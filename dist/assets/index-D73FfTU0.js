(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const h of document.querySelectorAll('link[rel="modulepreload"]'))o(h);new MutationObserver(h=>{for(const g of h)if(g.type==="childList")for(const _ of g.addedNodes)_.tagName==="LINK"&&_.rel==="modulepreload"&&o(_)}).observe(document,{childList:!0,subtree:!0});function t(h){const g={};return h.integrity&&(g.integrity=h.integrity),h.referrerPolicy&&(g.referrerPolicy=h.referrerPolicy),h.crossOrigin==="use-credentials"?g.credentials="include":h.crossOrigin==="anonymous"?g.credentials="omit":g.credentials="same-origin",g}function o(h){if(h.ep)return;h.ep=!0;const g=t(h);fetch(h.href,g)}})();function Rg(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Ov={exports:{}},vi={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var cb;function MP(){if(cb)return vi;cb=1;var i=Symbol.for("react.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),o=Symbol.for("react.strict_mode"),h=Symbol.for("react.profiler"),g=Symbol.for("react.provider"),_=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),R=Symbol.for("react.suspense"),O=Symbol.for("react.memo"),G=Symbol.for("react.lazy"),ne=Symbol.iterator;function re(Ze){return Ze===null||typeof Ze!="object"?null:(Ze=ne&&Ze[ne]||Ze["@@iterator"],typeof Ze=="function"?Ze:null)}var Q={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},de=Object.assign,Se={};function De(Ze,wt,Qt){this.props=Ze,this.context=wt,this.refs=Se,this.updater=Qt||Q}De.prototype.isReactComponent={},De.prototype.setState=function(Ze,wt){if(typeof Ze!="object"&&typeof Ze!="function"&&Ze!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,Ze,wt,"setState")},De.prototype.forceUpdate=function(Ze){this.updater.enqueueForceUpdate(this,Ze,"forceUpdate")};function Ke(){}Ke.prototype=De.prototype;function et(Ze,wt,Qt){this.props=Ze,this.context=wt,this.refs=Se,this.updater=Qt||Q}var vt=et.prototype=new Ke;vt.constructor=et,de(vt,De.prototype),vt.isPureReactComponent=!0;var Ye=Array.isArray,it=Object.prototype.hasOwnProperty,at={current:null},be={key:!0,ref:!0,__self:!0,__source:!0};function te(Ze,wt,Qt){var sn,Xt={},nn=null,Fn=null;if(wt!=null)for(sn in wt.ref!==void 0&&(Fn=wt.ref),wt.key!==void 0&&(nn=""+wt.key),wt)it.call(wt,sn)&&!be.hasOwnProperty(sn)&&(Xt[sn]=wt[sn]);var $n=arguments.length-2;if($n===1)Xt.children=Qt;else if(1<$n){for(var Jn=Array($n),ur=0;ur<$n;ur++)Jn[ur]=arguments[ur+2];Xt.children=Jn}if(Ze&&Ze.defaultProps)for(sn in $n=Ze.defaultProps,$n)Xt[sn]===void 0&&(Xt[sn]=$n[sn]);return{$$typeof:i,type:Ze,key:nn,ref:Fn,props:Xt,_owner:at.current}}function pe(Ze,wt){return{$$typeof:i,type:Ze.type,key:wt,ref:Ze.ref,props:Ze.props,_owner:Ze._owner}}function xe(Ze){return typeof Ze=="object"&&Ze!==null&&Ze.$$typeof===i}function Ae(Ze){var wt={"=":"=0",":":"=2"};return"$"+Ze.replace(/[=:]/g,function(Qt){return wt[Qt]})}var $e=/\/+/g;function Ce(Ze,wt){return typeof Ze=="object"&&Ze!==null&&Ze.key!=null?Ae(""+Ze.key):wt.toString(36)}function pn(Ze,wt,Qt,sn,Xt){var nn=typeof Ze;(nn==="undefined"||nn==="boolean")&&(Ze=null);var Fn=!1;if(Ze===null)Fn=!0;else switch(nn){case"string":case"number":Fn=!0;break;case"object":switch(Ze.$$typeof){case i:case e:Fn=!0}}if(Fn)return Fn=Ze,Xt=Xt(Fn),Ze=sn===""?"."+Ce(Fn,0):sn,Ye(Xt)?(Qt="",Ze!=null&&(Qt=Ze.replace($e,"$&/")+"/"),pn(Xt,wt,Qt,"",function(ur){return ur})):Xt!=null&&(xe(Xt)&&(Xt=pe(Xt,Qt+(!Xt.key||Fn&&Fn.key===Xt.key?"":(""+Xt.key).replace($e,"$&/")+"/")+Ze)),wt.push(Xt)),1;if(Fn=0,sn=sn===""?".":sn+":",Ye(Ze))for(var $n=0;$n<Ze.length;$n++){nn=Ze[$n];var Jn=sn+Ce(nn,$n);Fn+=pn(nn,wt,Qt,Jn,Xt)}else if(Jn=re(Ze),typeof Jn=="function")for(Ze=Jn.call(Ze),$n=0;!(nn=Ze.next()).done;)nn=nn.value,Jn=sn+Ce(nn,$n++),Fn+=pn(nn,wt,Qt,Jn,Xt);else if(nn==="object")throw wt=String(Ze),Error("Objects are not valid as a React child (found: "+(wt==="[object Object]"?"object with keys {"+Object.keys(Ze).join(", ")+"}":wt)+"). If you meant to render a collection of children, use an array instead.");return Fn}function ri(Ze,wt,Qt){if(Ze==null)return Ze;var sn=[],Xt=0;return pn(Ze,sn,"","",function(nn){return wt.call(Qt,nn,Xt++)}),sn}function dn(Ze){if(Ze._status===-1){var wt=Ze._result;wt=wt(),wt.then(function(Qt){(Ze._status===0||Ze._status===-1)&&(Ze._status=1,Ze._result=Qt)},function(Qt){(Ze._status===0||Ze._status===-1)&&(Ze._status=2,Ze._result=Qt)}),Ze._status===-1&&(Ze._status=0,Ze._result=wt)}if(Ze._status===1)return Ze._result.default;throw Ze._result}var jn={current:null},Tt={transition:null},gn={ReactCurrentDispatcher:jn,ReactCurrentBatchConfig:Tt,ReactCurrentOwner:at};function St(){throw Error("act(...) is not supported in production builds of React.")}return vi.Children={map:ri,forEach:function(Ze,wt,Qt){ri(Ze,function(){wt.apply(this,arguments)},Qt)},count:function(Ze){var wt=0;return ri(Ze,function(){wt++}),wt},toArray:function(Ze){return ri(Ze,function(wt){return wt})||[]},only:function(Ze){if(!xe(Ze))throw Error("React.Children.only expected to receive a single React element child.");return Ze}},vi.Component=De,vi.Fragment=t,vi.Profiler=h,vi.PureComponent=et,vi.StrictMode=o,vi.Suspense=R,vi.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=gn,vi.act=St,vi.cloneElement=function(Ze,wt,Qt){if(Ze==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+Ze+".");var sn=de({},Ze.props),Xt=Ze.key,nn=Ze.ref,Fn=Ze._owner;if(wt!=null){if(wt.ref!==void 0&&(nn=wt.ref,Fn=at.current),wt.key!==void 0&&(Xt=""+wt.key),Ze.type&&Ze.type.defaultProps)var $n=Ze.type.defaultProps;for(Jn in wt)it.call(wt,Jn)&&!be.hasOwnProperty(Jn)&&(sn[Jn]=wt[Jn]===void 0&&$n!==void 0?$n[Jn]:wt[Jn])}var Jn=arguments.length-2;if(Jn===1)sn.children=Qt;else if(1<Jn){$n=Array(Jn);for(var ur=0;ur<Jn;ur++)$n[ur]=arguments[ur+2];sn.children=$n}return{$$typeof:i,type:Ze.type,key:Xt,ref:nn,props:sn,_owner:Fn}},vi.createContext=function(Ze){return Ze={$$typeof:_,_currentValue:Ze,_currentValue2:Ze,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},Ze.Provider={$$typeof:g,_context:Ze},Ze.Consumer=Ze},vi.createElement=te,vi.createFactory=function(Ze){var wt=te.bind(null,Ze);return wt.type=Ze,wt},vi.createRef=function(){return{current:null}},vi.forwardRef=function(Ze){return{$$typeof:u,render:Ze}},vi.isValidElement=xe,vi.lazy=function(Ze){return{$$typeof:G,_payload:{_status:-1,_result:Ze},_init:dn}},vi.memo=function(Ze,wt){return{$$typeof:O,type:Ze,compare:wt===void 0?null:wt}},vi.startTransition=function(Ze){var wt=Tt.transition;Tt.transition={};try{Ze()}finally{Tt.transition=wt}},vi.unstable_act=St,vi.useCallback=function(Ze,wt){return jn.current.useCallback(Ze,wt)},vi.useContext=function(Ze){return jn.current.useContext(Ze)},vi.useDebugValue=function(){},vi.useDeferredValue=function(Ze){return jn.current.useDeferredValue(Ze)},vi.useEffect=function(Ze,wt){return jn.current.useEffect(Ze,wt)},vi.useId=function(){return jn.current.useId()},vi.useImperativeHandle=function(Ze,wt,Qt){return jn.current.useImperativeHandle(Ze,wt,Qt)},vi.useInsertionEffect=function(Ze,wt){return jn.current.useInsertionEffect(Ze,wt)},vi.useLayoutEffect=function(Ze,wt){return jn.current.useLayoutEffect(Ze,wt)},vi.useMemo=function(Ze,wt){return jn.current.useMemo(Ze,wt)},vi.useReducer=function(Ze,wt,Qt){return jn.current.useReducer(Ze,wt,Qt)},vi.useRef=function(Ze){return jn.current.useRef(Ze)},vi.useState=function(Ze){return jn.current.useState(Ze)},vi.useSyncExternalStore=function(Ze,wt,Qt){return jn.current.useSyncExternalStore(Ze,wt,Qt)},vi.useTransition=function(){return jn.current.useTransition()},vi.version="18.3.1",vi}var hb;function WT(){return hb||(hb=1,Ov.exports=MP()),Ov.exports}var It=WT();const Kt=Rg(It);var S_={},Fv={exports:{}},Dl={},Bv={exports:{}},Vv={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var db;function RP(){return db||(db=1,function(i){function e(Tt,gn){var St=Tt.length;Tt.push(gn);e:for(;0<St;){var Ze=St-1>>>1,wt=Tt[Ze];if(0<h(wt,gn))Tt[Ze]=gn,Tt[St]=wt,St=Ze;else break e}}function t(Tt){return Tt.length===0?null:Tt[0]}function o(Tt){if(Tt.length===0)return null;var gn=Tt[0],St=Tt.pop();if(St!==gn){Tt[0]=St;e:for(var Ze=0,wt=Tt.length,Qt=wt>>>1;Ze<Qt;){var sn=2*(Ze+1)-1,Xt=Tt[sn],nn=sn+1,Fn=Tt[nn];if(0>h(Xt,St))nn<wt&&0>h(Fn,Xt)?(Tt[Ze]=Fn,Tt[nn]=St,Ze=nn):(Tt[Ze]=Xt,Tt[sn]=St,Ze=sn);else if(nn<wt&&0>h(Fn,St))Tt[Ze]=Fn,Tt[nn]=St,Ze=nn;else break e}}return gn}function h(Tt,gn){var St=Tt.sortIndex-gn.sortIndex;return St!==0?St:Tt.id-gn.id}if(typeof performance=="object"&&typeof performance.now=="function"){var g=performance;i.unstable_now=function(){return g.now()}}else{var _=Date,u=_.now();i.unstable_now=function(){return _.now()-u}}var R=[],O=[],G=1,ne=null,re=3,Q=!1,de=!1,Se=!1,De=typeof setTimeout=="function"?setTimeout:null,Ke=typeof clearTimeout=="function"?clearTimeout:null,et=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function vt(Tt){for(var gn=t(O);gn!==null;){if(gn.callback===null)o(O);else if(gn.startTime<=Tt)o(O),gn.sortIndex=gn.expirationTime,e(R,gn);else break;gn=t(O)}}function Ye(Tt){if(Se=!1,vt(Tt),!de)if(t(R)!==null)de=!0,dn(it);else{var gn=t(O);gn!==null&&jn(Ye,gn.startTime-Tt)}}function it(Tt,gn){de=!1,Se&&(Se=!1,Ke(te),te=-1),Q=!0;var St=re;try{for(vt(gn),ne=t(R);ne!==null&&(!(ne.expirationTime>gn)||Tt&&!Ae());){var Ze=ne.callback;if(typeof Ze=="function"){ne.callback=null,re=ne.priorityLevel;var wt=Ze(ne.expirationTime<=gn);gn=i.unstable_now(),typeof wt=="function"?ne.callback=wt:ne===t(R)&&o(R),vt(gn)}else o(R);ne=t(R)}if(ne!==null)var Qt=!0;else{var sn=t(O);sn!==null&&jn(Ye,sn.startTime-gn),Qt=!1}return Qt}finally{ne=null,re=St,Q=!1}}var at=!1,be=null,te=-1,pe=5,xe=-1;function Ae(){return!(i.unstable_now()-xe<pe)}function $e(){if(be!==null){var Tt=i.unstable_now();xe=Tt;var gn=!0;try{gn=be(!0,Tt)}finally{gn?Ce():(at=!1,be=null)}}else at=!1}var Ce;if(typeof et=="function")Ce=function(){et($e)};else if(typeof MessageChannel<"u"){var pn=new MessageChannel,ri=pn.port2;pn.port1.onmessage=$e,Ce=function(){ri.postMessage(null)}}else Ce=function(){De($e,0)};function dn(Tt){be=Tt,at||(at=!0,Ce())}function jn(Tt,gn){te=De(function(){Tt(i.unstable_now())},gn)}i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function(Tt){Tt.callback=null},i.unstable_continueExecution=function(){de||Q||(de=!0,dn(it))},i.unstable_forceFrameRate=function(Tt){0>Tt||125<Tt?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):pe=0<Tt?Math.floor(1e3/Tt):5},i.unstable_getCurrentPriorityLevel=function(){return re},i.unstable_getFirstCallbackNode=function(){return t(R)},i.unstable_next=function(Tt){switch(re){case 1:case 2:case 3:var gn=3;break;default:gn=re}var St=re;re=gn;try{return Tt()}finally{re=St}},i.unstable_pauseExecution=function(){},i.unstable_requestPaint=function(){},i.unstable_runWithPriority=function(Tt,gn){switch(Tt){case 1:case 2:case 3:case 4:case 5:break;default:Tt=3}var St=re;re=Tt;try{return gn()}finally{re=St}},i.unstable_scheduleCallback=function(Tt,gn,St){var Ze=i.unstable_now();switch(typeof St=="object"&&St!==null?(St=St.delay,St=typeof St=="number"&&0<St?Ze+St:Ze):St=Ze,Tt){case 1:var wt=-1;break;case 2:wt=250;break;case 5:wt=1073741823;break;case 4:wt=1e4;break;default:wt=5e3}return wt=St+wt,Tt={id:G++,callback:gn,priorityLevel:Tt,startTime:St,expirationTime:wt,sortIndex:-1},St>Ze?(Tt.sortIndex=St,e(O,Tt),t(R)===null&&Tt===t(O)&&(Se?(Ke(te),te=-1):Se=!0,jn(Ye,St-Ze))):(Tt.sortIndex=wt,e(R,Tt),de||Q||(de=!0,dn(it))),Tt},i.unstable_shouldYield=Ae,i.unstable_wrapCallback=function(Tt){var gn=re;return function(){var St=re;re=gn;try{return Tt.apply(this,arguments)}finally{re=St}}}}(Vv)),Vv}var pb;function LP(){return pb||(pb=1,Bv.exports=RP()),Bv.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var fb;function DP(){if(fb)return Dl;fb=1;var i=WT(),e=LP();function t(c){for(var f="https://reactjs.org/docs/error-decoder.html?invariant="+c,S=1;S<arguments.length;S++)f+="&args[]="+encodeURIComponent(arguments[S]);return"Minified React error #"+c+"; visit "+f+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var o=new Set,h={};function g(c,f){_(c,f),_(c+"Capture",f)}function _(c,f){for(h[c]=f,c=0;c<f.length;c++)o.add(f[c])}var u=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),R=Object.prototype.hasOwnProperty,O=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,G={},ne={};function re(c){return R.call(ne,c)?!0:R.call(G,c)?!1:O.test(c)?ne[c]=!0:(G[c]=!0,!1)}function Q(c,f,S,k){if(S!==null&&S.type===0)return!1;switch(typeof f){case"function":case"symbol":return!0;case"boolean":return k?!1:S!==null?!S.acceptsBooleans:(c=c.toLowerCase().slice(0,5),c!=="data-"&&c!=="aria-");default:return!1}}function de(c,f,S,k){if(f===null||typeof f>"u"||Q(c,f,S,k))return!0;if(k)return!1;if(S!==null)switch(S.type){case 3:return!f;case 4:return f===!1;case 5:return isNaN(f);case 6:return isNaN(f)||1>f}return!1}function Se(c,f,S,k,V,$,ue){this.acceptsBooleans=f===2||f===3||f===4,this.attributeName=k,this.attributeNamespace=V,this.mustUseProperty=S,this.propertyName=c,this.type=f,this.sanitizeURL=$,this.removeEmptyString=ue}var De={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(c){De[c]=new Se(c,0,!1,c,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(c){var f=c[0];De[f]=new Se(f,1,!1,c[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(c){De[c]=new Se(c,2,!1,c.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(c){De[c]=new Se(c,2,!1,c,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(c){De[c]=new Se(c,3,!1,c.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(c){De[c]=new Se(c,3,!0,c,null,!1,!1)}),["capture","download"].forEach(function(c){De[c]=new Se(c,4,!1,c,null,!1,!1)}),["cols","rows","size","span"].forEach(function(c){De[c]=new Se(c,6,!1,c,null,!1,!1)}),["rowSpan","start"].forEach(function(c){De[c]=new Se(c,5,!1,c.toLowerCase(),null,!1,!1)});var Ke=/[\-:]([a-z])/g;function et(c){return c[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(c){var f=c.replace(Ke,et);De[f]=new Se(f,1,!1,c,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(c){var f=c.replace(Ke,et);De[f]=new Se(f,1,!1,c,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(c){var f=c.replace(Ke,et);De[f]=new Se(f,1,!1,c,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(c){De[c]=new Se(c,1,!1,c.toLowerCase(),null,!1,!1)}),De.xlinkHref=new Se("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(c){De[c]=new Se(c,1,!1,c.toLowerCase(),null,!0,!0)});function vt(c,f,S,k){var V=De.hasOwnProperty(f)?De[f]:null;(V!==null?V.type!==0:k||!(2<f.length)||f[0]!=="o"&&f[0]!=="O"||f[1]!=="n"&&f[1]!=="N")&&(de(f,S,V,k)&&(S=null),k||V===null?re(f)&&(S===null?c.removeAttribute(f):c.setAttribute(f,""+S)):V.mustUseProperty?c[V.propertyName]=S===null?V.type===3?!1:"":S:(f=V.attributeName,k=V.attributeNamespace,S===null?c.removeAttribute(f):(V=V.type,S=V===3||V===4&&S===!0?"":""+S,k?c.setAttributeNS(k,f,S):c.setAttribute(f,S))))}var Ye=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,it=Symbol.for("react.element"),at=Symbol.for("react.portal"),be=Symbol.for("react.fragment"),te=Symbol.for("react.strict_mode"),pe=Symbol.for("react.profiler"),xe=Symbol.for("react.provider"),Ae=Symbol.for("react.context"),$e=Symbol.for("react.forward_ref"),Ce=Symbol.for("react.suspense"),pn=Symbol.for("react.suspense_list"),ri=Symbol.for("react.memo"),dn=Symbol.for("react.lazy"),jn=Symbol.for("react.offscreen"),Tt=Symbol.iterator;function gn(c){return c===null||typeof c!="object"?null:(c=Tt&&c[Tt]||c["@@iterator"],typeof c=="function"?c:null)}var St=Object.assign,Ze;function wt(c){if(Ze===void 0)try{throw Error()}catch(S){var f=S.stack.trim().match(/\n( *(at )?)/);Ze=f&&f[1]||""}return`
`+Ze+c}var Qt=!1;function sn(c,f){if(!c||Qt)return"";Qt=!0;var S=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(f)if(f=function(){throw Error()},Object.defineProperty(f.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(f,[])}catch(gt){var k=gt}Reflect.construct(c,[],f)}else{try{f.call()}catch(gt){k=gt}c.call(f.prototype)}else{try{throw Error()}catch(gt){k=gt}c()}}catch(gt){if(gt&&k&&typeof gt.stack=="string"){for(var V=gt.stack.split(`
`),$=k.stack.split(`
`),ue=V.length-1,Le=$.length-1;1<=ue&&0<=Le&&V[ue]!==$[Le];)Le--;for(;1<=ue&&0<=Le;ue--,Le--)if(V[ue]!==$[Le]){if(ue!==1||Le!==1)do if(ue--,Le--,0>Le||V[ue]!==$[Le]){var He=`
`+V[ue].replace(" at new "," at ");return c.displayName&&He.includes("<anonymous>")&&(He=He.replace("<anonymous>",c.displayName)),He}while(1<=ue&&0<=Le);break}}}finally{Qt=!1,Error.prepareStackTrace=S}return(c=c?c.displayName||c.name:"")?wt(c):""}function Xt(c){switch(c.tag){case 5:return wt(c.type);case 16:return wt("Lazy");case 13:return wt("Suspense");case 19:return wt("SuspenseList");case 0:case 2:case 15:return c=sn(c.type,!1),c;case 11:return c=sn(c.type.render,!1),c;case 1:return c=sn(c.type,!0),c;default:return""}}function nn(c){if(c==null)return null;if(typeof c=="function")return c.displayName||c.name||null;if(typeof c=="string")return c;switch(c){case be:return"Fragment";case at:return"Portal";case pe:return"Profiler";case te:return"StrictMode";case Ce:return"Suspense";case pn:return"SuspenseList"}if(typeof c=="object")switch(c.$$typeof){case Ae:return(c.displayName||"Context")+".Consumer";case xe:return(c._context.displayName||"Context")+".Provider";case $e:var f=c.render;return c=c.displayName,c||(c=f.displayName||f.name||"",c=c!==""?"ForwardRef("+c+")":"ForwardRef"),c;case ri:return f=c.displayName||null,f!==null?f:nn(c.type)||"Memo";case dn:f=c._payload,c=c._init;try{return nn(c(f))}catch{}}return null}function Fn(c){var f=c.type;switch(c.tag){case 24:return"Cache";case 9:return(f.displayName||"Context")+".Consumer";case 10:return(f._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return c=f.render,c=c.displayName||c.name||"",f.displayName||(c!==""?"ForwardRef("+c+")":"ForwardRef");case 7:return"Fragment";case 5:return f;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return nn(f);case 8:return f===te?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof f=="function")return f.displayName||f.name||null;if(typeof f=="string")return f}return null}function $n(c){switch(typeof c){case"boolean":case"number":case"string":case"undefined":return c;case"object":return c;default:return""}}function Jn(c){var f=c.type;return(c=c.nodeName)&&c.toLowerCase()==="input"&&(f==="checkbox"||f==="radio")}function ur(c){var f=Jn(c)?"checked":"value",S=Object.getOwnPropertyDescriptor(c.constructor.prototype,f),k=""+c[f];if(!c.hasOwnProperty(f)&&typeof S<"u"&&typeof S.get=="function"&&typeof S.set=="function"){var V=S.get,$=S.set;return Object.defineProperty(c,f,{configurable:!0,get:function(){return V.call(this)},set:function(ue){k=""+ue,$.call(this,ue)}}),Object.defineProperty(c,f,{enumerable:S.enumerable}),{getValue:function(){return k},setValue:function(ue){k=""+ue},stopTracking:function(){c._valueTracker=null,delete c[f]}}}}function Ji(c){c._valueTracker||(c._valueTracker=ur(c))}function Ui(c){if(!c)return!1;var f=c._valueTracker;if(!f)return!0;var S=f.getValue(),k="";return c&&(k=Jn(c)?c.checked?"true":"false":c.value),c=k,c!==S?(f.setValue(c),!0):!1}function Hr(c){if(c=c||(typeof document<"u"?document:void 0),typeof c>"u")return null;try{return c.activeElement||c.body}catch{return c.body}}function Wi(c,f){var S=f.checked;return St({},f,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:S??c._wrapperState.initialChecked})}function Qo(c,f){var S=f.defaultValue==null?"":f.defaultValue,k=f.checked!=null?f.checked:f.defaultChecked;S=$n(f.value!=null?f.value:S),c._wrapperState={initialChecked:k,initialValue:S,controlled:f.type==="checkbox"||f.type==="radio"?f.checked!=null:f.value!=null}}function bs(c,f){f=f.checked,f!=null&&vt(c,"checked",f,!1)}function Qr(c,f){bs(c,f);var S=$n(f.value),k=f.type;if(S!=null)k==="number"?(S===0&&c.value===""||c.value!=S)&&(c.value=""+S):c.value!==""+S&&(c.value=""+S);else if(k==="submit"||k==="reset"){c.removeAttribute("value");return}f.hasOwnProperty("value")?Jo(c,f.type,S):f.hasOwnProperty("defaultValue")&&Jo(c,f.type,$n(f.defaultValue)),f.checked==null&&f.defaultChecked!=null&&(c.defaultChecked=!!f.defaultChecked)}function Oo(c,f,S){if(f.hasOwnProperty("value")||f.hasOwnProperty("defaultValue")){var k=f.type;if(!(k!=="submit"&&k!=="reset"||f.value!==void 0&&f.value!==null))return;f=""+c._wrapperState.initialValue,S||f===c.value||(c.value=f),c.defaultValue=f}S=c.name,S!==""&&(c.name=""),c.defaultChecked=!!c._wrapperState.initialChecked,S!==""&&(c.name=S)}function Jo(c,f,S){(f!=="number"||Hr(c.ownerDocument)!==c)&&(S==null?c.defaultValue=""+c._wrapperState.initialValue:c.defaultValue!==""+S&&(c.defaultValue=""+S))}var vr=Array.isArray;function Jr(c,f,S,k){if(c=c.options,f){f={};for(var V=0;V<S.length;V++)f["$"+S[V]]=!0;for(S=0;S<c.length;S++)V=f.hasOwnProperty("$"+c[S].value),c[S].selected!==V&&(c[S].selected=V),V&&k&&(c[S].defaultSelected=!0)}else{for(S=""+$n(S),f=null,V=0;V<c.length;V++){if(c[V].value===S){c[V].selected=!0,k&&(c[V].defaultSelected=!0);return}f!==null||c[V].disabled||(f=c[V])}f!==null&&(f.selected=!0)}}function Ts(c,f){if(f.dangerouslySetInnerHTML!=null)throw Error(t(91));return St({},f,{value:void 0,defaultValue:void 0,children:""+c._wrapperState.initialValue})}function Fo(c,f){var S=f.value;if(S==null){if(S=f.children,f=f.defaultValue,S!=null){if(f!=null)throw Error(t(92));if(vr(S)){if(1<S.length)throw Error(t(93));S=S[0]}f=S}f==null&&(f=""),S=f}c._wrapperState={initialValue:$n(S)}}function _a(c,f){var S=$n(f.value),k=$n(f.defaultValue);S!=null&&(S=""+S,S!==c.value&&(c.value=S),f.defaultValue==null&&c.defaultValue!==S&&(c.defaultValue=S)),k!=null&&(c.defaultValue=""+k)}function Hs(c){var f=c.textContent;f===c._wrapperState.initialValue&&f!==""&&f!==null&&(c.value=f)}function Mi(c){switch(c){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function er(c,f){return c==null||c==="http://www.w3.org/1999/xhtml"?Mi(f):c==="http://www.w3.org/2000/svg"&&f==="foreignObject"?"http://www.w3.org/1999/xhtml":c}var qr,qs=function(c){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(f,S,k,V){MSApp.execUnsafeLocalFunction(function(){return c(f,S,k,V)})}:c}(function(c,f){if(c.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in c)c.innerHTML=f;else{for(qr=qr||document.createElement("div"),qr.innerHTML="<svg>"+f.valueOf().toString()+"</svg>",f=qr.firstChild;c.firstChild;)c.removeChild(c.firstChild);for(;f.firstChild;)c.appendChild(f.firstChild)}});function uo(c,f){if(f){var S=c.firstChild;if(S&&S===c.lastChild&&S.nodeType===3){S.nodeValue=f;return}}c.textContent=f}var es={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Ss=["Webkit","ms","Moz","O"];Object.keys(es).forEach(function(c){Ss.forEach(function(f){f=f+c.charAt(0).toUpperCase()+c.substring(1),es[f]=es[c]})});function ya(c,f,S){return f==null||typeof f=="boolean"||f===""?"":S||typeof f!="number"||f===0||es.hasOwnProperty(c)&&es[c]?(""+f).trim():f+"px"}function Bo(c,f){c=c.style;for(var S in f)if(f.hasOwnProperty(S)){var k=S.indexOf("--")===0,V=ya(S,f[S],k);S==="float"&&(S="cssFloat"),k?c.setProperty(S,V):c[S]=V}}var ve=St({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function se(c,f){if(f){if(ve[c]&&(f.children!=null||f.dangerouslySetInnerHTML!=null))throw Error(t(137,c));if(f.dangerouslySetInnerHTML!=null){if(f.children!=null)throw Error(t(60));if(typeof f.dangerouslySetInnerHTML!="object"||!("__html"in f.dangerouslySetInnerHTML))throw Error(t(61))}if(f.style!=null&&typeof f.style!="object")throw Error(t(62))}}function ce(c,f){if(c.indexOf("-")===-1)return typeof f.is=="string";switch(c){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var fe=null;function Pe(c){return c=c.target||c.srcElement||window,c.correspondingUseElement&&(c=c.correspondingUseElement),c.nodeType===3?c.parentNode:c}var Be=null,qe=null,tt=null;function Ge(c){if(c=$i(c)){if(typeof Be!="function")throw Error(t(280));var f=c.stateNode;f&&(f=Uo(f),Be(c.stateNode,c.type,f))}}function ht(c){qe?tt?tt.push(c):tt=[c]:qe=c}function ut(){if(qe){var c=qe,f=tt;if(tt=qe=null,Ge(c),f)for(c=0;c<f.length;c++)Ge(f[c])}}function Xe(c,f){return c(f)}function Ue(){}var zt=!1;function Nt(c,f,S){if(zt)return c(f,S);zt=!0;try{return Xe(c,f,S)}finally{zt=!1,(qe!==null||tt!==null)&&(Ue(),ut())}}function en(c,f){var S=c.stateNode;if(S===null)return null;var k=Uo(S);if(k===null)return null;S=k[f];e:switch(f){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(k=!k.disabled)||(c=c.type,k=!(c==="button"||c==="input"||c==="select"||c==="textarea")),c=!k;break e;default:c=!1}if(c)return null;if(S&&typeof S!="function")throw Error(t(231,f,typeof S));return S}var Pn=!1;if(u)try{var mt={};Object.defineProperty(mt,"passive",{get:function(){Pn=!0}}),window.addEventListener("test",mt,mt),window.removeEventListener("test",mt,mt)}catch{Pn=!1}function Vt(c,f,S,k,V,$,ue,Le,He){var gt=Array.prototype.slice.call(arguments,3);try{f.apply(S,gt)}catch(Bt){this.onError(Bt)}}var $t=!1,Lt=null,Nn=!1,mn=null,Yt={onError:function(c){$t=!0,Lt=c}};function Ri(c,f,S,k,V,$,ue,Le,He){$t=!1,Lt=null,Vt.apply(Yt,arguments)}function ts(c,f,S,k,V,$,ue,Le,He){if(Ri.apply(this,arguments),$t){if($t){var gt=Lt;$t=!1,Lt=null}else throw Error(t(198));Nn||(Nn=!0,mn=gt)}}function Si(c){var f=c,S=c;if(c.alternate)for(;f.return;)f=f.return;else{c=f;do f=c,(f.flags&4098)!==0&&(S=f.return),c=f.return;while(c)}return f.tag===3?S:null}function xi(c){if(c.tag===13){var f=c.memoizedState;if(f===null&&(c=c.alternate,c!==null&&(f=c.memoizedState)),f!==null)return f.dehydrated}return null}function oi(c){if(Si(c)!==c)throw Error(t(188))}function co(c){var f=c.alternate;if(!f){if(f=Si(c),f===null)throw Error(t(188));return f!==c?null:c}for(var S=c,k=f;;){var V=S.return;if(V===null)break;var $=V.alternate;if($===null){if(k=V.return,k!==null){S=k;continue}break}if(V.child===$.child){for($=V.child;$;){if($===S)return oi(V),c;if($===k)return oi(V),f;$=$.sibling}throw Error(t(188))}if(S.return!==k.return)S=V,k=$;else{for(var ue=!1,Le=V.child;Le;){if(Le===S){ue=!0,S=V,k=$;break}if(Le===k){ue=!0,k=V,S=$;break}Le=Le.sibling}if(!ue){for(Le=$.child;Le;){if(Le===S){ue=!0,S=$,k=V;break}if(Le===k){ue=!0,k=$,S=V;break}Le=Le.sibling}if(!ue)throw Error(t(189))}}if(S.alternate!==k)throw Error(t(190))}if(S.tag!==3)throw Error(t(188));return S.stateNode.current===S?c:f}function Li(c){return c=co(c),c!==null?va(c):null}function va(c){if(c.tag===5||c.tag===6)return c;for(c=c.child;c!==null;){var f=va(c);if(f!==null)return f;c=c.sibling}return null}var Gs=e.unstable_scheduleCallback,ul=e.unstable_cancelCallback,xa=e.unstable_shouldYield,Es=e.unstable_requestPaint,Ki=e.unstable_now,yu=e.unstable_getCurrentPriorityLevel,cl=e.unstable_ImmediatePriority,ns=e.unstable_UserBlockingPriority,is=e.unstable_NormalPriority,Fl=e.unstable_LowPriority,hl=e.unstable_IdlePriority,dl=null,bo=null;function wa(c){if(bo&&typeof bo.onCommitFiberRoot=="function")try{bo.onCommitFiberRoot(dl,c,void 0,(c.current.flags&128)===128)}catch{}}var An=Math.clz32?Math.clz32:To,Di=Math.log,pl=Math.LN2;function To(c){return c>>>=0,c===0?32:31-(Di(c)/pl|0)|0}var rs=64,Zs=4194304;function Dn(c){switch(c&-c){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return c&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return c&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return c}}function fi(c,f){var S=c.pendingLanes;if(S===0)return 0;var k=0,V=c.suspendedLanes,$=c.pingedLanes,ue=S&268435455;if(ue!==0){var Le=ue&~V;Le!==0?k=Dn(Le):($&=ue,$!==0&&(k=Dn($)))}else ue=S&~V,ue!==0?k=Dn(ue):$!==0&&(k=Dn($));if(k===0)return 0;if(f!==0&&f!==k&&(f&V)===0&&(V=k&-k,$=f&-f,V>=$||V===16&&($&4194240)!==0))return f;if((k&4)!==0&&(k|=S&16),f=c.entangledLanes,f!==0)for(c=c.entanglements,f&=k;0<f;)S=31-An(f),V=1<<S,k|=c[S],f&=~V;return k}function Bl(c,f){switch(c){case 1:case 2:case 4:return f+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return f+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Sr(c,f){for(var S=c.suspendedLanes,k=c.pingedLanes,V=c.expirationTimes,$=c.pendingLanes;0<$;){var ue=31-An($),Le=1<<ue,He=V[ue];He===-1?((Le&S)===0||(Le&k)!==0)&&(V[ue]=Bl(Le,f)):He<=f&&(c.expiredLanes|=Le),$&=~Le}}function ln(c){return c=c.pendingLanes&-1073741825,c!==0?c:c&1073741824?1073741824:0}function ho(){var c=rs;return rs<<=1,(rs&4194240)===0&&(rs=64),c}function kn(c){for(var f=[],S=0;31>S;S++)f.push(c);return f}function eo(c,f,S){c.pendingLanes|=f,f!==536870912&&(c.suspendedLanes=0,c.pingedLanes=0),c=c.eventTimes,f=31-An(f),c[f]=S}function On(c,f){var S=c.pendingLanes&~f;c.pendingLanes=f,c.suspendedLanes=0,c.pingedLanes=0,c.expiredLanes&=f,c.mutableReadLanes&=f,c.entangledLanes&=f,f=c.entanglements;var k=c.eventTimes;for(c=c.expirationTimes;0<S;){var V=31-An(S),$=1<<V;f[V]=0,k[V]=-1,c[V]=-1,S&=~$}}function Gr(c,f){var S=c.entangledLanes|=f;for(c=c.entanglements;S;){var k=31-An(S),V=1<<k;V&f|c[k]&f&&(c[k]|=f),S&=~V}}var _n=0;function Ei(c){return c&=-c,1<c?4<c?(c&268435455)!==0?16:536870912:4:1}var zi,Is,Er,Ir,xr,Ha=!1,Zr=[],Bn=null,po=null,wr=null,fo=new Map,hn=new Map,Pr=[],si="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function fl(c,f){switch(c){case"focusin":case"focusout":Bn=null;break;case"dragenter":case"dragleave":po=null;break;case"mouseover":case"mouseout":wr=null;break;case"pointerover":case"pointerout":fo.delete(f.pointerId);break;case"gotpointercapture":case"lostpointercapture":hn.delete(f.pointerId)}}function Kn(c,f,S,k,V,$){return c===null||c.nativeEvent!==$?(c={blockedOn:f,domEventName:S,eventSystemFlags:k,nativeEvent:$,targetContainers:[V]},f!==null&&(f=$i(f),f!==null&&Is(f)),c):(c.eventSystemFlags|=k,f=c.targetContainers,V!==null&&f.indexOf(V)===-1&&f.push(V),c)}function ba(c,f,S,k,V){switch(f){case"focusin":return Bn=Kn(Bn,c,f,S,k,V),!0;case"dragenter":return po=Kn(po,c,f,S,k,V),!0;case"mouseover":return wr=Kn(wr,c,f,S,k,V),!0;case"pointerover":var $=V.pointerId;return fo.set($,Kn(fo.get($)||null,c,f,S,k,V)),!0;case"gotpointercapture":return $=V.pointerId,hn.set($,Kn(hn.get($)||null,c,f,S,k,V)),!0}return!1}function Wn(c){var f=Ar(c.target);if(f!==null){var S=Si(f);if(S!==null){if(f=S.tag,f===13){if(f=xi(S),f!==null){c.blockedOn=f,xr(c.priority,function(){Er(S)});return}}else if(f===3&&S.stateNode.current.memoizedState.isDehydrated){c.blockedOn=S.tag===3?S.stateNode.containerInfo:null;return}}}c.blockedOn=null}function xn(c){if(c.blockedOn!==null)return!1;for(var f=c.targetContainers;0<f.length;){var S=Ga(c.domEventName,c.eventSystemFlags,f[0],c.nativeEvent);if(S===null){S=c.nativeEvent;var k=new S.constructor(S.type,S);fe=k,S.target.dispatchEvent(k),fe=null}else return f=$i(S),f!==null&&Is(f),c.blockedOn=S,!1;f.shift()}return!0}function os(c,f,S){xn(c)&&S.delete(f)}function Hn(){Ha=!1,Bn!==null&&xn(Bn)&&(Bn=null),po!==null&&xn(po)&&(po=null),wr!==null&&xn(wr)&&(wr=null),fo.forEach(os),hn.forEach(os)}function gi(c,f){c.blockedOn===f&&(c.blockedOn=null,Ha||(Ha=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,Hn)))}function Xi(c){function f(V){return gi(V,c)}if(0<Zr.length){gi(Zr[0],c);for(var S=1;S<Zr.length;S++){var k=Zr[S];k.blockedOn===c&&(k.blockedOn=null)}}for(Bn!==null&&gi(Bn,c),po!==null&&gi(po,c),wr!==null&&gi(wr,c),fo.forEach(f),hn.forEach(f),S=0;S<Pr.length;S++)k=Pr[S],k.blockedOn===c&&(k.blockedOn=null);for(;0<Pr.length&&(S=Pr[0],S.blockedOn===null);)Wn(S),S.blockedOn===null&&Pr.shift()}var Vo=Ye.ReactCurrentBatchConfig,ss=!0;function ji(c,f,S,k){var V=_n,$=Vo.transition;Vo.transition=null;try{_n=1,ml(c,f,S,k)}finally{_n=V,Vo.transition=$}}function Ta(c,f,S,k){var V=_n,$=Vo.transition;Vo.transition=null;try{_n=4,ml(c,f,S,k)}finally{_n=V,Vo.transition=$}}function ml(c,f,S,k){if(ss){var V=Ga(c,f,S,k);if(V===null)d(c,f,k,qa,S),fl(c,k);else if(ba(V,c,f,S,k))k.stopPropagation();else if(fl(c,k),f&4&&-1<si.indexOf(c)){for(;V!==null;){var $=$i(V);if($!==null&&zi($),$=Ga(c,f,S,k),$===null&&d(c,f,k,qa,S),$===V)break;V=$}V!==null&&k.stopPropagation()}else d(c,f,k,null,S)}}var qa=null;function Ga(c,f,S,k){if(qa=null,c=Pe(k),c=Ar(c),c!==null)if(f=Si(c),f===null)c=null;else if(S=f.tag,S===13){if(c=xi(f),c!==null)return c;c=null}else if(S===3){if(f.stateNode.current.memoizedState.isDehydrated)return f.tag===3?f.stateNode.containerInfo:null;c=null}else f!==c&&(c=null);return qa=c,null}function ei(c){switch(c){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(yu()){case cl:return 1;case ns:return 4;case is:case Fl:return 16;case hl:return 536870912;default:return 16}default:return 16}}var to=null,qn=null,mr=null;function mo(){if(mr)return mr;var c,f=qn,S=f.length,k,V="value"in to?to.value:to.textContent,$=V.length;for(c=0;c<S&&f[c]===V[c];c++);var ue=S-c;for(k=1;k<=ue&&f[S-k]===V[$-k];k++);return mr=V.slice(c,1<k?1-k:void 0)}function Ps(c){var f=c.keyCode;return"charCode"in c?(c=c.charCode,c===0&&f===13&&(c=13)):c=f,c===10&&(c=13),32<=c||c===13?c:0}function Ii(){return!0}function Vl(){return!1}function or(c){function f(S,k,V,$,ue){this._reactName=S,this._targetInst=V,this.type=k,this.nativeEvent=$,this.target=ue,this.currentTarget=null;for(var Le in c)c.hasOwnProperty(Le)&&(S=c[Le],this[Le]=S?S($):$[Le]);return this.isDefaultPrevented=($.defaultPrevented!=null?$.defaultPrevented:$.returnValue===!1)?Ii:Vl,this.isPropagationStopped=Vl,this}return St(f.prototype,{preventDefault:function(){this.defaultPrevented=!0;var S=this.nativeEvent;S&&(S.preventDefault?S.preventDefault():typeof S.returnValue!="unknown"&&(S.returnValue=!1),this.isDefaultPrevented=Ii)},stopPropagation:function(){var S=this.nativeEvent;S&&(S.stopPropagation?S.stopPropagation():typeof S.cancelBubble!="unknown"&&(S.cancelBubble=!0),this.isPropagationStopped=Ii)},persist:function(){},isPersistent:Ii}),f}var Cs={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(c){return c.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},vu=or(Cs),So=St({},Cs,{view:0,detail:0}),$u=or(So),Eo,As,Io,tr=St({},So,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Po,button:0,buttons:0,relatedTarget:function(c){return c.relatedTarget===void 0?c.fromElement===c.srcElement?c.toElement:c.fromElement:c.relatedTarget},movementX:function(c){return"movementX"in c?c.movementX:(c!==Io&&(Io&&c.type==="mousemove"?(Eo=c.screenX-Io.screenX,As=c.screenY-Io.screenY):As=Eo=0,Io=c),Eo)},movementY:function(c){return"movementY"in c?c.movementY:As}}),Ws=or(tr),Ks=St({},tr,{dataTransfer:0}),gl=or(Ks),no=St({},So,{relatedTarget:0}),Ul=or(no),jl=St({},Cs,{animationName:0,elapsedTime:0,pseudoElement:0}),as=or(jl),_l=St({},Cs,{clipboardData:function(c){return"clipboardData"in c?c.clipboardData:window.clipboardData}}),Za=or(_l),$l=St({},Cs,{data:0}),Hl=or($l),ls={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Wr={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},ks={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Pc(c){var f=this.nativeEvent;return f.getModifierState?f.getModifierState(c):(c=ks[c])?!!f[c]:!1}function Po(){return Pc}var P=St({},So,{key:function(c){if(c.key){var f=ls[c.key]||c.key;if(f!=="Unidentified")return f}return c.type==="keypress"?(c=Ps(c),c===13?"Enter":String.fromCharCode(c)):c.type==="keydown"||c.type==="keyup"?Wr[c.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Po,charCode:function(c){return c.type==="keypress"?Ps(c):0},keyCode:function(c){return c.type==="keydown"||c.type==="keyup"?c.keyCode:0},which:function(c){return c.type==="keypress"?Ps(c):c.type==="keydown"||c.type==="keyup"?c.keyCode:0}}),j=or(P),Y=St({},tr,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),ye=or(Y),nt=St({},So,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Po}),ft=or(nt),Zt=St({},Cs,{propertyName:0,elapsedTime:0,pseudoElement:0}),Pi=or(Zt),cr=St({},tr,{deltaX:function(c){return"deltaX"in c?c.deltaX:"wheelDeltaX"in c?-c.wheelDeltaX:0},deltaY:function(c){return"deltaY"in c?c.deltaY:"wheelDeltaY"in c?-c.wheelDeltaY:"wheelDelta"in c?-c.wheelDelta:0},deltaZ:0,deltaMode:0}),ai=or(cr),wi=[9,13,27,32],sr=u&&"CompositionEvent"in window,Ms=null;u&&"documentMode"in document&&(Ms=document.documentMode);var gr=u&&"TextEvent"in window&&!Ms,Wa=u&&(!sr||Ms&&8<Ms&&11>=Ms),Rs=" ",Cc=!1;function yl(c,f){switch(c){case"keyup":return wi.indexOf(f.keyCode)!==-1;case"keydown":return f.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function ql(c){return c=c.detail,typeof c=="object"&&"data"in c?c.data:null}var io=!1;function yh(c,f){switch(c){case"compositionend":return ql(f);case"keypress":return f.which!==32?null:(Cc=!0,Rs);case"textInput":return c=f.data,c===Rs&&Cc?null:c;default:return null}}function Sa(c,f){if(io)return c==="compositionend"||!sr&&yl(c,f)?(c=mo(),mr=qn=to=null,io=!1,c):null;switch(c){case"paste":return null;case"keypress":if(!(f.ctrlKey||f.altKey||f.metaKey)||f.ctrlKey&&f.altKey){if(f.char&&1<f.char.length)return f.char;if(f.which)return String.fromCharCode(f.which)}return null;case"compositionend":return Wa&&f.locale!=="ko"?null:f.data;default:return null}}var Gl={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function vh(c){var f=c&&c.nodeName&&c.nodeName.toLowerCase();return f==="input"?!!Gl[c.type]:f==="textarea"}function xu(c,f,S,k){ht(k),f=A(f,"onChange"),0<f.length&&(S=new vu("onChange","change",null,S,k),c.push({event:S,listeners:f}))}var Xs=null,Co=null;function _i(c){Rc(c,0)}function Ka(c){var f=Ds(c);if(Ui(f))return c}function qd(c,f){if(c==="change")return f}var Ea=!1;if(u){var Zl;if(u){var Ac="oninput"in document;if(!Ac){var Hu=document.createElement("div");Hu.setAttribute("oninput","return;"),Ac=typeof Hu.oninput=="function"}Zl=Ac}else Zl=!1;Ea=Zl&&(!document.documentMode||9<document.documentMode)}function vl(){Xs&&(Xs.detachEvent("onpropertychange",Wl),Co=Xs=null)}function Wl(c){if(c.propertyName==="value"&&Ka(Co)){var f=[];xu(f,Co,c,Pe(c)),Nt(_i,f)}}function Kl(c,f,S){c==="focusin"?(vl(),Xs=f,Co=S,Xs.attachEvent("onpropertychange",Wl)):c==="focusout"&&vl()}function xl(c){if(c==="selectionchange"||c==="keyup"||c==="keydown")return Ka(Co)}function Ia(c,f){if(c==="click")return Ka(f)}function wl(c,f){if(c==="input"||c==="change")return Ka(f)}function us(c,f){return c===f&&(c!==0||1/c===1/f)||c!==c&&f!==f}var Ls=typeof Object.is=="function"?Object.is:us;function Xa(c,f){if(Ls(c,f))return!0;if(typeof c!="object"||c===null||typeof f!="object"||f===null)return!1;var S=Object.keys(c),k=Object.keys(f);if(S.length!==k.length)return!1;for(k=0;k<S.length;k++){var V=S[k];if(!R.call(f,V)||!Ls(c[V],f[V]))return!1}return!0}function kc(c){for(;c&&c.firstChild;)c=c.firstChild;return c}function Ya(c,f){var S=kc(c);c=0;for(var k;S;){if(S.nodeType===3){if(k=c+S.textContent.length,c<=f&&k>=f)return{node:S,offset:f-c};c=k}e:{for(;S;){if(S.nextSibling){S=S.nextSibling;break e}S=S.parentNode}S=void 0}S=kc(S)}}function qu(c,f){return c&&f?c===f?!0:c&&c.nodeType===3?!1:f&&f.nodeType===3?qu(c,f.parentNode):"contains"in c?c.contains(f):c.compareDocumentPosition?!!(c.compareDocumentPosition(f)&16):!1:!1}function wu(){for(var c=window,f=Hr();f instanceof c.HTMLIFrameElement;){try{var S=typeof f.contentWindow.location.href=="string"}catch{S=!1}if(S)c=f.contentWindow;else break;f=Hr(c.document)}return f}function Xl(c){var f=c&&c.nodeName&&c.nodeName.toLowerCase();return f&&(f==="input"&&(c.type==="text"||c.type==="search"||c.type==="tel"||c.type==="url"||c.type==="password")||f==="textarea"||c.contentEditable==="true")}function cs(c){var f=wu(),S=c.focusedElem,k=c.selectionRange;if(f!==S&&S&&S.ownerDocument&&qu(S.ownerDocument.documentElement,S)){if(k!==null&&Xl(S)){if(f=k.start,c=k.end,c===void 0&&(c=f),"selectionStart"in S)S.selectionStart=f,S.selectionEnd=Math.min(c,S.value.length);else if(c=(f=S.ownerDocument||document)&&f.defaultView||window,c.getSelection){c=c.getSelection();var V=S.textContent.length,$=Math.min(k.start,V);k=k.end===void 0?$:Math.min(k.end,V),!c.extend&&$>k&&(V=k,k=$,$=V),V=Ya(S,$);var ue=Ya(S,k);V&&ue&&(c.rangeCount!==1||c.anchorNode!==V.node||c.anchorOffset!==V.offset||c.focusNode!==ue.node||c.focusOffset!==ue.offset)&&(f=f.createRange(),f.setStart(V.node,V.offset),c.removeAllRanges(),$>k?(c.addRange(f),c.extend(ue.node,ue.offset)):(f.setEnd(ue.node,ue.offset),c.addRange(f)))}}for(f=[],c=S;c=c.parentNode;)c.nodeType===1&&f.push({element:c,left:c.scrollLeft,top:c.scrollTop});for(typeof S.focus=="function"&&S.focus(),S=0;S<f.length;S++)c=f[S],c.element.scrollLeft=c.left,c.element.scrollTop=c.top}}var Gu=u&&"documentMode"in document&&11>=document.documentMode,Ys=null,Qs=null,bu=null,Tu=!1;function li(c,f,S){var k=S.window===S?S.document:S.nodeType===9?S:S.ownerDocument;Tu||Ys==null||Ys!==Hr(k)||(k=Ys,"selectionStart"in k&&Xl(k)?k={start:k.selectionStart,end:k.selectionEnd}:(k=(k.ownerDocument&&k.ownerDocument.defaultView||window).getSelection(),k={anchorNode:k.anchorNode,anchorOffset:k.anchorOffset,focusNode:k.focusNode,focusOffset:k.focusOffset}),bu&&Xa(bu,k)||(bu=k,k=A(Qs,"onSelect"),0<k.length&&(f=new vu("onSelect","select",null,f,S),c.push({event:f,listeners:k}),f.target=Ys)))}function Js(c,f){var S={};return S[c.toLowerCase()]=f.toLowerCase(),S["Webkit"+c]="webkit"+f,S["Moz"+c]="moz"+f,S}var Su={animationend:Js("Animation","AnimationEnd"),animationiteration:Js("Animation","AnimationIteration"),animationstart:Js("Animation","AnimationStart"),transitionend:Js("Transition","TransitionEnd")},Qa={},Yl={};u&&(Yl=document.createElement("div").style,"AnimationEvent"in window||(delete Su.animationend.animation,delete Su.animationiteration.animation,delete Su.animationstart.animation),"TransitionEvent"in window||delete Su.transitionend.transition);function Ql(c){if(Qa[c])return Qa[c];if(!Su[c])return c;var f=Su[c],S;for(S in f)if(f.hasOwnProperty(S)&&S in Yl)return Qa[c]=f[S];return c}var rd=Ql("animationend"),ea=Ql("animationiteration"),xh=Ql("animationstart"),Eu=Ql("transitionend"),Ja=new Map,Zu="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function go(c,f){Ja.set(c,f),g(f,[c])}for(var Pa=0;Pa<Zu.length;Pa++){var Wu=Zu[Pa],Ku=Wu.toLowerCase(),Mc=Wu[0].toUpperCase()+Wu.slice(1);go(Ku,"on"+Mc)}go(rd,"onAnimationEnd"),go(ea,"onAnimationIteration"),go(xh,"onAnimationStart"),go("dblclick","onDoubleClick"),go("focusin","onFocus"),go("focusout","onBlur"),go(Eu,"onTransitionEnd"),_("onMouseEnter",["mouseout","mouseover"]),_("onMouseLeave",["mouseout","mouseover"]),_("onPointerEnter",["pointerout","pointerover"]),_("onPointerLeave",["pointerout","pointerover"]),g("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),g("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),g("onBeforeInput",["compositionend","keypress","textInput","paste"]),g("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),g("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),g("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var bl="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),od=new Set("cancel close invalid load scroll toggle".split(" ").concat(bl));function Iu(c,f,S){var k=c.type||"unknown-event";c.currentTarget=S,ts(k,f,void 0,c),c.currentTarget=null}function Rc(c,f){f=(f&4)!==0;for(var S=0;S<c.length;S++){var k=c[S],V=k.event;k=k.listeners;e:{var $=void 0;if(f)for(var ue=k.length-1;0<=ue;ue--){var Le=k[ue],He=Le.instance,gt=Le.currentTarget;if(Le=Le.listener,He!==$&&V.isPropagationStopped())break e;Iu(V,Le,gt),$=He}else for(ue=0;ue<k.length;ue++){if(Le=k[ue],He=Le.instance,gt=Le.currentTarget,Le=Le.listener,He!==$&&V.isPropagationStopped())break e;Iu(V,Le,gt),$=He}}}if(Nn)throw c=mn,Nn=!1,mn=null,c}function Yi(c,f){var S=f[nu];S===void 0&&(S=f[nu]=new Set);var k=c+"__bubble";S.has(k)||(Lc(f,c,2,!1),S.add(k))}function Pu(c,f,S){var k=0;f&&(k|=4),Lc(S,c,k,f)}var Tl="_reactListening"+Math.random().toString(36).slice(2);function Sl(c){if(!c[Tl]){c[Tl]=!0,o.forEach(function(S){S!=="selectionchange"&&(od.has(S)||Pu(S,!1,c),Pu(S,!0,c))});var f=c.nodeType===9?c:c.ownerDocument;f===null||f[Tl]||(f[Tl]=!0,Pu("selectionchange",!1,f))}}function Lc(c,f,S,k){switch(ei(f)){case 1:var V=ji;break;case 4:V=Ta;break;default:V=ml}S=V.bind(null,f,S,c),V=void 0,!Pn||f!=="touchstart"&&f!=="touchmove"&&f!=="wheel"||(V=!0),k?V!==void 0?c.addEventListener(f,S,{capture:!0,passive:V}):c.addEventListener(f,S,!0):V!==void 0?c.addEventListener(f,S,{passive:V}):c.addEventListener(f,S,!1)}function d(c,f,S,k,V){var $=k;if((f&1)===0&&(f&2)===0&&k!==null)e:for(;;){if(k===null)return;var ue=k.tag;if(ue===3||ue===4){var Le=k.stateNode.containerInfo;if(Le===V||Le.nodeType===8&&Le.parentNode===V)break;if(ue===4)for(ue=k.return;ue!==null;){var He=ue.tag;if((He===3||He===4)&&(He=ue.stateNode.containerInfo,He===V||He.nodeType===8&&He.parentNode===V))return;ue=ue.return}for(;Le!==null;){if(ue=Ar(Le),ue===null)return;if(He=ue.tag,He===5||He===6){k=$=ue;continue e}Le=Le.parentNode}}k=k.return}Nt(function(){var gt=$,Bt=Pe(S),jt=[];e:{var Ot=Ja.get(c);if(Ot!==void 0){var an=vu,yn=c;switch(c){case"keypress":if(Ps(S)===0)break e;case"keydown":case"keyup":an=j;break;case"focusin":yn="focus",an=Ul;break;case"focusout":yn="blur",an=Ul;break;case"beforeblur":case"afterblur":an=Ul;break;case"click":if(S.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":an=Ws;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":an=gl;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":an=ft;break;case rd:case ea:case xh:an=as;break;case Eu:an=Pi;break;case"scroll":an=$u;break;case"wheel":an=ai;break;case"copy":case"cut":case"paste":an=Za;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":an=ye}var wn=(f&4)!==0,so=!wn&&c==="scroll",ot=wn?Ot!==null?Ot+"Capture":null:Ot;wn=[];for(var We=gt,lt;We!==null;){lt=We;var qt=lt.stateNode;if(lt.tag===5&&qt!==null&&(lt=qt,ot!==null&&(qt=en(We,ot),qt!=null&&wn.push(x(We,qt,lt)))),so)break;We=We.return}0<wn.length&&(Ot=new an(Ot,yn,null,S,Bt),jt.push({event:Ot,listeners:wn}))}}if((f&7)===0){e:{if(Ot=c==="mouseover"||c==="pointerover",an=c==="mouseout"||c==="pointerout",Ot&&S!==fe&&(yn=S.relatedTarget||S.fromElement)&&(Ar(yn)||yn[Ni]))break e;if((an||Ot)&&(Ot=Bt.window===Bt?Bt:(Ot=Bt.ownerDocument)?Ot.defaultView||Ot.parentWindow:window,an?(yn=S.relatedTarget||S.toElement,an=gt,yn=yn?Ar(yn):null,yn!==null&&(so=Si(yn),yn!==so||yn.tag!==5&&yn.tag!==6)&&(yn=null)):(an=null,yn=gt),an!==yn)){if(wn=Ws,qt="onMouseLeave",ot="onMouseEnter",We="mouse",(c==="pointerout"||c==="pointerover")&&(wn=ye,qt="onPointerLeave",ot="onPointerEnter",We="pointer"),so=an==null?Ot:Ds(an),lt=yn==null?Ot:Ds(yn),Ot=new wn(qt,We+"leave",an,S,Bt),Ot.target=so,Ot.relatedTarget=lt,qt=null,Ar(Bt)===gt&&(wn=new wn(ot,We+"enter",yn,S,Bt),wn.target=lt,wn.relatedTarget=so,qt=wn),so=qt,an&&yn)t:{for(wn=an,ot=yn,We=0,lt=wn;lt;lt=F(lt))We++;for(lt=0,qt=ot;qt;qt=F(qt))lt++;for(;0<We-lt;)wn=F(wn),We--;for(;0<lt-We;)ot=F(ot),lt--;for(;We--;){if(wn===ot||ot!==null&&wn===ot.alternate)break t;wn=F(wn),ot=F(ot)}wn=null}else wn=null;an!==null&&Z(jt,Ot,an,wn,!1),yn!==null&&so!==null&&Z(jt,so,yn,wn,!0)}}e:{if(Ot=gt?Ds(gt):window,an=Ot.nodeName&&Ot.nodeName.toLowerCase(),an==="select"||an==="input"&&Ot.type==="file")var bn=qd;else if(vh(Ot))if(Ea)bn=wl;else{bn=xl;var Mn=Kl}else(an=Ot.nodeName)&&an.toLowerCase()==="input"&&(Ot.type==="checkbox"||Ot.type==="radio")&&(bn=Ia);if(bn&&(bn=bn(c,gt))){xu(jt,bn,S,Bt);break e}Mn&&Mn(c,Ot,gt),c==="focusout"&&(Mn=Ot._wrapperState)&&Mn.controlled&&Ot.type==="number"&&Jo(Ot,"number",Ot.value)}switch(Mn=gt?Ds(gt):window,c){case"focusin":(vh(Mn)||Mn.contentEditable==="true")&&(Ys=Mn,Qs=gt,bu=null);break;case"focusout":bu=Qs=Ys=null;break;case"mousedown":Tu=!0;break;case"contextmenu":case"mouseup":case"dragend":Tu=!1,li(jt,S,Bt);break;case"selectionchange":if(Gu)break;case"keydown":case"keyup":li(jt,S,Bt)}var Rn;if(sr)e:{switch(c){case"compositionstart":var Un="onCompositionStart";break e;case"compositionend":Un="onCompositionEnd";break e;case"compositionupdate":Un="onCompositionUpdate";break e}Un=void 0}else io?yl(c,S)&&(Un="onCompositionEnd"):c==="keydown"&&S.keyCode===229&&(Un="onCompositionStart");Un&&(Wa&&S.locale!=="ko"&&(io||Un!=="onCompositionStart"?Un==="onCompositionEnd"&&io&&(Rn=mo()):(to=Bt,qn="value"in to?to.value:to.textContent,io=!0)),Mn=A(gt,Un),0<Mn.length&&(Un=new Hl(Un,c,null,S,Bt),jt.push({event:Un,listeners:Mn}),Rn?Un.data=Rn:(Rn=ql(S),Rn!==null&&(Un.data=Rn)))),(Rn=gr?yh(c,S):Sa(c,S))&&(gt=A(gt,"onBeforeInput"),0<gt.length&&(Bt=new Hl("onBeforeInput","beforeinput",null,S,Bt),jt.push({event:Bt,listeners:gt}),Bt.data=Rn))}Rc(jt,f)})}function x(c,f,S){return{instance:c,listener:f,currentTarget:S}}function A(c,f){for(var S=f+"Capture",k=[];c!==null;){var V=c,$=V.stateNode;V.tag===5&&$!==null&&(V=$,$=en(c,S),$!=null&&k.unshift(x(c,$,V)),$=en(c,f),$!=null&&k.push(x(c,$,V))),c=c.return}return k}function F(c){if(c===null)return null;do c=c.return;while(c&&c.tag!==5);return c||null}function Z(c,f,S,k,V){for(var $=f._reactName,ue=[];S!==null&&S!==k;){var Le=S,He=Le.alternate,gt=Le.stateNode;if(He!==null&&He===k)break;Le.tag===5&&gt!==null&&(Le=gt,V?(He=en(S,$),He!=null&&ue.unshift(x(S,He,Le))):V||(He=en(S,$),He!=null&&ue.push(x(S,He,Le)))),S=S.return}ue.length!==0&&c.push({event:f,listeners:ue})}var he=/\r\n?/g,Oe=/\u0000|\uFFFD/g;function rt(c){return(typeof c=="string"?c:""+c).replace(he,`
`).replace(Oe,"")}function dt(c,f,S){if(f=rt(f),rt(c)!==f&&S)throw Error(t(425))}function kt(){}var tn=null,Sn=null;function Gn(c,f){return c==="textarea"||c==="noscript"||typeof f.children=="string"||typeof f.children=="number"||typeof f.dangerouslySetInnerHTML=="object"&&f.dangerouslySetInnerHTML!==null&&f.dangerouslySetInnerHTML.__html!=null}var Cr=typeof setTimeout=="function"?setTimeout:void 0,Nr=typeof clearTimeout=="function"?clearTimeout:void 0,Ao=typeof Promise=="function"?Promise:void 0,_o=typeof queueMicrotask=="function"?queueMicrotask:typeof Ao<"u"?function(c){return Ao.resolve(null).then(c).catch(Jl)}:Cr;function Jl(c){setTimeout(function(){throw c})}function Ca(c,f){var S=f,k=0;do{var V=S.nextSibling;if(c.removeChild(S),V&&V.nodeType===8)if(S=V.data,S==="/$"){if(k===0){c.removeChild(V),Xi(f);return}k--}else S!=="$"&&S!=="$?"&&S!=="$!"||k++;S=V}while(S);Xi(f)}function Aa(c){for(;c!=null;c=c.nextSibling){var f=c.nodeType;if(f===1||f===3)break;if(f===8){if(f=c.data,f==="$"||f==="$!"||f==="$?")break;if(f==="/$")return null}}return c}function eu(c){c=c.previousSibling;for(var f=0;c;){if(c.nodeType===8){var S=c.data;if(S==="$"||S==="$!"||S==="$?"){if(f===0)return c;f--}else S==="/$"&&f++}c=c.previousSibling}return null}var El=Math.random().toString(36).slice(2),ta="__reactFiber$"+El,tu="__reactProps$"+El,Ni="__reactContainer$"+El,nu="__reactEvents$"+El,Dc="__reactListeners$"+El,Cu="__reactHandles$"+El;function Ar(c){var f=c[ta];if(f)return f;for(var S=c.parentNode;S;){if(f=S[Ni]||S[ta]){if(S=f.alternate,f.child!==null||S!==null&&S.child!==null)for(c=eu(c);c!==null;){if(S=c[ta])return S;c=eu(c)}return f}c=S,S=c.parentNode}return null}function $i(c){return c=c[ta]||c[Ni],!c||c.tag!==5&&c.tag!==6&&c.tag!==13&&c.tag!==3?null:c}function Ds(c){if(c.tag===5||c.tag===6)return c.stateNode;throw Error(t(33))}function Uo(c){return c[tu]||null}var Au=[],zc=-1;function ka(c){return{current:c}}function hr(c){0>zc||(c.current=Au[zc],Au[zc]=null,zc--)}function nr(c,f){zc++,Au[zc]=c.current,c.current=f}var iu={},Mr=ka(iu),Rr=ka(!1),Gt=iu;function Xu(c,f){var S=c.type.contextTypes;if(!S)return iu;var k=c.stateNode;if(k&&k.__reactInternalMemoizedUnmaskedChildContext===f)return k.__reactInternalMemoizedMaskedChildContext;var V={},$;for($ in S)V[$]=f[$];return k&&(c=c.stateNode,c.__reactInternalMemoizedUnmaskedChildContext=f,c.__reactInternalMemoizedMaskedChildContext=V),V}function Kr(c){return c=c.childContextTypes,c!=null}function wh(){hr(Rr),hr(Mr)}function Nc(c,f,S){if(Mr.current!==iu)throw Error(t(168));nr(Mr,f),nr(Rr,S)}function ru(c,f,S){var k=c.stateNode;if(f=f.childContextTypes,typeof k.getChildContext!="function")return S;k=k.getChildContext();for(var V in k)if(!(V in f))throw Error(t(108,Fn(c)||"Unknown",V));return St({},S,k)}function bh(c){return c=(c=c.stateNode)&&c.__reactInternalMemoizedMergedChildContext||iu,Gt=Mr.current,nr(Mr,c),nr(Rr,Rr.current),!0}function ti(c,f,S){var k=c.stateNode;if(!k)throw Error(t(169));S?(c=ru(c,f,Gt),k.__reactInternalMemoizedMergedChildContext=c,hr(Rr),hr(Mr),nr(Mr,c)):hr(Rr),nr(Rr,S)}var zs=null,Th=!1,Oc=!1;function Gd(c){zs===null?zs=[c]:zs.push(c)}function Hp(c){Th=!0,Gd(c)}function el(){if(!Oc&&zs!==null){Oc=!0;var c=0,f=_n;try{var S=zs;for(_n=1;c<S.length;c++){var k=S[c];do k=k(!0);while(k!==null)}zs=null,Th=!1}catch(V){throw zs!==null&&(zs=zs.slice(c+1)),Gs(cl,el),V}finally{_n=f,Oc=!1}}return null}var ou=[],Yu=0,Sh=null,Eh=0,na=[],ia=0,hs=null,bi=1,Ma="";function Il(c,f){ou[Yu++]=Eh,ou[Yu++]=Sh,Sh=c,Eh=f}function sd(c,f,S){na[ia++]=bi,na[ia++]=Ma,na[ia++]=hs,hs=c;var k=bi;c=Ma;var V=32-An(k)-1;k&=~(1<<V),S+=1;var $=32-An(f)+V;if(30<$){var ue=V-V%5;$=(k&(1<<ue)-1).toString(32),k>>=ue,V-=ue,bi=1<<32-An(f)+V|S<<V|k,Ma=$+c}else bi=1<<$|S<<V|k,Ma=c}function Ih(c){c.return!==null&&(Il(c,1),sd(c,1,0))}function Ph(c){for(;c===Sh;)Sh=ou[--Yu],ou[Yu]=null,Eh=ou[--Yu],ou[Yu]=null;for(;c===hs;)hs=na[--ia],na[ia]=null,Ma=na[--ia],na[ia]=null,bi=na[--ia],na[ia]=null}var jo=null,Lr=null,Qi=!1,rn=null;function En(c,f){var S=Bs(5,null,null,0);S.elementType="DELETED",S.stateNode=f,S.return=c,f=c.deletions,f===null?(c.deletions=[S],c.flags|=16):f.push(S)}function Fc(c,f){switch(c.tag){case 5:var S=c.type;return f=f.nodeType!==1||S.toLowerCase()!==f.nodeName.toLowerCase()?null:f,f!==null?(c.stateNode=f,jo=c,Lr=Aa(f.firstChild),!0):!1;case 6:return f=c.pendingProps===""||f.nodeType!==3?null:f,f!==null?(c.stateNode=f,jo=c,Lr=null,!0):!1;case 13:return f=f.nodeType!==8?null:f,f!==null?(S=hs!==null?{id:bi,overflow:Ma}:null,c.memoizedState={dehydrated:f,treeContext:S,retryLane:1073741824},S=Bs(18,null,null,0),S.stateNode=f,S.return=c,c.child=S,jo=c,Lr=null,!0):!1;default:return!1}}function Bc(c){return(c.mode&1)!==0&&(c.flags&128)===0}function Vc(c){if(Qi){var f=Lr;if(f){var S=f;if(!Fc(c,f)){if(Bc(c))throw Error(t(418));f=Aa(S.nextSibling);var k=jo;f&&Fc(c,f)?En(k,S):(c.flags=c.flags&-4097|2,Qi=!1,jo=c)}}else{if(Bc(c))throw Error(t(418));c.flags=c.flags&-4097|2,Qi=!1,jo=c}}}function ds(c){for(c=c.return;c!==null&&c.tag!==5&&c.tag!==3&&c.tag!==13;)c=c.return;jo=c}function Ch(c){if(c!==jo)return!1;if(!Qi)return ds(c),Qi=!0,!1;var f;if((f=c.tag!==3)&&!(f=c.tag!==5)&&(f=c.type,f=f!=="head"&&f!=="body"&&!Gn(c.type,c.memoizedProps)),f&&(f=Lr)){if(Bc(c))throw tl(),Error(t(418));for(;f;)En(c,f),f=Aa(f.nextSibling)}if(ds(c),c.tag===13){if(c=c.memoizedState,c=c!==null?c.dehydrated:null,!c)throw Error(t(317));e:{for(c=c.nextSibling,f=0;c;){if(c.nodeType===8){var S=c.data;if(S==="/$"){if(f===0){Lr=Aa(c.nextSibling);break e}f--}else S!=="$"&&S!=="$!"&&S!=="$?"||f++}c=c.nextSibling}Lr=null}}else Lr=jo?Aa(c.stateNode.nextSibling):null;return!0}function tl(){for(var c=Lr;c;)c=Aa(c.nextSibling)}function Uc(){Lr=jo=null,Qi=!1}function Qu(c){rn===null?rn=[c]:rn.push(c)}var ir=Ye.ReactCurrentBatchConfig;function _r(c,f,S){if(c=S.ref,c!==null&&typeof c!="function"&&typeof c!="object"){if(S._owner){if(S=S._owner,S){if(S.tag!==1)throw Error(t(309));var k=S.stateNode}if(!k)throw Error(t(147,c));var V=k,$=""+c;return f!==null&&f.ref!==null&&typeof f.ref=="function"&&f.ref._stringRef===$?f.ref:(f=function(ue){var Le=V.refs;ue===null?delete Le[$]:Le[$]=ue},f._stringRef=$,f)}if(typeof c!="string")throw Error(t(284));if(!S._owner)throw Error(t(290,c))}return c}function Ah(c,f){throw c=Object.prototype.toString.call(f),Error(t(31,c==="[object Object]"?"object with keys {"+Object.keys(f).join(", ")+"}":c))}function jc(c){var f=c._init;return f(c._payload)}function $c(c){function f(ot,We){if(c){var lt=ot.deletions;lt===null?(ot.deletions=[We],ot.flags|=16):lt.push(We)}}function S(ot,We){if(!c)return null;for(;We!==null;)f(ot,We),We=We.sibling;return null}function k(ot,We){for(ot=new Map;We!==null;)We.key!==null?ot.set(We.key,We):ot.set(We.index,We),We=We.sibling;return ot}function V(ot,We){return ot=uu(ot,We),ot.index=0,ot.sibling=null,ot}function $(ot,We,lt){return ot.index=lt,c?(lt=ot.alternate,lt!==null?(lt=lt.index,lt<We?(ot.flags|=2,We):lt):(ot.flags|=2,We)):(ot.flags|=1048576,We)}function ue(ot){return c&&ot.alternate===null&&(ot.flags|=2),ot}function Le(ot,We,lt,qt){return We===null||We.tag!==6?(We=gf(lt,ot.mode,qt),We.return=ot,We):(We=V(We,lt),We.return=ot,We)}function He(ot,We,lt,qt){var bn=lt.type;return bn===be?Bt(ot,We,lt.props.children,qt,lt.key):We!==null&&(We.elementType===bn||typeof bn=="object"&&bn!==null&&bn.$$typeof===dn&&jc(bn)===We.type)?(qt=V(We,lt.props),qt.ref=_r(ot,We,lt),qt.return=ot,qt):(qt=mf(lt.type,lt.key,lt.props,null,ot.mode,qt),qt.ref=_r(ot,We,lt),qt.return=ot,qt)}function gt(ot,We,lt,qt){return We===null||We.tag!==4||We.stateNode.containerInfo!==lt.containerInfo||We.stateNode.implementation!==lt.implementation?(We=Bm(lt,ot.mode,qt),We.return=ot,We):(We=V(We,lt.children||[]),We.return=ot,We)}function Bt(ot,We,lt,qt,bn){return We===null||We.tag!==7?(We=Vh(lt,ot.mode,qt,bn),We.return=ot,We):(We=V(We,lt),We.return=ot,We)}function jt(ot,We,lt){if(typeof We=="string"&&We!==""||typeof We=="number")return We=gf(""+We,ot.mode,lt),We.return=ot,We;if(typeof We=="object"&&We!==null){switch(We.$$typeof){case it:return lt=mf(We.type,We.key,We.props,null,ot.mode,lt),lt.ref=_r(ot,null,We),lt.return=ot,lt;case at:return We=Bm(We,ot.mode,lt),We.return=ot,We;case dn:var qt=We._init;return jt(ot,qt(We._payload),lt)}if(vr(We)||gn(We))return We=Vh(We,ot.mode,lt,null),We.return=ot,We;Ah(ot,We)}return null}function Ot(ot,We,lt,qt){var bn=We!==null?We.key:null;if(typeof lt=="string"&&lt!==""||typeof lt=="number")return bn!==null?null:Le(ot,We,""+lt,qt);if(typeof lt=="object"&&lt!==null){switch(lt.$$typeof){case it:return lt.key===bn?He(ot,We,lt,qt):null;case at:return lt.key===bn?gt(ot,We,lt,qt):null;case dn:return bn=lt._init,Ot(ot,We,bn(lt._payload),qt)}if(vr(lt)||gn(lt))return bn!==null?null:Bt(ot,We,lt,qt,null);Ah(ot,lt)}return null}function an(ot,We,lt,qt,bn){if(typeof qt=="string"&&qt!==""||typeof qt=="number")return ot=ot.get(lt)||null,Le(We,ot,""+qt,bn);if(typeof qt=="object"&&qt!==null){switch(qt.$$typeof){case it:return ot=ot.get(qt.key===null?lt:qt.key)||null,He(We,ot,qt,bn);case at:return ot=ot.get(qt.key===null?lt:qt.key)||null,gt(We,ot,qt,bn);case dn:var Mn=qt._init;return an(ot,We,lt,Mn(qt._payload),bn)}if(vr(qt)||gn(qt))return ot=ot.get(lt)||null,Bt(We,ot,qt,bn,null);Ah(We,qt)}return null}function yn(ot,We,lt,qt){for(var bn=null,Mn=null,Rn=We,Un=We=0,Ro=null;Rn!==null&&Un<lt.length;Un++){Rn.index>Un?(Ro=Rn,Rn=null):Ro=Rn.sibling;var yi=Ot(ot,Rn,lt[Un],qt);if(yi===null){Rn===null&&(Rn=Ro);break}c&&Rn&&yi.alternate===null&&f(ot,Rn),We=$(yi,We,Un),Mn===null?bn=yi:Mn.sibling=yi,Mn=yi,Rn=Ro}if(Un===lt.length)return S(ot,Rn),Qi&&Il(ot,Un),bn;if(Rn===null){for(;Un<lt.length;Un++)Rn=jt(ot,lt[Un],qt),Rn!==null&&(We=$(Rn,We,Un),Mn===null?bn=Rn:Mn.sibling=Rn,Mn=Rn);return Qi&&Il(ot,Un),bn}for(Rn=k(ot,Rn);Un<lt.length;Un++)Ro=an(Rn,ot,Un,lt[Un],qt),Ro!==null&&(c&&Ro.alternate!==null&&Rn.delete(Ro.key===null?Un:Ro.key),We=$(Ro,We,Un),Mn===null?bn=Ro:Mn.sibling=Ro,Mn=Ro);return c&&Rn.forEach(function(fc){return f(ot,fc)}),Qi&&Il(ot,Un),bn}function wn(ot,We,lt,qt){var bn=gn(lt);if(typeof bn!="function")throw Error(t(150));if(lt=bn.call(lt),lt==null)throw Error(t(151));for(var Mn=bn=null,Rn=We,Un=We=0,Ro=null,yi=lt.next();Rn!==null&&!yi.done;Un++,yi=lt.next()){Rn.index>Un?(Ro=Rn,Rn=null):Ro=Rn.sibling;var fc=Ot(ot,Rn,yi.value,qt);if(fc===null){Rn===null&&(Rn=Ro);break}c&&Rn&&fc.alternate===null&&f(ot,Rn),We=$(fc,We,Un),Mn===null?bn=fc:Mn.sibling=fc,Mn=fc,Rn=Ro}if(yi.done)return S(ot,Rn),Qi&&Il(ot,Un),bn;if(Rn===null){for(;!yi.done;Un++,yi=lt.next())yi=jt(ot,yi.value,qt),yi!==null&&(We=$(yi,We,Un),Mn===null?bn=yi:Mn.sibling=yi,Mn=yi);return Qi&&Il(ot,Un),bn}for(Rn=k(ot,Rn);!yi.done;Un++,yi=lt.next())yi=an(Rn,ot,Un,yi.value,qt),yi!==null&&(c&&yi.alternate!==null&&Rn.delete(yi.key===null?Un:yi.key),We=$(yi,We,Un),Mn===null?bn=yi:Mn.sibling=yi,Mn=yi);return c&&Rn.forEach(function(jm){return f(ot,jm)}),Qi&&Il(ot,Un),bn}function so(ot,We,lt,qt){if(typeof lt=="object"&&lt!==null&&lt.type===be&&lt.key===null&&(lt=lt.props.children),typeof lt=="object"&&lt!==null){switch(lt.$$typeof){case it:e:{for(var bn=lt.key,Mn=We;Mn!==null;){if(Mn.key===bn){if(bn=lt.type,bn===be){if(Mn.tag===7){S(ot,Mn.sibling),We=V(Mn,lt.props.children),We.return=ot,ot=We;break e}}else if(Mn.elementType===bn||typeof bn=="object"&&bn!==null&&bn.$$typeof===dn&&jc(bn)===Mn.type){S(ot,Mn.sibling),We=V(Mn,lt.props),We.ref=_r(ot,Mn,lt),We.return=ot,ot=We;break e}S(ot,Mn);break}else f(ot,Mn);Mn=Mn.sibling}lt.type===be?(We=Vh(lt.props.children,ot.mode,qt,lt.key),We.return=ot,ot=We):(qt=mf(lt.type,lt.key,lt.props,null,ot.mode,qt),qt.ref=_r(ot,We,lt),qt.return=ot,ot=qt)}return ue(ot);case at:e:{for(Mn=lt.key;We!==null;){if(We.key===Mn)if(We.tag===4&&We.stateNode.containerInfo===lt.containerInfo&&We.stateNode.implementation===lt.implementation){S(ot,We.sibling),We=V(We,lt.children||[]),We.return=ot,ot=We;break e}else{S(ot,We);break}else f(ot,We);We=We.sibling}We=Bm(lt,ot.mode,qt),We.return=ot,ot=We}return ue(ot);case dn:return Mn=lt._init,so(ot,We,Mn(lt._payload),qt)}if(vr(lt))return yn(ot,We,lt,qt);if(gn(lt))return wn(ot,We,lt,qt);Ah(ot,lt)}return typeof lt=="string"&&lt!==""||typeof lt=="number"?(lt=""+lt,We!==null&&We.tag===6?(S(ot,We.sibling),We=V(We,lt),We.return=ot,ot=We):(S(ot,We),We=gf(lt,ot.mode,qt),We.return=ot,ot=We),ue(ot)):S(ot,We)}return so}var ku=$c(!0),ad=$c(!1),Ra=ka(null),su=null,Pl=null,Hc=null;function Ju(){Hc=Pl=su=null}function kh(c){var f=Ra.current;hr(Ra),c._currentValue=f}function Mu(c,f,S){for(;c!==null;){var k=c.alternate;if((c.childLanes&f)!==f?(c.childLanes|=f,k!==null&&(k.childLanes|=f)):k!==null&&(k.childLanes&f)!==f&&(k.childLanes|=f),c===S)break;c=c.return}}function La(c,f){su=c,Hc=Pl=null,c=c.dependencies,c!==null&&c.firstContext!==null&&((c.lanes&f)!==0&&(aa=!0),c.firstContext=null)}function Ns(c){var f=c._currentValue;if(Hc!==c)if(c={context:c,memoizedValue:f,next:null},Pl===null){if(su===null)throw Error(t(308));Pl=c,su.dependencies={lanes:0,firstContext:c}}else Pl=Pl.next=c;return f}var Cl=null;function Al(c){Cl===null?Cl=[c]:Cl.push(c)}function ld(c,f,S,k){var V=f.interleaved;return V===null?(S.next=S,Al(f)):(S.next=V.next,V.next=S),f.interleaved=S,nl(c,k)}function nl(c,f){c.lanes|=f;var S=c.alternate;for(S!==null&&(S.lanes|=f),S=c,c=c.return;c!==null;)c.childLanes|=f,S=c.alternate,S!==null&&(S.childLanes|=f),S=c,c=c.return;return S.tag===3?S.stateNode:null}var Da=!1;function Mh(c){c.updateQueue={baseState:c.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function w(c,f){c=c.updateQueue,f.updateQueue===c&&(f.updateQueue={baseState:c.baseState,firstBaseUpdate:c.firstBaseUpdate,lastBaseUpdate:c.lastBaseUpdate,shared:c.shared,effects:c.effects})}function n(c,f){return{eventTime:c,lane:f,tag:0,payload:null,callback:null,next:null}}function s(c,f,S){var k=c.updateQueue;if(k===null)return null;if(k=k.shared,(Ci&2)!==0){var V=k.pending;return V===null?f.next=f:(f.next=V.next,V.next=f),k.pending=f,nl(c,S)}return V=k.interleaved,V===null?(f.next=f,Al(k)):(f.next=V.next,V.next=f),k.interleaved=f,nl(c,S)}function m(c,f,S){if(f=f.updateQueue,f!==null&&(f=f.shared,(S&4194240)!==0)){var k=f.lanes;k&=c.pendingLanes,S|=k,f.lanes=S,Gr(c,S)}}function y(c,f){var S=c.updateQueue,k=c.alternate;if(k!==null&&(k=k.updateQueue,S===k)){var V=null,$=null;if(S=S.firstBaseUpdate,S!==null){do{var ue={eventTime:S.eventTime,lane:S.lane,tag:S.tag,payload:S.payload,callback:S.callback,next:null};$===null?V=$=ue:$=$.next=ue,S=S.next}while(S!==null);$===null?V=$=f:$=$.next=f}else V=$=f;S={baseState:k.baseState,firstBaseUpdate:V,lastBaseUpdate:$,shared:k.shared,effects:k.effects},c.updateQueue=S;return}c=S.lastBaseUpdate,c===null?S.firstBaseUpdate=f:c.next=f,S.lastBaseUpdate=f}function b(c,f,S,k){var V=c.updateQueue;Da=!1;var $=V.firstBaseUpdate,ue=V.lastBaseUpdate,Le=V.shared.pending;if(Le!==null){V.shared.pending=null;var He=Le,gt=He.next;He.next=null,ue===null?$=gt:ue.next=gt,ue=He;var Bt=c.alternate;Bt!==null&&(Bt=Bt.updateQueue,Le=Bt.lastBaseUpdate,Le!==ue&&(Le===null?Bt.firstBaseUpdate=gt:Le.next=gt,Bt.lastBaseUpdate=He))}if($!==null){var jt=V.baseState;ue=0,Bt=gt=He=null,Le=$;do{var Ot=Le.lane,an=Le.eventTime;if((k&Ot)===Ot){Bt!==null&&(Bt=Bt.next={eventTime:an,lane:0,tag:Le.tag,payload:Le.payload,callback:Le.callback,next:null});e:{var yn=c,wn=Le;switch(Ot=f,an=S,wn.tag){case 1:if(yn=wn.payload,typeof yn=="function"){jt=yn.call(an,jt,Ot);break e}jt=yn;break e;case 3:yn.flags=yn.flags&-65537|128;case 0:if(yn=wn.payload,Ot=typeof yn=="function"?yn.call(an,jt,Ot):yn,Ot==null)break e;jt=St({},jt,Ot);break e;case 2:Da=!0}}Le.callback!==null&&Le.lane!==0&&(c.flags|=64,Ot=V.effects,Ot===null?V.effects=[Le]:Ot.push(Le))}else an={eventTime:an,lane:Ot,tag:Le.tag,payload:Le.payload,callback:Le.callback,next:null},Bt===null?(gt=Bt=an,He=jt):Bt=Bt.next=an,ue|=Ot;if(Le=Le.next,Le===null){if(Le=V.shared.pending,Le===null)break;Ot=Le,Le=Ot.next,Ot.next=null,V.lastBaseUpdate=Ot,V.shared.pending=null}}while(!0);if(Bt===null&&(He=jt),V.baseState=He,V.firstBaseUpdate=gt,V.lastBaseUpdate=Bt,f=V.shared.interleaved,f!==null){V=f;do ue|=V.lane,V=V.next;while(V!==f)}else $===null&&(V.shared.lanes=0);ac|=ue,c.lanes=ue,c.memoizedState=jt}}function I(c,f,S){if(c=f.effects,f.effects=null,c!==null)for(f=0;f<c.length;f++){var k=c[f],V=k.callback;if(V!==null){if(k.callback=null,k=S,typeof V!="function")throw Error(t(191,V));V.call(k)}}}var M={},z=ka(M),B=ka(M),q=ka(M);function W(c){if(c===M)throw Error(t(174));return c}function K(c,f){switch(nr(q,f),nr(B,c),nr(z,M),c=f.nodeType,c){case 9:case 11:f=(f=f.documentElement)?f.namespaceURI:er(null,"");break;default:c=c===8?f.parentNode:f,f=c.namespaceURI||null,c=c.tagName,f=er(f,c)}hr(z),nr(z,f)}function oe(){hr(z),hr(B),hr(q)}function le(c){W(q.current);var f=W(z.current),S=er(f,c.type);f!==S&&(nr(B,c),nr(z,S))}function we(c){B.current===c&&(hr(z),hr(B))}var ge=ka(0);function Te(c){for(var f=c;f!==null;){if(f.tag===13){var S=f.memoizedState;if(S!==null&&(S=S.dehydrated,S===null||S.data==="$?"||S.data==="$!"))return f}else if(f.tag===19&&f.memoizedProps.revealOrder!==void 0){if((f.flags&128)!==0)return f}else if(f.child!==null){f.child.return=f,f=f.child;continue}if(f===c)break;for(;f.sibling===null;){if(f.return===null||f.return===c)return null;f=f.return}f.sibling.return=f.return,f=f.sibling}return null}var Ie=[];function Re(){for(var c=0;c<Ie.length;c++)Ie[c]._workInProgressVersionPrimary=null;Ie.length=0}var ze=Ye.ReactCurrentDispatcher,Fe=Ye.ReactCurrentBatchConfig,Ve=0,Ne=null,Qe=null,Je=null,yt=!1,xt=!1,pt=0,Ut=0;function At(){throw Error(t(321))}function Et(c,f){if(f===null)return!1;for(var S=0;S<f.length&&S<c.length;S++)if(!Ls(c[S],f[S]))return!1;return!0}function Ht(c,f,S,k,V,$){if(Ve=$,Ne=f,f.memoizedState=null,f.updateQueue=null,f.lanes=0,ze.current=c===null||c.memoizedState===null?Wd:Kd,c=S(k,V),xt){$=0;do{if(xt=!1,pt=0,25<=$)throw Error(t(301));$+=1,Je=Qe=null,f.updateQueue=null,ze.current=Xd,c=S(k,V)}while(xt)}if(ze.current=nc,f=Qe!==null&&Qe.next!==null,Ve=0,Je=Qe=Ne=null,yt=!1,f)throw Error(t(300));return c}function Vn(){var c=pt!==0;return pt=0,c}function Zn(){var c={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Je===null?Ne.memoizedState=Je=c:Je=Je.next=c,Je}function pi(){if(Qe===null){var c=Ne.alternate;c=c!==null?c.memoizedState:null}else c=Qe.next;var f=Je===null?Ne.memoizedState:Je.next;if(f!==null)Je=f,Qe=c;else{if(c===null)throw Error(t(310));Qe=c,c={memoizedState:Qe.memoizedState,baseState:Qe.baseState,baseQueue:Qe.baseQueue,queue:Qe.queue,next:null},Je===null?Ne.memoizedState=Je=c:Je=Je.next=c}return Je}function Ti(c,f){return typeof f=="function"?f(c):f}function ar(c){var f=pi(),S=f.queue;if(S===null)throw Error(t(311));S.lastRenderedReducer=c;var k=Qe,V=k.baseQueue,$=S.pending;if($!==null){if(V!==null){var ue=V.next;V.next=$.next,$.next=ue}k.baseQueue=V=$,S.pending=null}if(V!==null){$=V.next,k=k.baseState;var Le=ue=null,He=null,gt=$;do{var Bt=gt.lane;if((Ve&Bt)===Bt)He!==null&&(He=He.next={lane:0,action:gt.action,hasEagerState:gt.hasEagerState,eagerState:gt.eagerState,next:null}),k=gt.hasEagerState?gt.eagerState:c(k,gt.action);else{var jt={lane:Bt,action:gt.action,hasEagerState:gt.hasEagerState,eagerState:gt.eagerState,next:null};He===null?(Le=He=jt,ue=k):He=He.next=jt,Ne.lanes|=Bt,ac|=Bt}gt=gt.next}while(gt!==null&&gt!==$);He===null?ue=k:He.next=Le,Ls(k,f.memoizedState)||(aa=!0),f.memoizedState=k,f.baseState=ue,f.baseQueue=He,S.lastRenderedState=k}if(c=S.interleaved,c!==null){V=c;do $=V.lane,Ne.lanes|=$,ac|=$,V=V.next;while(V!==c)}else V===null&&(S.lanes=0);return[f.memoizedState,S.dispatch]}function Oi(c){var f=pi(),S=f.queue;if(S===null)throw Error(t(311));S.lastRenderedReducer=c;var k=S.dispatch,V=S.pending,$=f.memoizedState;if(V!==null){S.pending=null;var ue=V=V.next;do $=c($,ue.action),ue=ue.next;while(ue!==V);Ls($,f.memoizedState)||(aa=!0),f.memoizedState=$,f.baseQueue===null&&(f.baseState=$),S.lastRenderedState=$}return[$,k]}function Fi(){}function Hi(c,f){var S=Ne,k=pi(),V=f(),$=!Ls(k.memoizedState,V);if($&&(k.memoizedState=V,aa=!0),k=k.queue,Ho(Fr.bind(null,S,k,c),[c]),k.getSnapshot!==f||$||Je!==null&&Je.memoizedState.tag&1){if(S.flags|=2048,ko(9,Or.bind(null,S,k,V,f),void 0,null),Mo===null)throw Error(t(349));(Ve&30)!==0||yo(S,f,V)}return V}function yo(c,f,S){c.flags|=16384,c={getSnapshot:f,value:S},f=Ne.updateQueue,f===null?(f={lastEffect:null,stores:null},Ne.updateQueue=f,f.stores=[c]):(S=f.stores,S===null?f.stores=[c]:S.push(c))}function Or(c,f,S,k){f.value=S,f.getSnapshot=k,$o(f)&&kl(c)}function Fr(c,f,S){return S(function(){$o(f)&&kl(c)})}function $o(c){var f=c.getSnapshot;c=c.value;try{var S=f();return!Ls(c,S)}catch{return!0}}function kl(c){var f=nl(c,1);f!==null&&Ll(f,c,1,-1)}function il(c){var f=Zn();return typeof c=="function"&&(c=c()),f.memoizedState=f.baseState=c,c={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Ti,lastRenderedState:c},f.queue=c,c=c.dispatch=tc.bind(null,Ne,c),[f.memoizedState,c]}function ko(c,f,S,k){return c={tag:c,create:f,destroy:S,deps:k,next:null},f=Ne.updateQueue,f===null?(f={lastEffect:null,stores:null},Ne.updateQueue=f,f.lastEffect=c.next=c):(S=f.lastEffect,S===null?f.lastEffect=c.next=c:(k=S.next,S.next=c,c.next=k,f.lastEffect=c)),c}function Ml(){return pi().memoizedState}function Ru(c,f,S,k){var V=Zn();Ne.flags|=c,V.memoizedState=ko(1|f,S,void 0,k===void 0?null:k)}function Lu(c,f,S,k){var V=pi();k=k===void 0?null:k;var $=void 0;if(Qe!==null){var ue=Qe.memoizedState;if($=ue.destroy,k!==null&&Et(k,ue.deps)){V.memoizedState=ko(f,S,$,k);return}}Ne.flags|=c,V.memoizedState=ko(1|f,S,$,k)}function ec(c,f){return Ru(8390656,8,c,f)}function Ho(c,f){return Lu(2048,8,c,f)}function ra(c,f){return Lu(4,2,c,f)}function oa(c,f){return Lu(4,4,c,f)}function Os(c,f){if(typeof f=="function")return c=c(),f(c),function(){f(null)};if(f!=null)return c=c(),f.current=c,function(){f.current=null}}function qi(c,f,S){return S=S!=null?S.concat([c]):null,Lu(4,4,Os.bind(null,f,c),S)}function lr(){}function Fs(c,f){var S=pi();f=f===void 0?null:f;var k=S.memoizedState;return k!==null&&f!==null&&Et(f,k[1])?k[0]:(S.memoizedState=[c,f],c)}function yr(c,f){var S=pi();f=f===void 0?null:f;var k=S.memoizedState;return k!==null&&f!==null&&Et(f,k[1])?k[0]:(c=c(),S.memoizedState=[c,f],c)}function qp(c,f,S){return(Ve&21)===0?(c.baseState&&(c.baseState=!1,aa=!0),c.memoizedState=S):(Ls(S,f)||(S=ho(),Ne.lanes|=S,ac|=S,c.baseState=!0),f)}function Gp(c,f){var S=_n;_n=S!==0&&4>S?S:4,c(!0);var k=Fe.transition;Fe.transition={};try{c(!1),f()}finally{_n=S,Fe.transition=k}}function ud(){return pi().memoizedState}function Zp(c,f,S){var k=cc(c);if(S={lane:k,action:S,hasEagerState:!1,eagerState:null,next:null},Du(c))au(f,S);else if(S=ld(c,f,S,k),S!==null){var V=fs();Ll(S,c,k,V),Zd(S,f,k)}}function tc(c,f,S){var k=cc(c),V={lane:k,action:S,hasEagerState:!1,eagerState:null,next:null};if(Du(c))au(f,V);else{var $=c.alternate;if(c.lanes===0&&($===null||$.lanes===0)&&($=f.lastRenderedReducer,$!==null))try{var ue=f.lastRenderedState,Le=$(ue,S);if(V.hasEagerState=!0,V.eagerState=Le,Ls(Le,ue)){var He=f.interleaved;He===null?(V.next=V,Al(f)):(V.next=He.next,He.next=V),f.interleaved=V;return}}catch{}finally{}S=ld(c,f,V,k),S!==null&&(V=fs(),Ll(S,c,k,V),Zd(S,f,k))}}function Du(c){var f=c.alternate;return c===Ne||f!==null&&f===Ne}function au(c,f){xt=yt=!0;var S=c.pending;S===null?f.next=f:(f.next=S.next,S.next=f),c.pending=f}function Zd(c,f,S){if((S&4194240)!==0){var k=f.lanes;k&=c.pendingLanes,S|=k,f.lanes=S,Gr(c,S)}}var nc={readContext:Ns,useCallback:At,useContext:At,useEffect:At,useImperativeHandle:At,useInsertionEffect:At,useLayoutEffect:At,useMemo:At,useReducer:At,useRef:At,useState:At,useDebugValue:At,useDeferredValue:At,useTransition:At,useMutableSource:At,useSyncExternalStore:At,useId:At,unstable_isNewReconciler:!1},Wd={readContext:Ns,useCallback:function(c,f){return Zn().memoizedState=[c,f===void 0?null:f],c},useContext:Ns,useEffect:ec,useImperativeHandle:function(c,f,S){return S=S!=null?S.concat([c]):null,Ru(4194308,4,Os.bind(null,f,c),S)},useLayoutEffect:function(c,f){return Ru(4194308,4,c,f)},useInsertionEffect:function(c,f){return Ru(4,2,c,f)},useMemo:function(c,f){var S=Zn();return f=f===void 0?null:f,c=c(),S.memoizedState=[c,f],c},useReducer:function(c,f,S){var k=Zn();return f=S!==void 0?S(f):f,k.memoizedState=k.baseState=f,c={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:c,lastRenderedState:f},k.queue=c,c=c.dispatch=Zp.bind(null,Ne,c),[k.memoizedState,c]},useRef:function(c){var f=Zn();return c={current:c},f.memoizedState=c},useState:il,useDebugValue:lr,useDeferredValue:function(c){return Zn().memoizedState=c},useTransition:function(){var c=il(!1),f=c[0];return c=Gp.bind(null,c[1]),Zn().memoizedState=c,[f,c]},useMutableSource:function(){},useSyncExternalStore:function(c,f,S){var k=Ne,V=Zn();if(Qi){if(S===void 0)throw Error(t(407));S=S()}else{if(S=f(),Mo===null)throw Error(t(349));(Ve&30)!==0||yo(k,f,S)}V.memoizedState=S;var $={value:S,getSnapshot:f};return V.queue=$,ec(Fr.bind(null,k,$,c),[c]),k.flags|=2048,ko(9,Or.bind(null,k,$,S,f),void 0,null),S},useId:function(){var c=Zn(),f=Mo.identifierPrefix;if(Qi){var S=Ma,k=bi;S=(k&~(1<<32-An(k)-1)).toString(32)+S,f=":"+f+"R"+S,S=pt++,0<S&&(f+="H"+S.toString(32)),f+=":"}else S=Ut++,f=":"+f+"r"+S.toString(32)+":";return c.memoizedState=f},unstable_isNewReconciler:!1},Kd={readContext:Ns,useCallback:Fs,useContext:Ns,useEffect:Ho,useImperativeHandle:qi,useInsertionEffect:ra,useLayoutEffect:oa,useMemo:yr,useReducer:ar,useRef:Ml,useState:function(){return ar(Ti)},useDebugValue:lr,useDeferredValue:function(c){var f=pi();return qp(f,Qe.memoizedState,c)},useTransition:function(){var c=ar(Ti)[0],f=pi().memoizedState;return[c,f]},useMutableSource:Fi,useSyncExternalStore:Hi,useId:ud,unstable_isNewReconciler:!1},Xd={readContext:Ns,useCallback:Fs,useContext:Ns,useEffect:Ho,useImperativeHandle:qi,useInsertionEffect:ra,useLayoutEffect:oa,useMemo:yr,useReducer:Oi,useRef:Ml,useState:function(){return Oi(Ti)},useDebugValue:lr,useDeferredValue:function(c){var f=pi();return Qe===null?f.memoizedState=c:qp(f,Qe.memoizedState,c)},useTransition:function(){var c=Oi(Ti)[0],f=pi().memoizedState;return[c,f]},useMutableSource:Fi,useSyncExternalStore:Hi,useId:ud,unstable_isNewReconciler:!1};function sa(c,f){if(c&&c.defaultProps){f=St({},f),c=c.defaultProps;for(var S in c)f[S]===void 0&&(f[S]=c[S]);return f}return f}function Yd(c,f,S,k){f=c.memoizedState,S=S(k,f),S=S==null?f:St({},f,S),c.memoizedState=S,c.lanes===0&&(c.updateQueue.baseState=S)}var Wp={isMounted:function(c){return(c=c._reactInternals)?Si(c)===c:!1},enqueueSetState:function(c,f,S){c=c._reactInternals;var k=fs(),V=cc(c),$=n(k,V);$.payload=f,S!=null&&($.callback=S),f=s(c,$,V),f!==null&&(Ll(f,c,V,k),m(f,c,V))},enqueueReplaceState:function(c,f,S){c=c._reactInternals;var k=fs(),V=cc(c),$=n(k,V);$.tag=1,$.payload=f,S!=null&&($.callback=S),f=s(c,$,V),f!==null&&(Ll(f,c,V,k),m(f,c,V))},enqueueForceUpdate:function(c,f){c=c._reactInternals;var S=fs(),k=cc(c),V=n(S,k);V.tag=2,f!=null&&(V.callback=f),f=s(c,V,k),f!==null&&(Ll(f,c,k,S),m(f,c,k))}};function Kp(c,f,S,k,V,$,ue){return c=c.stateNode,typeof c.shouldComponentUpdate=="function"?c.shouldComponentUpdate(k,$,ue):f.prototype&&f.prototype.isPureReactComponent?!Xa(S,k)||!Xa(V,$):!0}function fm(c,f,S){var k=!1,V=iu,$=f.contextType;return typeof $=="object"&&$!==null?$=Ns($):(V=Kr(f)?Gt:Mr.current,k=f.contextTypes,$=(k=k!=null)?Xu(c,V):iu),f=new f(S,$),c.memoizedState=f.state!==null&&f.state!==void 0?f.state:null,f.updater=Wp,c.stateNode=f,f._reactInternals=c,k&&(c=c.stateNode,c.__reactInternalMemoizedUnmaskedChildContext=V,c.__reactInternalMemoizedMaskedChildContext=$),f}function mm(c,f,S,k){c=f.state,typeof f.componentWillReceiveProps=="function"&&f.componentWillReceiveProps(S,k),typeof f.UNSAFE_componentWillReceiveProps=="function"&&f.UNSAFE_componentWillReceiveProps(S,k),f.state!==c&&Wp.enqueueReplaceState(f,f.state,null)}function qc(c,f,S,k){var V=c.stateNode;V.props=S,V.state=c.memoizedState,V.refs={},Mh(c);var $=f.contextType;typeof $=="object"&&$!==null?V.context=Ns($):($=Kr(f)?Gt:Mr.current,V.context=Xu(c,$)),V.state=c.memoizedState,$=f.getDerivedStateFromProps,typeof $=="function"&&(Yd(c,f,$,S),V.state=c.memoizedState),typeof f.getDerivedStateFromProps=="function"||typeof V.getSnapshotBeforeUpdate=="function"||typeof V.UNSAFE_componentWillMount!="function"&&typeof V.componentWillMount!="function"||(f=V.state,typeof V.componentWillMount=="function"&&V.componentWillMount(),typeof V.UNSAFE_componentWillMount=="function"&&V.UNSAFE_componentWillMount(),f!==V.state&&Wp.enqueueReplaceState(V,V.state,null),b(c,S,V,k),V.state=c.memoizedState),typeof V.componentDidMount=="function"&&(c.flags|=4194308)}function cd(c,f){try{var S="",k=f;do S+=Xt(k),k=k.return;while(k);var V=S}catch($){V=`
Error generating stack: `+$.message+`
`+$.stack}return{value:c,source:f,stack:V,digest:null}}function Rh(c,f,S){return{value:c,source:null,stack:S??null,digest:f??null}}function hd(c,f){try{console.error(f.value)}catch(S){setTimeout(function(){throw S})}}var Xp=typeof WeakMap=="function"?WeakMap:Map;function gm(c,f,S){S=n(-1,S),S.tag=3,S.payload={element:null};var k=f.value;return S.callback=function(){uf||(uf=!0,Fh=k),hd(c,f)},S}function _m(c,f,S){S=n(-1,S),S.tag=3;var k=c.type.getDerivedStateFromError;if(typeof k=="function"){var V=f.value;S.payload=function(){return k(V)},S.callback=function(){hd(c,f)}}var $=c.stateNode;return $!==null&&typeof $.componentDidCatch=="function"&&(S.callback=function(){hd(c,f),typeof k!="function"&&(uc===null?uc=new Set([this]):uc.add(this));var ue=f.stack;this.componentDidCatch(f.value,{componentStack:ue!==null?ue:""})}),S}function Zg(c,f,S){var k=c.pingCache;if(k===null){k=c.pingCache=new Xp;var V=new Set;k.set(f,V)}else V=k.get(f),V===void 0&&(V=new Set,k.set(f,V));V.has(S)||(V.add(S),c=Tv.bind(null,c,f,S),f.then(c,c))}function Wg(c){do{var f;if((f=c.tag===13)&&(f=c.memoizedState,f=f!==null?f.dehydrated!==null:!0),f)return c;c=c.return}while(c!==null);return null}function ym(c,f,S,k,V){return(c.mode&1)===0?(c===f?c.flags|=65536:(c.flags|=128,S.flags|=131072,S.flags&=-52805,S.tag===1&&(S.alternate===null?S.tag=17:(f=n(-1,1),f.tag=2,s(S,f,1))),S.lanes|=1),c):(c.flags|=65536,c.lanes=V,c)}var Kg=Ye.ReactCurrentOwner,aa=!1;function la(c,f,S,k){f.child=c===null?ad(f,null,S,k):ku(f,c.child,S,k)}function Yp(c,f,S,k,V){S=S.render;var $=f.ref;return La(f,V),k=Ht(c,f,S,k,$,V),S=Vn(),c!==null&&!aa?(f.updateQueue=c.updateQueue,f.flags&=-2053,c.lanes&=~V,ic(c,f,V)):(Qi&&S&&Ih(f),f.flags|=1,la(c,f,k,V),f.child)}function vm(c,f,S,k,V){if(c===null){var $=S.type;return typeof $=="function"&&!Qc($)&&$.defaultProps===void 0&&S.compare===null&&S.defaultProps===void 0?(f.tag=15,f.type=$,Qp(c,f,$,k,V)):(c=mf(S.type,null,k,f,f.mode,V),c.ref=f.ref,c.return=f,f.child=c)}if($=c.child,(c.lanes&V)===0){var ue=$.memoizedProps;if(S=S.compare,S=S!==null?S:Xa,S(ue,k)&&c.ref===f.ref)return ic(c,f,V)}return f.flags|=1,c=uu($,k),c.ref=f.ref,c.return=f,f.child=c}function Qp(c,f,S,k,V){if(c!==null){var $=c.memoizedProps;if(Xa($,k)&&c.ref===f.ref)if(aa=!1,f.pendingProps=k=$,(c.lanes&V)!==0)(c.flags&131072)!==0&&(aa=!0);else return f.lanes=c.lanes,ic(c,f,V)}return Jp(c,f,S,k,V)}function dd(c,f,S){var k=f.pendingProps,V=k.children,$=c!==null?c.memoizedState:null;if(k.mode==="hidden")if((f.mode&1)===0)f.memoizedState={baseLanes:0,cachePool:null,transitions:null},nr(Nh,Oa),Oa|=S;else{if((S&1073741824)===0)return c=$!==null?$.baseLanes|S:S,f.lanes=f.childLanes=1073741824,f.memoizedState={baseLanes:c,cachePool:null,transitions:null},f.updateQueue=null,nr(Nh,Oa),Oa|=c,null;f.memoizedState={baseLanes:0,cachePool:null,transitions:null},k=$!==null?$.baseLanes:S,nr(Nh,Oa),Oa|=k}else $!==null?(k=$.baseLanes|S,f.memoizedState=null):k=S,nr(Nh,Oa),Oa|=k;return la(c,f,V,S),f.child}function za(c,f){var S=f.ref;(c===null&&S!==null||c!==null&&c.ref!==S)&&(f.flags|=512,f.flags|=2097152)}function Jp(c,f,S,k,V){var $=Kr(S)?Gt:Mr.current;return $=Xu(f,$),La(f,V),S=Ht(c,f,S,k,$,V),k=Vn(),c!==null&&!aa?(f.updateQueue=c.updateQueue,f.flags&=-2053,c.lanes&=~V,ic(c,f,V)):(Qi&&k&&Ih(f),f.flags|=1,la(c,f,S,V),f.child)}function ef(c,f,S,k,V){if(Kr(S)){var $=!0;bh(f)}else $=!1;if(La(f,V),f.stateNode===null)tf(c,f),fm(f,S,k),qc(f,S,k,V),k=!0;else if(c===null){var ue=f.stateNode,Le=f.memoizedProps;ue.props=Le;var He=ue.context,gt=S.contextType;typeof gt=="object"&&gt!==null?gt=Ns(gt):(gt=Kr(S)?Gt:Mr.current,gt=Xu(f,gt));var Bt=S.getDerivedStateFromProps,jt=typeof Bt=="function"||typeof ue.getSnapshotBeforeUpdate=="function";jt||typeof ue.UNSAFE_componentWillReceiveProps!="function"&&typeof ue.componentWillReceiveProps!="function"||(Le!==k||He!==gt)&&mm(f,ue,k,gt),Da=!1;var Ot=f.memoizedState;ue.state=Ot,b(f,k,ue,V),He=f.memoizedState,Le!==k||Ot!==He||Rr.current||Da?(typeof Bt=="function"&&(Yd(f,S,Bt,k),He=f.memoizedState),(Le=Da||Kp(f,S,Le,k,Ot,He,gt))?(jt||typeof ue.UNSAFE_componentWillMount!="function"&&typeof ue.componentWillMount!="function"||(typeof ue.componentWillMount=="function"&&ue.componentWillMount(),typeof ue.UNSAFE_componentWillMount=="function"&&ue.UNSAFE_componentWillMount()),typeof ue.componentDidMount=="function"&&(f.flags|=4194308)):(typeof ue.componentDidMount=="function"&&(f.flags|=4194308),f.memoizedProps=k,f.memoizedState=He),ue.props=k,ue.state=He,ue.context=gt,k=Le):(typeof ue.componentDidMount=="function"&&(f.flags|=4194308),k=!1)}else{ue=f.stateNode,w(c,f),Le=f.memoizedProps,gt=f.type===f.elementType?Le:sa(f.type,Le),ue.props=gt,jt=f.pendingProps,Ot=ue.context,He=S.contextType,typeof He=="object"&&He!==null?He=Ns(He):(He=Kr(S)?Gt:Mr.current,He=Xu(f,He));var an=S.getDerivedStateFromProps;(Bt=typeof an=="function"||typeof ue.getSnapshotBeforeUpdate=="function")||typeof ue.UNSAFE_componentWillReceiveProps!="function"&&typeof ue.componentWillReceiveProps!="function"||(Le!==jt||Ot!==He)&&mm(f,ue,k,He),Da=!1,Ot=f.memoizedState,ue.state=Ot,b(f,k,ue,V);var yn=f.memoizedState;Le!==jt||Ot!==yn||Rr.current||Da?(typeof an=="function"&&(Yd(f,S,an,k),yn=f.memoizedState),(gt=Da||Kp(f,S,gt,k,Ot,yn,He)||!1)?(Bt||typeof ue.UNSAFE_componentWillUpdate!="function"&&typeof ue.componentWillUpdate!="function"||(typeof ue.componentWillUpdate=="function"&&ue.componentWillUpdate(k,yn,He),typeof ue.UNSAFE_componentWillUpdate=="function"&&ue.UNSAFE_componentWillUpdate(k,yn,He)),typeof ue.componentDidUpdate=="function"&&(f.flags|=4),typeof ue.getSnapshotBeforeUpdate=="function"&&(f.flags|=1024)):(typeof ue.componentDidUpdate!="function"||Le===c.memoizedProps&&Ot===c.memoizedState||(f.flags|=4),typeof ue.getSnapshotBeforeUpdate!="function"||Le===c.memoizedProps&&Ot===c.memoizedState||(f.flags|=1024),f.memoizedProps=k,f.memoizedState=yn),ue.props=k,ue.state=yn,ue.context=He,k=gt):(typeof ue.componentDidUpdate!="function"||Le===c.memoizedProps&&Ot===c.memoizedState||(f.flags|=4),typeof ue.getSnapshotBeforeUpdate!="function"||Le===c.memoizedProps&&Ot===c.memoizedState||(f.flags|=1024),k=!1)}return xm(c,f,S,k,$,V)}function xm(c,f,S,k,V,$){za(c,f);var ue=(f.flags&128)!==0;if(!k&&!ue)return V&&ti(f,S,!1),ic(c,f,$);k=f.stateNode,Kg.current=f;var Le=ue&&typeof S.getDerivedStateFromError!="function"?null:k.render();return f.flags|=1,c!==null&&ue?(f.child=ku(f,c.child,null,$),f.child=ku(f,null,Le,$)):la(c,f,Le,$),f.memoizedState=k.state,V&&ti(f,S,!0),f.child}function wm(c){var f=c.stateNode;f.pendingContext?Nc(c,f.pendingContext,f.pendingContext!==f.context):f.context&&Nc(c,f.context,!1),K(c,f.containerInfo)}function Xg(c,f,S,k,V){return Uc(),Qu(V),f.flags|=256,la(c,f,S,k),f.child}var bm={dehydrated:null,treeContext:null,retryLane:0};function Tm(c){return{baseLanes:c,cachePool:null,transitions:null}}function Yg(c,f,S){var k=f.pendingProps,V=ge.current,$=!1,ue=(f.flags&128)!==0,Le;if((Le=ue)||(Le=c!==null&&c.memoizedState===null?!1:(V&2)!==0),Le?($=!0,f.flags&=-129):(c===null||c.memoizedState!==null)&&(V|=1),nr(ge,V&1),c===null)return Vc(f),c=f.memoizedState,c!==null&&(c=c.dehydrated,c!==null)?((f.mode&1)===0?f.lanes=1:c.data==="$!"?f.lanes=8:f.lanes=1073741824,null):(ue=k.children,c=k.fallback,$?(k=f.mode,$=f.child,ue={mode:"hidden",children:ue},(k&1)===0&&$!==null?($.childLanes=0,$.pendingProps=ue):$=up(ue,k,0,null),c=Vh(c,k,S,null),$.return=f,c.return=f,$.sibling=c,f.child=$,f.child.memoizedState=Tm(S),f.memoizedState=bm,c):Qd(f,ue));if(V=c.memoizedState,V!==null&&(Le=V.dehydrated,Le!==null))return Qg(c,f,ue,k,Le,V,S);if($){$=k.fallback,ue=f.mode,V=c.child,Le=V.sibling;var He={mode:"hidden",children:k.children};return(ue&1)===0&&f.child!==V?(k=f.child,k.childLanes=0,k.pendingProps=He,f.deletions=null):(k=uu(V,He),k.subtreeFlags=V.subtreeFlags&14680064),Le!==null?$=uu(Le,$):($=Vh($,ue,S,null),$.flags|=2),$.return=f,k.return=f,k.sibling=$,f.child=k,k=$,$=f.child,ue=c.child.memoizedState,ue=ue===null?Tm(S):{baseLanes:ue.baseLanes|S,cachePool:null,transitions:ue.transitions},$.memoizedState=ue,$.childLanes=c.childLanes&~S,f.memoizedState=bm,k}return $=c.child,c=$.sibling,k=uu($,{mode:"visible",children:k.children}),(f.mode&1)===0&&(k.lanes=S),k.return=f,k.sibling=null,c!==null&&(S=f.deletions,S===null?(f.deletions=[c],f.flags|=16):S.push(c)),f.child=k,f.memoizedState=null,k}function Qd(c,f){return f=up({mode:"visible",children:f},c.mode,0,null),f.return=c,c.child=f}function pd(c,f,S,k){return k!==null&&Qu(k),ku(f,c.child,null,S),c=Qd(f,f.pendingProps.children),c.flags|=2,f.memoizedState=null,c}function Qg(c,f,S,k,V,$,ue){if(S)return f.flags&256?(f.flags&=-257,k=Rh(Error(t(422))),pd(c,f,ue,k)):f.memoizedState!==null?(f.child=c.child,f.flags|=128,null):($=k.fallback,V=f.mode,k=up({mode:"visible",children:k.children},V,0,null),$=Vh($,V,ue,null),$.flags|=2,k.return=f,$.return=f,k.sibling=$,f.child=k,(f.mode&1)!==0&&ku(f,c.child,null,ue),f.child.memoizedState=Tm(ue),f.memoizedState=bm,$);if((f.mode&1)===0)return pd(c,f,ue,null);if(V.data==="$!"){if(k=V.nextSibling&&V.nextSibling.dataset,k)var Le=k.dgst;return k=Le,$=Error(t(419)),k=Rh($,k,void 0),pd(c,f,ue,k)}if(Le=(ue&c.childLanes)!==0,aa||Le){if(k=Mo,k!==null){switch(ue&-ue){case 4:V=2;break;case 16:V=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:V=32;break;case 536870912:V=268435456;break;default:V=0}V=(V&(k.suspendedLanes|ue))!==0?0:V,V!==0&&V!==$.retryLane&&($.retryLane=V,nl(c,V),Ll(k,c,V,-1))}return ap(),k=Rh(Error(t(421))),pd(c,f,ue,k)}return V.data==="$?"?(f.flags|=128,f.child=c.child,f=ca.bind(null,c),V._reactRetry=f,null):(c=$.treeContext,Lr=Aa(V.nextSibling),jo=f,Qi=!0,rn=null,c!==null&&(na[ia++]=bi,na[ia++]=Ma,na[ia++]=hs,bi=c.id,Ma=c.overflow,hs=f),f=Qd(f,k.children),f.flags|=4096,f)}function Gc(c,f,S){c.lanes|=f;var k=c.alternate;k!==null&&(k.lanes|=f),Mu(c.return,f,S)}function Lh(c,f,S,k,V){var $=c.memoizedState;$===null?c.memoizedState={isBackwards:f,rendering:null,renderingStartTime:0,last:k,tail:S,tailMode:V}:($.isBackwards=f,$.rendering=null,$.renderingStartTime=0,$.last=k,$.tail=S,$.tailMode=V)}function Jg(c,f,S){var k=f.pendingProps,V=k.revealOrder,$=k.tail;if(la(c,f,k.children,S),k=ge.current,(k&2)!==0)k=k&1|2,f.flags|=128;else{if(c!==null&&(c.flags&128)!==0)e:for(c=f.child;c!==null;){if(c.tag===13)c.memoizedState!==null&&Gc(c,S,f);else if(c.tag===19)Gc(c,S,f);else if(c.child!==null){c.child.return=c,c=c.child;continue}if(c===f)break e;for(;c.sibling===null;){if(c.return===null||c.return===f)break e;c=c.return}c.sibling.return=c.return,c=c.sibling}k&=1}if(nr(ge,k),(f.mode&1)===0)f.memoizedState=null;else switch(V){case"forwards":for(S=f.child,V=null;S!==null;)c=S.alternate,c!==null&&Te(c)===null&&(V=S),S=S.sibling;S=V,S===null?(V=f.child,f.child=null):(V=S.sibling,S.sibling=null),Lh(f,!1,V,S,$);break;case"backwards":for(S=null,V=f.child,f.child=null;V!==null;){if(c=V.alternate,c!==null&&Te(c)===null){f.child=V;break}c=V.sibling,V.sibling=S,S=V,V=c}Lh(f,!0,S,null,$);break;case"together":Lh(f,!1,null,null,void 0);break;default:f.memoizedState=null}return f.child}function tf(c,f){(f.mode&1)===0&&c!==null&&(c.alternate=null,f.alternate=null,f.flags|=2)}function ic(c,f,S){if(c!==null&&(f.dependencies=c.dependencies),ac|=f.lanes,(S&f.childLanes)===0)return null;if(c!==null&&f.child!==c.child)throw Error(t(153));if(f.child!==null){for(c=f.child,S=uu(c,c.pendingProps),f.child=S,S.return=f;c.sibling!==null;)c=c.sibling,S=S.sibling=uu(c,c.pendingProps),S.return=f;S.sibling=null}return f.child}function xv(c,f,S){switch(f.tag){case 3:wm(f),Uc();break;case 5:le(f);break;case 1:Kr(f.type)&&bh(f);break;case 4:K(f,f.stateNode.containerInfo);break;case 10:var k=f.type._context,V=f.memoizedProps.value;nr(Ra,k._currentValue),k._currentValue=V;break;case 13:if(k=f.memoizedState,k!==null)return k.dehydrated!==null?(nr(ge,ge.current&1),f.flags|=128,null):(S&f.child.childLanes)!==0?Yg(c,f,S):(nr(ge,ge.current&1),c=ic(c,f,S),c!==null?c.sibling:null);nr(ge,ge.current&1);break;case 19:if(k=(S&f.childLanes)!==0,(c.flags&128)!==0){if(k)return Jg(c,f,S);f.flags|=128}if(V=f.memoizedState,V!==null&&(V.rendering=null,V.tail=null,V.lastEffect=null),nr(ge,ge.current),k)break;return null;case 22:case 23:return f.lanes=0,dd(c,f,S)}return ic(c,f,S)}var e_,Sm,t_,nf;e_=function(c,f){for(var S=f.child;S!==null;){if(S.tag===5||S.tag===6)c.appendChild(S.stateNode);else if(S.tag!==4&&S.child!==null){S.child.return=S,S=S.child;continue}if(S===f)break;for(;S.sibling===null;){if(S.return===null||S.return===f)return;S=S.return}S.sibling.return=S.return,S=S.sibling}},Sm=function(){},t_=function(c,f,S,k){var V=c.memoizedProps;if(V!==k){c=f.stateNode,W(z.current);var $=null;switch(S){case"input":V=Wi(c,V),k=Wi(c,k),$=[];break;case"select":V=St({},V,{value:void 0}),k=St({},k,{value:void 0}),$=[];break;case"textarea":V=Ts(c,V),k=Ts(c,k),$=[];break;default:typeof V.onClick!="function"&&typeof k.onClick=="function"&&(c.onclick=kt)}se(S,k);var ue;S=null;for(gt in V)if(!k.hasOwnProperty(gt)&&V.hasOwnProperty(gt)&&V[gt]!=null)if(gt==="style"){var Le=V[gt];for(ue in Le)Le.hasOwnProperty(ue)&&(S||(S={}),S[ue]="")}else gt!=="dangerouslySetInnerHTML"&&gt!=="children"&&gt!=="suppressContentEditableWarning"&&gt!=="suppressHydrationWarning"&&gt!=="autoFocus"&&(h.hasOwnProperty(gt)?$||($=[]):($=$||[]).push(gt,null));for(gt in k){var He=k[gt];if(Le=V?.[gt],k.hasOwnProperty(gt)&&He!==Le&&(He!=null||Le!=null))if(gt==="style")if(Le){for(ue in Le)!Le.hasOwnProperty(ue)||He&&He.hasOwnProperty(ue)||(S||(S={}),S[ue]="");for(ue in He)He.hasOwnProperty(ue)&&Le[ue]!==He[ue]&&(S||(S={}),S[ue]=He[ue])}else S||($||($=[]),$.push(gt,S)),S=He;else gt==="dangerouslySetInnerHTML"?(He=He?He.__html:void 0,Le=Le?Le.__html:void 0,He!=null&&Le!==He&&($=$||[]).push(gt,He)):gt==="children"?typeof He!="string"&&typeof He!="number"||($=$||[]).push(gt,""+He):gt!=="suppressContentEditableWarning"&&gt!=="suppressHydrationWarning"&&(h.hasOwnProperty(gt)?(He!=null&&gt==="onScroll"&&Yi("scroll",c),$||Le===He||($=[])):($=$||[]).push(gt,He))}S&&($=$||[]).push("style",S);var gt=$;(f.updateQueue=gt)&&(f.flags|=4)}},nf=function(c,f,S,k){S!==k&&(f.flags|=4)};function Jd(c,f){if(!Qi)switch(c.tailMode){case"hidden":f=c.tail;for(var S=null;f!==null;)f.alternate!==null&&(S=f),f=f.sibling;S===null?c.tail=null:S.sibling=null;break;case"collapsed":S=c.tail;for(var k=null;S!==null;)S.alternate!==null&&(k=S),S=S.sibling;k===null?f||c.tail===null?c.tail=null:c.tail.sibling=null:k.sibling=null}}function ps(c){var f=c.alternate!==null&&c.alternate.child===c.child,S=0,k=0;if(f)for(var V=c.child;V!==null;)S|=V.lanes|V.childLanes,k|=V.subtreeFlags&14680064,k|=V.flags&14680064,V.return=c,V=V.sibling;else for(V=c.child;V!==null;)S|=V.lanes|V.childLanes,k|=V.subtreeFlags,k|=V.flags,V.return=c,V=V.sibling;return c.subtreeFlags|=k,c.childLanes=S,f}function ep(c,f,S){var k=f.pendingProps;switch(Ph(f),f.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ps(f),null;case 1:return Kr(f.type)&&wh(),ps(f),null;case 3:return k=f.stateNode,oe(),hr(Rr),hr(Mr),Re(),k.pendingContext&&(k.context=k.pendingContext,k.pendingContext=null),(c===null||c.child===null)&&(Ch(f)?f.flags|=4:c===null||c.memoizedState.isDehydrated&&(f.flags&256)===0||(f.flags|=1024,rn!==null&&(Am(rn),rn=null))),Sm(c,f),ps(f),null;case 5:we(f);var V=W(q.current);if(S=f.type,c!==null&&f.stateNode!=null)t_(c,f,S,k,V),c.ref!==f.ref&&(f.flags|=512,f.flags|=2097152);else{if(!k){if(f.stateNode===null)throw Error(t(166));return ps(f),null}if(c=W(z.current),Ch(f)){k=f.stateNode,S=f.type;var $=f.memoizedProps;switch(k[ta]=f,k[tu]=$,c=(f.mode&1)!==0,S){case"dialog":Yi("cancel",k),Yi("close",k);break;case"iframe":case"object":case"embed":Yi("load",k);break;case"video":case"audio":for(V=0;V<bl.length;V++)Yi(bl[V],k);break;case"source":Yi("error",k);break;case"img":case"image":case"link":Yi("error",k),Yi("load",k);break;case"details":Yi("toggle",k);break;case"input":Qo(k,$),Yi("invalid",k);break;case"select":k._wrapperState={wasMultiple:!!$.multiple},Yi("invalid",k);break;case"textarea":Fo(k,$),Yi("invalid",k)}se(S,$),V=null;for(var ue in $)if($.hasOwnProperty(ue)){var Le=$[ue];ue==="children"?typeof Le=="string"?k.textContent!==Le&&($.suppressHydrationWarning!==!0&&dt(k.textContent,Le,c),V=["children",Le]):typeof Le=="number"&&k.textContent!==""+Le&&($.suppressHydrationWarning!==!0&&dt(k.textContent,Le,c),V=["children",""+Le]):h.hasOwnProperty(ue)&&Le!=null&&ue==="onScroll"&&Yi("scroll",k)}switch(S){case"input":Ji(k),Oo(k,$,!0);break;case"textarea":Ji(k),Hs(k);break;case"select":case"option":break;default:typeof $.onClick=="function"&&(k.onclick=kt)}k=V,f.updateQueue=k,k!==null&&(f.flags|=4)}else{ue=V.nodeType===9?V:V.ownerDocument,c==="http://www.w3.org/1999/xhtml"&&(c=Mi(S)),c==="http://www.w3.org/1999/xhtml"?S==="script"?(c=ue.createElement("div"),c.innerHTML="<script><\/script>",c=c.removeChild(c.firstChild)):typeof k.is=="string"?c=ue.createElement(S,{is:k.is}):(c=ue.createElement(S),S==="select"&&(ue=c,k.multiple?ue.multiple=!0:k.size&&(ue.size=k.size))):c=ue.createElementNS(c,S),c[ta]=f,c[tu]=k,e_(c,f,!1,!1),f.stateNode=c;e:{switch(ue=ce(S,k),S){case"dialog":Yi("cancel",c),Yi("close",c),V=k;break;case"iframe":case"object":case"embed":Yi("load",c),V=k;break;case"video":case"audio":for(V=0;V<bl.length;V++)Yi(bl[V],c);V=k;break;case"source":Yi("error",c),V=k;break;case"img":case"image":case"link":Yi("error",c),Yi("load",c),V=k;break;case"details":Yi("toggle",c),V=k;break;case"input":Qo(c,k),V=Wi(c,k),Yi("invalid",c);break;case"option":V=k;break;case"select":c._wrapperState={wasMultiple:!!k.multiple},V=St({},k,{value:void 0}),Yi("invalid",c);break;case"textarea":Fo(c,k),V=Ts(c,k),Yi("invalid",c);break;default:V=k}se(S,V),Le=V;for($ in Le)if(Le.hasOwnProperty($)){var He=Le[$];$==="style"?Bo(c,He):$==="dangerouslySetInnerHTML"?(He=He?He.__html:void 0,He!=null&&qs(c,He)):$==="children"?typeof He=="string"?(S!=="textarea"||He!=="")&&uo(c,He):typeof He=="number"&&uo(c,""+He):$!=="suppressContentEditableWarning"&&$!=="suppressHydrationWarning"&&$!=="autoFocus"&&(h.hasOwnProperty($)?He!=null&&$==="onScroll"&&Yi("scroll",c):He!=null&&vt(c,$,He,ue))}switch(S){case"input":Ji(c),Oo(c,k,!1);break;case"textarea":Ji(c),Hs(c);break;case"option":k.value!=null&&c.setAttribute("value",""+$n(k.value));break;case"select":c.multiple=!!k.multiple,$=k.value,$!=null?Jr(c,!!k.multiple,$,!1):k.defaultValue!=null&&Jr(c,!!k.multiple,k.defaultValue,!0);break;default:typeof V.onClick=="function"&&(c.onclick=kt)}switch(S){case"button":case"input":case"select":case"textarea":k=!!k.autoFocus;break e;case"img":k=!0;break e;default:k=!1}}k&&(f.flags|=4)}f.ref!==null&&(f.flags|=512,f.flags|=2097152)}return ps(f),null;case 6:if(c&&f.stateNode!=null)nf(c,f,c.memoizedProps,k);else{if(typeof k!="string"&&f.stateNode===null)throw Error(t(166));if(S=W(q.current),W(z.current),Ch(f)){if(k=f.stateNode,S=f.memoizedProps,k[ta]=f,($=k.nodeValue!==S)&&(c=jo,c!==null))switch(c.tag){case 3:dt(k.nodeValue,S,(c.mode&1)!==0);break;case 5:c.memoizedProps.suppressHydrationWarning!==!0&&dt(k.nodeValue,S,(c.mode&1)!==0)}$&&(f.flags|=4)}else k=(S.nodeType===9?S:S.ownerDocument).createTextNode(k),k[ta]=f,f.stateNode=k}return ps(f),null;case 13:if(hr(ge),k=f.memoizedState,c===null||c.memoizedState!==null&&c.memoizedState.dehydrated!==null){if(Qi&&Lr!==null&&(f.mode&1)!==0&&(f.flags&128)===0)tl(),Uc(),f.flags|=98560,$=!1;else if($=Ch(f),k!==null&&k.dehydrated!==null){if(c===null){if(!$)throw Error(t(318));if($=f.memoizedState,$=$!==null?$.dehydrated:null,!$)throw Error(t(317));$[ta]=f}else Uc(),(f.flags&128)===0&&(f.memoizedState=null),f.flags|=4;ps(f),$=!1}else rn!==null&&(Am(rn),rn=null),$=!0;if(!$)return f.flags&65536?f:null}return(f.flags&128)!==0?(f.lanes=S,f):(k=k!==null,k!==(c!==null&&c.memoizedState!==null)&&k&&(f.child.flags|=8192,(f.mode&1)!==0&&(c===null||(ge.current&1)!==0?Ur===0&&(Ur=3):ap())),f.updateQueue!==null&&(f.flags|=4),ps(f),null);case 4:return oe(),Sm(c,f),c===null&&Sl(f.stateNode.containerInfo),ps(f),null;case 10:return kh(f.type._context),ps(f),null;case 17:return Kr(f.type)&&wh(),ps(f),null;case 19:if(hr(ge),$=f.memoizedState,$===null)return ps(f),null;if(k=(f.flags&128)!==0,ue=$.rendering,ue===null)if(k)Jd($,!1);else{if(Ur!==0||c!==null&&(c.flags&128)!==0)for(c=f.child;c!==null;){if(ue=Te(c),ue!==null){for(f.flags|=128,Jd($,!1),k=ue.updateQueue,k!==null&&(f.updateQueue=k,f.flags|=4),f.subtreeFlags=0,k=S,S=f.child;S!==null;)$=S,c=k,$.flags&=14680066,ue=$.alternate,ue===null?($.childLanes=0,$.lanes=c,$.child=null,$.subtreeFlags=0,$.memoizedProps=null,$.memoizedState=null,$.updateQueue=null,$.dependencies=null,$.stateNode=null):($.childLanes=ue.childLanes,$.lanes=ue.lanes,$.child=ue.child,$.subtreeFlags=0,$.deletions=null,$.memoizedProps=ue.memoizedProps,$.memoizedState=ue.memoizedState,$.updateQueue=ue.updateQueue,$.type=ue.type,c=ue.dependencies,$.dependencies=c===null?null:{lanes:c.lanes,firstContext:c.firstContext}),S=S.sibling;return nr(ge,ge.current&1|2),f.child}c=c.sibling}$.tail!==null&&Ki()>Oh&&(f.flags|=128,k=!0,Jd($,!1),f.lanes=4194304)}else{if(!k)if(c=Te(ue),c!==null){if(f.flags|=128,k=!0,S=c.updateQueue,S!==null&&(f.updateQueue=S,f.flags|=4),Jd($,!0),$.tail===null&&$.tailMode==="hidden"&&!ue.alternate&&!Qi)return ps(f),null}else 2*Ki()-$.renderingStartTime>Oh&&S!==1073741824&&(f.flags|=128,k=!0,Jd($,!1),f.lanes=4194304);$.isBackwards?(ue.sibling=f.child,f.child=ue):(S=$.last,S!==null?S.sibling=ue:f.child=ue,$.last=ue)}return $.tail!==null?(f=$.tail,$.rendering=f,$.tail=f.sibling,$.renderingStartTime=Ki(),f.sibling=null,S=ge.current,nr(ge,k?S&1|2:S&1),f):(ps(f),null);case 22:case 23:return Mm(),k=f.memoizedState!==null,c!==null&&c.memoizedState!==null!==k&&(f.flags|=8192),k&&(f.mode&1)!==0?(Oa&1073741824)!==0&&(ps(f),f.subtreeFlags&6&&(f.flags|=8192)):ps(f),null;case 24:return null;case 25:return null}throw Error(t(156,f.tag))}function wv(c,f){switch(Ph(f),f.tag){case 1:return Kr(f.type)&&wh(),c=f.flags,c&65536?(f.flags=c&-65537|128,f):null;case 3:return oe(),hr(Rr),hr(Mr),Re(),c=f.flags,(c&65536)!==0&&(c&128)===0?(f.flags=c&-65537|128,f):null;case 5:return we(f),null;case 13:if(hr(ge),c=f.memoizedState,c!==null&&c.dehydrated!==null){if(f.alternate===null)throw Error(t(340));Uc()}return c=f.flags,c&65536?(f.flags=c&-65537|128,f):null;case 19:return hr(ge),null;case 4:return oe(),null;case 10:return kh(f.type._context),null;case 22:case 23:return Mm(),null;case 24:return null;default:return null}}var br=!1,ro=!1,n_=typeof WeakSet=="function"?WeakSet:Set,un=null;function rc(c,f){var S=c.ref;if(S!==null)if(typeof S=="function")try{S(null)}catch(k){Xr(c,f,k)}else S.current=null}function Dh(c,f,S){try{S()}catch(k){Xr(c,f,k)}}var Em=!1;function i_(c,f){if(tn=ss,c=wu(),Xl(c)){if("selectionStart"in c)var S={start:c.selectionStart,end:c.selectionEnd};else e:{S=(S=c.ownerDocument)&&S.defaultView||window;var k=S.getSelection&&S.getSelection();if(k&&k.rangeCount!==0){S=k.anchorNode;var V=k.anchorOffset,$=k.focusNode;k=k.focusOffset;try{S.nodeType,$.nodeType}catch{S=null;break e}var ue=0,Le=-1,He=-1,gt=0,Bt=0,jt=c,Ot=null;t:for(;;){for(var an;jt!==S||V!==0&&jt.nodeType!==3||(Le=ue+V),jt!==$||k!==0&&jt.nodeType!==3||(He=ue+k),jt.nodeType===3&&(ue+=jt.nodeValue.length),(an=jt.firstChild)!==null;)Ot=jt,jt=an;for(;;){if(jt===c)break t;if(Ot===S&&++gt===V&&(Le=ue),Ot===$&&++Bt===k&&(He=ue),(an=jt.nextSibling)!==null)break;jt=Ot,Ot=jt.parentNode}jt=an}S=Le===-1||He===-1?null:{start:Le,end:He}}else S=null}S=S||{start:0,end:0}}else S=null;for(Sn={focusedElem:c,selectionRange:S},ss=!1,un=f;un!==null;)if(f=un,c=f.child,(f.subtreeFlags&1028)!==0&&c!==null)c.return=f,un=c;else for(;un!==null;){f=un;try{var yn=f.alternate;if((f.flags&1024)!==0)switch(f.tag){case 0:case 11:case 15:break;case 1:if(yn!==null){var wn=yn.memoizedProps,so=yn.memoizedState,ot=f.stateNode,We=ot.getSnapshotBeforeUpdate(f.elementType===f.type?wn:sa(f.type,wn),so);ot.__reactInternalSnapshotBeforeUpdate=We}break;case 3:var lt=f.stateNode.containerInfo;lt.nodeType===1?lt.textContent="":lt.nodeType===9&&lt.documentElement&&lt.removeChild(lt.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(t(163))}}catch(qt){Xr(f,f.return,qt)}if(c=f.sibling,c!==null){c.return=f.return,un=c;break}un=f.return}return yn=Em,Em=!1,yn}function oc(c,f,S){var k=f.updateQueue;if(k=k!==null?k.lastEffect:null,k!==null){var V=k=k.next;do{if((V.tag&c)===c){var $=V.destroy;V.destroy=void 0,$!==void 0&&Dh(f,S,$)}V=V.next}while(V!==k)}}function fd(c,f){if(f=f.updateQueue,f=f!==null?f.lastEffect:null,f!==null){var S=f=f.next;do{if((S.tag&c)===c){var k=S.create;S.destroy=k()}S=S.next}while(S!==f)}}function Zc(c){var f=c.ref;if(f!==null){var S=c.stateNode;switch(c.tag){case 5:c=S;break;default:c=S}typeof f=="function"?f(c):f.current=c}}function tp(c){var f=c.alternate;f!==null&&(c.alternate=null,tp(f)),c.child=null,c.deletions=null,c.sibling=null,c.tag===5&&(f=c.stateNode,f!==null&&(delete f[ta],delete f[tu],delete f[nu],delete f[Dc],delete f[Cu])),c.stateNode=null,c.return=null,c.dependencies=null,c.memoizedProps=null,c.memoizedState=null,c.pendingProps=null,c.stateNode=null,c.updateQueue=null}function zh(c){return c.tag===5||c.tag===3||c.tag===4}function md(c){e:for(;;){for(;c.sibling===null;){if(c.return===null||zh(c.return))return null;c=c.return}for(c.sibling.return=c.return,c=c.sibling;c.tag!==5&&c.tag!==6&&c.tag!==18;){if(c.flags&2||c.child===null||c.tag===4)continue e;c.child.return=c,c=c.child}if(!(c.flags&2))return c.stateNode}}function Im(c,f,S){var k=c.tag;if(k===5||k===6)c=c.stateNode,f?S.nodeType===8?S.parentNode.insertBefore(c,f):S.insertBefore(c,f):(S.nodeType===8?(f=S.parentNode,f.insertBefore(c,S)):(f=S,f.appendChild(c)),S=S._reactRootContainer,S!=null||f.onclick!==null||(f.onclick=kt));else if(k!==4&&(c=c.child,c!==null))for(Im(c,f,S),c=c.sibling;c!==null;)Im(c,f,S),c=c.sibling}function rf(c,f,S){var k=c.tag;if(k===5||k===6)c=c.stateNode,f?S.insertBefore(c,f):S.appendChild(c);else if(k!==4&&(c=c.child,c!==null))for(rf(c,f,S),c=c.sibling;c!==null;)rf(c,f,S),c=c.sibling}var Br=null,lu=!1;function sc(c,f,S){for(S=S.child;S!==null;)gd(c,f,S),S=S.sibling}function gd(c,f,S){if(bo&&typeof bo.onCommitFiberUnmount=="function")try{bo.onCommitFiberUnmount(dl,S)}catch{}switch(S.tag){case 5:ro||rc(S,f);case 6:var k=Br,V=lu;Br=null,sc(c,f,S),Br=k,lu=V,Br!==null&&(lu?(c=Br,S=S.stateNode,c.nodeType===8?c.parentNode.removeChild(S):c.removeChild(S)):Br.removeChild(S.stateNode));break;case 18:Br!==null&&(lu?(c=Br,S=S.stateNode,c.nodeType===8?Ca(c.parentNode,S):c.nodeType===1&&Ca(c,S),Xi(c)):Ca(Br,S.stateNode));break;case 4:k=Br,V=lu,Br=S.stateNode.containerInfo,lu=!0,sc(c,f,S),Br=k,lu=V;break;case 0:case 11:case 14:case 15:if(!ro&&(k=S.updateQueue,k!==null&&(k=k.lastEffect,k!==null))){V=k=k.next;do{var $=V,ue=$.destroy;$=$.tag,ue!==void 0&&(($&2)!==0||($&4)!==0)&&Dh(S,f,ue),V=V.next}while(V!==k)}sc(c,f,S);break;case 1:if(!ro&&(rc(S,f),k=S.stateNode,typeof k.componentWillUnmount=="function"))try{k.props=S.memoizedProps,k.state=S.memoizedState,k.componentWillUnmount()}catch(Le){Xr(S,f,Le)}sc(c,f,S);break;case 21:sc(c,f,S);break;case 22:S.mode&1?(ro=(k=ro)||S.memoizedState!==null,sc(c,f,S),ro=k):sc(c,f,S);break;default:sc(c,f,S)}}function of(c){var f=c.updateQueue;if(f!==null){c.updateQueue=null;var S=c.stateNode;S===null&&(S=c.stateNode=new n_),f.forEach(function(k){var V=Om.bind(null,c,k);S.has(k)||(S.add(k),k.then(V,V))})}}function Rl(c,f){var S=f.deletions;if(S!==null)for(var k=0;k<S.length;k++){var V=S[k];try{var $=c,ue=f,Le=ue;e:for(;Le!==null;){switch(Le.tag){case 5:Br=Le.stateNode,lu=!1;break e;case 3:Br=Le.stateNode.containerInfo,lu=!0;break e;case 4:Br=Le.stateNode.containerInfo,lu=!0;break e}Le=Le.return}if(Br===null)throw Error(t(160));gd($,ue,V),Br=null,lu=!1;var He=V.alternate;He!==null&&(He.return=null),V.return=null}catch(gt){Xr(V,f,gt)}}if(f.subtreeFlags&12854)for(f=f.child;f!==null;)Pm(f,c),f=f.sibling}function Pm(c,f){var S=c.alternate,k=c.flags;switch(c.tag){case 0:case 11:case 14:case 15:if(Rl(f,c),zu(c),k&4){try{oc(3,c,c.return),fd(3,c)}catch(wn){Xr(c,c.return,wn)}try{oc(5,c,c.return)}catch(wn){Xr(c,c.return,wn)}}break;case 1:Rl(f,c),zu(c),k&512&&S!==null&&rc(S,S.return);break;case 5:if(Rl(f,c),zu(c),k&512&&S!==null&&rc(S,S.return),c.flags&32){var V=c.stateNode;try{uo(V,"")}catch(wn){Xr(c,c.return,wn)}}if(k&4&&(V=c.stateNode,V!=null)){var $=c.memoizedProps,ue=S!==null?S.memoizedProps:$,Le=c.type,He=c.updateQueue;if(c.updateQueue=null,He!==null)try{Le==="input"&&$.type==="radio"&&$.name!=null&&bs(V,$),ce(Le,ue);var gt=ce(Le,$);for(ue=0;ue<He.length;ue+=2){var Bt=He[ue],jt=He[ue+1];Bt==="style"?Bo(V,jt):Bt==="dangerouslySetInnerHTML"?qs(V,jt):Bt==="children"?uo(V,jt):vt(V,Bt,jt,gt)}switch(Le){case"input":Qr(V,$);break;case"textarea":_a(V,$);break;case"select":var Ot=V._wrapperState.wasMultiple;V._wrapperState.wasMultiple=!!$.multiple;var an=$.value;an!=null?Jr(V,!!$.multiple,an,!1):Ot!==!!$.multiple&&($.defaultValue!=null?Jr(V,!!$.multiple,$.defaultValue,!0):Jr(V,!!$.multiple,$.multiple?[]:"",!1))}V[tu]=$}catch(wn){Xr(c,c.return,wn)}}break;case 6:if(Rl(f,c),zu(c),k&4){if(c.stateNode===null)throw Error(t(162));V=c.stateNode,$=c.memoizedProps;try{V.nodeValue=$}catch(wn){Xr(c,c.return,wn)}}break;case 3:if(Rl(f,c),zu(c),k&4&&S!==null&&S.memoizedState.isDehydrated)try{Xi(f.containerInfo)}catch(wn){Xr(c,c.return,wn)}break;case 4:Rl(f,c),zu(c);break;case 13:Rl(f,c),zu(c),V=c.child,V.flags&8192&&($=V.memoizedState!==null,V.stateNode.isHidden=$,!$||V.alternate!==null&&V.alternate.memoizedState!==null||(lf=Ki())),k&4&&of(c);break;case 22:if(Bt=S!==null&&S.memoizedState!==null,c.mode&1?(ro=(gt=ro)||Bt,Rl(f,c),ro=gt):Rl(f,c),zu(c),k&8192){if(gt=c.memoizedState!==null,(c.stateNode.isHidden=gt)&&!Bt&&(c.mode&1)!==0)for(un=c,Bt=c.child;Bt!==null;){for(jt=un=Bt;un!==null;){switch(Ot=un,an=Ot.child,Ot.tag){case 0:case 11:case 14:case 15:oc(4,Ot,Ot.return);break;case 1:rc(Ot,Ot.return);var yn=Ot.stateNode;if(typeof yn.componentWillUnmount=="function"){k=Ot,S=Ot.return;try{f=k,yn.props=f.memoizedProps,yn.state=f.memoizedState,yn.componentWillUnmount()}catch(wn){Xr(k,S,wn)}}break;case 5:rc(Ot,Ot.return);break;case 22:if(Ot.memoizedState!==null){s_(jt);continue}}an!==null?(an.return=Ot,un=an):s_(jt)}Bt=Bt.sibling}e:for(Bt=null,jt=c;;){if(jt.tag===5){if(Bt===null){Bt=jt;try{V=jt.stateNode,gt?($=V.style,typeof $.setProperty=="function"?$.setProperty("display","none","important"):$.display="none"):(Le=jt.stateNode,He=jt.memoizedProps.style,ue=He!=null&&He.hasOwnProperty("display")?He.display:null,Le.style.display=ya("display",ue))}catch(wn){Xr(c,c.return,wn)}}}else if(jt.tag===6){if(Bt===null)try{jt.stateNode.nodeValue=gt?"":jt.memoizedProps}catch(wn){Xr(c,c.return,wn)}}else if((jt.tag!==22&&jt.tag!==23||jt.memoizedState===null||jt===c)&&jt.child!==null){jt.child.return=jt,jt=jt.child;continue}if(jt===c)break e;for(;jt.sibling===null;){if(jt.return===null||jt.return===c)break e;Bt===jt&&(Bt=null),jt=jt.return}Bt===jt&&(Bt=null),jt.sibling.return=jt.return,jt=jt.sibling}}break;case 19:Rl(f,c),zu(c),k&4&&of(c);break;case 21:break;default:Rl(f,c),zu(c)}}function zu(c){var f=c.flags;if(f&2){try{e:{for(var S=c.return;S!==null;){if(zh(S)){var k=S;break e}S=S.return}throw Error(t(160))}switch(k.tag){case 5:var V=k.stateNode;k.flags&32&&(uo(V,""),k.flags&=-33);var $=md(c);rf(c,$,V);break;case 3:case 4:var ue=k.stateNode.containerInfo,Le=md(c);Im(c,Le,ue);break;default:throw Error(t(161))}}catch(He){Xr(c,c.return,He)}c.flags&=-3}f&4096&&(c.flags&=-4097)}function bv(c,f,S){un=c,r_(c)}function r_(c,f,S){for(var k=(c.mode&1)!==0;un!==null;){var V=un,$=V.child;if(V.tag===22&&k){var ue=V.memoizedState!==null||br;if(!ue){var Le=V.alternate,He=Le!==null&&Le.memoizedState!==null||ro;Le=br;var gt=ro;if(br=ue,(ro=He)&&!gt)for(un=V;un!==null;)ue=un,He=ue.child,ue.tag===22&&ue.memoizedState!==null?sf(V):He!==null?(He.return=ue,un=He):sf(V);for(;$!==null;)un=$,r_($),$=$.sibling;un=V,br=Le,ro=gt}o_(c)}else(V.subtreeFlags&8772)!==0&&$!==null?($.return=V,un=$):o_(c)}}function o_(c){for(;un!==null;){var f=un;if((f.flags&8772)!==0){var S=f.alternate;try{if((f.flags&8772)!==0)switch(f.tag){case 0:case 11:case 15:ro||fd(5,f);break;case 1:var k=f.stateNode;if(f.flags&4&&!ro)if(S===null)k.componentDidMount();else{var V=f.elementType===f.type?S.memoizedProps:sa(f.type,S.memoizedProps);k.componentDidUpdate(V,S.memoizedState,k.__reactInternalSnapshotBeforeUpdate)}var $=f.updateQueue;$!==null&&I(f,$,k);break;case 3:var ue=f.updateQueue;if(ue!==null){if(S=null,f.child!==null)switch(f.child.tag){case 5:S=f.child.stateNode;break;case 1:S=f.child.stateNode}I(f,ue,S)}break;case 5:var Le=f.stateNode;if(S===null&&f.flags&4){S=Le;var He=f.memoizedProps;switch(f.type){case"button":case"input":case"select":case"textarea":He.autoFocus&&S.focus();break;case"img":He.src&&(S.src=He.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(f.memoizedState===null){var gt=f.alternate;if(gt!==null){var Bt=gt.memoizedState;if(Bt!==null){var jt=Bt.dehydrated;jt!==null&&Xi(jt)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(t(163))}ro||f.flags&512&&Zc(f)}catch(Ot){Xr(f,f.return,Ot)}}if(f===c){un=null;break}if(S=f.sibling,S!==null){S.return=f.return,un=S;break}un=f.return}}function s_(c){for(;un!==null;){var f=un;if(f===c){un=null;break}var S=f.sibling;if(S!==null){S.return=f.return,un=S;break}un=f.return}}function sf(c){for(;un!==null;){var f=un;try{switch(f.tag){case 0:case 11:case 15:var S=f.return;try{fd(4,f)}catch(He){Xr(f,S,He)}break;case 1:var k=f.stateNode;if(typeof k.componentDidMount=="function"){var V=f.return;try{k.componentDidMount()}catch(He){Xr(f,V,He)}}var $=f.return;try{Zc(f)}catch(He){Xr(f,$,He)}break;case 5:var ue=f.return;try{Zc(f)}catch(He){Xr(f,ue,He)}}}catch(He){Xr(f,f.return,He)}if(f===c){un=null;break}var Le=f.sibling;if(Le!==null){Le.return=f.return,un=Le;break}un=f.return}}var a_=Math.ceil,_d=Ye.ReactCurrentDispatcher,af=Ye.ReactCurrentOwner,Na=Ye.ReactCurrentBatchConfig,Ci=0,Mo=null,Vr=null,qo=0,Oa=0,Nh=ka(0),Ur=0,np=null,ac=0,Wc=0,ip=0,rp=null,Fa=null,lf=0,Oh=1/0,lc=null,uf=!1,Fh=null,uc=null,cf=!1,Kc=null,hf=0,op=0,Cm=null,df=-1,sp=0;function fs(){return(Ci&6)!==0?Ki():df!==-1?df:df=Ki()}function cc(c){return(c.mode&1)===0?1:(Ci&2)!==0&&qo!==0?qo&-qo:ir.transition!==null?(sp===0&&(sp=ho()),sp):(c=_n,c!==0||(c=window.event,c=c===void 0?16:ei(c.type)),c)}function Ll(c,f,S,k){if(50<op)throw op=0,Cm=null,Error(t(185));eo(c,S,k),((Ci&2)===0||c!==Mo)&&(c===Mo&&((Ci&2)===0&&(Wc|=S),Ur===4&&Xc(c,qo)),ua(c,k),S===1&&Ci===0&&(f.mode&1)===0&&(Oh=Ki()+500,Th&&el()))}function ua(c,f){var S=c.callbackNode;Sr(c,f);var k=fi(c,c===Mo?qo:0);if(k===0)S!==null&&ul(S),c.callbackNode=null,c.callbackPriority=0;else if(f=k&-k,c.callbackPriority!==f){if(S!=null&&ul(S),f===1)c.tag===0?Hp(c_.bind(null,c)):Gd(c_.bind(null,c)),_o(function(){(Ci&6)===0&&el()}),S=null;else{switch(Ei(k)){case 1:S=cl;break;case 4:S=ns;break;case 16:S=is;break;case 536870912:S=hl;break;default:S=is}S=dc(S,l_.bind(null,c))}c.callbackPriority=f,c.callbackNode=S}}function l_(c,f){if(df=-1,sp=0,(Ci&6)!==0)throw Error(t(327));var S=c.callbackNode;if(xd()&&c.callbackNode!==S)return null;var k=fi(c,c===Mo?qo:0);if(k===0)return null;if((k&30)!==0||(k&c.expiredLanes)!==0||f)f=lp(c,k);else{f=k;var V=Ci;Ci|=2;var $=Rm();(Mo!==c||qo!==f)&&(lc=null,Oh=Ki()+500,Bh(c,f));do try{Lm();break}catch(Le){vd(c,Le)}while(!0);Ju(),_d.current=$,Ci=V,Vr!==null?f=0:(Mo=null,qo=0,f=Ur)}if(f!==0){if(f===2&&(V=ln(c),V!==0&&(k=V,f=yd(c,V))),f===1)throw S=np,Bh(c,0),Xc(c,k),ua(c,Ki()),S;if(f===6)Xc(c,k);else{if(V=c.current.alternate,(k&30)===0&&!u_(V)&&(f=lp(c,k),f===2&&($=ln(c),$!==0&&(k=$,f=yd(c,$))),f===1))throw S=np,Bh(c,0),Xc(c,k),ua(c,Ki()),S;switch(c.finishedWork=V,c.finishedLanes=k,f){case 0:case 1:throw Error(t(345));case 2:hc(c,Fa,lc);break;case 3:if(Xc(c,k),(k&130023424)===k&&(f=lf+500-Ki(),10<f)){if(fi(c,0)!==0)break;if(V=c.suspendedLanes,(V&k)!==k){fs(),c.pingedLanes|=c.suspendedLanes&V;break}c.timeoutHandle=Cr(hc.bind(null,c,Fa,lc),f);break}hc(c,Fa,lc);break;case 4:if(Xc(c,k),(k&4194240)===k)break;for(f=c.eventTimes,V=-1;0<k;){var ue=31-An(k);$=1<<ue,ue=f[ue],ue>V&&(V=ue),k&=~$}if(k=V,k=Ki()-k,k=(120>k?120:480>k?480:1080>k?1080:1920>k?1920:3e3>k?3e3:4320>k?4320:1960*a_(k/1960))-k,10<k){c.timeoutHandle=Cr(hc.bind(null,c,Fa,lc),k);break}hc(c,Fa,lc);break;case 5:hc(c,Fa,lc);break;default:throw Error(t(329))}}}return ua(c,Ki()),c.callbackNode===S?l_.bind(null,c):null}function yd(c,f){var S=rp;return c.current.memoizedState.isDehydrated&&(Bh(c,f).flags|=256),c=lp(c,f),c!==2&&(f=Fa,Fa=S,f!==null&&Am(f)),c}function Am(c){Fa===null?Fa=c:Fa.push.apply(Fa,c)}function u_(c){for(var f=c;;){if(f.flags&16384){var S=f.updateQueue;if(S!==null&&(S=S.stores,S!==null))for(var k=0;k<S.length;k++){var V=S[k],$=V.getSnapshot;V=V.value;try{if(!Ls($(),V))return!1}catch{return!1}}}if(S=f.child,f.subtreeFlags&16384&&S!==null)S.return=f,f=S;else{if(f===c)break;for(;f.sibling===null;){if(f.return===null||f.return===c)return!0;f=f.return}f.sibling.return=f.return,f=f.sibling}}return!0}function Xc(c,f){for(f&=~ip,f&=~Wc,c.suspendedLanes|=f,c.pingedLanes&=~f,c=c.expirationTimes;0<f;){var S=31-An(f),k=1<<S;c[S]=-1,f&=~k}}function c_(c){if((Ci&6)!==0)throw Error(t(327));xd();var f=fi(c,0);if((f&1)===0)return ua(c,Ki()),null;var S=lp(c,f);if(c.tag!==0&&S===2){var k=ln(c);k!==0&&(f=k,S=yd(c,k))}if(S===1)throw S=np,Bh(c,0),Xc(c,f),ua(c,Ki()),S;if(S===6)throw Error(t(345));return c.finishedWork=c.current.alternate,c.finishedLanes=f,hc(c,Fa,lc),ua(c,Ki()),null}function km(c,f){var S=Ci;Ci|=1;try{return c(f)}finally{Ci=S,Ci===0&&(Oh=Ki()+500,Th&&el())}}function Yc(c){Kc!==null&&Kc.tag===0&&(Ci&6)===0&&xd();var f=Ci;Ci|=1;var S=Na.transition,k=_n;try{if(Na.transition=null,_n=1,c)return c()}finally{_n=k,Na.transition=S,Ci=f,(Ci&6)===0&&el()}}function Mm(){Oa=Nh.current,hr(Nh)}function Bh(c,f){c.finishedWork=null,c.finishedLanes=0;var S=c.timeoutHandle;if(S!==-1&&(c.timeoutHandle=-1,Nr(S)),Vr!==null)for(S=Vr.return;S!==null;){var k=S;switch(Ph(k),k.tag){case 1:k=k.type.childContextTypes,k!=null&&wh();break;case 3:oe(),hr(Rr),hr(Mr),Re();break;case 5:we(k);break;case 4:oe();break;case 13:hr(ge);break;case 19:hr(ge);break;case 10:kh(k.type._context);break;case 22:case 23:Mm()}S=S.return}if(Mo=c,Vr=c=uu(c.current,null),qo=Oa=f,Ur=0,np=null,ip=Wc=ac=0,Fa=rp=null,Cl!==null){for(f=0;f<Cl.length;f++)if(S=Cl[f],k=S.interleaved,k!==null){S.interleaved=null;var V=k.next,$=S.pending;if($!==null){var ue=$.next;$.next=V,k.next=ue}S.pending=k}Cl=null}return c}function vd(c,f){do{var S=Vr;try{if(Ju(),ze.current=nc,yt){for(var k=Ne.memoizedState;k!==null;){var V=k.queue;V!==null&&(V.pending=null),k=k.next}yt=!1}if(Ve=0,Je=Qe=Ne=null,xt=!1,pt=0,af.current=null,S===null||S.return===null){Ur=1,np=f,Vr=null;break}e:{var $=c,ue=S.return,Le=S,He=f;if(f=qo,Le.flags|=32768,He!==null&&typeof He=="object"&&typeof He.then=="function"){var gt=He,Bt=Le,jt=Bt.tag;if((Bt.mode&1)===0&&(jt===0||jt===11||jt===15)){var Ot=Bt.alternate;Ot?(Bt.updateQueue=Ot.updateQueue,Bt.memoizedState=Ot.memoizedState,Bt.lanes=Ot.lanes):(Bt.updateQueue=null,Bt.memoizedState=null)}var an=Wg(ue);if(an!==null){an.flags&=-257,ym(an,ue,Le,$,f),an.mode&1&&Zg($,gt,f),f=an,He=gt;var yn=f.updateQueue;if(yn===null){var wn=new Set;wn.add(He),f.updateQueue=wn}else yn.add(He);break e}else{if((f&1)===0){Zg($,gt,f),ap();break e}He=Error(t(426))}}else if(Qi&&Le.mode&1){var so=Wg(ue);if(so!==null){(so.flags&65536)===0&&(so.flags|=256),ym(so,ue,Le,$,f),Qu(cd(He,Le));break e}}$=He=cd(He,Le),Ur!==4&&(Ur=2),rp===null?rp=[$]:rp.push($),$=ue;do{switch($.tag){case 3:$.flags|=65536,f&=-f,$.lanes|=f;var ot=gm($,He,f);y($,ot);break e;case 1:Le=He;var We=$.type,lt=$.stateNode;if(($.flags&128)===0&&(typeof We.getDerivedStateFromError=="function"||lt!==null&&typeof lt.componentDidCatch=="function"&&(uc===null||!uc.has(lt)))){$.flags|=65536,f&=-f,$.lanes|=f;var qt=_m($,Le,f);y($,qt);break e}}$=$.return}while($!==null)}Dm(S)}catch(bn){f=bn,Vr===S&&S!==null&&(Vr=S=S.return);continue}break}while(!0)}function Rm(){var c=_d.current;return _d.current=nc,c===null?nc:c}function ap(){(Ur===0||Ur===3||Ur===2)&&(Ur=4),Mo===null||(ac&268435455)===0&&(Wc&268435455)===0||Xc(Mo,qo)}function lp(c,f){var S=Ci;Ci|=2;var k=Rm();(Mo!==c||qo!==f)&&(lc=null,Bh(c,f));do try{oo();break}catch(V){vd(c,V)}while(!0);if(Ju(),Ci=S,_d.current=k,Vr!==null)throw Error(t(261));return Mo=null,qo=0,Ur}function oo(){for(;Vr!==null;)h_(Vr)}function Lm(){for(;Vr!==null&&!xa();)h_(Vr)}function h_(c){var f=Fm(c.alternate,c,Oa);c.memoizedProps=c.pendingProps,f===null?Dm(c):Vr=f,af.current=null}function Dm(c){var f=c;do{var S=f.alternate;if(c=f.return,(f.flags&32768)===0){if(S=ep(S,f,Oa),S!==null){Vr=S;return}}else{if(S=wv(S,f),S!==null){S.flags&=32767,Vr=S;return}if(c!==null)c.flags|=32768,c.subtreeFlags=0,c.deletions=null;else{Ur=6,Vr=null;return}}if(f=f.sibling,f!==null){Vr=f;return}Vr=f=c}while(f!==null);Ur===0&&(Ur=5)}function hc(c,f,S){var k=_n,V=Na.transition;try{Na.transition=null,_n=1,zm(c,f,S,k)}finally{Na.transition=V,_n=k}return null}function zm(c,f,S,k){do xd();while(Kc!==null);if((Ci&6)!==0)throw Error(t(327));S=c.finishedWork;var V=c.finishedLanes;if(S===null)return null;if(c.finishedWork=null,c.finishedLanes=0,S===c.current)throw Error(t(177));c.callbackNode=null,c.callbackPriority=0;var $=S.lanes|S.childLanes;if(On(c,$),c===Mo&&(Vr=Mo=null,qo=0),(S.subtreeFlags&2064)===0&&(S.flags&2064)===0||cf||(cf=!0,dc(is,function(){return xd(),null})),$=(S.flags&15990)!==0,(S.subtreeFlags&15990)!==0||$){$=Na.transition,Na.transition=null;var ue=_n;_n=1;var Le=Ci;Ci|=4,af.current=null,i_(c,S),Pm(S,c),cs(Sn),ss=!!tn,Sn=tn=null,c.current=S,bv(S),Es(),Ci=Le,_n=ue,Na.transition=$}else c.current=S;if(cf&&(cf=!1,Kc=c,hf=V),$=c.pendingLanes,$===0&&(uc=null),wa(S.stateNode),ua(c,Ki()),f!==null)for(k=c.onRecoverableError,S=0;S<f.length;S++)V=f[S],k(V.value,{componentStack:V.stack,digest:V.digest});if(uf)throw uf=!1,c=Fh,Fh=null,c;return(hf&1)!==0&&c.tag!==0&&xd(),$=c.pendingLanes,($&1)!==0?c===Cm?op++:(op=0,Cm=c):op=0,el(),null}function xd(){if(Kc!==null){var c=Ei(hf),f=Na.transition,S=_n;try{if(Na.transition=null,_n=16>c?16:c,Kc===null)var k=!1;else{if(c=Kc,Kc=null,hf=0,(Ci&6)!==0)throw Error(t(331));var V=Ci;for(Ci|=4,un=c.current;un!==null;){var $=un,ue=$.child;if((un.flags&16)!==0){var Le=$.deletions;if(Le!==null){for(var He=0;He<Le.length;He++){var gt=Le[He];for(un=gt;un!==null;){var Bt=un;switch(Bt.tag){case 0:case 11:case 15:oc(8,Bt,$)}var jt=Bt.child;if(jt!==null)jt.return=Bt,un=jt;else for(;un!==null;){Bt=un;var Ot=Bt.sibling,an=Bt.return;if(tp(Bt),Bt===gt){un=null;break}if(Ot!==null){Ot.return=an,un=Ot;break}un=an}}}var yn=$.alternate;if(yn!==null){var wn=yn.child;if(wn!==null){yn.child=null;do{var so=wn.sibling;wn.sibling=null,wn=so}while(wn!==null)}}un=$}}if(($.subtreeFlags&2064)!==0&&ue!==null)ue.return=$,un=ue;else e:for(;un!==null;){if($=un,($.flags&2048)!==0)switch($.tag){case 0:case 11:case 15:oc(9,$,$.return)}var ot=$.sibling;if(ot!==null){ot.return=$.return,un=ot;break e}un=$.return}}var We=c.current;for(un=We;un!==null;){ue=un;var lt=ue.child;if((ue.subtreeFlags&2064)!==0&&lt!==null)lt.return=ue,un=lt;else e:for(ue=We;un!==null;){if(Le=un,(Le.flags&2048)!==0)try{switch(Le.tag){case 0:case 11:case 15:fd(9,Le)}}catch(bn){Xr(Le,Le.return,bn)}if(Le===ue){un=null;break e}var qt=Le.sibling;if(qt!==null){qt.return=Le.return,un=qt;break e}un=Le.return}}if(Ci=V,el(),bo&&typeof bo.onPostCommitFiberRoot=="function")try{bo.onPostCommitFiberRoot(dl,c)}catch{}k=!0}return k}finally{_n=S,Na.transition=f}}return!1}function d_(c,f,S){f=cd(S,f),f=gm(c,f,1),c=s(c,f,1),f=fs(),c!==null&&(eo(c,1,f),ua(c,f))}function Xr(c,f,S){if(c.tag===3)d_(c,c,S);else for(;f!==null;){if(f.tag===3){d_(f,c,S);break}else if(f.tag===1){var k=f.stateNode;if(typeof f.type.getDerivedStateFromError=="function"||typeof k.componentDidCatch=="function"&&(uc===null||!uc.has(k))){c=cd(S,c),c=_m(f,c,1),f=s(f,c,1),c=fs(),f!==null&&(eo(f,1,c),ua(f,c));break}}f=f.return}}function Tv(c,f,S){var k=c.pingCache;k!==null&&k.delete(f),f=fs(),c.pingedLanes|=c.suspendedLanes&S,Mo===c&&(qo&S)===S&&(Ur===4||Ur===3&&(qo&130023424)===qo&&500>Ki()-lf?Bh(c,0):ip|=S),ua(c,f)}function Nm(c,f){f===0&&((c.mode&1)===0?f=1:(f=Zs,Zs<<=1,(Zs&130023424)===0&&(Zs=4194304)));var S=fs();c=nl(c,f),c!==null&&(eo(c,f,S),ua(c,S))}function ca(c){var f=c.memoizedState,S=0;f!==null&&(S=f.retryLane),Nm(c,S)}function Om(c,f){var S=0;switch(c.tag){case 13:var k=c.stateNode,V=c.memoizedState;V!==null&&(S=V.retryLane);break;case 19:k=c.stateNode;break;default:throw Error(t(314))}k!==null&&k.delete(f),Nm(c,S)}var Fm;Fm=function(c,f,S){if(c!==null)if(c.memoizedProps!==f.pendingProps||Rr.current)aa=!0;else{if((c.lanes&S)===0&&(f.flags&128)===0)return aa=!1,xv(c,f,S);aa=(c.flags&131072)!==0}else aa=!1,Qi&&(f.flags&1048576)!==0&&sd(f,Eh,f.index);switch(f.lanes=0,f.tag){case 2:var k=f.type;tf(c,f),c=f.pendingProps;var V=Xu(f,Mr.current);La(f,S),V=Ht(null,f,k,c,V,S);var $=Vn();return f.flags|=1,typeof V=="object"&&V!==null&&typeof V.render=="function"&&V.$$typeof===void 0?(f.tag=1,f.memoizedState=null,f.updateQueue=null,Kr(k)?($=!0,bh(f)):$=!1,f.memoizedState=V.state!==null&&V.state!==void 0?V.state:null,Mh(f),V.updater=Wp,f.stateNode=V,V._reactInternals=f,qc(f,k,c,S),f=xm(null,f,k,!0,$,S)):(f.tag=0,Qi&&$&&Ih(f),la(null,f,V,S),f=f.child),f;case 16:k=f.elementType;e:{switch(tf(c,f),c=f.pendingProps,V=k._init,k=V(k._payload),f.type=k,V=f.tag=ff(k),c=sa(k,c),V){case 0:f=Jp(null,f,k,c,S);break e;case 1:f=ef(null,f,k,c,S);break e;case 11:f=Yp(null,f,k,c,S);break e;case 14:f=vm(null,f,k,sa(k.type,c),S);break e}throw Error(t(306,k,""))}return f;case 0:return k=f.type,V=f.pendingProps,V=f.elementType===k?V:sa(k,V),Jp(c,f,k,V,S);case 1:return k=f.type,V=f.pendingProps,V=f.elementType===k?V:sa(k,V),ef(c,f,k,V,S);case 3:e:{if(wm(f),c===null)throw Error(t(387));k=f.pendingProps,$=f.memoizedState,V=$.element,w(c,f),b(f,k,null,S);var ue=f.memoizedState;if(k=ue.element,$.isDehydrated)if($={element:k,isDehydrated:!1,cache:ue.cache,pendingSuspenseBoundaries:ue.pendingSuspenseBoundaries,transitions:ue.transitions},f.updateQueue.baseState=$,f.memoizedState=$,f.flags&256){V=cd(Error(t(423)),f),f=Xg(c,f,k,S,V);break e}else if(k!==V){V=cd(Error(t(424)),f),f=Xg(c,f,k,S,V);break e}else for(Lr=Aa(f.stateNode.containerInfo.firstChild),jo=f,Qi=!0,rn=null,S=ad(f,null,k,S),f.child=S;S;)S.flags=S.flags&-3|4096,S=S.sibling;else{if(Uc(),k===V){f=ic(c,f,S);break e}la(c,f,k,S)}f=f.child}return f;case 5:return le(f),c===null&&Vc(f),k=f.type,V=f.pendingProps,$=c!==null?c.memoizedProps:null,ue=V.children,Gn(k,V)?ue=null:$!==null&&Gn(k,$)&&(f.flags|=32),za(c,f),la(c,f,ue,S),f.child;case 6:return c===null&&Vc(f),null;case 13:return Yg(c,f,S);case 4:return K(f,f.stateNode.containerInfo),k=f.pendingProps,c===null?f.child=ku(f,null,k,S):la(c,f,k,S),f.child;case 11:return k=f.type,V=f.pendingProps,V=f.elementType===k?V:sa(k,V),Yp(c,f,k,V,S);case 7:return la(c,f,f.pendingProps,S),f.child;case 8:return la(c,f,f.pendingProps.children,S),f.child;case 12:return la(c,f,f.pendingProps.children,S),f.child;case 10:e:{if(k=f.type._context,V=f.pendingProps,$=f.memoizedProps,ue=V.value,nr(Ra,k._currentValue),k._currentValue=ue,$!==null)if(Ls($.value,ue)){if($.children===V.children&&!Rr.current){f=ic(c,f,S);break e}}else for($=f.child,$!==null&&($.return=f);$!==null;){var Le=$.dependencies;if(Le!==null){ue=$.child;for(var He=Le.firstContext;He!==null;){if(He.context===k){if($.tag===1){He=n(-1,S&-S),He.tag=2;var gt=$.updateQueue;if(gt!==null){gt=gt.shared;var Bt=gt.pending;Bt===null?He.next=He:(He.next=Bt.next,Bt.next=He),gt.pending=He}}$.lanes|=S,He=$.alternate,He!==null&&(He.lanes|=S),Mu($.return,S,f),Le.lanes|=S;break}He=He.next}}else if($.tag===10)ue=$.type===f.type?null:$.child;else if($.tag===18){if(ue=$.return,ue===null)throw Error(t(341));ue.lanes|=S,Le=ue.alternate,Le!==null&&(Le.lanes|=S),Mu(ue,S,f),ue=$.sibling}else ue=$.child;if(ue!==null)ue.return=$;else for(ue=$;ue!==null;){if(ue===f){ue=null;break}if($=ue.sibling,$!==null){$.return=ue.return,ue=$;break}ue=ue.return}$=ue}la(c,f,V.children,S),f=f.child}return f;case 9:return V=f.type,k=f.pendingProps.children,La(f,S),V=Ns(V),k=k(V),f.flags|=1,la(c,f,k,S),f.child;case 14:return k=f.type,V=sa(k,f.pendingProps),V=sa(k.type,V),vm(c,f,k,V,S);case 15:return Qp(c,f,f.type,f.pendingProps,S);case 17:return k=f.type,V=f.pendingProps,V=f.elementType===k?V:sa(k,V),tf(c,f),f.tag=1,Kr(k)?(c=!0,bh(f)):c=!1,La(f,S),fm(f,k,V),qc(f,k,V,S),xm(null,f,k,!0,c,S);case 19:return Jg(c,f,S);case 22:return dd(c,f,S)}throw Error(t(156,f.tag))};function dc(c,f){return Gs(c,f)}function pf(c,f,S,k){this.tag=c,this.key=S,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=f,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=k,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Bs(c,f,S,k){return new pf(c,f,S,k)}function Qc(c){return c=c.prototype,!(!c||!c.isReactComponent)}function ff(c){if(typeof c=="function")return Qc(c)?1:0;if(c!=null){if(c=c.$$typeof,c===$e)return 11;if(c===ri)return 14}return 2}function uu(c,f){var S=c.alternate;return S===null?(S=Bs(c.tag,f,c.key,c.mode),S.elementType=c.elementType,S.type=c.type,S.stateNode=c.stateNode,S.alternate=c,c.alternate=S):(S.pendingProps=f,S.type=c.type,S.flags=0,S.subtreeFlags=0,S.deletions=null),S.flags=c.flags&14680064,S.childLanes=c.childLanes,S.lanes=c.lanes,S.child=c.child,S.memoizedProps=c.memoizedProps,S.memoizedState=c.memoizedState,S.updateQueue=c.updateQueue,f=c.dependencies,S.dependencies=f===null?null:{lanes:f.lanes,firstContext:f.firstContext},S.sibling=c.sibling,S.index=c.index,S.ref=c.ref,S}function mf(c,f,S,k,V,$){var ue=2;if(k=c,typeof c=="function")Qc(c)&&(ue=1);else if(typeof c=="string")ue=5;else e:switch(c){case be:return Vh(S.children,V,$,f);case te:ue=8,V|=8;break;case pe:return c=Bs(12,S,f,V|2),c.elementType=pe,c.lanes=$,c;case Ce:return c=Bs(13,S,f,V),c.elementType=Ce,c.lanes=$,c;case pn:return c=Bs(19,S,f,V),c.elementType=pn,c.lanes=$,c;case jn:return up(S,V,$,f);default:if(typeof c=="object"&&c!==null)switch(c.$$typeof){case xe:ue=10;break e;case Ae:ue=9;break e;case $e:ue=11;break e;case ri:ue=14;break e;case dn:ue=16,k=null;break e}throw Error(t(130,c==null?c:typeof c,""))}return f=Bs(ue,S,f,V),f.elementType=c,f.type=k,f.lanes=$,f}function Vh(c,f,S,k){return c=Bs(7,c,k,f),c.lanes=S,c}function up(c,f,S,k){return c=Bs(22,c,k,f),c.elementType=jn,c.lanes=S,c.stateNode={isHidden:!1},c}function gf(c,f,S){return c=Bs(6,c,null,f),c.lanes=S,c}function Bm(c,f,S){return f=Bs(4,c.children!==null?c.children:[],c.key,f),f.lanes=S,f.stateNode={containerInfo:c.containerInfo,pendingChildren:null,implementation:c.implementation},f}function p_(c,f,S,k,V){this.tag=f,this.containerInfo=c,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=kn(0),this.expirationTimes=kn(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=kn(0),this.identifierPrefix=k,this.onRecoverableError=V,this.mutableSourceEagerHydrationData=null}function _f(c,f,S,k,V,$,ue,Le,He){return c=new p_(c,f,S,Le,He),f===1?(f=1,$===!0&&(f|=8)):f=0,$=Bs(3,null,null,f),c.current=$,$.stateNode=c,$.memoizedState={element:k,isDehydrated:S,cache:null,transitions:null,pendingSuspenseBoundaries:null},Mh($),c}function Vm(c,f,S){var k=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:at,key:k==null?null:""+k,children:c,containerInfo:f,implementation:S}}function yf(c){if(!c)return iu;c=c._reactInternals;e:{if(Si(c)!==c||c.tag!==1)throw Error(t(170));var f=c;do{switch(f.tag){case 3:f=f.stateNode.context;break e;case 1:if(Kr(f.type)){f=f.stateNode.__reactInternalMemoizedMergedChildContext;break e}}f=f.return}while(f!==null);throw Error(t(171))}if(c.tag===1){var S=c.type;if(Kr(S))return ru(c,S,f)}return f}function f_(c,f,S,k,V,$,ue,Le,He){return c=_f(S,k,!0,c,V,$,ue,Le,He),c.context=yf(null),S=c.current,k=fs(),V=cc(S),$=n(k,V),$.callback=f??null,s(S,$,V),c.current.lanes=V,eo(c,V,k),ua(c,k),c}function cp(c,f,S,k){var V=f.current,$=fs(),ue=cc(V);return S=yf(S),f.context===null?f.context=S:f.pendingContext=S,f=n($,ue),f.payload={element:c},k=k===void 0?null:k,k!==null&&(f.callback=k),c=s(V,f,ue),c!==null&&(Ll(c,V,ue,$),m(c,V,ue)),ue}function vf(c){if(c=c.current,!c.child)return null;switch(c.child.tag){case 5:return c.child.stateNode;default:return c.child.stateNode}}function m_(c,f){if(c=c.memoizedState,c!==null&&c.dehydrated!==null){var S=c.retryLane;c.retryLane=S!==0&&S<f?S:f}}function Um(c,f){m_(c,f),(c=c.alternate)&&m_(c,f)}function Sv(){return null}var g_=typeof reportError=="function"?reportError:function(c){console.error(c)};function xf(c){this._internalRoot=c}hp.prototype.render=xf.prototype.render=function(c){var f=this._internalRoot;if(f===null)throw Error(t(409));cp(c,f,null,null)},hp.prototype.unmount=xf.prototype.unmount=function(){var c=this._internalRoot;if(c!==null){this._internalRoot=null;var f=c.containerInfo;Yc(function(){cp(null,c,null,null)}),f[Ni]=null}};function hp(c){this._internalRoot=c}hp.prototype.unstable_scheduleHydration=function(c){if(c){var f=Ir();c={blockedOn:null,target:c,priority:f};for(var S=0;S<Pr.length&&f!==0&&f<Pr[S].priority;S++);Pr.splice(S,0,c),S===0&&Wn(c)}};function Uh(c){return!(!c||c.nodeType!==1&&c.nodeType!==9&&c.nodeType!==11)}function rl(c){return!(!c||c.nodeType!==1&&c.nodeType!==9&&c.nodeType!==11&&(c.nodeType!==8||c.nodeValue!==" react-mount-point-unstable "))}function pc(){}function __(c,f,S,k,V){if(V){if(typeof k=="function"){var $=k;k=function(){var gt=vf(ue);$.call(gt)}}var ue=f_(f,k,c,0,null,!1,!1,"",pc);return c._reactRootContainer=ue,c[Ni]=ue.current,Sl(c.nodeType===8?c.parentNode:c),Yc(),ue}for(;V=c.lastChild;)c.removeChild(V);if(typeof k=="function"){var Le=k;k=function(){var gt=vf(He);Le.call(gt)}}var He=_f(c,0,!1,null,null,!1,!1,"",pc);return c._reactRootContainer=He,c[Ni]=He.current,Sl(c.nodeType===8?c.parentNode:c),Yc(function(){cp(f,He,S,k)}),He}function wd(c,f,S,k,V){var $=S._reactRootContainer;if($){var ue=$;if(typeof V=="function"){var Le=V;V=function(){var He=vf(ue);Le.call(He)}}cp(f,ue,c,V)}else ue=__(S,f,c,V,k);return vf(ue)}zi=function(c){switch(c.tag){case 3:var f=c.stateNode;if(f.current.memoizedState.isDehydrated){var S=Dn(f.pendingLanes);S!==0&&(Gr(f,S|1),ua(f,Ki()),(Ci&6)===0&&(Oh=Ki()+500,el()))}break;case 13:Yc(function(){var k=nl(c,1);if(k!==null){var V=fs();Ll(k,c,1,V)}}),Um(c,1)}},Is=function(c){if(c.tag===13){var f=nl(c,134217728);if(f!==null){var S=fs();Ll(f,c,134217728,S)}Um(c,134217728)}},Er=function(c){if(c.tag===13){var f=cc(c),S=nl(c,f);if(S!==null){var k=fs();Ll(S,c,f,k)}Um(c,f)}},Ir=function(){return _n},xr=function(c,f){var S=_n;try{return _n=c,f()}finally{_n=S}},Be=function(c,f,S){switch(f){case"input":if(Qr(c,S),f=S.name,S.type==="radio"&&f!=null){for(S=c;S.parentNode;)S=S.parentNode;for(S=S.querySelectorAll("input[name="+JSON.stringify(""+f)+'][type="radio"]'),f=0;f<S.length;f++){var k=S[f];if(k!==c&&k.form===c.form){var V=Uo(k);if(!V)throw Error(t(90));Ui(k),Qr(k,V)}}}break;case"textarea":_a(c,S);break;case"select":f=S.value,f!=null&&Jr(c,!!S.multiple,f,!1)}},Xe=km,Ue=Yc;var Ev={usingClientEntryPoint:!1,Events:[$i,Ds,Uo,ht,ut,km]},dp={findFiberByHostInstance:Ar,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},wf={bundleType:dp.bundleType,version:dp.version,rendererPackageName:dp.rendererPackageName,rendererConfig:dp.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Ye.ReactCurrentDispatcher,findHostInstanceByFiber:function(c){return c=Li(c),c===null?null:c.stateNode},findFiberByHostInstance:dp.findFiberByHostInstance||Sv,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var bd=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!bd.isDisabled&&bd.supportsFiber)try{dl=bd.inject(wf),bo=bd}catch{}}return Dl.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Ev,Dl.createPortal=function(c,f){var S=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Uh(f))throw Error(t(200));return Vm(c,f,null,S)},Dl.createRoot=function(c,f){if(!Uh(c))throw Error(t(299));var S=!1,k="",V=g_;return f!=null&&(f.unstable_strictMode===!0&&(S=!0),f.identifierPrefix!==void 0&&(k=f.identifierPrefix),f.onRecoverableError!==void 0&&(V=f.onRecoverableError)),f=_f(c,1,!1,null,null,S,!1,k,V),c[Ni]=f.current,Sl(c.nodeType===8?c.parentNode:c),new xf(f)},Dl.findDOMNode=function(c){if(c==null)return null;if(c.nodeType===1)return c;var f=c._reactInternals;if(f===void 0)throw typeof c.render=="function"?Error(t(188)):(c=Object.keys(c).join(","),Error(t(268,c)));return c=Li(f),c=c===null?null:c.stateNode,c},Dl.flushSync=function(c){return Yc(c)},Dl.hydrate=function(c,f,S){if(!rl(f))throw Error(t(200));return wd(null,c,f,!0,S)},Dl.hydrateRoot=function(c,f,S){if(!Uh(c))throw Error(t(405));var k=S!=null&&S.hydratedSources||null,V=!1,$="",ue=g_;if(S!=null&&(S.unstable_strictMode===!0&&(V=!0),S.identifierPrefix!==void 0&&($=S.identifierPrefix),S.onRecoverableError!==void 0&&(ue=S.onRecoverableError)),f=f_(f,null,c,1,S??null,V,!1,$,ue),c[Ni]=f.current,Sl(c),k)for(c=0;c<k.length;c++)S=k[c],V=S._getVersion,V=V(S._source),f.mutableSourceEagerHydrationData==null?f.mutableSourceEagerHydrationData=[S,V]:f.mutableSourceEagerHydrationData.push(S,V);return new hp(f)},Dl.render=function(c,f,S){if(!rl(f))throw Error(t(200));return wd(null,c,f,!1,S)},Dl.unmountComponentAtNode=function(c){if(!rl(c))throw Error(t(40));return c._reactRootContainer?(Yc(function(){wd(null,null,c,!1,function(){c._reactRootContainer=null,c[Ni]=null})}),!0):!1},Dl.unstable_batchedUpdates=km,Dl.unstable_renderSubtreeIntoContainer=function(c,f,S,k){if(!rl(S))throw Error(t(200));if(c==null||c._reactInternals===void 0)throw Error(t(38));return wd(c,f,S,!1,k)},Dl.version="18.3.1-next-f1338f8080-20240426",Dl}var mb;function zP(){if(mb)return Fv.exports;mb=1;function i(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(i)}catch(e){console.error(e)}}return i(),Fv.exports=DP(),Fv.exports}var gb;function NP(){if(gb)return S_;gb=1;var i=zP();return S_.createRoot=i.createRoot,S_.hydrateRoot=i.hydrateRoot,S_}var OP=NP();const FP=Rg(OP);var Gm={},_b;function BP(){if(_b)return Gm;_b=1,Object.defineProperty(Gm,"__esModule",{value:!0}),Gm.parse=_,Gm.serialize=O;const i=/^[\u0021-\u003A\u003C\u003E-\u007E]+$/,e=/^[\u0021-\u003A\u003C-\u007E]*$/,t=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,o=/^[\u0020-\u003A\u003D-\u007E]*$/,h=Object.prototype.toString,g=(()=>{const re=function(){};return re.prototype=Object.create(null),re})();function _(re,Q){const de=new g,Se=re.length;if(Se<2)return de;const De=Q?.decode||G;let Ke=0;do{const et=re.indexOf("=",Ke);if(et===-1)break;const vt=re.indexOf(";",Ke),Ye=vt===-1?Se:vt;if(et>Ye){Ke=re.lastIndexOf(";",et-1)+1;continue}const it=u(re,Ke,et),at=R(re,et,it),be=re.slice(it,at);if(de[be]===void 0){let te=u(re,et+1,Ye),pe=R(re,Ye,te);const xe=De(re.slice(te,pe));de[be]=xe}Ke=Ye+1}while(Ke<Se);return de}function u(re,Q,de){do{const Se=re.charCodeAt(Q);if(Se!==32&&Se!==9)return Q}while(++Q<de);return de}function R(re,Q,de){for(;Q>de;){const Se=re.charCodeAt(--Q);if(Se!==32&&Se!==9)return Q+1}return de}function O(re,Q,de){const Se=de?.encode||encodeURIComponent;if(!i.test(re))throw new TypeError(`argument name is invalid: ${re}`);const De=Se(Q);if(!e.test(De))throw new TypeError(`argument val is invalid: ${Q}`);let Ke=re+"="+De;if(!de)return Ke;if(de.maxAge!==void 0){if(!Number.isInteger(de.maxAge))throw new TypeError(`option maxAge is invalid: ${de.maxAge}`);Ke+="; Max-Age="+de.maxAge}if(de.domain){if(!t.test(de.domain))throw new TypeError(`option domain is invalid: ${de.domain}`);Ke+="; Domain="+de.domain}if(de.path){if(!o.test(de.path))throw new TypeError(`option path is invalid: ${de.path}`);Ke+="; Path="+de.path}if(de.expires){if(!ne(de.expires)||!Number.isFinite(de.expires.valueOf()))throw new TypeError(`option expires is invalid: ${de.expires}`);Ke+="; Expires="+de.expires.toUTCString()}if(de.httpOnly&&(Ke+="; HttpOnly"),de.secure&&(Ke+="; Secure"),de.partitioned&&(Ke+="; Partitioned"),de.priority)switch(typeof de.priority=="string"?de.priority.toLowerCase():void 0){case"low":Ke+="; Priority=Low";break;case"medium":Ke+="; Priority=Medium";break;case"high":Ke+="; Priority=High";break;default:throw new TypeError(`option priority is invalid: ${de.priority}`)}if(de.sameSite)switch(typeof de.sameSite=="string"?de.sameSite.toLowerCase():de.sameSite){case!0:case"strict":Ke+="; SameSite=Strict";break;case"lax":Ke+="; SameSite=Lax";break;case"none":Ke+="; SameSite=None";break;default:throw new TypeError(`option sameSite is invalid: ${de.sameSite}`)}return Ke}function G(re){if(re.indexOf("%")===-1)return re;try{return decodeURIComponent(re)}catch{return re}}function ne(re){return h.call(re)==="[object Date]"}return Gm}BP();var yb="popstate";function VP(i={}){function e(o,h){let{pathname:g,search:_,hash:u}=o.location;return m0("",{pathname:g,search:_,hash:u},h.state&&h.state.usr||null,h.state&&h.state.key||"default")}function t(o,h){return typeof h=="string"?h:mg(h)}return jP(e,t,null,i)}function ao(i,e){if(i===!1||i===null||typeof i>"u")throw new Error(e)}function dh(i,e){if(!i){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function UP(){return Math.random().toString(36).substring(2,10)}function vb(i,e){return{usr:i.state,key:i.key,idx:e}}function m0(i,e,t=null,o){return{pathname:typeof i=="string"?i:i.pathname,search:"",hash:"",...typeof e=="string"?nm(e):e,state:t,key:e&&e.key||o||UP()}}function mg({pathname:i="/",search:e="",hash:t=""}){return e&&e!=="?"&&(i+=e.charAt(0)==="?"?e:"?"+e),t&&t!=="#"&&(i+=t.charAt(0)==="#"?t:"#"+t),i}function nm(i){let e={};if(i){let t=i.indexOf("#");t>=0&&(e.hash=i.substring(t),i=i.substring(0,t));let o=i.indexOf("?");o>=0&&(e.search=i.substring(o),i=i.substring(0,o)),i&&(e.pathname=i)}return e}function jP(i,e,t,o={}){let{window:h=document.defaultView,v5Compat:g=!1}=o,_=h.history,u="POP",R=null,O=G();O==null&&(O=0,_.replaceState({..._.state,idx:O},""));function G(){return(_.state||{idx:null}).idx}function ne(){u="POP";let De=G(),Ke=De==null?null:De-O;O=De,R&&R({action:u,location:Se.location,delta:Ke})}function re(De,Ke){u="PUSH";let et=m0(Se.location,De,Ke);O=G()+1;let vt=vb(et,O),Ye=Se.createHref(et);try{_.pushState(vt,"",Ye)}catch(it){if(it instanceof DOMException&&it.name==="DataCloneError")throw it;h.location.assign(Ye)}g&&R&&R({action:u,location:Se.location,delta:1})}function Q(De,Ke){u="REPLACE";let et=m0(Se.location,De,Ke);O=G();let vt=vb(et,O),Ye=Se.createHref(et);_.replaceState(vt,"",Ye),g&&R&&R({action:u,location:Se.location,delta:0})}function de(De){return $P(De)}let Se={get action(){return u},get location(){return i(h,_)},listen(De){if(R)throw new Error("A history only accepts one active listener");return h.addEventListener(yb,ne),R=De,()=>{h.removeEventListener(yb,ne),R=null}},createHref(De){return e(h,De)},createURL:de,encodeLocation(De){let Ke=de(De);return{pathname:Ke.pathname,search:Ke.search,hash:Ke.hash}},push:re,replace:Q,go(De){return _.go(De)}};return Se}function $P(i,e=!1){let t="http://localhost";typeof window<"u"&&(t=window.location.origin!=="null"?window.location.origin:window.location.href),ao(t,"No window.location.(origin|href) available to create URL");let o=typeof i=="string"?i:mg(i);return o=o.replace(/ $/,"%20"),!e&&o.startsWith("//")&&(o=t+o),new URL(o,t)}function KT(i,e,t="/"){return HP(i,e,t,!1)}function HP(i,e,t,o){let h=typeof e=="string"?nm(e):e,g=Xh(h.pathname||"/",t);if(g==null)return null;let _=XT(i);qP(_);let u=null;for(let R=0;u==null&&R<_.length;++R){let O=nC(g);u=eC(_[R],O,o)}return u}function XT(i,e=[],t=[],o=""){let h=(g,_,u)=>{let R={relativePath:u===void 0?g.path||"":u,caseSensitive:g.caseSensitive===!0,childrenIndex:_,route:g};R.relativePath.startsWith("/")&&(ao(R.relativePath.startsWith(o),`Absolute route path "${R.relativePath}" nested under path "${o}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),R.relativePath=R.relativePath.slice(o.length));let O=Gh([o,R.relativePath]),G=t.concat(R);g.children&&g.children.length>0&&(ao(g.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${O}".`),XT(g.children,e,G,O)),!(g.path==null&&!g.index)&&e.push({path:O,score:QP(O,g.index),routesMeta:G})};return i.forEach((g,_)=>{if(g.path===""||!g.path?.includes("?"))h(g,_);else for(let u of YT(g.path))h(g,_,u)}),e}function YT(i){let e=i.split("/");if(e.length===0)return[];let[t,...o]=e,h=t.endsWith("?"),g=t.replace(/\?$/,"");if(o.length===0)return h?[g,""]:[g];let _=YT(o.join("/")),u=[];return u.push(..._.map(R=>R===""?g:[g,R].join("/"))),h&&u.push(..._),u.map(R=>i.startsWith("/")&&R===""?"/":R)}function qP(i){i.sort((e,t)=>e.score!==t.score?t.score-e.score:JP(e.routesMeta.map(o=>o.childrenIndex),t.routesMeta.map(o=>o.childrenIndex)))}var GP=/^:[\w-]+$/,ZP=3,WP=2,KP=1,XP=10,YP=-2,xb=i=>i==="*";function QP(i,e){let t=i.split("/"),o=t.length;return t.some(xb)&&(o+=YP),e&&(o+=WP),t.filter(h=>!xb(h)).reduce((h,g)=>h+(GP.test(g)?ZP:g===""?KP:XP),o)}function JP(i,e){return i.length===e.length&&i.slice(0,-1).every((o,h)=>o===e[h])?i[i.length-1]-e[e.length-1]:0}function eC(i,e,t=!1){let{routesMeta:o}=i,h={},g="/",_=[];for(let u=0;u<o.length;++u){let R=o[u],O=u===o.length-1,G=g==="/"?e:e.slice(g.length)||"/",ne=oy({path:R.relativePath,caseSensitive:R.caseSensitive,end:O},G),re=R.route;if(!ne&&O&&t&&!o[o.length-1].route.index&&(ne=oy({path:R.relativePath,caseSensitive:R.caseSensitive,end:!1},G)),!ne)return null;Object.assign(h,ne.params),_.push({params:h,pathname:Gh([g,ne.pathname]),pathnameBase:sC(Gh([g,ne.pathnameBase])),route:re}),ne.pathnameBase!=="/"&&(g=Gh([g,ne.pathnameBase]))}return _}function oy(i,e){typeof i=="string"&&(i={path:i,caseSensitive:!1,end:!0});let[t,o]=tC(i.path,i.caseSensitive,i.end),h=e.match(t);if(!h)return null;let g=h[0],_=g.replace(/(.)\/+$/,"$1"),u=h.slice(1);return{params:o.reduce((O,{paramName:G,isOptional:ne},re)=>{if(G==="*"){let de=u[re]||"";_=g.slice(0,g.length-de.length).replace(/(.)\/+$/,"$1")}const Q=u[re];return ne&&!Q?O[G]=void 0:O[G]=(Q||"").replace(/%2F/g,"/"),O},{}),pathname:g,pathnameBase:_,pattern:i}}function tC(i,e=!1,t=!0){dh(i==="*"||!i.endsWith("*")||i.endsWith("/*"),`Route path "${i}" will be treated as if it were "${i.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${i.replace(/\*$/,"/*")}".`);let o=[],h="^"+i.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(_,u,R)=>(o.push({paramName:u,isOptional:R!=null}),R?"/?([^\\/]+)?":"/([^\\/]+)"));return i.endsWith("*")?(o.push({paramName:"*"}),h+=i==="*"||i==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?h+="\\/*$":i!==""&&i!=="/"&&(h+="(?:(?=\\/|$))"),[new RegExp(h,e?void 0:"i"),o]}function nC(i){try{return i.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return dh(!1,`The URL path "${i}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),i}}function Xh(i,e){if(e==="/")return i;if(!i.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,o=i.charAt(t);return o&&o!=="/"?null:i.slice(t)||"/"}function iC(i,e="/"){let{pathname:t,search:o="",hash:h=""}=typeof i=="string"?nm(i):i;return{pathname:t?t.startsWith("/")?t:rC(t,e):e,search:aC(o),hash:lC(h)}}function rC(i,e){let t=e.replace(/\/+$/,"").split("/");return i.split("/").forEach(h=>{h===".."?t.length>1&&t.pop():h!=="."&&t.push(h)}),t.length>1?t.join("/"):"/"}function Uv(i,e,t,o){return`Cannot include a '${i}' character in a manually specified \`to.${e}\` field [${JSON.stringify(o)}].  Please separate it out to the \`to.${t}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function oC(i){return i.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function QT(i){let e=oC(i);return e.map((t,o)=>o===e.length-1?t.pathname:t.pathnameBase)}function JT(i,e,t,o=!1){let h;typeof i=="string"?h=nm(i):(h={...i},ao(!h.pathname||!h.pathname.includes("?"),Uv("?","pathname","search",h)),ao(!h.pathname||!h.pathname.includes("#"),Uv("#","pathname","hash",h)),ao(!h.search||!h.search.includes("#"),Uv("#","search","hash",h)));let g=i===""||h.pathname==="",_=g?"/":h.pathname,u;if(_==null)u=t;else{let ne=e.length-1;if(!o&&_.startsWith("..")){let re=_.split("/");for(;re[0]==="..";)re.shift(),ne-=1;h.pathname=re.join("/")}u=ne>=0?e[ne]:"/"}let R=iC(h,u),O=_&&_!=="/"&&_.endsWith("/"),G=(g||_===".")&&t.endsWith("/");return!R.pathname.endsWith("/")&&(O||G)&&(R.pathname+="/"),R}var Gh=i=>i.join("/").replace(/\/\/+/g,"/"),sC=i=>i.replace(/\/+$/,"").replace(/^\/*/,"/"),aC=i=>!i||i==="?"?"":i.startsWith("?")?i:"?"+i,lC=i=>!i||i==="#"?"":i.startsWith("#")?i:"#"+i;function uC(i){return i!=null&&typeof i.status=="number"&&typeof i.statusText=="string"&&typeof i.internal=="boolean"&&"data"in i}var e2=["POST","PUT","PATCH","DELETE"];new Set(e2);var cC=["GET",...e2];new Set(cC);var im=It.createContext(null);im.displayName="DataRouter";var Ny=It.createContext(null);Ny.displayName="DataRouterState";var t2=It.createContext({isTransitioning:!1});t2.displayName="ViewTransition";var hC=It.createContext(new Map);hC.displayName="Fetchers";var dC=It.createContext(null);dC.displayName="Await";var mh=It.createContext(null);mh.displayName="Navigation";var Lg=It.createContext(null);Lg.displayName="Location";var id=It.createContext({outlet:null,matches:[],isDataRoute:!1});id.displayName="Route";var tx=It.createContext(null);tx.displayName="RouteError";function pC(i,{relative:e}={}){ao(Dg(),"useHref() may be used only in the context of a <Router> component.");let{basename:t,navigator:o}=It.useContext(mh),{hash:h,pathname:g,search:_}=zg(i,{relative:e}),u=g;return t!=="/"&&(u=g==="/"?t:Gh([t,g])),o.createHref({pathname:u,search:_,hash:h})}function Dg(){return It.useContext(Lg)!=null}function Op(){return ao(Dg(),"useLocation() may be used only in the context of a <Router> component."),It.useContext(Lg).location}var n2="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function i2(i){It.useContext(mh).static||It.useLayoutEffect(i)}function r2(){let{isDataRoute:i}=It.useContext(id);return i?IC():fC()}function fC(){ao(Dg(),"useNavigate() may be used only in the context of a <Router> component.");let i=It.useContext(im),{basename:e,navigator:t}=It.useContext(mh),{matches:o}=It.useContext(id),{pathname:h}=Op(),g=JSON.stringify(QT(o)),_=It.useRef(!1);return i2(()=>{_.current=!0}),It.useCallback((R,O={})=>{if(dh(_.current,n2),!_.current)return;if(typeof R=="number"){t.go(R);return}let G=JT(R,JSON.parse(g),h,O.relative==="path");i==null&&e!=="/"&&(G.pathname=G.pathname==="/"?e:Gh([e,G.pathname])),(O.replace?t.replace:t.push)(G,O.state,O)},[e,t,g,h,i])}It.createContext(null);function zg(i,{relative:e}={}){let{matches:t}=It.useContext(id),{pathname:o}=Op(),h=JSON.stringify(QT(t));return It.useMemo(()=>JT(i,JSON.parse(h),o,e==="path"),[i,h,o,e])}function mC(i,e){return o2(i,e)}function o2(i,e,t,o){ao(Dg(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:h,static:g}=It.useContext(mh),{matches:_}=It.useContext(id),u=_[_.length-1],R=u?u.params:{},O=u?u.pathname:"/",G=u?u.pathnameBase:"/",ne=u&&u.route;{let et=ne&&ne.path||"";s2(O,!ne||et.endsWith("*")||et.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${O}" (under <Route path="${et}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${et}"> to <Route path="${et==="/"?"*":`${et}/*`}">.`)}let re=Op(),Q;if(e){let et=typeof e=="string"?nm(e):e;ao(G==="/"||et.pathname?.startsWith(G),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${G}" but pathname "${et.pathname}" was given in the \`location\` prop.`),Q=et}else Q=re;let de=Q.pathname||"/",Se=de;if(G!=="/"){let et=G.replace(/^\//,"").split("/");Se="/"+de.replace(/^\//,"").split("/").slice(et.length).join("/")}let De=!g&&t&&t.matches&&t.matches.length>0?t.matches:KT(i,{pathname:Se});dh(ne||De!=null,`No routes matched location "${Q.pathname}${Q.search}${Q.hash}" `),dh(De==null||De[De.length-1].route.element!==void 0||De[De.length-1].route.Component!==void 0||De[De.length-1].route.lazy!==void 0,`Matched leaf route at location "${Q.pathname}${Q.search}${Q.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let Ke=xC(De&&De.map(et=>Object.assign({},et,{params:Object.assign({},R,et.params),pathname:Gh([G,h.encodeLocation?h.encodeLocation(et.pathname).pathname:et.pathname]),pathnameBase:et.pathnameBase==="/"?G:Gh([G,h.encodeLocation?h.encodeLocation(et.pathnameBase).pathname:et.pathnameBase])})),_,t,o);return e&&Ke?It.createElement(Lg.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...Q},navigationType:"POP"}},Ke):Ke}function gC(){let i=EC(),e=uC(i)?`${i.status} ${i.statusText}`:i instanceof Error?i.message:JSON.stringify(i),t=i instanceof Error?i.stack:null,o="rgba(200,200,200, 0.5)",h={padding:"0.5rem",backgroundColor:o},g={padding:"2px 4px",backgroundColor:o},_=null;return console.error("Error handled by React Router default ErrorBoundary:",i),_=It.createElement(It.Fragment,null,It.createElement("p",null,"💿 Hey developer 👋"),It.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",It.createElement("code",{style:g},"ErrorBoundary")," or"," ",It.createElement("code",{style:g},"errorElement")," prop on your route.")),It.createElement(It.Fragment,null,It.createElement("h2",null,"Unexpected Application Error!"),It.createElement("h3",{style:{fontStyle:"italic"}},e),t?It.createElement("pre",{style:h},t):null,_)}var _C=It.createElement(gC,null),yC=class extends It.Component{constructor(i){super(i),this.state={location:i.location,revalidation:i.revalidation,error:i.error}}static getDerivedStateFromError(i){return{error:i}}static getDerivedStateFromProps(i,e){return e.location!==i.location||e.revalidation!=="idle"&&i.revalidation==="idle"?{error:i.error,location:i.location,revalidation:i.revalidation}:{error:i.error!==void 0?i.error:e.error,location:e.location,revalidation:i.revalidation||e.revalidation}}componentDidCatch(i,e){console.error("React Router caught the following error during render",i,e)}render(){return this.state.error!==void 0?It.createElement(id.Provider,{value:this.props.routeContext},It.createElement(tx.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function vC({routeContext:i,match:e,children:t}){let o=It.useContext(im);return o&&o.static&&o.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(o.staticContext._deepestRenderedBoundaryId=e.route.id),It.createElement(id.Provider,{value:i},t)}function xC(i,e=[],t=null,o=null){if(i==null){if(!t)return null;if(t.errors)i=t.matches;else if(e.length===0&&!t.initialized&&t.matches.length>0)i=t.matches;else return null}let h=i,g=t?.errors;if(g!=null){let R=h.findIndex(O=>O.route.id&&g?.[O.route.id]!==void 0);ao(R>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(g).join(",")}`),h=h.slice(0,Math.min(h.length,R+1))}let _=!1,u=-1;if(t)for(let R=0;R<h.length;R++){let O=h[R];if((O.route.HydrateFallback||O.route.hydrateFallbackElement)&&(u=R),O.route.id){let{loaderData:G,errors:ne}=t,re=O.route.loader&&!G.hasOwnProperty(O.route.id)&&(!ne||ne[O.route.id]===void 0);if(O.route.lazy||re){_=!0,u>=0?h=h.slice(0,u+1):h=[h[0]];break}}}return h.reduceRight((R,O,G)=>{let ne,re=!1,Q=null,de=null;t&&(ne=g&&O.route.id?g[O.route.id]:void 0,Q=O.route.errorElement||_C,_&&(u<0&&G===0?(s2("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),re=!0,de=null):u===G&&(re=!0,de=O.route.hydrateFallbackElement||null)));let Se=e.concat(h.slice(0,G+1)),De=()=>{let Ke;return ne?Ke=Q:re?Ke=de:O.route.Component?Ke=It.createElement(O.route.Component,null):O.route.element?Ke=O.route.element:Ke=R,It.createElement(vC,{match:O,routeContext:{outlet:R,matches:Se,isDataRoute:t!=null},children:Ke})};return t&&(O.route.ErrorBoundary||O.route.errorElement||G===0)?It.createElement(yC,{location:t.location,revalidation:t.revalidation,component:Q,error:ne,children:De(),routeContext:{outlet:null,matches:Se,isDataRoute:!0}}):De()},null)}function nx(i){return`${i} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function wC(i){let e=It.useContext(im);return ao(e,nx(i)),e}function bC(i){let e=It.useContext(Ny);return ao(e,nx(i)),e}function TC(i){let e=It.useContext(id);return ao(e,nx(i)),e}function ix(i){let e=TC(i),t=e.matches[e.matches.length-1];return ao(t.route.id,`${i} can only be used on routes that contain a unique "id"`),t.route.id}function SC(){return ix("useRouteId")}function EC(){let i=It.useContext(tx),e=bC("useRouteError"),t=ix("useRouteError");return i!==void 0?i:e.errors?.[t]}function IC(){let{router:i}=wC("useNavigate"),e=ix("useNavigate"),t=It.useRef(!1);return i2(()=>{t.current=!0}),It.useCallback(async(h,g={})=>{dh(t.current,n2),t.current&&(typeof h=="number"?i.navigate(h):await i.navigate(h,{fromRouteId:e,...g}))},[i,e])}var wb={};function s2(i,e,t){!e&&!wb[i]&&(wb[i]=!0,dh(!1,t))}It.memo(PC);function PC({routes:i,future:e,state:t}){return o2(i,void 0,t,e)}function Qm(i){ao(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function CC({basename:i="/",children:e=null,location:t,navigationType:o="POP",navigator:h,static:g=!1}){ao(!Dg(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let _=i.replace(/^\/*/,"/"),u=It.useMemo(()=>({basename:_,navigator:h,static:g,future:{}}),[_,h,g]);typeof t=="string"&&(t=nm(t));let{pathname:R="/",search:O="",hash:G="",state:ne=null,key:re="default"}=t,Q=It.useMemo(()=>{let de=Xh(R,_);return de==null?null:{location:{pathname:de,search:O,hash:G,state:ne,key:re},navigationType:o}},[_,R,O,G,ne,re,o]);return dh(Q!=null,`<Router basename="${_}"> is not able to match the URL "${R}${O}${G}" because it does not start with the basename, so the <Router> won't render anything.`),Q==null?null:It.createElement(mh.Provider,{value:u},It.createElement(Lg.Provider,{children:e,value:Q}))}function AC({children:i,location:e}){return mC(g0(i),e)}function g0(i,e=[]){let t=[];return It.Children.forEach(i,(o,h)=>{if(!It.isValidElement(o))return;let g=[...e,h];if(o.type===It.Fragment){t.push.apply(t,g0(o.props.children,g));return}ao(o.type===Qm,`[${typeof o.type=="string"?o.type:o.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),ao(!o.props.index||!o.props.children,"An index route cannot have child routes.");let _={id:o.props.id||g.join("-"),caseSensitive:o.props.caseSensitive,element:o.props.element,Component:o.props.Component,index:o.props.index,path:o.props.path,loader:o.props.loader,action:o.props.action,hydrateFallbackElement:o.props.hydrateFallbackElement,HydrateFallback:o.props.HydrateFallback,errorElement:o.props.errorElement,ErrorBoundary:o.props.ErrorBoundary,hasErrorBoundary:o.props.hasErrorBoundary===!0||o.props.ErrorBoundary!=null||o.props.errorElement!=null,shouldRevalidate:o.props.shouldRevalidate,handle:o.props.handle,lazy:o.props.lazy};o.props.children&&(_.children=g0(o.props.children,g)),t.push(_)}),t}var j_="get",$_="application/x-www-form-urlencoded";function Oy(i){return i!=null&&typeof i.tagName=="string"}function kC(i){return Oy(i)&&i.tagName.toLowerCase()==="button"}function MC(i){return Oy(i)&&i.tagName.toLowerCase()==="form"}function RC(i){return Oy(i)&&i.tagName.toLowerCase()==="input"}function LC(i){return!!(i.metaKey||i.altKey||i.ctrlKey||i.shiftKey)}function DC(i,e){return i.button===0&&(!e||e==="_self")&&!LC(i)}var E_=null;function zC(){if(E_===null)try{new FormData(document.createElement("form"),0),E_=!1}catch{E_=!0}return E_}var NC=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function jv(i){return i!=null&&!NC.has(i)?(dh(!1,`"${i}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${$_}"`),null):i}function OC(i,e){let t,o,h,g,_;if(MC(i)){let u=i.getAttribute("action");o=u?Xh(u,e):null,t=i.getAttribute("method")||j_,h=jv(i.getAttribute("enctype"))||$_,g=new FormData(i)}else if(kC(i)||RC(i)&&(i.type==="submit"||i.type==="image")){let u=i.form;if(u==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let R=i.getAttribute("formaction")||u.getAttribute("action");if(o=R?Xh(R,e):null,t=i.getAttribute("formmethod")||u.getAttribute("method")||j_,h=jv(i.getAttribute("formenctype"))||jv(u.getAttribute("enctype"))||$_,g=new FormData(u,i),!zC()){let{name:O,type:G,value:ne}=i;if(G==="image"){let re=O?`${O}.`:"";g.append(`${re}x`,"0"),g.append(`${re}y`,"0")}else O&&g.append(O,ne)}}else{if(Oy(i))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');t=j_,o=null,h=$_,_=i}return g&&h==="text/plain"&&(_=g,g=void 0),{action:o,method:t.toLowerCase(),encType:h,formData:g,body:_}}function rx(i,e){if(i===!1||i===null||typeof i>"u")throw new Error(e)}async function FC(i,e){if(i.id in e)return e[i.id];try{let t=await import(i.module);return e[i.id]=t,t}catch(t){return console.error(`Error loading route module \`${i.module}\`, reloading page...`),console.error(t),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function BC(i){return i==null?!1:i.href==null?i.rel==="preload"&&typeof i.imageSrcSet=="string"&&typeof i.imageSizes=="string":typeof i.rel=="string"&&typeof i.href=="string"}async function VC(i,e,t){let o=await Promise.all(i.map(async h=>{let g=e.routes[h.route.id];if(g){let _=await FC(g,t);return _.links?_.links():[]}return[]}));return HC(o.flat(1).filter(BC).filter(h=>h.rel==="stylesheet"||h.rel==="preload").map(h=>h.rel==="stylesheet"?{...h,rel:"prefetch",as:"style"}:{...h,rel:"prefetch"}))}function bb(i,e,t,o,h,g){let _=(R,O)=>t[O]?R.route.id!==t[O].route.id:!0,u=(R,O)=>t[O].pathname!==R.pathname||t[O].route.path?.endsWith("*")&&t[O].params["*"]!==R.params["*"];return g==="assets"?e.filter((R,O)=>_(R,O)||u(R,O)):g==="data"?e.filter((R,O)=>{let G=o.routes[R.route.id];if(!G||!G.hasLoader)return!1;if(_(R,O)||u(R,O))return!0;if(R.route.shouldRevalidate){let ne=R.route.shouldRevalidate({currentUrl:new URL(h.pathname+h.search+h.hash,window.origin),currentParams:t[0]?.params||{},nextUrl:new URL(i,window.origin),nextParams:R.params,defaultShouldRevalidate:!0});if(typeof ne=="boolean")return ne}return!0}):[]}function UC(i,e,{includeHydrateFallback:t}={}){return jC(i.map(o=>{let h=e.routes[o.route.id];if(!h)return[];let g=[h.module];return h.clientActionModule&&(g=g.concat(h.clientActionModule)),h.clientLoaderModule&&(g=g.concat(h.clientLoaderModule)),t&&h.hydrateFallbackModule&&(g=g.concat(h.hydrateFallbackModule)),h.imports&&(g=g.concat(h.imports)),g}).flat(1))}function jC(i){return[...new Set(i)]}function $C(i){let e={},t=Object.keys(i).sort();for(let o of t)e[o]=i[o];return e}function HC(i,e){let t=new Set;return new Set(e),i.reduce((o,h)=>{let g=JSON.stringify($C(h));return t.has(g)||(t.add(g),o.push({key:g,link:h})),o},[])}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var qC=new Set([100,101,204,205]);function GC(i,e){let t=typeof i=="string"?new URL(i,typeof window>"u"?"server://singlefetch/":window.location.origin):i;return t.pathname==="/"?t.pathname="_root.data":e&&Xh(t.pathname,e)==="/"?t.pathname=`${e.replace(/\/$/,"")}/_root.data`:t.pathname=`${t.pathname.replace(/\/$/,"")}.data`,t}function a2(){let i=It.useContext(im);return rx(i,"You must render this element inside a <DataRouterContext.Provider> element"),i}function ZC(){let i=It.useContext(Ny);return rx(i,"You must render this element inside a <DataRouterStateContext.Provider> element"),i}var ox=It.createContext(void 0);ox.displayName="FrameworkContext";function l2(){let i=It.useContext(ox);return rx(i,"You must render this element inside a <HydratedRouter> element"),i}function WC(i,e){let t=It.useContext(ox),[o,h]=It.useState(!1),[g,_]=It.useState(!1),{onFocus:u,onBlur:R,onMouseEnter:O,onMouseLeave:G,onTouchStart:ne}=e,re=It.useRef(null);It.useEffect(()=>{if(i==="render"&&_(!0),i==="viewport"){let Se=Ke=>{Ke.forEach(et=>{_(et.isIntersecting)})},De=new IntersectionObserver(Se,{threshold:.5});return re.current&&De.observe(re.current),()=>{De.disconnect()}}},[i]),It.useEffect(()=>{if(o){let Se=setTimeout(()=>{_(!0)},100);return()=>{clearTimeout(Se)}}},[o]);let Q=()=>{h(!0)},de=()=>{h(!1),_(!1)};return t?i!=="intent"?[g,re,{}]:[g,re,{onFocus:Zm(u,Q),onBlur:Zm(R,de),onMouseEnter:Zm(O,Q),onMouseLeave:Zm(G,de),onTouchStart:Zm(ne,Q)}]:[!1,re,{}]}function Zm(i,e){return t=>{i&&i(t),t.defaultPrevented||e(t)}}function KC({page:i,...e}){let{router:t}=a2(),o=It.useMemo(()=>KT(t.routes,i,t.basename),[t.routes,i,t.basename]);return o?It.createElement(YC,{page:i,matches:o,...e}):null}function XC(i){let{manifest:e,routeModules:t}=l2(),[o,h]=It.useState([]);return It.useEffect(()=>{let g=!1;return VC(i,e,t).then(_=>{g||h(_)}),()=>{g=!0}},[i,e,t]),o}function YC({page:i,matches:e,...t}){let o=Op(),{manifest:h,routeModules:g}=l2(),{basename:_}=a2(),{loaderData:u,matches:R}=ZC(),O=It.useMemo(()=>bb(i,e,R,h,o,"data"),[i,e,R,h,o]),G=It.useMemo(()=>bb(i,e,R,h,o,"assets"),[i,e,R,h,o]),ne=It.useMemo(()=>{if(i===o.pathname+o.search+o.hash)return[];let de=new Set,Se=!1;if(e.forEach(Ke=>{let et=h.routes[Ke.route.id];!et||!et.hasLoader||(!O.some(vt=>vt.route.id===Ke.route.id)&&Ke.route.id in u&&g[Ke.route.id]?.shouldRevalidate||et.hasClientLoader?Se=!0:de.add(Ke.route.id))}),de.size===0)return[];let De=GC(i,_);return Se&&de.size>0&&De.searchParams.set("_routes",e.filter(Ke=>de.has(Ke.route.id)).map(Ke=>Ke.route.id).join(",")),[De.pathname+De.search]},[_,u,o,h,O,e,i,g]),re=It.useMemo(()=>UC(G,h),[G,h]),Q=XC(G);return It.createElement(It.Fragment,null,ne.map(de=>It.createElement("link",{key:de,rel:"prefetch",as:"fetch",href:de,...t})),re.map(de=>It.createElement("link",{key:de,rel:"modulepreload",href:de,...t})),Q.map(({key:de,link:Se})=>It.createElement("link",{key:de,...Se})))}function QC(...i){return e=>{i.forEach(t=>{typeof t=="function"?t(e):t!=null&&(t.current=e)})}}var u2=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{u2&&(window.__reactRouterVersion="7.6.0")}catch{}function JC({basename:i,children:e,window:t}){let o=It.useRef();o.current==null&&(o.current=VP({window:t,v5Compat:!0}));let h=o.current,[g,_]=It.useState({action:h.action,location:h.location}),u=It.useCallback(R=>{It.startTransition(()=>_(R))},[_]);return It.useLayoutEffect(()=>h.listen(u),[h,u]),It.createElement(CC,{basename:i,children:e,location:g.location,navigationType:g.action,navigator:h})}var c2=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,h2=It.forwardRef(function({onClick:e,discover:t="render",prefetch:o="none",relative:h,reloadDocument:g,replace:_,state:u,target:R,to:O,preventScrollReset:G,viewTransition:ne,...re},Q){let{basename:de}=It.useContext(mh),Se=typeof O=="string"&&c2.test(O),De,Ke=!1;if(typeof O=="string"&&Se&&(De=O,u2))try{let pe=new URL(window.location.href),xe=O.startsWith("//")?new URL(pe.protocol+O):new URL(O),Ae=Xh(xe.pathname,de);xe.origin===pe.origin&&Ae!=null?O=Ae+xe.search+xe.hash:Ke=!0}catch{dh(!1,`<Link to="${O}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let et=pC(O,{relative:h}),[vt,Ye,it]=WC(o,re),at=iA(O,{replace:_,state:u,target:R,preventScrollReset:G,relative:h,viewTransition:ne});function be(pe){e&&e(pe),pe.defaultPrevented||at(pe)}let te=It.createElement("a",{...re,...it,href:De||et,onClick:Ke||g?e:be,ref:QC(Q,Ye),target:R,"data-discover":!Se&&t==="render"?"true":void 0});return vt&&!Se?It.createElement(It.Fragment,null,te,It.createElement(KC,{page:et})):te});h2.displayName="Link";var eA=It.forwardRef(function({"aria-current":e="page",caseSensitive:t=!1,className:o="",end:h=!1,style:g,to:_,viewTransition:u,children:R,...O},G){let ne=zg(_,{relative:O.relative}),re=Op(),Q=It.useContext(Ny),{navigator:de,basename:Se}=It.useContext(mh),De=Q!=null&&lA(ne)&&u===!0,Ke=de.encodeLocation?de.encodeLocation(ne).pathname:ne.pathname,et=re.pathname,vt=Q&&Q.navigation&&Q.navigation.location?Q.navigation.location.pathname:null;t||(et=et.toLowerCase(),vt=vt?vt.toLowerCase():null,Ke=Ke.toLowerCase()),vt&&Se&&(vt=Xh(vt,Se)||vt);const Ye=Ke!=="/"&&Ke.endsWith("/")?Ke.length-1:Ke.length;let it=et===Ke||!h&&et.startsWith(Ke)&&et.charAt(Ye)==="/",at=vt!=null&&(vt===Ke||!h&&vt.startsWith(Ke)&&vt.charAt(Ke.length)==="/"),be={isActive:it,isPending:at,isTransitioning:De},te=it?e:void 0,pe;typeof o=="function"?pe=o(be):pe=[o,it?"active":null,at?"pending":null,De?"transitioning":null].filter(Boolean).join(" ");let xe=typeof g=="function"?g(be):g;return It.createElement(h2,{...O,"aria-current":te,className:pe,ref:G,style:xe,to:_,viewTransition:u},typeof R=="function"?R(be):R)});eA.displayName="NavLink";var tA=It.forwardRef(({discover:i="render",fetcherKey:e,navigate:t,reloadDocument:o,replace:h,state:g,method:_=j_,action:u,onSubmit:R,relative:O,preventScrollReset:G,viewTransition:ne,...re},Q)=>{let de=sA(),Se=aA(u,{relative:O}),De=_.toLowerCase()==="get"?"get":"post",Ke=typeof u=="string"&&c2.test(u),et=vt=>{if(R&&R(vt),vt.defaultPrevented)return;vt.preventDefault();let Ye=vt.nativeEvent.submitter,it=Ye?.getAttribute("formmethod")||_;de(Ye||vt.currentTarget,{fetcherKey:e,method:it,navigate:t,replace:h,state:g,relative:O,preventScrollReset:G,viewTransition:ne})};return It.createElement("form",{ref:Q,method:De,action:Se,onSubmit:o?R:et,...re,"data-discover":!Ke&&i==="render"?"true":void 0})});tA.displayName="Form";function nA(i){return`${i} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function d2(i){let e=It.useContext(im);return ao(e,nA(i)),e}function iA(i,{target:e,replace:t,state:o,preventScrollReset:h,relative:g,viewTransition:_}={}){let u=r2(),R=Op(),O=zg(i,{relative:g});return It.useCallback(G=>{if(DC(G,e)){G.preventDefault();let ne=t!==void 0?t:mg(R)===mg(O);u(i,{replace:ne,state:o,preventScrollReset:h,relative:g,viewTransition:_})}},[R,u,O,t,o,e,i,h,g,_])}var rA=0,oA=()=>`__${String(++rA)}__`;function sA(){let{router:i}=d2("useSubmit"),{basename:e}=It.useContext(mh),t=SC();return It.useCallback(async(o,h={})=>{let{action:g,method:_,encType:u,formData:R,body:O}=OC(o,e);if(h.navigate===!1){let G=h.fetcherKey||oA();await i.fetch(G,t,h.action||g,{preventScrollReset:h.preventScrollReset,formData:R,body:O,formMethod:h.method||_,formEncType:h.encType||u,flushSync:h.flushSync})}else await i.navigate(h.action||g,{preventScrollReset:h.preventScrollReset,formData:R,body:O,formMethod:h.method||_,formEncType:h.encType||u,replace:h.replace,state:h.state,fromRouteId:t,flushSync:h.flushSync,viewTransition:h.viewTransition})},[i,e,t])}function aA(i,{relative:e}={}){let{basename:t}=It.useContext(mh),o=It.useContext(id);ao(o,"useFormAction must be used inside a RouteContext");let[h]=o.matches.slice(-1),g={...zg(i||".",{relative:e})},_=Op();if(i==null){g.search=_.search;let u=new URLSearchParams(g.search),R=u.getAll("index");if(R.some(G=>G==="")){u.delete("index"),R.filter(ne=>ne).forEach(ne=>u.append("index",ne));let G=u.toString();g.search=G?`?${G}`:""}}return(!i||i===".")&&h.route.index&&(g.search=g.search?g.search.replace(/^\?/,"?index&"):"?index"),t!=="/"&&(g.pathname=g.pathname==="/"?t:Gh([t,g.pathname])),mg(g)}function lA(i,e={}){let t=It.useContext(t2);ao(t!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:o}=d2("useViewTransitionState"),h=zg(i,{relative:e.relative});if(!t.isTransitioning)return!1;let g=Xh(t.currentLocation.pathname,o)||t.currentLocation.pathname,_=Xh(t.nextLocation.pathname,o)||t.nextLocation.pathname;return oy(h.pathname,_)!=null||oy(h.pathname,g)!=null}[...qC];const $v=[{name:"ACE",location:"Notre Dame",buildingType:"Academic Building"},{name:"Basilica",location:"Notre Dame",buildingType:"Academic Building"},{name:"Chem/Phys Library",location:"Notre Dame",buildingType:"Academic Building"},{name:"College of Engineering",location:"Notre Dame",buildingType:"Academic Building"},{name:"Corbett Family Hall",location:"Notre Dame",buildingType:"Academic Building"},{name:"DPAC",location:"Notre Dame",buildingType:"Academic Building"},{name:"DeBartolo",location:"Notre Dame",buildingType:"Academic Building"},{name:"Decio Faculty Hall",location:"Notre Dame",buildingType:"Academic Building"},{name:"ECDC",location:"Notre Dame",buildingType:"Academic Building"},{name:"Geddes Hall",location:"Notre Dame",buildingType:"Academic Building"},{name:"Grotto",location:"Notre Dame",buildingType:"Academic Building"},{name:"Hayes-Healy Center",location:"Notre Dame",buildingType:"Academic Building"},{name:"Hesburgh Library",location:"Notre Dame",buildingType:"Academic Building"},{name:"Holy Cross College",location:"Holy Cross",buildingType:"Academic Building"},{name:"Jordan Hall of Science",location:"Notre Dame",buildingType:"Academic Building"},{name:"Keough School",location:"Notre Dame",buildingType:"Academic Building"},{name:"Law School",location:"Notre Dame",buildingType:"Academic Building"},{name:"Library Lawn",location:"Notre Dame",buildingType:"Academic Building"},{name:"Loretto Church",location:"Saint Mary's",buildingType:"Academic Building"},{name:"Madeleva Hall",location:"Saint Mary's",buildingType:"Academic Building"},{name:"Main Building",location:"Notre Dame",buildingType:"Academic Building"},{name:"McCourtney Hall",location:"Notre Dame",buildingType:"Academic Building"},{name:"McGrath Institute",location:"Notre Dame",buildingType:"Academic Building"},{name:"Mendoza College",location:"Notre Dame",buildingType:"Academic Building"},{name:"Moreau Center for the Arts",location:"Saint Mary's",buildingType:"Academic Building"},{name:"Moreau Seminary Library",location:"Notre Dame",buildingType:"Academic Building"},{name:"Music Library",location:"Notre Dame",buildingType:"Academic Building"},{name:"Nieuwland Science Hall",location:"Notre Dame",buildingType:"Academic Building"},{name:"North Dome",location:"Notre Dame",buildingType:"Academic Building"},{name:"O'Neill Hall",location:"Notre Dame",buildingType:"Academic Building"},{name:"O'Shaughnessy Hall",location:"Notre Dame",buildingType:"Academic Building"},{name:"Raclin Murphy Museum",location:"Notre Dame",buildingType:"Academic Building"},{name:"Riley Hall of Art & Design",location:"Notre Dame",buildingType:"Academic Building"},{name:"SMC Library",location:"Saint Mary's",buildingType:"Academic Building"},{name:"School of Architecture",location:"Notre Dame",buildingType:"Academic Building"},{name:"Science Hall",location:"Saint Mary's",buildingType:"Academic Building"},{name:"St. Joseph Chapel",location:"Holy Cross",buildingType:"Academic Building"},{name:"The Graduate School",location:"Notre Dame",buildingType:"Academic Building"},{name:"Alumni Hall",location:"Notre Dame",buildingType:"Hall"},{name:"Anselm Hall",location:"Holy Cross",buildingType:"Hall"},{name:"Badin Hall",location:"Notre Dame",buildingType:"Hall"},{name:"Basil Hall",location:"Holy Cross",buildingType:"Hall"},{name:"Baumer Hall",location:"Notre Dame",buildingType:"Hall"},{name:"Breen-Phillips Hall",location:"Notre Dame",buildingType:"Hall"},{name:"Carroll Hall",location:"Notre Dame",buildingType:"Hall"},{name:"Cavanaugh Hall",location:"Notre Dame",buildingType:"Hall"},{name:"Dillon Hall",location:"Notre Dame",buildingType:"Hall"},{name:"Duncan Hall",location:"Notre Dame",buildingType:"Hall"},{name:"Dunne Hall",location:"Notre Dame",buildingType:"Hall"},{name:"East Hall",location:"Holy Cross",buildingType:"Hall"},{name:"Farley Hall",location:"Notre Dame",buildingType:"Hall"},{name:"Fischer Graduate Housing",location:"Notre Dame",buildingType:"Hall"},{name:"Fisher Hall",location:"Notre Dame",buildingType:"Hall"},{name:"Flaherty Hall",location:"Notre Dame",buildingType:"Hall"},{name:"Grace Hall",location:"Notre Dame",buildingType:"Hall"},{name:"Holy Cross Hall",location:"Saint Mary's",buildingType:"Hall"},{name:"Howard Hall",location:"Notre Dame",buildingType:"Hall"},{name:"James Hall",location:"Holy Cross",buildingType:"Hall"},{name:"Johnson Family",location:"Notre Dame",buildingType:"Hall"},{name:"Keenan Hall",location:"Notre Dame",buildingType:"Hall"},{name:"Keough Hall",location:"Notre Dame",buildingType:"Hall"},{name:"Knott Hall",location:"Notre Dame",buildingType:"Hall"},{name:"Le Mans Hall",location:"Saint Mary's",buildingType:"Hall"},{name:"Lewis Hall",location:"Notre Dame",buildingType:"Hall"},{name:"Lyons Hall",location:"Notre Dame",buildingType:"Hall"},{name:"McCandless Hall",location:"Saint Mary's",buildingType:"Hall"},{name:"McGlinn Hall",location:"Notre Dame",buildingType:"Hall"},{name:"Morrissey Hall",location:"Notre Dame",buildingType:"Hall"},{name:"North Hall",location:"Holy Cross",buildingType:"Hall"},{name:"O'Neill Family",location:"Notre Dame",buildingType:"Hall"},{name:"PE",location:"Notre Dame",buildingType:"Hall"},{name:"PW",location:"Notre Dame",buildingType:"Hall"},{name:"Pangborn Hall",location:"Notre Dame",buildingType:"Hall"},{name:"Pulde Hall",location:"Holy Cross",buildingType:"Hall"},{name:"Regina Hall",location:"Saint Mary's",buildingType:"Hall"},{name:"Ryan Hall",location:"Notre Dame",buildingType:"Hall"},{name:"Siegfried Hall",location:"Notre Dame",buildingType:"Hall"},{name:"Sorin Hall",location:"Notre Dame",buildingType:"Hall"},{name:"Spes Unica Hall",location:"Saint Mary's",buildingType:"Hall"},{name:"St Edwards Hall",location:"Notre Dame",buildingType:"Hall"},{name:"Stanford Hall",location:"Notre Dame",buildingType:"Hall"},{name:"University Village",location:"Notre Dame",buildingType:"Hall"},{name:"Walsh Hall",location:"Notre Dame",buildingType:"Hall"},{name:"Welsh Family",location:"Notre Dame",buildingType:"Hall"},{name:"Zahm Hall",location:"Notre Dame",buildingType:"Hall"},{name:"Angela Athletic Center",location:"Saint Mary's",buildingType:"Sports Facility"},{name:"Compton Arena",location:"Notre Dame",buildingType:"Sports Facility"},{name:"Pfeil Center",location:"Holy Cross",buildingType:"Sports Facility"},{name:"Purcell Pavilion",location:"Notre Dame",buildingType:"Sports Facility"},{name:"Rockne Memorial",location:"Notre Dame",buildingType:"Sports Facility"},{name:"Rolfs Aquatic Center",location:"Notre Dame",buildingType:"Sports Facility"},{name:"Rolfs Rec Center",location:"Notre Dame",buildingType:"Sports Facility"},{name:"Smith Center",location:"Notre Dame",buildingType:"Sports Facility"},{name:"Stadium",location:"Notre Dame",buildingType:"Sports Facility"},{name:"Cafe commons",location:"Notre Dame",buildingType:"Student Building"},{name:"Coleman-Morse",location:"Notre Dame",buildingType:"Student Building"},{name:"Computer Store",location:"Notre Dame",buildingType:"Student Building"},{name:"Duncan Center",location:"Notre Dame",buildingType:"Student Building"},{name:"Haggar Center",location:"Saint Mary's",buildingType:"Student Building"},{name:"Hammes Bookstore",location:"Notre Dame",buildingType:"Student Building"},{name:"LaFun",location:"Notre Dame",buildingType:"Student Building"},{name:"Legends",location:"Notre Dame",buildingType:"Student Building"},{name:"NDH",location:"Notre Dame",buildingType:"Student Building"},{name:"SDH",location:"Notre Dame",buildingType:"Student Building"},{name:"SMC Student Center",location:"Saint Mary's",buildingType:"Student Building"},{name:"Traditions",location:"Notre Dame",buildingType:"Student Building"},{name:"UHS",location:"Notre Dame",buildingType:"Student Building"},{name:"Undergraduate Admissions",location:"Notre Dame",buildingType:"Student Building"},{name:"Vincent Hall",location:"Holy Cross",buildingType:"Student Building"}].sort((i,e)=>i.buildingType!==e.buildingType?i.buildingType.localeCompare(e.buildingType):i.name.localeCompare(e.name)),Jm=[{name:"ACE",latitude:41.7036684,longitude:-86.2398665,location:"Notre Dame",buildingType:"Academic Building"},{name:"Basilica",latitude:41.7026336,longitude:-86.2397856,location:"Notre Dame",buildingType:"Academic Building"},{name:"Chem/Phys Library",latitude:41.7015402,longitude:-86.2366507,location:"Notre Dame",buildingType:"Academic Building"},{name:"College of Engineering",latitude:41.699234,longitude:-86.23695,location:"Notre Dame",buildingType:"Academic Building"},{name:"Corbett Family Hall",latitude:41.699192,longitude:-86.234851,location:"Notre Dame",buildingType:"Academic Building"},{name:"DPAC",latitude:41.694799,longitude:-86.236694,location:"Notre Dame",buildingType:"Academic Building"},{name:"DeBartolo",latitude:41.6982522,longitude:-86.2362484,location:"Notre Dame",buildingType:"Academic Building"},{name:"Decio Faculty Hall",latitude:41.700545,longitude:-86.235967,location:"Notre Dame",buildingType:"Academic Building"},{name:"ECDC",latitude:41.7036642,longitude:-86.2297151,location:"Notre Dame",buildingType:"Academic Building"},{name:"Geddes Hall",latitude:41.702441,longitude:-86.237894,location:"Notre Dame",buildingType:"Academic Building"},{name:"Grotto",latitude:41.7030868,longitude:-86.2403638,location:"Notre Dame",buildingType:"Academic Building"},{name:"Hayes-Healy Center",latitude:41.700344,longitude:-86.236814,location:"Notre Dame",buildingType:"Academic Building"},{name:"Hesburgh Library",latitude:41.7023892,longitude:-86.2341526,location:"Notre Dame",buildingType:"Academic Building"},{name:"Holy Cross College",latitude:41.7000923,longitude:-86.2537078,location:"Holy Cross",buildingType:"Academic Building"},{name:"Jordan Hall of Science",latitude:41.700685,longitude:-86.233075,location:"Notre Dame",buildingType:"Academic Building"},{name:"Keough School",latitude:41.6958104,longitude:-86.2377301,location:"Notre Dame",buildingType:"Academic Building"},{name:"Law School",latitude:41.698379,longitude:-86.23863,location:"Notre Dame",buildingType:"Academic Building"},{name:"Library Lawn",latitude:41.7014918,longitude:-86.2340728,location:"Notre Dame",buildingType:"Academic Building"},{name:"Loretto Church",latitude:41.7046872,longitude:-86.2605608,location:"Saint Mary's",buildingType:"Academic Building"},{name:"Madeleva Hall",latitude:41.705886,longitude:-86.256846,location:"Saint Mary's",buildingType:"Academic Building"},{name:"Main Building",latitude:41.7030267,longitude:-86.2390726,location:"Notre Dame",buildingType:"Academic Building"},{name:"McCourtney Hall",latitude:41.700684,longitude:-86.22997,location:"Notre Dame",buildingType:"Academic Building"},{name:"McGrath Institute",latitude:41.7028431,longitude:-86.2353977,location:"Notre Dame",buildingType:"Academic Building"},{name:"Mendoza College",latitude:41.6971637,longitude:-86.2360776,location:"Notre Dame",buildingType:"Academic Building"},{name:"Moreau Center for the Arts",latitude:41.707328,longitude:-86.254347,location:"Saint Mary's",buildingType:"Academic Building"},{name:"Moreau Seminary Library",latitude:41.7075309,longitude:-86.2413558,location:"Notre Dame",buildingType:"Academic Building"},{name:"Music Library",latitude:41.6972441,longitude:-86.2338908,location:"Notre Dame",buildingType:"Academic Building"},{name:"Nieuwland Science Hall",latitude:41.70087,longitude:-86.237494,location:"Notre Dame",buildingType:"Academic Building"},{name:"North Dome",latitude:41.6989078,longitude:-86.2313753,location:"Notre Dame",buildingType:"Academic Building"},{name:"O'Neill Hall",latitude:41.6972107,longitude:-86.2339136,location:"Notre Dame",buildingType:"Academic Building"},{name:"O'Shaughnessy Hall",latitude:41.700552,longitude:-86.238127,location:"Notre Dame",buildingType:"Academic Building"},{name:"Raclin Murphy Museum",latitude:41.6938488,longitude:-86.2348584,location:"Notre Dame",buildingType:"Academic Building"},{name:"Riley Hall of Art & Design",latitude:41.69966,longitude:-86.23871,location:"Notre Dame",buildingType:"Academic Building"},{name:"SMC Library",latitude:41.707718,longitude:-86.257523,location:"Saint Mary's",buildingType:"Academic Building"},{name:"School of Architecture",latitude:41.700344,longitude:-86.239272,location:"Notre Dame",buildingType:"Academic Building"},{name:"Science Hall",latitude:41.7082933,longitude:-86.2554595,location:"Saint Mary's",buildingType:"Academic Building"},{name:"St. Joseph Chapel",latitude:41.6999412,longitude:-86.2532049,location:"Holy Cross",buildingType:"Academic Building"},{name:"The Graduate School",latitude:41.70518,longitude:-86.23395,location:"Notre Dame",buildingType:"Academic Building"},{name:"Alumni Hall",latitude:41.699565,longitude:-86.241211,location:"Notre Dame",buildingType:"Hall"},{name:"Anselm Hall",latitude:41.698822,longitude:-86.255959,location:"Holy Cross",buildingType:"Hall"},{name:"Badin Hall",latitude:41.700688,longitude:-86.241771,location:"Notre Dame",buildingType:"Hall"},{name:"Basil Hall",latitude:41.699042,longitude:-86.254885,location:"Holy Cross",buildingType:"Hall"},{name:"Baumer Hall",latitude:41.6970819,longitude:-86.2413698,location:"Notre Dame",buildingType:"Hall"},{name:"Breen-Phillips Hall",latitude:41.703759,longitude:-86.236848,location:"Notre Dame",buildingType:"Hall"},{name:"Carroll Hall",latitude:41.702733,longitude:-86.232915,location:"Notre Dame",buildingType:"Hall"},{name:"Cavanaugh Hall",latitude:41.703495,longitude:-86.237497,location:"Notre Dame",buildingType:"Hall"},{name:"Dillon Hall",latitude:41.699742,longitude:-86.24086,location:"Notre Dame",buildingType:"Hall"},{name:"Duncan Hall",latitude:41.697909,longitude:-86.2433368,location:"Notre Dame",buildingType:"Hall"},{name:"Dunne Hall",latitude:41.7045274,longitude:-86.2329434,location:"Notre Dame",buildingType:"Hall"},{name:"East Hall",latitude:41.698375,longitude:-86.252623,location:"Holy Cross",buildingType:"Hall"},{name:"Farley Hall",latitude:41.7036468,longitude:-86.2361456,location:"Notre Dame",buildingType:"Hall"},{name:"Fischer Graduate Housing",latitude:41.7051242,longitude:-86.229011,location:"Notre Dame",buildingType:"Hall"},{name:"Fisher Hall",latitude:41.699268,longitude:-86.242784,location:"Notre Dame",buildingType:"Hall"},{name:"Flaherty Hall",latitude:41.7034216,longitude:-86.2329018,location:"Notre Dame",buildingType:"Hall"},{name:"Grace Hall",latitude:41.7048337,longitude:-86.2339312,location:"Notre Dame",buildingType:"Hall"},{name:"Holy Cross Hall",latitude:41.705701,longitude:-86.259293,location:"Saint Mary's",buildingType:"Hall"},{name:"Howard Hall",latitude:41.7007478,longitude:-86.2418234,location:"Notre Dame",buildingType:"Hall"},{name:"James Hall",latitude:41.699569,longitude:-86.255866,location:"Holy Cross",buildingType:"Hall"},{name:"Johnson Family",latitude:41.7051344,longitude:-86.2322357,location:"Notre Dame",buildingType:"Hall"},{name:"Keenan Hall",latitude:41.7042013,longitude:-86.2373552,location:"Notre Dame",buildingType:"Hall"},{name:"Keough Hall",latitude:41.6980119,longitude:-86.2410978,location:"Notre Dame",buildingType:"Hall"},{name:"Knott Hall",latitude:41.703816,longitude:-86.233827,location:"Notre Dame",buildingType:"Hall"},{name:"Le Mans Hall",latitude:41.706798,longitude:-86.257512,location:"Saint Mary's",buildingType:"Hall"},{name:"Lewis Hall",latitude:41.7044552,longitude:-86.2396082,location:"Notre Dame",buildingType:"Hall"},{name:"Lyons Hall",latitude:41.7007967,longitude:-86.2434023,location:"Notre Dame",buildingType:"Hall"},{name:"McCandless Hall",latitude:41.7088424,longitude:-86.2580949,location:"Saint Mary's",buildingType:"Hall"},{name:"McGlinn Hall",latitude:41.697486,longitude:-86.240728,location:"Notre Dame",buildingType:"Hall"},{name:"Morrissey Hall",latitude:41.7009489,longitude:-86.24263,location:"Notre Dame",buildingType:"Hall"},{name:"North Hall",latitude:41.698944,longitude:-86.252994,location:"Holy Cross",buildingType:"Hall"},{name:"O'Neill Family",latitude:41.69806,longitude:-86.242296,location:"Notre Dame",buildingType:"Hall"},{name:"PE",latitude:41.703666,longitude:-86.234408,location:"Notre Dame",buildingType:"Hall"},{name:"PW",latitude:41.7038431,longitude:-86.2349545,location:"Notre Dame",buildingType:"Hall"},{name:"Pangborn Hall",latitude:41.69917,longitude:-86.243574,location:"Notre Dame",buildingType:"Hall"},{name:"Pulde Hall",latitude:41.699268,longitude:-86.253011,location:"Holy Cross",buildingType:"Hall"},{name:"Regina Hall",latitude:41.707091,longitude:-86.260365,location:"Saint Mary's",buildingType:"Hall"},{name:"Ryan Hall",latitude:41.697321,longitude:-86.2401144,location:"Notre Dame",buildingType:"Hall"},{name:"Siegfried Hall",latitude:41.703517,longitude:-86.2349108,location:"Notre Dame",buildingType:"Hall"},{name:"Sorin Hall",latitude:41.702334,longitude:-86.240366,location:"Notre Dame",buildingType:"Hall"},{name:"Spes Unica Hall",latitude:41.7082812,longitude:-86.2542048,location:"Saint Mary's",buildingType:"Hall"},{name:"St Edwards Hall",latitude:41.703349,longitude:-86.2381985,location:"Notre Dame",buildingType:"Hall"},{name:"Stanford Hall",latitude:41.704471,longitude:-86.2374673,location:"Notre Dame",buildingType:"Hall"},{name:"University Village",latitude:41.7123537,longitude:-86.2481859,location:"Notre Dame",buildingType:"Hall"},{name:"Walsh Hall",latitude:41.701149,longitude:-86.240685,location:"Notre Dame",buildingType:"Hall"},{name:"Welsh Family",latitude:41.698092,longitude:-86.2403468,location:"Notre Dame",buildingType:"Hall"},{name:"Zahm Hall",latitude:41.703272,longitude:-86.238865,location:"Notre Dame",buildingType:"Hall"},{name:"Angela Athletic Center",latitude:41.7099386,longitude:-86.2569961,location:"Saint Mary's",buildingType:"Sports Facility"},{name:"Compton Arena",latitude:41.695786,longitude:-86.231263,location:"Notre Dame",buildingType:"Sports Facility"},{name:"Pfeil Center",latitude:41.6979537,longitude:-86.2548825,location:"Holy Cross",buildingType:"Sports Facility"},{name:"Purcell Pavilion",latitude:41.6978278,longitude:-86.2313079,location:"Notre Dame",buildingType:"Sports Facility"},{name:"Rockne Memorial",latitude:41.701191,longitude:-86.244719,location:"Notre Dame",buildingType:"Sports Facility"},{name:"Rolfs Aquatic Center",latitude:41.6985583,longitude:-86.2302632,location:"Notre Dame",buildingType:"Sports Facility"},{name:"Rolfs Rec Center",latitude:41.697693,longitude:-86.244675,location:"Notre Dame",buildingType:"Sports Facility"},{name:"Smith Center",latitude:41.6984522,longitude:-86.2347681,location:"Notre Dame",buildingType:"Sports Facility"},{name:"Stadium",latitude:41.6983981,longitude:-86.233916,location:"Notre Dame",buildingType:"Sports Facility"},{name:"Cafe commons",latitude:41.7056815,longitude:-86.2353447,location:"Notre Dame",buildingType:"Student Building"},{name:"Coleman-Morse",latitude:41.700941,longitude:-86.240213,location:"Notre Dame",buildingType:"Student Building"},{name:"Computer Store",latitude:41.69635,longitude:-86.2399734,location:"Notre Dame",buildingType:"Student Building"},{name:"Duncan Center",latitude:41.699042,longitude:-86.232936,location:"Notre Dame",buildingType:"Student Building"},{name:"Haggar Center",latitude:41.7074603,longitude:-86.2556776,location:"Saint Mary's",buildingType:"Student Building"},{name:"Hammes Bookstore",latitude:41.696401,longitude:-86.2397479,location:"Notre Dame",buildingType:"Student Building"},{name:"LaFun",latitude:41.7018394,longitude:-86.2374841,location:"Notre Dame",buildingType:"Student Building"},{name:"Legends",latitude:41.6961149,longitude:-86.2349385,location:"Notre Dame",buildingType:"Student Building"},{name:"NDH",latitude:41.7043644,longitude:-86.2360824,location:"Notre Dame",buildingType:"Student Building"},{name:"SDH",latitude:41.699728,longitude:-86.2414702,location:"Notre Dame",buildingType:"Student Building"},{name:"SMC Student Center",latitude:41.7081947,longitude:-86.258363,location:"Saint Mary's",buildingType:"Student Building"},{name:"Traditions",latitude:41.6924119,longitude:-86.2334396,location:"Notre Dame",buildingType:"Student Building"},{name:"UHS",latitude:41.7043474,longitude:-86.2381191,location:"Notre Dame",buildingType:"Student Building"},{name:"Undergraduate Admissions",latitude:41.6981031,longitude:-86.2379327,location:"Notre Dame",buildingType:"Student Building"},{name:"Vincent Hall",latitude:41.69907,longitude:-86.253946,location:"Holy Cross",buildingType:"Student Building"}].sort((i,e)=>i.buildingType!==e.buildingType?i.buildingType.localeCompare(e.buildingType):i.name.localeCompare(e.name));var Tb={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const p2=function(i){const e=[];let t=0;for(let o=0;o<i.length;o++){let h=i.charCodeAt(o);h<128?e[t++]=h:h<2048?(e[t++]=h>>6|192,e[t++]=h&63|128):(h&64512)===55296&&o+1<i.length&&(i.charCodeAt(o+1)&64512)===56320?(h=65536+((h&1023)<<10)+(i.charCodeAt(++o)&1023),e[t++]=h>>18|240,e[t++]=h>>12&63|128,e[t++]=h>>6&63|128,e[t++]=h&63|128):(e[t++]=h>>12|224,e[t++]=h>>6&63|128,e[t++]=h&63|128)}return e},uA=function(i){const e=[];let t=0,o=0;for(;t<i.length;){const h=i[t++];if(h<128)e[o++]=String.fromCharCode(h);else if(h>191&&h<224){const g=i[t++];e[o++]=String.fromCharCode((h&31)<<6|g&63)}else if(h>239&&h<365){const g=i[t++],_=i[t++],u=i[t++],R=((h&7)<<18|(g&63)<<12|(_&63)<<6|u&63)-65536;e[o++]=String.fromCharCode(55296+(R>>10)),e[o++]=String.fromCharCode(56320+(R&1023))}else{const g=i[t++],_=i[t++];e[o++]=String.fromCharCode((h&15)<<12|(g&63)<<6|_&63)}}return e.join("")},f2={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(i,e){if(!Array.isArray(i))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,o=[];for(let h=0;h<i.length;h+=3){const g=i[h],_=h+1<i.length,u=_?i[h+1]:0,R=h+2<i.length,O=R?i[h+2]:0,G=g>>2,ne=(g&3)<<4|u>>4;let re=(u&15)<<2|O>>6,Q=O&63;R||(Q=64,_||(re=64)),o.push(t[G],t[ne],t[re],t[Q])}return o.join("")},encodeString(i,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(i):this.encodeByteArray(p2(i),e)},decodeString(i,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(i):uA(this.decodeStringToByteArray(i,e))},decodeStringToByteArray(i,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,o=[];for(let h=0;h<i.length;){const g=t[i.charAt(h++)],u=h<i.length?t[i.charAt(h)]:0;++h;const O=h<i.length?t[i.charAt(h)]:64;++h;const ne=h<i.length?t[i.charAt(h)]:64;if(++h,g==null||u==null||O==null||ne==null)throw new cA;const re=g<<2|u>>4;if(o.push(re),O!==64){const Q=u<<4&240|O>>2;if(o.push(Q),ne!==64){const de=O<<6&192|ne;o.push(de)}}}return o},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let i=0;i<this.ENCODED_VALS.length;i++)this.byteToCharMap_[i]=this.ENCODED_VALS.charAt(i),this.charToByteMap_[this.byteToCharMap_[i]]=i,this.byteToCharMapWebSafe_[i]=this.ENCODED_VALS_WEBSAFE.charAt(i),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[i]]=i,i>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(i)]=i,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(i)]=i)}}};class cA extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const hA=function(i){const e=p2(i);return f2.encodeByteArray(e,!0)},sy=function(i){return hA(i).replace(/\./g,"")},m2=function(i){try{return f2.decodeString(i,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dA(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pA=()=>dA().__FIREBASE_DEFAULTS__,fA=()=>{if(typeof process>"u"||typeof Tb>"u")return;const i=Tb.__FIREBASE_DEFAULTS__;if(i)return JSON.parse(i)},mA=()=>{if(typeof document>"u")return;let i;try{i=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=i&&m2(i[1]);return e&&JSON.parse(e)},Fy=()=>{try{return pA()||fA()||mA()}catch(i){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${i}`);return}},g2=i=>{var e,t;return(t=(e=Fy())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[i]},gA=i=>{const e=g2(i);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const o=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),o]:[e.substring(0,t),o]},_2=()=>{var i;return(i=Fy())===null||i===void 0?void 0:i.config},y2=i=>{var e;return(e=Fy())===null||e===void 0?void 0:e[`_${i}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _A{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,o)=>{t?this.reject(t):this.resolve(o),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,o))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yA(i,e){if(i.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},o=e||"demo-project",h=i.iat||0,g=i.sub||i.user_id;if(!g)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const _=Object.assign({iss:`https://securetoken.google.com/${o}`,aud:o,iat:h,exp:h+3600,auth_time:h,sub:g,user_id:g,firebase:{sign_in_provider:"custom",identities:{}}},i);return[sy(JSON.stringify(t)),sy(JSON.stringify(_)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $a(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function vA(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test($a())}function xA(){var i;const e=(i=Fy())===null||i===void 0?void 0:i.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function wA(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function v2(){const i=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof i=="object"&&i.id!==void 0}function bA(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function TA(){const i=$a();return i.indexOf("MSIE ")>=0||i.indexOf("Trident/")>=0}function SA(){return!xA()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function x2(){try{return typeof indexedDB=="object"}catch{return!1}}function w2(){return new Promise((i,e)=>{try{let t=!0;const o="validate-browser-context-for-indexeddb-analytics-module",h=self.indexedDB.open(o);h.onsuccess=()=>{h.result.close(),t||self.indexedDB.deleteDatabase(o),i(!0)},h.onupgradeneeded=()=>{t=!1},h.onerror=()=>{var g;e(((g=h.error)===null||g===void 0?void 0:g.message)||"")}}catch(t){e(t)}})}function EA(){return!(typeof navigator>"u"||!navigator.cookieEnabled)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IA="FirebaseError";class Ic extends Error{constructor(e,t,o){super(t),this.code=e,this.customData=o,this.name=IA,Object.setPrototypeOf(this,Ic.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Fp.prototype.create)}}class Fp{constructor(e,t,o){this.service=e,this.serviceName=t,this.errors=o}create(e,...t){const o=t[0]||{},h=`${this.service}/${e}`,g=this.errors[e],_=g?PA(g,o):"Error",u=`${this.serviceName}: ${_} (${h}).`;return new Ic(h,u,o)}}function PA(i,e){return i.replace(CA,(t,o)=>{const h=e[o];return h!=null?String(h):`<${o}?>`})}const CA=/\{\$([^}]+)}/g;function AA(i){for(const e in i)if(Object.prototype.hasOwnProperty.call(i,e))return!1;return!0}function gg(i,e){if(i===e)return!0;const t=Object.keys(i),o=Object.keys(e);for(const h of t){if(!o.includes(h))return!1;const g=i[h],_=e[h];if(Sb(g)&&Sb(_)){if(!gg(g,_))return!1}else if(g!==_)return!1}for(const h of o)if(!t.includes(h))return!1;return!0}function Sb(i){return i!==null&&typeof i=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ng(i){const e=[];for(const[t,o]of Object.entries(i))Array.isArray(o)?o.forEach(h=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(h))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(o));return e.length?"&"+e.join("&"):""}function kA(i,e){const t=new MA(i,e);return t.subscribe.bind(t)}class MA{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(o=>{this.error(o)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,o){let h;if(e===void 0&&t===void 0&&o===void 0)throw new Error("Missing Observer.");RA(e,["next","error","complete"])?h=e:h={next:e,error:t,complete:o},h.next===void 0&&(h.next=Hv),h.error===void 0&&(h.error=Hv),h.complete===void 0&&(h.complete=Hv);const g=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?h.error(this.finalError):h.complete()}catch{}}),this.observers.push(h),g}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(o){typeof console<"u"&&console.error&&console.error(o)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function RA(i,e){if(typeof i!="object"||i===null)return!1;for(const t of e)if(t in i&&typeof i[t]=="function")return!0;return!1}function Hv(){}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LA=1e3,DA=2,zA=14400*1e3,NA=.5;function Eb(i,e=LA,t=DA){const o=e*Math.pow(t,i),h=Math.round(NA*o*(Math.random()-.5)*2);return Math.min(zA,o+h)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ol(i){return i&&i._delegate?i._delegate:i}class Sc{constructor(e,t,o){this.name=e,this.instanceFactory=t,this.type=o,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yp="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OA{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const o=new _A;if(this.instancesDeferred.set(t,o),this.isInitialized(t)||this.shouldAutoInitialize())try{const h=this.getOrInitializeService({instanceIdentifier:t});h&&o.resolve(h)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const o=this.normalizeInstanceIdentifier(e?.identifier),h=(t=e?.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(o)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:o})}catch(g){if(h)return null;throw g}else{if(h)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(BA(e))try{this.getOrInitializeService({instanceIdentifier:yp})}catch{}for(const[t,o]of this.instancesDeferred.entries()){const h=this.normalizeInstanceIdentifier(t);try{const g=this.getOrInitializeService({instanceIdentifier:h});o.resolve(g)}catch{}}}}clearInstance(e=yp){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=yp){return this.instances.has(e)}getOptions(e=yp){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,o=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(o))throw Error(`${this.name}(${o}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const h=this.getOrInitializeService({instanceIdentifier:o,options:t});for(const[g,_]of this.instancesDeferred.entries()){const u=this.normalizeInstanceIdentifier(g);o===u&&_.resolve(h)}return h}onInit(e,t){var o;const h=this.normalizeInstanceIdentifier(t),g=(o=this.onInitCallbacks.get(h))!==null&&o!==void 0?o:new Set;g.add(e),this.onInitCallbacks.set(h,g);const _=this.instances.get(h);return _&&e(_,h),()=>{g.delete(e)}}invokeOnInitCallbacks(e,t){const o=this.onInitCallbacks.get(t);if(o)for(const h of o)try{h(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let o=this.instances.get(e);if(!o&&this.component&&(o=this.component.instanceFactory(this.container,{instanceIdentifier:FA(e),options:t}),this.instances.set(e,o),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(o,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,o)}catch{}return o||null}normalizeInstanceIdentifier(e=yp){return this.component?this.component.multipleInstances?e:yp:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function FA(i){return i===yp?void 0:i}function BA(i){return i.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VA{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new OA(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ai;(function(i){i[i.DEBUG=0]="DEBUG",i[i.VERBOSE=1]="VERBOSE",i[i.INFO=2]="INFO",i[i.WARN=3]="WARN",i[i.ERROR=4]="ERROR",i[i.SILENT=5]="SILENT"})(Ai||(Ai={}));const UA={debug:Ai.DEBUG,verbose:Ai.VERBOSE,info:Ai.INFO,warn:Ai.WARN,error:Ai.ERROR,silent:Ai.SILENT},jA=Ai.INFO,$A={[Ai.DEBUG]:"log",[Ai.VERBOSE]:"log",[Ai.INFO]:"info",[Ai.WARN]:"warn",[Ai.ERROR]:"error"},HA=(i,e,...t)=>{if(e<i.logLevel)return;const o=new Date().toISOString(),h=$A[e];if(h)console[h](`[${o}]  ${i.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class By{constructor(e){this.name=e,this._logLevel=jA,this._logHandler=HA,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Ai))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?UA[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Ai.DEBUG,...e),this._logHandler(this,Ai.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Ai.VERBOSE,...e),this._logHandler(this,Ai.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Ai.INFO,...e),this._logHandler(this,Ai.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Ai.WARN,...e),this._logHandler(this,Ai.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Ai.ERROR,...e),this._logHandler(this,Ai.ERROR,...e)}}const qA=(i,e)=>e.some(t=>i instanceof t);let Ib,Pb;function GA(){return Ib||(Ib=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function ZA(){return Pb||(Pb=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const b2=new WeakMap,_0=new WeakMap,T2=new WeakMap,qv=new WeakMap,sx=new WeakMap;function WA(i){const e=new Promise((t,o)=>{const h=()=>{i.removeEventListener("success",g),i.removeEventListener("error",_)},g=()=>{t(Ld(i.result)),h()},_=()=>{o(i.error),h()};i.addEventListener("success",g),i.addEventListener("error",_)});return e.then(t=>{t instanceof IDBCursor&&b2.set(t,i)}).catch(()=>{}),sx.set(e,i),e}function KA(i){if(_0.has(i))return;const e=new Promise((t,o)=>{const h=()=>{i.removeEventListener("complete",g),i.removeEventListener("error",_),i.removeEventListener("abort",_)},g=()=>{t(),h()},_=()=>{o(i.error||new DOMException("AbortError","AbortError")),h()};i.addEventListener("complete",g),i.addEventListener("error",_),i.addEventListener("abort",_)});_0.set(i,e)}let y0={get(i,e,t){if(i instanceof IDBTransaction){if(e==="done")return _0.get(i);if(e==="objectStoreNames")return i.objectStoreNames||T2.get(i);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Ld(i[e])},set(i,e,t){return i[e]=t,!0},has(i,e){return i instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in i}};function XA(i){y0=i(y0)}function YA(i){return i===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const o=i.call(Gv(this),e,...t);return T2.set(o,e.sort?e.sort():[e]),Ld(o)}:ZA().includes(i)?function(...e){return i.apply(Gv(this),e),Ld(b2.get(this))}:function(...e){return Ld(i.apply(Gv(this),e))}}function QA(i){return typeof i=="function"?YA(i):(i instanceof IDBTransaction&&KA(i),qA(i,GA())?new Proxy(i,y0):i)}function Ld(i){if(i instanceof IDBRequest)return WA(i);if(qv.has(i))return qv.get(i);const e=QA(i);return e!==i&&(qv.set(i,e),sx.set(e,i)),e}const Gv=i=>sx.get(i);function S2(i,e,{blocked:t,upgrade:o,blocking:h,terminated:g}={}){const _=indexedDB.open(i,e),u=Ld(_);return o&&_.addEventListener("upgradeneeded",R=>{o(Ld(_.result),R.oldVersion,R.newVersion,Ld(_.transaction),R)}),t&&_.addEventListener("blocked",R=>t(R.oldVersion,R.newVersion,R)),u.then(R=>{g&&R.addEventListener("close",()=>g()),h&&R.addEventListener("versionchange",O=>h(O.oldVersion,O.newVersion,O))}).catch(()=>{}),u}const JA=["get","getKey","getAll","getAllKeys","count"],ek=["put","add","delete","clear"],Zv=new Map;function Cb(i,e){if(!(i instanceof IDBDatabase&&!(e in i)&&typeof e=="string"))return;if(Zv.get(e))return Zv.get(e);const t=e.replace(/FromIndex$/,""),o=e!==t,h=ek.includes(t);if(!(t in(o?IDBIndex:IDBObjectStore).prototype)||!(h||JA.includes(t)))return;const g=async function(_,...u){const R=this.transaction(_,h?"readwrite":"readonly");let O=R.store;return o&&(O=O.index(u.shift())),(await Promise.all([O[t](...u),h&&R.done]))[0]};return Zv.set(e,g),g}XA(i=>({...i,get:(e,t,o)=>Cb(e,t)||i.get(e,t,o),has:(e,t)=>!!Cb(e,t)||i.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tk{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(nk(t)){const o=t.getImmediate();return`${o.library}/${o.version}`}else return null}).filter(t=>t).join(" ")}}function nk(i){const e=i.getComponent();return e?.type==="VERSION"}const v0="@firebase/app",Ab="0.10.18";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yh=new By("@firebase/app"),ik="@firebase/app-compat",rk="@firebase/analytics-compat",ok="@firebase/analytics",sk="@firebase/app-check-compat",ak="@firebase/app-check",lk="@firebase/auth",uk="@firebase/auth-compat",ck="@firebase/database",hk="@firebase/data-connect",dk="@firebase/database-compat",pk="@firebase/functions",fk="@firebase/functions-compat",mk="@firebase/installations",gk="@firebase/installations-compat",_k="@firebase/messaging",yk="@firebase/messaging-compat",vk="@firebase/performance",xk="@firebase/performance-compat",wk="@firebase/remote-config",bk="@firebase/remote-config-compat",Tk="@firebase/storage",Sk="@firebase/storage-compat",Ek="@firebase/firestore",Ik="@firebase/vertexai",Pk="@firebase/firestore-compat",Ck="firebase",Ak="11.2.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const x0="[DEFAULT]",kk={[v0]:"fire-core",[ik]:"fire-core-compat",[ok]:"fire-analytics",[rk]:"fire-analytics-compat",[ak]:"fire-app-check",[sk]:"fire-app-check-compat",[lk]:"fire-auth",[uk]:"fire-auth-compat",[ck]:"fire-rtdb",[hk]:"fire-data-connect",[dk]:"fire-rtdb-compat",[pk]:"fire-fn",[fk]:"fire-fn-compat",[mk]:"fire-iid",[gk]:"fire-iid-compat",[_k]:"fire-fcm",[yk]:"fire-fcm-compat",[vk]:"fire-perf",[xk]:"fire-perf-compat",[wk]:"fire-rc",[bk]:"fire-rc-compat",[Tk]:"fire-gcs",[Sk]:"fire-gcs-compat",[Ek]:"fire-fst",[Pk]:"fire-fst-compat",[Ik]:"fire-vertex","fire-js":"fire-js",[Ck]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ay=new Map,Mk=new Map,w0=new Map;function kb(i,e){try{i.container.addComponent(e)}catch(t){Yh.debug(`Component ${e.name} failed to register with FirebaseApp ${i.name}`,t)}}function ph(i){const e=i.name;if(w0.has(e))return Yh.debug(`There were multiple attempts to register component ${e}.`),!1;w0.set(e,i);for(const t of ay.values())kb(t,i);for(const t of Mk.values())kb(t,i);return!0}function Bp(i,e){const t=i.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),i.container.getProvider(e)}function kd(i){return i.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rk={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Dd=new Fp("app","Firebase",Rk);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lk{constructor(e,t,o){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=o,this.container.addComponent(new Sc("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Dd.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rm=Ak;function E2(i,e={}){let t=i;typeof e!="object"&&(e={name:e});const o=Object.assign({name:x0,automaticDataCollectionEnabled:!1},e),h=o.name;if(typeof h!="string"||!h)throw Dd.create("bad-app-name",{appName:String(h)});if(t||(t=_2()),!t)throw Dd.create("no-options");const g=ay.get(h);if(g){if(gg(t,g.options)&&gg(o,g.config))return g;throw Dd.create("duplicate-app",{appName:h})}const _=new VA(h);for(const R of w0.values())_.addComponent(R);const u=new Lk(t,o,_);return ay.set(h,u),u}function ax(i=x0){const e=ay.get(i);if(!e&&i===x0&&_2())return E2();if(!e)throw Dd.create("no-app",{appName:i});return e}function Vu(i,e,t){var o;let h=(o=kk[i])!==null&&o!==void 0?o:i;t&&(h+=`-${t}`);const g=h.match(/\s|\//),_=e.match(/\s|\//);if(g||_){const u=[`Unable to register library "${h}" with version "${e}":`];g&&u.push(`library name "${h}" contains illegal characters (whitespace or "/")`),g&&_&&u.push("and"),_&&u.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Yh.warn(u.join(" "));return}ph(new Sc(`${h}-version`,()=>({library:h,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dk="firebase-heartbeat-database",zk=1,_g="firebase-heartbeat-store";let Wv=null;function I2(){return Wv||(Wv=S2(Dk,zk,{upgrade:(i,e)=>{switch(e){case 0:try{i.createObjectStore(_g)}catch(t){console.warn(t)}}}}).catch(i=>{throw Dd.create("idb-open",{originalErrorMessage:i.message})})),Wv}async function Nk(i){try{const t=(await I2()).transaction(_g),o=await t.objectStore(_g).get(P2(i));return await t.done,o}catch(e){if(e instanceof Ic)Yh.warn(e.message);else{const t=Dd.create("idb-get",{originalErrorMessage:e?.message});Yh.warn(t.message)}}}async function Mb(i,e){try{const o=(await I2()).transaction(_g,"readwrite");await o.objectStore(_g).put(e,P2(i)),await o.done}catch(t){if(t instanceof Ic)Yh.warn(t.message);else{const o=Dd.create("idb-set",{originalErrorMessage:t?.message});Yh.warn(o.message)}}}function P2(i){return`${i.name}!${i.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ok=1024,Fk=720*60*60*1e3;class Bk{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new Uk(t),this._heartbeatsCachePromise=this._storage.read().then(o=>(this._heartbeatsCache=o,o))}async triggerHeartbeat(){var e,t;try{const h=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),g=Rb();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===g||this._heartbeatsCache.heartbeats.some(_=>_.date===g)?void 0:(this._heartbeatsCache.heartbeats.push({date:g,agent:h}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(_=>{const u=new Date(_.date).valueOf();return Date.now()-u<=Fk}),this._storage.overwrite(this._heartbeatsCache))}catch(o){Yh.warn(o)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=Rb(),{heartbeatsToSend:o,unsentEntries:h}=Vk(this._heartbeatsCache.heartbeats),g=sy(JSON.stringify({version:2,heartbeats:o}));return this._heartbeatsCache.lastSentHeartbeatDate=t,h.length>0?(this._heartbeatsCache.heartbeats=h,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),g}catch(t){return Yh.warn(t),""}}}function Rb(){return new Date().toISOString().substring(0,10)}function Vk(i,e=Ok){const t=[];let o=i.slice();for(const h of i){const g=t.find(_=>_.agent===h.agent);if(g){if(g.dates.push(h.date),Lb(t)>e){g.dates.pop();break}}else if(t.push({agent:h.agent,dates:[h.date]}),Lb(t)>e){t.pop();break}o=o.slice(1)}return{heartbeatsToSend:t,unsentEntries:o}}class Uk{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return x2()?w2().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await Nk(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const h=await this.read();return Mb(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:h.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const h=await this.read();return Mb(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:h.lastSentHeartbeatDate,heartbeats:[...h.heartbeats,...e.heartbeats]})}else return}}function Lb(i){return sy(JSON.stringify({version:2,heartbeats:i})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jk(i){ph(new Sc("platform-logger",e=>new tk(e),"PRIVATE")),ph(new Sc("heartbeat",e=>new Bk(e),"PRIVATE")),Vu(v0,Ab,i),Vu(v0,Ab,"esm2017"),Vu("fire-js","")}jk("");var $k="firebase",Hk="11.2.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Vu($k,Hk,"app");var Db=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var zd,C2;(function(){var i;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(be,te){function pe(){}pe.prototype=te.prototype,be.D=te.prototype,be.prototype=new pe,be.prototype.constructor=be,be.C=function(xe,Ae,$e){for(var Ce=Array(arguments.length-2),pn=2;pn<arguments.length;pn++)Ce[pn-2]=arguments[pn];return te.prototype[Ae].apply(xe,Ce)}}function t(){this.blockSize=-1}function o(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(o,t),o.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function h(be,te,pe){pe||(pe=0);var xe=Array(16);if(typeof te=="string")for(var Ae=0;16>Ae;++Ae)xe[Ae]=te.charCodeAt(pe++)|te.charCodeAt(pe++)<<8|te.charCodeAt(pe++)<<16|te.charCodeAt(pe++)<<24;else for(Ae=0;16>Ae;++Ae)xe[Ae]=te[pe++]|te[pe++]<<8|te[pe++]<<16|te[pe++]<<24;te=be.g[0],pe=be.g[1],Ae=be.g[2];var $e=be.g[3],Ce=te+($e^pe&(Ae^$e))+xe[0]+3614090360&4294967295;te=pe+(Ce<<7&4294967295|Ce>>>25),Ce=$e+(Ae^te&(pe^Ae))+xe[1]+3905402710&4294967295,$e=te+(Ce<<12&4294967295|Ce>>>20),Ce=Ae+(pe^$e&(te^pe))+xe[2]+606105819&4294967295,Ae=$e+(Ce<<17&4294967295|Ce>>>15),Ce=pe+(te^Ae&($e^te))+xe[3]+3250441966&4294967295,pe=Ae+(Ce<<22&4294967295|Ce>>>10),Ce=te+($e^pe&(Ae^$e))+xe[4]+4118548399&4294967295,te=pe+(Ce<<7&4294967295|Ce>>>25),Ce=$e+(Ae^te&(pe^Ae))+xe[5]+1200080426&4294967295,$e=te+(Ce<<12&4294967295|Ce>>>20),Ce=Ae+(pe^$e&(te^pe))+xe[6]+2821735955&4294967295,Ae=$e+(Ce<<17&4294967295|Ce>>>15),Ce=pe+(te^Ae&($e^te))+xe[7]+4249261313&4294967295,pe=Ae+(Ce<<22&4294967295|Ce>>>10),Ce=te+($e^pe&(Ae^$e))+xe[8]+1770035416&4294967295,te=pe+(Ce<<7&4294967295|Ce>>>25),Ce=$e+(Ae^te&(pe^Ae))+xe[9]+2336552879&4294967295,$e=te+(Ce<<12&4294967295|Ce>>>20),Ce=Ae+(pe^$e&(te^pe))+xe[10]+4294925233&4294967295,Ae=$e+(Ce<<17&4294967295|Ce>>>15),Ce=pe+(te^Ae&($e^te))+xe[11]+2304563134&4294967295,pe=Ae+(Ce<<22&4294967295|Ce>>>10),Ce=te+($e^pe&(Ae^$e))+xe[12]+1804603682&4294967295,te=pe+(Ce<<7&4294967295|Ce>>>25),Ce=$e+(Ae^te&(pe^Ae))+xe[13]+4254626195&4294967295,$e=te+(Ce<<12&4294967295|Ce>>>20),Ce=Ae+(pe^$e&(te^pe))+xe[14]+2792965006&4294967295,Ae=$e+(Ce<<17&4294967295|Ce>>>15),Ce=pe+(te^Ae&($e^te))+xe[15]+1236535329&4294967295,pe=Ae+(Ce<<22&4294967295|Ce>>>10),Ce=te+(Ae^$e&(pe^Ae))+xe[1]+4129170786&4294967295,te=pe+(Ce<<5&4294967295|Ce>>>27),Ce=$e+(pe^Ae&(te^pe))+xe[6]+3225465664&4294967295,$e=te+(Ce<<9&4294967295|Ce>>>23),Ce=Ae+(te^pe&($e^te))+xe[11]+643717713&4294967295,Ae=$e+(Ce<<14&4294967295|Ce>>>18),Ce=pe+($e^te&(Ae^$e))+xe[0]+3921069994&4294967295,pe=Ae+(Ce<<20&4294967295|Ce>>>12),Ce=te+(Ae^$e&(pe^Ae))+xe[5]+3593408605&4294967295,te=pe+(Ce<<5&4294967295|Ce>>>27),Ce=$e+(pe^Ae&(te^pe))+xe[10]+38016083&4294967295,$e=te+(Ce<<9&4294967295|Ce>>>23),Ce=Ae+(te^pe&($e^te))+xe[15]+3634488961&4294967295,Ae=$e+(Ce<<14&4294967295|Ce>>>18),Ce=pe+($e^te&(Ae^$e))+xe[4]+3889429448&4294967295,pe=Ae+(Ce<<20&4294967295|Ce>>>12),Ce=te+(Ae^$e&(pe^Ae))+xe[9]+568446438&4294967295,te=pe+(Ce<<5&4294967295|Ce>>>27),Ce=$e+(pe^Ae&(te^pe))+xe[14]+3275163606&4294967295,$e=te+(Ce<<9&4294967295|Ce>>>23),Ce=Ae+(te^pe&($e^te))+xe[3]+4107603335&4294967295,Ae=$e+(Ce<<14&4294967295|Ce>>>18),Ce=pe+($e^te&(Ae^$e))+xe[8]+1163531501&4294967295,pe=Ae+(Ce<<20&4294967295|Ce>>>12),Ce=te+(Ae^$e&(pe^Ae))+xe[13]+2850285829&4294967295,te=pe+(Ce<<5&4294967295|Ce>>>27),Ce=$e+(pe^Ae&(te^pe))+xe[2]+4243563512&4294967295,$e=te+(Ce<<9&4294967295|Ce>>>23),Ce=Ae+(te^pe&($e^te))+xe[7]+1735328473&4294967295,Ae=$e+(Ce<<14&4294967295|Ce>>>18),Ce=pe+($e^te&(Ae^$e))+xe[12]+2368359562&4294967295,pe=Ae+(Ce<<20&4294967295|Ce>>>12),Ce=te+(pe^Ae^$e)+xe[5]+4294588738&4294967295,te=pe+(Ce<<4&4294967295|Ce>>>28),Ce=$e+(te^pe^Ae)+xe[8]+2272392833&4294967295,$e=te+(Ce<<11&4294967295|Ce>>>21),Ce=Ae+($e^te^pe)+xe[11]+1839030562&4294967295,Ae=$e+(Ce<<16&4294967295|Ce>>>16),Ce=pe+(Ae^$e^te)+xe[14]+4259657740&4294967295,pe=Ae+(Ce<<23&4294967295|Ce>>>9),Ce=te+(pe^Ae^$e)+xe[1]+2763975236&4294967295,te=pe+(Ce<<4&4294967295|Ce>>>28),Ce=$e+(te^pe^Ae)+xe[4]+1272893353&4294967295,$e=te+(Ce<<11&4294967295|Ce>>>21),Ce=Ae+($e^te^pe)+xe[7]+4139469664&4294967295,Ae=$e+(Ce<<16&4294967295|Ce>>>16),Ce=pe+(Ae^$e^te)+xe[10]+3200236656&4294967295,pe=Ae+(Ce<<23&4294967295|Ce>>>9),Ce=te+(pe^Ae^$e)+xe[13]+681279174&4294967295,te=pe+(Ce<<4&4294967295|Ce>>>28),Ce=$e+(te^pe^Ae)+xe[0]+3936430074&4294967295,$e=te+(Ce<<11&4294967295|Ce>>>21),Ce=Ae+($e^te^pe)+xe[3]+3572445317&4294967295,Ae=$e+(Ce<<16&4294967295|Ce>>>16),Ce=pe+(Ae^$e^te)+xe[6]+76029189&4294967295,pe=Ae+(Ce<<23&4294967295|Ce>>>9),Ce=te+(pe^Ae^$e)+xe[9]+3654602809&4294967295,te=pe+(Ce<<4&4294967295|Ce>>>28),Ce=$e+(te^pe^Ae)+xe[12]+3873151461&4294967295,$e=te+(Ce<<11&4294967295|Ce>>>21),Ce=Ae+($e^te^pe)+xe[15]+530742520&4294967295,Ae=$e+(Ce<<16&4294967295|Ce>>>16),Ce=pe+(Ae^$e^te)+xe[2]+3299628645&4294967295,pe=Ae+(Ce<<23&4294967295|Ce>>>9),Ce=te+(Ae^(pe|~$e))+xe[0]+4096336452&4294967295,te=pe+(Ce<<6&4294967295|Ce>>>26),Ce=$e+(pe^(te|~Ae))+xe[7]+1126891415&4294967295,$e=te+(Ce<<10&4294967295|Ce>>>22),Ce=Ae+(te^($e|~pe))+xe[14]+2878612391&4294967295,Ae=$e+(Ce<<15&4294967295|Ce>>>17),Ce=pe+($e^(Ae|~te))+xe[5]+4237533241&4294967295,pe=Ae+(Ce<<21&4294967295|Ce>>>11),Ce=te+(Ae^(pe|~$e))+xe[12]+1700485571&4294967295,te=pe+(Ce<<6&4294967295|Ce>>>26),Ce=$e+(pe^(te|~Ae))+xe[3]+2399980690&4294967295,$e=te+(Ce<<10&4294967295|Ce>>>22),Ce=Ae+(te^($e|~pe))+xe[10]+4293915773&4294967295,Ae=$e+(Ce<<15&4294967295|Ce>>>17),Ce=pe+($e^(Ae|~te))+xe[1]+2240044497&4294967295,pe=Ae+(Ce<<21&4294967295|Ce>>>11),Ce=te+(Ae^(pe|~$e))+xe[8]+1873313359&4294967295,te=pe+(Ce<<6&4294967295|Ce>>>26),Ce=$e+(pe^(te|~Ae))+xe[15]+4264355552&4294967295,$e=te+(Ce<<10&4294967295|Ce>>>22),Ce=Ae+(te^($e|~pe))+xe[6]+2734768916&4294967295,Ae=$e+(Ce<<15&4294967295|Ce>>>17),Ce=pe+($e^(Ae|~te))+xe[13]+1309151649&4294967295,pe=Ae+(Ce<<21&4294967295|Ce>>>11),Ce=te+(Ae^(pe|~$e))+xe[4]+4149444226&4294967295,te=pe+(Ce<<6&4294967295|Ce>>>26),Ce=$e+(pe^(te|~Ae))+xe[11]+3174756917&4294967295,$e=te+(Ce<<10&4294967295|Ce>>>22),Ce=Ae+(te^($e|~pe))+xe[2]+718787259&4294967295,Ae=$e+(Ce<<15&4294967295|Ce>>>17),Ce=pe+($e^(Ae|~te))+xe[9]+3951481745&4294967295,be.g[0]=be.g[0]+te&4294967295,be.g[1]=be.g[1]+(Ae+(Ce<<21&4294967295|Ce>>>11))&4294967295,be.g[2]=be.g[2]+Ae&4294967295,be.g[3]=be.g[3]+$e&4294967295}o.prototype.u=function(be,te){te===void 0&&(te=be.length);for(var pe=te-this.blockSize,xe=this.B,Ae=this.h,$e=0;$e<te;){if(Ae==0)for(;$e<=pe;)h(this,be,$e),$e+=this.blockSize;if(typeof be=="string"){for(;$e<te;)if(xe[Ae++]=be.charCodeAt($e++),Ae==this.blockSize){h(this,xe),Ae=0;break}}else for(;$e<te;)if(xe[Ae++]=be[$e++],Ae==this.blockSize){h(this,xe),Ae=0;break}}this.h=Ae,this.o+=te},o.prototype.v=function(){var be=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);be[0]=128;for(var te=1;te<be.length-8;++te)be[te]=0;var pe=8*this.o;for(te=be.length-8;te<be.length;++te)be[te]=pe&255,pe/=256;for(this.u(be),be=Array(16),te=pe=0;4>te;++te)for(var xe=0;32>xe;xe+=8)be[pe++]=this.g[te]>>>xe&255;return be};function g(be,te){var pe=u;return Object.prototype.hasOwnProperty.call(pe,be)?pe[be]:pe[be]=te(be)}function _(be,te){this.h=te;for(var pe=[],xe=!0,Ae=be.length-1;0<=Ae;Ae--){var $e=be[Ae]|0;xe&&$e==te||(pe[Ae]=$e,xe=!1)}this.g=pe}var u={};function R(be){return-128<=be&&128>be?g(be,function(te){return new _([te|0],0>te?-1:0)}):new _([be|0],0>be?-1:0)}function O(be){if(isNaN(be)||!isFinite(be))return ne;if(0>be)return De(O(-be));for(var te=[],pe=1,xe=0;be>=pe;xe++)te[xe]=be/pe|0,pe*=4294967296;return new _(te,0)}function G(be,te){if(be.length==0)throw Error("number format error: empty string");if(te=te||10,2>te||36<te)throw Error("radix out of range: "+te);if(be.charAt(0)=="-")return De(G(be.substring(1),te));if(0<=be.indexOf("-"))throw Error('number format error: interior "-" character');for(var pe=O(Math.pow(te,8)),xe=ne,Ae=0;Ae<be.length;Ae+=8){var $e=Math.min(8,be.length-Ae),Ce=parseInt(be.substring(Ae,Ae+$e),te);8>$e?($e=O(Math.pow(te,$e)),xe=xe.j($e).add(O(Ce))):(xe=xe.j(pe),xe=xe.add(O(Ce)))}return xe}var ne=R(0),re=R(1),Q=R(16777216);i=_.prototype,i.m=function(){if(Se(this))return-De(this).m();for(var be=0,te=1,pe=0;pe<this.g.length;pe++){var xe=this.i(pe);be+=(0<=xe?xe:4294967296+xe)*te,te*=4294967296}return be},i.toString=function(be){if(be=be||10,2>be||36<be)throw Error("radix out of range: "+be);if(de(this))return"0";if(Se(this))return"-"+De(this).toString(be);for(var te=O(Math.pow(be,6)),pe=this,xe="";;){var Ae=Ye(pe,te).g;pe=Ke(pe,Ae.j(te));var $e=((0<pe.g.length?pe.g[0]:pe.h)>>>0).toString(be);if(pe=Ae,de(pe))return $e+xe;for(;6>$e.length;)$e="0"+$e;xe=$e+xe}},i.i=function(be){return 0>be?0:be<this.g.length?this.g[be]:this.h};function de(be){if(be.h!=0)return!1;for(var te=0;te<be.g.length;te++)if(be.g[te]!=0)return!1;return!0}function Se(be){return be.h==-1}i.l=function(be){return be=Ke(this,be),Se(be)?-1:de(be)?0:1};function De(be){for(var te=be.g.length,pe=[],xe=0;xe<te;xe++)pe[xe]=~be.g[xe];return new _(pe,~be.h).add(re)}i.abs=function(){return Se(this)?De(this):this},i.add=function(be){for(var te=Math.max(this.g.length,be.g.length),pe=[],xe=0,Ae=0;Ae<=te;Ae++){var $e=xe+(this.i(Ae)&65535)+(be.i(Ae)&65535),Ce=($e>>>16)+(this.i(Ae)>>>16)+(be.i(Ae)>>>16);xe=Ce>>>16,$e&=65535,Ce&=65535,pe[Ae]=Ce<<16|$e}return new _(pe,pe[pe.length-1]&-2147483648?-1:0)};function Ke(be,te){return be.add(De(te))}i.j=function(be){if(de(this)||de(be))return ne;if(Se(this))return Se(be)?De(this).j(De(be)):De(De(this).j(be));if(Se(be))return De(this.j(De(be)));if(0>this.l(Q)&&0>be.l(Q))return O(this.m()*be.m());for(var te=this.g.length+be.g.length,pe=[],xe=0;xe<2*te;xe++)pe[xe]=0;for(xe=0;xe<this.g.length;xe++)for(var Ae=0;Ae<be.g.length;Ae++){var $e=this.i(xe)>>>16,Ce=this.i(xe)&65535,pn=be.i(Ae)>>>16,ri=be.i(Ae)&65535;pe[2*xe+2*Ae]+=Ce*ri,et(pe,2*xe+2*Ae),pe[2*xe+2*Ae+1]+=$e*ri,et(pe,2*xe+2*Ae+1),pe[2*xe+2*Ae+1]+=Ce*pn,et(pe,2*xe+2*Ae+1),pe[2*xe+2*Ae+2]+=$e*pn,et(pe,2*xe+2*Ae+2)}for(xe=0;xe<te;xe++)pe[xe]=pe[2*xe+1]<<16|pe[2*xe];for(xe=te;xe<2*te;xe++)pe[xe]=0;return new _(pe,0)};function et(be,te){for(;(be[te]&65535)!=be[te];)be[te+1]+=be[te]>>>16,be[te]&=65535,te++}function vt(be,te){this.g=be,this.h=te}function Ye(be,te){if(de(te))throw Error("division by zero");if(de(be))return new vt(ne,ne);if(Se(be))return te=Ye(De(be),te),new vt(De(te.g),De(te.h));if(Se(te))return te=Ye(be,De(te)),new vt(De(te.g),te.h);if(30<be.g.length){if(Se(be)||Se(te))throw Error("slowDivide_ only works with positive integers.");for(var pe=re,xe=te;0>=xe.l(be);)pe=it(pe),xe=it(xe);var Ae=at(pe,1),$e=at(xe,1);for(xe=at(xe,2),pe=at(pe,2);!de(xe);){var Ce=$e.add(xe);0>=Ce.l(be)&&(Ae=Ae.add(pe),$e=Ce),xe=at(xe,1),pe=at(pe,1)}return te=Ke(be,Ae.j(te)),new vt(Ae,te)}for(Ae=ne;0<=be.l(te);){for(pe=Math.max(1,Math.floor(be.m()/te.m())),xe=Math.ceil(Math.log(pe)/Math.LN2),xe=48>=xe?1:Math.pow(2,xe-48),$e=O(pe),Ce=$e.j(te);Se(Ce)||0<Ce.l(be);)pe-=xe,$e=O(pe),Ce=$e.j(te);de($e)&&($e=re),Ae=Ae.add($e),be=Ke(be,Ce)}return new vt(Ae,be)}i.A=function(be){return Ye(this,be).h},i.and=function(be){for(var te=Math.max(this.g.length,be.g.length),pe=[],xe=0;xe<te;xe++)pe[xe]=this.i(xe)&be.i(xe);return new _(pe,this.h&be.h)},i.or=function(be){for(var te=Math.max(this.g.length,be.g.length),pe=[],xe=0;xe<te;xe++)pe[xe]=this.i(xe)|be.i(xe);return new _(pe,this.h|be.h)},i.xor=function(be){for(var te=Math.max(this.g.length,be.g.length),pe=[],xe=0;xe<te;xe++)pe[xe]=this.i(xe)^be.i(xe);return new _(pe,this.h^be.h)};function it(be){for(var te=be.g.length+1,pe=[],xe=0;xe<te;xe++)pe[xe]=be.i(xe)<<1|be.i(xe-1)>>>31;return new _(pe,be.h)}function at(be,te){var pe=te>>5;te%=32;for(var xe=be.g.length-pe,Ae=[],$e=0;$e<xe;$e++)Ae[$e]=0<te?be.i($e+pe)>>>te|be.i($e+pe+1)<<32-te:be.i($e+pe);return new _(Ae,be.h)}o.prototype.digest=o.prototype.v,o.prototype.reset=o.prototype.s,o.prototype.update=o.prototype.u,C2=o,_.prototype.add=_.prototype.add,_.prototype.multiply=_.prototype.j,_.prototype.modulo=_.prototype.A,_.prototype.compare=_.prototype.l,_.prototype.toNumber=_.prototype.m,_.prototype.toString=_.prototype.toString,_.prototype.getBits=_.prototype.i,_.fromNumber=O,_.fromString=G,zd=_}).apply(typeof Db<"u"?Db:typeof self<"u"?self:typeof window<"u"?window:{});var I_=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var A2,eg,k2,H_,b0,M2,R2,L2;(function(){var i,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(P,j,Y){return P==Array.prototype||P==Object.prototype||(P[j]=Y.value),P};function t(P){P=[typeof globalThis=="object"&&globalThis,P,typeof window=="object"&&window,typeof self=="object"&&self,typeof I_=="object"&&I_];for(var j=0;j<P.length;++j){var Y=P[j];if(Y&&Y.Math==Math)return Y}throw Error("Cannot find global object")}var o=t(this);function h(P,j){if(j)e:{var Y=o;P=P.split(".");for(var ye=0;ye<P.length-1;ye++){var nt=P[ye];if(!(nt in Y))break e;Y=Y[nt]}P=P[P.length-1],ye=Y[P],j=j(ye),j!=ye&&j!=null&&e(Y,P,{configurable:!0,writable:!0,value:j})}}function g(P,j){P instanceof String&&(P+="");var Y=0,ye=!1,nt={next:function(){if(!ye&&Y<P.length){var ft=Y++;return{value:j(ft,P[ft]),done:!1}}return ye=!0,{done:!0,value:void 0}}};return nt[Symbol.iterator]=function(){return nt},nt}h("Array.prototype.values",function(P){return P||function(){return g(this,function(j,Y){return Y})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var _=_||{},u=this||self;function R(P){var j=typeof P;return j=j!="object"?j:P?Array.isArray(P)?"array":j:"null",j=="array"||j=="object"&&typeof P.length=="number"}function O(P){var j=typeof P;return j=="object"&&P!=null||j=="function"}function G(P,j,Y){return P.call.apply(P.bind,arguments)}function ne(P,j,Y){if(!P)throw Error();if(2<arguments.length){var ye=Array.prototype.slice.call(arguments,2);return function(){var nt=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(nt,ye),P.apply(j,nt)}}return function(){return P.apply(j,arguments)}}function re(P,j,Y){return re=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?G:ne,re.apply(null,arguments)}function Q(P,j){var Y=Array.prototype.slice.call(arguments,1);return function(){var ye=Y.slice();return ye.push.apply(ye,arguments),P.apply(this,ye)}}function de(P,j){function Y(){}Y.prototype=j.prototype,P.aa=j.prototype,P.prototype=new Y,P.prototype.constructor=P,P.Qb=function(ye,nt,ft){for(var Zt=Array(arguments.length-2),Pi=2;Pi<arguments.length;Pi++)Zt[Pi-2]=arguments[Pi];return j.prototype[nt].apply(ye,Zt)}}function Se(P){const j=P.length;if(0<j){const Y=Array(j);for(let ye=0;ye<j;ye++)Y[ye]=P[ye];return Y}return[]}function De(P,j){for(let Y=1;Y<arguments.length;Y++){const ye=arguments[Y];if(R(ye)){const nt=P.length||0,ft=ye.length||0;P.length=nt+ft;for(let Zt=0;Zt<ft;Zt++)P[nt+Zt]=ye[Zt]}else P.push(ye)}}class Ke{constructor(j,Y){this.i=j,this.j=Y,this.h=0,this.g=null}get(){let j;return 0<this.h?(this.h--,j=this.g,this.g=j.next,j.next=null):j=this.i(),j}}function et(P){return/^[\s\xa0]*$/.test(P)}function vt(){var P=u.navigator;return P&&(P=P.userAgent)?P:""}function Ye(P){return Ye[" "](P),P}Ye[" "]=function(){};var it=vt().indexOf("Gecko")!=-1&&!(vt().toLowerCase().indexOf("webkit")!=-1&&vt().indexOf("Edge")==-1)&&!(vt().indexOf("Trident")!=-1||vt().indexOf("MSIE")!=-1)&&vt().indexOf("Edge")==-1;function at(P,j,Y){for(const ye in P)j.call(Y,P[ye],ye,P)}function be(P,j){for(const Y in P)j.call(void 0,P[Y],Y,P)}function te(P){const j={};for(const Y in P)j[Y]=P[Y];return j}const pe="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function xe(P,j){let Y,ye;for(let nt=1;nt<arguments.length;nt++){ye=arguments[nt];for(Y in ye)P[Y]=ye[Y];for(let ft=0;ft<pe.length;ft++)Y=pe[ft],Object.prototype.hasOwnProperty.call(ye,Y)&&(P[Y]=ye[Y])}}function Ae(P){var j=1;P=P.split(":");const Y=[];for(;0<j&&P.length;)Y.push(P.shift()),j--;return P.length&&Y.push(P.join(":")),Y}function $e(P){u.setTimeout(()=>{throw P},0)}function Ce(){var P=gn;let j=null;return P.g&&(j=P.g,P.g=P.g.next,P.g||(P.h=null),j.next=null),j}class pn{constructor(){this.h=this.g=null}add(j,Y){const ye=ri.get();ye.set(j,Y),this.h?this.h.next=ye:this.g=ye,this.h=ye}}var ri=new Ke(()=>new dn,P=>P.reset());class dn{constructor(){this.next=this.g=this.h=null}set(j,Y){this.h=j,this.g=Y,this.next=null}reset(){this.next=this.g=this.h=null}}let jn,Tt=!1,gn=new pn,St=()=>{const P=u.Promise.resolve(void 0);jn=()=>{P.then(Ze)}};var Ze=()=>{for(var P;P=Ce();){try{P.h.call(P.g)}catch(Y){$e(Y)}var j=ri;j.j(P),100>j.h&&(j.h++,P.next=j.g,j.g=P)}Tt=!1};function wt(){this.s=this.s,this.C=this.C}wt.prototype.s=!1,wt.prototype.ma=function(){this.s||(this.s=!0,this.N())},wt.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Qt(P,j){this.type=P,this.g=this.target=j,this.defaultPrevented=!1}Qt.prototype.h=function(){this.defaultPrevented=!0};var sn=function(){if(!u.addEventListener||!Object.defineProperty)return!1;var P=!1,j=Object.defineProperty({},"passive",{get:function(){P=!0}});try{const Y=()=>{};u.addEventListener("test",Y,j),u.removeEventListener("test",Y,j)}catch{}return P}();function Xt(P,j){if(Qt.call(this,P?P.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,P){var Y=this.type=P.type,ye=P.changedTouches&&P.changedTouches.length?P.changedTouches[0]:null;if(this.target=P.target||P.srcElement,this.g=j,j=P.relatedTarget){if(it){e:{try{Ye(j.nodeName);var nt=!0;break e}catch{}nt=!1}nt||(j=null)}}else Y=="mouseover"?j=P.fromElement:Y=="mouseout"&&(j=P.toElement);this.relatedTarget=j,ye?(this.clientX=ye.clientX!==void 0?ye.clientX:ye.pageX,this.clientY=ye.clientY!==void 0?ye.clientY:ye.pageY,this.screenX=ye.screenX||0,this.screenY=ye.screenY||0):(this.clientX=P.clientX!==void 0?P.clientX:P.pageX,this.clientY=P.clientY!==void 0?P.clientY:P.pageY,this.screenX=P.screenX||0,this.screenY=P.screenY||0),this.button=P.button,this.key=P.key||"",this.ctrlKey=P.ctrlKey,this.altKey=P.altKey,this.shiftKey=P.shiftKey,this.metaKey=P.metaKey,this.pointerId=P.pointerId||0,this.pointerType=typeof P.pointerType=="string"?P.pointerType:nn[P.pointerType]||"",this.state=P.state,this.i=P,P.defaultPrevented&&Xt.aa.h.call(this)}}de(Xt,Qt);var nn={2:"touch",3:"pen",4:"mouse"};Xt.prototype.h=function(){Xt.aa.h.call(this);var P=this.i;P.preventDefault?P.preventDefault():P.returnValue=!1};var Fn="closure_listenable_"+(1e6*Math.random()|0),$n=0;function Jn(P,j,Y,ye,nt){this.listener=P,this.proxy=null,this.src=j,this.type=Y,this.capture=!!ye,this.ha=nt,this.key=++$n,this.da=this.fa=!1}function ur(P){P.da=!0,P.listener=null,P.proxy=null,P.src=null,P.ha=null}function Ji(P){this.src=P,this.g={},this.h=0}Ji.prototype.add=function(P,j,Y,ye,nt){var ft=P.toString();P=this.g[ft],P||(P=this.g[ft]=[],this.h++);var Zt=Hr(P,j,ye,nt);return-1<Zt?(j=P[Zt],Y||(j.fa=!1)):(j=new Jn(j,this.src,ft,!!ye,nt),j.fa=Y,P.push(j)),j};function Ui(P,j){var Y=j.type;if(Y in P.g){var ye=P.g[Y],nt=Array.prototype.indexOf.call(ye,j,void 0),ft;(ft=0<=nt)&&Array.prototype.splice.call(ye,nt,1),ft&&(ur(j),P.g[Y].length==0&&(delete P.g[Y],P.h--))}}function Hr(P,j,Y,ye){for(var nt=0;nt<P.length;++nt){var ft=P[nt];if(!ft.da&&ft.listener==j&&ft.capture==!!Y&&ft.ha==ye)return nt}return-1}var Wi="closure_lm_"+(1e6*Math.random()|0),Qo={};function bs(P,j,Y,ye,nt){if(Array.isArray(j)){for(var ft=0;ft<j.length;ft++)bs(P,j[ft],Y,ye,nt);return null}return Y=Hs(Y),P&&P[Fn]?P.K(j,Y,O(ye)?!!ye.capture:!1,nt):Qr(P,j,Y,!1,ye,nt)}function Qr(P,j,Y,ye,nt,ft){if(!j)throw Error("Invalid event type");var Zt=O(nt)?!!nt.capture:!!nt,Pi=Fo(P);if(Pi||(P[Wi]=Pi=new Ji(P)),Y=Pi.add(j,Y,ye,Zt,ft),Y.proxy)return Y;if(ye=Oo(),Y.proxy=ye,ye.src=P,ye.listener=Y,P.addEventListener)sn||(nt=Zt),nt===void 0&&(nt=!1),P.addEventListener(j.toString(),ye,nt);else if(P.attachEvent)P.attachEvent(Jr(j.toString()),ye);else if(P.addListener&&P.removeListener)P.addListener(ye);else throw Error("addEventListener and attachEvent are unavailable.");return Y}function Oo(){function P(Y){return j.call(P.src,P.listener,Y)}const j=Ts;return P}function Jo(P,j,Y,ye,nt){if(Array.isArray(j))for(var ft=0;ft<j.length;ft++)Jo(P,j[ft],Y,ye,nt);else ye=O(ye)?!!ye.capture:!!ye,Y=Hs(Y),P&&P[Fn]?(P=P.i,j=String(j).toString(),j in P.g&&(ft=P.g[j],Y=Hr(ft,Y,ye,nt),-1<Y&&(ur(ft[Y]),Array.prototype.splice.call(ft,Y,1),ft.length==0&&(delete P.g[j],P.h--)))):P&&(P=Fo(P))&&(j=P.g[j.toString()],P=-1,j&&(P=Hr(j,Y,ye,nt)),(Y=-1<P?j[P]:null)&&vr(Y))}function vr(P){if(typeof P!="number"&&P&&!P.da){var j=P.src;if(j&&j[Fn])Ui(j.i,P);else{var Y=P.type,ye=P.proxy;j.removeEventListener?j.removeEventListener(Y,ye,P.capture):j.detachEvent?j.detachEvent(Jr(Y),ye):j.addListener&&j.removeListener&&j.removeListener(ye),(Y=Fo(j))?(Ui(Y,P),Y.h==0&&(Y.src=null,j[Wi]=null)):ur(P)}}}function Jr(P){return P in Qo?Qo[P]:Qo[P]="on"+P}function Ts(P,j){if(P.da)P=!0;else{j=new Xt(j,this);var Y=P.listener,ye=P.ha||P.src;P.fa&&vr(P),P=Y.call(ye,j)}return P}function Fo(P){return P=P[Wi],P instanceof Ji?P:null}var _a="__closure_events_fn_"+(1e9*Math.random()>>>0);function Hs(P){return typeof P=="function"?P:(P[_a]||(P[_a]=function(j){return P.handleEvent(j)}),P[_a])}function Mi(){wt.call(this),this.i=new Ji(this),this.M=this,this.F=null}de(Mi,wt),Mi.prototype[Fn]=!0,Mi.prototype.removeEventListener=function(P,j,Y,ye){Jo(this,P,j,Y,ye)};function er(P,j){var Y,ye=P.F;if(ye)for(Y=[];ye;ye=ye.F)Y.push(ye);if(P=P.M,ye=j.type||j,typeof j=="string")j=new Qt(j,P);else if(j instanceof Qt)j.target=j.target||P;else{var nt=j;j=new Qt(ye,P),xe(j,nt)}if(nt=!0,Y)for(var ft=Y.length-1;0<=ft;ft--){var Zt=j.g=Y[ft];nt=qr(Zt,ye,!0,j)&&nt}if(Zt=j.g=P,nt=qr(Zt,ye,!0,j)&&nt,nt=qr(Zt,ye,!1,j)&&nt,Y)for(ft=0;ft<Y.length;ft++)Zt=j.g=Y[ft],nt=qr(Zt,ye,!1,j)&&nt}Mi.prototype.N=function(){if(Mi.aa.N.call(this),this.i){var P=this.i,j;for(j in P.g){for(var Y=P.g[j],ye=0;ye<Y.length;ye++)ur(Y[ye]);delete P.g[j],P.h--}}this.F=null},Mi.prototype.K=function(P,j,Y,ye){return this.i.add(String(P),j,!1,Y,ye)},Mi.prototype.L=function(P,j,Y,ye){return this.i.add(String(P),j,!0,Y,ye)};function qr(P,j,Y,ye){if(j=P.i.g[String(j)],!j)return!0;j=j.concat();for(var nt=!0,ft=0;ft<j.length;++ft){var Zt=j[ft];if(Zt&&!Zt.da&&Zt.capture==Y){var Pi=Zt.listener,cr=Zt.ha||Zt.src;Zt.fa&&Ui(P.i,Zt),nt=Pi.call(cr,ye)!==!1&&nt}}return nt&&!ye.defaultPrevented}function qs(P,j,Y){if(typeof P=="function")Y&&(P=re(P,Y));else if(P&&typeof P.handleEvent=="function")P=re(P.handleEvent,P);else throw Error("Invalid listener argument");return 2147483647<Number(j)?-1:u.setTimeout(P,j||0)}function uo(P){P.g=qs(()=>{P.g=null,P.i&&(P.i=!1,uo(P))},P.l);const j=P.h;P.h=null,P.m.apply(null,j)}class es extends wt{constructor(j,Y){super(),this.m=j,this.l=Y,this.h=null,this.i=!1,this.g=null}j(j){this.h=arguments,this.g?this.i=!0:uo(this)}N(){super.N(),this.g&&(u.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Ss(P){wt.call(this),this.h=P,this.g={}}de(Ss,wt);var ya=[];function Bo(P){at(P.g,function(j,Y){this.g.hasOwnProperty(Y)&&vr(j)},P),P.g={}}Ss.prototype.N=function(){Ss.aa.N.call(this),Bo(this)},Ss.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var ve=u.JSON.stringify,se=u.JSON.parse,ce=class{stringify(P){return u.JSON.stringify(P,void 0)}parse(P){return u.JSON.parse(P,void 0)}};function fe(){}fe.prototype.h=null;function Pe(P){return P.h||(P.h=P.i())}function Be(){}var qe={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function tt(){Qt.call(this,"d")}de(tt,Qt);function Ge(){Qt.call(this,"c")}de(Ge,Qt);var ht={},ut=null;function Xe(){return ut=ut||new Mi}ht.La="serverreachability";function Ue(P){Qt.call(this,ht.La,P)}de(Ue,Qt);function zt(P){const j=Xe();er(j,new Ue(j))}ht.STAT_EVENT="statevent";function Nt(P,j){Qt.call(this,ht.STAT_EVENT,P),this.stat=j}de(Nt,Qt);function en(P){const j=Xe();er(j,new Nt(j,P))}ht.Ma="timingevent";function Pn(P,j){Qt.call(this,ht.Ma,P),this.size=j}de(Pn,Qt);function mt(P,j){if(typeof P!="function")throw Error("Fn must not be null and must be a function");return u.setTimeout(function(){P()},j)}function Vt(){this.g=!0}Vt.prototype.xa=function(){this.g=!1};function $t(P,j,Y,ye,nt,ft){P.info(function(){if(P.g)if(ft)for(var Zt="",Pi=ft.split("&"),cr=0;cr<Pi.length;cr++){var ai=Pi[cr].split("=");if(1<ai.length){var wi=ai[0];ai=ai[1];var sr=wi.split("_");Zt=2<=sr.length&&sr[1]=="type"?Zt+(wi+"="+ai+"&"):Zt+(wi+"=redacted&")}}else Zt=null;else Zt=ft;return"XMLHTTP REQ ("+ye+") [attempt "+nt+"]: "+j+`
`+Y+`
`+Zt})}function Lt(P,j,Y,ye,nt,ft,Zt){P.info(function(){return"XMLHTTP RESP ("+ye+") [ attempt "+nt+"]: "+j+`
`+Y+`
`+ft+" "+Zt})}function Nn(P,j,Y,ye){P.info(function(){return"XMLHTTP TEXT ("+j+"): "+Yt(P,Y)+(ye?" "+ye:"")})}function mn(P,j){P.info(function(){return"TIMEOUT: "+j})}Vt.prototype.info=function(){};function Yt(P,j){if(!P.g)return j;if(!j)return null;try{var Y=JSON.parse(j);if(Y){for(P=0;P<Y.length;P++)if(Array.isArray(Y[P])){var ye=Y[P];if(!(2>ye.length)){var nt=ye[1];if(Array.isArray(nt)&&!(1>nt.length)){var ft=nt[0];if(ft!="noop"&&ft!="stop"&&ft!="close")for(var Zt=1;Zt<nt.length;Zt++)nt[Zt]=""}}}}return ve(Y)}catch{return j}}var Ri={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},ts={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Si;function xi(){}de(xi,fe),xi.prototype.g=function(){return new XMLHttpRequest},xi.prototype.i=function(){return{}},Si=new xi;function oi(P,j,Y,ye){this.j=P,this.i=j,this.l=Y,this.R=ye||1,this.U=new Ss(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new co}function co(){this.i=null,this.g="",this.h=!1}var Li={},va={};function Gs(P,j,Y){P.L=1,P.v=Gr(ln(j)),P.m=Y,P.P=!0,ul(P,null)}function ul(P,j){P.F=Date.now(),Ki(P),P.A=ln(P.v);var Y=P.A,ye=P.R;Array.isArray(ye)||(ye=[String(ye)]),fo(Y.i,"t",ye),P.C=0,Y=P.j.J,P.h=new co,P.g=$l(P.j,Y?j:null,!P.m),0<P.O&&(P.M=new es(re(P.Y,P,P.g),P.O)),j=P.U,Y=P.g,ye=P.ca;var nt="readystatechange";Array.isArray(nt)||(nt&&(ya[0]=nt.toString()),nt=ya);for(var ft=0;ft<nt.length;ft++){var Zt=bs(Y,nt[ft],ye||j.handleEvent,!1,j.h||j);if(!Zt)break;j.g[Zt.key]=Zt}j=P.H?te(P.H):{},P.m?(P.u||(P.u="POST"),j["Content-Type"]="application/x-www-form-urlencoded",P.g.ea(P.A,P.u,P.m,j)):(P.u="GET",P.g.ea(P.A,P.u,null,j)),zt(),$t(P.i,P.u,P.A,P.l,P.R,P.m)}oi.prototype.ca=function(P){P=P.target;const j=this.M;j&&mr(P)==3?j.j():this.Y(P)},oi.prototype.Y=function(P){try{if(P==this.g)e:{const sr=mr(this.g);var j=this.g.Ba();const Ms=this.g.Z();if(!(3>sr)&&(sr!=3||this.g&&(this.h.h||this.g.oa()||mo(this.g)))){this.J||sr!=4||j==7||(j==8||0>=Ms?zt(3):zt(2)),cl(this);var Y=this.g.Z();this.X=Y;t:if(xa(this)){var ye=mo(this.g);P="";var nt=ye.length,ft=mr(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){is(this),ns(this);var Zt="";break t}this.h.i=new u.TextDecoder}for(j=0;j<nt;j++)this.h.h=!0,P+=this.h.i.decode(ye[j],{stream:!(ft&&j==nt-1)});ye.length=0,this.h.g+=P,this.C=0,Zt=this.h.g}else Zt=this.g.oa();if(this.o=Y==200,Lt(this.i,this.u,this.A,this.l,this.R,sr,Y),this.o){if(this.T&&!this.K){t:{if(this.g){var Pi,cr=this.g;if((Pi=cr.g?cr.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!et(Pi)){var ai=Pi;break t}}ai=null}if(Y=ai)Nn(this.i,this.l,Y,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Fl(this,Y);else{this.o=!1,this.s=3,en(12),is(this),ns(this);break e}}if(this.P){Y=!0;let gr;for(;!this.J&&this.C<Zt.length;)if(gr=Es(this,Zt),gr==va){sr==4&&(this.s=4,en(14),Y=!1),Nn(this.i,this.l,null,"[Incomplete Response]");break}else if(gr==Li){this.s=4,en(15),Nn(this.i,this.l,Zt,"[Invalid Chunk]"),Y=!1;break}else Nn(this.i,this.l,gr,null),Fl(this,gr);if(xa(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),sr!=4||Zt.length!=0||this.h.h||(this.s=1,en(16),Y=!1),this.o=this.o&&Y,!Y)Nn(this.i,this.l,Zt,"[Invalid Chunked Response]"),is(this),ns(this);else if(0<Zt.length&&!this.W){this.W=!0;var wi=this.j;wi.g==this&&wi.ba&&!wi.M&&(wi.j.info("Great, no buffering proxy detected. Bytes received: "+Zt.length),Ks(wi),wi.M=!0,en(11))}}else Nn(this.i,this.l,Zt,null),Fl(this,Zt);sr==4&&is(this),this.o&&!this.J&&(sr==4?Ul(this.j,this):(this.o=!1,Ki(this)))}else Ps(this.g),Y==400&&0<Zt.indexOf("Unknown SID")?(this.s=3,en(12)):(this.s=0,en(13)),is(this),ns(this)}}}catch{}finally{}};function xa(P){return P.g?P.u=="GET"&&P.L!=2&&P.j.Ca:!1}function Es(P,j){var Y=P.C,ye=j.indexOf(`
`,Y);return ye==-1?va:(Y=Number(j.substring(Y,ye)),isNaN(Y)?Li:(ye+=1,ye+Y>j.length?va:(j=j.slice(ye,ye+Y),P.C=ye+Y,j)))}oi.prototype.cancel=function(){this.J=!0,is(this)};function Ki(P){P.S=Date.now()+P.I,yu(P,P.I)}function yu(P,j){if(P.B!=null)throw Error("WatchDog timer not null");P.B=mt(re(P.ba,P),j)}function cl(P){P.B&&(u.clearTimeout(P.B),P.B=null)}oi.prototype.ba=function(){this.B=null;const P=Date.now();0<=P-this.S?(mn(this.i,this.A),this.L!=2&&(zt(),en(17)),is(this),this.s=2,ns(this)):yu(this,this.S-P)};function ns(P){P.j.G==0||P.J||Ul(P.j,P)}function is(P){cl(P);var j=P.M;j&&typeof j.ma=="function"&&j.ma(),P.M=null,Bo(P.U),P.g&&(j=P.g,P.g=null,j.abort(),j.ma())}function Fl(P,j){try{var Y=P.j;if(Y.G!=0&&(Y.g==P||An(Y.h,P))){if(!P.K&&An(Y.h,P)&&Y.G==3){try{var ye=Y.Da.g.parse(j)}catch{ye=null}if(Array.isArray(ye)&&ye.length==3){var nt=ye;if(nt[0]==0){e:if(!Y.u){if(Y.g)if(Y.g.F+3e3<P.F)no(Y),Cs(Y);else break e;Ws(Y),en(18)}}else Y.za=nt[1],0<Y.za-Y.T&&37500>nt[2]&&Y.F&&Y.v==0&&!Y.C&&(Y.C=mt(re(Y.Za,Y),6e3));if(1>=wa(Y.h)&&Y.ca){try{Y.ca()}catch{}Y.ca=void 0}}else as(Y,11)}else if((P.K||Y.g==P)&&no(Y),!et(j))for(nt=Y.Da.g.parse(j),j=0;j<nt.length;j++){let ai=nt[j];if(Y.T=ai[0],ai=ai[1],Y.G==2)if(ai[0]=="c"){Y.K=ai[1],Y.ia=ai[2];const wi=ai[3];wi!=null&&(Y.la=wi,Y.j.info("VER="+Y.la));const sr=ai[4];sr!=null&&(Y.Aa=sr,Y.j.info("SVER="+Y.Aa));const Ms=ai[5];Ms!=null&&typeof Ms=="number"&&0<Ms&&(ye=1.5*Ms,Y.L=ye,Y.j.info("backChannelRequestTimeoutMs_="+ye)),ye=Y;const gr=P.g;if(gr){const Wa=gr.g?gr.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Wa){var ft=ye.h;ft.g||Wa.indexOf("spdy")==-1&&Wa.indexOf("quic")==-1&&Wa.indexOf("h2")==-1||(ft.j=ft.l,ft.g=new Set,ft.h&&(Di(ft,ft.h),ft.h=null))}if(ye.D){const Rs=gr.g?gr.g.getResponseHeader("X-HTTP-Session-Id"):null;Rs&&(ye.ya=Rs,On(ye.I,ye.D,Rs))}}Y.G=3,Y.l&&Y.l.ua(),Y.ba&&(Y.R=Date.now()-P.F,Y.j.info("Handshake RTT: "+Y.R+"ms")),ye=Y;var Zt=P;if(ye.qa=Za(ye,ye.J?ye.ia:null,ye.W),Zt.K){pl(ye.h,Zt);var Pi=Zt,cr=ye.L;cr&&(Pi.I=cr),Pi.B&&(cl(Pi),Ki(Pi)),ye.g=Zt}else tr(ye);0<Y.i.length&&So(Y)}else ai[0]!="stop"&&ai[0]!="close"||as(Y,7);else Y.G==3&&(ai[0]=="stop"||ai[0]=="close"?ai[0]=="stop"?as(Y,7):or(Y):ai[0]!="noop"&&Y.l&&Y.l.ta(ai),Y.v=0)}}zt(4)}catch{}}var hl=class{constructor(P,j){this.g=P,this.map=j}};function dl(P){this.l=P||10,u.PerformanceNavigationTiming?(P=u.performance.getEntriesByType("navigation"),P=0<P.length&&(P[0].nextHopProtocol=="hq"||P[0].nextHopProtocol=="h2")):P=!!(u.chrome&&u.chrome.loadTimes&&u.chrome.loadTimes()&&u.chrome.loadTimes().wasFetchedViaSpdy),this.j=P?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function bo(P){return P.h?!0:P.g?P.g.size>=P.j:!1}function wa(P){return P.h?1:P.g?P.g.size:0}function An(P,j){return P.h?P.h==j:P.g?P.g.has(j):!1}function Di(P,j){P.g?P.g.add(j):P.h=j}function pl(P,j){P.h&&P.h==j?P.h=null:P.g&&P.g.has(j)&&P.g.delete(j)}dl.prototype.cancel=function(){if(this.i=To(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const P of this.g.values())P.cancel();this.g.clear()}};function To(P){if(P.h!=null)return P.i.concat(P.h.D);if(P.g!=null&&P.g.size!==0){let j=P.i;for(const Y of P.g.values())j=j.concat(Y.D);return j}return Se(P.i)}function rs(P){if(P.V&&typeof P.V=="function")return P.V();if(typeof Map<"u"&&P instanceof Map||typeof Set<"u"&&P instanceof Set)return Array.from(P.values());if(typeof P=="string")return P.split("");if(R(P)){for(var j=[],Y=P.length,ye=0;ye<Y;ye++)j.push(P[ye]);return j}j=[],Y=0;for(ye in P)j[Y++]=P[ye];return j}function Zs(P){if(P.na&&typeof P.na=="function")return P.na();if(!P.V||typeof P.V!="function"){if(typeof Map<"u"&&P instanceof Map)return Array.from(P.keys());if(!(typeof Set<"u"&&P instanceof Set)){if(R(P)||typeof P=="string"){var j=[];P=P.length;for(var Y=0;Y<P;Y++)j.push(Y);return j}j=[],Y=0;for(const ye in P)j[Y++]=ye;return j}}}function Dn(P,j){if(P.forEach&&typeof P.forEach=="function")P.forEach(j,void 0);else if(R(P)||typeof P=="string")Array.prototype.forEach.call(P,j,void 0);else for(var Y=Zs(P),ye=rs(P),nt=ye.length,ft=0;ft<nt;ft++)j.call(void 0,ye[ft],Y&&Y[ft],P)}var fi=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Bl(P,j){if(P){P=P.split("&");for(var Y=0;Y<P.length;Y++){var ye=P[Y].indexOf("="),nt=null;if(0<=ye){var ft=P[Y].substring(0,ye);nt=P[Y].substring(ye+1)}else ft=P[Y];j(ft,nt?decodeURIComponent(nt.replace(/\+/g," ")):"")}}}function Sr(P){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,P instanceof Sr){this.h=P.h,ho(this,P.j),this.o=P.o,this.g=P.g,kn(this,P.s),this.l=P.l;var j=P.i,Y=new Zr;Y.i=j.i,j.g&&(Y.g=new Map(j.g),Y.h=j.h),eo(this,Y),this.m=P.m}else P&&(j=String(P).match(fi))?(this.h=!1,ho(this,j[1]||"",!0),this.o=_n(j[2]||""),this.g=_n(j[3]||"",!0),kn(this,j[4]),this.l=_n(j[5]||"",!0),eo(this,j[6]||"",!0),this.m=_n(j[7]||"")):(this.h=!1,this.i=new Zr(null,this.h))}Sr.prototype.toString=function(){var P=[],j=this.j;j&&P.push(Ei(j,Is,!0),":");var Y=this.g;return(Y||j=="file")&&(P.push("//"),(j=this.o)&&P.push(Ei(j,Is,!0),"@"),P.push(encodeURIComponent(String(Y)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),Y=this.s,Y!=null&&P.push(":",String(Y))),(Y=this.l)&&(this.g&&Y.charAt(0)!="/"&&P.push("/"),P.push(Ei(Y,Y.charAt(0)=="/"?Ir:Er,!0))),(Y=this.i.toString())&&P.push("?",Y),(Y=this.m)&&P.push("#",Ei(Y,Ha)),P.join("")};function ln(P){return new Sr(P)}function ho(P,j,Y){P.j=Y?_n(j,!0):j,P.j&&(P.j=P.j.replace(/:$/,""))}function kn(P,j){if(j){if(j=Number(j),isNaN(j)||0>j)throw Error("Bad port number "+j);P.s=j}else P.s=null}function eo(P,j,Y){j instanceof Zr?(P.i=j,Pr(P.i,P.h)):(Y||(j=Ei(j,xr)),P.i=new Zr(j,P.h))}function On(P,j,Y){P.i.set(j,Y)}function Gr(P){return On(P,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),P}function _n(P,j){return P?j?decodeURI(P.replace(/%25/g,"%2525")):decodeURIComponent(P):""}function Ei(P,j,Y){return typeof P=="string"?(P=encodeURI(P).replace(j,zi),Y&&(P=P.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),P):null}function zi(P){return P=P.charCodeAt(0),"%"+(P>>4&15).toString(16)+(P&15).toString(16)}var Is=/[#\/\?@]/g,Er=/[#\?:]/g,Ir=/[#\?]/g,xr=/[#\?@]/g,Ha=/#/g;function Zr(P,j){this.h=this.g=null,this.i=P||null,this.j=!!j}function Bn(P){P.g||(P.g=new Map,P.h=0,P.i&&Bl(P.i,function(j,Y){P.add(decodeURIComponent(j.replace(/\+/g," ")),Y)}))}i=Zr.prototype,i.add=function(P,j){Bn(this),this.i=null,P=hn(this,P);var Y=this.g.get(P);return Y||this.g.set(P,Y=[]),Y.push(j),this.h+=1,this};function po(P,j){Bn(P),j=hn(P,j),P.g.has(j)&&(P.i=null,P.h-=P.g.get(j).length,P.g.delete(j))}function wr(P,j){return Bn(P),j=hn(P,j),P.g.has(j)}i.forEach=function(P,j){Bn(this),this.g.forEach(function(Y,ye){Y.forEach(function(nt){P.call(j,nt,ye,this)},this)},this)},i.na=function(){Bn(this);const P=Array.from(this.g.values()),j=Array.from(this.g.keys()),Y=[];for(let ye=0;ye<j.length;ye++){const nt=P[ye];for(let ft=0;ft<nt.length;ft++)Y.push(j[ye])}return Y},i.V=function(P){Bn(this);let j=[];if(typeof P=="string")wr(this,P)&&(j=j.concat(this.g.get(hn(this,P))));else{P=Array.from(this.g.values());for(let Y=0;Y<P.length;Y++)j=j.concat(P[Y])}return j},i.set=function(P,j){return Bn(this),this.i=null,P=hn(this,P),wr(this,P)&&(this.h-=this.g.get(P).length),this.g.set(P,[j]),this.h+=1,this},i.get=function(P,j){return P?(P=this.V(P),0<P.length?String(P[0]):j):j};function fo(P,j,Y){po(P,j),0<Y.length&&(P.i=null,P.g.set(hn(P,j),Se(Y)),P.h+=Y.length)}i.toString=function(){if(this.i)return this.i;if(!this.g)return"";const P=[],j=Array.from(this.g.keys());for(var Y=0;Y<j.length;Y++){var ye=j[Y];const ft=encodeURIComponent(String(ye)),Zt=this.V(ye);for(ye=0;ye<Zt.length;ye++){var nt=ft;Zt[ye]!==""&&(nt+="="+encodeURIComponent(String(Zt[ye]))),P.push(nt)}}return this.i=P.join("&")};function hn(P,j){return j=String(j),P.j&&(j=j.toLowerCase()),j}function Pr(P,j){j&&!P.j&&(Bn(P),P.i=null,P.g.forEach(function(Y,ye){var nt=ye.toLowerCase();ye!=nt&&(po(this,ye),fo(this,nt,Y))},P)),P.j=j}function si(P,j){const Y=new Vt;if(u.Image){const ye=new Image;ye.onload=Q(Kn,Y,"TestLoadImage: loaded",!0,j,ye),ye.onerror=Q(Kn,Y,"TestLoadImage: error",!1,j,ye),ye.onabort=Q(Kn,Y,"TestLoadImage: abort",!1,j,ye),ye.ontimeout=Q(Kn,Y,"TestLoadImage: timeout",!1,j,ye),u.setTimeout(function(){ye.ontimeout&&ye.ontimeout()},1e4),ye.src=P}else j(!1)}function fl(P,j){const Y=new Vt,ye=new AbortController,nt=setTimeout(()=>{ye.abort(),Kn(Y,"TestPingServer: timeout",!1,j)},1e4);fetch(P,{signal:ye.signal}).then(ft=>{clearTimeout(nt),ft.ok?Kn(Y,"TestPingServer: ok",!0,j):Kn(Y,"TestPingServer: server error",!1,j)}).catch(()=>{clearTimeout(nt),Kn(Y,"TestPingServer: error",!1,j)})}function Kn(P,j,Y,ye,nt){try{nt&&(nt.onload=null,nt.onerror=null,nt.onabort=null,nt.ontimeout=null),ye(Y)}catch{}}function ba(){this.g=new ce}function Wn(P,j,Y){const ye=Y||"";try{Dn(P,function(nt,ft){let Zt=nt;O(nt)&&(Zt=ve(nt)),j.push(ye+ft+"="+encodeURIComponent(Zt))})}catch(nt){throw j.push(ye+"type="+encodeURIComponent("_badmap")),nt}}function xn(P){this.l=P.Ub||null,this.j=P.eb||!1}de(xn,fe),xn.prototype.g=function(){return new os(this.l,this.j)},xn.prototype.i=function(P){return function(){return P}}({});function os(P,j){Mi.call(this),this.D=P,this.o=j,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}de(os,Mi),i=os.prototype,i.open=function(P,j){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=P,this.A=j,this.readyState=1,Xi(this)},i.send=function(P){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const j={headers:this.u,method:this.B,credentials:this.m,cache:void 0};P&&(j.body=P),(this.D||u).fetch(new Request(this.A,j)).then(this.Sa.bind(this),this.ga.bind(this))},i.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,gi(this)),this.readyState=0},i.Sa=function(P){if(this.g&&(this.l=P,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=P.headers,this.readyState=2,Xi(this)),this.g&&(this.readyState=3,Xi(this),this.g)))if(this.responseType==="arraybuffer")P.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof u.ReadableStream<"u"&&"body"in P){if(this.j=P.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Hn(this)}else P.text().then(this.Ra.bind(this),this.ga.bind(this))};function Hn(P){P.j.read().then(P.Pa.bind(P)).catch(P.ga.bind(P))}i.Pa=function(P){if(this.g){if(this.o&&P.value)this.response.push(P.value);else if(!this.o){var j=P.value?P.value:new Uint8Array(0);(j=this.v.decode(j,{stream:!P.done}))&&(this.response=this.responseText+=j)}P.done?gi(this):Xi(this),this.readyState==3&&Hn(this)}},i.Ra=function(P){this.g&&(this.response=this.responseText=P,gi(this))},i.Qa=function(P){this.g&&(this.response=P,gi(this))},i.ga=function(){this.g&&gi(this)};function gi(P){P.readyState=4,P.l=null,P.j=null,P.v=null,Xi(P)}i.setRequestHeader=function(P,j){this.u.append(P,j)},i.getResponseHeader=function(P){return this.h&&this.h.get(P.toLowerCase())||""},i.getAllResponseHeaders=function(){if(!this.h)return"";const P=[],j=this.h.entries();for(var Y=j.next();!Y.done;)Y=Y.value,P.push(Y[0]+": "+Y[1]),Y=j.next();return P.join(`\r
`)};function Xi(P){P.onreadystatechange&&P.onreadystatechange.call(P)}Object.defineProperty(os.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(P){this.m=P?"include":"same-origin"}});function Vo(P){let j="";return at(P,function(Y,ye){j+=ye,j+=":",j+=Y,j+=`\r
`}),j}function ss(P,j,Y){e:{for(ye in Y){var ye=!1;break e}ye=!0}ye||(Y=Vo(Y),typeof P=="string"?Y!=null&&encodeURIComponent(String(Y)):On(P,j,Y))}function ji(P){Mi.call(this),this.headers=new Map,this.o=P||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}de(ji,Mi);var Ta=/^https?$/i,ml=["POST","PUT"];i=ji.prototype,i.Ha=function(P){this.J=P},i.ea=function(P,j,Y,ye){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+P);j=j?j.toUpperCase():"GET",this.D=P,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Si.g(),this.v=this.o?Pe(this.o):Pe(Si),this.g.onreadystatechange=re(this.Ea,this);try{this.B=!0,this.g.open(j,String(P),!0),this.B=!1}catch(ft){qa(this,ft);return}if(P=Y||"",Y=new Map(this.headers),ye)if(Object.getPrototypeOf(ye)===Object.prototype)for(var nt in ye)Y.set(nt,ye[nt]);else if(typeof ye.keys=="function"&&typeof ye.get=="function")for(const ft of ye.keys())Y.set(ft,ye.get(ft));else throw Error("Unknown input type for opt_headers: "+String(ye));ye=Array.from(Y.keys()).find(ft=>ft.toLowerCase()=="content-type"),nt=u.FormData&&P instanceof u.FormData,!(0<=Array.prototype.indexOf.call(ml,j,void 0))||ye||nt||Y.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[ft,Zt]of Y)this.g.setRequestHeader(ft,Zt);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{qn(this),this.u=!0,this.g.send(P),this.u=!1}catch(ft){qa(this,ft)}};function qa(P,j){P.h=!1,P.g&&(P.j=!0,P.g.abort(),P.j=!1),P.l=j,P.m=5,Ga(P),to(P)}function Ga(P){P.A||(P.A=!0,er(P,"complete"),er(P,"error"))}i.abort=function(P){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=P||7,er(this,"complete"),er(this,"abort"),to(this))},i.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),to(this,!0)),ji.aa.N.call(this)},i.Ea=function(){this.s||(this.B||this.u||this.j?ei(this):this.bb())},i.bb=function(){ei(this)};function ei(P){if(P.h&&typeof _<"u"&&(!P.v[1]||mr(P)!=4||P.Z()!=2)){if(P.u&&mr(P)==4)qs(P.Ea,0,P);else if(er(P,"readystatechange"),mr(P)==4){P.h=!1;try{const Zt=P.Z();e:switch(Zt){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var j=!0;break e;default:j=!1}var Y;if(!(Y=j)){var ye;if(ye=Zt===0){var nt=String(P.D).match(fi)[1]||null;!nt&&u.self&&u.self.location&&(nt=u.self.location.protocol.slice(0,-1)),ye=!Ta.test(nt?nt.toLowerCase():"")}Y=ye}if(Y)er(P,"complete"),er(P,"success");else{P.m=6;try{var ft=2<mr(P)?P.g.statusText:""}catch{ft=""}P.l=ft+" ["+P.Z()+"]",Ga(P)}}finally{to(P)}}}}function to(P,j){if(P.g){qn(P);const Y=P.g,ye=P.v[0]?()=>{}:null;P.g=null,P.v=null,j||er(P,"ready");try{Y.onreadystatechange=ye}catch{}}}function qn(P){P.I&&(u.clearTimeout(P.I),P.I=null)}i.isActive=function(){return!!this.g};function mr(P){return P.g?P.g.readyState:0}i.Z=function(){try{return 2<mr(this)?this.g.status:-1}catch{return-1}},i.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},i.Oa=function(P){if(this.g){var j=this.g.responseText;return P&&j.indexOf(P)==0&&(j=j.substring(P.length)),se(j)}};function mo(P){try{if(!P.g)return null;if("response"in P.g)return P.g.response;switch(P.H){case"":case"text":return P.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in P.g)return P.g.mozResponseArrayBuffer}return null}catch{return null}}function Ps(P){const j={};P=(P.g&&2<=mr(P)&&P.g.getAllResponseHeaders()||"").split(`\r
`);for(let ye=0;ye<P.length;ye++){if(et(P[ye]))continue;var Y=Ae(P[ye]);const nt=Y[0];if(Y=Y[1],typeof Y!="string")continue;Y=Y.trim();const ft=j[nt]||[];j[nt]=ft,ft.push(Y)}be(j,function(ye){return ye.join(", ")})}i.Ba=function(){return this.m},i.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Ii(P,j,Y){return Y&&Y.internalChannelParams&&Y.internalChannelParams[P]||j}function Vl(P){this.Aa=0,this.i=[],this.j=new Vt,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Ii("failFast",!1,P),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Ii("baseRetryDelayMs",5e3,P),this.cb=Ii("retryDelaySeedMs",1e4,P),this.Wa=Ii("forwardChannelMaxRetries",2,P),this.wa=Ii("forwardChannelRequestTimeoutMs",2e4,P),this.pa=P&&P.xmlHttpFactory||void 0,this.Xa=P&&P.Tb||void 0,this.Ca=P&&P.useFetchStreams||!1,this.L=void 0,this.J=P&&P.supportsCrossDomainXhr||!1,this.K="",this.h=new dl(P&&P.concurrentRequestLimit),this.Da=new ba,this.P=P&&P.fastHandshake||!1,this.O=P&&P.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=P&&P.Rb||!1,P&&P.xa&&this.j.xa(),P&&P.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&P&&P.detectBufferingProxy||!1,this.ja=void 0,P&&P.longPollingTimeout&&0<P.longPollingTimeout&&(this.ja=P.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}i=Vl.prototype,i.la=8,i.G=1,i.connect=function(P,j,Y,ye){en(0),this.W=P,this.H=j||{},Y&&ye!==void 0&&(this.H.OSID=Y,this.H.OAID=ye),this.F=this.X,this.I=Za(this,null,this.W),So(this)};function or(P){if(vu(P),P.G==3){var j=P.U++,Y=ln(P.I);if(On(Y,"SID",P.K),On(Y,"RID",j),On(Y,"TYPE","terminate"),As(P,Y),j=new oi(P,P.j,j),j.L=2,j.v=Gr(ln(Y)),Y=!1,u.navigator&&u.navigator.sendBeacon)try{Y=u.navigator.sendBeacon(j.v.toString(),"")}catch{}!Y&&u.Image&&(new Image().src=j.v,Y=!0),Y||(j.g=$l(j.j,null),j.g.ea(j.v)),j.F=Date.now(),Ki(j)}_l(P)}function Cs(P){P.g&&(Ks(P),P.g.cancel(),P.g=null)}function vu(P){Cs(P),P.u&&(u.clearTimeout(P.u),P.u=null),no(P),P.h.cancel(),P.s&&(typeof P.s=="number"&&u.clearTimeout(P.s),P.s=null)}function So(P){if(!bo(P.h)&&!P.s){P.s=!0;var j=P.Ga;jn||St(),Tt||(jn(),Tt=!0),gn.add(j,P),P.B=0}}function $u(P,j){return wa(P.h)>=P.h.j-(P.s?1:0)?!1:P.s?(P.i=j.D.concat(P.i),!0):P.G==1||P.G==2||P.B>=(P.Va?0:P.Wa)?!1:(P.s=mt(re(P.Ga,P,j),jl(P,P.B)),P.B++,!0)}i.Ga=function(P){if(this.s)if(this.s=null,this.G==1){if(!P){this.U=Math.floor(1e5*Math.random()),P=this.U++;const nt=new oi(this,this.j,P);let ft=this.o;if(this.S&&(ft?(ft=te(ft),xe(ft,this.S)):ft=this.S),this.m!==null||this.O||(nt.H=ft,ft=null),this.P)e:{for(var j=0,Y=0;Y<this.i.length;Y++){t:{var ye=this.i[Y];if("__data__"in ye.map&&(ye=ye.map.__data__,typeof ye=="string")){ye=ye.length;break t}ye=void 0}if(ye===void 0)break;if(j+=ye,4096<j){j=Y;break e}if(j===4096||Y===this.i.length-1){j=Y+1;break e}}j=1e3}else j=1e3;j=Io(this,nt,j),Y=ln(this.I),On(Y,"RID",P),On(Y,"CVER",22),this.D&&On(Y,"X-HTTP-Session-Id",this.D),As(this,Y),ft&&(this.O?j="headers="+encodeURIComponent(String(Vo(ft)))+"&"+j:this.m&&ss(Y,this.m,ft)),Di(this.h,nt),this.Ua&&On(Y,"TYPE","init"),this.P?(On(Y,"$req",j),On(Y,"SID","null"),nt.T=!0,Gs(nt,Y,null)):Gs(nt,Y,j),this.G=2}}else this.G==3&&(P?Eo(this,P):this.i.length==0||bo(this.h)||Eo(this))};function Eo(P,j){var Y;j?Y=j.l:Y=P.U++;const ye=ln(P.I);On(ye,"SID",P.K),On(ye,"RID",Y),On(ye,"AID",P.T),As(P,ye),P.m&&P.o&&ss(ye,P.m,P.o),Y=new oi(P,P.j,Y,P.B+1),P.m===null&&(Y.H=P.o),j&&(P.i=j.D.concat(P.i)),j=Io(P,Y,1e3),Y.I=Math.round(.5*P.wa)+Math.round(.5*P.wa*Math.random()),Di(P.h,Y),Gs(Y,ye,j)}function As(P,j){P.H&&at(P.H,function(Y,ye){On(j,ye,Y)}),P.l&&Dn({},function(Y,ye){On(j,ye,Y)})}function Io(P,j,Y){Y=Math.min(P.i.length,Y);var ye=P.l?re(P.l.Na,P.l,P):null;e:{var nt=P.i;let ft=-1;for(;;){const Zt=["count="+Y];ft==-1?0<Y?(ft=nt[0].g,Zt.push("ofs="+ft)):ft=0:Zt.push("ofs="+ft);let Pi=!0;for(let cr=0;cr<Y;cr++){let ai=nt[cr].g;const wi=nt[cr].map;if(ai-=ft,0>ai)ft=Math.max(0,nt[cr].g-100),Pi=!1;else try{Wn(wi,Zt,"req"+ai+"_")}catch{ye&&ye(wi)}}if(Pi){ye=Zt.join("&");break e}}}return P=P.i.splice(0,Y),j.D=P,ye}function tr(P){if(!P.g&&!P.u){P.Y=1;var j=P.Fa;jn||St(),Tt||(jn(),Tt=!0),gn.add(j,P),P.v=0}}function Ws(P){return P.g||P.u||3<=P.v?!1:(P.Y++,P.u=mt(re(P.Fa,P),jl(P,P.v)),P.v++,!0)}i.Fa=function(){if(this.u=null,gl(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var P=2*this.R;this.j.info("BP detection timer enabled: "+P),this.A=mt(re(this.ab,this),P)}},i.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,en(10),Cs(this),gl(this))};function Ks(P){P.A!=null&&(u.clearTimeout(P.A),P.A=null)}function gl(P){P.g=new oi(P,P.j,"rpc",P.Y),P.m===null&&(P.g.H=P.o),P.g.O=0;var j=ln(P.qa);On(j,"RID","rpc"),On(j,"SID",P.K),On(j,"AID",P.T),On(j,"CI",P.F?"0":"1"),!P.F&&P.ja&&On(j,"TO",P.ja),On(j,"TYPE","xmlhttp"),As(P,j),P.m&&P.o&&ss(j,P.m,P.o),P.L&&(P.g.I=P.L);var Y=P.g;P=P.ia,Y.L=1,Y.v=Gr(ln(j)),Y.m=null,Y.P=!0,ul(Y,P)}i.Za=function(){this.C!=null&&(this.C=null,Cs(this),Ws(this),en(19))};function no(P){P.C!=null&&(u.clearTimeout(P.C),P.C=null)}function Ul(P,j){var Y=null;if(P.g==j){no(P),Ks(P),P.g=null;var ye=2}else if(An(P.h,j))Y=j.D,pl(P.h,j),ye=1;else return;if(P.G!=0){if(j.o)if(ye==1){Y=j.m?j.m.length:0,j=Date.now()-j.F;var nt=P.B;ye=Xe(),er(ye,new Pn(ye,Y)),So(P)}else tr(P);else if(nt=j.s,nt==3||nt==0&&0<j.X||!(ye==1&&$u(P,j)||ye==2&&Ws(P)))switch(Y&&0<Y.length&&(j=P.h,j.i=j.i.concat(Y)),nt){case 1:as(P,5);break;case 4:as(P,10);break;case 3:as(P,6);break;default:as(P,2)}}}function jl(P,j){let Y=P.Ta+Math.floor(Math.random()*P.cb);return P.isActive()||(Y*=2),Y*j}function as(P,j){if(P.j.info("Error code "+j),j==2){var Y=re(P.fb,P),ye=P.Xa;const nt=!ye;ye=new Sr(ye||"//www.google.com/images/cleardot.gif"),u.location&&u.location.protocol=="http"||ho(ye,"https"),Gr(ye),nt?si(ye.toString(),Y):fl(ye.toString(),Y)}else en(2);P.G=0,P.l&&P.l.sa(j),_l(P),vu(P)}i.fb=function(P){P?(this.j.info("Successfully pinged google.com"),en(2)):(this.j.info("Failed to ping google.com"),en(1))};function _l(P){if(P.G=0,P.ka=[],P.l){const j=To(P.h);(j.length!=0||P.i.length!=0)&&(De(P.ka,j),De(P.ka,P.i),P.h.i.length=0,Se(P.i),P.i.length=0),P.l.ra()}}function Za(P,j,Y){var ye=Y instanceof Sr?ln(Y):new Sr(Y);if(ye.g!="")j&&(ye.g=j+"."+ye.g),kn(ye,ye.s);else{var nt=u.location;ye=nt.protocol,j=j?j+"."+nt.hostname:nt.hostname,nt=+nt.port;var ft=new Sr(null);ye&&ho(ft,ye),j&&(ft.g=j),nt&&kn(ft,nt),Y&&(ft.l=Y),ye=ft}return Y=P.D,j=P.ya,Y&&j&&On(ye,Y,j),On(ye,"VER",P.la),As(P,ye),ye}function $l(P,j,Y){if(j&&!P.J)throw Error("Can't create secondary domain capable XhrIo object.");return j=P.Ca&&!P.pa?new ji(new xn({eb:Y})):new ji(P.pa),j.Ha(P.J),j}i.isActive=function(){return!!this.l&&this.l.isActive(this)};function Hl(){}i=Hl.prototype,i.ua=function(){},i.ta=function(){},i.sa=function(){},i.ra=function(){},i.isActive=function(){return!0},i.Na=function(){};function ls(){}ls.prototype.g=function(P,j){return new Wr(P,j)};function Wr(P,j){Mi.call(this),this.g=new Vl(j),this.l=P,this.h=j&&j.messageUrlParams||null,P=j&&j.messageHeaders||null,j&&j.clientProtocolHeaderRequired&&(P?P["X-Client-Protocol"]="webchannel":P={"X-Client-Protocol":"webchannel"}),this.g.o=P,P=j&&j.initMessageHeaders||null,j&&j.messageContentType&&(P?P["X-WebChannel-Content-Type"]=j.messageContentType:P={"X-WebChannel-Content-Type":j.messageContentType}),j&&j.va&&(P?P["X-WebChannel-Client-Profile"]=j.va:P={"X-WebChannel-Client-Profile":j.va}),this.g.S=P,(P=j&&j.Sb)&&!et(P)&&(this.g.m=P),this.v=j&&j.supportsCrossDomainXhr||!1,this.u=j&&j.sendRawJson||!1,(j=j&&j.httpSessionIdParam)&&!et(j)&&(this.g.D=j,P=this.h,P!==null&&j in P&&(P=this.h,j in P&&delete P[j])),this.j=new Po(this)}de(Wr,Mi),Wr.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Wr.prototype.close=function(){or(this.g)},Wr.prototype.o=function(P){var j=this.g;if(typeof P=="string"){var Y={};Y.__data__=P,P=Y}else this.u&&(Y={},Y.__data__=ve(P),P=Y);j.i.push(new hl(j.Ya++,P)),j.G==3&&So(j)},Wr.prototype.N=function(){this.g.l=null,delete this.j,or(this.g),delete this.g,Wr.aa.N.call(this)};function ks(P){tt.call(this),P.__headers__&&(this.headers=P.__headers__,this.statusCode=P.__status__,delete P.__headers__,delete P.__status__);var j=P.__sm__;if(j){e:{for(const Y in j){P=Y;break e}P=void 0}(this.i=P)&&(P=this.i,j=j!==null&&P in j?j[P]:void 0),this.data=j}else this.data=P}de(ks,tt);function Pc(){Ge.call(this),this.status=1}de(Pc,Ge);function Po(P){this.g=P}de(Po,Hl),Po.prototype.ua=function(){er(this.g,"a")},Po.prototype.ta=function(P){er(this.g,new ks(P))},Po.prototype.sa=function(P){er(this.g,new Pc)},Po.prototype.ra=function(){er(this.g,"b")},ls.prototype.createWebChannel=ls.prototype.g,Wr.prototype.send=Wr.prototype.o,Wr.prototype.open=Wr.prototype.m,Wr.prototype.close=Wr.prototype.close,L2=function(){return new ls},R2=function(){return Xe()},M2=ht,b0={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Ri.NO_ERROR=0,Ri.TIMEOUT=8,Ri.HTTP_ERROR=6,H_=Ri,ts.COMPLETE="complete",k2=ts,Be.EventType=qe,qe.OPEN="a",qe.CLOSE="b",qe.ERROR="c",qe.MESSAGE="d",Mi.prototype.listen=Mi.prototype.K,eg=Be,ji.prototype.listenOnce=ji.prototype.L,ji.prototype.getLastError=ji.prototype.Ka,ji.prototype.getLastErrorCode=ji.prototype.Ba,ji.prototype.getStatus=ji.prototype.Z,ji.prototype.getResponseJson=ji.prototype.Oa,ji.prototype.getResponseText=ji.prototype.oa,ji.prototype.send=ji.prototype.ea,ji.prototype.setWithCredentials=ji.prototype.Ha,A2=ji}).apply(typeof I_<"u"?I_:typeof self<"u"?self:typeof window<"u"?window:{});const zb="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ua{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Ua.UNAUTHENTICATED=new Ua(null),Ua.GOOGLE_CREDENTIALS=new Ua("google-credentials-uid"),Ua.FIRST_PARTY=new Ua("first-party-uid"),Ua.MOCK_USER=new Ua("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let om="11.2.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mp=new By("@firebase/firestore");function kf(){return Mp.logLevel}function fn(i,...e){if(Mp.logLevel<=Ai.DEBUG){const t=e.map(lx);Mp.debug(`Firestore (${om}): ${i}`,...t)}}function Qh(i,...e){if(Mp.logLevel<=Ai.ERROR){const t=e.map(lx);Mp.error(`Firestore (${om}): ${i}`,...t)}}function Gf(i,...e){if(Mp.logLevel<=Ai.WARN){const t=e.map(lx);Mp.warn(`Firestore (${om}): ${i}`,...t)}}function lx(i){if(typeof i=="string")return i;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(t){return JSON.stringify(t)}(i)}catch{return i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xn(i="Unexpected state"){const e=`FIRESTORE (${om}) INTERNAL ASSERTION FAILED: `+i;throw Qh(e),new Error(e)}function fr(i,e){i||Xn()}function ii(i,e){return i}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rt={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class vn extends Ic{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nd{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D2{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class qk{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Ua.UNAUTHENTICATED))}shutdown(){}}class Gk{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class Zk{constructor(e){this.t=e,this.currentUser=Ua.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){fr(this.o===void 0);let o=this.i;const h=R=>this.i!==o?(o=this.i,t(R)):Promise.resolve();let g=new Nd;this.o=()=>{this.i++,this.currentUser=this.u(),g.resolve(),g=new Nd,e.enqueueRetryable(()=>h(this.currentUser))};const _=()=>{const R=g;e.enqueueRetryable(async()=>{await R.promise,await h(this.currentUser)})},u=R=>{fn("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=R,this.o&&(this.auth.addAuthTokenListener(this.o),_())};this.t.onInit(R=>u(R)),setTimeout(()=>{if(!this.auth){const R=this.t.getImmediate({optional:!0});R?u(R):(fn("FirebaseAuthCredentialsProvider","Auth not yet detected"),g.resolve(),g=new Nd)}},0),_()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(o=>this.i!==e?(fn("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):o?(fr(typeof o.accessToken=="string"),new D2(o.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return fr(e===null||typeof e=="string"),new Ua(e)}}class Wk{constructor(e,t,o){this.l=e,this.h=t,this.P=o,this.type="FirstParty",this.user=Ua.FIRST_PARTY,this.T=new Map}I(){return this.P?this.P():null}get headers(){this.T.set("X-Goog-AuthUser",this.l);const e=this.I();return e&&this.T.set("Authorization",e),this.h&&this.T.set("X-Goog-Iam-Authorization-Token",this.h),this.T}}class Kk{constructor(e,t,o){this.l=e,this.h=t,this.P=o}getToken(){return Promise.resolve(new Wk(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(Ua.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Xk{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Yk{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){fr(this.o===void 0);const o=g=>{g.error!=null&&fn("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${g.error.message}`);const _=g.token!==this.R;return this.R=g.token,fn("FirebaseAppCheckTokenProvider",`Received ${_?"new":"existing"} token.`),_?t(g.token):Promise.resolve()};this.o=g=>{e.enqueueRetryable(()=>o(g))};const h=g=>{fn("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=g,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(g=>h(g)),setTimeout(()=>{if(!this.appCheck){const g=this.A.getImmediate({optional:!0});g?h(g):fn("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(fr(typeof t.token=="string"),this.R=t.token,new Xk(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qk(i){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(i);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let o=0;o<i;o++)t[o]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class z2{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let o="";for(;o.length<20;){const h=Qk(40);for(let g=0;g<h.length;++g)o.length<20&&h[g]<t&&(o+=e.charAt(h[g]%e.length))}return o}}function Vi(i,e){return i<e?-1:i>e?1:0}function Zf(i,e,t){return i.length===e.length&&i.every((o,h)=>t(o,e[h]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xs{static now(){return xs.fromMillis(Date.now())}static fromDate(e){return xs.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),o=Math.floor(1e6*(e-1e3*t));return new xs(t,o)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new vn(Rt.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new vn(Rt.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new vn(Rt.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new vn(Rt.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Vi(this.nanoseconds,e.nanoseconds):Vi(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ni{static fromTimestamp(e){return new ni(e)}static min(){return new ni(new xs(0,0))}static max(){return new ni(new xs(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nh{constructor(e,t,o){t===void 0?t=0:t>e.length&&Xn(),o===void 0?o=e.length-t:o>e.length-t&&Xn(),this.segments=e,this.offset=t,this.len=o}get length(){return this.len}isEqual(e){return nh.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof nh?e.forEach(o=>{t.push(o)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,o=this.limit();t<o;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const o=Math.min(e.length,t.length);for(let h=0;h<o;h++){const g=nh.compareSegments(e.get(h),t.get(h));if(g!==0)return g}return Math.sign(e.length-t.length)}static compareSegments(e,t){const o=nh.isNumericId(e),h=nh.isNumericId(t);return o&&!h?-1:!o&&h?1:o&&h?nh.extractNumericId(e).compare(nh.extractNumericId(t)):e<t?-1:e>t?1:0}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return zd.fromString(e.substring(4,e.length-2))}}class $r extends nh{construct(e,t,o){return new $r(e,t,o)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const o of e){if(o.indexOf("//")>=0)throw new vn(Rt.INVALID_ARGUMENT,`Invalid segment (${o}). Paths must not contain // in them.`);t.push(...o.split("/").filter(h=>h.length>0))}return new $r(t)}static emptyPath(){return new $r([])}}const Jk=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class ma extends nh{construct(e,t,o){return new ma(e,t,o)}static isValidIdentifier(e){return Jk.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ma.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new ma(["__name__"])}static fromServerFormat(e){const t=[];let o="",h=0;const g=()=>{if(o.length===0)throw new vn(Rt.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(o),o=""};let _=!1;for(;h<e.length;){const u=e[h];if(u==="\\"){if(h+1===e.length)throw new vn(Rt.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const R=e[h+1];if(R!=="\\"&&R!=="."&&R!=="`")throw new vn(Rt.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);o+=R,h+=2}else u==="`"?(_=!_,h++):u!=="."||_?(o+=u,h++):(g(),h++)}if(g(),_)throw new vn(Rt.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new ma(t)}static emptyPath(){return new ma([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zn{constructor(e){this.path=e}static fromPath(e){return new zn($r.fromString(e))}static fromName(e){return new zn($r.fromString(e).popFirst(5))}static empty(){return new zn($r.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&$r.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return $r.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new zn(new $r(e.slice()))}}function eM(i,e){const t=i.toTimestamp().seconds,o=i.toTimestamp().nanoseconds+1,h=ni.fromTimestamp(o===1e9?new xs(t+1,0):new xs(t,o));return new Fd(h,zn.empty(),e)}function tM(i){return new Fd(i.readTime,i.key,-1)}class Fd{constructor(e,t,o){this.readTime=e,this.documentKey=t,this.largestBatchId=o}static min(){return new Fd(ni.min(),zn.empty(),-1)}static max(){return new Fd(ni.max(),zn.empty(),-1)}}function nM(i,e){let t=i.readTime.compareTo(e.readTime);return t!==0?t:(t=zn.comparator(i.documentKey,e.documentKey),t!==0?t:Vi(i.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iM="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class rM{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function sm(i){if(i.code!==Rt.FAILED_PRECONDITION||i.message!==iM)throw i;fn("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mt{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Xn(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new Mt((o,h)=>{this.nextCallback=g=>{this.wrapSuccess(e,g).next(o,h)},this.catchCallback=g=>{this.wrapFailure(t,g).next(o,h)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof Mt?t:Mt.resolve(t)}catch(t){return Mt.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):Mt.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):Mt.reject(t)}static resolve(e){return new Mt((t,o)=>{t(e)})}static reject(e){return new Mt((t,o)=>{o(e)})}static waitFor(e){return new Mt((t,o)=>{let h=0,g=0,_=!1;e.forEach(u=>{++h,u.next(()=>{++g,_&&g===h&&t()},R=>o(R))}),_=!0,g===h&&t()})}static or(e){let t=Mt.resolve(!1);for(const o of e)t=t.next(h=>h?Mt.resolve(h):o());return t}static forEach(e,t){const o=[];return e.forEach((h,g)=>{o.push(t.call(this,h,g))}),this.waitFor(o)}static mapArray(e,t){return new Mt((o,h)=>{const g=e.length,_=new Array(g);let u=0;for(let R=0;R<g;R++){const O=R;t(e[O]).next(G=>{_[O]=G,++u,u===g&&o(_)},G=>h(G))}})}static doWhile(e,t){return new Mt((o,h)=>{const g=()=>{e()===!0?t().next(()=>{g()},h):o()};g()})}}function oM(i){const e=i.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function am(i){return i.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vy{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=o=>this.ie(o),this.se=o=>t.writeSequenceNumber(o))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}Vy.oe=-1;function Uy(i){return i==null}function ly(i){return i===0&&1/i==-1/0}function sM(i){return typeof i=="number"&&Number.isInteger(i)&&!ly(i)&&i<=Number.MAX_SAFE_INTEGER&&i>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aM(i){let e="";for(let t=0;t<i.length;t++)e.length>0&&(e=Nb(e)),e=lM(i.get(t),e);return Nb(e)}function lM(i,e){let t=e;const o=i.length;for(let h=0;h<o;h++){const g=i.charAt(h);switch(g){case"\0":t+="";break;case"":t+="";break;default:t+=g}}return t}function Nb(i){return i+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ob(i){let e=0;for(const t in i)Object.prototype.hasOwnProperty.call(i,t)&&e++;return e}function Vp(i,e){for(const t in i)Object.prototype.hasOwnProperty.call(i,t)&&e(t,i[t])}function N2(i){for(const e in i)if(Object.prototype.hasOwnProperty.call(i,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lo{constructor(e,t){this.comparator=e,this.root=t||fa.EMPTY}insert(e,t){return new lo(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,fa.BLACK,null,null))}remove(e){return new lo(this.comparator,this.root.remove(e,this.comparator).copy(null,null,fa.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const o=this.comparator(e,t.key);if(o===0)return t.value;o<0?t=t.left:o>0&&(t=t.right)}return null}indexOf(e){let t=0,o=this.root;for(;!o.isEmpty();){const h=this.comparator(e,o.key);if(h===0)return t+o.left.size;h<0?o=o.left:(t+=o.left.size+1,o=o.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,o)=>(e(t,o),!1))}toString(){const e=[];return this.inorderTraversal((t,o)=>(e.push(`${t}:${o}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new P_(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new P_(this.root,e,this.comparator,!1)}getReverseIterator(){return new P_(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new P_(this.root,e,this.comparator,!0)}}class P_{constructor(e,t,o,h){this.isReverse=h,this.nodeStack=[];let g=1;for(;!e.isEmpty();)if(g=t?o(e.key,t):1,t&&h&&(g*=-1),g<0)e=this.isReverse?e.left:e.right;else{if(g===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class fa{constructor(e,t,o,h,g){this.key=e,this.value=t,this.color=o??fa.RED,this.left=h??fa.EMPTY,this.right=g??fa.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,o,h,g){return new fa(e??this.key,t??this.value,o??this.color,h??this.left,g??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,o){let h=this;const g=o(e,h.key);return h=g<0?h.copy(null,null,null,h.left.insert(e,t,o),null):g===0?h.copy(null,t,null,null,null):h.copy(null,null,null,null,h.right.insert(e,t,o)),h.fixUp()}removeMin(){if(this.left.isEmpty())return fa.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let o,h=this;if(t(e,h.key)<0)h.left.isEmpty()||h.left.isRed()||h.left.left.isRed()||(h=h.moveRedLeft()),h=h.copy(null,null,null,h.left.remove(e,t),null);else{if(h.left.isRed()&&(h=h.rotateRight()),h.right.isEmpty()||h.right.isRed()||h.right.left.isRed()||(h=h.moveRedRight()),t(e,h.key)===0){if(h.right.isEmpty())return fa.EMPTY;o=h.right.min(),h=h.copy(o.key,o.value,null,null,h.right.removeMin())}h=h.copy(null,null,null,null,h.right.remove(e,t))}return h.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,fa.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,fa.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw Xn();const e=this.left.check();if(e!==this.right.check())throw Xn();return e+(this.isRed()?0:1)}}fa.EMPTY=null,fa.RED=!0,fa.BLACK=!1;fa.EMPTY=new class{constructor(){this.size=0}get key(){throw Xn()}get value(){throw Xn()}get color(){throw Xn()}get left(){throw Xn()}get right(){throw Xn()}copy(e,t,o,h,g){return this}insert(e,t,o){return new fa(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ws{constructor(e){this.comparator=e,this.data=new lo(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,o)=>(e(t),!1))}forEachInRange(e,t){const o=this.data.getIteratorFrom(e[0]);for(;o.hasNext();){const h=o.getNext();if(this.comparator(h.key,e[1])>=0)return;t(h.key)}}forEachWhile(e,t){let o;for(o=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();o.hasNext();)if(!e(o.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Fb(this.data.getIterator())}getIteratorFrom(e){return new Fb(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(o=>{t=t.add(o)}),t}isEqual(e){if(!(e instanceof ws)||this.size!==e.size)return!1;const t=this.data.getIterator(),o=e.data.getIterator();for(;t.hasNext();){const h=t.getNext().key,g=o.getNext().key;if(this.comparator(h,g)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new ws(this.comparator);return t.data=e,t}}class Fb{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wc{constructor(e){this.fields=e,e.sort(ma.comparator)}static empty(){return new wc([])}unionWith(e){let t=new ws(ma.comparator);for(const o of this.fields)t=t.add(o);for(const o of e)t=t.add(o);return new wc(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Zf(this.fields,e.fields,(t,o)=>t.isEqual(o))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class O2 extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ga{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(h){try{return atob(h)}catch(g){throw typeof DOMException<"u"&&g instanceof DOMException?new O2("Invalid base64 string: "+g):g}}(e);return new ga(t)}static fromUint8Array(e){const t=function(h){let g="";for(let _=0;_<h.length;++_)g+=String.fromCharCode(h[_]);return g}(e);return new ga(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const o=new Uint8Array(t.length);for(let h=0;h<t.length;h++)o[h]=t.charCodeAt(h);return o}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Vi(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}ga.EMPTY_BYTE_STRING=new ga("");const uM=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Bd(i){if(fr(!!i),typeof i=="string"){let e=0;const t=uM.exec(i);if(fr(!!t),t[1]){let h=t[1];h=(h+"000000000").substr(0,9),e=Number(h)}const o=new Date(i);return{seconds:Math.floor(o.getTime()/1e3),nanos:e}}return{seconds:zo(i.seconds),nanos:zo(i.nanos)}}function zo(i){return typeof i=="number"?i:typeof i=="string"?Number(i):0}function Vd(i){return typeof i=="string"?ga.fromBase64String(i):ga.fromUint8Array(i)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ux(i){var e,t;return((t=(((e=i?.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function jy(i){const e=i.mapValue.fields.__previous_value__;return ux(e)?jy(e):e}function yg(i){const e=Bd(i.mapValue.fields.__local_write_time__.timestampValue);return new xs(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cM{constructor(e,t,o,h,g,_,u,R,O){this.databaseId=e,this.appId=t,this.persistenceKey=o,this.host=h,this.ssl=g,this.forceLongPolling=_,this.autoDetectLongPolling=u,this.longPollingOptions=R,this.useFetchStreams=O}}class vg{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new vg("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof vg&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const C_={mapValue:{}};function Ud(i){return"nullValue"in i?0:"booleanValue"in i?1:"integerValue"in i||"doubleValue"in i?2:"timestampValue"in i?3:"stringValue"in i?5:"bytesValue"in i?6:"referenceValue"in i?7:"geoPointValue"in i?8:"arrayValue"in i?9:"mapValue"in i?ux(i)?4:dM(i)?9007199254740991:hM(i)?10:11:Xn()}function fh(i,e){if(i===e)return!0;const t=Ud(i);if(t!==Ud(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return i.booleanValue===e.booleanValue;case 4:return yg(i).isEqual(yg(e));case 3:return function(h,g){if(typeof h.timestampValue=="string"&&typeof g.timestampValue=="string"&&h.timestampValue.length===g.timestampValue.length)return h.timestampValue===g.timestampValue;const _=Bd(h.timestampValue),u=Bd(g.timestampValue);return _.seconds===u.seconds&&_.nanos===u.nanos}(i,e);case 5:return i.stringValue===e.stringValue;case 6:return function(h,g){return Vd(h.bytesValue).isEqual(Vd(g.bytesValue))}(i,e);case 7:return i.referenceValue===e.referenceValue;case 8:return function(h,g){return zo(h.geoPointValue.latitude)===zo(g.geoPointValue.latitude)&&zo(h.geoPointValue.longitude)===zo(g.geoPointValue.longitude)}(i,e);case 2:return function(h,g){if("integerValue"in h&&"integerValue"in g)return zo(h.integerValue)===zo(g.integerValue);if("doubleValue"in h&&"doubleValue"in g){const _=zo(h.doubleValue),u=zo(g.doubleValue);return _===u?ly(_)===ly(u):isNaN(_)&&isNaN(u)}return!1}(i,e);case 9:return Zf(i.arrayValue.values||[],e.arrayValue.values||[],fh);case 10:case 11:return function(h,g){const _=h.mapValue.fields||{},u=g.mapValue.fields||{};if(Ob(_)!==Ob(u))return!1;for(const R in _)if(_.hasOwnProperty(R)&&(u[R]===void 0||!fh(_[R],u[R])))return!1;return!0}(i,e);default:return Xn()}}function xg(i,e){return(i.values||[]).find(t=>fh(t,e))!==void 0}function Wf(i,e){if(i===e)return 0;const t=Ud(i),o=Ud(e);if(t!==o)return Vi(t,o);switch(t){case 0:case 9007199254740991:return 0;case 1:return Vi(i.booleanValue,e.booleanValue);case 2:return function(g,_){const u=zo(g.integerValue||g.doubleValue),R=zo(_.integerValue||_.doubleValue);return u<R?-1:u>R?1:u===R?0:isNaN(u)?isNaN(R)?0:-1:1}(i,e);case 3:return Bb(i.timestampValue,e.timestampValue);case 4:return Bb(yg(i),yg(e));case 5:return Vi(i.stringValue,e.stringValue);case 6:return function(g,_){const u=Vd(g),R=Vd(_);return u.compareTo(R)}(i.bytesValue,e.bytesValue);case 7:return function(g,_){const u=g.split("/"),R=_.split("/");for(let O=0;O<u.length&&O<R.length;O++){const G=Vi(u[O],R[O]);if(G!==0)return G}return Vi(u.length,R.length)}(i.referenceValue,e.referenceValue);case 8:return function(g,_){const u=Vi(zo(g.latitude),zo(_.latitude));return u!==0?u:Vi(zo(g.longitude),zo(_.longitude))}(i.geoPointValue,e.geoPointValue);case 9:return Vb(i.arrayValue,e.arrayValue);case 10:return function(g,_){var u,R,O,G;const ne=g.fields||{},re=_.fields||{},Q=(u=ne.value)===null||u===void 0?void 0:u.arrayValue,de=(R=re.value)===null||R===void 0?void 0:R.arrayValue,Se=Vi(((O=Q?.values)===null||O===void 0?void 0:O.length)||0,((G=de?.values)===null||G===void 0?void 0:G.length)||0);return Se!==0?Se:Vb(Q,de)}(i.mapValue,e.mapValue);case 11:return function(g,_){if(g===C_.mapValue&&_===C_.mapValue)return 0;if(g===C_.mapValue)return 1;if(_===C_.mapValue)return-1;const u=g.fields||{},R=Object.keys(u),O=_.fields||{},G=Object.keys(O);R.sort(),G.sort();for(let ne=0;ne<R.length&&ne<G.length;++ne){const re=Vi(R[ne],G[ne]);if(re!==0)return re;const Q=Wf(u[R[ne]],O[G[ne]]);if(Q!==0)return Q}return Vi(R.length,G.length)}(i.mapValue,e.mapValue);default:throw Xn()}}function Bb(i,e){if(typeof i=="string"&&typeof e=="string"&&i.length===e.length)return Vi(i,e);const t=Bd(i),o=Bd(e),h=Vi(t.seconds,o.seconds);return h!==0?h:Vi(t.nanos,o.nanos)}function Vb(i,e){const t=i.values||[],o=e.values||[];for(let h=0;h<t.length&&h<o.length;++h){const g=Wf(t[h],o[h]);if(g)return g}return Vi(t.length,o.length)}function Kf(i){return T0(i)}function T0(i){return"nullValue"in i?"null":"booleanValue"in i?""+i.booleanValue:"integerValue"in i?""+i.integerValue:"doubleValue"in i?""+i.doubleValue:"timestampValue"in i?function(t){const o=Bd(t);return`time(${o.seconds},${o.nanos})`}(i.timestampValue):"stringValue"in i?i.stringValue:"bytesValue"in i?function(t){return Vd(t).toBase64()}(i.bytesValue):"referenceValue"in i?function(t){return zn.fromName(t).toString()}(i.referenceValue):"geoPointValue"in i?function(t){return`geo(${t.latitude},${t.longitude})`}(i.geoPointValue):"arrayValue"in i?function(t){let o="[",h=!0;for(const g of t.values||[])h?h=!1:o+=",",o+=T0(g);return o+"]"}(i.arrayValue):"mapValue"in i?function(t){const o=Object.keys(t.fields||{}).sort();let h="{",g=!0;for(const _ of o)g?g=!1:h+=",",h+=`${_}:${T0(t.fields[_])}`;return h+"}"}(i.mapValue):Xn()}function q_(i){switch(Ud(i)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=jy(i);return e?16+q_(e):16;case 5:return 2*i.stringValue.length;case 6:return Vd(i.bytesValue).approximateByteSize();case 7:return i.referenceValue.length;case 9:return function(o){return(o.values||[]).reduce((h,g)=>h+q_(g),0)}(i.arrayValue);case 10:case 11:return function(o){let h=0;return Vp(o.fields,(g,_)=>{h+=g.length+q_(_)}),h}(i.mapValue);default:throw Xn()}}function Ub(i,e){return{referenceValue:`projects/${i.projectId}/databases/${i.database}/documents/${e.path.canonicalString()}`}}function S0(i){return!!i&&"integerValue"in i}function cx(i){return!!i&&"arrayValue"in i}function jb(i){return!!i&&"nullValue"in i}function $b(i){return!!i&&"doubleValue"in i&&isNaN(Number(i.doubleValue))}function G_(i){return!!i&&"mapValue"in i}function hM(i){var e,t;return((t=(((e=i?.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="__vector__"}function sg(i){if(i.geoPointValue)return{geoPointValue:Object.assign({},i.geoPointValue)};if(i.timestampValue&&typeof i.timestampValue=="object")return{timestampValue:Object.assign({},i.timestampValue)};if(i.mapValue){const e={mapValue:{fields:{}}};return Vp(i.mapValue.fields,(t,o)=>e.mapValue.fields[t]=sg(o)),e}if(i.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(i.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=sg(i.arrayValue.values[t]);return e}return Object.assign({},i)}function dM(i){return(((i.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fu{constructor(e){this.value=e}static empty(){return new Fu({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let o=0;o<e.length-1;++o)if(t=(t.mapValue.fields||{})[e.get(o)],!G_(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=sg(t)}setAll(e){let t=ma.emptyPath(),o={},h=[];e.forEach((_,u)=>{if(!t.isImmediateParentOf(u)){const R=this.getFieldsMap(t);this.applyChanges(R,o,h),o={},h=[],t=u.popLast()}_?o[u.lastSegment()]=sg(_):h.push(u.lastSegment())});const g=this.getFieldsMap(t);this.applyChanges(g,o,h)}delete(e){const t=this.field(e.popLast());G_(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return fh(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let o=0;o<e.length;++o){let h=t.mapValue.fields[e.get(o)];G_(h)&&h.mapValue.fields||(h={mapValue:{fields:{}}},t.mapValue.fields[e.get(o)]=h),t=h}return t.mapValue.fields}applyChanges(e,t,o){Vp(t,(h,g)=>e[h]=g);for(const h of o)delete e[h]}clone(){return new Fu(sg(this.value))}}function F2(i){const e=[];return Vp(i.fields,(t,o)=>{const h=new ma([t]);if(G_(o)){const g=F2(o.mapValue).fields;if(g.length===0)e.push(h);else for(const _ of g)e.push(h.child(_))}else e.push(h)}),new wc(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ja{constructor(e,t,o,h,g,_,u){this.key=e,this.documentType=t,this.version=o,this.readTime=h,this.createTime=g,this.data=_,this.documentState=u}static newInvalidDocument(e){return new ja(e,0,ni.min(),ni.min(),ni.min(),Fu.empty(),0)}static newFoundDocument(e,t,o,h){return new ja(e,1,t,ni.min(),o,h,0)}static newNoDocument(e,t){return new ja(e,2,t,ni.min(),ni.min(),Fu.empty(),0)}static newUnknownDocument(e,t){return new ja(e,3,t,ni.min(),ni.min(),Fu.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(ni.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Fu.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Fu.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ni.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof ja&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new ja(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uy{constructor(e,t){this.position=e,this.inclusive=t}}function Hb(i,e,t){let o=0;for(let h=0;h<i.position.length;h++){const g=e[h],_=i.position[h];if(g.field.isKeyField()?o=zn.comparator(zn.fromName(_.referenceValue),t.key):o=Wf(_,t.data.field(g.field)),g.dir==="desc"&&(o*=-1),o!==0)break}return o}function qb(i,e){if(i===null)return e===null;if(e===null||i.inclusive!==e.inclusive||i.position.length!==e.position.length)return!1;for(let t=0;t<i.position.length;t++)if(!fh(i.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wg{constructor(e,t="asc"){this.field=e,this.dir=t}}function pM(i,e){return i.dir===e.dir&&i.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B2{}class Yo extends B2{constructor(e,t,o){super(),this.field=e,this.op=t,this.value=o}static create(e,t,o){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,o):new mM(e,t,o):t==="array-contains"?new yM(e,o):t==="in"?new vM(e,o):t==="not-in"?new xM(e,o):t==="array-contains-any"?new wM(e,o):new Yo(e,t,o)}static createKeyFieldInFilter(e,t,o){return t==="in"?new gM(e,o):new _M(e,o)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(Wf(t,this.value)):t!==null&&Ud(this.value)===Ud(t)&&this.matchesComparison(Wf(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Xn()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Ec extends B2{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new Ec(e,t)}matches(e){return V2(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function V2(i){return i.op==="and"}function U2(i){return fM(i)&&V2(i)}function fM(i){for(const e of i.filters)if(e instanceof Ec)return!1;return!0}function E0(i){if(i instanceof Yo)return i.field.canonicalString()+i.op.toString()+Kf(i.value);if(U2(i))return i.filters.map(e=>E0(e)).join(",");{const e=i.filters.map(t=>E0(t)).join(",");return`${i.op}(${e})`}}function j2(i,e){return i instanceof Yo?function(o,h){return h instanceof Yo&&o.op===h.op&&o.field.isEqual(h.field)&&fh(o.value,h.value)}(i,e):i instanceof Ec?function(o,h){return h instanceof Ec&&o.op===h.op&&o.filters.length===h.filters.length?o.filters.reduce((g,_,u)=>g&&j2(_,h.filters[u]),!0):!1}(i,e):void Xn()}function $2(i){return i instanceof Yo?function(t){return`${t.field.canonicalString()} ${t.op} ${Kf(t.value)}`}(i):i instanceof Ec?function(t){return t.op.toString()+" {"+t.getFilters().map($2).join(" ,")+"}"}(i):"Filter"}class mM extends Yo{constructor(e,t,o){super(e,t,o),this.key=zn.fromName(o.referenceValue)}matches(e){const t=zn.comparator(e.key,this.key);return this.matchesComparison(t)}}class gM extends Yo{constructor(e,t){super(e,"in",t),this.keys=H2("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class _M extends Yo{constructor(e,t){super(e,"not-in",t),this.keys=H2("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function H2(i,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(o=>zn.fromName(o.referenceValue))}class yM extends Yo{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return cx(t)&&xg(t.arrayValue,this.value)}}class vM extends Yo{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&xg(this.value.arrayValue,t)}}class xM extends Yo{constructor(e,t){super(e,"not-in",t)}matches(e){if(xg(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&!xg(this.value.arrayValue,t)}}class wM extends Yo{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!cx(t)||!t.arrayValue.values)&&t.arrayValue.values.some(o=>xg(this.value.arrayValue,o))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bM{constructor(e,t=null,o=[],h=[],g=null,_=null,u=null){this.path=e,this.collectionGroup=t,this.orderBy=o,this.filters=h,this.limit=g,this.startAt=_,this.endAt=u,this.ue=null}}function Gb(i,e=null,t=[],o=[],h=null,g=null,_=null){return new bM(i,e,t,o,h,g,_)}function hx(i){const e=ii(i);if(e.ue===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(o=>E0(o)).join(","),t+="|ob:",t+=e.orderBy.map(o=>function(g){return g.field.canonicalString()+g.dir}(o)).join(","),Uy(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(o=>Kf(o)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(o=>Kf(o)).join(",")),e.ue=t}return e.ue}function dx(i,e){if(i.limit!==e.limit||i.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<i.orderBy.length;t++)if(!pM(i.orderBy[t],e.orderBy[t]))return!1;if(i.filters.length!==e.filters.length)return!1;for(let t=0;t<i.filters.length;t++)if(!j2(i.filters[t],e.filters[t]))return!1;return i.collectionGroup===e.collectionGroup&&!!i.path.isEqual(e.path)&&!!qb(i.startAt,e.startAt)&&qb(i.endAt,e.endAt)}function I0(i){return zn.isDocumentKey(i.path)&&i.collectionGroup===null&&i.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lm{constructor(e,t=null,o=[],h=[],g=null,_="F",u=null,R=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=o,this.filters=h,this.limit=g,this.limitType=_,this.startAt=u,this.endAt=R,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function TM(i,e,t,o,h,g,_,u){return new lm(i,e,t,o,h,g,_,u)}function q2(i){return new lm(i)}function Zb(i){return i.filters.length===0&&i.limit===null&&i.startAt==null&&i.endAt==null&&(i.explicitOrderBy.length===0||i.explicitOrderBy.length===1&&i.explicitOrderBy[0].field.isKeyField())}function G2(i){return i.collectionGroup!==null}function ag(i){const e=ii(i);if(e.ce===null){e.ce=[];const t=new Set;for(const g of e.explicitOrderBy)e.ce.push(g),t.add(g.field.canonicalString());const o=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(_){let u=new ws(ma.comparator);return _.filters.forEach(R=>{R.getFlattenedFilters().forEach(O=>{O.isInequality()&&(u=u.add(O.field))})}),u})(e).forEach(g=>{t.has(g.canonicalString())||g.isKeyField()||e.ce.push(new wg(g,o))}),t.has(ma.keyField().canonicalString())||e.ce.push(new wg(ma.keyField(),o))}return e.ce}function rh(i){const e=ii(i);return e.le||(e.le=SM(e,ag(i))),e.le}function SM(i,e){if(i.limitType==="F")return Gb(i.path,i.collectionGroup,e,i.filters,i.limit,i.startAt,i.endAt);{e=e.map(h=>{const g=h.dir==="desc"?"asc":"desc";return new wg(h.field,g)});const t=i.endAt?new uy(i.endAt.position,i.endAt.inclusive):null,o=i.startAt?new uy(i.startAt.position,i.startAt.inclusive):null;return Gb(i.path,i.collectionGroup,e,i.filters,i.limit,t,o)}}function P0(i,e){const t=i.filters.concat([e]);return new lm(i.path,i.collectionGroup,i.explicitOrderBy.slice(),t,i.limit,i.limitType,i.startAt,i.endAt)}function cy(i,e,t){return new lm(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),e,t,i.startAt,i.endAt)}function $y(i,e){return dx(rh(i),rh(e))&&i.limitType===e.limitType}function Z2(i){return`${hx(rh(i))}|lt:${i.limitType}`}function Mf(i){return`Query(target=${function(t){let o=t.path.canonicalString();return t.collectionGroup!==null&&(o+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(o+=`, filters: [${t.filters.map(h=>$2(h)).join(", ")}]`),Uy(t.limit)||(o+=", limit: "+t.limit),t.orderBy.length>0&&(o+=`, orderBy: [${t.orderBy.map(h=>function(_){return`${_.field.canonicalString()} (${_.dir})`}(h)).join(", ")}]`),t.startAt&&(o+=", startAt: ",o+=t.startAt.inclusive?"b:":"a:",o+=t.startAt.position.map(h=>Kf(h)).join(",")),t.endAt&&(o+=", endAt: ",o+=t.endAt.inclusive?"a:":"b:",o+=t.endAt.position.map(h=>Kf(h)).join(",")),`Target(${o})`}(rh(i))}; limitType=${i.limitType})`}function Hy(i,e){return e.isFoundDocument()&&function(o,h){const g=h.key.path;return o.collectionGroup!==null?h.key.hasCollectionId(o.collectionGroup)&&o.path.isPrefixOf(g):zn.isDocumentKey(o.path)?o.path.isEqual(g):o.path.isImmediateParentOf(g)}(i,e)&&function(o,h){for(const g of ag(o))if(!g.field.isKeyField()&&h.data.field(g.field)===null)return!1;return!0}(i,e)&&function(o,h){for(const g of o.filters)if(!g.matches(h))return!1;return!0}(i,e)&&function(o,h){return!(o.startAt&&!function(_,u,R){const O=Hb(_,u,R);return _.inclusive?O<=0:O<0}(o.startAt,ag(o),h)||o.endAt&&!function(_,u,R){const O=Hb(_,u,R);return _.inclusive?O>=0:O>0}(o.endAt,ag(o),h))}(i,e)}function EM(i){return i.collectionGroup||(i.path.length%2==1?i.path.lastSegment():i.path.get(i.path.length-2))}function W2(i){return(e,t)=>{let o=!1;for(const h of ag(i)){const g=IM(h,e,t);if(g!==0)return g;o=o||h.field.isKeyField()}return 0}}function IM(i,e,t){const o=i.field.isKeyField()?zn.comparator(e.key,t.key):function(g,_,u){const R=_.data.field(g),O=u.data.field(g);return R!==null&&O!==null?Wf(R,O):Xn()}(i.field,e,t);switch(i.dir){case"asc":return o;case"desc":return-1*o;default:return Xn()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Up{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),o=this.inner[t];if(o!==void 0){for(const[h,g]of o)if(this.equalsFn(h,e))return g}}has(e){return this.get(e)!==void 0}set(e,t){const o=this.mapKeyFn(e),h=this.inner[o];if(h===void 0)return this.inner[o]=[[e,t]],void this.innerSize++;for(let g=0;g<h.length;g++)if(this.equalsFn(h[g][0],e))return void(h[g]=[e,t]);h.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),o=this.inner[t];if(o===void 0)return!1;for(let h=0;h<o.length;h++)if(this.equalsFn(o[h][0],e))return o.length===1?delete this.inner[t]:o.splice(h,1),this.innerSize--,!0;return!1}forEach(e){Vp(this.inner,(t,o)=>{for(const[h,g]of o)e(h,g)})}isEmpty(){return N2(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PM=new lo(zn.comparator);function Jh(){return PM}const K2=new lo(zn.comparator);function tg(...i){let e=K2;for(const t of i)e=e.insert(t.key,t);return e}function X2(i){let e=K2;return i.forEach((t,o)=>e=e.insert(t,o.overlayedDocument)),e}function wp(){return lg()}function Y2(){return lg()}function lg(){return new Up(i=>i.toString(),(i,e)=>i.isEqual(e))}const CM=new lo(zn.comparator),AM=new ws(zn.comparator);function ki(...i){let e=AM;for(const t of i)e=e.add(t);return e}const kM=new ws(Vi);function MM(){return kM}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function px(i,e){if(i.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ly(e)?"-0":e}}function Q2(i){return{integerValue:""+i}}function RM(i,e){return sM(e)?Q2(e):px(i,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qy{constructor(){this._=void 0}}function LM(i,e,t){return i instanceof bg?function(h,g){const _={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:h.seconds,nanos:h.nanoseconds}}}};return g&&ux(g)&&(g=jy(g)),g&&(_.fields.__previous_value__=g),{mapValue:_}}(t,e):i instanceof Tg?eS(i,e):i instanceof Sg?tS(i,e):function(h,g){const _=J2(h,g),u=Wb(_)+Wb(h.Pe);return S0(_)&&S0(h.Pe)?Q2(u):px(h.serializer,u)}(i,e)}function DM(i,e,t){return i instanceof Tg?eS(i,e):i instanceof Sg?tS(i,e):t}function J2(i,e){return i instanceof hy?function(o){return S0(o)||function(g){return!!g&&"doubleValue"in g}(o)}(e)?e:{integerValue:0}:null}class bg extends qy{}class Tg extends qy{constructor(e){super(),this.elements=e}}function eS(i,e){const t=nS(e);for(const o of i.elements)t.some(h=>fh(h,o))||t.push(o);return{arrayValue:{values:t}}}class Sg extends qy{constructor(e){super(),this.elements=e}}function tS(i,e){let t=nS(e);for(const o of i.elements)t=t.filter(h=>!fh(h,o));return{arrayValue:{values:t}}}class hy extends qy{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function Wb(i){return zo(i.integerValue||i.doubleValue)}function nS(i){return cx(i)&&i.arrayValue.values?i.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zM{constructor(e,t){this.field=e,this.transform=t}}function NM(i,e){return i.field.isEqual(e.field)&&function(o,h){return o instanceof Tg&&h instanceof Tg||o instanceof Sg&&h instanceof Sg?Zf(o.elements,h.elements,fh):o instanceof hy&&h instanceof hy?fh(o.Pe,h.Pe):o instanceof bg&&h instanceof bg}(i.transform,e.transform)}class OM{constructor(e,t){this.version=e,this.transformResults=t}}class Zh{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Zh}static exists(e){return new Zh(void 0,e)}static updateTime(e){return new Zh(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Z_(i,e){return i.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(i.updateTime):i.exists===void 0||i.exists===e.isFoundDocument()}class Gy{}function iS(i,e){if(!i.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return i.isNoDocument()?new oS(i.key,Zh.none()):new Og(i.key,i.data,Zh.none());{const t=i.data,o=Fu.empty();let h=new ws(ma.comparator);for(let g of e.fields)if(!h.has(g)){let _=t.field(g);_===null&&g.length>1&&(g=g.popLast(),_=t.field(g)),_===null?o.delete(g):o.set(g,_),h=h.add(g)}return new jp(i.key,o,new wc(h.toArray()),Zh.none())}}function FM(i,e,t){i instanceof Og?function(h,g,_){const u=h.value.clone(),R=Xb(h.fieldTransforms,g,_.transformResults);u.setAll(R),g.convertToFoundDocument(_.version,u).setHasCommittedMutations()}(i,e,t):i instanceof jp?function(h,g,_){if(!Z_(h.precondition,g))return void g.convertToUnknownDocument(_.version);const u=Xb(h.fieldTransforms,g,_.transformResults),R=g.data;R.setAll(rS(h)),R.setAll(u),g.convertToFoundDocument(_.version,R).setHasCommittedMutations()}(i,e,t):function(h,g,_){g.convertToNoDocument(_.version).setHasCommittedMutations()}(0,e,t)}function ug(i,e,t,o){return i instanceof Og?function(g,_,u,R){if(!Z_(g.precondition,_))return u;const O=g.value.clone(),G=Yb(g.fieldTransforms,R,_);return O.setAll(G),_.convertToFoundDocument(_.version,O).setHasLocalMutations(),null}(i,e,t,o):i instanceof jp?function(g,_,u,R){if(!Z_(g.precondition,_))return u;const O=Yb(g.fieldTransforms,R,_),G=_.data;return G.setAll(rS(g)),G.setAll(O),_.convertToFoundDocument(_.version,G).setHasLocalMutations(),u===null?null:u.unionWith(g.fieldMask.fields).unionWith(g.fieldTransforms.map(ne=>ne.field))}(i,e,t,o):function(g,_,u){return Z_(g.precondition,_)?(_.convertToNoDocument(_.version).setHasLocalMutations(),null):u}(i,e,t)}function BM(i,e){let t=null;for(const o of i.fieldTransforms){const h=e.data.field(o.field),g=J2(o.transform,h||null);g!=null&&(t===null&&(t=Fu.empty()),t.set(o.field,g))}return t||null}function Kb(i,e){return i.type===e.type&&!!i.key.isEqual(e.key)&&!!i.precondition.isEqual(e.precondition)&&!!function(o,h){return o===void 0&&h===void 0||!(!o||!h)&&Zf(o,h,(g,_)=>NM(g,_))}(i.fieldTransforms,e.fieldTransforms)&&(i.type===0?i.value.isEqual(e.value):i.type!==1||i.data.isEqual(e.data)&&i.fieldMask.isEqual(e.fieldMask))}class Og extends Gy{constructor(e,t,o,h=[]){super(),this.key=e,this.value=t,this.precondition=o,this.fieldTransforms=h,this.type=0}getFieldMask(){return null}}class jp extends Gy{constructor(e,t,o,h,g=[]){super(),this.key=e,this.data=t,this.fieldMask=o,this.precondition=h,this.fieldTransforms=g,this.type=1}getFieldMask(){return this.fieldMask}}function rS(i){const e=new Map;return i.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const o=i.data.field(t);e.set(t,o)}}),e}function Xb(i,e,t){const o=new Map;fr(i.length===t.length);for(let h=0;h<t.length;h++){const g=i[h],_=g.transform,u=e.data.field(g.field);o.set(g.field,DM(_,u,t[h]))}return o}function Yb(i,e,t){const o=new Map;for(const h of i){const g=h.transform,_=t.data.field(h.field);o.set(h.field,LM(g,_,e))}return o}class oS extends Gy{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class VM extends Gy{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UM{constructor(e,t,o,h){this.batchId=e,this.localWriteTime=t,this.baseMutations=o,this.mutations=h}applyToRemoteDocument(e,t){const o=t.mutationResults;for(let h=0;h<this.mutations.length;h++){const g=this.mutations[h];g.key.isEqual(e.key)&&FM(g,e,o[h])}}applyToLocalView(e,t){for(const o of this.baseMutations)o.key.isEqual(e.key)&&(t=ug(o,e,t,this.localWriteTime));for(const o of this.mutations)o.key.isEqual(e.key)&&(t=ug(o,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const o=Y2();return this.mutations.forEach(h=>{const g=e.get(h.key),_=g.overlayedDocument;let u=this.applyToLocalView(_,g.mutatedFields);u=t.has(h.key)?null:u;const R=iS(_,u);R!==null&&o.set(h.key,R),_.isValidDocument()||_.convertToNoDocument(ni.min())}),o}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),ki())}isEqual(e){return this.batchId===e.batchId&&Zf(this.mutations,e.mutations,(t,o)=>Kb(t,o))&&Zf(this.baseMutations,e.baseMutations,(t,o)=>Kb(t,o))}}class fx{constructor(e,t,o,h){this.batch=e,this.commitVersion=t,this.mutationResults=o,this.docVersions=h}static from(e,t,o){fr(e.mutations.length===o.length);let h=function(){return CM}();const g=e.mutations;for(let _=0;_<g.length;_++)h=h.insert(g[_].key,o[_].version);return new fx(e,t,o,h)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jM{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $M{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Xo,Gi;function HM(i){switch(i){default:return Xn();case Rt.CANCELLED:case Rt.UNKNOWN:case Rt.DEADLINE_EXCEEDED:case Rt.RESOURCE_EXHAUSTED:case Rt.INTERNAL:case Rt.UNAVAILABLE:case Rt.UNAUTHENTICATED:return!1;case Rt.INVALID_ARGUMENT:case Rt.NOT_FOUND:case Rt.ALREADY_EXISTS:case Rt.PERMISSION_DENIED:case Rt.FAILED_PRECONDITION:case Rt.ABORTED:case Rt.OUT_OF_RANGE:case Rt.UNIMPLEMENTED:case Rt.DATA_LOSS:return!0}}function sS(i){if(i===void 0)return Qh("GRPC error has no .code"),Rt.UNKNOWN;switch(i){case Xo.OK:return Rt.OK;case Xo.CANCELLED:return Rt.CANCELLED;case Xo.UNKNOWN:return Rt.UNKNOWN;case Xo.DEADLINE_EXCEEDED:return Rt.DEADLINE_EXCEEDED;case Xo.RESOURCE_EXHAUSTED:return Rt.RESOURCE_EXHAUSTED;case Xo.INTERNAL:return Rt.INTERNAL;case Xo.UNAVAILABLE:return Rt.UNAVAILABLE;case Xo.UNAUTHENTICATED:return Rt.UNAUTHENTICATED;case Xo.INVALID_ARGUMENT:return Rt.INVALID_ARGUMENT;case Xo.NOT_FOUND:return Rt.NOT_FOUND;case Xo.ALREADY_EXISTS:return Rt.ALREADY_EXISTS;case Xo.PERMISSION_DENIED:return Rt.PERMISSION_DENIED;case Xo.FAILED_PRECONDITION:return Rt.FAILED_PRECONDITION;case Xo.ABORTED:return Rt.ABORTED;case Xo.OUT_OF_RANGE:return Rt.OUT_OF_RANGE;case Xo.UNIMPLEMENTED:return Rt.UNIMPLEMENTED;case Xo.DATA_LOSS:return Rt.DATA_LOSS;default:return Xn()}}(Gi=Xo||(Xo={}))[Gi.OK=0]="OK",Gi[Gi.CANCELLED=1]="CANCELLED",Gi[Gi.UNKNOWN=2]="UNKNOWN",Gi[Gi.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Gi[Gi.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Gi[Gi.NOT_FOUND=5]="NOT_FOUND",Gi[Gi.ALREADY_EXISTS=6]="ALREADY_EXISTS",Gi[Gi.PERMISSION_DENIED=7]="PERMISSION_DENIED",Gi[Gi.UNAUTHENTICATED=16]="UNAUTHENTICATED",Gi[Gi.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Gi[Gi.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Gi[Gi.ABORTED=10]="ABORTED",Gi[Gi.OUT_OF_RANGE=11]="OUT_OF_RANGE",Gi[Gi.UNIMPLEMENTED=12]="UNIMPLEMENTED",Gi[Gi.INTERNAL=13]="INTERNAL",Gi[Gi.UNAVAILABLE=14]="UNAVAILABLE",Gi[Gi.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qM(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GM=new zd([4294967295,4294967295],0);function Qb(i){const e=qM().encode(i),t=new C2;return t.update(e),new Uint8Array(t.digest())}function Jb(i){const e=new DataView(i.buffer),t=e.getUint32(0,!0),o=e.getUint32(4,!0),h=e.getUint32(8,!0),g=e.getUint32(12,!0);return[new zd([t,o],0),new zd([h,g],0)]}class mx{constructor(e,t,o){if(this.bitmap=e,this.padding=t,this.hashCount=o,t<0||t>=8)throw new ng(`Invalid padding: ${t}`);if(o<0)throw new ng(`Invalid hash count: ${o}`);if(e.length>0&&this.hashCount===0)throw new ng(`Invalid hash count: ${o}`);if(e.length===0&&t!==0)throw new ng(`Invalid padding when bitmap length is 0: ${t}`);this.Te=8*e.length-t,this.Ie=zd.fromNumber(this.Te)}de(e,t,o){let h=e.add(t.multiply(zd.fromNumber(o)));return h.compare(GM)===1&&(h=new zd([h.getBits(0),h.getBits(1)],0)),h.modulo(this.Ie).toNumber()}Ee(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Te===0)return!1;const t=Qb(e),[o,h]=Jb(t);for(let g=0;g<this.hashCount;g++){const _=this.de(o,h,g);if(!this.Ee(_))return!1}return!0}static create(e,t,o){const h=e%8==0?0:8-e%8,g=new Uint8Array(Math.ceil(e/8)),_=new mx(g,h,t);return o.forEach(u=>_.insert(u)),_}insert(e){if(this.Te===0)return;const t=Qb(e),[o,h]=Jb(t);for(let g=0;g<this.hashCount;g++){const _=this.de(o,h,g);this.Ae(_)}}Ae(e){const t=Math.floor(e/8),o=e%8;this.bitmap[t]|=1<<o}}class ng extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zy{constructor(e,t,o,h,g){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=o,this.documentUpdates=h,this.resolvedLimboDocuments=g}static createSynthesizedRemoteEventForCurrentChange(e,t,o){const h=new Map;return h.set(e,Fg.createSynthesizedTargetChangeForCurrentChange(e,t,o)),new Zy(ni.min(),h,new lo(Vi),Jh(),ki())}}class Fg{constructor(e,t,o,h,g){this.resumeToken=e,this.current=t,this.addedDocuments=o,this.modifiedDocuments=h,this.removedDocuments=g}static createSynthesizedTargetChangeForCurrentChange(e,t,o){return new Fg(o,t,ki(),ki(),ki())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class W_{constructor(e,t,o,h){this.Re=e,this.removedTargetIds=t,this.key=o,this.Ve=h}}class aS{constructor(e,t){this.targetId=e,this.me=t}}class lS{constructor(e,t,o=ga.EMPTY_BYTE_STRING,h=null){this.state=e,this.targetIds=t,this.resumeToken=o,this.cause=h}}class e1{constructor(){this.fe=0,this.ge=t1(),this.pe=ga.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=ki(),t=ki(),o=ki();return this.ge.forEach((h,g)=>{switch(g){case 0:e=e.add(h);break;case 2:t=t.add(h);break;case 1:o=o.add(h);break;default:Xn()}}),new Fg(this.pe,this.ye,e,t,o)}Ce(){this.we=!1,this.ge=t1()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,fr(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class ZM{constructor(e){this.Be=e,this.Le=new Map,this.ke=Jh(),this.qe=A_(),this.Qe=A_(),this.Ke=new lo(Vi)}$e(e){for(const t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.Ue(t,e.Ve):this.We(t,e.key,e.Ve);for(const t of e.removedTargetIds)this.We(t,e.key,e.Ve)}Ge(e){this.forEachTarget(e,t=>{const o=this.ze(t);switch(e.state){case 0:this.je(t)&&o.De(e.resumeToken);break;case 1:o.Oe(),o.Se||o.Ce(),o.De(e.resumeToken);break;case 2:o.Oe(),o.Se||this.removeTarget(t);break;case 3:this.je(t)&&(o.Ne(),o.De(e.resumeToken));break;case 4:this.je(t)&&(this.He(t),o.De(e.resumeToken));break;default:Xn()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Le.forEach((o,h)=>{this.je(h)&&t(h)})}Je(e){const t=e.targetId,o=e.me.count,h=this.Ye(t);if(h){const g=h.target;if(I0(g))if(o===0){const _=new zn(g.path);this.We(t,_,ja.newNoDocument(_,ni.min()))}else fr(o===1);else{const _=this.Ze(t);if(_!==o){const u=this.Xe(e),R=u?this.et(u,e,_):1;if(R!==0){this.He(t);const O=R===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ke=this.Ke.insert(t,O)}}}}}Xe(e){const t=e.me.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:o="",padding:h=0},hashCount:g=0}=t;let _,u;try{_=Vd(o).toUint8Array()}catch(R){if(R instanceof O2)return Gf("Decoding the base64 bloom filter in existence filter failed ("+R.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw R}try{u=new mx(_,h,g)}catch(R){return Gf(R instanceof ng?"BloomFilter error: ":"Applying bloom filter failed: ",R),null}return u.Te===0?null:u}et(e,t,o){return t.me.count===o-this.rt(e,t.targetId)?0:2}rt(e,t){const o=this.Be.getRemoteKeysForTarget(t);let h=0;return o.forEach(g=>{const _=this.Be.nt(),u=`projects/${_.projectId}/databases/${_.database}/documents/${g.path.canonicalString()}`;e.mightContain(u)||(this.We(t,g,null),h++)}),h}it(e){const t=new Map;this.Le.forEach((g,_)=>{const u=this.Ye(_);if(u){if(g.current&&I0(u.target)){const R=new zn(u.target.path);this.st(R).has(_)||this.ot(_,R)||this.We(_,R,ja.newNoDocument(R,e))}g.be&&(t.set(_,g.ve()),g.Ce())}});let o=ki();this.Qe.forEach((g,_)=>{let u=!0;_.forEachWhile(R=>{const O=this.Ye(R);return!O||O.purpose==="TargetPurposeLimboResolution"||(u=!1,!1)}),u&&(o=o.add(g))}),this.ke.forEach((g,_)=>_.setReadTime(e));const h=new Zy(e,t,this.Ke,this.ke,o);return this.ke=Jh(),this.qe=A_(),this.Qe=A_(),this.Ke=new lo(Vi),h}Ue(e,t){if(!this.je(e))return;const o=this.ot(e,t.key)?2:0;this.ze(e).Fe(t.key,o),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e)),this.Qe=this.Qe.insert(t.key,this._t(t.key).add(e))}We(e,t,o){if(!this.je(e))return;const h=this.ze(e);this.ot(e,t)?h.Fe(t,1):h.Me(t),this.Qe=this.Qe.insert(t,this._t(t).delete(e)),this.Qe=this.Qe.insert(t,this._t(t).add(e)),o&&(this.ke=this.ke.insert(t,o))}removeTarget(e){this.Le.delete(e)}Ze(e){const t=this.ze(e).ve();return this.Be.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.ze(e).xe()}ze(e){let t=this.Le.get(e);return t||(t=new e1,this.Le.set(e,t)),t}_t(e){let t=this.Qe.get(e);return t||(t=new ws(Vi),this.Qe=this.Qe.insert(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new ws(Vi),this.qe=this.qe.insert(e,t)),t}je(e){const t=this.Ye(e)!==null;return t||fn("WatchChangeAggregator","Detected inactive target",e),t}Ye(e){const t=this.Le.get(e);return t&&t.Se?null:this.Be.ut(e)}He(e){this.Le.set(e,new e1),this.Be.getRemoteKeysForTarget(e).forEach(t=>{this.We(e,t,null)})}ot(e,t){return this.Be.getRemoteKeysForTarget(e).has(t)}}function A_(){return new lo(zn.comparator)}function t1(){return new lo(zn.comparator)}const WM={asc:"ASCENDING",desc:"DESCENDING"},KM={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},XM={and:"AND",or:"OR"};class YM{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function C0(i,e){return i.useProto3Json||Uy(e)?e:{value:e}}function dy(i,e){return i.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function uS(i,e){return i.useProto3Json?e.toBase64():e.toUint8Array()}function QM(i,e){return dy(i,e.toTimestamp())}function oh(i){return fr(!!i),ni.fromTimestamp(function(t){const o=Bd(t);return new xs(o.seconds,o.nanos)}(i))}function gx(i,e){return A0(i,e).canonicalString()}function A0(i,e){const t=function(h){return new $r(["projects",h.projectId,"databases",h.database])}(i).child("documents");return e===void 0?t:t.child(e)}function cS(i){const e=$r.fromString(i);return fr(mS(e)),e}function k0(i,e){return gx(i.databaseId,e.path)}function Kv(i,e){const t=cS(e);if(t.get(1)!==i.databaseId.projectId)throw new vn(Rt.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+i.databaseId.projectId);if(t.get(3)!==i.databaseId.database)throw new vn(Rt.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+i.databaseId.database);return new zn(dS(t))}function hS(i,e){return gx(i.databaseId,e)}function JM(i){const e=cS(i);return e.length===4?$r.emptyPath():dS(e)}function M0(i){return new $r(["projects",i.databaseId.projectId,"databases",i.databaseId.database]).canonicalString()}function dS(i){return fr(i.length>4&&i.get(4)==="documents"),i.popFirst(5)}function n1(i,e,t){return{name:k0(i,e),fields:t.value.mapValue.fields}}function eR(i,e){let t;if("targetChange"in e){e.targetChange;const o=function(O){return O==="NO_CHANGE"?0:O==="ADD"?1:O==="REMOVE"?2:O==="CURRENT"?3:O==="RESET"?4:Xn()}(e.targetChange.targetChangeType||"NO_CHANGE"),h=e.targetChange.targetIds||[],g=function(O,G){return O.useProto3Json?(fr(G===void 0||typeof G=="string"),ga.fromBase64String(G||"")):(fr(G===void 0||G instanceof Buffer||G instanceof Uint8Array),ga.fromUint8Array(G||new Uint8Array))}(i,e.targetChange.resumeToken),_=e.targetChange.cause,u=_&&function(O){const G=O.code===void 0?Rt.UNKNOWN:sS(O.code);return new vn(G,O.message||"")}(_);t=new lS(o,h,g,u||null)}else if("documentChange"in e){e.documentChange;const o=e.documentChange;o.document,o.document.name,o.document.updateTime;const h=Kv(i,o.document.name),g=oh(o.document.updateTime),_=o.document.createTime?oh(o.document.createTime):ni.min(),u=new Fu({mapValue:{fields:o.document.fields}}),R=ja.newFoundDocument(h,g,_,u),O=o.targetIds||[],G=o.removedTargetIds||[];t=new W_(O,G,R.key,R)}else if("documentDelete"in e){e.documentDelete;const o=e.documentDelete;o.document;const h=Kv(i,o.document),g=o.readTime?oh(o.readTime):ni.min(),_=ja.newNoDocument(h,g),u=o.removedTargetIds||[];t=new W_([],u,_.key,_)}else if("documentRemove"in e){e.documentRemove;const o=e.documentRemove;o.document;const h=Kv(i,o.document),g=o.removedTargetIds||[];t=new W_([],g,h,null)}else{if(!("filter"in e))return Xn();{e.filter;const o=e.filter;o.targetId;const{count:h=0,unchangedNames:g}=o,_=new $M(h,g),u=o.targetId;t=new aS(u,_)}}return t}function tR(i,e){let t;if(e instanceof Og)t={update:n1(i,e.key,e.value)};else if(e instanceof oS)t={delete:k0(i,e.key)};else if(e instanceof jp)t={update:n1(i,e.key,e.data),updateMask:cR(e.fieldMask)};else{if(!(e instanceof VM))return Xn();t={verify:k0(i,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(o=>function(g,_){const u=_.transform;if(u instanceof bg)return{fieldPath:_.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof Tg)return{fieldPath:_.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof Sg)return{fieldPath:_.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof hy)return{fieldPath:_.field.canonicalString(),increment:u.Pe};throw Xn()}(0,o))),e.precondition.isNone||(t.currentDocument=function(h,g){return g.updateTime!==void 0?{updateTime:QM(h,g.updateTime)}:g.exists!==void 0?{exists:g.exists}:Xn()}(i,e.precondition)),t}function nR(i,e){return i&&i.length>0?(fr(e!==void 0),i.map(t=>function(h,g){let _=h.updateTime?oh(h.updateTime):oh(g);return _.isEqual(ni.min())&&(_=oh(g)),new OM(_,h.transformResults||[])}(t,e))):[]}function iR(i,e){return{documents:[hS(i,e.path)]}}function rR(i,e){const t={structuredQuery:{}},o=e.path;let h;e.collectionGroup!==null?(h=o,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(h=o.popLast(),t.structuredQuery.from=[{collectionId:o.lastSegment()}]),t.parent=hS(i,h);const g=function(O){if(O.length!==0)return fS(Ec.create(O,"and"))}(e.filters);g&&(t.structuredQuery.where=g);const _=function(O){if(O.length!==0)return O.map(G=>function(re){return{field:Rf(re.field),direction:aR(re.dir)}}(G))}(e.orderBy);_&&(t.structuredQuery.orderBy=_);const u=C0(i,e.limit);return u!==null&&(t.structuredQuery.limit=u),e.startAt&&(t.structuredQuery.startAt=function(O){return{before:O.inclusive,values:O.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(O){return{before:!O.inclusive,values:O.position}}(e.endAt)),{ct:t,parent:h}}function oR(i){let e=JM(i.parent);const t=i.structuredQuery,o=t.from?t.from.length:0;let h=null;if(o>0){fr(o===1);const G=t.from[0];G.allDescendants?h=G.collectionId:e=e.child(G.collectionId)}let g=[];t.where&&(g=function(ne){const re=pS(ne);return re instanceof Ec&&U2(re)?re.getFilters():[re]}(t.where));let _=[];t.orderBy&&(_=function(ne){return ne.map(re=>function(de){return new wg(Lf(de.field),function(De){switch(De){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(de.direction))}(re))}(t.orderBy));let u=null;t.limit&&(u=function(ne){let re;return re=typeof ne=="object"?ne.value:ne,Uy(re)?null:re}(t.limit));let R=null;t.startAt&&(R=function(ne){const re=!!ne.before,Q=ne.values||[];return new uy(Q,re)}(t.startAt));let O=null;return t.endAt&&(O=function(ne){const re=!ne.before,Q=ne.values||[];return new uy(Q,re)}(t.endAt)),TM(e,h,_,g,u,"F",R,O)}function sR(i,e){const t=function(h){switch(h){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Xn()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function pS(i){return i.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const o=Lf(t.unaryFilter.field);return Yo.create(o,"==",{doubleValue:NaN});case"IS_NULL":const h=Lf(t.unaryFilter.field);return Yo.create(h,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const g=Lf(t.unaryFilter.field);return Yo.create(g,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const _=Lf(t.unaryFilter.field);return Yo.create(_,"!=",{nullValue:"NULL_VALUE"});default:return Xn()}}(i):i.fieldFilter!==void 0?function(t){return Yo.create(Lf(t.fieldFilter.field),function(h){switch(h){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Xn()}}(t.fieldFilter.op),t.fieldFilter.value)}(i):i.compositeFilter!==void 0?function(t){return Ec.create(t.compositeFilter.filters.map(o=>pS(o)),function(h){switch(h){case"AND":return"and";case"OR":return"or";default:return Xn()}}(t.compositeFilter.op))}(i):Xn()}function aR(i){return WM[i]}function lR(i){return KM[i]}function uR(i){return XM[i]}function Rf(i){return{fieldPath:i.canonicalString()}}function Lf(i){return ma.fromServerFormat(i.fieldPath)}function fS(i){return i instanceof Yo?function(t){if(t.op==="=="){if($b(t.value))return{unaryFilter:{field:Rf(t.field),op:"IS_NAN"}};if(jb(t.value))return{unaryFilter:{field:Rf(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if($b(t.value))return{unaryFilter:{field:Rf(t.field),op:"IS_NOT_NAN"}};if(jb(t.value))return{unaryFilter:{field:Rf(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Rf(t.field),op:lR(t.op),value:t.value}}}(i):i instanceof Ec?function(t){const o=t.getFilters().map(h=>fS(h));return o.length===1?o[0]:{compositeFilter:{op:uR(t.op),filters:o}}}(i):Xn()}function cR(i){const e=[];return i.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function mS(i){return i.length>=4&&i.get(0)==="projects"&&i.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Md{constructor(e,t,o,h,g=ni.min(),_=ni.min(),u=ga.EMPTY_BYTE_STRING,R=null){this.target=e,this.targetId=t,this.purpose=o,this.sequenceNumber=h,this.snapshotVersion=g,this.lastLimboFreeSnapshotVersion=_,this.resumeToken=u,this.expectedCount=R}withSequenceNumber(e){return new Md(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Md(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Md(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Md(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hR{constructor(e){this.ht=e}}function dR(i){const e=oR({parent:i.parent,structuredQuery:i.structuredQuery});return i.limitType==="LAST"?cy(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pR{constructor(){this.ln=new fR}addToCollectionParentIndex(e,t){return this.ln.add(t),Mt.resolve()}getCollectionParents(e,t){return Mt.resolve(this.ln.getEntries(t))}addFieldIndex(e,t){return Mt.resolve()}deleteFieldIndex(e,t){return Mt.resolve()}deleteAllFieldIndexes(e){return Mt.resolve()}createTargetIndexes(e,t){return Mt.resolve()}getDocumentsMatchingTarget(e,t){return Mt.resolve(null)}getIndexType(e,t){return Mt.resolve(0)}getFieldIndexes(e,t){return Mt.resolve([])}getNextCollectionGroupToUpdate(e){return Mt.resolve(null)}getMinOffset(e,t){return Mt.resolve(Fd.min())}getMinOffsetFromCollectionGroup(e,t){return Mt.resolve(Fd.min())}updateCollectionGroup(e,t,o){return Mt.resolve()}updateIndexEntries(e,t){return Mt.resolve()}}class fR{constructor(){this.index={}}add(e){const t=e.lastSegment(),o=e.popLast(),h=this.index[t]||new ws($r.comparator),g=!h.has(o);return this.index[t]=h.add(o),g}has(e){const t=e.lastSegment(),o=e.popLast(),h=this.index[t];return h&&h.has(o)}getEntries(e){return(this.index[e]||new ws($r.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const i1={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class zl{static withCacheSize(e){return new zl(e,zl.DEFAULT_COLLECTION_PERCENTILE,zl.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,o){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=o}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */zl.DEFAULT_COLLECTION_PERCENTILE=10,zl.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,zl.DEFAULT=new zl(41943040,zl.DEFAULT_COLLECTION_PERCENTILE,zl.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),zl.DISABLED=new zl(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xf{constructor(e){this.kn=e}next(){return this.kn+=2,this.kn}static qn(){return new Xf(0)}static Qn(){return new Xf(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function r1([i,e],[t,o]){const h=Vi(i,t);return h===0?Vi(e,o):h}class mR{constructor(e){this.Gn=e,this.buffer=new ws(r1),this.zn=0}jn(){return++this.zn}Hn(e){const t=[e,this.jn()];if(this.buffer.size<this.Gn)this.buffer=this.buffer.add(t);else{const o=this.buffer.last();r1(t,o)<0&&(this.buffer=this.buffer.delete(o).add(t))}}get maxValue(){return this.buffer.last()[0]}}class gR{constructor(e,t,o){this.garbageCollector=e,this.asyncQueue=t,this.localStore=o,this.Jn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Yn(6e4)}stop(){this.Jn&&(this.Jn.cancel(),this.Jn=null)}get started(){return this.Jn!==null}Yn(e){fn("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Jn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Jn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){am(t)?fn("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):await sm(t)}await this.Yn(3e5)})}}class _R{constructor(e,t){this.Zn=e,this.params=t}calculateTargetCount(e,t){return this.Zn.Xn(e).next(o=>Math.floor(t/100*o))}nthSequenceNumber(e,t){if(t===0)return Mt.resolve(Vy.oe);const o=new mR(t);return this.Zn.forEachTarget(e,h=>o.Hn(h.sequenceNumber)).next(()=>this.Zn.er(e,h=>o.Hn(h))).next(()=>o.maxValue)}removeTargets(e,t,o){return this.Zn.removeTargets(e,t,o)}removeOrphanedDocuments(e,t){return this.Zn.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(fn("LruGarbageCollector","Garbage collection skipped; disabled"),Mt.resolve(i1)):this.getCacheSize(e).next(o=>o<this.params.cacheSizeCollectionThreshold?(fn("LruGarbageCollector",`Garbage collection skipped; Cache size ${o} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),i1):this.tr(e,t))}getCacheSize(e){return this.Zn.getCacheSize(e)}tr(e,t){let o,h,g,_,u,R,O;const G=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(ne=>(ne>this.params.maximumSequenceNumbersToCollect?(fn("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${ne}`),h=this.params.maximumSequenceNumbersToCollect):h=ne,_=Date.now(),this.nthSequenceNumber(e,h))).next(ne=>(o=ne,u=Date.now(),this.removeTargets(e,o,t))).next(ne=>(g=ne,R=Date.now(),this.removeOrphanedDocuments(e,o))).next(ne=>(O=Date.now(),kf()<=Ai.DEBUG&&fn("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${_-G}ms
	Determined least recently used ${h} in `+(u-_)+`ms
	Removed ${g} targets in `+(R-u)+`ms
	Removed ${ne} documents in `+(O-R)+`ms
Total Duration: ${O-G}ms`),Mt.resolve({didRun:!0,sequenceNumbersCollected:h,targetsRemoved:g,documentsRemoved:ne})))}}function yR(i,e){return new _R(i,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vR{constructor(){this.changes=new Up(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,ja.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const o=this.changes.get(t);return o!==void 0?Mt.resolve(o):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xR{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wR{constructor(e,t,o,h){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=o,this.indexManager=h}getDocument(e,t){let o=null;return this.documentOverlayCache.getOverlay(e,t).next(h=>(o=h,this.remoteDocumentCache.getEntry(e,t))).next(h=>(o!==null&&ug(o.mutation,h,wc.empty(),xs.now()),h))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(o=>this.getLocalViewOfDocuments(e,o,ki()).next(()=>o))}getLocalViewOfDocuments(e,t,o=ki()){const h=wp();return this.populateOverlays(e,h,t).next(()=>this.computeViews(e,t,h,o).next(g=>{let _=tg();return g.forEach((u,R)=>{_=_.insert(u,R.overlayedDocument)}),_}))}getOverlayedDocuments(e,t){const o=wp();return this.populateOverlays(e,o,t).next(()=>this.computeViews(e,t,o,ki()))}populateOverlays(e,t,o){const h=[];return o.forEach(g=>{t.has(g)||h.push(g)}),this.documentOverlayCache.getOverlays(e,h).next(g=>{g.forEach((_,u)=>{t.set(_,u)})})}computeViews(e,t,o,h){let g=Jh();const _=lg(),u=function(){return lg()}();return t.forEach((R,O)=>{const G=o.get(O.key);h.has(O.key)&&(G===void 0||G.mutation instanceof jp)?g=g.insert(O.key,O):G!==void 0?(_.set(O.key,G.mutation.getFieldMask()),ug(G.mutation,O,G.mutation.getFieldMask(),xs.now())):_.set(O.key,wc.empty())}),this.recalculateAndSaveOverlays(e,g).next(R=>(R.forEach((O,G)=>_.set(O,G)),t.forEach((O,G)=>{var ne;return u.set(O,new xR(G,(ne=_.get(O))!==null&&ne!==void 0?ne:null))}),u))}recalculateAndSaveOverlays(e,t){const o=lg();let h=new lo((_,u)=>_-u),g=ki();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(_=>{for(const u of _)u.keys().forEach(R=>{const O=t.get(R);if(O===null)return;let G=o.get(R)||wc.empty();G=u.applyToLocalView(O,G),o.set(R,G);const ne=(h.get(u.batchId)||ki()).add(R);h=h.insert(u.batchId,ne)})}).next(()=>{const _=[],u=h.getReverseIterator();for(;u.hasNext();){const R=u.getNext(),O=R.key,G=R.value,ne=Y2();G.forEach(re=>{if(!g.has(re)){const Q=iS(t.get(re),o.get(re));Q!==null&&ne.set(re,Q),g=g.add(re)}}),_.push(this.documentOverlayCache.saveOverlays(e,O,ne))}return Mt.waitFor(_)}).next(()=>o)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(o=>this.recalculateAndSaveOverlays(e,o))}getDocumentsMatchingQuery(e,t,o,h){return function(_){return zn.isDocumentKey(_.path)&&_.collectionGroup===null&&_.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):G2(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,o,h):this.getDocumentsMatchingCollectionQuery(e,t,o,h)}getNextDocuments(e,t,o,h){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,o,h).next(g=>{const _=h-g.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,o.largestBatchId,h-g.size):Mt.resolve(wp());let u=-1,R=g;return _.next(O=>Mt.forEach(O,(G,ne)=>(u<ne.largestBatchId&&(u=ne.largestBatchId),g.get(G)?Mt.resolve():this.remoteDocumentCache.getEntry(e,G).next(re=>{R=R.insert(G,re)}))).next(()=>this.populateOverlays(e,O,g)).next(()=>this.computeViews(e,R,O,ki())).next(G=>({batchId:u,changes:X2(G)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new zn(t)).next(o=>{let h=tg();return o.isFoundDocument()&&(h=h.insert(o.key,o)),h})}getDocumentsMatchingCollectionGroupQuery(e,t,o,h){const g=t.collectionGroup;let _=tg();return this.indexManager.getCollectionParents(e,g).next(u=>Mt.forEach(u,R=>{const O=function(ne,re){return new lm(re,null,ne.explicitOrderBy.slice(),ne.filters.slice(),ne.limit,ne.limitType,ne.startAt,ne.endAt)}(t,R.child(g));return this.getDocumentsMatchingCollectionQuery(e,O,o,h).next(G=>{G.forEach((ne,re)=>{_=_.insert(ne,re)})})}).next(()=>_))}getDocumentsMatchingCollectionQuery(e,t,o,h){let g;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,o.largestBatchId).next(_=>(g=_,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,o,g,h))).next(_=>{g.forEach((R,O)=>{const G=O.getKey();_.get(G)===null&&(_=_.insert(G,ja.newInvalidDocument(G)))});let u=tg();return _.forEach((R,O)=>{const G=g.get(R);G!==void 0&&ug(G.mutation,O,wc.empty(),xs.now()),Hy(t,O)&&(u=u.insert(R,O))}),u})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bR{constructor(e){this.serializer=e,this.Tr=new Map,this.Ir=new Map}getBundleMetadata(e,t){return Mt.resolve(this.Tr.get(t))}saveBundleMetadata(e,t){return this.Tr.set(t.id,function(h){return{id:h.id,version:h.version,createTime:oh(h.createTime)}}(t)),Mt.resolve()}getNamedQuery(e,t){return Mt.resolve(this.Ir.get(t))}saveNamedQuery(e,t){return this.Ir.set(t.name,function(h){return{name:h.name,query:dR(h.bundledQuery),readTime:oh(h.readTime)}}(t)),Mt.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TR{constructor(){this.overlays=new lo(zn.comparator),this.dr=new Map}getOverlay(e,t){return Mt.resolve(this.overlays.get(t))}getOverlays(e,t){const o=wp();return Mt.forEach(t,h=>this.getOverlay(e,h).next(g=>{g!==null&&o.set(h,g)})).next(()=>o)}saveOverlays(e,t,o){return o.forEach((h,g)=>{this.Tt(e,t,g)}),Mt.resolve()}removeOverlaysForBatchId(e,t,o){const h=this.dr.get(o);return h!==void 0&&(h.forEach(g=>this.overlays=this.overlays.remove(g)),this.dr.delete(o)),Mt.resolve()}getOverlaysForCollection(e,t,o){const h=wp(),g=t.length+1,_=new zn(t.child("")),u=this.overlays.getIteratorFrom(_);for(;u.hasNext();){const R=u.getNext().value,O=R.getKey();if(!t.isPrefixOf(O.path))break;O.path.length===g&&R.largestBatchId>o&&h.set(R.getKey(),R)}return Mt.resolve(h)}getOverlaysForCollectionGroup(e,t,o,h){let g=new lo((O,G)=>O-G);const _=this.overlays.getIterator();for(;_.hasNext();){const O=_.getNext().value;if(O.getKey().getCollectionGroup()===t&&O.largestBatchId>o){let G=g.get(O.largestBatchId);G===null&&(G=wp(),g=g.insert(O.largestBatchId,G)),G.set(O.getKey(),O)}}const u=wp(),R=g.getIterator();for(;R.hasNext()&&(R.getNext().value.forEach((O,G)=>u.set(O,G)),!(u.size()>=h)););return Mt.resolve(u)}Tt(e,t,o){const h=this.overlays.get(o.key);if(h!==null){const _=this.dr.get(h.largestBatchId).delete(o.key);this.dr.set(h.largestBatchId,_)}this.overlays=this.overlays.insert(o.key,new jM(t,o));let g=this.dr.get(t);g===void 0&&(g=ki(),this.dr.set(t,g)),this.dr.set(t,g.add(o.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SR{constructor(){this.sessionToken=ga.EMPTY_BYTE_STRING}getSessionToken(e){return Mt.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,Mt.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _x{constructor(){this.Er=new ws(js.Ar),this.Rr=new ws(js.Vr)}isEmpty(){return this.Er.isEmpty()}addReference(e,t){const o=new js(e,t);this.Er=this.Er.add(o),this.Rr=this.Rr.add(o)}mr(e,t){e.forEach(o=>this.addReference(o,t))}removeReference(e,t){this.gr(new js(e,t))}pr(e,t){e.forEach(o=>this.removeReference(o,t))}yr(e){const t=new zn(new $r([])),o=new js(t,e),h=new js(t,e+1),g=[];return this.Rr.forEachInRange([o,h],_=>{this.gr(_),g.push(_.key)}),g}wr(){this.Er.forEach(e=>this.gr(e))}gr(e){this.Er=this.Er.delete(e),this.Rr=this.Rr.delete(e)}Sr(e){const t=new zn(new $r([])),o=new js(t,e),h=new js(t,e+1);let g=ki();return this.Rr.forEachInRange([o,h],_=>{g=g.add(_.key)}),g}containsKey(e){const t=new js(e,0),o=this.Er.firstAfterOrEqual(t);return o!==null&&e.isEqual(o.key)}}class js{constructor(e,t){this.key=e,this.br=t}static Ar(e,t){return zn.comparator(e.key,t.key)||Vi(e.br,t.br)}static Vr(e,t){return Vi(e.br,t.br)||zn.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ER{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Dr=1,this.vr=new ws(js.Ar)}checkEmpty(e){return Mt.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,o,h){const g=this.Dr;this.Dr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const _=new UM(g,t,o,h);this.mutationQueue.push(_);for(const u of h)this.vr=this.vr.add(new js(u.key,g)),this.indexManager.addToCollectionParentIndex(e,u.key.path.popLast());return Mt.resolve(_)}lookupMutationBatch(e,t){return Mt.resolve(this.Cr(t))}getNextMutationBatchAfterBatchId(e,t){const o=t+1,h=this.Fr(o),g=h<0?0:h;return Mt.resolve(this.mutationQueue.length>g?this.mutationQueue[g]:null)}getHighestUnacknowledgedBatchId(){return Mt.resolve(this.mutationQueue.length===0?-1:this.Dr-1)}getAllMutationBatches(e){return Mt.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const o=new js(t,0),h=new js(t,Number.POSITIVE_INFINITY),g=[];return this.vr.forEachInRange([o,h],_=>{const u=this.Cr(_.br);g.push(u)}),Mt.resolve(g)}getAllMutationBatchesAffectingDocumentKeys(e,t){let o=new ws(Vi);return t.forEach(h=>{const g=new js(h,0),_=new js(h,Number.POSITIVE_INFINITY);this.vr.forEachInRange([g,_],u=>{o=o.add(u.br)})}),Mt.resolve(this.Mr(o))}getAllMutationBatchesAffectingQuery(e,t){const o=t.path,h=o.length+1;let g=o;zn.isDocumentKey(g)||(g=g.child(""));const _=new js(new zn(g),0);let u=new ws(Vi);return this.vr.forEachWhile(R=>{const O=R.key.path;return!!o.isPrefixOf(O)&&(O.length===h&&(u=u.add(R.br)),!0)},_),Mt.resolve(this.Mr(u))}Mr(e){const t=[];return e.forEach(o=>{const h=this.Cr(o);h!==null&&t.push(h)}),t}removeMutationBatch(e,t){fr(this.Or(t.batchId,"removed")===0),this.mutationQueue.shift();let o=this.vr;return Mt.forEach(t.mutations,h=>{const g=new js(h.key,t.batchId);return o=o.delete(g),this.referenceDelegate.markPotentiallyOrphaned(e,h.key)}).next(()=>{this.vr=o})}Bn(e){}containsKey(e,t){const o=new js(t,0),h=this.vr.firstAfterOrEqual(o);return Mt.resolve(t.isEqual(h&&h.key))}performConsistencyCheck(e){return this.mutationQueue.length,Mt.resolve()}Or(e,t){return this.Fr(e)}Fr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Cr(e){const t=this.Fr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IR{constructor(e){this.Nr=e,this.docs=function(){return new lo(zn.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const o=t.key,h=this.docs.get(o),g=h?h.size:0,_=this.Nr(t);return this.docs=this.docs.insert(o,{document:t.mutableCopy(),size:_}),this.size+=_-g,this.indexManager.addToCollectionParentIndex(e,o.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const o=this.docs.get(t);return Mt.resolve(o?o.document.mutableCopy():ja.newInvalidDocument(t))}getEntries(e,t){let o=Jh();return t.forEach(h=>{const g=this.docs.get(h);o=o.insert(h,g?g.document.mutableCopy():ja.newInvalidDocument(h))}),Mt.resolve(o)}getDocumentsMatchingQuery(e,t,o,h){let g=Jh();const _=t.path,u=new zn(_.child("__id-9223372036854775808__")),R=this.docs.getIteratorFrom(u);for(;R.hasNext();){const{key:O,value:{document:G}}=R.getNext();if(!_.isPrefixOf(O.path))break;O.path.length>_.length+1||nM(tM(G),o)<=0||(h.has(G.key)||Hy(t,G))&&(g=g.insert(G.key,G.mutableCopy()))}return Mt.resolve(g)}getAllFromCollectionGroup(e,t,o,h){Xn()}Br(e,t){return Mt.forEach(this.docs,o=>t(o))}newChangeBuffer(e){return new PR(this)}getSize(e){return Mt.resolve(this.size)}}class PR extends vR{constructor(e){super(),this.hr=e}applyChanges(e){const t=[];return this.changes.forEach((o,h)=>{h.isValidDocument()?t.push(this.hr.addEntry(e,h)):this.hr.removeEntry(o)}),Mt.waitFor(t)}getFromCache(e,t){return this.hr.getEntry(e,t)}getAllFromCache(e,t){return this.hr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CR{constructor(e){this.persistence=e,this.Lr=new Up(t=>hx(t),dx),this.lastRemoteSnapshotVersion=ni.min(),this.highestTargetId=0,this.kr=0,this.qr=new _x,this.targetCount=0,this.Qr=Xf.qn()}forEachTarget(e,t){return this.Lr.forEach((o,h)=>t(h)),Mt.resolve()}getLastRemoteSnapshotVersion(e){return Mt.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return Mt.resolve(this.kr)}allocateTargetId(e){return this.highestTargetId=this.Qr.next(),Mt.resolve(this.highestTargetId)}setTargetsMetadata(e,t,o){return o&&(this.lastRemoteSnapshotVersion=o),t>this.kr&&(this.kr=t),Mt.resolve()}Un(e){this.Lr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Qr=new Xf(t),this.highestTargetId=t),e.sequenceNumber>this.kr&&(this.kr=e.sequenceNumber)}addTargetData(e,t){return this.Un(t),this.targetCount+=1,Mt.resolve()}updateTargetData(e,t){return this.Un(t),Mt.resolve()}removeTargetData(e,t){return this.Lr.delete(t.target),this.qr.yr(t.targetId),this.targetCount-=1,Mt.resolve()}removeTargets(e,t,o){let h=0;const g=[];return this.Lr.forEach((_,u)=>{u.sequenceNumber<=t&&o.get(u.targetId)===null&&(this.Lr.delete(_),g.push(this.removeMatchingKeysForTargetId(e,u.targetId)),h++)}),Mt.waitFor(g).next(()=>h)}getTargetCount(e){return Mt.resolve(this.targetCount)}getTargetData(e,t){const o=this.Lr.get(t)||null;return Mt.resolve(o)}addMatchingKeys(e,t,o){return this.qr.mr(t,o),Mt.resolve()}removeMatchingKeys(e,t,o){this.qr.pr(t,o);const h=this.persistence.referenceDelegate,g=[];return h&&t.forEach(_=>{g.push(h.markPotentiallyOrphaned(e,_))}),Mt.waitFor(g)}removeMatchingKeysForTargetId(e,t){return this.qr.yr(t),Mt.resolve()}getMatchingKeysForTargetId(e,t){const o=this.qr.Sr(t);return Mt.resolve(o)}containsKey(e,t){return Mt.resolve(this.qr.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gS{constructor(e,t){this.Kr={},this.overlays={},this.$r=new Vy(0),this.Ur=!1,this.Ur=!0,this.Wr=new SR,this.referenceDelegate=e(this),this.Gr=new CR(this),this.indexManager=new pR,this.remoteDocumentCache=function(h){return new IR(h)}(o=>this.referenceDelegate.zr(o)),this.serializer=new hR(t),this.jr=new bR(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Ur=!1,Promise.resolve()}get started(){return this.Ur}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new TR,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let o=this.Kr[e.toKey()];return o||(o=new ER(t,this.referenceDelegate),this.Kr[e.toKey()]=o),o}getGlobalsCache(){return this.Wr}getTargetCache(){return this.Gr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.jr}runTransaction(e,t,o){fn("MemoryPersistence","Starting transaction:",e);const h=new AR(this.$r.next());return this.referenceDelegate.Hr(),o(h).next(g=>this.referenceDelegate.Jr(h).next(()=>g)).toPromise().then(g=>(h.raiseOnCommittedEvent(),g))}Yr(e,t){return Mt.or(Object.values(this.Kr).map(o=>()=>o.containsKey(e,t)))}}class AR extends rM{constructor(e){super(),this.currentSequenceNumber=e}}class yx{constructor(e){this.persistence=e,this.Zr=new _x,this.Xr=null}static ei(e){return new yx(e)}get ti(){if(this.Xr)return this.Xr;throw Xn()}addReference(e,t,o){return this.Zr.addReference(o,t),this.ti.delete(o.toString()),Mt.resolve()}removeReference(e,t,o){return this.Zr.removeReference(o,t),this.ti.add(o.toString()),Mt.resolve()}markPotentiallyOrphaned(e,t){return this.ti.add(t.toString()),Mt.resolve()}removeTarget(e,t){this.Zr.yr(t.targetId).forEach(h=>this.ti.add(h.toString()));const o=this.persistence.getTargetCache();return o.getMatchingKeysForTargetId(e,t.targetId).next(h=>{h.forEach(g=>this.ti.add(g.toString()))}).next(()=>o.removeTargetData(e,t))}Hr(){this.Xr=new Set}Jr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Mt.forEach(this.ti,o=>{const h=zn.fromPath(o);return this.ni(e,h).next(g=>{g||t.removeEntry(h,ni.min())})}).next(()=>(this.Xr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ni(e,t).next(o=>{o?this.ti.delete(t.toString()):this.ti.add(t.toString())})}zr(e){return 0}ni(e,t){return Mt.or([()=>Mt.resolve(this.Zr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Yr(e,t)])}}class py{constructor(e,t){this.persistence=e,this.ri=new Up(o=>aM(o.path),(o,h)=>o.isEqual(h)),this.garbageCollector=yR(this,t)}static ei(e,t){return new py(e,t)}Hr(){}Jr(e){return Mt.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}Xn(e){const t=this.nr(e);return this.persistence.getTargetCache().getTargetCount(e).next(o=>t.next(h=>o+h))}nr(e){let t=0;return this.er(e,o=>{t++}).next(()=>t)}er(e,t){return Mt.forEach(this.ri,(o,h)=>this.ir(e,o,h).next(g=>g?Mt.resolve():t(h)))}removeTargets(e,t,o){return this.persistence.getTargetCache().removeTargets(e,t,o)}removeOrphanedDocuments(e,t){let o=0;const h=this.persistence.getRemoteDocumentCache(),g=h.newChangeBuffer();return h.Br(e,_=>this.ir(e,_,t).next(u=>{u||(o++,g.removeEntry(_,ni.min()))})).next(()=>g.apply(e)).next(()=>o)}markPotentiallyOrphaned(e,t){return this.ri.set(t,e.currentSequenceNumber),Mt.resolve()}removeTarget(e,t){const o=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,o)}addReference(e,t,o){return this.ri.set(o,e.currentSequenceNumber),Mt.resolve()}removeReference(e,t,o){return this.ri.set(o,e.currentSequenceNumber),Mt.resolve()}updateLimboDocument(e,t){return this.ri.set(t,e.currentSequenceNumber),Mt.resolve()}zr(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=q_(e.data.value)),t}ir(e,t,o){return Mt.or([()=>this.persistence.Yr(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const h=this.ri.get(t);return Mt.resolve(h!==void 0&&h>o)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vx{constructor(e,t,o,h){this.targetId=e,this.fromCache=t,this.Wi=o,this.Gi=h}static zi(e,t){let o=ki(),h=ki();for(const g of t.docChanges)switch(g.type){case 0:o=o.add(g.doc.key);break;case 1:h=h.add(g.doc.key)}return new vx(e,t.fromCache,o,h)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kR{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MR{constructor(){this.ji=!1,this.Hi=!1,this.Ji=100,this.Yi=function(){return SA()?8:oM($a())>0?6:4}()}initialize(e,t){this.Zi=e,this.indexManager=t,this.ji=!0}getDocumentsMatchingQuery(e,t,o,h){const g={result:null};return this.Xi(e,t).next(_=>{g.result=_}).next(()=>{if(!g.result)return this.es(e,t,h,o).next(_=>{g.result=_})}).next(()=>{if(g.result)return;const _=new kR;return this.ts(e,t,_).next(u=>{if(g.result=u,this.Hi)return this.ns(e,t,_,u.size)})}).next(()=>g.result)}ns(e,t,o,h){return o.documentReadCount<this.Ji?(kf()<=Ai.DEBUG&&fn("QueryEngine","SDK will not create cache indexes for query:",Mf(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Ji,"documents"),Mt.resolve()):(kf()<=Ai.DEBUG&&fn("QueryEngine","Query:",Mf(t),"scans",o.documentReadCount,"local documents and returns",h,"documents as results."),o.documentReadCount>this.Yi*h?(kf()<=Ai.DEBUG&&fn("QueryEngine","The SDK decides to create cache indexes for query:",Mf(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,rh(t))):Mt.resolve())}Xi(e,t){if(Zb(t))return Mt.resolve(null);let o=rh(t);return this.indexManager.getIndexType(e,o).next(h=>h===0?null:(t.limit!==null&&h===1&&(t=cy(t,null,"F"),o=rh(t)),this.indexManager.getDocumentsMatchingTarget(e,o).next(g=>{const _=ki(...g);return this.Zi.getDocuments(e,_).next(u=>this.indexManager.getMinOffset(e,o).next(R=>{const O=this.rs(t,u);return this.ss(t,O,_,R.readTime)?this.Xi(e,cy(t,null,"F")):this.os(e,O,t,R)}))})))}es(e,t,o,h){return Zb(t)||h.isEqual(ni.min())?Mt.resolve(null):this.Zi.getDocuments(e,o).next(g=>{const _=this.rs(t,g);return this.ss(t,_,o,h)?Mt.resolve(null):(kf()<=Ai.DEBUG&&fn("QueryEngine","Re-using previous result from %s to execute query: %s",h.toString(),Mf(t)),this.os(e,_,t,eM(h,-1)).next(u=>u))})}rs(e,t){let o=new ws(W2(e));return t.forEach((h,g)=>{Hy(e,g)&&(o=o.add(g))}),o}ss(e,t,o,h){if(e.limit===null)return!1;if(o.size!==t.size)return!0;const g=e.limitType==="F"?t.last():t.first();return!!g&&(g.hasPendingWrites||g.version.compareTo(h)>0)}ts(e,t,o){return kf()<=Ai.DEBUG&&fn("QueryEngine","Using full collection scan to execute query:",Mf(t)),this.Zi.getDocumentsMatchingQuery(e,t,Fd.min(),o)}os(e,t,o,h){return this.Zi.getDocumentsMatchingQuery(e,o,h).next(g=>(t.forEach(_=>{g=g.insert(_.key,_)}),g))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RR{constructor(e,t,o,h){this.persistence=e,this._s=t,this.serializer=h,this.us=new lo(Vi),this.cs=new Up(g=>hx(g),dx),this.ls=new Map,this.hs=e.getRemoteDocumentCache(),this.Gr=e.getTargetCache(),this.jr=e.getBundleCache(),this.Ps(o)}Ps(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new wR(this.hs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.hs.setIndexManager(this.indexManager),this._s.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.us))}}function LR(i,e,t,o){return new RR(i,e,t,o)}async function _S(i,e){const t=ii(i);return await t.persistence.runTransaction("Handle user change","readonly",o=>{let h;return t.mutationQueue.getAllMutationBatches(o).next(g=>(h=g,t.Ps(e),t.mutationQueue.getAllMutationBatches(o))).next(g=>{const _=[],u=[];let R=ki();for(const O of h){_.push(O.batchId);for(const G of O.mutations)R=R.add(G.key)}for(const O of g){u.push(O.batchId);for(const G of O.mutations)R=R.add(G.key)}return t.localDocuments.getDocuments(o,R).next(O=>({Ts:O,removedBatchIds:_,addedBatchIds:u}))})})}function DR(i,e){const t=ii(i);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",o=>{const h=e.batch.keys(),g=t.hs.newChangeBuffer({trackRemovals:!0});return function(u,R,O,G){const ne=O.batch,re=ne.keys();let Q=Mt.resolve();return re.forEach(de=>{Q=Q.next(()=>G.getEntry(R,de)).next(Se=>{const De=O.docVersions.get(de);fr(De!==null),Se.version.compareTo(De)<0&&(ne.applyToRemoteDocument(Se,O),Se.isValidDocument()&&(Se.setReadTime(O.commitVersion),G.addEntry(Se)))})}),Q.next(()=>u.mutationQueue.removeMutationBatch(R,ne))}(t,o,e,g).next(()=>g.apply(o)).next(()=>t.mutationQueue.performConsistencyCheck(o)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(o,h,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(o,function(u){let R=ki();for(let O=0;O<u.mutationResults.length;++O)u.mutationResults[O].transformResults.length>0&&(R=R.add(u.batch.mutations[O].key));return R}(e))).next(()=>t.localDocuments.getDocuments(o,h))})}function yS(i){const e=ii(i);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Gr.getLastRemoteSnapshotVersion(t))}function zR(i,e){const t=ii(i),o=e.snapshotVersion;let h=t.us;return t.persistence.runTransaction("Apply remote event","readwrite-primary",g=>{const _=t.hs.newChangeBuffer({trackRemovals:!0});h=t.us;const u=[];e.targetChanges.forEach((G,ne)=>{const re=h.get(ne);if(!re)return;u.push(t.Gr.removeMatchingKeys(g,G.removedDocuments,ne).next(()=>t.Gr.addMatchingKeys(g,G.addedDocuments,ne)));let Q=re.withSequenceNumber(g.currentSequenceNumber);e.targetMismatches.get(ne)!==null?Q=Q.withResumeToken(ga.EMPTY_BYTE_STRING,ni.min()).withLastLimboFreeSnapshotVersion(ni.min()):G.resumeToken.approximateByteSize()>0&&(Q=Q.withResumeToken(G.resumeToken,o)),h=h.insert(ne,Q),function(Se,De,Ke){return Se.resumeToken.approximateByteSize()===0||De.snapshotVersion.toMicroseconds()-Se.snapshotVersion.toMicroseconds()>=3e8?!0:Ke.addedDocuments.size+Ke.modifiedDocuments.size+Ke.removedDocuments.size>0}(re,Q,G)&&u.push(t.Gr.updateTargetData(g,Q))});let R=Jh(),O=ki();if(e.documentUpdates.forEach(G=>{e.resolvedLimboDocuments.has(G)&&u.push(t.persistence.referenceDelegate.updateLimboDocument(g,G))}),u.push(NR(g,_,e.documentUpdates).next(G=>{R=G.Is,O=G.ds})),!o.isEqual(ni.min())){const G=t.Gr.getLastRemoteSnapshotVersion(g).next(ne=>t.Gr.setTargetsMetadata(g,g.currentSequenceNumber,o));u.push(G)}return Mt.waitFor(u).next(()=>_.apply(g)).next(()=>t.localDocuments.getLocalViewOfDocuments(g,R,O)).next(()=>R)}).then(g=>(t.us=h,g))}function NR(i,e,t){let o=ki(),h=ki();return t.forEach(g=>o=o.add(g)),e.getEntries(i,o).next(g=>{let _=Jh();return t.forEach((u,R)=>{const O=g.get(u);R.isFoundDocument()!==O.isFoundDocument()&&(h=h.add(u)),R.isNoDocument()&&R.version.isEqual(ni.min())?(e.removeEntry(u,R.readTime),_=_.insert(u,R)):!O.isValidDocument()||R.version.compareTo(O.version)>0||R.version.compareTo(O.version)===0&&O.hasPendingWrites?(e.addEntry(R),_=_.insert(u,R)):fn("LocalStore","Ignoring outdated watch update for ",u,". Current version:",O.version," Watch version:",R.version)}),{Is:_,ds:h}})}function OR(i,e){const t=ii(i);return t.persistence.runTransaction("Get next mutation batch","readonly",o=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(o,e)))}function FR(i,e){const t=ii(i);return t.persistence.runTransaction("Allocate target","readwrite",o=>{let h;return t.Gr.getTargetData(o,e).next(g=>g?(h=g,Mt.resolve(h)):t.Gr.allocateTargetId(o).next(_=>(h=new Md(e,_,"TargetPurposeListen",o.currentSequenceNumber),t.Gr.addTargetData(o,h).next(()=>h))))}).then(o=>{const h=t.us.get(o.targetId);return(h===null||o.snapshotVersion.compareTo(h.snapshotVersion)>0)&&(t.us=t.us.insert(o.targetId,o),t.cs.set(e,o.targetId)),o})}async function R0(i,e,t){const o=ii(i),h=o.us.get(e),g=t?"readwrite":"readwrite-primary";try{t||await o.persistence.runTransaction("Release target",g,_=>o.persistence.referenceDelegate.removeTarget(_,h))}catch(_){if(!am(_))throw _;fn("LocalStore",`Failed to update sequence numbers for target ${e}: ${_}`)}o.us=o.us.remove(e),o.cs.delete(h.target)}function o1(i,e,t){const o=ii(i);let h=ni.min(),g=ki();return o.persistence.runTransaction("Execute query","readwrite",_=>function(R,O,G){const ne=ii(R),re=ne.cs.get(G);return re!==void 0?Mt.resolve(ne.us.get(re)):ne.Gr.getTargetData(O,G)}(o,_,rh(e)).next(u=>{if(u)return h=u.lastLimboFreeSnapshotVersion,o.Gr.getMatchingKeysForTargetId(_,u.targetId).next(R=>{g=R})}).next(()=>o._s.getDocumentsMatchingQuery(_,e,t?h:ni.min(),t?g:ki())).next(u=>(BR(o,EM(e),u),{documents:u,Es:g})))}function BR(i,e,t){let o=i.ls.get(e)||ni.min();t.forEach((h,g)=>{g.readTime.compareTo(o)>0&&(o=g.readTime)}),i.ls.set(e,o)}class s1{constructor(){this.activeTargetIds=MM()}ps(e){this.activeTargetIds=this.activeTargetIds.add(e)}ys(e){this.activeTargetIds=this.activeTargetIds.delete(e)}gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class VR{constructor(){this._o=new s1,this.ao={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,o){}addLocalQueryTarget(e,t=!0){return t&&this._o.ps(e),this.ao[e]||"not-current"}updateQueryState(e,t,o){this.ao[e]=t}removeLocalQueryTarget(e){this._o.ys(e)}isLocalQueryTarget(e){return this._o.activeTargetIds.has(e)}clearQueryState(e){delete this.ao[e]}getAllActiveQueryTargets(){return this._o.activeTargetIds}isActiveQueryTarget(e){return this._o.activeTargetIds.has(e)}start(){return this._o=new s1,Promise.resolve()}handleUserChange(e,t,o){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UR{uo(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class a1{constructor(){this.co=()=>this.lo(),this.ho=()=>this.Po(),this.To=[],this.Io()}uo(e){this.To.push(e)}shutdown(){window.removeEventListener("online",this.co),window.removeEventListener("offline",this.ho)}Io(){window.addEventListener("online",this.co),window.addEventListener("offline",this.ho)}lo(){fn("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.To)e(0)}Po(){fn("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.To)e(1)}static p(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let k_=null;function Xv(){return k_===null?k_=function(){return 268435456+Math.round(2147483648*Math.random())}():k_++,"0x"+k_.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jR={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $R{constructor(e){this.Eo=e.Eo,this.Ao=e.Ao}Ro(e){this.Vo=e}mo(e){this.fo=e}po(e){this.yo=e}onMessage(e){this.wo=e}close(){this.Ao()}send(e){this.Eo(e)}So(){this.Vo()}bo(){this.fo()}Do(e){this.yo(e)}vo(e){this.wo(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Va="WebChannelConnection";class HR extends class{get Co(){return!1}constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const o=t.ssl?"https":"http",h=encodeURIComponent(this.databaseId.projectId),g=encodeURIComponent(this.databaseId.database);this.Fo=o+"://"+t.host,this.Mo=`projects/${h}/databases/${g}`,this.xo=this.databaseId.database==="(default)"?`project_id=${h}`:`project_id=${h}&database_id=${g}`}Oo(t,o,h,g,_){const u=Xv(),R=this.No(t,o.toUriEncodedString());fn("RestConnection",`Sending RPC '${t}' ${u}:`,R,h);const O={"google-cloud-resource-prefix":this.Mo,"x-goog-request-params":this.xo};return this.Bo(O,g,_),this.Lo(t,R,O,h).then(G=>(fn("RestConnection",`Received RPC '${t}' ${u}: `,G),G),G=>{throw Gf("RestConnection",`RPC '${t}' ${u} failed with error: `,G,"url: ",R,"request:",h),G})}ko(t,o,h,g,_,u){return this.Oo(t,o,h,g,_)}Bo(t,o,h){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+om}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),o&&o.headers.forEach((g,_)=>t[_]=g),h&&h.headers.forEach((g,_)=>t[_]=g)}No(t,o){const h=jR[t];return`${this.Fo}/v1/${o}:${h}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Lo(e,t,o,h){const g=Xv();return new Promise((_,u)=>{const R=new A2;R.setWithCredentials(!0),R.listenOnce(k2.COMPLETE,()=>{try{switch(R.getLastErrorCode()){case H_.NO_ERROR:const G=R.getResponseJson();fn(Va,`XHR for RPC '${e}' ${g} received:`,JSON.stringify(G)),_(G);break;case H_.TIMEOUT:fn(Va,`RPC '${e}' ${g} timed out`),u(new vn(Rt.DEADLINE_EXCEEDED,"Request time out"));break;case H_.HTTP_ERROR:const ne=R.getStatus();if(fn(Va,`RPC '${e}' ${g} failed with status:`,ne,"response text:",R.getResponseText()),ne>0){let re=R.getResponseJson();Array.isArray(re)&&(re=re[0]);const Q=re?.error;if(Q&&Q.status&&Q.message){const de=function(De){const Ke=De.toLowerCase().replace(/_/g,"-");return Object.values(Rt).indexOf(Ke)>=0?Ke:Rt.UNKNOWN}(Q.status);u(new vn(de,Q.message))}else u(new vn(Rt.UNKNOWN,"Server responded with status "+R.getStatus()))}else u(new vn(Rt.UNAVAILABLE,"Connection failed."));break;default:Xn()}}finally{fn(Va,`RPC '${e}' ${g} completed.`)}});const O=JSON.stringify(h);fn(Va,`RPC '${e}' ${g} sending request:`,h),R.send(t,"POST",O,o,15)})}qo(e,t,o){const h=Xv(),g=[this.Fo,"/","google.firestore.v1.Firestore","/",e,"/channel"],_=L2(),u=R2(),R={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},O=this.longPollingOptions.timeoutSeconds;O!==void 0&&(R.longPollingTimeout=Math.round(1e3*O)),this.useFetchStreams&&(R.useFetchStreams=!0),this.Bo(R.initMessageHeaders,t,o),R.encodeInitMessageHeaders=!0;const G=g.join("");fn(Va,`Creating RPC '${e}' stream ${h}: ${G}`,R);const ne=_.createWebChannel(G,R);let re=!1,Q=!1;const de=new $R({Eo:De=>{Q?fn(Va,`Not sending because RPC '${e}' stream ${h} is closed:`,De):(re||(fn(Va,`Opening RPC '${e}' stream ${h} transport.`),ne.open(),re=!0),fn(Va,`RPC '${e}' stream ${h} sending:`,De),ne.send(De))},Ao:()=>ne.close()}),Se=(De,Ke,et)=>{De.listen(Ke,vt=>{try{et(vt)}catch(Ye){setTimeout(()=>{throw Ye},0)}})};return Se(ne,eg.EventType.OPEN,()=>{Q||(fn(Va,`RPC '${e}' stream ${h} transport opened.`),de.So())}),Se(ne,eg.EventType.CLOSE,()=>{Q||(Q=!0,fn(Va,`RPC '${e}' stream ${h} transport closed`),de.Do())}),Se(ne,eg.EventType.ERROR,De=>{Q||(Q=!0,Gf(Va,`RPC '${e}' stream ${h} transport errored:`,De),de.Do(new vn(Rt.UNAVAILABLE,"The operation could not be completed")))}),Se(ne,eg.EventType.MESSAGE,De=>{var Ke;if(!Q){const et=De.data[0];fr(!!et);const vt=et,Ye=vt?.error||((Ke=vt[0])===null||Ke===void 0?void 0:Ke.error);if(Ye){fn(Va,`RPC '${e}' stream ${h} received error:`,Ye);const it=Ye.status;let at=function(pe){const xe=Xo[pe];if(xe!==void 0)return sS(xe)}(it),be=Ye.message;at===void 0&&(at=Rt.INTERNAL,be="Unknown error status: "+it+" with message "+Ye.message),Q=!0,de.Do(new vn(at,be)),ne.close()}else fn(Va,`RPC '${e}' stream ${h} received:`,et),de.vo(et)}}),Se(u,M2.STAT_EVENT,De=>{De.stat===b0.PROXY?fn(Va,`RPC '${e}' stream ${h} detected buffering proxy`):De.stat===b0.NOPROXY&&fn(Va,`RPC '${e}' stream ${h} detected no buffering proxy`)}),setTimeout(()=>{de.bo()},0),de}}function Yv(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wy(i){return new YM(i,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vS{constructor(e,t,o=1e3,h=1.5,g=6e4){this.li=e,this.timerId=t,this.Qo=o,this.Ko=h,this.$o=g,this.Uo=0,this.Wo=null,this.Go=Date.now(),this.reset()}reset(){this.Uo=0}zo(){this.Uo=this.$o}jo(e){this.cancel();const t=Math.floor(this.Uo+this.Ho()),o=Math.max(0,Date.now()-this.Go),h=Math.max(0,t-o);h>0&&fn("ExponentialBackoff",`Backing off for ${h} ms (base delay: ${this.Uo} ms, delay with jitter: ${t} ms, last attempt: ${o} ms ago)`),this.Wo=this.li.enqueueAfterDelay(this.timerId,h,()=>(this.Go=Date.now(),e())),this.Uo*=this.Ko,this.Uo<this.Qo&&(this.Uo=this.Qo),this.Uo>this.$o&&(this.Uo=this.$o)}Jo(){this.Wo!==null&&(this.Wo.skipDelay(),this.Wo=null)}cancel(){this.Wo!==null&&(this.Wo.cancel(),this.Wo=null)}Ho(){return(Math.random()-.5)*this.Uo}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xS{constructor(e,t,o,h,g,_,u,R){this.li=e,this.Yo=o,this.Zo=h,this.connection=g,this.authCredentialsProvider=_,this.appCheckCredentialsProvider=u,this.listener=R,this.state=0,this.Xo=0,this.e_=null,this.t_=null,this.stream=null,this.n_=0,this.r_=new vS(e,t)}i_(){return this.state===1||this.state===5||this.s_()}s_(){return this.state===2||this.state===3}start(){this.n_=0,this.state!==4?this.auth():this.o_()}async stop(){this.i_()&&await this.close(0)}__(){this.state=0,this.r_.reset()}a_(){this.s_()&&this.e_===null&&(this.e_=this.li.enqueueAfterDelay(this.Yo,6e4,()=>this.u_()))}c_(e){this.l_(),this.stream.send(e)}async u_(){if(this.s_())return this.close(0)}l_(){this.e_&&(this.e_.cancel(),this.e_=null)}h_(){this.t_&&(this.t_.cancel(),this.t_=null)}async close(e,t){this.l_(),this.h_(),this.r_.cancel(),this.Xo++,e!==4?this.r_.reset():t&&t.code===Rt.RESOURCE_EXHAUSTED?(Qh(t.toString()),Qh("Using maximum backoff delay to prevent overloading the backend."),this.r_.zo()):t&&t.code===Rt.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.P_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.po(t)}P_(){}auth(){this.state=1;const e=this.T_(this.Xo),t=this.Xo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([o,h])=>{this.Xo===t&&this.I_(o,h)},o=>{e(()=>{const h=new vn(Rt.UNKNOWN,"Fetching auth token failed: "+o.message);return this.d_(h)})})}I_(e,t){const o=this.T_(this.Xo);this.stream=this.E_(e,t),this.stream.Ro(()=>{o(()=>this.listener.Ro())}),this.stream.mo(()=>{o(()=>(this.state=2,this.t_=this.li.enqueueAfterDelay(this.Zo,1e4,()=>(this.s_()&&(this.state=3),Promise.resolve())),this.listener.mo()))}),this.stream.po(h=>{o(()=>this.d_(h))}),this.stream.onMessage(h=>{o(()=>++this.n_==1?this.A_(h):this.onNext(h))})}o_(){this.state=5,this.r_.jo(async()=>{this.state=0,this.start()})}d_(e){return fn("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}T_(e){return t=>{this.li.enqueueAndForget(()=>this.Xo===e?t():(fn("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class qR extends xS{constructor(e,t,o,h,g,_){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,o,h,_),this.serializer=g}E_(e,t){return this.connection.qo("Listen",e,t)}A_(e){return this.onNext(e)}onNext(e){this.r_.reset();const t=eR(this.serializer,e),o=function(g){if(!("targetChange"in g))return ni.min();const _=g.targetChange;return _.targetIds&&_.targetIds.length?ni.min():_.readTime?oh(_.readTime):ni.min()}(e);return this.listener.R_(t,o)}V_(e){const t={};t.database=M0(this.serializer),t.addTarget=function(g,_){let u;const R=_.target;if(u=I0(R)?{documents:iR(g,R)}:{query:rR(g,R).ct},u.targetId=_.targetId,_.resumeToken.approximateByteSize()>0){u.resumeToken=uS(g,_.resumeToken);const O=C0(g,_.expectedCount);O!==null&&(u.expectedCount=O)}else if(_.snapshotVersion.compareTo(ni.min())>0){u.readTime=dy(g,_.snapshotVersion.toTimestamp());const O=C0(g,_.expectedCount);O!==null&&(u.expectedCount=O)}return u}(this.serializer,e);const o=sR(this.serializer,e);o&&(t.labels=o),this.c_(t)}m_(e){const t={};t.database=M0(this.serializer),t.removeTarget=e,this.c_(t)}}class GR extends xS{constructor(e,t,o,h,g,_){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,o,h,_),this.serializer=g}get f_(){return this.n_>0}start(){this.lastStreamToken=void 0,super.start()}P_(){this.f_&&this.g_([])}E_(e,t){return this.connection.qo("Write",e,t)}A_(e){return fr(!!e.streamToken),this.lastStreamToken=e.streamToken,fr(!e.writeResults||e.writeResults.length===0),this.listener.p_()}onNext(e){fr(!!e.streamToken),this.lastStreamToken=e.streamToken,this.r_.reset();const t=nR(e.writeResults,e.commitTime),o=oh(e.commitTime);return this.listener.y_(o,t)}w_(){const e={};e.database=M0(this.serializer),this.c_(e)}g_(e){const t={streamToken:this.lastStreamToken,writes:e.map(o=>tR(this.serializer,o))};this.c_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZR extends class{}{constructor(e,t,o,h){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=o,this.serializer=h,this.S_=!1}b_(){if(this.S_)throw new vn(Rt.FAILED_PRECONDITION,"The client has already been terminated.")}Oo(e,t,o,h){return this.b_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([g,_])=>this.connection.Oo(e,A0(t,o),h,g,_)).catch(g=>{throw g.name==="FirebaseError"?(g.code===Rt.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),g):new vn(Rt.UNKNOWN,g.toString())})}ko(e,t,o,h,g){return this.b_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([_,u])=>this.connection.ko(e,A0(t,o),h,_,u,g)).catch(_=>{throw _.name==="FirebaseError"?(_.code===Rt.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),_):new vn(Rt.UNKNOWN,_.toString())})}terminate(){this.S_=!0,this.connection.terminate()}}class WR{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.D_=0,this.v_=null,this.C_=!0}F_(){this.D_===0&&(this.M_("Unknown"),this.v_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.v_=null,this.x_("Backend didn't respond within 10 seconds."),this.M_("Offline"),Promise.resolve())))}O_(e){this.state==="Online"?this.M_("Unknown"):(this.D_++,this.D_>=1&&(this.N_(),this.x_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.M_("Offline")))}set(e){this.N_(),this.D_=0,e==="Online"&&(this.C_=!1),this.M_(e)}M_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}x_(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.C_?(Qh(t),this.C_=!1):fn("OnlineStateTracker",t)}N_(){this.v_!==null&&(this.v_.cancel(),this.v_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KR{constructor(e,t,o,h,g){this.localStore=e,this.datastore=t,this.asyncQueue=o,this.remoteSyncer={},this.B_=[],this.L_=new Map,this.k_=new Set,this.q_=[],this.Q_=g,this.Q_.uo(_=>{o.enqueueAndForget(async()=>{$p(this)&&(fn("RemoteStore","Restarting streams for network reachability change."),await async function(R){const O=ii(R);O.k_.add(4),await Bg(O),O.K_.set("Unknown"),O.k_.delete(4),await Ky(O)}(this))})}),this.K_=new WR(o,h)}}async function Ky(i){if($p(i))for(const e of i.q_)await e(!0)}async function Bg(i){for(const e of i.q_)await e(!1)}function wS(i,e){const t=ii(i);t.L_.has(e.targetId)||(t.L_.set(e.targetId,e),Tx(t)?bx(t):um(t).s_()&&wx(t,e))}function xx(i,e){const t=ii(i),o=um(t);t.L_.delete(e),o.s_()&&bS(t,e),t.L_.size===0&&(o.s_()?o.a_():$p(t)&&t.K_.set("Unknown"))}function wx(i,e){if(i.U_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(ni.min())>0){const t=i.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}um(i).V_(e)}function bS(i,e){i.U_.xe(e),um(i).m_(e)}function bx(i){i.U_=new ZM({getRemoteKeysForTarget:e=>i.remoteSyncer.getRemoteKeysForTarget(e),ut:e=>i.L_.get(e)||null,nt:()=>i.datastore.serializer.databaseId}),um(i).start(),i.K_.F_()}function Tx(i){return $p(i)&&!um(i).i_()&&i.L_.size>0}function $p(i){return ii(i).k_.size===0}function TS(i){i.U_=void 0}async function XR(i){i.K_.set("Online")}async function YR(i){i.L_.forEach((e,t)=>{wx(i,e)})}async function QR(i,e){TS(i),Tx(i)?(i.K_.O_(e),bx(i)):i.K_.set("Unknown")}async function JR(i,e,t){if(i.K_.set("Online"),e instanceof lS&&e.state===2&&e.cause)try{await async function(h,g){const _=g.cause;for(const u of g.targetIds)h.L_.has(u)&&(await h.remoteSyncer.rejectListen(u,_),h.L_.delete(u),h.U_.removeTarget(u))}(i,e)}catch(o){fn("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),o),await fy(i,o)}else if(e instanceof W_?i.U_.$e(e):e instanceof aS?i.U_.Je(e):i.U_.Ge(e),!t.isEqual(ni.min()))try{const o=await yS(i.localStore);t.compareTo(o)>=0&&await function(g,_){const u=g.U_.it(_);return u.targetChanges.forEach((R,O)=>{if(R.resumeToken.approximateByteSize()>0){const G=g.L_.get(O);G&&g.L_.set(O,G.withResumeToken(R.resumeToken,_))}}),u.targetMismatches.forEach((R,O)=>{const G=g.L_.get(R);if(!G)return;g.L_.set(R,G.withResumeToken(ga.EMPTY_BYTE_STRING,G.snapshotVersion)),bS(g,R);const ne=new Md(G.target,R,O,G.sequenceNumber);wx(g,ne)}),g.remoteSyncer.applyRemoteEvent(u)}(i,t)}catch(o){fn("RemoteStore","Failed to raise snapshot:",o),await fy(i,o)}}async function fy(i,e,t){if(!am(e))throw e;i.k_.add(1),await Bg(i),i.K_.set("Offline"),t||(t=()=>yS(i.localStore)),i.asyncQueue.enqueueRetryable(async()=>{fn("RemoteStore","Retrying IndexedDB access"),await t(),i.k_.delete(1),await Ky(i)})}function SS(i,e){return e().catch(t=>fy(i,t,e))}async function Xy(i){const e=ii(i),t=jd(e);let o=e.B_.length>0?e.B_[e.B_.length-1].batchId:-1;for(;eL(e);)try{const h=await OR(e.localStore,o);if(h===null){e.B_.length===0&&t.a_();break}o=h.batchId,tL(e,h)}catch(h){await fy(e,h)}ES(e)&&IS(e)}function eL(i){return $p(i)&&i.B_.length<10}function tL(i,e){i.B_.push(e);const t=jd(i);t.s_()&&t.f_&&t.g_(e.mutations)}function ES(i){return $p(i)&&!jd(i).i_()&&i.B_.length>0}function IS(i){jd(i).start()}async function nL(i){jd(i).w_()}async function iL(i){const e=jd(i);for(const t of i.B_)e.g_(t.mutations)}async function rL(i,e,t){const o=i.B_.shift(),h=fx.from(o,e,t);await SS(i,()=>i.remoteSyncer.applySuccessfulWrite(h)),await Xy(i)}async function oL(i,e){e&&jd(i).f_&&await async function(o,h){if(function(_){return HM(_)&&_!==Rt.ABORTED}(h.code)){const g=o.B_.shift();jd(o).__(),await SS(o,()=>o.remoteSyncer.rejectFailedWrite(g.batchId,h)),await Xy(o)}}(i,e),ES(i)&&IS(i)}async function l1(i,e){const t=ii(i);t.asyncQueue.verifyOperationInProgress(),fn("RemoteStore","RemoteStore received new credentials");const o=$p(t);t.k_.add(3),await Bg(t),o&&t.K_.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.k_.delete(3),await Ky(t)}async function sL(i,e){const t=ii(i);e?(t.k_.delete(2),await Ky(t)):e||(t.k_.add(2),await Bg(t),t.K_.set("Unknown"))}function um(i){return i.W_||(i.W_=function(t,o,h){const g=ii(t);return g.b_(),new qR(o,g.connection,g.authCredentials,g.appCheckCredentials,g.serializer,h)}(i.datastore,i.asyncQueue,{Ro:XR.bind(null,i),mo:YR.bind(null,i),po:QR.bind(null,i),R_:JR.bind(null,i)}),i.q_.push(async e=>{e?(i.W_.__(),Tx(i)?bx(i):i.K_.set("Unknown")):(await i.W_.stop(),TS(i))})),i.W_}function jd(i){return i.G_||(i.G_=function(t,o,h){const g=ii(t);return g.b_(),new GR(o,g.connection,g.authCredentials,g.appCheckCredentials,g.serializer,h)}(i.datastore,i.asyncQueue,{Ro:()=>Promise.resolve(),mo:nL.bind(null,i),po:oL.bind(null,i),p_:iL.bind(null,i),y_:rL.bind(null,i)}),i.q_.push(async e=>{e?(i.G_.__(),await Xy(i)):(await i.G_.stop(),i.B_.length>0&&(fn("RemoteStore",`Stopping write stream with ${i.B_.length} pending writes`),i.B_=[]))})),i.G_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sx{constructor(e,t,o,h,g){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=o,this.op=h,this.removalCallback=g,this.deferred=new Nd,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(_=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,o,h,g){const _=Date.now()+o,u=new Sx(e,t,_,h,g);return u.start(o),u}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new vn(Rt.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Ex(i,e){if(Qh("AsyncQueue",`${e}: ${i}`),am(i))return new vn(Rt.UNAVAILABLE,`${e}: ${i}`);throw i}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ff{static emptySet(e){return new Ff(e.comparator)}constructor(e){this.comparator=e?(t,o)=>e(t,o)||zn.comparator(t.key,o.key):(t,o)=>zn.comparator(t.key,o.key),this.keyedMap=tg(),this.sortedSet=new lo(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,o)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Ff)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),o=e.sortedSet.getIterator();for(;t.hasNext();){const h=t.getNext().key,g=o.getNext().key;if(!h.isEqual(g))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const o=new Ff;return o.comparator=this.comparator,o.keyedMap=e,o.sortedSet=t,o}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class u1{constructor(){this.z_=new lo(zn.comparator)}track(e){const t=e.doc.key,o=this.z_.get(t);o?e.type!==0&&o.type===3?this.z_=this.z_.insert(t,e):e.type===3&&o.type!==1?this.z_=this.z_.insert(t,{type:o.type,doc:e.doc}):e.type===2&&o.type===2?this.z_=this.z_.insert(t,{type:2,doc:e.doc}):e.type===2&&o.type===0?this.z_=this.z_.insert(t,{type:0,doc:e.doc}):e.type===1&&o.type===0?this.z_=this.z_.remove(t):e.type===1&&o.type===2?this.z_=this.z_.insert(t,{type:1,doc:o.doc}):e.type===0&&o.type===1?this.z_=this.z_.insert(t,{type:2,doc:e.doc}):Xn():this.z_=this.z_.insert(t,e)}j_(){const e=[];return this.z_.inorderTraversal((t,o)=>{e.push(o)}),e}}class Yf{constructor(e,t,o,h,g,_,u,R,O){this.query=e,this.docs=t,this.oldDocs=o,this.docChanges=h,this.mutatedKeys=g,this.fromCache=_,this.syncStateChanged=u,this.excludesMetadataChanges=R,this.hasCachedResults=O}static fromInitialDocuments(e,t,o,h,g){const _=[];return t.forEach(u=>{_.push({type:0,doc:u})}),new Yf(e,t,Ff.emptySet(t),_,o,h,!0,!1,g)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&$y(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,o=e.docChanges;if(t.length!==o.length)return!1;for(let h=0;h<t.length;h++)if(t[h].type!==o[h].type||!t[h].doc.isEqual(o[h].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aL{constructor(){this.H_=void 0,this.J_=[]}Y_(){return this.J_.some(e=>e.Z_())}}class lL{constructor(){this.queries=c1(),this.onlineState="Unknown",this.X_=new Set}terminate(){(function(t,o){const h=ii(t),g=h.queries;h.queries=c1(),g.forEach((_,u)=>{for(const R of u.J_)R.onError(o)})})(this,new vn(Rt.ABORTED,"Firestore shutting down"))}}function c1(){return new Up(i=>Z2(i),$y)}async function uL(i,e){const t=ii(i);let o=3;const h=e.query;let g=t.queries.get(h);g?!g.Y_()&&e.Z_()&&(o=2):(g=new aL,o=e.Z_()?0:1);try{switch(o){case 0:g.H_=await t.onListen(h,!0);break;case 1:g.H_=await t.onListen(h,!1);break;case 2:await t.onFirstRemoteStoreListen(h)}}catch(_){const u=Ex(_,`Initialization of query '${Mf(e.query)}' failed`);return void e.onError(u)}t.queries.set(h,g),g.J_.push(e),e.ea(t.onlineState),g.H_&&e.ta(g.H_)&&Ix(t)}async function cL(i,e){const t=ii(i),o=e.query;let h=3;const g=t.queries.get(o);if(g){const _=g.J_.indexOf(e);_>=0&&(g.J_.splice(_,1),g.J_.length===0?h=e.Z_()?0:1:!g.Y_()&&e.Z_()&&(h=2))}switch(h){case 0:return t.queries.delete(o),t.onUnlisten(o,!0);case 1:return t.queries.delete(o),t.onUnlisten(o,!1);case 2:return t.onLastRemoteStoreUnlisten(o);default:return}}function hL(i,e){const t=ii(i);let o=!1;for(const h of e){const g=h.query,_=t.queries.get(g);if(_){for(const u of _.J_)u.ta(h)&&(o=!0);_.H_=h}}o&&Ix(t)}function dL(i,e,t){const o=ii(i),h=o.queries.get(e);if(h)for(const g of h.J_)g.onError(t);o.queries.delete(e)}function Ix(i){i.X_.forEach(e=>{e.next()})}var L0,h1;(h1=L0||(L0={})).na="default",h1.Cache="cache";class pL{constructor(e,t,o){this.query=e,this.ra=t,this.ia=!1,this.sa=null,this.onlineState="Unknown",this.options=o||{}}ta(e){if(!this.options.includeMetadataChanges){const o=[];for(const h of e.docChanges)h.type!==3&&o.push(h);e=new Yf(e.query,e.docs,e.oldDocs,o,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.ia?this.oa(e)&&(this.ra.next(e),t=!0):this._a(e,this.onlineState)&&(this.aa(e),t=!0),this.sa=e,t}onError(e){this.ra.error(e)}ea(e){this.onlineState=e;let t=!1;return this.sa&&!this.ia&&this._a(this.sa,e)&&(this.aa(this.sa),t=!0),t}_a(e,t){if(!e.fromCache||!this.Z_())return!0;const o=t!=="Offline";return(!this.options.ua||!o)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}oa(e){if(e.docChanges.length>0)return!0;const t=this.sa&&this.sa.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}aa(e){e=Yf.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.ia=!0,this.ra.next(e)}Z_(){return this.options.source!==L0.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PS{constructor(e){this.key=e}}class CS{constructor(e){this.key=e}}class fL{constructor(e,t){this.query=e,this.Ea=t,this.Aa=null,this.hasCachedResults=!1,this.current=!1,this.Ra=ki(),this.mutatedKeys=ki(),this.Va=W2(e),this.ma=new Ff(this.Va)}get fa(){return this.Ea}ga(e,t){const o=t?t.pa:new u1,h=t?t.ma:this.ma;let g=t?t.mutatedKeys:this.mutatedKeys,_=h,u=!1;const R=this.query.limitType==="F"&&h.size===this.query.limit?h.last():null,O=this.query.limitType==="L"&&h.size===this.query.limit?h.first():null;if(e.inorderTraversal((G,ne)=>{const re=h.get(G),Q=Hy(this.query,ne)?ne:null,de=!!re&&this.mutatedKeys.has(re.key),Se=!!Q&&(Q.hasLocalMutations||this.mutatedKeys.has(Q.key)&&Q.hasCommittedMutations);let De=!1;re&&Q?re.data.isEqual(Q.data)?de!==Se&&(o.track({type:3,doc:Q}),De=!0):this.ya(re,Q)||(o.track({type:2,doc:Q}),De=!0,(R&&this.Va(Q,R)>0||O&&this.Va(Q,O)<0)&&(u=!0)):!re&&Q?(o.track({type:0,doc:Q}),De=!0):re&&!Q&&(o.track({type:1,doc:re}),De=!0,(R||O)&&(u=!0)),De&&(Q?(_=_.add(Q),g=Se?g.add(G):g.delete(G)):(_=_.delete(G),g=g.delete(G)))}),this.query.limit!==null)for(;_.size>this.query.limit;){const G=this.query.limitType==="F"?_.last():_.first();_=_.delete(G.key),g=g.delete(G.key),o.track({type:1,doc:G})}return{ma:_,pa:o,ss:u,mutatedKeys:g}}ya(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,o,h){const g=this.ma;this.ma=e.ma,this.mutatedKeys=e.mutatedKeys;const _=e.pa.j_();_.sort((G,ne)=>function(Q,de){const Se=De=>{switch(De){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Xn()}};return Se(Q)-Se(de)}(G.type,ne.type)||this.Va(G.doc,ne.doc)),this.wa(o),h=h!=null&&h;const u=t&&!h?this.Sa():[],R=this.Ra.size===0&&this.current&&!h?1:0,O=R!==this.Aa;return this.Aa=R,_.length!==0||O?{snapshot:new Yf(this.query,e.ma,g,_,e.mutatedKeys,R===0,O,!1,!!o&&o.resumeToken.approximateByteSize()>0),ba:u}:{ba:u}}ea(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({ma:this.ma,pa:new u1,mutatedKeys:this.mutatedKeys,ss:!1},!1)):{ba:[]}}Da(e){return!this.Ea.has(e)&&!!this.ma.has(e)&&!this.ma.get(e).hasLocalMutations}wa(e){e&&(e.addedDocuments.forEach(t=>this.Ea=this.Ea.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ea=this.Ea.delete(t)),this.current=e.current)}Sa(){if(!this.current)return[];const e=this.Ra;this.Ra=ki(),this.ma.forEach(o=>{this.Da(o.key)&&(this.Ra=this.Ra.add(o.key))});const t=[];return e.forEach(o=>{this.Ra.has(o)||t.push(new CS(o))}),this.Ra.forEach(o=>{e.has(o)||t.push(new PS(o))}),t}va(e){this.Ea=e.Es,this.Ra=ki();const t=this.ga(e.documents);return this.applyChanges(t,!0)}Ca(){return Yf.fromInitialDocuments(this.query,this.ma,this.mutatedKeys,this.Aa===0,this.hasCachedResults)}}class mL{constructor(e,t,o){this.query=e,this.targetId=t,this.view=o}}class gL{constructor(e){this.key=e,this.Fa=!1}}class _L{constructor(e,t,o,h,g,_){this.localStore=e,this.remoteStore=t,this.eventManager=o,this.sharedClientState=h,this.currentUser=g,this.maxConcurrentLimboResolutions=_,this.Ma={},this.xa=new Up(u=>Z2(u),$y),this.Oa=new Map,this.Na=new Set,this.Ba=new lo(zn.comparator),this.La=new Map,this.ka=new _x,this.qa={},this.Qa=new Map,this.Ka=Xf.Qn(),this.onlineState="Unknown",this.$a=void 0}get isPrimaryClient(){return this.$a===!0}}async function yL(i,e,t=!0){const o=DS(i);let h;const g=o.xa.get(e);return g?(o.sharedClientState.addLocalQueryTarget(g.targetId),h=g.view.Ca()):h=await AS(o,e,t,!0),h}async function vL(i,e){const t=DS(i);await AS(t,e,!0,!1)}async function AS(i,e,t,o){const h=await FR(i.localStore,rh(e)),g=h.targetId,_=i.sharedClientState.addLocalQueryTarget(g,t);let u;return o&&(u=await xL(i,e,g,_==="current",h.resumeToken)),i.isPrimaryClient&&t&&wS(i.remoteStore,h),u}async function xL(i,e,t,o,h){i.Ua=(ne,re,Q)=>async function(Se,De,Ke,et){let vt=De.view.ga(Ke);vt.ss&&(vt=await o1(Se.localStore,De.query,!1).then(({documents:be})=>De.view.ga(be,vt)));const Ye=et&&et.targetChanges.get(De.targetId),it=et&&et.targetMismatches.get(De.targetId)!=null,at=De.view.applyChanges(vt,Se.isPrimaryClient,Ye,it);return p1(Se,De.targetId,at.ba),at.snapshot}(i,ne,re,Q);const g=await o1(i.localStore,e,!0),_=new fL(e,g.Es),u=_.ga(g.documents),R=Fg.createSynthesizedTargetChangeForCurrentChange(t,o&&i.onlineState!=="Offline",h),O=_.applyChanges(u,i.isPrimaryClient,R);p1(i,t,O.ba);const G=new mL(e,t,_);return i.xa.set(e,G),i.Oa.has(t)?i.Oa.get(t).push(e):i.Oa.set(t,[e]),O.snapshot}async function wL(i,e,t){const o=ii(i),h=o.xa.get(e),g=o.Oa.get(h.targetId);if(g.length>1)return o.Oa.set(h.targetId,g.filter(_=>!$y(_,e))),void o.xa.delete(e);o.isPrimaryClient?(o.sharedClientState.removeLocalQueryTarget(h.targetId),o.sharedClientState.isActiveQueryTarget(h.targetId)||await R0(o.localStore,h.targetId,!1).then(()=>{o.sharedClientState.clearQueryState(h.targetId),t&&xx(o.remoteStore,h.targetId),D0(o,h.targetId)}).catch(sm)):(D0(o,h.targetId),await R0(o.localStore,h.targetId,!0))}async function bL(i,e){const t=ii(i),o=t.xa.get(e),h=t.Oa.get(o.targetId);t.isPrimaryClient&&h.length===1&&(t.sharedClientState.removeLocalQueryTarget(o.targetId),xx(t.remoteStore,o.targetId))}async function TL(i,e,t){const o=kL(i);try{const h=await function(_,u){const R=ii(_),O=xs.now(),G=u.reduce((Q,de)=>Q.add(de.key),ki());let ne,re;return R.persistence.runTransaction("Locally write mutations","readwrite",Q=>{let de=Jh(),Se=ki();return R.hs.getEntries(Q,G).next(De=>{de=De,de.forEach((Ke,et)=>{et.isValidDocument()||(Se=Se.add(Ke))})}).next(()=>R.localDocuments.getOverlayedDocuments(Q,de)).next(De=>{ne=De;const Ke=[];for(const et of u){const vt=BM(et,ne.get(et.key).overlayedDocument);vt!=null&&Ke.push(new jp(et.key,vt,F2(vt.value.mapValue),Zh.exists(!0)))}return R.mutationQueue.addMutationBatch(Q,O,Ke,u)}).next(De=>{re=De;const Ke=De.applyToLocalDocumentSet(ne,Se);return R.documentOverlayCache.saveOverlays(Q,De.batchId,Ke)})}).then(()=>({batchId:re.batchId,changes:X2(ne)}))}(o.localStore,e);o.sharedClientState.addPendingMutation(h.batchId),function(_,u,R){let O=_.qa[_.currentUser.toKey()];O||(O=new lo(Vi)),O=O.insert(u,R),_.qa[_.currentUser.toKey()]=O}(o,h.batchId,t),await Vg(o,h.changes),await Xy(o.remoteStore)}catch(h){const g=Ex(h,"Failed to persist write");t.reject(g)}}async function kS(i,e){const t=ii(i);try{const o=await zR(t.localStore,e);e.targetChanges.forEach((h,g)=>{const _=t.La.get(g);_&&(fr(h.addedDocuments.size+h.modifiedDocuments.size+h.removedDocuments.size<=1),h.addedDocuments.size>0?_.Fa=!0:h.modifiedDocuments.size>0?fr(_.Fa):h.removedDocuments.size>0&&(fr(_.Fa),_.Fa=!1))}),await Vg(t,o,e)}catch(o){await sm(o)}}function d1(i,e,t){const o=ii(i);if(o.isPrimaryClient&&t===0||!o.isPrimaryClient&&t===1){const h=[];o.xa.forEach((g,_)=>{const u=_.view.ea(e);u.snapshot&&h.push(u.snapshot)}),function(_,u){const R=ii(_);R.onlineState=u;let O=!1;R.queries.forEach((G,ne)=>{for(const re of ne.J_)re.ea(u)&&(O=!0)}),O&&Ix(R)}(o.eventManager,e),h.length&&o.Ma.R_(h),o.onlineState=e,o.isPrimaryClient&&o.sharedClientState.setOnlineState(e)}}async function SL(i,e,t){const o=ii(i);o.sharedClientState.updateQueryState(e,"rejected",t);const h=o.La.get(e),g=h&&h.key;if(g){let _=new lo(zn.comparator);_=_.insert(g,ja.newNoDocument(g,ni.min()));const u=ki().add(g),R=new Zy(ni.min(),new Map,new lo(Vi),_,u);await kS(o,R),o.Ba=o.Ba.remove(g),o.La.delete(e),Px(o)}else await R0(o.localStore,e,!1).then(()=>D0(o,e,t)).catch(sm)}async function EL(i,e){const t=ii(i),o=e.batch.batchId;try{const h=await DR(t.localStore,e);RS(t,o,null),MS(t,o),t.sharedClientState.updateMutationState(o,"acknowledged"),await Vg(t,h)}catch(h){await sm(h)}}async function IL(i,e,t){const o=ii(i);try{const h=await function(_,u){const R=ii(_);return R.persistence.runTransaction("Reject batch","readwrite-primary",O=>{let G;return R.mutationQueue.lookupMutationBatch(O,u).next(ne=>(fr(ne!==null),G=ne.keys(),R.mutationQueue.removeMutationBatch(O,ne))).next(()=>R.mutationQueue.performConsistencyCheck(O)).next(()=>R.documentOverlayCache.removeOverlaysForBatchId(O,G,u)).next(()=>R.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(O,G)).next(()=>R.localDocuments.getDocuments(O,G))})}(o.localStore,e);RS(o,e,t),MS(o,e),o.sharedClientState.updateMutationState(e,"rejected",t),await Vg(o,h)}catch(h){await sm(h)}}function MS(i,e){(i.Qa.get(e)||[]).forEach(t=>{t.resolve()}),i.Qa.delete(e)}function RS(i,e,t){const o=ii(i);let h=o.qa[o.currentUser.toKey()];if(h){const g=h.get(e);g&&(t?g.reject(t):g.resolve(),h=h.remove(e)),o.qa[o.currentUser.toKey()]=h}}function D0(i,e,t=null){i.sharedClientState.removeLocalQueryTarget(e);for(const o of i.Oa.get(e))i.xa.delete(o),t&&i.Ma.Wa(o,t);i.Oa.delete(e),i.isPrimaryClient&&i.ka.yr(e).forEach(o=>{i.ka.containsKey(o)||LS(i,o)})}function LS(i,e){i.Na.delete(e.path.canonicalString());const t=i.Ba.get(e);t!==null&&(xx(i.remoteStore,t),i.Ba=i.Ba.remove(e),i.La.delete(t),Px(i))}function p1(i,e,t){for(const o of t)o instanceof PS?(i.ka.addReference(o.key,e),PL(i,o)):o instanceof CS?(fn("SyncEngine","Document no longer in limbo: "+o.key),i.ka.removeReference(o.key,e),i.ka.containsKey(o.key)||LS(i,o.key)):Xn()}function PL(i,e){const t=e.key,o=t.path.canonicalString();i.Ba.get(t)||i.Na.has(o)||(fn("SyncEngine","New document in limbo: "+t),i.Na.add(o),Px(i))}function Px(i){for(;i.Na.size>0&&i.Ba.size<i.maxConcurrentLimboResolutions;){const e=i.Na.values().next().value;i.Na.delete(e);const t=new zn($r.fromString(e)),o=i.Ka.next();i.La.set(o,new gL(t)),i.Ba=i.Ba.insert(t,o),wS(i.remoteStore,new Md(rh(q2(t.path)),o,"TargetPurposeLimboResolution",Vy.oe))}}async function Vg(i,e,t){const o=ii(i),h=[],g=[],_=[];o.xa.isEmpty()||(o.xa.forEach((u,R)=>{_.push(o.Ua(R,e,t).then(O=>{var G;if((O||t)&&o.isPrimaryClient){const ne=O?!O.fromCache:(G=t?.targetChanges.get(R.targetId))===null||G===void 0?void 0:G.current;o.sharedClientState.updateQueryState(R.targetId,ne?"current":"not-current")}if(O){h.push(O);const ne=vx.zi(R.targetId,O);g.push(ne)}}))}),await Promise.all(_),o.Ma.R_(h),await async function(R,O){const G=ii(R);try{await G.persistence.runTransaction("notifyLocalViewChanges","readwrite",ne=>Mt.forEach(O,re=>Mt.forEach(re.Wi,Q=>G.persistence.referenceDelegate.addReference(ne,re.targetId,Q)).next(()=>Mt.forEach(re.Gi,Q=>G.persistence.referenceDelegate.removeReference(ne,re.targetId,Q)))))}catch(ne){if(!am(ne))throw ne;fn("LocalStore","Failed to update sequence numbers: "+ne)}for(const ne of O){const re=ne.targetId;if(!ne.fromCache){const Q=G.us.get(re),de=Q.snapshotVersion,Se=Q.withLastLimboFreeSnapshotVersion(de);G.us=G.us.insert(re,Se)}}}(o.localStore,g))}async function CL(i,e){const t=ii(i);if(!t.currentUser.isEqual(e)){fn("SyncEngine","User change. New user:",e.toKey());const o=await _S(t.localStore,e);t.currentUser=e,function(g,_){g.Qa.forEach(u=>{u.forEach(R=>{R.reject(new vn(Rt.CANCELLED,_))})}),g.Qa.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,o.removedBatchIds,o.addedBatchIds),await Vg(t,o.Ts)}}function AL(i,e){const t=ii(i),o=t.La.get(e);if(o&&o.Fa)return ki().add(o.key);{let h=ki();const g=t.Oa.get(e);if(!g)return h;for(const _ of g){const u=t.xa.get(_);h=h.unionWith(u.view.fa)}return h}}function DS(i){const e=ii(i);return e.remoteStore.remoteSyncer.applyRemoteEvent=kS.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=AL.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=SL.bind(null,e),e.Ma.R_=hL.bind(null,e.eventManager),e.Ma.Wa=dL.bind(null,e.eventManager),e}function kL(i){const e=ii(i);return e.remoteStore.remoteSyncer.applySuccessfulWrite=EL.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=IL.bind(null,e),e}class my{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Wy(e.databaseInfo.databaseId),this.sharedClientState=this.za(e),this.persistence=this.ja(e),await this.persistence.start(),this.localStore=this.Ha(e),this.gcScheduler=this.Ja(e,this.localStore),this.indexBackfillerScheduler=this.Ya(e,this.localStore)}Ja(e,t){return null}Ya(e,t){return null}Ha(e){return LR(this.persistence,new MR,e.initialUser,this.serializer)}ja(e){return new gS(yx.ei,this.serializer)}za(e){return new VR}async terminate(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}my.provider={build:()=>new my};class ML extends my{constructor(e){super(),this.cacheSizeBytes=e}Ja(e,t){fr(this.persistence.referenceDelegate instanceof py);const o=this.persistence.referenceDelegate.garbageCollector;return new gR(o,e.asyncQueue,t)}ja(e){const t=this.cacheSizeBytes!==void 0?zl.withCacheSize(this.cacheSizeBytes):zl.DEFAULT;return new gS(o=>py.ei(o,t),this.serializer)}}class z0{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=o=>d1(this.syncEngine,o,1),this.remoteStore.remoteSyncer.handleCredentialChange=CL.bind(null,this.syncEngine),await sL(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new lL}()}createDatastore(e){const t=Wy(e.databaseInfo.databaseId),o=function(g){return new HR(g)}(e.databaseInfo);return function(g,_,u,R){return new ZR(g,_,u,R)}(e.authCredentials,e.appCheckCredentials,o,t)}createRemoteStore(e){return function(o,h,g,_,u){return new KR(o,h,g,_,u)}(this.localStore,this.datastore,e.asyncQueue,t=>d1(this.syncEngine,t,0),function(){return a1.p()?new a1:new UR}())}createSyncEngine(e,t){return function(h,g,_,u,R,O,G){const ne=new _L(h,g,_,u,R,O);return G&&(ne.$a=!0),ne}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(h){const g=ii(h);fn("RemoteStore","RemoteStore shutting down."),g.k_.add(5),await Bg(g),g.Q_.shutdown(),g.K_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(t=this.eventManager)===null||t===void 0||t.terminate()}}z0.provider={build:()=>new z0};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RL{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Xa(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Xa(this.observer.error,e):Qh("Uncaught Error in snapshot listener:",e.toString()))}eu(){this.muted=!0}Xa(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LL{constructor(e,t,o,h,g){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=o,this.databaseInfo=h,this.user=Ua.UNAUTHENTICATED,this.clientId=z2.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=g,this.authCredentials.start(o,async _=>{fn("FirestoreClient","Received user=",_.uid),await this.authCredentialListener(_),this.user=_}),this.appCheckCredentials.start(o,_=>(fn("FirestoreClient","Received new app check token=",_),this.appCheckCredentialListener(_,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Nd;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const o=Ex(t,"Failed to shutdown persistence");e.reject(o)}}),e.promise}}async function Qv(i,e){i.asyncQueue.verifyOperationInProgress(),fn("FirestoreClient","Initializing OfflineComponentProvider");const t=i.configuration;await e.initialize(t);let o=t.initialUser;i.setCredentialChangeListener(async h=>{o.isEqual(h)||(await _S(e.localStore,h),o=h)}),e.persistence.setDatabaseDeletedListener(()=>i.terminate()),i._offlineComponents=e}async function f1(i,e){i.asyncQueue.verifyOperationInProgress();const t=await DL(i);fn("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(t,i.configuration),i.setCredentialChangeListener(o=>l1(e.remoteStore,o)),i.setAppCheckTokenChangeListener((o,h)=>l1(e.remoteStore,h)),i._onlineComponents=e}async function DL(i){if(!i._offlineComponents)if(i._uninitializedComponentsProvider){fn("FirestoreClient","Using user provided OfflineComponentProvider");try{await Qv(i,i._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(h){return h.name==="FirebaseError"?h.code===Rt.FAILED_PRECONDITION||h.code===Rt.UNIMPLEMENTED:!(typeof DOMException<"u"&&h instanceof DOMException)||h.code===22||h.code===20||h.code===11}(t))throw t;Gf("Error using user provided cache. Falling back to memory cache: "+t),await Qv(i,new my)}}else fn("FirestoreClient","Using default OfflineComponentProvider"),await Qv(i,new ML(void 0));return i._offlineComponents}async function zS(i){return i._onlineComponents||(i._uninitializedComponentsProvider?(fn("FirestoreClient","Using user provided OnlineComponentProvider"),await f1(i,i._uninitializedComponentsProvider._online)):(fn("FirestoreClient","Using default OnlineComponentProvider"),await f1(i,new z0))),i._onlineComponents}function zL(i){return zS(i).then(e=>e.syncEngine)}async function NL(i){const e=await zS(i),t=e.eventManager;return t.onListen=yL.bind(null,e.syncEngine),t.onUnlisten=wL.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=vL.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=bL.bind(null,e.syncEngine),t}function OL(i,e,t={}){const o=new Nd;return i.asyncQueue.enqueueAndForget(async()=>function(g,_,u,R,O){const G=new RL({next:re=>{G.eu(),_.enqueueAndForget(()=>cL(g,ne)),re.fromCache&&R.source==="server"?O.reject(new vn(Rt.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):O.resolve(re)},error:re=>O.reject(re)}),ne=new pL(u,G,{includeMetadataChanges:!0,ua:!0});return uL(g,ne)}(await NL(i),i.asyncQueue,e,t,o)),o.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function NS(i){const e={};return i.timeoutSeconds!==void 0&&(e.timeoutSeconds=i.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const m1=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function OS(i,e,t){if(!t)throw new vn(Rt.INVALID_ARGUMENT,`Function ${i}() cannot be called with an empty ${e}.`)}function FL(i,e,t,o){if(e===!0&&o===!0)throw new vn(Rt.INVALID_ARGUMENT,`${i} and ${t} cannot be used together.`)}function g1(i){if(!zn.isDocumentKey(i))throw new vn(Rt.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${i} has ${i.length}.`)}function _1(i){if(zn.isDocumentKey(i))throw new vn(Rt.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${i} has ${i.length}.`)}function Yy(i){if(i===void 0)return"undefined";if(i===null)return"null";if(typeof i=="string")return i.length>20&&(i=`${i.substring(0,20)}...`),JSON.stringify(i);if(typeof i=="number"||typeof i=="boolean")return""+i;if(typeof i=="object"){if(i instanceof Array)return"an array";{const e=function(o){return o.constructor?o.constructor.name:null}(i);return e?`a custom ${e} object`:"an object"}}return typeof i=="function"?"a function":Xn()}function gy(i,e){if("_delegate"in i&&(i=i._delegate),!(i instanceof e)){if(e.name===i.constructor.name)throw new vn(Rt.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Yy(i);throw new vn(Rt.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return i}function BL(i,e){if(e<=0)throw new vn(Rt.INVALID_ARGUMENT,`Function ${i}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class y1{constructor(e){var t,o;if(e.host===void 0){if(e.ssl!==void 0)throw new vn(Rt.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new vn(Rt.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}FL("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=NS((o=e.experimentalLongPollingOptions)!==null&&o!==void 0?o:{}),function(g){if(g.timeoutSeconds!==void 0){if(isNaN(g.timeoutSeconds))throw new vn(Rt.INVALID_ARGUMENT,`invalid long polling timeout: ${g.timeoutSeconds} (must not be NaN)`);if(g.timeoutSeconds<5)throw new vn(Rt.INVALID_ARGUMENT,`invalid long polling timeout: ${g.timeoutSeconds} (minimum allowed value is 5)`);if(g.timeoutSeconds>30)throw new vn(Rt.INVALID_ARGUMENT,`invalid long polling timeout: ${g.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(o,h){return o.timeoutSeconds===h.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Qy{constructor(e,t,o,h){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=o,this._app=h,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new y1({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new vn(Rt.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new vn(Rt.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new y1(e),e.credentials!==void 0&&(this._authCredentials=function(o){if(!o)return new qk;switch(o.type){case"firstParty":return new Kk(o.sessionIndex||"0",o.iamToken||null,o.authTokenFactory||null);case"provider":return o.client;default:throw new vn(Rt.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const o=m1.get(t);o&&(fn("ComponentProvider","Removing Datastore"),m1.delete(t),o.terminate())}(this),Promise.resolve()}}function VL(i,e,t,o={}){var h;const g=(i=gy(i,Qy))._getSettings(),_=`${e}:${t}`;if(g.host!=="firestore.googleapis.com"&&g.host!==_&&Gf("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),i._setSettings(Object.assign(Object.assign({},g),{host:_,ssl:!1})),o.mockUserToken){let u,R;if(typeof o.mockUserToken=="string")u=o.mockUserToken,R=Ua.MOCK_USER;else{u=yA(o.mockUserToken,(h=i._app)===null||h===void 0?void 0:h.options.projectId);const O=o.mockUserToken.sub||o.mockUserToken.user_id;if(!O)throw new vn(Rt.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");R=new Ua(O)}i._authCredentials=new Gk(new D2(u,R))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $d{constructor(e,t,o){this.converter=t,this._query=o,this.type="query",this.firestore=e}withConverter(e){return new $d(this.firestore,e,this._query)}}class Uu{constructor(e,t,o){this.converter=t,this._key=o,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Od(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Uu(this.firestore,e,this._key)}}class Od extends $d{constructor(e,t,o){super(e,t,q2(o)),this._path=o,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Uu(this.firestore,null,new zn(e))}withConverter(e){return new Od(this.firestore,e,this._path)}}function Wm(i,e,...t){if(i=Ol(i),OS("collection","path",e),i instanceof Qy){const o=$r.fromString(e,...t);return _1(o),new Od(i,null,o)}{if(!(i instanceof Uu||i instanceof Od))throw new vn(Rt.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const o=i._path.child($r.fromString(e,...t));return _1(o),new Od(i.firestore,null,o)}}function UL(i,e,...t){if(i=Ol(i),arguments.length===1&&(e=z2.newId()),OS("doc","path",e),i instanceof Qy){const o=$r.fromString(e,...t);return g1(o),new Uu(i,null,new zn(o))}{if(!(i instanceof Uu||i instanceof Od))throw new vn(Rt.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const o=i._path.child($r.fromString(e,...t));return g1(o),new Uu(i.firestore,i instanceof Od?i.converter:null,new zn(o))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v1{constructor(e=Promise.resolve()){this.Iu=[],this.du=!1,this.Eu=[],this.Au=null,this.Ru=!1,this.Vu=!1,this.mu=[],this.r_=new vS(this,"async_queue_retry"),this.fu=()=>{const o=Yv();o&&fn("AsyncQueue","Visibility state changed to "+o.visibilityState),this.r_.Jo()},this.gu=e;const t=Yv();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.fu)}get isShuttingDown(){return this.du}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.pu(),this.yu(e)}enterRestrictedMode(e){if(!this.du){this.du=!0,this.Vu=e||!1;const t=Yv();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.fu)}}enqueue(e){if(this.pu(),this.du)return new Promise(()=>{});const t=new Nd;return this.yu(()=>this.du&&this.Vu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Iu.push(e),this.wu()))}async wu(){if(this.Iu.length!==0){try{await this.Iu[0](),this.Iu.shift(),this.r_.reset()}catch(e){if(!am(e))throw e;fn("AsyncQueue","Operation failed with retryable error: "+e)}this.Iu.length>0&&this.r_.jo(()=>this.wu())}}yu(e){const t=this.gu.then(()=>(this.Ru=!0,e().catch(o=>{this.Au=o,this.Ru=!1;const h=function(_){let u=_.message||"";return _.stack&&(u=_.stack.includes(_.message)?_.stack:_.message+`
`+_.stack),u}(o);throw Qh("INTERNAL UNHANDLED ERROR: ",h),o}).then(o=>(this.Ru=!1,o))));return this.gu=t,t}enqueueAfterDelay(e,t,o){this.pu(),this.mu.indexOf(e)>-1&&(t=0);const h=Sx.createAndSchedule(this,e,t,o,g=>this.Su(g));return this.Eu.push(h),h}pu(){this.Au&&Xn()}verifyOperationInProgress(){}async bu(){let e;do e=this.gu,await e;while(e!==this.gu)}Du(e){for(const t of this.Eu)if(t.timerId===e)return!0;return!1}vu(e){return this.bu().then(()=>{this.Eu.sort((t,o)=>t.targetTimeMs-o.targetTimeMs);for(const t of this.Eu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.bu()})}Cu(e){this.mu.push(e)}Su(e){const t=this.Eu.indexOf(e);this.Eu.splice(t,1)}}class Cx extends Qy{constructor(e,t,o,h){super(e,t,o,h),this.type="firestore",this._queue=new v1,this._persistenceKey=h?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new v1(e),this._firestoreClient=void 0,await e}}}function jL(i,e){const t=typeof i=="object"?i:ax(),o=typeof i=="string"?i:"(default)",h=Bp(t,"firestore").getImmediate({identifier:o});if(!h._initialized){const g=gA("firestore");g&&VL(h,...g)}return h}function FS(i){if(i._terminated)throw new vn(Rt.FAILED_PRECONDITION,"The client has already been terminated.");return i._firestoreClient||$L(i),i._firestoreClient}function $L(i){var e,t,o;const h=i._freezeSettings(),g=function(u,R,O,G){return new cM(u,R,O,G.host,G.ssl,G.experimentalForceLongPolling,G.experimentalAutoDetectLongPolling,NS(G.experimentalLongPollingOptions),G.useFetchStreams)}(i._databaseId,((e=i._app)===null||e===void 0?void 0:e.options.appId)||"",i._persistenceKey,h);i._componentsProvider||!((t=h.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((o=h.localCache)===null||o===void 0)&&o._onlineComponentProvider)&&(i._componentsProvider={_offline:h.localCache._offlineComponentProvider,_online:h.localCache._onlineComponentProvider}),i._firestoreClient=new LL(i._authCredentials,i._appCheckCredentials,i._queue,g,i._componentsProvider&&function(u){const R=u?._online.build();return{_offline:u?._offline.build(R),_online:R}}(i._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qf{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Qf(ga.fromBase64String(e))}catch(t){throw new vn(Rt.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Qf(ga.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ax{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new vn(Rt.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ma(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kx{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mx{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new vn(Rt.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new vn(Rt.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Vi(this._lat,e._lat)||Vi(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rx{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(o,h){if(o.length!==h.length)return!1;for(let g=0;g<o.length;++g)if(o[g]!==h[g])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HL=/^__.*__$/;class qL{constructor(e,t,o){this.data=e,this.fieldMask=t,this.fieldTransforms=o}toMutation(e,t){return this.fieldMask!==null?new jp(e,this.data,this.fieldMask,t,this.fieldTransforms):new Og(e,this.data,t,this.fieldTransforms)}}function BS(i){switch(i){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Xn()}}class Lx{constructor(e,t,o,h,g,_){this.settings=e,this.databaseId=t,this.serializer=o,this.ignoreUndefinedProperties=h,g===void 0&&this.Fu(),this.fieldTransforms=g||[],this.fieldMask=_||[]}get path(){return this.settings.path}get Mu(){return this.settings.Mu}xu(e){return new Lx(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Ou(e){var t;const o=(t=this.path)===null||t===void 0?void 0:t.child(e),h=this.xu({path:o,Nu:!1});return h.Bu(e),h}Lu(e){var t;const o=(t=this.path)===null||t===void 0?void 0:t.child(e),h=this.xu({path:o,Nu:!1});return h.Fu(),h}ku(e){return this.xu({path:void 0,Nu:!0})}qu(e){return _y(e,this.settings.methodName,this.settings.Qu||!1,this.path,this.settings.Ku)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}Fu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Bu(this.path.get(e))}Bu(e){if(e.length===0)throw this.qu("Document fields must not be empty");if(BS(this.Mu)&&HL.test(e))throw this.qu('Document fields cannot begin and end with "__"')}}class GL{constructor(e,t,o){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=o||Wy(e)}$u(e,t,o,h=!1){return new Lx({Mu:e,methodName:t,Ku:o,path:ma.emptyPath(),Nu:!1,Qu:h},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function VS(i){const e=i._freezeSettings(),t=Wy(i._databaseId);return new GL(i._databaseId,!!e.ignoreUndefinedProperties,t)}function ZL(i,e,t,o,h,g={}){const _=i.$u(g.merge||g.mergeFields?2:0,e,t,h);$S("Data must be an object, but it was:",_,o);const u=US(o,_);let R,O;if(g.merge)R=new wc(_.fieldMask),O=_.fieldTransforms;else if(g.mergeFields){const G=[];for(const ne of g.mergeFields){const re=KL(e,ne,t);if(!_.contains(re))throw new vn(Rt.INVALID_ARGUMENT,`Field '${re}' is specified in your field mask but missing from your input data.`);YL(G,re)||G.push(re)}R=new wc(G),O=_.fieldTransforms.filter(ne=>R.covers(ne.field))}else R=null,O=_.fieldTransforms;return new qL(new Fu(u),R,O)}class Dx extends kx{_toFieldTransform(e){return new zM(e.path,new bg)}isEqual(e){return e instanceof Dx}}function WL(i,e,t,o=!1){return zx(t,i.$u(o?4:3,e))}function zx(i,e){if(jS(i=Ol(i)))return $S("Unsupported field value:",e,i),US(i,e);if(i instanceof kx)return function(o,h){if(!BS(h.Mu))throw h.qu(`${o._methodName}() can only be used with update() and set()`);if(!h.path)throw h.qu(`${o._methodName}() is not currently supported inside arrays`);const g=o._toFieldTransform(h);g&&h.fieldTransforms.push(g)}(i,e),null;if(i===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),i instanceof Array){if(e.settings.Nu&&e.Mu!==4)throw e.qu("Nested arrays are not supported");return function(o,h){const g=[];let _=0;for(const u of o){let R=zx(u,h.ku(_));R==null&&(R={nullValue:"NULL_VALUE"}),g.push(R),_++}return{arrayValue:{values:g}}}(i,e)}return function(o,h){if((o=Ol(o))===null)return{nullValue:"NULL_VALUE"};if(typeof o=="number")return RM(h.serializer,o);if(typeof o=="boolean")return{booleanValue:o};if(typeof o=="string")return{stringValue:o};if(o instanceof Date){const g=xs.fromDate(o);return{timestampValue:dy(h.serializer,g)}}if(o instanceof xs){const g=new xs(o.seconds,1e3*Math.floor(o.nanoseconds/1e3));return{timestampValue:dy(h.serializer,g)}}if(o instanceof Mx)return{geoPointValue:{latitude:o.latitude,longitude:o.longitude}};if(o instanceof Qf)return{bytesValue:uS(h.serializer,o._byteString)};if(o instanceof Uu){const g=h.databaseId,_=o.firestore._databaseId;if(!_.isEqual(g))throw h.qu(`Document reference is for database ${_.projectId}/${_.database} but should be for database ${g.projectId}/${g.database}`);return{referenceValue:gx(o.firestore._databaseId||h.databaseId,o._key.path)}}if(o instanceof Rx)return function(_,u){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:_.toArray().map(R=>{if(typeof R!="number")throw u.qu("VectorValues must only contain numeric values.");return px(u.serializer,R)})}}}}}}(o,h);throw h.qu(`Unsupported field value: ${Yy(o)}`)}(i,e)}function US(i,e){const t={};return N2(i)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Vp(i,(o,h)=>{const g=zx(h,e.Ou(o));g!=null&&(t[o]=g)}),{mapValue:{fields:t}}}function jS(i){return!(typeof i!="object"||i===null||i instanceof Array||i instanceof Date||i instanceof xs||i instanceof Mx||i instanceof Qf||i instanceof Uu||i instanceof kx||i instanceof Rx)}function $S(i,e,t){if(!jS(t)||!function(h){return typeof h=="object"&&h!==null&&(Object.getPrototypeOf(h)===Object.prototype||Object.getPrototypeOf(h)===null)}(t)){const o=Yy(t);throw o==="an object"?e.qu(i+" a custom object"):e.qu(i+" "+o)}}function KL(i,e,t){if((e=Ol(e))instanceof Ax)return e._internalPath;if(typeof e=="string")return HS(i,e);throw _y("Field path arguments must be of type string or ",i,!1,void 0,t)}const XL=new RegExp("[~\\*/\\[\\]]");function HS(i,e,t){if(e.search(XL)>=0)throw _y(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,i,!1,void 0,t);try{return new Ax(...e.split("."))._internalPath}catch{throw _y(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,i,!1,void 0,t)}}function _y(i,e,t,o,h){const g=o&&!o.isEmpty(),_=h!==void 0;let u=`Function ${e}() called with invalid data`;t&&(u+=" (via `toFirestore()`)"),u+=". ";let R="";return(g||_)&&(R+=" (found",g&&(R+=` in field ${o}`),_&&(R+=` in document ${h}`),R+=")"),new vn(Rt.INVALID_ARGUMENT,u+i+R)}function YL(i,e){return i.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qS{constructor(e,t,o,h,g){this._firestore=e,this._userDataWriter=t,this._key=o,this._document=h,this._converter=g}get id(){return this._key.path.lastSegment()}get ref(){return new Uu(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new QL(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Nx("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class QL extends qS{data(){return super.data()}}function Nx(i,e){return typeof e=="string"?HS(i,e):e instanceof Ax?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function JL(i){if(i.limitType==="L"&&i.explicitOrderBy.length===0)throw new vn(Rt.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Ox{}class Fx extends Ox{}function M_(i,e,...t){let o=[];e instanceof Ox&&o.push(e),o=o.concat(t),function(g){const _=g.filter(R=>R instanceof Vx).length,u=g.filter(R=>R instanceof Bx).length;if(_>1||_>0&&u>0)throw new vn(Rt.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(o);for(const h of o)i=h._apply(i);return i}class Bx extends Fx{constructor(e,t,o){super(),this._field=e,this._op=t,this._value=o,this.type="where"}static _create(e,t,o){return new Bx(e,t,o)}_apply(e){const t=this._parse(e);return GS(e._query,t),new $d(e.firestore,e.converter,P0(e._query,t))}_parse(e){const t=VS(e.firestore);return function(g,_,u,R,O,G,ne){let re;if(O.isKeyField()){if(G==="array-contains"||G==="array-contains-any")throw new vn(Rt.INVALID_ARGUMENT,`Invalid Query. You can't perform '${G}' queries on documentId().`);if(G==="in"||G==="not-in"){w1(ne,G);const Q=[];for(const de of ne)Q.push(x1(R,g,de));re={arrayValue:{values:Q}}}else re=x1(R,g,ne)}else G!=="in"&&G!=="not-in"&&G!=="array-contains-any"||w1(ne,G),re=WL(u,_,ne,G==="in"||G==="not-in");return Yo.create(O,G,re)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}class Vx extends Ox{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Vx(e,t)}_parse(e){const t=this._queryConstraints.map(o=>o._parse(e)).filter(o=>o.getFilters().length>0);return t.length===1?t[0]:Ec.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:(function(h,g){let _=h;const u=g.getFlattenedFilters();for(const R of u)GS(_,R),_=P0(_,R)}(e._query,t),new $d(e.firestore,e.converter,P0(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class Ux extends Fx{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new Ux(e,t)}_apply(e){const t=function(h,g,_){if(h.startAt!==null)throw new vn(Rt.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(h.endAt!==null)throw new vn(Rt.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new wg(g,_)}(e._query,this._field,this._direction);return new $d(e.firestore,e.converter,function(h,g){const _=h.explicitOrderBy.concat([g]);return new lm(h.path,h.collectionGroup,_,h.filters.slice(),h.limit,h.limitType,h.startAt,h.endAt)}(e._query,t))}}function R_(i,e="asc"){const t=e,o=Nx("orderBy",i);return Ux._create(o,t)}class jx extends Fx{constructor(e,t,o){super(),this.type=e,this._limit=t,this._limitType=o}static _create(e,t,o){return new jx(e,t,o)}_apply(e){return new $d(e.firestore,e.converter,cy(e._query,this._limit,this._limitType))}}function eD(i){return BL("limit",i),jx._create("limit",i,"F")}function x1(i,e,t){if(typeof(t=Ol(t))=="string"){if(t==="")throw new vn(Rt.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!G2(e)&&t.indexOf("/")!==-1)throw new vn(Rt.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const o=e.path.child($r.fromString(t));if(!zn.isDocumentKey(o))throw new vn(Rt.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${o}' is not because it has an odd number of segments (${o.length}).`);return Ub(i,new zn(o))}if(t instanceof Uu)return Ub(i,t._key);throw new vn(Rt.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Yy(t)}.`)}function w1(i,e){if(!Array.isArray(i)||i.length===0)throw new vn(Rt.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function GS(i,e){const t=function(h,g){for(const _ of h)for(const u of _.getFlattenedFilters())if(g.indexOf(u.op)>=0)return u.op;return null}(i.filters,function(h){switch(h){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new vn(Rt.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new vn(Rt.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class tD{convertValue(e,t="none"){switch(Ud(e)){case 0:return null;case 1:return e.booleanValue;case 2:return zo(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Vd(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw Xn()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const o={};return Vp(e,(h,g)=>{o[h]=this.convertValue(g,t)}),o}convertVectorValue(e){var t,o,h;const g=(h=(o=(t=e.fields)===null||t===void 0?void 0:t.value.arrayValue)===null||o===void 0?void 0:o.values)===null||h===void 0?void 0:h.map(_=>zo(_.doubleValue));return new Rx(g)}convertGeoPoint(e){return new Mx(zo(e.latitude),zo(e.longitude))}convertArray(e,t){return(e.values||[]).map(o=>this.convertValue(o,t))}convertServerTimestamp(e,t){switch(t){case"previous":const o=jy(e);return o==null?null:this.convertValue(o,t);case"estimate":return this.convertTimestamp(yg(e));default:return null}}convertTimestamp(e){const t=Bd(e);return new xs(t.seconds,t.nanos)}convertDocumentKey(e,t){const o=$r.fromString(e);fr(mS(o));const h=new vg(o.get(1),o.get(3)),g=new zn(o.popFirst(5));return h.isEqual(t)||Qh(`Document ${g} contains a document reference within a different database (${h.projectId}/${h.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),g}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nD(i,e,t){let o;return o=i?i.toFirestore(e):e,o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class L_{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class iD extends qS{constructor(e,t,o,h,g,_){super(e,t,o,h,_),this._firestore=e,this._firestoreImpl=e,this.metadata=g}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new K_(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const o=this._document.data.field(Nx("DocumentSnapshot.get",e));if(o!==null)return this._userDataWriter.convertValue(o,t.serverTimestamps)}}}class K_ extends iD{data(e={}){return super.data(e)}}class rD{constructor(e,t,o,h){this._firestore=e,this._userDataWriter=t,this._snapshot=h,this.metadata=new L_(h.hasPendingWrites,h.fromCache),this.query=o}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(o=>{e.call(t,new K_(this._firestore,this._userDataWriter,o.key,o,new L_(this._snapshot.mutatedKeys.has(o.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new vn(Rt.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(h,g){if(h._snapshot.oldDocs.isEmpty()){let _=0;return h._snapshot.docChanges.map(u=>{const R=new K_(h._firestore,h._userDataWriter,u.doc.key,u.doc,new L_(h._snapshot.mutatedKeys.has(u.doc.key),h._snapshot.fromCache),h.query.converter);return u.doc,{type:"added",doc:R,oldIndex:-1,newIndex:_++}})}{let _=h._snapshot.oldDocs;return h._snapshot.docChanges.filter(u=>g||u.type!==3).map(u=>{const R=new K_(h._firestore,h._userDataWriter,u.doc.key,u.doc,new L_(h._snapshot.mutatedKeys.has(u.doc.key),h._snapshot.fromCache),h.query.converter);let O=-1,G=-1;return u.type!==0&&(O=_.indexOf(u.doc.key),_=_.delete(u.doc.key)),u.type!==1&&(_=_.add(u.doc),G=_.indexOf(u.doc.key)),{type:oD(u.type),doc:R,oldIndex:O,newIndex:G}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function oD(i){switch(i){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Xn()}}class sD extends tD{constructor(e){super(),this.firestore=e}convertBytes(e){return new Qf(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Uu(this.firestore,null,t)}}function D_(i){i=gy(i,$d);const e=gy(i.firestore,Cx),t=FS(e),o=new sD(e);return JL(i._query),OL(t,i._query).then(h=>new rD(e,o,i,h))}function aD(i,e){const t=gy(i.firestore,Cx),o=UL(i),h=nD(i.converter,e);return lD(t,[ZL(VS(i.firestore),"addDoc",o._key,h,i.converter!==null,{}).toMutation(o._key,Zh.exists(!1))]).then(()=>o)}function lD(i,e){return function(o,h){const g=new Nd;return o.asyncQueue.enqueueAndForget(async()=>TL(await zL(o),h,g)),g.promise}(FS(i),e)}function b1(){return new Dx("serverTimestamp")}(function(e,t=!0){(function(h){om=h})(rm),ph(new Sc("firestore",(o,{instanceIdentifier:h,options:g})=>{const _=o.getProvider("app").getImmediate(),u=new Cx(new Zk(o.getProvider("auth-internal")),new Yk(o.getProvider("app-check-internal")),function(O,G){if(!Object.prototype.hasOwnProperty.apply(O.options,["projectId"]))throw new vn(Rt.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new vg(O.options.projectId,G)}(_,h),_);return g=Object.assign({useFetchStreams:t},g),u._setSettings(g),u},"PUBLIC").setMultipleInstances(!0)),Vu(zb,"4.7.6",e),Vu(zb,"4.7.6","esm2017")})();function $x(i,e){var t={};for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&e.indexOf(o)<0&&(t[o]=i[o]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var h=0,o=Object.getOwnPropertySymbols(i);h<o.length;h++)e.indexOf(o[h])<0&&Object.prototype.propertyIsEnumerable.call(i,o[h])&&(t[o[h]]=i[o[h]]);return t}function ZS(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const uD=ZS,WS=new Fp("auth","Firebase",ZS());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yy=new By("@firebase/auth");function cD(i,...e){yy.logLevel<=Ai.WARN&&yy.warn(`Auth (${rm}): ${i}`,...e)}function X_(i,...e){yy.logLevel<=Ai.ERROR&&yy.error(`Auth (${rm}): ${i}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ed(i,...e){throw Hx(i,...e)}function sh(i,...e){return Hx(i,...e)}function KS(i,e,t){const o=Object.assign(Object.assign({},uD()),{[e]:t});return new Fp("auth","Firebase",o).create(e,{appName:i.name})}function Sp(i){return KS(i,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Hx(i,...e){if(typeof i!="string"){const t=e[0],o=[...e.slice(1)];return o[0]&&(o[0].appName=i.name),i._errorFactory.create(t,...o)}return WS.create(i,...e)}function Qn(i,e,...t){if(!i)throw Hx(e,...t)}function $h(i){const e="INTERNAL ASSERTION FAILED: "+i;throw X_(e),new Error(e)}function td(i,e){i||$h(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function N0(){var i;return typeof self<"u"&&((i=self.location)===null||i===void 0?void 0:i.href)||""}function hD(){return T1()==="http:"||T1()==="https:"}function T1(){var i;return typeof self<"u"&&((i=self.location)===null||i===void 0?void 0:i.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dD(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(hD()||v2()||"connection"in navigator)?navigator.onLine:!0}function pD(){if(typeof navigator>"u")return null;const i=navigator;return i.languages&&i.languages[0]||i.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ug{constructor(e,t){this.shortDelay=e,this.longDelay=t,td(t>e,"Short delay should be less than long delay!"),this.isMobile=vA()||bA()}get(){return dD()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qx(i,e){td(i.emulator,"Emulator should always be set here");const{url:t}=i.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XS{static initialize(e,t,o){this.fetchImpl=e,t&&(this.headersImpl=t),o&&(this.responseImpl=o)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;$h("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;$h("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;$h("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fD={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mD=new Ug(3e4,6e4);function Gx(i,e){return i.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:i.tenantId}):e}async function cm(i,e,t,o,h={}){return YS(i,h,async()=>{let g={},_={};o&&(e==="GET"?_=o:g={body:JSON.stringify(o)});const u=Ng(Object.assign({key:i.config.apiKey},_)).slice(1),R=await i._getAdditionalHeaders();R["Content-Type"]="application/json",i.languageCode&&(R["X-Firebase-Locale"]=i.languageCode);const O=Object.assign({method:e,headers:R},g);return wA()||(O.referrerPolicy="no-referrer"),XS.fetch()(QS(i,i.config.apiHost,t,u),O)})}async function YS(i,e,t){i._canInitEmulator=!1;const o=Object.assign(Object.assign({},fD),e);try{const h=new _D(i),g=await Promise.race([t(),h.promise]);h.clearNetworkTimeout();const _=await g.json();if("needConfirmation"in _)throw z_(i,"account-exists-with-different-credential",_);if(g.ok&&!("errorMessage"in _))return _;{const u=g.ok?_.errorMessage:_.error.message,[R,O]=u.split(" : ");if(R==="FEDERATED_USER_ID_ALREADY_LINKED")throw z_(i,"credential-already-in-use",_);if(R==="EMAIL_EXISTS")throw z_(i,"email-already-in-use",_);if(R==="USER_DISABLED")throw z_(i,"user-disabled",_);const G=o[R]||R.toLowerCase().replace(/[_\s]+/g,"-");if(O)throw KS(i,G,O);ed(i,G)}}catch(h){if(h instanceof Ic)throw h;ed(i,"network-request-failed",{message:String(h)})}}async function gD(i,e,t,o,h={}){const g=await cm(i,e,t,o,h);return"mfaPendingCredential"in g&&ed(i,"multi-factor-auth-required",{_serverResponse:g}),g}function QS(i,e,t,o){const h=`${e}${t}?${o}`;return i.config.emulator?qx(i.config,h):`${i.config.apiScheme}://${h}`}class _D{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,o)=>{this.timer=setTimeout(()=>o(sh(this.auth,"network-request-failed")),mD.get())})}}function z_(i,e,t){const o={appName:i.name};t.email&&(o.email=t.email),t.phoneNumber&&(o.phoneNumber=t.phoneNumber);const h=sh(i,e,o);return h.customData._tokenResponse=t,h}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function yD(i,e){return cm(i,"POST","/v1/accounts:delete",e)}async function JS(i,e){return cm(i,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cg(i){if(i)try{const e=new Date(Number(i));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function vD(i,e=!1){const t=Ol(i),o=await t.getIdToken(e),h=Zx(o);Qn(h&&h.exp&&h.auth_time&&h.iat,t.auth,"internal-error");const g=typeof h.firebase=="object"?h.firebase:void 0,_=g?.sign_in_provider;return{claims:h,token:o,authTime:cg(Jv(h.auth_time)),issuedAtTime:cg(Jv(h.iat)),expirationTime:cg(Jv(h.exp)),signInProvider:_||null,signInSecondFactor:g?.sign_in_second_factor||null}}function Jv(i){return Number(i)*1e3}function Zx(i){const[e,t,o]=i.split(".");if(e===void 0||t===void 0||o===void 0)return X_("JWT malformed, contained fewer than 3 sections"),null;try{const h=m2(t);return h?JSON.parse(h):(X_("Failed to decode base64 JWT payload"),null)}catch(h){return X_("Caught error parsing JWT payload as JSON",h?.toString()),null}}function S1(i){const e=Zx(i);return Qn(e,"internal-error"),Qn(typeof e.exp<"u","internal-error"),Qn(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Eg(i,e,t=!1){if(t)return e;try{return await e}catch(o){throw o instanceof Ic&&xD(o)&&i.auth.currentUser===i&&await i.auth.signOut(),o}}function xD({code:i}){return i==="auth/user-disabled"||i==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wD{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const o=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),o}else{this.errorBackoff=3e4;const h=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,h)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class O0{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=cg(this.lastLoginAt),this.creationTime=cg(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function vy(i){var e;const t=i.auth,o=await i.getIdToken(),h=await Eg(i,JS(t,{idToken:o}));Qn(h?.users.length,t,"internal-error");const g=h.users[0];i._notifyReloadListener(g);const _=!((e=g.providerUserInfo)===null||e===void 0)&&e.length?eE(g.providerUserInfo):[],u=TD(i.providerData,_),R=i.isAnonymous,O=!(i.email&&g.passwordHash)&&!u?.length,G=R?O:!1,ne={uid:g.localId,displayName:g.displayName||null,photoURL:g.photoUrl||null,email:g.email||null,emailVerified:g.emailVerified||!1,phoneNumber:g.phoneNumber||null,tenantId:g.tenantId||null,providerData:u,metadata:new O0(g.createdAt,g.lastLoginAt),isAnonymous:G};Object.assign(i,ne)}async function bD(i){const e=Ol(i);await vy(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function TD(i,e){return[...i.filter(o=>!e.some(h=>h.providerId===o.providerId)),...e]}function eE(i){return i.map(e=>{var{providerId:t}=e,o=$x(e,["providerId"]);return{providerId:t,uid:o.rawId||"",displayName:o.displayName||null,email:o.email||null,phoneNumber:o.phoneNumber||null,photoURL:o.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function SD(i,e){const t=await YS(i,{},async()=>{const o=Ng({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:h,apiKey:g}=i.config,_=QS(i,h,"/v1/token",`key=${g}`),u=await i._getAdditionalHeaders();return u["Content-Type"]="application/x-www-form-urlencoded",XS.fetch()(_,{method:"POST",headers:u,body:o})});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function ED(i,e){return cm(i,"POST","/v2/accounts:revokeToken",Gx(i,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bf{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Qn(e.idToken,"internal-error"),Qn(typeof e.idToken<"u","internal-error"),Qn(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):S1(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){Qn(e.length!==0,"internal-error");const t=S1(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(Qn(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:o,refreshToken:h,expiresIn:g}=await SD(e,t);this.updateTokensAndExpiration(o,h,Number(g))}updateTokensAndExpiration(e,t,o){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+o*1e3}static fromJSON(e,t){const{refreshToken:o,accessToken:h,expirationTime:g}=t,_=new Bf;return o&&(Qn(typeof o=="string","internal-error",{appName:e}),_.refreshToken=o),h&&(Qn(typeof h=="string","internal-error",{appName:e}),_.accessToken=h),g&&(Qn(typeof g=="number","internal-error",{appName:e}),_.expirationTime=g),_}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Bf,this.toJSON())}_performRefresh(){return $h("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ed(i,e){Qn(typeof i=="string"||typeof i>"u","internal-error",{appName:e})}class Hh{constructor(e){var{uid:t,auth:o,stsTokenManager:h}=e,g=$x(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new wD(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=o,this.stsTokenManager=h,this.accessToken=h.accessToken,this.displayName=g.displayName||null,this.email=g.email||null,this.emailVerified=g.emailVerified||!1,this.phoneNumber=g.phoneNumber||null,this.photoURL=g.photoURL||null,this.isAnonymous=g.isAnonymous||!1,this.tenantId=g.tenantId||null,this.providerData=g.providerData?[...g.providerData]:[],this.metadata=new O0(g.createdAt||void 0,g.lastLoginAt||void 0)}async getIdToken(e){const t=await Eg(this,this.stsTokenManager.getToken(this.auth,e));return Qn(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return vD(this,e)}reload(){return bD(this)}_assign(e){this!==e&&(Qn(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Hh(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){Qn(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let o=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),o=!0),t&&await vy(this),await this.auth._persistUserIfCurrent(this),o&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(kd(this.auth.app))return Promise.reject(Sp(this.auth));const e=await this.getIdToken();return await Eg(this,yD(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var o,h,g,_,u,R,O,G;const ne=(o=t.displayName)!==null&&o!==void 0?o:void 0,re=(h=t.email)!==null&&h!==void 0?h:void 0,Q=(g=t.phoneNumber)!==null&&g!==void 0?g:void 0,de=(_=t.photoURL)!==null&&_!==void 0?_:void 0,Se=(u=t.tenantId)!==null&&u!==void 0?u:void 0,De=(R=t._redirectEventId)!==null&&R!==void 0?R:void 0,Ke=(O=t.createdAt)!==null&&O!==void 0?O:void 0,et=(G=t.lastLoginAt)!==null&&G!==void 0?G:void 0,{uid:vt,emailVerified:Ye,isAnonymous:it,providerData:at,stsTokenManager:be}=t;Qn(vt&&be,e,"internal-error");const te=Bf.fromJSON(this.name,be);Qn(typeof vt=="string",e,"internal-error"),Ed(ne,e.name),Ed(re,e.name),Qn(typeof Ye=="boolean",e,"internal-error"),Qn(typeof it=="boolean",e,"internal-error"),Ed(Q,e.name),Ed(de,e.name),Ed(Se,e.name),Ed(De,e.name),Ed(Ke,e.name),Ed(et,e.name);const pe=new Hh({uid:vt,auth:e,email:re,emailVerified:Ye,displayName:ne,isAnonymous:it,photoURL:de,phoneNumber:Q,tenantId:Se,stsTokenManager:te,createdAt:Ke,lastLoginAt:et});return at&&Array.isArray(at)&&(pe.providerData=at.map(xe=>Object.assign({},xe))),De&&(pe._redirectEventId=De),pe}static async _fromIdTokenResponse(e,t,o=!1){const h=new Bf;h.updateFromServerResponse(t);const g=new Hh({uid:t.localId,auth:e,stsTokenManager:h,isAnonymous:o});return await vy(g),g}static async _fromGetAccountInfoResponse(e,t,o){const h=t.users[0];Qn(h.localId!==void 0,"internal-error");const g=h.providerUserInfo!==void 0?eE(h.providerUserInfo):[],_=!(h.email&&h.passwordHash)&&!g?.length,u=new Bf;u.updateFromIdToken(o);const R=new Hh({uid:h.localId,auth:e,stsTokenManager:u,isAnonymous:_}),O={uid:h.localId,displayName:h.displayName||null,photoURL:h.photoUrl||null,email:h.email||null,emailVerified:h.emailVerified||!1,phoneNumber:h.phoneNumber||null,tenantId:h.tenantId||null,providerData:g,metadata:new O0(h.createdAt,h.lastLoginAt),isAnonymous:!(h.email&&h.passwordHash)&&!g?.length};return Object.assign(R,O),R}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const E1=new Map;function qh(i){td(i instanceof Function,"Expected a class definition");let e=E1.get(i);return e?(td(e instanceof i,"Instance stored in cache mismatched with class"),e):(e=new i,E1.set(i,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tE{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}tE.type="NONE";const I1=tE;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Y_(i,e,t){return`firebase:${i}:${e}:${t}`}class Vf{constructor(e,t,o){this.persistence=e,this.auth=t,this.userKey=o;const{config:h,name:g}=this.auth;this.fullUserKey=Y_(this.userKey,h.apiKey,g),this.fullPersistenceKey=Y_("persistence",h.apiKey,g),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?Hh._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,o="authUser"){if(!t.length)return new Vf(qh(I1),e,o);const h=(await Promise.all(t.map(async O=>{if(await O._isAvailable())return O}))).filter(O=>O);let g=h[0]||qh(I1);const _=Y_(o,e.config.apiKey,e.name);let u=null;for(const O of t)try{const G=await O._get(_);if(G){const ne=Hh._fromJSON(e,G);O!==g&&(u=ne),g=O;break}}catch{}const R=h.filter(O=>O._shouldAllowMigration);return!g._shouldAllowMigration||!R.length?new Vf(g,e,o):(g=R[0],u&&await g._set(_,u.toJSON()),await Promise.all(t.map(async O=>{if(O!==g)try{await O._remove(_)}catch{}})),new Vf(g,e,o))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function P1(i){const e=i.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(oE(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(nE(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(aE(e))return"Blackberry";if(lE(e))return"Webos";if(iE(e))return"Safari";if((e.includes("chrome/")||rE(e))&&!e.includes("edge/"))return"Chrome";if(sE(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,o=i.match(t);if(o?.length===2)return o[1]}return"Other"}function nE(i=$a()){return/firefox\//i.test(i)}function iE(i=$a()){const e=i.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function rE(i=$a()){return/crios\//i.test(i)}function oE(i=$a()){return/iemobile/i.test(i)}function sE(i=$a()){return/android/i.test(i)}function aE(i=$a()){return/blackberry/i.test(i)}function lE(i=$a()){return/webos/i.test(i)}function Wx(i=$a()){return/iphone|ipad|ipod/i.test(i)||/macintosh/i.test(i)&&/mobile/i.test(i)}function ID(i=$a()){var e;return Wx(i)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function PD(){return TA()&&document.documentMode===10}function uE(i=$a()){return Wx(i)||sE(i)||lE(i)||aE(i)||/windows phone/i.test(i)||oE(i)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cE(i,e=[]){let t;switch(i){case"Browser":t=P1($a());break;case"Worker":t=`${P1($a())}-${i}`;break;default:t=i}const o=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${rm}/${o}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CD{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const o=g=>new Promise((_,u)=>{try{const R=e(g);_(R)}catch(R){u(R)}});o.onAbort=t,this.queue.push(o);const h=this.queue.length-1;return()=>{this.queue[h]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const o of this.queue)await o(e),o.onAbort&&t.push(o.onAbort)}catch(o){t.reverse();for(const h of t)try{h()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:o?.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function AD(i,e={}){return cm(i,"GET","/v2/passwordPolicy",Gx(i,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kD=6;class MD{constructor(e){var t,o,h,g;const _=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=_.minPasswordLength)!==null&&t!==void 0?t:kD,_.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=_.maxPasswordLength),_.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=_.containsLowercaseCharacter),_.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=_.containsUppercaseCharacter),_.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=_.containsNumericCharacter),_.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=_.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(h=(o=e.allowedNonAlphanumericCharacters)===null||o===void 0?void 0:o.join(""))!==null&&h!==void 0?h:"",this.forceUpgradeOnSignin=(g=e.forceUpgradeOnSignin)!==null&&g!==void 0?g:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,o,h,g,_,u;const R={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,R),this.validatePasswordCharacterOptions(e,R),R.isValid&&(R.isValid=(t=R.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),R.isValid&&(R.isValid=(o=R.meetsMaxPasswordLength)!==null&&o!==void 0?o:!0),R.isValid&&(R.isValid=(h=R.containsLowercaseLetter)!==null&&h!==void 0?h:!0),R.isValid&&(R.isValid=(g=R.containsUppercaseLetter)!==null&&g!==void 0?g:!0),R.isValid&&(R.isValid=(_=R.containsNumericCharacter)!==null&&_!==void 0?_:!0),R.isValid&&(R.isValid=(u=R.containsNonAlphanumericCharacter)!==null&&u!==void 0?u:!0),R}validatePasswordLengthOptions(e,t){const o=this.customStrengthOptions.minPasswordLength,h=this.customStrengthOptions.maxPasswordLength;o&&(t.meetsMinPasswordLength=e.length>=o),h&&(t.meetsMaxPasswordLength=e.length<=h)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let o;for(let h=0;h<e.length;h++)o=e.charAt(h),this.updatePasswordCharacterOptionsStatuses(t,o>="a"&&o<="z",o>="A"&&o<="Z",o>="0"&&o<="9",this.allowedNonAlphanumericCharacters.includes(o))}updatePasswordCharacterOptionsStatuses(e,t,o,h,g){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=o)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=h)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=g))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RD{constructor(e,t,o,h){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=o,this.config=h,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new C1(this),this.idTokenSubscription=new C1(this),this.beforeStateQueue=new CD(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=WS,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=h.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=qh(t)),this._initializationPromise=this.queue(async()=>{var o,h;if(!this._deleted&&(this.persistenceManager=await Vf.create(this,e),!this._deleted)){if(!((o=this._popupRedirectResolver)===null||o===void 0)&&o._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((h=this.currentUser)===null||h===void 0?void 0:h.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await JS(this,{idToken:e}),o=await Hh._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(o)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(kd(this.app)){const _=this.app.settings.authIdToken;return _?new Promise(u=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(_).then(u,u))}):this.directlySetCurrentUser(null)}const o=await this.assertedPersistence.getCurrentUser();let h=o,g=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const _=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,u=h?._redirectEventId,R=await this.tryRedirectSignIn(e);(!_||_===u)&&R?.user&&(h=R.user,g=!0)}if(!h)return this.directlySetCurrentUser(null);if(!h._redirectEventId){if(g)try{await this.beforeStateQueue.runMiddleware(h)}catch(_){h=o,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(_))}return h?this.reloadAndSetCurrentUserOrClear(h):this.directlySetCurrentUser(null)}return Qn(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===h._redirectEventId?this.directlySetCurrentUser(h):this.reloadAndSetCurrentUserOrClear(h)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await vy(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=pD()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(kd(this.app))return Promise.reject(Sp(this));const t=e?Ol(e):null;return t&&Qn(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&Qn(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return kd(this.app)?Promise.reject(Sp(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return kd(this.app)?Promise.reject(Sp(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(qh(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await AD(this),t=new MD(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new Fp("auth","Firebase",e())}onAuthStateChanged(e,t,o){return this.registerStateListener(this.authStateSubscription,e,t,o)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,o){return this.registerStateListener(this.idTokenSubscription,e,t,o)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const o=this.onAuthStateChanged(()=>{o(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),o={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(o.tenantId=this.tenantId),await ED(this,o)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,t){const o=await this.getOrInitRedirectPersistenceManager(t);return e===null?o.removeCurrentUser():o.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&qh(e)||this._popupRedirectResolver;Qn(t,this,"argument-error"),this.redirectPersistenceManager=await Vf.create(this,[qh(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,o;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((o=this.redirectUser)===null||o===void 0?void 0:o._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const o=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==o&&(this.lastNotifiedUid=o,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,o,h){if(this._deleted)return()=>{};const g=typeof t=="function"?t:t.next.bind(t);let _=!1;const u=this._isInitialized?Promise.resolve():this._initializationPromise;if(Qn(u,this,"internal-error"),u.then(()=>{_||g(this.currentUser)}),typeof t=="function"){const R=e.addObserver(t,o,h);return()=>{_=!0,R()}}else{const R=e.addObserver(t);return()=>{_=!0,R()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Qn(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=cE(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const o=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());o&&(t["X-Firebase-Client"]=o);const h=await this._getAppCheckToken();return h&&(t["X-Firebase-AppCheck"]=h),t}async _getAppCheckToken(){var e;const t=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return t?.error&&cD(`Error while retrieving App Check token: ${t.error}`),t?.token}}function Kx(i){return Ol(i)}class C1{constructor(e){this.auth=e,this.observer=null,this.addObserver=kA(t=>this.observer=t)}get next(){return Qn(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Xx={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function LD(i){Xx=i}function DD(i){return Xx.loadJS(i)}function zD(){return Xx.gapiScript}function ND(i){return`__${i}${Math.floor(Math.random()*1e6)}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function OD(i,e){const t=Bp(i,"auth");if(t.isInitialized()){const h=t.getImmediate(),g=t.getOptions();if(gg(g,e??{}))return h;ed(h,"already-initialized")}return t.initialize({options:e})}function FD(i,e){const t=e?.persistence||[],o=(Array.isArray(t)?t:[t]).map(qh);e?.errorMap&&i._updateErrorMap(e.errorMap),i._initializeWithPersistence(o,e?.popupRedirectResolver)}function BD(i,e,t){const o=Kx(i);Qn(o._canInitEmulator,o,"emulator-config-failed"),Qn(/^https?:\/\//.test(e),o,"invalid-emulator-scheme");const h=!1,g=hE(e),{host:_,port:u}=VD(e),R=u===null?"":`:${u}`;o.config.emulator={url:`${g}//${_}${R}/`},o.settings.appVerificationDisabledForTesting=!0,o.emulatorConfig=Object.freeze({host:_,port:u,protocol:g.replace(":",""),options:Object.freeze({disableWarnings:h})}),UD()}function hE(i){const e=i.indexOf(":");return e<0?"":i.substr(0,e+1)}function VD(i){const e=hE(i),t=/(\/\/)?([^?#/]+)/.exec(i.substr(e.length));if(!t)return{host:"",port:null};const o=t[2].split("@").pop()||"",h=/^(\[[^\]]+\])(:|$)/.exec(o);if(h){const g=h[1];return{host:g,port:A1(o.substr(g.length+1))}}else{const[g,_]=o.split(":");return{host:g,port:A1(_)}}}function A1(i){if(!i)return null;const e=Number(i);return isNaN(e)?null:e}function UD(){function i(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",i):i())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dE{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return $h("not implemented")}_getIdTokenResponse(e){return $h("not implemented")}_linkToIdToken(e,t){return $h("not implemented")}_getReauthenticationResolver(e){return $h("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Uf(i,e){return gD(i,"POST","/v1/accounts:signInWithIdp",Gx(i,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jD="http://localhost";class Rp extends dE{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Rp(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):ed("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:o,signInMethod:h}=t,g=$x(t,["providerId","signInMethod"]);if(!o||!h)return null;const _=new Rp(o,h);return _.idToken=g.idToken||void 0,_.accessToken=g.accessToken||void 0,_.secret=g.secret,_.nonce=g.nonce,_.pendingToken=g.pendingToken||null,_}_getIdTokenResponse(e){const t=this.buildRequest();return Uf(e,t)}_linkToIdToken(e,t){const o=this.buildRequest();return o.idToken=t,Uf(e,o)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Uf(e,t)}buildRequest(){const e={requestUri:jD,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Ng(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pE{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jg extends pE{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Id extends jg{constructor(){super("facebook.com")}static credential(e){return Rp._fromParams({providerId:Id.PROVIDER_ID,signInMethod:Id.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Id.credentialFromTaggedObject(e)}static credentialFromError(e){return Id.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Id.credential(e.oauthAccessToken)}catch{return null}}}Id.FACEBOOK_SIGN_IN_METHOD="facebook.com";Id.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pd extends jg{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Rp._fromParams({providerId:Pd.PROVIDER_ID,signInMethod:Pd.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Pd.credentialFromTaggedObject(e)}static credentialFromError(e){return Pd.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:o}=e;if(!t&&!o)return null;try{return Pd.credential(t,o)}catch{return null}}}Pd.GOOGLE_SIGN_IN_METHOD="google.com";Pd.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cd extends jg{constructor(){super("github.com")}static credential(e){return Rp._fromParams({providerId:Cd.PROVIDER_ID,signInMethod:Cd.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Cd.credentialFromTaggedObject(e)}static credentialFromError(e){return Cd.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Cd.credential(e.oauthAccessToken)}catch{return null}}}Cd.GITHUB_SIGN_IN_METHOD="github.com";Cd.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ad extends jg{constructor(){super("twitter.com")}static credential(e,t){return Rp._fromParams({providerId:Ad.PROVIDER_ID,signInMethod:Ad.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Ad.credentialFromTaggedObject(e)}static credentialFromError(e){return Ad.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:o}=e;if(!t||!o)return null;try{return Ad.credential(t,o)}catch{return null}}}Ad.TWITTER_SIGN_IN_METHOD="twitter.com";Ad.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jf{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,o,h=!1){const g=await Hh._fromIdTokenResponse(e,o,h),_=k1(o);return new Jf({user:g,providerId:_,_tokenResponse:o,operationType:t})}static async _forOperation(e,t,o){await e._updateTokensIfNecessary(o,!0);const h=k1(o);return new Jf({user:e,providerId:h,_tokenResponse:o,operationType:t})}}function k1(i){return i.providerId?i.providerId:"phoneNumber"in i?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xy extends Ic{constructor(e,t,o,h){var g;super(t.code,t.message),this.operationType=o,this.user=h,Object.setPrototypeOf(this,xy.prototype),this.customData={appName:e.name,tenantId:(g=e.tenantId)!==null&&g!==void 0?g:void 0,_serverResponse:t.customData._serverResponse,operationType:o}}static _fromErrorAndOperation(e,t,o,h){return new xy(e,t,o,h)}}function fE(i,e,t,o){return(e==="reauthenticate"?t._getReauthenticationResolver(i):t._getIdTokenResponse(i)).catch(g=>{throw g.code==="auth/multi-factor-auth-required"?xy._fromErrorAndOperation(i,g,e,o):g})}async function $D(i,e,t=!1){const o=await Eg(i,e._linkToIdToken(i.auth,await i.getIdToken()),t);return Jf._forOperation(i,"link",o)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function HD(i,e,t=!1){const{auth:o}=i;if(kd(o.app))return Promise.reject(Sp(o));const h="reauthenticate";try{const g=await Eg(i,fE(o,h,e,i),t);Qn(g.idToken,o,"internal-error");const _=Zx(g.idToken);Qn(_,o,"internal-error");const{sub:u}=_;return Qn(i.uid===u,o,"user-mismatch"),Jf._forOperation(i,h,g)}catch(g){throw g?.code==="auth/user-not-found"&&ed(o,"user-mismatch"),g}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function qD(i,e,t=!1){if(kd(i.app))return Promise.reject(Sp(i));const o="signIn",h=await fE(i,o,e),g=await Jf._fromIdTokenResponse(i,o,h);return t||await i._updateCurrentUser(g.user),g}function GD(i,e,t,o){return Ol(i).onIdTokenChanged(e,t,o)}function ZD(i,e,t){return Ol(i).beforeAuthStateChanged(e,t)}const wy="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mE{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(wy,"1"),this.storage.removeItem(wy),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WD=1e3,KD=10;class gE extends mE{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=uE(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const o=this.storage.getItem(t),h=this.localCache[t];o!==h&&e(t,h,o)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((_,u,R)=>{this.notifyListeners(_,R)});return}const o=e.key;t?this.detachListener():this.stopPolling();const h=()=>{const _=this.storage.getItem(o);!t&&this.localCache[o]===_||this.notifyListeners(o,_)},g=this.storage.getItem(o);PD()&&g!==e.newValue&&e.newValue!==e.oldValue?setTimeout(h,KD):h()}notifyListeners(e,t){this.localCache[e]=t;const o=this.listeners[e];if(o)for(const h of Array.from(o))h(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,o)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:o}),!0)})},WD)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}gE.type="LOCAL";const XD=gE;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _E extends mE{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}_E.type="SESSION";const yE=_E;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function YD(i){return Promise.all(i.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jy{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(h=>h.isListeningto(e));if(t)return t;const o=new Jy(e);return this.receivers.push(o),o}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:o,eventType:h,data:g}=t.data,_=this.handlersMap[h];if(!_?.size)return;t.ports[0].postMessage({status:"ack",eventId:o,eventType:h});const u=Array.from(_).map(async O=>O(t.origin,g)),R=await YD(u);t.ports[0].postMessage({status:"done",eventId:o,eventType:h,response:R})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Jy.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yx(i="",e=10){let t="";for(let o=0;o<e;o++)t+=Math.floor(Math.random()*10);return i+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QD{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,o=50){const h=typeof MessageChannel<"u"?new MessageChannel:null;if(!h)throw new Error("connection_unavailable");let g,_;return new Promise((u,R)=>{const O=Yx("",20);h.port1.start();const G=setTimeout(()=>{R(new Error("unsupported_event"))},o);_={messageChannel:h,onMessage(ne){const re=ne;if(re.data.eventId===O)switch(re.data.status){case"ack":clearTimeout(G),g=setTimeout(()=>{R(new Error("timeout"))},3e3);break;case"done":clearTimeout(g),u(re.data.response);break;default:clearTimeout(G),clearTimeout(g),R(new Error("invalid_response"));break}}},this.handlers.add(_),h.port1.addEventListener("message",_.onMessage),this.target.postMessage({eventType:e,eventId:O,data:t},[h.port2])}).finally(()=>{_&&this.removeMessageHandler(_)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ah(){return window}function JD(i){ah().location.href=i}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vE(){return typeof ah().WorkerGlobalScope<"u"&&typeof ah().importScripts=="function"}async function ez(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function tz(){var i;return((i=navigator?.serviceWorker)===null||i===void 0?void 0:i.controller)||null}function nz(){return vE()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xE="firebaseLocalStorageDb",iz=1,by="firebaseLocalStorage",wE="fbase_key";class $g{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function ev(i,e){return i.transaction([by],e?"readwrite":"readonly").objectStore(by)}function rz(){const i=indexedDB.deleteDatabase(xE);return new $g(i).toPromise()}function F0(){const i=indexedDB.open(xE,iz);return new Promise((e,t)=>{i.addEventListener("error",()=>{t(i.error)}),i.addEventListener("upgradeneeded",()=>{const o=i.result;try{o.createObjectStore(by,{keyPath:wE})}catch(h){t(h)}}),i.addEventListener("success",async()=>{const o=i.result;o.objectStoreNames.contains(by)?e(o):(o.close(),await rz(),e(await F0()))})})}async function M1(i,e,t){const o=ev(i,!0).put({[wE]:e,value:t});return new $g(o).toPromise()}async function oz(i,e){const t=ev(i,!1).get(e),o=await new $g(t).toPromise();return o===void 0?null:o.value}function R1(i,e){const t=ev(i,!0).delete(e);return new $g(t).toPromise()}const sz=800,az=3;class bE{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await F0(),this.db)}async _withRetries(e){let t=0;for(;;)try{const o=await this._openDb();return await e(o)}catch(o){if(t++>az)throw o;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return vE()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Jy._getInstance(nz()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await ez(),!this.activeServiceWorker)return;this.sender=new QD(this.activeServiceWorker);const o=await this.sender._send("ping",{},800);o&&!((e=o[0])===null||e===void 0)&&e.fulfilled&&!((t=o[0])===null||t===void 0)&&t.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||tz()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await F0();return await M1(e,wy,"1"),await R1(e,wy),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(o=>M1(o,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(o=>oz(o,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>R1(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(h=>{const g=ev(h,!1).getAll();return new $g(g).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],o=new Set;if(e.length!==0)for(const{fbase_key:h,value:g}of e)o.add(h),JSON.stringify(this.localCache[h])!==JSON.stringify(g)&&(this.notifyListeners(h,g),t.push(h));for(const h of Object.keys(this.localCache))this.localCache[h]&&!o.has(h)&&(this.notifyListeners(h,null),t.push(h));return t}notifyListeners(e,t){this.localCache[e]=t;const o=this.listeners[e];if(o)for(const h of Array.from(o))h(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),sz)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}bE.type="LOCAL";const lz=bE;new Ug(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uz(i,e){return e?qh(e):(Qn(i._popupRedirectResolver,i,"argument-error"),i._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qx extends dE{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Uf(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Uf(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Uf(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function cz(i){return qD(i.auth,new Qx(i),i.bypassAuthState)}function hz(i){const{auth:e,user:t}=i;return Qn(t,e,"internal-error"),HD(t,new Qx(i),i.bypassAuthState)}async function dz(i){const{auth:e,user:t}=i;return Qn(t,e,"internal-error"),$D(t,new Qx(i),i.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TE{constructor(e,t,o,h,g=!1){this.auth=e,this.resolver=o,this.user=h,this.bypassAuthState=g,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(o){this.reject(o)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:o,postBody:h,tenantId:g,error:_,type:u}=e;if(_){this.reject(_);return}const R={auth:this.auth,requestUri:t,sessionId:o,tenantId:g||void 0,postBody:h||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(u)(R))}catch(O){this.reject(O)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return cz;case"linkViaPopup":case"linkViaRedirect":return dz;case"reauthViaPopup":case"reauthViaRedirect":return hz;default:ed(this.auth,"internal-error")}}resolve(e){td(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){td(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pz=new Ug(2e3,1e4);class Of extends TE{constructor(e,t,o,h,g){super(e,t,h,g),this.provider=o,this.authWindow=null,this.pollId=null,Of.currentPopupAction&&Of.currentPopupAction.cancel(),Of.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Qn(e,this.auth,"internal-error"),e}async onExecution(){td(this.filter.length===1,"Popup operations only handle one event");const e=Yx();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(sh(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(sh(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Of.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,o;if(!((o=(t=this.authWindow)===null||t===void 0?void 0:t.window)===null||o===void 0)&&o.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(sh(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,pz.get())};e()}}Of.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fz="pendingRedirect",Q_=new Map;class mz extends TE{constructor(e,t,o=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,o),this.eventId=null}async execute(){let e=Q_.get(this.auth._key());if(!e){try{const o=await gz(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(o)}catch(t){e=()=>Promise.reject(t)}Q_.set(this.auth._key(),e)}return this.bypassAuthState||Q_.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function gz(i,e){const t=vz(e),o=yz(i);if(!await o._isAvailable())return!1;const h=await o._get(t)==="true";return await o._remove(t),h}function _z(i,e){Q_.set(i._key(),e)}function yz(i){return qh(i._redirectPersistence)}function vz(i){return Y_(fz,i.config.apiKey,i.name)}async function xz(i,e,t=!1){if(kd(i.app))return Promise.reject(Sp(i));const o=Kx(i),h=uz(o,e),_=await new mz(o,h,t).execute();return _&&!t&&(delete _.user._redirectEventId,await o._persistUserIfCurrent(_.user),await o._setRedirectUser(null,e)),_}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wz=600*1e3;class bz{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(o=>{this.isEventForConsumer(e,o)&&(t=!0,this.sendToConsumer(e,o),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!Tz(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var o;if(e.error&&!SE(e)){const h=((o=e.error.code)===null||o===void 0?void 0:o.split("auth/")[1])||"internal-error";t.onError(sh(this.auth,h))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const o=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&o}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=wz&&this.cachedEventUids.clear(),this.cachedEventUids.has(L1(e))}saveEventToCache(e){this.cachedEventUids.add(L1(e)),this.lastProcessedEventTime=Date.now()}}function L1(i){return[i.type,i.eventId,i.sessionId,i.tenantId].filter(e=>e).join("-")}function SE({type:i,error:e}){return i==="unknown"&&e?.code==="auth/no-auth-event"}function Tz(i){switch(i.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return SE(i);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Sz(i,e={}){return cm(i,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ez=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Iz=/^https?/;async function Pz(i){if(i.config.emulator)return;const{authorizedDomains:e}=await Sz(i);for(const t of e)try{if(Cz(t))return}catch{}ed(i,"unauthorized-domain")}function Cz(i){const e=N0(),{protocol:t,hostname:o}=new URL(e);if(i.startsWith("chrome-extension://")){const _=new URL(i);return _.hostname===""&&o===""?t==="chrome-extension:"&&i.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&_.hostname===o}if(!Iz.test(t))return!1;if(Ez.test(i))return o===i;const h=i.replace(/\./g,"\\.");return new RegExp("^(.+\\."+h+"|"+h+")$","i").test(o)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Az=new Ug(3e4,6e4);function D1(){const i=ah().___jsl;if(i?.H){for(const e of Object.keys(i.H))if(i.H[e].r=i.H[e].r||[],i.H[e].L=i.H[e].L||[],i.H[e].r=[...i.H[e].L],i.CP)for(let t=0;t<i.CP.length;t++)i.CP[t]=null}}function kz(i){return new Promise((e,t)=>{var o,h,g;function _(){D1(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{D1(),t(sh(i,"network-request-failed"))},timeout:Az.get()})}if(!((h=(o=ah().gapi)===null||o===void 0?void 0:o.iframes)===null||h===void 0)&&h.Iframe)e(gapi.iframes.getContext());else if(!((g=ah().gapi)===null||g===void 0)&&g.load)_();else{const u=ND("iframefcb");return ah()[u]=()=>{gapi.load?_():t(sh(i,"network-request-failed"))},DD(`${zD()}?onload=${u}`).catch(R=>t(R))}}).catch(e=>{throw J_=null,e})}let J_=null;function Mz(i){return J_=J_||kz(i),J_}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rz=new Ug(5e3,15e3),Lz="__/auth/iframe",Dz="emulator/auth/iframe",zz={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Nz=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Oz(i){const e=i.config;Qn(e.authDomain,i,"auth-domain-config-required");const t=e.emulator?qx(e,Dz):`https://${i.config.authDomain}/${Lz}`,o={apiKey:e.apiKey,appName:i.name,v:rm},h=Nz.get(i.config.apiHost);h&&(o.eid=h);const g=i._getFrameworks();return g.length&&(o.fw=g.join(",")),`${t}?${Ng(o).slice(1)}`}async function Fz(i){const e=await Mz(i),t=ah().gapi;return Qn(t,i,"internal-error"),e.open({where:document.body,url:Oz(i),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:zz,dontclear:!0},o=>new Promise(async(h,g)=>{await o.restyle({setHideOnLeave:!1});const _=sh(i,"network-request-failed"),u=ah().setTimeout(()=>{g(_)},Rz.get());function R(){ah().clearTimeout(u),h(o)}o.ping(R).then(R,()=>{g(_)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bz={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},Vz=500,Uz=600,jz="_blank",$z="http://localhost";class z1{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function Hz(i,e,t,o=Vz,h=Uz){const g=Math.max((window.screen.availHeight-h)/2,0).toString(),_=Math.max((window.screen.availWidth-o)/2,0).toString();let u="";const R=Object.assign(Object.assign({},Bz),{width:o.toString(),height:h.toString(),top:g,left:_}),O=$a().toLowerCase();t&&(u=rE(O)?jz:t),nE(O)&&(e=e||$z,R.scrollbars="yes");const G=Object.entries(R).reduce((re,[Q,de])=>`${re}${Q}=${de},`,"");if(ID(O)&&u!=="_self")return qz(e||"",u),new z1(null);const ne=window.open(e||"",u,G);Qn(ne,i,"popup-blocked");try{ne.focus()}catch{}return new z1(ne)}function qz(i,e){const t=document.createElement("a");t.href=i,t.target=e;const o=document.createEvent("MouseEvent");o.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(o)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gz="__/auth/handler",Zz="emulator/auth/handler",Wz=encodeURIComponent("fac");async function N1(i,e,t,o,h,g){Qn(i.config.authDomain,i,"auth-domain-config-required"),Qn(i.config.apiKey,i,"invalid-api-key");const _={apiKey:i.config.apiKey,appName:i.name,authType:t,redirectUrl:o,v:rm,eventId:h};if(e instanceof pE){e.setDefaultLanguage(i.languageCode),_.providerId=e.providerId||"",AA(e.getCustomParameters())||(_.customParameters=JSON.stringify(e.getCustomParameters()));for(const[G,ne]of Object.entries({}))_[G]=ne}if(e instanceof jg){const G=e.getScopes().filter(ne=>ne!=="");G.length>0&&(_.scopes=G.join(","))}i.tenantId&&(_.tid=i.tenantId);const u=_;for(const G of Object.keys(u))u[G]===void 0&&delete u[G];const R=await i._getAppCheckToken(),O=R?`#${Wz}=${encodeURIComponent(R)}`:"";return`${Kz(i)}?${Ng(u).slice(1)}${O}`}function Kz({config:i}){return i.emulator?qx(i,Zz):`https://${i.authDomain}/${Gz}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const e0="webStorageSupport";class Xz{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=yE,this._completeRedirectFn=xz,this._overrideRedirectResult=_z}async _openPopup(e,t,o,h){var g;td((g=this.eventManagers[e._key()])===null||g===void 0?void 0:g.manager,"_initialize() not called before _openPopup()");const _=await N1(e,t,o,N0(),h);return Hz(e,_,Yx())}async _openRedirect(e,t,o,h){await this._originValidation(e);const g=await N1(e,t,o,N0(),h);return JD(g),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:h,promise:g}=this.eventManagers[t];return h?Promise.resolve(h):(td(g,"If manager is not set, promise should be"),g)}const o=this.initAndGetManager(e);return this.eventManagers[t]={promise:o},o.catch(()=>{delete this.eventManagers[t]}),o}async initAndGetManager(e){const t=await Fz(e),o=new bz(e);return t.register("authEvent",h=>(Qn(h?.authEvent,e,"invalid-auth-event"),{status:o.onEvent(h.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:o},this.iframes[e._key()]=t,o}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(e0,{type:e0},h=>{var g;const _=(g=h?.[0])===null||g===void 0?void 0:g[e0];_!==void 0&&t(!!_),ed(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=Pz(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return uE()||iE()||Wx()}}const Yz=Xz;var O1="@firebase/auth",F1="1.8.2";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qz{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(o=>{e(o?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){Qn(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jz(i){switch(i){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function e5(i){ph(new Sc("auth",(e,{options:t})=>{const o=e.getProvider("app").getImmediate(),h=e.getProvider("heartbeat"),g=e.getProvider("app-check-internal"),{apiKey:_,authDomain:u}=o.options;Qn(_&&!_.includes(":"),"invalid-api-key",{appName:o.name});const R={apiKey:_,authDomain:u,clientPlatform:i,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:cE(i)},O=new RD(o,h,g,R);return FD(O,t),O},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,o)=>{e.getProvider("auth-internal").initialize()})),ph(new Sc("auth-internal",e=>{const t=Kx(e.getProvider("auth").getImmediate());return(o=>new Qz(o))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Vu(O1,F1,Jz(i)),Vu(O1,F1,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const t5=300,n5=y2("authIdTokenMaxAge")||t5;let B1=null;const i5=i=>async e=>{const t=e&&await e.getIdTokenResult(),o=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(o&&o>n5)return;const h=t?.token;B1!==h&&(B1=h,await fetch(i,{method:h?"POST":"DELETE",headers:h?{Authorization:`Bearer ${h}`}:{}}))};function r5(i=ax()){const e=Bp(i,"auth");if(e.isInitialized())return e.getImmediate();const t=OD(i,{popupRedirectResolver:Yz,persistence:[lz,XD,yE]}),o=y2("authTokenSyncURL");if(o&&typeof isSecureContext=="boolean"&&isSecureContext){const g=new URL(o,location.origin);if(location.origin===g.origin){const _=i5(g.toString());ZD(t,_,()=>_(t.currentUser)),GD(t,u=>_(u))}}const h=g2("auth");return h&&BD(t,`http://${h}`),t}function o5(){var i,e;return(e=(i=document.getElementsByTagName("head"))===null||i===void 0?void 0:i[0])!==null&&e!==void 0?e:document}LD({loadJS(i){return new Promise((e,t)=>{const o=document.createElement("script");o.setAttribute("src",i),o.onload=e,o.onerror=h=>{const g=sh("internal-error");g.customData=h,t(g)},o.type="text/javascript",o.charset="UTF-8",o5().appendChild(o)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});e5("Browser");const EE="@firebase/installations",Jx="0.6.12";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IE=1e4,PE=`w:${Jx}`,CE="FIS_v2",s5="https://firebaseinstallations.googleapis.com/v1",a5=3600*1e3,l5="installations",u5="Installations";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const c5={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},Lp=new Fp(l5,u5,c5);function AE(i){return i instanceof Ic&&i.code.includes("request-failed")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kE({projectId:i}){return`${s5}/projects/${i}/installations`}function ME(i){return{token:i.token,requestStatus:2,expiresIn:d5(i.expiresIn),creationTime:Date.now()}}async function RE(i,e){const o=(await e.json()).error;return Lp.create("request-failed",{requestName:i,serverCode:o.code,serverMessage:o.message,serverStatus:o.status})}function LE({apiKey:i}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":i})}function h5(i,{refreshToken:e}){const t=LE(i);return t.append("Authorization",p5(e)),t}async function DE(i){const e=await i();return e.status>=500&&e.status<600?i():e}function d5(i){return Number(i.replace("s","000"))}function p5(i){return`${CE} ${i}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function f5({appConfig:i,heartbeatServiceProvider:e},{fid:t}){const o=kE(i),h=LE(i),g=e.getImmediate({optional:!0});if(g){const O=await g.getHeartbeatsHeader();O&&h.append("x-firebase-client",O)}const _={fid:t,authVersion:CE,appId:i.appId,sdkVersion:PE},u={method:"POST",headers:h,body:JSON.stringify(_)},R=await DE(()=>fetch(o,u));if(R.ok){const O=await R.json();return{fid:O.fid||t,registrationStatus:2,refreshToken:O.refreshToken,authToken:ME(O.authToken)}}else throw await RE("Create Installation",R)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zE(i){return new Promise(e=>{setTimeout(e,i)})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function m5(i){return btoa(String.fromCharCode(...i)).replace(/\+/g,"-").replace(/\//g,"_")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const g5=/^[cdef][\w-]{21}$/,B0="";function _5(){try{const i=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(i),i[0]=112+i[0]%16;const t=y5(i);return g5.test(t)?t:B0}catch{return B0}}function y5(i){return m5(i).substr(0,22)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tv(i){return`${i.appName}!${i.appId}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const NE=new Map;function OE(i,e){const t=tv(i);FE(t,e),v5(t,e)}function FE(i,e){const t=NE.get(i);if(t)for(const o of t)o(e)}function v5(i,e){const t=x5();t&&t.postMessage({key:i,fid:e}),w5()}let bp=null;function x5(){return!bp&&"BroadcastChannel"in self&&(bp=new BroadcastChannel("[Firebase] FID Change"),bp.onmessage=i=>{FE(i.data.key,i.data.fid)}),bp}function w5(){NE.size===0&&bp&&(bp.close(),bp=null)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const b5="firebase-installations-database",T5=1,Dp="firebase-installations-store";let t0=null;function ew(){return t0||(t0=S2(b5,T5,{upgrade:(i,e)=>{switch(e){case 0:i.createObjectStore(Dp)}}})),t0}async function Ty(i,e){const t=tv(i),h=(await ew()).transaction(Dp,"readwrite"),g=h.objectStore(Dp),_=await g.get(t);return await g.put(e,t),await h.done,(!_||_.fid!==e.fid)&&OE(i,e.fid),e}async function BE(i){const e=tv(i),o=(await ew()).transaction(Dp,"readwrite");await o.objectStore(Dp).delete(e),await o.done}async function nv(i,e){const t=tv(i),h=(await ew()).transaction(Dp,"readwrite"),g=h.objectStore(Dp),_=await g.get(t),u=e(_);return u===void 0?await g.delete(t):await g.put(u,t),await h.done,u&&(!_||_.fid!==u.fid)&&OE(i,u.fid),u}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function tw(i){let e;const t=await nv(i.appConfig,o=>{const h=S5(o),g=E5(i,h);return e=g.registrationPromise,g.installationEntry});return t.fid===B0?{installationEntry:await e}:{installationEntry:t,registrationPromise:e}}function S5(i){const e=i||{fid:_5(),registrationStatus:0};return VE(e)}function E5(i,e){if(e.registrationStatus===0){if(!navigator.onLine){const h=Promise.reject(Lp.create("app-offline"));return{installationEntry:e,registrationPromise:h}}const t={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},o=I5(i,t);return{installationEntry:t,registrationPromise:o}}else return e.registrationStatus===1?{installationEntry:e,registrationPromise:P5(i)}:{installationEntry:e}}async function I5(i,e){try{const t=await f5(i,e);return Ty(i.appConfig,t)}catch(t){throw AE(t)&&t.customData.serverCode===409?await BE(i.appConfig):await Ty(i.appConfig,{fid:e.fid,registrationStatus:0}),t}}async function P5(i){let e=await V1(i.appConfig);for(;e.registrationStatus===1;)await zE(100),e=await V1(i.appConfig);if(e.registrationStatus===0){const{installationEntry:t,registrationPromise:o}=await tw(i);return o||t}return e}function V1(i){return nv(i,e=>{if(!e)throw Lp.create("installation-not-found");return VE(e)})}function VE(i){return C5(i)?{fid:i.fid,registrationStatus:0}:i}function C5(i){return i.registrationStatus===1&&i.registrationTime+IE<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function A5({appConfig:i,heartbeatServiceProvider:e},t){const o=k5(i,t),h=h5(i,t),g=e.getImmediate({optional:!0});if(g){const O=await g.getHeartbeatsHeader();O&&h.append("x-firebase-client",O)}const _={installation:{sdkVersion:PE,appId:i.appId}},u={method:"POST",headers:h,body:JSON.stringify(_)},R=await DE(()=>fetch(o,u));if(R.ok){const O=await R.json();return ME(O)}else throw await RE("Generate Auth Token",R)}function k5(i,{fid:e}){return`${kE(i)}/${e}/authTokens:generate`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function nw(i,e=!1){let t;const o=await nv(i.appConfig,g=>{if(!UE(g))throw Lp.create("not-registered");const _=g.authToken;if(!e&&L5(_))return g;if(_.requestStatus===1)return t=M5(i,e),g;{if(!navigator.onLine)throw Lp.create("app-offline");const u=z5(g);return t=R5(i,u),u}});return t?await t:o.authToken}async function M5(i,e){let t=await U1(i.appConfig);for(;t.authToken.requestStatus===1;)await zE(100),t=await U1(i.appConfig);const o=t.authToken;return o.requestStatus===0?nw(i,e):o}function U1(i){return nv(i,e=>{if(!UE(e))throw Lp.create("not-registered");const t=e.authToken;return N5(t)?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e})}async function R5(i,e){try{const t=await A5(i,e),o=Object.assign(Object.assign({},e),{authToken:t});return await Ty(i.appConfig,o),t}catch(t){if(AE(t)&&(t.customData.serverCode===401||t.customData.serverCode===404))await BE(i.appConfig);else{const o=Object.assign(Object.assign({},e),{authToken:{requestStatus:0}});await Ty(i.appConfig,o)}throw t}}function UE(i){return i!==void 0&&i.registrationStatus===2}function L5(i){return i.requestStatus===2&&!D5(i)}function D5(i){const e=Date.now();return e<i.creationTime||i.creationTime+i.expiresIn<e+a5}function z5(i){const e={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},i),{authToken:e})}function N5(i){return i.requestStatus===1&&i.requestTime+IE<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function O5(i){const e=i,{installationEntry:t,registrationPromise:o}=await tw(e);return o?o.catch(console.error):nw(e).catch(console.error),t.fid}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function F5(i,e=!1){const t=i;return await B5(t),(await nw(t,e)).token}async function B5(i){const{registrationPromise:e}=await tw(i);e&&await e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function V5(i){if(!i||!i.options)throw n0("App Configuration");if(!i.name)throw n0("App Name");const e=["projectId","apiKey","appId"];for(const t of e)if(!i.options[t])throw n0(t);return{appName:i.name,projectId:i.options.projectId,apiKey:i.options.apiKey,appId:i.options.appId}}function n0(i){return Lp.create("missing-app-config-values",{valueName:i})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jE="installations",U5="installations-internal",j5=i=>{const e=i.getProvider("app").getImmediate(),t=V5(e),o=Bp(e,"heartbeat");return{app:e,appConfig:t,heartbeatServiceProvider:o,_delete:()=>Promise.resolve()}},$5=i=>{const e=i.getProvider("app").getImmediate(),t=Bp(e,jE).getImmediate();return{getId:()=>O5(t),getToken:h=>F5(t,h)}};function H5(){ph(new Sc(jE,j5,"PUBLIC")),ph(new Sc(U5,$5,"PRIVATE"))}H5();Vu(EE,Jx);Vu(EE,Jx,"esm2017");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sy="analytics",q5="firebase_id",G5="origin",Z5=60*1e3,W5="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",iw="https://www.googletagmanager.com/gtag/js";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nl=new By("@firebase/analytics");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const K5={"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-initialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."},_u=new Fp("analytics","Analytics",K5);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function X5(i){if(!i.startsWith(iw)){const e=_u.create("invalid-gtag-resource",{gtagURL:i});return Nl.warn(e.message),""}return i}function $E(i){return Promise.all(i.map(e=>e.catch(t=>t)))}function Y5(i,e){let t;return window.trustedTypes&&(t=window.trustedTypes.createPolicy(i,e)),t}function Q5(i,e){const t=Y5("firebase-js-sdk-policy",{createScriptURL:X5}),o=document.createElement("script"),h=`${iw}?l=${i}&id=${e}`;o.src=t?t?.createScriptURL(h):h,o.async=!0,document.head.appendChild(o)}function J5(i){let e=[];return Array.isArray(window[i])?e=window[i]:window[i]=e,e}async function eN(i,e,t,o,h,g){const _=o[h];try{if(_)await e[_];else{const R=(await $E(t)).find(O=>O.measurementId===h);R&&await e[R.appId]}}catch(u){Nl.error(u)}i("config",h,g)}async function tN(i,e,t,o,h){try{let g=[];if(h&&h.send_to){let _=h.send_to;Array.isArray(_)||(_=[_]);const u=await $E(t);for(const R of _){const O=u.find(ne=>ne.measurementId===R),G=O&&e[O.appId];if(G)g.push(G);else{g=[];break}}}g.length===0&&(g=Object.values(e)),await Promise.all(g),i("event",o,h||{})}catch(g){Nl.error(g)}}function nN(i,e,t,o){async function h(g,..._){try{if(g==="event"){const[u,R]=_;await tN(i,e,t,u,R)}else if(g==="config"){const[u,R]=_;await eN(i,e,t,o,u,R)}else if(g==="consent"){const[u,R]=_;i("consent",u,R)}else if(g==="get"){const[u,R,O]=_;i("get",u,R,O)}else if(g==="set"){const[u]=_;i("set",u)}else i(g,..._)}catch(u){Nl.error(u)}}return h}function iN(i,e,t,o,h){let g=function(..._){window[o].push(arguments)};return window[h]&&typeof window[h]=="function"&&(g=window[h]),window[h]=nN(g,i,e,t),{gtagCore:g,wrappedGtag:window[h]}}function rN(i){const e=window.document.getElementsByTagName("script");for(const t of Object.values(e))if(t.src&&t.src.includes(iw)&&t.src.includes(i))return t;return null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oN=30,sN=1e3;class aN{constructor(e={},t=sN){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}}const HE=new aN;function lN(i){return new Headers({Accept:"application/json","x-goog-api-key":i})}async function uN(i){var e;const{appId:t,apiKey:o}=i,h={method:"GET",headers:lN(o)},g=W5.replace("{app-id}",t),_=await fetch(g,h);if(_.status!==200&&_.status!==304){let u="";try{const R=await _.json();!((e=R.error)===null||e===void 0)&&e.message&&(u=R.error.message)}catch{}throw _u.create("config-fetch-failed",{httpStatus:_.status,responseMessage:u})}return _.json()}async function cN(i,e=HE,t){const{appId:o,apiKey:h,measurementId:g}=i.options;if(!o)throw _u.create("no-app-id");if(!h){if(g)return{measurementId:g,appId:o};throw _u.create("no-api-key")}const _=e.getThrottleMetadata(o)||{backoffCount:0,throttleEndTimeMillis:Date.now()},u=new pN;return setTimeout(async()=>{u.abort()},Z5),qE({appId:o,apiKey:h,measurementId:g},_,u,e)}async function qE(i,{throttleEndTimeMillis:e,backoffCount:t},o,h=HE){var g;const{appId:_,measurementId:u}=i;try{await hN(o,e)}catch(R){if(u)return Nl.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${u} provided in the "measurementId" field in the local Firebase config. [${R?.message}]`),{appId:_,measurementId:u};throw R}try{const R=await uN(i);return h.deleteThrottleMetadata(_),R}catch(R){const O=R;if(!dN(O)){if(h.deleteThrottleMetadata(_),u)return Nl.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${u} provided in the "measurementId" field in the local Firebase config. [${O?.message}]`),{appId:_,measurementId:u};throw R}const G=Number((g=O?.customData)===null||g===void 0?void 0:g.httpStatus)===503?Eb(t,h.intervalMillis,oN):Eb(t,h.intervalMillis),ne={throttleEndTimeMillis:Date.now()+G,backoffCount:t+1};return h.setThrottleMetadata(_,ne),Nl.debug(`Calling attemptFetch again in ${G} millis`),qE(i,ne,o,h)}}function hN(i,e){return new Promise((t,o)=>{const h=Math.max(e-Date.now(),0),g=setTimeout(t,h);i.addEventListener(()=>{clearTimeout(g),o(_u.create("fetch-throttle",{throttleEndTimeMillis:e}))})})}function dN(i){if(!(i instanceof Ic)||!i.customData)return!1;const e=Number(i.customData.httpStatus);return e===429||e===500||e===503||e===504}class pN{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}async function fN(i,e,t,o,h){if(h&&h.global){i("event",t,o);return}else{const g=await e,_=Object.assign(Object.assign({},o),{send_to:g});i("event",t,_)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function mN(){if(x2())try{await w2()}catch(i){return Nl.warn(_u.create("indexeddb-unavailable",{errorInfo:i?.toString()}).message),!1}else return Nl.warn(_u.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;return!0}async function gN(i,e,t,o,h,g,_){var u;const R=cN(i);R.then(Q=>{t[Q.measurementId]=Q.appId,i.options.measurementId&&Q.measurementId!==i.options.measurementId&&Nl.warn(`The measurement ID in the local Firebase config (${i.options.measurementId}) does not match the measurement ID fetched from the server (${Q.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(Q=>Nl.error(Q)),e.push(R);const O=mN().then(Q=>{if(Q)return o.getId()}),[G,ne]=await Promise.all([R,O]);rN(g)||Q5(g,G.measurementId),h("js",new Date);const re=(u=_?.config)!==null&&u!==void 0?u:{};return re[G5]="firebase",re.update=!0,ne!=null&&(re[q5]=ne),h("config",G.measurementId,re),G.measurementId}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let _N=class{constructor(e){this.app=e}_delete(){return delete hg[this.app.options.appId],Promise.resolve()}},hg={},j1=[];const $1={};let i0="dataLayer",yN="gtag",H1,GE,q1=!1;function vN(){const i=[];if(v2()&&i.push("This is a browser extension environment."),EA()||i.push("Cookies are not available."),i.length>0){const e=i.map((o,h)=>`(${h+1}) ${o}`).join(" "),t=_u.create("invalid-analytics-context",{errorInfo:e});Nl.warn(t.message)}}function xN(i,e,t){vN();const o=i.options.appId;if(!o)throw _u.create("no-app-id");if(!i.options.apiKey)if(i.options.measurementId)Nl.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${i.options.measurementId} provided in the "measurementId" field in the local Firebase config.`);else throw _u.create("no-api-key");if(hg[o]!=null)throw _u.create("already-exists",{id:o});if(!q1){J5(i0);const{wrappedGtag:g,gtagCore:_}=iN(hg,j1,$1,i0,yN);GE=g,H1=_,q1=!0}return hg[o]=gN(i,j1,$1,e,H1,i0,t),new _N(i)}function wN(i=ax()){i=Ol(i);const e=Bp(i,Sy);return e.isInitialized()?e.getImmediate():bN(i)}function bN(i,e={}){const t=Bp(i,Sy);if(t.isInitialized()){const h=t.getImmediate();if(gg(e,t.getOptions()))return h;throw _u.create("already-initialized")}return t.initialize({options:e})}function eh(i,e,t,o){i=Ol(i),fN(GE,hg[i.app.options.appId],e,t,o).catch(h=>Nl.error(h))}const G1="@firebase/analytics",Z1="0.10.11";function TN(){ph(new Sc(Sy,(e,{options:t})=>{const o=e.getProvider("app").getImmediate(),h=e.getProvider("installations-internal").getImmediate();return xN(o,h,t)},"PUBLIC")),ph(new Sc("analytics-internal",i,"PRIVATE")),Vu(G1,Z1),Vu(G1,Z1,"esm2017");function i(e){try{const t=e.getProvider(Sy).getImmediate();return{logEvent:(o,h,g)=>eh(t,o,h,g)}}catch(t){throw _u.create("interop-component-reg-failed",{reason:t})}}}TN();const SN={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_FIREBASE_API_KEY:"AIzaSyC5EgMfrRpFh8_ZFyQ_ieF-YYD9xPrOaVU",VITE_FIREBASE_APP_ID:"1:1016256516850:web:5b902e0616dfc3c926766b",VITE_FIREBASE_AUTH_DOMAIN:"redreport-29023.firebaseapp.com",VITE_FIREBASE_MEASUREMENT_ID:"G-S4C6LSBB9G",VITE_FIREBASE_MESSAGING_SENDER_ID:"1016256516850",VITE_FIREBASE_PROJECT_ID:"redreport-29023",VITE_FIREBASE_STORAGE_BUCKET:"redreport-29023.firebasestorage.app",VITE_MAP_KEY:"0UGrg19TXtYRROinsJ9a"},EN={apiKey:"AIzaSyC5EgMfrRpFh8_ZFyQ_ieF-YYD9xPrOaVU",authDomain:"redreport-29023.firebaseapp.com",projectId:"redreport-29023",storageBucket:"redreport-29023.firebasestorage.app",messagingSenderId:"1016256516850",appId:"1:1016256516850:web:5b902e0616dfc3c926766b",measurementId:"G-S4C6LSBB9G"},IN=["VITE_FIREBASE_API_KEY","VITE_FIREBASE_AUTH_DOMAIN","VITE_FIREBASE_PROJECT_ID"];IN.forEach(i=>{if(!SN[i])throw new Error(`Missing required environment variable: ${i}`)});const rw=E2(EN),Km=jL(rw);r5(rw);let ys=null;typeof window<"u"&&(ys=wN(rw));class Xm{static async withRetry(e,t=3,o=1e3){let h;for(let g=1;g<=t;g++)try{return await e()}catch(_){if(h=_,g===t)throw h;await new Promise(u=>setTimeout(u,o*Math.pow(2,g-1)))}throw h}static handleFirebaseError(e){switch(e.code){case"permission-denied":return"Access denied. Please check your permissions.";case"unavailable":return"Service temporarily unavailable. Please try again.";case"deadline-exceeded":return"Request timed out. Please try again.";case"not-found":return"The requested resource was not found.";case"already-exists":return"The resource already exists.";case"resource-exhausted":return"Service quota exceeded. Please try again later.";case"failed-precondition":return"Operation failed due to a precondition.";case"aborted":return"Operation was aborted.";case"out-of-range":return"Operation is out of valid range.";case"unimplemented":return"Operation is not implemented.";case"internal":return"Internal error occurred. Please try again.";case"unavailable":return"Service is currently unavailable.";case"data-loss":return"Data loss occurred.";case"unauthenticated":return"Authentication required.";default:return"An unexpected error occurred. Please try again."}}static isFirebaseError(e){return e&&typeof e.code=="string"&&typeof e.message=="string"}static logError(e,t){console.error(`Firebase Error in ${t}:`,{code:e.code,message:e.message,details:e.details,stack:e.stack})}}const Dw=class Dw{static async submitReport(e){return Xm.withRetry(async()=>(await aD(Wm(Km,this.COLLECTION_NAME),{...e,Time:b1(),createdAt:b1()})).id)}static async getReports(e=100){return Xm.withRetry(async()=>{const t=M_(Wm(Km,this.COLLECTION_NAME),R_("Time","desc"),eD(e));return(await D_(t)).docs.map(h=>{const g=h.data();return{id:h.id,Dorm:g.Dorm,Type:g.Type,Time:g.Time?.toDate()||new Date,hallData:g.hallData,userAgent:g.userAgent,timestamp:g.timestamp?.toDate()||g.Time?.toDate()||new Date,sessionId:g.sessionId,deviceInfo:g.deviceInfo,incidentDetails:g.incidentDetails}})})}static async getReportsByHall(e){return Xm.withRetry(async()=>{const t=M_(Wm(Km,this.COLLECTION_NAME),R_("Time","desc"));return(await D_(t)).docs.map(h=>{const g=h.data();return{id:h.id,Dorm:g.Dorm,Type:g.Type,Time:g.Time?.toDate()||new Date,hallData:g.hallData,userAgent:g.userAgent,timestamp:g.timestamp?.toDate()||g.Time?.toDate()||new Date,sessionId:g.sessionId,deviceInfo:g.deviceInfo,incidentDetails:g.incidentDetails}}).filter(h=>h.Dorm===e)})}static async getReportsByType(e){return Xm.withRetry(async()=>{const t=M_(Wm(Km,this.COLLECTION_NAME),R_("Time","desc"));return(await D_(t)).docs.map(h=>{const g=h.data();return{id:h.id,Dorm:g.Dorm,Type:g.Type,Time:g.Time?.toDate()||new Date,hallData:g.hallData,userAgent:g.userAgent,timestamp:g.timestamp?.toDate()||g.Time?.toDate()||new Date,sessionId:g.sessionId,deviceInfo:g.deviceInfo,incidentDetails:g.incidentDetails}}).filter(h=>h.Type===e)})}static async getReportsByBuildingType(e){return Xm.withRetry(async()=>{const t=M_(Wm(Km,this.COLLECTION_NAME),R_("Time","desc"));return(await D_(t)).docs.map(h=>{const g=h.data();return{id:h.id,Dorm:g.Dorm,Type:g.Type,Time:g.Time?.toDate()||new Date,hallData:g.hallData,userAgent:g.userAgent,timestamp:g.timestamp?.toDate()||g.Time?.toDate()||new Date,sessionId:g.sessionId,deviceInfo:g.deviceInfo,incidentDetails:g.incidentDetails}}).filter(h=>h.hallData?.buildingType===e)})}};Dw.COLLECTION_NAME="Test";let Ey=Dw;class ig{static logReportSubmission(e,t,o,h){ys&&eh(ys,"report_submitted",{hall_name:e,incident_type:t,building_type:o?.buildingType||"Unknown",location:o?.location||"Unknown",platform:h?.platform||"Unknown",browser:h?.browser||"Unknown",screen_resolution:h?.screenResolution||"Unknown",timestamp:new Date().toISOString()})}static logMapView(){ys&&eh(ys,"map_viewed",{timestamp:new Date().toISOString()})}static logError(e,t){ys&&eh(ys,"error_occurred",{error_message:e,context:t||"general",timestamp:new Date().toISOString()})}static logHallSelection(e,t){ys&&eh(ys,"hall_selected",{hall_name:e,building_type:t,timestamp:new Date().toISOString()})}static logTypeSelection(e,t){ys&&eh(ys,"type_selected",{type_id:e,type_name:t,timestamp:new Date().toISOString()})}static logSessionStart(e,t){ys&&eh(ys,"session_started",{session_id:e,platform:t?.platform||"Unknown",browser:t?.browser||"Unknown",language:t?.language||"Unknown",timezone:t?.timezone||"Unknown",timestamp:new Date().toISOString()})}static logIncidentSeverity(e,t){ys&&eh(ys,"incident_severity",{severity_level:e,incident_type:t,timestamp:new Date().toISOString()})}static logBuildingTypeAnalysis(e,t){ys&&eh(ys,"building_type_analysis",{building_type:e,incident_count:t,timestamp:new Date().toISOString()})}static logGeographicAnalysis(e,t,o){ys&&eh(ys,"geographic_analysis",{location:e,latitude:t,longitude:o,timestamp:new Date().toISOString()})}}function PN(){return`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}function CN(){const i=navigator.userAgent;let e="Unknown";i.includes("Chrome")?e="Chrome":i.includes("Firefox")?e="Firefox":i.includes("Safari")?e="Safari":i.includes("Edge")&&(e="Edge");let t="Unknown";return i.includes("Windows")?t="Windows":i.includes("Mac")?t="Mac":i.includes("Linux")?t="Linux":i.includes("Android")?t="Android":i.includes("iOS")&&(t="iOS"),{platform:t,browser:e,screenResolution:`${screen.width}x${screen.height}`,userAgent:i,language:navigator.language,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,viewport:{width:window.innerWidth,height:window.innerHeight}}}function AN(){return{sessionId:PN(),timestamp:new Date,deviceInfo:CN()}}function kN(i){return["Uncomfortable Situation","Sexual Misconduct","Physical Aggression","Verbal Aggression","Discrimination"][i]||"Unknown"}function W1({onHallSelect:i,onTypeSelect:e,onSubmit:t}){const o=r2(),[h,g]=It.useState(""),[_,u]=It.useState(),[R,O]=It.useState(!1),[G,ne]=It.useState(!1);var re=[],Q=!0,de=$v.map(te=>te.name);function Se(te,pe,xe){const Ae=document.createElement("div");Ae.id=te;const $e=$v.find(Ce=>Ce.name===te);Ae.innerHTML=`${te} (${$e?.buildingType||"Unknown"})`,Ae.onclick=()=>{for(xe.value=te,g(te),vt(),i?.(te),ig.logHallSelection(te,$e?.buildingType||"Unknown");pe?.firstChild;)pe.firstChild.remove()},pe?.appendChild(Ae)}function De(){var te=document.getElementById("list");if(re.length==de.length||G){for(console.log("Deleting");te?.firstChild;)te.firstChild.remove();re=[]}}function Ke(te){var pe=document.getElementById("list");if(Q==!0)for(Q=!1;pe?.firstChild;)pe.firstChild.remove();for(var xe of de)te.value.length==0&&!re.includes(xe)&&(re.push(xe),Se(xe,pe,te))}function et(te){ne(!1),te.classList.remove("completehall");var pe=te.value.replace(/[^a-zA-Z0-9]/g,""),xe=document.getElementById("list");for(re=[],console.log(re);xe?.children.length!=0;)xe?.firstChild?.remove();for(var Ae of de){var $e=!0,Ce=!0,pn=Ae.replace(/[^a-zA-Z0-9]/g,"");for(let ri=0;ri<pe.length;ri++)pe.length>pn.length||pe[ri].toLocaleLowerCase()!=pn[ri].toLocaleLowerCase()?($e=!1,Ce=!1):(pe.length<pn.length||pe[ri].toLocaleLowerCase()!=pn[ri].toLocaleLowerCase())&&(Ce=!1);pe.length==0&&(Ce=!1),$e==!0&&re.push(Ae),Ce==!0&&vt()}for(var Ae of re)xe?.children.namedItem(Ae)==null&&Se(Ae,xe,te)}function vt(te){var pe=document.getElementById("report");pe?.classList.add("completehall"),ne(!0),console.log("Ran")}const Ye=async te=>{if(!G){alert("No Hall Selected");return}if(_===void 0){alert("Please select an incident type");return}try{const pe=$v.find(Ce=>Ce.name===te),xe=Jm.find(Ce=>Ce.name===te),Ae=AN(),$e={Dorm:te,Type:_,hallData:pe?{name:pe.name,location:pe.location,buildingType:pe.buildingType,latitude:xe?.latitude,longitude:xe?.longitude}:void 0,userAgent:Ae.deviceInfo.userAgent,timestamp:Ae.timestamp,sessionId:Ae.sessionId,deviceInfo:{platform:Ae.deviceInfo.platform,browser:Ae.deviceInfo.browser,screenResolution:Ae.deviceInfo.screenResolution},incidentDetails:{typeName:kN(_)}};t?.($e),await Ey.submitReport($e),ig.logReportSubmission(te,_,pe,Ae.deviceInfo),ig.logGeographicAnalysis(pe?.location||"Unknown",xe?.latitude,xe?.longitude),o("/map")}catch(pe){console.error("Error submitting report:",pe),alert("Error submitting report. Please try again.")}};function it(te){var pe=te.ownerDocument.getElementsByClassName("overlay");for(const xe of pe)xe.classList.replace("animate__fadeIn","animate__fadeOut"),xe.classList.replace("animate__fadeInDown","animate__fadeOut")}function at(te){var pe=te.ownerDocument.getElementsByClassName("overlay");for(const xe of pe)xe.classList.replace("animate__fadeOut","animate__fadeIn"),xe.classList.add("animate__fadeInDown")}const be=(te,pe)=>{u(te),e?.(te),ig.logTypeSelection(te,pe)};return Kt.createElement(Kt.Fragment,null,Kt.createElement("div",{id:"underlay",className:"underlay"}),Kt.createElement("div",{id:"overlay",className:"animate__animated animate__fadeIn overlay cont",onMouseUp:te=>{it(te.currentTarget)},onTouchEnd:te=>{it(te.currentTarget)}},Kt.createElement("div",{className:"animate__animated animate__fadeInDown animate__delay-1s col"},Kt.createElement("h3",{className:"xxlarge"},Kt.createElement("b",{className:"red"},"Redreport")," ND Campus Safety Tool",Kt.createElement("b",{className:"red"}," Instructions")),Kt.createElement("p",{className:"small"},Kt.createElement("i",null,"You don't need to suffer alone")),Kt.createElement("h6",{className:"small"},"Click anywhere to access the form"),Kt.createElement("div",{className:"jus-center m-2"},Kt.createElement("div",{className:"chatbubble bubble small flip animate__animated animate__fadeInDown animate__delay-2s"},"Enter a HCC/ND/SMC campus location"),Kt.createElement("input",{type:"text",className:"w-50"})),Kt.createElement("div",{className:"just-cent"},Kt.createElement("div",{className:"chatbubble bubble small animate__animated animate__fadeInDown animate__delay-2s"},"Pick the appropiate option"),Kt.createElement("button",{className:"button yellowbg"}),Kt.createElement("button",{className:"button redbg"}),Kt.createElement("button",{className:"button bluebg"}),Kt.createElement("button",{className:"button purplebg"}),Kt.createElement("button",{className:"button blackbg"})))),Kt.createElement("div",{className:"cont"},Kt.createElement("div",{className:"just-cent"},Kt.createElement("div",{onClick:te=>{at(te.currentTarget)},className:"circle"})),Kt.createElement("div",null,Kt.createElement("label",{htmlFor:"report",id:"DormQ"},Kt.createElement("b",null,"Where did you feel unsafe?")),Kt.createElement("h6",null,"Enter a campus location"),Kt.createElement("input",{id:"report",type:"text",name:"report",placeholder:"Alumni",onClick:te=>{Ke(te.currentTarget)},onInputCapture:te=>{et(te.currentTarget)}}),Kt.createElement("div",{className:"just-cent h-100"},Kt.createElement("div",{id:"list",className:"autocomplete-items"}))),Kt.createElement("div",{className:"autocomplete",onMouseDown:()=>{De()}}),Kt.createElement("div",{className:"mt-2"},Kt.createElement("button",{className:"button yellowbg base",onClick:te=>{te.currentTarget.focus(),be(0,"Uncomfortable Situation")}},"Uncomfortable Situation"),Kt.createElement("button",{className:"button redbg base",onClick:te=>{te.currentTarget.focus(),be(1,"Sexual Misconduct")}},"Sexual Misconduct"),Kt.createElement("button",{className:"button purplebg base",onClick:te=>{te.currentTarget.focus(),be(2,"Physical Aggression")}},"Physical Aggression"),Kt.createElement("button",{className:"button bluebg base",onClick:te=>{te.currentTarget.focus(),be(3,"Verbal Aggression")}},"Verbal Aggression"),Kt.createElement("button",{className:"button blackbg base",onClick:te=>{te.currentTarget.focus(),be(4,"Discrimination")}},"Discrimination")),Kt.createElement("button",{className:"submit button base w-50 borderred whitebg black",onClick:()=>{Ye(h)}},"Submit")))}var rg={exports:{}};/* @preserve
 * Leaflet 1.9.4, a JS library for interactive maps. https://leafletjs.com
 * (c) 2010-2023 Vladimir Agafonkin, (c) 2010-2011 CloudMade
 */var MN=rg.exports,K1;function RN(){return K1||(K1=1,function(i,e){(function(t,o){o(e)})(MN,function(t){var o="1.9.4";function h(d){var x,A,F,Z;for(A=1,F=arguments.length;A<F;A++){Z=arguments[A];for(x in Z)d[x]=Z[x]}return d}var g=Object.create||function(){function d(){}return function(x){return d.prototype=x,new d}}();function _(d,x){var A=Array.prototype.slice;if(d.bind)return d.bind.apply(d,A.call(arguments,1));var F=A.call(arguments,2);return function(){return d.apply(x,F.length?F.concat(A.call(arguments)):arguments)}}var u=0;function R(d){return"_leaflet_id"in d||(d._leaflet_id=++u),d._leaflet_id}function O(d,x,A){var F,Z,he,Oe;return Oe=function(){F=!1,Z&&(he.apply(A,Z),Z=!1)},he=function(){F?Z=arguments:(d.apply(A,arguments),setTimeout(Oe,x),F=!0)},he}function G(d,x,A){var F=x[1],Z=x[0],he=F-Z;return d===F&&A?d:((d-Z)%he+he)%he+Z}function ne(){return!1}function re(d,x){if(x===!1)return d;var A=Math.pow(10,x===void 0?6:x);return Math.round(d*A)/A}function Q(d){return d.trim?d.trim():d.replace(/^\s+|\s+$/g,"")}function de(d){return Q(d).split(/\s+/)}function Se(d,x){Object.prototype.hasOwnProperty.call(d,"options")||(d.options=d.options?g(d.options):{});for(var A in x)d.options[A]=x[A];return d.options}function De(d,x,A){var F=[];for(var Z in d)F.push(encodeURIComponent(A?Z.toUpperCase():Z)+"="+encodeURIComponent(d[Z]));return(!x||x.indexOf("?")===-1?"?":"&")+F.join("&")}var Ke=/\{ *([\w_ -]+) *\}/g;function et(d,x){return d.replace(Ke,function(A,F){var Z=x[F];if(Z===void 0)throw new Error("No value provided for variable "+A);return typeof Z=="function"&&(Z=Z(x)),Z})}var vt=Array.isArray||function(d){return Object.prototype.toString.call(d)==="[object Array]"};function Ye(d,x){for(var A=0;A<d.length;A++)if(d[A]===x)return A;return-1}var it="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function at(d){return window["webkit"+d]||window["moz"+d]||window["ms"+d]}var be=0;function te(d){var x=+new Date,A=Math.max(0,16-(x-be));return be=x+A,window.setTimeout(d,A)}var pe=window.requestAnimationFrame||at("RequestAnimationFrame")||te,xe=window.cancelAnimationFrame||at("CancelAnimationFrame")||at("CancelRequestAnimationFrame")||function(d){window.clearTimeout(d)};function Ae(d,x,A){if(A&&pe===te)d.call(x);else return pe.call(window,_(d,x))}function $e(d){d&&xe.call(window,d)}var Ce={__proto__:null,extend:h,create:g,bind:_,get lastId(){return u},stamp:R,throttle:O,wrapNum:G,falseFn:ne,formatNum:re,trim:Q,splitWords:de,setOptions:Se,getParamString:De,template:et,isArray:vt,indexOf:Ye,emptyImageUrl:it,requestFn:pe,cancelFn:xe,requestAnimFrame:Ae,cancelAnimFrame:$e};function pn(){}pn.extend=function(d){var x=function(){Se(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},A=x.__super__=this.prototype,F=g(A);F.constructor=x,x.prototype=F;for(var Z in this)Object.prototype.hasOwnProperty.call(this,Z)&&Z!=="prototype"&&Z!=="__super__"&&(x[Z]=this[Z]);return d.statics&&h(x,d.statics),d.includes&&(ri(d.includes),h.apply(null,[F].concat(d.includes))),h(F,d),delete F.statics,delete F.includes,F.options&&(F.options=A.options?g(A.options):{},h(F.options,d.options)),F._initHooks=[],F.callInitHooks=function(){if(!this._initHooksCalled){A.callInitHooks&&A.callInitHooks.call(this),this._initHooksCalled=!0;for(var he=0,Oe=F._initHooks.length;he<Oe;he++)F._initHooks[he].call(this)}},x},pn.include=function(d){var x=this.prototype.options;return h(this.prototype,d),d.options&&(this.prototype.options=x,this.mergeOptions(d.options)),this},pn.mergeOptions=function(d){return h(this.prototype.options,d),this},pn.addInitHook=function(d){var x=Array.prototype.slice.call(arguments,1),A=typeof d=="function"?d:function(){this[d].apply(this,x)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(A),this};function ri(d){if(!(typeof L>"u"||!L||!L.Mixin)){d=vt(d)?d:[d];for(var x=0;x<d.length;x++)d[x]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",new Error().stack)}}var dn={on:function(d,x,A){if(typeof d=="object")for(var F in d)this._on(F,d[F],x);else{d=de(d);for(var Z=0,he=d.length;Z<he;Z++)this._on(d[Z],x,A)}return this},off:function(d,x,A){if(!arguments.length)delete this._events;else if(typeof d=="object")for(var F in d)this._off(F,d[F],x);else{d=de(d);for(var Z=arguments.length===1,he=0,Oe=d.length;he<Oe;he++)Z?this._off(d[he]):this._off(d[he],x,A)}return this},_on:function(d,x,A,F){if(typeof x!="function"){console.warn("wrong listener type: "+typeof x);return}if(this._listens(d,x,A)===!1){A===this&&(A=void 0);var Z={fn:x,ctx:A};F&&(Z.once=!0),this._events=this._events||{},this._events[d]=this._events[d]||[],this._events[d].push(Z)}},_off:function(d,x,A){var F,Z,he;if(this._events&&(F=this._events[d],!!F)){if(arguments.length===1){if(this._firingCount)for(Z=0,he=F.length;Z<he;Z++)F[Z].fn=ne;delete this._events[d];return}if(typeof x!="function"){console.warn("wrong listener type: "+typeof x);return}var Oe=this._listens(d,x,A);if(Oe!==!1){var rt=F[Oe];this._firingCount&&(rt.fn=ne,this._events[d]=F=F.slice()),F.splice(Oe,1)}}},fire:function(d,x,A){if(!this.listens(d,A))return this;var F=h({},x,{type:d,target:this,sourceTarget:x&&x.sourceTarget||this});if(this._events){var Z=this._events[d];if(Z){this._firingCount=this._firingCount+1||1;for(var he=0,Oe=Z.length;he<Oe;he++){var rt=Z[he],dt=rt.fn;rt.once&&this.off(d,dt,rt.ctx),dt.call(rt.ctx||this,F)}this._firingCount--}}return A&&this._propagateEvent(F),this},listens:function(d,x,A,F){typeof d!="string"&&console.warn('"string" type argument expected');var Z=x;typeof x!="function"&&(F=!!x,Z=void 0,A=void 0);var he=this._events&&this._events[d];if(he&&he.length&&this._listens(d,Z,A)!==!1)return!0;if(F){for(var Oe in this._eventParents)if(this._eventParents[Oe].listens(d,x,A,F))return!0}return!1},_listens:function(d,x,A){if(!this._events)return!1;var F=this._events[d]||[];if(!x)return!!F.length;A===this&&(A=void 0);for(var Z=0,he=F.length;Z<he;Z++)if(F[Z].fn===x&&F[Z].ctx===A)return Z;return!1},once:function(d,x,A){if(typeof d=="object")for(var F in d)this._on(F,d[F],x,!0);else{d=de(d);for(var Z=0,he=d.length;Z<he;Z++)this._on(d[Z],x,A,!0)}return this},addEventParent:function(d){return this._eventParents=this._eventParents||{},this._eventParents[R(d)]=d,this},removeEventParent:function(d){return this._eventParents&&delete this._eventParents[R(d)],this},_propagateEvent:function(d){for(var x in this._eventParents)this._eventParents[x].fire(d.type,h({layer:d.target,propagatedFrom:d.target},d),!0)}};dn.addEventListener=dn.on,dn.removeEventListener=dn.clearAllEventListeners=dn.off,dn.addOneTimeEventListener=dn.once,dn.fireEvent=dn.fire,dn.hasEventListeners=dn.listens;var jn=pn.extend(dn);function Tt(d,x,A){this.x=A?Math.round(d):d,this.y=A?Math.round(x):x}var gn=Math.trunc||function(d){return d>0?Math.floor(d):Math.ceil(d)};Tt.prototype={clone:function(){return new Tt(this.x,this.y)},add:function(d){return this.clone()._add(St(d))},_add:function(d){return this.x+=d.x,this.y+=d.y,this},subtract:function(d){return this.clone()._subtract(St(d))},_subtract:function(d){return this.x-=d.x,this.y-=d.y,this},divideBy:function(d){return this.clone()._divideBy(d)},_divideBy:function(d){return this.x/=d,this.y/=d,this},multiplyBy:function(d){return this.clone()._multiplyBy(d)},_multiplyBy:function(d){return this.x*=d,this.y*=d,this},scaleBy:function(d){return new Tt(this.x*d.x,this.y*d.y)},unscaleBy:function(d){return new Tt(this.x/d.x,this.y/d.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=gn(this.x),this.y=gn(this.y),this},distanceTo:function(d){d=St(d);var x=d.x-this.x,A=d.y-this.y;return Math.sqrt(x*x+A*A)},equals:function(d){return d=St(d),d.x===this.x&&d.y===this.y},contains:function(d){return d=St(d),Math.abs(d.x)<=Math.abs(this.x)&&Math.abs(d.y)<=Math.abs(this.y)},toString:function(){return"Point("+re(this.x)+", "+re(this.y)+")"}};function St(d,x,A){return d instanceof Tt?d:vt(d)?new Tt(d[0],d[1]):d==null?d:typeof d=="object"&&"x"in d&&"y"in d?new Tt(d.x,d.y):new Tt(d,x,A)}function Ze(d,x){if(d)for(var A=x?[d,x]:d,F=0,Z=A.length;F<Z;F++)this.extend(A[F])}Ze.prototype={extend:function(d){var x,A;if(!d)return this;if(d instanceof Tt||typeof d[0]=="number"||"x"in d)x=A=St(d);else if(d=wt(d),x=d.min,A=d.max,!x||!A)return this;return!this.min&&!this.max?(this.min=x.clone(),this.max=A.clone()):(this.min.x=Math.min(x.x,this.min.x),this.max.x=Math.max(A.x,this.max.x),this.min.y=Math.min(x.y,this.min.y),this.max.y=Math.max(A.y,this.max.y)),this},getCenter:function(d){return St((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,d)},getBottomLeft:function(){return St(this.min.x,this.max.y)},getTopRight:function(){return St(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(d){var x,A;return typeof d[0]=="number"||d instanceof Tt?d=St(d):d=wt(d),d instanceof Ze?(x=d.min,A=d.max):x=A=d,x.x>=this.min.x&&A.x<=this.max.x&&x.y>=this.min.y&&A.y<=this.max.y},intersects:function(d){d=wt(d);var x=this.min,A=this.max,F=d.min,Z=d.max,he=Z.x>=x.x&&F.x<=A.x,Oe=Z.y>=x.y&&F.y<=A.y;return he&&Oe},overlaps:function(d){d=wt(d);var x=this.min,A=this.max,F=d.min,Z=d.max,he=Z.x>x.x&&F.x<A.x,Oe=Z.y>x.y&&F.y<A.y;return he&&Oe},isValid:function(){return!!(this.min&&this.max)},pad:function(d){var x=this.min,A=this.max,F=Math.abs(x.x-A.x)*d,Z=Math.abs(x.y-A.y)*d;return wt(St(x.x-F,x.y-Z),St(A.x+F,A.y+Z))},equals:function(d){return d?(d=wt(d),this.min.equals(d.getTopLeft())&&this.max.equals(d.getBottomRight())):!1}};function wt(d,x){return!d||d instanceof Ze?d:new Ze(d,x)}function Qt(d,x){if(d)for(var A=x?[d,x]:d,F=0,Z=A.length;F<Z;F++)this.extend(A[F])}Qt.prototype={extend:function(d){var x=this._southWest,A=this._northEast,F,Z;if(d instanceof Xt)F=d,Z=d;else if(d instanceof Qt){if(F=d._southWest,Z=d._northEast,!F||!Z)return this}else return d?this.extend(nn(d)||sn(d)):this;return!x&&!A?(this._southWest=new Xt(F.lat,F.lng),this._northEast=new Xt(Z.lat,Z.lng)):(x.lat=Math.min(F.lat,x.lat),x.lng=Math.min(F.lng,x.lng),A.lat=Math.max(Z.lat,A.lat),A.lng=Math.max(Z.lng,A.lng)),this},pad:function(d){var x=this._southWest,A=this._northEast,F=Math.abs(x.lat-A.lat)*d,Z=Math.abs(x.lng-A.lng)*d;return new Qt(new Xt(x.lat-F,x.lng-Z),new Xt(A.lat+F,A.lng+Z))},getCenter:function(){return new Xt((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new Xt(this.getNorth(),this.getWest())},getSouthEast:function(){return new Xt(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(d){typeof d[0]=="number"||d instanceof Xt||"lat"in d?d=nn(d):d=sn(d);var x=this._southWest,A=this._northEast,F,Z;return d instanceof Qt?(F=d.getSouthWest(),Z=d.getNorthEast()):F=Z=d,F.lat>=x.lat&&Z.lat<=A.lat&&F.lng>=x.lng&&Z.lng<=A.lng},intersects:function(d){d=sn(d);var x=this._southWest,A=this._northEast,F=d.getSouthWest(),Z=d.getNorthEast(),he=Z.lat>=x.lat&&F.lat<=A.lat,Oe=Z.lng>=x.lng&&F.lng<=A.lng;return he&&Oe},overlaps:function(d){d=sn(d);var x=this._southWest,A=this._northEast,F=d.getSouthWest(),Z=d.getNorthEast(),he=Z.lat>x.lat&&F.lat<A.lat,Oe=Z.lng>x.lng&&F.lng<A.lng;return he&&Oe},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(d,x){return d?(d=sn(d),this._southWest.equals(d.getSouthWest(),x)&&this._northEast.equals(d.getNorthEast(),x)):!1},isValid:function(){return!!(this._southWest&&this._northEast)}};function sn(d,x){return d instanceof Qt?d:new Qt(d,x)}function Xt(d,x,A){if(isNaN(d)||isNaN(x))throw new Error("Invalid LatLng object: ("+d+", "+x+")");this.lat=+d,this.lng=+x,A!==void 0&&(this.alt=+A)}Xt.prototype={equals:function(d,x){if(!d)return!1;d=nn(d);var A=Math.max(Math.abs(this.lat-d.lat),Math.abs(this.lng-d.lng));return A<=(x===void 0?1e-9:x)},toString:function(d){return"LatLng("+re(this.lat,d)+", "+re(this.lng,d)+")"},distanceTo:function(d){return $n.distance(this,nn(d))},wrap:function(){return $n.wrapLatLng(this)},toBounds:function(d){var x=180*d/40075017,A=x/Math.cos(Math.PI/180*this.lat);return sn([this.lat-x,this.lng-A],[this.lat+x,this.lng+A])},clone:function(){return new Xt(this.lat,this.lng,this.alt)}};function nn(d,x,A){return d instanceof Xt?d:vt(d)&&typeof d[0]!="object"?d.length===3?new Xt(d[0],d[1],d[2]):d.length===2?new Xt(d[0],d[1]):null:d==null?d:typeof d=="object"&&"lat"in d?new Xt(d.lat,"lng"in d?d.lng:d.lon,d.alt):x===void 0?null:new Xt(d,x,A)}var Fn={latLngToPoint:function(d,x){var A=this.projection.project(d),F=this.scale(x);return this.transformation._transform(A,F)},pointToLatLng:function(d,x){var A=this.scale(x),F=this.transformation.untransform(d,A);return this.projection.unproject(F)},project:function(d){return this.projection.project(d)},unproject:function(d){return this.projection.unproject(d)},scale:function(d){return 256*Math.pow(2,d)},zoom:function(d){return Math.log(d/256)/Math.LN2},getProjectedBounds:function(d){if(this.infinite)return null;var x=this.projection.bounds,A=this.scale(d),F=this.transformation.transform(x.min,A),Z=this.transformation.transform(x.max,A);return new Ze(F,Z)},infinite:!1,wrapLatLng:function(d){var x=this.wrapLng?G(d.lng,this.wrapLng,!0):d.lng,A=this.wrapLat?G(d.lat,this.wrapLat,!0):d.lat,F=d.alt;return new Xt(A,x,F)},wrapLatLngBounds:function(d){var x=d.getCenter(),A=this.wrapLatLng(x),F=x.lat-A.lat,Z=x.lng-A.lng;if(F===0&&Z===0)return d;var he=d.getSouthWest(),Oe=d.getNorthEast(),rt=new Xt(he.lat-F,he.lng-Z),dt=new Xt(Oe.lat-F,Oe.lng-Z);return new Qt(rt,dt)}},$n=h({},Fn,{wrapLng:[-180,180],R:6371e3,distance:function(d,x){var A=Math.PI/180,F=d.lat*A,Z=x.lat*A,he=Math.sin((x.lat-d.lat)*A/2),Oe=Math.sin((x.lng-d.lng)*A/2),rt=he*he+Math.cos(F)*Math.cos(Z)*Oe*Oe,dt=2*Math.atan2(Math.sqrt(rt),Math.sqrt(1-rt));return this.R*dt}}),Jn=6378137,ur={R:Jn,MAX_LATITUDE:85.0511287798,project:function(d){var x=Math.PI/180,A=this.MAX_LATITUDE,F=Math.max(Math.min(A,d.lat),-A),Z=Math.sin(F*x);return new Tt(this.R*d.lng*x,this.R*Math.log((1+Z)/(1-Z))/2)},unproject:function(d){var x=180/Math.PI;return new Xt((2*Math.atan(Math.exp(d.y/this.R))-Math.PI/2)*x,d.x*x/this.R)},bounds:function(){var d=Jn*Math.PI;return new Ze([-d,-d],[d,d])}()};function Ji(d,x,A,F){if(vt(d)){this._a=d[0],this._b=d[1],this._c=d[2],this._d=d[3];return}this._a=d,this._b=x,this._c=A,this._d=F}Ji.prototype={transform:function(d,x){return this._transform(d.clone(),x)},_transform:function(d,x){return x=x||1,d.x=x*(this._a*d.x+this._b),d.y=x*(this._c*d.y+this._d),d},untransform:function(d,x){return x=x||1,new Tt((d.x/x-this._b)/this._a,(d.y/x-this._d)/this._c)}};function Ui(d,x,A,F){return new Ji(d,x,A,F)}var Hr=h({},$n,{code:"EPSG:3857",projection:ur,transformation:function(){var d=.5/(Math.PI*ur.R);return Ui(d,.5,-d,.5)}()}),Wi=h({},Hr,{code:"EPSG:900913"});function Qo(d){return document.createElementNS("http://www.w3.org/2000/svg",d)}function bs(d,x){var A="",F,Z,he,Oe,rt,dt;for(F=0,he=d.length;F<he;F++){for(rt=d[F],Z=0,Oe=rt.length;Z<Oe;Z++)dt=rt[Z],A+=(Z?"L":"M")+dt.x+" "+dt.y;A+=x?Lt.svg?"z":"x":""}return A||"M0 0"}var Qr=document.documentElement.style,Oo="ActiveXObject"in window,Jo=Oo&&!document.addEventListener,vr="msLaunchUri"in navigator&&!("documentMode"in document),Jr=$t("webkit"),Ts=$t("android"),Fo=$t("android 2")||$t("android 3"),_a=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),Hs=Ts&&$t("Google")&&_a<537&&!("AudioNode"in window),Mi=!!window.opera,er=!vr&&$t("chrome"),qr=$t("gecko")&&!Jr&&!Mi&&!Oo,qs=!er&&$t("safari"),uo=$t("phantom"),es="OTransition"in Qr,Ss=navigator.platform.indexOf("Win")===0,ya=Oo&&"transition"in Qr,Bo="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!Fo,ve="MozPerspective"in Qr,se=!window.L_DISABLE_3D&&(ya||Bo||ve)&&!es&&!uo,ce=typeof orientation<"u"||$t("mobile"),fe=ce&&Jr,Pe=ce&&Bo,Be=!window.PointerEvent&&window.MSPointerEvent,qe=!!(window.PointerEvent||Be),tt="ontouchstart"in window||!!window.TouchEvent,Ge=!window.L_NO_TOUCH&&(tt||qe),ht=ce&&Mi,ut=ce&&qr,Xe=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,Ue=function(){var d=!1;try{var x=Object.defineProperty({},"passive",{get:function(){d=!0}});window.addEventListener("testPassiveEventSupport",ne,x),window.removeEventListener("testPassiveEventSupport",ne,x)}catch{}return d}(),zt=function(){return!!document.createElement("canvas").getContext}(),Nt=!!(document.createElementNS&&Qo("svg").createSVGRect),en=!!Nt&&function(){var d=document.createElement("div");return d.innerHTML="<svg/>",(d.firstChild&&d.firstChild.namespaceURI)==="http://www.w3.org/2000/svg"}(),Pn=!Nt&&function(){try{var d=document.createElement("div");d.innerHTML='<v:shape adj="1"/>';var x=d.firstChild;return x.style.behavior="url(#default#VML)",x&&typeof x.adj=="object"}catch{return!1}}(),mt=navigator.platform.indexOf("Mac")===0,Vt=navigator.platform.indexOf("Linux")===0;function $t(d){return navigator.userAgent.toLowerCase().indexOf(d)>=0}var Lt={ie:Oo,ielt9:Jo,edge:vr,webkit:Jr,android:Ts,android23:Fo,androidStock:Hs,opera:Mi,chrome:er,gecko:qr,safari:qs,phantom:uo,opera12:es,win:Ss,ie3d:ya,webkit3d:Bo,gecko3d:ve,any3d:se,mobile:ce,mobileWebkit:fe,mobileWebkit3d:Pe,msPointer:Be,pointer:qe,touch:Ge,touchNative:tt,mobileOpera:ht,mobileGecko:ut,retina:Xe,passiveEvents:Ue,canvas:zt,svg:Nt,vml:Pn,inlineSvg:en,mac:mt,linux:Vt},Nn=Lt.msPointer?"MSPointerDown":"pointerdown",mn=Lt.msPointer?"MSPointerMove":"pointermove",Yt=Lt.msPointer?"MSPointerUp":"pointerup",Ri=Lt.msPointer?"MSPointerCancel":"pointercancel",ts={touchstart:Nn,touchmove:mn,touchend:Yt,touchcancel:Ri},Si={touchstart:Ki,touchmove:Es,touchend:Es,touchcancel:Es},xi={},oi=!1;function co(d,x,A){return x==="touchstart"&&xa(),Si[x]?(A=Si[x].bind(this,A),d.addEventListener(ts[x],A,!1),A):(console.warn("wrong event specified:",x),ne)}function Li(d,x,A){if(!ts[x]){console.warn("wrong event specified:",x);return}d.removeEventListener(ts[x],A,!1)}function va(d){xi[d.pointerId]=d}function Gs(d){xi[d.pointerId]&&(xi[d.pointerId]=d)}function ul(d){delete xi[d.pointerId]}function xa(){oi||(document.addEventListener(Nn,va,!0),document.addEventListener(mn,Gs,!0),document.addEventListener(Yt,ul,!0),document.addEventListener(Ri,ul,!0),oi=!0)}function Es(d,x){if(x.pointerType!==(x.MSPOINTER_TYPE_MOUSE||"mouse")){x.touches=[];for(var A in xi)x.touches.push(xi[A]);x.changedTouches=[x],d(x)}}function Ki(d,x){x.MSPOINTER_TYPE_TOUCH&&x.pointerType===x.MSPOINTER_TYPE_TOUCH&&gi(x),Es(d,x)}function yu(d){var x={},A,F;for(F in d)A=d[F],x[F]=A&&A.bind?A.bind(d):A;return d=x,x.type="dblclick",x.detail=2,x.isTrusted=!1,x._simulated=!0,x}var cl=200;function ns(d,x){d.addEventListener("dblclick",x);var A=0,F;function Z(he){if(he.detail!==1){F=he.detail;return}if(!(he.pointerType==="mouse"||he.sourceCapabilities&&!he.sourceCapabilities.firesTouchEvents)){var Oe=Vo(he);if(!(Oe.some(function(dt){return dt instanceof HTMLLabelElement&&dt.attributes.for})&&!Oe.some(function(dt){return dt instanceof HTMLInputElement||dt instanceof HTMLSelectElement}))){var rt=Date.now();rt-A<=cl?(F++,F===2&&x(yu(he))):F=1,A=rt}}}return d.addEventListener("click",Z),{dblclick:x,simDblclick:Z}}function is(d,x){d.removeEventListener("dblclick",x.dblclick),d.removeEventListener("click",x.simDblclick)}var Fl=kn(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),hl=kn(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),dl=hl==="webkitTransition"||hl==="OTransition"?hl+"End":"transitionend";function bo(d){return typeof d=="string"?document.getElementById(d):d}function wa(d,x){var A=d.style[x]||d.currentStyle&&d.currentStyle[x];if((!A||A==="auto")&&document.defaultView){var F=document.defaultView.getComputedStyle(d,null);A=F?F[x]:null}return A==="auto"?null:A}function An(d,x,A){var F=document.createElement(d);return F.className=x||"",A&&A.appendChild(F),F}function Di(d){var x=d.parentNode;x&&x.removeChild(d)}function pl(d){for(;d.firstChild;)d.removeChild(d.firstChild)}function To(d){var x=d.parentNode;x&&x.lastChild!==d&&x.appendChild(d)}function rs(d){var x=d.parentNode;x&&x.firstChild!==d&&x.insertBefore(d,x.firstChild)}function Zs(d,x){if(d.classList!==void 0)return d.classList.contains(x);var A=Sr(d);return A.length>0&&new RegExp("(^|\\s)"+x+"(\\s|$)").test(A)}function Dn(d,x){if(d.classList!==void 0)for(var A=de(x),F=0,Z=A.length;F<Z;F++)d.classList.add(A[F]);else if(!Zs(d,x)){var he=Sr(d);Bl(d,(he?he+" ":"")+x)}}function fi(d,x){d.classList!==void 0?d.classList.remove(x):Bl(d,Q((" "+Sr(d)+" ").replace(" "+x+" "," ")))}function Bl(d,x){d.className.baseVal===void 0?d.className=x:d.className.baseVal=x}function Sr(d){return d.correspondingElement&&(d=d.correspondingElement),d.className.baseVal===void 0?d.className:d.className.baseVal}function ln(d,x){"opacity"in d.style?d.style.opacity=x:"filter"in d.style&&ho(d,x)}function ho(d,x){var A=!1,F="DXImageTransform.Microsoft.Alpha";try{A=d.filters.item(F)}catch{if(x===1)return}x=Math.round(x*100),A?(A.Enabled=x!==100,A.Opacity=x):d.style.filter+=" progid:"+F+"(opacity="+x+")"}function kn(d){for(var x=document.documentElement.style,A=0;A<d.length;A++)if(d[A]in x)return d[A];return!1}function eo(d,x,A){var F=x||new Tt(0,0);d.style[Fl]=(Lt.ie3d?"translate("+F.x+"px,"+F.y+"px)":"translate3d("+F.x+"px,"+F.y+"px,0)")+(A?" scale("+A+")":"")}function On(d,x){d._leaflet_pos=x,Lt.any3d?eo(d,x):(d.style.left=x.x+"px",d.style.top=x.y+"px")}function Gr(d){return d._leaflet_pos||new Tt(0,0)}var _n,Ei,zi;if("onselectstart"in document)_n=function(){hn(window,"selectstart",gi)},Ei=function(){si(window,"selectstart",gi)};else{var Is=kn(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);_n=function(){if(Is){var d=document.documentElement.style;zi=d[Is],d[Is]="none"}},Ei=function(){Is&&(document.documentElement.style[Is]=zi,zi=void 0)}}function Er(){hn(window,"dragstart",gi)}function Ir(){si(window,"dragstart",gi)}var xr,Ha;function Zr(d){for(;d.tabIndex===-1;)d=d.parentNode;d.style&&(Bn(),xr=d,Ha=d.style.outlineStyle,d.style.outlineStyle="none",hn(window,"keydown",Bn))}function Bn(){xr&&(xr.style.outlineStyle=Ha,xr=void 0,Ha=void 0,si(window,"keydown",Bn))}function po(d){do d=d.parentNode;while((!d.offsetWidth||!d.offsetHeight)&&d!==document.body);return d}function wr(d){var x=d.getBoundingClientRect();return{x:x.width/d.offsetWidth||1,y:x.height/d.offsetHeight||1,boundingClientRect:x}}var fo={__proto__:null,TRANSFORM:Fl,TRANSITION:hl,TRANSITION_END:dl,get:bo,getStyle:wa,create:An,remove:Di,empty:pl,toFront:To,toBack:rs,hasClass:Zs,addClass:Dn,removeClass:fi,setClass:Bl,getClass:Sr,setOpacity:ln,testProp:kn,setTransform:eo,setPosition:On,getPosition:Gr,get disableTextSelection(){return _n},get enableTextSelection(){return Ei},disableImageDrag:Er,enableImageDrag:Ir,preventOutline:Zr,restoreOutline:Bn,getSizedParentNode:po,getScale:wr};function hn(d,x,A,F){if(x&&typeof x=="object")for(var Z in x)ba(d,Z,x[Z],A);else{x=de(x);for(var he=0,Oe=x.length;he<Oe;he++)ba(d,x[he],A,F)}return this}var Pr="_leaflet_events";function si(d,x,A,F){if(arguments.length===1)fl(d),delete d[Pr];else if(x&&typeof x=="object")for(var Z in x)Wn(d,Z,x[Z],A);else if(x=de(x),arguments.length===2)fl(d,function(rt){return Ye(x,rt)!==-1});else for(var he=0,Oe=x.length;he<Oe;he++)Wn(d,x[he],A,F);return this}function fl(d,x){for(var A in d[Pr]){var F=A.split(/\d/)[0];(!x||x(F))&&Wn(d,F,null,null,A)}}var Kn={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function ba(d,x,A,F){var Z=x+R(A)+(F?"_"+R(F):"");if(d[Pr]&&d[Pr][Z])return this;var he=function(rt){return A.call(F||d,rt||window.event)},Oe=he;!Lt.touchNative&&Lt.pointer&&x.indexOf("touch")===0?he=co(d,x,he):Lt.touch&&x==="dblclick"?he=ns(d,he):"addEventListener"in d?x==="touchstart"||x==="touchmove"||x==="wheel"||x==="mousewheel"?d.addEventListener(Kn[x]||x,he,Lt.passiveEvents?{passive:!1}:!1):x==="mouseenter"||x==="mouseleave"?(he=function(rt){rt=rt||window.event,ml(d,rt)&&Oe(rt)},d.addEventListener(Kn[x],he,!1)):d.addEventListener(x,Oe,!1):d.attachEvent("on"+x,he),d[Pr]=d[Pr]||{},d[Pr][Z]=he}function Wn(d,x,A,F,Z){Z=Z||x+R(A)+(F?"_"+R(F):"");var he=d[Pr]&&d[Pr][Z];if(!he)return this;!Lt.touchNative&&Lt.pointer&&x.indexOf("touch")===0?Li(d,x,he):Lt.touch&&x==="dblclick"?is(d,he):"removeEventListener"in d?d.removeEventListener(Kn[x]||x,he,!1):d.detachEvent("on"+x,he),d[Pr][Z]=null}function xn(d){return d.stopPropagation?d.stopPropagation():d.originalEvent?d.originalEvent._stopped=!0:d.cancelBubble=!0,this}function os(d){return ba(d,"wheel",xn),this}function Hn(d){return hn(d,"mousedown touchstart dblclick contextmenu",xn),d._leaflet_disable_click=!0,this}function gi(d){return d.preventDefault?d.preventDefault():d.returnValue=!1,this}function Xi(d){return gi(d),xn(d),this}function Vo(d){if(d.composedPath)return d.composedPath();for(var x=[],A=d.target;A;)x.push(A),A=A.parentNode;return x}function ss(d,x){if(!x)return new Tt(d.clientX,d.clientY);var A=wr(x),F=A.boundingClientRect;return new Tt((d.clientX-F.left)/A.x-x.clientLeft,(d.clientY-F.top)/A.y-x.clientTop)}var ji=Lt.linux&&Lt.chrome?window.devicePixelRatio:Lt.mac?window.devicePixelRatio*3:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function Ta(d){return Lt.edge?d.wheelDeltaY/2:d.deltaY&&d.deltaMode===0?-d.deltaY/ji:d.deltaY&&d.deltaMode===1?-d.deltaY*20:d.deltaY&&d.deltaMode===2?-d.deltaY*60:d.deltaX||d.deltaZ?0:d.wheelDelta?(d.wheelDeltaY||d.wheelDelta)/2:d.detail&&Math.abs(d.detail)<32765?-d.detail*20:d.detail?d.detail/-32765*60:0}function ml(d,x){var A=x.relatedTarget;if(!A)return!0;try{for(;A&&A!==d;)A=A.parentNode}catch{return!1}return A!==d}var qa={__proto__:null,on:hn,off:si,stopPropagation:xn,disableScrollPropagation:os,disableClickPropagation:Hn,preventDefault:gi,stop:Xi,getPropagationPath:Vo,getMousePosition:ss,getWheelDelta:Ta,isExternalTarget:ml,addListener:hn,removeListener:si},Ga=jn.extend({run:function(d,x,A,F){this.stop(),this._el=d,this._inProgress=!0,this._duration=A||.25,this._easeOutPower=1/Math.max(F||.5,.2),this._startPos=Gr(d),this._offset=x.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=Ae(this._animate,this),this._step()},_step:function(d){var x=+new Date-this._startTime,A=this._duration*1e3;x<A?this._runFrame(this._easeOut(x/A),d):(this._runFrame(1),this._complete())},_runFrame:function(d,x){var A=this._startPos.add(this._offset.multiplyBy(d));x&&A._round(),On(this._el,A),this.fire("step")},_complete:function(){$e(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(d){return 1-Math.pow(1-d,this._easeOutPower)}}),ei=jn.extend({options:{crs:Hr,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(d,x){x=Se(this,x),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(d),this._initLayout(),this._onResize=_(this._onResize,this),this._initEvents(),x.maxBounds&&this.setMaxBounds(x.maxBounds),x.zoom!==void 0&&(this._zoom=this._limitZoom(x.zoom)),x.center&&x.zoom!==void 0&&this.setView(nn(x.center),x.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=hl&&Lt.any3d&&!Lt.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),hn(this._proxy,dl,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(d,x,A){if(x=x===void 0?this._zoom:this._limitZoom(x),d=this._limitCenter(nn(d),x,this.options.maxBounds),A=A||{},this._stop(),this._loaded&&!A.reset&&A!==!0){A.animate!==void 0&&(A.zoom=h({animate:A.animate},A.zoom),A.pan=h({animate:A.animate,duration:A.duration},A.pan));var F=this._zoom!==x?this._tryAnimatedZoom&&this._tryAnimatedZoom(d,x,A.zoom):this._tryAnimatedPan(d,A.pan);if(F)return clearTimeout(this._sizeTimer),this}return this._resetView(d,x,A.pan&&A.pan.noMoveStart),this},setZoom:function(d,x){return this._loaded?this.setView(this.getCenter(),d,{zoom:x}):(this._zoom=d,this)},zoomIn:function(d,x){return d=d||(Lt.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+d,x)},zoomOut:function(d,x){return d=d||(Lt.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-d,x)},setZoomAround:function(d,x,A){var F=this.getZoomScale(x),Z=this.getSize().divideBy(2),he=d instanceof Tt?d:this.latLngToContainerPoint(d),Oe=he.subtract(Z).multiplyBy(1-1/F),rt=this.containerPointToLatLng(Z.add(Oe));return this.setView(rt,x,{zoom:A})},_getBoundsCenterZoom:function(d,x){x=x||{},d=d.getBounds?d.getBounds():sn(d);var A=St(x.paddingTopLeft||x.padding||[0,0]),F=St(x.paddingBottomRight||x.padding||[0,0]),Z=this.getBoundsZoom(d,!1,A.add(F));if(Z=typeof x.maxZoom=="number"?Math.min(x.maxZoom,Z):Z,Z===1/0)return{center:d.getCenter(),zoom:Z};var he=F.subtract(A).divideBy(2),Oe=this.project(d.getSouthWest(),Z),rt=this.project(d.getNorthEast(),Z),dt=this.unproject(Oe.add(rt).divideBy(2).add(he),Z);return{center:dt,zoom:Z}},fitBounds:function(d,x){if(d=sn(d),!d.isValid())throw new Error("Bounds are not valid.");var A=this._getBoundsCenterZoom(d,x);return this.setView(A.center,A.zoom,x)},fitWorld:function(d){return this.fitBounds([[-90,-180],[90,180]],d)},panTo:function(d,x){return this.setView(d,this._zoom,{pan:x})},panBy:function(d,x){if(d=St(d).round(),x=x||{},!d.x&&!d.y)return this.fire("moveend");if(x.animate!==!0&&!this.getSize().contains(d))return this._resetView(this.unproject(this.project(this.getCenter()).add(d)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new Ga,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),x.noMoveStart||this.fire("movestart"),x.animate!==!1){Dn(this._mapPane,"leaflet-pan-anim");var A=this._getMapPanePos().subtract(d).round();this._panAnim.run(this._mapPane,A,x.duration||.25,x.easeLinearity)}else this._rawPanBy(d),this.fire("move").fire("moveend");return this},flyTo:function(d,x,A){if(A=A||{},A.animate===!1||!Lt.any3d)return this.setView(d,x,A);this._stop();var F=this.project(this.getCenter()),Z=this.project(d),he=this.getSize(),Oe=this._zoom;d=nn(d),x=x===void 0?Oe:x;var rt=Math.max(he.x,he.y),dt=rt*this.getZoomScale(Oe,x),kt=Z.distanceTo(F)||1,tn=1.42,Sn=tn*tn;function Gn(Ni){var nu=Ni?-1:1,Dc=Ni?dt:rt,Cu=dt*dt-rt*rt+nu*Sn*Sn*kt*kt,Ar=2*Dc*Sn*kt,$i=Cu/Ar,Ds=Math.sqrt($i*$i+1)-$i,Uo=Ds<1e-9?-18:Math.log(Ds);return Uo}function Cr(Ni){return(Math.exp(Ni)-Math.exp(-Ni))/2}function Nr(Ni){return(Math.exp(Ni)+Math.exp(-Ni))/2}function Ao(Ni){return Cr(Ni)/Nr(Ni)}var _o=Gn(0);function Jl(Ni){return rt*(Nr(_o)/Nr(_o+tn*Ni))}function Ca(Ni){return rt*(Nr(_o)*Ao(_o+tn*Ni)-Cr(_o))/Sn}function Aa(Ni){return 1-Math.pow(1-Ni,1.5)}var eu=Date.now(),El=(Gn(1)-_o)/tn,ta=A.duration?1e3*A.duration:1e3*El*.8;function tu(){var Ni=(Date.now()-eu)/ta,nu=Aa(Ni)*El;Ni<=1?(this._flyToFrame=Ae(tu,this),this._move(this.unproject(F.add(Z.subtract(F).multiplyBy(Ca(nu)/kt)),Oe),this.getScaleZoom(rt/Jl(nu),Oe),{flyTo:!0})):this._move(d,x)._moveEnd(!0)}return this._moveStart(!0,A.noMoveStart),tu.call(this),this},flyToBounds:function(d,x){var A=this._getBoundsCenterZoom(d,x);return this.flyTo(A.center,A.zoom,x)},setMaxBounds:function(d){return d=sn(d),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),d.isValid()?(this.options.maxBounds=d,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(d){var x=this.options.minZoom;return this.options.minZoom=d,this._loaded&&x!==d&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(d):this},setMaxZoom:function(d){var x=this.options.maxZoom;return this.options.maxZoom=d,this._loaded&&x!==d&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(d):this},panInsideBounds:function(d,x){this._enforcingBounds=!0;var A=this.getCenter(),F=this._limitCenter(A,this._zoom,sn(d));return A.equals(F)||this.panTo(F,x),this._enforcingBounds=!1,this},panInside:function(d,x){x=x||{};var A=St(x.paddingTopLeft||x.padding||[0,0]),F=St(x.paddingBottomRight||x.padding||[0,0]),Z=this.project(this.getCenter()),he=this.project(d),Oe=this.getPixelBounds(),rt=wt([Oe.min.add(A),Oe.max.subtract(F)]),dt=rt.getSize();if(!rt.contains(he)){this._enforcingBounds=!0;var kt=he.subtract(rt.getCenter()),tn=rt.extend(he).getSize().subtract(dt);Z.x+=kt.x<0?-tn.x:tn.x,Z.y+=kt.y<0?-tn.y:tn.y,this.panTo(this.unproject(Z),x),this._enforcingBounds=!1}return this},invalidateSize:function(d){if(!this._loaded)return this;d=h({animate:!1,pan:!0},d===!0?{animate:!0}:d);var x=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var A=this.getSize(),F=x.divideBy(2).round(),Z=A.divideBy(2).round(),he=F.subtract(Z);return!he.x&&!he.y?this:(d.animate&&d.pan?this.panBy(he):(d.pan&&this._rawPanBy(he),this.fire("move"),d.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(_(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:x,newSize:A}))},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(d){if(d=this._locateOptions=h({timeout:1e4,watch:!1},d),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var x=_(this._handleGeolocationResponse,this),A=_(this._handleGeolocationError,this);return d.watch?this._locationWatchId=navigator.geolocation.watchPosition(x,A,d):navigator.geolocation.getCurrentPosition(x,A,d),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(d){if(this._container._leaflet_id){var x=d.code,A=d.message||(x===1?"permission denied":x===2?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:x,message:"Geolocation error: "+A+"."})}},_handleGeolocationResponse:function(d){if(this._container._leaflet_id){var x=d.coords.latitude,A=d.coords.longitude,F=new Xt(x,A),Z=F.toBounds(d.coords.accuracy*2),he=this._locateOptions;if(he.setView){var Oe=this.getBoundsZoom(Z);this.setView(F,he.maxZoom?Math.min(Oe,he.maxZoom):Oe)}var rt={latlng:F,bounds:Z,timestamp:d.timestamp};for(var dt in d.coords)typeof d.coords[dt]=="number"&&(rt[dt]=d.coords[dt]);this.fire("locationfound",rt)}},addHandler:function(d,x){if(!x)return this;var A=this[d]=new x(this);return this._handlers.push(A),this.options[d]&&A.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch{this._container._leaflet_id=void 0,this._containerId=void 0}this._locationWatchId!==void 0&&this.stopLocate(),this._stop(),Di(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&($e(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload");var d;for(d in this._layers)this._layers[d].remove();for(d in this._panes)Di(this._panes[d]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(d,x){var A="leaflet-pane"+(d?" leaflet-"+d.replace("Pane","")+"-pane":""),F=An("div",A,x||this._mapPane);return d&&(this._panes[d]=F),F},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var d=this.getPixelBounds(),x=this.unproject(d.getBottomLeft()),A=this.unproject(d.getTopRight());return new Qt(x,A)},getMinZoom:function(){return this.options.minZoom===void 0?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===void 0?this._layersMaxZoom===void 0?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(d,x,A){d=sn(d),A=St(A||[0,0]);var F=this.getZoom()||0,Z=this.getMinZoom(),he=this.getMaxZoom(),Oe=d.getNorthWest(),rt=d.getSouthEast(),dt=this.getSize().subtract(A),kt=wt(this.project(rt,F),this.project(Oe,F)).getSize(),tn=Lt.any3d?this.options.zoomSnap:1,Sn=dt.x/kt.x,Gn=dt.y/kt.y,Cr=x?Math.max(Sn,Gn):Math.min(Sn,Gn);return F=this.getScaleZoom(Cr,F),tn&&(F=Math.round(F/(tn/100))*(tn/100),F=x?Math.ceil(F/tn)*tn:Math.floor(F/tn)*tn),Math.max(Z,Math.min(he,F))},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new Tt(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(d,x){var A=this._getTopLeftPoint(d,x);return new Ze(A,A.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(d){return this.options.crs.getProjectedBounds(d===void 0?this.getZoom():d)},getPane:function(d){return typeof d=="string"?this._panes[d]:d},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(d,x){var A=this.options.crs;return x=x===void 0?this._zoom:x,A.scale(d)/A.scale(x)},getScaleZoom:function(d,x){var A=this.options.crs;x=x===void 0?this._zoom:x;var F=A.zoom(d*A.scale(x));return isNaN(F)?1/0:F},project:function(d,x){return x=x===void 0?this._zoom:x,this.options.crs.latLngToPoint(nn(d),x)},unproject:function(d,x){return x=x===void 0?this._zoom:x,this.options.crs.pointToLatLng(St(d),x)},layerPointToLatLng:function(d){var x=St(d).add(this.getPixelOrigin());return this.unproject(x)},latLngToLayerPoint:function(d){var x=this.project(nn(d))._round();return x._subtract(this.getPixelOrigin())},wrapLatLng:function(d){return this.options.crs.wrapLatLng(nn(d))},wrapLatLngBounds:function(d){return this.options.crs.wrapLatLngBounds(sn(d))},distance:function(d,x){return this.options.crs.distance(nn(d),nn(x))},containerPointToLayerPoint:function(d){return St(d).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(d){return St(d).add(this._getMapPanePos())},containerPointToLatLng:function(d){var x=this.containerPointToLayerPoint(St(d));return this.layerPointToLatLng(x)},latLngToContainerPoint:function(d){return this.layerPointToContainerPoint(this.latLngToLayerPoint(nn(d)))},mouseEventToContainerPoint:function(d){return ss(d,this._container)},mouseEventToLayerPoint:function(d){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(d))},mouseEventToLatLng:function(d){return this.layerPointToLatLng(this.mouseEventToLayerPoint(d))},_initContainer:function(d){var x=this._container=bo(d);if(x){if(x._leaflet_id)throw new Error("Map container is already initialized.")}else throw new Error("Map container not found.");hn(x,"scroll",this._onScroll,this),this._containerId=R(x)},_initLayout:function(){var d=this._container;this._fadeAnimated=this.options.fadeAnimation&&Lt.any3d,Dn(d,"leaflet-container"+(Lt.touch?" leaflet-touch":"")+(Lt.retina?" leaflet-retina":"")+(Lt.ielt9?" leaflet-oldie":"")+(Lt.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var x=wa(d,"position");x!=="absolute"&&x!=="relative"&&x!=="fixed"&&x!=="sticky"&&(d.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var d=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),On(this._mapPane,new Tt(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(Dn(d.markerPane,"leaflet-zoom-hide"),Dn(d.shadowPane,"leaflet-zoom-hide"))},_resetView:function(d,x,A){On(this._mapPane,new Tt(0,0));var F=!this._loaded;this._loaded=!0,x=this._limitZoom(x),this.fire("viewprereset");var Z=this._zoom!==x;this._moveStart(Z,A)._move(d,x)._moveEnd(Z),this.fire("viewreset"),F&&this.fire("load")},_moveStart:function(d,x){return d&&this.fire("zoomstart"),x||this.fire("movestart"),this},_move:function(d,x,A,F){x===void 0&&(x=this._zoom);var Z=this._zoom!==x;return this._zoom=x,this._lastCenter=d,this._pixelOrigin=this._getNewPixelOrigin(d),F?A&&A.pinch&&this.fire("zoom",A):((Z||A&&A.pinch)&&this.fire("zoom",A),this.fire("move",A)),this},_moveEnd:function(d){return d&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return $e(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(d){On(this._mapPane,this._getMapPanePos().subtract(d))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(d){this._targets={},this._targets[R(this._container)]=this;var x=d?si:hn;x(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&x(window,"resize",this._onResize,this),Lt.any3d&&this.options.transform3DLimit&&(d?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){$e(this._resizeRequest),this._resizeRequest=Ae(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var d=this._getMapPanePos();Math.max(Math.abs(d.x),Math.abs(d.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(d,x){for(var A=[],F,Z=x==="mouseout"||x==="mouseover",he=d.target||d.srcElement,Oe=!1;he;){if(F=this._targets[R(he)],F&&(x==="click"||x==="preclick")&&this._draggableMoved(F)){Oe=!0;break}if(F&&F.listens(x,!0)&&(Z&&!ml(he,d)||(A.push(F),Z))||he===this._container)break;he=he.parentNode}return!A.length&&!Oe&&!Z&&this.listens(x,!0)&&(A=[this]),A},_isClickDisabled:function(d){for(;d&&d!==this._container;){if(d._leaflet_disable_click)return!0;d=d.parentNode}},_handleDOMEvent:function(d){var x=d.target||d.srcElement;if(!(!this._loaded||x._leaflet_disable_events||d.type==="click"&&this._isClickDisabled(x))){var A=d.type;A==="mousedown"&&Zr(x),this._fireDOMEvent(d,A)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(d,x,A){if(d.type==="click"){var F=h({},d);F.type="preclick",this._fireDOMEvent(F,F.type,A)}var Z=this._findEventTargets(d,x);if(A){for(var he=[],Oe=0;Oe<A.length;Oe++)A[Oe].listens(x,!0)&&he.push(A[Oe]);Z=he.concat(Z)}if(Z.length){x==="contextmenu"&&gi(d);var rt=Z[0],dt={originalEvent:d};if(d.type!=="keypress"&&d.type!=="keydown"&&d.type!=="keyup"){var kt=rt.getLatLng&&(!rt._radius||rt._radius<=10);dt.containerPoint=kt?this.latLngToContainerPoint(rt.getLatLng()):this.mouseEventToContainerPoint(d),dt.layerPoint=this.containerPointToLayerPoint(dt.containerPoint),dt.latlng=kt?rt.getLatLng():this.layerPointToLatLng(dt.layerPoint)}for(Oe=0;Oe<Z.length;Oe++)if(Z[Oe].fire(x,dt,!0),dt.originalEvent._stopped||Z[Oe].options.bubblingMouseEvents===!1&&Ye(this._mouseEvents,x)!==-1)return}},_draggableMoved:function(d){return d=d.dragging&&d.dragging.enabled()?d:this,d.dragging&&d.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var d=0,x=this._handlers.length;d<x;d++)this._handlers[d].disable()},whenReady:function(d,x){return this._loaded?d.call(x||this,{target:this}):this.on("load",d,x),this},_getMapPanePos:function(){return Gr(this._mapPane)||new Tt(0,0)},_moved:function(){var d=this._getMapPanePos();return d&&!d.equals([0,0])},_getTopLeftPoint:function(d,x){var A=d&&x!==void 0?this._getNewPixelOrigin(d,x):this.getPixelOrigin();return A.subtract(this._getMapPanePos())},_getNewPixelOrigin:function(d,x){var A=this.getSize()._divideBy(2);return this.project(d,x)._subtract(A)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(d,x,A){var F=this._getNewPixelOrigin(A,x);return this.project(d,x)._subtract(F)},_latLngBoundsToNewLayerBounds:function(d,x,A){var F=this._getNewPixelOrigin(A,x);return wt([this.project(d.getSouthWest(),x)._subtract(F),this.project(d.getNorthWest(),x)._subtract(F),this.project(d.getSouthEast(),x)._subtract(F),this.project(d.getNorthEast(),x)._subtract(F)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(d){return this.latLngToLayerPoint(d).subtract(this._getCenterLayerPoint())},_limitCenter:function(d,x,A){if(!A)return d;var F=this.project(d,x),Z=this.getSize().divideBy(2),he=new Ze(F.subtract(Z),F.add(Z)),Oe=this._getBoundsOffset(he,A,x);return Math.abs(Oe.x)<=1&&Math.abs(Oe.y)<=1?d:this.unproject(F.add(Oe),x)},_limitOffset:function(d,x){if(!x)return d;var A=this.getPixelBounds(),F=new Ze(A.min.add(d),A.max.add(d));return d.add(this._getBoundsOffset(F,x))},_getBoundsOffset:function(d,x,A){var F=wt(this.project(x.getNorthEast(),A),this.project(x.getSouthWest(),A)),Z=F.min.subtract(d.min),he=F.max.subtract(d.max),Oe=this._rebound(Z.x,-he.x),rt=this._rebound(Z.y,-he.y);return new Tt(Oe,rt)},_rebound:function(d,x){return d+x>0?Math.round(d-x)/2:Math.max(0,Math.ceil(d))-Math.max(0,Math.floor(x))},_limitZoom:function(d){var x=this.getMinZoom(),A=this.getMaxZoom(),F=Lt.any3d?this.options.zoomSnap:1;return F&&(d=Math.round(d/F)*F),Math.max(x,Math.min(A,d))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){fi(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(d,x){var A=this._getCenterOffset(d)._trunc();return(x&&x.animate)!==!0&&!this.getSize().contains(A)?!1:(this.panBy(A,x),!0)},_createAnimProxy:function(){var d=this._proxy=An("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(d),this.on("zoomanim",function(x){var A=Fl,F=this._proxy.style[A];eo(this._proxy,this.project(x.center,x.zoom),this.getZoomScale(x.zoom,1)),F===this._proxy.style[A]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){Di(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var d=this.getCenter(),x=this.getZoom();eo(this._proxy,this.project(d,x),this.getZoomScale(x,1))},_catchTransitionEnd:function(d){this._animatingZoom&&d.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(d,x,A){if(this._animatingZoom)return!0;if(A=A||{},!this._zoomAnimated||A.animate===!1||this._nothingToAnimate()||Math.abs(x-this._zoom)>this.options.zoomAnimationThreshold)return!1;var F=this.getZoomScale(x),Z=this._getCenterOffset(d)._divideBy(1-1/F);return A.animate!==!0&&!this.getSize().contains(Z)?!1:(Ae(function(){this._moveStart(!0,A.noMoveStart||!1)._animateZoom(d,x,!0)},this),!0)},_animateZoom:function(d,x,A,F){this._mapPane&&(A&&(this._animatingZoom=!0,this._animateToCenter=d,this._animateToZoom=x,Dn(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:d,zoom:x,noUpdate:F}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(_(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&fi(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});function to(d,x){return new ei(d,x)}var qn=pn.extend({options:{position:"topright"},initialize:function(d){Se(this,d)},getPosition:function(){return this.options.position},setPosition:function(d){var x=this._map;return x&&x.removeControl(this),this.options.position=d,x&&x.addControl(this),this},getContainer:function(){return this._container},addTo:function(d){this.remove(),this._map=d;var x=this._container=this.onAdd(d),A=this.getPosition(),F=d._controlCorners[A];return Dn(x,"leaflet-control"),A.indexOf("bottom")!==-1?F.insertBefore(x,F.firstChild):F.appendChild(x),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(Di(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(d){this._map&&d&&d.screenX>0&&d.screenY>0&&this._map.getContainer().focus()}}),mr=function(d){return new qn(d)};ei.include({addControl:function(d){return d.addTo(this),this},removeControl:function(d){return d.remove(),this},_initControlPos:function(){var d=this._controlCorners={},x="leaflet-",A=this._controlContainer=An("div",x+"control-container",this._container);function F(Z,he){var Oe=x+Z+" "+x+he;d[Z+he]=An("div",Oe,A)}F("top","left"),F("top","right"),F("bottom","left"),F("bottom","right")},_clearControlPos:function(){for(var d in this._controlCorners)Di(this._controlCorners[d]);Di(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var mo=qn.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(d,x,A,F){return A<F?-1:F<A?1:0}},initialize:function(d,x,A){Se(this,A),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1;for(var F in d)this._addLayer(d[F],F);for(F in x)this._addLayer(x[F],F,!0)},onAdd:function(d){this._initLayout(),this._update(),this._map=d,d.on("zoomend",this._checkDisabledLayers,this);for(var x=0;x<this._layers.length;x++)this._layers[x].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(d){return qn.prototype.addTo.call(this,d),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var d=0;d<this._layers.length;d++)this._layers[d].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(d,x){return this._addLayer(d,x),this._map?this._update():this},addOverlay:function(d,x){return this._addLayer(d,x,!0),this._map?this._update():this},removeLayer:function(d){d.off("add remove",this._onLayerChange,this);var x=this._getLayer(R(d));return x&&this._layers.splice(this._layers.indexOf(x),1),this._map?this._update():this},expand:function(){Dn(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var d=this._map.getSize().y-(this._container.offsetTop+50);return d<this._section.clientHeight?(Dn(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=d+"px"):fi(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return fi(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var d="leaflet-control-layers",x=this._container=An("div",d),A=this.options.collapsed;x.setAttribute("aria-haspopup",!0),Hn(x),os(x);var F=this._section=An("section",d+"-list");A&&(this._map.on("click",this.collapse,this),hn(x,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var Z=this._layersLink=An("a",d+"-toggle",x);Z.href="#",Z.title="Layers",Z.setAttribute("role","button"),hn(Z,{keydown:function(he){he.keyCode===13&&this._expandSafely()},click:function(he){gi(he),this._expandSafely()}},this),A||this.expand(),this._baseLayersList=An("div",d+"-base",F),this._separator=An("div",d+"-separator",F),this._overlaysList=An("div",d+"-overlays",F),x.appendChild(F)},_getLayer:function(d){for(var x=0;x<this._layers.length;x++)if(this._layers[x]&&R(this._layers[x].layer)===d)return this._layers[x]},_addLayer:function(d,x,A){this._map&&d.on("add remove",this._onLayerChange,this),this._layers.push({layer:d,name:x,overlay:A}),this.options.sortLayers&&this._layers.sort(_(function(F,Z){return this.options.sortFunction(F.layer,Z.layer,F.name,Z.name)},this)),this.options.autoZIndex&&d.setZIndex&&(this._lastZIndex++,d.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;pl(this._baseLayersList),pl(this._overlaysList),this._layerControlInputs=[];var d,x,A,F,Z=0;for(A=0;A<this._layers.length;A++)F=this._layers[A],this._addItem(F),x=x||F.overlay,d=d||!F.overlay,Z+=F.overlay?0:1;return this.options.hideSingleBase&&(d=d&&Z>1,this._baseLayersList.style.display=d?"":"none"),this._separator.style.display=x&&d?"":"none",this},_onLayerChange:function(d){this._handlingClick||this._update();var x=this._getLayer(R(d.target)),A=x.overlay?d.type==="add"?"overlayadd":"overlayremove":d.type==="add"?"baselayerchange":null;A&&this._map.fire(A,x)},_createRadioElement:function(d,x){var A='<input type="radio" class="leaflet-control-layers-selector" name="'+d+'"'+(x?' checked="checked"':"")+"/>",F=document.createElement("div");return F.innerHTML=A,F.firstChild},_addItem:function(d){var x=document.createElement("label"),A=this._map.hasLayer(d.layer),F;d.overlay?(F=document.createElement("input"),F.type="checkbox",F.className="leaflet-control-layers-selector",F.defaultChecked=A):F=this._createRadioElement("leaflet-base-layers_"+R(this),A),this._layerControlInputs.push(F),F.layerId=R(d.layer),hn(F,"click",this._onInputClick,this);var Z=document.createElement("span");Z.innerHTML=" "+d.name;var he=document.createElement("span");x.appendChild(he),he.appendChild(F),he.appendChild(Z);var Oe=d.overlay?this._overlaysList:this._baseLayersList;return Oe.appendChild(x),this._checkDisabledLayers(),x},_onInputClick:function(){if(!this._preventClick){var d=this._layerControlInputs,x,A,F=[],Z=[];this._handlingClick=!0;for(var he=d.length-1;he>=0;he--)x=d[he],A=this._getLayer(x.layerId).layer,x.checked?F.push(A):x.checked||Z.push(A);for(he=0;he<Z.length;he++)this._map.hasLayer(Z[he])&&this._map.removeLayer(Z[he]);for(he=0;he<F.length;he++)this._map.hasLayer(F[he])||this._map.addLayer(F[he]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var d=this._layerControlInputs,x,A,F=this._map.getZoom(),Z=d.length-1;Z>=0;Z--)x=d[Z],A=this._getLayer(x.layerId).layer,x.disabled=A.options.minZoom!==void 0&&F<A.options.minZoom||A.options.maxZoom!==void 0&&F>A.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var d=this._section;this._preventClick=!0,hn(d,"click",gi),this.expand();var x=this;setTimeout(function(){si(d,"click",gi),x._preventClick=!1})}}),Ps=function(d,x,A){return new mo(d,x,A)},Ii=qn.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(d){var x="leaflet-control-zoom",A=An("div",x+" leaflet-bar"),F=this.options;return this._zoomInButton=this._createButton(F.zoomInText,F.zoomInTitle,x+"-in",A,this._zoomIn),this._zoomOutButton=this._createButton(F.zoomOutText,F.zoomOutTitle,x+"-out",A,this._zoomOut),this._updateDisabled(),d.on("zoomend zoomlevelschange",this._updateDisabled,this),A},onRemove:function(d){d.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(d){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(d.shiftKey?3:1))},_zoomOut:function(d){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(d.shiftKey?3:1))},_createButton:function(d,x,A,F,Z){var he=An("a",A,F);return he.innerHTML=d,he.href="#",he.title=x,he.setAttribute("role","button"),he.setAttribute("aria-label",x),Hn(he),hn(he,"click",Xi),hn(he,"click",Z,this),hn(he,"click",this._refocusOnMap,this),he},_updateDisabled:function(){var d=this._map,x="leaflet-disabled";fi(this._zoomInButton,x),fi(this._zoomOutButton,x),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||d._zoom===d.getMinZoom())&&(Dn(this._zoomOutButton,x),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||d._zoom===d.getMaxZoom())&&(Dn(this._zoomInButton,x),this._zoomInButton.setAttribute("aria-disabled","true"))}});ei.mergeOptions({zoomControl:!0}),ei.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new Ii,this.addControl(this.zoomControl))});var Vl=function(d){return new Ii(d)},or=qn.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(d){var x="leaflet-control-scale",A=An("div",x),F=this.options;return this._addScales(F,x+"-line",A),d.on(F.updateWhenIdle?"moveend":"move",this._update,this),d.whenReady(this._update,this),A},onRemove:function(d){d.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(d,x,A){d.metric&&(this._mScale=An("div",x,A)),d.imperial&&(this._iScale=An("div",x,A))},_update:function(){var d=this._map,x=d.getSize().y/2,A=d.distance(d.containerPointToLatLng([0,x]),d.containerPointToLatLng([this.options.maxWidth,x]));this._updateScales(A)},_updateScales:function(d){this.options.metric&&d&&this._updateMetric(d),this.options.imperial&&d&&this._updateImperial(d)},_updateMetric:function(d){var x=this._getRoundNum(d),A=x<1e3?x+" m":x/1e3+" km";this._updateScale(this._mScale,A,x/d)},_updateImperial:function(d){var x=d*3.2808399,A,F,Z;x>5280?(A=x/5280,F=this._getRoundNum(A),this._updateScale(this._iScale,F+" mi",F/A)):(Z=this._getRoundNum(x),this._updateScale(this._iScale,Z+" ft",Z/x))},_updateScale:function(d,x,A){d.style.width=Math.round(this.options.maxWidth*A)+"px",d.innerHTML=x},_getRoundNum:function(d){var x=Math.pow(10,(Math.floor(d)+"").length-1),A=d/x;return A=A>=10?10:A>=5?5:A>=3?3:A>=2?2:1,x*A}}),Cs=function(d){return new or(d)},vu='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg>',So=qn.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(Lt.inlineSvg?vu+" ":"")+"Leaflet</a>"},initialize:function(d){Se(this,d),this._attributions={}},onAdd:function(d){d.attributionControl=this,this._container=An("div","leaflet-control-attribution"),Hn(this._container);for(var x in d._layers)d._layers[x].getAttribution&&this.addAttribution(d._layers[x].getAttribution());return this._update(),d.on("layeradd",this._addAttribution,this),this._container},onRemove:function(d){d.off("layeradd",this._addAttribution,this)},_addAttribution:function(d){d.layer.getAttribution&&(this.addAttribution(d.layer.getAttribution()),d.layer.once("remove",function(){this.removeAttribution(d.layer.getAttribution())},this))},setPrefix:function(d){return this.options.prefix=d,this._update(),this},addAttribution:function(d){return d?(this._attributions[d]||(this._attributions[d]=0),this._attributions[d]++,this._update(),this):this},removeAttribution:function(d){return d?(this._attributions[d]&&(this._attributions[d]--,this._update()),this):this},_update:function(){if(this._map){var d=[];for(var x in this._attributions)this._attributions[x]&&d.push(x);var A=[];this.options.prefix&&A.push(this.options.prefix),d.length&&A.push(d.join(", ")),this._container.innerHTML=A.join(' <span aria-hidden="true">|</span> ')}}});ei.mergeOptions({attributionControl:!0}),ei.addInitHook(function(){this.options.attributionControl&&new So().addTo(this)});var $u=function(d){return new So(d)};qn.Layers=mo,qn.Zoom=Ii,qn.Scale=or,qn.Attribution=So,mr.layers=Ps,mr.zoom=Vl,mr.scale=Cs,mr.attribution=$u;var Eo=pn.extend({initialize:function(d){this._map=d},enable:function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});Eo.addTo=function(d,x){return d.addHandler(x,this),this};var As={Events:dn},Io=Lt.touch?"touchstart mousedown":"mousedown",tr=jn.extend({options:{clickTolerance:3},initialize:function(d,x,A,F){Se(this,F),this._element=d,this._dragStartTarget=x||d,this._preventOutline=A},enable:function(){this._enabled||(hn(this._dragStartTarget,Io,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(tr._dragging===this&&this.finishDrag(!0),si(this._dragStartTarget,Io,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(d){if(this._enabled&&(this._moved=!1,!Zs(this._element,"leaflet-zoom-anim"))){if(d.touches&&d.touches.length!==1){tr._dragging===this&&this.finishDrag();return}if(!(tr._dragging||d.shiftKey||d.which!==1&&d.button!==1&&!d.touches)&&(tr._dragging=this,this._preventOutline&&Zr(this._element),Er(),_n(),!this._moving)){this.fire("down");var x=d.touches?d.touches[0]:d,A=po(this._element);this._startPoint=new Tt(x.clientX,x.clientY),this._startPos=Gr(this._element),this._parentScale=wr(A);var F=d.type==="mousedown";hn(document,F?"mousemove":"touchmove",this._onMove,this),hn(document,F?"mouseup":"touchend touchcancel",this._onUp,this)}}},_onMove:function(d){if(this._enabled){if(d.touches&&d.touches.length>1){this._moved=!0;return}var x=d.touches&&d.touches.length===1?d.touches[0]:d,A=new Tt(x.clientX,x.clientY)._subtract(this._startPoint);!A.x&&!A.y||Math.abs(A.x)+Math.abs(A.y)<this.options.clickTolerance||(A.x/=this._parentScale.x,A.y/=this._parentScale.y,gi(d),this._moved||(this.fire("dragstart"),this._moved=!0,Dn(document.body,"leaflet-dragging"),this._lastTarget=d.target||d.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),Dn(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(A),this._moving=!0,this._lastEvent=d,this._updatePosition())}},_updatePosition:function(){var d={originalEvent:this._lastEvent};this.fire("predrag",d),On(this._element,this._newPos),this.fire("drag",d)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(d){fi(document.body,"leaflet-dragging"),this._lastTarget&&(fi(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),si(document,"mousemove touchmove",this._onMove,this),si(document,"mouseup touchend touchcancel",this._onUp,this),Ir(),Ei();var x=this._moved&&this._moving;this._moving=!1,tr._dragging=!1,x&&this.fire("dragend",{noInertia:d,distance:this._newPos.distanceTo(this._startPos)})}});function Ws(d,x,A){var F,Z=[1,4,2,8],he,Oe,rt,dt,kt,tn,Sn,Gn;for(he=0,tn=d.length;he<tn;he++)d[he]._code=ks(d[he],x);for(rt=0;rt<4;rt++){for(Sn=Z[rt],F=[],he=0,tn=d.length,Oe=tn-1;he<tn;Oe=he++)dt=d[he],kt=d[Oe],dt._code&Sn?kt._code&Sn||(Gn=Wr(kt,dt,Sn,x,A),Gn._code=ks(Gn,x),F.push(Gn)):(kt._code&Sn&&(Gn=Wr(kt,dt,Sn,x,A),Gn._code=ks(Gn,x),F.push(Gn)),F.push(dt));d=F}return d}function Ks(d,x){var A,F,Z,he,Oe,rt,dt,kt,tn;if(!d||d.length===0)throw new Error("latlngs not passed");P(d)||(console.warn("latlngs are not flat! Only the first ring will be used"),d=d[0]);var Sn=nn([0,0]),Gn=sn(d),Cr=Gn.getNorthWest().distanceTo(Gn.getSouthWest())*Gn.getNorthEast().distanceTo(Gn.getNorthWest());Cr<1700&&(Sn=gl(d));var Nr=d.length,Ao=[];for(A=0;A<Nr;A++){var _o=nn(d[A]);Ao.push(x.project(nn([_o.lat-Sn.lat,_o.lng-Sn.lng])))}for(rt=dt=kt=0,A=0,F=Nr-1;A<Nr;F=A++)Z=Ao[A],he=Ao[F],Oe=Z.y*he.x-he.y*Z.x,dt+=(Z.x+he.x)*Oe,kt+=(Z.y+he.y)*Oe,rt+=Oe*3;rt===0?tn=Ao[0]:tn=[dt/rt,kt/rt];var Jl=x.unproject(St(tn));return nn([Jl.lat+Sn.lat,Jl.lng+Sn.lng])}function gl(d){for(var x=0,A=0,F=0,Z=0;Z<d.length;Z++){var he=nn(d[Z]);x+=he.lat,A+=he.lng,F++}return nn([x/F,A/F])}var no={__proto__:null,clipPolygon:Ws,polygonCenter:Ks,centroid:gl};function Ul(d,x){if(!x||!d.length)return d.slice();var A=x*x;return d=$l(d,A),d=_l(d,A),d}function jl(d,x,A){return Math.sqrt(Po(d,x,A,!0))}function as(d,x,A){return Po(d,x,A)}function _l(d,x){var A=d.length,F=typeof Uint8Array<"u"?Uint8Array:Array,Z=new F(A);Z[0]=Z[A-1]=1,Za(d,Z,x,0,A-1);var he,Oe=[];for(he=0;he<A;he++)Z[he]&&Oe.push(d[he]);return Oe}function Za(d,x,A,F,Z){var he=0,Oe,rt,dt;for(rt=F+1;rt<=Z-1;rt++)dt=Po(d[rt],d[F],d[Z],!0),dt>he&&(Oe=rt,he=dt);he>A&&(x[Oe]=1,Za(d,x,A,F,Oe),Za(d,x,A,Oe,Z))}function $l(d,x){for(var A=[d[0]],F=1,Z=0,he=d.length;F<he;F++)Pc(d[F],d[Z])>x&&(A.push(d[F]),Z=F);return Z<he-1&&A.push(d[he-1]),A}var Hl;function ls(d,x,A,F,Z){var he=F?Hl:ks(d,A),Oe=ks(x,A),rt,dt,kt;for(Hl=Oe;;){if(!(he|Oe))return[d,x];if(he&Oe)return!1;rt=he||Oe,dt=Wr(d,x,rt,A,Z),kt=ks(dt,A),rt===he?(d=dt,he=kt):(x=dt,Oe=kt)}}function Wr(d,x,A,F,Z){var he=x.x-d.x,Oe=x.y-d.y,rt=F.min,dt=F.max,kt,tn;return A&8?(kt=d.x+he*(dt.y-d.y)/Oe,tn=dt.y):A&4?(kt=d.x+he*(rt.y-d.y)/Oe,tn=rt.y):A&2?(kt=dt.x,tn=d.y+Oe*(dt.x-d.x)/he):A&1&&(kt=rt.x,tn=d.y+Oe*(rt.x-d.x)/he),new Tt(kt,tn,Z)}function ks(d,x){var A=0;return d.x<x.min.x?A|=1:d.x>x.max.x&&(A|=2),d.y<x.min.y?A|=4:d.y>x.max.y&&(A|=8),A}function Pc(d,x){var A=x.x-d.x,F=x.y-d.y;return A*A+F*F}function Po(d,x,A,F){var Z=x.x,he=x.y,Oe=A.x-Z,rt=A.y-he,dt=Oe*Oe+rt*rt,kt;return dt>0&&(kt=((d.x-Z)*Oe+(d.y-he)*rt)/dt,kt>1?(Z=A.x,he=A.y):kt>0&&(Z+=Oe*kt,he+=rt*kt)),Oe=d.x-Z,rt=d.y-he,F?Oe*Oe+rt*rt:new Tt(Z,he)}function P(d){return!vt(d[0])||typeof d[0][0]!="object"&&typeof d[0][0]<"u"}function j(d){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),P(d)}function Y(d,x){var A,F,Z,he,Oe,rt,dt,kt;if(!d||d.length===0)throw new Error("latlngs not passed");P(d)||(console.warn("latlngs are not flat! Only the first ring will be used"),d=d[0]);var tn=nn([0,0]),Sn=sn(d),Gn=Sn.getNorthWest().distanceTo(Sn.getSouthWest())*Sn.getNorthEast().distanceTo(Sn.getNorthWest());Gn<1700&&(tn=gl(d));var Cr=d.length,Nr=[];for(A=0;A<Cr;A++){var Ao=nn(d[A]);Nr.push(x.project(nn([Ao.lat-tn.lat,Ao.lng-tn.lng])))}for(A=0,F=0;A<Cr-1;A++)F+=Nr[A].distanceTo(Nr[A+1])/2;if(F===0)kt=Nr[0];else for(A=0,he=0;A<Cr-1;A++)if(Oe=Nr[A],rt=Nr[A+1],Z=Oe.distanceTo(rt),he+=Z,he>F){dt=(he-F)/Z,kt=[rt.x-dt*(rt.x-Oe.x),rt.y-dt*(rt.y-Oe.y)];break}var _o=x.unproject(St(kt));return nn([_o.lat+tn.lat,_o.lng+tn.lng])}var ye={__proto__:null,simplify:Ul,pointToSegmentDistance:jl,closestPointOnSegment:as,clipSegment:ls,_getEdgeIntersection:Wr,_getBitCode:ks,_sqClosestPointOnSegment:Po,isFlat:P,_flat:j,polylineCenter:Y},nt={project:function(d){return new Tt(d.lng,d.lat)},unproject:function(d){return new Xt(d.y,d.x)},bounds:new Ze([-180,-90],[180,90])},ft={R:6378137,R_MINOR:6356752314245179e-9,bounds:new Ze([-2003750834279e-5,-1549657073972e-5],[2003750834279e-5,1876465623138e-5]),project:function(d){var x=Math.PI/180,A=this.R,F=d.lat*x,Z=this.R_MINOR/A,he=Math.sqrt(1-Z*Z),Oe=he*Math.sin(F),rt=Math.tan(Math.PI/4-F/2)/Math.pow((1-Oe)/(1+Oe),he/2);return F=-A*Math.log(Math.max(rt,1e-10)),new Tt(d.lng*x*A,F)},unproject:function(d){for(var x=180/Math.PI,A=this.R,F=this.R_MINOR/A,Z=Math.sqrt(1-F*F),he=Math.exp(-d.y/A),Oe=Math.PI/2-2*Math.atan(he),rt=0,dt=.1,kt;rt<15&&Math.abs(dt)>1e-7;rt++)kt=Z*Math.sin(Oe),kt=Math.pow((1-kt)/(1+kt),Z/2),dt=Math.PI/2-2*Math.atan(he*kt)-Oe,Oe+=dt;return new Xt(Oe*x,d.x*x/A)}},Zt={__proto__:null,LonLat:nt,Mercator:ft,SphericalMercator:ur},Pi=h({},$n,{code:"EPSG:3395",projection:ft,transformation:function(){var d=.5/(Math.PI*ft.R);return Ui(d,.5,-d,.5)}()}),cr=h({},$n,{code:"EPSG:4326",projection:nt,transformation:Ui(1/180,1,-1/180,.5)}),ai=h({},Fn,{projection:nt,transformation:Ui(1,0,-1,0),scale:function(d){return Math.pow(2,d)},zoom:function(d){return Math.log(d)/Math.LN2},distance:function(d,x){var A=x.lng-d.lng,F=x.lat-d.lat;return Math.sqrt(A*A+F*F)},infinite:!0});Fn.Earth=$n,Fn.EPSG3395=Pi,Fn.EPSG3857=Hr,Fn.EPSG900913=Wi,Fn.EPSG4326=cr,Fn.Simple=ai;var wi=jn.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(d){return d.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(d){return d&&d.removeLayer(this),this},getPane:function(d){return this._map.getPane(d?this.options[d]||d:this.options.pane)},addInteractiveTarget:function(d){return this._map._targets[R(d)]=this,this},removeInteractiveTarget:function(d){return delete this._map._targets[R(d)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(d){var x=d.target;if(x.hasLayer(this)){if(this._map=x,this._zoomAnimated=x._zoomAnimated,this.getEvents){var A=this.getEvents();x.on(A,this),this.once("remove",function(){x.off(A,this)},this)}this.onAdd(x),this.fire("add"),x.fire("layeradd",{layer:this})}}});ei.include({addLayer:function(d){if(!d._layerAdd)throw new Error("The provided object is not a Layer.");var x=R(d);return this._layers[x]?this:(this._layers[x]=d,d._mapToAdd=this,d.beforeAdd&&d.beforeAdd(this),this.whenReady(d._layerAdd,d),this)},removeLayer:function(d){var x=R(d);return this._layers[x]?(this._loaded&&d.onRemove(this),delete this._layers[x],this._loaded&&(this.fire("layerremove",{layer:d}),d.fire("remove")),d._map=d._mapToAdd=null,this):this},hasLayer:function(d){return R(d)in this._layers},eachLayer:function(d,x){for(var A in this._layers)d.call(x,this._layers[A]);return this},_addLayers:function(d){d=d?vt(d)?d:[d]:[];for(var x=0,A=d.length;x<A;x++)this.addLayer(d[x])},_addZoomLimit:function(d){(!isNaN(d.options.maxZoom)||!isNaN(d.options.minZoom))&&(this._zoomBoundLayers[R(d)]=d,this._updateZoomLevels())},_removeZoomLimit:function(d){var x=R(d);this._zoomBoundLayers[x]&&(delete this._zoomBoundLayers[x],this._updateZoomLevels())},_updateZoomLevels:function(){var d=1/0,x=-1/0,A=this._getZoomSpan();for(var F in this._zoomBoundLayers){var Z=this._zoomBoundLayers[F].options;d=Z.minZoom===void 0?d:Math.min(d,Z.minZoom),x=Z.maxZoom===void 0?x:Math.max(x,Z.maxZoom)}this._layersMaxZoom=x===-1/0?void 0:x,this._layersMinZoom=d===1/0?void 0:d,A!==this._getZoomSpan()&&this.fire("zoomlevelschange"),this.options.maxZoom===void 0&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),this.options.minZoom===void 0&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var sr=wi.extend({initialize:function(d,x){Se(this,x),this._layers={};var A,F;if(d)for(A=0,F=d.length;A<F;A++)this.addLayer(d[A])},addLayer:function(d){var x=this.getLayerId(d);return this._layers[x]=d,this._map&&this._map.addLayer(d),this},removeLayer:function(d){var x=d in this._layers?d:this.getLayerId(d);return this._map&&this._layers[x]&&this._map.removeLayer(this._layers[x]),delete this._layers[x],this},hasLayer:function(d){var x=typeof d=="number"?d:this.getLayerId(d);return x in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(d){var x=Array.prototype.slice.call(arguments,1),A,F;for(A in this._layers)F=this._layers[A],F[d]&&F[d].apply(F,x);return this},onAdd:function(d){this.eachLayer(d.addLayer,d)},onRemove:function(d){this.eachLayer(d.removeLayer,d)},eachLayer:function(d,x){for(var A in this._layers)d.call(x,this._layers[A]);return this},getLayer:function(d){return this._layers[d]},getLayers:function(){var d=[];return this.eachLayer(d.push,d),d},setZIndex:function(d){return this.invoke("setZIndex",d)},getLayerId:function(d){return R(d)}}),Ms=function(d,x){return new sr(d,x)},gr=sr.extend({addLayer:function(d){return this.hasLayer(d)?this:(d.addEventParent(this),sr.prototype.addLayer.call(this,d),this.fire("layeradd",{layer:d}))},removeLayer:function(d){return this.hasLayer(d)?(d in this._layers&&(d=this._layers[d]),d.removeEventParent(this),sr.prototype.removeLayer.call(this,d),this.fire("layerremove",{layer:d})):this},setStyle:function(d){return this.invoke("setStyle",d)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var d=new Qt;for(var x in this._layers){var A=this._layers[x];d.extend(A.getBounds?A.getBounds():A.getLatLng())}return d}}),Wa=function(d,x){return new gr(d,x)},Rs=pn.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(d){Se(this,d)},createIcon:function(d){return this._createIcon("icon",d)},createShadow:function(d){return this._createIcon("shadow",d)},_createIcon:function(d,x){var A=this._getIconUrl(d);if(!A){if(d==="icon")throw new Error("iconUrl not set in Icon options (see the docs).");return null}var F=this._createImg(A,x&&x.tagName==="IMG"?x:null);return this._setIconStyles(F,d),(this.options.crossOrigin||this.options.crossOrigin==="")&&(F.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),F},_setIconStyles:function(d,x){var A=this.options,F=A[x+"Size"];typeof F=="number"&&(F=[F,F]);var Z=St(F),he=St(x==="shadow"&&A.shadowAnchor||A.iconAnchor||Z&&Z.divideBy(2,!0));d.className="leaflet-marker-"+x+" "+(A.className||""),he&&(d.style.marginLeft=-he.x+"px",d.style.marginTop=-he.y+"px"),Z&&(d.style.width=Z.x+"px",d.style.height=Z.y+"px")},_createImg:function(d,x){return x=x||document.createElement("img"),x.src=d,x},_getIconUrl:function(d){return Lt.retina&&this.options[d+"RetinaUrl"]||this.options[d+"Url"]}});function Cc(d){return new Rs(d)}var yl=Rs.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(d){return typeof yl.imagePath!="string"&&(yl.imagePath=this._detectIconPath()),(this.options.imagePath||yl.imagePath)+Rs.prototype._getIconUrl.call(this,d)},_stripUrl:function(d){var x=function(A,F,Z){var he=F.exec(A);return he&&he[Z]};return d=x(d,/^url\((['"])?(.+)\1\)$/,2),d&&x(d,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var d=An("div","leaflet-default-icon-path",document.body),x=wa(d,"background-image")||wa(d,"backgroundImage");if(document.body.removeChild(d),x=this._stripUrl(x),x)return x;var A=document.querySelector('link[href$="leaflet.css"]');return A?A.href.substring(0,A.href.length-11-1):""}}),ql=Eo.extend({initialize:function(d){this._marker=d},addHooks:function(){var d=this._marker._icon;this._draggable||(this._draggable=new tr(d,d,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),Dn(d,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&fi(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(d){var x=this._marker,A=x._map,F=this._marker.options.autoPanSpeed,Z=this._marker.options.autoPanPadding,he=Gr(x._icon),Oe=A.getPixelBounds(),rt=A.getPixelOrigin(),dt=wt(Oe.min._subtract(rt).add(Z),Oe.max._subtract(rt).subtract(Z));if(!dt.contains(he)){var kt=St((Math.max(dt.max.x,he.x)-dt.max.x)/(Oe.max.x-dt.max.x)-(Math.min(dt.min.x,he.x)-dt.min.x)/(Oe.min.x-dt.min.x),(Math.max(dt.max.y,he.y)-dt.max.y)/(Oe.max.y-dt.max.y)-(Math.min(dt.min.y,he.y)-dt.min.y)/(Oe.min.y-dt.min.y)).multiplyBy(F);A.panBy(kt,{animate:!1}),this._draggable._newPos._add(kt),this._draggable._startPos._add(kt),On(x._icon,this._draggable._newPos),this._onDrag(d),this._panRequest=Ae(this._adjustPan.bind(this,d))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(d){this._marker.options.autoPan&&($e(this._panRequest),this._panRequest=Ae(this._adjustPan.bind(this,d)))},_onDrag:function(d){var x=this._marker,A=x._shadow,F=Gr(x._icon),Z=x._map.layerPointToLatLng(F);A&&On(A,F),x._latlng=Z,d.latlng=Z,d.oldLatLng=this._oldLatLng,x.fire("move",d).fire("drag",d)},_onDragEnd:function(d){$e(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",d)}}),io=wi.extend({options:{icon:new yl,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(d,x){Se(this,x),this._latlng=nn(d)},onAdd:function(d){this._zoomAnimated=this._zoomAnimated&&d.options.markerZoomAnimation,this._zoomAnimated&&d.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(d){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&d.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(d){var x=this._latlng;return this._latlng=nn(d),this.update(),this.fire("move",{oldLatLng:x,latlng:this._latlng})},setZIndexOffset:function(d){return this.options.zIndexOffset=d,this.update()},getIcon:function(){return this.options.icon},setIcon:function(d){return this.options.icon=d,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var d=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(d)}return this},_initIcon:function(){var d=this.options,x="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),A=d.icon.createIcon(this._icon),F=!1;A!==this._icon&&(this._icon&&this._removeIcon(),F=!0,d.title&&(A.title=d.title),A.tagName==="IMG"&&(A.alt=d.alt||"")),Dn(A,x),d.keyboard&&(A.tabIndex="0",A.setAttribute("role","button")),this._icon=A,d.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&hn(A,"focus",this._panOnFocus,this);var Z=d.icon.createShadow(this._shadow),he=!1;Z!==this._shadow&&(this._removeShadow(),he=!0),Z&&(Dn(Z,x),Z.alt=""),this._shadow=Z,d.opacity<1&&this._updateOpacity(),F&&this.getPane().appendChild(this._icon),this._initInteraction(),Z&&he&&this.getPane(d.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&si(this._icon,"focus",this._panOnFocus,this),Di(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&Di(this._shadow),this._shadow=null},_setPos:function(d){this._icon&&On(this._icon,d),this._shadow&&On(this._shadow,d),this._zIndex=d.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(d){this._icon&&(this._icon.style.zIndex=this._zIndex+d)},_animateZoom:function(d){var x=this._map._latLngToNewLayerPoint(this._latlng,d.zoom,d.center).round();this._setPos(x)},_initInteraction:function(){if(this.options.interactive&&(Dn(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),ql)){var d=this.options.draggable;this.dragging&&(d=this.dragging.enabled(),this.dragging.disable()),this.dragging=new ql(this),d&&this.dragging.enable()}},setOpacity:function(d){return this.options.opacity=d,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var d=this.options.opacity;this._icon&&ln(this._icon,d),this._shadow&&ln(this._shadow,d)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var d=this._map;if(d){var x=this.options.icon.options,A=x.iconSize?St(x.iconSize):St(0,0),F=x.iconAnchor?St(x.iconAnchor):St(0,0);d.panInside(this._latlng,{paddingTopLeft:F,paddingBottomRight:A.subtract(F)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});function yh(d,x){return new io(d,x)}var Sa=wi.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(d){this._renderer=d.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(d){return Se(this,d),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&d&&Object.prototype.hasOwnProperty.call(d,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),Gl=Sa.extend({options:{fill:!0,radius:10},initialize:function(d,x){Se(this,x),this._latlng=nn(d),this._radius=this.options.radius},setLatLng:function(d){var x=this._latlng;return this._latlng=nn(d),this.redraw(),this.fire("move",{oldLatLng:x,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(d){return this.options.radius=this._radius=d,this.redraw()},getRadius:function(){return this._radius},setStyle:function(d){var x=d&&d.radius||this._radius;return Sa.prototype.setStyle.call(this,d),this.setRadius(x),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var d=this._radius,x=this._radiusY||d,A=this._clickTolerance(),F=[d+A,x+A];this._pxBounds=new Ze(this._point.subtract(F),this._point.add(F))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(d){return d.distanceTo(this._point)<=this._radius+this._clickTolerance()}});function vh(d,x){return new Gl(d,x)}var xu=Gl.extend({initialize:function(d,x,A){if(typeof x=="number"&&(x=h({},A,{radius:x})),Se(this,x),this._latlng=nn(d),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(d){return this._mRadius=d,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var d=[this._radius,this._radiusY||this._radius];return new Qt(this._map.layerPointToLatLng(this._point.subtract(d)),this._map.layerPointToLatLng(this._point.add(d)))},setStyle:Sa.prototype.setStyle,_project:function(){var d=this._latlng.lng,x=this._latlng.lat,A=this._map,F=A.options.crs;if(F.distance===$n.distance){var Z=Math.PI/180,he=this._mRadius/$n.R/Z,Oe=A.project([x+he,d]),rt=A.project([x-he,d]),dt=Oe.add(rt).divideBy(2),kt=A.unproject(dt).lat,tn=Math.acos((Math.cos(he*Z)-Math.sin(x*Z)*Math.sin(kt*Z))/(Math.cos(x*Z)*Math.cos(kt*Z)))/Z;(isNaN(tn)||tn===0)&&(tn=he/Math.cos(Math.PI/180*x)),this._point=dt.subtract(A.getPixelOrigin()),this._radius=isNaN(tn)?0:dt.x-A.project([kt,d-tn]).x,this._radiusY=dt.y-Oe.y}else{var Sn=F.unproject(F.project(this._latlng).subtract([this._mRadius,0]));this._point=A.latLngToLayerPoint(this._latlng),this._radius=this._point.x-A.latLngToLayerPoint(Sn).x}this._updateBounds()}});function Xs(d,x,A){return new xu(d,x,A)}var Co=Sa.extend({options:{smoothFactor:1,noClip:!1},initialize:function(d,x){Se(this,x),this._setLatLngs(d)},getLatLngs:function(){return this._latlngs},setLatLngs:function(d){return this._setLatLngs(d),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(d){for(var x=1/0,A=null,F=Po,Z,he,Oe=0,rt=this._parts.length;Oe<rt;Oe++)for(var dt=this._parts[Oe],kt=1,tn=dt.length;kt<tn;kt++){Z=dt[kt-1],he=dt[kt];var Sn=F(d,Z,he,!0);Sn<x&&(x=Sn,A=F(d,Z,he))}return A&&(A.distance=Math.sqrt(x)),A},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return Y(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(d,x){return x=x||this._defaultShape(),d=nn(d),x.push(d),this._bounds.extend(d),this.redraw()},_setLatLngs:function(d){this._bounds=new Qt,this._latlngs=this._convertLatLngs(d)},_defaultShape:function(){return P(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(d){for(var x=[],A=P(d),F=0,Z=d.length;F<Z;F++)A?(x[F]=nn(d[F]),this._bounds.extend(x[F])):x[F]=this._convertLatLngs(d[F]);return x},_project:function(){var d=new Ze;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,d),this._bounds.isValid()&&d.isValid()&&(this._rawPxBounds=d,this._updateBounds())},_updateBounds:function(){var d=this._clickTolerance(),x=new Tt(d,d);this._rawPxBounds&&(this._pxBounds=new Ze([this._rawPxBounds.min.subtract(x),this._rawPxBounds.max.add(x)]))},_projectLatlngs:function(d,x,A){var F=d[0]instanceof Xt,Z=d.length,he,Oe;if(F){for(Oe=[],he=0;he<Z;he++)Oe[he]=this._map.latLngToLayerPoint(d[he]),A.extend(Oe[he]);x.push(Oe)}else for(he=0;he<Z;he++)this._projectLatlngs(d[he],x,A)},_clipPoints:function(){var d=this._renderer._bounds;if(this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(d))){if(this.options.noClip){this._parts=this._rings;return}var x=this._parts,A,F,Z,he,Oe,rt,dt;for(A=0,Z=0,he=this._rings.length;A<he;A++)for(dt=this._rings[A],F=0,Oe=dt.length;F<Oe-1;F++)rt=ls(dt[F],dt[F+1],d,F,!0),rt&&(x[Z]=x[Z]||[],x[Z].push(rt[0]),(rt[1]!==dt[F+1]||F===Oe-2)&&(x[Z].push(rt[1]),Z++))}},_simplifyPoints:function(){for(var d=this._parts,x=this.options.smoothFactor,A=0,F=d.length;A<F;A++)d[A]=Ul(d[A],x)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(d,x){var A,F,Z,he,Oe,rt,dt=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(d))return!1;for(A=0,he=this._parts.length;A<he;A++)for(rt=this._parts[A],F=0,Oe=rt.length,Z=Oe-1;F<Oe;Z=F++)if(!(!x&&F===0)&&jl(d,rt[Z],rt[F])<=dt)return!0;return!1}});function _i(d,x){return new Co(d,x)}Co._flat=j;var Ka=Co.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return Ks(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(d){var x=Co.prototype._convertLatLngs.call(this,d),A=x.length;return A>=2&&x[0]instanceof Xt&&x[0].equals(x[A-1])&&x.pop(),x},_setLatLngs:function(d){Co.prototype._setLatLngs.call(this,d),P(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return P(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var d=this._renderer._bounds,x=this.options.weight,A=new Tt(x,x);if(d=new Ze(d.min.subtract(A),d.max.add(A)),this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(d))){if(this.options.noClip){this._parts=this._rings;return}for(var F=0,Z=this._rings.length,he;F<Z;F++)he=Ws(this._rings[F],d,!0),he.length&&this._parts.push(he)}},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(d){var x=!1,A,F,Z,he,Oe,rt,dt,kt;if(!this._pxBounds||!this._pxBounds.contains(d))return!1;for(he=0,dt=this._parts.length;he<dt;he++)for(A=this._parts[he],Oe=0,kt=A.length,rt=kt-1;Oe<kt;rt=Oe++)F=A[Oe],Z=A[rt],F.y>d.y!=Z.y>d.y&&d.x<(Z.x-F.x)*(d.y-F.y)/(Z.y-F.y)+F.x&&(x=!x);return x||Co.prototype._containsPoint.call(this,d,!0)}});function qd(d,x){return new Ka(d,x)}var Ea=gr.extend({initialize:function(d,x){Se(this,x),this._layers={},d&&this.addData(d)},addData:function(d){var x=vt(d)?d:d.features,A,F,Z;if(x){for(A=0,F=x.length;A<F;A++)Z=x[A],(Z.geometries||Z.geometry||Z.features||Z.coordinates)&&this.addData(Z);return this}var he=this.options;if(he.filter&&!he.filter(d))return this;var Oe=Zl(d,he);return Oe?(Oe.feature=Ia(d),Oe.defaultOptions=Oe.options,this.resetStyle(Oe),he.onEachFeature&&he.onEachFeature(d,Oe),this.addLayer(Oe)):this},resetStyle:function(d){return d===void 0?this.eachLayer(this.resetStyle,this):(d.options=h({},d.defaultOptions),this._setLayerStyle(d,this.options.style),this)},setStyle:function(d){return this.eachLayer(function(x){this._setLayerStyle(x,d)},this)},_setLayerStyle:function(d,x){d.setStyle&&(typeof x=="function"&&(x=x(d.feature)),d.setStyle(x))}});function Zl(d,x){var A=d.type==="Feature"?d.geometry:d,F=A?A.coordinates:null,Z=[],he=x&&x.pointToLayer,Oe=x&&x.coordsToLatLng||Hu,rt,dt,kt,tn;if(!F&&!A)return null;switch(A.type){case"Point":return rt=Oe(F),Ac(he,d,rt,x);case"MultiPoint":for(kt=0,tn=F.length;kt<tn;kt++)rt=Oe(F[kt]),Z.push(Ac(he,d,rt,x));return new gr(Z);case"LineString":case"MultiLineString":return dt=vl(F,A.type==="LineString"?0:1,Oe),new Co(dt,x);case"Polygon":case"MultiPolygon":return dt=vl(F,A.type==="Polygon"?1:2,Oe),new Ka(dt,x);case"GeometryCollection":for(kt=0,tn=A.geometries.length;kt<tn;kt++){var Sn=Zl({geometry:A.geometries[kt],type:"Feature",properties:d.properties},x);Sn&&Z.push(Sn)}return new gr(Z);case"FeatureCollection":for(kt=0,tn=A.features.length;kt<tn;kt++){var Gn=Zl(A.features[kt],x);Gn&&Z.push(Gn)}return new gr(Z);default:throw new Error("Invalid GeoJSON object.")}}function Ac(d,x,A,F){return d?d(x,A):new io(A,F&&F.markersInheritOptions&&F)}function Hu(d){return new Xt(d[1],d[0],d[2])}function vl(d,x,A){for(var F=[],Z=0,he=d.length,Oe;Z<he;Z++)Oe=x?vl(d[Z],x-1,A):(A||Hu)(d[Z]),F.push(Oe);return F}function Wl(d,x){return d=nn(d),d.alt!==void 0?[re(d.lng,x),re(d.lat,x),re(d.alt,x)]:[re(d.lng,x),re(d.lat,x)]}function Kl(d,x,A,F){for(var Z=[],he=0,Oe=d.length;he<Oe;he++)Z.push(x?Kl(d[he],P(d[he])?0:x-1,A,F):Wl(d[he],F));return!x&&A&&Z.length>0&&Z.push(Z[0].slice()),Z}function xl(d,x){return d.feature?h({},d.feature,{geometry:x}):Ia(x)}function Ia(d){return d.type==="Feature"||d.type==="FeatureCollection"?d:{type:"Feature",properties:{},geometry:d}}var wl={toGeoJSON:function(d){return xl(this,{type:"Point",coordinates:Wl(this.getLatLng(),d)})}};io.include(wl),xu.include(wl),Gl.include(wl),Co.include({toGeoJSON:function(d){var x=!P(this._latlngs),A=Kl(this._latlngs,x?1:0,!1,d);return xl(this,{type:(x?"Multi":"")+"LineString",coordinates:A})}}),Ka.include({toGeoJSON:function(d){var x=!P(this._latlngs),A=x&&!P(this._latlngs[0]),F=Kl(this._latlngs,A?2:x?1:0,!0,d);return x||(F=[F]),xl(this,{type:(A?"Multi":"")+"Polygon",coordinates:F})}}),sr.include({toMultiPoint:function(d){var x=[];return this.eachLayer(function(A){x.push(A.toGeoJSON(d).geometry.coordinates)}),xl(this,{type:"MultiPoint",coordinates:x})},toGeoJSON:function(d){var x=this.feature&&this.feature.geometry&&this.feature.geometry.type;if(x==="MultiPoint")return this.toMultiPoint(d);var A=x==="GeometryCollection",F=[];return this.eachLayer(function(Z){if(Z.toGeoJSON){var he=Z.toGeoJSON(d);if(A)F.push(he.geometry);else{var Oe=Ia(he);Oe.type==="FeatureCollection"?F.push.apply(F,Oe.features):F.push(Oe)}}}),A?xl(this,{geometries:F,type:"GeometryCollection"}):{type:"FeatureCollection",features:F}}});function us(d,x){return new Ea(d,x)}var Ls=us,Xa=wi.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(d,x,A){this._url=d,this._bounds=sn(x),Se(this,A)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(Dn(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){Di(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(d){return this.options.opacity=d,this._image&&this._updateOpacity(),this},setStyle:function(d){return d.opacity&&this.setOpacity(d.opacity),this},bringToFront:function(){return this._map&&To(this._image),this},bringToBack:function(){return this._map&&rs(this._image),this},setUrl:function(d){return this._url=d,this._image&&(this._image.src=d),this},setBounds:function(d){return this._bounds=sn(d),this._map&&this._reset(),this},getEvents:function(){var d={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(d.zoomanim=this._animateZoom),d},setZIndex:function(d){return this.options.zIndex=d,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var d=this._url.tagName==="IMG",x=this._image=d?this._url:An("img");if(Dn(x,"leaflet-image-layer"),this._zoomAnimated&&Dn(x,"leaflet-zoom-animated"),this.options.className&&Dn(x,this.options.className),x.onselectstart=ne,x.onmousemove=ne,x.onload=_(this.fire,this,"load"),x.onerror=_(this._overlayOnError,this,"error"),(this.options.crossOrigin||this.options.crossOrigin==="")&&(x.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),d){this._url=x.src;return}x.src=this._url,x.alt=this.options.alt},_animateZoom:function(d){var x=this._map.getZoomScale(d.zoom),A=this._map._latLngBoundsToNewLayerBounds(this._bounds,d.zoom,d.center).min;eo(this._image,A,x)},_reset:function(){var d=this._image,x=new Ze(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),A=x.getSize();On(d,x.min),d.style.width=A.x+"px",d.style.height=A.y+"px"},_updateOpacity:function(){ln(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var d=this.options.errorOverlayUrl;d&&this._url!==d&&(this._url=d,this._image.src=d)},getCenter:function(){return this._bounds.getCenter()}}),kc=function(d,x,A){return new Xa(d,x,A)},Ya=Xa.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var d=this._url.tagName==="VIDEO",x=this._image=d?this._url:An("video");if(Dn(x,"leaflet-image-layer"),this._zoomAnimated&&Dn(x,"leaflet-zoom-animated"),this.options.className&&Dn(x,this.options.className),x.onselectstart=ne,x.onmousemove=ne,x.onloadeddata=_(this.fire,this,"load"),d){for(var A=x.getElementsByTagName("source"),F=[],Z=0;Z<A.length;Z++)F.push(A[Z].src);this._url=A.length>0?F:[x.src];return}vt(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(x.style,"objectFit")&&(x.style.objectFit="fill"),x.autoplay=!!this.options.autoplay,x.loop=!!this.options.loop,x.muted=!!this.options.muted,x.playsInline=!!this.options.playsInline;for(var he=0;he<this._url.length;he++){var Oe=An("source");Oe.src=this._url[he],x.appendChild(Oe)}}});function qu(d,x,A){return new Ya(d,x,A)}var wu=Xa.extend({_initImage:function(){var d=this._image=this._url;Dn(d,"leaflet-image-layer"),this._zoomAnimated&&Dn(d,"leaflet-zoom-animated"),this.options.className&&Dn(d,this.options.className),d.onselectstart=ne,d.onmousemove=ne}});function Xl(d,x,A){return new wu(d,x,A)}var cs=wi.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(d,x){d&&(d instanceof Xt||vt(d))?(this._latlng=nn(d),Se(this,x)):(Se(this,d),this._source=x),this.options.content&&(this._content=this.options.content)},openOn:function(d){return d=arguments.length?d:this._source._map,d.hasLayer(this)||d.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(d){return this._map?this.close():(arguments.length?this._source=d:d=this._source,this._prepareOpen(),this.openOn(d._map)),this},onAdd:function(d){this._zoomAnimated=d._zoomAnimated,this._container||this._initLayout(),d._fadeAnimated&&ln(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),d._fadeAnimated&&ln(this._container,1),this.bringToFront(),this.options.interactive&&(Dn(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(d){d._fadeAnimated?(ln(this._container,0),this._removeTimeout=setTimeout(_(Di,void 0,this._container),200)):Di(this._container),this.options.interactive&&(fi(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(d){return this._latlng=nn(d),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(d){return this._content=d,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var d={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(d.zoomanim=this._animateZoom),d},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&To(this._container),this},bringToBack:function(){return this._map&&rs(this._container),this},_prepareOpen:function(d){var x=this._source;if(!x._map)return!1;if(x instanceof gr){x=null;var A=this._source._layers;for(var F in A)if(A[F]._map){x=A[F];break}if(!x)return!1;this._source=x}if(!d)if(x.getCenter)d=x.getCenter();else if(x.getLatLng)d=x.getLatLng();else if(x.getBounds)d=x.getBounds().getCenter();else throw new Error("Unable to get source layer LatLng.");return this.setLatLng(d),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var d=this._contentNode,x=typeof this._content=="function"?this._content(this._source||this):this._content;if(typeof x=="string")d.innerHTML=x;else{for(;d.hasChildNodes();)d.removeChild(d.firstChild);d.appendChild(x)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var d=this._map.latLngToLayerPoint(this._latlng),x=St(this.options.offset),A=this._getAnchor();this._zoomAnimated?On(this._container,d.add(A)):x=x.add(d).add(A);var F=this._containerBottom=-x.y,Z=this._containerLeft=-Math.round(this._containerWidth/2)+x.x;this._container.style.bottom=F+"px",this._container.style.left=Z+"px"}},_getAnchor:function(){return[0,0]}});ei.include({_initOverlay:function(d,x,A,F){var Z=x;return Z instanceof d||(Z=new d(F).setContent(x)),A&&Z.setLatLng(A),Z}}),wi.include({_initOverlay:function(d,x,A,F){var Z=A;return Z instanceof d?(Se(Z,F),Z._source=this):(Z=x&&!F?x:new d(F,this),Z.setContent(A)),Z}});var Gu=cs.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(d){return d=arguments.length?d:this._source._map,!d.hasLayer(this)&&d._popup&&d._popup.options.autoClose&&d.removeLayer(d._popup),d._popup=this,cs.prototype.openOn.call(this,d)},onAdd:function(d){cs.prototype.onAdd.call(this,d),d.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof Sa||this._source.on("preclick",xn))},onRemove:function(d){cs.prototype.onRemove.call(this,d),d.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof Sa||this._source.off("preclick",xn))},getEvents:function(){var d=cs.prototype.getEvents.call(this);return(this.options.closeOnClick!==void 0?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(d.preclick=this.close),this.options.keepInView&&(d.moveend=this._adjustPan),d},_initLayout:function(){var d="leaflet-popup",x=this._container=An("div",d+" "+(this.options.className||"")+" leaflet-zoom-animated"),A=this._wrapper=An("div",d+"-content-wrapper",x);if(this._contentNode=An("div",d+"-content",A),Hn(x),os(this._contentNode),hn(x,"contextmenu",xn),this._tipContainer=An("div",d+"-tip-container",x),this._tip=An("div",d+"-tip",this._tipContainer),this.options.closeButton){var F=this._closeButton=An("a",d+"-close-button",x);F.setAttribute("role","button"),F.setAttribute("aria-label","Close popup"),F.href="#close",F.innerHTML='<span aria-hidden="true">&#215;</span>',hn(F,"click",function(Z){gi(Z),this.close()},this)}},_updateLayout:function(){var d=this._contentNode,x=d.style;x.width="",x.whiteSpace="nowrap";var A=d.offsetWidth;A=Math.min(A,this.options.maxWidth),A=Math.max(A,this.options.minWidth),x.width=A+1+"px",x.whiteSpace="",x.height="";var F=d.offsetHeight,Z=this.options.maxHeight,he="leaflet-popup-scrolled";Z&&F>Z?(x.height=Z+"px",Dn(d,he)):fi(d,he),this._containerWidth=this._container.offsetWidth},_animateZoom:function(d){var x=this._map._latLngToNewLayerPoint(this._latlng,d.zoom,d.center),A=this._getAnchor();On(this._container,x.add(A))},_adjustPan:function(){if(this.options.autoPan){if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning){this._autopanning=!1;return}var d=this._map,x=parseInt(wa(this._container,"marginBottom"),10)||0,A=this._container.offsetHeight+x,F=this._containerWidth,Z=new Tt(this._containerLeft,-A-this._containerBottom);Z._add(Gr(this._container));var he=d.layerPointToContainerPoint(Z),Oe=St(this.options.autoPanPadding),rt=St(this.options.autoPanPaddingTopLeft||Oe),dt=St(this.options.autoPanPaddingBottomRight||Oe),kt=d.getSize(),tn=0,Sn=0;he.x+F+dt.x>kt.x&&(tn=he.x+F-kt.x+dt.x),he.x-tn-rt.x<0&&(tn=he.x-rt.x),he.y+A+dt.y>kt.y&&(Sn=he.y+A-kt.y+dt.y),he.y-Sn-rt.y<0&&(Sn=he.y-rt.y),(tn||Sn)&&(this.options.keepInView&&(this._autopanning=!0),d.fire("autopanstart").panBy([tn,Sn]))}},_getAnchor:function(){return St(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),Ys=function(d,x){return new Gu(d,x)};ei.mergeOptions({closePopupOnClick:!0}),ei.include({openPopup:function(d,x,A){return this._initOverlay(Gu,d,x,A).openOn(this),this},closePopup:function(d){return d=arguments.length?d:this._popup,d&&d.close(),this}}),wi.include({bindPopup:function(d,x){return this._popup=this._initOverlay(Gu,this._popup,d,x),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(d){return this._popup&&(this instanceof gr||(this._popup._source=this),this._popup._prepareOpen(d||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return this._popup?this._popup.isOpen():!1},setPopupContent:function(d){return this._popup&&this._popup.setContent(d),this},getPopup:function(){return this._popup},_openPopup:function(d){if(!(!this._popup||!this._map)){Xi(d);var x=d.layer||d.target;if(this._popup._source===x&&!(x instanceof Sa)){this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(d.latlng);return}this._popup._source=x,this.openPopup(d.latlng)}},_movePopup:function(d){this._popup.setLatLng(d.latlng)},_onKeyPress:function(d){d.originalEvent.keyCode===13&&this._openPopup(d)}});var Qs=cs.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(d){cs.prototype.onAdd.call(this,d),this.setOpacity(this.options.opacity),d.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(d){cs.prototype.onRemove.call(this,d),d.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var d=cs.prototype.getEvents.call(this);return this.options.permanent||(d.preclick=this.close),d},_initLayout:function(){var d="leaflet-tooltip",x=d+" "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=An("div",x),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+R(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(d){var x,A,F=this._map,Z=this._container,he=F.latLngToContainerPoint(F.getCenter()),Oe=F.layerPointToContainerPoint(d),rt=this.options.direction,dt=Z.offsetWidth,kt=Z.offsetHeight,tn=St(this.options.offset),Sn=this._getAnchor();rt==="top"?(x=dt/2,A=kt):rt==="bottom"?(x=dt/2,A=0):rt==="center"?(x=dt/2,A=kt/2):rt==="right"?(x=0,A=kt/2):rt==="left"?(x=dt,A=kt/2):Oe.x<he.x?(rt="right",x=0,A=kt/2):(rt="left",x=dt+(tn.x+Sn.x)*2,A=kt/2),d=d.subtract(St(x,A,!0)).add(tn).add(Sn),fi(Z,"leaflet-tooltip-right"),fi(Z,"leaflet-tooltip-left"),fi(Z,"leaflet-tooltip-top"),fi(Z,"leaflet-tooltip-bottom"),Dn(Z,"leaflet-tooltip-"+rt),On(Z,d)},_updatePosition:function(){var d=this._map.latLngToLayerPoint(this._latlng);this._setPosition(d)},setOpacity:function(d){this.options.opacity=d,this._container&&ln(this._container,d)},_animateZoom:function(d){var x=this._map._latLngToNewLayerPoint(this._latlng,d.zoom,d.center);this._setPosition(x)},_getAnchor:function(){return St(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),bu=function(d,x){return new Qs(d,x)};ei.include({openTooltip:function(d,x,A){return this._initOverlay(Qs,d,x,A).openOn(this),this},closeTooltip:function(d){return d.close(),this}}),wi.include({bindTooltip:function(d,x){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(Qs,this._tooltip,d,x),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(d){if(!(!d&&this._tooltipHandlersAdded)){var x=d?"off":"on",A={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?A.add=this._openTooltip:(A.mouseover=this._openTooltip,A.mouseout=this.closeTooltip,A.click=this._openTooltip,this._map?this._addFocusListeners():A.add=this._addFocusListeners),this._tooltip.options.sticky&&(A.mousemove=this._moveTooltip),this[x](A),this._tooltipHandlersAdded=!d}},openTooltip:function(d){return this._tooltip&&(this instanceof gr||(this._tooltip._source=this),this._tooltip._prepareOpen(d)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(d){return this._tooltip&&this._tooltip.setContent(d),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(d){var x=typeof d.getElement=="function"&&d.getElement();x&&(hn(x,"focus",function(){this._tooltip._source=d,this.openTooltip()},this),hn(x,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(d){var x=typeof d.getElement=="function"&&d.getElement();x&&x.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(d){if(!(!this._tooltip||!this._map)){if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var x=this;this._map.once("moveend",function(){x._openOnceFlag=!1,x._openTooltip(d)});return}this._tooltip._source=d.layer||d.target,this.openTooltip(this._tooltip.options.sticky?d.latlng:void 0)}},_moveTooltip:function(d){var x=d.latlng,A,F;this._tooltip.options.sticky&&d.originalEvent&&(A=this._map.mouseEventToContainerPoint(d.originalEvent),F=this._map.containerPointToLayerPoint(A),x=this._map.layerPointToLatLng(F)),this._tooltip.setLatLng(x)}});var Tu=Rs.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(d){var x=d&&d.tagName==="DIV"?d:document.createElement("div"),A=this.options;if(A.html instanceof Element?(pl(x),x.appendChild(A.html)):x.innerHTML=A.html!==!1?A.html:"",A.bgPos){var F=St(A.bgPos);x.style.backgroundPosition=-F.x+"px "+-F.y+"px"}return this._setIconStyles(x,"icon"),x},createShadow:function(){return null}});function li(d){return new Tu(d)}Rs.Default=yl;var Js=wi.extend({options:{tileSize:256,opacity:1,updateWhenIdle:Lt.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(d){Se(this,d)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(d){d._addZoomLimit(this)},onRemove:function(d){this._removeAllTiles(),Di(this._container),d._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(To(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(rs(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(d){return this.options.opacity=d,this._updateOpacity(),this},setZIndex:function(d){return this.options.zIndex=d,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var d=this._clampZoom(this._map.getZoom());d!==this._tileZoom&&(this._tileZoom=d,this._updateLevels()),this._update()}return this},getEvents:function(){var d={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=O(this._onMoveEnd,this.options.updateInterval,this)),d.move=this._onMove),this._zoomAnimated&&(d.zoomanim=this._animateZoom),d},createTile:function(){return document.createElement("div")},getTileSize:function(){var d=this.options.tileSize;return d instanceof Tt?d:new Tt(d,d)},_updateZIndex:function(){this._container&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(d){for(var x=this.getPane().children,A=-d(-1/0,1/0),F=0,Z=x.length,he;F<Z;F++)he=x[F].style.zIndex,x[F]!==this._container&&he&&(A=d(A,+he));isFinite(A)&&(this.options.zIndex=A+d(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!Lt.ielt9){ln(this._container,this.options.opacity);var d=+new Date,x=!1,A=!1;for(var F in this._tiles){var Z=this._tiles[F];if(!(!Z.current||!Z.loaded)){var he=Math.min(1,(d-Z.loaded)/200);ln(Z.el,he),he<1?x=!0:(Z.active?A=!0:this._onOpaqueTile(Z),Z.active=!0)}}A&&!this._noPrune&&this._pruneTiles(),x&&($e(this._fadeFrame),this._fadeFrame=Ae(this._updateOpacity,this))}},_onOpaqueTile:ne,_initContainer:function(){this._container||(this._container=An("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var d=this._tileZoom,x=this.options.maxZoom;if(d!==void 0){for(var A in this._levels)A=Number(A),this._levels[A].el.children.length||A===d?(this._levels[A].el.style.zIndex=x-Math.abs(d-A),this._onUpdateLevel(A)):(Di(this._levels[A].el),this._removeTilesAtZoom(A),this._onRemoveLevel(A),delete this._levels[A]);var F=this._levels[d],Z=this._map;return F||(F=this._levels[d]={},F.el=An("div","leaflet-tile-container leaflet-zoom-animated",this._container),F.el.style.zIndex=x,F.origin=Z.project(Z.unproject(Z.getPixelOrigin()),d).round(),F.zoom=d,this._setZoomTransform(F,Z.getCenter(),Z.getZoom()),ne(F.el.offsetWidth),this._onCreateLevel(F)),this._level=F,F}},_onUpdateLevel:ne,_onRemoveLevel:ne,_onCreateLevel:ne,_pruneTiles:function(){if(this._map){var d,x,A=this._map.getZoom();if(A>this.options.maxZoom||A<this.options.minZoom){this._removeAllTiles();return}for(d in this._tiles)x=this._tiles[d],x.retain=x.current;for(d in this._tiles)if(x=this._tiles[d],x.current&&!x.active){var F=x.coords;this._retainParent(F.x,F.y,F.z,F.z-5)||this._retainChildren(F.x,F.y,F.z,F.z+2)}for(d in this._tiles)this._tiles[d].retain||this._removeTile(d)}},_removeTilesAtZoom:function(d){for(var x in this._tiles)this._tiles[x].coords.z===d&&this._removeTile(x)},_removeAllTiles:function(){for(var d in this._tiles)this._removeTile(d)},_invalidateAll:function(){for(var d in this._levels)Di(this._levels[d].el),this._onRemoveLevel(Number(d)),delete this._levels[d];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(d,x,A,F){var Z=Math.floor(d/2),he=Math.floor(x/2),Oe=A-1,rt=new Tt(+Z,+he);rt.z=+Oe;var dt=this._tileCoordsToKey(rt),kt=this._tiles[dt];return kt&&kt.active?(kt.retain=!0,!0):(kt&&kt.loaded&&(kt.retain=!0),Oe>F?this._retainParent(Z,he,Oe,F):!1)},_retainChildren:function(d,x,A,F){for(var Z=2*d;Z<2*d+2;Z++)for(var he=2*x;he<2*x+2;he++){var Oe=new Tt(Z,he);Oe.z=A+1;var rt=this._tileCoordsToKey(Oe),dt=this._tiles[rt];if(dt&&dt.active){dt.retain=!0;continue}else dt&&dt.loaded&&(dt.retain=!0);A+1<F&&this._retainChildren(Z,he,A+1,F)}},_resetView:function(d){var x=d&&(d.pinch||d.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),x,x)},_animateZoom:function(d){this._setView(d.center,d.zoom,!0,d.noUpdate)},_clampZoom:function(d){var x=this.options;return x.minNativeZoom!==void 0&&d<x.minNativeZoom?x.minNativeZoom:x.maxNativeZoom!==void 0&&x.maxNativeZoom<d?x.maxNativeZoom:d},_setView:function(d,x,A,F){var Z=Math.round(x);this.options.maxZoom!==void 0&&Z>this.options.maxZoom||this.options.minZoom!==void 0&&Z<this.options.minZoom?Z=void 0:Z=this._clampZoom(Z);var he=this.options.updateWhenZooming&&Z!==this._tileZoom;(!F||he)&&(this._tileZoom=Z,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),Z!==void 0&&this._update(d),A||this._pruneTiles(),this._noPrune=!!A),this._setZoomTransforms(d,x)},_setZoomTransforms:function(d,x){for(var A in this._levels)this._setZoomTransform(this._levels[A],d,x)},_setZoomTransform:function(d,x,A){var F=this._map.getZoomScale(A,d.zoom),Z=d.origin.multiplyBy(F).subtract(this._map._getNewPixelOrigin(x,A)).round();Lt.any3d?eo(d.el,Z,F):On(d.el,Z)},_resetGrid:function(){var d=this._map,x=d.options.crs,A=this._tileSize=this.getTileSize(),F=this._tileZoom,Z=this._map.getPixelWorldBounds(this._tileZoom);Z&&(this._globalTileRange=this._pxBoundsToTileRange(Z)),this._wrapX=x.wrapLng&&!this.options.noWrap&&[Math.floor(d.project([0,x.wrapLng[0]],F).x/A.x),Math.ceil(d.project([0,x.wrapLng[1]],F).x/A.y)],this._wrapY=x.wrapLat&&!this.options.noWrap&&[Math.floor(d.project([x.wrapLat[0],0],F).y/A.x),Math.ceil(d.project([x.wrapLat[1],0],F).y/A.y)]},_onMoveEnd:function(){!this._map||this._map._animatingZoom||this._update()},_getTiledPixelBounds:function(d){var x=this._map,A=x._animatingZoom?Math.max(x._animateToZoom,x.getZoom()):x.getZoom(),F=x.getZoomScale(A,this._tileZoom),Z=x.project(d,this._tileZoom).floor(),he=x.getSize().divideBy(F*2);return new Ze(Z.subtract(he),Z.add(he))},_update:function(d){var x=this._map;if(x){var A=this._clampZoom(x.getZoom());if(d===void 0&&(d=x.getCenter()),this._tileZoom!==void 0){var F=this._getTiledPixelBounds(d),Z=this._pxBoundsToTileRange(F),he=Z.getCenter(),Oe=[],rt=this.options.keepBuffer,dt=new Ze(Z.getBottomLeft().subtract([rt,-rt]),Z.getTopRight().add([rt,-rt]));if(!(isFinite(Z.min.x)&&isFinite(Z.min.y)&&isFinite(Z.max.x)&&isFinite(Z.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var kt in this._tiles){var tn=this._tiles[kt].coords;(tn.z!==this._tileZoom||!dt.contains(new Tt(tn.x,tn.y)))&&(this._tiles[kt].current=!1)}if(Math.abs(A-this._tileZoom)>1){this._setView(d,A);return}for(var Sn=Z.min.y;Sn<=Z.max.y;Sn++)for(var Gn=Z.min.x;Gn<=Z.max.x;Gn++){var Cr=new Tt(Gn,Sn);if(Cr.z=this._tileZoom,!!this._isValidTile(Cr)){var Nr=this._tiles[this._tileCoordsToKey(Cr)];Nr?Nr.current=!0:Oe.push(Cr)}}if(Oe.sort(function(_o,Jl){return _o.distanceTo(he)-Jl.distanceTo(he)}),Oe.length!==0){this._loading||(this._loading=!0,this.fire("loading"));var Ao=document.createDocumentFragment();for(Gn=0;Gn<Oe.length;Gn++)this._addTile(Oe[Gn],Ao);this._level.el.appendChild(Ao)}}}},_isValidTile:function(d){var x=this._map.options.crs;if(!x.infinite){var A=this._globalTileRange;if(!x.wrapLng&&(d.x<A.min.x||d.x>A.max.x)||!x.wrapLat&&(d.y<A.min.y||d.y>A.max.y))return!1}if(!this.options.bounds)return!0;var F=this._tileCoordsToBounds(d);return sn(this.options.bounds).overlaps(F)},_keyToBounds:function(d){return this._tileCoordsToBounds(this._keyToTileCoords(d))},_tileCoordsToNwSe:function(d){var x=this._map,A=this.getTileSize(),F=d.scaleBy(A),Z=F.add(A),he=x.unproject(F,d.z),Oe=x.unproject(Z,d.z);return[he,Oe]},_tileCoordsToBounds:function(d){var x=this._tileCoordsToNwSe(d),A=new Qt(x[0],x[1]);return this.options.noWrap||(A=this._map.wrapLatLngBounds(A)),A},_tileCoordsToKey:function(d){return d.x+":"+d.y+":"+d.z},_keyToTileCoords:function(d){var x=d.split(":"),A=new Tt(+x[0],+x[1]);return A.z=+x[2],A},_removeTile:function(d){var x=this._tiles[d];x&&(Di(x.el),delete this._tiles[d],this.fire("tileunload",{tile:x.el,coords:this._keyToTileCoords(d)}))},_initTile:function(d){Dn(d,"leaflet-tile");var x=this.getTileSize();d.style.width=x.x+"px",d.style.height=x.y+"px",d.onselectstart=ne,d.onmousemove=ne,Lt.ielt9&&this.options.opacity<1&&ln(d,this.options.opacity)},_addTile:function(d,x){var A=this._getTilePos(d),F=this._tileCoordsToKey(d),Z=this.createTile(this._wrapCoords(d),_(this._tileReady,this,d));this._initTile(Z),this.createTile.length<2&&Ae(_(this._tileReady,this,d,null,Z)),On(Z,A),this._tiles[F]={el:Z,coords:d,current:!0},x.appendChild(Z),this.fire("tileloadstart",{tile:Z,coords:d})},_tileReady:function(d,x,A){x&&this.fire("tileerror",{error:x,tile:A,coords:d});var F=this._tileCoordsToKey(d);A=this._tiles[F],A&&(A.loaded=+new Date,this._map._fadeAnimated?(ln(A.el,0),$e(this._fadeFrame),this._fadeFrame=Ae(this._updateOpacity,this)):(A.active=!0,this._pruneTiles()),x||(Dn(A.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:A.el,coords:d})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),Lt.ielt9||!this._map._fadeAnimated?Ae(this._pruneTiles,this):setTimeout(_(this._pruneTiles,this),250)))},_getTilePos:function(d){return d.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(d){var x=new Tt(this._wrapX?G(d.x,this._wrapX):d.x,this._wrapY?G(d.y,this._wrapY):d.y);return x.z=d.z,x},_pxBoundsToTileRange:function(d){var x=this.getTileSize();return new Ze(d.min.unscaleBy(x).floor(),d.max.unscaleBy(x).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var d in this._tiles)if(!this._tiles[d].loaded)return!1;return!0}});function Su(d){return new Js(d)}var Qa=Js.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(d,x){this._url=d,x=Se(this,x),x.detectRetina&&Lt.retina&&x.maxZoom>0?(x.tileSize=Math.floor(x.tileSize/2),x.zoomReverse?(x.zoomOffset--,x.minZoom=Math.min(x.maxZoom,x.minZoom+1)):(x.zoomOffset++,x.maxZoom=Math.max(x.minZoom,x.maxZoom-1)),x.minZoom=Math.max(0,x.minZoom)):x.zoomReverse?x.minZoom=Math.min(x.maxZoom,x.minZoom):x.maxZoom=Math.max(x.minZoom,x.maxZoom),typeof x.subdomains=="string"&&(x.subdomains=x.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(d,x){return this._url===d&&x===void 0&&(x=!0),this._url=d,x||this.redraw(),this},createTile:function(d,x){var A=document.createElement("img");return hn(A,"load",_(this._tileOnLoad,this,x,A)),hn(A,"error",_(this._tileOnError,this,x,A)),(this.options.crossOrigin||this.options.crossOrigin==="")&&(A.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),typeof this.options.referrerPolicy=="string"&&(A.referrerPolicy=this.options.referrerPolicy),A.alt="",A.src=this.getTileUrl(d),A},getTileUrl:function(d){var x={r:Lt.retina?"@2x":"",s:this._getSubdomain(d),x:d.x,y:d.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var A=this._globalTileRange.max.y-d.y;this.options.tms&&(x.y=A),x["-y"]=A}return et(this._url,h(x,this.options))},_tileOnLoad:function(d,x){Lt.ielt9?setTimeout(_(d,this,null,x),0):d(null,x)},_tileOnError:function(d,x,A){var F=this.options.errorTileUrl;F&&x.getAttribute("src")!==F&&(x.src=F),d(A,x)},_onTileRemove:function(d){d.tile.onload=null},_getZoomForUrl:function(){var d=this._tileZoom,x=this.options.maxZoom,A=this.options.zoomReverse,F=this.options.zoomOffset;return A&&(d=x-d),d+F},_getSubdomain:function(d){var x=Math.abs(d.x+d.y)%this.options.subdomains.length;return this.options.subdomains[x]},_abortLoading:function(){var d,x;for(d in this._tiles)if(this._tiles[d].coords.z!==this._tileZoom&&(x=this._tiles[d].el,x.onload=ne,x.onerror=ne,!x.complete)){x.src=it;var A=this._tiles[d].coords;Di(x),delete this._tiles[d],this.fire("tileabort",{tile:x,coords:A})}},_removeTile:function(d){var x=this._tiles[d];if(x)return x.el.setAttribute("src",it),Js.prototype._removeTile.call(this,d)},_tileReady:function(d,x,A){if(!(!this._map||A&&A.getAttribute("src")===it))return Js.prototype._tileReady.call(this,d,x,A)}});function Yl(d,x){return new Qa(d,x)}var Ql=Qa.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(d,x){this._url=d;var A=h({},this.defaultWmsParams);for(var F in x)F in this.options||(A[F]=x[F]);x=Se(this,x);var Z=x.detectRetina&&Lt.retina?2:1,he=this.getTileSize();A.width=he.x*Z,A.height=he.y*Z,this.wmsParams=A},onAdd:function(d){this._crs=this.options.crs||d.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var x=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[x]=this._crs.code,Qa.prototype.onAdd.call(this,d)},getTileUrl:function(d){var x=this._tileCoordsToNwSe(d),A=this._crs,F=wt(A.project(x[0]),A.project(x[1])),Z=F.min,he=F.max,Oe=(this._wmsVersion>=1.3&&this._crs===cr?[Z.y,Z.x,he.y,he.x]:[Z.x,Z.y,he.x,he.y]).join(","),rt=Qa.prototype.getTileUrl.call(this,d);return rt+De(this.wmsParams,rt,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+Oe},setParams:function(d,x){return h(this.wmsParams,d),x||this.redraw(),this}});function rd(d,x){return new Ql(d,x)}Qa.WMS=Ql,Yl.wms=rd;var ea=wi.extend({options:{padding:.1},initialize:function(d){Se(this,d),R(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),Dn(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var d={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(d.zoomanim=this._onAnimZoom),d},_onAnimZoom:function(d){this._updateTransform(d.center,d.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(d,x){var A=this._map.getZoomScale(x,this._zoom),F=this._map.getSize().multiplyBy(.5+this.options.padding),Z=this._map.project(this._center,x),he=F.multiplyBy(-A).add(Z).subtract(this._map._getNewPixelOrigin(d,x));Lt.any3d?eo(this._container,he,A):On(this._container,he)},_reset:function(){this._update(),this._updateTransform(this._center,this._zoom);for(var d in this._layers)this._layers[d]._reset()},_onZoomEnd:function(){for(var d in this._layers)this._layers[d]._project()},_updatePaths:function(){for(var d in this._layers)this._layers[d]._update()},_update:function(){var d=this.options.padding,x=this._map.getSize(),A=this._map.containerPointToLayerPoint(x.multiplyBy(-d)).round();this._bounds=new Ze(A,A.add(x.multiplyBy(1+d*2)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),xh=ea.extend({options:{tolerance:0},getEvents:function(){var d=ea.prototype.getEvents.call(this);return d.viewprereset=this._onViewPreReset,d},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){ea.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var d=this._container=document.createElement("canvas");hn(d,"mousemove",this._onMouseMove,this),hn(d,"click dblclick mousedown mouseup contextmenu",this._onClick,this),hn(d,"mouseout",this._handleMouseOut,this),d._leaflet_disable_events=!0,this._ctx=d.getContext("2d")},_destroyContainer:function(){$e(this._redrawRequest),delete this._ctx,Di(this._container),si(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){var d;this._redrawBounds=null;for(var x in this._layers)d=this._layers[x],d._update();this._redraw()}},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){ea.prototype._update.call(this);var d=this._bounds,x=this._container,A=d.getSize(),F=Lt.retina?2:1;On(x,d.min),x.width=F*A.x,x.height=F*A.y,x.style.width=A.x+"px",x.style.height=A.y+"px",Lt.retina&&this._ctx.scale(2,2),this._ctx.translate(-d.min.x,-d.min.y),this.fire("update")}},_reset:function(){ea.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(d){this._updateDashArray(d),this._layers[R(d)]=d;var x=d._order={layer:d,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=x),this._drawLast=x,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(d){this._requestRedraw(d)},_removePath:function(d){var x=d._order,A=x.next,F=x.prev;A?A.prev=F:this._drawLast=F,F?F.next=A:this._drawFirst=A,delete d._order,delete this._layers[R(d)],this._requestRedraw(d)},_updatePath:function(d){this._extendRedrawBounds(d),d._project(),d._update(),this._requestRedraw(d)},_updateStyle:function(d){this._updateDashArray(d),this._requestRedraw(d)},_updateDashArray:function(d){if(typeof d.options.dashArray=="string"){var x=d.options.dashArray.split(/[, ]+/),A=[],F,Z;for(Z=0;Z<x.length;Z++){if(F=Number(x[Z]),isNaN(F))return;A.push(F)}d.options._dashArray=A}else d.options._dashArray=d.options.dashArray},_requestRedraw:function(d){this._map&&(this._extendRedrawBounds(d),this._redrawRequest=this._redrawRequest||Ae(this._redraw,this))},_extendRedrawBounds:function(d){if(d._pxBounds){var x=(d.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new Ze,this._redrawBounds.extend(d._pxBounds.min.subtract([x,x])),this._redrawBounds.extend(d._pxBounds.max.add([x,x]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var d=this._redrawBounds;if(d){var x=d.getSize();this._ctx.clearRect(d.min.x,d.min.y,x.x,x.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var d,x=this._redrawBounds;if(this._ctx.save(),x){var A=x.getSize();this._ctx.beginPath(),this._ctx.rect(x.min.x,x.min.y,A.x,A.y),this._ctx.clip()}this._drawing=!0;for(var F=this._drawFirst;F;F=F.next)d=F.layer,(!x||d._pxBounds&&d._pxBounds.intersects(x))&&d._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(d,x){if(this._drawing){var A,F,Z,he,Oe=d._parts,rt=Oe.length,dt=this._ctx;if(rt){for(dt.beginPath(),A=0;A<rt;A++){for(F=0,Z=Oe[A].length;F<Z;F++)he=Oe[A][F],dt[F?"lineTo":"moveTo"](he.x,he.y);x&&dt.closePath()}this._fillStroke(dt,d)}}},_updateCircle:function(d){if(!(!this._drawing||d._empty())){var x=d._point,A=this._ctx,F=Math.max(Math.round(d._radius),1),Z=(Math.max(Math.round(d._radiusY),1)||F)/F;Z!==1&&(A.save(),A.scale(1,Z)),A.beginPath(),A.arc(x.x,x.y/Z,F,0,Math.PI*2,!1),Z!==1&&A.restore(),this._fillStroke(A,d)}},_fillStroke:function(d,x){var A=x.options;A.fill&&(d.globalAlpha=A.fillOpacity,d.fillStyle=A.fillColor||A.color,d.fill(A.fillRule||"evenodd")),A.stroke&&A.weight!==0&&(d.setLineDash&&d.setLineDash(x.options&&x.options._dashArray||[]),d.globalAlpha=A.opacity,d.lineWidth=A.weight,d.strokeStyle=A.color,d.lineCap=A.lineCap,d.lineJoin=A.lineJoin,d.stroke())},_onClick:function(d){for(var x=this._map.mouseEventToLayerPoint(d),A,F,Z=this._drawFirst;Z;Z=Z.next)A=Z.layer,A.options.interactive&&A._containsPoint(x)&&(!(d.type==="click"||d.type==="preclick")||!this._map._draggableMoved(A))&&(F=A);this._fireEvent(F?[F]:!1,d)},_onMouseMove:function(d){if(!(!this._map||this._map.dragging.moving()||this._map._animatingZoom)){var x=this._map.mouseEventToLayerPoint(d);this._handleMouseHover(d,x)}},_handleMouseOut:function(d){var x=this._hoveredLayer;x&&(fi(this._container,"leaflet-interactive"),this._fireEvent([x],d,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(d,x){if(!this._mouseHoverThrottled){for(var A,F,Z=this._drawFirst;Z;Z=Z.next)A=Z.layer,A.options.interactive&&A._containsPoint(x)&&(F=A);F!==this._hoveredLayer&&(this._handleMouseOut(d),F&&(Dn(this._container,"leaflet-interactive"),this._fireEvent([F],d,"mouseover"),this._hoveredLayer=F)),this._fireEvent(this._hoveredLayer?[this._hoveredLayer]:!1,d),this._mouseHoverThrottled=!0,setTimeout(_(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(d,x,A){this._map._fireDOMEvent(x,A||x.type,d)},_bringToFront:function(d){var x=d._order;if(x){var A=x.next,F=x.prev;if(A)A.prev=F;else return;F?F.next=A:A&&(this._drawFirst=A),x.prev=this._drawLast,this._drawLast.next=x,x.next=null,this._drawLast=x,this._requestRedraw(d)}},_bringToBack:function(d){var x=d._order;if(x){var A=x.next,F=x.prev;if(F)F.next=A;else return;A?A.prev=F:F&&(this._drawLast=F),x.prev=null,x.next=this._drawFirst,this._drawFirst.prev=x,this._drawFirst=x,this._requestRedraw(d)}}});function Eu(d){return Lt.canvas?new xh(d):null}var Ja=function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(d){return document.createElement("<lvml:"+d+' class="lvml">')}}catch{}return function(d){return document.createElement("<"+d+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}(),Zu={_initContainer:function(){this._container=An("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(ea.prototype._update.call(this),this.fire("update"))},_initPath:function(d){var x=d._container=Ja("shape");Dn(x,"leaflet-vml-shape "+(this.options.className||"")),x.coordsize="1 1",d._path=Ja("path"),x.appendChild(d._path),this._updateStyle(d),this._layers[R(d)]=d},_addPath:function(d){var x=d._container;this._container.appendChild(x),d.options.interactive&&d.addInteractiveTarget(x)},_removePath:function(d){var x=d._container;Di(x),d.removeInteractiveTarget(x),delete this._layers[R(d)]},_updateStyle:function(d){var x=d._stroke,A=d._fill,F=d.options,Z=d._container;Z.stroked=!!F.stroke,Z.filled=!!F.fill,F.stroke?(x||(x=d._stroke=Ja("stroke")),Z.appendChild(x),x.weight=F.weight+"px",x.color=F.color,x.opacity=F.opacity,F.dashArray?x.dashStyle=vt(F.dashArray)?F.dashArray.join(" "):F.dashArray.replace(/( *, *)/g," "):x.dashStyle="",x.endcap=F.lineCap.replace("butt","flat"),x.joinstyle=F.lineJoin):x&&(Z.removeChild(x),d._stroke=null),F.fill?(A||(A=d._fill=Ja("fill")),Z.appendChild(A),A.color=F.fillColor||F.color,A.opacity=F.fillOpacity):A&&(Z.removeChild(A),d._fill=null)},_updateCircle:function(d){var x=d._point.round(),A=Math.round(d._radius),F=Math.round(d._radiusY||A);this._setPath(d,d._empty()?"M0 0":"AL "+x.x+","+x.y+" "+A+","+F+" 0,"+65535*360)},_setPath:function(d,x){d._path.v=x},_bringToFront:function(d){To(d._container)},_bringToBack:function(d){rs(d._container)}},go=Lt.vml?Ja:Qo,Pa=ea.extend({_initContainer:function(){this._container=go("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=go("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){Di(this._container),si(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){ea.prototype._update.call(this);var d=this._bounds,x=d.getSize(),A=this._container;(!this._svgSize||!this._svgSize.equals(x))&&(this._svgSize=x,A.setAttribute("width",x.x),A.setAttribute("height",x.y)),On(A,d.min),A.setAttribute("viewBox",[d.min.x,d.min.y,x.x,x.y].join(" ")),this.fire("update")}},_initPath:function(d){var x=d._path=go("path");d.options.className&&Dn(x,d.options.className),d.options.interactive&&Dn(x,"leaflet-interactive"),this._updateStyle(d),this._layers[R(d)]=d},_addPath:function(d){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(d._path),d.addInteractiveTarget(d._path)},_removePath:function(d){Di(d._path),d.removeInteractiveTarget(d._path),delete this._layers[R(d)]},_updatePath:function(d){d._project(),d._update()},_updateStyle:function(d){var x=d._path,A=d.options;x&&(A.stroke?(x.setAttribute("stroke",A.color),x.setAttribute("stroke-opacity",A.opacity),x.setAttribute("stroke-width",A.weight),x.setAttribute("stroke-linecap",A.lineCap),x.setAttribute("stroke-linejoin",A.lineJoin),A.dashArray?x.setAttribute("stroke-dasharray",A.dashArray):x.removeAttribute("stroke-dasharray"),A.dashOffset?x.setAttribute("stroke-dashoffset",A.dashOffset):x.removeAttribute("stroke-dashoffset")):x.setAttribute("stroke","none"),A.fill?(x.setAttribute("fill",A.fillColor||A.color),x.setAttribute("fill-opacity",A.fillOpacity),x.setAttribute("fill-rule",A.fillRule||"evenodd")):x.setAttribute("fill","none"))},_updatePoly:function(d,x){this._setPath(d,bs(d._parts,x))},_updateCircle:function(d){var x=d._point,A=Math.max(Math.round(d._radius),1),F=Math.max(Math.round(d._radiusY),1)||A,Z="a"+A+","+F+" 0 1,0 ",he=d._empty()?"M0 0":"M"+(x.x-A)+","+x.y+Z+A*2+",0 "+Z+-A*2+",0 ";this._setPath(d,he)},_setPath:function(d,x){d._path.setAttribute("d",x)},_bringToFront:function(d){To(d._path)},_bringToBack:function(d){rs(d._path)}});Lt.vml&&Pa.include(Zu);function Wu(d){return Lt.svg||Lt.vml?new Pa(d):null}ei.include({getRenderer:function(d){var x=d.options.renderer||this._getPaneRenderer(d.options.pane)||this.options.renderer||this._renderer;return x||(x=this._renderer=this._createRenderer()),this.hasLayer(x)||this.addLayer(x),x},_getPaneRenderer:function(d){if(d==="overlayPane"||d===void 0)return!1;var x=this._paneRenderers[d];return x===void 0&&(x=this._createRenderer({pane:d}),this._paneRenderers[d]=x),x},_createRenderer:function(d){return this.options.preferCanvas&&Eu(d)||Wu(d)}});var Ku=Ka.extend({initialize:function(d,x){Ka.prototype.initialize.call(this,this._boundsToLatLngs(d),x)},setBounds:function(d){return this.setLatLngs(this._boundsToLatLngs(d))},_boundsToLatLngs:function(d){return d=sn(d),[d.getSouthWest(),d.getNorthWest(),d.getNorthEast(),d.getSouthEast()]}});function Mc(d,x){return new Ku(d,x)}Pa.create=go,Pa.pointsToPath=bs,Ea.geometryToLayer=Zl,Ea.coordsToLatLng=Hu,Ea.coordsToLatLngs=vl,Ea.latLngToCoords=Wl,Ea.latLngsToCoords=Kl,Ea.getFeature=xl,Ea.asFeature=Ia,ei.mergeOptions({boxZoom:!0});var bl=Eo.extend({initialize:function(d){this._map=d,this._container=d._container,this._pane=d._panes.overlayPane,this._resetStateTimeout=0,d.on("unload",this._destroy,this)},addHooks:function(){hn(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){si(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){Di(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){this._resetStateTimeout!==0&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(d){if(!d.shiftKey||d.which!==1&&d.button!==1)return!1;this._clearDeferredResetState(),this._resetState(),_n(),Er(),this._startPoint=this._map.mouseEventToContainerPoint(d),hn(document,{contextmenu:Xi,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(d){this._moved||(this._moved=!0,this._box=An("div","leaflet-zoom-box",this._container),Dn(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(d);var x=new Ze(this._point,this._startPoint),A=x.getSize();On(this._box,x.min),this._box.style.width=A.x+"px",this._box.style.height=A.y+"px"},_finish:function(){this._moved&&(Di(this._box),fi(this._container,"leaflet-crosshair")),Ei(),Ir(),si(document,{contextmenu:Xi,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(d){if(!(d.which!==1&&d.button!==1)&&(this._finish(),!!this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(_(this._resetState,this),0);var x=new Qt(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(x).fire("boxzoomend",{boxZoomBounds:x})}},_onKeyDown:function(d){d.keyCode===27&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});ei.addInitHook("addHandler","boxZoom",bl),ei.mergeOptions({doubleClickZoom:!0});var od=Eo.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(d){var x=this._map,A=x.getZoom(),F=x.options.zoomDelta,Z=d.originalEvent.shiftKey?A-F:A+F;x.options.doubleClickZoom==="center"?x.setZoom(Z):x.setZoomAround(d.containerPoint,Z)}});ei.addInitHook("addHandler","doubleClickZoom",od),ei.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var Iu=Eo.extend({addHooks:function(){if(!this._draggable){var d=this._map;this._draggable=new tr(d._mapPane,d._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),d.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),d.on("zoomend",this._onZoomEnd,this),d.whenReady(this._onZoomEnd,this))}Dn(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){fi(this._map._container,"leaflet-grab"),fi(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var d=this._map;if(d._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var x=sn(this._map.options.maxBounds);this._offsetLimit=wt(this._map.latLngToContainerPoint(x.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(x.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;d.fire("movestart").fire("dragstart"),d.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(d){if(this._map.options.inertia){var x=this._lastTime=+new Date,A=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(A),this._times.push(x),this._prunePositions(x)}this._map.fire("move",d).fire("drag",d)},_prunePositions:function(d){for(;this._positions.length>1&&d-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var d=this._map.getSize().divideBy(2),x=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=x.subtract(d).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(d,x){return d-(d-x)*this._viscosity},_onPreDragLimit:function(){if(!(!this._viscosity||!this._offsetLimit)){var d=this._draggable._newPos.subtract(this._draggable._startPos),x=this._offsetLimit;d.x<x.min.x&&(d.x=this._viscousLimit(d.x,x.min.x)),d.y<x.min.y&&(d.y=this._viscousLimit(d.y,x.min.y)),d.x>x.max.x&&(d.x=this._viscousLimit(d.x,x.max.x)),d.y>x.max.y&&(d.y=this._viscousLimit(d.y,x.max.y)),this._draggable._newPos=this._draggable._startPos.add(d)}},_onPreDragWrap:function(){var d=this._worldWidth,x=Math.round(d/2),A=this._initialWorldOffset,F=this._draggable._newPos.x,Z=(F-x+A)%d+x-A,he=(F+x+A)%d-x-A,Oe=Math.abs(Z+A)<Math.abs(he+A)?Z:he;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=Oe},_onDragEnd:function(d){var x=this._map,A=x.options,F=!A.inertia||d.noInertia||this._times.length<2;if(x.fire("dragend",d),F)x.fire("moveend");else{this._prunePositions(+new Date);var Z=this._lastPos.subtract(this._positions[0]),he=(this._lastTime-this._times[0])/1e3,Oe=A.easeLinearity,rt=Z.multiplyBy(Oe/he),dt=rt.distanceTo([0,0]),kt=Math.min(A.inertiaMaxSpeed,dt),tn=rt.multiplyBy(kt/dt),Sn=kt/(A.inertiaDeceleration*Oe),Gn=tn.multiplyBy(-Sn/2).round();!Gn.x&&!Gn.y?x.fire("moveend"):(Gn=x._limitOffset(Gn,x.options.maxBounds),Ae(function(){x.panBy(Gn,{duration:Sn,easeLinearity:Oe,noMoveStart:!0,animate:!0})}))}}});ei.addInitHook("addHandler","dragging",Iu),ei.mergeOptions({keyboard:!0,keyboardPanDelta:80});var Rc=Eo.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(d){this._map=d,this._setPanDelta(d.options.keyboardPanDelta),this._setZoomDelta(d.options.zoomDelta)},addHooks:function(){var d=this._map._container;d.tabIndex<=0&&(d.tabIndex="0"),hn(d,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),si(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var d=document.body,x=document.documentElement,A=d.scrollTop||x.scrollTop,F=d.scrollLeft||x.scrollLeft;this._map._container.focus(),window.scrollTo(F,A)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(d){var x=this._panKeys={},A=this.keyCodes,F,Z;for(F=0,Z=A.left.length;F<Z;F++)x[A.left[F]]=[-1*d,0];for(F=0,Z=A.right.length;F<Z;F++)x[A.right[F]]=[d,0];for(F=0,Z=A.down.length;F<Z;F++)x[A.down[F]]=[0,d];for(F=0,Z=A.up.length;F<Z;F++)x[A.up[F]]=[0,-1*d]},_setZoomDelta:function(d){var x=this._zoomKeys={},A=this.keyCodes,F,Z;for(F=0,Z=A.zoomIn.length;F<Z;F++)x[A.zoomIn[F]]=d;for(F=0,Z=A.zoomOut.length;F<Z;F++)x[A.zoomOut[F]]=-d},_addHooks:function(){hn(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){si(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(d){if(!(d.altKey||d.ctrlKey||d.metaKey)){var x=d.keyCode,A=this._map,F;if(x in this._panKeys){if(!A._panAnim||!A._panAnim._inProgress)if(F=this._panKeys[x],d.shiftKey&&(F=St(F).multiplyBy(3)),A.options.maxBounds&&(F=A._limitOffset(St(F),A.options.maxBounds)),A.options.worldCopyJump){var Z=A.wrapLatLng(A.unproject(A.project(A.getCenter()).add(F)));A.panTo(Z)}else A.panBy(F)}else if(x in this._zoomKeys)A.setZoom(A.getZoom()+(d.shiftKey?3:1)*this._zoomKeys[x]);else if(x===27&&A._popup&&A._popup.options.closeOnEscapeKey)A.closePopup();else return;Xi(d)}}});ei.addInitHook("addHandler","keyboard",Rc),ei.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var Yi=Eo.extend({addHooks:function(){hn(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){si(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(d){var x=Ta(d),A=this._map.options.wheelDebounceTime;this._delta+=x,this._lastMousePos=this._map.mouseEventToContainerPoint(d),this._startTime||(this._startTime=+new Date);var F=Math.max(A-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(_(this._performZoom,this),F),Xi(d)},_performZoom:function(){var d=this._map,x=d.getZoom(),A=this._map.options.zoomSnap||0;d._stop();var F=this._delta/(this._map.options.wheelPxPerZoomLevel*4),Z=4*Math.log(2/(1+Math.exp(-Math.abs(F))))/Math.LN2,he=A?Math.ceil(Z/A)*A:Z,Oe=d._limitZoom(x+(this._delta>0?he:-he))-x;this._delta=0,this._startTime=null,Oe&&(d.options.scrollWheelZoom==="center"?d.setZoom(x+Oe):d.setZoomAround(this._lastMousePos,x+Oe))}});ei.addInitHook("addHandler","scrollWheelZoom",Yi);var Pu=600;ei.mergeOptions({tapHold:Lt.touchNative&&Lt.safari&&Lt.mobile,tapTolerance:15});var Tl=Eo.extend({addHooks:function(){hn(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){si(this._map._container,"touchstart",this._onDown,this)},_onDown:function(d){if(clearTimeout(this._holdTimeout),d.touches.length===1){var x=d.touches[0];this._startPos=this._newPos=new Tt(x.clientX,x.clientY),this._holdTimeout=setTimeout(_(function(){this._cancel(),this._isTapValid()&&(hn(document,"touchend",gi),hn(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",x))},this),Pu),hn(document,"touchend touchcancel contextmenu",this._cancel,this),hn(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function d(){si(document,"touchend",gi),si(document,"touchend touchcancel",d)},_cancel:function(){clearTimeout(this._holdTimeout),si(document,"touchend touchcancel contextmenu",this._cancel,this),si(document,"touchmove",this._onMove,this)},_onMove:function(d){var x=d.touches[0];this._newPos=new Tt(x.clientX,x.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(d,x){var A=new MouseEvent(d,{bubbles:!0,cancelable:!0,view:window,screenX:x.screenX,screenY:x.screenY,clientX:x.clientX,clientY:x.clientY});A._simulated=!0,x.target.dispatchEvent(A)}});ei.addInitHook("addHandler","tapHold",Tl),ei.mergeOptions({touchZoom:Lt.touch,bounceAtZoomLimits:!0});var Sl=Eo.extend({addHooks:function(){Dn(this._map._container,"leaflet-touch-zoom"),hn(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){fi(this._map._container,"leaflet-touch-zoom"),si(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(d){var x=this._map;if(!(!d.touches||d.touches.length!==2||x._animatingZoom||this._zooming)){var A=x.mouseEventToContainerPoint(d.touches[0]),F=x.mouseEventToContainerPoint(d.touches[1]);this._centerPoint=x.getSize()._divideBy(2),this._startLatLng=x.containerPointToLatLng(this._centerPoint),x.options.touchZoom!=="center"&&(this._pinchStartLatLng=x.containerPointToLatLng(A.add(F)._divideBy(2))),this._startDist=A.distanceTo(F),this._startZoom=x.getZoom(),this._moved=!1,this._zooming=!0,x._stop(),hn(document,"touchmove",this._onTouchMove,this),hn(document,"touchend touchcancel",this._onTouchEnd,this),gi(d)}},_onTouchMove:function(d){if(!(!d.touches||d.touches.length!==2||!this._zooming)){var x=this._map,A=x.mouseEventToContainerPoint(d.touches[0]),F=x.mouseEventToContainerPoint(d.touches[1]),Z=A.distanceTo(F)/this._startDist;if(this._zoom=x.getScaleZoom(Z,this._startZoom),!x.options.bounceAtZoomLimits&&(this._zoom<x.getMinZoom()&&Z<1||this._zoom>x.getMaxZoom()&&Z>1)&&(this._zoom=x._limitZoom(this._zoom)),x.options.touchZoom==="center"){if(this._center=this._startLatLng,Z===1)return}else{var he=A._add(F)._divideBy(2)._subtract(this._centerPoint);if(Z===1&&he.x===0&&he.y===0)return;this._center=x.unproject(x.project(this._pinchStartLatLng,this._zoom).subtract(he),this._zoom)}this._moved||(x._moveStart(!0,!1),this._moved=!0),$e(this._animRequest);var Oe=_(x._move,x,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=Ae(Oe,this,!0),gi(d)}},_onTouchEnd:function(){if(!this._moved||!this._zooming){this._zooming=!1;return}this._zooming=!1,$e(this._animRequest),si(document,"touchmove",this._onTouchMove,this),si(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))}});ei.addInitHook("addHandler","touchZoom",Sl),ei.BoxZoom=bl,ei.DoubleClickZoom=od,ei.Drag=Iu,ei.Keyboard=Rc,ei.ScrollWheelZoom=Yi,ei.TapHold=Tl,ei.TouchZoom=Sl,t.Bounds=Ze,t.Browser=Lt,t.CRS=Fn,t.Canvas=xh,t.Circle=xu,t.CircleMarker=Gl,t.Class=pn,t.Control=qn,t.DivIcon=Tu,t.DivOverlay=cs,t.DomEvent=qa,t.DomUtil=fo,t.Draggable=tr,t.Evented=jn,t.FeatureGroup=gr,t.GeoJSON=Ea,t.GridLayer=Js,t.Handler=Eo,t.Icon=Rs,t.ImageOverlay=Xa,t.LatLng=Xt,t.LatLngBounds=Qt,t.Layer=wi,t.LayerGroup=sr,t.LineUtil=ye,t.Map=ei,t.Marker=io,t.Mixin=As,t.Path=Sa,t.Point=Tt,t.PolyUtil=no,t.Polygon=Ka,t.Polyline=Co,t.Popup=Gu,t.PosAnimation=Ga,t.Projection=Zt,t.Rectangle=Ku,t.Renderer=ea,t.SVG=Pa,t.SVGOverlay=wu,t.TileLayer=Qa,t.Tooltip=Qs,t.Transformation=Ji,t.Util=Ce,t.VideoOverlay=Ya,t.bind=_,t.bounds=wt,t.canvas=Eu,t.circle=Xs,t.circleMarker=vh,t.control=mr,t.divIcon=li,t.extend=h,t.featureGroup=Wa,t.geoJSON=us,t.geoJson=Ls,t.gridLayer=Su,t.icon=Cc,t.imageOverlay=kc,t.latLng=nn,t.latLngBounds=sn,t.layerGroup=Ms,t.map=to,t.marker=yh,t.point=St,t.polygon=qd,t.polyline=_i,t.popup=Ys,t.rectangle=Mc,t.setOptions=Se,t.stamp=R,t.svg=Wu,t.svgOverlay=Xl,t.tileLayer=Yl,t.tooltip=bu,t.transformation=Ui,t.version=o,t.videoOverlay=qu;var Lc=window.L;t.noConflict=function(){return window.L=Lc,this},window.L=t})}(rg,rg.exports)),rg.exports}var LN=RN();const zr=Rg(LN);var ey={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v5.1.0/LICENSE.txt
 */var DN=ey.exports,X1;function zN(){return X1||(X1=1,function(i,e){(function(t,o){i.exports=o()})(DN,function(){var t={},o={};function h(_,u,R){if(o[_]=R,_==="index"){var O="var sharedModule = {}; ("+o.shared+")(sharedModule); ("+o.worker+")(sharedModule);",G={};return o.shared(G),o.index(t,G),typeof window<"u"&&t.setWorkerUrl(window.URL.createObjectURL(new Blob([O],{type:"text/javascript"}))),t}}h("shared",["exports"],function(_){function u(l,r,a,p){return new(a||(a=Promise))(function(v,T){function E(N){try{D(p.next(N))}catch(U){T(U)}}function C(N){try{D(p.throw(N))}catch(U){T(U)}}function D(N){var U;N.done?v(N.value):(U=N.value,U instanceof a?U:new a(function(H){H(U)})).then(E,C)}D((p=p.apply(l,r||[])).next())})}function R(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}var O,G;function ne(){if(G)return O;function l(r,a){this.x=r,this.y=a}return G=1,O=l,l.prototype={clone:function(){return new l(this.x,this.y)},add:function(r){return this.clone()._add(r)},sub:function(r){return this.clone()._sub(r)},multByPoint:function(r){return this.clone()._multByPoint(r)},divByPoint:function(r){return this.clone()._divByPoint(r)},mult:function(r){return this.clone()._mult(r)},div:function(r){return this.clone()._div(r)},rotate:function(r){return this.clone()._rotate(r)},rotateAround:function(r,a){return this.clone()._rotateAround(r,a)},matMult:function(r){return this.clone()._matMult(r)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(r){return this.x===r.x&&this.y===r.y},dist:function(r){return Math.sqrt(this.distSqr(r))},distSqr:function(r){var a=r.x-this.x,p=r.y-this.y;return a*a+p*p},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(r){return Math.atan2(this.y-r.y,this.x-r.x)},angleWith:function(r){return this.angleWithSep(r.x,r.y)},angleWithSep:function(r,a){return Math.atan2(this.x*a-this.y*r,this.x*r+this.y*a)},_matMult:function(r){var a=r[2]*this.x+r[3]*this.y;return this.x=r[0]*this.x+r[1]*this.y,this.y=a,this},_add:function(r){return this.x+=r.x,this.y+=r.y,this},_sub:function(r){return this.x-=r.x,this.y-=r.y,this},_mult:function(r){return this.x*=r,this.y*=r,this},_div:function(r){return this.x/=r,this.y/=r,this},_multByPoint:function(r){return this.x*=r.x,this.y*=r.y,this},_divByPoint:function(r){return this.x/=r.x,this.y/=r.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var r=this.y;return this.y=this.x,this.x=-r,this},_rotate:function(r){var a=Math.cos(r),p=Math.sin(r),v=p*this.x+a*this.y;return this.x=a*this.x-p*this.y,this.y=v,this},_rotateAround:function(r,a){var p=Math.cos(r),v=Math.sin(r),T=a.y+v*(this.x-a.x)+p*(this.y-a.y);return this.x=a.x+p*(this.x-a.x)-v*(this.y-a.y),this.y=T,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},l.convert=function(r){return r instanceof l?r:Array.isArray(r)?new l(r[0],r[1]):r},O}typeof SuppressedError=="function"&&SuppressedError;var re,Q,de=R(ne()),Se=function(){if(Q)return re;function l(r,a,p,v){this.cx=3*r,this.bx=3*(p-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*a,this.by=3*(v-a)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=a,this.p2x=p,this.p2y=v}return Q=1,re=l,l.prototype={sampleCurveX:function(r){return((this.ax*r+this.bx)*r+this.cx)*r},sampleCurveY:function(r){return((this.ay*r+this.by)*r+this.cy)*r},sampleCurveDerivativeX:function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},solveCurveX:function(r,a){if(a===void 0&&(a=1e-6),r<0)return 0;if(r>1)return 1;for(var p=r,v=0;v<8;v++){var T=this.sampleCurveX(p)-r;if(Math.abs(T)<a)return p;var E=this.sampleCurveDerivativeX(p);if(Math.abs(E)<1e-6)break;p-=T/E}var C=0,D=1;for(p=r,v=0;v<20&&(T=this.sampleCurveX(p),!(Math.abs(T-r)<a));v++)r>T?C=p:D=p,p=.5*(D-C)+C;return p},solve:function(r,a){return this.sampleCurveY(this.solveCurveX(r,a))}},re}(),De=R(Se);let Ke,et;function vt(){return Ke==null&&(Ke=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Ke}function Ye(){if(et==null&&(et=!1,vt())){const r=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(r){for(let p=0;p<25;p++){const v=4*p;r.fillStyle=`rgb(${v},${v+1},${v+2})`,r.fillRect(p%5,Math.floor(p/5),1,1)}const a=r.getImageData(0,0,5,5).data;for(let p=0;p<100;p++)if(p%4!=3&&a[p]!==p){et=!0;break}}}return et||!1}var it,at=1e-6,be=typeof Float32Array<"u"?Float32Array:Array;function te(){var l=new be(9);return be!=Float32Array&&(l[1]=0,l[2]=0,l[3]=0,l[5]=0,l[6]=0,l[7]=0),l[0]=1,l[4]=1,l[8]=1,l}function pe(l){return l[0]=1,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=1,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=1,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l}function xe(){var l=new be(3);return be!=Float32Array&&(l[0]=0,l[1]=0,l[2]=0),l}function Ae(l,r,a){var p=new be(3);return p[0]=l,p[1]=r,p[2]=a,p}function $e(l,r,a){var p=r[0],v=r[1],T=r[2],E=r[3];return l[0]=a[0]*p+a[4]*v+a[8]*T+a[12]*E,l[1]=a[1]*p+a[5]*v+a[9]*T+a[13]*E,l[2]=a[2]*p+a[6]*v+a[10]*T+a[14]*E,l[3]=a[3]*p+a[7]*v+a[11]*T+a[15]*E,l}function Ce(){var l=new be(4);return be!=Float32Array&&(l[0]=0,l[1]=0,l[2]=0),l[3]=1,l}function pn(){var l=new be(2);return be!=Float32Array&&(l[0]=0,l[1]=0),l}function ri(l,r){var a=new be(2);return a[0]=l,a[1]=r,a}Math.hypot||(Math.hypot=function(){for(var l=0,r=arguments.length;r--;)l+=arguments[r]*arguments[r];return Math.sqrt(l)}),xe(),it=new be(4),be!=Float32Array&&(it[0]=0,it[1]=0,it[2]=0,it[3]=0),xe(),Ae(1,0,0),Ae(0,1,0),Ce(),Ce(),te(),pn();const dn=8192;function jn(l,r,a){return r*(dn/(l.tileSize*Math.pow(2,a-l.tileID.overscaledZ)))}function Tt(l,r){return(l%r+r)%r}function gn(l,r,a){return l*(1-a)+r*a}function St(l){if(l<=0)return 0;if(l>=1)return 1;const r=l*l,a=r*l;return 4*(l<.5?a:3*(l-r)+a-.75)}function Ze(l,r,a,p){const v=new De(l,r,a,p);return T=>v.solve(T)}const wt=Ze(.25,.1,.25,1);function Qt(l,r,a){return Math.min(a,Math.max(r,l))}function sn(l,r,a){const p=a-r,v=((l-r)%p+p)%p+r;return v===r?a:v}function Xt(l,...r){for(const a of r)for(const p in a)l[p]=a[p];return l}let nn=1;function Fn(l,r,a){const p={};for(const v in l)p[v]=r.call(this,l[v],v,l);return p}function $n(l,r,a){const p={};for(const v in l)r.call(this,l[v],v,l)&&(p[v]=l[v]);return p}function Jn(l){return Array.isArray(l)?l.map(Jn):typeof l=="object"&&l?Fn(l,Jn):l}const ur={};function Ji(l){ur[l]||(typeof console<"u"&&console.warn(l),ur[l]=!0)}function Ui(l,r,a){return(a.y-l.y)*(r.x-l.x)>(r.y-l.y)*(a.x-l.x)}function Hr(l){return typeof WorkerGlobalScope<"u"&&l!==void 0&&l instanceof WorkerGlobalScope}let Wi=null;function Qo(l){return typeof ImageBitmap<"u"&&l instanceof ImageBitmap}const bs="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Qr(l,r,a,p,v){return u(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const T=new VideoFrame(l,{timestamp:0});try{const E=T?.format;if(!E||!E.startsWith("BGR")&&!E.startsWith("RGB"))throw new Error(`Unrecognized format ${E}`);const C=E.startsWith("BGR"),D=new Uint8ClampedArray(p*v*4);if(yield T.copyTo(D,function(N,U,H,X,ee){const ie=4*Math.max(1,0),ae=(Math.max(0,H)-H)*X*4+ie,_e=4*X,Ee=Math.max(0,U),je=Math.max(0,H);return{rect:{x:Ee,y:je,width:Math.min(N.width,U+X)-Ee,height:Math.min(N.height,H+ee)-je},layout:[{offset:ae,stride:_e}]}}(l,r,a,p,v)),C)for(let N=0;N<D.length;N+=4){const U=D[N];D[N]=D[N+2],D[N+2]=U}return D}finally{T.close()}})}let Oo,Jo;function vr(l){return l/Math.PI*180}const Jr="AbortError";function Ts(){return new Error(Jr)}const Fo={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function _a(l){return Fo.REGISTERED_PROTOCOLS[l.substring(0,l.indexOf("://"))]}const Hs="global-dispatcher";class Mi extends Error{constructor(r,a,p,v){super(`AJAXError: ${a} (${r}): ${p}`),this.status=r,this.statusText=a,this.url=p,this.body=v}}const er=()=>Hr(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,qr=function(l,r){if(/:\/\//.test(l.url)&&!/^https?:|^file:/.test(l.url)){const p=_a(l.url);if(p)return p(l,r);if(Hr(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:l,targetMapId:Hs},r)}if(!(/^file:/.test(a=l.url)||/^file:/.test(er())&&!/^\w+:/.test(a))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(p,v){return u(this,void 0,void 0,function*(){const T=new Request(p.url,{method:p.method||"GET",body:p.body,credentials:p.credentials,headers:p.headers,cache:p.cache,referrer:er(),signal:v.signal});let E,C;p.type!=="json"||T.headers.has("Accept")||T.headers.set("Accept","application/json");try{E=yield fetch(T)}catch(N){throw new Mi(0,N.message,p.url,new Blob)}if(!E.ok){const N=yield E.blob();throw new Mi(E.status,E.statusText,p.url,N)}C=p.type==="arrayBuffer"||p.type==="image"?E.arrayBuffer():p.type==="json"?E.json():E.text();const D=yield C;if(v.signal.aborted)throw Ts();return{data:D,cacheControl:E.headers.get("Cache-Control"),expires:E.headers.get("Expires")}})}(l,r);if(Hr(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:l,mustQueue:!0,targetMapId:Hs},r)}var a;return function(p,v){return new Promise((T,E)=>{var C;const D=new XMLHttpRequest;D.open(p.method||"GET",p.url,!0),p.type!=="arrayBuffer"&&p.type!=="image"||(D.responseType="arraybuffer");for(const N in p.headers)D.setRequestHeader(N,p.headers[N]);p.type==="json"&&(D.responseType="text",!((C=p.headers)===null||C===void 0)&&C.Accept||D.setRequestHeader("Accept","application/json")),D.withCredentials=p.credentials==="include",D.onerror=()=>{E(new Error(D.statusText))},D.onload=()=>{if(!v.signal.aborted)if((D.status>=200&&D.status<300||D.status===0)&&D.response!==null){let N=D.response;if(p.type==="json")try{N=JSON.parse(D.response)}catch(U){return void E(U)}T({data:N,cacheControl:D.getResponseHeader("Cache-Control"),expires:D.getResponseHeader("Expires")})}else{const N=new Blob([D.response],{type:D.getResponseHeader("Content-Type")});E(new Mi(D.status,D.statusText,p.url,N))}},v.signal.addEventListener("abort",()=>{D.abort(),E(Ts())}),D.send(p.body)})}(l,r)};function qs(l){if(!l||l.indexOf("://")<=0||l.indexOf("data:image/")===0||l.indexOf("blob:")===0)return!0;const r=new URL(l),a=window.location;return r.protocol===a.protocol&&r.host===a.host}function uo(l,r,a){a[l]&&a[l].indexOf(r)!==-1||(a[l]=a[l]||[],a[l].push(r))}function es(l,r,a){if(a&&a[l]){const p=a[l].indexOf(r);p!==-1&&a[l].splice(p,1)}}class Ss{constructor(r,a={}){Xt(this,a),this.type=r}}class ya extends Ss{constructor(r,a={}){super("error",Xt({error:r},a))}}class Bo{on(r,a){return this._listeners=this._listeners||{},uo(r,a,this._listeners),{unsubscribe:()=>{this.off(r,a)}}}off(r,a){return es(r,a,this._listeners),es(r,a,this._oneTimeListeners),this}once(r,a){return a?(this._oneTimeListeners=this._oneTimeListeners||{},uo(r,a,this._oneTimeListeners),this):new Promise(p=>this.once(r,p))}fire(r,a){typeof r=="string"&&(r=new Ss(r,a||{}));const p=r.type;if(this.listens(p)){r.target=this;const v=this._listeners&&this._listeners[p]?this._listeners[p].slice():[];for(const C of v)C.call(this,r);const T=this._oneTimeListeners&&this._oneTimeListeners[p]?this._oneTimeListeners[p].slice():[];for(const C of T)es(p,C,this._oneTimeListeners),C.call(this,r);const E=this._eventedParent;E&&(Xt(r,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),E.fire(r))}else r instanceof ya&&console.error(r.error);return this}listens(r){return this._listeners&&this._listeners[r]&&this._listeners[r].length>0||this._oneTimeListeners&&this._oneTimeListeners[r]&&this._oneTimeListeners[r].length>0||this._eventedParent&&this._eventedParent.listens(r)}setEventedParent(r,a){return this._eventedParent=r,this._eventedParentData=a,this}}var ve={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const se=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function ce(l,r){const a={};for(const p in l)p!=="ref"&&(a[p]=l[p]);return se.forEach(p=>{p in r&&(a[p]=r[p])}),a}function fe(l,r){if(Array.isArray(l)){if(!Array.isArray(r)||l.length!==r.length)return!1;for(let a=0;a<l.length;a++)if(!fe(l[a],r[a]))return!1;return!0}if(typeof l=="object"&&l!==null&&r!==null){if(typeof r!="object"||Object.keys(l).length!==Object.keys(r).length)return!1;for(const a in l)if(!fe(l[a],r[a]))return!1;return!0}return l===r}function Pe(l,r){l.push(r)}function Be(l,r,a){Pe(a,{command:"addSource",args:[l,r[l]]})}function qe(l,r,a){Pe(r,{command:"removeSource",args:[l]}),a[l]=!0}function tt(l,r,a,p){qe(l,a,p),Be(l,r,a)}function Ge(l,r,a){let p;for(p in l[a])if(Object.prototype.hasOwnProperty.call(l[a],p)&&p!=="data"&&!fe(l[a][p],r[a][p]))return!1;for(p in r[a])if(Object.prototype.hasOwnProperty.call(r[a],p)&&p!=="data"&&!fe(l[a][p],r[a][p]))return!1;return!0}function ht(l,r,a,p,v,T){l=l||{},r=r||{};for(const E in l)Object.prototype.hasOwnProperty.call(l,E)&&(fe(l[E],r[E])||a.push({command:T,args:[p,E,r[E],v]}));for(const E in r)Object.prototype.hasOwnProperty.call(r,E)&&!Object.prototype.hasOwnProperty.call(l,E)&&(fe(l[E],r[E])||a.push({command:T,args:[p,E,r[E],v]}))}function ut(l){return l.id}function Xe(l,r){return l[r.id]=r,l}class Ue{constructor(r,a,p,v){this.message=(r?`${r}: `:"")+p,v&&(this.identifier=v),a!=null&&a.__line__&&(this.line=a.__line__)}}function zt(l,...r){for(const a of r)for(const p in a)l[p]=a[p];return l}class Nt extends Error{constructor(r,a){super(a),this.message=a,this.key=r}}class en{constructor(r,a=[]){this.parent=r,this.bindings={};for(const[p,v]of a)this.bindings[p]=v}concat(r){return new en(this,r)}get(r){if(this.bindings[r])return this.bindings[r];if(this.parent)return this.parent.get(r);throw new Error(`${r} not found in scope.`)}has(r){return!!this.bindings[r]||!!this.parent&&this.parent.has(r)}}const Pn={kind:"null"},mt={kind:"number"},Vt={kind:"string"},$t={kind:"boolean"},Lt={kind:"color"},Nn={kind:"projectionDefinition"},mn={kind:"object"},Yt={kind:"value"},Ri={kind:"collator"},ts={kind:"formatted"},Si={kind:"padding"},xi={kind:"resolvedImage"},oi={kind:"variableAnchorOffsetCollection"};function co(l,r){return{kind:"array",itemType:l,N:r}}function Li(l){if(l.kind==="array"){const r=Li(l.itemType);return typeof l.N=="number"?`array<${r}, ${l.N}>`:l.itemType.kind==="value"?"array":`array<${r}>`}return l.kind}const va=[Pn,mt,Vt,$t,Lt,Nn,ts,mn,co(Yt),Si,xi,oi];function Gs(l,r){if(r.kind==="error")return null;if(l.kind==="array"){if(r.kind==="array"&&(r.N===0&&r.itemType.kind==="value"||!Gs(l.itemType,r.itemType))&&(typeof l.N!="number"||l.N===r.N))return null}else{if(l.kind===r.kind)return null;if(l.kind==="value"){for(const a of va)if(!Gs(a,r))return null}}return`Expected ${Li(l)} but found ${Li(r)} instead.`}function ul(l,r){return r.some(a=>a.kind===l.kind)}function xa(l,r){return r.some(a=>a==="null"?l===null:a==="array"?Array.isArray(l):a==="object"?l&&!Array.isArray(l)&&typeof l=="object":a===typeof l)}function Es(l,r){return l.kind==="array"&&r.kind==="array"?l.itemType.kind===r.itemType.kind&&typeof l.N=="number":l.kind===r.kind}const Ki=.96422,yu=.82521,cl=4/29,ns=6/29,is=3*ns*ns,Fl=ns*ns*ns,hl=Math.PI/180,dl=180/Math.PI;function bo(l){return(l%=360)<0&&(l+=360),l}function wa([l,r,a,p]){let v,T;const E=Di((.2225045*(l=An(l))+.7168786*(r=An(r))+.0606169*(a=An(a)))/1);l===r&&r===a?v=T=E:(v=Di((.4360747*l+.3850649*r+.1430804*a)/Ki),T=Di((.0139322*l+.0971045*r+.7141733*a)/yu));const C=116*E-16;return[C<0?0:C,500*(v-E),200*(E-T),p]}function An(l){return l<=.04045?l/12.92:Math.pow((l+.055)/1.055,2.4)}function Di(l){return l>Fl?Math.pow(l,1/3):l/is+cl}function pl([l,r,a,p]){let v=(l+16)/116,T=isNaN(r)?v:v+r/500,E=isNaN(a)?v:v-a/200;return v=1*rs(v),T=Ki*rs(T),E=yu*rs(E),[To(3.1338561*T-1.6168667*v-.4906146*E),To(-.9787684*T+1.9161415*v+.033454*E),To(.0719453*T-.2289914*v+1.4052427*E),p]}function To(l){return(l=l<=.00304?12.92*l:1.055*Math.pow(l,1/2.4)-.055)<0?0:l>1?1:l}function rs(l){return l>ns?l*l*l:is*(l-cl)}function Zs(l){return parseInt(l.padEnd(2,l),16)/255}function Dn(l,r){return fi(r?l/100:l,0,1)}function fi(l,r,a){return Math.min(Math.max(r,l),a)}function Bl(l){return!l.some(Number.isNaN)}const Sr={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function ln(l,r,a){return l+a*(r-l)}function ho(l,r,a){return l.map((p,v)=>ln(p,r[v],a))}class kn{constructor(r,a,p,v=1,T=!0){this.r=r,this.g=a,this.b=p,this.a=v,T||(this.r*=v,this.g*=v,this.b*=v,v||this.overwriteGetter("rgb",[r,a,p,v]))}static parse(r){if(r instanceof kn)return r;if(typeof r!="string")return;const a=function(p){if((p=p.toLowerCase().trim())==="transparent")return[0,0,0,0];const v=Sr[p];if(v){const[E,C,D]=v;return[E/255,C/255,D/255,1]}if(p.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(p)){const E=p.length<6?1:2;let C=1;return[Zs(p.slice(C,C+=E)),Zs(p.slice(C,C+=E)),Zs(p.slice(C,C+=E)),Zs(p.slice(C,C+E)||"ff")]}if(p.startsWith("rgb")){const E=p.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(E){const[C,D,N,U,H,X,ee,ie,ae,_e,Ee,je]=E,ke=[U||" ",ee||" ",_e].join("");if(ke==="  "||ke==="  /"||ke===",,"||ke===",,,"){const J=[N,X,ae].join(""),me=J==="%%%"?100:J===""?255:0;if(me){const Me=[fi(+D/me,0,1),fi(+H/me,0,1),fi(+ie/me,0,1),Ee?Dn(+Ee,je):1];if(Bl(Me))return Me}}return}}const T=p.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(T){const[E,C,D,N,U,H,X,ee,ie]=T,ae=[D||" ",U||" ",X].join("");if(ae==="  "||ae==="  /"||ae===",,"||ae===",,,"){const _e=[+C,fi(+N,0,100),fi(+H,0,100),ee?Dn(+ee,ie):1];if(Bl(_e))return function([Ee,je,ke,J]){function me(Me){const st=(Me+Ee/30)%12,Pt=je*Math.min(ke,1-ke);return ke-Pt*Math.max(-1,Math.min(st-3,9-st,1))}return Ee=bo(Ee),je/=100,ke/=100,[me(0),me(8),me(4),J]}(_e)}}}(r);return a?new kn(...a,!1):void 0}get rgb(){const{r,g:a,b:p,a:v}=this,T=v||1/0;return this.overwriteGetter("rgb",[r/T,a/T,p/T,v])}get hcl(){return this.overwriteGetter("hcl",function(r){const[a,p,v,T]=wa(r),E=Math.sqrt(p*p+v*v);return[Math.round(1e4*E)?bo(Math.atan2(v,p)*dl):NaN,E,a,T]}(this.rgb))}get lab(){return this.overwriteGetter("lab",wa(this.rgb))}overwriteGetter(r,a){return Object.defineProperty(this,r,{value:a}),a}toString(){const[r,a,p,v]=this.rgb;return`rgba(${[r,a,p].map(T=>Math.round(255*T)).join(",")},${v})`}static interpolate(r,a,p,v="rgb"){switch(v){case"rgb":{const[T,E,C,D]=ho(r.rgb,a.rgb,p);return new kn(T,E,C,D,!1)}case"hcl":{const[T,E,C,D]=r.hcl,[N,U,H,X]=a.hcl;let ee,ie;if(isNaN(T)||isNaN(N))isNaN(T)?isNaN(N)?ee=NaN:(ee=N,C!==1&&C!==0||(ie=U)):(ee=T,H!==1&&H!==0||(ie=E));else{let ke=N-T;N>T&&ke>180?ke-=360:N<T&&T-N>180&&(ke+=360),ee=T+p*ke}const[ae,_e,Ee,je]=function([ke,J,me,Me]){return ke=isNaN(ke)?0:ke*hl,pl([me,Math.cos(ke)*J,Math.sin(ke)*J,Me])}([ee,ie??ln(E,U,p),ln(C,H,p),ln(D,X,p)]);return new kn(ae,_e,Ee,je,!1)}case"lab":{const[T,E,C,D]=pl(ho(r.lab,a.lab,p));return new kn(T,E,C,D,!1)}}}}kn.black=new kn(0,0,0,1),kn.white=new kn(1,1,1,1),kn.transparent=new kn(0,0,0,0),kn.red=new kn(1,0,0,1);class eo{constructor(r,a,p){this.sensitivity=r?a?"variant":"case":a?"accent":"base",this.locale=p,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(r,a){return this.collator.compare(r,a)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const On=["bottom","center","top"];class Gr{constructor(r,a,p,v,T,E){this.text=r,this.image=a,this.scale=p,this.fontStack=v,this.textColor=T,this.verticalAlign=E}}class _n{constructor(r){this.sections=r}static fromString(r){return new _n([new Gr(r,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(r=>r.text.length!==0||r.image&&r.image.name.length!==0)}static factory(r){return r instanceof _n?r:_n.fromString(r)}toString(){return this.sections.length===0?"":this.sections.map(r=>r.text).join("")}}class Ei{constructor(r){this.values=r.slice()}static parse(r){if(r instanceof Ei)return r;if(typeof r=="number")return new Ei([r,r,r,r]);if(Array.isArray(r)&&!(r.length<1||r.length>4)){for(const a of r)if(typeof a!="number")return;switch(r.length){case 1:r=[r[0],r[0],r[0],r[0]];break;case 2:r=[r[0],r[1],r[0],r[1]];break;case 3:r=[r[0],r[1],r[2],r[1]]}return new Ei(r)}}toString(){return JSON.stringify(this.values)}static interpolate(r,a,p){return new Ei(ho(r.values,a.values,p))}}class zi{constructor(r){this.name="ExpressionEvaluationError",this.message=r}toJSON(){return this.message}}const Is=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Er{constructor(r){this.values=r.slice()}static parse(r){if(r instanceof Er)return r;if(Array.isArray(r)&&!(r.length<1)&&r.length%2==0){for(let a=0;a<r.length;a+=2){const p=r[a],v=r[a+1];if(typeof p!="string"||!Is.has(p)||!Array.isArray(v)||v.length!==2||typeof v[0]!="number"||typeof v[1]!="number")return}return new Er(r)}}toString(){return JSON.stringify(this.values)}static interpolate(r,a,p){const v=r.values,T=a.values;if(v.length!==T.length)throw new zi(`Cannot interpolate values of different length. from: ${r.toString()}, to: ${a.toString()}`);const E=[];for(let C=0;C<v.length;C+=2){if(v[C]!==T[C])throw new zi(`Cannot interpolate values containing mismatched anchors. from[${C}]: ${v[C]}, to[${C}]: ${T[C]}`);E.push(v[C]);const[D,N]=v[C+1],[U,H]=T[C+1];E.push([ln(D,U,p),ln(N,H,p)])}return new Er(E)}}class Ir{constructor(r){this.name=r.name,this.available=r.available}toString(){return this.name}static fromString(r){return r?new Ir({name:r,available:!1}):null}}class xr{constructor(r,a,p){this.from=r,this.to=a,this.transition=p}static interpolate(r,a,p){return new xr(r,a,p)}static parse(r){return r instanceof xr?r:Array.isArray(r)&&r.length===3&&typeof r[0]=="string"&&typeof r[1]=="string"&&typeof r[2]=="number"?new xr(r[0],r[1],r[2]):typeof r=="object"&&typeof r.from=="string"&&typeof r.to=="string"&&typeof r.transition=="number"?new xr(r.from,r.to,r.transition):typeof r=="string"?new xr(r,r,1):void 0}}function Ha(l,r,a,p){return typeof l=="number"&&l>=0&&l<=255&&typeof r=="number"&&r>=0&&r<=255&&typeof a=="number"&&a>=0&&a<=255?p===void 0||typeof p=="number"&&p>=0&&p<=1?null:`Invalid rgba value [${[l,r,a,p].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof p=="number"?[l,r,a,p]:[l,r,a]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Zr(l){if(l===null||typeof l=="string"||typeof l=="boolean"||typeof l=="number"||l instanceof xr||l instanceof kn||l instanceof eo||l instanceof _n||l instanceof Ei||l instanceof Er||l instanceof Ir)return!0;if(Array.isArray(l)){for(const r of l)if(!Zr(r))return!1;return!0}if(typeof l=="object"){for(const r in l)if(!Zr(l[r]))return!1;return!0}return!1}function Bn(l){if(l===null)return Pn;if(typeof l=="string")return Vt;if(typeof l=="boolean")return $t;if(typeof l=="number")return mt;if(l instanceof kn)return Lt;if(l instanceof xr)return Nn;if(l instanceof eo)return Ri;if(l instanceof _n)return ts;if(l instanceof Ei)return Si;if(l instanceof Er)return oi;if(l instanceof Ir)return xi;if(Array.isArray(l)){const r=l.length;let a;for(const p of l){const v=Bn(p);if(a){if(a===v)continue;a=Yt;break}a=v}return co(a||Yt,r)}return mn}function po(l){const r=typeof l;return l===null?"":r==="string"||r==="number"||r==="boolean"?String(l):l instanceof kn||l instanceof xr||l instanceof _n||l instanceof Ei||l instanceof Er||l instanceof Ir?l.toString():JSON.stringify(l)}class wr{constructor(r,a){this.type=r,this.value=a}static parse(r,a){if(r.length!==2)return a.error(`'literal' expression requires exactly one argument, but found ${r.length-1} instead.`);if(!Zr(r[1]))return a.error("invalid value");const p=r[1];let v=Bn(p);const T=a.expectedType;return v.kind!=="array"||v.N!==0||!T||T.kind!=="array"||typeof T.N=="number"&&T.N!==0||(v=T),new wr(v,p)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const fo={string:Vt,number:mt,boolean:$t,object:mn};class hn{constructor(r,a){this.type=r,this.args=a}static parse(r,a){if(r.length<2)return a.error("Expected at least one argument.");let p,v=1;const T=r[0];if(T==="array"){let C,D;if(r.length>2){const N=r[1];if(typeof N!="string"||!(N in fo)||N==="object")return a.error('The item type argument of "array" must be one of string, number, boolean',1);C=fo[N],v++}else C=Yt;if(r.length>3){if(r[2]!==null&&(typeof r[2]!="number"||r[2]<0||r[2]!==Math.floor(r[2])))return a.error('The length argument to "array" must be a positive integer literal',2);D=r[2],v++}p=co(C,D)}else{if(!fo[T])throw new Error(`Types doesn't contain name = ${T}`);p=fo[T]}const E=[];for(;v<r.length;v++){const C=a.parse(r[v],v,Yt);if(!C)return null;E.push(C)}return new hn(p,E)}evaluate(r){for(let a=0;a<this.args.length;a++){const p=this.args[a].evaluate(r);if(!Gs(this.type,Bn(p)))return p;if(a===this.args.length-1)throw new zi(`Expected value to be of type ${Li(this.type)}, but found ${Li(Bn(p))} instead.`)}throw new Error}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}}const Pr={"to-boolean":$t,"to-color":Lt,"to-number":mt,"to-string":Vt};class si{constructor(r,a){this.type=r,this.args=a}static parse(r,a){if(r.length<2)return a.error("Expected at least one argument.");const p=r[0];if(!Pr[p])throw new Error(`Can't parse ${p} as it is not part of the known types`);if((p==="to-boolean"||p==="to-string")&&r.length!==2)return a.error("Expected one argument.");const v=Pr[p],T=[];for(let E=1;E<r.length;E++){const C=a.parse(r[E],E,Yt);if(!C)return null;T.push(C)}return new si(v,T)}evaluate(r){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(r);case"color":{let a,p;for(const v of this.args){if(a=v.evaluate(r),p=null,a instanceof kn)return a;if(typeof a=="string"){const T=r.parseColor(a);if(T)return T}else if(Array.isArray(a)&&(p=a.length<3||a.length>4?`Invalid rgba value ${JSON.stringify(a)}: expected an array containing either three or four numeric values.`:Ha(a[0],a[1],a[2],a[3]),!p))return new kn(a[0]/255,a[1]/255,a[2]/255,a[3])}throw new zi(p||`Could not parse color from value '${typeof a=="string"?a:JSON.stringify(a)}'`)}case"padding":{let a;for(const p of this.args){a=p.evaluate(r);const v=Ei.parse(a);if(v)return v}throw new zi(`Could not parse padding from value '${typeof a=="string"?a:JSON.stringify(a)}'`)}case"variableAnchorOffsetCollection":{let a;for(const p of this.args){a=p.evaluate(r);const v=Er.parse(a);if(v)return v}throw new zi(`Could not parse variableAnchorOffsetCollection from value '${typeof a=="string"?a:JSON.stringify(a)}'`)}case"number":{let a=null;for(const p of this.args){if(a=p.evaluate(r),a===null)return 0;const v=Number(a);if(!isNaN(v))return v}throw new zi(`Could not convert ${JSON.stringify(a)} to number.`)}case"formatted":return _n.fromString(po(this.args[0].evaluate(r)));case"resolvedImage":return Ir.fromString(po(this.args[0].evaluate(r)));case"projectionDefinition":return this.args[0].evaluate(r);default:return po(this.args[0].evaluate(r))}}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}}const fl=["Unknown","Point","LineString","Polygon"];class Kn{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?fl[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(r){let a=this._parseColorCache[r];return a||(a=this._parseColorCache[r]=kn.parse(r)),a}}class ba{constructor(r,a,p=[],v,T=new en,E=[]){this.registry=r,this.path=p,this.key=p.map(C=>`[${C}]`).join(""),this.scope=T,this.errors=E,this.expectedType=v,this._isConstant=a}parse(r,a,p,v,T={}){return a?this.concat(a,p,v)._parse(r,T):this._parse(r,T)}_parse(r,a){function p(v,T,E){return E==="assert"?new hn(T,[v]):E==="coerce"?new si(T,[v]):v}if(r!==null&&typeof r!="string"&&typeof r!="boolean"&&typeof r!="number"||(r=["literal",r]),Array.isArray(r)){if(r.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const v=r[0];if(typeof v!="string")return this.error(`Expression name must be a string, but found ${typeof v} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const T=this.registry[v];if(T){let E=T.parse(r,this);if(!E)return null;if(this.expectedType){const C=this.expectedType,D=E.type;if(C.kind!=="string"&&C.kind!=="number"&&C.kind!=="boolean"&&C.kind!=="object"&&C.kind!=="array"||D.kind!=="value")if(C.kind!=="projectionDefinition"||D.kind!=="string"&&D.kind!=="array")if(C.kind!=="color"&&C.kind!=="formatted"&&C.kind!=="resolvedImage"||D.kind!=="value"&&D.kind!=="string")if(C.kind!=="padding"||D.kind!=="value"&&D.kind!=="number"&&D.kind!=="array")if(C.kind!=="variableAnchorOffsetCollection"||D.kind!=="value"&&D.kind!=="array"){if(this.checkSubtype(C,D))return null}else E=p(E,C,a.typeAnnotation||"coerce");else E=p(E,C,a.typeAnnotation||"coerce");else E=p(E,C,a.typeAnnotation||"coerce");else E=p(E,C,a.typeAnnotation||"coerce");else E=p(E,C,a.typeAnnotation||"assert")}if(!(E instanceof wr)&&E.type.kind!=="resolvedImage"&&this._isConstant(E)){const C=new Kn;try{E=new wr(E.type,E.evaluate(C))}catch(D){return this.error(D.message),null}}return E}return this.error(`Unknown expression "${v}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(r===void 0?"'undefined' value invalid. Use null instead.":typeof r=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof r} instead.`)}concat(r,a,p){const v=typeof r=="number"?this.path.concat(r):this.path,T=p?this.scope.concat(p):this.scope;return new ba(this.registry,this._isConstant,v,a||null,T,this.errors)}error(r,...a){const p=`${this.key}${a.map(v=>`[${v}]`).join("")}`;this.errors.push(new Nt(p,r))}checkSubtype(r,a){const p=Gs(r,a);return p&&this.error(p),p}}class Wn{constructor(r,a){this.type=a.type,this.bindings=[].concat(r),this.result=a}evaluate(r){return this.result.evaluate(r)}eachChild(r){for(const a of this.bindings)r(a[1]);r(this.result)}static parse(r,a){if(r.length<4)return a.error(`Expected at least 3 arguments, but found ${r.length-1} instead.`);const p=[];for(let T=1;T<r.length-1;T+=2){const E=r[T];if(typeof E!="string")return a.error(`Expected string, but found ${typeof E} instead.`,T);if(/[^a-zA-Z0-9_]/.test(E))return a.error("Variable names must contain only alphanumeric characters or '_'.",T);const C=a.parse(r[T+1],T+1);if(!C)return null;p.push([E,C])}const v=a.parse(r[r.length-1],r.length-1,a.expectedType,p);return v?new Wn(p,v):null}outputDefined(){return this.result.outputDefined()}}class xn{constructor(r,a){this.type=a.type,this.name=r,this.boundExpression=a}static parse(r,a){if(r.length!==2||typeof r[1]!="string")return a.error("'var' expression requires exactly one string literal argument.");const p=r[1];return a.scope.has(p)?new xn(p,a.scope.get(p)):a.error(`Unknown variable "${p}". Make sure "${p}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(r){return this.boundExpression.evaluate(r)}eachChild(){}outputDefined(){return!1}}class os{constructor(r,a,p){this.type=r,this.index=a,this.input=p}static parse(r,a){if(r.length!==3)return a.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const p=a.parse(r[1],1,mt),v=a.parse(r[2],2,co(a.expectedType||Yt));return p&&v?new os(v.type.itemType,p,v):null}evaluate(r){const a=this.index.evaluate(r),p=this.input.evaluate(r);if(a<0)throw new zi(`Array index out of bounds: ${a} < 0.`);if(a>=p.length)throw new zi(`Array index out of bounds: ${a} > ${p.length-1}.`);if(a!==Math.floor(a))throw new zi(`Array index must be an integer, but found ${a} instead.`);return p[a]}eachChild(r){r(this.index),r(this.input)}outputDefined(){return!1}}class Hn{constructor(r,a){this.type=$t,this.needle=r,this.haystack=a}static parse(r,a){if(r.length!==3)return a.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const p=a.parse(r[1],1,Yt),v=a.parse(r[2],2,Yt);return p&&v?ul(p.type,[$t,Vt,mt,Pn,Yt])?new Hn(p,v):a.error(`Expected first argument to be of type boolean, string, number or null, but found ${Li(p.type)} instead`):null}evaluate(r){const a=this.needle.evaluate(r),p=this.haystack.evaluate(r);if(!p)return!1;if(!xa(a,["boolean","string","number","null"]))throw new zi(`Expected first argument to be of type boolean, string, number or null, but found ${Li(Bn(a))} instead.`);if(!xa(p,["string","array"]))throw new zi(`Expected second argument to be of type array or string, but found ${Li(Bn(p))} instead.`);return p.indexOf(a)>=0}eachChild(r){r(this.needle),r(this.haystack)}outputDefined(){return!0}}class gi{constructor(r,a,p){this.type=mt,this.needle=r,this.haystack=a,this.fromIndex=p}static parse(r,a){if(r.length<=2||r.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const p=a.parse(r[1],1,Yt),v=a.parse(r[2],2,Yt);if(!p||!v)return null;if(!ul(p.type,[$t,Vt,mt,Pn,Yt]))return a.error(`Expected first argument to be of type boolean, string, number or null, but found ${Li(p.type)} instead`);if(r.length===4){const T=a.parse(r[3],3,mt);return T?new gi(p,v,T):null}return new gi(p,v)}evaluate(r){const a=this.needle.evaluate(r),p=this.haystack.evaluate(r);if(!xa(a,["boolean","string","number","null"]))throw new zi(`Expected first argument to be of type boolean, string, number or null, but found ${Li(Bn(a))} instead.`);let v;if(this.fromIndex&&(v=this.fromIndex.evaluate(r)),xa(p,["string"])){const T=p.indexOf(a,v);return T===-1?-1:[...p.slice(0,T)].length}if(xa(p,["array"]))return p.indexOf(a,v);throw new zi(`Expected second argument to be of type array or string, but found ${Li(Bn(p))} instead.`)}eachChild(r){r(this.needle),r(this.haystack),this.fromIndex&&r(this.fromIndex)}outputDefined(){return!1}}class Xi{constructor(r,a,p,v,T,E){this.inputType=r,this.type=a,this.input=p,this.cases=v,this.outputs=T,this.otherwise=E}static parse(r,a){if(r.length<5)return a.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if(r.length%2!=1)return a.error("Expected an even number of arguments.");let p,v;a.expectedType&&a.expectedType.kind!=="value"&&(v=a.expectedType);const T={},E=[];for(let N=2;N<r.length-1;N+=2){let U=r[N];const H=r[N+1];Array.isArray(U)||(U=[U]);const X=a.concat(N);if(U.length===0)return X.error("Expected at least one branch label.");for(const ie of U){if(typeof ie!="number"&&typeof ie!="string")return X.error("Branch labels must be numbers or strings.");if(typeof ie=="number"&&Math.abs(ie)>Number.MAX_SAFE_INTEGER)return X.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof ie=="number"&&Math.floor(ie)!==ie)return X.error("Numeric branch labels must be integer values.");if(p){if(X.checkSubtype(p,Bn(ie)))return null}else p=Bn(ie);if(T[String(ie)]!==void 0)return X.error("Branch labels must be unique.");T[String(ie)]=E.length}const ee=a.parse(H,N,v);if(!ee)return null;v=v||ee.type,E.push(ee)}const C=a.parse(r[1],1,Yt);if(!C)return null;const D=a.parse(r[r.length-1],r.length-1,v);return D?C.type.kind!=="value"&&a.concat(1).checkSubtype(p,C.type)?null:new Xi(p,v,C,T,E,D):null}evaluate(r){const a=this.input.evaluate(r);return(Bn(a)===this.inputType&&this.outputs[this.cases[a]]||this.otherwise).evaluate(r)}eachChild(r){r(this.input),this.outputs.forEach(r),r(this.otherwise)}outputDefined(){return this.outputs.every(r=>r.outputDefined())&&this.otherwise.outputDefined()}}class Vo{constructor(r,a,p){this.type=r,this.branches=a,this.otherwise=p}static parse(r,a){if(r.length<4)return a.error(`Expected at least 3 arguments, but found only ${r.length-1}.`);if(r.length%2!=0)return a.error("Expected an odd number of arguments.");let p;a.expectedType&&a.expectedType.kind!=="value"&&(p=a.expectedType);const v=[];for(let E=1;E<r.length-1;E+=2){const C=a.parse(r[E],E,$t);if(!C)return null;const D=a.parse(r[E+1],E+1,p);if(!D)return null;v.push([C,D]),p=p||D.type}const T=a.parse(r[r.length-1],r.length-1,p);if(!T)return null;if(!p)throw new Error("Can't infer output type");return new Vo(p,v,T)}evaluate(r){for(const[a,p]of this.branches)if(a.evaluate(r))return p.evaluate(r);return this.otherwise.evaluate(r)}eachChild(r){for(const[a,p]of this.branches)r(a),r(p);r(this.otherwise)}outputDefined(){return this.branches.every(([r,a])=>a.outputDefined())&&this.otherwise.outputDefined()}}class ss{constructor(r,a,p,v){this.type=r,this.input=a,this.beginIndex=p,this.endIndex=v}static parse(r,a){if(r.length<=2||r.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const p=a.parse(r[1],1,Yt),v=a.parse(r[2],2,mt);if(!p||!v)return null;if(!ul(p.type,[co(Yt),Vt,Yt]))return a.error(`Expected first argument to be of type array or string, but found ${Li(p.type)} instead`);if(r.length===4){const T=a.parse(r[3],3,mt);return T?new ss(p.type,p,v,T):null}return new ss(p.type,p,v)}evaluate(r){const a=this.input.evaluate(r),p=this.beginIndex.evaluate(r);let v;if(this.endIndex&&(v=this.endIndex.evaluate(r)),xa(a,["string"]))return[...a].slice(p,v).join("");if(xa(a,["array"]))return a.slice(p,v);throw new zi(`Expected first argument to be of type array or string, but found ${Li(Bn(a))} instead.`)}eachChild(r){r(this.input),r(this.beginIndex),this.endIndex&&r(this.endIndex)}outputDefined(){return!1}}function ji(l,r){const a=l.length-1;let p,v,T=0,E=a,C=0;for(;T<=E;)if(C=Math.floor((T+E)/2),p=l[C],v=l[C+1],p<=r){if(C===a||r<v)return C;T=C+1}else{if(!(p>r))throw new zi("Input is not a number.");E=C-1}return 0}class Ta{constructor(r,a,p){this.type=r,this.input=a,this.labels=[],this.outputs=[];for(const[v,T]of p)this.labels.push(v),this.outputs.push(T)}static parse(r,a){if(r.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return a.error("Expected an even number of arguments.");const p=a.parse(r[1],1,mt);if(!p)return null;const v=[];let T=null;a.expectedType&&a.expectedType.kind!=="value"&&(T=a.expectedType);for(let E=1;E<r.length;E+=2){const C=E===1?-1/0:r[E],D=r[E+1],N=E,U=E+1;if(typeof C!="number")return a.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',N);if(v.length&&v[v.length-1][0]>=C)return a.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',N);const H=a.parse(D,U,T);if(!H)return null;T=T||H.type,v.push([C,H])}return new Ta(T,p,v)}evaluate(r){const a=this.labels,p=this.outputs;if(a.length===1)return p[0].evaluate(r);const v=this.input.evaluate(r);if(v<=a[0])return p[0].evaluate(r);const T=a.length;return v>=a[T-1]?p[T-1].evaluate(r):p[ji(a,v)].evaluate(r)}eachChild(r){r(this.input);for(const a of this.outputs)r(a)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}}function ml(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}var qa,Ga,ei=function(){if(Ga)return qa;function l(r,a,p,v){this.cx=3*r,this.bx=3*(p-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*a,this.by=3*(v-a)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=a,this.p2x=p,this.p2y=v}return Ga=1,qa=l,l.prototype={sampleCurveX:function(r){return((this.ax*r+this.bx)*r+this.cx)*r},sampleCurveY:function(r){return((this.ay*r+this.by)*r+this.cy)*r},sampleCurveDerivativeX:function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},solveCurveX:function(r,a){if(a===void 0&&(a=1e-6),r<0)return 0;if(r>1)return 1;for(var p=r,v=0;v<8;v++){var T=this.sampleCurveX(p)-r;if(Math.abs(T)<a)return p;var E=this.sampleCurveDerivativeX(p);if(Math.abs(E)<1e-6)break;p-=T/E}var C=0,D=1;for(p=r,v=0;v<20&&(T=this.sampleCurveX(p),!(Math.abs(T-r)<a));v++)r>T?C=p:D=p,p=.5*(D-C)+C;return p},solve:function(r,a){return this.sampleCurveY(this.solveCurveX(r,a))}},qa}(),to=ml(ei);class qn{constructor(r,a,p,v,T){this.type=r,this.operator=a,this.interpolation=p,this.input=v,this.labels=[],this.outputs=[];for(const[E,C]of T)this.labels.push(E),this.outputs.push(C)}static interpolationFactor(r,a,p,v){let T=0;if(r.name==="exponential")T=mr(a,r.base,p,v);else if(r.name==="linear")T=mr(a,1,p,v);else if(r.name==="cubic-bezier"){const E=r.controlPoints;T=new to(E[0],E[1],E[2],E[3]).solve(mr(a,1,p,v))}return T}static parse(r,a){let[p,v,T,...E]=r;if(!Array.isArray(v)||v.length===0)return a.error("Expected an interpolation type expression.",1);if(v[0]==="linear")v={name:"linear"};else if(v[0]==="exponential"){const N=v[1];if(typeof N!="number")return a.error("Exponential interpolation requires a numeric base.",1,1);v={name:"exponential",base:N}}else{if(v[0]!=="cubic-bezier")return a.error(`Unknown interpolation type ${String(v[0])}`,1,0);{const N=v.slice(1);if(N.length!==4||N.some(U=>typeof U!="number"||U<0||U>1))return a.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);v={name:"cubic-bezier",controlPoints:N}}}if(r.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return a.error("Expected an even number of arguments.");if(T=a.parse(T,2,mt),!T)return null;const C=[];let D=null;p==="interpolate-hcl"||p==="interpolate-lab"?D=Lt:a.expectedType&&a.expectedType.kind!=="value"&&(D=a.expectedType);for(let N=0;N<E.length;N+=2){const U=E[N],H=E[N+1],X=N+3,ee=N+4;if(typeof U!="number")return a.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',X);if(C.length&&C[C.length-1][0]>=U)return a.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',X);const ie=a.parse(H,ee,D);if(!ie)return null;D=D||ie.type,C.push([U,ie])}return Es(D,mt)||Es(D,Nn)||Es(D,Lt)||Es(D,Si)||Es(D,oi)||Es(D,co(mt))?new qn(D,p,v,T,C):a.error(`Type ${Li(D)} is not interpolatable.`)}evaluate(r){const a=this.labels,p=this.outputs;if(a.length===1)return p[0].evaluate(r);const v=this.input.evaluate(r);if(v<=a[0])return p[0].evaluate(r);const T=a.length;if(v>=a[T-1])return p[T-1].evaluate(r);const E=ji(a,v),C=qn.interpolationFactor(this.interpolation,v,a[E],a[E+1]),D=p[E].evaluate(r),N=p[E+1].evaluate(r);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return ln(D,N,C);case"color":return kn.interpolate(D,N,C);case"padding":return Ei.interpolate(D,N,C);case"variableAnchorOffsetCollection":return Er.interpolate(D,N,C);case"array":return ho(D,N,C);case"projectionDefinition":return xr.interpolate(D,N,C)}case"interpolate-hcl":return kn.interpolate(D,N,C,"hcl");case"interpolate-lab":return kn.interpolate(D,N,C,"lab")}}eachChild(r){r(this.input);for(const a of this.outputs)r(a)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}}function mr(l,r,a,p){const v=p-a,T=l-a;return v===0?0:r===1?T/v:(Math.pow(r,T)-1)/(Math.pow(r,v)-1)}const mo={color:kn.interpolate,number:ln,padding:Ei.interpolate,variableAnchorOffsetCollection:Er.interpolate,array:ho};class Ps{constructor(r,a){this.type=r,this.args=a}static parse(r,a){if(r.length<2)return a.error("Expected at least one argument.");let p=null;const v=a.expectedType;v&&v.kind!=="value"&&(p=v);const T=[];for(const C of r.slice(1)){const D=a.parse(C,1+T.length,p,void 0,{typeAnnotation:"omit"});if(!D)return null;p=p||D.type,T.push(D)}if(!p)throw new Error("No output type");const E=v&&T.some(C=>Gs(v,C.type));return new Ps(E?Yt:p,T)}evaluate(r){let a,p=null,v=0;for(const T of this.args)if(v++,p=T.evaluate(r),p&&p instanceof Ir&&!p.available&&(a||(a=p.name),p=null,v===this.args.length&&(p=a)),p!==null)break;return p}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}}function Ii(l,r){return l==="=="||l==="!="?r.kind==="boolean"||r.kind==="string"||r.kind==="number"||r.kind==="null"||r.kind==="value":r.kind==="string"||r.kind==="number"||r.kind==="value"}function Vl(l,r,a,p){return p.compare(r,a)===0}function or(l,r,a){const p=l!=="=="&&l!=="!=";return class ZE{constructor(T,E,C){this.type=$t,this.lhs=T,this.rhs=E,this.collator=C,this.hasUntypedArgument=T.type.kind==="value"||E.type.kind==="value"}static parse(T,E){if(T.length!==3&&T.length!==4)return E.error("Expected two or three arguments.");const C=T[0];let D=E.parse(T[1],1,Yt);if(!D)return null;if(!Ii(C,D.type))return E.concat(1).error(`"${C}" comparisons are not supported for type '${Li(D.type)}'.`);let N=E.parse(T[2],2,Yt);if(!N)return null;if(!Ii(C,N.type))return E.concat(2).error(`"${C}" comparisons are not supported for type '${Li(N.type)}'.`);if(D.type.kind!==N.type.kind&&D.type.kind!=="value"&&N.type.kind!=="value")return E.error(`Cannot compare types '${Li(D.type)}' and '${Li(N.type)}'.`);p&&(D.type.kind==="value"&&N.type.kind!=="value"?D=new hn(N.type,[D]):D.type.kind!=="value"&&N.type.kind==="value"&&(N=new hn(D.type,[N])));let U=null;if(T.length===4){if(D.type.kind!=="string"&&N.type.kind!=="string"&&D.type.kind!=="value"&&N.type.kind!=="value")return E.error("Cannot use collator to compare non-string types.");if(U=E.parse(T[3],3,Ri),!U)return null}return new ZE(D,N,U)}evaluate(T){const E=this.lhs.evaluate(T),C=this.rhs.evaluate(T);if(p&&this.hasUntypedArgument){const D=Bn(E),N=Bn(C);if(D.kind!==N.kind||D.kind!=="string"&&D.kind!=="number")throw new zi(`Expected arguments for "${l}" to be (string, string) or (number, number), but found (${D.kind}, ${N.kind}) instead.`)}if(this.collator&&!p&&this.hasUntypedArgument){const D=Bn(E),N=Bn(C);if(D.kind!=="string"||N.kind!=="string")return r(T,E,C)}return this.collator?a(T,E,C,this.collator.evaluate(T)):r(T,E,C)}eachChild(T){T(this.lhs),T(this.rhs),this.collator&&T(this.collator)}outputDefined(){return!0}}}const Cs=or("==",function(l,r,a){return r===a},Vl),vu=or("!=",function(l,r,a){return r!==a},function(l,r,a,p){return!Vl(0,r,a,p)}),So=or("<",function(l,r,a){return r<a},function(l,r,a,p){return p.compare(r,a)<0}),$u=or(">",function(l,r,a){return r>a},function(l,r,a,p){return p.compare(r,a)>0}),Eo=or("<=",function(l,r,a){return r<=a},function(l,r,a,p){return p.compare(r,a)<=0}),As=or(">=",function(l,r,a){return r>=a},function(l,r,a,p){return p.compare(r,a)>=0});class Io{constructor(r,a,p){this.type=Ri,this.locale=p,this.caseSensitive=r,this.diacriticSensitive=a}static parse(r,a){if(r.length!==2)return a.error("Expected one argument.");const p=r[1];if(typeof p!="object"||Array.isArray(p))return a.error("Collator options argument must be an object.");const v=a.parse(p["case-sensitive"]!==void 0&&p["case-sensitive"],1,$t);if(!v)return null;const T=a.parse(p["diacritic-sensitive"]!==void 0&&p["diacritic-sensitive"],1,$t);if(!T)return null;let E=null;return p.locale&&(E=a.parse(p.locale,1,Vt),!E)?null:new Io(v,T,E)}evaluate(r){return new eo(this.caseSensitive.evaluate(r),this.diacriticSensitive.evaluate(r),this.locale?this.locale.evaluate(r):null)}eachChild(r){r(this.caseSensitive),r(this.diacriticSensitive),this.locale&&r(this.locale)}outputDefined(){return!1}}class tr{constructor(r,a,p,v,T){this.type=Vt,this.number=r,this.locale=a,this.currency=p,this.minFractionDigits=v,this.maxFractionDigits=T}static parse(r,a){if(r.length!==3)return a.error("Expected two arguments.");const p=a.parse(r[1],1,mt);if(!p)return null;const v=r[2];if(typeof v!="object"||Array.isArray(v))return a.error("NumberFormat options argument must be an object.");let T=null;if(v.locale&&(T=a.parse(v.locale,1,Vt),!T))return null;let E=null;if(v.currency&&(E=a.parse(v.currency,1,Vt),!E))return null;let C=null;if(v["min-fraction-digits"]&&(C=a.parse(v["min-fraction-digits"],1,mt),!C))return null;let D=null;return v["max-fraction-digits"]&&(D=a.parse(v["max-fraction-digits"],1,mt),!D)?null:new tr(p,T,E,C,D)}evaluate(r){return new Intl.NumberFormat(this.locale?this.locale.evaluate(r):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(r):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(r):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(r):void 0}).format(this.number.evaluate(r))}eachChild(r){r(this.number),this.locale&&r(this.locale),this.currency&&r(this.currency),this.minFractionDigits&&r(this.minFractionDigits),this.maxFractionDigits&&r(this.maxFractionDigits)}outputDefined(){return!1}}class Ws{constructor(r){this.type=ts,this.sections=r}static parse(r,a){if(r.length<2)return a.error("Expected at least one argument.");const p=r[1];if(!Array.isArray(p)&&typeof p=="object")return a.error("First argument must be an image or text section.");const v=[];let T=!1;for(let E=1;E<=r.length-1;++E){const C=r[E];if(T&&typeof C=="object"&&!Array.isArray(C)){T=!1;let D=null;if(C["font-scale"]&&(D=a.parse(C["font-scale"],1,mt),!D))return null;let N=null;if(C["text-font"]&&(N=a.parse(C["text-font"],1,co(Vt)),!N))return null;let U=null;if(C["text-color"]&&(U=a.parse(C["text-color"],1,Lt),!U))return null;let H=null;if(C["vertical-align"]){if(typeof C["vertical-align"]=="string"&&!On.includes(C["vertical-align"]))return a.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${C["vertical-align"]}' instead.`);if(H=a.parse(C["vertical-align"],1,Vt),!H)return null}const X=v[v.length-1];X.scale=D,X.font=N,X.textColor=U,X.verticalAlign=H}else{const D=a.parse(r[E],1,Yt);if(!D)return null;const N=D.type.kind;if(N!=="string"&&N!=="value"&&N!=="null"&&N!=="resolvedImage")return a.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");T=!0,v.push({content:D,scale:null,font:null,textColor:null,verticalAlign:null})}}return new Ws(v)}evaluate(r){return new _n(this.sections.map(a=>{const p=a.content.evaluate(r);return Bn(p)===xi?new Gr("",p,null,null,null,a.verticalAlign?a.verticalAlign.evaluate(r):null):new Gr(po(p),null,a.scale?a.scale.evaluate(r):null,a.font?a.font.evaluate(r).join(","):null,a.textColor?a.textColor.evaluate(r):null,a.verticalAlign?a.verticalAlign.evaluate(r):null)}))}eachChild(r){for(const a of this.sections)r(a.content),a.scale&&r(a.scale),a.font&&r(a.font),a.textColor&&r(a.textColor),a.verticalAlign&&r(a.verticalAlign)}outputDefined(){return!1}}class Ks{constructor(r){this.type=xi,this.input=r}static parse(r,a){if(r.length!==2)return a.error("Expected two arguments.");const p=a.parse(r[1],1,Vt);return p?new Ks(p):a.error("No image name provided.")}evaluate(r){const a=this.input.evaluate(r),p=Ir.fromString(a);return p&&r.availableImages&&(p.available=r.availableImages.indexOf(a)>-1),p}eachChild(r){r(this.input)}outputDefined(){return!1}}class gl{constructor(r){this.type=mt,this.input=r}static parse(r,a){if(r.length!==2)return a.error(`Expected 1 argument, but found ${r.length-1} instead.`);const p=a.parse(r[1],1);return p?p.type.kind!=="array"&&p.type.kind!=="string"&&p.type.kind!=="value"?a.error(`Expected argument of type string or array, but found ${Li(p.type)} instead.`):new gl(p):null}evaluate(r){const a=this.input.evaluate(r);if(typeof a=="string")return[...a].length;if(Array.isArray(a))return a.length;throw new zi(`Expected value to be of type string or array, but found ${Li(Bn(a))} instead.`)}eachChild(r){r(this.input)}outputDefined(){return!1}}const no=8192;function Ul(l,r){const a=(180+l[0])/360,p=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+l[1]*Math.PI/360)))/360,v=Math.pow(2,r.z);return[Math.round(a*v*no),Math.round(p*v*no)]}function jl(l,r){const a=Math.pow(2,r.z);return[(v=(l[0]/no+r.x)/a,360*v-180),(p=(l[1]/no+r.y)/a,360/Math.PI*Math.atan(Math.exp((180-360*p)*Math.PI/180))-90)];var p,v}function as(l,r){l[0]=Math.min(l[0],r[0]),l[1]=Math.min(l[1],r[1]),l[2]=Math.max(l[2],r[0]),l[3]=Math.max(l[3],r[1])}function _l(l,r){return!(l[0]<=r[0]||l[2]>=r[2]||l[1]<=r[1]||l[3]>=r[3])}function Za(l,r,a){const p=l[0]-r[0],v=l[1]-r[1],T=l[0]-a[0],E=l[1]-a[1];return p*E-T*v==0&&p*T<=0&&v*E<=0}function $l(l,r,a,p){return(v=[p[0]-a[0],p[1]-a[1]])[0]*(T=[r[0]-l[0],r[1]-l[1]])[1]-v[1]*T[0]!=0&&!(!Po(l,r,a,p)||!Po(a,p,l,r));var v,T}function Hl(l,r,a){for(const p of a)for(let v=0;v<p.length-1;++v)if($l(l,r,p[v],p[v+1]))return!0;return!1}function ls(l,r,a=!1){let p=!1;for(const C of r)for(let D=0;D<C.length-1;D++){if(Za(l,C[D],C[D+1]))return a;(T=C[D])[1]>(v=l)[1]!=(E=C[D+1])[1]>v[1]&&v[0]<(E[0]-T[0])*(v[1]-T[1])/(E[1]-T[1])+T[0]&&(p=!p)}var v,T,E;return p}function Wr(l,r){for(const a of r)if(ls(l,a))return!0;return!1}function ks(l,r){for(const a of l)if(!ls(a,r))return!1;for(let a=0;a<l.length-1;++a)if(Hl(l[a],l[a+1],r))return!1;return!0}function Pc(l,r){for(const a of r)if(ks(l,a))return!0;return!1}function Po(l,r,a,p){const v=p[0]-a[0],T=p[1]-a[1],E=(l[0]-a[0])*T-v*(l[1]-a[1]),C=(r[0]-a[0])*T-v*(r[1]-a[1]);return E>0&&C<0||E<0&&C>0}function P(l,r,a){const p=[];for(let v=0;v<l.length;v++){const T=[];for(let E=0;E<l[v].length;E++){const C=Ul(l[v][E],a);as(r,C),T.push(C)}p.push(T)}return p}function j(l,r,a){const p=[];for(let v=0;v<l.length;v++){const T=P(l[v],r,a);p.push(T)}return p}function Y(l,r,a,p){if(l[0]<a[0]||l[0]>a[2]){const v=.5*p;let T=l[0]-a[0]>v?-p:a[0]-l[0]>v?p:0;T===0&&(T=l[0]-a[2]>v?-p:a[2]-l[0]>v?p:0),l[0]+=T}as(r,l)}function ye(l,r,a,p){const v=Math.pow(2,p.z)*no,T=[p.x*no,p.y*no],E=[];for(const C of l)for(const D of C){const N=[D.x+T[0],D.y+T[1]];Y(N,r,a,v),E.push(N)}return E}function nt(l,r,a,p){const v=Math.pow(2,p.z)*no,T=[p.x*no,p.y*no],E=[];for(const D of l){const N=[];for(const U of D){const H=[U.x+T[0],U.y+T[1]];as(r,H),N.push(H)}E.push(N)}if(r[2]-r[0]<=v/2){(C=r)[0]=C[1]=1/0,C[2]=C[3]=-1/0;for(const D of E)for(const N of D)Y(N,r,a,v)}var C;return E}class ft{constructor(r,a){this.type=$t,this.geojson=r,this.geometries=a}static parse(r,a){if(r.length!==2)return a.error(`'within' expression requires exactly one argument, but found ${r.length-1} instead.`);if(Zr(r[1])){const p=r[1];if(p.type==="FeatureCollection"){const v=[];for(const T of p.features){const{type:E,coordinates:C}=T.geometry;E==="Polygon"&&v.push(C),E==="MultiPolygon"&&v.push(...C)}if(v.length)return new ft(p,{type:"MultiPolygon",coordinates:v})}else if(p.type==="Feature"){const v=p.geometry.type;if(v==="Polygon"||v==="MultiPolygon")return new ft(p,p.geometry)}else if(p.type==="Polygon"||p.type==="MultiPolygon")return new ft(p,p)}return a.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(r){if(r.geometry()!=null&&r.canonicalID()!=null){if(r.geometryType()==="Point")return function(a,p){const v=[1/0,1/0,-1/0,-1/0],T=[1/0,1/0,-1/0,-1/0],E=a.canonicalID();if(p.type==="Polygon"){const C=P(p.coordinates,T,E),D=ye(a.geometry(),v,T,E);if(!_l(v,T))return!1;for(const N of D)if(!ls(N,C))return!1}if(p.type==="MultiPolygon"){const C=j(p.coordinates,T,E),D=ye(a.geometry(),v,T,E);if(!_l(v,T))return!1;for(const N of D)if(!Wr(N,C))return!1}return!0}(r,this.geometries);if(r.geometryType()==="LineString")return function(a,p){const v=[1/0,1/0,-1/0,-1/0],T=[1/0,1/0,-1/0,-1/0],E=a.canonicalID();if(p.type==="Polygon"){const C=P(p.coordinates,T,E),D=nt(a.geometry(),v,T,E);if(!_l(v,T))return!1;for(const N of D)if(!ks(N,C))return!1}if(p.type==="MultiPolygon"){const C=j(p.coordinates,T,E),D=nt(a.geometry(),v,T,E);if(!_l(v,T))return!1;for(const N of D)if(!Pc(N,C))return!1}return!0}(r,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Zt=class{constructor(l=[],r=(a,p)=>a<p?-1:a>p?1:0){if(this.data=l,this.length=this.data.length,this.compare=r,this.length>0)for(let a=(this.length>>1)-1;a>=0;a--)this._down(a)}push(l){this.data.push(l),this._up(this.length++)}pop(){if(this.length===0)return;const l=this.data[0],r=this.data.pop();return--this.length>0&&(this.data[0]=r,this._down(0)),l}peek(){return this.data[0]}_up(l){const{data:r,compare:a}=this,p=r[l];for(;l>0;){const v=l-1>>1,T=r[v];if(a(p,T)>=0)break;r[l]=T,l=v}r[l]=p}_down(l){const{data:r,compare:a}=this,p=this.length>>1,v=r[l];for(;l<p;){let T=1+(l<<1);const E=T+1;if(E<this.length&&a(r[E],r[T])<0&&(T=E),a(r[T],v)>=0)break;r[l]=r[T],l=T}r[l]=v}};function Pi(l,r,a=0,p=l.length-1,v=ai){for(;p>a;){if(p-a>600){const D=p-a+1,N=r-a+1,U=Math.log(D),H=.5*Math.exp(2*U/3),X=.5*Math.sqrt(U*H*(D-H)/D)*(N-D/2<0?-1:1);Pi(l,r,Math.max(a,Math.floor(r-N*H/D+X)),Math.min(p,Math.floor(r+(D-N)*H/D+X)),v)}const T=l[r];let E=a,C=p;for(cr(l,a,r),v(l[p],T)>0&&cr(l,a,p);E<C;){for(cr(l,E,C),E++,C--;v(l[E],T)<0;)E++;for(;v(l[C],T)>0;)C--}v(l[a],T)===0?cr(l,a,C):(C++,cr(l,C,p)),C<=r&&(a=C+1),r<=C&&(p=C-1)}}function cr(l,r,a){const p=l[r];l[r]=l[a],l[a]=p}function ai(l,r){return l<r?-1:l>r?1:0}function wi(l,r){if(l.length<=1)return[l];const a=[];let p,v;for(const T of l){const E=Ms(T);E!==0&&(T.area=Math.abs(E),v===void 0&&(v=E<0),v===E<0?(p&&a.push(p),p=[T]):p.push(T))}if(p&&a.push(p),r>1)for(let T=0;T<a.length;T++)a[T].length<=r||(Pi(a[T],r,1,a[T].length-1,sr),a[T]=a[T].slice(0,r));return a}function sr(l,r){return r.area-l.area}function Ms(l){let r=0;for(let a,p,v=0,T=l.length,E=T-1;v<T;E=v++)a=l[v],p=l[E],r+=(p.x-a.x)*(a.y+p.y);return r}const gr=1/298.257223563,Wa=gr*(2-gr),Rs=Math.PI/180;class Cc{constructor(r){const a=6378.137*Rs*1e3,p=Math.cos(r*Rs),v=1/(1-Wa*(1-p*p)),T=Math.sqrt(v);this.kx=a*T*p,this.ky=a*T*v*(1-Wa)}distance(r,a){const p=this.wrap(r[0]-a[0])*this.kx,v=(r[1]-a[1])*this.ky;return Math.sqrt(p*p+v*v)}pointOnLine(r,a){let p,v,T,E,C=1/0;for(let D=0;D<r.length-1;D++){let N=r[D][0],U=r[D][1],H=this.wrap(r[D+1][0]-N)*this.kx,X=(r[D+1][1]-U)*this.ky,ee=0;H===0&&X===0||(ee=(this.wrap(a[0]-N)*this.kx*H+(a[1]-U)*this.ky*X)/(H*H+X*X),ee>1?(N=r[D+1][0],U=r[D+1][1]):ee>0&&(N+=H/this.kx*ee,U+=X/this.ky*ee)),H=this.wrap(a[0]-N)*this.kx,X=(a[1]-U)*this.ky;const ie=H*H+X*X;ie<C&&(C=ie,p=N,v=U,T=D,E=ee)}return{point:[p,v],index:T,t:Math.max(0,Math.min(1,E))}}wrap(r){for(;r<-180;)r+=360;for(;r>180;)r-=360;return r}}function yl(l,r){return r[0]-l[0]}function ql(l){return l[1]-l[0]+1}function io(l,r){return l[1]>=l[0]&&l[1]<r}function yh(l,r){if(l[0]>l[1])return[null,null];const a=ql(l);if(r){if(a===2)return[l,null];const v=Math.floor(a/2);return[[l[0],l[0]+v],[l[0]+v,l[1]]]}if(a===1)return[l,null];const p=Math.floor(a/2)-1;return[[l[0],l[0]+p],[l[0]+p+1,l[1]]]}function Sa(l,r){if(!io(r,l.length))return[1/0,1/0,-1/0,-1/0];const a=[1/0,1/0,-1/0,-1/0];for(let p=r[0];p<=r[1];++p)as(a,l[p]);return a}function Gl(l){const r=[1/0,1/0,-1/0,-1/0];for(const a of l)for(const p of a)as(r,p);return r}function vh(l){return l[0]!==-1/0&&l[1]!==-1/0&&l[2]!==1/0&&l[3]!==1/0}function xu(l,r,a){if(!vh(l)||!vh(r))return NaN;let p=0,v=0;return l[2]<r[0]&&(p=r[0]-l[2]),l[0]>r[2]&&(p=l[0]-r[2]),l[1]>r[3]&&(v=l[1]-r[3]),l[3]<r[1]&&(v=r[1]-l[3]),a.distance([0,0],[p,v])}function Xs(l,r,a){const p=a.pointOnLine(r,l);return a.distance(l,p.point)}function Co(l,r,a,p,v){const T=Math.min(Xs(l,[a,p],v),Xs(r,[a,p],v)),E=Math.min(Xs(a,[l,r],v),Xs(p,[l,r],v));return Math.min(T,E)}function _i(l,r,a,p,v){if(!io(r,l.length)||!io(p,a.length))return 1/0;let T=1/0;for(let E=r[0];E<r[1];++E){const C=l[E],D=l[E+1];for(let N=p[0];N<p[1];++N){const U=a[N],H=a[N+1];if($l(C,D,U,H))return 0;T=Math.min(T,Co(C,D,U,H,v))}}return T}function Ka(l,r,a,p,v){if(!io(r,l.length)||!io(p,a.length))return NaN;let T=1/0;for(let E=r[0];E<=r[1];++E)for(let C=p[0];C<=p[1];++C)if(T=Math.min(T,v.distance(l[E],a[C])),T===0)return T;return T}function qd(l,r,a){if(ls(l,r,!0))return 0;let p=1/0;for(const v of r){const T=v[0],E=v[v.length-1];if(T!==E&&(p=Math.min(p,Xs(l,[E,T],a)),p===0))return p;const C=a.pointOnLine(v,l);if(p=Math.min(p,a.distance(l,C.point)),p===0)return p}return p}function Ea(l,r,a,p){if(!io(r,l.length))return NaN;for(let T=r[0];T<=r[1];++T)if(ls(l[T],a,!0))return 0;let v=1/0;for(let T=r[0];T<r[1];++T){const E=l[T],C=l[T+1];for(const D of a)for(let N=0,U=D.length,H=U-1;N<U;H=N++){const X=D[H],ee=D[N];if($l(E,C,X,ee))return 0;v=Math.min(v,Co(E,C,X,ee,p))}}return v}function Zl(l,r){for(const a of l)for(const p of a)if(ls(p,r,!0))return!0;return!1}function Ac(l,r,a,p=1/0){const v=Gl(l),T=Gl(r);if(p!==1/0&&xu(v,T,a)>=p)return p;if(_l(v,T)){if(Zl(l,r))return 0}else if(Zl(r,l))return 0;let E=1/0;for(const C of l)for(let D=0,N=C.length,U=N-1;D<N;U=D++){const H=C[U],X=C[D];for(const ee of r)for(let ie=0,ae=ee.length,_e=ae-1;ie<ae;_e=ie++){const Ee=ee[_e],je=ee[ie];if($l(H,X,Ee,je))return 0;E=Math.min(E,Co(H,X,Ee,je,a))}}return E}function Hu(l,r,a,p,v,T){if(!T)return;const E=xu(Sa(p,T),v,a);E<r&&l.push([E,T,[0,0]])}function vl(l,r,a,p,v,T,E){if(!T||!E)return;const C=xu(Sa(p,T),Sa(v,E),a);C<r&&l.push([C,T,E])}function Wl(l,r,a,p,v=1/0){let T=Math.min(p.distance(l[0],a[0][0]),v);if(T===0)return T;const E=new Zt([[0,[0,l.length-1],[0,0]]],yl),C=Gl(a);for(;E.length>0;){const D=E.pop();if(D[0]>=T)continue;const N=D[1],U=r?50:100;if(ql(N)<=U){if(!io(N,l.length))return NaN;if(r){const H=Ea(l,N,a,p);if(isNaN(H)||H===0)return H;T=Math.min(T,H)}else for(let H=N[0];H<=N[1];++H){const X=qd(l[H],a,p);if(T=Math.min(T,X),T===0)return 0}}else{const H=yh(N,r);Hu(E,T,p,l,C,H[0]),Hu(E,T,p,l,C,H[1])}}return T}function Kl(l,r,a,p,v,T=1/0){let E=Math.min(T,v.distance(l[0],a[0]));if(E===0)return E;const C=new Zt([[0,[0,l.length-1],[0,a.length-1]]],yl);for(;C.length>0;){const D=C.pop();if(D[0]>=E)continue;const N=D[1],U=D[2],H=r?50:100,X=p?50:100;if(ql(N)<=H&&ql(U)<=X){if(!io(N,l.length)&&io(U,a.length))return NaN;let ee;if(r&&p)ee=_i(l,N,a,U,v),E=Math.min(E,ee);else if(r&&!p){const ie=l.slice(N[0],N[1]+1);for(let ae=U[0];ae<=U[1];++ae)if(ee=Xs(a[ae],ie,v),E=Math.min(E,ee),E===0)return E}else if(!r&&p){const ie=a.slice(U[0],U[1]+1);for(let ae=N[0];ae<=N[1];++ae)if(ee=Xs(l[ae],ie,v),E=Math.min(E,ee),E===0)return E}else ee=Ka(l,N,a,U,v),E=Math.min(E,ee)}else{const ee=yh(N,r),ie=yh(U,p);vl(C,E,v,l,a,ee[0],ie[0]),vl(C,E,v,l,a,ee[0],ie[1]),vl(C,E,v,l,a,ee[1],ie[0]),vl(C,E,v,l,a,ee[1],ie[1])}}return E}function xl(l){return l.type==="MultiPolygon"?l.coordinates.map(r=>({type:"Polygon",coordinates:r})):l.type==="MultiLineString"?l.coordinates.map(r=>({type:"LineString",coordinates:r})):l.type==="MultiPoint"?l.coordinates.map(r=>({type:"Point",coordinates:r})):[l]}class Ia{constructor(r,a){this.type=mt,this.geojson=r,this.geometries=a}static parse(r,a){if(r.length!==2)return a.error(`'distance' expression requires exactly one argument, but found ${r.length-1} instead.`);if(Zr(r[1])){const p=r[1];if(p.type==="FeatureCollection")return new Ia(p,p.features.map(v=>xl(v.geometry)).flat());if(p.type==="Feature")return new Ia(p,xl(p.geometry));if("type"in p&&"coordinates"in p)return new Ia(p,xl(p))}return a.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(r){if(r.geometry()!=null&&r.canonicalID()!=null){if(r.geometryType()==="Point")return function(a,p){const v=a.geometry(),T=v.flat().map(D=>jl([D.x,D.y],a.canonical));if(v.length===0)return NaN;const E=new Cc(T[0][1]);let C=1/0;for(const D of p){switch(D.type){case"Point":C=Math.min(C,Kl(T,!1,[D.coordinates],!1,E,C));break;case"LineString":C=Math.min(C,Kl(T,!1,D.coordinates,!0,E,C));break;case"Polygon":C=Math.min(C,Wl(T,!1,D.coordinates,E,C))}if(C===0)return C}return C}(r,this.geometries);if(r.geometryType()==="LineString")return function(a,p){const v=a.geometry(),T=v.flat().map(D=>jl([D.x,D.y],a.canonical));if(v.length===0)return NaN;const E=new Cc(T[0][1]);let C=1/0;for(const D of p){switch(D.type){case"Point":C=Math.min(C,Kl(T,!0,[D.coordinates],!1,E,C));break;case"LineString":C=Math.min(C,Kl(T,!0,D.coordinates,!0,E,C));break;case"Polygon":C=Math.min(C,Wl(T,!0,D.coordinates,E,C))}if(C===0)return C}return C}(r,this.geometries);if(r.geometryType()==="Polygon")return function(a,p){const v=a.geometry();if(v.length===0||v[0].length===0)return NaN;const T=wi(v,0).map(D=>D.map(N=>N.map(U=>jl([U.x,U.y],a.canonical)))),E=new Cc(T[0][0][0][1]);let C=1/0;for(const D of p)for(const N of T){switch(D.type){case"Point":C=Math.min(C,Wl([D.coordinates],!1,N,E,C));break;case"LineString":C=Math.min(C,Wl(D.coordinates,!0,N,E,C));break;case"Polygon":C=Math.min(C,Ac(N,D.coordinates,E,C))}if(C===0)return C}return C}(r,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const wl={"==":Cs,"!=":vu,">":$u,"<":So,">=":As,"<=":Eo,array:hn,at:os,boolean:hn,case:Vo,coalesce:Ps,collator:Io,format:Ws,image:Ks,in:Hn,"index-of":gi,interpolate:qn,"interpolate-hcl":qn,"interpolate-lab":qn,length:gl,let:Wn,literal:wr,match:Xi,number:hn,"number-format":tr,object:hn,slice:ss,step:Ta,string:hn,"to-boolean":si,"to-color":si,"to-number":si,"to-string":si,var:xn,within:ft,distance:Ia};class us{constructor(r,a,p,v){this.name=r,this.type=a,this._evaluate=p,this.args=v}evaluate(r){return this._evaluate(r,this.args)}eachChild(r){this.args.forEach(r)}outputDefined(){return!1}static parse(r,a){const p=r[0],v=us.definitions[p];if(!v)return a.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0);const T=Array.isArray(v)?v[0]:v.type,E=Array.isArray(v)?[[v[1],v[2]]]:v.overloads,C=E.filter(([N])=>!Array.isArray(N)||N.length===r.length-1);let D=null;for(const[N,U]of C){D=new ba(a.registry,qu,a.path,null,a.scope);const H=[];let X=!1;for(let ee=1;ee<r.length;ee++){const ie=r[ee],ae=Array.isArray(N)?N[ee-1]:N.type,_e=D.parse(ie,1+H.length,ae);if(!_e){X=!0;break}H.push(_e)}if(!X)if(Array.isArray(N)&&N.length!==H.length)D.error(`Expected ${N.length} arguments, but found ${H.length} instead.`);else{for(let ee=0;ee<H.length;ee++){const ie=Array.isArray(N)?N[ee]:N.type,ae=H[ee];D.concat(ee+1).checkSubtype(ie,ae.type)}if(D.errors.length===0)return new us(p,T,U,H)}}if(C.length===1)a.errors.push(...D.errors);else{const N=(C.length?C:E).map(([H])=>{return X=H,Array.isArray(X)?`(${X.map(Li).join(", ")})`:`(${Li(X.type)}...)`;var X}).join(" | "),U=[];for(let H=1;H<r.length;H++){const X=a.parse(r[H],1+U.length);if(!X)return null;U.push(Li(X.type))}a.error(`Expected arguments of type ${N}, but found (${U.join(", ")}) instead.`)}return null}static register(r,a){us.definitions=a;for(const p in a)r[p]=us}}function Ls(l,[r,a,p,v]){r=r.evaluate(l),a=a.evaluate(l),p=p.evaluate(l);const T=v?v.evaluate(l):1,E=Ha(r,a,p,T);if(E)throw new zi(E);return new kn(r/255,a/255,p/255,T,!1)}function Xa(l,r){return l in r}function kc(l,r){const a=r[l];return a===void 0?null:a}function Ya(l){return{type:l}}function qu(l){if(l instanceof xn)return qu(l.boundExpression);if(l instanceof us&&l.name==="error"||l instanceof Io||l instanceof ft||l instanceof Ia)return!1;const r=l instanceof si||l instanceof hn;let a=!0;return l.eachChild(p=>{a=r?a&&qu(p):a&&p instanceof wr}),!!a&&wu(l)&&cs(l,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function wu(l){if(l instanceof us&&(l.name==="get"&&l.args.length===1||l.name==="feature-state"||l.name==="has"&&l.args.length===1||l.name==="properties"||l.name==="geometry-type"||l.name==="id"||/^filter-/.test(l.name))||l instanceof ft||l instanceof Ia)return!1;let r=!0;return l.eachChild(a=>{r&&!wu(a)&&(r=!1)}),r}function Xl(l){if(l instanceof us&&l.name==="feature-state")return!1;let r=!0;return l.eachChild(a=>{r&&!Xl(a)&&(r=!1)}),r}function cs(l,r){if(l instanceof us&&r.indexOf(l.name)>=0)return!1;let a=!0;return l.eachChild(p=>{a&&!cs(p,r)&&(a=!1)}),a}function Gu(l){return{result:"success",value:l}}function Ys(l){return{result:"error",value:l}}function Qs(l){return l["property-type"]==="data-driven"||l["property-type"]==="cross-faded-data-driven"}function bu(l){return!!l.expression&&l.expression.parameters.indexOf("zoom")>-1}function Tu(l){return!!l.expression&&l.expression.interpolated}function li(l){return l instanceof Number?"number":l instanceof String?"string":l instanceof Boolean?"boolean":Array.isArray(l)?"array":l===null?"null":typeof l}function Js(l){return typeof l=="object"&&l!==null&&!Array.isArray(l)}function Su(l){return l}function Qa(l,r){const a=r.type==="color",p=l.stops&&typeof l.stops[0][0]=="object",v=p||!(p||l.property!==void 0),T=l.type||(Tu(r)?"exponential":"interval");if(a||r.type==="padding"){const U=a?kn.parse:Ei.parse;(l=zt({},l)).stops&&(l.stops=l.stops.map(H=>[H[0],U(H[1])])),l.default=U(l.default?l.default:r.default)}if(l.colorSpace&&(E=l.colorSpace)!=="rgb"&&E!=="hcl"&&E!=="lab")throw new Error(`Unknown color space: "${l.colorSpace}"`);var E;let C,D,N;if(T==="exponential")C=ea;else if(T==="interval")C=rd;else if(T==="categorical"){C=Ql,D=Object.create(null);for(const U of l.stops)D[U[0]]=U[1];N=typeof l.stops[0][0]}else{if(T!=="identity")throw new Error(`Unknown function type "${T}"`);C=xh}if(p){const U={},H=[];for(let ie=0;ie<l.stops.length;ie++){const ae=l.stops[ie],_e=ae[0].zoom;U[_e]===void 0&&(U[_e]={zoom:_e,type:l.type,property:l.property,default:l.default,stops:[]},H.push(_e)),U[_e].stops.push([ae[0].value,ae[1]])}const X=[];for(const ie of H)X.push([U[ie].zoom,Qa(U[ie],r)]);const ee={name:"linear"};return{kind:"composite",interpolationType:ee,interpolationFactor:qn.interpolationFactor.bind(void 0,ee),zoomStops:X.map(ie=>ie[0]),evaluate:({zoom:ie},ae)=>ea({stops:X,base:l.base},r,ie).evaluate(ie,ae)}}if(v){const U=T==="exponential"?{name:"exponential",base:l.base!==void 0?l.base:1}:null;return{kind:"camera",interpolationType:U,interpolationFactor:qn.interpolationFactor.bind(void 0,U),zoomStops:l.stops.map(H=>H[0]),evaluate:({zoom:H})=>C(l,r,H,D,N)}}return{kind:"source",evaluate(U,H){const X=H&&H.properties?H.properties[l.property]:void 0;return X===void 0?Yl(l.default,r.default):C(l,r,X,D,N)}}}function Yl(l,r,a){return l!==void 0?l:r!==void 0?r:a!==void 0?a:void 0}function Ql(l,r,a,p,v){return Yl(typeof a===v?p[a]:void 0,l.default,r.default)}function rd(l,r,a){if(li(a)!=="number")return Yl(l.default,r.default);const p=l.stops.length;if(p===1||a<=l.stops[0][0])return l.stops[0][1];if(a>=l.stops[p-1][0])return l.stops[p-1][1];const v=ji(l.stops.map(T=>T[0]),a);return l.stops[v][1]}function ea(l,r,a){const p=l.base!==void 0?l.base:1;if(li(a)!=="number")return Yl(l.default,r.default);const v=l.stops.length;if(v===1||a<=l.stops[0][0])return l.stops[0][1];if(a>=l.stops[v-1][0])return l.stops[v-1][1];const T=ji(l.stops.map(U=>U[0]),a),E=function(U,H,X,ee){const ie=ee-X,ae=U-X;return ie===0?0:H===1?ae/ie:(Math.pow(H,ae)-1)/(Math.pow(H,ie)-1)}(a,p,l.stops[T][0],l.stops[T+1][0]),C=l.stops[T][1],D=l.stops[T+1][1],N=mo[r.type]||Su;return typeof C.evaluate=="function"?{evaluate(...U){const H=C.evaluate.apply(void 0,U),X=D.evaluate.apply(void 0,U);if(H!==void 0&&X!==void 0)return N(H,X,E,l.colorSpace)}}:N(C,D,E,l.colorSpace)}function xh(l,r,a){switch(r.type){case"color":a=kn.parse(a);break;case"formatted":a=_n.fromString(a.toString());break;case"resolvedImage":a=Ir.fromString(a.toString());break;case"padding":a=Ei.parse(a);break;default:li(a)===r.type||r.type==="enum"&&r.values[a]||(a=void 0)}return Yl(a,l.default,r.default)}us.register(wl,{error:[{kind:"error"},[Vt],(l,[r])=>{throw new zi(r.evaluate(l))}],typeof:[Vt,[Yt],(l,[r])=>Li(Bn(r.evaluate(l)))],"to-rgba":[co(mt,4),[Lt],(l,[r])=>{const[a,p,v,T]=r.evaluate(l).rgb;return[255*a,255*p,255*v,T]}],rgb:[Lt,[mt,mt,mt],Ls],rgba:[Lt,[mt,mt,mt,mt],Ls],has:{type:$t,overloads:[[[Vt],(l,[r])=>Xa(r.evaluate(l),l.properties())],[[Vt,mn],(l,[r,a])=>Xa(r.evaluate(l),a.evaluate(l))]]},get:{type:Yt,overloads:[[[Vt],(l,[r])=>kc(r.evaluate(l),l.properties())],[[Vt,mn],(l,[r,a])=>kc(r.evaluate(l),a.evaluate(l))]]},"feature-state":[Yt,[Vt],(l,[r])=>kc(r.evaluate(l),l.featureState||{})],properties:[mn,[],l=>l.properties()],"geometry-type":[Vt,[],l=>l.geometryType()],id:[Yt,[],l=>l.id()],zoom:[mt,[],l=>l.globals.zoom],"heatmap-density":[mt,[],l=>l.globals.heatmapDensity||0],"line-progress":[mt,[],l=>l.globals.lineProgress||0],accumulated:[Yt,[],l=>l.globals.accumulated===void 0?null:l.globals.accumulated],"+":[mt,Ya(mt),(l,r)=>{let a=0;for(const p of r)a+=p.evaluate(l);return a}],"*":[mt,Ya(mt),(l,r)=>{let a=1;for(const p of r)a*=p.evaluate(l);return a}],"-":{type:mt,overloads:[[[mt,mt],(l,[r,a])=>r.evaluate(l)-a.evaluate(l)],[[mt],(l,[r])=>-r.evaluate(l)]]},"/":[mt,[mt,mt],(l,[r,a])=>r.evaluate(l)/a.evaluate(l)],"%":[mt,[mt,mt],(l,[r,a])=>r.evaluate(l)%a.evaluate(l)],ln2:[mt,[],()=>Math.LN2],pi:[mt,[],()=>Math.PI],e:[mt,[],()=>Math.E],"^":[mt,[mt,mt],(l,[r,a])=>Math.pow(r.evaluate(l),a.evaluate(l))],sqrt:[mt,[mt],(l,[r])=>Math.sqrt(r.evaluate(l))],log10:[mt,[mt],(l,[r])=>Math.log(r.evaluate(l))/Math.LN10],ln:[mt,[mt],(l,[r])=>Math.log(r.evaluate(l))],log2:[mt,[mt],(l,[r])=>Math.log(r.evaluate(l))/Math.LN2],sin:[mt,[mt],(l,[r])=>Math.sin(r.evaluate(l))],cos:[mt,[mt],(l,[r])=>Math.cos(r.evaluate(l))],tan:[mt,[mt],(l,[r])=>Math.tan(r.evaluate(l))],asin:[mt,[mt],(l,[r])=>Math.asin(r.evaluate(l))],acos:[mt,[mt],(l,[r])=>Math.acos(r.evaluate(l))],atan:[mt,[mt],(l,[r])=>Math.atan(r.evaluate(l))],min:[mt,Ya(mt),(l,r)=>Math.min(...r.map(a=>a.evaluate(l)))],max:[mt,Ya(mt),(l,r)=>Math.max(...r.map(a=>a.evaluate(l)))],abs:[mt,[mt],(l,[r])=>Math.abs(r.evaluate(l))],round:[mt,[mt],(l,[r])=>{const a=r.evaluate(l);return a<0?-Math.round(-a):Math.round(a)}],floor:[mt,[mt],(l,[r])=>Math.floor(r.evaluate(l))],ceil:[mt,[mt],(l,[r])=>Math.ceil(r.evaluate(l))],"filter-==":[$t,[Vt,Yt],(l,[r,a])=>l.properties()[r.value]===a.value],"filter-id-==":[$t,[Yt],(l,[r])=>l.id()===r.value],"filter-type-==":[$t,[Vt],(l,[r])=>l.geometryType()===r.value],"filter-<":[$t,[Vt,Yt],(l,[r,a])=>{const p=l.properties()[r.value],v=a.value;return typeof p==typeof v&&p<v}],"filter-id-<":[$t,[Yt],(l,[r])=>{const a=l.id(),p=r.value;return typeof a==typeof p&&a<p}],"filter->":[$t,[Vt,Yt],(l,[r,a])=>{const p=l.properties()[r.value],v=a.value;return typeof p==typeof v&&p>v}],"filter-id->":[$t,[Yt],(l,[r])=>{const a=l.id(),p=r.value;return typeof a==typeof p&&a>p}],"filter-<=":[$t,[Vt,Yt],(l,[r,a])=>{const p=l.properties()[r.value],v=a.value;return typeof p==typeof v&&p<=v}],"filter-id-<=":[$t,[Yt],(l,[r])=>{const a=l.id(),p=r.value;return typeof a==typeof p&&a<=p}],"filter->=":[$t,[Vt,Yt],(l,[r,a])=>{const p=l.properties()[r.value],v=a.value;return typeof p==typeof v&&p>=v}],"filter-id->=":[$t,[Yt],(l,[r])=>{const a=l.id(),p=r.value;return typeof a==typeof p&&a>=p}],"filter-has":[$t,[Yt],(l,[r])=>r.value in l.properties()],"filter-has-id":[$t,[],l=>l.id()!==null&&l.id()!==void 0],"filter-type-in":[$t,[co(Vt)],(l,[r])=>r.value.indexOf(l.geometryType())>=0],"filter-id-in":[$t,[co(Yt)],(l,[r])=>r.value.indexOf(l.id())>=0],"filter-in-small":[$t,[Vt,co(Yt)],(l,[r,a])=>a.value.indexOf(l.properties()[r.value])>=0],"filter-in-large":[$t,[Vt,co(Yt)],(l,[r,a])=>function(p,v,T,E){for(;T<=E;){const C=T+E>>1;if(v[C]===p)return!0;v[C]>p?E=C-1:T=C+1}return!1}(l.properties()[r.value],a.value,0,a.value.length-1)],all:{type:$t,overloads:[[[$t,$t],(l,[r,a])=>r.evaluate(l)&&a.evaluate(l)],[Ya($t),(l,r)=>{for(const a of r)if(!a.evaluate(l))return!1;return!0}]]},any:{type:$t,overloads:[[[$t,$t],(l,[r,a])=>r.evaluate(l)||a.evaluate(l)],[Ya($t),(l,r)=>{for(const a of r)if(a.evaluate(l))return!0;return!1}]]},"!":[$t,[$t],(l,[r])=>!r.evaluate(l)],"is-supported-script":[$t,[Vt],(l,[r])=>{const a=l.globals&&l.globals.isSupportedScript;return!a||a(r.evaluate(l))}],upcase:[Vt,[Vt],(l,[r])=>r.evaluate(l).toUpperCase()],downcase:[Vt,[Vt],(l,[r])=>r.evaluate(l).toLowerCase()],concat:[Vt,Ya(Yt),(l,r)=>r.map(a=>po(a.evaluate(l))).join("")],"resolved-locale":[Vt,[Ri],(l,[r])=>r.evaluate(l).resolvedLocale()]});class Eu{constructor(r,a){var p;this.expression=r,this._warningHistory={},this._evaluator=new Kn,this._defaultValue=a?(p=a).type==="color"&&Js(p.default)?new kn(0,0,0,0):p.type==="color"?kn.parse(p.default)||null:p.type==="padding"?Ei.parse(p.default)||null:p.type==="variableAnchorOffsetCollection"?Er.parse(p.default)||null:p.type==="projectionDefinition"?xr.parse(p.default)||null:p.default===void 0?null:p.default:null,this._enumValues=a&&a.type==="enum"?a.values:null}evaluateWithoutErrorHandling(r,a,p,v,T,E){return this._evaluator.globals=r,this._evaluator.feature=a,this._evaluator.featureState=p,this._evaluator.canonical=v,this._evaluator.availableImages=T||null,this._evaluator.formattedSection=E,this.expression.evaluate(this._evaluator)}evaluate(r,a,p,v,T,E){this._evaluator.globals=r,this._evaluator.feature=a||null,this._evaluator.featureState=p||null,this._evaluator.canonical=v,this._evaluator.availableImages=T||null,this._evaluator.formattedSection=E||null;try{const C=this.expression.evaluate(this._evaluator);if(C==null||typeof C=="number"&&C!=C)return this._defaultValue;if(this._enumValues&&!(C in this._enumValues))throw new zi(`Expected value to be one of ${Object.keys(this._enumValues).map(D=>JSON.stringify(D)).join(", ")}, but found ${JSON.stringify(C)} instead.`);return C}catch(C){return this._warningHistory[C.message]||(this._warningHistory[C.message]=!0,typeof console<"u"&&console.warn(C.message)),this._defaultValue}}}function Ja(l){return Array.isArray(l)&&l.length>0&&typeof l[0]=="string"&&l[0]in wl}function Zu(l,r){const a=new ba(wl,qu,[],r?function(v){const T={color:Lt,string:Vt,number:mt,enum:Vt,boolean:$t,formatted:ts,padding:Si,projectionDefinition:Nn,resolvedImage:xi,variableAnchorOffsetCollection:oi};return v.type==="array"?co(T[v.value]||Yt,v.length):T[v.type]}(r):void 0),p=a.parse(l,void 0,void 0,void 0,r&&r.type==="string"?{typeAnnotation:"coerce"}:void 0);return p?Gu(new Eu(p,r)):Ys(a.errors)}class go{constructor(r,a){this.kind=r,this._styleExpression=a,this.isStateDependent=r!=="constant"&&!Xl(a.expression)}evaluateWithoutErrorHandling(r,a,p,v,T,E){return this._styleExpression.evaluateWithoutErrorHandling(r,a,p,v,T,E)}evaluate(r,a,p,v,T,E){return this._styleExpression.evaluate(r,a,p,v,T,E)}}class Pa{constructor(r,a,p,v){this.kind=r,this.zoomStops=p,this._styleExpression=a,this.isStateDependent=r!=="camera"&&!Xl(a.expression),this.interpolationType=v}evaluateWithoutErrorHandling(r,a,p,v,T,E){return this._styleExpression.evaluateWithoutErrorHandling(r,a,p,v,T,E)}evaluate(r,a,p,v,T,E){return this._styleExpression.evaluate(r,a,p,v,T,E)}interpolationFactor(r,a,p){return this.interpolationType?qn.interpolationFactor(this.interpolationType,r,a,p):0}}function Wu(l,r){const a=Zu(l,r);if(a.result==="error")return a;const p=a.value.expression,v=wu(p);if(!v&&!Qs(r))return Ys([new Nt("","data expressions not supported")]);const T=cs(p,["zoom"]);if(!T&&!bu(r))return Ys([new Nt("","zoom expressions not supported")]);const E=Mc(p);return E||T?E instanceof Nt?Ys([E]):E instanceof qn&&!Tu(r)?Ys([new Nt("",'"interpolate" expressions cannot be used with this property')]):Gu(E?new Pa(v?"camera":"composite",a.value,E.labels,E instanceof qn?E.interpolation:void 0):new go(v?"constant":"source",a.value)):Ys([new Nt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Ku{constructor(r,a){this._parameters=r,this._specification=a,zt(this,Qa(this._parameters,this._specification))}static deserialize(r){return new Ku(r._parameters,r._specification)}static serialize(r){return{_parameters:r._parameters,_specification:r._specification}}}function Mc(l){let r=null;if(l instanceof Wn)r=Mc(l.result);else if(l instanceof Ps){for(const a of l.args)if(r=Mc(a),r)break}else(l instanceof Ta||l instanceof qn)&&l.input instanceof us&&l.input.name==="zoom"&&(r=l);return r instanceof Nt||l.eachChild(a=>{const p=Mc(a);p instanceof Nt?r=p:!r&&p?r=new Nt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):r&&p&&r!==p&&(r=new Nt("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),r}function bl(l){if(l===!0||l===!1)return!0;if(!Array.isArray(l)||l.length===0)return!1;switch(l[0]){case"has":return l.length>=2&&l[1]!=="$id"&&l[1]!=="$type";case"in":return l.length>=3&&(typeof l[1]!="string"||Array.isArray(l[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return l.length!==3||Array.isArray(l[1])||Array.isArray(l[2]);case"any":case"all":for(const r of l.slice(1))if(!bl(r)&&typeof r!="boolean")return!1;return!0;default:return!0}}const od={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Iu(l){if(l==null)return{filter:()=>!0,needGeometry:!1};bl(l)||(l=Pu(l));const r=Zu(l,od);if(r.result==="error")throw new Error(r.value.map(a=>`${a.key}: ${a.message}`).join(", "));return{filter:(a,p,v)=>r.value.evaluate(a,p,{},v),needGeometry:Yi(l)}}function Rc(l,r){return l<r?-1:l>r?1:0}function Yi(l){if(!Array.isArray(l))return!1;if(l[0]==="within"||l[0]==="distance")return!0;for(let r=1;r<l.length;r++)if(Yi(l[r]))return!0;return!1}function Pu(l){if(!l)return!0;const r=l[0];return l.length<=1?r!=="any":r==="=="?Tl(l[1],l[2],"=="):r==="!="?d(Tl(l[1],l[2],"==")):r==="<"||r===">"||r==="<="||r===">="?Tl(l[1],l[2],r):r==="any"?(a=l.slice(1),["any"].concat(a.map(Pu))):r==="all"?["all"].concat(l.slice(1).map(Pu)):r==="none"?["all"].concat(l.slice(1).map(Pu).map(d)):r==="in"?Sl(l[1],l.slice(2)):r==="!in"?d(Sl(l[1],l.slice(2))):r==="has"?Lc(l[1]):r!=="!has"||d(Lc(l[1]));var a}function Tl(l,r,a){switch(l){case"$type":return[`filter-type-${a}`,r];case"$id":return[`filter-id-${a}`,r];default:return[`filter-${a}`,l,r]}}function Sl(l,r){if(r.length===0)return!1;switch(l){case"$type":return["filter-type-in",["literal",r]];case"$id":return["filter-id-in",["literal",r]];default:return r.length>200&&!r.some(a=>typeof a!=typeof r[0])?["filter-in-large",l,["literal",r.sort(Rc)]]:["filter-in-small",l,["literal",r]]}}function Lc(l){switch(l){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",l]}}function d(l){return["!",l]}function x(l){const r=typeof l;if(r==="number"||r==="boolean"||r==="string"||l==null)return JSON.stringify(l);if(Array.isArray(l)){let v="[";for(const T of l)v+=`${x(T)},`;return`${v}]`}const a=Object.keys(l).sort();let p="{";for(let v=0;v<a.length;v++)p+=`${JSON.stringify(a[v])}:${x(l[a[v]])},`;return`${p}}`}function A(l){let r="";for(const a of se)r+=`/${x(l[a])}`;return r}function F(l){const r=l.value;return r?[new Ue(l.key,r,"constants have been deprecated as of v8")]:[]}function Z(l){return l instanceof Number||l instanceof String||l instanceof Boolean?l.valueOf():l}function he(l){if(Array.isArray(l))return l.map(he);if(l instanceof Object&&!(l instanceof Number||l instanceof String||l instanceof Boolean)){const r={};for(const a in l)r[a]=he(l[a]);return r}return Z(l)}function Oe(l){const r=l.key,a=l.value,p=l.valueSpec||{},v=l.objectElementValidators||{},T=l.style,E=l.styleSpec,C=l.validateSpec;let D=[];const N=li(a);if(N!=="object")return[new Ue(r,a,`object expected, ${N} found`)];for(const U in a){const H=U.split(".")[0],X=p[H]||p["*"];let ee;if(v[H])ee=v[H];else if(p[H])ee=C;else if(v["*"])ee=v["*"];else{if(!p["*"]){D.push(new Ue(r,a[U],`unknown property "${U}"`));continue}ee=C}D=D.concat(ee({key:(r&&`${r}.`)+U,value:a[U],valueSpec:X,style:T,styleSpec:E,object:a,objectKey:U,validateSpec:C},a))}for(const U in p)v[U]||p[U].required&&p[U].default===void 0&&a[U]===void 0&&D.push(new Ue(r,a,`missing required property "${U}"`));return D}function rt(l){const r=l.value,a=l.valueSpec,p=l.style,v=l.styleSpec,T=l.key,E=l.arrayElementValidator||l.validateSpec;if(li(r)!=="array")return[new Ue(T,r,`array expected, ${li(r)} found`)];if(a.length&&r.length!==a.length)return[new Ue(T,r,`array length ${a.length} expected, length ${r.length} found`)];if(a["min-length"]&&r.length<a["min-length"])return[new Ue(T,r,`array length at least ${a["min-length"]} expected, length ${r.length} found`)];let C={type:a.value,values:a.values};v.$version<7&&(C.function=a.function),li(a.value)==="object"&&(C=a.value);let D=[];for(let N=0;N<r.length;N++)D=D.concat(E({array:r,arrayIndex:N,value:r[N],valueSpec:C,validateSpec:l.validateSpec,style:p,styleSpec:v,key:`${T}[${N}]`}));return D}function dt(l){const r=l.key,a=l.value,p=l.valueSpec;let v=li(a);return v==="number"&&a!=a&&(v="NaN"),v!=="number"?[new Ue(r,a,`number expected, ${v} found`)]:"minimum"in p&&a<p.minimum?[new Ue(r,a,`${a} is less than the minimum value ${p.minimum}`)]:"maximum"in p&&a>p.maximum?[new Ue(r,a,`${a} is greater than the maximum value ${p.maximum}`)]:[]}function kt(l){const r=l.valueSpec,a=Z(l.value.type);let p,v,T,E={};const C=a!=="categorical"&&l.value.property===void 0,D=!C,N=li(l.value.stops)==="array"&&li(l.value.stops[0])==="array"&&li(l.value.stops[0][0])==="object",U=Oe({key:l.key,value:l.value,valueSpec:l.styleSpec.function,validateSpec:l.validateSpec,style:l.style,styleSpec:l.styleSpec,objectElementValidators:{stops:function(ee){if(a==="identity")return[new Ue(ee.key,ee.value,'identity function may not have a "stops" property')];let ie=[];const ae=ee.value;return ie=ie.concat(rt({key:ee.key,value:ae,valueSpec:ee.valueSpec,validateSpec:ee.validateSpec,style:ee.style,styleSpec:ee.styleSpec,arrayElementValidator:H})),li(ae)==="array"&&ae.length===0&&ie.push(new Ue(ee.key,ae,"array must have at least one stop")),ie},default:function(ee){return ee.validateSpec({key:ee.key,value:ee.value,valueSpec:r,validateSpec:ee.validateSpec,style:ee.style,styleSpec:ee.styleSpec})}}});return a==="identity"&&C&&U.push(new Ue(l.key,l.value,'missing required property "property"')),a==="identity"||l.value.stops||U.push(new Ue(l.key,l.value,'missing required property "stops"')),a==="exponential"&&l.valueSpec.expression&&!Tu(l.valueSpec)&&U.push(new Ue(l.key,l.value,"exponential functions not supported")),l.styleSpec.$version>=8&&(D&&!Qs(l.valueSpec)?U.push(new Ue(l.key,l.value,"property functions not supported")):C&&!bu(l.valueSpec)&&U.push(new Ue(l.key,l.value,"zoom functions not supported"))),a!=="categorical"&&!N||l.value.property!==void 0||U.push(new Ue(l.key,l.value,'"property" property is required')),U;function H(ee){let ie=[];const ae=ee.value,_e=ee.key;if(li(ae)!=="array")return[new Ue(_e,ae,`array expected, ${li(ae)} found`)];if(ae.length!==2)return[new Ue(_e,ae,`array length 2 expected, length ${ae.length} found`)];if(N){if(li(ae[0])!=="object")return[new Ue(_e,ae,`object expected, ${li(ae[0])} found`)];if(ae[0].zoom===void 0)return[new Ue(_e,ae,"object stop key must have zoom")];if(ae[0].value===void 0)return[new Ue(_e,ae,"object stop key must have value")];if(T&&T>Z(ae[0].zoom))return[new Ue(_e,ae[0].zoom,"stop zoom values must appear in ascending order")];Z(ae[0].zoom)!==T&&(T=Z(ae[0].zoom),v=void 0,E={}),ie=ie.concat(Oe({key:`${_e}[0]`,value:ae[0],valueSpec:{zoom:{}},validateSpec:ee.validateSpec,style:ee.style,styleSpec:ee.styleSpec,objectElementValidators:{zoom:dt,value:X}}))}else ie=ie.concat(X({key:`${_e}[0]`,value:ae[0],validateSpec:ee.validateSpec,style:ee.style,styleSpec:ee.styleSpec},ae));return Ja(he(ae[1]))?ie.concat([new Ue(`${_e}[1]`,ae[1],"expressions are not allowed in function stops.")]):ie.concat(ee.validateSpec({key:`${_e}[1]`,value:ae[1],valueSpec:r,validateSpec:ee.validateSpec,style:ee.style,styleSpec:ee.styleSpec}))}function X(ee,ie){const ae=li(ee.value),_e=Z(ee.value),Ee=ee.value!==null?ee.value:ie;if(p){if(ae!==p)return[new Ue(ee.key,Ee,`${ae} stop domain type must match previous stop domain type ${p}`)]}else p=ae;if(ae!=="number"&&ae!=="string"&&ae!=="boolean")return[new Ue(ee.key,Ee,"stop domain value must be a number, string, or boolean")];if(ae!=="number"&&a!=="categorical"){let je=`number expected, ${ae} found`;return Qs(r)&&a===void 0&&(je+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ue(ee.key,Ee,je)]}return a!=="categorical"||ae!=="number"||isFinite(_e)&&Math.floor(_e)===_e?a!=="categorical"&&ae==="number"&&v!==void 0&&_e<v?[new Ue(ee.key,Ee,"stop domain values must appear in ascending order")]:(v=_e,a==="categorical"&&_e in E?[new Ue(ee.key,Ee,"stop domain values must be unique")]:(E[_e]=!0,[])):[new Ue(ee.key,Ee,`integer expected, found ${_e}`)]}}function tn(l){const r=(l.expressionContext==="property"?Wu:Zu)(he(l.value),l.valueSpec);if(r.result==="error")return r.value.map(p=>new Ue(`${l.key}${p.key}`,l.value,p.message));const a=r.value.expression||r.value._styleExpression.expression;if(l.expressionContext==="property"&&l.propertyKey==="text-font"&&!a.outputDefined())return[new Ue(l.key,l.value,`Invalid data expression for "${l.propertyKey}". Output values must be contained as literals within the expression.`)];if(l.expressionContext==="property"&&l.propertyType==="layout"&&!Xl(a))return[new Ue(l.key,l.value,'"feature-state" data expressions are not supported with layout properties.')];if(l.expressionContext==="filter"&&!Xl(a))return[new Ue(l.key,l.value,'"feature-state" data expressions are not supported with filters.')];if(l.expressionContext&&l.expressionContext.indexOf("cluster")===0){if(!cs(a,["zoom","feature-state"]))return[new Ue(l.key,l.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(l.expressionContext==="cluster-initial"&&!wu(a))return[new Ue(l.key,l.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Sn(l){const r=l.key,a=l.value,p=l.valueSpec,v=[];return Array.isArray(p.values)?p.values.indexOf(Z(a))===-1&&v.push(new Ue(r,a,`expected one of [${p.values.join(", ")}], ${JSON.stringify(a)} found`)):Object.keys(p.values).indexOf(Z(a))===-1&&v.push(new Ue(r,a,`expected one of [${Object.keys(p.values).join(", ")}], ${JSON.stringify(a)} found`)),v}function Gn(l){return bl(he(l.value))?tn(zt({},l,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Cr(l)}function Cr(l){const r=l.value,a=l.key;if(li(r)!=="array")return[new Ue(a,r,`array expected, ${li(r)} found`)];const p=l.styleSpec;let v,T=[];if(r.length<1)return[new Ue(a,r,"filter array must have at least 1 element")];switch(T=T.concat(Sn({key:`${a}[0]`,value:r[0],valueSpec:p.filter_operator,style:l.style,styleSpec:l.styleSpec})),Z(r[0])){case"<":case"<=":case">":case">=":r.length>=2&&Z(r[1])==="$type"&&T.push(new Ue(a,r,`"$type" cannot be use with operator "${r[0]}"`));case"==":case"!=":r.length!==3&&T.push(new Ue(a,r,`filter array for operator "${r[0]}" must have 3 elements`));case"in":case"!in":r.length>=2&&(v=li(r[1]),v!=="string"&&T.push(new Ue(`${a}[1]`,r[1],`string expected, ${v} found`)));for(let E=2;E<r.length;E++)v=li(r[E]),Z(r[1])==="$type"?T=T.concat(Sn({key:`${a}[${E}]`,value:r[E],valueSpec:p.geometry_type,style:l.style,styleSpec:l.styleSpec})):v!=="string"&&v!=="number"&&v!=="boolean"&&T.push(new Ue(`${a}[${E}]`,r[E],`string, number, or boolean expected, ${v} found`));break;case"any":case"all":case"none":for(let E=1;E<r.length;E++)T=T.concat(Cr({key:`${a}[${E}]`,value:r[E],style:l.style,styleSpec:l.styleSpec}));break;case"has":case"!has":v=li(r[1]),r.length!==2?T.push(new Ue(a,r,`filter array for "${r[0]}" operator must have 2 elements`)):v!=="string"&&T.push(new Ue(`${a}[1]`,r[1],`string expected, ${v} found`))}return T}function Nr(l,r){const a=l.key,p=l.validateSpec,v=l.style,T=l.styleSpec,E=l.value,C=l.objectKey,D=T[`${r}_${l.layerType}`];if(!D)return[];const N=C.match(/^(.*)-transition$/);if(r==="paint"&&N&&D[N[1]]&&D[N[1]].transition)return p({key:a,value:E,valueSpec:T.transition,style:v,styleSpec:T});const U=l.valueSpec||D[C];if(!U)return[new Ue(a,E,`unknown property "${C}"`)];let H;if(li(E)==="string"&&Qs(U)&&!U.tokens&&(H=/^{([^}]+)}$/.exec(E)))return[new Ue(a,E,`"${C}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(H[1])} }\`.`)];const X=[];return l.layerType==="symbol"&&(C==="text-field"&&v&&!v.glyphs&&X.push(new Ue(a,E,'use of "text-field" requires a style "glyphs" property')),C==="text-font"&&Js(he(E))&&Z(E.type)==="identity"&&X.push(new Ue(a,E,'"text-font" does not support identity functions'))),X.concat(p({key:l.key,value:E,valueSpec:U,style:v,styleSpec:T,expressionContext:"property",propertyType:r,propertyKey:C}))}function Ao(l){return Nr(l,"paint")}function _o(l){return Nr(l,"layout")}function Jl(l){let r=[];const a=l.value,p=l.key,v=l.style,T=l.styleSpec;a.type||a.ref||r.push(new Ue(p,a,'either "type" or "ref" is required'));let E=Z(a.type);const C=Z(a.ref);if(a.id){const D=Z(a.id);for(let N=0;N<l.arrayIndex;N++){const U=v.layers[N];Z(U.id)===D&&r.push(new Ue(p,a.id,`duplicate layer id "${a.id}", previously used at line ${U.id.__line__}`))}}if("ref"in a){let D;["type","source","source-layer","filter","layout"].forEach(N=>{N in a&&r.push(new Ue(p,a[N],`"${N}" is prohibited for ref layers`))}),v.layers.forEach(N=>{Z(N.id)===C&&(D=N)}),D?D.ref?r.push(new Ue(p,a.ref,"ref cannot reference another ref layer")):E=Z(D.type):r.push(new Ue(p,a.ref,`ref layer "${C}" not found`))}else if(E!=="background")if(a.source){const D=v.sources&&v.sources[a.source],N=D&&Z(D.type);D?N==="vector"&&E==="raster"?r.push(new Ue(p,a.source,`layer "${a.id}" requires a raster source`)):N!=="raster-dem"&&E==="hillshade"?r.push(new Ue(p,a.source,`layer "${a.id}" requires a raster-dem source`)):N==="raster"&&E!=="raster"?r.push(new Ue(p,a.source,`layer "${a.id}" requires a vector source`)):N!=="vector"||a["source-layer"]?N==="raster-dem"&&E!=="hillshade"?r.push(new Ue(p,a.source,"raster-dem source can only be used with layer type 'hillshade'.")):E!=="line"||!a.paint||!a.paint["line-gradient"]||N==="geojson"&&D.lineMetrics||r.push(new Ue(p,a,`layer "${a.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):r.push(new Ue(p,a,`layer "${a.id}" must specify a "source-layer"`)):r.push(new Ue(p,a.source,`source "${a.source}" not found`))}else r.push(new Ue(p,a,'missing required property "source"'));return r=r.concat(Oe({key:p,value:a,valueSpec:T.layer,style:l.style,styleSpec:l.styleSpec,validateSpec:l.validateSpec,objectElementValidators:{"*":()=>[],type:()=>l.validateSpec({key:`${p}.type`,value:a.type,valueSpec:T.layer.type,style:l.style,styleSpec:l.styleSpec,validateSpec:l.validateSpec,object:a,objectKey:"type"}),filter:Gn,layout:D=>Oe({layer:a,key:D.key,value:D.value,style:D.style,styleSpec:D.styleSpec,validateSpec:D.validateSpec,objectElementValidators:{"*":N=>_o(zt({layerType:E},N))}}),paint:D=>Oe({layer:a,key:D.key,value:D.value,style:D.style,styleSpec:D.styleSpec,validateSpec:D.validateSpec,objectElementValidators:{"*":N=>Ao(zt({layerType:E},N))}})}})),r}function Ca(l){const r=l.value,a=l.key,p=li(r);return p!=="string"?[new Ue(a,r,`string expected, ${p} found`)]:[]}const Aa={promoteId:function({key:l,value:r}){if(li(r)==="string")return Ca({key:l,value:r});{const a=[];for(const p in r)a.push(...Ca({key:`${l}.${p}`,value:r[p]}));return a}}};function eu(l){const r=l.value,a=l.key,p=l.styleSpec,v=l.style,T=l.validateSpec;if(!r.type)return[new Ue(a,r,'"type" is required')];const E=Z(r.type);let C;switch(E){case"vector":case"raster":return C=Oe({key:a,value:r,valueSpec:p[`source_${E.replace("-","_")}`],style:l.style,styleSpec:p,objectElementValidators:Aa,validateSpec:T}),C;case"raster-dem":return C=function(D){var N;const U=(N=D.sourceName)!==null&&N!==void 0?N:"",H=D.value,X=D.styleSpec,ee=X.source_raster_dem,ie=D.style;let ae=[];const _e=li(H);if(H===void 0)return ae;if(_e!=="object")return ae.push(new Ue("source_raster_dem",H,`object expected, ${_e} found`)),ae;const Ee=Z(H.encoding)==="custom",je=["redFactor","greenFactor","blueFactor","baseShift"],ke=D.value.encoding?`"${D.value.encoding}"`:"Default";for(const J in H)!Ee&&je.includes(J)?ae.push(new Ue(J,H[J],`In "${U}": "${J}" is only valid when "encoding" is set to "custom". ${ke} encoding found`)):ee[J]?ae=ae.concat(D.validateSpec({key:J,value:H[J],valueSpec:ee[J],validateSpec:D.validateSpec,style:ie,styleSpec:X})):ae.push(new Ue(J,H[J],`unknown property "${J}"`));return ae}({sourceName:a,value:r,style:l.style,styleSpec:p,validateSpec:T}),C;case"geojson":if(C=Oe({key:a,value:r,valueSpec:p.source_geojson,style:v,styleSpec:p,validateSpec:T,objectElementValidators:Aa}),r.cluster)for(const D in r.clusterProperties){const[N,U]=r.clusterProperties[D],H=typeof N=="string"?[N,["accumulated"],["get",D]]:N;C.push(...tn({key:`${a}.${D}.map`,value:U,expressionContext:"cluster-map"})),C.push(...tn({key:`${a}.${D}.reduce`,value:H,expressionContext:"cluster-reduce"}))}return C;case"video":return Oe({key:a,value:r,valueSpec:p.source_video,style:v,validateSpec:T,styleSpec:p});case"image":return Oe({key:a,value:r,valueSpec:p.source_image,style:v,validateSpec:T,styleSpec:p});case"canvas":return[new Ue(a,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Sn({key:`${a}.type`,value:r.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function El(l){const r=l.value,a=l.styleSpec,p=a.light,v=l.style;let T=[];const E=li(r);if(r===void 0)return T;if(E!=="object")return T=T.concat([new Ue("light",r,`object expected, ${E} found`)]),T;for(const C in r){const D=C.match(/^(.*)-transition$/);T=T.concat(D&&p[D[1]]&&p[D[1]].transition?l.validateSpec({key:C,value:r[C],valueSpec:a.transition,validateSpec:l.validateSpec,style:v,styleSpec:a}):p[C]?l.validateSpec({key:C,value:r[C],valueSpec:p[C],validateSpec:l.validateSpec,style:v,styleSpec:a}):[new Ue(C,r[C],`unknown property "${C}"`)])}return T}function ta(l){const r=l.value,a=l.styleSpec,p=a.sky,v=l.style,T=li(r);if(r===void 0)return[];if(T!=="object")return[new Ue("sky",r,`object expected, ${T} found`)];let E=[];for(const C in r)E=E.concat(p[C]?l.validateSpec({key:C,value:r[C],valueSpec:p[C],style:v,styleSpec:a}):[new Ue(C,r[C],`unknown property "${C}"`)]);return E}function tu(l){const r=l.value,a=l.styleSpec,p=a.terrain,v=l.style;let T=[];const E=li(r);if(r===void 0)return T;if(E!=="object")return T=T.concat([new Ue("terrain",r,`object expected, ${E} found`)]),T;for(const C in r)T=T.concat(p[C]?l.validateSpec({key:C,value:r[C],valueSpec:p[C],validateSpec:l.validateSpec,style:v,styleSpec:a}):[new Ue(C,r[C],`unknown property "${C}"`)]);return T}function Ni(l){let r=[];const a=l.value,p=l.key;if(Array.isArray(a)){const v=[],T=[];for(const E in a)a[E].id&&v.includes(a[E].id)&&r.push(new Ue(p,a,`all the sprites' ids must be unique, but ${a[E].id} is duplicated`)),v.push(a[E].id),a[E].url&&T.includes(a[E].url)&&r.push(new Ue(p,a,`all the sprites' URLs must be unique, but ${a[E].url} is duplicated`)),T.push(a[E].url),r=r.concat(Oe({key:`${p}[${E}]`,value:a[E],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:l.validateSpec}));return r}return Ca({key:p,value:a})}const nu={"*":()=>[],array:rt,boolean:function(l){const r=l.value,a=l.key,p=li(r);return p!=="boolean"?[new Ue(a,r,`boolean expected, ${p} found`)]:[]},number:dt,color:function(l){const r=l.key,a=l.value,p=li(a);return p!=="string"?[new Ue(r,a,`color expected, ${p} found`)]:kn.parse(String(a))?[]:[new Ue(r,a,`color expected, "${a}" found`)]},constants:F,enum:Sn,filter:Gn,function:kt,layer:Jl,object:Oe,source:eu,light:El,sky:ta,terrain:tu,projection:function(l){const r=l.value,a=l.styleSpec,p=a.projection,v=l.style,T=li(r);if(r===void 0)return[];if(T!=="object")return[new Ue("projection",r,`object expected, ${T} found`)];let E=[];for(const C in r)E=E.concat(p[C]?l.validateSpec({key:C,value:r[C],valueSpec:p[C],style:v,styleSpec:a}):[new Ue(C,r[C],`unknown property "${C}"`)]);return E},projectionDefinition:function(l){const r=l.key;let a=l.value;a=a instanceof String?a.valueOf():a;const p=li(a);return p!=="array"||function(v){return Array.isArray(v)&&v.length===3&&typeof v[0]=="string"&&typeof v[1]=="string"&&typeof v[2]=="number"}(a)||function(v){return!!["interpolate","step","literal"].includes(v[0])}(a)?["array","string"].includes(p)?[]:[new Ue(r,a,`projection expected, invalid type "${p}" found`)]:[new Ue(r,a,`projection expected, invalid array ${JSON.stringify(a)} found`)]},string:Ca,formatted:function(l){return Ca(l).length===0?[]:tn(l)},resolvedImage:function(l){return Ca(l).length===0?[]:tn(l)},padding:function(l){const r=l.key,a=l.value;if(li(a)==="array"){if(a.length<1||a.length>4)return[new Ue(r,a,`padding requires 1 to 4 values; ${a.length} values found`)];const p={type:"number"};let v=[];for(let T=0;T<a.length;T++)v=v.concat(l.validateSpec({key:`${r}[${T}]`,value:a[T],validateSpec:l.validateSpec,valueSpec:p}));return v}return dt({key:r,value:a,valueSpec:{}})},variableAnchorOffsetCollection:function(l){const r=l.key,a=l.value,p=li(a),v=l.styleSpec;if(p!=="array"||a.length<1||a.length%2!=0)return[new Ue(r,a,"variableAnchorOffsetCollection requires a non-empty array of even length")];let T=[];for(let E=0;E<a.length;E+=2)T=T.concat(Sn({key:`${r}[${E}]`,value:a[E],valueSpec:v.layout_symbol["text-anchor"]})),T=T.concat(rt({key:`${r}[${E+1}]`,value:a[E+1],valueSpec:{length:2,value:"number"},validateSpec:l.validateSpec,style:l.style,styleSpec:v}));return T},sprite:Ni};function Dc(l){const r=l.value,a=l.valueSpec,p=l.styleSpec;return l.validateSpec=Dc,a.expression&&Js(Z(r))?kt(l):a.expression&&Ja(he(r))?tn(l):a.type&&nu[a.type]?nu[a.type](l):Oe(zt({},l,{valueSpec:a.type?p[a.type]:a}))}function Cu(l){const r=l.value,a=l.key,p=Ca(l);return p.length||(r.indexOf("{fontstack}")===-1&&p.push(new Ue(a,r,'"glyphs" url must include a "{fontstack}" token')),r.indexOf("{range}")===-1&&p.push(new Ue(a,r,'"glyphs" url must include a "{range}" token'))),p}function Ar(l,r=ve){let a=[];return a=a.concat(Dc({key:"",value:l,valueSpec:r.$root,styleSpec:r,style:l,validateSpec:Dc,objectElementValidators:{glyphs:Cu,"*":()=>[]}})),l.constants&&(a=a.concat(F({key:"constants",value:l.constants}))),Ds(a)}function $i(l){return function(r){return l({...r,validateSpec:Dc})}}function Ds(l){return[].concat(l).sort((r,a)=>r.line-a.line)}function Uo(l){return function(...r){return Ds(l.apply(this,r))}}Ar.source=Uo($i(eu)),Ar.sprite=Uo($i(Ni)),Ar.glyphs=Uo($i(Cu)),Ar.light=Uo($i(El)),Ar.sky=Uo($i(ta)),Ar.terrain=Uo($i(tu)),Ar.layer=Uo($i(Jl)),Ar.filter=Uo($i(Gn)),Ar.paintProperty=Uo($i(Ao)),Ar.layoutProperty=Uo($i(_o));const Au=Ar,zc=Au.light,ka=Au.sky,hr=Au.paintProperty,nr=Au.layoutProperty;function iu(l,r){let a=!1;if(r&&r.length)for(const p of r)l.fire(new ya(new Error(p.message))),a=!0;return a}class Mr{constructor(r,a,p){const v=this.cells=[];if(r instanceof ArrayBuffer){this.arrayBuffer=r;const E=new Int32Array(this.arrayBuffer);r=E[0],this.d=(a=E[1])+2*(p=E[2]);for(let D=0;D<this.d*this.d;D++){const N=E[3+D],U=E[3+D+1];v.push(N===U?null:E.subarray(N,U))}const C=E[3+v.length+1];this.keys=E.subarray(E[3+v.length],C),this.bboxes=E.subarray(C),this.insert=this._insertReadonly}else{this.d=a+2*p;for(let E=0;E<this.d*this.d;E++)v.push([]);this.keys=[],this.bboxes=[]}this.n=a,this.extent=r,this.padding=p,this.scale=a/r,this.uid=0;const T=p/a*r;this.min=-T,this.max=r+T}insert(r,a,p,v,T){this._forEachCell(a,p,v,T,this._insertCell,this.uid++,void 0,void 0),this.keys.push(r),this.bboxes.push(a),this.bboxes.push(p),this.bboxes.push(v),this.bboxes.push(T)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(r,a,p,v,T,E){this.cells[T].push(E)}query(r,a,p,v,T){const E=this.min,C=this.max;if(r<=E&&a<=E&&C<=p&&C<=v&&!T)return Array.prototype.slice.call(this.keys);{const D=[];return this._forEachCell(r,a,p,v,this._queryCell,D,{},T),D}}_queryCell(r,a,p,v,T,E,C,D){const N=this.cells[T];if(N!==null){const U=this.keys,H=this.bboxes;for(let X=0;X<N.length;X++){const ee=N[X];if(C[ee]===void 0){const ie=4*ee;(D?D(H[ie+0],H[ie+1],H[ie+2],H[ie+3]):r<=H[ie+2]&&a<=H[ie+3]&&p>=H[ie+0]&&v>=H[ie+1])?(C[ee]=!0,E.push(U[ee])):C[ee]=!1}}}}_forEachCell(r,a,p,v,T,E,C,D){const N=this._convertToCellCoord(r),U=this._convertToCellCoord(a),H=this._convertToCellCoord(p),X=this._convertToCellCoord(v);for(let ee=N;ee<=H;ee++)for(let ie=U;ie<=X;ie++){const ae=this.d*ie+ee;if((!D||D(this._convertFromCellCoord(ee),this._convertFromCellCoord(ie),this._convertFromCellCoord(ee+1),this._convertFromCellCoord(ie+1)))&&T.call(this,r,a,p,v,ae,E,C,D))return}}_convertFromCellCoord(r){return(r-this.padding)/this.scale}_convertToCellCoord(r){return Math.max(0,Math.min(this.d-1,Math.floor(r*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const r=this.cells,a=3+this.cells.length+1+1;let p=0;for(let E=0;E<this.cells.length;E++)p+=this.cells[E].length;const v=new Int32Array(a+p+this.keys.length+this.bboxes.length);v[0]=this.extent,v[1]=this.n,v[2]=this.padding;let T=a;for(let E=0;E<r.length;E++){const C=r[E];v[3+E]=T,v.set(C,T),T+=C.length}return v[3+r.length]=T,v.set(this.keys,T),T+=this.keys.length,v[3+r.length+1]=T,v.set(this.bboxes,T),T+=this.bboxes.length,v.buffer}static serialize(r,a){const p=r.toArrayBuffer();return a&&a.push(p),{buffer:p}}static deserialize(r){return new Mr(r.buffer)}}const Rr={};function Gt(l,r,a={}){if(Rr[l])throw new Error(`${l} is already registered.`);Object.defineProperty(r,"_classRegistryKey",{value:l,writeable:!1}),Rr[l]={klass:r,omit:a.omit||[],shallow:a.shallow||[]}}Gt("Object",Object),Gt("TransferableGridIndex",Mr),Gt("Color",kn),Gt("Error",Error),Gt("AJAXError",Mi),Gt("ResolvedImage",Ir),Gt("StylePropertyFunction",Ku),Gt("StyleExpression",Eu,{omit:["_evaluator"]}),Gt("ZoomDependentExpression",Pa),Gt("ZoomConstantExpression",go),Gt("CompoundExpression",us,{omit:["_evaluate"]});for(const l in wl)wl[l]._classRegistryKey||Gt(`Expression_${l}`,wl[l]);function Xu(l){return l&&typeof ArrayBuffer<"u"&&(l instanceof ArrayBuffer||l.constructor&&l.constructor.name==="ArrayBuffer")}function Kr(l){return l.$name||l.constructor._classRegistryKey}function wh(l){return!function(r){if(r===null||typeof r!="object")return!1;const a=Kr(r);return!(!a||a==="Object")}(l)&&(l==null||typeof l=="boolean"||typeof l=="number"||typeof l=="string"||l instanceof Boolean||l instanceof Number||l instanceof String||l instanceof Date||l instanceof RegExp||l instanceof Blob||l instanceof Error||Xu(l)||Qo(l)||ArrayBuffer.isView(l)||l instanceof ImageData)}function Nc(l,r){if(wh(l))return(Xu(l)||Qo(l))&&r&&r.push(l),ArrayBuffer.isView(l)&&r&&r.push(l.buffer),l instanceof ImageData&&r&&r.push(l.data.buffer),l;if(Array.isArray(l)){const T=[];for(const E of l)T.push(Nc(E,r));return T}if(typeof l!="object")throw new Error("can't serialize object of type "+typeof l);const a=Kr(l);if(!a)throw new Error(`can't serialize object of unregistered class ${l.constructor.name}`);if(!Rr[a])throw new Error(`${a} is not registered.`);const{klass:p}=Rr[a],v=p.serialize?p.serialize(l,r):{};if(p.serialize){if(r&&v===r[r.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const T in l){if(!l.hasOwnProperty(T)||Rr[a].omit.indexOf(T)>=0)continue;const E=l[T];v[T]=Rr[a].shallow.indexOf(T)>=0?E:Nc(E,r)}l instanceof Error&&(v.message=l.message)}if(v.$name)throw new Error("$name property is reserved for worker serialization logic.");return a!=="Object"&&(v.$name=a),v}function ru(l){if(wh(l))return l;if(Array.isArray(l))return l.map(ru);if(typeof l!="object")throw new Error("can't deserialize object of type "+typeof l);const r=Kr(l)||"Object";if(!Rr[r])throw new Error(`can't deserialize unregistered class ${r}`);const{klass:a}=Rr[r];if(!a)throw new Error(`can't deserialize unregistered class ${r}`);if(a.deserialize)return a.deserialize(l);const p=Object.create(a.prototype);for(const v of Object.keys(l)){if(v==="$name")continue;const T=l[v];p[v]=Rr[r].shallow.indexOf(v)>=0?T:ru(T)}return p}class bh{constructor(){this.first=!0}update(r,a){const p=Math.floor(r);return this.first?(this.first=!1,this.lastIntegerZoom=p,this.lastIntegerZoomTime=0,this.lastZoom=r,this.lastFloorZoom=p,!0):(this.lastFloorZoom>p?(this.lastIntegerZoom=p+1,this.lastIntegerZoomTime=a):this.lastFloorZoom<p&&(this.lastIntegerZoom=p,this.lastIntegerZoomTime=a),r!==this.lastZoom&&(this.lastZoom=r,this.lastFloorZoom=p,!0))}}const ti={"Latin-1 Supplement":l=>l>=128&&l<=255,"Hangul Jamo":l=>l>=4352&&l<=4607,Khmer:l=>l>=6016&&l<=6143,"General Punctuation":l=>l>=8192&&l<=8303,"Letterlike Symbols":l=>l>=8448&&l<=8527,"Number Forms":l=>l>=8528&&l<=8591,"Miscellaneous Technical":l=>l>=8960&&l<=9215,"Control Pictures":l=>l>=9216&&l<=9279,"Optical Character Recognition":l=>l>=9280&&l<=9311,"Enclosed Alphanumerics":l=>l>=9312&&l<=9471,"Geometric Shapes":l=>l>=9632&&l<=9727,"Miscellaneous Symbols":l=>l>=9728&&l<=9983,"Miscellaneous Symbols and Arrows":l=>l>=11008&&l<=11263,"Ideographic Description Characters":l=>l>=12272&&l<=12287,"CJK Symbols and Punctuation":l=>l>=12288&&l<=12351,Katakana:l=>l>=12448&&l<=12543,Kanbun:l=>l>=12688&&l<=12703,"CJK Strokes":l=>l>=12736&&l<=12783,"Enclosed CJK Letters and Months":l=>l>=12800&&l<=13055,"CJK Compatibility":l=>l>=13056&&l<=13311,"Yijing Hexagram Symbols":l=>l>=19904&&l<=19967,"Private Use Area":l=>l>=57344&&l<=63743,"Vertical Forms":l=>l>=65040&&l<=65055,"CJK Compatibility Forms":l=>l>=65072&&l<=65103,"Small Form Variants":l=>l>=65104&&l<=65135,"Halfwidth and Fullwidth Forms":l=>l>=65280&&l<=65519};function zs(l){for(const r of l)if(ou(r.charCodeAt(0)))return!0;return!1}function Th(l){for(const r of l)if(!Hp(r.charCodeAt(0)))return!1;return!0}function Oc(l){const r=l.map(a=>{try{return new RegExp(`\\p{sc=${a}}`,"u").source}catch{return null}}).filter(a=>a);return new RegExp(r.join("|"),"u")}const Gd=Oc(["Arab","Dupl","Mong","Ougr","Syrc"]);function Hp(l){return!Gd.test(String.fromCodePoint(l))}const el=Oc(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function ou(l){return!(l!==746&&l!==747&&(l<4352||!(ti["CJK Compatibility Forms"](l)&&!(l>=65097&&l<=65103)||ti["CJK Compatibility"](l)||ti["CJK Strokes"](l)||!(!ti["CJK Symbols and Punctuation"](l)||l>=12296&&l<=12305||l>=12308&&l<=12319||l===12336)||ti["Enclosed CJK Letters and Months"](l)||ti["Ideographic Description Characters"](l)||ti.Kanbun(l)||ti.Katakana(l)&&l!==12540||!(!ti["Halfwidth and Fullwidth Forms"](l)||l===65288||l===65289||l===65293||l>=65306&&l<=65310||l===65339||l===65341||l===65343||l>=65371&&l<=65503||l===65507||l>=65512&&l<=65519)||!(!ti["Small Form Variants"](l)||l>=65112&&l<=65118||l>=65123&&l<=65126)||ti["Vertical Forms"](l)||ti["Yijing Hexagram Symbols"](l)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(l))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(l))||el.test(String.fromCodePoint(l)))))}function Yu(l){return!(ou(l)||function(r){return!!(ti["Latin-1 Supplement"](r)&&(r===167||r===169||r===174||r===177||r===188||r===189||r===190||r===215||r===247)||ti["General Punctuation"](r)&&(r===8214||r===8224||r===8225||r===8240||r===8241||r===8251||r===8252||r===8258||r===8263||r===8264||r===8265||r===8273)||ti["Letterlike Symbols"](r)||ti["Number Forms"](r)||ti["Miscellaneous Technical"](r)&&(r>=8960&&r<=8967||r>=8972&&r<=8991||r>=8996&&r<=9e3||r===9003||r>=9085&&r<=9114||r>=9150&&r<=9165||r===9167||r>=9169&&r<=9179||r>=9186&&r<=9215)||ti["Control Pictures"](r)&&r!==9251||ti["Optical Character Recognition"](r)||ti["Enclosed Alphanumerics"](r)||ti["Geometric Shapes"](r)||ti["Miscellaneous Symbols"](r)&&!(r>=9754&&r<=9759)||ti["Miscellaneous Symbols and Arrows"](r)&&(r>=11026&&r<=11055||r>=11088&&r<=11097||r>=11192&&r<=11243)||ti["CJK Symbols and Punctuation"](r)||ti.Katakana(r)||ti["Private Use Area"](r)||ti["CJK Compatibility Forms"](r)||ti["Small Form Variants"](r)||ti["Halfwidth and Fullwidth Forms"](r)||r===8734||r===8756||r===8757||r>=9984&&r<=10087||r>=10102&&r<=10131||r===65532||r===65533)}(l))}const Sh=Oc(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Eh(l){return Sh.test(String.fromCodePoint(l))}function na(l,r){return!(!r&&Eh(l)||l>=2304&&l<=3583||l>=3840&&l<=4255||ti.Khmer(l))}function ia(l){for(const r of l)if(Eh(r.charCodeAt(0)))return!0;return!1}const hs=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(l){this.pluginStatus=l.pluginStatus,this.pluginURL=l.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(l){if(hs.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=l.applyArabicShaping,this.processBidirectionalText=l.processBidirectionalText,this.processStyledBidirectionalText=l.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(l,r){return u(this,void 0,void 0,function*(){if(this.isParsed())return this.getState();if(l.pluginStatus!=="loading")return this.setState(l),l;const a=l.pluginURL,p=new Promise(T=>{this.loadScriptResolve=T});r(a);const v=new Promise(T=>setTimeout(()=>T(),this.TIMEOUT));if(yield Promise.race([p,v]),this.isParsed()){const T={pluginStatus:"loaded",pluginURL:a};return this.setState(T),T}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${a}`)})}};class bi{constructor(r,a){this.zoom=r,a?(this.now=a.now,this.fadeDuration=a.fadeDuration,this.zoomHistory=a.zoomHistory,this.transition=a.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new bh,this.transition={})}isSupportedScript(r){return function(a,p){for(const v of a)if(!na(v.charCodeAt(0),p))return!1;return!0}(r,hs.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const r=this.zoom,a=r-Math.floor(r),p=this.crossFadingFactor();return r>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:a+(1-a)*p}:{fromScale:.5,toScale:1,t:1-(1-p)*a}}}class Ma{constructor(r,a){this.property=r,this.value=a,this.expression=function(p,v){if(Js(p))return new Ku(p,v);if(Ja(p)){const T=Wu(p,v);if(T.result==="error")throw new Error(T.value.map(E=>`${E.key}: ${E.message}`).join(", "));return T.value}{let T=p;return v.type==="color"&&typeof p=="string"?T=kn.parse(p):v.type!=="padding"||typeof p!="number"&&!Array.isArray(p)?v.type==="variableAnchorOffsetCollection"&&Array.isArray(p)?T=Er.parse(p):v.type==="projectionDefinition"&&typeof p=="string"&&(T=xr.parse(p)):T=Ei.parse(p),{kind:"constant",evaluate:()=>T}}}(a===void 0?r.specification.default:a,r.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(r,a,p){return this.property.possiblyEvaluate(this,r,a,p)}}class Il{constructor(r){this.property=r,this.value=new Ma(r,void 0)}transitioned(r,a){return new Ih(this.property,this.value,a,Xt({},r.transition,this.transition),r.now)}untransitioned(){return new Ih(this.property,this.value,null,{},0)}}class sd{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitionablePropertyValues)}getValue(r){return Jn(this._values[r].value.value)}setValue(r,a){Object.prototype.hasOwnProperty.call(this._values,r)||(this._values[r]=new Il(this._values[r].property)),this._values[r].value=new Ma(this._values[r].property,a===null?void 0:Jn(a))}getTransition(r){return Jn(this._values[r].transition)}setTransition(r,a){Object.prototype.hasOwnProperty.call(this._values,r)||(this._values[r]=new Il(this._values[r].property)),this._values[r].transition=Jn(a)||void 0}serialize(){const r={};for(const a of Object.keys(this._values)){const p=this.getValue(a);p!==void 0&&(r[a]=p);const v=this.getTransition(a);v!==void 0&&(r[`${a}-transition`]=v)}return r}transitioned(r,a){const p=new Ph(this._properties);for(const v of Object.keys(this._values))p._values[v]=this._values[v].transitioned(r,a._values[v]);return p}untransitioned(){const r=new Ph(this._properties);for(const a of Object.keys(this._values))r._values[a]=this._values[a].untransitioned();return r}}class Ih{constructor(r,a,p,v,T){this.property=r,this.value=a,this.begin=T+v.delay||0,this.end=this.begin+v.duration||0,r.specification.transition&&(v.delay||v.duration)&&(this.prior=p)}possiblyEvaluate(r,a,p){const v=r.now||0,T=this.value.possiblyEvaluate(r,a,p),E=this.prior;if(E){if(v>this.end)return this.prior=null,T;if(this.value.isDataDriven())return this.prior=null,T;if(v<this.begin)return E.possiblyEvaluate(r,a,p);{const C=(v-this.begin)/(this.end-this.begin);return this.property.interpolate(E.possiblyEvaluate(r,a,p),T,St(C))}}return T}}class Ph{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitioningPropertyValues)}possiblyEvaluate(r,a,p){const v=new Qi(this._properties);for(const T of Object.keys(this._values))v._values[T]=this._values[T].possiblyEvaluate(r,a,p);return v}hasTransition(){for(const r of Object.keys(this._values))if(this._values[r].prior)return!0;return!1}}class jo{constructor(r){this._properties=r,this._values=Object.create(r.defaultPropertyValues)}hasValue(r){return this._values[r].value!==void 0}getValue(r){return Jn(this._values[r].value)}setValue(r,a){this._values[r]=new Ma(this._values[r].property,a===null?void 0:Jn(a))}serialize(){const r={};for(const a of Object.keys(this._values)){const p=this.getValue(a);p!==void 0&&(r[a]=p)}return r}possiblyEvaluate(r,a,p){const v=new Qi(this._properties);for(const T of Object.keys(this._values))v._values[T]=this._values[T].possiblyEvaluate(r,a,p);return v}}class Lr{constructor(r,a,p){this.property=r,this.value=a,this.parameters=p}isConstant(){return this.value.kind==="constant"}constantOr(r){return this.value.kind==="constant"?this.value.value:r}evaluate(r,a,p,v){return this.property.evaluate(this.value,this.parameters,r,a,p,v)}}class Qi{constructor(r){this._properties=r,this._values=Object.create(r.defaultPossiblyEvaluatedValues)}get(r){return this._values[r]}}class rn{constructor(r){this.specification=r}possiblyEvaluate(r,a){if(r.isDataDriven())throw new Error("Value should not be data driven");return r.expression.evaluate(a)}interpolate(r,a,p){const v=mo[this.specification.type];return v?v(r,a,p):r}}class En{constructor(r,a){this.specification=r,this.overrides=a}possiblyEvaluate(r,a,p,v){return new Lr(this,r.expression.kind==="constant"||r.expression.kind==="camera"?{kind:"constant",value:r.expression.evaluate(a,null,{},p,v)}:r.expression,a)}interpolate(r,a,p){if(r.value.kind!=="constant"||a.value.kind!=="constant")return r;if(r.value.value===void 0||a.value.value===void 0)return new Lr(this,{kind:"constant",value:void 0},r.parameters);const v=mo[this.specification.type];if(v){const T=v(r.value.value,a.value.value,p);return new Lr(this,{kind:"constant",value:T},r.parameters)}return r}evaluate(r,a,p,v,T,E){return r.kind==="constant"?r.value:r.evaluate(a,p,v,T,E)}}class Fc extends En{possiblyEvaluate(r,a,p,v){if(r.value===void 0)return new Lr(this,{kind:"constant",value:void 0},a);if(r.expression.kind==="constant"){const T=r.expression.evaluate(a,null,{},p,v),E=r.property.specification.type==="resolvedImage"&&typeof T!="string"?T.name:T,C=this._calculate(E,E,E,a);return new Lr(this,{kind:"constant",value:C},a)}if(r.expression.kind==="camera"){const T=this._calculate(r.expression.evaluate({zoom:a.zoom-1}),r.expression.evaluate({zoom:a.zoom}),r.expression.evaluate({zoom:a.zoom+1}),a);return new Lr(this,{kind:"constant",value:T},a)}return new Lr(this,r.expression,a)}evaluate(r,a,p,v,T,E){if(r.kind==="source"){const C=r.evaluate(a,p,v,T,E);return this._calculate(C,C,C,a)}return r.kind==="composite"?this._calculate(r.evaluate({zoom:Math.floor(a.zoom)-1},p,v),r.evaluate({zoom:Math.floor(a.zoom)},p,v),r.evaluate({zoom:Math.floor(a.zoom)+1},p,v),a):r.value}_calculate(r,a,p,v){return v.zoom>v.zoomHistory.lastIntegerZoom?{from:r,to:a}:{from:p,to:a}}interpolate(r){return r}}class Bc{constructor(r){this.specification=r}possiblyEvaluate(r,a,p,v){if(r.value!==void 0){if(r.expression.kind==="constant"){const T=r.expression.evaluate(a,null,{},p,v);return this._calculate(T,T,T,a)}return this._calculate(r.expression.evaluate(new bi(Math.floor(a.zoom-1),a)),r.expression.evaluate(new bi(Math.floor(a.zoom),a)),r.expression.evaluate(new bi(Math.floor(a.zoom+1),a)),a)}}_calculate(r,a,p,v){return v.zoom>v.zoomHistory.lastIntegerZoom?{from:r,to:a}:{from:p,to:a}}interpolate(r){return r}}class Vc{constructor(r){this.specification=r}possiblyEvaluate(r,a,p,v){return!!r.expression.evaluate(a,null,{},p,v)}interpolate(){return!1}}class ds{constructor(r){this.properties=r,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const a in r){const p=r[a];p.specification.overridable&&this.overridableProperties.push(a);const v=this.defaultPropertyValues[a]=new Ma(p,void 0),T=this.defaultTransitionablePropertyValues[a]=new Il(p);this.defaultTransitioningPropertyValues[a]=T.untransitioned(),this.defaultPossiblyEvaluatedValues[a]=v.possiblyEvaluate({})}}}Gt("DataDrivenProperty",En),Gt("DataConstantProperty",rn),Gt("CrossFadedDataDrivenProperty",Fc),Gt("CrossFadedProperty",Bc),Gt("ColorRampProperty",Vc);const Ch="-transition";class tl extends Bo{constructor(r,a){if(super(),this.id=r.id,this.type=r.type,this._featureFilter={filter:()=>!0,needGeometry:!1},r.type!=="custom"&&(this.metadata=r.metadata,this.minzoom=r.minzoom,this.maxzoom=r.maxzoom,r.type!=="background"&&(this.source=r.source,this.sourceLayer=r["source-layer"],this.filter=r.filter),a.layout&&(this._unevaluatedLayout=new jo(a.layout)),a.paint)){this._transitionablePaint=new sd(a.paint);for(const p in r.paint)this.setPaintProperty(p,r.paint[p],{validate:!1});for(const p in r.layout)this.setLayoutProperty(p,r.layout[p],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Qi(a.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(r){return r==="visibility"?this.visibility:this._unevaluatedLayout.getValue(r)}setLayoutProperty(r,a,p={}){a!=null&&this._validate(nr,`layers.${this.id}.layout.${r}`,r,a,p)||(r!=="visibility"?this._unevaluatedLayout.setValue(r,a):this.visibility=a)}getPaintProperty(r){return r.endsWith(Ch)?this._transitionablePaint.getTransition(r.slice(0,-11)):this._transitionablePaint.getValue(r)}setPaintProperty(r,a,p={}){if(a!=null&&this._validate(hr,`layers.${this.id}.paint.${r}`,r,a,p))return!1;if(r.endsWith(Ch))return this._transitionablePaint.setTransition(r.slice(0,-11),a||void 0),!1;{const v=this._transitionablePaint._values[r],T=v.property.specification["property-type"]==="cross-faded-data-driven",E=v.value.isDataDriven(),C=v.value;this._transitionablePaint.setValue(r,a),this._handleSpecialPaintPropertyUpdate(r);const D=this._transitionablePaint._values[r].value;return D.isDataDriven()||E||T||this._handleOverridablePaintPropertyUpdate(r,C,D)}}_handleSpecialPaintPropertyUpdate(r){}_handleOverridablePaintPropertyUpdate(r,a,p){return!1}isHidden(r){return!!(this.minzoom&&r<this.minzoom)||!!(this.maxzoom&&r>=this.maxzoom)||this.visibility==="none"}updateTransitions(r){this._transitioningPaint=this._transitionablePaint.transitioned(r,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(r,a){r.getCrossfadeParameters&&(this._crossfadeParameters=r.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(r,void 0,a)),this.paint=this._transitioningPaint.possiblyEvaluate(r,void 0,a)}serialize(){const r={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(r.layout=r.layout||{},r.layout.visibility=this.visibility),$n(r,(a,p)=>!(a===void 0||p==="layout"&&!Object.keys(a).length||p==="paint"&&!Object.keys(a).length))}_validate(r,a,p,v,T={}){return(!T||T.validate!==!1)&&iu(this,r.call(Au,{key:a,layerType:this.type,objectKey:p,value:v,styleSpec:ve,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const r in this.paint._values){const a=this.paint.get(r);if(a instanceof Lr&&Qs(a.property.specification)&&(a.value.kind==="source"||a.value.kind==="composite")&&a.value.isStateDependent)return!0}return!1}}const Uc={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Qu{constructor(r,a){this._structArray=r,this._pos1=a*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class ir{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(r,a){return r._trim(),a&&(r.isTransferred=!0,a.push(r.arrayBuffer)),{length:r.length,arrayBuffer:r.arrayBuffer}}static deserialize(r){const a=Object.create(this.prototype);return a.arrayBuffer=r.arrayBuffer,a.length=r.length,a.capacity=r.arrayBuffer.byteLength/a.bytesPerElement,a._refreshViews(),a}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(r){this.reserve(r),this.length=r}reserve(r){if(r>this.capacity){this.capacity=Math.max(r,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const a=this.uint8;this._refreshViews(),a&&this.uint8.set(a)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function _r(l,r=1){let a=0,p=0;return{members:l.map(v=>{const T=Uc[v.type].BYTES_PER_ELEMENT,E=a=Ah(a,Math.max(r,T)),C=v.components||1;return p=Math.max(p,T),a+=T*C,{name:v.name,type:v.type,components:C,offset:E}}),size:Ah(a,Math.max(p,r)),alignment:r}}function Ah(l,r){return Math.ceil(l/r)*r}class jc extends ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a){const p=this.length;return this.resize(p+1),this.emplace(p,r,a)}emplace(r,a,p){const v=2*r;return this.int16[v+0]=a,this.int16[v+1]=p,r}}jc.prototype.bytesPerElement=4,Gt("StructArrayLayout2i4",jc);class $c extends ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a,p){const v=this.length;return this.resize(v+1),this.emplace(v,r,a,p)}emplace(r,a,p,v){const T=3*r;return this.int16[T+0]=a,this.int16[T+1]=p,this.int16[T+2]=v,r}}$c.prototype.bytesPerElement=6,Gt("StructArrayLayout3i6",$c);class ku extends ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a,p,v){const T=this.length;return this.resize(T+1),this.emplace(T,r,a,p,v)}emplace(r,a,p,v,T){const E=4*r;return this.int16[E+0]=a,this.int16[E+1]=p,this.int16[E+2]=v,this.int16[E+3]=T,r}}ku.prototype.bytesPerElement=8,Gt("StructArrayLayout4i8",ku);class ad extends ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a,p,v,T,E){const C=this.length;return this.resize(C+1),this.emplace(C,r,a,p,v,T,E)}emplace(r,a,p,v,T,E,C){const D=6*r;return this.int16[D+0]=a,this.int16[D+1]=p,this.int16[D+2]=v,this.int16[D+3]=T,this.int16[D+4]=E,this.int16[D+5]=C,r}}ad.prototype.bytesPerElement=12,Gt("StructArrayLayout2i4i12",ad);class Ra extends ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a,p,v,T,E){const C=this.length;return this.resize(C+1),this.emplace(C,r,a,p,v,T,E)}emplace(r,a,p,v,T,E,C){const D=4*r,N=8*r;return this.int16[D+0]=a,this.int16[D+1]=p,this.uint8[N+4]=v,this.uint8[N+5]=T,this.uint8[N+6]=E,this.uint8[N+7]=C,r}}Ra.prototype.bytesPerElement=8,Gt("StructArrayLayout2i4ub8",Ra);class su extends ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a){const p=this.length;return this.resize(p+1),this.emplace(p,r,a)}emplace(r,a,p){const v=2*r;return this.float32[v+0]=a,this.float32[v+1]=p,r}}su.prototype.bytesPerElement=8,Gt("StructArrayLayout2f8",su);class Pl extends ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a,p,v,T,E,C,D,N,U){const H=this.length;return this.resize(H+1),this.emplace(H,r,a,p,v,T,E,C,D,N,U)}emplace(r,a,p,v,T,E,C,D,N,U,H){const X=10*r;return this.uint16[X+0]=a,this.uint16[X+1]=p,this.uint16[X+2]=v,this.uint16[X+3]=T,this.uint16[X+4]=E,this.uint16[X+5]=C,this.uint16[X+6]=D,this.uint16[X+7]=N,this.uint16[X+8]=U,this.uint16[X+9]=H,r}}Pl.prototype.bytesPerElement=20,Gt("StructArrayLayout10ui20",Pl);class Hc extends ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a,p,v,T,E,C,D,N,U,H,X){const ee=this.length;return this.resize(ee+1),this.emplace(ee,r,a,p,v,T,E,C,D,N,U,H,X)}emplace(r,a,p,v,T,E,C,D,N,U,H,X,ee){const ie=12*r;return this.int16[ie+0]=a,this.int16[ie+1]=p,this.int16[ie+2]=v,this.int16[ie+3]=T,this.uint16[ie+4]=E,this.uint16[ie+5]=C,this.uint16[ie+6]=D,this.uint16[ie+7]=N,this.int16[ie+8]=U,this.int16[ie+9]=H,this.int16[ie+10]=X,this.int16[ie+11]=ee,r}}Hc.prototype.bytesPerElement=24,Gt("StructArrayLayout4i4ui4i24",Hc);class Ju extends ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,p){const v=this.length;return this.resize(v+1),this.emplace(v,r,a,p)}emplace(r,a,p,v){const T=3*r;return this.float32[T+0]=a,this.float32[T+1]=p,this.float32[T+2]=v,r}}Ju.prototype.bytesPerElement=12,Gt("StructArrayLayout3f12",Ju);class kh extends ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r){const a=this.length;return this.resize(a+1),this.emplace(a,r)}emplace(r,a){return this.uint32[1*r+0]=a,r}}kh.prototype.bytesPerElement=4,Gt("StructArrayLayout1ul4",kh);class Mu extends ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a,p,v,T,E,C,D,N){const U=this.length;return this.resize(U+1),this.emplace(U,r,a,p,v,T,E,C,D,N)}emplace(r,a,p,v,T,E,C,D,N,U){const H=10*r,X=5*r;return this.int16[H+0]=a,this.int16[H+1]=p,this.int16[H+2]=v,this.int16[H+3]=T,this.int16[H+4]=E,this.int16[H+5]=C,this.uint32[X+3]=D,this.uint16[H+8]=N,this.uint16[H+9]=U,r}}Mu.prototype.bytesPerElement=20,Gt("StructArrayLayout6i1ul2ui20",Mu);class La extends ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a,p,v,T,E){const C=this.length;return this.resize(C+1),this.emplace(C,r,a,p,v,T,E)}emplace(r,a,p,v,T,E,C){const D=6*r;return this.int16[D+0]=a,this.int16[D+1]=p,this.int16[D+2]=v,this.int16[D+3]=T,this.int16[D+4]=E,this.int16[D+5]=C,r}}La.prototype.bytesPerElement=12,Gt("StructArrayLayout2i2i2i12",La);class Ns extends ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a,p,v,T){const E=this.length;return this.resize(E+1),this.emplace(E,r,a,p,v,T)}emplace(r,a,p,v,T,E){const C=4*r,D=8*r;return this.float32[C+0]=a,this.float32[C+1]=p,this.float32[C+2]=v,this.int16[D+6]=T,this.int16[D+7]=E,r}}Ns.prototype.bytesPerElement=16,Gt("StructArrayLayout2f1f2i16",Ns);class Cl extends ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a,p,v,T,E){const C=this.length;return this.resize(C+1),this.emplace(C,r,a,p,v,T,E)}emplace(r,a,p,v,T,E,C){const D=16*r,N=4*r,U=8*r;return this.uint8[D+0]=a,this.uint8[D+1]=p,this.float32[N+1]=v,this.float32[N+2]=T,this.int16[U+6]=E,this.int16[U+7]=C,r}}Cl.prototype.bytesPerElement=16,Gt("StructArrayLayout2ub2f2i16",Cl);class Al extends ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a,p){const v=this.length;return this.resize(v+1),this.emplace(v,r,a,p)}emplace(r,a,p,v){const T=3*r;return this.uint16[T+0]=a,this.uint16[T+1]=p,this.uint16[T+2]=v,r}}Al.prototype.bytesPerElement=6,Gt("StructArrayLayout3ui6",Al);class ld extends ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,p,v,T,E,C,D,N,U,H,X,ee,ie,ae,_e,Ee){const je=this.length;return this.resize(je+1),this.emplace(je,r,a,p,v,T,E,C,D,N,U,H,X,ee,ie,ae,_e,Ee)}emplace(r,a,p,v,T,E,C,D,N,U,H,X,ee,ie,ae,_e,Ee,je){const ke=24*r,J=12*r,me=48*r;return this.int16[ke+0]=a,this.int16[ke+1]=p,this.uint16[ke+2]=v,this.uint16[ke+3]=T,this.uint32[J+2]=E,this.uint32[J+3]=C,this.uint32[J+4]=D,this.uint16[ke+10]=N,this.uint16[ke+11]=U,this.uint16[ke+12]=H,this.float32[J+7]=X,this.float32[J+8]=ee,this.uint8[me+36]=ie,this.uint8[me+37]=ae,this.uint8[me+38]=_e,this.uint32[J+10]=Ee,this.int16[ke+22]=je,r}}ld.prototype.bytesPerElement=48,Gt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",ld);class nl extends ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,p,v,T,E,C,D,N,U,H,X,ee,ie,ae,_e,Ee,je,ke,J,me,Me,st,Pt,ct,_t,Dt,Ct){const Ft=this.length;return this.resize(Ft+1),this.emplace(Ft,r,a,p,v,T,E,C,D,N,U,H,X,ee,ie,ae,_e,Ee,je,ke,J,me,Me,st,Pt,ct,_t,Dt,Ct)}emplace(r,a,p,v,T,E,C,D,N,U,H,X,ee,ie,ae,_e,Ee,je,ke,J,me,Me,st,Pt,ct,_t,Dt,Ct,Ft){const bt=32*r,on=16*r;return this.int16[bt+0]=a,this.int16[bt+1]=p,this.int16[bt+2]=v,this.int16[bt+3]=T,this.int16[bt+4]=E,this.int16[bt+5]=C,this.int16[bt+6]=D,this.int16[bt+7]=N,this.uint16[bt+8]=U,this.uint16[bt+9]=H,this.uint16[bt+10]=X,this.uint16[bt+11]=ee,this.uint16[bt+12]=ie,this.uint16[bt+13]=ae,this.uint16[bt+14]=_e,this.uint16[bt+15]=Ee,this.uint16[bt+16]=je,this.uint16[bt+17]=ke,this.uint16[bt+18]=J,this.uint16[bt+19]=me,this.uint16[bt+20]=Me,this.uint16[bt+21]=st,this.uint16[bt+22]=Pt,this.uint32[on+12]=ct,this.float32[on+13]=_t,this.float32[on+14]=Dt,this.uint16[bt+30]=Ct,this.uint16[bt+31]=Ft,r}}nl.prototype.bytesPerElement=64,Gt("StructArrayLayout8i15ui1ul2f2ui64",nl);class Da extends ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r){const a=this.length;return this.resize(a+1),this.emplace(a,r)}emplace(r,a){return this.float32[1*r+0]=a,r}}Da.prototype.bytesPerElement=4,Gt("StructArrayLayout1f4",Da);class Mh extends ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,p){const v=this.length;return this.resize(v+1),this.emplace(v,r,a,p)}emplace(r,a,p,v){const T=3*r;return this.uint16[6*r+0]=a,this.float32[T+1]=p,this.float32[T+2]=v,r}}Mh.prototype.bytesPerElement=12,Gt("StructArrayLayout1ui2f12",Mh);class w extends ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a,p){const v=this.length;return this.resize(v+1),this.emplace(v,r,a,p)}emplace(r,a,p,v){const T=4*r;return this.uint32[2*r+0]=a,this.uint16[T+2]=p,this.uint16[T+3]=v,r}}w.prototype.bytesPerElement=8,Gt("StructArrayLayout1ul2ui8",w);class n extends ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a){const p=this.length;return this.resize(p+1),this.emplace(p,r,a)}emplace(r,a,p){const v=2*r;return this.uint16[v+0]=a,this.uint16[v+1]=p,r}}n.prototype.bytesPerElement=4,Gt("StructArrayLayout2ui4",n);class s extends ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r){const a=this.length;return this.resize(a+1),this.emplace(a,r)}emplace(r,a){return this.uint16[1*r+0]=a,r}}s.prototype.bytesPerElement=2,Gt("StructArrayLayout1ui2",s);class m extends ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,p,v){const T=this.length;return this.resize(T+1),this.emplace(T,r,a,p,v)}emplace(r,a,p,v,T){const E=4*r;return this.float32[E+0]=a,this.float32[E+1]=p,this.float32[E+2]=v,this.float32[E+3]=T,r}}m.prototype.bytesPerElement=16,Gt("StructArrayLayout4f16",m);class y extends Qu{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new de(this.anchorPointX,this.anchorPointY)}}y.prototype.size=20;class b extends Mu{get(r){return new y(this,r)}}Gt("CollisionBoxArray",b);class I extends Qu{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(r){this._structArray.uint8[this._pos1+37]=r}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(r){this._structArray.uint8[this._pos1+38]=r}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(r){this._structArray.uint32[this._pos4+10]=r}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}I.prototype.size=48;class M extends ld{get(r){return new I(this,r)}}Gt("PlacedSymbolArray",M);class z extends Qu{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(r){this._structArray.uint32[this._pos4+12]=r}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}z.prototype.size=64;class B extends nl{get(r){return new z(this,r)}}Gt("SymbolInstanceArray",B);class q extends Da{getoffsetX(r){return this.float32[1*r+0]}}Gt("GlyphOffsetArray",q);class W extends $c{getx(r){return this.int16[3*r+0]}gety(r){return this.int16[3*r+1]}gettileUnitDistanceFromAnchor(r){return this.int16[3*r+2]}}Gt("SymbolLineVertexArray",W);class K extends Qu{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}K.prototype.size=12;class oe extends Mh{get(r){return new K(this,r)}}Gt("TextAnchorOffsetArray",oe);class le extends Qu{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}le.prototype.size=8;class we extends w{get(r){return new le(this,r)}}Gt("FeatureIndexArray",we);class ge extends jc{}class Te extends jc{}class Ie extends jc{}class Re extends ad{}class ze extends Ra{}class Fe extends su{}class Ve extends Pl{}class Ne extends Hc{}class Qe extends Ju{}class Je extends kh{}class yt extends La{}class xt extends Cl{}class pt extends Al{}class Ut extends n{}const At=_r([{name:"a_pos",components:2,type:"Int16"}],4),{members:Et}=At;class Ht{constructor(r=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=r}prepareSegment(r,a,p,v){const T=this.segments[this.segments.length-1];return r>Ht.MAX_VERTEX_ARRAY_LENGTH&&Ji(`Max vertices per segment is ${Ht.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${r}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${Ht.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!T||T.vertexLength+r>Ht.MAX_VERTEX_ARRAY_LENGTH||T.sortKey!==v?this.createNewSegment(a,p,v):T}createNewSegment(r,a,p){const v={vertexOffset:r.length,primitiveOffset:a.length,vertexLength:0,primitiveLength:0,vaos:{}};return p!==void 0&&(v.sortKey=p),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(v),v}getOrCreateLatestSegment(r,a,p){return this.prepareSegment(0,r,a,p)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const r of this.segments)for(const a in r.vaos)r.vaos[a].destroy()}static simpleSegment(r,a,p,v){return new Ht([{vertexOffset:r,primitiveOffset:a,vertexLength:p,primitiveLength:v,vaos:{},sortKey:0}])}}function Vn(l,r){return 256*(l=Qt(Math.floor(l),0,255))+Qt(Math.floor(r),0,255)}Ht.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Gt("SegmentVector",Ht);const Zn=_r([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var pi,Ti,ar,Oi={exports:{}},Fi={exports:{}},Hi={exports:{}},yo=function(){if(ar)return Oi.exports;ar=1;var l=(pi||(pi=1,Fi.exports=function(a,p){var v,T,E,C,D,N,U,H;for(T=a.length-(v=3&a.length),E=p,D=3432918353,N=461845907,H=0;H<T;)U=255&a.charCodeAt(H)|(255&a.charCodeAt(++H))<<8|(255&a.charCodeAt(++H))<<16|(255&a.charCodeAt(++H))<<24,++H,E=27492+(65535&(C=5*(65535&(E=(E^=U=(65535&(U=(U=(65535&U)*D+(((U>>>16)*D&65535)<<16)&4294967295)<<15|U>>>17))*N+(((U>>>16)*N&65535)<<16)&4294967295)<<13|E>>>19))+((5*(E>>>16)&65535)<<16)&4294967295))+((58964+(C>>>16)&65535)<<16);switch(U=0,v){case 3:U^=(255&a.charCodeAt(H+2))<<16;case 2:U^=(255&a.charCodeAt(H+1))<<8;case 1:E^=U=(65535&(U=(U=(65535&(U^=255&a.charCodeAt(H)))*D+(((U>>>16)*D&65535)<<16)&4294967295)<<15|U>>>17))*N+(((U>>>16)*N&65535)<<16)&4294967295}return E^=a.length,E=2246822507*(65535&(E^=E>>>16))+((2246822507*(E>>>16)&65535)<<16)&4294967295,E=3266489909*(65535&(E^=E>>>13))+((3266489909*(E>>>16)&65535)<<16)&4294967295,(E^=E>>>16)>>>0}),Fi.exports),r=(Ti||(Ti=1,Hi.exports=function(a,p){for(var v,T=a.length,E=p^T,C=0;T>=4;)v=1540483477*(65535&(v=255&a.charCodeAt(C)|(255&a.charCodeAt(++C))<<8|(255&a.charCodeAt(++C))<<16|(255&a.charCodeAt(++C))<<24))+((1540483477*(v>>>16)&65535)<<16),E=1540483477*(65535&E)+((1540483477*(E>>>16)&65535)<<16)^(v=1540483477*(65535&(v^=v>>>24))+((1540483477*(v>>>16)&65535)<<16)),T-=4,++C;switch(T){case 3:E^=(255&a.charCodeAt(C+2))<<16;case 2:E^=(255&a.charCodeAt(C+1))<<8;case 1:E=1540483477*(65535&(E^=255&a.charCodeAt(C)))+((1540483477*(E>>>16)&65535)<<16)}return E=1540483477*(65535&(E^=E>>>13))+((1540483477*(E>>>16)&65535)<<16),(E^=E>>>15)>>>0}),Hi.exports);return Oi.exports=l,Oi.exports.murmur3=l,Oi.exports.murmur2=r,Oi.exports}(),Or=R(yo);class Fr{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(r,a,p,v){this.ids.push($o(r)),this.positions.push(a,p,v)}getPositions(r){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const a=$o(r);let p=0,v=this.ids.length-1;for(;p<v;){const E=p+v>>1;this.ids[E]>=a?v=E:p=E+1}const T=[];for(;this.ids[p]===a;)T.push({index:this.positions[3*p],start:this.positions[3*p+1],end:this.positions[3*p+2]}),p++;return T}static serialize(r,a){const p=new Float64Array(r.ids),v=new Uint32Array(r.positions);return kl(p,v,0,p.length-1),a&&a.push(p.buffer,v.buffer),{ids:p,positions:v}}static deserialize(r){const a=new Fr;return a.ids=r.ids,a.positions=r.positions,a.indexed=!0,a}}function $o(l){const r=+l;return!isNaN(r)&&r<=Number.MAX_SAFE_INTEGER?r:Or(String(l))}function kl(l,r,a,p){for(;a<p;){const v=l[a+p>>1];let T=a-1,E=p+1;for(;;){do T++;while(l[T]<v);do E--;while(l[E]>v);if(T>=E)break;il(l,T,E),il(r,3*T,3*E),il(r,3*T+1,3*E+1),il(r,3*T+2,3*E+2)}E-a<p-E?(kl(l,r,a,E),a=E+1):(kl(l,r,E+1,p),p=E)}}function il(l,r,a){const p=l[r];l[r]=l[a],l[a]=p}Gt("FeaturePositionMap",Fr);class ko{constructor(r,a){this.gl=r.gl,this.location=a}}class Ml extends ko{constructor(r,a){super(r,a),this.current=0}set(r){this.current!==r&&(this.current=r,this.gl.uniform1f(this.location,r))}}class Ru extends ko{constructor(r,a){super(r,a),this.current=[0,0,0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]&&r[3]===this.current[3]||(this.current=r,this.gl.uniform4f(this.location,r[0],r[1],r[2],r[3]))}}class Lu extends ko{constructor(r,a){super(r,a),this.current=kn.transparent}set(r){r.r===this.current.r&&r.g===this.current.g&&r.b===this.current.b&&r.a===this.current.a||(this.current=r,this.gl.uniform4f(this.location,r.r,r.g,r.b,r.a))}}const ec=new Float32Array(16);function Ho(l){return[Vn(255*l.r,255*l.g),Vn(255*l.b,255*l.a)]}class ra{constructor(r,a,p){this.value=r,this.uniformNames=a.map(v=>`u_${v}`),this.type=p}setUniform(r,a,p){r.set(p.constantOr(this.value))}getBinding(r,a,p){return this.type==="color"?new Lu(r,a):new Ml(r,a)}}class oa{constructor(r,a){this.uniformNames=a.map(p=>`u_${p}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(r,a){this.pixelRatioFrom=a.pixelRatio,this.pixelRatioTo=r.pixelRatio,this.patternFrom=a.tlbr,this.patternTo=r.tlbr}setUniform(r,a,p,v){const T=v==="u_pattern_to"?this.patternTo:v==="u_pattern_from"?this.patternFrom:v==="u_pixel_ratio_to"?this.pixelRatioTo:v==="u_pixel_ratio_from"?this.pixelRatioFrom:null;T&&r.set(T)}getBinding(r,a,p){return p.substr(0,9)==="u_pattern"?new Ru(r,a):new Ml(r,a)}}class Os{constructor(r,a,p,v){this.expression=r,this.type=p,this.maxValue=0,this.paintVertexAttributes=a.map(T=>({name:`a_${T}`,type:"Float32",components:p==="color"?2:1,offset:0})),this.paintVertexArray=new v}populatePaintArray(r,a,p,v,T){const E=this.paintVertexArray.length,C=this.expression.evaluate(new bi(0),a,{},v,[],T);this.paintVertexArray.resize(r),this._setPaintValue(E,r,C)}updatePaintArray(r,a,p,v){const T=this.expression.evaluate({zoom:0},p,v);this._setPaintValue(r,a,T)}_setPaintValue(r,a,p){if(this.type==="color"){const v=Ho(p);for(let T=r;T<a;T++)this.paintVertexArray.emplace(T,v[0],v[1])}else{for(let v=r;v<a;v++)this.paintVertexArray.emplace(v,p);this.maxValue=Math.max(this.maxValue,Math.abs(p))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class qi{constructor(r,a,p,v,T,E){this.expression=r,this.uniformNames=a.map(C=>`u_${C}_t`),this.type=p,this.useIntegerZoom=v,this.zoom=T,this.maxValue=0,this.paintVertexAttributes=a.map(C=>({name:`a_${C}`,type:"Float32",components:p==="color"?4:2,offset:0})),this.paintVertexArray=new E}populatePaintArray(r,a,p,v,T){const E=this.expression.evaluate(new bi(this.zoom),a,{},v,[],T),C=this.expression.evaluate(new bi(this.zoom+1),a,{},v,[],T),D=this.paintVertexArray.length;this.paintVertexArray.resize(r),this._setPaintValue(D,r,E,C)}updatePaintArray(r,a,p,v){const T=this.expression.evaluate({zoom:this.zoom},p,v),E=this.expression.evaluate({zoom:this.zoom+1},p,v);this._setPaintValue(r,a,T,E)}_setPaintValue(r,a,p,v){if(this.type==="color"){const T=Ho(p),E=Ho(v);for(let C=r;C<a;C++)this.paintVertexArray.emplace(C,T[0],T[1],E[0],E[1])}else{for(let T=r;T<a;T++)this.paintVertexArray.emplace(T,p,v);this.maxValue=Math.max(this.maxValue,Math.abs(p),Math.abs(v))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(r,a){const p=this.useIntegerZoom?Math.floor(a.zoom):a.zoom,v=Qt(this.expression.interpolationFactor(p,this.zoom,this.zoom+1),0,1);r.set(v)}getBinding(r,a,p){return new Ml(r,a)}}class lr{constructor(r,a,p,v,T,E){this.expression=r,this.type=a,this.useIntegerZoom=p,this.zoom=v,this.layerId=E,this.zoomInPaintVertexArray=new T,this.zoomOutPaintVertexArray=new T}populatePaintArray(r,a,p){const v=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(r),this.zoomOutPaintVertexArray.resize(r),this._setPaintValues(v,r,a.patterns&&a.patterns[this.layerId],p)}updatePaintArray(r,a,p,v,T){this._setPaintValues(r,a,p.patterns&&p.patterns[this.layerId],T)}_setPaintValues(r,a,p,v){if(!v||!p)return;const{min:T,mid:E,max:C}=p,D=v[T],N=v[E],U=v[C];if(D&&N&&U)for(let H=r;H<a;H++)this.zoomInPaintVertexArray.emplace(H,N.tl[0],N.tl[1],N.br[0],N.br[1],D.tl[0],D.tl[1],D.br[0],D.br[1],N.pixelRatio,D.pixelRatio),this.zoomOutPaintVertexArray.emplace(H,N.tl[0],N.tl[1],N.br[0],N.br[1],U.tl[0],U.tl[1],U.br[0],U.br[1],N.pixelRatio,U.pixelRatio)}upload(r){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=r.createVertexBuffer(this.zoomInPaintVertexArray,Zn.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=r.createVertexBuffer(this.zoomOutPaintVertexArray,Zn.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Fs{constructor(r,a,p){this.binders={},this._buffers=[];const v=[];for(const T in r.paint._values){if(!p(T))continue;const E=r.paint.get(T);if(!(E instanceof Lr&&Qs(E.property.specification)))continue;const C=qp(T,r.type),D=E.value,N=E.property.specification.type,U=E.property.useIntegerZoom,H=E.property.specification["property-type"],X=H==="cross-faded"||H==="cross-faded-data-driven";if(D.kind==="constant")this.binders[T]=X?new oa(D.value,C):new ra(D.value,C,N),v.push(`/u_${T}`);else if(D.kind==="source"||X){const ee=Gp(T,N,"source");this.binders[T]=X?new lr(D,N,U,a,ee,r.id):new Os(D,C,N,ee),v.push(`/a_${T}`)}else{const ee=Gp(T,N,"composite");this.binders[T]=new qi(D,C,N,U,a,ee),v.push(`/z_${T}`)}}this.cacheKey=v.sort().join("")}getMaxValue(r){const a=this.binders[r];return a instanceof Os||a instanceof qi?a.maxValue:0}populatePaintArrays(r,a,p,v,T){for(const E in this.binders){const C=this.binders[E];(C instanceof Os||C instanceof qi||C instanceof lr)&&C.populatePaintArray(r,a,p,v,T)}}setConstantPatternPositions(r,a){for(const p in this.binders){const v=this.binders[p];v instanceof oa&&v.setConstantPatternPositions(r,a)}}updatePaintArrays(r,a,p,v,T){let E=!1;for(const C in r){const D=a.getPositions(C);for(const N of D){const U=p.feature(N.index);for(const H in this.binders){const X=this.binders[H];if((X instanceof Os||X instanceof qi||X instanceof lr)&&X.expression.isStateDependent===!0){const ee=v.paint.get(H);X.expression=ee.value,X.updatePaintArray(N.start,N.end,U,r[C],T),E=!0}}}}return E}defines(){const r=[];for(const a in this.binders){const p=this.binders[a];(p instanceof ra||p instanceof oa)&&r.push(...p.uniformNames.map(v=>`#define HAS_UNIFORM_${v}`))}return r}getBinderAttributes(){const r=[];for(const a in this.binders){const p=this.binders[a];if(p instanceof Os||p instanceof qi)for(let v=0;v<p.paintVertexAttributes.length;v++)r.push(p.paintVertexAttributes[v].name);else if(p instanceof lr)for(let v=0;v<Zn.members.length;v++)r.push(Zn.members[v].name)}return r}getBinderUniforms(){const r=[];for(const a in this.binders){const p=this.binders[a];if(p instanceof ra||p instanceof oa||p instanceof qi)for(const v of p.uniformNames)r.push(v)}return r}getPaintVertexBuffers(){return this._buffers}getUniforms(r,a){const p=[];for(const v in this.binders){const T=this.binders[v];if(T instanceof ra||T instanceof oa||T instanceof qi){for(const E of T.uniformNames)if(a[E]){const C=T.getBinding(r,a[E],E);p.push({name:E,property:v,binding:C})}}}return p}setUniforms(r,a,p,v){for(const{name:T,property:E,binding:C}of a)this.binders[E].setUniform(C,v,p.get(E),T)}updatePaintBuffers(r){this._buffers=[];for(const a in this.binders){const p=this.binders[a];if(r&&p instanceof lr){const v=r.fromScale===2?p.zoomInPaintVertexBuffer:p.zoomOutPaintVertexBuffer;v&&this._buffers.push(v)}else(p instanceof Os||p instanceof qi)&&p.paintVertexBuffer&&this._buffers.push(p.paintVertexBuffer)}}upload(r){for(const a in this.binders){const p=this.binders[a];(p instanceof Os||p instanceof qi||p instanceof lr)&&p.upload(r)}this.updatePaintBuffers()}destroy(){for(const r in this.binders){const a=this.binders[r];(a instanceof Os||a instanceof qi||a instanceof lr)&&a.destroy()}}}class yr{constructor(r,a,p=()=>!0){this.programConfigurations={};for(const v of r)this.programConfigurations[v.id]=new Fs(v,a,p);this.needsUpload=!1,this._featureMap=new Fr,this._bufferOffset=0}populatePaintArrays(r,a,p,v,T,E){for(const C in this.programConfigurations)this.programConfigurations[C].populatePaintArrays(r,a,v,T,E);a.id!==void 0&&this._featureMap.add(a.id,p,this._bufferOffset,r),this._bufferOffset=r,this.needsUpload=!0}updatePaintArrays(r,a,p,v){for(const T of p)this.needsUpload=this.programConfigurations[T.id].updatePaintArrays(r,this._featureMap,a,T,v)||this.needsUpload}get(r){return this.programConfigurations[r]}upload(r){if(this.needsUpload){for(const a in this.programConfigurations)this.programConfigurations[a].upload(r);this.needsUpload=!1}}destroy(){for(const r in this.programConfigurations)this.programConfigurations[r].destroy()}}function qp(l,r){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[l]||[l.replace(`${r}-`,"").replace(/-/g,"_")]}function Gp(l,r,a){const p={color:{source:su,composite:m},number:{source:Da,composite:su}},v=function(T){return{"line-pattern":{source:Ve,composite:Ve},"fill-pattern":{source:Ve,composite:Ve},"fill-extrusion-pattern":{source:Ve,composite:Ve}}[T]}(l);return v&&v[a]||p[r][a]}Gt("ConstantBinder",ra),Gt("CrossFadedConstantBinder",oa),Gt("SourceExpressionBinder",Os),Gt("CrossFadedCompositeBinder",lr),Gt("CompositeExpressionBinder",qi),Gt("ProgramConfiguration",Fs,{omit:["_buffers"]}),Gt("ProgramConfigurationSet",yr);const ud=Math.pow(2,14)-1,Zp=-ud-1;function tc(l){const r=dn/l.extent,a=l.loadGeometry();for(let p=0;p<a.length;p++){const v=a[p];for(let T=0;T<v.length;T++){const E=v[T],C=Math.round(E.x*r),D=Math.round(E.y*r);E.x=Qt(C,Zp,ud),E.y=Qt(D,Zp,ud),(C<E.x||C>E.x+1||D<E.y||D>E.y+1)&&Ji("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return a}function Du(l,r){return{type:l.type,id:l.id,properties:l.properties,geometry:r?tc(l):[]}}const au=-32768;function Zd(l,r,a,p,v){l.emplaceBack(au+8*r+p,au+8*a+v)}class nc{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(a=>a.id),this.index=r.index,this.hasPattern=!1,this.layoutVertexArray=new Te,this.indexArray=new pt,this.segments=new Ht,this.programConfigurations=new yr(r.layers,r.zoom),this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id)}populate(r,a,p){const v=this.layers[0],T=[];let E=null,C=!1,D=v.type==="heatmap";if(v.type==="circle"){const U=v;E=U.layout.get("circle-sort-key"),C=!E.isConstant(),D=D||U.paint.get("circle-pitch-alignment")==="map"}const N=D?a.subdivisionGranularity.circle:1;for(const{feature:U,id:H,index:X,sourceLayerIndex:ee}of r){const ie=this.layers[0]._featureFilter.needGeometry,ae=Du(U,ie);if(!this.layers[0]._featureFilter.filter(new bi(this.zoom),ae,p))continue;const _e=C?E.evaluate(ae,{},p):void 0,Ee={id:H,properties:U.properties,type:U.type,sourceLayerIndex:ee,index:X,geometry:ie?ae.geometry:tc(U),patterns:{},sortKey:_e};T.push(Ee)}C&&T.sort((U,H)=>U.sortKey-H.sortKey);for(const U of T){const{geometry:H,index:X,sourceLayerIndex:ee}=U,ie=r[X].feature;this.addFeature(U,H,X,p,N),a.featureIndex.insert(ie,H,X,ee,this.index)}}update(r,a,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,a,this.stateDependentLayers,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,Et),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(r,a,p,v,T=1){let E;switch(T){case 1:E=[0,7];break;case 3:E=[0,2,5,7];break;case 5:E=[0,1,3,4,6,7];break;case 7:E=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${T}; valid values are 1, 3, 5, 7.`)}const C=E.length;for(const D of a)for(const N of D){const U=N.x,H=N.y;if(U<0||U>=dn||H<0||H>=dn)continue;const X=this.segments.prepareSegment(C*C,this.layoutVertexArray,this.indexArray,r.sortKey),ee=X.vertexLength;for(let ie=0;ie<C;ie++)for(let ae=0;ae<C;ae++)Zd(this.layoutVertexArray,U,H,E[ae],E[ie]);for(let ie=0;ie<C-1;ie++)for(let ae=0;ae<C-1;ae++){const _e=ee+ie*C+ae,Ee=ee+(ie+1)*C+ae;this.indexArray.emplaceBack(_e,Ee+1,_e+1),this.indexArray.emplaceBack(_e,Ee,Ee+1)}X.vertexLength+=C*C,X.primitiveLength+=(C-1)*(C-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,p,{},v)}}function Wd(l,r){for(let a=0;a<l.length;a++)if(qc(r,l[a]))return!0;for(let a=0;a<r.length;a++)if(qc(l,r[a]))return!0;return!!Yd(l,r)}function Kd(l,r,a){return!!qc(l,r)||!!Kp(r,l,a)}function Xd(l,r){if(l.length===1)return mm(r,l[0]);for(let a=0;a<r.length;a++){const p=r[a];for(let v=0;v<p.length;v++)if(qc(l,p[v]))return!0}for(let a=0;a<l.length;a++)if(mm(r,l[a]))return!0;for(let a=0;a<r.length;a++)if(Yd(l,r[a]))return!0;return!1}function sa(l,r,a){if(l.length>1){if(Yd(l,r))return!0;for(let p=0;p<r.length;p++)if(Kp(r[p],l,a))return!0}for(let p=0;p<l.length;p++)if(Kp(l[p],r,a))return!0;return!1}function Yd(l,r){if(l.length===0||r.length===0)return!1;for(let a=0;a<l.length-1;a++){const p=l[a],v=l[a+1];for(let T=0;T<r.length-1;T++)if(Wp(p,v,r[T],r[T+1]))return!0}return!1}function Wp(l,r,a,p){return Ui(l,a,p)!==Ui(r,a,p)&&Ui(l,r,a)!==Ui(l,r,p)}function Kp(l,r,a){const p=a*a;if(r.length===1)return l.distSqr(r[0])<p;for(let v=1;v<r.length;v++)if(fm(l,r[v-1],r[v])<p)return!0;return!1}function fm(l,r,a){const p=r.distSqr(a);if(p===0)return l.distSqr(r);const v=((l.x-r.x)*(a.x-r.x)+(l.y-r.y)*(a.y-r.y))/p;return l.distSqr(v<0?r:v>1?a:a.sub(r)._mult(v)._add(r))}function mm(l,r){let a,p,v,T=!1;for(let E=0;E<l.length;E++){a=l[E];for(let C=0,D=a.length-1;C<a.length;D=C++)p=a[C],v=a[D],p.y>r.y!=v.y>r.y&&r.x<(v.x-p.x)*(r.y-p.y)/(v.y-p.y)+p.x&&(T=!T)}return T}function qc(l,r){let a=!1;for(let p=0,v=l.length-1;p<l.length;v=p++){const T=l[p],E=l[v];T.y>r.y!=E.y>r.y&&r.x<(E.x-T.x)*(r.y-T.y)/(E.y-T.y)+T.x&&(a=!a)}return a}function cd(l,r,a){const p=a[0],v=a[2];if(l.x<p.x&&r.x<p.x||l.x>v.x&&r.x>v.x||l.y<p.y&&r.y<p.y||l.y>v.y&&r.y>v.y)return!1;const T=Ui(l,r,a[0]);return T!==Ui(l,r,a[1])||T!==Ui(l,r,a[2])||T!==Ui(l,r,a[3])}function Rh(l,r,a){const p=r.paint.get(l).value;return p.kind==="constant"?p.value:a.programConfigurations.get(r.id).getMaxValue(l)}function hd(l){return Math.sqrt(l[0]*l[0]+l[1]*l[1])}function Xp(l,r,a,p,v){if(!r[0]&&!r[1])return l;const T=de.convert(r)._mult(v);a==="viewport"&&T._rotate(-p);const E=[];for(let C=0;C<l.length;C++)E.push(l[C].sub(T));return E}let gm,_m;Gt("CircleBucket",nc,{omit:["layers"]});var Zg={get paint(){return _m=_m||new ds({"circle-radius":new En(ve.paint_circle["circle-radius"]),"circle-color":new En(ve.paint_circle["circle-color"]),"circle-blur":new En(ve.paint_circle["circle-blur"]),"circle-opacity":new En(ve.paint_circle["circle-opacity"]),"circle-translate":new rn(ve.paint_circle["circle-translate"]),"circle-translate-anchor":new rn(ve.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new rn(ve.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new rn(ve.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new En(ve.paint_circle["circle-stroke-width"]),"circle-stroke-color":new En(ve.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new En(ve.paint_circle["circle-stroke-opacity"])})},get layout(){return gm=gm||new ds({"circle-sort-key":new En(ve.layout_circle["circle-sort-key"])})}};class Wg extends tl{constructor(r){super(r,Zg)}createBucket(r){return new nc(r)}queryRadius(r){const a=r;return Rh("circle-radius",this,a)+Rh("circle-stroke-width",this,a)+hd(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:r,feature:a,featureState:p,geometry:v,transform:T,pixelsToTileUnits:E,pixelPosMatrix:C}){const D=Xp(r,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-T.bearingInRadians,E),N=this.paint.get("circle-radius").evaluate(a,p)+this.paint.get("circle-stroke-width").evaluate(a,p),U=this.paint.get("circle-pitch-alignment")==="map",H=U?D:function(ee,ie){return ee.map(ae=>ym(ae,ie))}(D,C),X=U?N*E:N;for(const ee of v)for(const ie of ee){const ae=U?ie:ym(ie,C);let _e=X;const Ee=$e([],[ie.x,ie.y,0,1],C);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?_e*=Ee[3]/T.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(_e*=T.cameraToCenterDistance/Ee[3]),Kd(H,ae,_e))return!0}return!1}}function ym(l,r){const a=$e([],[l.x,l.y,0,1],r);return new de(a[0]/a[3],a[1]/a[3])}class Kg extends nc{}let aa;Gt("HeatmapBucket",Kg,{omit:["layers"]});var la={get paint(){return aa=aa||new ds({"heatmap-radius":new En(ve.paint_heatmap["heatmap-radius"]),"heatmap-weight":new En(ve.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new rn(ve.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Vc(ve.paint_heatmap["heatmap-color"]),"heatmap-opacity":new rn(ve.paint_heatmap["heatmap-opacity"])})}};function Yp(l,{width:r,height:a},p,v){if(v){if(v instanceof Uint8ClampedArray)v=new Uint8Array(v.buffer);else if(v.length!==r*a*p)throw new RangeError(`mismatched image size. expected: ${v.length} but got: ${r*a*p}`)}else v=new Uint8Array(r*a*p);return l.width=r,l.height=a,l.data=v,l}function vm(l,{width:r,height:a},p){if(r===l.width&&a===l.height)return;const v=Yp({},{width:r,height:a},p);Qp(l,v,{x:0,y:0},{x:0,y:0},{width:Math.min(l.width,r),height:Math.min(l.height,a)},p),l.width=r,l.height=a,l.data=v.data}function Qp(l,r,a,p,v,T){if(v.width===0||v.height===0)return r;if(v.width>l.width||v.height>l.height||a.x>l.width-v.width||a.y>l.height-v.height)throw new RangeError("out of range source coordinates for image copy");if(v.width>r.width||v.height>r.height||p.x>r.width-v.width||p.y>r.height-v.height)throw new RangeError("out of range destination coordinates for image copy");const E=l.data,C=r.data;if(E===C)throw new Error("srcData equals dstData, so image is already copied");for(let D=0;D<v.height;D++){const N=((a.y+D)*l.width+a.x)*T,U=((p.y+D)*r.width+p.x)*T;for(let H=0;H<v.width*T;H++)C[U+H]=E[N+H]}return r}class dd{constructor(r,a){Yp(this,r,1,a)}resize(r){vm(this,r,1)}clone(){return new dd({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,a,p,v,T){Qp(r,a,p,v,T,1)}}class za{constructor(r,a){Yp(this,r,4,a)}resize(r){vm(this,r,4)}replace(r,a){a?this.data.set(r):this.data=r instanceof Uint8ClampedArray?new Uint8Array(r.buffer):r}clone(){return new za({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,a,p,v,T){Qp(r,a,p,v,T,4)}}function Jp(l){const r={},a=l.resolution||256,p=l.clips?l.clips.length:1,v=l.image||new za({width:a,height:p});if(Math.log(a)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${a}`);const T=(E,C,D)=>{r[l.evaluationKey]=D;const N=l.expression.evaluate(r);v.data[E+C+0]=Math.floor(255*N.r/N.a),v.data[E+C+1]=Math.floor(255*N.g/N.a),v.data[E+C+2]=Math.floor(255*N.b/N.a),v.data[E+C+3]=Math.floor(255*N.a)};if(l.clips)for(let E=0,C=0;E<p;++E,C+=4*a)for(let D=0,N=0;D<a;D++,N+=4){const U=D/(a-1),{start:H,end:X}=l.clips[E];T(C,N,H*(1-U)+X*U)}else for(let E=0,C=0;E<a;E++,C+=4)T(0,C,E/(a-1));return v}Gt("AlphaImage",dd),Gt("RGBAImage",za);const ef="big-fb";class xm extends tl{createBucket(r){return new Kg(r)}constructor(r){super(r,la),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(r){r==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Jp({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(ef)&&this.heatmapFbos.delete(ef)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let wm;var Xg={get paint(){return wm=wm||new ds({"hillshade-illumination-direction":new rn(ve.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new rn(ve.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new rn(ve.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new rn(ve.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new rn(ve.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new rn(ve.paint_hillshade["hillshade-accent-color"])})}};class bm extends tl{constructor(r){super(r,Xg)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const Tm=_r([{name:"a_pos",components:2,type:"Int16"}],4),{members:Yg}=Tm;function Qd(l,r,a){const p=a.patternDependencies;let v=!1;for(const T of r){const E=T.paint.get(`${l}-pattern`);E.isConstant()||(v=!0);const C=E.constantOr(null);C&&(v=!0,p[C.to]=!0,p[C.from]=!0)}return v}function pd(l,r,a,p,v){const T=v.patternDependencies;for(const E of r){const C=E.paint.get(`${l}-pattern`).value;if(C.kind!=="constant"){let D=C.evaluate({zoom:p-1},a,{},v.availableImages),N=C.evaluate({zoom:p},a,{},v.availableImages),U=C.evaluate({zoom:p+1},a,{},v.availableImages);D=D&&D.name?D.name:D,N=N&&N.name?N.name:N,U=U&&U.name?U.name:U,T[D]=!0,T[N]=!0,T[U]=!0,a.patterns[E.id]={min:D,mid:N,max:U}}}return a}function Qg(l,r,a,p,v){let T;if(v===function(E,C,D,N){let U=0;for(let H=C,X=D-N;H<D;H+=N)U+=(E[X]-E[H])*(E[H+1]+E[X+1]),X=H;return U}(l,r,a,p)>0)for(let E=r;E<a;E+=p)T=i_(E/p|0,l[E],l[E+1],T);else for(let E=a-p;E>=r;E-=p)T=i_(E/p|0,l[E],l[E+1],T);return T&&ro(T,T.next)&&(oc(T),T=T.next),T}function Gc(l,r){if(!l)return l;r||(r=l);let a,p=l;do if(a=!1,p.steiner||!ro(p,p.next)&&br(p.prev,p,p.next)!==0)p=p.next;else{if(oc(p),p=r=p.prev,p===p.next)break;a=!0}while(a||p!==r);return r}function Lh(l,r,a,p,v,T,E){if(!l)return;!E&&T&&function(D,N,U,H){let X=D;do X.z===0&&(X.z=nf(X.x,X.y,N,U,H)),X.prevZ=X.prev,X.nextZ=X.next,X=X.next;while(X!==D);X.prevZ.nextZ=null,X.prevZ=null,function(ee){let ie,ae=1;do{let _e,Ee=ee;ee=null;let je=null;for(ie=0;Ee;){ie++;let ke=Ee,J=0;for(let Me=0;Me<ae&&(J++,ke=ke.nextZ,ke);Me++);let me=ae;for(;J>0||me>0&&ke;)J!==0&&(me===0||!ke||Ee.z<=ke.z)?(_e=Ee,Ee=Ee.nextZ,J--):(_e=ke,ke=ke.nextZ,me--),je?je.nextZ=_e:ee=_e,_e.prevZ=je,je=_e;Ee=ke}je.nextZ=null,ae*=2}while(ie>1)}(X)}(l,p,v,T);let C=l;for(;l.prev!==l.next;){const D=l.prev,N=l.next;if(T?tf(l,p,v,T):Jg(l))r.push(D.i,l.i,N.i),oc(l),l=N.next,C=N.next;else if((l=N)===C){E?E===1?Lh(l=ic(Gc(l),r),r,a,p,v,T,2):E===2&&xv(l,r,a,p,v,T):Lh(Gc(l),r,a,p,v,T,1);break}}}function Jg(l){const r=l.prev,a=l,p=l.next;if(br(r,a,p)>=0)return!1;const v=r.x,T=a.x,E=p.x,C=r.y,D=a.y,N=p.y,U=Math.min(v,T,E),H=Math.min(C,D,N),X=Math.max(v,T,E),ee=Math.max(C,D,N);let ie=p.next;for(;ie!==r;){if(ie.x>=U&&ie.x<=X&&ie.y>=H&&ie.y<=ee&&ep(v,C,T,D,E,N,ie.x,ie.y)&&br(ie.prev,ie,ie.next)>=0)return!1;ie=ie.next}return!0}function tf(l,r,a,p){const v=l.prev,T=l,E=l.next;if(br(v,T,E)>=0)return!1;const C=v.x,D=T.x,N=E.x,U=v.y,H=T.y,X=E.y,ee=Math.min(C,D,N),ie=Math.min(U,H,X),ae=Math.max(C,D,N),_e=Math.max(U,H,X),Ee=nf(ee,ie,r,a,p),je=nf(ae,_e,r,a,p);let ke=l.prevZ,J=l.nextZ;for(;ke&&ke.z>=Ee&&J&&J.z<=je;){if(ke.x>=ee&&ke.x<=ae&&ke.y>=ie&&ke.y<=_e&&ke!==v&&ke!==E&&ep(C,U,D,H,N,X,ke.x,ke.y)&&br(ke.prev,ke,ke.next)>=0||(ke=ke.prevZ,J.x>=ee&&J.x<=ae&&J.y>=ie&&J.y<=_e&&J!==v&&J!==E&&ep(C,U,D,H,N,X,J.x,J.y)&&br(J.prev,J,J.next)>=0))return!1;J=J.nextZ}for(;ke&&ke.z>=Ee;){if(ke.x>=ee&&ke.x<=ae&&ke.y>=ie&&ke.y<=_e&&ke!==v&&ke!==E&&ep(C,U,D,H,N,X,ke.x,ke.y)&&br(ke.prev,ke,ke.next)>=0)return!1;ke=ke.prevZ}for(;J&&J.z<=je;){if(J.x>=ee&&J.x<=ae&&J.y>=ie&&J.y<=_e&&J!==v&&J!==E&&ep(C,U,D,H,N,X,J.x,J.y)&&br(J.prev,J,J.next)>=0)return!1;J=J.nextZ}return!0}function ic(l,r){let a=l;do{const p=a.prev,v=a.next.next;!ro(p,v)&&n_(p,a,a.next,v)&&Dh(p,v)&&Dh(v,p)&&(r.push(p.i,a.i,v.i),oc(a),oc(a.next),a=l=v),a=a.next}while(a!==l);return Gc(a)}function xv(l,r,a,p,v,T){let E=l;do{let C=E.next.next;for(;C!==E.prev;){if(E.i!==C.i&&wv(E,C)){let D=Em(E,C);return E=Gc(E,E.next),D=Gc(D,D.next),Lh(E,r,a,p,v,T,0),void Lh(D,r,a,p,v,T,0)}C=C.next}E=E.next}while(E!==l)}function e_(l,r){let a=l.x-r.x;return a===0&&(a=l.y-r.y,a===0)&&(a=(l.next.y-l.y)/(l.next.x-l.x)-(r.next.y-r.y)/(r.next.x-r.x)),a}function Sm(l,r){const a=function(v,T){let E=T;const C=v.x,D=v.y;let N,U=-1/0;if(ro(v,E))return E;do{if(ro(v,E.next))return E.next;if(D<=E.y&&D>=E.next.y&&E.next.y!==E.y){const ae=E.x+(D-E.y)*(E.next.x-E.x)/(E.next.y-E.y);if(ae<=C&&ae>U&&(U=ae,N=E.x<E.next.x?E:E.next,ae===C))return N}E=E.next}while(E!==T);if(!N)return null;const H=N,X=N.x,ee=N.y;let ie=1/0;E=N;do{if(C>=E.x&&E.x>=X&&C!==E.x&&ps(D<ee?C:U,D,X,ee,D<ee?U:C,D,E.x,E.y)){const ae=Math.abs(D-E.y)/(C-E.x);Dh(E,v)&&(ae<ie||ae===ie&&(E.x>N.x||E.x===N.x&&t_(N,E)))&&(N=E,ie=ae)}E=E.next}while(E!==H);return N}(l,r);if(!a)return r;const p=Em(a,l);return Gc(p,p.next),Gc(a,a.next)}function t_(l,r){return br(l.prev,l,r.prev)<0&&br(r.next,l,l.next)<0}function nf(l,r,a,p,v){return(l=1431655765&((l=858993459&((l=252645135&((l=16711935&((l=(l-a)*v|0)|l<<8))|l<<4))|l<<2))|l<<1))|(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-p)*v|0)|r<<8))|r<<4))|r<<2))|r<<1))<<1}function Jd(l){let r=l,a=l;do(r.x<a.x||r.x===a.x&&r.y<a.y)&&(a=r),r=r.next;while(r!==l);return a}function ps(l,r,a,p,v,T,E,C){return(v-E)*(r-C)>=(l-E)*(T-C)&&(l-E)*(p-C)>=(a-E)*(r-C)&&(a-E)*(T-C)>=(v-E)*(p-C)}function ep(l,r,a,p,v,T,E,C){return!(l===E&&r===C)&&ps(l,r,a,p,v,T,E,C)}function wv(l,r){return l.next.i!==r.i&&l.prev.i!==r.i&&!function(a,p){let v=a;do{if(v.i!==a.i&&v.next.i!==a.i&&v.i!==p.i&&v.next.i!==p.i&&n_(v,v.next,a,p))return!0;v=v.next}while(v!==a);return!1}(l,r)&&(Dh(l,r)&&Dh(r,l)&&function(a,p){let v=a,T=!1;const E=(a.x+p.x)/2,C=(a.y+p.y)/2;do v.y>C!=v.next.y>C&&v.next.y!==v.y&&E<(v.next.x-v.x)*(C-v.y)/(v.next.y-v.y)+v.x&&(T=!T),v=v.next;while(v!==a);return T}(l,r)&&(br(l.prev,l,r.prev)||br(l,r.prev,r))||ro(l,r)&&br(l.prev,l,l.next)>0&&br(r.prev,r,r.next)>0)}function br(l,r,a){return(r.y-l.y)*(a.x-r.x)-(r.x-l.x)*(a.y-r.y)}function ro(l,r){return l.x===r.x&&l.y===r.y}function n_(l,r,a,p){const v=rc(br(l,r,a)),T=rc(br(l,r,p)),E=rc(br(a,p,l)),C=rc(br(a,p,r));return v!==T&&E!==C||!(v!==0||!un(l,a,r))||!(T!==0||!un(l,p,r))||!(E!==0||!un(a,l,p))||!(C!==0||!un(a,r,p))}function un(l,r,a){return r.x<=Math.max(l.x,a.x)&&r.x>=Math.min(l.x,a.x)&&r.y<=Math.max(l.y,a.y)&&r.y>=Math.min(l.y,a.y)}function rc(l){return l>0?1:l<0?-1:0}function Dh(l,r){return br(l.prev,l,l.next)<0?br(l,r,l.next)>=0&&br(l,l.prev,r)>=0:br(l,r,l.prev)<0||br(l,l.next,r)<0}function Em(l,r){const a=fd(l.i,l.x,l.y),p=fd(r.i,r.x,r.y),v=l.next,T=r.prev;return l.next=r,r.prev=l,a.next=v,v.prev=a,p.next=a,a.prev=p,T.next=p,p.prev=T,p}function i_(l,r,a,p){const v=fd(l,r,a);return p?(v.next=p.next,v.prev=p,p.next.prev=v,p.next=v):(v.prev=v,v.next=v),v}function oc(l){l.next.prev=l.prev,l.prev.next=l.next,l.prevZ&&(l.prevZ.nextZ=l.nextZ),l.nextZ&&(l.nextZ.prevZ=l.prevZ)}function fd(l,r,a){return{i:l,x:r,y:a,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class Zc{constructor(r,a){if(a>r)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=r,this._minGranularity=a}getGranularityForZoomLevel(r){return Math.max(Math.floor(this._baseZoomGranularity/(1<<r)),this._minGranularity,1)}}class tp{constructor(r){this.fill=r.fill,this.line=r.line,this.tile=r.tile,this.stencil=r.stencil,this.circle=r.circle}}tp.noSubdivision=new tp({fill:new Zc(0,0),line:new Zc(0,0),tile:new Zc(0,0),stencil:new Zc(0,0),circle:1}),Gt("SubdivisionGranularityExpression",Zc),Gt("SubdivisionGranularitySetting",tp);const zh=-32768,md=32767;class Im{constructor(r,a){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=r,this._granularityCellSize=dn/r,this._canonical=a}_getKey(r,a){return(r+=32768)<<16|(a+=32768)<<0}_vertexToIndex(r,a){if(r<-32768||a<-32768||r>32767||a>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const p=0|Math.round(r),v=0|Math.round(a),T=this._getKey(p,v);if(this._vertexDictionary.has(T))return this._vertexDictionary.get(T);const E=this._vertexBuffer.length/2;return this._vertexDictionary.set(T,E),this._vertexBuffer.push(p,v),E}_subdivideTrianglesScanline(r){if(this._granularity<2)return function(v,T){const E=[];for(let C=0;C<T.length;C+=3){const D=T[C],N=T[C+1],U=T[C+2],H=v[2*D],X=v[2*D+1];(v[2*N]-H)*(v[2*U+1]-X)-(v[2*N+1]-X)*(v[2*U]-H)>0?(E.push(D),E.push(U),E.push(N)):(E.push(D),E.push(N),E.push(U))}return E}(this._vertexBuffer,r);const a=[],p=r.length;for(let v=0;v<p;v+=3){const T=[r[v+0],r[v+1],r[v+2]],E=[this._vertexBuffer[2*r[v+0]+0],this._vertexBuffer[2*r[v+0]+1],this._vertexBuffer[2*r[v+1]+0],this._vertexBuffer[2*r[v+1]+1],this._vertexBuffer[2*r[v+2]+0],this._vertexBuffer[2*r[v+2]+1]];let C=1/0,D=1/0,N=-1/0,U=-1/0;for(let ae=0;ae<3;ae++){const _e=E[2*ae],Ee=E[2*ae+1];C=Math.min(C,_e),N=Math.max(N,_e),D=Math.min(D,Ee),U=Math.max(U,Ee)}if(C===N||D===U)continue;const H=Math.floor(C/this._granularityCellSize),X=Math.ceil(N/this._granularityCellSize),ee=Math.floor(D/this._granularityCellSize),ie=Math.ceil(U/this._granularityCellSize);if(H!==X||ee!==ie)for(let ae=ee;ae<ie;ae++){const _e=this._scanlineGenerateVertexRingForCellRow(ae,E,T);lu(this._vertexBuffer,_e,a)}else a.push(...T)}return a}_scanlineGenerateVertexRingForCellRow(r,a,p){const v=r*this._granularityCellSize,T=v+this._granularityCellSize,E=[];for(let C=0;C<3;C++){const D=a[2*C],N=a[2*C+1],U=a[2*(C+1)%6],H=a[(2*(C+1)+1)%6],X=a[2*(C+2)%6],ee=a[(2*(C+2)+1)%6],ie=U-D,ae=H-N,_e=ie===0,Ee=ae===0,je=(v-N)/ae,ke=(T-N)/ae,J=Math.min(je,ke),me=Math.max(je,ke);if(!Ee&&(J>=1||me<=0)||Ee&&(N<v||N>T)){H>=v&&H<=T&&E.push(p[(C+1)%3]);continue}!Ee&&J>0&&E.push(this._vertexToIndex(D+ie*J,N+ae*J));const Me=D+ie*Math.max(J,0),st=D+ie*Math.min(me,1);_e||this._generateIntraEdgeVertices(E,D,N,U,H,Me,st),!Ee&&me<1&&E.push(this._vertexToIndex(D+ie*me,N+ae*me)),(Ee||H>=v&&H<=T)&&E.push(p[(C+1)%3]),!Ee&&(H<=v||H>=T)&&this._generateInterEdgeVertices(E,D,N,U,H,X,ee,st,v,T)}return E}_generateIntraEdgeVertices(r,a,p,v,T,E,C){const D=v-a,N=T-p,U=N===0,H=U?Math.min(a,v):Math.min(E,C),X=U?Math.max(a,v):Math.max(E,C),ee=Math.floor(H/this._granularityCellSize)+1,ie=Math.ceil(X/this._granularityCellSize)-1;if(U?a<v:E<C)for(let ae=ee;ae<=ie;ae++){const _e=ae*this._granularityCellSize;r.push(this._vertexToIndex(_e,p+N*(_e-a)/D))}else for(let ae=ie;ae>=ee;ae--){const _e=ae*this._granularityCellSize;r.push(this._vertexToIndex(_e,p+N*(_e-a)/D))}}_generateInterEdgeVertices(r,a,p,v,T,E,C,D,N,U){const H=T-p,X=E-v,ee=C-T,ie=(N-T)/ee,ae=(U-T)/ee,_e=Math.min(ie,ae),Ee=Math.max(ie,ae),je=v+X*_e;let ke=Math.floor(Math.min(je,D)/this._granularityCellSize)+1,J=Math.ceil(Math.max(je,D)/this._granularityCellSize)-1,me=D<je;const Me=ee===0;if(Me&&(C===N||C===U))return;if(Me||_e>=1||Ee<=0){const Pt=p-C,ct=E+(a-E)*Math.min((N-C)/Pt,(U-C)/Pt);ke=Math.floor(Math.min(ct,D)/this._granularityCellSize)+1,J=Math.ceil(Math.max(ct,D)/this._granularityCellSize)-1,me=D<ct}const st=H>0?U:N;if(me)for(let Pt=ke;Pt<=J;Pt++)r.push(this._vertexToIndex(Pt*this._granularityCellSize,st));else for(let Pt=J;Pt>=ke;Pt--)r.push(this._vertexToIndex(Pt*this._granularityCellSize,st))}_generateOutline(r){const a=[];for(const p of r){const v=Br(p,this._granularity,!0),T=this._pointArrayToIndices(v),E=[];for(let C=1;C<T.length;C++)E.push(T[C-1]),E.push(T[C]);a.push(E)}return a}_handlePoles(r){let a=!1,p=!1;this._canonical&&(this._canonical.y===0&&(a=!0),this._canonical.y===(1<<this._canonical.z)-1&&(p=!0)),(a||p)&&this._fillPoles(r,a,p)}_ensureNoPoleVertices(){const r=this._vertexBuffer;for(let a=0;a<r.length;a+=2){const p=r[a+1];p===zh&&(r[a+1]=-32767),p===md&&(r[a+1]=32766)}}_generatePoleQuad(r,a,p,v,T,E){v>T!=(E===zh)?(r.push(a),r.push(p),r.push(this._vertexToIndex(v,E)),r.push(p),r.push(this._vertexToIndex(T,E)),r.push(this._vertexToIndex(v,E))):(r.push(p),r.push(a),r.push(this._vertexToIndex(v,E)),r.push(this._vertexToIndex(T,E)),r.push(p),r.push(this._vertexToIndex(v,E)))}_fillPoles(r,a,p){const v=this._vertexBuffer,T=dn,E=r.length;for(let C=2;C<E;C+=3){const D=r[C-2],N=r[C-1],U=r[C],H=v[2*D],X=v[2*D+1],ee=v[2*N],ie=v[2*N+1],ae=v[2*U],_e=v[2*U+1];a&&(X===0&&ie===0&&this._generatePoleQuad(r,D,N,H,ee,zh),ie===0&&_e===0&&this._generatePoleQuad(r,N,U,ee,ae,zh),_e===0&&X===0&&this._generatePoleQuad(r,U,D,ae,H,zh)),p&&(X===T&&ie===T&&this._generatePoleQuad(r,D,N,H,ee,md),ie===T&&_e===T&&this._generatePoleQuad(r,N,U,ee,ae,md),_e===T&&X===T&&this._generatePoleQuad(r,U,D,ae,H,md))}}_initializeVertices(r){for(let a=0;a<r.length;a+=2)this._vertexToIndex(r[a],r[a+1])}subdividePolygonInternal(r,a){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:p,holeIndices:v}=function(C){const D=[],N=[];for(const U of C)if(U.length!==0){U!==C[0]&&D.push(N.length/2);for(let H=0;H<U.length;H++)N.push(U[H].x),N.push(U[H].y)}return{flattened:N,holeIndices:D}}(r);let T;this._initializeVertices(p);try{const C=function(N,U,H=2){const X=U&&U.length,ee=X?U[0]*H:N.length;let ie=Qg(N,0,ee,H,!0);const ae=[];if(!ie||ie.next===ie.prev)return ae;let _e,Ee,je;if(X&&(ie=function(ke,J,me,Me){const st=[];for(let Pt=0,ct=J.length;Pt<ct;Pt++){const _t=Qg(ke,J[Pt]*Me,Pt<ct-1?J[Pt+1]*Me:ke.length,Me,!1);_t===_t.next&&(_t.steiner=!0),st.push(Jd(_t))}st.sort(e_);for(let Pt=0;Pt<st.length;Pt++)me=Sm(st[Pt],me);return me}(N,U,ie,H)),N.length>80*H){_e=1/0,Ee=1/0;let ke=-1/0,J=-1/0;for(let me=H;me<ee;me+=H){const Me=N[me],st=N[me+1];Me<_e&&(_e=Me),st<Ee&&(Ee=st),Me>ke&&(ke=Me),st>J&&(J=st)}je=Math.max(ke-_e,J-Ee),je=je!==0?32767/je:0}return Lh(ie,ae,H,_e,Ee,je,0),ae}(p,v),D=this._convertIndices(p,C);T=this._subdivideTrianglesScanline(D)}catch(C){console.error(C)}let E=[];return a&&(E=this._generateOutline(r)),this._ensureNoPoleVertices(),this._handlePoles(T),{verticesFlattened:this._vertexBuffer,indicesTriangles:T,indicesLineList:E}}_convertIndices(r,a){const p=[];for(let v=0;v<a.length;v++)p.push(this._vertexToIndex(r[2*a[v]],r[2*a[v]+1]));return p}_pointArrayToIndices(r){const a=[];for(let p=0;p<r.length;p++){const v=r[p];a.push(this._vertexToIndex(v.x,v.y))}return a}}function rf(l,r,a,p=!0){return new Im(a,r).subdividePolygonInternal(l,p)}function Br(l,r,a=!1){if(!l||l.length<1)return[];if(l.length<2)return[];const p=l[0],v=l[l.length-1],T=a&&(p.x!==v.x||p.y!==v.y);if(r<2)return T?[...l,l[0]]:[...l];const E=Math.floor(dn/r),C=[];C.push(new de(l[0].x,l[0].y));const D=l.length,N=T?D:D-1;for(let U=0;U<N;U++){const H=l[U],X=U<D-1?l[U+1]:l[0],ee=H.x,ie=H.y,ae=X.x,_e=X.y,Ee=ee!==ae,je=ie!==_e;if(!Ee&&!je)continue;const ke=ae-ee,J=_e-ie,me=Math.abs(ke),Me=Math.abs(J);let st=ee,Pt=ie;for(;;){const _t=ke>0?(Math.floor(st/E)+1)*E:(Math.ceil(st/E)-1)*E,Dt=J>0?(Math.floor(Pt/E)+1)*E:(Math.ceil(Pt/E)-1)*E,Ct=Math.abs(st-_t),Ft=Math.abs(Pt-Dt),bt=Math.abs(st-ae),on=Math.abs(Pt-_e),Cn=Ee?Ct/me:Number.POSITIVE_INFINITY,Tn=je?Ft/Me:Number.POSITIVE_INFINITY;if((bt<=Ct||!Ee)&&(on<=Ft||!je))break;if(Cn<Tn&&Ee||!je){st=_t,Pt+=J*Cn;const cn=new de(st,Math.round(Pt));C[C.length-1].x===cn.x&&C[C.length-1].y===cn.y||C.push(cn)}else{st+=ke*Tn,Pt=Dt;const cn=new de(Math.round(st),Pt);C[C.length-1].x===cn.x&&C[C.length-1].y===cn.y||C.push(cn)}}const ct=new de(ae,_e);C[C.length-1].x===ct.x&&C[C.length-1].y===ct.y||C.push(ct)}return C}function lu(l,r,a){if(r.length===0)throw new Error("Subdivision vertex ring is empty.");let p=0,v=l[2*r[0]];for(let D=1;D<r.length;D++){const N=l[2*r[D]];N<v&&(v=N,p=D)}const T=r.length;let E=p,C=(E+1)%T;for(;;){const D=E-1>=0?E-1:T-1,N=(C+1)%T,U=l[2*r[D]],H=l[2*r[N]],X=l[2*r[E]],ee=l[2*r[E]+1],ie=l[2*r[C]+1];let ae=!1;if(U<H)ae=!0;else if(U>H)ae=!1;else{const _e=ie-ee,Ee=-(l[2*r[C]]-X),je=ee<ie?1:-1;((U-X)*_e+(l[2*r[D]+1]-ee)*Ee)*je>((H-X)*_e+(l[2*r[N]+1]-ee)*Ee)*je&&(ae=!0)}if(ae){const _e=r[D],Ee=r[E],je=r[C];_e!==Ee&&_e!==je&&Ee!==je&&a.push(je,Ee,_e),E--,E<0&&(E=T-1)}else{const _e=r[N],Ee=r[E],je=r[C];_e!==Ee&&_e!==je&&Ee!==je&&a.push(je,Ee,_e),C++,C>=T&&(C=0)}if(D===N)break}}function sc(l,r,a,p,v,T,E,C,D){const N=v.length/2,U=E&&C&&D;if(N<Ht.MAX_VERTEX_ARRAY_LENGTH){const H=r.prepareSegment(N,a,p),X=H.vertexLength;for(let ae=0;ae<T.length;ae+=3)p.emplaceBack(X+T[ae],X+T[ae+1],X+T[ae+2]);let ee,ie;H.vertexLength+=N,H.primitiveLength+=T.length/3,U&&(ie=E.prepareSegment(N,a,C),ee=ie.vertexLength,ie.vertexLength+=N);for(let ae=0;ae<v.length;ae+=2)l(v[ae],v[ae+1]);if(U)for(let ae=0;ae<D.length;ae++){const _e=D[ae];for(let Ee=1;Ee<_e.length;Ee+=2)C.emplaceBack(ee+_e[Ee-1],ee+_e[Ee]);ie.primitiveLength+=_e.length/2}}else(function(H,X,ee,ie,ae,_e){const Ee=[];for(let Me=0;Me<ie.length/2;Me++)Ee.push(-1);const je={count:0};let ke=0,J=H.getOrCreateLatestSegment(X,ee),me=J.vertexLength;for(let Me=2;Me<ae.length;Me+=3){const st=ae[Me-2],Pt=ae[Me-1],ct=ae[Me];let _t=Ee[st]<ke,Dt=Ee[Pt]<ke,Ct=Ee[ct]<ke;J.vertexLength+((_t?1:0)+(Dt?1:0)+(Ct?1:0))>Ht.MAX_VERTEX_ARRAY_LENGTH&&(J=H.createNewSegment(X,ee),ke=je.count,_t=!0,Dt=!0,Ct=!0,me=0);const Ft=gd(Ee,ie,_e,je,st,_t,J),bt=gd(Ee,ie,_e,je,Pt,Dt,J),on=gd(Ee,ie,_e,je,ct,Ct,J);ee.emplaceBack(me+Ft-ke,me+bt-ke,me+on-ke),J.primitiveLength++}})(r,a,p,v,T,l),U&&function(H,X,ee,ie,ae,_e){const Ee=[];for(let Me=0;Me<ie.length/2;Me++)Ee.push(-1);const je={count:0};let ke=0,J=H.getOrCreateLatestSegment(X,ee),me=J.vertexLength;for(let Me=0;Me<ae.length;Me++){const st=ae[Me];for(let Pt=1;Pt<ae[Me].length;Pt+=2){const ct=st[Pt-1],_t=st[Pt];let Dt=Ee[ct]<ke,Ct=Ee[_t]<ke;J.vertexLength+((Dt?1:0)+(Ct?1:0))>Ht.MAX_VERTEX_ARRAY_LENGTH&&(J=H.createNewSegment(X,ee),ke=je.count,Dt=!0,Ct=!0,me=0);const Ft=gd(Ee,ie,_e,je,ct,Dt,J),bt=gd(Ee,ie,_e,je,_t,Ct,J);ee.emplaceBack(me+Ft-ke,me+bt-ke),J.primitiveLength++}}}(E,a,C,v,D,l),r.forceNewSegmentOnNextPrepare(),E?.forceNewSegmentOnNextPrepare()}function gd(l,r,a,p,v,T,E){if(T){const C=p.count;return a(r[2*v],r[2*v+1]),l[v]=p.count,p.count++,E.vertexLength++,C}return l[v]}class of{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(a=>a.id),this.index=r.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Ie,this.indexArray=new pt,this.indexArray2=new Ut,this.programConfigurations=new yr(r.layers,r.zoom),this.segments=new Ht,this.segments2=new Ht,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id)}populate(r,a,p){this.hasPattern=Qd("fill",this.layers,a);const v=this.layers[0].layout.get("fill-sort-key"),T=!v.isConstant(),E=[];for(const{feature:C,id:D,index:N,sourceLayerIndex:U}of r){const H=this.layers[0]._featureFilter.needGeometry,X=Du(C,H);if(!this.layers[0]._featureFilter.filter(new bi(this.zoom),X,p))continue;const ee=T?v.evaluate(X,{},p,a.availableImages):void 0,ie={id:D,properties:C.properties,type:C.type,sourceLayerIndex:U,index:N,geometry:H?X.geometry:tc(C),patterns:{},sortKey:ee};E.push(ie)}T&&E.sort((C,D)=>C.sortKey-D.sortKey);for(const C of E){const{geometry:D,index:N,sourceLayerIndex:U}=C;if(this.hasPattern){const H=pd("fill",this.layers,C,this.zoom,a);this.patternFeatures.push(H)}else this.addFeature(C,D,N,p,{},a.subdivisionGranularity);a.featureIndex.insert(r[N].feature,D,N,U,this.index)}}update(r,a,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,a,this.stateDependentLayers,p)}addFeatures(r,a,p){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,a,p,r.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,Yg),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.indexBuffer2=r.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(r,a,p,v,T,E){for(const C of wi(a,500)){const D=rf(C,v,E.fill.getGranularityForZoomLevel(v.z)),N=this.layoutVertexArray;sc((U,H)=>{N.emplaceBack(U,H)},this.segments,this.layoutVertexArray,this.indexArray,D.verticesFlattened,D.indicesTriangles,this.segments2,this.indexArray2,D.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,p,T,v)}}let Rl,Pm;Gt("FillBucket",of,{omit:["layers","patternFeatures"]});var zu={get paint(){return Pm=Pm||new ds({"fill-antialias":new rn(ve.paint_fill["fill-antialias"]),"fill-opacity":new En(ve.paint_fill["fill-opacity"]),"fill-color":new En(ve.paint_fill["fill-color"]),"fill-outline-color":new En(ve.paint_fill["fill-outline-color"]),"fill-translate":new rn(ve.paint_fill["fill-translate"]),"fill-translate-anchor":new rn(ve.paint_fill["fill-translate-anchor"]),"fill-pattern":new Fc(ve.paint_fill["fill-pattern"])})},get layout(){return Rl=Rl||new ds({"fill-sort-key":new En(ve.layout_fill["fill-sort-key"])})}};class bv extends tl{constructor(r){super(r,zu)}recalculate(r,a){super.recalculate(r,a);const p=this.paint._values["fill-outline-color"];p.value.kind==="constant"&&p.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(r){return new of(r)}queryRadius(){return hd(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:r,geometry:a,transform:p,pixelsToTileUnits:v}){return Xd(Xp(r,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-p.bearingInRadians,v),a)}isTileClipped(){return!0}}const r_=_r([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),o_=_r([{name:"a_centroid",components:2,type:"Int16"}],4),{members:s_}=r_;var sf,a_,_d,af,Na,Ci,Mo,Vr={};function qo(){if(a_)return sf;a_=1;var l=ne();function r(v,T,E,C,D){this.properties={},this.extent=E,this.type=0,this._pbf=v,this._geometry=-1,this._keys=C,this._values=D,v.readFields(a,this,T)}function a(v,T,E){v==1?T.id=E.readVarint():v==2?function(C,D){for(var N=C.readVarint()+C.pos;C.pos<N;){var U=D._keys[C.readVarint()],H=D._values[C.readVarint()];D.properties[U]=H}}(E,T):v==3?T.type=E.readVarint():v==4&&(T._geometry=E.pos)}function p(v){for(var T,E,C=0,D=0,N=v.length,U=N-1;D<N;U=D++)C+=((E=v[U]).x-(T=v[D]).x)*(T.y+E.y);return C}return sf=r,r.types=["Unknown","Point","LineString","Polygon"],r.prototype.loadGeometry=function(){var v=this._pbf;v.pos=this._geometry;for(var T,E=v.readVarint()+v.pos,C=1,D=0,N=0,U=0,H=[];v.pos<E;){if(D<=0){var X=v.readVarint();C=7&X,D=X>>3}if(D--,C===1||C===2)N+=v.readSVarint(),U+=v.readSVarint(),C===1&&(T&&H.push(T),T=[]),T.push(new l(N,U));else{if(C!==7)throw new Error("unknown command "+C);T&&T.push(T[0].clone())}}return T&&H.push(T),H},r.prototype.bbox=function(){var v=this._pbf;v.pos=this._geometry;for(var T=v.readVarint()+v.pos,E=1,C=0,D=0,N=0,U=1/0,H=-1/0,X=1/0,ee=-1/0;v.pos<T;){if(C<=0){var ie=v.readVarint();E=7&ie,C=ie>>3}if(C--,E===1||E===2)(D+=v.readSVarint())<U&&(U=D),D>H&&(H=D),(N+=v.readSVarint())<X&&(X=N),N>ee&&(ee=N);else if(E!==7)throw new Error("unknown command "+E)}return[U,X,H,ee]},r.prototype.toGeoJSON=function(v,T,E){var C,D,N=this.extent*Math.pow(2,E),U=this.extent*v,H=this.extent*T,X=this.loadGeometry(),ee=r.types[this.type];function ie(Ee){for(var je=0;je<Ee.length;je++){var ke=Ee[je];Ee[je]=[360*(ke.x+U)/N-180,360/Math.PI*Math.atan(Math.exp((180-360*(ke.y+H)/N)*Math.PI/180))-90]}}switch(this.type){case 1:var ae=[];for(C=0;C<X.length;C++)ae[C]=X[C][0];ie(X=ae);break;case 2:for(C=0;C<X.length;C++)ie(X[C]);break;case 3:for(X=function(Ee){var je=Ee.length;if(je<=1)return[Ee];for(var ke,J,me=[],Me=0;Me<je;Me++){var st=p(Ee[Me]);st!==0&&(J===void 0&&(J=st<0),J===st<0?(ke&&me.push(ke),ke=[Ee[Me]]):ke.push(Ee[Me]))}return ke&&me.push(ke),me}(X),C=0;C<X.length;C++)for(D=0;D<X[C].length;D++)ie(X[C][D])}X.length===1?X=X[0]:ee="Multi"+ee;var _e={type:"Feature",geometry:{type:ee,coordinates:X},properties:this.properties};return"id"in this&&(_e.id=this.id),_e},sf}function Oa(){if(af)return _d;af=1;var l=qo();function r(p,v){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=p,this._keys=[],this._values=[],this._features=[],p.readFields(a,this,v),this.length=this._features.length}function a(p,v,T){p===15?v.version=T.readVarint():p===1?v.name=T.readString():p===5?v.extent=T.readVarint():p===2?v._features.push(T.pos):p===3?v._keys.push(T.readString()):p===4&&v._values.push(function(E){for(var C=null,D=E.readVarint()+E.pos;E.pos<D;){var N=E.readVarint()>>3;C=N===1?E.readString():N===2?E.readFloat():N===3?E.readDouble():N===4?E.readVarint64():N===5?E.readVarint():N===6?E.readSVarint():N===7?E.readBoolean():null}return C}(T))}return _d=r,r.prototype.feature=function(p){if(p<0||p>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[p];var v=this._pbf.readVarint()+this._pbf.pos;return new l(this._pbf,v,this.extent,this._keys,this._values)},_d}function Nh(){return Mo||(Mo=1,Vr.VectorTile=function(){if(Ci)return Na;Ci=1;var l=Oa();function r(a,p,v){if(a===3){var T=new l(v,v.readVarint()+v.pos);T.length&&(p[T.name]=T)}}return Na=function(a,p){this.layers=a.readFields(r,{},p)},Na}(),Vr.VectorTileFeature=qo(),Vr.VectorTileLayer=Oa()),Vr}var Ur=R(Nh());const np=Ur.VectorTileFeature.types,ac=Math.pow(2,13);function Wc(l,r,a,p,v,T,E,C){l.emplaceBack(r,a,2*Math.floor(p*ac)+E,v*ac*2,T*ac*2,Math.round(C))}class ip{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(a=>a.id),this.index=r.index,this.hasPattern=!1,this.layoutVertexArray=new Re,this.centroidVertexArray=new ge,this.indexArray=new pt,this.programConfigurations=new yr(r.layers,r.zoom),this.segments=new Ht,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id)}populate(r,a,p){this.features=[],this.hasPattern=Qd("fill-extrusion",this.layers,a);for(const{feature:v,id:T,index:E,sourceLayerIndex:C}of r){const D=this.layers[0]._featureFilter.needGeometry,N=Du(v,D);if(!this.layers[0]._featureFilter.filter(new bi(this.zoom),N,p))continue;const U={id:T,sourceLayerIndex:C,index:E,geometry:D?N.geometry:tc(v),properties:v.properties,type:v.type,patterns:{}};this.hasPattern?this.features.push(pd("fill-extrusion",this.layers,U,this.zoom,a)):this.addFeature(U,U.geometry,E,p,{},a.subdivisionGranularity),a.featureIndex.insert(v,U.geometry,E,C,this.index,!0)}}addFeatures(r,a,p){for(const v of this.features){const{geometry:T}=v;this.addFeature(v,T,v.index,a,p,r.subdivisionGranularity)}}update(r,a,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,a,this.stateDependentLayers,p)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,s_),this.centroidVertexBuffer=r.createVertexBuffer(this.centroidVertexArray,o_.members,!0),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(r,a,p,v,T,E){for(const C of wi(a,500)){const D={x:0,y:0,sampleCount:0},N=this.layoutVertexArray.length;this.processPolygon(D,v,r,C,E);const U=this.layoutVertexArray.length-N,H=Math.floor(D.x/D.sampleCount),X=Math.floor(D.y/D.sampleCount);for(let ee=0;ee<U;ee++)this.centroidVertexArray.emplaceBack(H,X)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,p,T,v)}processPolygon(r,a,p,v,T){if(v.length<1||lf(v[0]))return;for(const H of v)H.length!==0&&rp(r,H);const E={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},C=T.fill.getGranularityForZoomLevel(a.z),D=np[p.type]==="Polygon";for(const H of v){if(H.length===0||lf(H))continue;const X=Br(H,C,D);this._generateSideFaces(X,E)}if(!D)return;const N=rf(v,a,C,!1),U=this.layoutVertexArray;sc((H,X)=>{Wc(U,H,X,0,0,1,1,0)},this.segments,this.layoutVertexArray,this.indexArray,N.verticesFlattened,N.indicesTriangles)}_generateSideFaces(r,a){let p=0;for(let v=1;v<r.length;v++){const T=r[v],E=r[v-1];if(Fa(T,E))continue;a.segment.vertexLength+4>Ht.MAX_VERTEX_ARRAY_LENGTH&&(a.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const C=T.sub(E)._perp()._unit(),D=E.dist(T);p+D>32768&&(p=0),Wc(this.layoutVertexArray,T.x,T.y,C.x,C.y,0,0,p),Wc(this.layoutVertexArray,T.x,T.y,C.x,C.y,0,1,p),p+=D,Wc(this.layoutVertexArray,E.x,E.y,C.x,C.y,0,0,p),Wc(this.layoutVertexArray,E.x,E.y,C.x,C.y,0,1,p);const N=a.segment.vertexLength;this.indexArray.emplaceBack(N,N+2,N+1),this.indexArray.emplaceBack(N+1,N+2,N+3),a.segment.vertexLength+=4,a.segment.primitiveLength+=2}}}function rp(l,r){for(let a=0;a<r.length;a++){const p=r[a];a===r.length-1&&r[0].x===p.x&&r[0].y===p.y||(l.x+=p.x,l.y+=p.y,l.sampleCount++)}}function Fa(l,r){return l.x===r.x&&(l.x<0||l.x>dn)||l.y===r.y&&(l.y<0||l.y>dn)}function lf(l){return l.every(r=>r.x<0)||l.every(r=>r.x>dn)||l.every(r=>r.y<0)||l.every(r=>r.y>dn)}let Oh;Gt("FillExtrusionBucket",ip,{omit:["layers","features"]});var lc={get paint(){return Oh=Oh||new ds({"fill-extrusion-opacity":new rn(ve["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new En(ve["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new rn(ve["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new rn(ve["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Fc(ve["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new En(ve["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new En(ve["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new rn(ve["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class uf extends tl{constructor(r){super(r,lc)}createBucket(r){return new ip(r)}queryRadius(){return hd(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:r,feature:a,featureState:p,geometry:v,transform:T,pixelsToTileUnits:E,pixelPosMatrix:C}){const D=Xp(r,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-T.bearingInRadians,E),N=this.paint.get("fill-extrusion-height").evaluate(a,p),U=this.paint.get("fill-extrusion-base").evaluate(a,p),H=function(ee,ie,ae){const _e=[];for(const Ee of ee){const je=[Ee.x,Ee.y,0,1];$e(je,je,ie),_e.push(new de(je[0]/je[3],je[1]/je[3]))}return _e}(D,C),X=function(ee,ie,ae,_e){const Ee=[],je=[],ke=_e[8]*ie,J=_e[9]*ie,me=_e[10]*ie,Me=_e[11]*ie,st=_e[8]*ae,Pt=_e[9]*ae,ct=_e[10]*ae,_t=_e[11]*ae;for(const Dt of ee){const Ct=[],Ft=[];for(const bt of Dt){const on=bt.x,Cn=bt.y,Tn=_e[0]*on+_e[4]*Cn+_e[12],cn=_e[1]*on+_e[5]*Cn+_e[13],di=_e[2]*on+_e[6]*Cn+_e[14],jr=_e[3]*on+_e[7]*Cn+_e[15],Lo=di+me,Us=jr+Me,hu=Tn+st,ol=cn+Pt,ms=di+ct,Dr=jr+_t,Go=new de((Tn+ke)/Us,(cn+J)/Us);Go.z=Lo/Us,Ct.push(Go);const gs=new de(hu/Dr,ol/Dr);gs.z=ms/Dr,Ft.push(gs)}Ee.push(Ct),je.push(Ft)}return[Ee,je]}(v,U,N,C);return function(ee,ie,ae){let _e=1/0;Xd(ae,ie)&&(_e=uc(ae,ie[0]));for(let Ee=0;Ee<ie.length;Ee++){const je=ie[Ee],ke=ee[Ee];for(let J=0;J<je.length-1;J++){const me=je[J],Me=[me,je[J+1],ke[J+1],ke[J],me];Wd(ae,Me)&&(_e=Math.min(_e,uc(ae,Me)))}}return _e!==1/0&&_e}(X[0],X[1],H)}}function Fh(l,r){return l.x*r.x+l.y*r.y}function uc(l,r){if(l.length===1){let a=0;const p=r[a++];let v;for(;!v||p.equals(v);)if(v=r[a++],!v)return 1/0;for(;a<r.length;a++){const T=r[a],E=l[0],C=v.sub(p),D=T.sub(p),N=E.sub(p),U=Fh(C,C),H=Fh(C,D),X=Fh(D,D),ee=Fh(N,C),ie=Fh(N,D),ae=U*X-H*H,_e=(X*ee-H*ie)/ae,Ee=(U*ie-H*ee)/ae,je=p.z*(1-_e-Ee)+v.z*_e+T.z*Ee;if(isFinite(je))return je}return 1/0}{let a=1/0;for(const p of r)a=Math.min(a,p.z);return a}}const cf=_r([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Kc}=cf,hf=_r([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:op}=hf,Cm=Ur.VectorTileFeature.types,df=Math.cos(Math.PI/180*37.5),sp=Math.pow(2,14)/.5;class fs{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(a=>a.id),this.index=r.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(a=>{this.gradients[a.id]={}}),this.layoutVertexArray=new ze,this.layoutVertexArray2=new Fe,this.indexArray=new pt,this.programConfigurations=new yr(r.layers,r.zoom),this.segments=new Ht,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id)}populate(r,a,p){this.hasPattern=Qd("line",this.layers,a);const v=this.layers[0].layout.get("line-sort-key"),T=!v.isConstant(),E=[];for(const{feature:C,id:D,index:N,sourceLayerIndex:U}of r){const H=this.layers[0]._featureFilter.needGeometry,X=Du(C,H);if(!this.layers[0]._featureFilter.filter(new bi(this.zoom),X,p))continue;const ee=T?v.evaluate(X,{},p):void 0,ie={id:D,properties:C.properties,type:C.type,sourceLayerIndex:U,index:N,geometry:H?X.geometry:tc(C),patterns:{},sortKey:ee};E.push(ie)}T&&E.sort((C,D)=>C.sortKey-D.sortKey);for(const C of E){const{geometry:D,index:N,sourceLayerIndex:U}=C;if(this.hasPattern){const H=pd("line",this.layers,C,this.zoom,a);this.patternFeatures.push(H)}else this.addFeature(C,D,N,p,{},a.subdivisionGranularity);a.featureIndex.insert(r[N].feature,D,N,U,this.index)}}update(r,a,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,a,this.stateDependentLayers,p)}addFeatures(r,a,p){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,a,p,r.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=r.createVertexBuffer(this.layoutVertexArray2,op)),this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,Kc),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(r){if(r.properties&&Object.prototype.hasOwnProperty.call(r.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(r.properties,"mapbox_clip_end"))return{start:+r.properties.mapbox_clip_start,end:+r.properties.mapbox_clip_end}}addFeature(r,a,p,v,T,E){const C=this.layers[0].layout,D=C.get("line-join").evaluate(r,{}),N=C.get("line-cap"),U=C.get("line-miter-limit"),H=C.get("line-round-limit");this.lineClips=this.lineFeatureClips(r);for(const X of a)this.addLine(X,r,D,N,U,H,v,E);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,p,T,v)}addLine(r,a,p,v,T,E,C,D){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,r=Br(r,C?D.line.getGranularityForZoomLevel(C.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ke=0;ke<r.length-1;ke++)this.totalDistance+=r[ke].dist(r[ke+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const N=Cm[a.type]==="Polygon";let U=r.length;for(;U>=2&&r[U-1].equals(r[U-2]);)U--;let H=0;for(;H<U-1&&r[H].equals(r[H+1]);)H++;if(U<(N?3:2))return;p==="bevel"&&(T=1.05);const X=this.overscaling<=16?15*dn/(512*this.overscaling):0,ee=this.segments.prepareSegment(10*U,this.layoutVertexArray,this.indexArray);let ie,ae,_e,Ee,je;this.e1=this.e2=-1,N&&(ie=r[U-2],je=r[H].sub(ie)._unit()._perp());for(let ke=H;ke<U;ke++){if(_e=ke===U-1?N?r[H+1]:void 0:r[ke+1],_e&&r[ke].equals(_e))continue;je&&(Ee=je),ie&&(ae=ie),ie=r[ke],je=_e?_e.sub(ie)._unit()._perp():Ee,Ee=Ee||je;let J=Ee.add(je);J.x===0&&J.y===0||J._unit();const me=Ee.x*je.x+Ee.y*je.y,Me=J.x*je.x+J.y*je.y,st=Me!==0?1/Me:1/0,Pt=2*Math.sqrt(2-2*Me),ct=Me<df&&ae&&_e,_t=Ee.x*je.y-Ee.y*je.x>0;if(ct&&ke>H){const Ft=ie.dist(ae);if(Ft>2*X){const bt=ie.sub(ie.sub(ae)._mult(X/Ft)._round());this.updateDistance(ae,bt),this.addCurrentVertex(bt,Ee,0,0,ee),ae=bt}}const Dt=ae&&_e;let Ct=Dt?p:N?"butt":v;if(Dt&&Ct==="round"&&(st<E?Ct="miter":st<=2&&(Ct="fakeround")),Ct==="miter"&&st>T&&(Ct="bevel"),Ct==="bevel"&&(st>2&&(Ct="flipbevel"),st<T&&(Ct="miter")),ae&&this.updateDistance(ae,ie),Ct==="miter")J._mult(st),this.addCurrentVertex(ie,J,0,0,ee);else if(Ct==="flipbevel"){if(st>100)J=je.mult(-1);else{const Ft=st*Ee.add(je).mag()/Ee.sub(je).mag();J._perp()._mult(Ft*(_t?-1:1))}this.addCurrentVertex(ie,J,0,0,ee),this.addCurrentVertex(ie,J.mult(-1),0,0,ee)}else if(Ct==="bevel"||Ct==="fakeround"){const Ft=-Math.sqrt(st*st-1),bt=_t?Ft:0,on=_t?0:Ft;if(ae&&this.addCurrentVertex(ie,Ee,bt,on,ee),Ct==="fakeround"){const Cn=Math.round(180*Pt/Math.PI/20);for(let Tn=1;Tn<Cn;Tn++){let cn=Tn/Cn;if(cn!==.5){const jr=cn-.5;cn+=cn*jr*(cn-1)*((1.0904+me*(me*(3.55645-1.43519*me)-3.2452))*jr*jr+(.848013+me*(.215638*me-1.06021)))}const di=je.sub(Ee)._mult(cn)._add(Ee)._unit()._mult(_t?-1:1);this.addHalfVertex(ie,di.x,di.y,!1,_t,0,ee)}}_e&&this.addCurrentVertex(ie,je,-bt,-on,ee)}else if(Ct==="butt")this.addCurrentVertex(ie,J,0,0,ee);else if(Ct==="square"){const Ft=ae?1:-1;this.addCurrentVertex(ie,J,Ft,Ft,ee)}else Ct==="round"&&(ae&&(this.addCurrentVertex(ie,Ee,0,0,ee),this.addCurrentVertex(ie,Ee,1,1,ee,!0)),_e&&(this.addCurrentVertex(ie,je,-1,-1,ee,!0),this.addCurrentVertex(ie,je,0,0,ee)));if(ct&&ke<U-1){const Ft=ie.dist(_e);if(Ft>2*X){const bt=ie.add(_e.sub(ie)._mult(X/Ft)._round());this.updateDistance(ie,bt),this.addCurrentVertex(bt,je,0,0,ee),ie=bt}}}}addCurrentVertex(r,a,p,v,T,E=!1){const C=a.y*v-a.x,D=-a.y-a.x*v;this.addHalfVertex(r,a.x+a.y*p,a.y-a.x*p,E,!1,p,T),this.addHalfVertex(r,C,D,E,!0,-v,T),this.distance>sp/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(r,a,p,v,T,E))}addHalfVertex({x:r,y:a},p,v,T,E,C,D){const N=.5*(this.lineClips?this.scaledDistance*(sp-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((r<<1)+(T?1:0),(a<<1)+(E?1:0),Math.round(63*p)+128,Math.round(63*v)+128,1+(C===0?0:C<0?-1:1)|(63&N)<<2,N>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const U=D.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,U,this.e2),D.primitiveLength++),E?this.e2=U:this.e1=U}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(r,a){this.distance+=r.dist(a),this.updateScaledDistance()}}let cc,Ll;Gt("LineBucket",fs,{omit:["layers","patternFeatures"]});var ua={get paint(){return Ll=Ll||new ds({"line-opacity":new En(ve.paint_line["line-opacity"]),"line-color":new En(ve.paint_line["line-color"]),"line-translate":new rn(ve.paint_line["line-translate"]),"line-translate-anchor":new rn(ve.paint_line["line-translate-anchor"]),"line-width":new En(ve.paint_line["line-width"]),"line-gap-width":new En(ve.paint_line["line-gap-width"]),"line-offset":new En(ve.paint_line["line-offset"]),"line-blur":new En(ve.paint_line["line-blur"]),"line-dasharray":new Bc(ve.paint_line["line-dasharray"]),"line-pattern":new Fc(ve.paint_line["line-pattern"]),"line-gradient":new Vc(ve.paint_line["line-gradient"])})},get layout(){return cc=cc||new ds({"line-cap":new rn(ve.layout_line["line-cap"]),"line-join":new En(ve.layout_line["line-join"]),"line-miter-limit":new rn(ve.layout_line["line-miter-limit"]),"line-round-limit":new rn(ve.layout_line["line-round-limit"]),"line-sort-key":new En(ve.layout_line["line-sort-key"])})}};class l_ extends En{possiblyEvaluate(r,a){return a=new bi(Math.floor(a.zoom),{now:a.now,fadeDuration:a.fadeDuration,zoomHistory:a.zoomHistory,transition:a.transition}),super.possiblyEvaluate(r,a)}evaluate(r,a,p,v){return a=Xt({},a,{zoom:Math.floor(a.zoom)}),super.evaluate(r,a,p,v)}}let yd;class Am extends tl{constructor(r){super(r,ua),this.gradientVersion=0,yd||(yd=new l_(ua.paint.properties["line-width"].specification),yd.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(r){if(r==="line-gradient"){const a=this.gradientExpression();this.stepInterpolant=!!function(p){return p._styleExpression!==void 0}(a)&&a._styleExpression.expression instanceof Ta,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(r,a){super.recalculate(r,a),this.paint._values["line-floorwidth"]=yd.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,r)}createBucket(r){return new fs(r)}queryRadius(r){const a=r,p=u_(Rh("line-width",this,a),Rh("line-gap-width",this,a)),v=Rh("line-offset",this,a);return p/2+Math.abs(v)+hd(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:r,feature:a,featureState:p,geometry:v,transform:T,pixelsToTileUnits:E}){const C=Xp(r,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-T.bearingInRadians,E),D=E/2*u_(this.paint.get("line-width").evaluate(a,p),this.paint.get("line-gap-width").evaluate(a,p)),N=this.paint.get("line-offset").evaluate(a,p);return N&&(v=function(U,H){const X=[];for(let ee=0;ee<U.length;ee++){const ie=U[ee],ae=[];for(let _e=0;_e<ie.length;_e++){const Ee=ie[_e-1],je=ie[_e],ke=ie[_e+1],J=_e===0?new de(0,0):je.sub(Ee)._unit()._perp(),me=_e===ie.length-1?new de(0,0):ke.sub(je)._unit()._perp(),Me=J._add(me)._unit(),st=Me.x*me.x+Me.y*me.y;st!==0&&Me._mult(1/st),ae.push(Me._mult(H)._add(je))}X.push(ae)}return X}(v,N*E)),function(U,H,X){for(let ee=0;ee<H.length;ee++){const ie=H[ee];if(U.length>=3){for(let ae=0;ae<ie.length;ae++)if(qc(U,ie[ae]))return!0}if(sa(U,ie,X))return!0}return!1}(C,v,D)}isTileClipped(){return!0}}function u_(l,r){return r>0?r+2*l:l}const Xc=_r([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),c_=_r([{name:"a_projected_pos",components:3,type:"Float32"}],4);_r([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const km=_r([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);_r([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Yc=_r([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Mm=_r([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Bh(l,r,a){return l.sections.forEach(p=>{p.text=function(v,T,E){const C=T.layout.get("text-transform").evaluate(E,{});return C==="uppercase"?v=v.toLocaleUpperCase():C==="lowercase"&&(v=v.toLocaleLowerCase()),hs.applyArabicShaping&&(v=hs.applyArabicShaping(v)),v}(p.text,r,a)}),l}_r([{name:"triangle",components:3,type:"Uint16"}]),_r([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),_r([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),_r([{type:"Float32",name:"offsetX"}]),_r([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),_r([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const vd={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var Rm,ap,lp,oo=24,Lm={};function h_(){return Rm||(Rm=1,Lm.read=function(l,r,a,p,v){var T,E,C=8*v-p-1,D=(1<<C)-1,N=D>>1,U=-7,H=a?v-1:0,X=a?-1:1,ee=l[r+H];for(H+=X,T=ee&(1<<-U)-1,ee>>=-U,U+=C;U>0;T=256*T+l[r+H],H+=X,U-=8);for(E=T&(1<<-U)-1,T>>=-U,U+=p;U>0;E=256*E+l[r+H],H+=X,U-=8);if(T===0)T=1-N;else{if(T===D)return E?NaN:1/0*(ee?-1:1);E+=Math.pow(2,p),T-=N}return(ee?-1:1)*E*Math.pow(2,T-p)},Lm.write=function(l,r,a,p,v,T){var E,C,D,N=8*T-v-1,U=(1<<N)-1,H=U>>1,X=v===23?Math.pow(2,-24)-Math.pow(2,-77):0,ee=p?0:T-1,ie=p?1:-1,ae=r<0||r===0&&1/r<0?1:0;for(r=Math.abs(r),isNaN(r)||r===1/0?(C=isNaN(r)?1:0,E=U):(E=Math.floor(Math.log(r)/Math.LN2),r*(D=Math.pow(2,-E))<1&&(E--,D*=2),(r+=E+H>=1?X/D:X*Math.pow(2,1-H))*D>=2&&(E++,D/=2),E+H>=U?(C=0,E=U):E+H>=1?(C=(r*D-1)*Math.pow(2,v),E+=H):(C=r*Math.pow(2,H-1)*Math.pow(2,v),E=0));v>=8;l[a+ee]=255&C,ee+=ie,C/=256,v-=8);for(E=E<<v|C,N+=v;N>0;l[a+ee]=255&E,ee+=ie,E/=256,N-=8);l[a+ee-ie]|=128*ae}),Lm}function Dm(){if(lp)return ap;lp=1,ap=r;var l=h_();function r(J){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(J)?J:new Uint8Array(J||0),this.pos=0,this.type=0,this.length=this.buf.length}r.Varint=0,r.Fixed64=1,r.Bytes=2,r.Fixed32=5;var a=4294967296,p=1/a,v=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function T(J){return J.type===r.Bytes?J.readVarint()+J.pos:J.pos+1}function E(J,me,Me){return Me?4294967296*me+(J>>>0):4294967296*(me>>>0)+(J>>>0)}function C(J,me,Me){var st=me<=16383?1:me<=2097151?2:me<=268435455?3:Math.floor(Math.log(me)/(7*Math.LN2));Me.realloc(st);for(var Pt=Me.pos-1;Pt>=J;Pt--)Me.buf[Pt+st]=Me.buf[Pt]}function D(J,me){for(var Me=0;Me<J.length;Me++)me.writeVarint(J[Me])}function N(J,me){for(var Me=0;Me<J.length;Me++)me.writeSVarint(J[Me])}function U(J,me){for(var Me=0;Me<J.length;Me++)me.writeFloat(J[Me])}function H(J,me){for(var Me=0;Me<J.length;Me++)me.writeDouble(J[Me])}function X(J,me){for(var Me=0;Me<J.length;Me++)me.writeBoolean(J[Me])}function ee(J,me){for(var Me=0;Me<J.length;Me++)me.writeFixed32(J[Me])}function ie(J,me){for(var Me=0;Me<J.length;Me++)me.writeSFixed32(J[Me])}function ae(J,me){for(var Me=0;Me<J.length;Me++)me.writeFixed64(J[Me])}function _e(J,me){for(var Me=0;Me<J.length;Me++)me.writeSFixed64(J[Me])}function Ee(J,me){return(J[me]|J[me+1]<<8|J[me+2]<<16)+16777216*J[me+3]}function je(J,me,Me){J[Me]=me,J[Me+1]=me>>>8,J[Me+2]=me>>>16,J[Me+3]=me>>>24}function ke(J,me){return(J[me]|J[me+1]<<8|J[me+2]<<16)+(J[me+3]<<24)}return r.prototype={destroy:function(){this.buf=null},readFields:function(J,me,Me){for(Me=Me||this.length;this.pos<Me;){var st=this.readVarint(),Pt=st>>3,ct=this.pos;this.type=7&st,J(Pt,me,this),this.pos===ct&&this.skip(st)}return me},readMessage:function(J,me){return this.readFields(J,me,this.readVarint()+this.pos)},readFixed32:function(){var J=Ee(this.buf,this.pos);return this.pos+=4,J},readSFixed32:function(){var J=ke(this.buf,this.pos);return this.pos+=4,J},readFixed64:function(){var J=Ee(this.buf,this.pos)+Ee(this.buf,this.pos+4)*a;return this.pos+=8,J},readSFixed64:function(){var J=Ee(this.buf,this.pos)+ke(this.buf,this.pos+4)*a;return this.pos+=8,J},readFloat:function(){var J=l.read(this.buf,this.pos,!0,23,4);return this.pos+=4,J},readDouble:function(){var J=l.read(this.buf,this.pos,!0,52,8);return this.pos+=8,J},readVarint:function(J){var me,Me,st=this.buf;return me=127&(Me=st[this.pos++]),Me<128?me:(me|=(127&(Me=st[this.pos++]))<<7,Me<128?me:(me|=(127&(Me=st[this.pos++]))<<14,Me<128?me:(me|=(127&(Me=st[this.pos++]))<<21,Me<128?me:function(Pt,ct,_t){var Dt,Ct,Ft=_t.buf;if(Dt=(112&(Ct=Ft[_t.pos++]))>>4,Ct<128||(Dt|=(127&(Ct=Ft[_t.pos++]))<<3,Ct<128)||(Dt|=(127&(Ct=Ft[_t.pos++]))<<10,Ct<128)||(Dt|=(127&(Ct=Ft[_t.pos++]))<<17,Ct<128)||(Dt|=(127&(Ct=Ft[_t.pos++]))<<24,Ct<128)||(Dt|=(1&(Ct=Ft[_t.pos++]))<<31,Ct<128))return E(Pt,Dt,ct);throw new Error("Expected varint not more than 10 bytes")}(me|=(15&(Me=st[this.pos]))<<28,J,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var J=this.readVarint();return J%2==1?(J+1)/-2:J/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var J=this.readVarint()+this.pos,me=this.pos;return this.pos=J,J-me>=12&&v?function(Me,st,Pt){return v.decode(Me.subarray(st,Pt))}(this.buf,me,J):function(Me,st,Pt){for(var ct="",_t=st;_t<Pt;){var Dt,Ct,Ft,bt=Me[_t],on=null,Cn=bt>239?4:bt>223?3:bt>191?2:1;if(_t+Cn>Pt)break;Cn===1?bt<128&&(on=bt):Cn===2?(192&(Dt=Me[_t+1]))==128&&(on=(31&bt)<<6|63&Dt)<=127&&(on=null):Cn===3?(Ct=Me[_t+2],(192&(Dt=Me[_t+1]))==128&&(192&Ct)==128&&((on=(15&bt)<<12|(63&Dt)<<6|63&Ct)<=2047||on>=55296&&on<=57343)&&(on=null)):Cn===4&&(Ct=Me[_t+2],Ft=Me[_t+3],(192&(Dt=Me[_t+1]))==128&&(192&Ct)==128&&(192&Ft)==128&&((on=(15&bt)<<18|(63&Dt)<<12|(63&Ct)<<6|63&Ft)<=65535||on>=1114112)&&(on=null)),on===null?(on=65533,Cn=1):on>65535&&(on-=65536,ct+=String.fromCharCode(on>>>10&1023|55296),on=56320|1023&on),ct+=String.fromCharCode(on),_t+=Cn}return ct}(this.buf,me,J)},readBytes:function(){var J=this.readVarint()+this.pos,me=this.buf.subarray(this.pos,J);return this.pos=J,me},readPackedVarint:function(J,me){if(this.type!==r.Bytes)return J.push(this.readVarint(me));var Me=T(this);for(J=J||[];this.pos<Me;)J.push(this.readVarint(me));return J},readPackedSVarint:function(J){if(this.type!==r.Bytes)return J.push(this.readSVarint());var me=T(this);for(J=J||[];this.pos<me;)J.push(this.readSVarint());return J},readPackedBoolean:function(J){if(this.type!==r.Bytes)return J.push(this.readBoolean());var me=T(this);for(J=J||[];this.pos<me;)J.push(this.readBoolean());return J},readPackedFloat:function(J){if(this.type!==r.Bytes)return J.push(this.readFloat());var me=T(this);for(J=J||[];this.pos<me;)J.push(this.readFloat());return J},readPackedDouble:function(J){if(this.type!==r.Bytes)return J.push(this.readDouble());var me=T(this);for(J=J||[];this.pos<me;)J.push(this.readDouble());return J},readPackedFixed32:function(J){if(this.type!==r.Bytes)return J.push(this.readFixed32());var me=T(this);for(J=J||[];this.pos<me;)J.push(this.readFixed32());return J},readPackedSFixed32:function(J){if(this.type!==r.Bytes)return J.push(this.readSFixed32());var me=T(this);for(J=J||[];this.pos<me;)J.push(this.readSFixed32());return J},readPackedFixed64:function(J){if(this.type!==r.Bytes)return J.push(this.readFixed64());var me=T(this);for(J=J||[];this.pos<me;)J.push(this.readFixed64());return J},readPackedSFixed64:function(J){if(this.type!==r.Bytes)return J.push(this.readSFixed64());var me=T(this);for(J=J||[];this.pos<me;)J.push(this.readSFixed64());return J},skip:function(J){var me=7&J;if(me===r.Varint)for(;this.buf[this.pos++]>127;);else if(me===r.Bytes)this.pos=this.readVarint()+this.pos;else if(me===r.Fixed32)this.pos+=4;else{if(me!==r.Fixed64)throw new Error("Unimplemented type: "+me);this.pos+=8}},writeTag:function(J,me){this.writeVarint(J<<3|me)},realloc:function(J){for(var me=this.length||16;me<this.pos+J;)me*=2;if(me!==this.length){var Me=new Uint8Array(me);Me.set(this.buf),this.buf=Me,this.length=me}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(J){this.realloc(4),je(this.buf,J,this.pos),this.pos+=4},writeSFixed32:function(J){this.realloc(4),je(this.buf,J,this.pos),this.pos+=4},writeFixed64:function(J){this.realloc(8),je(this.buf,-1&J,this.pos),je(this.buf,Math.floor(J*p),this.pos+4),this.pos+=8},writeSFixed64:function(J){this.realloc(8),je(this.buf,-1&J,this.pos),je(this.buf,Math.floor(J*p),this.pos+4),this.pos+=8},writeVarint:function(J){(J=+J||0)>268435455||J<0?function(me,Me){var st,Pt;if(me>=0?(st=me%4294967296|0,Pt=me/4294967296|0):(Pt=~(-me/4294967296),4294967295^(st=~(-me%4294967296))?st=st+1|0:(st=0,Pt=Pt+1|0)),me>=18446744073709552e3||me<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");Me.realloc(10),function(ct,_t,Dt){Dt.buf[Dt.pos++]=127&ct|128,ct>>>=7,Dt.buf[Dt.pos++]=127&ct|128,ct>>>=7,Dt.buf[Dt.pos++]=127&ct|128,ct>>>=7,Dt.buf[Dt.pos++]=127&ct|128,Dt.buf[Dt.pos]=127&(ct>>>=7)}(st,0,Me),function(ct,_t){var Dt=(7&ct)<<4;_t.buf[_t.pos++]|=Dt|((ct>>>=3)?128:0),ct&&(_t.buf[_t.pos++]=127&ct|((ct>>>=7)?128:0),ct&&(_t.buf[_t.pos++]=127&ct|((ct>>>=7)?128:0),ct&&(_t.buf[_t.pos++]=127&ct|((ct>>>=7)?128:0),ct&&(_t.buf[_t.pos++]=127&ct|((ct>>>=7)?128:0),ct&&(_t.buf[_t.pos++]=127&ct)))))}(Pt,Me)}(J,this):(this.realloc(4),this.buf[this.pos++]=127&J|(J>127?128:0),J<=127||(this.buf[this.pos++]=127&(J>>>=7)|(J>127?128:0),J<=127||(this.buf[this.pos++]=127&(J>>>=7)|(J>127?128:0),J<=127||(this.buf[this.pos++]=J>>>7&127))))},writeSVarint:function(J){this.writeVarint(J<0?2*-J-1:2*J)},writeBoolean:function(J){this.writeVarint(!!J)},writeString:function(J){J=String(J),this.realloc(4*J.length),this.pos++;var me=this.pos;this.pos=function(st,Pt,ct){for(var _t,Dt,Ct=0;Ct<Pt.length;Ct++){if((_t=Pt.charCodeAt(Ct))>55295&&_t<57344){if(!Dt){_t>56319||Ct+1===Pt.length?(st[ct++]=239,st[ct++]=191,st[ct++]=189):Dt=_t;continue}if(_t<56320){st[ct++]=239,st[ct++]=191,st[ct++]=189,Dt=_t;continue}_t=Dt-55296<<10|_t-56320|65536,Dt=null}else Dt&&(st[ct++]=239,st[ct++]=191,st[ct++]=189,Dt=null);_t<128?st[ct++]=_t:(_t<2048?st[ct++]=_t>>6|192:(_t<65536?st[ct++]=_t>>12|224:(st[ct++]=_t>>18|240,st[ct++]=_t>>12&63|128),st[ct++]=_t>>6&63|128),st[ct++]=63&_t|128)}return ct}(this.buf,J,this.pos);var Me=this.pos-me;Me>=128&&C(me,Me,this),this.pos=me-1,this.writeVarint(Me),this.pos+=Me},writeFloat:function(J){this.realloc(4),l.write(this.buf,J,this.pos,!0,23,4),this.pos+=4},writeDouble:function(J){this.realloc(8),l.write(this.buf,J,this.pos,!0,52,8),this.pos+=8},writeBytes:function(J){var me=J.length;this.writeVarint(me),this.realloc(me);for(var Me=0;Me<me;Me++)this.buf[this.pos++]=J[Me]},writeRawMessage:function(J,me){this.pos++;var Me=this.pos;J(me,this);var st=this.pos-Me;st>=128&&C(Me,st,this),this.pos=Me-1,this.writeVarint(st),this.pos+=st},writeMessage:function(J,me,Me){this.writeTag(J,r.Bytes),this.writeRawMessage(me,Me)},writePackedVarint:function(J,me){me.length&&this.writeMessage(J,D,me)},writePackedSVarint:function(J,me){me.length&&this.writeMessage(J,N,me)},writePackedBoolean:function(J,me){me.length&&this.writeMessage(J,X,me)},writePackedFloat:function(J,me){me.length&&this.writeMessage(J,U,me)},writePackedDouble:function(J,me){me.length&&this.writeMessage(J,H,me)},writePackedFixed32:function(J,me){me.length&&this.writeMessage(J,ee,me)},writePackedSFixed32:function(J,me){me.length&&this.writeMessage(J,ie,me)},writePackedFixed64:function(J,me){me.length&&this.writeMessage(J,ae,me)},writePackedSFixed64:function(J,me){me.length&&this.writeMessage(J,_e,me)},writeBytesField:function(J,me){this.writeTag(J,r.Bytes),this.writeBytes(me)},writeFixed32Field:function(J,me){this.writeTag(J,r.Fixed32),this.writeFixed32(me)},writeSFixed32Field:function(J,me){this.writeTag(J,r.Fixed32),this.writeSFixed32(me)},writeFixed64Field:function(J,me){this.writeTag(J,r.Fixed64),this.writeFixed64(me)},writeSFixed64Field:function(J,me){this.writeTag(J,r.Fixed64),this.writeSFixed64(me)},writeVarintField:function(J,me){this.writeTag(J,r.Varint),this.writeVarint(me)},writeSVarintField:function(J,me){this.writeTag(J,r.Varint),this.writeSVarint(me)},writeStringField:function(J,me){this.writeTag(J,r.Bytes),this.writeString(me)},writeFloatField:function(J,me){this.writeTag(J,r.Fixed32),this.writeFloat(me)},writeDoubleField:function(J,me){this.writeTag(J,r.Fixed64),this.writeDouble(me)},writeBooleanField:function(J,me){this.writeVarintField(J,!!me)}},ap}var hc=R(Dm());const zm=3;function xd(l,r,a){l===1&&a.readMessage(d_,r)}function d_(l,r,a){if(l===3){const{id:p,bitmap:v,width:T,height:E,left:C,top:D,advance:N}=a.readMessage(Xr,{});r.push({id:p,bitmap:new dd({width:T+2*zm,height:E+2*zm},v),metrics:{width:T,height:E,left:C,top:D,advance:N}})}}function Xr(l,r,a){l===1?r.id=a.readVarint():l===2?r.bitmap=a.readBytes():l===3?r.width=a.readVarint():l===4?r.height=a.readVarint():l===5?r.left=a.readSVarint():l===6?r.top=a.readSVarint():l===7&&(r.advance=a.readVarint())}const Tv=zm;function Nm(l){let r=0,a=0;for(const E of l)r+=E.w*E.h,a=Math.max(a,E.w);l.sort((E,C)=>C.h-E.h);const p=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(r/.95)),a),h:1/0}];let v=0,T=0;for(const E of l)for(let C=p.length-1;C>=0;C--){const D=p[C];if(!(E.w>D.w||E.h>D.h)){if(E.x=D.x,E.y=D.y,T=Math.max(T,E.y+E.h),v=Math.max(v,E.x+E.w),E.w===D.w&&E.h===D.h){const N=p.pop();C<p.length&&(p[C]=N)}else E.h===D.h?(D.x+=E.w,D.w-=E.w):E.w===D.w?(D.y+=E.h,D.h-=E.h):(p.push({x:D.x+E.w,y:D.y,w:D.w-E.w,h:E.h}),D.y+=E.h,D.h-=E.h);break}}return{w:v,h:T,fill:r/(v*T)||0}}const ca=1;class Om{constructor(r,{pixelRatio:a,version:p,stretchX:v,stretchY:T,content:E,textFitWidth:C,textFitHeight:D}){this.paddedRect=r,this.pixelRatio=a,this.stretchX=v,this.stretchY=T,this.content=E,this.version=p,this.textFitWidth=C,this.textFitHeight=D}get tl(){return[this.paddedRect.x+ca,this.paddedRect.y+ca]}get br(){return[this.paddedRect.x+this.paddedRect.w-ca,this.paddedRect.y+this.paddedRect.h-ca]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*ca)/this.pixelRatio,(this.paddedRect.h-2*ca)/this.pixelRatio]}}class Fm{constructor(r,a){const p={},v={};this.haveRenderCallbacks=[];const T=[];this.addImages(r,p,T),this.addImages(a,v,T);const{w:E,h:C}=Nm(T),D=new za({width:E||1,height:C||1});for(const N in r){const U=r[N],H=p[N].paddedRect;za.copy(U.data,D,{x:0,y:0},{x:H.x+ca,y:H.y+ca},U.data)}for(const N in a){const U=a[N],H=v[N].paddedRect,X=H.x+ca,ee=H.y+ca,ie=U.data.width,ae=U.data.height;za.copy(U.data,D,{x:0,y:0},{x:X,y:ee},U.data),za.copy(U.data,D,{x:0,y:ae-1},{x:X,y:ee-1},{width:ie,height:1}),za.copy(U.data,D,{x:0,y:0},{x:X,y:ee+ae},{width:ie,height:1}),za.copy(U.data,D,{x:ie-1,y:0},{x:X-1,y:ee},{width:1,height:ae}),za.copy(U.data,D,{x:0,y:0},{x:X+ie,y:ee},{width:1,height:ae})}this.image=D,this.iconPositions=p,this.patternPositions=v}addImages(r,a,p){for(const v in r){const T=r[v],E={x:0,y:0,w:T.data.width+2*ca,h:T.data.height+2*ca};p.push(E),a[v]=new Om(E,T),T.hasRenderCallback&&this.haveRenderCallbacks.push(v)}}patchUpdatedImages(r,a){r.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const p in r.updatedImages)this.patchUpdatedImage(this.iconPositions[p],r.getImage(p),a),this.patchUpdatedImage(this.patternPositions[p],r.getImage(p),a)}patchUpdatedImage(r,a,p){if(!r||!a||r.version===a.version)return;r.version=a.version;const[v,T]=r.tl;p.update(a.data,void 0,{x:v,y:T})}}var dc;Gt("ImagePosition",Om),Gt("ImageAtlas",Fm),_.ai=void 0,(dc=_.ai||(_.ai={}))[dc.none=0]="none",dc[dc.horizontal=1]="horizontal",dc[dc.vertical=2]="vertical",dc[dc.horizontalOnly=3]="horizontalOnly";const pf=-17;class Bs{constructor(){this.scale=1,this.fontStack="",this.imageName=null,this.verticalAlign="bottom"}static forText(r,a,p){const v=new Bs;return v.scale=r||1,v.fontStack=a,v.verticalAlign=p||"bottom",v}static forImage(r,a){const p=new Bs;return p.imageName=r,p.verticalAlign=a||"bottom",p}}class Qc{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(r,a){const p=new Qc;for(let v=0;v<r.sections.length;v++){const T=r.sections[v];T.image?p.addImageSection(T):p.addTextSection(T,a)}return p}length(){return this.text.length}getSection(r){return this.sections[this.sectionIndex[r]]}getSectionIndex(r){return this.sectionIndex[r]}getCharCode(r){return this.text.charCodeAt(r)}verticalizePunctuation(){this.text=function(r){let a="";for(let p=0;p<r.length;p++){const v=r.charCodeAt(p+1)||null,T=r.charCodeAt(p-1)||null;a+=v&&Yu(v)&&!vd[r[p+1]]||T&&Yu(T)&&!vd[r[p-1]]||!vd[r[p]]?r[p]:vd[r[p]]}return a}(this.text)}trim(){let r=0;for(let p=0;p<this.text.length&&uu[this.text.charCodeAt(p)];p++)r++;let a=this.text.length;for(let p=this.text.length-1;p>=0&&p>=r&&uu[this.text.charCodeAt(p)];p--)a--;this.text=this.text.substring(r,a),this.sectionIndex=this.sectionIndex.slice(r,a)}substring(r,a){const p=new Qc;return p.text=this.text.substring(r,a),p.sectionIndex=this.sectionIndex.slice(r,a),p.sections=this.sections,p}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((r,a)=>Math.max(r,this.sections[a].scale),0)}getMaxImageSize(r){let a=0,p=0;for(let v=0;v<this.length();v++){const T=this.getSection(v);if(T.imageName){const E=r[T.imageName];if(!E)continue;const C=E.displaySize;a=Math.max(a,C[0]),p=Math.max(p,C[1])}}return{maxImageWidth:a,maxImageHeight:p}}addTextSection(r,a){this.text+=r.text,this.sections.push(Bs.forText(r.scale,r.fontStack||a,r.verticalAlign));const p=this.sections.length-1;for(let v=0;v<r.text.length;++v)this.sectionIndex.push(p)}addImageSection(r){const a=r.image?r.image.name:"";if(a.length===0)return void Ji("Can't add FormattedSection with an empty image.");const p=this.getNextImageSectionCharCode();p?(this.text+=String.fromCharCode(p),this.sections.push(Bs.forImage(a,r.verticalAlign)),this.sectionIndex.push(this.sections.length-1)):Ji("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function ff(l,r,a,p,v,T,E,C,D,N,U,H,X,ee,ie){const ae=Qc.fromFeature(l,v);let _e;H===_.ai.vertical&&ae.verticalizePunctuation();const{processBidirectionalText:Ee,processStyledBidirectionalText:je}=hs;if(Ee&&ae.sections.length===1){_e=[];const me=Ee(ae.toString(),Vm(ae,N,T,r,p,ee));for(const Me of me){const st=new Qc;st.text=Me,st.sections=ae.sections;for(let Pt=0;Pt<Me.length;Pt++)st.sectionIndex.push(0);_e.push(st)}}else if(je){_e=[];const me=je(ae.text,ae.sectionIndex,Vm(ae,N,T,r,p,ee));for(const Me of me){const st=new Qc;st.text=Me[0],st.sectionIndex=Me[1],st.sections=ae.sections,_e.push(st)}}else _e=function(me,Me){const st=[],Pt=me.text;let ct=0;for(const _t of Me)st.push(me.substring(ct,_t)),ct=_t;return ct<Pt.length&&st.push(me.substring(ct,Pt.length)),st}(ae,Vm(ae,N,T,r,p,ee));const ke=[],J={positionedLines:ke,text:ae.toString(),top:U[1],bottom:U[1],left:U[0],right:U[0],writingMode:H,iconsInText:!1,verticalizable:!1};return function(me,Me,st,Pt,ct,_t,Dt,Ct,Ft,bt,on,Cn){let Tn=0,cn=0,di=0,jr=0;const Lo=Ct==="right"?1:Ct==="left"?0:.5,Us=oo/Cn;let hu=0;for(const Dr of ct){Dr.trim();const Go=Dr.getMaxScale(),gs={positionedGlyphs:[],lineOffset:0};me.positionedLines[hu]=gs;const _s=gs.positionedGlyphs;let Ba=0;if(!Dr.length()){cn+=_t,++hu;continue}const du=f_(Pt,Dr,Us);for(let sl=0;sl<Dr.length();sl++){const Do=Dr.getSection(sl),Wo=Dr.getSectionIndex(sl),Ko=Dr.getCharCode(sl),vo=vf(Ft,on,Ko);let Tr;if(Do.imageName){if(me.iconsInText=!0,Do.scale=Do.scale*Us,Tr=Um(Do,vo,Go,du,Pt),!Tr)continue;Ba=Math.max(Ba,Tr.imageOffset)}else if(Tr=m_(Do,Ko,vo,du,Me,st),!Tr)continue;const{rect:mc,metrics:Sf,baselineOffset:gc}=Tr;_s.push({glyph:Ko,imageName:Do.imageName,x:Tn,y:cn+gc+pf,vertical:vo,scale:Do.scale,fontStack:Do.fontStack,sectionIndex:Wo,metrics:Sf,rect:mc}),vo?(me.verticalizable=!0,Tn+=(Do.imageName?Sf.advance:oo)*Do.scale+bt):Tn+=Sf.advance*Do.scale+bt}_s.length!==0&&(di=Math.max(Tn-bt,di),Sv(_s,0,_s.length-1,Lo)),Tn=0,gs.lineOffset=Math.max(Ba,(Go-1)*oo);const Zo=_t*Go+Ba;cn+=Zo,jr=Math.max(Zo,jr),++hu}const{horizontalAlign:ol,verticalAlign:ms}=yf(Dt);(function(Dr,Go,gs,_s,Ba,du,Zo,sl,Do){const Wo=(Go-gs)*Ba;let Ko=0;Ko=du!==Zo?-sl*_s-pf:-_s*Do*Zo+.5*Zo;for(const vo of Dr)for(const Tr of vo.positionedGlyphs)Tr.x+=Wo,Tr.y+=Ko})(me.positionedLines,Lo,ol,ms,di,jr,_t,cn,ct.length),me.top+=-ms*cn,me.bottom=me.top+cn,me.left+=-ol*di,me.right=me.left+di}(J,r,a,p,_e,E,C,D,H,N,X,ie),!function(me){for(const Me of me)if(Me.positionedGlyphs.length!==0)return!1;return!0}(ke)&&J}const uu={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},mf={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},Vh={40:!0};function up(l,r,a,p,v,T){if(r.imageName){const E=p[r.imageName];return E?E.displaySize[0]*r.scale*oo/T+v:0}{const E=a[r.fontStack],C=E&&E[l];return C?C.metrics.advance*r.scale+v:0}}function gf(l,r,a,p){const v=Math.pow(l-r,2);return p?l<r?v/2:2*v:v+Math.abs(a)*a}function Bm(l,r,a){let p=0;return l===10&&(p-=1e4),a&&(p+=150),l!==40&&l!==65288||(p+=50),r!==41&&r!==65289||(p+=50),p}function p_(l,r,a,p,v,T){let E=null,C=gf(r,a,v,T);for(const D of p){const N=gf(r-D.x,a,v,T)+D.badness;N<=C&&(E=D,C=N)}return{index:l,x:r,priorBreak:E,badness:C}}function _f(l){return l?_f(l.priorBreak).concat(l.index):[]}function Vm(l,r,a,p,v,T){if(!l)return[];const E=[],C=function(H,X,ee,ie,ae,_e){let Ee=0;for(let je=0;je<H.length();je++){const ke=H.getSection(je);Ee+=up(H.getCharCode(je),ke,ie,ae,X,_e)}return Ee/Math.max(1,Math.ceil(Ee/ee))}(l,r,a,p,v,T),D=l.text.indexOf("​")>=0;let N=0;for(let H=0;H<l.length();H++){const X=l.getSection(H),ee=l.getCharCode(H);if(uu[ee]||(N+=up(ee,X,p,v,r,T)),H<l.length()-1){const ie=!((U=ee)<11904)&&(!!ti["CJK Compatibility Forms"](U)||!!ti["CJK Compatibility"](U)||!!ti["CJK Strokes"](U)||!!ti["CJK Symbols and Punctuation"](U)||!!ti["Enclosed CJK Letters and Months"](U)||!!ti["Halfwidth and Fullwidth Forms"](U)||!!ti["Ideographic Description Characters"](U)||!!ti["Vertical Forms"](U)||el.test(String.fromCodePoint(U)));(mf[ee]||ie||X.imageName||H!==l.length()-2&&Vh[l.getCharCode(H+1)])&&E.push(p_(H+1,N,C,E,Bm(ee,l.getCharCode(H+1),ie&&D),!1))}}var U;return _f(p_(l.length(),N,C,E,0,!0))}function yf(l){let r=.5,a=.5;switch(l){case"right":case"top-right":case"bottom-right":r=1;break;case"left":case"top-left":case"bottom-left":r=0}switch(l){case"bottom":case"bottom-right":case"bottom-left":a=1;break;case"top":case"top-right":case"top-left":a=0}return{horizontalAlign:r,verticalAlign:a}}function f_(l,r,a){const p=r.getMaxScale()*oo,{maxImageWidth:v,maxImageHeight:T}=r.getMaxImageSize(l),E=Math.max(p,T*a);return{verticalLineContentWidth:Math.max(p,v*a),horizontalLineContentHeight:E}}function cp(l){switch(l){case"top":return 0;case"center":return .5;default:return 1}}function vf(l,r,a){return!(l===_.ai.horizontal||!r&&!ou(a)||r&&(uu[a]||(p=a,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(p)))));var p}function m_(l,r,a,p,v,T){const E=T[l.fontStack],C=function(N,U,H,X){if(N&&N.rect)return N;const ee=U[H.fontStack],ie=ee&&ee[X];return ie?{rect:null,metrics:ie.metrics}:null}(E&&E[r],v,l,r);if(C===null)return null;let D;if(a)D=p.verticalLineContentWidth-l.scale*oo;else{const N=cp(l.verticalAlign);D=(p.horizontalLineContentHeight-l.scale*oo)*N}return{rect:C.rect,metrics:C.metrics,baselineOffset:D}}function Um(l,r,a,p,v){const T=v[l.imageName];if(!T)return null;const E=T.paddedRect,C=T.displaySize,D={width:C[0],height:C[1],left:ca,top:-3,advance:r?C[1]:C[0]};let N;if(r)N=p.verticalLineContentWidth-C[1]*l.scale;else{const U=cp(l.verticalAlign);N=(p.horizontalLineContentHeight-C[1]*l.scale)*U}return{rect:E,metrics:D,baselineOffset:N,imageOffset:(r?C[0]:C[1])*l.scale-oo*a}}function Sv(l,r,a,p){if(p===0)return;const v=l[a],T=(l[a].x+v.metrics.advance*v.scale)*p;for(let E=r;E<=a;E++)l[E].x-=T}function g_(l,r,a){const{horizontalAlign:p,verticalAlign:v}=yf(a),T=r[0]-l.displaySize[0]*p,E=r[1]-l.displaySize[1]*v;return{image:l,top:E,bottom:E+l.displaySize[1],left:T,right:T+l.displaySize[0]}}function xf(l){var r,a;let p=l.left,v=l.top,T=l.right-p,E=l.bottom-v;const C=(r=l.image.textFitWidth)!==null&&r!==void 0?r:"stretchOrShrink",D=(a=l.image.textFitHeight)!==null&&a!==void 0?a:"stretchOrShrink",N=(l.image.content[2]-l.image.content[0])/(l.image.content[3]-l.image.content[1]);if(D==="proportional"){if(C==="stretchOnly"&&T/E<N||C==="proportional"){const U=Math.ceil(E*N);p*=U/T,T=U}}else if(C==="proportional"&&D==="stretchOnly"&&N!==0&&T/E>N){const U=Math.ceil(T/N);v*=U/E,E=U}return{x1:p,y1:v,x2:p+T,y2:v+E}}function hp(l,r,a,p,v,T){const E=l.image;let C;if(E.content){const _e=E.content,Ee=E.pixelRatio||1;C=[_e[0]/Ee,_e[1]/Ee,E.displaySize[0]-_e[2]/Ee,E.displaySize[1]-_e[3]/Ee]}const D=r.left*T,N=r.right*T;let U,H,X,ee;a==="width"||a==="both"?(ee=v[0]+D-p[3],H=v[0]+N+p[1]):(ee=v[0]+(D+N-E.displaySize[0])/2,H=ee+E.displaySize[0]);const ie=r.top*T,ae=r.bottom*T;return a==="height"||a==="both"?(U=v[1]+ie-p[0],X=v[1]+ae+p[2]):(U=v[1]+(ie+ae-E.displaySize[1])/2,X=U+E.displaySize[1]),{image:E,top:U,right:H,bottom:X,left:ee,collisionPadding:C}}const Uh=255,rl=128,pc=Uh*rl;function __(l,r){const{expression:a}=r;if(a.kind==="constant")return{kind:"constant",layoutSize:a.evaluate(new bi(l+1))};if(a.kind==="source")return{kind:"source"};{const{zoomStops:p,interpolationType:v}=a;let T=0;for(;T<p.length&&p[T]<=l;)T++;T=Math.max(0,T-1);let E=T;for(;E<p.length&&p[E]<l+1;)E++;E=Math.min(p.length-1,E);const C=p[T],D=p[E];return a.kind==="composite"?{kind:"composite",minZoom:C,maxZoom:D,interpolationType:v}:{kind:"camera",minZoom:C,maxZoom:D,minSize:a.evaluate(new bi(C)),maxSize:a.evaluate(new bi(D)),interpolationType:v}}}function wd(l,r,a){let p="never";const v=l.get(r);return v?p=v:l.get(a)&&(p="always"),p}const Ev=Ur.VectorTileFeature.types,dp=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function wf(l,r,a,p,v,T,E,C,D,N,U,H,X){const ee=C?Math.min(pc,Math.round(C[0])):0,ie=C?Math.min(pc,Math.round(C[1])):0;l.emplaceBack(r,a,Math.round(32*p),Math.round(32*v),T,E,(ee<<1)+(D?1:0),ie,16*N,16*U,256*H,256*X)}function bd(l,r,a){l.emplaceBack(r.x,r.y,a),l.emplaceBack(r.x,r.y,a),l.emplaceBack(r.x,r.y,a),l.emplaceBack(r.x,r.y,a)}function c(l){for(const r of l.sections)if(ia(r.text))return!0;return!1}class f{constructor(r){this.layoutVertexArray=new Ne,this.indexArray=new pt,this.programConfigurations=r,this.segments=new Ht,this.dynamicLayoutVertexArray=new Qe,this.opacityVertexArray=new Je,this.hasVisibleVertices=!1,this.placedSymbolArray=new M}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(r,a,p,v){this.isEmpty()||(p&&(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,Xc.members),this.indexBuffer=r.createIndexBuffer(this.indexArray,a),this.dynamicLayoutVertexBuffer=r.createVertexBuffer(this.dynamicLayoutVertexArray,c_.members,!0),this.opacityVertexBuffer=r.createVertexBuffer(this.opacityVertexArray,dp,!0),this.opacityVertexBuffer.itemSize=1),(p||v)&&this.programConfigurations.upload(r))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Gt("SymbolBuffers",f);class S{constructor(r,a,p){this.layoutVertexArray=new r,this.layoutAttributes=a,this.indexArray=new p,this.segments=new Ht,this.collisionVertexArray=new xt}upload(r){this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=r.createVertexBuffer(this.collisionVertexArray,km.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Gt("CollisionBuffers",S);class k{constructor(r){this.collisionBoxArray=r.collisionBoxArray,this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(E=>E.id),this.index=r.index,this.pixelRatio=r.pixelRatio,this.sourceLayerIndex=r.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const a=this.layers[0]._unevaluatedLayout._values;this.textSizeData=__(this.zoom,a["text-size"]),this.iconSizeData=__(this.zoom,a["icon-size"]);const p=this.layers[0].layout,v=p.get("symbol-sort-key"),T=p.get("symbol-z-order");this.canOverlap=wd(p,"text-overlap","text-allow-overlap")!=="never"||wd(p,"icon-overlap","icon-allow-overlap")!=="never"||p.get("text-ignore-placement")||p.get("icon-ignore-placement"),this.sortFeaturesByKey=T!=="viewport-y"&&!v.isConstant(),this.sortFeaturesByY=(T==="viewport-y"||T==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,p.get("symbol-placement")==="point"&&(this.writingModes=p.get("text-writing-mode").map(E=>_.ai[E])),this.stateDependentLayerIds=this.layers.filter(E=>E.isStateDependent()).map(E=>E.id),this.sourceID=r.sourceID}createArrays(){this.text=new f(new yr(this.layers,this.zoom,r=>/^text/.test(r))),this.icon=new f(new yr(this.layers,this.zoom,r=>/^icon/.test(r))),this.glyphOffsetArray=new q,this.lineVertexArray=new W,this.symbolInstances=new B,this.textAnchorOffsets=new oe}calculateGlyphDependencies(r,a,p,v,T){for(let E=0;E<r.length;E++)if(a[r.charCodeAt(E)]=!0,(p||v)&&T){const C=vd[r.charAt(E)];C&&(a[C.charCodeAt(0)]=!0)}}populate(r,a,p){const v=this.layers[0],T=v.layout,E=T.get("text-font"),C=T.get("text-field"),D=T.get("icon-image"),N=(C.value.kind!=="constant"||C.value.value instanceof _n&&!C.value.value.isEmpty()||C.value.value.toString().length>0)&&(E.value.kind!=="constant"||E.value.value.length>0),U=D.value.kind!=="constant"||!!D.value.value||Object.keys(D.parameters).length>0,H=T.get("symbol-sort-key");if(this.features=[],!N&&!U)return;const X=a.iconDependencies,ee=a.glyphDependencies,ie=a.availableImages,ae=new bi(this.zoom);for(const{feature:_e,id:Ee,index:je,sourceLayerIndex:ke}of r){const J=v._featureFilter.needGeometry,me=Du(_e,J);if(!v._featureFilter.filter(ae,me,p))continue;let Me,st;if(J||(me.geometry=tc(_e)),N){const ct=v.getValueAndResolveTokens("text-field",me,p,ie),_t=_n.factory(ct),Dt=this.hasRTLText=this.hasRTLText||c(_t);(!Dt||hs.getRTLTextPluginStatus()==="unavailable"||Dt&&hs.isParsed())&&(Me=Bh(_t,v,me))}if(U){const ct=v.getValueAndResolveTokens("icon-image",me,p,ie);st=ct instanceof Ir?ct:Ir.fromString(ct)}if(!Me&&!st)continue;const Pt=this.sortFeaturesByKey?H.evaluate(me,{},p):void 0;if(this.features.push({id:Ee,text:Me,icon:st,index:je,sourceLayerIndex:ke,geometry:me.geometry,properties:_e.properties,type:Ev[_e.type],sortKey:Pt}),st&&(X[st.name]=!0),Me){const ct=E.evaluate(me,{},p).join(","),_t=T.get("text-rotation-alignment")!=="viewport"&&T.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(_.ai.vertical)>=0;for(const Dt of Me.sections)if(Dt.image)X[Dt.image.name]=!0;else{const Ct=zs(Me.toString()),Ft=Dt.fontStack||ct,bt=ee[Ft]=ee[Ft]||{};this.calculateGlyphDependencies(Dt.text,bt,_t,this.allowVerticalPlacement,Ct)}}}T.get("symbol-placement")==="line"&&(this.features=function(_e){const Ee={},je={},ke=[];let J=0;function me(ct){ke.push(_e[ct]),J++}function Me(ct,_t,Dt){const Ct=je[ct];return delete je[ct],je[_t]=Ct,ke[Ct].geometry[0].pop(),ke[Ct].geometry[0]=ke[Ct].geometry[0].concat(Dt[0]),Ct}function st(ct,_t,Dt){const Ct=Ee[_t];return delete Ee[_t],Ee[ct]=Ct,ke[Ct].geometry[0].shift(),ke[Ct].geometry[0]=Dt[0].concat(ke[Ct].geometry[0]),Ct}function Pt(ct,_t,Dt){const Ct=Dt?_t[0][_t[0].length-1]:_t[0][0];return`${ct}:${Ct.x}:${Ct.y}`}for(let ct=0;ct<_e.length;ct++){const _t=_e[ct],Dt=_t.geometry,Ct=_t.text?_t.text.toString():null;if(!Ct){me(ct);continue}const Ft=Pt(Ct,Dt),bt=Pt(Ct,Dt,!0);if(Ft in je&&bt in Ee&&je[Ft]!==Ee[bt]){const on=st(Ft,bt,Dt),Cn=Me(Ft,bt,ke[on].geometry);delete Ee[Ft],delete je[bt],je[Pt(Ct,ke[Cn].geometry,!0)]=Cn,ke[on].geometry=null}else Ft in je?Me(Ft,bt,Dt):bt in Ee?st(Ft,bt,Dt):(me(ct),Ee[Ft]=J-1,je[bt]=J-1)}return ke.filter(ct=>ct.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((_e,Ee)=>_e.sortKey-Ee.sortKey)}update(r,a,p){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(r,a,this.layers,p),this.icon.programConfigurations.updatePaintArrays(r,a,this.layers,p))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(r){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(r),this.iconCollisionBox.upload(r)),this.text.upload(r,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(r,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(r,a){const p=this.lineVertexArray.length;if(r.segment!==void 0){let v=r.dist(a[r.segment+1]),T=r.dist(a[r.segment]);const E={};for(let C=r.segment+1;C<a.length;C++)E[C]={x:a[C].x,y:a[C].y,tileUnitDistanceFromAnchor:v},C<a.length-1&&(v+=a[C+1].dist(a[C]));for(let C=r.segment||0;C>=0;C--)E[C]={x:a[C].x,y:a[C].y,tileUnitDistanceFromAnchor:T},C>0&&(T+=a[C-1].dist(a[C]));for(let C=0;C<a.length;C++){const D=E[C];this.lineVertexArray.emplaceBack(D.x,D.y,D.tileUnitDistanceFromAnchor)}}return{lineStartIndex:p,lineLength:this.lineVertexArray.length-p}}addSymbols(r,a,p,v,T,E,C,D,N,U,H,X){const ee=r.indexArray,ie=r.layoutVertexArray,ae=r.segments.prepareSegment(4*a.length,ie,ee,this.canOverlap?E.sortKey:void 0),_e=this.glyphOffsetArray.length,Ee=ae.vertexLength,je=this.allowVerticalPlacement&&C===_.ai.vertical?Math.PI/2:0,ke=E.text&&E.text.sections;for(let J=0;J<a.length;J++){const{tl:me,tr:Me,bl:st,br:Pt,tex:ct,pixelOffsetTL:_t,pixelOffsetBR:Dt,minFontScaleX:Ct,minFontScaleY:Ft,glyphOffset:bt,isSDF:on,sectionIndex:Cn}=a[J],Tn=ae.vertexLength,cn=bt[1];wf(ie,D.x,D.y,me.x,cn+me.y,ct.x,ct.y,p,on,_t.x,_t.y,Ct,Ft),wf(ie,D.x,D.y,Me.x,cn+Me.y,ct.x+ct.w,ct.y,p,on,Dt.x,_t.y,Ct,Ft),wf(ie,D.x,D.y,st.x,cn+st.y,ct.x,ct.y+ct.h,p,on,_t.x,Dt.y,Ct,Ft),wf(ie,D.x,D.y,Pt.x,cn+Pt.y,ct.x+ct.w,ct.y+ct.h,p,on,Dt.x,Dt.y,Ct,Ft),bd(r.dynamicLayoutVertexArray,D,je),ee.emplaceBack(Tn,Tn+2,Tn+1),ee.emplaceBack(Tn+1,Tn+2,Tn+3),ae.vertexLength+=4,ae.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(bt[0]),J!==a.length-1&&Cn===a[J+1].sectionIndex||r.programConfigurations.populatePaintArrays(ie.length,E,E.index,{},X,ke&&ke[Cn])}r.placedSymbolArray.emplaceBack(D.x,D.y,_e,this.glyphOffsetArray.length-_e,Ee,N,U,D.segment,p?p[0]:0,p?p[1]:0,v[0],v[1],C,0,!1,0,H)}_addCollisionDebugVertex(r,a,p,v,T,E){return a.emplaceBack(0,0),r.emplaceBack(p.x,p.y,v,T,Math.round(E.x),Math.round(E.y))}addCollisionDebugVertices(r,a,p,v,T,E,C){const D=T.segments.prepareSegment(4,T.layoutVertexArray,T.indexArray),N=D.vertexLength,U=T.layoutVertexArray,H=T.collisionVertexArray,X=C.anchorX,ee=C.anchorY;this._addCollisionDebugVertex(U,H,E,X,ee,new de(r,a)),this._addCollisionDebugVertex(U,H,E,X,ee,new de(p,a)),this._addCollisionDebugVertex(U,H,E,X,ee,new de(p,v)),this._addCollisionDebugVertex(U,H,E,X,ee,new de(r,v)),D.vertexLength+=4;const ie=T.indexArray;ie.emplaceBack(N,N+1),ie.emplaceBack(N+1,N+2),ie.emplaceBack(N+2,N+3),ie.emplaceBack(N+3,N),D.primitiveLength+=4}addDebugCollisionBoxes(r,a,p,v){for(let T=r;T<a;T++){const E=this.collisionBoxArray.get(T);this.addCollisionDebugVertices(E.x1,E.y1,E.x2,E.y2,v?this.textCollisionBox:this.iconCollisionBox,E.anchorPoint,p)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new S(yt,Yc.members,Ut),this.iconCollisionBox=new S(yt,Yc.members,Ut);for(let r=0;r<this.symbolInstances.length;r++){const a=this.symbolInstances.get(r);this.addDebugCollisionBoxes(a.textBoxStartIndex,a.textBoxEndIndex,a,!0),this.addDebugCollisionBoxes(a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a,!0),this.addDebugCollisionBoxes(a.iconBoxStartIndex,a.iconBoxEndIndex,a,!1),this.addDebugCollisionBoxes(a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex,a,!1)}}_deserializeCollisionBoxesForSymbol(r,a,p,v,T,E,C,D,N){const U={};for(let H=a;H<p;H++){const X=r.get(H);U.textBox={x1:X.x1,y1:X.y1,x2:X.x2,y2:X.y2,anchorPointX:X.anchorPointX,anchorPointY:X.anchorPointY},U.textFeatureIndex=X.featureIndex;break}for(let H=v;H<T;H++){const X=r.get(H);U.verticalTextBox={x1:X.x1,y1:X.y1,x2:X.x2,y2:X.y2,anchorPointX:X.anchorPointX,anchorPointY:X.anchorPointY},U.verticalTextFeatureIndex=X.featureIndex;break}for(let H=E;H<C;H++){const X=r.get(H);U.iconBox={x1:X.x1,y1:X.y1,x2:X.x2,y2:X.y2,anchorPointX:X.anchorPointX,anchorPointY:X.anchorPointY},U.iconFeatureIndex=X.featureIndex;break}for(let H=D;H<N;H++){const X=r.get(H);U.verticalIconBox={x1:X.x1,y1:X.y1,x2:X.x2,y2:X.y2,anchorPointX:X.anchorPointX,anchorPointY:X.anchorPointY},U.verticalIconFeatureIndex=X.featureIndex;break}return U}deserializeCollisionBoxes(r){this.collisionArrays=[];for(let a=0;a<this.symbolInstances.length;a++){const p=this.symbolInstances.get(a);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(r,p.textBoxStartIndex,p.textBoxEndIndex,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p.iconBoxStartIndex,p.iconBoxEndIndex,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(r,a){const p=r.placedSymbolArray.get(a),v=p.vertexStartIndex+4*p.numGlyphs;for(let T=p.vertexStartIndex;T<v;T+=4)r.indexArray.emplaceBack(T,T+2,T+1),r.indexArray.emplaceBack(T+1,T+2,T+3)}getSortedSymbolIndexes(r){if(this.sortedAngle===r&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const a=Math.sin(r),p=Math.cos(r),v=[],T=[],E=[];for(let C=0;C<this.symbolInstances.length;++C){E.push(C);const D=this.symbolInstances.get(C);v.push(0|Math.round(a*D.anchorX+p*D.anchorY)),T.push(D.featureIndex)}return E.sort((C,D)=>v[C]-v[D]||T[D]-T[C]),E}addToSortKeyRanges(r,a){const p=this.sortKeyRanges[this.sortKeyRanges.length-1];p&&p.sortKey===a?p.symbolInstanceEnd=r+1:this.sortKeyRanges.push({sortKey:a,symbolInstanceStart:r,symbolInstanceEnd:r+1})}sortFeatures(r){if(this.sortFeaturesByY&&this.sortedAngle!==r&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(r),this.sortedAngle=r,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const a of this.symbolInstanceIndexes){const p=this.symbolInstances.get(a);this.featureSortOrder.push(p.featureIndex),[p.rightJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.leftJustifiedTextSymbolIndex].forEach((v,T,E)=>{v>=0&&E.indexOf(v)===T&&this.addIndicesForPlacedSymbol(this.text,v)}),p.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,p.verticalPlacedTextSymbolIndex),p.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,p.placedIconSymbolIndex),p.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,p.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let V,$;Gt("SymbolBucket",k,{omit:["layers","collisionBoxArray","features","compareText"]}),k.MAX_GLYPHS=65535,k.addDynamicAttributes=bd;var ue={get paint(){return $=$||new ds({"icon-opacity":new En(ve.paint_symbol["icon-opacity"]),"icon-color":new En(ve.paint_symbol["icon-color"]),"icon-halo-color":new En(ve.paint_symbol["icon-halo-color"]),"icon-halo-width":new En(ve.paint_symbol["icon-halo-width"]),"icon-halo-blur":new En(ve.paint_symbol["icon-halo-blur"]),"icon-translate":new rn(ve.paint_symbol["icon-translate"]),"icon-translate-anchor":new rn(ve.paint_symbol["icon-translate-anchor"]),"text-opacity":new En(ve.paint_symbol["text-opacity"]),"text-color":new En(ve.paint_symbol["text-color"],{runtimeType:Lt,getOverride:l=>l.textColor,hasOverride:l=>!!l.textColor}),"text-halo-color":new En(ve.paint_symbol["text-halo-color"]),"text-halo-width":new En(ve.paint_symbol["text-halo-width"]),"text-halo-blur":new En(ve.paint_symbol["text-halo-blur"]),"text-translate":new rn(ve.paint_symbol["text-translate"]),"text-translate-anchor":new rn(ve.paint_symbol["text-translate-anchor"])})},get layout(){return V=V||new ds({"symbol-placement":new rn(ve.layout_symbol["symbol-placement"]),"symbol-spacing":new rn(ve.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new rn(ve.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new En(ve.layout_symbol["symbol-sort-key"]),"symbol-z-order":new rn(ve.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new rn(ve.layout_symbol["icon-allow-overlap"]),"icon-overlap":new rn(ve.layout_symbol["icon-overlap"]),"icon-ignore-placement":new rn(ve.layout_symbol["icon-ignore-placement"]),"icon-optional":new rn(ve.layout_symbol["icon-optional"]),"icon-rotation-alignment":new rn(ve.layout_symbol["icon-rotation-alignment"]),"icon-size":new En(ve.layout_symbol["icon-size"]),"icon-text-fit":new rn(ve.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new rn(ve.layout_symbol["icon-text-fit-padding"]),"icon-image":new En(ve.layout_symbol["icon-image"]),"icon-rotate":new En(ve.layout_symbol["icon-rotate"]),"icon-padding":new En(ve.layout_symbol["icon-padding"]),"icon-keep-upright":new rn(ve.layout_symbol["icon-keep-upright"]),"icon-offset":new En(ve.layout_symbol["icon-offset"]),"icon-anchor":new En(ve.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new rn(ve.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new rn(ve.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new rn(ve.layout_symbol["text-rotation-alignment"]),"text-field":new En(ve.layout_symbol["text-field"]),"text-font":new En(ve.layout_symbol["text-font"]),"text-size":new En(ve.layout_symbol["text-size"]),"text-max-width":new En(ve.layout_symbol["text-max-width"]),"text-line-height":new rn(ve.layout_symbol["text-line-height"]),"text-letter-spacing":new En(ve.layout_symbol["text-letter-spacing"]),"text-justify":new En(ve.layout_symbol["text-justify"]),"text-radial-offset":new En(ve.layout_symbol["text-radial-offset"]),"text-variable-anchor":new rn(ve.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new En(ve.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new En(ve.layout_symbol["text-anchor"]),"text-max-angle":new rn(ve.layout_symbol["text-max-angle"]),"text-writing-mode":new rn(ve.layout_symbol["text-writing-mode"]),"text-rotate":new En(ve.layout_symbol["text-rotate"]),"text-padding":new rn(ve.layout_symbol["text-padding"]),"text-keep-upright":new rn(ve.layout_symbol["text-keep-upright"]),"text-transform":new En(ve.layout_symbol["text-transform"]),"text-offset":new En(ve.layout_symbol["text-offset"]),"text-allow-overlap":new rn(ve.layout_symbol["text-allow-overlap"]),"text-overlap":new rn(ve.layout_symbol["text-overlap"]),"text-ignore-placement":new rn(ve.layout_symbol["text-ignore-placement"]),"text-optional":new rn(ve.layout_symbol["text-optional"])})}};class Le{constructor(r){if(r.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=r.property.overrides?r.property.overrides.runtimeType:Pn,this.defaultValue=r}evaluate(r){if(r.formattedSection){const a=this.defaultValue.property.overrides;if(a&&a.hasOverride(r.formattedSection))return a.getOverride(r.formattedSection)}return r.feature&&r.featureState?this.defaultValue.evaluate(r.feature,r.featureState):this.defaultValue.property.specification.default}eachChild(r){this.defaultValue.isConstant()||r(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Gt("FormatSectionOverride",Le,{omit:["defaultValue"]});class He extends tl{constructor(r){super(r,ue)}recalculate(r,a){if(super.recalculate(r,a),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const p=this.layout.get("text-writing-mode");if(p){const v=[];for(const T of p)v.indexOf(T)<0&&v.push(T);this.layout._values["text-writing-mode"]=v}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(r,a,p,v){const T=this.layout.get(r).evaluate(a,{},p,v),E=this._unevaluatedLayout._values[r];return E.isDataDriven()||Ja(E.value)||!T?T:function(C,D){return D.replace(/{([^{}]+)}/g,(N,U)=>C&&U in C?String(C[U]):"")}(a.properties,T)}createBucket(r){return new k(r)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const r of ue.paint.overridableProperties){if(!He.hasPaintOverride(this.layout,r))continue;const a=this.paint.get(r),p=new Le(a),v=new Eu(p,a.property.specification);let T=null;T=a.value.kind==="constant"||a.value.kind==="source"?new go("source",v):new Pa("composite",v,a.value.zoomStops),this.paint._values[r]=new Lr(a.property,T,a.parameters)}}_handleOverridablePaintPropertyUpdate(r,a,p){return!(!this.layout||a.isDataDriven()||p.isDataDriven())&&He.hasPaintOverride(this.layout,r)}static hasPaintOverride(r,a){const p=r.get("text-field"),v=ue.paint.properties[a];let T=!1;const E=C=>{for(const D of C)if(v.overrides&&v.overrides.hasOverride(D))return void(T=!0)};if(p.value.kind==="constant"&&p.value.value instanceof _n)E(p.value.value.sections);else if(p.value.kind==="source"){const C=N=>{T||(N instanceof wr&&Bn(N.value)===ts?E(N.value.sections):N instanceof Ws?E(N.sections):N.eachChild(C))},D=p.value;D._styleExpression&&C(D._styleExpression.expression)}return T}}let gt;var Bt={get paint(){return gt=gt||new ds({"background-color":new rn(ve.paint_background["background-color"]),"background-pattern":new Bc(ve.paint_background["background-pattern"]),"background-opacity":new rn(ve.paint_background["background-opacity"])})}};class jt extends tl{constructor(r){super(r,Bt)}}let Ot;var an={get paint(){return Ot=Ot||new ds({"raster-opacity":new rn(ve.paint_raster["raster-opacity"]),"raster-hue-rotate":new rn(ve.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new rn(ve.paint_raster["raster-brightness-min"]),"raster-brightness-max":new rn(ve.paint_raster["raster-brightness-max"]),"raster-saturation":new rn(ve.paint_raster["raster-saturation"]),"raster-contrast":new rn(ve.paint_raster["raster-contrast"]),"raster-resampling":new rn(ve.paint_raster["raster-resampling"]),"raster-fade-duration":new rn(ve.paint_raster["raster-fade-duration"])})}};class yn extends tl{constructor(r){super(r,an)}}class wn extends tl{constructor(r){super(r,{}),this.onAdd=a=>{this.implementation.onAdd&&this.implementation.onAdd(a,a.painter.context.gl)},this.onRemove=a=>{this.implementation.onRemove&&this.implementation.onRemove(a,a.painter.context.gl)},this.implementation=r}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class so{constructor(r){this._methodToThrottle=r,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const ot=63710088e-1;class We{constructor(r,a){if(isNaN(r)||isNaN(a))throw new Error(`Invalid LngLat object: (${r}, ${a})`);if(this.lng=+r,this.lat=+a,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new We(sn(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(r){const a=Math.PI/180,p=this.lat*a,v=r.lat*a,T=Math.sin(p)*Math.sin(v)+Math.cos(p)*Math.cos(v)*Math.cos((r.lng-this.lng)*a);return ot*Math.acos(Math.min(T,1))}static convert(r){if(r instanceof We)return r;if(Array.isArray(r)&&(r.length===2||r.length===3))return new We(Number(r[0]),Number(r[1]));if(!Array.isArray(r)&&typeof r=="object"&&r!==null)return new We(Number("lng"in r?r.lng:r.lon),Number(r.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const lt=2*Math.PI*ot;function qt(l){return lt*Math.cos(l*Math.PI/180)}function bn(l){return(180+l)/360}function Mn(l){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+l*Math.PI/360)))/360}function Rn(l,r){return l/qt(r)}function Un(l){return 360/Math.PI*Math.atan(Math.exp((180-360*l)*Math.PI/180))-90}function Ro(l,r){return l*qt(Un(r))}class yi{constructor(r,a,p=0){this.x=+r,this.y=+a,this.z=+p}static fromLngLat(r,a=0){const p=We.convert(r);return new yi(bn(p.lng),Mn(p.lat),Rn(a,p.lat))}toLngLat(){return new We(360*this.x-180,Un(this.y))}toAltitude(){return Ro(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/lt*(r=Un(this.y),1/Math.cos(r*Math.PI/180));var r}}function fc(l,r,a){var p=2*Math.PI*6378137/256/Math.pow(2,a);return[l*p-2*Math.PI*6378137/2,r*p-2*Math.PI*6378137/2]}class jm{constructor(r,a,p){if(!function(v,T,E){return!(v<0||v>25||E<0||E>=Math.pow(2,v)||T<0||T>=Math.pow(2,v))}(r,a,p))throw new Error(`x=${a}, y=${p}, z=${r} outside of bounds. 0<=x<${Math.pow(2,r)}, 0<=y<${Math.pow(2,r)} 0<=z<=25 `);this.z=r,this.x=a,this.y=p,this.key=bf(0,r,r,a,p)}equals(r){return this.z===r.z&&this.x===r.x&&this.y===r.y}url(r,a,p){const v=(E=this.y,C=this.z,D=fc(256*(T=this.x),256*(E=Math.pow(2,C)-E-1),C),N=fc(256*(T+1),256*(E+1),C),D[0]+","+D[1]+","+N[0]+","+N[1]);var T,E,C,D,N;const U=function(H,X,ee){let ie,ae="";for(let _e=H;_e>0;_e--)ie=1<<_e-1,ae+=(X&ie?1:0)+(ee&ie?2:0);return ae}(this.z,this.x,this.y);return r[(this.x+this.y)%r.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(p==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,a>1?"@2x":"").replace(/{quadkey}/g,U).replace(/{bbox-epsg-3857}/g,v)}isChildOf(r){const a=this.z-r.z;return a>0&&r.x===this.x>>a&&r.y===this.y>>a}getTilePoint(r){const a=Math.pow(2,this.z);return new de((r.x*a-this.x)*dn,(r.y*a-this.y)*dn)}toString(){return`${this.z}/${this.x}/${this.y}`}}class zw{constructor(r,a){this.wrap=r,this.canonical=a,this.key=bf(r,a.z,a.z,a.x,a.y)}}class cu{constructor(r,a,p,v,T){if(this.terrainRttPosMatrix32f=null,r<p)throw new Error(`overscaledZ should be >= z; overscaledZ = ${r}; z = ${p}`);this.overscaledZ=r,this.wrap=a,this.canonical=new jm(p,+v,+T),this.key=bf(a,r,p,v,T)}clone(){return new cu(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(r){return this.overscaledZ===r.overscaledZ&&this.wrap===r.wrap&&this.canonical.equals(r.canonical)}scaledTo(r){if(r>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${r}; overscaledZ = ${this.overscaledZ}`);const a=this.canonical.z-r;return r>this.canonical.z?new cu(r,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new cu(r,this.wrap,r,this.canonical.x>>a,this.canonical.y>>a)}calculateScaledKey(r,a){if(r>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${r}; overscaledZ = ${this.overscaledZ}`);const p=this.canonical.z-r;return r>this.canonical.z?bf(this.wrap*+a,r,this.canonical.z,this.canonical.x,this.canonical.y):bf(this.wrap*+a,r,r,this.canonical.x>>p,this.canonical.y>>p)}isChildOf(r){if(r.wrap!==this.wrap)return!1;const a=this.canonical.z-r.canonical.z;return r.overscaledZ===0||r.overscaledZ<this.overscaledZ&&r.canonical.x===this.canonical.x>>a&&r.canonical.y===this.canonical.y>>a}children(r){if(this.overscaledZ>=r)return[new cu(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const a=this.canonical.z+1,p=2*this.canonical.x,v=2*this.canonical.y;return[new cu(a,this.wrap,a,p,v),new cu(a,this.wrap,a,p+1,v),new cu(a,this.wrap,a,p,v+1),new cu(a,this.wrap,a,p+1,v+1)]}isLessThan(r){return this.wrap<r.wrap||!(this.wrap>r.wrap)&&(this.overscaledZ<r.overscaledZ||!(this.overscaledZ>r.overscaledZ)&&(this.canonical.x<r.canonical.x||!(this.canonical.x>r.canonical.x)&&this.canonical.y<r.canonical.y))}wrapped(){return new cu(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(r){return new cu(this.overscaledZ,r,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new zw(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(r){return this.canonical.getTilePoint(new yi(r.x-this.wrap,r.y))}}function bf(l,r,a,p,v){(l*=2)<0&&(l=-1*l-1);const T=1<<a;return(T*T*l+T*v+p).toString(36)+a.toString(36)+r.toString(36)}Gt("CanonicalTileID",jm),Gt("OverscaledTileID",cu,{omit:["terrainRttPosMatrix32f"]});class Nw{constructor(r,a,p,v=1,T=1,E=1,C=0){if(this.uid=r,a.height!==a.width)throw new RangeError("DEM tiles must be square");if(p&&!["mapbox","terrarium","custom"].includes(p))return void Ji(`"${p}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=a.height;const D=this.dim=a.height-2;switch(this.data=new Uint32Array(a.data.buffer),p){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=v,this.greenFactor=T,this.blueFactor=E,this.baseShift=C;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let N=0;N<D;N++)this.data[this._idx(-1,N)]=this.data[this._idx(0,N)],this.data[this._idx(D,N)]=this.data[this._idx(D-1,N)],this.data[this._idx(N,-1)]=this.data[this._idx(N,0)],this.data[this._idx(N,D)]=this.data[this._idx(N,D-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(D,-1)]=this.data[this._idx(D-1,0)],this.data[this._idx(-1,D)]=this.data[this._idx(0,D-1)],this.data[this._idx(D,D)]=this.data[this._idx(D-1,D-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let N=0;N<D;N++)for(let U=0;U<D;U++){const H=this.get(N,U);H>this.max&&(this.max=H),H<this.min&&(this.min=H)}}get(r,a){const p=new Uint8Array(this.data.buffer),v=4*this._idx(r,a);return this.unpack(p[v],p[v+1],p[v+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(r,a){if(r<-1||r>=this.dim+1||a<-1||a>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(a+1)*this.stride+(r+1)}unpack(r,a,p){return r*this.redFactor+a*this.greenFactor+p*this.blueFactor-this.baseShift}getPixels(){return new za({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(r,a,p){if(this.dim!==r.dim)throw new Error("dem dimension mismatch");let v=a*this.dim,T=a*this.dim+this.dim,E=p*this.dim,C=p*this.dim+this.dim;switch(a){case-1:v=T-1;break;case 1:T=v+1}switch(p){case-1:E=C-1;break;case 1:C=E+1}const D=-a*this.dim,N=-p*this.dim;for(let U=E;U<C;U++)for(let H=v;H<T;H++)this.data[this._idx(H,U)]=r.data[this._idx(H+D,U+N)]}}Gt("DEMData",Nw);class Ow{constructor(r){this._stringToNumber={},this._numberToString=[];for(let a=0;a<r.length;a++){const p=r[a];this._stringToNumber[p]=a,this._numberToString[a]=p}}encode(r){return this._stringToNumber[r]}decode(r){if(r>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${r} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[r]}}class Fw{constructor(r,a,p,v,T){this.type="Feature",this._vectorTileFeature=r,r._z=a,r._x=p,r._y=v,this.properties=r.properties,this.id=T}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(r){this._geometry=r}toJSON(){const r={geometry:this.geometry};for(const a in this)a!=="_geometry"&&a!=="_vectorTileFeature"&&(r[a]=this[a]);return r}}class Bw{constructor(r,a){this.tileID=r,this.x=r.canonical.x,this.y=r.canonical.y,this.z=r.canonical.z,this.grid=new Mr(dn,16,0),this.grid3D=new Mr(dn,16,0),this.featureIndexArray=new we,this.promoteId=a}insert(r,a,p,v,T,E){const C=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(p,v,T);const D=E?this.grid3D:this.grid;for(let N=0;N<a.length;N++){const U=a[N],H=[1/0,1/0,-1/0,-1/0];for(let X=0;X<U.length;X++){const ee=U[X];H[0]=Math.min(H[0],ee.x),H[1]=Math.min(H[1],ee.y),H[2]=Math.max(H[2],ee.x),H[3]=Math.max(H[3],ee.y)}H[0]<dn&&H[1]<dn&&H[2]>=0&&H[3]>=0&&D.insert(C,H[0],H[1],H[2],H[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Ur.VectorTile(new hc(this.rawTileData)).layers,this.sourceLayerCoder=new Ow(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(r,a,p,v){this.loadVTLayers();const T=r.params,E=dn/r.tileSize/r.scale,C=Iu(T.filter),D=r.queryGeometry,N=r.queryPadding*E,U=Uw(D),H=this.grid.query(U.minX-N,U.minY-N,U.maxX+N,U.maxY+N),X=Uw(r.cameraQueryGeometry),ee=this.grid3D.query(X.minX-N,X.minY-N,X.maxX+N,X.maxY+N,(_e,Ee,je,ke)=>function(J,me,Me,st,Pt){for(const _t of J)if(me<=_t.x&&Me<=_t.y&&st>=_t.x&&Pt>=_t.y)return!0;const ct=[new de(me,Me),new de(me,Pt),new de(st,Pt),new de(st,Me)];if(J.length>2){for(const _t of ct)if(qc(J,_t))return!0}for(let _t=0;_t<J.length-1;_t++)if(cd(J[_t],J[_t+1],ct))return!0;return!1}(r.cameraQueryGeometry,_e-N,Ee-N,je+N,ke+N));for(const _e of ee)H.push(_e);H.sort(cP);const ie={};let ae;for(let _e=0;_e<H.length;_e++){const Ee=H[_e];if(Ee===ae)continue;ae=Ee;const je=this.featureIndexArray.get(Ee);let ke=null;this.loadMatchingFeature(ie,je.bucketIndex,je.sourceLayerIndex,je.featureIndex,C,T.layers,T.availableImages,a,p,v,(J,me,Me)=>(ke||(ke=tc(J)),me.queryIntersectsFeature({queryGeometry:D,feature:J,featureState:Me,geometry:ke,zoom:this.z,transform:r.transform,pixelsToTileUnits:E,pixelPosMatrix:r.pixelPosMatrix})))}return ie}loadMatchingFeature(r,a,p,v,T,E,C,D,N,U,H){const X=this.bucketLayerIDs[a];if(E&&!X.some(_e=>E.has(_e)))return;const ee=this.sourceLayerCoder.decode(p),ie=this.vtLayers[ee].feature(v);if(T.needGeometry){const _e=Du(ie,!0);if(!T.filter(new bi(this.tileID.overscaledZ),_e,this.tileID.canonical))return}else if(!T.filter(new bi(this.tileID.overscaledZ),ie))return;const ae=this.getId(ie,ee);for(let _e=0;_e<X.length;_e++){const Ee=X[_e];if(E&&!E.has(Ee))continue;const je=D[Ee];if(!je)continue;let ke={};ae&&U&&(ke=U.getState(je.sourceLayer||"_geojsonTileLayer",ae));const J=Xt({},N[Ee]);J.paint=Vw(J.paint,je.paint,ie,ke,C),J.layout=Vw(J.layout,je.layout,ie,ke,C);const me=!H||H(ie,je,ke);if(!me)continue;const Me=new Fw(ie,this.z,this.x,this.y,ae);Me.layer=J;let st=r[Ee];st===void 0&&(st=r[Ee]=[]),st.push({featureIndex:v,feature:Me,intersectionZ:me})}}lookupSymbolFeatures(r,a,p,v,T,E,C,D){const N={};this.loadVTLayers();const U=Iu(T);for(const H of r)this.loadMatchingFeature(N,p,v,H,U,E,C,D,a);return N}hasLayer(r){for(const a of this.bucketLayerIDs)for(const p of a)if(r===p)return!0;return!1}getId(r,a){var p;let v=r.id;return this.promoteId&&(v=r.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[a]],typeof v=="boolean"&&(v=Number(v)),v===void 0&&(!((p=r.properties)===null||p===void 0)&&p.cluster)&&this.promoteId&&(v=Number(r.properties.cluster_id))),v}}function Vw(l,r,a,p,v){return Fn(l,(T,E)=>{const C=r instanceof Qi?r.get(E):null;return C&&C.evaluate?C.evaluate(a,p,v):C})}function Uw(l){let r=1/0,a=1/0,p=-1/0,v=-1/0;for(const T of l)r=Math.min(r,T.x),a=Math.min(a,T.y),p=Math.max(p,T.x),v=Math.max(v,T.y);return{minX:r,minY:a,maxX:p,maxY:v}}function cP(l,r){return r-l}function jw(l,r,a,p,v){const T=[];for(let E=0;E<l.length;E++){const C=l[E];let D;for(let N=0;N<C.length-1;N++){let U=C[N],H=C[N+1];U.x<r&&H.x<r||(U.x<r?U=new de(r,U.y+(r-U.x)/(H.x-U.x)*(H.y-U.y))._round():H.x<r&&(H=new de(r,U.y+(r-U.x)/(H.x-U.x)*(H.y-U.y))._round()),U.y<a&&H.y<a||(U.y<a?U=new de(U.x+(a-U.y)/(H.y-U.y)*(H.x-U.x),a)._round():H.y<a&&(H=new de(U.x+(a-U.y)/(H.y-U.y)*(H.x-U.x),a)._round()),U.x>=p&&H.x>=p||(U.x>=p?U=new de(p,U.y+(p-U.x)/(H.x-U.x)*(H.y-U.y))._round():H.x>=p&&(H=new de(p,U.y+(p-U.x)/(H.x-U.x)*(H.y-U.y))._round()),U.y>=v&&H.y>=v||(U.y>=v?U=new de(U.x+(v-U.y)/(H.y-U.y)*(H.x-U.x),v)._round():H.y>=v&&(H=new de(U.x+(v-U.y)/(H.y-U.y)*(H.x-U.x),v)._round()),D&&U.equals(D[D.length-1])||(D=[U],T.push(D)),D.push(H)))))}}return T}Gt("FeatureIndex",Bw,{omit:["rawTileData","sourceLayerCoder"]});class Td extends de{constructor(r,a,p,v){super(r,a),this.angle=p,v!==void 0&&(this.segment=v)}clone(){return new Td(this.x,this.y,this.angle,this.segment)}}function $w(l,r,a,p,v){if(r.segment===void 0||a===0)return!0;let T=r,E=r.segment+1,C=0;for(;C>-a/2;){if(E--,E<0)return!1;C-=l[E].dist(T),T=l[E]}C+=l[E].dist(l[E+1]),E++;const D=[];let N=0;for(;C<a/2;){const U=l[E],H=l[E+1];if(!H)return!1;let X=l[E-1].angleTo(U)-U.angleTo(H);for(X=Math.abs((X+3*Math.PI)%(2*Math.PI)-Math.PI),D.push({distance:C,angleDelta:X}),N+=X;C-D[0].distance>p;)N-=D.shift().angleDelta;if(N>v)return!1;E++,C+=U.dist(H)}return!0}function Hw(l){let r=0;for(let a=0;a<l.length-1;a++)r+=l[a].dist(l[a+1]);return r}function qw(l,r,a){return l?.6*r*a:0}function Gw(l,r){return Math.max(l?l.right-l.left:0,r?r.right-r.left:0)}function hP(l,r,a,p,v,T){const E=qw(a,v,T),C=Gw(a,p)*T;let D=0;const N=Hw(l)/2;for(let U=0;U<l.length-1;U++){const H=l[U],X=l[U+1],ee=H.dist(X);if(D+ee>N){const ie=(N-D)/ee,ae=mo.number(H.x,X.x,ie),_e=mo.number(H.y,X.y,ie),Ee=new Td(ae,_e,X.angleTo(H),U);return Ee._round(),!E||$w(l,Ee,C,E,r)?Ee:void 0}D+=ee}}function dP(l,r,a,p,v,T,E,C,D){const N=qw(p,T,E),U=Gw(p,v),H=U*E,X=l[0].x===0||l[0].x===D||l[0].y===0||l[0].y===D;return r-H<r/4&&(r=H+r/4),Zw(l,X?r/2*C%r:(U/2+2*T)*E*C%r,r,N,a,H,X,!1,D)}function Zw(l,r,a,p,v,T,E,C,D){const N=T/2,U=Hw(l);let H=0,X=r-a,ee=[];for(let ie=0;ie<l.length-1;ie++){const ae=l[ie],_e=l[ie+1],Ee=ae.dist(_e),je=_e.angleTo(ae);for(;X+a<H+Ee;){X+=a;const ke=(X-H)/Ee,J=mo.number(ae.x,_e.x,ke),me=mo.number(ae.y,_e.y,ke);if(J>=0&&J<D&&me>=0&&me<D&&X-N>=0&&X+N<=U){const Me=new Td(J,me,je,ie);Me._round(),p&&!$w(l,Me,T,p,v)||ee.push(Me)}}H+=Ee}return C||ee.length||E||(ee=Zw(l,H/2,a,p,v,T,E,!0,D)),ee}Gt("Anchor",Td);const $m=ca;function Ww(l,r,a,p){const v=[],T=l.image,E=T.pixelRatio,C=T.paddedRect.w-2*$m,D=T.paddedRect.h-2*$m;let N={x1:l.left,y1:l.top,x2:l.right,y2:l.bottom};const U=T.stretchX||[[0,C]],H=T.stretchY||[[0,D]],X=(bt,on)=>bt+on[1]-on[0],ee=U.reduce(X,0),ie=H.reduce(X,0),ae=C-ee,_e=D-ie;let Ee=0,je=ee,ke=0,J=ie,me=0,Me=ae,st=0,Pt=_e;if(T.content&&p){const bt=T.content,on=bt[2]-bt[0],Cn=bt[3]-bt[1];(T.textFitWidth||T.textFitHeight)&&(N=xf(l)),Ee=y_(U,0,bt[0]),ke=y_(H,0,bt[1]),je=y_(U,bt[0],bt[2]),J=y_(H,bt[1],bt[3]),me=bt[0]-Ee,st=bt[1]-ke,Me=on-je,Pt=Cn-J}const ct=N.x1,_t=N.y1,Dt=N.x2-ct,Ct=N.y2-_t,Ft=(bt,on,Cn,Tn)=>{const cn=v_(bt.stretch-Ee,je,Dt,ct),di=x_(bt.fixed-me,Me,bt.stretch,ee),jr=v_(on.stretch-ke,J,Ct,_t),Lo=x_(on.fixed-st,Pt,on.stretch,ie),Us=v_(Cn.stretch-Ee,je,Dt,ct),hu=x_(Cn.fixed-me,Me,Cn.stretch,ee),ol=v_(Tn.stretch-ke,J,Ct,_t),ms=x_(Tn.fixed-st,Pt,Tn.stretch,ie),Dr=new de(cn,jr),Go=new de(Us,jr),gs=new de(Us,ol),_s=new de(cn,ol),Ba=new de(di/E,Lo/E),du=new de(hu/E,ms/E),Zo=r*Math.PI/180;if(Zo){const Wo=Math.sin(Zo),Ko=Math.cos(Zo),vo=[Ko,-Wo,Wo,Ko];Dr._matMult(vo),Go._matMult(vo),_s._matMult(vo),gs._matMult(vo)}const sl=bt.stretch+bt.fixed,Do=on.stretch+on.fixed;return{tl:Dr,tr:Go,bl:_s,br:gs,tex:{x:T.paddedRect.x+$m+sl,y:T.paddedRect.y+$m+Do,w:Cn.stretch+Cn.fixed-sl,h:Tn.stretch+Tn.fixed-Do},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ba,pixelOffsetBR:du,minFontScaleX:Me/E/Dt,minFontScaleY:Pt/E/Ct,isSDF:a}};if(p&&(T.stretchX||T.stretchY)){const bt=Kw(U,ae,ee),on=Kw(H,_e,ie);for(let Cn=0;Cn<bt.length-1;Cn++){const Tn=bt[Cn],cn=bt[Cn+1];for(let di=0;di<on.length-1;di++)v.push(Ft(Tn,on[di],cn,on[di+1]))}}else v.push(Ft({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:C+1},{fixed:0,stretch:D+1}));return v}function y_(l,r,a){let p=0;for(const v of l)p+=Math.max(r,Math.min(a,v[1]))-Math.max(r,Math.min(a,v[0]));return p}function Kw(l,r,a){const p=[{fixed:-1,stretch:0}];for(const[v,T]of l){const E=p[p.length-1];p.push({fixed:v-E.stretch,stretch:E.stretch}),p.push({fixed:v-E.stretch,stretch:E.stretch+(T-v)})}return p.push({fixed:r+$m,stretch:a}),p}function v_(l,r,a,p){return l/r*a+p}function x_(l,r,a,p){return l-r*a/p}class w_{constructor(r,a,p,v,T,E,C,D,N,U){var H;if(this.boxStartIndex=r.length,N){let X=E.top,ee=E.bottom;const ie=E.collisionPadding;ie&&(X-=ie[1],ee+=ie[3]);let ae=ee-X;ae>0&&(ae=Math.max(10,ae),this.circleDiameter=ae)}else{const X=!((H=E.image)===null||H===void 0)&&H.content&&(E.image.textFitWidth||E.image.textFitHeight)?xf(E):{x1:E.left,y1:E.top,x2:E.right,y2:E.bottom};X.y1=X.y1*C-D[0],X.y2=X.y2*C+D[2],X.x1=X.x1*C-D[3],X.x2=X.x2*C+D[1];const ee=E.collisionPadding;if(ee&&(X.x1-=ee[0]*C,X.y1-=ee[1]*C,X.x2+=ee[2]*C,X.y2+=ee[3]*C),U){const ie=new de(X.x1,X.y1),ae=new de(X.x2,X.y1),_e=new de(X.x1,X.y2),Ee=new de(X.x2,X.y2),je=U*Math.PI/180;ie._rotate(je),ae._rotate(je),_e._rotate(je),Ee._rotate(je),X.x1=Math.min(ie.x,ae.x,_e.x,Ee.x),X.x2=Math.max(ie.x,ae.x,_e.x,Ee.x),X.y1=Math.min(ie.y,ae.y,_e.y,Ee.y),X.y2=Math.max(ie.y,ae.y,_e.y,Ee.y)}r.emplaceBack(a.x,a.y,X.x1,X.y1,X.x2,X.y2,p,v,T)}this.boxEndIndex=r.length}}class pP{constructor(r=[],a=(p,v)=>p<v?-1:p>v?1:0){if(this.data=r,this.length=this.data.length,this.compare=a,this.length>0)for(let p=(this.length>>1)-1;p>=0;p--)this._down(p)}push(r){this.data.push(r),this._up(this.length++)}pop(){if(this.length===0)return;const r=this.data[0],a=this.data.pop();return--this.length>0&&(this.data[0]=a,this._down(0)),r}peek(){return this.data[0]}_up(r){const{data:a,compare:p}=this,v=a[r];for(;r>0;){const T=r-1>>1,E=a[T];if(p(v,E)>=0)break;a[r]=E,r=T}a[r]=v}_down(r){const{data:a,compare:p}=this,v=this.length>>1,T=a[r];for(;r<v;){let E=1+(r<<1);const C=E+1;if(C<this.length&&p(a[C],a[E])<0&&(E=C),p(a[E],T)>=0)break;a[r]=a[E],r=E}a[r]=T}}function fP(l,r=1,a=!1){let p=1/0,v=1/0,T=-1/0,E=-1/0;const C=l[0];for(let ee=0;ee<C.length;ee++){const ie=C[ee];(!ee||ie.x<p)&&(p=ie.x),(!ee||ie.y<v)&&(v=ie.y),(!ee||ie.x>T)&&(T=ie.x),(!ee||ie.y>E)&&(E=ie.y)}const D=Math.min(T-p,E-v);let N=D/2;const U=new pP([],mP);if(D===0)return new de(p,v);for(let ee=p;ee<T;ee+=D)for(let ie=v;ie<E;ie+=D)U.push(new Tf(ee+N,ie+N,N,l));let H=function(ee){let ie=0,ae=0,_e=0;const Ee=ee[0];for(let je=0,ke=Ee.length,J=ke-1;je<ke;J=je++){const me=Ee[je],Me=Ee[J],st=me.x*Me.y-Me.x*me.y;ae+=(me.x+Me.x)*st,_e+=(me.y+Me.y)*st,ie+=3*st}return new Tf(ae/ie,_e/ie,0,ee)}(l),X=U.length;for(;U.length;){const ee=U.pop();(ee.d>H.d||!H.d)&&(H=ee,a&&console.log("found best %d after %d probes",Math.round(1e4*ee.d)/1e4,X)),ee.max-H.d<=r||(N=ee.h/2,U.push(new Tf(ee.p.x-N,ee.p.y-N,N,l)),U.push(new Tf(ee.p.x+N,ee.p.y-N,N,l)),U.push(new Tf(ee.p.x-N,ee.p.y+N,N,l)),U.push(new Tf(ee.p.x+N,ee.p.y+N,N,l)),X+=4)}return a&&(console.log(`num probes: ${X}`),console.log(`best distance: ${H.d}`)),H.p}function mP(l,r){return r.max-l.max}function Tf(l,r,a,p){this.p=new de(l,r),this.h=a,this.d=function(v,T){let E=!1,C=1/0;for(let D=0;D<T.length;D++){const N=T[D];for(let U=0,H=N.length,X=H-1;U<H;X=U++){const ee=N[U],ie=N[X];ee.y>v.y!=ie.y>v.y&&v.x<(ie.x-ee.x)*(v.y-ee.y)/(ie.y-ee.y)+ee.x&&(E=!E),C=Math.min(C,fm(v,ee,ie))}}return(E?1:-1)*Math.sqrt(C)}(this.p,p),this.max=this.d+this.h*Math.SQRT2}var Vs;_.av=void 0,(Vs=_.av||(_.av={}))[Vs.center=1]="center",Vs[Vs.left=2]="left",Vs[Vs.right=3]="right",Vs[Vs.top=4]="top",Vs[Vs.bottom=5]="bottom",Vs[Vs["top-left"]=6]="top-left",Vs[Vs["top-right"]=7]="top-right",Vs[Vs["bottom-left"]=8]="bottom-left",Vs[Vs["bottom-right"]=9]="bottom-right";const Sd=7,Iv=Number.POSITIVE_INFINITY;function Xw(l,r){return r[1]!==Iv?function(a,p,v){let T=0,E=0;switch(p=Math.abs(p),v=Math.abs(v),a){case"top-right":case"top-left":case"top":E=v-Sd;break;case"bottom-right":case"bottom-left":case"bottom":E=-v+Sd}switch(a){case"top-right":case"bottom-right":case"right":T=-p;break;case"top-left":case"bottom-left":case"left":T=p}return[T,E]}(l,r[0],r[1]):function(a,p){let v=0,T=0;p<0&&(p=0);const E=p/Math.SQRT2;switch(a){case"top-right":case"top-left":T=E-Sd;break;case"bottom-right":case"bottom-left":T=-E+Sd;break;case"bottom":T=-p+Sd;break;case"top":T=p-Sd}switch(a){case"top-right":case"bottom-right":v=-E;break;case"top-left":case"bottom-left":v=E;break;case"left":v=p;break;case"right":v=-p}return[v,T]}(l,r[0])}function Yw(l,r,a){var p;const v=l.layout,T=(p=v.get("text-variable-anchor-offset"))===null||p===void 0?void 0:p.evaluate(r,{},a);if(T){const C=T.values,D=[];for(let N=0;N<C.length;N+=2){const U=D[N]=C[N],H=C[N+1].map(X=>X*oo);U.startsWith("top")?H[1]-=Sd:U.startsWith("bottom")&&(H[1]+=Sd),D[N+1]=H}return new Er(D)}const E=v.get("text-variable-anchor");if(E){let C;C=l._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[v.get("text-radial-offset").evaluate(r,{},a)*oo,Iv]:v.get("text-offset").evaluate(r,{},a).map(N=>N*oo);const D=[];for(const N of E)D.push(N,Xw(N,C));return new Er(D)}return null}function Pv(l){switch(l){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function gP(l,r,a,p,v,T,E,C,D,N,U,H){let X=T.textMaxSize.evaluate(r,{});X===void 0&&(X=E);const ee=l.layers[0].layout,ie=ee.get("icon-offset").evaluate(r,{},U),ae=Jw(a.horizontal),_e=E/24,Ee=l.tilePixelRatio*_e,je=l.tilePixelRatio*X/24,ke=l.tilePixelRatio*C,J=l.tilePixelRatio*ee.get("symbol-spacing"),me=ee.get("text-padding")*l.tilePixelRatio,Me=function(Cn,Tn,cn,di=1){const jr=Cn.get("icon-padding").evaluate(Tn,{},cn),Lo=jr&&jr.values;return[Lo[0]*di,Lo[1]*di,Lo[2]*di,Lo[3]*di]}(ee,r,U,l.tilePixelRatio),st=ee.get("text-max-angle")/180*Math.PI,Pt=ee.get("text-rotation-alignment")!=="viewport"&&ee.get("symbol-placement")!=="point",ct=ee.get("icon-rotation-alignment")==="map"&&ee.get("symbol-placement")!=="point",_t=ee.get("symbol-placement"),Dt=J/2,Ct=ee.get("icon-text-fit");let Ft;p&&Ct!=="none"&&(l.allowVerticalPlacement&&a.vertical&&(Ft=hp(p,a.vertical,Ct,ee.get("icon-text-fit-padding"),ie,_e)),ae&&(p=hp(p,ae,Ct,ee.get("icon-text-fit-padding"),ie,_e)));const bt=U?H.line.getGranularityForZoomLevel(U.z):1,on=(Cn,Tn)=>{Tn.x<0||Tn.x>=dn||Tn.y<0||Tn.y>=dn||function(cn,di,jr,Lo,Us,hu,ol,ms,Dr,Go,gs,_s,Ba,du,Zo,sl,Do,Wo,Ko,vo,Tr,mc,Sf,gc,vP){const Ef=cn.addToLineVertexArray(di,jr);let pp,If,Pf,Cf,ib=0,rb=0,ob=0,sb=0,zv=-1,Nv=-1;const jh={};let ab=Or("");if(cn.allowVerticalPlacement&&Lo.vertical){const ha=ms.layout.get("text-rotate").evaluate(Tr,{},gc)+90;Pf=new w_(Dr,di,Go,gs,_s,Lo.vertical,Ba,du,Zo,ha),ol&&(Cf=new w_(Dr,di,Go,gs,_s,ol,Do,Wo,Zo,ha))}if(Us){const ha=ms.layout.get("icon-rotate").evaluate(Tr,{}),pu=ms.layout.get("icon-text-fit")!=="none",fp=Ww(Us,ha,Sf,pu),yc=ol?Ww(ol,ha,Sf,pu):void 0;If=new w_(Dr,di,Go,gs,_s,Us,Do,Wo,!1,ha),ib=4*fp.length;const mp=cn.iconSizeData;let Jc=null;mp.kind==="source"?(Jc=[rl*ms.layout.get("icon-size").evaluate(Tr,{})],Jc[0]>pc&&Ji(`${cn.layerIds[0]}: Value for "icon-size" is >= ${Uh}. Reduce your "icon-size".`)):mp.kind==="composite"&&(Jc=[rl*mc.compositeIconSizes[0].evaluate(Tr,{},gc),rl*mc.compositeIconSizes[1].evaluate(Tr,{},gc)],(Jc[0]>pc||Jc[1]>pc)&&Ji(`${cn.layerIds[0]}: Value for "icon-size" is >= ${Uh}. Reduce your "icon-size".`)),cn.addSymbols(cn.icon,fp,Jc,vo,Ko,Tr,_.ai.none,di,Ef.lineStartIndex,Ef.lineLength,-1,gc),zv=cn.icon.placedSymbolArray.length-1,yc&&(rb=4*yc.length,cn.addSymbols(cn.icon,yc,Jc,vo,Ko,Tr,_.ai.vertical,di,Ef.lineStartIndex,Ef.lineLength,-1,gc),Nv=cn.icon.placedSymbolArray.length-1)}const lb=Object.keys(Lo.horizontal);for(const ha of lb){const pu=Lo.horizontal[ha];if(!pp){ab=Or(pu.text);const yc=ms.layout.get("text-rotate").evaluate(Tr,{},gc);pp=new w_(Dr,di,Go,gs,_s,pu,Ba,du,Zo,yc)}const fp=pu.positionedLines.length===1;if(ob+=Qw(cn,di,pu,hu,ms,Zo,Tr,sl,Ef,Lo.vertical?_.ai.horizontal:_.ai.horizontalOnly,fp?lb:[ha],jh,zv,mc,gc),fp)break}Lo.vertical&&(sb+=Qw(cn,di,Lo.vertical,hu,ms,Zo,Tr,sl,Ef,_.ai.vertical,["vertical"],jh,Nv,mc,gc));const xP=pp?pp.boxStartIndex:cn.collisionBoxArray.length,wP=pp?pp.boxEndIndex:cn.collisionBoxArray.length,bP=Pf?Pf.boxStartIndex:cn.collisionBoxArray.length,TP=Pf?Pf.boxEndIndex:cn.collisionBoxArray.length,SP=If?If.boxStartIndex:cn.collisionBoxArray.length,EP=If?If.boxEndIndex:cn.collisionBoxArray.length,IP=Cf?Cf.boxStartIndex:cn.collisionBoxArray.length,PP=Cf?Cf.boxEndIndex:cn.collisionBoxArray.length;let _c=-1;const T_=(ha,pu)=>ha&&ha.circleDiameter?Math.max(ha.circleDiameter,pu):pu;_c=T_(pp,_c),_c=T_(Pf,_c),_c=T_(If,_c),_c=T_(Cf,_c);const ub=_c>-1?1:0;ub&&(_c*=vP/oo),cn.glyphOffsetArray.length>=k.MAX_GLYPHS&&Ji("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Tr.sortKey!==void 0&&cn.addToSortKeyRanges(cn.symbolInstances.length,Tr.sortKey);const CP=Yw(ms,Tr,gc),[AP,kP]=function(ha,pu){const fp=ha.length,yc=pu?.values;if(yc?.length>0)for(let mp=0;mp<yc.length;mp+=2){const Jc=yc[mp+1];ha.emplaceBack(_.av[yc[mp]],Jc[0],Jc[1])}return[fp,ha.length]}(cn.textAnchorOffsets,CP);cn.symbolInstances.emplaceBack(di.x,di.y,jh.right>=0?jh.right:-1,jh.center>=0?jh.center:-1,jh.left>=0?jh.left:-1,jh.vertical||-1,zv,Nv,ab,xP,wP,bP,TP,SP,EP,IP,PP,Go,ob,sb,ib,rb,ub,0,Ba,_c,AP,kP)}(l,Tn,Cn,a,p,v,Ft,l.layers[0],l.collisionBoxArray,r.index,r.sourceLayerIndex,l.index,Ee,[me,me,me,me],Pt,D,ke,Me,ct,ie,r,T,N,U,E)};if(_t==="line")for(const Cn of jw(r.geometry,0,0,dn,dn)){const Tn=Br(Cn,bt),cn=dP(Tn,J,st,a.vertical||ae,p,24,je,l.overscaling,dn);for(const di of cn)ae&&_P(l,ae.text,Dt,di)||on(Tn,di)}else if(_t==="line-center"){for(const Cn of r.geometry)if(Cn.length>1){const Tn=Br(Cn,bt),cn=hP(Tn,st,a.vertical||ae,p,24,je);cn&&on(Tn,cn)}}else if(r.type==="Polygon")for(const Cn of wi(r.geometry,0)){const Tn=fP(Cn,16);on(Br(Cn[0],bt,!0),new Td(Tn.x,Tn.y,0))}else if(r.type==="LineString")for(const Cn of r.geometry){const Tn=Br(Cn,bt);on(Tn,new Td(Tn[0].x,Tn[0].y,0))}else if(r.type==="Point")for(const Cn of r.geometry)for(const Tn of Cn)on([Tn],new Td(Tn.x,Tn.y,0))}function Qw(l,r,a,p,v,T,E,C,D,N,U,H,X,ee,ie){const ae=function(je,ke,J,me,Me,st,Pt,ct){const _t=me.layout.get("text-rotate").evaluate(st,{})*Math.PI/180,Dt=[];for(const Ct of ke.positionedLines)for(const Ft of Ct.positionedGlyphs){if(!Ft.rect)continue;const bt=Ft.rect||{};let on=Tv+1,Cn=!0,Tn=1,cn=0;const di=(Me||ct)&&Ft.vertical,jr=Ft.metrics.advance*Ft.scale/2;if(ct&&ke.verticalizable&&(cn=Ct.lineOffset/2-(Ft.imageName?-(oo-Ft.metrics.width*Ft.scale)/2:(Ft.scale-1)*oo)),Ft.imageName){const Wo=Pt[Ft.imageName];Cn=Wo.sdf,Tn=Wo.pixelRatio,on=ca/Tn}const Lo=Me?[Ft.x+jr,Ft.y]:[0,0];let Us=Me?[0,0]:[Ft.x+jr+J[0],Ft.y+J[1]-cn],hu=[0,0];di&&(hu=Us,Us=[0,0]);const ol=Ft.metrics.isDoubleResolution?2:1,ms=(Ft.metrics.left-on)*Ft.scale-jr+Us[0],Dr=(-Ft.metrics.top-on)*Ft.scale+Us[1],Go=ms+bt.w/ol*Ft.scale/Tn,gs=Dr+bt.h/ol*Ft.scale/Tn,_s=new de(ms,Dr),Ba=new de(Go,Dr),du=new de(ms,gs),Zo=new de(Go,gs);if(di){const Wo=new de(-jr,jr-pf),Ko=-Math.PI/2,vo=oo/2-jr,Tr=new de(5-pf-vo,-(Ft.imageName?vo:0)),mc=new de(...hu);_s._rotateAround(Ko,Wo)._add(Tr)._add(mc),Ba._rotateAround(Ko,Wo)._add(Tr)._add(mc),du._rotateAround(Ko,Wo)._add(Tr)._add(mc),Zo._rotateAround(Ko,Wo)._add(Tr)._add(mc)}if(_t){const Wo=Math.sin(_t),Ko=Math.cos(_t),vo=[Ko,-Wo,Wo,Ko];_s._matMult(vo),Ba._matMult(vo),du._matMult(vo),Zo._matMult(vo)}const sl=new de(0,0),Do=new de(0,0);Dt.push({tl:_s,tr:Ba,bl:du,br:Zo,tex:bt,writingMode:ke.writingMode,glyphOffset:Lo,sectionIndex:Ft.sectionIndex,isSDF:Cn,pixelOffsetTL:sl,pixelOffsetBR:Do,minFontScaleX:0,minFontScaleY:0})}return Dt}(0,a,C,v,T,E,p,l.allowVerticalPlacement),_e=l.textSizeData;let Ee=null;_e.kind==="source"?(Ee=[rl*v.layout.get("text-size").evaluate(E,{})],Ee[0]>pc&&Ji(`${l.layerIds[0]}: Value for "text-size" is >= ${Uh}. Reduce your "text-size".`)):_e.kind==="composite"&&(Ee=[rl*ee.compositeTextSizes[0].evaluate(E,{},ie),rl*ee.compositeTextSizes[1].evaluate(E,{},ie)],(Ee[0]>pc||Ee[1]>pc)&&Ji(`${l.layerIds[0]}: Value for "text-size" is >= ${Uh}. Reduce your "text-size".`)),l.addSymbols(l.text,ae,Ee,C,T,E,N,r,D.lineStartIndex,D.lineLength,X,ie);for(const je of U)H[je]=l.text.placedSymbolArray.length-1;return 4*ae.length}function Jw(l){for(const r in l)return l[r];return null}function _P(l,r,a,p){const v=l.compareText;if(r in v){const T=v[r];for(let E=T.length-1;E>=0;E--)if(p.dist(T[E])<a)return!0}else v[r]=[];return v[r].push(p),!1}const eb=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Cv{static from(r){if(!(r instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[a,p]=new Uint8Array(r,0,2);if(a!==219)throw new Error("Data does not appear to be in a KDBush format.");const v=p>>4;if(v!==1)throw new Error(`Got v${v} data when expected v1.`);const T=eb[15&p];if(!T)throw new Error("Unrecognized array type.");const[E]=new Uint16Array(r,2,1),[C]=new Uint32Array(r,4,1);return new Cv(C,E,T,r)}constructor(r,a=64,p=Float64Array,v){if(isNaN(r)||r<0)throw new Error(`Unpexpected numItems value: ${r}.`);this.numItems=+r,this.nodeSize=Math.min(Math.max(+a,2),65535),this.ArrayType=p,this.IndexArrayType=r<65536?Uint16Array:Uint32Array;const T=eb.indexOf(this.ArrayType),E=2*r*this.ArrayType.BYTES_PER_ELEMENT,C=r*this.IndexArrayType.BYTES_PER_ELEMENT,D=(8-C%8)%8;if(T<0)throw new Error(`Unexpected typed array class: ${p}.`);v&&v instanceof ArrayBuffer?(this.data=v,this.ids=new this.IndexArrayType(this.data,8,r),this.coords=new this.ArrayType(this.data,8+C+D,2*r),this._pos=2*r,this._finished=!0):(this.data=new ArrayBuffer(8+E+C+D),this.ids=new this.IndexArrayType(this.data,8,r),this.coords=new this.ArrayType(this.data,8+C+D,2*r),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+T]),new Uint16Array(this.data,2,1)[0]=a,new Uint32Array(this.data,4,1)[0]=r)}add(r,a){const p=this._pos>>1;return this.ids[p]=p,this.coords[this._pos++]=r,this.coords[this._pos++]=a,p}finish(){const r=this._pos>>1;if(r!==this.numItems)throw new Error(`Added ${r} items when expected ${this.numItems}.`);return Av(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(r,a,p,v){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:T,coords:E,nodeSize:C}=this,D=[0,T.length-1,0],N=[];for(;D.length;){const U=D.pop()||0,H=D.pop()||0,X=D.pop()||0;if(H-X<=C){for(let _e=X;_e<=H;_e++){const Ee=E[2*_e],je=E[2*_e+1];Ee>=r&&Ee<=p&&je>=a&&je<=v&&N.push(T[_e])}continue}const ee=X+H>>1,ie=E[2*ee],ae=E[2*ee+1];ie>=r&&ie<=p&&ae>=a&&ae<=v&&N.push(T[ee]),(U===0?r<=ie:a<=ae)&&(D.push(X),D.push(ee-1),D.push(1-U)),(U===0?p>=ie:v>=ae)&&(D.push(ee+1),D.push(H),D.push(1-U))}return N}within(r,a,p){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:v,coords:T,nodeSize:E}=this,C=[0,v.length-1,0],D=[],N=p*p;for(;C.length;){const U=C.pop()||0,H=C.pop()||0,X=C.pop()||0;if(H-X<=E){for(let _e=X;_e<=H;_e++)nb(T[2*_e],T[2*_e+1],r,a)<=N&&D.push(v[_e]);continue}const ee=X+H>>1,ie=T[2*ee],ae=T[2*ee+1];nb(ie,ae,r,a)<=N&&D.push(v[ee]),(U===0?r-p<=ie:a-p<=ae)&&(C.push(X),C.push(ee-1),C.push(1-U)),(U===0?r+p>=ie:a+p>=ae)&&(C.push(ee+1),C.push(H),C.push(1-U))}return D}}function Av(l,r,a,p,v,T){if(v-p<=a)return;const E=p+v>>1;tb(l,r,E,p,v,T),Av(l,r,a,p,E-1,1-T),Av(l,r,a,E+1,v,1-T)}function tb(l,r,a,p,v,T){for(;v>p;){if(v-p>600){const N=v-p+1,U=a-p+1,H=Math.log(N),X=.5*Math.exp(2*H/3),ee=.5*Math.sqrt(H*X*(N-X)/N)*(U-N/2<0?-1:1);tb(l,r,a,Math.max(p,Math.floor(a-U*X/N+ee)),Math.min(v,Math.floor(a+(N-U)*X/N+ee)),T)}const E=r[2*a+T];let C=p,D=v;for(Hm(l,r,p,a),r[2*v+T]>E&&Hm(l,r,p,v);C<D;){for(Hm(l,r,C,D),C++,D--;r[2*C+T]<E;)C++;for(;r[2*D+T]>E;)D--}r[2*p+T]===E?Hm(l,r,p,D):(D++,Hm(l,r,D,v)),D<=a&&(p=D+1),a<=D&&(v=D-1)}}function Hm(l,r,a,p){kv(l,a,p),kv(r,2*a,2*p),kv(r,2*a+1,2*p+1)}function kv(l,r,a){const p=l[r];l[r]=l[a],l[a]=p}function nb(l,r,a,p){const v=l-a,T=r-p;return v*v+T*T}var Mv;_.ce=void 0,(Mv=_.ce||(_.ce={})).create="create",Mv.load="load",Mv.fullLoad="fullLoad";let b_=null,qm=[];const Rv=1e3/60,Lv="loadTime",Dv="fullLoadTime",yP={mark(l){performance.mark(l)},frame(l){const r=l;b_!=null&&qm.push(r-b_),b_=r},clearMetrics(){b_=null,qm=[],performance.clearMeasures(Lv),performance.clearMeasures(Dv);for(const l in _.ce)performance.clearMarks(_.ce[l])},getPerformanceMetrics(){performance.measure(Lv,_.ce.create,_.ce.load),performance.measure(Dv,_.ce.create,_.ce.fullLoad);const l=performance.getEntriesByName(Lv)[0].duration,r=performance.getEntriesByName(Dv)[0].duration,a=qm.length,p=1/(qm.reduce((T,E)=>T+E,0)/a/1e3),v=qm.filter(T=>T>Rv).reduce((T,E)=>T+(E-Rv)/Rv,0);return{loadTime:l,fullLoadTime:r,fps:p,percentDroppedFrames:v/(a+v)*100,totalFrames:a}}};_.$=Ue,_.A=be,_.B=ka,_.C=function(l){if(Wi==null){const r=l.navigator?l.navigator.userAgent:null;Wi=!!l.safari||!(!r||!(/\b(iPad|iPhone|iPod)\b/.test(r)||r.match("Safari")&&!r.match("Chrome")))}return Wi},_.D=rn,_.E=Bo,_.F=class{constructor(l,r){this.target=l,this.mapId=r,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new so(()=>this.process()),this.subscription=function(a,p,v,T){return a.addEventListener(p,v,!1),{unsubscribe:()=>{a.removeEventListener(p,v,!1)}}}(this.target,"message",a=>this.receive(a)),this.globalScope=Hr(self)?l:window}registerMessageHandler(l,r){this.messageHandlers[l]=r}sendAsync(l,r){return new Promise((a,p)=>{const v=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[v]={resolve:a,reject:p},r&&r.signal.addEventListener("abort",()=>{delete this.resolveRejects[v];const C={id:v,type:"<cancel>",origin:location.origin,targetMapId:l.targetMapId,sourceMapId:this.mapId};this.target.postMessage(C)},{once:!0});const T=[],E=Object.assign(Object.assign({},l),{id:v,sourceMapId:this.mapId,origin:location.origin,data:Nc(l.data,T)});this.target.postMessage(E,{transfer:T})})}receive(l){const r=l.data,a=r.id;if(!(r.origin!=="file://"&&location.origin!=="file://"&&r.origin!=="resource://android"&&location.origin!=="resource://android"&&r.origin!==location.origin||r.targetMapId&&this.mapId!==r.targetMapId)){if(r.type==="<cancel>"){delete this.tasks[a];const p=this.abortControllers[a];return delete this.abortControllers[a],void(p&&p.abort())}if(Hr(self)||r.mustQueue)return this.tasks[a]=r,this.taskQueue.push(a),void this.invoker.trigger();this.processTask(a,r)}}process(){if(this.taskQueue.length===0)return;const l=this.taskQueue.shift(),r=this.tasks[l];delete this.tasks[l],this.taskQueue.length>0&&this.invoker.trigger(),r&&this.processTask(l,r)}processTask(l,r){return u(this,void 0,void 0,function*(){if(r.type==="<response>"){const v=this.resolveRejects[l];return delete this.resolveRejects[l],v?void(r.error?v.reject(ru(r.error)):v.resolve(ru(r.data))):void 0}if(!this.messageHandlers[r.type])return void this.completeTask(l,new Error(`Could not find a registered handler for ${r.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const a=ru(r.data),p=new AbortController;this.abortControllers[l]=p;try{const v=yield this.messageHandlers[r.type](r.sourceMapId,a,p);this.completeTask(l,null,v)}catch(v){this.completeTask(l,v)}})}completeTask(l,r,a){const p=[];delete this.abortControllers[l];const v={id:l,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:r?Nc(r):null,data:Nc(a,p)};this.target.postMessage(v,{transfer:p})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},_.G=Hs,_.H=function(){var l=new be(16);return be!=Float32Array&&(l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[11]=0,l[12]=0,l[13]=0,l[14]=0),l[0]=1,l[5]=1,l[10]=1,l[15]=1,l},_.I=Om,_.J=function(l,r,a){var p,v,T,E,C,D,N,U,H,X,ee,ie,ae=a[0],_e=a[1],Ee=a[2];return r===l?(l[12]=r[0]*ae+r[4]*_e+r[8]*Ee+r[12],l[13]=r[1]*ae+r[5]*_e+r[9]*Ee+r[13],l[14]=r[2]*ae+r[6]*_e+r[10]*Ee+r[14],l[15]=r[3]*ae+r[7]*_e+r[11]*Ee+r[15]):(v=r[1],T=r[2],E=r[3],C=r[4],D=r[5],N=r[6],U=r[7],H=r[8],X=r[9],ee=r[10],ie=r[11],l[0]=p=r[0],l[1]=v,l[2]=T,l[3]=E,l[4]=C,l[5]=D,l[6]=N,l[7]=U,l[8]=H,l[9]=X,l[10]=ee,l[11]=ie,l[12]=p*ae+C*_e+H*Ee+r[12],l[13]=v*ae+D*_e+X*Ee+r[13],l[14]=T*ae+N*_e+ee*Ee+r[14],l[15]=E*ae+U*_e+ie*Ee+r[15]),l},_.K=function(l,r,a){var p=a[0],v=a[1],T=a[2];return l[0]=r[0]*p,l[1]=r[1]*p,l[2]=r[2]*p,l[3]=r[3]*p,l[4]=r[4]*v,l[5]=r[5]*v,l[6]=r[6]*v,l[7]=r[7]*v,l[8]=r[8]*T,l[9]=r[9]*T,l[10]=r[10]*T,l[11]=r[11]*T,l[12]=r[12],l[13]=r[13],l[14]=r[14],l[15]=r[15],l},_.L=function(l,r,a){var p=r[0],v=r[1],T=r[2],E=r[3],C=r[4],D=r[5],N=r[6],U=r[7],H=r[8],X=r[9],ee=r[10],ie=r[11],ae=r[12],_e=r[13],Ee=r[14],je=r[15],ke=a[0],J=a[1],me=a[2],Me=a[3];return l[0]=ke*p+J*C+me*H+Me*ae,l[1]=ke*v+J*D+me*X+Me*_e,l[2]=ke*T+J*N+me*ee+Me*Ee,l[3]=ke*E+J*U+me*ie+Me*je,l[4]=(ke=a[4])*p+(J=a[5])*C+(me=a[6])*H+(Me=a[7])*ae,l[5]=ke*v+J*D+me*X+Me*_e,l[6]=ke*T+J*N+me*ee+Me*Ee,l[7]=ke*E+J*U+me*ie+Me*je,l[8]=(ke=a[8])*p+(J=a[9])*C+(me=a[10])*H+(Me=a[11])*ae,l[9]=ke*v+J*D+me*X+Me*_e,l[10]=ke*T+J*N+me*ee+Me*Ee,l[11]=ke*E+J*U+me*ie+Me*je,l[12]=(ke=a[12])*p+(J=a[13])*C+(me=a[14])*H+(Me=a[15])*ae,l[13]=ke*v+J*D+me*X+Me*_e,l[14]=ke*T+J*N+me*ee+Me*Ee,l[15]=ke*E+J*U+me*ie+Me*je,l},_.M=function(l,r){const a={};for(let p=0;p<r.length;p++){const v=r[p];v in l&&(a[v]=l[v])}return a},_.N=We,_.O=bn,_.P=de,_.Q=Mn,_.R=za,_.S=cu,_.T=sd,_.U=vt,_.V=Ye,_.W=Qr,_.X=dn,_.Y=yi,_.Z=jm,_._=u,_.a=Fo,_.a$=function(){return new Float64Array(16)},_.a0=l=>{const r=window.document.createElement("video");return r.muted=!0,new Promise(a=>{r.onloadstart=()=>{a(r)};for(const p of l){const v=window.document.createElement("source");qs(p)||(r.crossOrigin="Anonymous"),v.src=p,r.appendChild(v)}})},_.a1=function(){return nn++},_.a2=b,_.a3=k,_.a4=Iu,_.a5=Du,_.a6=Fw,_.a7=function(l){const r={};if(l.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(a,p,v,T)=>{const E=v||T;return r[p]=!E||E.toLowerCase(),""}),r["max-age"]){const a=parseInt(r["max-age"],10);isNaN(a)?delete r["max-age"]:r["max-age"]=a}return r},_.a8=function(l){return Math.log(l)/Math.LN2},_.a9=function(l){var r=l[0],a=l[1];return r*r+a*a},_.aA=_r,_.aB=tp,_.aC=ge,_.aD=Ht,_.aE=pt,_.aF=85.051129,_.aG=function(l){return Math.pow(2,l)},_.aH=Rn,_.aI=sn,_.aJ=vr,_.aK=Ro,_.aL=function(l,r,a){return l[0]=r[0]*a,l[1]=r[1]*a,l[2]=r[2]*a,l},_.aM=function(l,r,a){return l[0]=r[0]+a[0],l[1]=r[1]+a[1],l[2]=r[2]+a[2],l},_.aN=function(l){var r=new be(3);return r[0]=l[0],r[1]=l[1],r[2]=l[2],r},_.aO=function(l,r,a){return l[0]=r[0]*a[0],l[1]=r[1]*a[1],l[2]=r[2]*a[2],l[3]=r[3]*a[3],l},_.aP=function(l,r,a){return l[0]=r[0]-a[0],l[1]=r[1]-a[1],l[2]=r[2]-a[2],l},_.aQ=function(l,r){var a=r[0],p=r[1],v=r[2],T=a*a+p*p+v*v;return T>0&&(T=1/Math.sqrt(T)),l[0]=r[0]*T,l[1]=r[1]*T,l[2]=r[2]*T,l},_.aR=function(l,r,a){var p=r[0],v=r[1],T=r[2],E=a[0],C=a[1],D=a[2];return l[0]=v*D-T*C,l[1]=T*E-p*D,l[2]=p*C-v*E,l},_.aS=function(l,r){return l[0]*r[0]+l[1]*r[1]+l[2]*r[2]},_.aT=zw,_.aU=bf,_.aV=function(l,r,a,p,v){var T,E=1/Math.tan(r/2);return l[0]=E/a,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=E,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[11]=-1,l[12]=0,l[13]=0,l[15]=0,v!=null&&v!==1/0?(l[10]=(v+p)*(T=1/(p-v)),l[14]=2*v*p*T):(l[10]=-1,l[14]=-2*p),l},_.aW=function(l){var r=new be(16);return r[0]=l[0],r[1]=l[1],r[2]=l[2],r[3]=l[3],r[4]=l[4],r[5]=l[5],r[6]=l[6],r[7]=l[7],r[8]=l[8],r[9]=l[9],r[10]=l[10],r[11]=l[11],r[12]=l[12],r[13]=l[13],r[14]=l[14],r[15]=l[15],r},_.aX=function(l,r,a){var p=Math.sin(a),v=Math.cos(a),T=r[0],E=r[1],C=r[2],D=r[3],N=r[4],U=r[5],H=r[6],X=r[7];return r!==l&&(l[8]=r[8],l[9]=r[9],l[10]=r[10],l[11]=r[11],l[12]=r[12],l[13]=r[13],l[14]=r[14],l[15]=r[15]),l[0]=T*v+N*p,l[1]=E*v+U*p,l[2]=C*v+H*p,l[3]=D*v+X*p,l[4]=N*v-T*p,l[5]=U*v-E*p,l[6]=H*v-C*p,l[7]=X*v-D*p,l},_.aY=function(l,r,a){var p=Math.sin(a),v=Math.cos(a),T=r[4],E=r[5],C=r[6],D=r[7],N=r[8],U=r[9],H=r[10],X=r[11];return r!==l&&(l[0]=r[0],l[1]=r[1],l[2]=r[2],l[3]=r[3],l[12]=r[12],l[13]=r[13],l[14]=r[14],l[15]=r[15]),l[4]=T*v+N*p,l[5]=E*v+U*p,l[6]=C*v+H*p,l[7]=D*v+X*p,l[8]=N*v-T*p,l[9]=U*v-E*p,l[10]=H*v-C*p,l[11]=X*v-D*p,l},_.aZ=function(){const l=new Float32Array(16);return pe(l),l},_.a_=function(){const l=new Float64Array(16);return pe(l),l},_.aa=function(l){return l*Math.PI/180},_.ab=Qt,_.ac=function(l,r){const a=[];for(const p in l)p in r||a.push(p);return a},_.ad=pn,_.ae=function(l){return Math.hypot(l[0],l[1])},_.af=function(l){return l[0]=0,l[1]=0,l},_.ag=function(l,r,a){return l[0]=r[0]*a,l[1]=r[1]*a,l},_.ah=function(l,r){let a=0,p=0;if(l.kind==="constant")p=l.layoutSize;else if(l.kind!=="source"){const{interpolationType:v,minZoom:T,maxZoom:E}=l,C=v?Qt(qn.interpolationFactor(v,r,T,E),0,1):0;l.kind==="camera"?p=mo.number(l.minSize,l.maxSize,C):a=C}return{uSizeT:a,uSize:p}},_.aj=function(l,{uSize:r,uSizeT:a},{lowerSize:p,upperSize:v}){return l.kind==="source"?p/rl:l.kind==="composite"?mo.number(p/rl,v/rl,a):r},_.ak=bd,_.al=$e,_.am=function(l,r,a,p){const v=r.y-l.y,T=r.x-l.x,E=p.y-a.y,C=p.x-a.x,D=E*T-C*v;if(D===0)return null;const N=(C*(l.y-a.y)-E*(l.x-a.x))/D;return new de(l.x+N*T,l.y+N*v)},_.an=function(l,r){var a=r[0],p=r[1],v=r[2],T=r[3],E=r[4],C=r[5],D=r[6],N=r[7],U=r[8],H=r[9],X=r[10],ee=r[11],ie=r[12],ae=r[13],_e=r[14],Ee=r[15],je=a*C-p*E,ke=a*D-v*E,J=a*N-T*E,me=p*D-v*C,Me=p*N-T*C,st=v*N-T*D,Pt=U*ae-H*ie,ct=U*_e-X*ie,_t=U*Ee-ee*ie,Dt=H*_e-X*ae,Ct=H*Ee-ee*ae,Ft=X*Ee-ee*_e,bt=je*Ft-ke*Ct+J*Dt+me*_t-Me*ct+st*Pt;return bt?(l[0]=(C*Ft-D*Ct+N*Dt)*(bt=1/bt),l[1]=(v*Ct-p*Ft-T*Dt)*bt,l[2]=(ae*st-_e*Me+Ee*me)*bt,l[3]=(X*Me-H*st-ee*me)*bt,l[4]=(D*_t-E*Ft-N*ct)*bt,l[5]=(a*Ft-v*_t+T*ct)*bt,l[6]=(_e*J-ie*st-Ee*ke)*bt,l[7]=(U*st-X*J+ee*ke)*bt,l[8]=(E*Ct-C*_t+N*Pt)*bt,l[9]=(p*_t-a*Ct-T*Pt)*bt,l[10]=(ie*Me-ae*J+Ee*je)*bt,l[11]=(H*J-U*Me-ee*je)*bt,l[12]=(C*ct-E*Dt-D*Pt)*bt,l[13]=(a*Dt-p*ct+v*Pt)*bt,l[14]=(ae*ke-ie*me-_e*je)*bt,l[15]=(U*me-H*ke+X*je)*bt,l):null},_.ao=jw,_.ap=Wd,_.aq=pe,_.ar=function(l){let r=1/0,a=1/0,p=-1/0,v=-1/0;for(const T of l)r=Math.min(r,T.x),a=Math.min(a,T.y),p=Math.max(p,T.x),v=Math.max(v,T.y);return[r,a,p,v]},_.as=oo,_.at=jn,_.au=function(l,r,a,p,v=!1){if(!a[0]&&!a[1])return[0,0];const T=v?p==="map"?-l.bearingInRadians:0:p==="viewport"?l.bearingInRadians:0;if(T){const E=Math.sin(T),C=Math.cos(T);a=[a[0]*C-a[1]*E,a[0]*E+a[1]*C]}return[v?a[0]:jn(r,a[0],l.zoom),v?a[1]:jn(r,a[1],l.zoom)]},_.aw=wd,_.ax=Pv,_.ay=yf,_.az=Cv,_.b=Qo,_.b$=l=>l.type==="line",_.b0=function(l,r,a){const p=new Float64Array(4);return function(v,T,E,C){var D=.5*Math.PI/180;T*=D,E*=D,C*=D;var N=Math.sin(T),U=Math.cos(T),H=Math.sin(E),X=Math.cos(E),ee=Math.sin(C),ie=Math.cos(C);v[0]=N*X*ie-U*H*ee,v[1]=U*H*ie+N*X*ee,v[2]=U*X*ee-N*H*ie,v[3]=U*X*ie+N*H*ee}(p,l,r-90,a),p},_.b1=function(l,r,a,p){var v,T,E,C,D,N=r[0],U=r[1],H=r[2],X=r[3],ee=a[0],ie=a[1],ae=a[2],_e=a[3];return(T=N*ee+U*ie+H*ae+X*_e)<0&&(T=-T,ee=-ee,ie=-ie,ae=-ae,_e=-_e),1-T>at?(v=Math.acos(T),E=Math.sin(v),C=Math.sin((1-p)*v)/E,D=Math.sin(p*v)/E):(C=1-p,D=p),l[0]=C*N+D*ee,l[1]=C*U+D*ie,l[2]=C*H+D*ae,l[3]=C*X+D*_e,l},_.b2=function(l){const r=new Float64Array(9);var a,p,v,T,E,C,D,N,U,H,X,ee,ie,ae,_e,Ee,je,ke;H=(v=(p=l)[0])*(D=v+v),X=(T=p[1])*D,ie=(E=p[2])*D,ae=E*(N=T+T),Ee=(C=p[3])*D,je=C*N,ke=C*(U=E+E),(a=r)[0]=1-(ee=T*N)-(_e=E*U),a[3]=X-ke,a[6]=ie+je,a[1]=X+ke,a[4]=1-H-_e,a[7]=ae-Ee,a[2]=ie-je,a[5]=ae+Ee,a[8]=1-H-ee;const J=vr(-Math.asin(Qt(r[2],-1,1)));let me,Me;return Math.hypot(r[5],r[8])<.001?(me=0,Me=-vr(Math.atan2(r[3],r[4]))):(me=vr(r[5]===0&&r[8]===0?0:Math.atan2(r[5],r[8])),Me=vr(r[1]===0&&r[0]===0?0:Math.atan2(r[1],r[0]))),{roll:me,pitch:J+90,bearing:Me}},_.b3=function(l,r){return l.roll==r.roll&&l.pitch==r.pitch&&l.bearing==r.bearing},_.b4=kn,_.b5=Ml,_.b6=zh,_.b7=md,_.b8=Zc,_.b9=gn,_.bA=Fn,_.bB=$n,_.bC=class extends ko{constructor(l,r){super(l,r),this.current=0}set(l){this.current!==l&&(this.current=l,this.gl.uniform1i(this.location,l))}},_.bD=class extends ko{constructor(l,r){super(l,r),this.current=ec}set(l){if(l[12]!==this.current[12]||l[0]!==this.current[0])return this.current=l,void this.gl.uniformMatrix4fv(this.location,!1,l);for(let r=1;r<16;r++)if(l[r]!==this.current[r]){this.current=l,this.gl.uniformMatrix4fv(this.location,!1,l);break}}},_.bE=Ru,_.bF=Lu,_.bG=class extends ko{constructor(l,r){super(l,r),this.current=[0,0,0]}set(l){l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]||(this.current=l,this.gl.uniform3f(this.location,l[0],l[1],l[2]))}},_.bH=class extends ko{constructor(l,r){super(l,r),this.current=[0,0]}set(l){l[0]===this.current[0]&&l[1]===this.current[1]||(this.current=l,this.gl.uniform2f(this.location,l[0],l[1]))}},_.bI=te,_.bJ=function(l,r){var a=Math.sin(r),p=Math.cos(r);return l[0]=p,l[1]=a,l[2]=0,l[3]=-a,l[4]=p,l[5]=0,l[6]=0,l[7]=0,l[8]=1,l},_.bK=function(l,r,a){var p=r[0],v=r[1],T=r[2];return l[0]=p*a[0]+v*a[3]+T*a[6],l[1]=p*a[1]+v*a[4]+T*a[7],l[2]=p*a[2]+v*a[5]+T*a[8],l},_.bL=function(l,r,a,p,v,T,E){var C=1/(r-a),D=1/(p-v),N=1/(T-E);return l[0]=-2*C,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=-2*D,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=2*N,l[11]=0,l[12]=(r+a)*C,l[13]=(v+p)*D,l[14]=(E+T)*N,l[15]=1,l},_.bM=class extends Ns{},_.bN=Mm,_.bO=class extends Al{},_.bP=ef,_.bQ=function(l){return l<=1?1:Math.pow(2,Math.ceil(Math.log(l)/Math.LN2))},_.bR=Jp,_.bS=function(l,r,a){var p=r[0],v=r[1],T=r[2],E=a[3]*p+a[7]*v+a[11]*T+a[15];return l[0]=(a[0]*p+a[4]*v+a[8]*T+a[12])/(E=E||1),l[1]=(a[1]*p+a[5]*v+a[9]*T+a[13])/E,l[2]=(a[2]*p+a[6]*v+a[10]*T+a[14])/E,l},_.bT=class extends ku{},_.bU=class extends s{},_.bV=function(l,r){return l[0]===r[0]&&l[1]===r[1]&&l[2]===r[2]&&l[3]===r[3]&&l[4]===r[4]&&l[5]===r[5]&&l[6]===r[6]&&l[7]===r[7]&&l[8]===r[8]&&l[9]===r[9]&&l[10]===r[10]&&l[11]===r[11]&&l[12]===r[12]&&l[13]===r[13]&&l[14]===r[14]&&l[15]===r[15]},_.bW=function(l,r){var a=l[0],p=l[1],v=l[2],T=l[3],E=l[4],C=l[5],D=l[6],N=l[7],U=l[8],H=l[9],X=l[10],ee=l[11],ie=l[12],ae=l[13],_e=l[14],Ee=l[15],je=r[0],ke=r[1],J=r[2],me=r[3],Me=r[4],st=r[5],Pt=r[6],ct=r[7],_t=r[8],Dt=r[9],Ct=r[10],Ft=r[11],bt=r[12],on=r[13],Cn=r[14],Tn=r[15];return Math.abs(a-je)<=at*Math.max(1,Math.abs(a),Math.abs(je))&&Math.abs(p-ke)<=at*Math.max(1,Math.abs(p),Math.abs(ke))&&Math.abs(v-J)<=at*Math.max(1,Math.abs(v),Math.abs(J))&&Math.abs(T-me)<=at*Math.max(1,Math.abs(T),Math.abs(me))&&Math.abs(E-Me)<=at*Math.max(1,Math.abs(E),Math.abs(Me))&&Math.abs(C-st)<=at*Math.max(1,Math.abs(C),Math.abs(st))&&Math.abs(D-Pt)<=at*Math.max(1,Math.abs(D),Math.abs(Pt))&&Math.abs(N-ct)<=at*Math.max(1,Math.abs(N),Math.abs(ct))&&Math.abs(U-_t)<=at*Math.max(1,Math.abs(U),Math.abs(_t))&&Math.abs(H-Dt)<=at*Math.max(1,Math.abs(H),Math.abs(Dt))&&Math.abs(X-Ct)<=at*Math.max(1,Math.abs(X),Math.abs(Ct))&&Math.abs(ee-Ft)<=at*Math.max(1,Math.abs(ee),Math.abs(Ft))&&Math.abs(ie-bt)<=at*Math.max(1,Math.abs(ie),Math.abs(bt))&&Math.abs(ae-on)<=at*Math.max(1,Math.abs(ae),Math.abs(on))&&Math.abs(_e-Cn)<=at*Math.max(1,Math.abs(_e),Math.abs(Cn))&&Math.abs(Ee-Tn)<=at*Math.max(1,Math.abs(Ee),Math.abs(Tn))},_.bX=function(l,r){return l[0]=r[0],l[1]=r[1],l[2]=r[2],l[3]=r[3],l[4]=r[4],l[5]=r[5],l[6]=r[6],l[7]=r[7],l[8]=r[8],l[9]=r[9],l[10]=r[10],l[11]=r[11],l[12]=r[12],l[13]=r[13],l[14]=r[14],l[15]=r[15],l},_.bY=l=>l.type==="symbol",_.bZ=l=>l.type==="circle",_.b_=l=>l.type==="heatmap",_.ba=St,_.bb=xr,_.bc=function(l,r,a,p,v){return gn(p,v,Qt((l-r)/(a-r),0,1))},_.bd=Tt,_.be=function(){return new Float64Array(4)},_.bf=function(){return new Float64Array(3)},_.bg=function(l,r,a,p){var v=[],T=[];return v[0]=r[0]-a[0],v[1]=r[1]-a[1],v[2]=r[2]-a[2],T[0]=v[0]*Math.cos(p)-v[1]*Math.sin(p),T[1]=v[0]*Math.sin(p)+v[1]*Math.cos(p),T[2]=v[2],l[0]=T[0]+a[0],l[1]=T[1]+a[1],l[2]=T[2]+a[2],l},_.bh=function(l,r,a,p){var v=[],T=[];return v[0]=r[0]-a[0],v[1]=r[1]-a[1],v[2]=r[2]-a[2],T[0]=v[0],T[1]=v[1]*Math.cos(p)-v[2]*Math.sin(p),T[2]=v[1]*Math.sin(p)+v[2]*Math.cos(p),l[0]=T[0]+a[0],l[1]=T[1]+a[1],l[2]=T[2]+a[2],l},_.bi=function(l,r,a,p){var v=[],T=[];return v[0]=r[0]-a[0],v[1]=r[1]-a[1],v[2]=r[2]-a[2],T[0]=v[2]*Math.sin(p)+v[0]*Math.cos(p),T[1]=v[1],T[2]=v[2]*Math.cos(p)-v[0]*Math.sin(p),l[0]=T[0]+a[0],l[1]=T[1]+a[1],l[2]=T[2]+a[2],l},_.bj=function(l,r,a){var p=Math.sin(a),v=Math.cos(a),T=r[0],E=r[1],C=r[2],D=r[3],N=r[8],U=r[9],H=r[10],X=r[11];return r!==l&&(l[4]=r[4],l[5]=r[5],l[6]=r[6],l[7]=r[7],l[12]=r[12],l[13]=r[13],l[14]=r[14],l[15]=r[15]),l[0]=T*v-N*p,l[1]=E*v-U*p,l[2]=C*v-H*p,l[3]=D*v-X*p,l[8]=T*p+N*v,l[9]=E*p+U*v,l[10]=C*p+H*v,l[11]=D*p+X*v,l},_.bk=function(l,r){const a=Tt(l,360),p=Tt(r,360),v=p-a,T=p>a?v-360:v+360;return Math.abs(v)<Math.abs(T)?v:T},_.bl=function(l){return l[0]=0,l[1]=0,l[2]=0,l},_.bm=function(l,r,a,p){const v=Math.sqrt(l*l+r*r),T=Math.sqrt(a*a+p*p);l/=v,r/=v,a/=T,p/=T;const E=Math.acos(l*a+r*p);return-r*a+l*p>0?E:-E},_.bn=function(l,r){return l[0]*r[0]+l[1]*r[1]+l[2]*r[2]+l[3]},_.bo=ot,_.bp=function(l,r){const a=Tt(l,2*Math.PI),p=Tt(r,2*Math.PI);return Math.min(Math.abs(a-p),Math.abs(a-p+2*Math.PI),Math.abs(a-p-2*Math.PI))},_.bq=function(l){return Math.hypot(l[0],l[1],l[2])},_.br=function(){const l={},r=ve.$version;for(const a in ve.$root){const p=ve.$root[a];if(p.required){let v=null;v=a==="version"?r:p.type==="array"?[]:{},v!=null&&(l[a]=v)}}return l},_.bs=bh,_.bt=er,_.bu=function(l){l=l.slice();const r=Object.create(null);for(let a=0;a<l.length;a++)r[l[a].id]=l[a];for(let a=0;a<l.length;a++)"ref"in l[a]&&(l[a]=ce(l[a],r[l[a].ref]));return l},_.bv=function(l){if(l.type==="custom")return new wn(l);switch(l.type){case"background":return new jt(l);case"circle":return new Wg(l);case"fill":return new bv(l);case"fill-extrusion":return new uf(l);case"heatmap":return new xm(l);case"hillshade":return new bm(l);case"line":return new Am(l);case"raster":return new yn(l);case"symbol":return new He(l)}},_.bw=Jn,_.bx=function(l,r){if(!l)return[{command:"setStyle",args:[r]}];let a=[];try{if(!fe(l.version,r.version))return[{command:"setStyle",args:[r]}];fe(l.center,r.center)||a.push({command:"setCenter",args:[r.center]}),fe(l.centerAltitude,r.centerAltitude)||a.push({command:"setCenterAltitude",args:[r.centerAltitude]}),fe(l.zoom,r.zoom)||a.push({command:"setZoom",args:[r.zoom]}),fe(l.bearing,r.bearing)||a.push({command:"setBearing",args:[r.bearing]}),fe(l.pitch,r.pitch)||a.push({command:"setPitch",args:[r.pitch]}),fe(l.roll,r.roll)||a.push({command:"setRoll",args:[r.roll]}),fe(l.sprite,r.sprite)||a.push({command:"setSprite",args:[r.sprite]}),fe(l.glyphs,r.glyphs)||a.push({command:"setGlyphs",args:[r.glyphs]}),fe(l.transition,r.transition)||a.push({command:"setTransition",args:[r.transition]}),fe(l.light,r.light)||a.push({command:"setLight",args:[r.light]}),fe(l.terrain,r.terrain)||a.push({command:"setTerrain",args:[r.terrain]}),fe(l.sky,r.sky)||a.push({command:"setSky",args:[r.sky]}),fe(l.projection,r.projection)||a.push({command:"setProjection",args:[r.projection]});const p={},v=[];(function(E,C,D,N){let U;for(U in C=C||{},E=E||{})Object.prototype.hasOwnProperty.call(E,U)&&(Object.prototype.hasOwnProperty.call(C,U)||qe(U,D,N));for(U in C)Object.prototype.hasOwnProperty.call(C,U)&&(Object.prototype.hasOwnProperty.call(E,U)?fe(E[U],C[U])||(E[U].type==="geojson"&&C[U].type==="geojson"&&Ge(E,C,U)?Pe(D,{command:"setGeoJSONSourceData",args:[U,C[U].data]}):tt(U,C,D,N)):Be(U,C,D))})(l.sources,r.sources,v,p);const T=[];l.layers&&l.layers.forEach(E=>{"source"in E&&p[E.source]?a.push({command:"removeLayer",args:[E.id]}):T.push(E)}),a=a.concat(v),function(E,C,D){C=C||[];const N=(E=E||[]).map(ut),U=C.map(ut),H=E.reduce(Xe,{}),X=C.reduce(Xe,{}),ee=N.slice(),ie=Object.create(null);let ae,_e,Ee,je,ke;for(let J=0,me=0;J<N.length;J++)ae=N[J],Object.prototype.hasOwnProperty.call(X,ae)?me++:(Pe(D,{command:"removeLayer",args:[ae]}),ee.splice(ee.indexOf(ae,me),1));for(let J=0,me=0;J<U.length;J++)ae=U[U.length-1-J],ee[ee.length-1-J]!==ae&&(Object.prototype.hasOwnProperty.call(H,ae)?(Pe(D,{command:"removeLayer",args:[ae]}),ee.splice(ee.lastIndexOf(ae,ee.length-me),1)):me++,je=ee[ee.length-J],Pe(D,{command:"addLayer",args:[X[ae],je]}),ee.splice(ee.length-J,0,ae),ie[ae]=!0);for(let J=0;J<U.length;J++)if(ae=U[J],_e=H[ae],Ee=X[ae],!ie[ae]&&!fe(_e,Ee))if(fe(_e.source,Ee.source)&&fe(_e["source-layer"],Ee["source-layer"])&&fe(_e.type,Ee.type)){for(ke in ht(_e.layout,Ee.layout,D,ae,null,"setLayoutProperty"),ht(_e.paint,Ee.paint,D,ae,null,"setPaintProperty"),fe(_e.filter,Ee.filter)||Pe(D,{command:"setFilter",args:[ae,Ee.filter]}),fe(_e.minzoom,Ee.minzoom)&&fe(_e.maxzoom,Ee.maxzoom)||Pe(D,{command:"setLayerZoomRange",args:[ae,Ee.minzoom,Ee.maxzoom]}),_e)Object.prototype.hasOwnProperty.call(_e,ke)&&ke!=="layout"&&ke!=="paint"&&ke!=="filter"&&ke!=="metadata"&&ke!=="minzoom"&&ke!=="maxzoom"&&(ke.indexOf("paint.")===0?ht(_e[ke],Ee[ke],D,ae,ke.slice(6),"setPaintProperty"):fe(_e[ke],Ee[ke])||Pe(D,{command:"setLayerProperty",args:[ae,ke,Ee[ke]]}));for(ke in Ee)Object.prototype.hasOwnProperty.call(Ee,ke)&&!Object.prototype.hasOwnProperty.call(_e,ke)&&ke!=="layout"&&ke!=="paint"&&ke!=="filter"&&ke!=="metadata"&&ke!=="minzoom"&&ke!=="maxzoom"&&(ke.indexOf("paint.")===0?ht(_e[ke],Ee[ke],D,ae,ke.slice(6),"setPaintProperty"):fe(_e[ke],Ee[ke])||Pe(D,{command:"setLayerProperty",args:[ae,ke,Ee[ke]]}))}else Pe(D,{command:"removeLayer",args:[ae]}),je=ee[ee.lastIndexOf(ae)+1],Pe(D,{command:"addLayer",args:[Ee,je]})}(T,r.layers,a)}catch(p){console.warn("Unable to compute style diff:",p),a=[{command:"setStyle",args:[r]}]}return a},_.by=function(l){const r=[],a=l.id;return a===void 0&&r.push({message:`layers.${a}: missing required property "id"`}),l.render===void 0&&r.push({message:`layers.${a}: missing required method "render"`}),l.renderingMode&&l.renderingMode!=="2d"&&l.renderingMode!=="3d"&&r.push({message:`layers.${a}: property "renderingMode" must be either "2d" or "3d"`}),r},_.bz=function l(r,a){if(Array.isArray(r)){if(!Array.isArray(a)||r.length!==a.length)return!1;for(let p=0;p<r.length;p++)if(!l(r[p],a[p]))return!1;return!0}if(typeof r=="object"&&r!==null&&a!==null){if(typeof a!="object"||Object.keys(r).length!==Object.keys(a).length)return!1;for(const p in r)if(!l(r[p],a[p]))return!1;return!0}return r===a},_.c=Ts,_.c0=l=>l.type==="fill",_.c1=l=>l.type==="fill-extrusion",_.c2=l=>l.type==="hillshade",_.c3=l=>l.type==="raster",_.c4=l=>l.type==="background",_.c5=l=>l.type==="custom",_.c6=Ze,_.c7=function(l,r,a){const p=ri(r.x-a.x,r.y-a.y),v=ri(l.x-a.x,l.y-a.y);var T,E;return vr(Math.atan2(p[0]*v[1]-p[1]*v[0],(T=p)[0]*(E=v)[0]+T[1]*E[1]))},_.c8=wt,_.c9=function(l,r,a){var p=r[0],v=r[1];return l[0]=a[0]*p+a[4]*v+a[12],l[1]=a[1]*p+a[5]*v+a[13],l},_.cA=Dm,_.cB=Zu,_.cC=hs,_.ca=function(l,r){const{x:a,y:p}=yi.fromLngLat(r);return!(l<0||l>25||p<0||p>=1||a<0||a>=1)},_.cb=function(l,r){return l[0]=r[0],l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=r[1],l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=r[2],l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l},_.cc=class extends $c{},_.cd=yP,_.cf=function(l){return l.message===Jr},_.cg=Mi,_.ch=function(l,r){Fo.REGISTERED_PROTOCOLS[l]=r},_.ci=function(l){delete Fo.REGISTERED_PROTOCOLS[l]},_.cj=function(l,r){const a={};for(let v=0;v<l.length;v++){const T=r&&r[l[v].id]||A(l[v]);r&&(r[l[v].id]=T);let E=a[T];E||(E=a[T]=[]),E.push(l[v])}const p=[];for(const v in a)p.push(a[v]);return p},_.ck=Gt,_.cl=Ow,_.cm=Bw,_.cn=Fm,_.co=function(l){l.bucket.createArrays(),l.bucket.tilePixelRatio=dn/(512*l.bucket.overscaling),l.bucket.compareText={},l.bucket.iconsNeedLinear=!1;const r=l.bucket.layers[0],a=r.layout,p=r._unevaluatedLayout._values,v={layoutIconSize:p["icon-size"].possiblyEvaluate(new bi(l.bucket.zoom+1),l.canonical),layoutTextSize:p["text-size"].possiblyEvaluate(new bi(l.bucket.zoom+1),l.canonical),textMaxSize:p["text-size"].possiblyEvaluate(new bi(18))};if(l.bucket.textSizeData.kind==="composite"){const{minZoom:N,maxZoom:U}=l.bucket.textSizeData;v.compositeTextSizes=[p["text-size"].possiblyEvaluate(new bi(N),l.canonical),p["text-size"].possiblyEvaluate(new bi(U),l.canonical)]}if(l.bucket.iconSizeData.kind==="composite"){const{minZoom:N,maxZoom:U}=l.bucket.iconSizeData;v.compositeIconSizes=[p["icon-size"].possiblyEvaluate(new bi(N),l.canonical),p["icon-size"].possiblyEvaluate(new bi(U),l.canonical)]}const T=a.get("text-line-height")*oo,E=a.get("text-rotation-alignment")!=="viewport"&&a.get("symbol-placement")!=="point",C=a.get("text-keep-upright"),D=a.get("text-size");for(const N of l.bucket.features){const U=a.get("text-font").evaluate(N,{},l.canonical).join(","),H=D.evaluate(N,{},l.canonical),X=v.layoutTextSize.evaluate(N,{},l.canonical),ee=v.layoutIconSize.evaluate(N,{},l.canonical),ie={horizontal:{},vertical:void 0},ae=N.text;let _e,Ee=[0,0];if(ae){const J=ae.toString(),me=a.get("text-letter-spacing").evaluate(N,{},l.canonical)*oo,Me=Th(J)?me:0,st=a.get("text-anchor").evaluate(N,{},l.canonical),Pt=Yw(r,N,l.canonical);if(!Pt){const Ct=a.get("text-radial-offset").evaluate(N,{},l.canonical);Ee=Ct?Xw(st,[Ct*oo,Iv]):a.get("text-offset").evaluate(N,{},l.canonical).map(Ft=>Ft*oo)}let ct=E?"center":a.get("text-justify").evaluate(N,{},l.canonical);const _t=a.get("symbol-placement")==="point"?a.get("text-max-width").evaluate(N,{},l.canonical)*oo:1/0,Dt=()=>{l.bucket.allowVerticalPlacement&&zs(J)&&(ie.vertical=ff(ae,l.glyphMap,l.glyphPositions,l.imagePositions,U,_t,T,st,"left",Me,Ee,_.ai.vertical,!0,X,H))};if(!E&&Pt){const Ct=new Set;if(ct==="auto")for(let bt=0;bt<Pt.values.length;bt+=2)Ct.add(Pv(Pt.values[bt]));else Ct.add(ct);let Ft=!1;for(const bt of Ct)if(!ie.horizontal[bt])if(Ft)ie.horizontal[bt]=ie.horizontal[0];else{const on=ff(ae,l.glyphMap,l.glyphPositions,l.imagePositions,U,_t,T,"center",bt,Me,Ee,_.ai.horizontal,!1,X,H);on&&(ie.horizontal[bt]=on,Ft=on.positionedLines.length===1)}Dt()}else{ct==="auto"&&(ct=Pv(st));const Ct=ff(ae,l.glyphMap,l.glyphPositions,l.imagePositions,U,_t,T,st,ct,Me,Ee,_.ai.horizontal,!1,X,H);Ct&&(ie.horizontal[ct]=Ct),Dt(),zs(J)&&E&&C&&(ie.vertical=ff(ae,l.glyphMap,l.glyphPositions,l.imagePositions,U,_t,T,st,ct,Me,Ee,_.ai.vertical,!1,X,H))}}let je=!1;if(N.icon&&N.icon.name){const J=l.imageMap[N.icon.name];J&&(_e=g_(l.imagePositions[N.icon.name],a.get("icon-offset").evaluate(N,{},l.canonical),a.get("icon-anchor").evaluate(N,{},l.canonical)),je=!!J.sdf,l.bucket.sdfIcons===void 0?l.bucket.sdfIcons=je:l.bucket.sdfIcons!==je&&Ji("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(J.pixelRatio!==l.bucket.pixelRatio||a.get("icon-rotate").constantOr(1)!==0)&&(l.bucket.iconsNeedLinear=!0))}const ke=Jw(ie.horizontal)||ie.vertical;l.bucket.iconsInText=!!ke&&ke.iconsInText,(ke||_e)&&gP(l.bucket,N,ie,_e,l.imageMap,v,X,ee,Ee,je,l.canonical,l.subdivisionGranularity)}l.showCollisionBoxes&&l.bucket.generateCollisionDebugBuffers()},_.cp=fs,_.cq=of,_.cr=ip,_.cs=Ur,_.ct=hc,_.cu=class{constructor(l){this._marks={start:[l.url,"start"].join("#"),end:[l.url,"end"].join("#"),measure:l.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let l=performance.getEntriesByName(this._marks.measure);return l.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),l=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),l}},_.cv=function(l,r,a,p,v){return u(this,void 0,void 0,function*(){if(Ye())try{return yield Qr(l,r,a,p,v)}catch{}return function(T,E,C,D,N){const U=T.width,H=T.height;Oo&&Jo||(Oo=new OffscreenCanvas(U,H),Jo=Oo.getContext("2d",{willReadFrequently:!0})),Oo.width=U,Oo.height=H,Jo.drawImage(T,0,0,U,H);const X=Jo.getImageData(E,C,D,N);return Jo.clearRect(0,0,U,H),X.data}(l,r,a,p,v)})},_.cw=Nw,_.cx=R,_.cy=ne,_.cz=Nh,_.d=l=>u(void 0,void 0,void 0,function*(){if(l.byteLength===0)return createImageBitmap(new ImageData(1,1));const r=new Blob([new Uint8Array(l)],{type:"image/png"});try{return createImageBitmap(r)}catch(a){throw new Error(`Could not load image because of ${a.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),_.e=Xt,_.f=l=>new Promise((r,a)=>{const p=new Image;p.onload=()=>{r(p),URL.revokeObjectURL(p.src),p.onload=null,window.requestAnimationFrame(()=>{p.src=bs})},p.onerror=()=>a(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const v=new Blob([new Uint8Array(l)],{type:"image/png"});p.src=l.byteLength?URL.createObjectURL(v):bs}),_.g=_a,_.h=(l,r)=>qr(Xt(l,{type:"json"}),r),_.i=Hr,_.j=ya,_.k=Ss,_.l=(l,r)=>qr(Xt(l,{type:"arrayBuffer"}),r),_.m=qr,_.n=function(l){return new hc(l).readFields(xd,[])},_.o=dd,_.p=Nm,_.q=ds,_.r=zc,_.s=qs,_.t=iu,_.u=Au,_.v=ve,_.w=Ji,_.x=function([l,r,a]){return r+=90,r*=Math.PI/180,a*=Math.PI/180,{x:l*Math.cos(r)*Math.sin(a),y:l*Math.sin(r)*Math.sin(a),z:l*Math.cos(a)}},_.y=mo,_.z=bi}),h("worker",["./shared"],function(_){class u{constructor(se){this.keyCache={},se&&this.replace(se)}replace(se){this._layerConfigs={},this._layers={},this.update(se,[])}update(se,ce){for(const Pe of se){this._layerConfigs[Pe.id]=Pe;const Be=this._layers[Pe.id]=_.bv(Pe);Be._featureFilter=_.a4(Be.filter),this.keyCache[Pe.id]&&delete this.keyCache[Pe.id]}for(const Pe of ce)delete this.keyCache[Pe],delete this._layerConfigs[Pe],delete this._layers[Pe];this.familiesBySource={};const fe=_.cj(Object.values(this._layerConfigs),this.keyCache);for(const Pe of fe){const Be=Pe.map(Xe=>this._layers[Xe.id]),qe=Be[0];if(qe.visibility==="none")continue;const tt=qe.source||"";let Ge=this.familiesBySource[tt];Ge||(Ge=this.familiesBySource[tt]={});const ht=qe.sourceLayer||"_geojsonTileLayer";let ut=Ge[ht];ut||(ut=Ge[ht]=[]),ut.push(Be)}}}class R{constructor(se){const ce={},fe=[];for(const tt in se){const Ge=se[tt],ht=ce[tt]={};for(const ut in Ge){const Xe=Ge[+ut];if(!Xe||Xe.bitmap.width===0||Xe.bitmap.height===0)continue;const Ue={x:0,y:0,w:Xe.bitmap.width+2,h:Xe.bitmap.height+2};fe.push(Ue),ht[ut]={rect:Ue,metrics:Xe.metrics}}}const{w:Pe,h:Be}=_.p(fe),qe=new _.o({width:Pe||1,height:Be||1});for(const tt in se){const Ge=se[tt];for(const ht in Ge){const ut=Ge[+ht];if(!ut||ut.bitmap.width===0||ut.bitmap.height===0)continue;const Xe=ce[tt][ht].rect;_.o.copy(ut.bitmap,qe,{x:0,y:0},{x:Xe.x+1,y:Xe.y+1},ut.bitmap)}}this.image=qe,this.positions=ce}}_.ck("GlyphAtlas",R);class O{constructor(se){this.tileID=new _.S(se.tileID.overscaledZ,se.tileID.wrap,se.tileID.canonical.z,se.tileID.canonical.x,se.tileID.canonical.y),this.uid=se.uid,this.zoom=se.zoom,this.pixelRatio=se.pixelRatio,this.tileSize=se.tileSize,this.source=se.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=se.showCollisionBoxes,this.collectResourceTiming=!!se.collectResourceTiming,this.returnDependencies=!!se.returnDependencies,this.promoteId=se.promoteId,this.inFlightDependencies=[]}parse(se,ce,fe,Pe,Be){return _._(this,void 0,void 0,function*(){this.status="parsing",this.data=se,this.collisionBoxArray=new _.a2;const qe=new _.cl(Object.keys(se.layers).sort()),tt=new _.cm(this.tileID,this.promoteId);tt.bucketLayerIDs=[];const Ge={},ht={featureIndex:tt,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:fe,subdivisionGranularity:Be},ut=ce.familiesBySource[this.source];for(const mn in ut){const Yt=se.layers[mn];if(!Yt)continue;Yt.version===1&&_.w(`Vector tile source "${this.source}" layer "${mn}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Ri=qe.encode(mn),ts=[];for(let Si=0;Si<Yt.length;Si++){const xi=Yt.feature(Si),oi=tt.getId(xi,mn);ts.push({feature:xi,id:oi,index:Si,sourceLayerIndex:Ri})}for(const Si of ut[mn]){const xi=Si[0];xi.source!==this.source&&_.w(`layer.source = ${xi.source} does not equal this.source = ${this.source}`),xi.minzoom&&this.zoom<Math.floor(xi.minzoom)||xi.maxzoom&&this.zoom>=xi.maxzoom||xi.visibility!=="none"&&(G(Si,this.zoom,fe),(Ge[xi.id]=xi.createBucket({index:tt.bucketLayerIDs.length,layers:Si,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ri,sourceID:this.source})).populate(ts,ht,this.tileID.canonical),tt.bucketLayerIDs.push(Si.map(oi=>oi.id)))}}const Xe=_.bA(ht.glyphDependencies,mn=>Object.keys(mn).map(Number));this.inFlightDependencies.forEach(mn=>mn?.abort()),this.inFlightDependencies=[];let Ue=Promise.resolve({});if(Object.keys(Xe).length){const mn=new AbortController;this.inFlightDependencies.push(mn),Ue=Pe.sendAsync({type:"GG",data:{stacks:Xe,source:this.source,tileID:this.tileID,type:"glyphs"}},mn)}const zt=Object.keys(ht.iconDependencies);let Nt=Promise.resolve({});if(zt.length){const mn=new AbortController;this.inFlightDependencies.push(mn),Nt=Pe.sendAsync({type:"GI",data:{icons:zt,source:this.source,tileID:this.tileID,type:"icons"}},mn)}const en=Object.keys(ht.patternDependencies);let Pn=Promise.resolve({});if(en.length){const mn=new AbortController;this.inFlightDependencies.push(mn),Pn=Pe.sendAsync({type:"GI",data:{icons:en,source:this.source,tileID:this.tileID,type:"patterns"}},mn)}const[mt,Vt,$t]=yield Promise.all([Ue,Nt,Pn]),Lt=new R(mt),Nn=new _.cn(Vt,$t);for(const mn in Ge){const Yt=Ge[mn];Yt instanceof _.a3?(G(Yt.layers,this.zoom,fe),_.co({bucket:Yt,glyphMap:mt,glyphPositions:Lt.positions,imageMap:Vt,imagePositions:Nn.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:ht.subdivisionGranularity})):Yt.hasPattern&&(Yt instanceof _.cp||Yt instanceof _.cq||Yt instanceof _.cr)&&(G(Yt.layers,this.zoom,fe),Yt.addFeatures(ht,this.tileID.canonical,Nn.patternPositions))}return this.status="done",{buckets:Object.values(Ge).filter(mn=>!mn.isEmpty()),featureIndex:tt,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Lt.image,imageAtlas:Nn,glyphMap:this.returnDependencies?mt:null,iconMap:this.returnDependencies?Vt:null,glyphPositions:this.returnDependencies?Lt.positions:null}})}}function G(ve,se,ce){const fe=new _.z(se);for(const Pe of ve)Pe.recalculate(fe,ce)}class ne{constructor(se,ce,fe){this.actor=se,this.layerIndex=ce,this.availableImages=fe,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(se,ce){return _._(this,void 0,void 0,function*(){const fe=yield _.l(se.request,ce);try{return{vectorTile:new _.cs.VectorTile(new _.ct(fe.data)),rawData:fe.data,cacheControl:fe.cacheControl,expires:fe.expires}}catch(Pe){const Be=new Uint8Array(fe.data);let qe=`Unable to parse the tile at ${se.request.url}, `;throw qe+=Be[0]===31&&Be[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${Pe.message}`,new Error(qe)}})}loadTile(se){return _._(this,void 0,void 0,function*(){const ce=se.uid,fe=!!(se&&se.request&&se.request.collectResourceTiming)&&new _.cu(se.request),Pe=new O(se);this.loading[ce]=Pe;const Be=new AbortController;Pe.abort=Be;try{const qe=yield this.loadVectorTile(se,Be);if(delete this.loading[ce],!qe)return null;const tt=qe.rawData,Ge={};qe.expires&&(Ge.expires=qe.expires),qe.cacheControl&&(Ge.cacheControl=qe.cacheControl);const ht={};if(fe){const Xe=fe.finish();Xe&&(ht.resourceTiming=JSON.parse(JSON.stringify(Xe)))}Pe.vectorTile=qe.vectorTile;const ut=Pe.parse(qe.vectorTile,this.layerIndex,this.availableImages,this.actor,se.subdivisionGranularity);this.loaded[ce]=Pe,this.fetching[ce]={rawTileData:tt,cacheControl:Ge,resourceTiming:ht};try{const Xe=yield ut;return _.e({rawTileData:tt.slice(0)},Xe,Ge,ht)}finally{delete this.fetching[ce]}}catch(qe){throw delete this.loading[ce],Pe.status="done",this.loaded[ce]=Pe,qe}})}reloadTile(se){return _._(this,void 0,void 0,function*(){const ce=se.uid;if(!this.loaded||!this.loaded[ce])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const fe=this.loaded[ce];if(fe.showCollisionBoxes=se.showCollisionBoxes,fe.status==="parsing"){const Pe=yield fe.parse(fe.vectorTile,this.layerIndex,this.availableImages,this.actor,se.subdivisionGranularity);let Be;if(this.fetching[ce]){const{rawTileData:qe,cacheControl:tt,resourceTiming:Ge}=this.fetching[ce];delete this.fetching[ce],Be=_.e({rawTileData:qe.slice(0)},Pe,tt,Ge)}else Be=Pe;return Be}if(fe.status==="done"&&fe.vectorTile)return fe.parse(fe.vectorTile,this.layerIndex,this.availableImages,this.actor,se.subdivisionGranularity)})}abortTile(se){return _._(this,void 0,void 0,function*(){const ce=this.loading,fe=se.uid;ce&&ce[fe]&&ce[fe].abort&&(ce[fe].abort.abort(),delete ce[fe])})}removeTile(se){return _._(this,void 0,void 0,function*(){this.loaded&&this.loaded[se.uid]&&delete this.loaded[se.uid]})}}class re{constructor(){this.loaded={}}loadTile(se){return _._(this,void 0,void 0,function*(){const{uid:ce,encoding:fe,rawImageData:Pe,redFactor:Be,greenFactor:qe,blueFactor:tt,baseShift:Ge}=se,ht=Pe.width+2,ut=Pe.height+2,Xe=_.b(Pe)?new _.R({width:ht,height:ut},yield _.cv(Pe,-1,-1,ht,ut)):Pe,Ue=new _.cw(ce,Xe,fe,Be,qe,tt,Ge);return this.loaded=this.loaded||{},this.loaded[ce]=Ue,Ue})}removeTile(se){const ce=this.loaded,fe=se.uid;ce&&ce[fe]&&delete ce[fe]}}var Q,de,Se=function(){if(de)return Q;function ve(ce,fe){if(ce.length!==0){se(ce[0],fe);for(var Pe=1;Pe<ce.length;Pe++)se(ce[Pe],!fe)}}function se(ce,fe){for(var Pe=0,Be=0,qe=0,tt=ce.length,Ge=tt-1;qe<tt;Ge=qe++){var ht=(ce[qe][0]-ce[Ge][0])*(ce[Ge][1]+ce[qe][1]),ut=Pe+ht;Be+=Math.abs(Pe)>=Math.abs(ht)?Pe-ut+ht:ht-ut+Pe,Pe=ut}Pe+Be>=0!=!!fe&&ce.reverse()}return de=1,Q=function ce(fe,Pe){var Be,qe=fe&&fe.type;if(qe==="FeatureCollection")for(Be=0;Be<fe.features.length;Be++)ce(fe.features[Be],Pe);else if(qe==="GeometryCollection")for(Be=0;Be<fe.geometries.length;Be++)ce(fe.geometries[Be],Pe);else if(qe==="Feature")ce(fe.geometry,Pe);else if(qe==="Polygon")ve(fe.coordinates,Pe);else if(qe==="MultiPolygon")for(Be=0;Be<fe.coordinates.length;Be++)ve(fe.coordinates[Be],Pe);return fe}}(),De=_.cx(Se);const Ke=_.cs.VectorTileFeature.prototype.toGeoJSON;class et{constructor(se){this._feature=se,this.extent=_.X,this.type=se.type,this.properties=se.tags,"id"in se&&!isNaN(se.id)&&(this.id=parseInt(se.id,10))}loadGeometry(){if(this._feature.type===1){const se=[];for(const ce of this._feature.geometry)se.push([new _.P(ce[0],ce[1])]);return se}{const se=[];for(const ce of this._feature.geometry){const fe=[];for(const Pe of ce)fe.push(new _.P(Pe[0],Pe[1]));se.push(fe)}return se}}toGeoJSON(se,ce,fe){return Ke.call(this,se,ce,fe)}}class vt{constructor(se){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=_.X,this.length=se.length,this._features=se}feature(se){return new et(this._features[se])}}var Ye,it,at,be={exports:{}},te=function(){if(at)return be.exports;at=1;var ve=_.cA(),se=function(){if(it)return Ye;it=1;var ut=_.cy(),Xe=_.cz().VectorTileFeature;function Ue(Nt,en){this.options=en||{},this.features=Nt,this.length=Nt.length}function zt(Nt,en){this.id=typeof Nt.id=="number"?Nt.id:void 0,this.type=Nt.type,this.rawGeometry=Nt.type===1?[Nt.geometry]:Nt.geometry,this.properties=Nt.tags,this.extent=en||4096}return Ye=Ue,Ue.prototype.feature=function(Nt){return new zt(this.features[Nt],this.options.extent)},zt.prototype.loadGeometry=function(){var Nt=this.rawGeometry;this.geometry=[];for(var en=0;en<Nt.length;en++){for(var Pn=Nt[en],mt=[],Vt=0;Vt<Pn.length;Vt++)mt.push(new ut(Pn[Vt][0],Pn[Vt][1]));this.geometry.push(mt)}return this.geometry},zt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Nt=this.geometry,en=1/0,Pn=-1/0,mt=1/0,Vt=-1/0,$t=0;$t<Nt.length;$t++)for(var Lt=Nt[$t],Nn=0;Nn<Lt.length;Nn++){var mn=Lt[Nn];en=Math.min(en,mn.x),Pn=Math.max(Pn,mn.x),mt=Math.min(mt,mn.y),Vt=Math.max(Vt,mn.y)}return[en,mt,Pn,Vt]},zt.prototype.toGeoJSON=Xe.prototype.toGeoJSON,Ye}();function ce(ut){var Xe=new ve;return function(Ue,zt){for(var Nt in Ue.layers)zt.writeMessage(3,fe,Ue.layers[Nt])}(ut,Xe),Xe.finish()}function fe(ut,Xe){var Ue;Xe.writeVarintField(15,ut.version||1),Xe.writeStringField(1,ut.name||""),Xe.writeVarintField(5,ut.extent||4096);var zt={keys:[],values:[],keycache:{},valuecache:{}};for(Ue=0;Ue<ut.length;Ue++)zt.feature=ut.feature(Ue),Xe.writeMessage(2,Pe,zt);var Nt=zt.keys;for(Ue=0;Ue<Nt.length;Ue++)Xe.writeStringField(3,Nt[Ue]);var en=zt.values;for(Ue=0;Ue<en.length;Ue++)Xe.writeMessage(4,ht,en[Ue])}function Pe(ut,Xe){var Ue=ut.feature;Ue.id!==void 0&&Xe.writeVarintField(1,Ue.id),Xe.writeMessage(2,Be,ut),Xe.writeVarintField(3,Ue.type),Xe.writeMessage(4,Ge,Ue)}function Be(ut,Xe){var Ue=ut.feature,zt=ut.keys,Nt=ut.values,en=ut.keycache,Pn=ut.valuecache;for(var mt in Ue.properties){var Vt=Ue.properties[mt],$t=en[mt];if(Vt!==null){$t===void 0&&(zt.push(mt),en[mt]=$t=zt.length-1),Xe.writeVarint($t);var Lt=typeof Vt;Lt!=="string"&&Lt!=="boolean"&&Lt!=="number"&&(Vt=JSON.stringify(Vt));var Nn=Lt+":"+Vt,mn=Pn[Nn];mn===void 0&&(Nt.push(Vt),Pn[Nn]=mn=Nt.length-1),Xe.writeVarint(mn)}}}function qe(ut,Xe){return(Xe<<3)+(7&ut)}function tt(ut){return ut<<1^ut>>31}function Ge(ut,Xe){for(var Ue=ut.loadGeometry(),zt=ut.type,Nt=0,en=0,Pn=Ue.length,mt=0;mt<Pn;mt++){var Vt=Ue[mt],$t=1;zt===1&&($t=Vt.length),Xe.writeVarint(qe(1,$t));for(var Lt=zt===3?Vt.length-1:Vt.length,Nn=0;Nn<Lt;Nn++){Nn===1&&zt!==1&&Xe.writeVarint(qe(2,Lt-1));var mn=Vt[Nn].x-Nt,Yt=Vt[Nn].y-en;Xe.writeVarint(tt(mn)),Xe.writeVarint(tt(Yt)),Nt+=mn,en+=Yt}zt===3&&Xe.writeVarint(qe(7,1))}}function ht(ut,Xe){var Ue=typeof ut;Ue==="string"?Xe.writeStringField(1,ut):Ue==="boolean"?Xe.writeBooleanField(7,ut):Ue==="number"&&(ut%1!=0?Xe.writeDoubleField(3,ut):ut<0?Xe.writeSVarintField(6,ut):Xe.writeVarintField(5,ut))}return be.exports=ce,be.exports.fromVectorTileJs=ce,be.exports.fromGeojsonVt=function(ut,Xe){Xe=Xe||{};var Ue={};for(var zt in ut)Ue[zt]=new se(ut[zt].features,Xe),Ue[zt].name=zt,Ue[zt].version=Xe.version,Ue[zt].extent=Xe.extent;return ce({layers:Ue})},be.exports.GeoJSONWrapper=se,be.exports}(),pe=_.cx(te);const xe={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ve=>ve},Ae=Math.fround||($e=new Float32Array(1),ve=>($e[0]=+ve,$e[0]));var $e;const Ce=3,pn=5,ri=6;class dn{constructor(se){this.options=Object.assign(Object.create(xe),se),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(se){const{log:ce,minZoom:fe,maxZoom:Pe}=this.options;ce&&console.time("total time");const Be=`prepare ${se.length} points`;ce&&console.time(Be),this.points=se;const qe=[];for(let Ge=0;Ge<se.length;Ge++){const ht=se[Ge];if(!ht.geometry)continue;const[ut,Xe]=ht.geometry.coordinates,Ue=Ae(gn(ut)),zt=Ae(St(Xe));qe.push(Ue,zt,1/0,Ge,-1,1),this.options.reduce&&qe.push(0)}let tt=this.trees[Pe+1]=this._createTree(qe);ce&&console.timeEnd(Be);for(let Ge=Pe;Ge>=fe;Ge--){const ht=+Date.now();tt=this.trees[Ge]=this._createTree(this._cluster(tt,Ge)),ce&&console.log("z%d: %d clusters in %dms",Ge,tt.numItems,+Date.now()-ht)}return ce&&console.timeEnd("total time"),this}getClusters(se,ce){let fe=((se[0]+180)%360+360)%360-180;const Pe=Math.max(-90,Math.min(90,se[1]));let Be=se[2]===180?180:((se[2]+180)%360+360)%360-180;const qe=Math.max(-90,Math.min(90,se[3]));if(se[2]-se[0]>=360)fe=-180,Be=180;else if(fe>Be){const Xe=this.getClusters([fe,Pe,180,qe],ce),Ue=this.getClusters([-180,Pe,Be,qe],ce);return Xe.concat(Ue)}const tt=this.trees[this._limitZoom(ce)],Ge=tt.range(gn(fe),St(qe),gn(Be),St(Pe)),ht=tt.data,ut=[];for(const Xe of Ge){const Ue=this.stride*Xe;ut.push(ht[Ue+pn]>1?jn(ht,Ue,this.clusterProps):this.points[ht[Ue+Ce]])}return ut}getChildren(se){const ce=this._getOriginId(se),fe=this._getOriginZoom(se),Pe="No cluster with the specified id.",Be=this.trees[fe];if(!Be)throw new Error(Pe);const qe=Be.data;if(ce*this.stride>=qe.length)throw new Error(Pe);const tt=this.options.radius/(this.options.extent*Math.pow(2,fe-1)),Ge=Be.within(qe[ce*this.stride],qe[ce*this.stride+1],tt),ht=[];for(const ut of Ge){const Xe=ut*this.stride;qe[Xe+4]===se&&ht.push(qe[Xe+pn]>1?jn(qe,Xe,this.clusterProps):this.points[qe[Xe+Ce]])}if(ht.length===0)throw new Error(Pe);return ht}getLeaves(se,ce,fe){const Pe=[];return this._appendLeaves(Pe,se,ce=ce||10,fe=fe||0,0),Pe}getTile(se,ce,fe){const Pe=this.trees[this._limitZoom(se)],Be=Math.pow(2,se),{extent:qe,radius:tt}=this.options,Ge=tt/qe,ht=(fe-Ge)/Be,ut=(fe+1+Ge)/Be,Xe={features:[]};return this._addTileFeatures(Pe.range((ce-Ge)/Be,ht,(ce+1+Ge)/Be,ut),Pe.data,ce,fe,Be,Xe),ce===0&&this._addTileFeatures(Pe.range(1-Ge/Be,ht,1,ut),Pe.data,Be,fe,Be,Xe),ce===Be-1&&this._addTileFeatures(Pe.range(0,ht,Ge/Be,ut),Pe.data,-1,fe,Be,Xe),Xe.features.length?Xe:null}getClusterExpansionZoom(se){let ce=this._getOriginZoom(se)-1;for(;ce<=this.options.maxZoom;){const fe=this.getChildren(se);if(ce++,fe.length!==1)break;se=fe[0].properties.cluster_id}return ce}_appendLeaves(se,ce,fe,Pe,Be){const qe=this.getChildren(ce);for(const tt of qe){const Ge=tt.properties;if(Ge&&Ge.cluster?Be+Ge.point_count<=Pe?Be+=Ge.point_count:Be=this._appendLeaves(se,Ge.cluster_id,fe,Pe,Be):Be<Pe?Be++:se.push(tt),se.length===fe)break}return Be}_createTree(se){const ce=new _.az(se.length/this.stride|0,this.options.nodeSize,Float32Array);for(let fe=0;fe<se.length;fe+=this.stride)ce.add(se[fe],se[fe+1]);return ce.finish(),ce.data=se,ce}_addTileFeatures(se,ce,fe,Pe,Be,qe){for(const tt of se){const Ge=tt*this.stride,ht=ce[Ge+pn]>1;let ut,Xe,Ue;if(ht)ut=Tt(ce,Ge,this.clusterProps),Xe=ce[Ge],Ue=ce[Ge+1];else{const en=this.points[ce[Ge+Ce]];ut=en.properties;const[Pn,mt]=en.geometry.coordinates;Xe=gn(Pn),Ue=St(mt)}const zt={type:1,geometry:[[Math.round(this.options.extent*(Xe*Be-fe)),Math.round(this.options.extent*(Ue*Be-Pe))]],tags:ut};let Nt;Nt=ht||this.options.generateId?ce[Ge+Ce]:this.points[ce[Ge+Ce]].id,Nt!==void 0&&(zt.id=Nt),qe.features.push(zt)}}_limitZoom(se){return Math.max(this.options.minZoom,Math.min(Math.floor(+se),this.options.maxZoom+1))}_cluster(se,ce){const{radius:fe,extent:Pe,reduce:Be,minPoints:qe}=this.options,tt=fe/(Pe*Math.pow(2,ce)),Ge=se.data,ht=[],ut=this.stride;for(let Xe=0;Xe<Ge.length;Xe+=ut){if(Ge[Xe+2]<=ce)continue;Ge[Xe+2]=ce;const Ue=Ge[Xe],zt=Ge[Xe+1],Nt=se.within(Ge[Xe],Ge[Xe+1],tt),en=Ge[Xe+pn];let Pn=en;for(const mt of Nt){const Vt=mt*ut;Ge[Vt+2]>ce&&(Pn+=Ge[Vt+pn])}if(Pn>en&&Pn>=qe){let mt,Vt=Ue*en,$t=zt*en,Lt=-1;const Nn=((Xe/ut|0)<<5)+(ce+1)+this.points.length;for(const mn of Nt){const Yt=mn*ut;if(Ge[Yt+2]<=ce)continue;Ge[Yt+2]=ce;const Ri=Ge[Yt+pn];Vt+=Ge[Yt]*Ri,$t+=Ge[Yt+1]*Ri,Ge[Yt+4]=Nn,Be&&(mt||(mt=this._map(Ge,Xe,!0),Lt=this.clusterProps.length,this.clusterProps.push(mt)),Be(mt,this._map(Ge,Yt)))}Ge[Xe+4]=Nn,ht.push(Vt/Pn,$t/Pn,1/0,Nn,-1,Pn),Be&&ht.push(Lt)}else{for(let mt=0;mt<ut;mt++)ht.push(Ge[Xe+mt]);if(Pn>1)for(const mt of Nt){const Vt=mt*ut;if(!(Ge[Vt+2]<=ce)){Ge[Vt+2]=ce;for(let $t=0;$t<ut;$t++)ht.push(Ge[Vt+$t])}}}}return ht}_getOriginId(se){return se-this.points.length>>5}_getOriginZoom(se){return(se-this.points.length)%32}_map(se,ce,fe){if(se[ce+pn]>1){const qe=this.clusterProps[se[ce+ri]];return fe?Object.assign({},qe):qe}const Pe=this.points[se[ce+Ce]].properties,Be=this.options.map(Pe);return fe&&Be===Pe?Object.assign({},Be):Be}}function jn(ve,se,ce){return{type:"Feature",id:ve[se+Ce],properties:Tt(ve,se,ce),geometry:{type:"Point",coordinates:[(fe=ve[se],360*(fe-.5)),Ze(ve[se+1])]}};var fe}function Tt(ve,se,ce){const fe=ve[se+pn],Pe=fe>=1e4?`${Math.round(fe/1e3)}k`:fe>=1e3?Math.round(fe/100)/10+"k":fe,Be=ve[se+ri],qe=Be===-1?{}:Object.assign({},ce[Be]);return Object.assign(qe,{cluster:!0,cluster_id:ve[se+Ce],point_count:fe,point_count_abbreviated:Pe})}function gn(ve){return ve/360+.5}function St(ve){const se=Math.sin(ve*Math.PI/180),ce=.5-.25*Math.log((1+se)/(1-se))/Math.PI;return ce<0?0:ce>1?1:ce}function Ze(ve){const se=(180-360*ve)*Math.PI/180;return 360*Math.atan(Math.exp(se))/Math.PI-90}function wt(ve,se,ce,fe){let Pe=fe;const Be=se+(ce-se>>1);let qe,tt=ce-se;const Ge=ve[se],ht=ve[se+1],ut=ve[ce],Xe=ve[ce+1];for(let Ue=se+3;Ue<ce;Ue+=3){const zt=Qt(ve[Ue],ve[Ue+1],Ge,ht,ut,Xe);if(zt>Pe)qe=Ue,Pe=zt;else if(zt===Pe){const Nt=Math.abs(Ue-Be);Nt<tt&&(qe=Ue,tt=Nt)}}Pe>fe&&(qe-se>3&&wt(ve,se,qe,fe),ve[qe+2]=Pe,ce-qe>3&&wt(ve,qe,ce,fe))}function Qt(ve,se,ce,fe,Pe,Be){let qe=Pe-ce,tt=Be-fe;if(qe!==0||tt!==0){const Ge=((ve-ce)*qe+(se-fe)*tt)/(qe*qe+tt*tt);Ge>1?(ce=Pe,fe=Be):Ge>0&&(ce+=qe*Ge,fe+=tt*Ge)}return qe=ve-ce,tt=se-fe,qe*qe+tt*tt}function sn(ve,se,ce,fe){const Pe={id:ve??null,type:se,geometry:ce,tags:fe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(se==="Point"||se==="MultiPoint"||se==="LineString")Xt(Pe,ce);else if(se==="Polygon")Xt(Pe,ce[0]);else if(se==="MultiLineString")for(const Be of ce)Xt(Pe,Be);else if(se==="MultiPolygon")for(const Be of ce)Xt(Pe,Be[0]);return Pe}function Xt(ve,se){for(let ce=0;ce<se.length;ce+=3)ve.minX=Math.min(ve.minX,se[ce]),ve.minY=Math.min(ve.minY,se[ce+1]),ve.maxX=Math.max(ve.maxX,se[ce]),ve.maxY=Math.max(ve.maxY,se[ce+1])}function nn(ve,se,ce,fe){if(!se.geometry)return;const Pe=se.geometry.coordinates;if(Pe&&Pe.length===0)return;const Be=se.geometry.type,qe=Math.pow(ce.tolerance/((1<<ce.maxZoom)*ce.extent),2);let tt=[],Ge=se.id;if(ce.promoteId?Ge=se.properties[ce.promoteId]:ce.generateId&&(Ge=fe||0),Be==="Point")Fn(Pe,tt);else if(Be==="MultiPoint")for(const ht of Pe)Fn(ht,tt);else if(Be==="LineString")$n(Pe,tt,qe,!1);else if(Be==="MultiLineString"){if(ce.lineMetrics){for(const ht of Pe)tt=[],$n(ht,tt,qe,!1),ve.push(sn(Ge,"LineString",tt,se.properties));return}Jn(Pe,tt,qe,!1)}else if(Be==="Polygon")Jn(Pe,tt,qe,!0);else{if(Be!=="MultiPolygon"){if(Be==="GeometryCollection"){for(const ht of se.geometry.geometries)nn(ve,{id:Ge,geometry:ht,properties:se.properties},ce,fe);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const ht of Pe){const ut=[];Jn(ht,ut,qe,!0),tt.push(ut)}}ve.push(sn(Ge,Be,tt,se.properties))}function Fn(ve,se){se.push(ur(ve[0]),Ji(ve[1]),0)}function $n(ve,se,ce,fe){let Pe,Be,qe=0;for(let Ge=0;Ge<ve.length;Ge++){const ht=ur(ve[Ge][0]),ut=Ji(ve[Ge][1]);se.push(ht,ut,0),Ge>0&&(qe+=fe?(Pe*ut-ht*Be)/2:Math.sqrt(Math.pow(ht-Pe,2)+Math.pow(ut-Be,2))),Pe=ht,Be=ut}const tt=se.length-3;se[2]=1,wt(se,0,tt,ce),se[tt+2]=1,se.size=Math.abs(qe),se.start=0,se.end=se.size}function Jn(ve,se,ce,fe){for(let Pe=0;Pe<ve.length;Pe++){const Be=[];$n(ve[Pe],Be,ce,fe),se.push(Be)}}function ur(ve){return ve/360+.5}function Ji(ve){const se=Math.sin(ve*Math.PI/180),ce=.5-.25*Math.log((1+se)/(1-se))/Math.PI;return ce<0?0:ce>1?1:ce}function Ui(ve,se,ce,fe,Pe,Be,qe,tt){if(fe/=se,Be>=(ce/=se)&&qe<fe)return ve;if(qe<ce||Be>=fe)return null;const Ge=[];for(const ht of ve){const ut=ht.geometry;let Xe=ht.type;const Ue=Pe===0?ht.minX:ht.minY,zt=Pe===0?ht.maxX:ht.maxY;if(Ue>=ce&&zt<fe){Ge.push(ht);continue}if(zt<ce||Ue>=fe)continue;let Nt=[];if(Xe==="Point"||Xe==="MultiPoint")Hr(ut,Nt,ce,fe,Pe);else if(Xe==="LineString")Wi(ut,Nt,ce,fe,Pe,!1,tt.lineMetrics);else if(Xe==="MultiLineString")bs(ut,Nt,ce,fe,Pe,!1);else if(Xe==="Polygon")bs(ut,Nt,ce,fe,Pe,!0);else if(Xe==="MultiPolygon")for(const en of ut){const Pn=[];bs(en,Pn,ce,fe,Pe,!0),Pn.length&&Nt.push(Pn)}if(Nt.length){if(tt.lineMetrics&&Xe==="LineString"){for(const en of Nt)Ge.push(sn(ht.id,Xe,en,ht.tags));continue}Xe!=="LineString"&&Xe!=="MultiLineString"||(Nt.length===1?(Xe="LineString",Nt=Nt[0]):Xe="MultiLineString"),Xe!=="Point"&&Xe!=="MultiPoint"||(Xe=Nt.length===3?"Point":"MultiPoint"),Ge.push(sn(ht.id,Xe,Nt,ht.tags))}}return Ge.length?Ge:null}function Hr(ve,se,ce,fe,Pe){for(let Be=0;Be<ve.length;Be+=3){const qe=ve[Be+Pe];qe>=ce&&qe<=fe&&Qr(se,ve[Be],ve[Be+1],ve[Be+2])}}function Wi(ve,se,ce,fe,Pe,Be,qe){let tt=Qo(ve);const Ge=Pe===0?Oo:Jo;let ht,ut,Xe=ve.start;for(let Pn=0;Pn<ve.length-3;Pn+=3){const mt=ve[Pn],Vt=ve[Pn+1],$t=ve[Pn+2],Lt=ve[Pn+3],Nn=ve[Pn+4],mn=Pe===0?mt:Vt,Yt=Pe===0?Lt:Nn;let Ri=!1;qe&&(ht=Math.sqrt(Math.pow(mt-Lt,2)+Math.pow(Vt-Nn,2))),mn<ce?Yt>ce&&(ut=Ge(tt,mt,Vt,Lt,Nn,ce),qe&&(tt.start=Xe+ht*ut)):mn>fe?Yt<fe&&(ut=Ge(tt,mt,Vt,Lt,Nn,fe),qe&&(tt.start=Xe+ht*ut)):Qr(tt,mt,Vt,$t),Yt<ce&&mn>=ce&&(ut=Ge(tt,mt,Vt,Lt,Nn,ce),Ri=!0),Yt>fe&&mn<=fe&&(ut=Ge(tt,mt,Vt,Lt,Nn,fe),Ri=!0),!Be&&Ri&&(qe&&(tt.end=Xe+ht*ut),se.push(tt),tt=Qo(ve)),qe&&(Xe+=ht)}let Ue=ve.length-3;const zt=ve[Ue],Nt=ve[Ue+1],en=Pe===0?zt:Nt;en>=ce&&en<=fe&&Qr(tt,zt,Nt,ve[Ue+2]),Ue=tt.length-3,Be&&Ue>=3&&(tt[Ue]!==tt[0]||tt[Ue+1]!==tt[1])&&Qr(tt,tt[0],tt[1],tt[2]),tt.length&&se.push(tt)}function Qo(ve){const se=[];return se.size=ve.size,se.start=ve.start,se.end=ve.end,se}function bs(ve,se,ce,fe,Pe,Be){for(const qe of ve)Wi(qe,se,ce,fe,Pe,Be,!1)}function Qr(ve,se,ce,fe){ve.push(se,ce,fe)}function Oo(ve,se,ce,fe,Pe,Be){const qe=(Be-se)/(fe-se);return Qr(ve,Be,ce+(Pe-ce)*qe,1),qe}function Jo(ve,se,ce,fe,Pe,Be){const qe=(Be-ce)/(Pe-ce);return Qr(ve,se+(fe-se)*qe,Be,1),qe}function vr(ve,se){const ce=[];for(let fe=0;fe<ve.length;fe++){const Pe=ve[fe],Be=Pe.type;let qe;if(Be==="Point"||Be==="MultiPoint"||Be==="LineString")qe=Jr(Pe.geometry,se);else if(Be==="MultiLineString"||Be==="Polygon"){qe=[];for(const tt of Pe.geometry)qe.push(Jr(tt,se))}else if(Be==="MultiPolygon"){qe=[];for(const tt of Pe.geometry){const Ge=[];for(const ht of tt)Ge.push(Jr(ht,se));qe.push(Ge)}}ce.push(sn(Pe.id,Be,qe,Pe.tags))}return ce}function Jr(ve,se){const ce=[];ce.size=ve.size,ve.start!==void 0&&(ce.start=ve.start,ce.end=ve.end);for(let fe=0;fe<ve.length;fe+=3)ce.push(ve[fe]+se,ve[fe+1],ve[fe+2]);return ce}function Ts(ve,se){if(ve.transformed)return ve;const ce=1<<ve.z,fe=ve.x,Pe=ve.y;for(const Be of ve.features){const qe=Be.geometry,tt=Be.type;if(Be.geometry=[],tt===1)for(let Ge=0;Ge<qe.length;Ge+=2)Be.geometry.push(Fo(qe[Ge],qe[Ge+1],se,ce,fe,Pe));else for(let Ge=0;Ge<qe.length;Ge++){const ht=[];for(let ut=0;ut<qe[Ge].length;ut+=2)ht.push(Fo(qe[Ge][ut],qe[Ge][ut+1],se,ce,fe,Pe));Be.geometry.push(ht)}}return ve.transformed=!0,ve}function Fo(ve,se,ce,fe,Pe,Be){return[Math.round(ce*(ve*fe-Pe)),Math.round(ce*(se*fe-Be))]}function _a(ve,se,ce,fe,Pe){const Be=se===Pe.maxZoom?0:Pe.tolerance/((1<<se)*Pe.extent),qe={features:[],numPoints:0,numSimplified:0,numFeatures:ve.length,source:null,x:ce,y:fe,z:se,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const tt of ve)Hs(qe,tt,Be,Pe);return qe}function Hs(ve,se,ce,fe){const Pe=se.geometry,Be=se.type,qe=[];if(ve.minX=Math.min(ve.minX,se.minX),ve.minY=Math.min(ve.minY,se.minY),ve.maxX=Math.max(ve.maxX,se.maxX),ve.maxY=Math.max(ve.maxY,se.maxY),Be==="Point"||Be==="MultiPoint")for(let tt=0;tt<Pe.length;tt+=3)qe.push(Pe[tt],Pe[tt+1]),ve.numPoints++,ve.numSimplified++;else if(Be==="LineString")Mi(qe,Pe,ve,ce,!1,!1);else if(Be==="MultiLineString"||Be==="Polygon")for(let tt=0;tt<Pe.length;tt++)Mi(qe,Pe[tt],ve,ce,Be==="Polygon",tt===0);else if(Be==="MultiPolygon")for(let tt=0;tt<Pe.length;tt++){const Ge=Pe[tt];for(let ht=0;ht<Ge.length;ht++)Mi(qe,Ge[ht],ve,ce,!0,ht===0)}if(qe.length){let tt=se.tags||null;if(Be==="LineString"&&fe.lineMetrics){tt={};for(const ht in se.tags)tt[ht]=se.tags[ht];tt.mapbox_clip_start=Pe.start/Pe.size,tt.mapbox_clip_end=Pe.end/Pe.size}const Ge={geometry:qe,type:Be==="Polygon"||Be==="MultiPolygon"?3:Be==="LineString"||Be==="MultiLineString"?2:1,tags:tt};se.id!==null&&(Ge.id=se.id),ve.features.push(Ge)}}function Mi(ve,se,ce,fe,Pe,Be){const qe=fe*fe;if(fe>0&&se.size<(Pe?qe:fe))return void(ce.numPoints+=se.length/3);const tt=[];for(let Ge=0;Ge<se.length;Ge+=3)(fe===0||se[Ge+2]>qe)&&(ce.numSimplified++,tt.push(se[Ge],se[Ge+1])),ce.numPoints++;Pe&&function(Ge,ht){let ut=0;for(let Xe=0,Ue=Ge.length,zt=Ue-2;Xe<Ue;zt=Xe,Xe+=2)ut+=(Ge[Xe]-Ge[zt])*(Ge[Xe+1]+Ge[zt+1]);if(ut>0===ht)for(let Xe=0,Ue=Ge.length;Xe<Ue/2;Xe+=2){const zt=Ge[Xe],Nt=Ge[Xe+1];Ge[Xe]=Ge[Ue-2-Xe],Ge[Xe+1]=Ge[Ue-1-Xe],Ge[Ue-2-Xe]=zt,Ge[Ue-1-Xe]=Nt}}(tt,Be),ve.push(tt)}const er={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class qr{constructor(se,ce){const fe=(ce=this.options=function(Be,qe){for(const tt in qe)Be[tt]=qe[tt];return Be}(Object.create(er),ce)).debug;if(fe&&console.time("preprocess data"),ce.maxZoom<0||ce.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ce.promoteId&&ce.generateId)throw new Error("promoteId and generateId cannot be used together.");let Pe=function(Be,qe){const tt=[];if(Be.type==="FeatureCollection")for(let Ge=0;Ge<Be.features.length;Ge++)nn(tt,Be.features[Ge],qe,Ge);else nn(tt,Be.type==="Feature"?Be:{geometry:Be},qe);return tt}(se,ce);this.tiles={},this.tileCoords=[],fe&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ce.indexMaxZoom,ce.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Pe=function(Be,qe){const tt=qe.buffer/qe.extent;let Ge=Be;const ht=Ui(Be,1,-1-tt,tt,0,-1,2,qe),ut=Ui(Be,1,1-tt,2+tt,0,-1,2,qe);return(ht||ut)&&(Ge=Ui(Be,1,-tt,1+tt,0,-1,2,qe)||[],ht&&(Ge=vr(ht,1).concat(Ge)),ut&&(Ge=Ge.concat(vr(ut,-1)))),Ge}(Pe,ce),Pe.length&&this.splitTile(Pe,0,0,0),fe&&(Pe.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(se,ce,fe,Pe,Be,qe,tt){const Ge=[se,ce,fe,Pe],ht=this.options,ut=ht.debug;for(;Ge.length;){Pe=Ge.pop(),fe=Ge.pop(),ce=Ge.pop(),se=Ge.pop();const Xe=1<<ce,Ue=qs(ce,fe,Pe);let zt=this.tiles[Ue];if(!zt&&(ut>1&&console.time("creation"),zt=this.tiles[Ue]=_a(se,ce,fe,Pe,ht),this.tileCoords.push({z:ce,x:fe,y:Pe}),ut)){ut>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ce,fe,Pe,zt.numFeatures,zt.numPoints,zt.numSimplified),console.timeEnd("creation"));const Ri=`z${ce}`;this.stats[Ri]=(this.stats[Ri]||0)+1,this.total++}if(zt.source=se,Be==null){if(ce===ht.indexMaxZoom||zt.numPoints<=ht.indexMaxPoints)continue}else{if(ce===ht.maxZoom||ce===Be)continue;if(Be!=null){const Ri=Be-ce;if(fe!==qe>>Ri||Pe!==tt>>Ri)continue}}if(zt.source=null,se.length===0)continue;ut>1&&console.time("clipping");const Nt=.5*ht.buffer/ht.extent,en=.5-Nt,Pn=.5+Nt,mt=1+Nt;let Vt=null,$t=null,Lt=null,Nn=null,mn=Ui(se,Xe,fe-Nt,fe+Pn,0,zt.minX,zt.maxX,ht),Yt=Ui(se,Xe,fe+en,fe+mt,0,zt.minX,zt.maxX,ht);se=null,mn&&(Vt=Ui(mn,Xe,Pe-Nt,Pe+Pn,1,zt.minY,zt.maxY,ht),$t=Ui(mn,Xe,Pe+en,Pe+mt,1,zt.minY,zt.maxY,ht),mn=null),Yt&&(Lt=Ui(Yt,Xe,Pe-Nt,Pe+Pn,1,zt.minY,zt.maxY,ht),Nn=Ui(Yt,Xe,Pe+en,Pe+mt,1,zt.minY,zt.maxY,ht),Yt=null),ut>1&&console.timeEnd("clipping"),Ge.push(Vt||[],ce+1,2*fe,2*Pe),Ge.push($t||[],ce+1,2*fe,2*Pe+1),Ge.push(Lt||[],ce+1,2*fe+1,2*Pe),Ge.push(Nn||[],ce+1,2*fe+1,2*Pe+1)}}getTile(se,ce,fe){se=+se,ce=+ce,fe=+fe;const Pe=this.options,{extent:Be,debug:qe}=Pe;if(se<0||se>24)return null;const tt=1<<se,Ge=qs(se,ce=ce+tt&tt-1,fe);if(this.tiles[Ge])return Ts(this.tiles[Ge],Be);qe>1&&console.log("drilling down to z%d-%d-%d",se,ce,fe);let ht,ut=se,Xe=ce,Ue=fe;for(;!ht&&ut>0;)ut--,Xe>>=1,Ue>>=1,ht=this.tiles[qs(ut,Xe,Ue)];return ht&&ht.source?(qe>1&&(console.log("found parent tile z%d-%d-%d",ut,Xe,Ue),console.time("drilling down")),this.splitTile(ht.source,ut,Xe,Ue,se,ce,fe),qe>1&&console.timeEnd("drilling down"),this.tiles[Ge]?Ts(this.tiles[Ge],Be):null):null}}function qs(ve,se,ce){return 32*((1<<ve)*ce+se)+ve}function uo(ve,se){return se?ve.properties[se]:ve.id}function es(ve,se){if(ve==null)return!0;if(ve.type==="Feature")return uo(ve,se)!=null;if(ve.type==="FeatureCollection"){const ce=new Set;for(const fe of ve.features){const Pe=uo(fe,se);if(Pe==null||ce.has(Pe))return!1;ce.add(Pe)}return!0}return!1}function Ss(ve,se){const ce=new Map;if(ve!=null)if(ve.type==="Feature")ce.set(uo(ve,se),ve);else for(const fe of ve.features)ce.set(uo(fe,se),fe);return ce}class ya extends ne{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(se,ce){return _._(this,void 0,void 0,function*(){const fe=se.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const Pe=this._geoJSONIndex.getTile(fe.z,fe.x,fe.y);if(!Pe)return null;const Be=new vt(Pe.features);let qe=pe(Be);return qe.byteOffset===0&&qe.byteLength===qe.buffer.byteLength||(qe=new Uint8Array(qe)),{vectorTile:Be,rawData:qe.buffer}})}loadData(se){return _._(this,void 0,void 0,function*(){var ce;(ce=this._pendingRequest)===null||ce===void 0||ce.abort();const fe=!!(se&&se.request&&se.request.collectResourceTiming)&&new _.cu(se.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(se,this._pendingRequest),this._geoJSONIndex=se.cluster?new dn(function({superclusterOptions:qe,clusterProperties:tt}){if(!tt||!qe)return qe;const Ge={},ht={},ut={accumulated:null,zoom:0},Xe={properties:null},Ue=Object.keys(tt);for(const zt of Ue){const[Nt,en]=tt[zt],Pn=_.cB(en),mt=_.cB(typeof Nt=="string"?[Nt,["accumulated"],["get",zt]]:Nt);Ge[zt]=Pn.value,ht[zt]=mt.value}return qe.map=zt=>{Xe.properties=zt;const Nt={};for(const en of Ue)Nt[en]=Ge[en].evaluate(ut,Xe);return Nt},qe.reduce=(zt,Nt)=>{Xe.properties=Nt;for(const en of Ue)ut.accumulated=zt[en],zt[en]=ht[en].evaluate(ut,Xe)},qe}(se)).load((yield this._pendingData).features):(Pe=yield this._pendingData,new qr(Pe,se.geojsonVtOptions)),this.loaded={};const Be={};if(fe){const qe=fe.finish();qe&&(Be.resourceTiming={},Be.resourceTiming[se.source]=JSON.parse(JSON.stringify(qe)))}return Be}catch(Be){if(delete this._pendingRequest,_.cf(Be))return{abandoned:!0};throw Be}var Pe})}getData(){return _._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(se){const ce=this.loaded;return ce&&ce[se.uid]?super.reloadTile(se):this.loadTile(se)}loadAndProcessGeoJSON(se,ce){return _._(this,void 0,void 0,function*(){let fe=yield this.loadGeoJSON(se,ce);if(delete this._pendingRequest,typeof fe!="object")throw new Error(`Input data given to '${se.source}' is not a valid GeoJSON object.`);if(De(fe,!0),se.filter){const Pe=_.cB(se.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Pe.result==="error")throw new Error(Pe.value.map(qe=>`${qe.key}: ${qe.message}`).join(", "));fe={type:"FeatureCollection",features:fe.features.filter(qe=>Pe.value.evaluate({zoom:0},qe))}}return fe})}loadGeoJSON(se,ce){return _._(this,void 0,void 0,function*(){const{promoteId:fe}=se;if(se.request){const Pe=yield _.h(se.request,ce);return this._dataUpdateable=es(Pe.data,fe)?Ss(Pe.data,fe):void 0,Pe.data}if(typeof se.data=="string")try{const Pe=JSON.parse(se.data);return this._dataUpdateable=es(Pe,fe)?Ss(Pe,fe):void 0,Pe}catch{throw new Error(`Input data given to '${se.source}' is not a valid GeoJSON object.`)}if(!se.dataDiff)throw new Error(`Input data given to '${se.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${se.source}`);return function(Pe,Be,qe){var tt,Ge,ht,ut;if(Be.removeAll&&Pe.clear(),Be.remove)for(const Xe of Be.remove)Pe.delete(Xe);if(Be.add)for(const Xe of Be.add){const Ue=uo(Xe,qe);Ue!=null&&Pe.set(Ue,Xe)}if(Be.update)for(const Xe of Be.update){let Ue=Pe.get(Xe.id);if(Ue==null)continue;const zt=!Xe.removeAllProperties&&(((tt=Xe.removeProperties)===null||tt===void 0?void 0:tt.length)>0||((Ge=Xe.addOrUpdateProperties)===null||Ge===void 0?void 0:Ge.length)>0);if((Xe.newGeometry||Xe.removeAllProperties||zt)&&(Ue=Object.assign({},Ue),Pe.set(Xe.id,Ue),zt&&(Ue.properties=Object.assign({},Ue.properties))),Xe.newGeometry&&(Ue.geometry=Xe.newGeometry),Xe.removeAllProperties)Ue.properties={};else if(((ht=Xe.removeProperties)===null||ht===void 0?void 0:ht.length)>0)for(const Nt of Xe.removeProperties)Object.prototype.hasOwnProperty.call(Ue.properties,Nt)&&delete Ue.properties[Nt];if(((ut=Xe.addOrUpdateProperties)===null||ut===void 0?void 0:ut.length)>0)for(const{key:Nt,value:en}of Xe.addOrUpdateProperties)Ue.properties[Nt]=en}}(this._dataUpdateable,se.dataDiff,fe),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(se){return _._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(se){return this._geoJSONIndex.getClusterExpansionZoom(se.clusterId)}getClusterChildren(se){return this._geoJSONIndex.getChildren(se.clusterId)}getClusterLeaves(se){return this._geoJSONIndex.getLeaves(se.clusterId,se.limit,se.offset)}}class Bo{constructor(se){this.self=se,this.actor=new _.F(se),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(ce,fe)=>{if(this.externalWorkerSourceTypes[ce])throw new Error(`Worker source with name "${ce}" already registered.`);this.externalWorkerSourceTypes[ce]=fe},this.self.addProtocol=_.ch,this.self.removeProtocol=_.ci,this.self.registerRTLTextPlugin=ce=>{_.cC.setMethods(ce)},this.actor.registerMessageHandler("LDT",(ce,fe)=>this._getDEMWorkerSource(ce,fe.source).loadTile(fe)),this.actor.registerMessageHandler("RDT",(ce,fe)=>_._(this,void 0,void 0,function*(){this._getDEMWorkerSource(ce,fe.source).removeTile(fe)})),this.actor.registerMessageHandler("GCEZ",(ce,fe)=>_._(this,void 0,void 0,function*(){return this._getWorkerSource(ce,fe.type,fe.source).getClusterExpansionZoom(fe)})),this.actor.registerMessageHandler("GCC",(ce,fe)=>_._(this,void 0,void 0,function*(){return this._getWorkerSource(ce,fe.type,fe.source).getClusterChildren(fe)})),this.actor.registerMessageHandler("GCL",(ce,fe)=>_._(this,void 0,void 0,function*(){return this._getWorkerSource(ce,fe.type,fe.source).getClusterLeaves(fe)})),this.actor.registerMessageHandler("LD",(ce,fe)=>this._getWorkerSource(ce,fe.type,fe.source).loadData(fe)),this.actor.registerMessageHandler("GD",(ce,fe)=>this._getWorkerSource(ce,fe.type,fe.source).getData()),this.actor.registerMessageHandler("LT",(ce,fe)=>this._getWorkerSource(ce,fe.type,fe.source).loadTile(fe)),this.actor.registerMessageHandler("RT",(ce,fe)=>this._getWorkerSource(ce,fe.type,fe.source).reloadTile(fe)),this.actor.registerMessageHandler("AT",(ce,fe)=>this._getWorkerSource(ce,fe.type,fe.source).abortTile(fe)),this.actor.registerMessageHandler("RMT",(ce,fe)=>this._getWorkerSource(ce,fe.type,fe.source).removeTile(fe)),this.actor.registerMessageHandler("RS",(ce,fe)=>_._(this,void 0,void 0,function*(){if(!this.workerSources[ce]||!this.workerSources[ce][fe.type]||!this.workerSources[ce][fe.type][fe.source])return;const Pe=this.workerSources[ce][fe.type][fe.source];delete this.workerSources[ce][fe.type][fe.source],Pe.removeSource!==void 0&&Pe.removeSource(fe)})),this.actor.registerMessageHandler("RM",ce=>_._(this,void 0,void 0,function*(){delete this.layerIndexes[ce],delete this.availableImages[ce],delete this.workerSources[ce],delete this.demWorkerSources[ce]})),this.actor.registerMessageHandler("SR",(ce,fe)=>_._(this,void 0,void 0,function*(){this.referrer=fe})),this.actor.registerMessageHandler("SRPS",(ce,fe)=>this._syncRTLPluginState(ce,fe)),this.actor.registerMessageHandler("IS",(ce,fe)=>_._(this,void 0,void 0,function*(){this.self.importScripts(fe)})),this.actor.registerMessageHandler("SI",(ce,fe)=>this._setImages(ce,fe)),this.actor.registerMessageHandler("UL",(ce,fe)=>_._(this,void 0,void 0,function*(){this._getLayerIndex(ce).update(fe.layers,fe.removedIds)})),this.actor.registerMessageHandler("SL",(ce,fe)=>_._(this,void 0,void 0,function*(){this._getLayerIndex(ce).replace(fe)}))}_setImages(se,ce){return _._(this,void 0,void 0,function*(){this.availableImages[se]=ce;for(const fe in this.workerSources[se]){const Pe=this.workerSources[se][fe];for(const Be in Pe)Pe[Be].availableImages=ce}})}_syncRTLPluginState(se,ce){return _._(this,void 0,void 0,function*(){return yield _.cC.syncState(ce,this.self.importScripts)})}_getAvailableImages(se){let ce=this.availableImages[se];return ce||(ce=[]),ce}_getLayerIndex(se){let ce=this.layerIndexes[se];return ce||(ce=this.layerIndexes[se]=new u),ce}_getWorkerSource(se,ce,fe){if(this.workerSources[se]||(this.workerSources[se]={}),this.workerSources[se][ce]||(this.workerSources[se][ce]={}),!this.workerSources[se][ce][fe]){const Pe={sendAsync:(Be,qe)=>(Be.targetMapId=se,this.actor.sendAsync(Be,qe))};switch(ce){case"vector":this.workerSources[se][ce][fe]=new ne(Pe,this._getLayerIndex(se),this._getAvailableImages(se));break;case"geojson":this.workerSources[se][ce][fe]=new ya(Pe,this._getLayerIndex(se),this._getAvailableImages(se));break;default:this.workerSources[se][ce][fe]=new this.externalWorkerSourceTypes[ce](Pe,this._getLayerIndex(se),this._getAvailableImages(se))}}return this.workerSources[se][ce][fe]}_getDEMWorkerSource(se,ce){return this.demWorkerSources[se]||(this.demWorkerSources[se]={}),this.demWorkerSources[se][ce]||(this.demWorkerSources[se][ce]=new re),this.demWorkerSources[se][ce]}}return _.i(self)&&(self.worker=new Bo(self)),Bo}),h("index",["exports","./shared"],function(_,u){var R="5.1.0";function O(){var w=new u.A(4);return u.A!=Float32Array&&(w[1]=0,w[2]=0),w[0]=1,w[3]=1,w}let G,ne;const re={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(w,n,s){const m=requestAnimationFrame(n);w.signal.addEventListener("abort",()=>{cancelAnimationFrame(m),s(u.c())})},frameAsync(w){return new Promise((n,s)=>{this.frame(w,n,s)})},getImageData(w,n=0){return this.getImageCanvasContext(w).getImageData(-n,-n,w.width+2*n,w.height+2*n)},getImageCanvasContext(w){const n=window.document.createElement("canvas"),s=n.getContext("2d",{willReadFrequently:!0});if(!s)throw new Error("failed to create canvas 2d context");return n.width=w.width,n.height=w.height,s.drawImage(w,0,0,w.width,w.height),s},resolveURL:w=>(G||(G=document.createElement("a")),G.href=w,G.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(ne==null&&(ne=matchMedia("(prefers-reduced-motion: reduce)")),ne.matches)}};class Q{static testProp(n){if(!Q.docStyle)return n[0];for(let s=0;s<n.length;s++)if(n[s]in Q.docStyle)return n[s];return n[0]}static create(n,s,m){const y=window.document.createElement(n);return s!==void 0&&(y.className=s),m&&m.appendChild(y),y}static createNS(n,s){return window.document.createElementNS(n,s)}static disableDrag(){Q.docStyle&&Q.selectProp&&(Q.userSelect=Q.docStyle[Q.selectProp],Q.docStyle[Q.selectProp]="none")}static enableDrag(){Q.docStyle&&Q.selectProp&&(Q.docStyle[Q.selectProp]=Q.userSelect)}static setTransform(n,s){n.style[Q.transformProp]=s}static addEventListener(n,s,m,y={}){n.addEventListener(s,m,"passive"in y?y:y.capture)}static removeEventListener(n,s,m,y={}){n.removeEventListener(s,m,"passive"in y?y:y.capture)}static suppressClickInternal(n){n.preventDefault(),n.stopPropagation(),window.removeEventListener("click",Q.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",Q.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",Q.suppressClickInternal,!0)},0)}static getScale(n){const s=n.getBoundingClientRect();return{x:s.width/n.offsetWidth||1,y:s.height/n.offsetHeight||1,boundingClientRect:s}}static getPoint(n,s,m){const y=s.boundingClientRect;return new u.P((m.clientX-y.left)/s.x-n.clientLeft,(m.clientY-y.top)/s.y-n.clientTop)}static mousePos(n,s){const m=Q.getScale(n);return Q.getPoint(n,m,s)}static touchPos(n,s){const m=[],y=Q.getScale(n);for(let b=0;b<s.length;b++)m.push(Q.getPoint(n,y,s[b]));return m}static mouseButton(n){return n.button}static remove(n){n.parentNode&&n.parentNode.removeChild(n)}static sanitize(n){const s=new DOMParser().parseFromString(n,"text/html").body||document.createElement("body"),m=s.querySelectorAll("script");for(const y of m)y.remove();return Q.clean(s),s.innerHTML}static isPossiblyDangerous(n,s){const m=s.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(n)||!m.includes("javascript:")&&!m.includes("data:"))||!!n.startsWith("on")||void 0}static clean(n){const s=n.children;for(const m of s)Q.removeAttributes(m),Q.clean(m)}static removeAttributes(n){for(const{name:s,value:m}of n.attributes)Q.isPossiblyDangerous(s,m)&&n.removeAttribute(s)}}Q.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,Q.selectProp=Q.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),Q.transformProp=Q.testProp(["transform","WebkitTransform"]);const de={supported:!1,testSupport:function(w){!Ke&&De&&(et?vt(w):Se=w)}};let Se,De,Ke=!1,et=!1;function vt(w){const n=w.createTexture();w.bindTexture(w.TEXTURE_2D,n);try{if(w.texImage2D(w.TEXTURE_2D,0,w.RGBA,w.RGBA,w.UNSIGNED_BYTE,De),w.isContextLost())return;de.supported=!0}catch{}w.deleteTexture(n),Ke=!0}var Ye;typeof document<"u"&&(De=document.createElement("img"),De.onload=()=>{Se&&vt(Se),Se=null,et=!0},De.onerror=()=>{Ke=!0,Se=null},De.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(w){let n,s,m,y;w.resetRequestQueue=()=>{n=[],s=0,m=0,y={}},w.addThrottleControl=z=>{const B=m++;return y[B]=z,B},w.removeThrottleControl=z=>{delete y[z],I()},w.getImage=(z,B,q=!0)=>new Promise((W,K)=>{de.supported&&(z.headers||(z.headers={}),z.headers.accept="image/webp,*/*"),u.e(z,{type:"image"}),n.push({abortController:B,requestParameters:z,supportImageRefresh:q,state:"queued",onError:oe=>{K(oe)},onSuccess:oe=>{W(oe)}}),I()});const b=z=>u._(this,void 0,void 0,function*(){z.state="running";const{requestParameters:B,supportImageRefresh:q,onError:W,onSuccess:K,abortController:oe}=z,le=q===!1&&!u.i(self)&&!u.g(B.url)&&(!B.headers||Object.keys(B.headers).reduce((Te,Ie)=>Te&&Ie==="accept",!0));s++;const we=le?M(B,oe):u.m(B,oe);try{const Te=yield we;delete z.abortController,z.state="completed",Te.data instanceof HTMLImageElement||u.b(Te.data)?K(Te):Te.data&&K({data:yield(ge=Te.data,typeof createImageBitmap=="function"?u.d(ge):u.f(ge)),cacheControl:Te.cacheControl,expires:Te.expires})}catch(Te){delete z.abortController,W(Te)}finally{s--,I()}var ge}),I=()=>{const z=(()=>{for(const B of Object.keys(y))if(y[B]())return!0;return!1})()?u.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:u.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let B=s;B<z&&n.length>0;B++){const q=n.shift();q.abortController.signal.aborted?B--:b(q)}},M=(z,B)=>new Promise((q,W)=>{const K=new Image,oe=z.url,le=z.credentials;le&&le==="include"?K.crossOrigin="use-credentials":(le&&le==="same-origin"||!u.s(oe))&&(K.crossOrigin="anonymous"),B.signal.addEventListener("abort",()=>{K.src="",W(u.c())}),K.fetchPriority="high",K.onload=()=>{K.onerror=K.onload=null,q({data:K})},K.onerror=()=>{K.onerror=K.onload=null,B.signal.aborted||W(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},K.src=oe})}(Ye||(Ye={})),Ye.resetRequestQueue();class it{constructor(n){this._transformRequestFn=n}transformRequest(n,s){return this._transformRequestFn&&this._transformRequestFn(n,s)||{url:n}}setTransformRequest(n){this._transformRequestFn=n}}function at(w){const n=[];if(typeof w=="string")n.push({id:"default",url:w});else if(w&&w.length>0){const s=[];for(const{id:m,url:y}of w){const b=`${m}${y}`;s.indexOf(b)===-1&&(s.push(b),n.push({id:m,url:y}))}}return n}function be(w,n,s){try{const m=new URL(w);return m.pathname+=`${n}${s}`,m.toString()}catch{throw new Error(`Invalid sprite URL "${w}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}class te{constructor(n,s,m,y){this.context=n,this.format=m,this.texture=n.gl.createTexture(),this.update(s,y)}update(n,s,m){const{width:y,height:b}=n,I=!(this.size&&this.size[0]===y&&this.size[1]===b||m),{context:M}=this,{gl:z}=M;if(this.useMipmap=!!(s&&s.useMipmap),z.bindTexture(z.TEXTURE_2D,this.texture),M.pixelStoreUnpackFlipY.set(!1),M.pixelStoreUnpack.set(1),M.pixelStoreUnpackPremultiplyAlpha.set(this.format===z.RGBA&&(!s||s.premultiply!==!1)),I)this.size=[y,b],n instanceof HTMLImageElement||n instanceof HTMLCanvasElement||n instanceof HTMLVideoElement||n instanceof ImageData||u.b(n)?z.texImage2D(z.TEXTURE_2D,0,this.format,this.format,z.UNSIGNED_BYTE,n):z.texImage2D(z.TEXTURE_2D,0,this.format,y,b,0,this.format,z.UNSIGNED_BYTE,n.data);else{const{x:B,y:q}=m||{x:0,y:0};n instanceof HTMLImageElement||n instanceof HTMLCanvasElement||n instanceof HTMLVideoElement||n instanceof ImageData||u.b(n)?z.texSubImage2D(z.TEXTURE_2D,0,B,q,z.RGBA,z.UNSIGNED_BYTE,n):z.texSubImage2D(z.TEXTURE_2D,0,B,q,y,b,z.RGBA,z.UNSIGNED_BYTE,n.data)}this.useMipmap&&this.isSizePowerOfTwo()&&z.generateMipmap(z.TEXTURE_2D)}bind(n,s,m){const{context:y}=this,{gl:b}=y;b.bindTexture(b.TEXTURE_2D,this.texture),m!==b.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(m=b.LINEAR),n!==this.filter&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,n),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,m||n),this.filter=n),s!==this.wrap&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,s),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,s),this.wrap=s)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:n}=this.context;n.deleteTexture(this.texture),this.texture=null}}function pe(w){const{userImage:n}=w;return!!(n&&n.render&&n.render())&&(w.data.replace(new Uint8Array(n.data.buffer)),!0)}class xe extends u.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new u.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(n){if(this.loaded!==n&&(this.loaded=n,n)){for(const{ids:s,promiseResolve:m}of this.requestors)m(this._getImagesForIds(s));this.requestors=[]}}getImage(n){const s=this.images[n];if(s&&!s.data&&s.spriteData){const m=s.spriteData;s.data=new u.R({width:m.width,height:m.height},m.context.getImageData(m.x,m.y,m.width,m.height).data),s.spriteData=null}return s}addImage(n,s){if(this.images[n])throw new Error(`Image id ${n} already exist, use updateImage instead`);this._validate(n,s)&&(this.images[n]=s)}_validate(n,s){let m=!0;const y=s.data||s.spriteData;return this._validateStretch(s.stretchX,y&&y.width)||(this.fire(new u.j(new Error(`Image "${n}" has invalid "stretchX" value`))),m=!1),this._validateStretch(s.stretchY,y&&y.height)||(this.fire(new u.j(new Error(`Image "${n}" has invalid "stretchY" value`))),m=!1),this._validateContent(s.content,s)||(this.fire(new u.j(new Error(`Image "${n}" has invalid "content" value`))),m=!1),m}_validateStretch(n,s){if(!n)return!0;let m=0;for(const y of n){if(y[0]<m||y[1]<y[0]||s<y[1])return!1;m=y[1]}return!0}_validateContent(n,s){if(!n)return!0;if(n.length!==4)return!1;const m=s.spriteData,y=m&&m.width||s.data.width,b=m&&m.height||s.data.height;return!(n[0]<0||y<n[0]||n[1]<0||b<n[1]||n[2]<0||y<n[2]||n[3]<0||b<n[3]||n[2]<n[0]||n[3]<n[1])}updateImage(n,s,m=!0){const y=this.getImage(n);if(m&&(y.data.width!==s.data.width||y.data.height!==s.data.height))throw new Error(`size mismatch between old image (${y.data.width}x${y.data.height}) and new image (${s.data.width}x${s.data.height}).`);s.version=y.version+1,this.images[n]=s,this.updatedImages[n]=!0}removeImage(n){const s=this.images[n];delete this.images[n],delete this.patterns[n],s.userImage&&s.userImage.onRemove&&s.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(n){return new Promise((s,m)=>{let y=!0;if(!this.isLoaded())for(const b of n)this.images[b]||(y=!1);this.isLoaded()||y?s(this._getImagesForIds(n)):this.requestors.push({ids:n,promiseResolve:s})})}_getImagesForIds(n){const s={};for(const m of n){let y=this.getImage(m);y||(this.fire(new u.k("styleimagemissing",{id:m})),y=this.getImage(m)),y?s[m]={data:y.data.clone(),pixelRatio:y.pixelRatio,sdf:y.sdf,version:y.version,stretchX:y.stretchX,stretchY:y.stretchY,content:y.content,textFitWidth:y.textFitWidth,textFitHeight:y.textFitHeight,hasRenderCallback:!!(y.userImage&&y.userImage.render)}:u.w(`Image "${m}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return s}getPixelSize(){const{width:n,height:s}=this.atlasImage;return{width:n,height:s}}getPattern(n){const s=this.patterns[n],m=this.getImage(n);if(!m)return null;if(s&&s.position.version===m.version)return s.position;if(s)s.position.version=m.version;else{const y={w:m.data.width+2,h:m.data.height+2,x:0,y:0},b=new u.I(y,m);this.patterns[n]={bin:y,position:b}}return this._updatePatternAtlas(),this.patterns[n].position}bind(n){const s=n.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new te(n,this.atlasImage,s.RGBA),this.atlasTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE)}_updatePatternAtlas(){const n=[];for(const b in this.patterns)n.push(this.patterns[b].bin);const{w:s,h:m}=u.p(n),y=this.atlasImage;y.resize({width:s||1,height:m||1});for(const b in this.patterns){const{bin:I}=this.patterns[b],M=I.x+1,z=I.y+1,B=this.getImage(b).data,q=B.width,W=B.height;u.R.copy(B,y,{x:0,y:0},{x:M,y:z},{width:q,height:W}),u.R.copy(B,y,{x:0,y:W-1},{x:M,y:z-1},{width:q,height:1}),u.R.copy(B,y,{x:0,y:0},{x:M,y:z+W},{width:q,height:1}),u.R.copy(B,y,{x:q-1,y:0},{x:M-1,y:z},{width:1,height:W}),u.R.copy(B,y,{x:0,y:0},{x:M+q,y:z},{width:1,height:W})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(n){for(const s of n){if(this.callbackDispatchedThisFrame[s])continue;this.callbackDispatchedThisFrame[s]=!0;const m=this.getImage(s);m||u.w(`Image with ID: "${s}" was not found`),pe(m)&&this.updateImage(s,m)}}}const Ae=1e20;function $e(w,n,s,m,y,b,I,M,z){for(let B=n;B<n+m;B++)Ce(w,s*b+B,b,y,I,M,z);for(let B=s;B<s+y;B++)Ce(w,B*b+n,1,m,I,M,z)}function Ce(w,n,s,m,y,b,I){b[0]=0,I[0]=-1e20,I[1]=Ae,y[0]=w[n];for(let M=1,z=0,B=0;M<m;M++){y[M]=w[n+M*s];const q=M*M;do{const W=b[z];B=(y[M]-y[W]+q-W*W)/(M-W)/2}while(B<=I[z]&&--z>-1);z++,b[z]=M,I[z]=B,I[z+1]=Ae}for(let M=0,z=0;M<m;M++){for(;I[z+1]<M;)z++;const B=b[z],q=M-B;w[n+M*s]=y[B]+q*q}}class pn{constructor(n,s){this.requestManager=n,this.localIdeographFontFamily=s,this.entries={}}setURL(n){this.url=n}getGlyphs(n){return u._(this,void 0,void 0,function*(){const s=[];for(const b in n)for(const I of n[b])s.push(this._getAndCacheGlyphsPromise(b,I));const m=yield Promise.all(s),y={};for(const{stack:b,id:I,glyph:M}of m)y[b]||(y[b]={}),y[b][I]=M&&{id:M.id,bitmap:M.bitmap.clone(),metrics:M.metrics};return y})}_getAndCacheGlyphsPromise(n,s){return u._(this,void 0,void 0,function*(){let m=this.entries[n];m||(m=this.entries[n]={glyphs:{},requests:{},ranges:{}});let y=m.glyphs[s];if(y!==void 0)return{stack:n,id:s,glyph:y};if(y=this._tinySDF(m,n,s),y)return m.glyphs[s]=y,{stack:n,id:s,glyph:y};const b=Math.floor(s/256);if(256*b>65535)throw new Error("glyphs > 65535 not supported");if(m.ranges[b])return{stack:n,id:s,glyph:y};if(!this.url)throw new Error("glyphsUrl is not set");if(!m.requests[b]){const M=pn.loadGlyphRange(n,b,this.url,this.requestManager);m.requests[b]=M}const I=yield m.requests[b];for(const M in I)this._doesCharSupportLocalGlyph(+M)||(m.glyphs[+M]=I[+M]);return m.ranges[b]=!0,{stack:n,id:s,glyph:I[s]||null}})}_doesCharSupportLocalGlyph(n){return!!this.localIdeographFontFamily&&new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(n))}_tinySDF(n,s,m){const y=this.localIdeographFontFamily;if(!y||!this._doesCharSupportLocalGlyph(m))return;let b=n.tinySDF;if(!b){let M="400";/bold/i.test(s)?M="900":/medium/i.test(s)?M="500":/light/i.test(s)&&(M="200"),b=n.tinySDF=new pn.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:y,fontWeight:M})}const I=b.draw(String.fromCharCode(m));return{id:m,bitmap:new u.o({width:I.width||60,height:I.height||60},I.data),metrics:{width:I.glyphWidth/2||24,height:I.glyphHeight/2||24,left:I.glyphLeft/2+.5||0,top:I.glyphTop/2-27.5||-8,advance:I.glyphAdvance/2||24,isDoubleResolution:!0}}}}pn.loadGlyphRange=function(w,n,s,m){return u._(this,void 0,void 0,function*(){const y=256*n,b=y+255,I=m.transformRequest(s.replace("{fontstack}",w).replace("{range}",`${y}-${b}`),"Glyphs"),M=yield u.l(I,new AbortController);if(!M||!M.data)throw new Error(`Could not load glyph range. range: ${n}, ${y}-${b}`);const z={};for(const B of u.n(M.data))z[B.id]=B;return z})},pn.TinySDF=class{constructor({fontSize:w=24,buffer:n=3,radius:s=8,cutoff:m=.25,fontFamily:y="sans-serif",fontWeight:b="normal",fontStyle:I="normal"}={}){this.buffer=n,this.cutoff=m,this.radius=s;const M=this.size=w+4*n,z=this._createCanvas(M),B=this.ctx=z.getContext("2d",{willReadFrequently:!0});B.font=`${I} ${b} ${w}px ${y}`,B.textBaseline="alphabetic",B.textAlign="left",B.fillStyle="black",this.gridOuter=new Float64Array(M*M),this.gridInner=new Float64Array(M*M),this.f=new Float64Array(M),this.z=new Float64Array(M+1),this.v=new Uint16Array(M)}_createCanvas(w){const n=document.createElement("canvas");return n.width=n.height=w,n}draw(w){const{width:n,actualBoundingBoxAscent:s,actualBoundingBoxDescent:m,actualBoundingBoxLeft:y,actualBoundingBoxRight:b}=this.ctx.measureText(w),I=Math.ceil(s),M=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(b-y))),z=Math.min(this.size-this.buffer,I+Math.ceil(m)),B=M+2*this.buffer,q=z+2*this.buffer,W=Math.max(B*q,0),K=new Uint8ClampedArray(W),oe={data:K,width:B,height:q,glyphWidth:M,glyphHeight:z,glyphTop:I,glyphLeft:0,glyphAdvance:n};if(M===0||z===0)return oe;const{ctx:le,buffer:we,gridInner:ge,gridOuter:Te}=this;le.clearRect(we,we,M,z),le.fillText(w,we,we+I);const Ie=le.getImageData(we,we,M,z);Te.fill(Ae,0,W),ge.fill(0,0,W);for(let Re=0;Re<z;Re++)for(let ze=0;ze<M;ze++){const Fe=Ie.data[4*(Re*M+ze)+3]/255;if(Fe===0)continue;const Ve=(Re+we)*B+ze+we;if(Fe===1)Te[Ve]=0,ge[Ve]=Ae;else{const Ne=.5-Fe;Te[Ve]=Ne>0?Ne*Ne:0,ge[Ve]=Ne<0?Ne*Ne:0}}$e(Te,0,0,B,q,B,this.f,this.v,this.z),$e(ge,we,we,M,z,B,this.f,this.v,this.z);for(let Re=0;Re<W;Re++){const ze=Math.sqrt(Te[Re])-Math.sqrt(ge[Re]);K[Re]=Math.round(255-255*(ze/this.radius+this.cutoff))}return oe}};class ri{constructor(){this.specification=u.v.light.position}possiblyEvaluate(n,s){return u.x(n.expression.evaluate(s))}interpolate(n,s,m){return{x:u.y.number(n.x,s.x,m),y:u.y.number(n.y,s.y,m),z:u.y.number(n.z,s.z,m)}}}let dn;class jn extends u.E{constructor(n){super(),dn=dn||new u.q({anchor:new u.D(u.v.light.anchor),position:new ri,color:new u.D(u.v.light.color),intensity:new u.D(u.v.light.intensity)}),this._transitionable=new u.T(dn),this.setLight(n),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(n,s={}){if(!this._validate(u.r,n,s))for(const m in n){const y=n[m];m.endsWith("-transition")?this._transitionable.setTransition(m.slice(0,-11),y):this._transitionable.setValue(m,y)}}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,s,m){return(!m||m.validate!==!1)&&u.t(this,n.call(u.u,{value:s,style:{glyphs:!0,sprite:!0},styleSpec:u.v}))}}const Tt=new u.q({"sky-color":new u.D(u.v.sky["sky-color"]),"horizon-color":new u.D(u.v.sky["horizon-color"]),"fog-color":new u.D(u.v.sky["fog-color"]),"fog-ground-blend":new u.D(u.v.sky["fog-ground-blend"]),"horizon-fog-blend":new u.D(u.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new u.D(u.v.sky["sky-horizon-blend"]),"atmosphere-blend":new u.D(u.v.sky["atmosphere-blend"])});class gn extends u.E{constructor(n){super(),this._transitionable=new u.T(Tt),this.setSky(n),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new u.z(0))}setSky(n,s={}){if(!this._validate(u.B,n,s)){n||(n={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const m in n){const y=n[m];m.endsWith("-transition")?this._transitionable.setTransition(m.slice(0,-11),y):this._transitionable.setValue(m,y)}}}getSky(){return this._transitionable.serialize()}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,s,m={}){return m?.validate!==!1&&u.t(this,n.call(u.u,u.e({value:s,style:{glyphs:!0,sprite:!0},styleSpec:u.v})))}calculateFogBlendOpacity(n){return n<60?0:n<70?(n-60)/10:1}}class St{constructor(n,s){this.width=n,this.height=s,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(n,s){const m=n.join(",")+String(s);return this.dashEntry[m]||(this.dashEntry[m]=this.addDash(n,s)),this.dashEntry[m]}getDashRanges(n,s,m){const y=[];let b=n.length%2==1?-n[n.length-1]*m:0,I=n[0]*m,M=!0;y.push({left:b,right:I,isDash:M,zeroLength:n[0]===0});let z=n[0];for(let B=1;B<n.length;B++){M=!M;const q=n[B];b=z*m,z+=q,I=z*m,y.push({left:b,right:I,isDash:M,zeroLength:q===0})}return y}addRoundDash(n,s,m){const y=s/2;for(let b=-m;b<=m;b++){const I=this.width*(this.nextRow+m+b);let M=0,z=n[M];for(let B=0;B<this.width;B++){B/z.right>1&&(z=n[++M]);const q=Math.abs(B-z.left),W=Math.abs(B-z.right),K=Math.min(q,W);let oe;const le=b/m*(y+1);if(z.isDash){const we=y-Math.abs(le);oe=Math.sqrt(K*K+we*we)}else oe=y-Math.sqrt(K*K+le*le);this.data[I+B]=Math.max(0,Math.min(255,oe+128))}}}addRegularDash(n){for(let M=n.length-1;M>=0;--M){const z=n[M],B=n[M+1];z.zeroLength?n.splice(M,1):B&&B.isDash===z.isDash&&(B.left=z.left,n.splice(M,1))}const s=n[0],m=n[n.length-1];s.isDash===m.isDash&&(s.left=m.left-this.width,m.right=s.right+this.width);const y=this.width*this.nextRow;let b=0,I=n[b];for(let M=0;M<this.width;M++){M/I.right>1&&(I=n[++b]);const z=Math.abs(M-I.left),B=Math.abs(M-I.right),q=Math.min(z,B);this.data[y+M]=Math.max(0,Math.min(255,(I.isDash?q:-q)+128))}}addDash(n,s){const m=s?7:0,y=2*m+1;if(this.nextRow+y>this.height)return u.w("LineAtlas out of space"),null;let b=0;for(let M=0;M<n.length;M++)b+=n[M];if(b!==0){const M=this.width/b,z=this.getDashRanges(n,this.width,M);s?this.addRoundDash(z,M,m):this.addRegularDash(z)}const I={y:(this.nextRow+m+.5)/this.height,height:2*m/this.height,width:b};return this.nextRow+=y,this.dirty=!0,I}bind(n){const s=n.gl;this.texture?(s.bindTexture(s.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,s.texSubImage2D(s.TEXTURE_2D,0,0,0,this.width,this.height,s.ALPHA,s.UNSIGNED_BYTE,this.data))):(this.texture=s.createTexture(),s.bindTexture(s.TEXTURE_2D,this.texture),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texImage2D(s.TEXTURE_2D,0,s.ALPHA,this.width,this.height,0,s.ALPHA,s.UNSIGNED_BYTE,this.data))}}const Ze="maplibre_preloaded_worker_pool";class wt{constructor(){this.active={}}acquire(n){if(!this.workers)for(this.workers=[];this.workers.length<wt.workerCount;)this.workers.push(new Worker(u.a.WORKER_URL));return this.active[n]=!0,this.workers.slice()}release(n){delete this.active[n],this.numActive()===0&&(this.workers.forEach(s=>{s.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Ze]}numActive(){return Object.keys(this.active).length}}const Qt=Math.floor(re.hardwareConcurrency/2);let sn,Xt;function nn(){return sn||(sn=new wt),sn}wt.workerCount=u.C(globalThis)?Math.max(Math.min(Qt,3),1):1;class Fn{constructor(n,s){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=s;const m=this.workerPool.acquire(s);for(let y=0;y<m.length;y++){const b=new u.F(m[y],s);b.name=`Worker ${y}`,this.actors.push(b)}if(!this.actors.length)throw new Error("No actors found")}broadcast(n,s){const m=[];for(const y of this.actors)m.push(y.sendAsync({type:n,data:s}));return Promise.all(m)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(n=!0){this.actors.forEach(s=>{s.remove()}),this.actors=[],n&&this.workerPool.release(this.id)}registerMessageHandler(n,s){for(const m of this.actors)m.registerMessageHandler(n,s)}}function $n(){return Xt||(Xt=new Fn(nn(),u.G),Xt.registerMessageHandler("GR",(w,n,s)=>u.m(n,s))),Xt}function Jn(w,n){const s=u.H();return u.J(s,s,[1,1,0]),u.K(s,s,[.5*w.width,.5*w.height,1]),w.calculatePosMatrix?u.L(s,s,w.calculatePosMatrix(n.toUnwrapped())):s}function ur(w,n,s,m,y,b){var I;const M=function(W,K,oe){if(W)for(const le of W){const we=K[le];if(we&&we.source===oe&&we.type==="fill-extrusion")return!0}else for(const le in K){const we=K[le];if(we.source===oe&&we.type==="fill-extrusion")return!0}return!1}((I=y?.layers)!==null&&I!==void 0?I:null,n,w.id),z=b.maxPitchScaleFactor(),B=w.tilesIn(m,z,M);B.sort(Ji);const q=[];for(const W of B)q.push({wrappedTileID:W.tileID.wrapped().key,queryResults:W.tile.queryRenderedFeatures(n,s,w._state,W.queryGeometry,W.cameraQueryGeometry,W.scale,y,b,z,Jn(w.transform,W.tileID))});return function(W,K){for(const oe in W)for(const le of W[oe])Ui(le,K);return W}(function(W){const K={},oe={};for(const le of W){const we=le.queryResults,ge=le.wrappedTileID,Te=oe[ge]=oe[ge]||{};for(const Ie in we){const Re=we[Ie],ze=Te[Ie]=Te[Ie]||{},Fe=K[Ie]=K[Ie]||[];for(const Ve of Re)ze[Ve.featureIndex]||(ze[Ve.featureIndex]=!0,Fe.push(Ve))}}return K}(q),w)}function Ji(w,n){const s=w.tileID,m=n.tileID;return s.overscaledZ-m.overscaledZ||s.canonical.y-m.canonical.y||s.wrap-m.wrap||s.canonical.x-m.canonical.x}function Ui(w,n){const s=w.feature,m=n.getFeatureState(s.layer["source-layer"],s.id);s.source=s.layer.source,s.layer["source-layer"]&&(s.sourceLayer=s.layer["source-layer"]),s.state=m}function Hr(w,n,s){return u._(this,void 0,void 0,function*(){let m=w;if(w.url?m=(yield u.h(n.transformRequest(w.url,"Source"),s)).data:yield re.frameAsync(s),!m)return null;const y=u.M(u.e(m,w),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in m&&m.vector_layers&&(y.vectorLayerIds=m.vector_layers.map(b=>b.id)),y})}class Wi{constructor(n,s){n&&(s?this.setSouthWest(n).setNorthEast(s):Array.isArray(n)&&(n.length===4?this.setSouthWest([n[0],n[1]]).setNorthEast([n[2],n[3]]):this.setSouthWest(n[0]).setNorthEast(n[1])))}setNorthEast(n){return this._ne=n instanceof u.N?new u.N(n.lng,n.lat):u.N.convert(n),this}setSouthWest(n){return this._sw=n instanceof u.N?new u.N(n.lng,n.lat):u.N.convert(n),this}extend(n){const s=this._sw,m=this._ne;let y,b;if(n instanceof u.N)y=n,b=n;else{if(!(n instanceof Wi))return Array.isArray(n)?n.length===4||n.every(Array.isArray)?this.extend(Wi.convert(n)):this.extend(u.N.convert(n)):n&&("lng"in n||"lon"in n)&&"lat"in n?this.extend(u.N.convert(n)):this;if(y=n._sw,b=n._ne,!y||!b)return this}return s||m?(s.lng=Math.min(y.lng,s.lng),s.lat=Math.min(y.lat,s.lat),m.lng=Math.max(b.lng,m.lng),m.lat=Math.max(b.lat,m.lat)):(this._sw=new u.N(y.lng,y.lat),this._ne=new u.N(b.lng,b.lat)),this}getCenter(){return new u.N((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new u.N(this.getWest(),this.getNorth())}getSouthEast(){return new u.N(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(n){const{lng:s,lat:m}=u.N.convert(n);let y=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(y=this._sw.lng>=s&&s>=this._ne.lng),this._sw.lat<=m&&m<=this._ne.lat&&y}static convert(n){return n instanceof Wi?n:n&&new Wi(n)}static fromLngLat(n,s=0){const m=360*s/40075017,y=m/Math.cos(Math.PI/180*n.lat);return new Wi(new u.N(n.lng-y,n.lat-m),new u.N(n.lng+y,n.lat+m))}adjustAntiMeridian(){const n=new u.N(this._sw.lng,this._sw.lat),s=new u.N(this._ne.lng,this._ne.lat);return new Wi(n,n.lng>s.lng?new u.N(s.lng+360,s.lat):s)}}class Qo{constructor(n,s,m){this.bounds=Wi.convert(this.validateBounds(n)),this.minzoom=s||0,this.maxzoom=m||24}validateBounds(n){return Array.isArray(n)&&n.length===4?[Math.max(-180,n[0]),Math.max(-90,n[1]),Math.min(180,n[2]),Math.min(90,n[3])]:[-180,-90,180,90]}contains(n){const s=Math.pow(2,n.z),m=Math.floor(u.O(this.bounds.getWest())*s),y=Math.floor(u.Q(this.bounds.getNorth())*s),b=Math.ceil(u.O(this.bounds.getEast())*s),I=Math.ceil(u.Q(this.bounds.getSouth())*s);return n.x>=m&&n.x<b&&n.y>=y&&n.y<I}}class bs extends u.E{constructor(n,s,m,y){if(super(),this.id=n,this.dispatcher=m,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,u.e(this,u.M(s,["url","scheme","tileSize","promoteId"])),this._options=u.e({type:"vector"},s),this._collectResourceTiming=s.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(y)}load(){return u._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new u.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const n=yield Hr(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),n&&(u.e(this,n),n.bounds&&(this.tileBounds=new Qo(n.bounds,this.minzoom,this.maxzoom)),this.fire(new u.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new u.k("data",{dataType:"source",sourceDataType:"content"})))}catch(n){this._tileJSONRequest=null,this.fire(new u.j(n))}})}loaded(){return this._loaded}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}onAdd(n){this.map=n,this.load()}setSourceProperty(n){this._tileJSONRequest&&this._tileJSONRequest.abort(),n(),this.load()}setTiles(n){return this.setSourceProperty(()=>{this._options.tiles=n}),this}setUrl(n){return this.setSourceProperty(()=>{this.url=n,this._options.url=n}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return u.e({},this._options)}loadTile(n){return u._(this,void 0,void 0,function*(){const s=n.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),m={request:this.map._requestManager.transformRequest(s,"Tile"),uid:n.uid,tileID:n.tileID,zoom:n.tileID.overscaledZ,tileSize:this.tileSize*n.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};m.request.collectResourceTiming=this._collectResourceTiming;let y="RT";if(n.actor&&n.state!=="expired"){if(n.state==="loading")return new Promise((b,I)=>{n.reloadPromise={resolve:b,reject:I}})}else n.actor=this.dispatcher.getActor(),y="LT";n.abortController=new AbortController;try{const b=yield n.actor.sendAsync({type:y,data:m},n.abortController);if(delete n.abortController,n.aborted)return;this._afterTileLoadWorkerResponse(n,b)}catch(b){if(delete n.abortController,n.aborted)return;if(b&&b.status!==404)throw b;this._afterTileLoadWorkerResponse(n,null)}})}_afterTileLoadWorkerResponse(n,s){if(s&&s.resourceTiming&&(n.resourceTiming=s.resourceTiming),s&&this.map._refreshExpiredTiles&&n.setExpiryData(s),n.loadVectorData(s,this.map.painter),n.reloadPromise){const m=n.reloadPromise;n.reloadPromise=null,this.loadTile(n).then(m.resolve).catch(m.reject)}}abortTile(n){return u._(this,void 0,void 0,function*(){n.abortController&&(n.abortController.abort(),delete n.abortController),n.actor&&(yield n.actor.sendAsync({type:"AT",data:{uid:n.uid,type:this.type,source:this.id}}))})}unloadTile(n){return u._(this,void 0,void 0,function*(){n.unloadVectorData(),n.actor&&(yield n.actor.sendAsync({type:"RMT",data:{uid:n.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class Qr extends u.E{constructor(n,s,m,y){super(),this.id=n,this.dispatcher=m,this.setEventedParent(y),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=u.e({type:"raster"},s),u.e(this,u.M(s,["url","scheme","tileSize"]))}load(){return u._(this,arguments,void 0,function*(n=!1){this._loaded=!1,this.fire(new u.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const s=yield Hr(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,s&&(u.e(this,s),s.bounds&&(this.tileBounds=new Qo(s.bounds,this.minzoom,this.maxzoom)),this.fire(new u.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new u.k("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:n})))}catch(s){this._tileJSONRequest=null,this.fire(new u.j(s))}})}loaded(){return this._loaded}onAdd(n){this.map=n,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(n){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),n(),this.load(!0)}setTiles(n){return this.setSourceProperty(()=>{this._options.tiles=n}),this}setUrl(n){return this.setSourceProperty(()=>{this.url=n,this._options.url=n}),this}serialize(){return u.e({},this._options)}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}loadTile(n){return u._(this,void 0,void 0,function*(){const s=n.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);n.abortController=new AbortController;try{const m=yield Ye.getImage(this.map._requestManager.transformRequest(s,"Tile"),n.abortController,this.map._refreshExpiredTiles);if(delete n.abortController,n.aborted)return void(n.state="unloaded");if(m&&m.data){this.map._refreshExpiredTiles&&m.cacheControl&&m.expires&&n.setExpiryData({cacheControl:m.cacheControl,expires:m.expires});const y=this.map.painter.context,b=y.gl,I=m.data;n.texture=this.map.painter.getTileTexture(I.width),n.texture?n.texture.update(I,{useMipmap:!0}):(n.texture=new te(y,I,b.RGBA,{useMipmap:!0}),n.texture.bind(b.LINEAR,b.CLAMP_TO_EDGE,b.LINEAR_MIPMAP_NEAREST)),n.state="loaded"}}catch(m){if(delete n.abortController,n.aborted)n.state="unloaded";else if(m)throw n.state="errored",m}})}abortTile(n){return u._(this,void 0,void 0,function*(){n.abortController&&(n.abortController.abort(),delete n.abortController)})}unloadTile(n){return u._(this,void 0,void 0,function*(){n.texture&&this.map.painter.saveTileTexture(n.texture)})}hasTransition(){return!1}}class Oo extends Qr{constructor(n,s,m,y){super(n,s,m,y),this.type="raster-dem",this.maxzoom=22,this._options=u.e({type:"raster-dem"},s),this.encoding=s.encoding||"mapbox",this.redFactor=s.redFactor,this.greenFactor=s.greenFactor,this.blueFactor=s.blueFactor,this.baseShift=s.baseShift}loadTile(n){return u._(this,void 0,void 0,function*(){const s=n.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),m=this.map._requestManager.transformRequest(s,"Tile");n.neighboringTiles=this._getNeighboringTiles(n.tileID),n.abortController=new AbortController;try{const y=yield Ye.getImage(m,n.abortController,this.map._refreshExpiredTiles);if(delete n.abortController,n.aborted)return void(n.state="unloaded");if(y&&y.data){const b=y.data;this.map._refreshExpiredTiles&&y.cacheControl&&y.expires&&n.setExpiryData({cacheControl:y.cacheControl,expires:y.expires});const I=u.b(b)&&u.U()?b:yield this.readImageNow(b),M={type:this.type,uid:n.uid,source:this.id,rawImageData:I,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!n.actor||n.state==="expired"){n.actor=this.dispatcher.getActor();const z=yield n.actor.sendAsync({type:"LDT",data:M});n.dem=z,n.needsHillshadePrepare=!0,n.needsTerrainPrepare=!0,n.state="loaded"}}}catch(y){if(delete n.abortController,n.aborted)n.state="unloaded";else if(y)throw n.state="errored",y}})}readImageNow(n){return u._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&u.V()){const s=n.width+2,m=n.height+2;try{return new u.R({width:s,height:m},yield u.W(n,-1,-1,s,m))}catch{}}return re.getImageData(n,1)})}_getNeighboringTiles(n){const s=n.canonical,m=Math.pow(2,s.z),y=(s.x-1+m)%m,b=s.x===0?n.wrap-1:n.wrap,I=(s.x+1+m)%m,M=s.x+1===m?n.wrap+1:n.wrap,z={};return z[new u.S(n.overscaledZ,b,s.z,y,s.y).key]={backfilled:!1},z[new u.S(n.overscaledZ,M,s.z,I,s.y).key]={backfilled:!1},s.y>0&&(z[new u.S(n.overscaledZ,b,s.z,y,s.y-1).key]={backfilled:!1},z[new u.S(n.overscaledZ,n.wrap,s.z,s.x,s.y-1).key]={backfilled:!1},z[new u.S(n.overscaledZ,M,s.z,I,s.y-1).key]={backfilled:!1}),s.y+1<m&&(z[new u.S(n.overscaledZ,b,s.z,y,s.y+1).key]={backfilled:!1},z[new u.S(n.overscaledZ,n.wrap,s.z,s.x,s.y+1).key]={backfilled:!1},z[new u.S(n.overscaledZ,M,s.z,I,s.y+1).key]={backfilled:!1}),z}unloadTile(n){return u._(this,void 0,void 0,function*(){n.demTexture&&this.map.painter.saveTileTexture(n.demTexture),n.fbo&&(n.fbo.destroy(),delete n.fbo),n.dem&&delete n.dem,delete n.neighboringTiles,n.state="unloaded",n.actor&&(yield n.actor.sendAsync({type:"RDT",data:{type:this.type,uid:n.uid,source:this.id}}))})}}class Jo extends u.E{constructor(n,s,m,y){super(),this.id=n,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=m.getActor(),this.setEventedParent(y),this._data=s.data,this._options=u.e({},s),this._collectResourceTiming=s.collectResourceTiming,s.maxzoom!==void 0&&(this.maxzoom=s.maxzoom),s.type&&(this.type=s.type),s.attribution&&(this.attribution=s.attribution),this.promoteId=s.promoteId,s.clusterMaxZoom!==void 0&&this.maxzoom<=s.clusterMaxZoom&&u.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${s.clusterMaxZoom}".`),this.workerOptions=u.e({source:this.id,cluster:s.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(s.buffer!==void 0?s.buffer:128),tolerance:this._pixelsToTileUnits(s.tolerance!==void 0?s.tolerance:.375),extent:u.X,maxZoom:this.maxzoom,lineMetrics:s.lineMetrics||!1,generateId:s.generateId||!1},superclusterOptions:{maxZoom:s.clusterMaxZoom!==void 0?s.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,s.clusterMinPoints||2),extent:u.X,radius:this._pixelsToTileUnits(s.clusterRadius||50),log:!1,generateId:s.generateId||!1},clusterProperties:s.clusterProperties,filter:s.filter},s.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_pixelsToTileUnits(n){return n*(u.X/this.tileSize)}load(){return u._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(n){this.map=n,this.load()}setData(n){return this._data=n,this._updateWorkerData(),this}updateData(n){return this._updateWorkerData(n),this}getData(){return u._(this,void 0,void 0,function*(){const n=u.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:n})})}setClusterOptions(n){return this.workerOptions.cluster=n.cluster,n&&(n.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(n.clusterRadius)),n.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=n.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(n){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:n,source:this.id}})}getClusterChildren(n){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:n,source:this.id}})}getClusterLeaves(n,s,m){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:n,limit:s,offset:m}})}_updateWorkerData(n){return u._(this,void 0,void 0,function*(){const s=u.e({type:this.type},this.workerOptions);n?s.dataDiff=n:typeof this._data=="string"?(s.request=this.map._requestManager.transformRequest(re.resolveURL(this._data),"Source"),s.request.collectResourceTiming=this._collectResourceTiming):s.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new u.k("dataloading",{dataType:"source"}));try{const m=yield this.actor.sendAsync({type:"LD",data:s});if(this._pendingLoads--,this._removed||m.abandoned)return void this.fire(new u.k("dataabort",{dataType:"source"}));let y=null;m.resourceTiming&&m.resourceTiming[this.id]&&(y=m.resourceTiming[this.id].slice(0));const b={dataType:"source"};this._collectResourceTiming&&y&&y.length>0&&u.e(b,{resourceTiming:y}),this.fire(new u.k("data",Object.assign(Object.assign({},b),{sourceDataType:"metadata"}))),this.fire(new u.k("data",Object.assign(Object.assign({},b),{sourceDataType:"content"})))}catch(m){if(this._pendingLoads--,this._removed)return void this.fire(new u.k("dataabort",{dataType:"source"}));this.fire(new u.j(m))}})}loaded(){return this._pendingLoads===0}loadTile(n){return u._(this,void 0,void 0,function*(){const s=n.actor?"RT":"LT";n.actor=this.actor;const m={type:this.type,uid:n.uid,tileID:n.tileID,zoom:n.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};n.abortController=new AbortController;const y=yield this.actor.sendAsync({type:s,data:m},n.abortController);delete n.abortController,n.unloadVectorData(),n.aborted||n.loadVectorData(y,this.map.painter,s==="RT")})}abortTile(n){return u._(this,void 0,void 0,function*(){n.abortController&&(n.abortController.abort(),delete n.abortController),n.aborted=!0})}unloadTile(n){return u._(this,void 0,void 0,function*(){n.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:n.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return u.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}class vr extends u.E{constructor(n,s,m,y){super(),this.flippedWindingOrder=!1,this.id=n,this.dispatcher=m,this.coordinates=s.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(y),this.options=s}load(n){return u._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new u.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const s=yield Ye.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,s&&s.data&&(this.image=s.data,n&&(this.coordinates=n),this._finishLoading())}catch(s){this._request=null,this._loaded=!0,this.fire(new u.j(s))}})}loaded(){return this._loaded}updateImage(n){return n.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=n.url,this.load(n.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new u.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(n){this.map=n,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(n){this.coordinates=n;const s=n.map(u.Y.fromLngLat);var m;return this.tileID=function(y){let b=1/0,I=1/0,M=-1/0,z=-1/0;for(const K of y)b=Math.min(b,K.x),I=Math.min(I,K.y),M=Math.max(M,K.x),z=Math.max(z,K.y);const B=Math.max(M-b,z-I),q=Math.max(0,Math.floor(-Math.log(B)/Math.LN2)),W=Math.pow(2,q);return new u.Z(q,Math.floor((b+M)/2*W),Math.floor((I+z)/2*W))}(s),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=s.map(y=>this.tileID.getTilePoint(y)._round()),this.flippedWindingOrder=((m=this.tileCoords)[1].x-m[0].x)*(m[2].y-m[0].y)-(m[1].y-m[0].y)*(m[2].x-m[0].x)<0,this.fire(new u.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const n=this.map.painter.context,s=n.gl;this.texture||(this.texture=new te(n,this.image,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE));let m=!1;for(const y in this.tiles){const b=this.tiles[y];b.state!=="loaded"&&(b.state="loaded",b.texture=this.texture,m=!0)}m&&this.fire(new u.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(n){return u._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(n.tileID.canonical)?(this.tiles[String(n.tileID.wrap)]=n,n.buckets={}):n.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Jr extends vr{constructor(n,s,m,y){super(n,s,m,y),this.roundZoom=!0,this.type="video",this.options=s}load(){return u._(this,void 0,void 0,function*(){this._loaded=!1;const n=this.options;this.urls=[];for(const s of n.urls)this.urls.push(this.map._requestManager.transformRequest(s,"Source").url);try{const s=yield u.a0(this.urls);if(this._loaded=!0,!s)return;this.video=s,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(s){this.fire(new u.j(s))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(n){if(this.video){const s=this.video.seekable;n<s.start(0)||n>s.end(0)?this.fire(new u.j(new u.$(`sources.${this.id}`,null,`Playback for this video can be set only between the ${s.start(0)} and ${s.end(0)}-second mark.`))):this.video.currentTime=n}}getVideo(){return this.video}onAdd(n){this.map||(this.map=n,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const n=this.map.painter.context,s=n.gl;this.texture?this.video.paused||(this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),s.texSubImage2D(s.TEXTURE_2D,0,0,0,s.RGBA,s.UNSIGNED_BYTE,this.video)):(this.texture=new te(n,this.video,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE));let m=!1;for(const y in this.tiles){const b=this.tiles[y];b.state!=="loaded"&&(b.state="loaded",b.texture=this.texture,m=!0)}m&&this.fire(new u.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Ts extends vr{constructor(n,s,m,y){super(n,s,m,y),s.coordinates?Array.isArray(s.coordinates)&&s.coordinates.length===4&&!s.coordinates.some(b=>!Array.isArray(b)||b.length!==2||b.some(I=>typeof I!="number"))||this.fire(new u.j(new u.$(`sources.${n}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new u.j(new u.$(`sources.${n}`,null,'missing required property "coordinates"'))),s.animate&&typeof s.animate!="boolean"&&this.fire(new u.j(new u.$(`sources.${n}`,null,'optional "animate" property must be a boolean value'))),s.canvas?typeof s.canvas=="string"||s.canvas instanceof HTMLCanvasElement||this.fire(new u.j(new u.$(`sources.${n}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new u.j(new u.$(`sources.${n}`,null,'missing required property "canvas"'))),this.options=s,this.animate=s.animate===void 0||s.animate}load(){return u._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new u.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(n){this.map=n,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let n=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,n=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,n=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const s=this.map.painter.context,m=s.gl;this.texture?(n||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new te(s,this.canvas,m.RGBA,{premultiply:!0});let y=!1;for(const b in this.tiles){const I=this.tiles[b];I.state!=="loaded"&&(I.state="loaded",I.texture=this.texture,y=!0)}y&&this.fire(new u.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const n of[this.canvas.width,this.canvas.height])if(isNaN(n)||n<=0)return!0;return!1}}const Fo={},_a=w=>{switch(w){case"geojson":return Jo;case"image":return vr;case"raster":return Qr;case"raster-dem":return Oo;case"vector":return bs;case"video":return Jr;case"canvas":return Ts}return Fo[w]},Hs="RTLPluginLoaded";class Mi extends u.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=$n()}_syncState(n){return this.status=n,this.dispatcher.broadcast("SRPS",{pluginStatus:n,pluginURL:this.url}).catch(s=>{throw this.status="error",s})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(n){return u._(this,arguments,void 0,function*(s,m=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=re.resolveURL(s),!this.url)throw new Error(`requested url ${s} is invalid`);if(this.status==="unavailable"){if(!m)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return u._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new u.k(Hs))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let er=null;function qr(){return er||(er=new Mi),er}class qs{constructor(n,s){this.timeAdded=0,this.fadeEndTime=0,this.tileID=n,this.uid=u.a1(),this.uses=0,this.tileSize=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(n){const s=n+this.timeAdded;s<this.fadeEndTime||(this.fadeEndTime=s)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(n){this.demTexture&&n.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(n,s,m){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",n){n.featureIndex&&(this.latestFeatureIndex=n.featureIndex,n.rawTileData?(this.latestRawTileData=n.rawTileData,this.latestFeatureIndex.rawTileData=n.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=n.collisionBoxArray,this.buckets=function(y,b){const I={};if(!b)return I;for(const M of y){const z=M.layerIds.map(B=>b.getLayer(B)).filter(Boolean);if(z.length!==0){M.layers=z,M.stateDependentLayerIds&&(M.stateDependentLayers=M.stateDependentLayerIds.map(B=>z.filter(q=>q.id===B)[0]));for(const B of z)I[B.id]=M}}return I}(n.buckets,s?.style),this.hasSymbolBuckets=!1;for(const y in this.buckets){const b=this.buckets[y];if(b instanceof u.a3){if(this.hasSymbolBuckets=!0,!m)break;b.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const y in this.buckets){const b=this.buckets[y];if(b instanceof u.a3&&b.hasRTLText){this.hasRTLText=!0,qr().lazyLoad();break}}this.queryPadding=0;for(const y in this.buckets){const b=this.buckets[y];this.queryPadding=Math.max(this.queryPadding,s.style.getLayer(y).queryRadius(b))}n.imageAtlas&&(this.imageAtlas=n.imageAtlas),n.glyphAtlasImage&&(this.glyphAtlasImage=n.glyphAtlasImage)}else this.collisionBoxArray=new u.a2}unloadVectorData(){for(const n in this.buckets)this.buckets[n].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(n){return this.buckets[n.id]}upload(n){for(const m in this.buckets){const y=this.buckets[m];y.uploadPending()&&y.upload(n)}const s=n.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new te(n,this.imageAtlas.image,s.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new te(n,this.glyphAtlasImage,s.ALPHA),this.glyphAtlasImage=null)}prepare(n){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(n,this.imageAtlasTexture)}queryRenderedFeatures(n,s,m,y,b,I,M,z,B,q){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:y,cameraQueryGeometry:b,scale:I,tileSize:this.tileSize,pixelPosMatrix:q,transform:z,params:M,queryPadding:this.queryPadding*B},n,s,m):{}}querySourceFeatures(n,s){const m=this.latestFeatureIndex;if(!m||!m.rawTileData)return;const y=m.loadVTLayers(),b=s&&s.sourceLayer?s.sourceLayer:"",I=y._geojsonTileLayer||y[b];if(!I)return;const M=u.a4(s&&s.filter),{z,x:B,y:q}=this.tileID.canonical,W={z,x:B,y:q};for(let K=0;K<I.length;K++){const oe=I.feature(K);if(M.needGeometry){const ge=u.a5(oe,!0);if(!M.filter(new u.z(this.tileID.overscaledZ),ge,this.tileID.canonical))continue}else if(!M.filter(new u.z(this.tileID.overscaledZ),oe))continue;const le=m.getId(oe,b),we=new u.a6(oe,z,B,q,le);we.tile=W,n.push(we)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(n){const s=this.expirationTime;if(n.cacheControl){const m=u.a7(n.cacheControl);m["max-age"]&&(this.expirationTime=Date.now()+1e3*m["max-age"])}else n.expires&&(this.expirationTime=new Date(n.expires).getTime());if(this.expirationTime){const m=Date.now();let y=!1;if(this.expirationTime>m)y=!1;else if(s)if(this.expirationTime<s)y=!0;else{const b=this.expirationTime-s;b?this.expirationTime=m+Math.max(b,3e4):y=!0}else y=!0;y?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(n,s){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(n).length===0)return;const m=this.latestFeatureIndex.loadVTLayers();for(const y in this.buckets){if(!s.style.hasLayer(y))continue;const b=this.buckets[y],I=b.layers[0].sourceLayer||"_geojsonTileLayer",M=m[I],z=n[I];if(!M||!z||Object.keys(z).length===0)continue;b.update(z,M,this.imageAtlas&&this.imageAtlas.patternPositions||{});const B=s&&s.style&&s.style.getLayer(y);B&&(this.queryPadding=Math.max(this.queryPadding,B.queryRadius(b)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<re.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(n){this.symbolFadeHoldUntil=re.now()+n}setDependencies(n,s){const m={};for(const y of s)m[y]=!0;this.dependencies[n]=m}hasDependency(n,s){for(const m of n){const y=this.dependencies[m];if(y){for(const b of s)if(y[b])return!0}}return!1}}class uo{constructor(n,s){this.max=n,this.onRemove=s,this.reset()}reset(){for(const n in this.data)for(const s of this.data[n])s.timeout&&clearTimeout(s.timeout),this.onRemove(s.value);return this.data={},this.order=[],this}add(n,s,m){const y=n.wrapped().key;this.data[y]===void 0&&(this.data[y]=[]);const b={value:s,timeout:void 0};if(m!==void 0&&(b.timeout=setTimeout(()=>{this.remove(n,b)},m)),this.data[y].push(b),this.order.push(y),this.order.length>this.max){const I=this._getAndRemoveByKey(this.order[0]);I&&this.onRemove(I)}return this}has(n){return n.wrapped().key in this.data}getAndRemove(n){return this.has(n)?this._getAndRemoveByKey(n.wrapped().key):null}_getAndRemoveByKey(n){const s=this.data[n].shift();return s.timeout&&clearTimeout(s.timeout),this.data[n].length===0&&delete this.data[n],this.order.splice(this.order.indexOf(n),1),s.value}getByKey(n){const s=this.data[n];return s?s[0].value:null}get(n){return this.has(n)?this.data[n.wrapped().key][0].value:null}remove(n,s){if(!this.has(n))return this;const m=n.wrapped().key,y=s===void 0?0:this.data[m].indexOf(s),b=this.data[m][y];return this.data[m].splice(y,1),b.timeout&&clearTimeout(b.timeout),this.data[m].length===0&&delete this.data[m],this.onRemove(b.value),this.order.splice(this.order.indexOf(m),1),this}setMaxSize(n){for(this.max=n;this.order.length>this.max;){const s=this._getAndRemoveByKey(this.order[0]);s&&this.onRemove(s)}return this}filter(n){const s=[];for(const m in this.data)for(const y of this.data[m])n(y.value)||s.push(y);for(const m of s)this.remove(m.value.tileID,m)}}class es{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(n,s,m){const y=String(s);if(this.stateChanges[n]=this.stateChanges[n]||{},this.stateChanges[n][y]=this.stateChanges[n][y]||{},u.e(this.stateChanges[n][y],m),this.deletedStates[n]===null){this.deletedStates[n]={};for(const b in this.state[n])b!==y&&(this.deletedStates[n][b]=null)}else if(this.deletedStates[n]&&this.deletedStates[n][y]===null){this.deletedStates[n][y]={};for(const b in this.state[n][y])m[b]||(this.deletedStates[n][y][b]=null)}else for(const b in m)this.deletedStates[n]&&this.deletedStates[n][y]&&this.deletedStates[n][y][b]===null&&delete this.deletedStates[n][y][b]}removeFeatureState(n,s,m){if(this.deletedStates[n]===null)return;const y=String(s);if(this.deletedStates[n]=this.deletedStates[n]||{},m&&s!==void 0)this.deletedStates[n][y]!==null&&(this.deletedStates[n][y]=this.deletedStates[n][y]||{},this.deletedStates[n][y][m]=null);else if(s!==void 0)if(this.stateChanges[n]&&this.stateChanges[n][y])for(m in this.deletedStates[n][y]={},this.stateChanges[n][y])this.deletedStates[n][y][m]=null;else this.deletedStates[n][y]=null;else this.deletedStates[n]=null}getState(n,s){const m=String(s),y=u.e({},(this.state[n]||{})[m],(this.stateChanges[n]||{})[m]);if(this.deletedStates[n]===null)return{};if(this.deletedStates[n]){const b=this.deletedStates[n][s];if(b===null)return{};for(const I in b)delete y[I]}return y}initializeTileState(n,s){n.setFeatureState(this.state,s)}coalesceChanges(n,s){const m={};for(const y in this.stateChanges){this.state[y]=this.state[y]||{};const b={};for(const I in this.stateChanges[y])this.state[y][I]||(this.state[y][I]={}),u.e(this.state[y][I],this.stateChanges[y][I]),b[I]=this.state[y][I];m[y]=b}for(const y in this.deletedStates){this.state[y]=this.state[y]||{};const b={};if(this.deletedStates[y]===null)for(const I in this.state[y])b[I]={},this.state[y][I]={};else for(const I in this.deletedStates[y]){if(this.deletedStates[y][I]===null)this.state[y][I]={};else for(const M of Object.keys(this.deletedStates[y][I]))delete this.state[y][I][M];b[I]=this.state[y][I]}m[y]=m[y]||{},u.e(m[y],b)}if(this.stateChanges={},this.deletedStates={},Object.keys(m).length!==0)for(const y in n)n[y].setFeatureState(m,s)}}function Ss(w,n,s){const m=n.intersectsFrustum(w);if(!s)return m;const y=n.intersectsPlane(s);return m===0||y===0?0:m===2&&y===2?2:1}function ya(w,n,s,m,y){let b=w;const I=Math.atan(n/s),M=Math.hypot(n,s);return b=w+u.a8(m/M/Math.max(.5,Math.cos(u.aa(y/2)))),b+=1*u.a8(Math.cos(I))/2,b+=u.ab(w-b,-0,0),b}function Bo(w,n){const s=(n.roundZoom?Math.round:Math.floor)(w.zoom+u.a8(w.tileSize/n.tileSize));return Math.max(0,s)}function ve(w,n){const s=w.getCameraFrustum(),m=w.getClippingPlane(),y=w.screenPointToMercatorCoordinate(w.getCameraPoint()),b=u.Y.fromLngLat(w.center,w.elevation);y.z=b.z+Math.cos(w.pitchInRadians)*w.cameraToCenterDistance/w.worldSize;const I=w.getCoveringTilesDetailsProvider(),M=I.allowVariableZoom(w,n),z=Bo(w,n),B=n.minzoom||0,q=n.maxzoom!==void 0?n.maxzoom:w.maxZoom,W=Math.min(Math.max(0,z),q),K=Math.pow(2,W),oe=[K*y.x,K*y.y,0],le=[K*b.x,K*b.y,0],we=Math.hypot(b.x-y.x,b.y-y.y),ge=Math.abs(b.z-y.z),Te=Math.hypot(we,ge),Ie=Fe=>({zoom:0,x:0,y:0,wrap:Fe,fullyVisible:!1}),Re=[],ze=[];if(w.renderWorldCopies&&I.allowWorldCopies())for(let Fe=1;Fe<=3;Fe++)Re.push(Ie(-Fe)),Re.push(Ie(Fe));for(Re.push(Ie(0));Re.length>0;){const Fe=Re.pop(),Ve=Fe.x,Ne=Fe.y;let Qe=Fe.fullyVisible;const Je={x:Ve,y:Ne,z:Fe.zoom},yt=I.getTileAABB(Je,Fe.wrap,w.elevation,n);if(!Qe){const At=Ss(s,yt,m);if(At===0)continue;Qe=At===2}const xt=I.distanceToTile2d(y.x,y.y,Je,yt);let pt=z;M&&(pt=(n.calculateTileZoom||ya)(w.zoom+u.a8(w.tileSize/n.tileSize),xt,ge,Te,w.fov)),pt=(n.roundZoom?Math.round:Math.floor)(pt),pt=Math.max(0,pt);const Ut=Math.min(pt,q);if(Fe.wrap=I.getWrap(b,Je,Fe.wrap),Fe.zoom>=Ut){if(Fe.zoom<B)continue;const At=W-Fe.zoom,Et=oe[0]-.5-(Ve<<At),Ht=oe[1]-.5-(Ne<<At),Vn=n.reparseOverscaled?Math.max(Fe.zoom,pt):Fe.zoom;ze.push({tileID:new u.S(Fe.zoom===q?Vn:Fe.zoom,Fe.wrap,Fe.zoom,Ve,Ne),distanceSq:u.a9([le[0]-.5-Ve,le[1]-.5-Ne]),tileDistanceToCamera:Math.sqrt(Et*Et+Ht*Ht)})}else for(let At=0;At<4;At++)Re.push({zoom:Fe.zoom+1,x:(Ve<<1)+At%2,y:(Ne<<1)+(At>>1),wrap:Fe.wrap,fullyVisible:Qe})}return ze.sort((Fe,Ve)=>Fe.distanceSq-Ve.distanceSq).map(Fe=>Fe.tileID)}class se extends u.E{constructor(n,s,m){super(),this.id=n,this.dispatcher=m,this.on("data",y=>this._dataHandler(y)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((y,b,I,M)=>{const z=new(_a(b.type))(y,b,I,M);if(z.id!==y)throw new Error(`Expected Source id to be ${y} instead of ${z.id}`);return z})(n,s,m,this),this._tiles={},this._cache=new uo(0,y=>this._unloadTile(y)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new es,this._didEmitContent=!1,this._updated=!1}onAdd(n){this.map=n,this._maxTileCacheSize=n?n._maxTileCacheSize:null,this._maxTileCacheZoomLevels=n?n._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(n)}onRemove(n){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(n)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const n in this._tiles){const s=this._tiles[n];if(s.state!=="loaded"&&s.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const n=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,n&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(n,s,m){return u._(this,void 0,void 0,function*(){try{yield this._source.loadTile(n),this._tileLoaded(n,s,m)}catch(y){n.state="errored",y.status!==404?this._source.fire(new u.j(y,{tile:n})):this.update(this.transform,this.terrain)}})}_unloadTile(n){this._source.unloadTile&&this._source.unloadTile(n)}_abortTile(n){this._source.abortTile&&this._source.abortTile(n),this._source.fire(new u.k("dataabort",{tile:n,coord:n.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(n){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const s in this._tiles){const m=this._tiles[s];m.upload(n),m.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(n=>n.tileID).sort(ce).map(n=>n.key)}getRenderableIds(n){const s=[];for(const m in this._tiles)this._isIdRenderable(m,n)&&s.push(this._tiles[m]);return n?s.sort((m,y)=>{const b=m.tileID,I=y.tileID,M=new u.P(b.canonical.x,b.canonical.y)._rotate(-this.transform.bearingInRadians),z=new u.P(I.canonical.x,I.canonical.y)._rotate(-this.transform.bearingInRadians);return b.overscaledZ-I.overscaledZ||z.y-M.y||z.x-M.x}).map(m=>m.tileID.key):s.map(m=>m.tileID).sort(ce).map(m=>m.key)}hasRenderableParent(n){const s=this.findLoadedParent(n,0);return!!s&&this._isIdRenderable(s.tileID.key)}_isIdRenderable(n,s){return this._tiles[n]&&this._tiles[n].hasData()&&!this._coveredTiles[n]&&(s||!this._tiles[n].holdingForFade())}reload(n){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const s in this._tiles)(n||this._tiles[s].state!=="errored")&&this._reloadTile(s,"reloading")}}_reloadTile(n,s){return u._(this,void 0,void 0,function*(){const m=this._tiles[n];m&&(m.state!=="loading"&&(m.state=s),yield this._loadTile(m,n,s))})}_tileLoaded(n,s,m){n.timeAdded=re.now(),m==="expired"&&(n.refreshedUponExpiration=!0),this._setTileReloadTimer(s,n),this.getSource().type==="raster-dem"&&n.dem&&this._backfillDEM(n),this._state.initializeTileState(n,this.map?this.map.painter:null),n.aborted||this._source.fire(new u.k("data",{dataType:"source",tile:n,coord:n.tileID}))}_backfillDEM(n){const s=this.getRenderableIds();for(let y=0;y<s.length;y++){const b=s[y];if(n.neighboringTiles&&n.neighboringTiles[b]){const I=this.getTileByID(b);m(n,I),m(I,n)}}function m(y,b){y.needsHillshadePrepare=!0,y.needsTerrainPrepare=!0;let I=b.tileID.canonical.x-y.tileID.canonical.x;const M=b.tileID.canonical.y-y.tileID.canonical.y,z=Math.pow(2,y.tileID.canonical.z),B=b.tileID.key;I===0&&M===0||Math.abs(M)>1||(Math.abs(I)>1&&(Math.abs(I+z)===1?I+=z:Math.abs(I-z)===1&&(I-=z)),b.dem&&y.dem&&(y.dem.backfillBorder(b.dem,I,M),y.neighboringTiles&&y.neighboringTiles[B]&&(y.neighboringTiles[B].backfilled=!0)))}}getTile(n){return this.getTileByID(n.key)}getTileByID(n){return this._tiles[n]}_retainLoadedChildren(n,s,m,y){for(const b in this._tiles){let I=this._tiles[b];if(y[b]||!I.hasData()||I.tileID.overscaledZ<=s||I.tileID.overscaledZ>m)continue;let M=I.tileID;for(;I&&I.tileID.overscaledZ>s+1;){const B=I.tileID.scaledTo(I.tileID.overscaledZ-1);I=this._tiles[B.key],I&&I.hasData()&&(M=B)}let z=M;for(;z.overscaledZ>s;)if(z=z.scaledTo(z.overscaledZ-1),n[z.key]||n[z.canonical.key]){y[M.key]=M;break}}}findLoadedParent(n,s){if(n.key in this._loadedParentTiles){const m=this._loadedParentTiles[n.key];return m&&m.tileID.overscaledZ>=s?m:null}for(let m=n.overscaledZ-1;m>=s;m--){const y=n.scaledTo(m),b=this._getLoadedTile(y);if(b)return b}}findLoadedSibling(n){return this._getLoadedTile(n)}_getLoadedTile(n){const s=this._tiles[n.key];return s&&s.hasData()?s:this._cache.getByKey(n.wrapped().key)}updateCacheSize(n){const s=Math.ceil(n.width/this._source.tileSize)+1,m=Math.ceil(n.height/this._source.tileSize)+1,y=Math.floor(s*m*(this._maxTileCacheZoomLevels===null?u.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),b=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,y):y;this._cache.setMaxSize(b)}handleWrapJump(n){const s=Math.round((n-(this._prevLng===void 0?n:this._prevLng))/360);if(this._prevLng=n,s){const m={};for(const y in this._tiles){const b=this._tiles[y];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+s),m[b.tileID.key]=b}this._tiles=m;for(const y in this._timers)clearTimeout(this._timers[y]),delete this._timers[y];for(const y in this._tiles)this._setTileReloadTimer(y,this._tiles[y])}}_updateCoveredAndRetainedTiles(n,s,m,y,b,I){const M={},z={},B=Object.keys(n),q=re.now();for(const W of B){const K=n[W],oe=this._tiles[W];if(!oe||oe.fadeEndTime!==0&&oe.fadeEndTime<=q)continue;const le=this.findLoadedParent(K,s),we=this.findLoadedSibling(K),ge=le||we||null;ge&&(this._addTile(ge.tileID),M[ge.tileID.key]=ge.tileID),z[W]=K}this._retainLoadedChildren(z,y,m,n);for(const W in M)n[W]||(this._coveredTiles[W]=!0,n[W]=M[W]);if(I){const W={},K={};for(const oe of b)this._tiles[oe.key].hasData()?W[oe.key]=oe:K[oe.key]=oe;for(const oe in K){const le=K[oe].children(this._source.maxzoom);this._tiles[le[0].key]&&this._tiles[le[1].key]&&this._tiles[le[2].key]&&this._tiles[le[3].key]&&(W[le[0].key]=n[le[0].key]=le[0],W[le[1].key]=n[le[1].key]=le[1],W[le[2].key]=n[le[2].key]=le[2],W[le[3].key]=n[le[3].key]=le[3],delete K[oe])}for(const oe in K){const le=K[oe],we=this.findLoadedParent(le,this._source.minzoom),ge=this.findLoadedSibling(le),Te=we||ge||null;if(Te){W[Te.tileID.key]=n[Te.tileID.key]=Te.tileID;for(const Ie in W)W[Ie].isChildOf(Te.tileID)&&delete W[Ie]}}for(const oe in this._tiles)W[oe]||(this._coveredTiles[oe]=!0)}}update(n,s){if(!this._sourceLoaded||this._paused)return;let m;this.transform=n,this.terrain=s,this.updateCacheSize(n),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?m=n.getVisibleUnwrappedCoordinates(this._source.tileID).map(q=>new u.S(q.canonical.z,q.wrap,q.canonical.z,q.canonical.x,q.canonical.y)):(m=ve(n,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:s,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(m=m.filter(q=>this._source.hasTile(q)))):m=[];const y=Bo(n,this._source),b=Math.max(y-se.maxOverzooming,this._source.minzoom),I=Math.max(y+se.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const q={};for(const W of m)if(W.canonical.z>this._source.minzoom){const K=W.scaledTo(W.canonical.z-1);q[K.key]=K;const oe=W.scaledTo(Math.max(this._source.minzoom,Math.min(W.canonical.z,5)));q[oe.key]=oe}m=m.concat(Object.values(q))}const M=m.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,M&&this.fire(new u.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const z=this._updateRetainedTiles(m,y);fe(this._source.type)&&this._updateCoveredAndRetainedTiles(z,b,I,y,m,s);for(const q in z)this._tiles[q].clearFadeHold();const B=u.ac(this._tiles,z);for(const q of B){const W=this._tiles[q];W.hasSymbolBuckets&&!W.holdingForFade()?W.setHoldDuration(this.map._fadeDuration):W.hasSymbolBuckets&&!W.symbolFadeFinished()||this._removeTile(q)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const n in this._tiles)this._tiles[n].holdingForFade()&&this._removeTile(n)}_updateRetainedTiles(n,s){var m;const y={},b={},I=Math.max(s-se.maxOverzooming,this._source.minzoom),M=Math.max(s+se.maxUnderzooming,this._source.minzoom),z={};for(const B of n){const q=this._addTile(B);y[B.key]=B,q.hasData()||s<this._source.maxzoom&&(z[B.key]=B)}this._retainLoadedChildren(z,s,M,y);for(const B of n){let q=this._tiles[B.key];if(q.hasData())continue;if(s+1>this._source.maxzoom){const K=B.children(this._source.maxzoom)[0],oe=this.getTile(K);if(oe&&oe.hasData()){y[K.key]=K;continue}}else{const K=B.children(this._source.maxzoom);if(y[K[0].key]&&y[K[1].key]&&y[K[2].key]&&y[K[3].key])continue}let W=q.wasRequested();for(let K=B.overscaledZ-1;K>=I;--K){const oe=B.scaledTo(K);if(b[oe.key])break;if(b[oe.key]=!0,q=this.getTile(oe),!q&&W&&(q=this._addTile(oe)),q){const le=q.hasData();if((le||!(!((m=this.map)===null||m===void 0)&&m.cancelPendingTileRequestsWhileZooming)||W)&&(y[oe.key]=oe),W=q.wasRequested(),le)break}}}return y}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const n in this._tiles){const s=[];let m,y=this._tiles[n].tileID;for(;y.overscaledZ>0;){if(y.key in this._loadedParentTiles){m=this._loadedParentTiles[y.key];break}s.push(y.key);const b=y.scaledTo(y.overscaledZ-1);if(m=this._getLoadedTile(b),m)break;y=b}for(const b of s)this._loadedParentTiles[b]=m}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const n in this._tiles){const s=this._tiles[n].tileID,m=this._getLoadedTile(s);this._loadedSiblingTiles[s.key]=m}}_addTile(n){let s=this._tiles[n.key];if(s)return s;s=this._cache.getAndRemove(n),s&&(this._setTileReloadTimer(n.key,s),s.tileID=n,this._state.initializeTileState(s,this.map?this.map.painter:null),this._cacheTimers[n.key]&&(clearTimeout(this._cacheTimers[n.key]),delete this._cacheTimers[n.key],this._setTileReloadTimer(n.key,s)));const m=s;return s||(s=new qs(n,this._source.tileSize*n.overscaleFactor()),this._loadTile(s,n.key,s.state)),s.uses++,this._tiles[n.key]=s,m||this._source.fire(new u.k("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s}_setTileReloadTimer(n,s){n in this._timers&&(clearTimeout(this._timers[n]),delete this._timers[n]);const m=s.getExpiryTimeout();m&&(this._timers[n]=setTimeout(()=>{this._reloadTile(n,"expired"),delete this._timers[n]},m))}_removeTile(n){const s=this._tiles[n];s&&(s.uses--,delete this._tiles[n],this._timers[n]&&(clearTimeout(this._timers[n]),delete this._timers[n]),s.uses>0||(s.hasData()&&s.state!=="reloading"?this._cache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))}_dataHandler(n){const s=n.sourceDataType;n.dataType==="source"&&s==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&n.dataType==="source"&&s==="content"&&(this.reload(n.sourceDataChanged),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const n in this._tiles)this._removeTile(n);this._cache.reset()}tilesIn(n,s,m){const y=[],b=this.transform;if(!b)return y;const I=m?b.getCameraQueryGeometry(n):n,M=n.map(le=>b.screenPointToMercatorCoordinate(le,this.terrain)),z=I.map(le=>b.screenPointToMercatorCoordinate(le,this.terrain)),B=this.getIds();let q=1/0,W=1/0,K=-1/0,oe=-1/0;for(const le of z)q=Math.min(q,le.x),W=Math.min(W,le.y),K=Math.max(K,le.x),oe=Math.max(oe,le.y);for(let le=0;le<B.length;le++){const we=this._tiles[B[le]];if(we.holdingForFade())continue;const ge=we.tileID,Te=Math.pow(2,b.zoom-we.tileID.overscaledZ),Ie=s*we.queryPadding*u.X/we.tileSize/Te,Re=[ge.getTilePoint(new u.Y(q,W)),ge.getTilePoint(new u.Y(K,oe))];if(Re[0].x-Ie<u.X&&Re[0].y-Ie<u.X&&Re[1].x+Ie>=0&&Re[1].y+Ie>=0){const ze=M.map(Ve=>ge.getTilePoint(Ve)),Fe=z.map(Ve=>ge.getTilePoint(Ve));y.push({tile:we,tileID:ge,queryGeometry:ze,cameraQueryGeometry:Fe,scale:Te})}}return y}getVisibleCoordinates(n){const s=this.getRenderableIds(n).map(m=>this._tiles[m].tileID);return this.transform&&this.transform.populateCache(s),s}hasTransition(){if(this._source.hasTransition())return!0;if(fe(this._source.type)){const n=re.now();for(const s in this._tiles)if(this._tiles[s].fadeEndTime>=n)return!0}return!1}setFeatureState(n,s,m){this._state.updateState(n=n||"_geojsonTileLayer",s,m)}removeFeatureState(n,s,m){this._state.removeFeatureState(n=n||"_geojsonTileLayer",s,m)}getFeatureState(n,s){return this._state.getState(n=n||"_geojsonTileLayer",s)}setDependencies(n,s,m){const y=this._tiles[n];y&&y.setDependencies(s,m)}reloadTilesForDependencies(n,s){for(const m in this._tiles)this._tiles[m].hasDependency(n,s)&&this._reloadTile(m,"reloading");this._cache.filter(m=>!m.hasDependency(n,s))}}function ce(w,n){const s=Math.abs(2*w.wrap)-+(w.wrap<0),m=Math.abs(2*n.wrap)-+(n.wrap<0);return w.overscaledZ-n.overscaledZ||m-s||n.canonical.y-w.canonical.y||n.canonical.x-w.canonical.x}function fe(w){return w==="raster"||w==="image"||w==="video"}se.maxOverzooming=10,se.maxUnderzooming=3;class Pe{constructor(n,s){this.reset(n,s)}reset(n,s){this.points=n||[],this._distances=[0];for(let m=1;m<this.points.length;m++)this._distances[m]=this._distances[m-1]+this.points[m].dist(this.points[m-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(s||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(n){if(this.points.length===1)return this.points[0];n=u.ab(n,0,1);let s=1,m=this._distances[s];const y=n*this.paddedLength+this.padding;for(;m<y&&s<this._distances.length;)m=this._distances[++s];const b=s-1,I=this._distances[b],M=m-I,z=M>0?(y-I)/M:0;return this.points[b].mult(1-z).add(this.points[s].mult(z))}}function Be(w,n){let s=!0;return w==="always"||w!=="never"&&n!=="never"||(s=!1),s}class qe{constructor(n,s,m){const y=this.boxCells=[],b=this.circleCells=[];this.xCellCount=Math.ceil(n/m),this.yCellCount=Math.ceil(s/m);for(let I=0;I<this.xCellCount*this.yCellCount;I++)y.push([]),b.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=n,this.height=s,this.xScale=this.xCellCount/n,this.yScale=this.yCellCount/s,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(n,s,m,y,b){this._forEachCell(s,m,y,b,this._insertBoxCell,this.boxUid++),this.boxKeys.push(n),this.bboxes.push(s),this.bboxes.push(m),this.bboxes.push(y),this.bboxes.push(b)}insertCircle(n,s,m,y){this._forEachCell(s-y,m-y,s+y,m+y,this._insertCircleCell,this.circleUid++),this.circleKeys.push(n),this.circles.push(s),this.circles.push(m),this.circles.push(y)}_insertBoxCell(n,s,m,y,b,I){this.boxCells[b].push(I)}_insertCircleCell(n,s,m,y,b,I){this.circleCells[b].push(I)}_query(n,s,m,y,b,I,M){if(m<0||n>this.width||y<0||s>this.height)return[];const z=[];if(n<=0&&s<=0&&this.width<=m&&this.height<=y){if(b)return[{key:null,x1:n,y1:s,x2:m,y2:y}];for(let B=0;B<this.boxKeys.length;B++)z.push({key:this.boxKeys[B],x1:this.bboxes[4*B],y1:this.bboxes[4*B+1],x2:this.bboxes[4*B+2],y2:this.bboxes[4*B+3]});for(let B=0;B<this.circleKeys.length;B++){const q=this.circles[3*B],W=this.circles[3*B+1],K=this.circles[3*B+2];z.push({key:this.circleKeys[B],x1:q-K,y1:W-K,x2:q+K,y2:W+K})}}else this._forEachCell(n,s,m,y,this._queryCell,z,{hitTest:b,overlapMode:I,seenUids:{box:{},circle:{}}},M);return z}query(n,s,m,y){return this._query(n,s,m,y,!1,null)}hitTest(n,s,m,y,b,I){return this._query(n,s,m,y,!0,b,I).length>0}hitTestCircle(n,s,m,y,b){const I=n-m,M=n+m,z=s-m,B=s+m;if(M<0||I>this.width||B<0||z>this.height)return!1;const q=[];return this._forEachCell(I,z,M,B,this._queryCellCircle,q,{hitTest:!0,overlapMode:y,circle:{x:n,y:s,radius:m},seenUids:{box:{},circle:{}}},b),q.length>0}_queryCell(n,s,m,y,b,I,M,z){const{seenUids:B,hitTest:q,overlapMode:W}=M,K=this.boxCells[b];if(K!==null){const le=this.bboxes;for(const we of K)if(!B.box[we]){B.box[we]=!0;const ge=4*we,Te=this.boxKeys[we];if(n<=le[ge+2]&&s<=le[ge+3]&&m>=le[ge+0]&&y>=le[ge+1]&&(!z||z(Te))&&(!q||!Be(W,Te.overlapMode))&&(I.push({key:Te,x1:le[ge],y1:le[ge+1],x2:le[ge+2],y2:le[ge+3]}),q))return!0}}const oe=this.circleCells[b];if(oe!==null){const le=this.circles;for(const we of oe)if(!B.circle[we]){B.circle[we]=!0;const ge=3*we,Te=this.circleKeys[we];if(this._circleAndRectCollide(le[ge],le[ge+1],le[ge+2],n,s,m,y)&&(!z||z(Te))&&(!q||!Be(W,Te.overlapMode))){const Ie=le[ge],Re=le[ge+1],ze=le[ge+2];if(I.push({key:Te,x1:Ie-ze,y1:Re-ze,x2:Ie+ze,y2:Re+ze}),q)return!0}}}return!1}_queryCellCircle(n,s,m,y,b,I,M,z){const{circle:B,seenUids:q,overlapMode:W}=M,K=this.boxCells[b];if(K!==null){const le=this.bboxes;for(const we of K)if(!q.box[we]){q.box[we]=!0;const ge=4*we,Te=this.boxKeys[we];if(this._circleAndRectCollide(B.x,B.y,B.radius,le[ge+0],le[ge+1],le[ge+2],le[ge+3])&&(!z||z(Te))&&!Be(W,Te.overlapMode))return I.push(!0),!0}}const oe=this.circleCells[b];if(oe!==null){const le=this.circles;for(const we of oe)if(!q.circle[we]){q.circle[we]=!0;const ge=3*we,Te=this.circleKeys[we];if(this._circlesCollide(le[ge],le[ge+1],le[ge+2],B.x,B.y,B.radius)&&(!z||z(Te))&&!Be(W,Te.overlapMode))return I.push(!0),!0}}}_forEachCell(n,s,m,y,b,I,M,z){const B=this._convertToXCellCoord(n),q=this._convertToYCellCoord(s),W=this._convertToXCellCoord(m),K=this._convertToYCellCoord(y);for(let oe=B;oe<=W;oe++)for(let le=q;le<=K;le++)if(b.call(this,n,s,m,y,this.xCellCount*le+oe,I,M,z))return}_convertToXCellCoord(n){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(n*this.xScale)))}_convertToYCellCoord(n){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(n*this.yScale)))}_circlesCollide(n,s,m,y,b,I){const M=y-n,z=b-s,B=m+I;return B*B>M*M+z*z}_circleAndRectCollide(n,s,m,y,b,I,M){const z=(I-y)/2,B=Math.abs(n-(y+z));if(B>z+m)return!1;const q=(M-b)/2,W=Math.abs(s-(b+q));if(W>q+m)return!1;if(B<=z||W<=q)return!0;const K=B-z,oe=W-q;return K*K+oe*oe<=m*m}}function tt(w,n,s){const m=u.H();if(!w){const{vecSouth:W,vecEast:K}=ht(n),oe=O();oe[0]=K[0],oe[1]=K[1],oe[2]=W[0],oe[3]=W[1],y=oe,(q=(I=(b=oe)[0])*(B=b[3])-(z=b[2])*(M=b[1]))&&(y[0]=B*(q=1/q),y[1]=-M*q,y[2]=-z*q,y[3]=I*q),m[0]=oe[0],m[1]=oe[1],m[4]=oe[2],m[5]=oe[3]}var y,b,I,M,z,B,q;return u.K(m,m,[1/s,1/s,1]),m}function Ge(w,n,s,m){if(w){const y=u.H();if(!n){const{vecSouth:b,vecEast:I}=ht(s);y[0]=I[0],y[1]=I[1],y[4]=b[0],y[5]=b[1]}return u.K(y,y,[m,m,1]),y}return s.pixelsToClipSpaceMatrix}function ht(w){const n=Math.cos(w.rollInRadians),s=Math.sin(w.rollInRadians),m=Math.cos(w.pitchInRadians),y=Math.cos(w.bearingInRadians),b=Math.sin(w.bearingInRadians),I=u.ad();I[0]=-y*m*s-b*n,I[1]=-b*m*s+y*n;const M=u.ae(I);M<1e-9?u.af(I):u.ag(I,I,1/M);const z=u.ad();z[0]=y*m*n-b*s,z[1]=b*m*n+y*s;const B=u.ae(z);return B<1e-9?u.af(z):u.ag(z,z,1/B),{vecEast:z,vecSouth:I}}function ut(w,n,s,m){let y;m?(y=[w,n,m(w,n),1],u.al(y,y,s)):(y=[w,n,0,1],xi(y,y,s));const b=y[3];return{point:new u.P(y[0]/b,y[1]/b),signedDistanceFromCamera:b,isOccluded:!1}}function Xe(w,n){return .5+w/n*.5}function Ue(w,n){return w.x>=-n[0]&&w.x<=n[0]&&w.y>=-n[1]&&w.y<=n[1]}function zt(w,n,s,m,y,b,I,M,z,B,q,W,K){const oe=s?w.textSizeData:w.iconSizeData,le=u.ah(oe,n.transform.zoom),we=[256/n.width*2+1,256/n.height*2+1],ge=s?w.text.dynamicLayoutVertexArray:w.icon.dynamicLayoutVertexArray;ge.clear();const Te=w.lineVertexArray,Ie=s?w.text.placedSymbolArray:w.icon.placedSymbolArray,Re=n.transform.width/n.transform.height;let ze=!1;for(let Fe=0;Fe<Ie.length;Fe++){const Ve=Ie.get(Fe);if(Ve.hidden||Ve.writingMode===u.ai.vertical&&!ze){Si(Ve.numGlyphs,ge);continue}ze=!1;const Ne=new u.P(Ve.anchorX,Ve.anchorY),Qe={getElevation:K,pitchedLabelPlaneMatrix:m,lineVertexArray:Te,pitchWithMap:b,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:n.transform,tileAnchorPoint:Ne,unwrappedTileID:z,width:B,height:q,translation:W},Je=Nn(Ve.anchorX,Ve.anchorY,Qe);if(!Ue(Je.point,we)){Si(Ve.numGlyphs,ge);continue}const yt=Xe(n.transform.cameraToCenterDistance,Je.signedDistanceFromCamera),xt=u.aj(oe,le,Ve),pt=b?xt*n.transform.getPitchedTextCorrection(Ve.anchorX,Ve.anchorY,z)/yt:xt*yt,Ut=Pn({projectionContext:Qe,pitchedLabelPlaneMatrixInverse:y,symbol:Ve,fontSize:pt,flip:!1,keepUpright:I,glyphOffsetArray:w.glyphOffsetArray,dynamicLayoutVertexArray:ge,aspectRatio:Re,rotateToLine:M});ze=Ut.useVertical,(Ut.notEnoughRoom||ze||Ut.needsFlipping&&Pn({projectionContext:Qe,pitchedLabelPlaneMatrixInverse:y,symbol:Ve,fontSize:pt,flip:!0,keepUpright:I,glyphOffsetArray:w.glyphOffsetArray,dynamicLayoutVertexArray:ge,aspectRatio:Re,rotateToLine:M}).notEnoughRoom)&&Si(Ve.numGlyphs,ge)}s?w.text.dynamicLayoutVertexBuffer.updateData(ge):w.icon.dynamicLayoutVertexBuffer.updateData(ge)}function Nt(w,n,s,m,y,b,I,M){const z=b.glyphStartIndex+b.numGlyphs,B=b.lineStartIndex,q=b.lineStartIndex+b.lineLength,W=n.getoffsetX(b.glyphStartIndex),K=n.getoffsetX(z-1),oe=Ri(w*W,s,m,y,b.segment,B,q,M,I);if(!oe)return null;const le=Ri(w*K,s,m,y,b.segment,B,q,M,I);return le?M.projectionCache.anyProjectionOccluded?null:{first:oe,last:le}:null}function en(w,n,s,m){return w===u.ai.horizontal&&Math.abs(s.y-n.y)>Math.abs(s.x-n.x)*m?{useVertical:!0}:(w===u.ai.vertical?n.y<s.y:n.x>s.x)?{needsFlipping:!0}:null}function Pn(w){const{projectionContext:n,pitchedLabelPlaneMatrixInverse:s,symbol:m,fontSize:y,flip:b,keepUpright:I,glyphOffsetArray:M,dynamicLayoutVertexArray:z,aspectRatio:B,rotateToLine:q}=w,W=y/24,K=m.lineOffsetX*W,oe=m.lineOffsetY*W;let le;if(m.numGlyphs>1){const we=m.glyphStartIndex+m.numGlyphs,ge=m.lineStartIndex,Te=m.lineStartIndex+m.lineLength,Ie=Nt(W,M,K,oe,b,m,q,n);if(!Ie)return{notEnoughRoom:!0};const Re=Lt(Ie.first.point.x,Ie.first.point.y,n,s),ze=Lt(Ie.last.point.x,Ie.last.point.y,n,s);if(I&&!b){const Fe=en(m.writingMode,Re,ze,B);if(Fe)return Fe}le=[Ie.first];for(let Fe=m.glyphStartIndex+1;Fe<we-1;Fe++)le.push(Ri(W*M.getoffsetX(Fe),K,oe,b,m.segment,ge,Te,n,q));le.push(Ie.last)}else{if(I&&!b){const ge=$t(n.tileAnchorPoint.x,n.tileAnchorPoint.y,n).point,Te=m.lineStartIndex+m.segment+1,Ie=new u.P(n.lineVertexArray.getx(Te),n.lineVertexArray.gety(Te)),Re=$t(Ie.x,Ie.y,n),ze=Re.signedDistanceFromCamera>0?Re.point:mt(n.tileAnchorPoint,Ie,ge,1,n),Fe=Lt(ge.x,ge.y,n,s),Ve=Lt(ze.x,ze.y,n,s),Ne=en(m.writingMode,Fe,Ve,B);if(Ne)return Ne}const we=Ri(W*M.getoffsetX(m.glyphStartIndex),K,oe,b,m.segment,m.lineStartIndex,m.lineStartIndex+m.lineLength,n,q);if(!we||n.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};le=[we]}for(const we of le)u.ak(z,we.point,we.angle);return{}}function mt(w,n,s,m,y){const b=w.add(w.sub(n)._unit()),I=$t(b.x,b.y,y).point,M=s.sub(I);return s.add(M._mult(m/M.mag()))}function Vt(w,n,s){const m=n.projectionCache;if(m.projections[w])return m.projections[w];const y=new u.P(n.lineVertexArray.getx(w),n.lineVertexArray.gety(w)),b=$t(y.x,y.y,n);if(b.signedDistanceFromCamera>0)return m.projections[w]=b.point,m.anyProjectionOccluded=m.anyProjectionOccluded||b.isOccluded,b.point;const I=w-s.direction;return mt(s.distanceFromAnchor===0?n.tileAnchorPoint:new u.P(n.lineVertexArray.getx(I),n.lineVertexArray.gety(I)),y,s.previousVertex,s.absOffsetX-s.distanceFromAnchor+1,n)}function $t(w,n,s){const m=w+s.translation[0],y=n+s.translation[1];let b;return s.pitchWithMap?(b=ut(m,y,s.pitchedLabelPlaneMatrix,s.getElevation),b.isOccluded=!1):(b=s.transform.projectTileCoordinates(m,y,s.unwrappedTileID,s.getElevation),b.point.x=(.5*b.point.x+.5)*s.width,b.point.y=(.5*-b.point.y+.5)*s.height),b}function Lt(w,n,s,m){if(s.pitchWithMap){const y=[w,n,0,1];return u.al(y,y,m),s.transform.projectTileCoordinates(y[0]/y[3],y[1]/y[3],s.unwrappedTileID,s.getElevation).point}return{x:w/s.width*2-1,y:n/s.height*2-1}}function Nn(w,n,s){return s.transform.projectTileCoordinates(w,n,s.unwrappedTileID,s.getElevation)}function mn(w,n,s){return w._unit()._perp()._mult(n*s)}function Yt(w,n,s,m,y,b,I,M,z){if(M.projectionCache.offsets[w])return M.projectionCache.offsets[w];const B=s.add(n);if(w+z.direction<m||w+z.direction>=y)return M.projectionCache.offsets[w]=B,B;const q=Vt(w+z.direction,M,z),W=mn(q.sub(s),I,z.direction),K=s.add(W),oe=q.add(W);return M.projectionCache.offsets[w]=u.am(b,B,K,oe)||B,M.projectionCache.offsets[w]}function Ri(w,n,s,m,y,b,I,M,z){const B=m?w-n:w+n;let q=B>0?1:-1,W=0;m&&(q*=-1,W=Math.PI),q<0&&(W+=Math.PI);let K,oe=q>0?b+y:b+y+1;M.projectionCache.cachedAnchorPoint?K=M.projectionCache.cachedAnchorPoint:(K=$t(M.tileAnchorPoint.x,M.tileAnchorPoint.y,M).point,M.projectionCache.cachedAnchorPoint=K);let le,we,ge=K,Te=K,Ie=0,Re=0;const ze=Math.abs(B),Fe=[];let Ve;for(;Ie+Re<=ze;){if(oe+=q,oe<b||oe>=I)return null;Ie+=Re,Te=ge,we=le;const Je={absOffsetX:ze,direction:q,distanceFromAnchor:Ie,previousVertex:Te};if(ge=Vt(oe,M,Je),s===0)Fe.push(Te),Ve=ge.sub(Te);else{let yt;const xt=ge.sub(Te);yt=xt.mag()===0?mn(Vt(oe+q,M,Je).sub(ge),s,q):mn(xt,s,q),we||(we=Te.add(yt)),le=Yt(oe,yt,ge,b,I,we,s,M,Je),Fe.push(we),Ve=le.sub(we)}Re=Ve.mag()}const Ne=Ve._mult((ze-Ie)/Re)._add(we||Te),Qe=W+Math.atan2(ge.y-Te.y,ge.x-Te.x);return Fe.push(Ne),{point:Ne,angle:z?Qe:0,path:Fe}}const ts=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Si(w,n){for(let s=0;s<w;s++){const m=n.length;n.resize(m+4),n.float32.set(ts,3*m)}}function xi(w,n,s){const m=n[0],y=n[1];return w[0]=s[0]*m+s[4]*y+s[12],w[1]=s[1]*m+s[5]*y+s[13],w[3]=s[3]*m+s[7]*y+s[15],w}const oi=100;class co{constructor(n,s=new qe(n.width+200,n.height+200,25),m=new qe(n.width+200,n.height+200,25)){this.transform=n,this.grid=s,this.ignoredGrid=m,this.pitchFactor=Math.cos(n.pitch*Math.PI/180)*n.cameraToCenterDistance,this.screenRightBoundary=n.width+oi,this.screenBottomBoundary=n.height+oi,this.gridRightBoundary=n.width+200,this.gridBottomBoundary=n.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(n,s,m,y,b,I,M,z,B,q,W,K){const oe=this.projectAndGetPerspectiveRatio(n.anchorPointX+z[0],n.anchorPointY+z[1],b,q,K),le=m*oe.perspectiveRatio;let we;if(I||M)we=this._projectCollisionBox(n,le,y,b,I,M,z,oe,q,W,K);else{const Ve=oe.x+(W?W.x*le:0),Ne=oe.y+(W?W.y*le:0);we={allPointsOccluded:!1,box:[Ve+n.x1*le,Ne+n.y1*le,Ve+n.x2*le,Ne+n.y2*le]}}const[ge,Te,Ie,Re]=we.box,ze=I?we.allPointsOccluded:oe.isOccluded;let Fe=ze;return Fe||(Fe=oe.perspectiveRatio<this.perspectiveRatioCutoff),Fe||(Fe=!this.isInsideGrid(ge,Te,Ie,Re)),Fe||s!=="always"&&this.grid.hitTest(ge,Te,Ie,Re,s,B)?{box:[ge,Te,Ie,Re],placeable:!1,offscreen:!1,occluded:ze}:{box:[ge,Te,Ie,Re],placeable:!0,offscreen:this.isOffscreen(ge,Te,Ie,Re),occluded:ze}}placeCollisionCircles(n,s,m,y,b,I,M,z,B,q,W,K,oe,le){const we=[],ge=new u.P(s.anchorX,s.anchorY),Te=this.getPerspectiveRatio(ge.x,ge.y,I,le),Ie=(B?b*this.transform.getPitchedTextCorrection(s.anchorX,s.anchorY,I)/Te:b*Te)/u.as,Re={getElevation:le,pitchedLabelPlaneMatrix:M,lineVertexArray:m,pitchWithMap:B,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:ge,unwrappedTileID:I,width:this.transform.width,height:this.transform.height,translation:oe},ze=Nt(Ie,y,s.lineOffsetX*Ie,s.lineOffsetY*Ie,!1,s,!1,Re);let Fe=!1,Ve=!1,Ne=!0;if(ze){const Qe=.5*W*Te+K,Je=new u.P(-100,-100),yt=new u.P(this.screenRightBoundary,this.screenBottomBoundary),xt=new Pe,pt=ze.first,Ut=ze.last;let At=[];for(let Vn=pt.path.length-1;Vn>=1;Vn--)At.push(pt.path[Vn]);for(let Vn=1;Vn<Ut.path.length;Vn++)At.push(Ut.path[Vn]);const Et=2.5*Qe;if(B){const Vn=this.projectPathToScreenSpace(At,Re);At=Vn.some(Zn=>Zn.signedDistanceFromCamera<=0)?[]:Vn.map(Zn=>Zn.point)}let Ht=[];if(At.length>0){const Vn=At[0].clone(),Zn=At[0].clone();for(let pi=1;pi<At.length;pi++)Vn.x=Math.min(Vn.x,At[pi].x),Vn.y=Math.min(Vn.y,At[pi].y),Zn.x=Math.max(Zn.x,At[pi].x),Zn.y=Math.max(Zn.y,At[pi].y);Ht=Vn.x>=Je.x&&Zn.x<=yt.x&&Vn.y>=Je.y&&Zn.y<=yt.y?[At]:Zn.x<Je.x||Vn.x>yt.x||Zn.y<Je.y||Vn.y>yt.y?[]:u.ao([At],Je.x,Je.y,yt.x,yt.y)}for(const Vn of Ht){xt.reset(Vn,.25*Qe);let Zn=0;Zn=xt.length<=.5*Qe?1:Math.ceil(xt.paddedLength/Et)+1;for(let pi=0;pi<Zn;pi++){const Ti=pi/Math.max(Zn-1,1),ar=xt.lerp(Ti),Oi=ar.x+oi,Fi=ar.y+oi;we.push(Oi,Fi,Qe,0);const Hi=Oi-Qe,yo=Fi-Qe,Or=Oi+Qe,Fr=Fi+Qe;if(Ne=Ne&&this.isOffscreen(Hi,yo,Or,Fr),Ve=Ve||this.isInsideGrid(Hi,yo,Or,Fr),n!=="always"&&this.grid.hitTestCircle(Oi,Fi,Qe,n,q)&&(Fe=!0,!z))return{circles:[],offscreen:!1,collisionDetected:Fe}}}}return{circles:!z&&Fe||!Ve||Te<this.perspectiveRatioCutoff?[]:we,offscreen:Ne,collisionDetected:Fe}}projectPathToScreenSpace(n,s){const m=function(y,b){const I=u.H();return u.an(I,b.pitchedLabelPlaneMatrix),y.map(M=>{const z=ut(M.x,M.y,I,b.getElevation),B=b.transform.projectTileCoordinates(z.point.x,z.point.y,b.unwrappedTileID,b.getElevation);return B.point.x=(.5*B.point.x+.5)*b.width,B.point.y=(.5*-B.point.y+.5)*b.height,B})}(n,s);return function(y){let b=0,I=0,M=0,z=0;for(let B=0;B<y.length;B++)y[B].isOccluded?(M=B+1,z=0):(z++,z>I&&(I=z,b=M));return y.slice(b,b+I)}(m)}queryRenderedSymbols(n){if(n.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const s=[];let m=1/0,y=1/0,b=-1/0,I=-1/0;for(const q of n){const W=new u.P(q.x+oi,q.y+oi);m=Math.min(m,W.x),y=Math.min(y,W.y),b=Math.max(b,W.x),I=Math.max(I,W.y),s.push(W)}const M=this.grid.query(m,y,b,I).concat(this.ignoredGrid.query(m,y,b,I)),z={},B={};for(const q of M){const W=q.key;if(z[W.bucketInstanceId]===void 0&&(z[W.bucketInstanceId]={}),z[W.bucketInstanceId][W.featureIndex])continue;const K=[new u.P(q.x1,q.y1),new u.P(q.x2,q.y1),new u.P(q.x2,q.y2),new u.P(q.x1,q.y2)];u.ap(s,K)&&(z[W.bucketInstanceId][W.featureIndex]=!0,B[W.bucketInstanceId]===void 0&&(B[W.bucketInstanceId]=[]),B[W.bucketInstanceId].push(W.featureIndex))}return B}insertCollisionBox(n,s,m,y,b,I){(m?this.ignoredGrid:this.grid).insert({bucketInstanceId:y,featureIndex:b,collisionGroupID:I,overlapMode:s},n[0],n[1],n[2],n[3])}insertCollisionCircles(n,s,m,y,b,I){const M=m?this.ignoredGrid:this.grid,z={bucketInstanceId:y,featureIndex:b,collisionGroupID:I,overlapMode:s};for(let B=0;B<n.length;B+=4)M.insertCircle(z,n[B],n[B+1],n[B+2])}projectAndGetPerspectiveRatio(n,s,m,y,b){if(b){let I;y?(I=[n,s,y(n,s),1],u.al(I,I,b)):(I=[n,s,0,1],xi(I,I,b));const M=I[3];return{x:(I[0]/M+1)/2*this.transform.width+oi,y:(-I[1]/M+1)/2*this.transform.height+oi,perspectiveRatio:.5+this.transform.cameraToCenterDistance/M*.5,isOccluded:!1,signedDistanceFromCamera:M}}{const I=this.transform.projectTileCoordinates(n,s,m,y);return{x:(I.point.x+1)/2*this.transform.width+oi,y:(1-I.point.y)/2*this.transform.height+oi,perspectiveRatio:.5+this.transform.cameraToCenterDistance/I.signedDistanceFromCamera*.5,isOccluded:I.isOccluded,signedDistanceFromCamera:I.signedDistanceFromCamera}}}getPerspectiveRatio(n,s,m,y){const b=this.transform.projectTileCoordinates(n,s,m,y);return .5+this.transform.cameraToCenterDistance/b.signedDistanceFromCamera*.5}isOffscreen(n,s,m,y){return m<oi||n>=this.screenRightBoundary||y<oi||s>this.screenBottomBoundary}isInsideGrid(n,s,m,y){return m>=0&&n<this.gridRightBoundary&&y>=0&&s<this.gridBottomBoundary}getViewportMatrix(){const n=u.aq([]);return u.J(n,n,[-100,-100,0]),n}_projectCollisionBox(n,s,m,y,b,I,M,z,B,q,W){let K=1,oe=0,le=0,we=1;const ge=n.anchorPointX+M[0],Te=n.anchorPointY+M[1];if(I&&!b){const At=this.projectAndGetPerspectiveRatio(ge+1,Te,y,B,W),Et=At.x-z.x,Ht=Math.atan((At.y-z.y)/Et)+(Et<0?Math.PI:0),Vn=Math.sin(Ht),Zn=Math.cos(Ht);K=Zn,oe=Vn,le=-Vn,we=Zn}else if(!I&&b){const At=ht(this.transform);K=At.vecEast[0],oe=At.vecEast[1],le=At.vecSouth[0],we=At.vecSouth[1]}let Ie=z.x,Re=z.y,ze=s;b&&(Ie=ge,Re=Te,ze=Math.pow(2,-(this.transform.zoom-m.overscaledZ)),ze*=this.transform.getPitchedTextCorrection(ge,Te,y),q||(ze*=u.ab(.5+z.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),q&&(Ie+=K*q.x*ze+le*q.y*ze,Re+=oe*q.x*ze+we*q.y*ze);const Fe=n.x1*ze,Ve=n.x2*ze,Ne=(Fe+Ve)/2,Qe=n.y1*ze,Je=n.y2*ze,yt=(Qe+Je)/2,xt=[{offsetX:Fe,offsetY:Qe},{offsetX:Ne,offsetY:Qe},{offsetX:Ve,offsetY:Qe},{offsetX:Ve,offsetY:yt},{offsetX:Ve,offsetY:Je},{offsetX:Ne,offsetY:Je},{offsetX:Fe,offsetY:Je},{offsetX:Fe,offsetY:yt}];let pt=[];for(const{offsetX:At,offsetY:Et}of xt)pt.push(new u.P(Ie+K*At+le*Et,Re+oe*At+we*Et));let Ut=!1;if(b){const At=pt.map(Et=>this.projectAndGetPerspectiveRatio(Et.x,Et.y,y,B,W));Ut=At.some(Et=>!Et.isOccluded),pt=At.map(Et=>new u.P(Et.x,Et.y))}else Ut=!0;return{box:u.ar(pt),allPointsOccluded:!Ut}}}class Li{constructor(n,s,m,y){this.opacity=n?Math.max(0,Math.min(1,n.opacity+(n.placed?s:-s))):y&&m?1:0,this.placed=m}isHidden(){return this.opacity===0&&!this.placed}}class va{constructor(n,s,m,y,b){this.text=new Li(n?n.text:null,s,m,b),this.icon=new Li(n?n.icon:null,s,y,b)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Gs{constructor(n,s,m){this.text=n,this.icon=s,this.skipFade=m}}class ul{constructor(n,s,m,y,b){this.bucketInstanceId=n,this.featureIndex=s,this.sourceLayerIndex=m,this.bucketIndex=y,this.tileID=b}}class xa{constructor(n){this.crossSourceCollisions=n,this.maxGroupID=0,this.collisionGroups={}}get(n){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[n]){const s=++this.maxGroupID;this.collisionGroups[n]={ID:s,predicate:m=>m.collisionGroupID===s}}return this.collisionGroups[n]}}function Es(w,n,s,m,y){const{horizontalAlign:b,verticalAlign:I}=u.ay(w);return new u.P(-(b-.5)*n+m[0]*y,-(I-.5)*s+m[1]*y)}class Ki{constructor(n,s,m,y,b){this.transform=n.clone(),this.terrain=s,this.collisionIndex=new co(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=m,this.retainedQueryData={},this.collisionGroups=new xa(y),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=b,b&&(b.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(n){const s=this.terrain;return s?(m,y)=>s.getElevation(n,m,y):null}getBucketParts(n,s,m,y){const b=m.getBucket(s),I=m.latestFeatureIndex;if(!b||!I||s.id!==b.layerIds[0])return;const M=m.collisionBoxArray,z=b.layers[0].layout,B=b.layers[0].paint,q=Math.pow(2,this.transform.zoom-m.tileID.overscaledZ),W=m.tileSize/u.X,K=m.tileID.toUnwrapped(),oe=z.get("text-rotation-alignment")==="map",le=u.at(m,1,this.transform.zoom),we=u.au(this.collisionIndex.transform,m,B.get("text-translate"),B.get("text-translate-anchor")),ge=u.au(this.collisionIndex.transform,m,B.get("icon-translate"),B.get("icon-translate-anchor")),Te=tt(oe,this.transform,le);this.retainedQueryData[b.bucketInstanceId]=new ul(b.bucketInstanceId,I,b.sourceLayerIndex,b.index,m.tileID);const Ie={bucket:b,layout:z,translationText:we,translationIcon:ge,unwrappedTileID:K,pitchedLabelPlaneMatrix:Te,scale:q,textPixelRatio:W,holdingForFade:m.holdingForFade(),collisionBoxArray:M,partiallyEvaluatedTextSize:u.ah(b.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(b.sourceID)};if(y)for(const Re of b.sortKeyRanges){const{sortKey:ze,symbolInstanceStart:Fe,symbolInstanceEnd:Ve}=Re;n.push({sortKey:ze,symbolInstanceStart:Fe,symbolInstanceEnd:Ve,parameters:Ie})}else n.push({symbolInstanceStart:0,symbolInstanceEnd:b.symbolInstances.length,parameters:Ie})}attemptAnchorPlacement(n,s,m,y,b,I,M,z,B,q,W,K,oe,le,we,ge,Te,Ie,Re,ze){const Fe=u.av[n.textAnchor],Ve=[n.textOffset0,n.textOffset1],Ne=Es(Fe,m,y,Ve,b),Qe=this.collisionIndex.placeCollisionBox(s,K,z,B,q,M,I,ge,W.predicate,Re,Ne,ze);if((!Ie||this.collisionIndex.placeCollisionBox(Ie,K,z,B,q,M,I,Te,W.predicate,Re,Ne,ze).placeable)&&Qe.placeable){let Je;if(this.prevPlacement&&this.prevPlacement.variableOffsets[oe.crossTileID]&&this.prevPlacement.placements[oe.crossTileID]&&this.prevPlacement.placements[oe.crossTileID].text&&(Je=this.prevPlacement.variableOffsets[oe.crossTileID].anchor),oe.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[oe.crossTileID]={textOffset:Ve,width:m,height:y,anchor:Fe,textBoxScale:b,prevAnchor:Je},this.markUsedJustification(le,Fe,oe,we),le.allowVerticalPlacement&&(this.markUsedOrientation(le,we,oe),this.placedOrientations[oe.crossTileID]=we),{shift:Ne,placedGlyphBoxes:Qe}}}placeLayerBucketPart(n,s,m){const{bucket:y,layout:b,translationText:I,translationIcon:M,unwrappedTileID:z,pitchedLabelPlaneMatrix:B,textPixelRatio:q,holdingForFade:W,collisionBoxArray:K,partiallyEvaluatedTextSize:oe,collisionGroup:le}=n.parameters,we=b.get("text-optional"),ge=b.get("icon-optional"),Te=u.aw(b,"text-overlap","text-allow-overlap"),Ie=Te==="always",Re=u.aw(b,"icon-overlap","icon-allow-overlap"),ze=Re==="always",Fe=b.get("text-rotation-alignment")==="map",Ve=b.get("text-pitch-alignment")==="map",Ne=b.get("icon-text-fit")!=="none",Qe=b.get("symbol-z-order")==="viewport-y",Je=Ie&&(ze||!y.hasIconData()||ge),yt=ze&&(Ie||!y.hasTextData()||we);!y.collisionArrays&&K&&y.deserializeCollisionBoxes(K);const xt=this.retainedQueryData[y.bucketInstanceId].tileID,pt=this._getTerrainElevationFunc(xt),Ut=this.transform.getFastPathSimpleProjectionMatrix(xt),At=(Et,Ht,Vn)=>{var Zn,pi;if(s[Et.crossTileID])return;if(W)return void(this.placements[Et.crossTileID]=new Gs(!1,!1,!1));let Ti=!1,ar=!1,Oi=!0,Fi=null,Hi={box:null,placeable:!1,offscreen:null,occluded:!1},yo={placeable:!1},Or=null,Fr=null,$o=null,kl=0,il=0,ko=0;Ht.textFeatureIndex?kl=Ht.textFeatureIndex:Et.useRuntimeCollisionCircles&&(kl=Et.featureIndex),Ht.verticalTextFeatureIndex&&(il=Ht.verticalTextFeatureIndex);const Ml=Ht.textBox;if(Ml){const Ho=qi=>{let lr=u.ai.horizontal;if(y.allowVerticalPlacement&&!qi&&this.prevPlacement){const Fs=this.prevPlacement.placedOrientations[Et.crossTileID];Fs&&(this.placedOrientations[Et.crossTileID]=Fs,lr=Fs,this.markUsedOrientation(y,lr,Et))}return lr},ra=(qi,lr)=>{if(y.allowVerticalPlacement&&Et.numVerticalGlyphVertices>0&&Ht.verticalTextBox){for(const Fs of y.writingModes)if(Fs===u.ai.vertical?(Hi=lr(),yo=Hi):Hi=qi(),Hi&&Hi.placeable)break}else Hi=qi()},oa=Et.textAnchorOffsetStartIndex,Os=Et.textAnchorOffsetEndIndex;if(Os===oa){const qi=(lr,Fs)=>{const yr=this.collisionIndex.placeCollisionBox(lr,Te,q,xt,z,Ve,Fe,I,le.predicate,pt,void 0,Ut);return yr&&yr.placeable&&(this.markUsedOrientation(y,Fs,Et),this.placedOrientations[Et.crossTileID]=Fs),yr};ra(()=>qi(Ml,u.ai.horizontal),()=>{const lr=Ht.verticalTextBox;return y.allowVerticalPlacement&&Et.numVerticalGlyphVertices>0&&lr?qi(lr,u.ai.vertical):{box:null,offscreen:null}}),Ho(Hi&&Hi.placeable)}else{let qi=u.av[(pi=(Zn=this.prevPlacement)===null||Zn===void 0?void 0:Zn.variableOffsets[Et.crossTileID])===null||pi===void 0?void 0:pi.anchor];const lr=(yr,qp,Gp)=>{const ud=yr.x2-yr.x1,Zp=yr.y2-yr.y1,tc=Et.textBoxScale,Du=Ne&&Re==="never"?qp:null;let au=null,Zd=Te==="never"?1:2,nc="never";qi&&Zd++;for(let Wd=0;Wd<Zd;Wd++){for(let Kd=oa;Kd<Os;Kd++){const Xd=y.textAnchorOffsets.get(Kd);if(qi&&Xd.textAnchor!==qi)continue;const sa=this.attemptAnchorPlacement(Xd,yr,ud,Zp,tc,Fe,Ve,q,xt,z,le,nc,Et,y,Gp,I,M,Du,pt);if(sa&&(au=sa.placedGlyphBoxes,au&&au.placeable))return Ti=!0,Fi=sa.shift,au}qi?qi=null:nc=Te}return m&&!au&&(au={box:this.collisionIndex.placeCollisionBox(Ml,"always",q,xt,z,Ve,Fe,I,le.predicate,pt,void 0,Ut).box,offscreen:!1,placeable:!1,occluded:!1}),au};ra(()=>lr(Ml,Ht.iconBox,u.ai.horizontal),()=>{const yr=Ht.verticalTextBox;return y.allowVerticalPlacement&&(!Hi||!Hi.placeable)&&Et.numVerticalGlyphVertices>0&&yr?lr(yr,Ht.verticalIconBox,u.ai.vertical):{box:null,occluded:!0,offscreen:null}}),Hi&&(Ti=Hi.placeable,Oi=Hi.offscreen);const Fs=Ho(Hi&&Hi.placeable);if(!Ti&&this.prevPlacement){const yr=this.prevPlacement.variableOffsets[Et.crossTileID];yr&&(this.variableOffsets[Et.crossTileID]=yr,this.markUsedJustification(y,yr.anchor,Et,Fs))}}}if(Or=Hi,Ti=Or&&Or.placeable,Oi=Or&&Or.offscreen,Et.useRuntimeCollisionCircles){const Ho=y.text.placedSymbolArray.get(Et.centerJustifiedTextSymbolIndex),ra=u.aj(y.textSizeData,oe,Ho),oa=b.get("text-padding");Fr=this.collisionIndex.placeCollisionCircles(Te,Ho,y.lineVertexArray,y.glyphOffsetArray,ra,z,B,m,Ve,le.predicate,Et.collisionCircleDiameter,oa,I,pt),Fr.circles.length&&Fr.collisionDetected&&!m&&u.w("Collisions detected, but collision boxes are not shown"),Ti=Ie||Fr.circles.length>0&&!Fr.collisionDetected,Oi=Oi&&Fr.offscreen}if(Ht.iconFeatureIndex&&(ko=Ht.iconFeatureIndex),Ht.iconBox){const Ho=ra=>this.collisionIndex.placeCollisionBox(ra,Re,q,xt,z,Ve,Fe,M,le.predicate,pt,Ne&&Fi?Fi:void 0,Ut);yo&&yo.placeable&&Ht.verticalIconBox?($o=Ho(Ht.verticalIconBox),ar=$o.placeable):($o=Ho(Ht.iconBox),ar=$o.placeable),Oi=Oi&&$o.offscreen}const Ru=we||Et.numHorizontalGlyphVertices===0&&Et.numVerticalGlyphVertices===0,Lu=ge||Et.numIconVertices===0;Ru||Lu?Lu?Ru||(ar=ar&&Ti):Ti=ar&&Ti:ar=Ti=ar&&Ti;const ec=ar&&$o.placeable;if(Ti&&Or.placeable&&this.collisionIndex.insertCollisionBox(Or.box,Te,b.get("text-ignore-placement"),y.bucketInstanceId,yo&&yo.placeable&&il?il:kl,le.ID),ec&&this.collisionIndex.insertCollisionBox($o.box,Re,b.get("icon-ignore-placement"),y.bucketInstanceId,ko,le.ID),Fr&&Ti&&this.collisionIndex.insertCollisionCircles(Fr.circles,Te,b.get("text-ignore-placement"),y.bucketInstanceId,kl,le.ID),m&&this.storeCollisionData(y.bucketInstanceId,Vn,Ht,Or,$o,Fr),Et.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(y.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Et.crossTileID]=new Gs((Ti||Je)&&!Or?.occluded,(ar||yt)&&!$o?.occluded,Oi||y.justReloaded),s[Et.crossTileID]=!0};if(Qe){if(n.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Et=y.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let Ht=Et.length-1;Ht>=0;--Ht){const Vn=Et[Ht];At(y.symbolInstances.get(Vn),y.collisionArrays[Vn],Vn)}}else for(let Et=n.symbolInstanceStart;Et<n.symbolInstanceEnd;Et++)At(y.symbolInstances.get(Et),y.collisionArrays[Et],Et);y.justReloaded=!1}storeCollisionData(n,s,m,y,b,I){if(m.textBox||m.iconBox){let M,z;this.collisionBoxArrays.has(n)?M=this.collisionBoxArrays.get(n):(M=new Map,this.collisionBoxArrays.set(n,M)),M.has(s)?z=M.get(s):(z={text:null,icon:null},M.set(s,z)),m.textBox&&(z.text=y.box),m.iconBox&&(z.icon=b.box)}if(I){let M=this.collisionCircleArrays[n];M===void 0&&(M=this.collisionCircleArrays[n]=[]);for(let z=0;z<I.circles.length;z+=4)M.push(I.circles[z+0]-oi),M.push(I.circles[z+1]-oi),M.push(I.circles[z+2]),M.push(I.collisionDetected?1:0)}}markUsedJustification(n,s,m,y){let b;b=y===u.ai.vertical?m.verticalPlacedTextSymbolIndex:{left:m.leftJustifiedTextSymbolIndex,center:m.centerJustifiedTextSymbolIndex,right:m.rightJustifiedTextSymbolIndex}[u.ax(s)];const I=[m.leftJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.rightJustifiedTextSymbolIndex,m.verticalPlacedTextSymbolIndex];for(const M of I)M>=0&&(n.text.placedSymbolArray.get(M).crossTileID=b>=0&&M!==b?0:m.crossTileID)}markUsedOrientation(n,s,m){const y=s===u.ai.horizontal||s===u.ai.horizontalOnly?s:0,b=s===u.ai.vertical?s:0,I=[m.leftJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.rightJustifiedTextSymbolIndex];for(const M of I)n.text.placedSymbolArray.get(M).placedOrientation=y;m.verticalPlacedTextSymbolIndex&&(n.text.placedSymbolArray.get(m.verticalPlacedTextSymbolIndex).placedOrientation=b)}commit(n){this.commitTime=n,this.zoomAtLastRecencyCheck=this.transform.zoom;const s=this.prevPlacement;let m=!1;this.prevZoomAdjustment=s?s.zoomAdjustment(this.transform.zoom):0;const y=s?s.symbolFadeChange(n):1,b=s?s.opacities:{},I=s?s.variableOffsets:{},M=s?s.placedOrientations:{};for(const z in this.placements){const B=this.placements[z],q=b[z];q?(this.opacities[z]=new va(q,y,B.text,B.icon),m=m||B.text!==q.text.placed||B.icon!==q.icon.placed):(this.opacities[z]=new va(null,y,B.text,B.icon,B.skipFade),m=m||B.text||B.icon)}for(const z in b){const B=b[z];if(!this.opacities[z]){const q=new va(B,y,!1,!1);q.isHidden()||(this.opacities[z]=q,m=m||B.text.placed||B.icon.placed)}}for(const z in I)this.variableOffsets[z]||!this.opacities[z]||this.opacities[z].isHidden()||(this.variableOffsets[z]=I[z]);for(const z in M)this.placedOrientations[z]||!this.opacities[z]||this.opacities[z].isHidden()||(this.placedOrientations[z]=M[z]);if(s&&s.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");m?this.lastPlacementChangeTime=n:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=s?s.lastPlacementChangeTime:n)}updateLayerOpacities(n,s){const m={};for(const y of s){const b=y.getBucket(n);b&&y.latestFeatureIndex&&n.id===b.layerIds[0]&&this.updateBucketOpacities(b,y.tileID,m,y.collisionBoxArray)}}updateBucketOpacities(n,s,m,y){n.hasTextData()&&(n.text.opacityVertexArray.clear(),n.text.hasVisibleVertices=!1),n.hasIconData()&&(n.icon.opacityVertexArray.clear(),n.icon.hasVisibleVertices=!1),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexArray.clear(),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexArray.clear();const b=n.layers[0],I=b.layout,M=new va(null,0,!1,!1,!0),z=I.get("text-allow-overlap"),B=I.get("icon-allow-overlap"),q=b._unevaluatedLayout.hasValue("text-variable-anchor")||b._unevaluatedLayout.hasValue("text-variable-anchor-offset"),W=I.get("text-rotation-alignment")==="map",K=I.get("text-pitch-alignment")==="map",oe=I.get("icon-text-fit")!=="none",le=new va(null,0,z&&(B||!n.hasIconData()||I.get("icon-optional")),B&&(z||!n.hasTextData()||I.get("text-optional")),!0);!n.collisionArrays&&y&&(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData())&&n.deserializeCollisionBoxes(y);const we=(Te,Ie,Re)=>{for(let ze=0;ze<Ie/4;ze++)Te.opacityVertexArray.emplaceBack(Re);Te.hasVisibleVertices=Te.hasVisibleVertices||Re!==An},ge=this.collisionBoxArrays.get(n.bucketInstanceId);for(let Te=0;Te<n.symbolInstances.length;Te++){const Ie=n.symbolInstances.get(Te),{numHorizontalGlyphVertices:Re,numVerticalGlyphVertices:ze,crossTileID:Fe}=Ie;let Ve=this.opacities[Fe];m[Fe]?Ve=M:Ve||(Ve=le,this.opacities[Fe]=Ve),m[Fe]=!0;const Ne=Ie.numIconVertices>0,Qe=this.placedOrientations[Ie.crossTileID],Je=Qe===u.ai.vertical,yt=Qe===u.ai.horizontal||Qe===u.ai.horizontalOnly;if(Re>0||ze>0){const pt=wa(Ve.text);we(n.text,Re,Je?An:pt),we(n.text,ze,yt?An:pt);const Ut=Ve.text.isHidden();[Ie.rightJustifiedTextSymbolIndex,Ie.centerJustifiedTextSymbolIndex,Ie.leftJustifiedTextSymbolIndex].forEach(Ht=>{Ht>=0&&(n.text.placedSymbolArray.get(Ht).hidden=Ut||Je?1:0)}),Ie.verticalPlacedTextSymbolIndex>=0&&(n.text.placedSymbolArray.get(Ie.verticalPlacedTextSymbolIndex).hidden=Ut||yt?1:0);const At=this.variableOffsets[Ie.crossTileID];At&&this.markUsedJustification(n,At.anchor,Ie,Qe);const Et=this.placedOrientations[Ie.crossTileID];Et&&(this.markUsedJustification(n,"left",Ie,Et),this.markUsedOrientation(n,Et,Ie))}if(Ne){const pt=wa(Ve.icon),Ut=!(oe&&Ie.verticalPlacedIconSymbolIndex&&Je);Ie.placedIconSymbolIndex>=0&&(we(n.icon,Ie.numIconVertices,Ut?pt:An),n.icon.placedSymbolArray.get(Ie.placedIconSymbolIndex).hidden=Ve.icon.isHidden()),Ie.verticalPlacedIconSymbolIndex>=0&&(we(n.icon,Ie.numVerticalIconVertices,Ut?An:pt),n.icon.placedSymbolArray.get(Ie.verticalPlacedIconSymbolIndex).hidden=Ve.icon.isHidden())}const xt=ge&&ge.has(Te)?ge.get(Te):{text:null,icon:null};if(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData()){const pt=n.collisionArrays[Te];if(pt){let Ut=new u.P(0,0);if(pt.textBox||pt.verticalTextBox){let At=!0;if(q){const Et=this.variableOffsets[Fe];Et?(Ut=Es(Et.anchor,Et.width,Et.height,Et.textOffset,Et.textBoxScale),W&&Ut._rotate(K?-this.transform.bearingInRadians:this.transform.bearingInRadians)):At=!1}if(pt.textBox||pt.verticalTextBox){let Et;pt.textBox&&(Et=Je),pt.verticalTextBox&&(Et=yt),yu(n.textCollisionBox.collisionVertexArray,Ve.text.placed,!At||Et,xt.text,Ut.x,Ut.y)}}if(pt.iconBox||pt.verticalIconBox){const At=!!(!yt&&pt.verticalIconBox);let Et;pt.iconBox&&(Et=At),pt.verticalIconBox&&(Et=!At),yu(n.iconCollisionBox.collisionVertexArray,Ve.icon.placed,Et,xt.icon,oe?Ut.x:0,oe?Ut.y:0)}}}}if(n.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[n.bucketInstanceId]&&(this.retainedQueryData[n.bucketInstanceId].featureSortOrder=n.featureSortOrder),n.hasTextData()&&n.text.opacityVertexBuffer&&n.text.opacityVertexBuffer.updateData(n.text.opacityVertexArray),n.hasIconData()&&n.icon.opacityVertexBuffer&&n.icon.opacityVertexBuffer.updateData(n.icon.opacityVertexArray),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexBuffer&&n.iconCollisionBox.collisionVertexBuffer.updateData(n.iconCollisionBox.collisionVertexArray),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexBuffer&&n.textCollisionBox.collisionVertexBuffer.updateData(n.textCollisionBox.collisionVertexArray),n.text.opacityVertexArray.length!==n.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${n.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${n.text.layoutVertexArray.length}) / 4`);if(n.icon.opacityVertexArray.length!==n.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${n.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${n.icon.layoutVertexArray.length}) / 4`);n.bucketInstanceId in this.collisionCircleArrays&&(n.collisionCircleArray=this.collisionCircleArrays[n.bucketInstanceId],delete this.collisionCircleArrays[n.bucketInstanceId])}symbolFadeChange(n){return this.fadeDuration===0?1:(n-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(n){return Math.max(0,(this.transform.zoom-n)/1.5)}hasTransitions(n){return this.stale||n-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(n,s){const m=this.zoomAtLastRecencyCheck===s?1-this.zoomAdjustment(s):1;return this.zoomAtLastRecencyCheck=s,this.commitTime+this.fadeDuration*m>n}setStale(){this.stale=!0}}function yu(w,n,s,m,y,b){m&&m.length!==0||(m=[0,0,0,0]);const I=m[0]-oi,M=m[1]-oi,z=m[2]-oi,B=m[3]-oi;w.emplaceBack(n?1:0,s?1:0,y||0,b||0,I,M),w.emplaceBack(n?1:0,s?1:0,y||0,b||0,z,M),w.emplaceBack(n?1:0,s?1:0,y||0,b||0,z,B),w.emplaceBack(n?1:0,s?1:0,y||0,b||0,I,B)}const cl=Math.pow(2,25),ns=Math.pow(2,24),is=Math.pow(2,17),Fl=Math.pow(2,16),hl=Math.pow(2,9),dl=Math.pow(2,8),bo=Math.pow(2,1);function wa(w){if(w.opacity===0&&!w.placed)return 0;if(w.opacity===1&&w.placed)return 4294967295;const n=w.placed?1:0,s=Math.floor(127*w.opacity);return s*cl+n*ns+s*is+n*Fl+s*hl+n*dl+s*bo+n}const An=0;class Di{constructor(n){this._sortAcrossTiles=n.layout.get("symbol-z-order")!=="viewport-y"&&!n.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(n,s,m,y,b){const I=this._bucketParts;for(;this._currentTileIndex<n.length;)if(s.getBucketParts(I,y,n[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,b())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,I.sort((M,z)=>M.sortKey-z.sortKey));this._currentPartIndex<I.length;)if(s.placeLayerBucketPart(I[this._currentPartIndex],this._seenCrossTileIDs,m),this._currentPartIndex++,b())return!0;return!1}}class pl{constructor(n,s,m,y,b,I,M,z){this.placement=new Ki(n,s,I,M,z),this._currentPlacementIndex=m.length-1,this._forceFullPlacement=y,this._showCollisionBoxes=b,this._done=!1}isDone(){return this._done}continuePlacement(n,s,m){const y=re.now(),b=()=>!this._forceFullPlacement&&re.now()-y>2;for(;this._currentPlacementIndex>=0;){const I=s[n[this._currentPlacementIndex]],M=this.placement.collisionIndex.transform.zoom;if(I.type==="symbol"&&(!I.minzoom||I.minzoom<=M)&&(!I.maxzoom||I.maxzoom>M)){if(this._inProgressLayer||(this._inProgressLayer=new Di(I)),this._inProgressLayer.continuePlacement(m[I.source],this.placement,this._showCollisionBoxes,I,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(n){return this.placement.commit(n),this.placement}}const To=512/u.X/2;class rs{constructor(n,s,m){this.tileID=n,this.bucketInstanceId=m,this._symbolsByKey={};const y=new Map;for(let b=0;b<s.length;b++){const I=s.get(b),M=I.key,z=y.get(M);z?z.push(I):y.set(M,[I])}for(const[b,I]of y){const M={positions:I.map(z=>({x:Math.floor(z.anchorX*To),y:Math.floor(z.anchorY*To)})),crossTileIDs:I.map(z=>z.crossTileID)};if(M.positions.length>128){const z=new u.az(M.positions.length,16,Uint16Array);for(const{x:B,y:q}of M.positions)z.add(B,q);z.finish(),delete M.positions,M.index=z}this._symbolsByKey[b]=M}}getScaledCoordinates(n,s){const{x:m,y,z:b}=this.tileID.canonical,{x:I,y:M,z}=s.canonical,B=To/Math.pow(2,z-b),q=(M*u.X+n.anchorY)*B,W=y*u.X*To;return{x:Math.floor((I*u.X+n.anchorX)*B-m*u.X*To),y:Math.floor(q-W)}}findMatches(n,s,m){const y=this.tileID.canonical.z<s.canonical.z?1:Math.pow(2,this.tileID.canonical.z-s.canonical.z);for(let b=0;b<n.length;b++){const I=n.get(b);if(I.crossTileID)continue;const M=this._symbolsByKey[I.key];if(!M)continue;const z=this.getScaledCoordinates(I,s);if(M.index){const B=M.index.range(z.x-y,z.y-y,z.x+y,z.y+y).sort();for(const q of B){const W=M.crossTileIDs[q];if(!m[W]){m[W]=!0,I.crossTileID=W;break}}}else if(M.positions)for(let B=0;B<M.positions.length;B++){const q=M.positions[B],W=M.crossTileIDs[B];if(Math.abs(q.x-z.x)<=y&&Math.abs(q.y-z.y)<=y&&!m[W]){m[W]=!0,I.crossTileID=W;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:n})=>n)}}class Zs{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Dn{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(n){const s=Math.round((n-this.lng)/360);if(s!==0)for(const m in this.indexes){const y=this.indexes[m],b={};for(const I in y){const M=y[I];M.tileID=M.tileID.unwrapTo(M.tileID.wrap+s),b[M.tileID.key]=M}this.indexes[m]=b}this.lng=n}addBucket(n,s,m){if(this.indexes[n.overscaledZ]&&this.indexes[n.overscaledZ][n.key]){if(this.indexes[n.overscaledZ][n.key].bucketInstanceId===s.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(n.overscaledZ,this.indexes[n.overscaledZ][n.key])}for(let b=0;b<s.symbolInstances.length;b++)s.symbolInstances.get(b).crossTileID=0;this.usedCrossTileIDs[n.overscaledZ]||(this.usedCrossTileIDs[n.overscaledZ]={});const y=this.usedCrossTileIDs[n.overscaledZ];for(const b in this.indexes){const I=this.indexes[b];if(Number(b)>n.overscaledZ)for(const M in I){const z=I[M];z.tileID.isChildOf(n)&&z.findMatches(s.symbolInstances,n,y)}else{const M=I[n.scaledTo(Number(b)).key];M&&M.findMatches(s.symbolInstances,n,y)}}for(let b=0;b<s.symbolInstances.length;b++){const I=s.symbolInstances.get(b);I.crossTileID||(I.crossTileID=m.generate(),y[I.crossTileID]=!0)}return this.indexes[n.overscaledZ]===void 0&&(this.indexes[n.overscaledZ]={}),this.indexes[n.overscaledZ][n.key]=new rs(n,s.symbolInstances,s.bucketInstanceId),!0}removeBucketCrossTileIDs(n,s){for(const m of s.getCrossTileIDsLists())for(const y of m)delete this.usedCrossTileIDs[n][y]}removeStaleBuckets(n){let s=!1;for(const m in this.indexes){const y=this.indexes[m];for(const b in y)n[y[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(m,y[b]),delete y[b],s=!0)}return s}}class fi{constructor(){this.layerIndexes={},this.crossTileIDs=new Zs,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(n,s,m){let y=this.layerIndexes[n.id];y===void 0&&(y=this.layerIndexes[n.id]=new Dn);let b=!1;const I={};y.handleWrapJump(m);for(const M of s){const z=M.getBucket(n);z&&n.id===z.layerIds[0]&&(z.bucketInstanceId||(z.bucketInstanceId=++this.maxBucketInstanceId),y.addBucket(M.tileID,z,this.crossTileIDs)&&(b=!0),I[z.bucketInstanceId]=!0)}return y.removeStaleBuckets(I)&&(b=!0),b}pruneUnusedLayers(n){const s={};n.forEach(m=>{s[m]=!0});for(const m in this.layerIndexes)s[m]||delete this.layerIndexes[m]}}var Bl="void main() {fragColor=vec4(1.0);}";const Sr={prelude:ln(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:ln("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:ln("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:ln(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:ln(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:ln(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:ln(Bl,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:ln(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:ln(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:ln("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:ln("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:ln("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:ln(Bl,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:ln(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:ln(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:ln(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:ln(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:ln(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:ln(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:ln(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));fragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:ln(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:ln(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:ln(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:ln(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:ln(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:ln(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:ln(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:ln(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:ln(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:ln("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:ln("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:ln("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:ln("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:ln(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:ln("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function ln(w,n){const s=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,m=n.match(/in ([\w]+) ([\w]+)/g),y=w.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),b=n.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),I=b?b.concat(y):y,M={};return{fragmentSource:w=w.replace(s,(z,B,q,W,K)=>(M[K]=!0,B==="define"?`
#ifndef HAS_UNIFORM_u_${K}
in ${q} ${W} ${K};
#else
uniform ${q} ${W} u_${K};
#endif
`:`
#ifdef HAS_UNIFORM_u_${K}
    ${q} ${W} ${K} = u_${K};
#endif
`)),vertexSource:n=n.replace(s,(z,B,q,W,K)=>{const oe=W==="float"?"vec2":"vec4",le=K.match(/color/)?"color":oe;return M[K]?B==="define"?`
#ifndef HAS_UNIFORM_u_${K}
uniform lowp float u_${K}_t;
in ${q} ${oe} a_${K};
out ${q} ${W} ${K};
#else
uniform ${q} ${W} u_${K};
#endif
`:le==="vec4"?`
#ifndef HAS_UNIFORM_u_${K}
    ${K} = a_${K};
#else
    ${q} ${W} ${K} = u_${K};
#endif
`:`
#ifndef HAS_UNIFORM_u_${K}
    ${K} = unpack_mix_${le}(a_${K}, u_${K}_t);
#else
    ${q} ${W} ${K} = u_${K};
#endif
`:B==="define"?`
#ifndef HAS_UNIFORM_u_${K}
uniform lowp float u_${K}_t;
in ${q} ${oe} a_${K};
#else
uniform ${q} ${W} u_${K};
#endif
`:le==="vec4"?`
#ifndef HAS_UNIFORM_u_${K}
    ${q} ${W} ${K} = a_${K};
#else
    ${q} ${W} ${K} = u_${K};
#endif
`:`
#ifndef HAS_UNIFORM_u_${K}
    ${q} ${W} ${K} = unpack_mix_${le}(a_${K}, u_${K}_t);
#else
    ${q} ${W} ${K} = u_${K};
#endif
`}),staticAttributes:m,staticUniforms:I}}class ho{constructor(n,s,m){this.vertexBuffer=n,this.indexBuffer=s,this.segments=m}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var kn=u.aA([{name:"a_pos",type:"Int16",components:2}]);const eo="#define PROJECTION_MERCATOR",On="mercator";class Gr{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return On}get shaderDefine(){return eo}get shaderPreludeCode(){return Sr.projectionMercator}get vertexShaderPreludeCode(){return Sr.projectionMercator.vertexSource}get subdivisionGranularity(){return u.aB.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(n){}getMeshFromTileID(n,s,m,y,b){if(this._cachedMesh)return this._cachedMesh;const I=new u.aC;I.emplaceBack(0,0),I.emplaceBack(u.X,0),I.emplaceBack(0,u.X),I.emplaceBack(u.X,u.X);const M=n.createVertexBuffer(I,kn.members),z=u.aD.simpleSegment(0,0,4,2),B=new u.aE;B.emplaceBack(1,0,2),B.emplaceBack(1,2,3);const q=n.createIndexBuffer(B);return this._cachedMesh=new ho(M,q,z),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(n){}}function _n(w,n){const s=u.ab(n.lat,-85.051129,u.aF);return new u.P(u.O(n.lng)*w,u.Q(s)*w)}function Ei(w,n){return new u.Y(n.x/w,n.y/w).toLngLat()}function zi(w){return w.cameraToCenterDistance*Math.min(.85*Math.tan(u.aa(90-w.pitch)),Math.tan(u.aa(89.25-w.pitch)))}function Is(w,n){const s=w.canonical,m=n/u.aG(s.z),y=s.x+Math.pow(2,s.z)*w.wrap,b=u.aq(new Float64Array(16));return u.J(b,b,[y*m,s.y*m,0]),u.K(b,b,[m/u.X,m/u.X,1]),b}function Er(w,n,s,m,y){const b=u.Y.fromLngLat(w,n),I=y*u.aH(1,w.lat),M=I*Math.cos(u.aa(s)),z=Math.sqrt(I*I-M*M),B=z*Math.sin(u.aa(-m)),q=z*Math.cos(u.aa(-m));return new u.Y(b.x+B,b.y+q,b.z+M)}class Ir{constructor(n=0,s=0,m=0,y=0){if(isNaN(n)||n<0||isNaN(s)||s<0||isNaN(m)||m<0||isNaN(y)||y<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=n,this.bottom=s,this.left=m,this.right=y}interpolate(n,s,m){return s.top!=null&&n.top!=null&&(this.top=u.y.number(n.top,s.top,m)),s.bottom!=null&&n.bottom!=null&&(this.bottom=u.y.number(n.bottom,s.bottom,m)),s.left!=null&&n.left!=null&&(this.left=u.y.number(n.left,s.left,m)),s.right!=null&&n.right!=null&&(this.right=u.y.number(n.right,s.right,m)),this}getCenter(n,s){const m=u.ab((this.left+n-this.right)/2,0,n),y=u.ab((this.top+s-this.bottom)/2,0,s);return new u.P(m,y)}equals(n){return this.top===n.top&&this.bottom===n.bottom&&this.left===n.left&&this.right===n.right}clone(){return new Ir(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function xr(w,n){if(!w.renderWorldCopies||w.lngRange)return;const s=n.lng-w.center.lng;n.lng+=s>180?-360:s<-180?360:0}function Ha(w){return Math.max(0,Math.floor(w))}class Zr{constructor(n,s,m,y,b,I){this._callbacks=n,this._tileSize=512,this._renderWorldCopies=I===void 0||!!I,this._minZoom=s||0,this._maxZoom=m||22,this._minPitch=y??0,this._maxPitch=b??60,this.setMaxBounds(),this._width=0,this._height=0,this._center=new u.N(0,0),this._elevation=0,this._zoom=0,this._tileZoom=Ha(this._zoom),this._scale=u.aG(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new Ir,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(n,s,m){this._latRange=n.latRange,this._lngRange=n.lngRange,this._width=n.width,this._height=n.height,this._center=n.center,this._elevation=n.elevation,this._minElevationForCurrentTile=n.minElevationForCurrentTile,this._zoom=n.zoom,this._tileZoom=Ha(this._zoom),this._scale=u.aG(this._zoom),this._bearingInRadians=n.bearingInRadians,this._fovInRadians=n.fovInRadians,this._pitchInRadians=n.pitchInRadians,this._rollInRadians=n.rollInRadians,this._unmodified=n.unmodified,this._edgeInsets=new Ir(n.padding.top,n.padding.bottom,n.padding.left,n.padding.right),this._minZoom=n.minZoom,this._maxZoom=n.maxZoom,this._minPitch=n.minPitch,this._maxPitch=n.maxPitch,this._renderWorldCopies=n.renderWorldCopies,this._cameraToCenterDistance=n.cameraToCenterDistance,this._nearZ=n.nearZ,this._farZ=n.farZ,this._autoCalculateNearFarZ=!m&&n.autoCalculateNearFarZ,s&&this._constrain(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(n){this._minElevationForCurrentTile=n}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(n){this._minZoom!==n&&(this._minZoom=n,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(n){this._maxZoom!==n&&(this._maxZoom=n,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(n){this._minPitch!==n&&(this._minPitch=n,this.setPitch(Math.max(this.pitch,n)))}get maxPitch(){return this._maxPitch}setMaxPitch(n){this._maxPitch!==n&&(this._maxPitch=n,this.setPitch(Math.min(this.pitch,n)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(n){n===void 0?n=!0:n===null&&(n=!1),this._renderWorldCopies=n}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new u.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(n){const s=u.aI(n,-180,180)*Math.PI/180;var m,y,b,I,M,z,B,q,W;this._bearingInRadians!==s&&(this._unmodified=!1,this._bearingInRadians=s,this._calcMatrices(),this._rotationMatrix=O(),m=this._rotationMatrix,b=-this._bearingInRadians,I=(y=this._rotationMatrix)[0],M=y[1],z=y[2],B=y[3],q=Math.sin(b),W=Math.cos(b),m[0]=I*W+z*q,m[1]=M*W+B*q,m[2]=I*-q+z*W,m[3]=M*-q+B*W)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(n){const s=u.ab(n,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==s&&(this._unmodified=!1,this._pitchInRadians=s,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(n){const s=n/180*Math.PI;this._rollInRadians!==s&&(this._unmodified=!1,this._rollInRadians=s,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return u.aJ(this._fovInRadians)}setFov(n){n=u.ab(n,.1,150),this.fov!==n&&(this._unmodified=!1,this._fovInRadians=u.aa(n),this._calcMatrices())}get zoom(){return this._zoom}setZoom(n){const s=this.getConstrained(this._center,n).zoom;this._zoom!==s&&(this._unmodified=!1,this._zoom=s,this._tileZoom=Math.max(0,Math.floor(s)),this._scale=u.aG(s),this._constrain(),this._calcMatrices())}get center(){return this._center}setCenter(n){n.lat===this._center.lat&&n.lng===this._center.lng||(this._unmodified=!1,this._center=n,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(n){n!==this._elevation&&(this._elevation=n,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(n){this._edgeInsets.equals(n)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,n,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(n,s){this._autoCalculateNearFarZ=!1,this._nearZ=n,this._farZ=s,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(n){return this._edgeInsets.equals(n)}interpolatePadding(n,s,m){this._unmodified=!1,this._edgeInsets.interpolate(n,s,m),this._constrain(),this._calcMatrices()}resize(n,s,m=!0){this._width=n,this._height=s,m&&this._constrain(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new Wi([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(n){n?(this._lngRange=[n.getWest(),n.getEast()],this._latRange=[n.getSouth(),n.getNorth()],this._constrain()):(this._lngRange=null,this._latRange=[-85.051129,u.aF])}getConstrained(n,s){return this._callbacks.getConstrained(n,s)}getCameraQueryGeometry(n,s){if(s.length===1)return[s[0],n];{let m=n.x,y=n.y,b=n.x,I=n.y;for(const M of s)m=Math.min(m,M.x),y=Math.min(y,M.y),b=Math.max(b,M.x),I=Math.max(I,M.y);return[new u.P(m,y),new u.P(b,y),new u.P(b,I),new u.P(m,I),new u.P(m,y)]}}_constrain(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const n=this._unmodified,{center:s,zoom:m}=this.getConstrained(this.center,this.zoom);this.setCenter(s),this.setZoom(m),this._unmodified=n,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let n=u.aq(new Float64Array(16));u.K(n,n,[this._width/2,-this._height/2,1]),u.J(n,n,[1,-1,0]),this._clipSpaceToPixelsMatrix=n,n=u.aq(new Float64Array(16)),u.K(n,n,[1,-1,1]),u.J(n,n,[-1,-1,0]),u.K(n,n,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=n,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(n,s,m,y){const b=m!==void 0?m:this.bearing,I=y=y!==void 0?y:this.pitch,M=u.Y.fromLngLat(n,s),z=-Math.cos(u.aa(I)),B=Math.sin(u.aa(I)),q=B*Math.sin(u.aa(b)),W=-B*Math.cos(u.aa(b));let K=this.elevation;const oe=s-K;let le;z*oe>=0||Math.abs(z)<.1?(le=1e4,K=s+le*z):le=-oe/z;let we,ge,Te=u.aK(1,M.y),Ie=0;do{if(Ie+=1,Ie>10)break;ge=le/Te,we=new u.Y(M.x+q*ge,M.y+W*ge),Te=1/we.meterInMercatorCoordinateUnits()}while(Math.abs(le-ge*Te)>1e-12);return{center:we.toLngLat(),elevation:K,zoom:u.a8(this.height/2/Math.tan(this.fovInRadians/2)/ge/this.tileSize)}}recalculateZoomAndCenter(n){if(this.elevation-n==0)return;const s=u.aH(1,this.center.lat)*this.worldSize,m=this.cameraToCenterDistance/s,y=u.Y.fromLngLat(this.center,this.elevation),b=Er(this.center,this.elevation,this.pitch,this.bearing,m);this._elevation=n;const I=this.calculateCenterFromCameraLngLatAlt(b.toLngLat(),u.aK(b.z,y.y),this.bearing,this.pitch);this._elevation=I.elevation,this._center=I.center,this.setZoom(I.zoom)}getCameraPoint(){const n=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new u.P(n*Math.sin(this.rollInRadians),n*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const n=u.aH(1,this.center.lat)*this.worldSize;return Er(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/n).toLngLat()}getMercatorTileCoordinates(n){if(!n)return[0,0,1,1];const s=n.canonical.z>=0?1<<n.canonical.z:Math.pow(2,n.canonical.z);return[n.canonical.x/s,n.canonical.y/s,1/s/u.X,1/s/u.X]}}class Bn{constructor(n,s){this.min=n,this.max=s,this.center=u.aL([],u.aM([],this.min,this.max),.5)}quadrant(n){const s=[n%2==0,n<2],m=u.aN(this.min),y=u.aN(this.max);for(let b=0;b<s.length;b++)m[b]=s[b]?this.min[b]:this.center[b],y[b]=s[b]?this.center[b]:this.max[b];return y[2]=this.max[2],new Bn(m,y)}distanceX(n){return Math.max(Math.min(this.max[0],n[0]),this.min[0])-n[0]}distanceY(n){return Math.max(Math.min(this.max[1],n[1]),this.min[1])-n[1]}intersectsFrustum(n){let s=!0;for(let m=0;m<n.planes.length;m++){const y=this.intersectsPlane(n.planes[m]);if(y===0)return 0;y===1&&(s=!1)}return s?2:n.aabb.min[0]>this.max[0]||n.aabb.min[1]>this.max[1]||n.aabb.min[2]>this.max[2]||n.aabb.max[0]<this.min[0]||n.aabb.max[1]<this.min[1]||n.aabb.max[2]<this.min[2]?0:1}intersectsPlane(n){let s=n[3],m=n[3];for(let y=0;y<3;y++)n[y]>0?(s+=n[y]*this.min[y],m+=n[y]*this.max[y]):(m+=n[y]*this.min[y],s+=n[y]*this.max[y]);return s>=0?2:m<0?0:1}}class po{distanceToTile2d(n,s,m,y){const b=y.distanceX([n,s]),I=y.distanceY([n,s]);return Math.hypot(b,I)}getWrap(n,s,m){return m}getTileAABB(n,s,m,y){var b,I;let M=m,z=m;if(y.terrain){const q=new u.S(n.z,s,n.z,n.x,n.y),W=y.terrain.getMinMaxElevation(q);M=(b=W.minElevation)!==null&&b!==void 0?b:m,z=(I=W.maxElevation)!==null&&I!==void 0?I:m}const B=1<<n.z;return new Bn([s+n.x/B,n.y/B,M],[s+(n.x+1)/B,(n.y+1)/B,z])}allowVariableZoom(n,s){const m=n.fov*(Math.abs(Math.cos(n.rollInRadians))*n.height+Math.abs(Math.sin(n.rollInRadians))*n.width)/n.height,y=u.ab(78.5-m/2,0,60);return!!s.terrain||n.pitch>y||n.padding.top>=.1}allowWorldCopies(){return!0}recalculateCache(){}}class wr{constructor(n,s,m){this.points=n,this.planes=s,this.aabb=m}static fromInvProjectionMatrix(n,s=1,m=0){const y=Math.pow(2,m),b=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(B=>{const q=1/(B=u.al([],B,n))[3]/s*y;return u.aO(B,B,[q,q,1/B[3],q])}),I=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(B=>{const q=u.aP([],b[B[0]],b[B[1]]),W=u.aP([],b[B[2]],b[B[1]]),K=u.aQ([],u.aR([],q,W)),oe=-u.aS(K,b[B[1]]);return K.concat(oe)}),M=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],z=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const B of b)for(let q=0;q<3;q++)M[q]=Math.min(M[q],B[q]),z[q]=Math.max(z[q],B[q]);return new wr(b,I,new Bn(M,z))}}class fo{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(n){this._helper.setMinZoom(n)}setMaxZoom(n){this._helper.setMaxZoom(n)}setMinPitch(n){this._helper.setMinPitch(n)}setMaxPitch(n){this._helper.setMaxPitch(n)}setRenderWorldCopies(n){this._helper.setRenderWorldCopies(n)}setBearing(n){this._helper.setBearing(n)}setPitch(n){this._helper.setPitch(n)}setRoll(n){this._helper.setRoll(n)}setFov(n){this._helper.setFov(n)}setZoom(n){this._helper.setZoom(n)}setCenter(n){this._helper.setCenter(n)}setElevation(n){this._helper.setElevation(n)}setMinElevationForCurrentTile(n){this._helper.setMinElevationForCurrentTile(n)}setPadding(n){this._helper.setPadding(n)}interpolatePadding(n,s,m){return this._helper.interpolatePadding(n,s,m)}isPaddingEqual(n){return this._helper.isPaddingEqual(n)}resize(n,s,m=!0){this._helper.resize(n,s,m)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(n){this._helper.setMaxBounds(n)}overrideNearFarZ(n,s){this._helper.overrideNearFarZ(n,s)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(n){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),n)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(n,s){}constructor(n,s,m,y,b){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this._helper=new Zr({calcMatrices:()=>{this._calcMatrices()},getConstrained:(I,M)=>this.getConstrained(I,M)},n,s,m,y,b),this._coveringTilesDetailsProvider=new po}clone(){const n=new fo;return n.apply(this),n}apply(n,s,m){this._helper.apply(n,s,m)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(n){const s=[new u.aT(0,n)];if(this._helper._renderWorldCopies){const m=this.screenPointToMercatorCoordinate(new u.P(0,0)),y=this.screenPointToMercatorCoordinate(new u.P(this._helper._width,0)),b=this.screenPointToMercatorCoordinate(new u.P(this._helper._width,this._helper._height)),I=this.screenPointToMercatorCoordinate(new u.P(0,this._helper._height)),M=Math.floor(Math.min(m.x,y.x,b.x,I.x)),z=Math.floor(Math.max(m.x,y.x,b.x,I.x)),B=1;for(let q=M-B;q<=z+B;q++)q!==0&&s.push(new u.aT(q,n))}return s}getCameraFrustum(){return wr.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(n){const s=this.screenPointToLocation(this.centerPoint,n),m=n?n.getElevationForLngLatZoom(s,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(m)}setLocationAtPoint(n,s){const m=u.aH(this.elevation,this.center.lat),y=this.screenPointToMercatorCoordinateAtZ(s,m),b=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,m),I=u.Y.fromLngLat(n),M=new u.Y(I.x-(y.x-b.x),I.y-(y.y-b.y));this.setCenter(M?.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(n,s){return s?this.coordinatePoint(u.Y.fromLngLat(n),s.getElevationForLngLatZoom(n,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(u.Y.fromLngLat(n))}screenPointToLocation(n,s){var m;return(m=this.screenPointToMercatorCoordinate(n,s))===null||m===void 0?void 0:m.toLngLat()}screenPointToMercatorCoordinate(n,s){if(s){const m=s.pointCoordinate(n);if(m!=null)return m}return this.screenPointToMercatorCoordinateAtZ(n)}screenPointToMercatorCoordinateAtZ(n,s){const m=s||0,y=[n.x,n.y,0,1],b=[n.x,n.y,1,1];u.al(y,y,this._pixelMatrixInverse),u.al(b,b,this._pixelMatrixInverse);const I=y[3],M=b[3],z=y[1]/I,B=b[1]/M,q=y[2]/I,W=b[2]/M,K=q===W?0:(m-q)/(W-q);return new u.Y(u.y.number(y[0]/I,b[0]/M,K)/this.worldSize,u.y.number(z,B,K)/this.worldSize,m)}coordinatePoint(n,s=0,m=this._pixelMatrix){const y=[n.x*this.worldSize,n.y*this.worldSize,s,1];return u.al(y,y,m),new u.P(y[0]/y[3],y[1]/y[3])}getBounds(){const n=Math.max(0,this._helper._height/2-zi(this));return new Wi().extend(this.screenPointToLocation(new u.P(0,n))).extend(this.screenPointToLocation(new u.P(this._helper._width,n))).extend(this.screenPointToLocation(new u.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new u.P(0,this._helper._height)))}isPointOnMapSurface(n,s){return s?s.pointCoordinate(n)!=null:n.y>this.height/2-zi(this)}calculatePosMatrix(n,s=!1,m){var y;const b=(y=n.key)!==null&&y!==void 0?y:u.aU(n.wrap,n.canonical.z,n.canonical.z,n.canonical.x,n.canonical.y),I=s?this._alignedPosMatrixCache:this._posMatrixCache;if(I.has(b)){const B=I.get(b);return m?B.f32:B.f64}const M=Is(n,this.worldSize);u.L(M,s?this._alignedProjMatrix:this._viewProjMatrix,M);const z={f64:M,f32:new Float32Array(M)};return I.set(b,z),m?z.f32:z.f64}calculateFogMatrix(n){const s=n.key,m=this._fogMatrixCacheF32;if(m.has(s))return m.get(s);const y=Is(n,this.worldSize);return u.L(y,this._fogMatrix,y),m.set(s,new Float32Array(y)),m.get(s)}getConstrained(n,s){s=u.ab(+s,this.minZoom,this.maxZoom);const m={center:new u.N(n.lng,n.lat),zoom:s};let y=this._helper._lngRange;this._helper._renderWorldCopies||y!==null||(y=[-179.9999999999,180-1e-10]);const b=this.tileSize*u.aG(m.zoom);let I=0,M=b,z=0,B=b,q=0,W=0;const{x:K,y:oe}=this.size;if(this._helper._latRange){const Re=this._helper._latRange;I=u.Q(Re[1])*b,M=u.Q(Re[0])*b,M-I<oe&&(q=oe/(M-I))}y&&(z=u.aI(u.O(y[0])*b,0,b),B=u.aI(u.O(y[1])*b,0,b),B<z&&(B+=b),B-z<K&&(W=K/(B-z)));const{x:le,y:we}=_n(b,n);let ge,Te;const Ie=Math.max(W||0,q||0);if(Ie){const Re=new u.P(W?(B+z)/2:le,q?(M+I)/2:we);return m.center=Ei(b,Re).wrap(),m.zoom+=u.a8(Ie),m}if(this._helper._latRange){const Re=oe/2;we-Re<I&&(Te=I+Re),we+Re>M&&(Te=M-Re)}if(y){const Re=(z+B)/2;let ze=le;this._helper._renderWorldCopies&&(ze=u.aI(le,Re-b/2,Re+b/2));const Fe=K/2;ze-Fe<z&&(ge=z+Fe),ze+Fe>B&&(ge=B-Fe)}if(ge!==void 0||Te!==void 0){const Re=new u.P(ge??le,Te??we);m.center=Ei(b,Re).wrap()}return m}calculateCenterFromCameraLngLatAlt(n,s,m,y){return this._helper.calculateCenterFromCameraLngLatAlt(n,s,m,y)}_calculateNearFarZIfNeeded(n,s,m){if(!this._helper.autoCalculateNearFarZ)return;const y=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),b=n-y*this._helper._pixelPerMeter/Math.cos(s),I=y<0?b:n,M=Math.PI/2+this.pitchInRadians,z=u.aa(this.fov)*(Math.abs(Math.cos(u.aa(this.roll)))*this.height+Math.abs(Math.sin(u.aa(this.roll)))*this.width)/this.height*(.5+m.y/this.height),B=Math.sin(z)*I/Math.sin(u.ab(Math.PI-M-z,.01,Math.PI-.01)),q=zi(this),W=Math.atan(q/this._helper.cameraToCenterDistance),K=u.aa(.75),oe=W>K?2*W*(.5+m.y/(2*q)):K,le=Math.sin(oe)*I/Math.sin(u.ab(Math.PI-M-oe,.01,Math.PI-.01)),we=Math.min(B,le);this._helper._farZ=1.01*(Math.cos(Math.PI/2-s)*we+I),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const n=this.centerOffset,s=_n(this.worldSize,this.center),m=s.x,y=s.y;this._helper._pixelPerMeter=u.aH(1,this.center.lat)*this.worldSize;const b=u.aa(Math.min(this.pitch,89.25)),I=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(b));let M;this._calculateNearFarZIfNeeded(I,b,n),M=new Float64Array(16),u.aV(M,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),u.an(this._invProjMatrix,M),M[8]=2*-n.x/this._helper._width,M[9]=2*n.y/this._helper._height,this._projectionMatrix=u.aW(M),u.K(M,M,[1,-1,1]),u.J(M,M,[0,0,-this._helper.cameraToCenterDistance]),u.aX(M,M,-this.rollInRadians),u.aY(M,M,this.pitchInRadians),u.aX(M,M,-this.bearingInRadians),u.J(M,M,[-m,-y,0]),this._mercatorMatrix=u.K([],M,[this.worldSize,this.worldSize,this.worldSize]),u.K(M,M,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=u.L(new Float64Array(16),this.clipSpaceToPixelsMatrix,M),u.J(M,M,[0,0,-this.elevation]),this._viewProjMatrix=M,this._invViewProjMatrix=u.an([],M);const z=[0,0,-1,1];u.al(z,z,this._invViewProjMatrix),this._cameraPosition=[z[0]/z[3],z[1]/z[3],z[2]/z[3]],this._fogMatrix=new Float64Array(16),u.aV(this._fogMatrix,this.fovInRadians,this.width/this.height,I,this._helper._farZ),this._fogMatrix[8]=2*-n.x/this.width,this._fogMatrix[9]=2*n.y/this.height,u.K(this._fogMatrix,this._fogMatrix,[1,-1,1]),u.J(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),u.aX(this._fogMatrix,this._fogMatrix,-this.rollInRadians),u.aY(this._fogMatrix,this._fogMatrix,this.pitchInRadians),u.aX(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),u.J(this._fogMatrix,this._fogMatrix,[-m,-y,0]),u.K(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),u.J(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=u.L(new Float64Array(16),this.clipSpaceToPixelsMatrix,M);const B=this._helper._width%2/2,q=this._helper._height%2/2,W=Math.cos(this.bearingInRadians),K=Math.sin(-this.bearingInRadians),oe=m-Math.round(m)+W*B+K*q,le=y-Math.round(y)+W*q+K*B,we=new Float64Array(M);if(u.J(we,we,[oe>.5?oe-1:oe,le>.5?le-1:le,0]),this._alignedProjMatrix=we,M=u.an(new Float64Array(16),this._pixelMatrix),!M)throw new Error("failed to invert matrix");this._pixelMatrixInverse=M,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const n=this.screenPointToMercatorCoordinate(new u.P(0,0)),s=[n.x*this.worldSize,n.y*this.worldSize,0,1];return u.al(s,s,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const n=u.aH(1,this.center.lat)*this.worldSize;return Er(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/n).toLngLat()}lngLatToCameraDepth(n,s){const m=u.Y.fromLngLat(n),y=[m.x*this.worldSize,m.y*this.worldSize,s,1];return u.al(y,y,this._viewProjMatrix),y[2]/y[3]}getProjectionData(n){const{overscaledTileID:s,aligned:m,applyTerrainMatrix:y}=n,b=this._helper.getMercatorTileCoordinates(s),I=s?this.calculatePosMatrix(s,m,!0):null;let M;return M=s&&s.terrainRttPosMatrix32f&&y?s.terrainRttPosMatrix32f:I||u.aZ(),{mainMatrix:M,tileMercatorCoords:b,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:M}}isLocationOccluded(n){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(n,s,m){return 1}transformLightDirection(n){return u.aN(n)}getRayDirectionFromPixel(n){throw new Error("Not implemented.")}projectTileCoordinates(n,s,m,y){const b=this.calculatePosMatrix(m);let I;y?(I=[n,s,y(n,s),1],u.al(I,I,b)):(I=[n,s,0,1],xi(I,I,b));const M=I[3];return{point:new u.P(I[0]/M,I[1]/M),signedDistanceFromCamera:M,isOccluded:!1}}populateCache(n){for(const s of n)this.calculatePosMatrix(s)}getMatrixForModel(n,s){const m=u.Y.fromLngLat(n,s),y=m.meterInMercatorCoordinateUnits(),b=u.a_();return u.J(b,b,[m.x,m.y,m.z]),u.aX(b,b,Math.PI),u.aY(b,b,Math.PI/2),u.K(b,b,[-y,y,y]),b}getProjectionDataForCustomLayer(n=!0){const s=new u.S(0,0,0,0,0),m=this.getProjectionData({overscaledTileID:s,applyGlobeMatrix:n}),y=Is(s,this.worldSize);u.L(y,this._viewProjMatrix,y),m.tileMercatorCoords=[0,0,1,1];const b=[u.X,u.X,this.worldSize/this._helper.pixelsPerMeter],I=u.a$();return u.K(I,y,b),m.fallbackMatrix=I,m.mainMatrix=I,m}getFastPathSimpleProjectionMatrix(n){return this.calculatePosMatrix(n)}}function hn(){u.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function Pr(w){if(w.useSlerp)if(w.k<1){const n=u.b0(w.startEulerAngles.roll,w.startEulerAngles.pitch,w.startEulerAngles.bearing),s=u.b0(w.endEulerAngles.roll,w.endEulerAngles.pitch,w.endEulerAngles.bearing),m=new Float64Array(4);u.b1(m,n,s,w.k);const y=u.b2(m);w.tr.setRoll(y.roll),w.tr.setPitch(y.pitch),w.tr.setBearing(y.bearing)}else w.tr.setRoll(w.endEulerAngles.roll),w.tr.setPitch(w.endEulerAngles.pitch),w.tr.setBearing(w.endEulerAngles.bearing);else w.tr.setRoll(u.y.number(w.startEulerAngles.roll,w.endEulerAngles.roll,w.k)),w.tr.setPitch(u.y.number(w.startEulerAngles.pitch,w.endEulerAngles.pitch,w.k)),w.tr.setBearing(u.y.number(w.startEulerAngles.bearing,w.endEulerAngles.bearing,w.k))}function si(w,n,s,m,y){const b=y.padding,I=_n(y.worldSize,s.getNorthWest()),M=_n(y.worldSize,s.getNorthEast()),z=_n(y.worldSize,s.getSouthEast()),B=_n(y.worldSize,s.getSouthWest()),q=u.aa(-m),W=I.rotate(q),K=M.rotate(q),oe=z.rotate(q),le=B.rotate(q),we=new u.P(Math.max(W.x,K.x,le.x,oe.x),Math.max(W.y,K.y,le.y,oe.y)),ge=new u.P(Math.min(W.x,K.x,le.x,oe.x),Math.min(W.y,K.y,le.y,oe.y)),Te=we.sub(ge),Ie=(y.width-(b.left+b.right+n.left+n.right))/Te.x,Re=(y.height-(b.top+b.bottom+n.top+n.bottom))/Te.y;if(Re<0||Ie<0)return void hn();const ze=Math.min(u.a8(y.scale*Math.min(Ie,Re)),w.maxZoom),Fe=u.P.convert(w.offset),Ve=new u.P((n.left-n.right)/2,(n.top-n.bottom)/2).rotate(u.aa(m)),Ne=Fe.add(Ve).mult(y.scale/u.aG(ze));return{center:Ei(y.worldSize,I.add(z).div(2).sub(Ne)),zoom:ze,bearing:m}}class fl{get useGlobeControls(){return!1}handlePanInertia(n,s){return{easingOffset:n,easingCenter:s.center}}handleMapControlsRollPitchBearingZoom(n,s){n.bearingDelta&&s.setBearing(s.bearing+n.bearingDelta),n.pitchDelta&&s.setPitch(s.pitch+n.pitchDelta),n.rollDelta&&s.setRoll(s.roll+n.rollDelta),n.zoomDelta&&s.setZoom(s.zoom+n.zoomDelta)}handleMapControlsPan(n,s,m){n.around.distSqr(s.centerPoint)<.01||s.setLocationAtPoint(m,n.around)}cameraForBoxAndBearing(n,s,m,y,b){return si(n,s,m,y,b)}handleJumpToCenterZoom(n,s){n.zoom!==(s.zoom!==void 0?+s.zoom:n.zoom)&&n.setZoom(+s.zoom),s.center!==void 0&&n.setCenter(u.N.convert(s.center))}handleEaseTo(n,s){const m=n.zoom,y=n.padding,b={roll:n.roll,pitch:n.pitch,bearing:n.bearing},I={roll:s.roll===void 0?n.roll:s.roll,pitch:s.pitch===void 0?n.pitch:s.pitch,bearing:s.bearing===void 0?n.bearing:s.bearing},M=s.zoom!==void 0,z=!n.isPaddingEqual(s.padding);let B=!1;const q=M?+s.zoom:n.zoom;let W=n.centerPoint.add(s.offsetAsPoint);const K=n.screenPointToLocation(W),{center:oe,zoom:le}=n.getConstrained(u.N.convert(s.center||K),q??m);xr(n,oe);const we=_n(n.worldSize,K),ge=_n(n.worldSize,oe).sub(we),Te=u.aG(le-m);return B=le!==m,{easeFunc:Ie=>{if(B&&n.setZoom(u.y.number(m,le,Ie)),u.b3(b,I)||Pr({startEulerAngles:b,endEulerAngles:I,tr:n,k:Ie,useSlerp:b.roll!=I.roll}),z&&(n.interpolatePadding(y,s.padding,Ie),W=n.centerPoint.add(s.offsetAsPoint)),s.around)n.setLocationAtPoint(s.around,s.aroundPoint);else{const Re=u.aG(n.zoom-m),ze=le>m?Math.min(2,Te):Math.max(.5,Te),Fe=Math.pow(ze,1-Ie),Ve=Ei(n.worldSize,we.add(ge.mult(Ie*Fe)).mult(Re));n.setLocationAtPoint(n.renderWorldCopies?Ve.wrap():Ve,W)}},isZooming:B,elevationCenter:oe}}handleFlyTo(n,s){const m=s.zoom!==void 0,y=n.zoom,b=n.getConstrained(u.N.convert(s.center||s.locationAtOffset),m?+s.zoom:y),I=b.center,M=b.zoom;xr(n,I);const z=_n(n.worldSize,s.locationAtOffset),B=_n(n.worldSize,I).sub(z),q=B.mag(),W=u.aG(M-y);let K;if(s.minZoom!==void 0){const oe=Math.min(+s.minZoom,y,M),le=n.getConstrained(I,oe).zoom;K=u.aG(le-y)}return{easeFunc:(oe,le,we,ge)=>{n.setZoom(oe===1?M:y+u.a8(le));const Te=oe===1?I:Ei(n.worldSize,z.add(B.mult(we)).mult(le));n.setLocationAtPoint(n.renderWorldCopies?Te.wrap():Te,ge)},scaleOfZoom:W,targetCenter:I,scaleOfMinZoom:K,pixelPathLength:q}}}class Kn{constructor(n,s,m){this.blendFunction=n,this.blendColor=s,this.mask=m}}Kn.Replace=[1,0],Kn.disabled=new Kn(Kn.Replace,u.b4.transparent,[!1,!1,!1,!1]),Kn.unblended=new Kn(Kn.Replace,u.b4.transparent,[!0,!0,!0,!0]),Kn.alphaBlended=new Kn([1,771],u.b4.transparent,[!0,!0,!0,!0]);const ba=2305;class Wn{constructor(n,s,m){this.enable=n,this.mode=s,this.frontFace=m}}Wn.disabled=new Wn(!1,1029,ba),Wn.backCCW=new Wn(!0,1029,ba),Wn.frontCCW=new Wn(!0,1028,ba);class xn{constructor(n,s,m){this.func=n,this.mask=s,this.range=m}}xn.ReadOnly=!1,xn.ReadWrite=!0,xn.disabled=new xn(519,xn.ReadOnly,[0,1]);const os=7680;class Hn{constructor(n,s,m,y,b,I){this.test=n,this.ref=s,this.mask=m,this.fail=y,this.depthFail=b,this.pass=I}}Hn.disabled=new Hn({func:519,mask:0},0,0,os,os,os);const gi=new WeakMap;function Xi(w){var n;if(gi.has(w))return gi.get(w);{const s=(n=w.getParameter(w.VERSION))===null||n===void 0?void 0:n.startsWith("WebGL 2.0");return gi.set(w,s),s}}class Vo{get awaitingQuery(){return!!this._readbackQueue}constructor(n){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=n;const s=n.context,m=s.gl;this._texFormat=m.RGBA,this._texType=m.UNSIGNED_BYTE;const y=new u.aC;y.emplaceBack(-1,-1),y.emplaceBack(2,-1),y.emplaceBack(-1,2);const b=new u.aE;b.emplaceBack(0,1,2),this._fullscreenTriangle=new ho(s.createVertexBuffer(y,kn.members),s.createIndexBuffer(b),u.aD.simpleSegment(0,0,y.length,b.length)),this._resultBuffer=new Uint8Array(4),s.activeTexture.set(m.TEXTURE1);const I=m.createTexture();m.bindTexture(m.TEXTURE_2D,I),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,m.CLAMP_TO_EDGE),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,m.CLAMP_TO_EDGE),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,m.NEAREST),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,m.NEAREST),m.texImage2D(m.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=s.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(I),Xi(m)&&(this._pbo=m.createBuffer(),m.bindBuffer(m.PIXEL_PACK_BUFFER,this._pbo),m.bufferData(m.PIXEL_PACK_BUFFER,4,m.STREAM_READ),m.bindBuffer(m.PIXEL_PACK_BUFFER,null))}destroy(){const n=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),n.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(n,s){const m=this._updateCount;return this._readbackQueue?m>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():m>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(n,s),this._updateCount++,this._measuredError}_bindFramebuffer(){const n=this._cachedRenderContext.context,s=n.gl;n.activeTexture.set(s.TEXTURE1),s.bindTexture(s.TEXTURE_2D,this._fbo.colorAttachment.get()),n.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(n,s){const m=this._cachedRenderContext.context,y=m.gl;if(this._bindFramebuffer(),m.viewport.set([0,0,this._texWidth,this._texHeight]),m.clear({color:u.b4.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(m,y.TRIANGLES,xn.disabled,Hn.disabled,Kn.unblended,Wn.disabled,((b,I)=>({u_input:b,u_output_expected:I}))(n,s),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&Xi(y)){y.bindBuffer(y.PIXEL_PACK_BUFFER,this._pbo),y.readBuffer(y.COLOR_ATTACHMENT0),y.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),y.bindBuffer(y.PIXEL_PACK_BUFFER,null);const b=y.fenceSync(y.SYNC_GPU_COMMANDS_COMPLETE,0);y.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:b}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const n=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&Xi(n)){const s=n.clientWaitSync(this._readbackQueue.sync,0,0);if(s===n.WAIT_FAILED)return u.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(s===n.TIMEOUT_EXPIRED)return;n.bindBuffer(n.PIXEL_PACK_BUFFER,this._pbo),n.getBufferSubData(n.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),n.bindBuffer(n.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),n.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=Vo._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(n){let s=0;return s+=n[0]/256,s+=n[1]/65536,s+=n[2]/16777216,n[3]<127&&(s=-s),s/128}}const ss=u.X/128;function ji(w,n){const s=w.granularity!==void 0?Math.max(w.granularity,1):1,m=s+(w.generateBorders?2:0),y=s+(w.extendToNorthPole||w.generateBorders?1:0)+(w.extendToSouthPole||w.generateBorders?1:0),b=m+1,I=y+1,M=w.generateBorders?-1:0,z=w.generateBorders||w.extendToNorthPole?-1:0,B=s+(w.generateBorders?1:0),q=s+(w.generateBorders||w.extendToSouthPole?1:0),W=b*I,K=m*y*6,oe=b*I>65536;if(oe&&n==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const le=oe||n==="32bit",we=new Int16Array(2*W);let ge=0;for(let Re=z;Re<=q;Re++)for(let ze=M;ze<=B;ze++){let Fe=ze/s*u.X;ze===-1&&(Fe=-64),ze===s+1&&(Fe=u.X+ss);let Ve=Re/s*u.X;Re===-1&&(Ve=w.extendToNorthPole?u.b6:-64),Re===s+1&&(Ve=w.extendToSouthPole?u.b7:u.X+ss),we[ge++]=Fe,we[ge++]=Ve}const Te=le?new Uint32Array(K):new Uint16Array(K);let Ie=0;for(let Re=0;Re<y;Re++)for(let ze=0;ze<m;ze++){const Fe=ze+1+Re*b,Ve=ze+(Re+1)*b,Ne=ze+1+(Re+1)*b;Te[Ie++]=ze+Re*b,Te[Ie++]=Ve,Te[Ie++]=Fe,Te[Ie++]=Fe,Te[Ie++]=Ve,Te[Ie++]=Ne}return{vertices:we.buffer.slice(0),indices:Te.buffer.slice(0),uses32bitIndices:le}}const Ta=new u.aB({fill:new u.b8(128,2),line:new u.b8(512,0),tile:new u.b8(128,32),stencil:new u.b8(128,1),circle:3});class ml{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return Sr.projectionGlobe}get vertexShaderPreludeCode(){return Sr.projectionMercator.vertexSource}get subdivisionGranularity(){return Ta}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(n){this._errorMeasurement||(this._errorMeasurement=new Vo(n));const s=u.Q(this._errorQueryLatitudeDegrees),m=2*Math.atan(Math.exp(Math.PI-s*Math.PI*2))-.5*Math.PI,y=this._errorMeasurement.updateErrorLoop(s,m),b=re.now();y!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=y,this._errorMeasurementLastChangeTime=b);const I=Math.min(Math.max((b-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=u.b9(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,u.ba(I))}_getMeshKey(n){return`${n.granularity.toString(36)}_${n.generateBorders?"b":""}${n.extendToNorthPole?"n":""}${n.extendToSouthPole?"s":""}`}getMeshFromTileID(n,s,m,y,b){const I=(b==="stencil"?Ta.stencil:Ta.tile).getGranularityForZoomLevel(s.z);return this._getMesh(n,{granularity:I,generateBorders:m,extendToNorthPole:s.y===0&&y,extendToSouthPole:s.y===(1<<s.z)-1&&y})}_getMesh(n,s){const m=this._getMeshKey(s);if(m in this._tileMeshCache)return this._tileMeshCache[m];const y=function(b,I){const M=ji(I,"16bit"),z=u.aC.deserialize({arrayBuffer:M.vertices,length:M.vertices.byteLength/2/2}),B=u.aE.deserialize({arrayBuffer:M.indices,length:M.indices.byteLength/2/3});return new ho(b.createVertexBuffer(z,kn.members),b.createIndexBuffer(B),u.aD.simpleSegment(0,0,z.length,B.length))}(n,s);return this._tileMeshCache[m]=y,y}recalculate(n){}hasTransition(){const n=re.now();let s=!1;return s=s||(n-this._errorMeasurementLastChangeTime)/1e3<.7,s=s||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,s}setErrorQueryLatitudeDegrees(n){this._errorQueryLatitudeDegrees=n}}const qa=new u.q({type:new u.D(u.v.projection.type)});class Ga extends u.E{constructor(n){super(),this._transitionable=new u.T(qa),this.setProjection(n),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new u.z(0)),this._mercatorProjection=new Gr,this._verticalPerspectiveProjection=new ml}get transitionState(){const n=this.properties.get("type");if(typeof n=="string"&&n==="mercator")return 0;if(typeof n=="string"&&n==="vertical-perspective")return 1;if(n instanceof u.bb){if(n.from==="vertical-perspective"&&n.to==="mercator")return 1-n.transition;if(n.from==="mercator"&&n.to==="vertical-perspective")return n.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(n){this._mercatorProjection.updateGPUdependent(n),this._verticalPerspectiveProjection.updateGPUdependent(n)}getMeshFromTileID(n,s,m,y,b){return this.currentProjection.getMeshFromTileID(n,s,m,y,b)}setProjection(n){this._transitionable.setValue("type",n?.type||"mercator")}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}setErrorQueryLatitudeDegrees(n){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(n),this._mercatorProjection.setErrorQueryLatitudeDegrees(n)}}function ei(w){const n=mr(w.worldSize,w.center.lat);return 2*Math.PI*n}function to(w,n,s,m,y){const b=1/(1<<y),I=n/u.X*b+m*b,M=u.bd((w/u.X*b+s*b)*Math.PI*2+Math.PI,2*Math.PI),z=2*Math.atan(Math.exp(Math.PI-I*Math.PI*2))-.5*Math.PI,B=Math.cos(z),q=new Float64Array(3);return q[0]=Math.sin(M)*B,q[1]=Math.sin(z),q[2]=Math.cos(M)*B,q}function qn(w){return function(n,s){const m=Math.cos(s),y=new Float64Array(3);return y[0]=Math.sin(n)*m,y[1]=Math.sin(s),y[2]=Math.cos(n)*m,y}(w.lng*Math.PI/180,w.lat*Math.PI/180)}function mr(w,n){return w/(2*Math.PI)/Math.cos(n*Math.PI/180)}function mo(w){const n=Math.asin(w[1])/Math.PI*180,s=Math.sqrt(w[0]*w[0]+w[2]*w[2]);if(s>1e-6){const m=w[0]/s,y=Math.acos(w[2]/s),b=(m>0?y:-y)/Math.PI*180;return new u.N(u.aI(b,-180,180),n)}return new u.N(0,n)}function Ps(w){return Math.cos(w*Math.PI/180)}function Ii(w,n){const s=Ps(w),m=Ps(n);return u.a8(m/s)}function Vl(w,n){const s=w.rotate(n.bearingInRadians),m=n.zoom+Ii(n.center.lat,0),y=u.b9(1/Ps(n.center.lat),1/Ps(Math.min(Math.abs(n.center.lat),60)),u.bc(m,7,3,0,1)),b=360/ei({worldSize:n.worldSize,center:{lat:n.center.lat}});return new u.N(n.center.lng-s.x*b*y,u.ab(n.center.lat+s.y*b,-85.051129,u.aF))}function or(w){const n=.5*w,s=Math.sin(n),m=Math.cos(n);return Math.log(s+m)-Math.log(m-s)}function Cs(w,n,s,m){const y=w.lat+s*m;if(Math.abs(s)>1){const b=(Math.sign(w.lat+s)!==Math.sign(w.lat)?-Math.abs(w.lat):Math.abs(w.lat))*Math.PI/180,I=Math.abs(w.lat+s)*Math.PI/180,M=or(b+m*(I-b)),z=or(b),B=or(I);return new u.N(w.lng+n*((M-z)/(B-z)),y)}return new u.N(w.lng+n*m,y)}class vu{constructor(n){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._aabbFactory=n}recalculateCache(){if(!this._hadAnyChanges)return;const n=this._cachePrevious;this._cachePrevious=this._cache,this._cache=n,this._cache.clear(),this._hadAnyChanges=!1}getTileAABB(n,s,m,y){const b=`${n.z}_${n.x}_${n.y}`,I=this._cache.get(b);if(I)return I;const M=this._cachePrevious.get(b);if(M)return this._cache.set(b,M),M;const z=this._aabbFactory(n,s,m,y);return this._cache.set(b,z),this._hadAnyChanges=!0,z}}function So(w,n,s){const m=w-n;return m<0?-m:Math.max(0,m-s)}function $u(w,n,s,m,y){const b=w-s;let I;return I=b<0?Math.min(-b,1+b-y):b>1?Math.min(Math.max(b-y,0),1-b):0,Math.max(I,So(n,m,y))}class Eo{constructor(){this._aabbCache=new vu(this._computeTileAABB)}recalculateCache(){this._aabbCache.recalculateCache()}distanceToTile2d(n,s,m,y){const b=1<<m.z,I=1/b,M=m.x/b,z=m.y/b;let B=2;return B=Math.min(B,$u(n,s,M,z,I)),B=Math.min(B,$u(n,s,M+.5,-z-I,I)),B=Math.min(B,$u(n,s,M+.5,2-z-I,I)),B}getWrap(n,s,m){const y=1<<s.z,b=1/y,I=s.x/y,M=So(n.x,I,b),z=So(n.x,I-1,b),B=So(n.x,I+1,b),q=Math.min(M,z,B);return q===B?1:q===z?-1:0}allowVariableZoom(n,s){return Bo(n,s)>4}allowWorldCopies(){return!1}getTileAABB(n,s,m,y){return this._aabbCache.getTileAABB(n,s,m,y)}_computeTileAABB(n,s,m,y){if(n.z<=0)return new Bn([-1,-1,-1],[1,1,1]);if(n.z===1)return new Bn([n.x===0?-1:0,n.y===0?0:-1,-1],[n.x===0?0:1,n.y===0?1:0,1]);{const b=[to(0,0,n.x,n.y,n.z),to(u.X,0,n.x,n.y,n.z),to(u.X,u.X,n.x,n.y,n.z),to(0,u.X,n.x,n.y,n.z)],I=[1,1,1],M=[-1,-1,-1];for(const z of b)for(let B=0;B<3;B++)I[B]=Math.min(I[B],z[B]),M[B]=Math.max(M[B],z[B]);if(n.y===0||n.y===(1<<n.z)-1){const z=[0,n.y===0?1:-1,0];for(let B=0;B<3;B++)I[B]=Math.min(I[B],z[B]),M[B]=Math.max(M[B],z[B])}return new Bn(I,M)}}}class As{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(n){this._helper.setMinZoom(n)}setMaxZoom(n){this._helper.setMaxZoom(n)}setMinPitch(n){this._helper.setMinPitch(n)}setMaxPitch(n){this._helper.setMaxPitch(n)}setRenderWorldCopies(n){this._helper.setRenderWorldCopies(n)}setBearing(n){this._helper.setBearing(n)}setPitch(n){this._helper.setPitch(n)}setRoll(n){this._helper.setRoll(n)}setFov(n){this._helper.setFov(n)}setZoom(n){this._helper.setZoom(n)}setCenter(n){this._helper.setCenter(n)}setElevation(n){this._helper.setElevation(n)}setMinElevationForCurrentTile(n){this._helper.setMinElevationForCurrentTile(n)}setPadding(n){this._helper.setPadding(n)}interpolatePadding(n,s,m){return this._helper.interpolatePadding(n,s,m)}isPaddingEqual(n){return this._helper.isPaddingEqual(n)}resize(n,s){this._helper.resize(n,s)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(n){this._helper.setMaxBounds(n)}overrideNearFarZ(n,s){this._helper.overrideNearFarZ(n,s)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(n){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),n)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(n){}constructor(){this._cachedClippingPlane=u.be(),this._projectionMatrix=u.a_(),this._globeViewProjMatrix32f=u.aZ(),this._globeViewProjMatrixNoCorrection=u.a_(),this._globeViewProjMatrixNoCorrectionInverted=u.a_(),this._globeProjMatrixInverted=u.a_(),this._cameraPosition=u.bf(),this._globeLatitudeErrorCorrectionRadians=0,this._helper=new Zr({calcMatrices:()=>{this._calcMatrices()},getConstrained:(n,s)=>this.getConstrained(n,s)}),this._coveringTilesDetailsProvider=new Eo}clone(){const n=new As;return n.apply(this),n}apply(n,s){this._globeLatitudeErrorCorrectionRadians=s||0,this._helper.apply(n)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const n=u.bf();return n[0]=this._cameraPosition[0],n[1]=this._cameraPosition[1],n[2]=this._cameraPosition[2],n}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(n){const{overscaledTileID:s,applyGlobeMatrix:m}=n,y=this._helper.getMercatorTileCoordinates(s);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:y,clippingPlane:this._cachedClippingPlane,projectionTransition:m?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(n){const s=this.pitchInRadians,m=this.cameraToCenterDistance/n,y=Math.sin(s)*m,b=Math.cos(s)*m+1,I=1/Math.sqrt(y*y+b*b)*1;let M=-y,z=b;const B=Math.sqrt(M*M+z*z);M/=B,z/=B;const q=[0,M,z];return u.bg(q,q,[0,0,0],-this.bearingInRadians),u.bh(q,q,[0,0,0],-1*this.center.lat*Math.PI/180),u.bi(q,q,[0,0,0],this.center.lng*Math.PI/180),u.aL(q,q,.25),[...q,.25*-I]}isLocationOccluded(n){return!this.isSurfacePointVisible(qn(n))}transformLightDirection(n){const s=this._helper._center.lng*Math.PI/180,m=this._helper._center.lat*Math.PI/180,y=Math.cos(m),b=[Math.sin(s)*y,Math.sin(m),Math.cos(s)*y],I=[b[2],0,-b[0]],M=[0,0,0];u.aR(M,I,b),u.aQ(I,I),u.aQ(M,M);const z=[0,0,0];return u.aQ(z,[I[0]*n[0]+M[0]*n[1]+b[0]*n[2],I[1]*n[0]+M[1]*n[1]+b[1]*n[2],I[2]*n[0]+M[2]*n[1]+b[2]*n[2]]),z}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(n,s,m){const y=function(M,z,B){const q=1/(1<<B.z);return new u.Y(M/u.X*q+B.x*q,z/u.X*q+B.y*q)}(n,s,m.canonical),b=(I=y.y,[u.bd(y.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-I*Math.PI*2))-.5*Math.PI]);var I;return this.getCircleRadiusCorrection()/Math.cos(b[1])}projectTileCoordinates(n,s,m,y){const b=m.canonical,I=to(n,s,b.x,b.y,b.z),M=1+(y?y(n,s):0)/u.bo,z=[I[0]*M,I[1]*M,I[2]*M,1];u.al(z,z,this._globeViewProjMatrixNoCorrection);const B=this._cachedClippingPlane,q=B[0]*I[0]+B[1]*I[1]+B[2]*I[2]+B[3]<0;return{point:new u.P(z[0]/z[3],z[1]/z[3]),signedDistanceFromCamera:z[3],isOccluded:q}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const n=mr(this.worldSize,this.center.lat),s=u.a$(),m=u.a$();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*n),u.aV(s,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const y=this.centerOffset;s[8]=2*-y.x/this._helper._width,s[9]=2*y.y/this._helper._height,this._projectionMatrix=u.aW(s),this._globeProjMatrixInverted=u.a$(),u.an(this._globeProjMatrixInverted,s),u.J(s,s,[0,0,-this.cameraToCenterDistance]),u.aX(s,s,this.rollInRadians),u.aY(s,s,-this.pitchInRadians),u.aX(s,s,this.bearingInRadians),u.J(s,s,[0,0,-n]);const b=u.bf();b[0]=n,b[1]=n,b[2]=n,u.aY(m,s,this.center.lat*Math.PI/180),u.bj(m,m,-this.center.lng*Math.PI/180),u.K(m,m,b),this._globeViewProjMatrixNoCorrection=m,u.aY(s,s,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),u.bj(s,s,-this.center.lng*Math.PI/180),u.K(s,s,b),this._globeViewProjMatrix32f=new Float32Array(s),this._globeViewProjMatrixNoCorrectionInverted=u.a$(),u.an(this._globeViewProjMatrixNoCorrectionInverted,m);const I=u.bf();this._cameraPosition=u.bf(),this._cameraPosition[2]=this.cameraToCenterDistance/n,u.bg(this._cameraPosition,this._cameraPosition,I,-this.rollInRadians),u.bh(this._cameraPosition,this._cameraPosition,I,this.pitchInRadians),u.bg(this._cameraPosition,this._cameraPosition,I,-this.bearingInRadians),u.aM(this._cameraPosition,this._cameraPosition,[0,0,1]),u.bh(this._cameraPosition,this._cameraPosition,I,-this.center.lat*Math.PI/180),u.bi(this._cameraPosition,this._cameraPosition,I,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(n);const M=u.aW(this._globeViewProjMatrixNoCorrectionInverted);u.K(M,M,[1,1,-1]),this._cachedFrustum=wr.fromInvProjectionMatrix(M)}calculateFogMatrix(n){u.w("calculateFogMatrix is not supported on globe projection.");const s=u.a$();return u.aq(s),s}getVisibleUnwrappedCoordinates(n){return[new u.aT(0,n)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(n){n&&u.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(n,s){if(!this._globeViewProjMatrixNoCorrection)return 1;const m=qn(n);u.aL(m,m,1+s/u.bo);const y=u.be();return u.al(y,[m[0],m[1],m[2],1],this._globeViewProjMatrixNoCorrection),y[2]/y[3]}populateCache(n){}getBounds(){const n=.5*this.width,s=.5*this.height,m=[new u.P(0,0),new u.P(n,0),new u.P(this.width,0),new u.P(this.width,s),new u.P(this.width,this.height),new u.P(n,this.height),new u.P(0,this.height),new u.P(0,s)],y=[];for(const W of m)y.push(this.unprojectScreenPoint(W));let b=0,I=0,M=0,z=0;const B=this.center;for(const W of y){const K=u.bk(B.lng,W.lng),oe=u.bk(B.lat,W.lat);K<I&&(I=K),K>b&&(b=K),oe<z&&(z=oe),oe>M&&(M=oe)}const q=[B.lng+I,B.lat+z,B.lng+b,B.lat+M];return this.isSurfacePointOnScreen([0,1,0])&&(q[3]=90,q[0]=-180,q[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(q[1]=-90,q[0]=-180,q[2]=180),new Wi(q)}getConstrained(n,s){const m=u.ab(n.lat,-85.051129,u.aF),y=u.ab(+s,this.minZoom+Ii(0,m),this.maxZoom);return{center:new u.N(n.lng,m),zoom:y}}calculateCenterFromCameraLngLatAlt(n,s,m,y){return this._helper.calculateCenterFromCameraLngLatAlt(n,s,m,y)}setLocationAtPoint(n,s){const m=qn(this.unprojectScreenPoint(s)),y=qn(n),b=u.bf();u.bl(b);const I=u.bf();u.bi(I,m,b,-this.center.lng*Math.PI/180),u.bh(I,I,b,this.center.lat*Math.PI/180);const M=y[0]*y[0]+y[2]*y[2],z=I[0]*I[0];if(M<z)return;const B=Math.sqrt(M-z),q=-B,W=u.bm(y[0],y[2],I[0],B),K=u.bm(y[0],y[2],I[0],q),oe=u.bf();u.bi(oe,y,b,-W);const le=u.bm(oe[1],oe[2],I[1],I[2]),we=u.bf();u.bi(we,y,b,-K);const ge=u.bm(we[1],we[2],I[1],I[2]),Te=.5*Math.PI,Ie=le>=-Te&&le<=Te,Re=ge>=-Te&&ge<=Te;let ze,Fe;if(Ie&&Re){const Je=this.center.lng*Math.PI/180,yt=this.center.lat*Math.PI/180;u.bp(W,Je)+u.bp(le,yt)<u.bp(K,Je)+u.bp(ge,yt)?(ze=W,Fe=le):(ze=K,Fe=ge)}else if(Ie)ze=W,Fe=le;else{if(!Re)return;ze=K,Fe=ge}const Ve=ze/Math.PI*180,Ne=Fe/Math.PI*180,Qe=this.center.lat;this.setCenter(new u.N(Ve,u.ab(Ne,-90,90))),this.setZoom(this.zoom+Ii(Qe,this.center.lat))}locationToScreenPoint(n,s){const m=qn(n);if(s){const y=s.getElevationForLngLatZoom(n,this._helper._tileZoom);u.aL(m,m,1+y/u.bo)}return this._projectSurfacePointToScreen(m)}_projectSurfacePointToScreen(n){const s=u.be();return u.al(s,[...n,1],this._globeViewProjMatrixNoCorrection),s[0]/=s[3],s[1]/=s[3],new u.P((.5*s[0]+.5)*this.width,(.5*-s[1]+.5)*this.height)}screenPointToMercatorCoordinate(n,s){if(s){const m=s.pointCoordinate(n);if(m)return m}return u.Y.fromLngLat(this.unprojectScreenPoint(n))}screenPointToLocation(n,s){var m;return(m=this.screenPointToMercatorCoordinate(n,s))===null||m===void 0?void 0:m.toLngLat()}isPointOnMapSurface(n,s){const m=this._cameraPosition,y=this.getRayDirectionFromPixel(n);return!!this.rayPlanetIntersection(m,y)}getRayDirectionFromPixel(n){const s=u.be();s[0]=n.x/this.width*2-1,s[1]=-1*(n.y/this.height*2-1),s[2]=1,s[3]=1,u.al(s,s,this._globeViewProjMatrixNoCorrectionInverted),s[0]/=s[3],s[1]/=s[3],s[2]/=s[3];const m=u.bf();m[0]=s[0]-this._cameraPosition[0],m[1]=s[1]-this._cameraPosition[1],m[2]=s[2]-this._cameraPosition[2];const y=u.bf();return u.aQ(y,m),y}isSurfacePointVisible(n){const s=this._cachedClippingPlane;return s[0]*n[0]+s[1]*n[1]+s[2]*n[2]+s[3]>=0}isSurfacePointOnScreen(n){if(!this.isSurfacePointVisible(n))return!1;const s=u.be();return u.al(s,[...n,1],this._globeViewProjMatrixNoCorrection),s[0]/=s[3],s[1]/=s[3],s[2]/=s[3],s[0]>-1&&s[0]<1&&s[1]>-1&&s[1]<1&&s[2]>-1&&s[2]<1}rayPlanetIntersection(n,s){const m=u.aS(n,s),y=u.bf(),b=u.bf();u.aL(b,s,m),u.aP(y,n,b);const I=1-u.aS(y,y);if(I<0)return null;const M=u.aS(n,n)-1,z=-m+(m<0?1:-1)*Math.sqrt(I),B=M/z,q=z;return{tMin:Math.min(B,q),tMax:Math.max(B,q)}}unprojectScreenPoint(n){const s=this._cameraPosition,m=this.getRayDirectionFromPixel(n),y=this.rayPlanetIntersection(s,m);if(y){const B=u.bf();u.aM(B,s,[m[0]*y.tMin,m[1]*y.tMin,m[2]*y.tMin]);const q=u.bf();return u.aQ(q,B),mo(q)}const b=this._cachedClippingPlane[0]*m[0]+this._cachedClippingPlane[1]*m[1]+this._cachedClippingPlane[2]*m[2],I=-u.bn(this._cachedClippingPlane,s)/b,M=u.bf();if(I>0)u.aM(M,s,[m[0]*I,m[1]*I,m[2]*I]);else{const B=u.bf();u.aM(B,s,[2*m[0],2*m[1],2*m[2]]);const q=u.bn(this._cachedClippingPlane,B);u.aP(M,B,[this._cachedClippingPlane[0]*q,this._cachedClippingPlane[1]*q,this._cachedClippingPlane[2]*q])}const z=u.bf();return u.aQ(z,M),mo(z)}getMatrixForModel(n,s){const m=u.N.convert(n),y=1/u.bo,b=u.a_();return u.bj(b,b,m.lng/180*Math.PI),u.aY(b,b,-m.lat/180*Math.PI),u.J(b,b,[0,0,1+s/u.bo]),u.aY(b,b,.5*Math.PI),u.K(b,b,[y,y,y]),b}getProjectionDataForCustomLayer(n=!0){const s=this.getProjectionData({overscaledTileID:new u.S(0,0,0,0,0),applyGlobeMatrix:n});return s.tileMercatorCoords=[0,0,1,1],s}getFastPathSimpleProjectionMatrix(n){}}class Io{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(n){this._helper.setMinZoom(n)}setMaxZoom(n){this._helper.setMaxZoom(n)}setMinPitch(n){this._helper.setMinPitch(n)}setMaxPitch(n){this._helper.setMaxPitch(n)}setRenderWorldCopies(n){this._helper.setRenderWorldCopies(n)}setBearing(n){this._helper.setBearing(n)}setPitch(n){this._helper.setPitch(n)}setRoll(n){this._helper.setRoll(n)}setFov(n){this._helper.setFov(n)}setZoom(n){this._helper.setZoom(n)}setCenter(n){this._helper.setCenter(n)}setElevation(n){this._helper.setElevation(n)}setMinElevationForCurrentTile(n){this._helper.setMinElevationForCurrentTile(n)}setPadding(n){this._helper.setPadding(n)}interpolatePadding(n,s,m){return this._helper.interpolatePadding(n,s,m)}isPaddingEqual(n){return this._helper.isPaddingEqual(n)}resize(n,s,m=!0){this._helper.resize(n,s,m)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(n){this._helper.setMaxBounds(n)}overrideNearFarZ(n,s){this._helper.overrideNearFarZ(n,s)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(n){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),n)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(n,s){this._globeness=n,this._globeLatitudeErrorCorrectionRadians=s,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().recalculateCache(),this._mercatorTransform.getCoveringTilesDetailsProvider().recalculateCache()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this._helper=new Zr({calcMatrices:()=>{this._calcMatrices()},getConstrained:(n,s)=>this.getConstrained(n,s)}),this._globeness=1,this._mercatorTransform=new fo,this._verticalPerspectiveTransform=new As}clone(){const n=new Io;return n._globeness=this._globeness,n._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,n.apply(this),n}apply(n){this._helper.apply(n),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(n){const s=this._mercatorTransform.getProjectionData(n),m=this._verticalPerspectiveTransform.getProjectionData(n);return{mainMatrix:this.isGlobeRendering?m.mainMatrix:s.mainMatrix,clippingPlane:m.clippingPlane,tileMercatorCoords:m.tileMercatorCoords,projectionTransition:n.applyGlobeMatrix?this._globeness:0,fallbackMatrix:s.fallbackMatrix}}isLocationOccluded(n){return this.currentTransform.isLocationOccluded(n)}transformLightDirection(n){return this.currentTransform.transformLightDirection(n)}getPixelScale(){return u.b9(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return u.b9(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(n,s,m){const y=this._mercatorTransform.getPitchedTextCorrection(n,s,m),b=this._verticalPerspectiveTransform.getPitchedTextCorrection(n,s,m);return u.b9(y,b,this._globeness)}projectTileCoordinates(n,s,m,y){return this.currentTransform.projectTileCoordinates(n,s,m,y)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(n){return this.currentTransform.calculateFogMatrix(n)}getVisibleUnwrappedCoordinates(n){return this.currentTransform.getVisibleUnwrappedCoordinates(n)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(n){this._mercatorTransform.recalculateZoomAndCenter(n),this._verticalPerspectiveTransform.recalculateZoomAndCenter(n)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(n,s){return this.currentTransform.lngLatToCameraDepth(n,s)}populateCache(n){this._mercatorTransform.populateCache(n),this._verticalPerspectiveTransform.populateCache(n)}getBounds(){return this.currentTransform.getBounds()}getConstrained(n,s){return this.currentTransform.getConstrained(n,s)}calculateCenterFromCameraLngLatAlt(n,s,m,y){return this._helper.calculateCenterFromCameraLngLatAlt(n,s,m,y)}setLocationAtPoint(n,s){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(n,s),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(n,s),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(n,s){return this.currentTransform.locationToScreenPoint(n,s)}screenPointToMercatorCoordinate(n,s){return this.currentTransform.screenPointToMercatorCoordinate(n,s)}screenPointToLocation(n,s){return this.currentTransform.screenPointToLocation(n,s)}isPointOnMapSurface(n,s){return this.currentTransform.isPointOnMapSurface(n,s)}getRayDirectionFromPixel(n){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(n)}getMatrixForModel(n,s){return this.currentTransform.getMatrixForModel(n,s)}getProjectionDataForCustomLayer(n=!0){const s=this._mercatorTransform.getProjectionDataForCustomLayer(n);if(!this.isGlobeRendering)return s;const m=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(n);return m.fallbackMatrix=s.mainMatrix,m}getFastPathSimpleProjectionMatrix(n){return this.currentTransform.getFastPathSimpleProjectionMatrix(n)}}class tr{get useGlobeControls(){return!0}handlePanInertia(n,s){const m=Vl(n,s);return Math.abs(m.lng-s.center.lng)>180&&(m.lng=s.center.lng+179.5*Math.sign(m.lng-s.center.lng)),{easingCenter:m,easingOffset:new u.P(0,0)}}handleMapControlsRollPitchBearingZoom(n,s){const m=n.around,y=s.screenPointToLocation(m);n.bearingDelta&&s.setBearing(s.bearing+n.bearingDelta),n.pitchDelta&&s.setPitch(s.pitch+n.pitchDelta),n.rollDelta&&s.setRoll(s.roll+n.rollDelta);const b=s.zoom;n.zoomDelta&&s.setZoom(s.zoom+n.zoomDelta);const I=s.zoom-b;if(I===0)return;const M=u.bk(s.center.lng,y.lng),z=M/(Math.abs(M/180)+1),B=u.bk(s.center.lat,y.lat),q=s.getRayDirectionFromPixel(m),W=s.cameraPosition,K=-1*u.aS(W,q),oe=u.bf();u.aM(oe,W,[q[0]*K,q[1]*K,q[2]*K]);const le=u.bq(oe)-1,we=Math.exp(.5*-Math.max(le-.3,0)),ge=mr(s.worldSize,s.center.lat)/Math.min(s.width,s.height),Te=u.bc(ge,.9,.5,1,.25),Ie=(1-u.aG(-I))*Math.min(we,Te),Re=s.center.lat,ze=s.zoom,Fe=new u.N(s.center.lng+z*Ie,u.ab(s.center.lat+B*Ie,-85.051129,u.aF));s.setLocationAtPoint(y,m);const Ve=s.center,Ne=u.bc(Math.abs(M),45,85,0,1),Qe=u.bc(ge,.75,.35,0,1),Je=Math.pow(Math.max(Ne,Qe),.25),yt=u.bk(Ve.lng,Fe.lng),xt=u.bk(Ve.lat,Fe.lat);s.setCenter(new u.N(Ve.lng+yt*Je,Ve.lat+xt*Je).wrap()),s.setZoom(ze+Ii(Re,s.center.lat))}handleMapControlsPan(n,s,m){if(!n.panDelta)return;const y=s.center.lat,b=s.zoom;s.setCenter(Vl(n.panDelta,s).wrap()),s.setZoom(b+Ii(y,s.center.lat))}cameraForBoxAndBearing(n,s,m,y,b){const I=si(n,s,m,y,b),M=s.left/b.width*2-1,z=(b.width-s.right)/b.width*2-1,B=s.top/b.height*-2+1,q=(b.height-s.bottom)/b.height*-2+1,W=u.bk(m.getWest(),m.getEast())<0,K=W?m.getEast():m.getWest(),oe=W?m.getWest():m.getEast(),le=Math.max(m.getNorth(),m.getSouth()),we=Math.min(m.getNorth(),m.getSouth()),ge=K+.5*u.bk(K,oe),Te=le+.5*u.bk(le,we),Ie=b.clone();Ie.setCenter(I.center),Ie.setBearing(I.bearing),Ie.setPitch(0),Ie.setRoll(0),Ie.setZoom(I.zoom);const Re=Ie.modelViewProjectionMatrix,ze=[qn(m.getNorthWest()),qn(m.getNorthEast()),qn(m.getSouthWest()),qn(m.getSouthEast()),qn(new u.N(oe,Te)),qn(new u.N(K,Te)),qn(new u.N(ge,le)),qn(new u.N(ge,we))],Fe=qn(I.center);let Ve=Number.POSITIVE_INFINITY;for(const Ne of ze)M<0&&(Ve=tr.getLesserNonNegativeNonNull(Ve,tr.solveVectorScale(Ne,Fe,Re,"x",M))),z>0&&(Ve=tr.getLesserNonNegativeNonNull(Ve,tr.solveVectorScale(Ne,Fe,Re,"x",z))),B>0&&(Ve=tr.getLesserNonNegativeNonNull(Ve,tr.solveVectorScale(Ne,Fe,Re,"y",B))),q<0&&(Ve=tr.getLesserNonNegativeNonNull(Ve,tr.solveVectorScale(Ne,Fe,Re,"y",q)));if(Number.isFinite(Ve)&&Ve!==0)return I.zoom=Ie.zoom+u.a8(Ve),I;hn()}handleJumpToCenterZoom(n,s){const m=n.center.lat,y=n.getConstrained(s.center?u.N.convert(s.center):n.center,n.zoom).center;n.setCenter(y.wrap());const b=s.zoom!==void 0?+s.zoom:n.zoom+Ii(m,y.lat);n.zoom!==b&&n.setZoom(b)}handleEaseTo(n,s){const m=n.zoom,y=n.center,b=n.padding,I={roll:n.roll,pitch:n.pitch,bearing:n.bearing},M={roll:s.roll===void 0?n.roll:s.roll,pitch:s.pitch===void 0?n.pitch:s.pitch,bearing:s.bearing===void 0?n.bearing:s.bearing},z=s.zoom!==void 0,B=!n.isPaddingEqual(s.padding);let q=!1;const W=s.center?u.N.convert(s.center):y,K=n.getConstrained(W,m).center;xr(n,K);const oe=n.clone();oe.setCenter(K),oe.setZoom(z?+s.zoom:m+Ii(y.lat,W.lat)),oe.setBearing(s.bearing);const le=new u.P(u.ab(n.centerPoint.x+s.offsetAsPoint.x,0,n.width),u.ab(n.centerPoint.y+s.offsetAsPoint.y,0,n.height));oe.setLocationAtPoint(K,le);const we=(s.offset&&s.offsetAsPoint.mag())>0?oe.center:K,ge=z?+s.zoom:m+Ii(y.lat,we.lat),Te=m+Ii(y.lat,0),Ie=ge+Ii(we.lat,0),Re=u.bk(y.lng,we.lng),ze=u.bk(y.lat,we.lat),Fe=u.aG(Ie-Te);return q=ge!==m,{easeFunc:Ve=>{if(u.b3(I,M)||Pr({startEulerAngles:I,endEulerAngles:M,tr:n,k:Ve,useSlerp:I.roll!=M.roll}),B&&n.interpolatePadding(b,s.padding,Ve),s.around)u.w("Easing around a point is not supported under globe projection."),n.setLocationAtPoint(s.around,s.aroundPoint);else{const Ne=Ie>Te?Math.min(2,Fe):Math.max(.5,Fe),Qe=Math.pow(Ne,1-Ve),Je=Cs(y,Re,ze,Ve*Qe);n.setCenter(Je.wrap())}if(q){const Ne=u.y.number(Te,Ie,Ve)+Ii(0,n.center.lat);n.setZoom(Ne)}},isZooming:q,elevationCenter:we}}handleFlyTo(n,s){const m=s.zoom!==void 0,y=n.center,b=n.zoom,I=!n.isPaddingEqual(s.padding),M=n.getConstrained(u.N.convert(s.center||s.locationAtOffset),b).center,z=m?+s.zoom:n.zoom+Ii(n.center.lat,M.lat),B=n.clone();B.setCenter(M),I&&B.setPadding(s.padding),B.setZoom(z),B.setBearing(s.bearing);const q=new u.P(u.ab(n.centerPoint.x+s.offsetAsPoint.x,0,n.width),u.ab(n.centerPoint.y+s.offsetAsPoint.y,0,n.height));B.setLocationAtPoint(M,q);const W=B.center;xr(n,W);const K=function(Re,ze,Fe){const Ve=qn(ze),Ne=qn(Fe),Qe=u.aS(Ve,Ne),Je=Math.acos(Qe),yt=ei(Re);return Je/(2*Math.PI)*yt}(n,y,W),oe=b+Ii(y.lat,0),le=z+Ii(W.lat,0),we=u.aG(le-oe);let ge;if(typeof s.minZoom=="number"){const Re=+s.minZoom+Ii(W.lat,0),ze=Math.min(Re,oe,le)+Ii(0,W.lat),Fe=n.getConstrained(W,ze).zoom+Ii(W.lat,0);ge=u.aG(Fe-oe)}const Te=u.bk(y.lng,W.lng),Ie=u.bk(y.lat,W.lat);return{easeFunc:(Re,ze,Fe,Ve)=>{const Ne=Cs(y,Te,Ie,Fe),Qe=Re===1?W:Ne;n.setCenter(Qe.wrap());const Je=oe+u.a8(ze);n.setZoom(Re===1?z:Je+Ii(0,Qe.lat))},scaleOfZoom:we,targetCenter:W,scaleOfMinZoom:ge,pixelPathLength:K}}static solveVectorScale(n,s,m,y,b){const I=y==="x"?[m[0],m[4],m[8],m[12]]:[m[1],m[5],m[9],m[13]],M=[m[3],m[7],m[11],m[15]],z=n[0]*I[0]+n[1]*I[1]+n[2]*I[2],B=n[0]*M[0]+n[1]*M[1]+n[2]*M[2],q=s[0]*I[0]+s[1]*I[1]+s[2]*I[2],W=s[0]*M[0]+s[1]*M[1]+s[2]*M[2];return q+b*B===z+b*W||M[3]*(z-q)+I[3]*(W-B)+z*W==q*B?null:(q+I[3]-b*W-b*M[3])/(q-z-b*W+b*B)}static getLesserNonNegativeNonNull(n,s){return s!==null&&s>=0&&s<n?s:n}}class Ws{constructor(n){this._globe=n,this._mercatorCameraHelper=new fl,this._verticalPerspectiveCameraHelper=new tr}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(n,s){return this.currentHelper.handlePanInertia(n,s)}handleMapControlsRollPitchBearingZoom(n,s){return this.currentHelper.handleMapControlsRollPitchBearingZoom(n,s)}handleMapControlsPan(n,s,m){this.currentHelper.handleMapControlsPan(n,s,m)}cameraForBoxAndBearing(n,s,m,y,b){return this.currentHelper.cameraForBoxAndBearing(n,s,m,y,b)}handleJumpToCenterZoom(n,s){this.currentHelper.handleJumpToCenterZoom(n,s)}handleEaseTo(n,s){return this.currentHelper.handleEaseTo(n,s)}handleFlyTo(n,s){return this.currentHelper.handleFlyTo(n,s)}}const Ks=(w,n)=>u.t(w,n&&n.filter(s=>s.identifier!=="source.canvas")),gl=u.br();class no extends u.E{constructor(n,s={}){super(),this._rtlPluginLoaded=()=>{for(const m in this.sourceCaches){const y=this.sourceCaches[m].getSource().type;y!=="vector"&&y!=="geojson"||this.sourceCaches[m].reload()}},this.map=n,this.dispatcher=new Fn(nn(),n._getMapId()),this.dispatcher.registerMessageHandler("GG",(m,y)=>this.getGlyphs(m,y)),this.dispatcher.registerMessageHandler("GI",(m,y)=>this.getImages(m,y)),this.imageManager=new xe,this.imageManager.setEventedParent(this),this.glyphManager=new pn(n._requestManager,s.localIdeographFontFamily),this.lineAtlas=new St(256,512),this.crossTileSymbolIndex=new fi,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new u.bs,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",u.bt()),qr().on(Hs,this._rtlPluginLoaded),this.on("data",m=>{if(m.dataType!=="source"||m.sourceDataType!=="metadata")return;const y=this.sourceCaches[m.sourceId];if(!y)return;const b=y.getSource();if(b&&b.vectorLayerIds)for(const I in this._layers){const M=this._layers[I];M.source===b.id&&this._validateLayer(M)}})}loadURL(n,s={},m){this.fire(new u.k("dataloading",{dataType:"style"})),s.validate=typeof s.validate!="boolean"||s.validate;const y=this.map._requestManager.transformRequest(n,"Style");this._loadStyleRequest=new AbortController;const b=this._loadStyleRequest;u.h(y,this._loadStyleRequest).then(I=>{this._loadStyleRequest=null,this._load(I.data,s,m)}).catch(I=>{this._loadStyleRequest=null,I&&!b.signal.aborted&&this.fire(new u.j(I))})}loadJSON(n,s={},m){this.fire(new u.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,re.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,s.validate=s.validate!==!1,this._load(n,s,m)}).catch(()=>{})}loadEmpty(){this.fire(new u.k("dataloading",{dataType:"style"})),this._load(gl,{validate:!1})}_load(n,s,m){var y,b;const I=s.transformStyle?s.transformStyle(m,n):n;if(!s.validate||!Ks(this,u.u(I))){this._loaded=!0,this.stylesheet=I;for(const M in I.sources)this.addSource(M,I.sources[M],{validate:!1});I.sprite?this._loadSprite(I.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(I.glyphs),this._createLayers(),this.light=new jn(this.stylesheet.light),this._setProjectionInternal(((y=this.stylesheet.projection)===null||y===void 0?void 0:y.type)||"mercator"),this.sky=new gn(this.stylesheet.sky),this.map.setTerrain((b=this.stylesheet.terrain)!==null&&b!==void 0?b:null),this.fire(new u.k("data",{dataType:"style"})),this.fire(new u.k("style.load"))}}_createLayers(){const n=u.bu(this.stylesheet.layers);this.dispatcher.broadcast("SL",n),this._order=n.map(s=>s.id),this._layers={},this._serializedLayers=null;for(const s of n){const m=u.bv(s);m.setEventedParent(this,{layer:{id:s.id}}),this._layers[s.id]=m}}_loadSprite(n,s=!1,m=void 0){let y;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(b,I,M,z){return u._(this,void 0,void 0,function*(){const B=at(b),q=M>1?"@2x":"",W={},K={};for(const{id:oe,url:le}of B){const we=I.transformRequest(be(le,q,".json"),"SpriteJSON");W[oe]=u.h(we,z);const ge=I.transformRequest(be(le,q,".png"),"SpriteImage");K[oe]=Ye.getImage(ge,z)}return yield Promise.all([...Object.values(W),...Object.values(K)]),function(oe,le){return u._(this,void 0,void 0,function*(){const we={};for(const ge in oe){we[ge]={};const Te=re.getImageCanvasContext((yield le[ge]).data),Ie=(yield oe[ge]).data;for(const Re in Ie){const{width:ze,height:Fe,x:Ve,y:Ne,sdf:Qe,pixelRatio:Je,stretchX:yt,stretchY:xt,content:pt,textFitWidth:Ut,textFitHeight:At}=Ie[Re];we[ge][Re]={data:null,pixelRatio:Je,sdf:Qe,stretchX:yt,stretchY:xt,content:pt,textFitWidth:Ut,textFitHeight:At,spriteData:{width:ze,height:Fe,x:Ve,y:Ne,context:Te}}}}return we})}(W,K)})}(n,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(b=>{if(this._spriteRequest=null,b)for(const I in b){this._spritesImagesIds[I]=[];const M=this._spritesImagesIds[I]?this._spritesImagesIds[I].filter(z=>!(z in b)):[];for(const z of M)this.imageManager.removeImage(z),this._changedImages[z]=!0;for(const z in b[I]){const B=I==="default"?z:`${I}:${z}`;this._spritesImagesIds[I].push(B),B in this.imageManager.images?this.imageManager.updateImage(B,b[I][z],!1):this.imageManager.addImage(B,b[I][z]),s&&(this._changedImages[B]=!0)}}}).catch(b=>{this._spriteRequest=null,y=b,this.fire(new u.j(y))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),s&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new u.k("data",{dataType:"style"})),m&&m(y)})}_unloadSprite(){for(const n of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(n),this._changedImages[n]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new u.k("data",{dataType:"style"}))}_validateLayer(n){const s=this.sourceCaches[n.source];if(!s)return;const m=n.sourceLayer;if(!m)return;const y=s.getSource();(y.type==="geojson"||y.vectorLayerIds&&y.vectorLayerIds.indexOf(m)===-1)&&this.fire(new u.j(new Error(`Source layer "${m}" does not exist on source "${y.id}" as specified by style layer "${n.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const n in this.sourceCaches)if(!this.sourceCaches[n].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(n,s=!1){const m=this._serializedAllLayers();if(!n||n.length===0)return Object.values(s?u.bw(m):m);const y=[];for(const b of n)if(m[b]){const I=s?u.bw(m[b]):m[b];y.push(I)}return y}_serializedAllLayers(){let n=this._serializedLayers;if(n)return n;n=this._serializedLayers={};const s=Object.keys(this._layers);for(const m of s){const y=this._layers[m];y.type!=="custom"&&(n[m]=y.serialize())}return n}hasTransitions(){var n,s,m;if(!((n=this.light)===null||n===void 0)&&n.hasTransition()||!((s=this.sky)===null||s===void 0)&&s.hasTransition()||!((m=this.projection)===null||m===void 0)&&m.hasTransition())return!0;for(const y in this.sourceCaches)if(this.sourceCaches[y].hasTransition())return!0;for(const y in this._layers)if(this._layers[y].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(n){if(!this._loaded)return;const s=this._changed;if(s){const y=Object.keys(this._updatedLayers),b=Object.keys(this._removedLayers);(y.length||b.length)&&this._updateWorkerLayers(y,b);for(const I in this._updatedSources){const M=this._updatedSources[I];if(M==="reload")this._reloadSource(I);else{if(M!=="clear")throw new Error(`Invalid action ${M}`);this._clearSource(I)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const I in this._updatedPaintProps)this._layers[I].updateTransitions(n);this.light.updateTransitions(n),this.sky.updateTransitions(n),this._resetUpdates()}const m={};for(const y in this.sourceCaches){const b=this.sourceCaches[y];m[y]=b.used,b.used=!1}for(const y of this._order){const b=this._layers[y];b.recalculate(n,this._availableImages),!b.isHidden(n.zoom)&&b.source&&(this.sourceCaches[b.source].used=!0)}for(const y in m){const b=this.sourceCaches[y];!!m[y]!=!!b.used&&b.fire(new u.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:y}))}this.light.recalculate(n),this.sky.recalculate(n),this.projection.recalculate(n),this.z=n.zoom,s&&this.fire(new u.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const n=Object.keys(this._changedImages);if(n.length){for(const s in this.sourceCaches)this.sourceCaches[s].reloadTilesForDependencies(["icons","patterns"],n);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const n in this.sourceCaches)this.sourceCaches[n].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(n,s){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(n,!1),removedIds:s})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(n,s={}){var m;this._checkLoaded();const y=this.serialize();if(n=s.transformStyle?s.transformStyle(y,n):n,((m=s.validate)===null||m===void 0||m)&&Ks(this,u.u(n)))return!1;(n=u.bw(n)).layers=u.bu(n.layers);const b=u.bx(y,n),I=this._getOperationsToPerform(b);if(I.unimplemented.length>0)throw new Error(`Unimplemented: ${I.unimplemented.join(", ")}.`);if(I.operations.length===0)return!1;for(const M of I.operations)M();return this.stylesheet=n,this._serializedLayers=null,!0}_getOperationsToPerform(n){const s=[],m=[];for(const y of n)switch(y.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":s.push(()=>this.addLayer.apply(this,y.args));break;case"removeLayer":s.push(()=>this.removeLayer.apply(this,y.args));break;case"setPaintProperty":s.push(()=>this.setPaintProperty.apply(this,y.args));break;case"setLayoutProperty":s.push(()=>this.setLayoutProperty.apply(this,y.args));break;case"setFilter":s.push(()=>this.setFilter.apply(this,y.args));break;case"addSource":s.push(()=>this.addSource.apply(this,y.args));break;case"removeSource":s.push(()=>this.removeSource.apply(this,y.args));break;case"setLayerZoomRange":s.push(()=>this.setLayerZoomRange.apply(this,y.args));break;case"setLight":s.push(()=>this.setLight.apply(this,y.args));break;case"setGeoJSONSourceData":s.push(()=>this.setGeoJSONSourceData.apply(this,y.args));break;case"setGlyphs":s.push(()=>this.setGlyphs.apply(this,y.args));break;case"setSprite":s.push(()=>this.setSprite.apply(this,y.args));break;case"setTerrain":s.push(()=>this.map.setTerrain.apply(this,y.args));break;case"setSky":s.push(()=>this.setSky.apply(this,y.args));break;case"setProjection":this.setProjection.apply(this,y.args);break;case"setTransition":s.push(()=>{});break;default:m.push(y.command)}return{operations:s,unimplemented:m}}addImage(n,s){if(this.getImage(n))return this.fire(new u.j(new Error(`An image named "${n}" already exists.`)));this.imageManager.addImage(n,s),this._afterImageUpdated(n)}updateImage(n,s){this.imageManager.updateImage(n,s)}getImage(n){return this.imageManager.getImage(n)}removeImage(n){if(!this.getImage(n))return this.fire(new u.j(new Error(`An image named "${n}" does not exist.`)));this.imageManager.removeImage(n),this._afterImageUpdated(n)}_afterImageUpdated(n){this._availableImages=this.imageManager.listImages(),this._changedImages[n]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new u.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(n,s,m={}){if(this._checkLoaded(),this.sourceCaches[n]!==void 0)throw new Error(`Source "${n}" already exists.`);if(!s.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(s).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(s.type)>=0&&this._validate(u.u.source,`sources.${n}`,s,null,m))return;this.map&&this.map._collectResourceTiming&&(s.collectResourceTiming=!0);const y=this.sourceCaches[n]=new se(n,s,this.dispatcher);y.style=this,y.setEventedParent(this,()=>({isSourceLoaded:y.loaded(),source:y.serialize(),sourceId:n})),y.onAdd(this.map),this._changed=!0}removeSource(n){if(this._checkLoaded(),this.sourceCaches[n]===void 0)throw new Error("There is no source with this ID");for(const m in this._layers)if(this._layers[m].source===n)return this.fire(new u.j(new Error(`Source "${n}" cannot be removed while layer "${m}" is using it.`)));const s=this.sourceCaches[n];delete this.sourceCaches[n],delete this._updatedSources[n],s.fire(new u.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:n})),s.setEventedParent(null),s.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(n,s){if(this._checkLoaded(),this.sourceCaches[n]===void 0)throw new Error(`There is no source with this ID=${n}`);const m=this.sourceCaches[n].getSource();if(m.type!=="geojson")throw new Error(`geojsonSource.type is ${m.type}, which is !== 'geojson`);m.setData(s),this._changed=!0}getSource(n){return this.sourceCaches[n]&&this.sourceCaches[n].getSource()}addLayer(n,s,m={}){this._checkLoaded();const y=n.id;if(this.getLayer(y))return void this.fire(new u.j(new Error(`Layer "${y}" already exists on this map.`)));let b;if(n.type==="custom"){if(Ks(this,u.by(n)))return;b=u.bv(n)}else{if("source"in n&&typeof n.source=="object"&&(this.addSource(y,n.source),n=u.bw(n),n=u.e(n,{source:y})),this._validate(u.u.layer,`layers.${y}`,n,{arrayIndex:-1},m))return;b=u.bv(n),this._validateLayer(b),b.setEventedParent(this,{layer:{id:y}})}const I=s?this._order.indexOf(s):this._order.length;if(s&&I===-1)this.fire(new u.j(new Error(`Cannot add layer "${y}" before non-existing layer "${s}".`)));else{if(this._order.splice(I,0,y),this._layerOrderChanged=!0,this._layers[y]=b,this._removedLayers[y]&&b.source&&b.type!=="custom"){const M=this._removedLayers[y];delete this._removedLayers[y],M.type!==b.type?this._updatedSources[b.source]="clear":(this._updatedSources[b.source]="reload",this.sourceCaches[b.source].pause())}this._updateLayer(b),b.onAdd&&b.onAdd(this.map)}}moveLayer(n,s){if(this._checkLoaded(),this._changed=!0,!this._layers[n])return void this.fire(new u.j(new Error(`The layer '${n}' does not exist in the map's style and cannot be moved.`)));if(n===s)return;const m=this._order.indexOf(n);this._order.splice(m,1);const y=s?this._order.indexOf(s):this._order.length;s&&y===-1?this.fire(new u.j(new Error(`Cannot move layer "${n}" before non-existing layer "${s}".`))):(this._order.splice(y,0,n),this._layerOrderChanged=!0)}removeLayer(n){this._checkLoaded();const s=this._layers[n];if(!s)return void this.fire(new u.j(new Error(`Cannot remove non-existing layer "${n}".`)));s.setEventedParent(null);const m=this._order.indexOf(n);this._order.splice(m,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[n]=s,delete this._layers[n],this._serializedLayers&&delete this._serializedLayers[n],delete this._updatedLayers[n],delete this._updatedPaintProps[n],s.onRemove&&s.onRemove(this.map)}getLayer(n){return this._layers[n]}getLayersOrder(){return[...this._order]}hasLayer(n){return n in this._layers}setLayerZoomRange(n,s,m){this._checkLoaded();const y=this.getLayer(n);y?y.minzoom===s&&y.maxzoom===m||(s!=null&&(y.minzoom=s),m!=null&&(y.maxzoom=m),this._updateLayer(y)):this.fire(new u.j(new Error(`Cannot set the zoom range of non-existing layer "${n}".`)))}setFilter(n,s,m={}){this._checkLoaded();const y=this.getLayer(n);if(y){if(!u.bz(y.filter,s))return s==null?(y.filter=void 0,void this._updateLayer(y)):void(this._validate(u.u.filter,`layers.${y.id}.filter`,s,null,m)||(y.filter=u.bw(s),this._updateLayer(y)))}else this.fire(new u.j(new Error(`Cannot filter non-existing layer "${n}".`)))}getFilter(n){return u.bw(this.getLayer(n).filter)}setLayoutProperty(n,s,m,y={}){this._checkLoaded();const b=this.getLayer(n);b?u.bz(b.getLayoutProperty(s),m)||(b.setLayoutProperty(s,m,y),this._updateLayer(b)):this.fire(new u.j(new Error(`Cannot style non-existing layer "${n}".`)))}getLayoutProperty(n,s){const m=this.getLayer(n);if(m)return m.getLayoutProperty(s);this.fire(new u.j(new Error(`Cannot get style of non-existing layer "${n}".`)))}setPaintProperty(n,s,m,y={}){this._checkLoaded();const b=this.getLayer(n);b?u.bz(b.getPaintProperty(s),m)||(b.setPaintProperty(s,m,y)&&this._updateLayer(b),this._changed=!0,this._updatedPaintProps[n]=!0,this._serializedLayers=null):this.fire(new u.j(new Error(`Cannot style non-existing layer "${n}".`)))}getPaintProperty(n,s){return this.getLayer(n).getPaintProperty(s)}setFeatureState(n,s){this._checkLoaded();const m=n.source,y=n.sourceLayer,b=this.sourceCaches[m];if(b===void 0)return void this.fire(new u.j(new Error(`The source '${m}' does not exist in the map's style.`)));const I=b.getSource().type;I==="geojson"&&y?this.fire(new u.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):I!=="vector"||y?(n.id===void 0&&this.fire(new u.j(new Error("The feature id parameter must be provided."))),b.setFeatureState(y,n.id,s)):this.fire(new u.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(n,s){this._checkLoaded();const m=n.source,y=this.sourceCaches[m];if(y===void 0)return void this.fire(new u.j(new Error(`The source '${m}' does not exist in the map's style.`)));const b=y.getSource().type,I=b==="vector"?n.sourceLayer:void 0;b!=="vector"||I?s&&typeof n.id!="string"&&typeof n.id!="number"?this.fire(new u.j(new Error("A feature id is required to remove its specific state property."))):y.removeFeatureState(I,n.id,s):this.fire(new u.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(n){this._checkLoaded();const s=n.source,m=n.sourceLayer,y=this.sourceCaches[s];if(y!==void 0)return y.getSource().type!=="vector"||m?(n.id===void 0&&this.fire(new u.j(new Error("The feature id parameter must be provided."))),y.getFeatureState(m,n.id)):void this.fire(new u.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new u.j(new Error(`The source '${s}' does not exist in the map's style.`)))}getTransition(){return u.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const n=u.bA(this.sourceCaches,b=>b.serialize()),s=this._serializeByIds(this._order,!0),m=this.map.getTerrain()||void 0,y=this.stylesheet;return u.bB({version:y.version,name:y.name,metadata:y.metadata,light:y.light,sky:y.sky,center:y.center,zoom:y.zoom,bearing:y.bearing,pitch:y.pitch,sprite:y.sprite,glyphs:y.glyphs,transition:y.transition,projection:y.projection,sources:n,layers:s,terrain:m},b=>b!==void 0)}_updateLayer(n){this._updatedLayers[n.id]=!0,n.source&&!this._updatedSources[n.source]&&this.sourceCaches[n.source].getSource().type!=="raster"&&(this._updatedSources[n.source]="reload",this.sourceCaches[n.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(n){const s=I=>this._layers[I].type==="fill-extrusion",m={},y=[];for(let I=this._order.length-1;I>=0;I--){const M=this._order[I];if(s(M)){m[M]=I;for(const z of n){const B=z[M];if(B)for(const q of B)y.push(q)}}}y.sort((I,M)=>M.intersectionZ-I.intersectionZ);const b=[];for(let I=this._order.length-1;I>=0;I--){const M=this._order[I];if(s(M))for(let z=y.length-1;z>=0;z--){const B=y[z].feature;if(m[B.layer.id]<I)break;b.push(B),y.pop()}else for(const z of n){const B=z[M];if(B)for(const q of B)b.push(q.feature)}}return b}queryRenderedFeatures(n,s,m){s&&s.filter&&this._validate(u.u.filter,"queryRenderedFeatures.filter",s.filter,null,s);const y={};if(s&&s.layers){if(!(Array.isArray(s.layers)||s.layers instanceof Set))return this.fire(new u.j(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const B of s.layers){const q=this._layers[B];if(!q)return this.fire(new u.j(new Error(`The layer '${B}' does not exist in the map's style and cannot be queried for features.`))),[];y[q.source]=!0}}const b=[];s.availableImages=this._availableImages;const I=this._serializedAllLayers(),M=s.layers instanceof Set?s.layers:Array.isArray(s.layers)?new Set(s.layers):null,z=Object.assign(Object.assign({},s),{layers:M});for(const B in this.sourceCaches)s.layers&&!y[B]||b.push(ur(this.sourceCaches[B],this._layers,I,n,z,m));return this.placement&&b.push(function(B,q,W,K,oe,le,we){const ge={},Te=le.queryRenderedSymbols(K),Ie=[];for(const Re of Object.keys(Te).map(Number))Ie.push(we[Re]);Ie.sort(Ji);for(const Re of Ie){const ze=Re.featureIndex.lookupSymbolFeatures(Te[Re.bucketInstanceId],q,Re.bucketIndex,Re.sourceLayerIndex,oe.filter,oe.layers,oe.availableImages,B);for(const Fe in ze){const Ve=ge[Fe]=ge[Fe]||[],Ne=ze[Fe];Ne.sort((Qe,Je)=>{const yt=Re.featureSortOrder;if(yt){const xt=yt.indexOf(Qe.featureIndex);return yt.indexOf(Je.featureIndex)-xt}return Je.featureIndex-Qe.featureIndex});for(const Qe of Ne)Ve.push(Qe)}}return function(Re,ze,Fe){for(const Ve in Re)for(const Ne of Re[Ve])Ui(Ne,Fe[ze[Ve].source]);return Re}(ge,B,W)}(this._layers,I,this.sourceCaches,n,z,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(b)}querySourceFeatures(n,s){s&&s.filter&&this._validate(u.u.filter,"querySourceFeatures.filter",s.filter,null,s);const m=this.sourceCaches[n];return m?function(y,b){const I=y.getRenderableIds().map(B=>y.getTileByID(B)),M=[],z={};for(let B=0;B<I.length;B++){const q=I[B],W=q.tileID.canonical.key;z[W]||(z[W]=!0,q.querySourceFeatures(M,b))}return M}(m,s):[]}getLight(){return this.light.getLight()}setLight(n,s={}){this._checkLoaded();const m=this.light.getLight();let y=!1;for(const I in n)if(!u.bz(n[I],m[I])){y=!0;break}if(!y)return;const b={now:re.now(),transition:u.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(n,s),this.light.updateTransitions(b)}getProjection(){var n;return(n=this.stylesheet)===null||n===void 0?void 0:n.projection}setProjection(n){if(this._checkLoaded(),this.projection){if(this.projection.name===n.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=n,this._setProjectionInternal(n.type)}getSky(){var n;return(n=this.stylesheet)===null||n===void 0?void 0:n.sky}setSky(n,s={}){this._checkLoaded();const m=this.getSky();let y=!1;if(!n&&!m)return;if(n&&!m)y=!0;else if(!n&&m)y=!0;else for(const I in n)if(!u.bz(n[I],m[I])){y=!0;break}if(!y)return;const b={now:re.now(),transition:u.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=n,this.sky.setSky(n,s),this.sky.updateTransitions(b)}_setProjectionInternal(n){const s=function(m){if(Array.isArray(m)){const y=new Ga({type:m});return{projection:y,transform:new Io,cameraHelper:new Ws(y)}}switch(m){case"mercator":return{projection:new Gr,transform:new fo,cameraHelper:new fl};case"globe":{const y=new Ga({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:y,transform:new Io,cameraHelper:new Ws(y)}}case"vertical-perspective":return{projection:new ml,transform:new As,cameraHelper:new tr};default:return u.w(`Unknown projection name: ${m}. Falling back to mercator projection.`),{projection:new Gr,transform:new fo,cameraHelper:new fl}}}(n);this.projection=s.projection,this.map.migrateProjection(s.transform,s.cameraHelper);for(const m in this.sourceCaches)this.sourceCaches[m].reload()}_validate(n,s,m,y,b={}){return(!b||b.validate!==!1)&&Ks(this,n.call(u.u,u.e({key:s,style:this.serialize(),value:m,styleSpec:u.v},y)))}_remove(n=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),qr().off(Hs,this._rtlPluginLoaded);for(const s in this._layers)this._layers[s].setEventedParent(null);for(const s in this.sourceCaches){const m=this.sourceCaches[s];m.setEventedParent(null),m.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),n&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(n)}_clearSource(n){this.sourceCaches[n].clearTiles()}_reloadSource(n){this.sourceCaches[n].resume(),this.sourceCaches[n].reload()}_updateSources(n){for(const s in this.sourceCaches)this.sourceCaches[s].update(n,this.map.terrain)}_generateCollisionBoxes(){for(const n in this.sourceCaches)this._reloadSource(n)}_updatePlacement(n,s,m,y,b=!1){let I=!1,M=!1;const z={};for(const B of this._order){const q=this._layers[B];if(q.type!=="symbol")continue;if(!z[q.source]){const K=this.sourceCaches[q.source];z[q.source]=K.getRenderableIds(!0).map(oe=>K.getTileByID(oe)).sort((oe,le)=>le.tileID.overscaledZ-oe.tileID.overscaledZ||(oe.tileID.isLessThan(le.tileID)?-1:1))}const W=this.crossTileSymbolIndex.addLayer(q,z[q.source],n.center.lng);I=I||W}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((b=b||this._layerOrderChanged||m===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(re.now(),n.zoom))&&(this.pauseablePlacement=new pl(n,this.map.terrain,this._order,b,s,m,y,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,z),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(re.now()),M=!0),I&&this.pauseablePlacement.placement.setStale()),M||I)for(const B of this._order){const q=this._layers[B];q.type==="symbol"&&this.placement.updateLayerOpacities(q,z[q.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(re.now())}_releaseSymbolFadeTiles(){for(const n in this.sourceCaches)this.sourceCaches[n].releaseSymbolFadeTiles()}getImages(n,s){return u._(this,void 0,void 0,function*(){const m=yield this.imageManager.getImages(s.icons);this._updateTilesForChangedImages();const y=this.sourceCaches[s.source];return y&&y.setDependencies(s.tileID.key,s.type,s.icons),m})}getGlyphs(n,s){return u._(this,void 0,void 0,function*(){const m=yield this.glyphManager.getGlyphs(s.stacks),y=this.sourceCaches[s.source];return y&&y.setDependencies(s.tileID.key,s.type,[""]),m})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(n,s={}){this._checkLoaded(),n&&this._validate(u.u.glyphs,"glyphs",n,null,s)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=n,this.glyphManager.entries={},this.glyphManager.setURL(n))}addSprite(n,s,m={},y){this._checkLoaded();const b=[{id:n,url:s}],I=[...at(this.stylesheet.sprite),...b];this._validate(u.u.sprite,"sprite",I,null,m)||(this.stylesheet.sprite=I,this._loadSprite(b,!0,y))}removeSprite(n){this._checkLoaded();const s=at(this.stylesheet.sprite);if(s.find(m=>m.id===n)){if(this._spritesImagesIds[n])for(const m of this._spritesImagesIds[n])this.imageManager.removeImage(m),this._changedImages[m]=!0;s.splice(s.findIndex(m=>m.id===n),1),this.stylesheet.sprite=s.length>0?s:void 0,delete this._spritesImagesIds[n],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new u.k("data",{dataType:"style"}))}else this.fire(new u.j(new Error(`Sprite "${n}" doesn't exists on this map.`)))}getSprite(){return at(this.stylesheet.sprite)}setSprite(n,s={},m){this._checkLoaded(),n&&this._validate(u.u.sprite,"sprite",n,null,s)||(this.stylesheet.sprite=n,n?this._loadSprite(n,!0,m):(this._unloadSprite(),m&&m(null)))}}var Ul=u.aA([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class jl{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(n,s,m,y,b,I,M,z,B){this.context=n;let q=this.boundPaintVertexBuffers.length!==y.length;for(let W=0;!q&&W<y.length;W++)this.boundPaintVertexBuffers[W]!==y[W]&&(q=!0);!this.vao||this.boundProgram!==s||this.boundLayoutVertexBuffer!==m||q||this.boundIndexBuffer!==b||this.boundVertexOffset!==I||this.boundDynamicVertexBuffer!==M||this.boundDynamicVertexBuffer2!==z||this.boundDynamicVertexBuffer3!==B?this.freshBind(s,m,y,b,I,M,z,B):(n.bindVertexArray.set(this.vao),M&&M.bind(),b&&b.dynamicDraw&&b.bind(),z&&z.bind(),B&&B.bind())}freshBind(n,s,m,y,b,I,M,z){const B=n.numAttributes,q=this.context,W=q.gl;this.vao&&this.destroy(),this.vao=q.createVertexArray(),q.bindVertexArray.set(this.vao),this.boundProgram=n,this.boundLayoutVertexBuffer=s,this.boundPaintVertexBuffers=m,this.boundIndexBuffer=y,this.boundVertexOffset=b,this.boundDynamicVertexBuffer=I,this.boundDynamicVertexBuffer2=M,this.boundDynamicVertexBuffer3=z,s.enableAttributes(W,n);for(const K of m)K.enableAttributes(W,n);I&&I.enableAttributes(W,n),M&&M.enableAttributes(W,n),z&&z.enableAttributes(W,n),s.bind(),s.setVertexAttribPointers(W,n,b);for(const K of m)K.bind(),K.setVertexAttribPointers(W,n,b);I&&(I.bind(),I.setVertexAttribPointers(W,n,b)),y&&y.bind(),M&&(M.bind(),M.setVertexAttribPointers(W,n,b)),z&&(z.bind(),z.setVertexAttribPointers(W,n,b)),q.currentNumAttributes=B}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const as=(w,n,s,m,y)=>({u_texture:0,u_ele_delta:w,u_fog_matrix:n,u_fog_color:s?s.properties.get("fog-color"):u.b4.white,u_fog_ground_blend:s?s.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:y?0:s?s.calculateFogBlendOpacity(m):0,u_horizon_color:s?s.properties.get("horizon-color"):u.b4.white,u_horizon_fog_blend:s?s.properties.get("horizon-fog-blend"):1,u_is_globe_mode:y?1:0}),_l={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function Za(w){const n=[];for(let s=0;s<w.length;s++){if(w[s]===null)continue;const m=w[s].split(" ");n.push(m.pop())}return n}class $l{constructor(n,s,m,y,b,I,M,z){const B=n.gl;this.program=B.createProgram();const q=Za(s.staticAttributes),W=m?m.getBinderAttributes():[],K=q.concat(W),oe=Sr.prelude.staticUniforms?Za(Sr.prelude.staticUniforms):[],le=M.staticUniforms?Za(M.staticUniforms):[],we=s.staticUniforms?Za(s.staticUniforms):[],ge=m?m.getBinderUniforms():[],Te=oe.concat(le).concat(we).concat(ge),Ie=[];for(const Je of Te)Ie.indexOf(Je)<0&&Ie.push(Je);const Re=m?m.defines():[];Xi(B)&&Re.unshift("#version 300 es"),b&&Re.push("#define OVERDRAW_INSPECTOR;"),I&&Re.push("#define TERRAIN3D;"),z&&Re.push(z);let ze=Re.concat(Sr.prelude.fragmentSource,M.fragmentSource,s.fragmentSource).join(`
`),Fe=Re.concat(Sr.prelude.vertexSource,M.vertexSource,s.vertexSource).join(`
`);Xi(B)||(ze=function(Je){return Je.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")}(ze),Fe=function(Je){return Je.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")}(Fe));const Ve=B.createShader(B.FRAGMENT_SHADER);if(B.isContextLost())return void(this.failedToCreate=!0);if(B.shaderSource(Ve,ze),B.compileShader(Ve),!B.getShaderParameter(Ve,B.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${B.getShaderInfoLog(Ve)}`);B.attachShader(this.program,Ve);const Ne=B.createShader(B.VERTEX_SHADER);if(B.isContextLost())return void(this.failedToCreate=!0);if(B.shaderSource(Ne,Fe),B.compileShader(Ne),!B.getShaderParameter(Ne,B.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${B.getShaderInfoLog(Ne)}`);B.attachShader(this.program,Ne),this.attributes={};const Qe={};this.numAttributes=K.length;for(let Je=0;Je<this.numAttributes;Je++)K[Je]&&(B.bindAttribLocation(this.program,Je,K[Je]),this.attributes[K[Je]]=Je);if(B.linkProgram(this.program),!B.getProgramParameter(this.program,B.LINK_STATUS))throw new Error(`Program failed to link: ${B.getProgramInfoLog(this.program)}`);B.deleteShader(Ne),B.deleteShader(Ve);for(let Je=0;Je<Ie.length;Je++){const yt=Ie[Je];if(yt&&!Qe[yt]){const xt=B.getUniformLocation(this.program,yt);xt&&(Qe[yt]=xt)}}this.fixedUniforms=y(n,Qe),this.terrainUniforms=((Je,yt)=>({u_depth:new u.bC(Je,yt.u_depth),u_terrain:new u.bC(Je,yt.u_terrain),u_terrain_dim:new u.b5(Je,yt.u_terrain_dim),u_terrain_matrix:new u.bD(Je,yt.u_terrain_matrix),u_terrain_unpack:new u.bE(Je,yt.u_terrain_unpack),u_terrain_exaggeration:new u.b5(Je,yt.u_terrain_exaggeration)}))(n,Qe),this.projectionUniforms=((Je,yt)=>({u_projection_matrix:new u.bD(Je,yt.u_projection_matrix),u_projection_tile_mercator_coords:new u.bE(Je,yt.u_projection_tile_mercator_coords),u_projection_clipping_plane:new u.bE(Je,yt.u_projection_clipping_plane),u_projection_transition:new u.b5(Je,yt.u_projection_transition),u_projection_fallback_matrix:new u.bD(Je,yt.u_projection_fallback_matrix)}))(n,Qe),this.binderUniforms=m?m.getUniforms(n,Qe):[]}draw(n,s,m,y,b,I,M,z,B,q,W,K,oe,le,we,ge,Te,Ie,Re){const ze=n.gl;if(this.failedToCreate)return;if(n.program.set(this.program),n.setDepthMode(m),n.setStencilMode(y),n.setColorMode(b),n.setCullFace(I),z){n.activeTexture.set(ze.TEXTURE2),ze.bindTexture(ze.TEXTURE_2D,z.depthTexture),n.activeTexture.set(ze.TEXTURE3),ze.bindTexture(ze.TEXTURE_2D,z.texture);for(const Ve in this.terrainUniforms)this.terrainUniforms[Ve].set(z[Ve])}if(B)for(const Ve in B)this.projectionUniforms[_l[Ve]].set(B[Ve]);if(M)for(const Ve in this.fixedUniforms)this.fixedUniforms[Ve].set(M[Ve]);ge&&ge.setUniforms(n,this.binderUniforms,le,{zoom:we});let Fe=0;switch(s){case ze.LINES:Fe=2;break;case ze.TRIANGLES:Fe=3;break;case ze.LINE_STRIP:Fe=1}for(const Ve of oe.get()){const Ne=Ve.vaos||(Ve.vaos={});(Ne[q]||(Ne[q]=new jl)).bind(n,this,W,ge?ge.getPaintVertexBuffers():[],K,Ve.vertexOffset,Te,Ie,Re),ze.drawElements(s,Ve.primitiveLength*Fe,ze.UNSIGNED_SHORT,Ve.primitiveOffset*Fe*2)}}}function Hl(w,n,s){const m=1/u.at(s,1,n.transform.tileZoom),y=Math.pow(2,s.tileID.overscaledZ),b=s.tileSize*Math.pow(2,n.transform.tileZoom)/y,I=b*(s.tileID.canonical.x+s.tileID.wrap*y),M=b*s.tileID.canonical.y;return{u_image:0,u_texsize:s.imageAtlasTexture.size,u_scale:[m,w.fromScale,w.toScale],u_fade:w.t,u_pixel_coord_upper:[I>>16,M>>16],u_pixel_coord_lower:[65535&I,65535&M]}}const ls=(w,n,s,m)=>{const y=w.style.light,b=y.properties.get("position"),I=[b.x,b.y,b.z],M=u.bI();y.properties.get("anchor")==="viewport"&&u.bJ(M,w.transform.bearingInRadians),u.bK(I,I,M);const z=w.transform.transformLightDirection(I),B=y.properties.get("color");return{u_lightpos:I,u_lightpos_globe:z,u_lightintensity:y.properties.get("intensity"),u_lightcolor:[B.r,B.g,B.b],u_vertical_gradient:+n,u_opacity:s,u_fill_translate:m}},Wr=(w,n,s,m,y,b,I)=>u.e(ls(w,n,s,m),Hl(b,w,I),{u_height_factor:-Math.pow(2,y.overscaledZ)/I.tileSize/8}),ks=(w,n,s,m)=>u.e(Hl(n,w,s),{u_fill_translate:m}),Pc=(w,n)=>({u_world:w,u_fill_translate:n}),Po=(w,n,s,m,y)=>u.e(ks(w,n,s,y),{u_world:m}),P=(w,n,s,m,y)=>{const b=w.transform;let I,M,z=0;if(s.paint.get("circle-pitch-alignment")==="map"){const B=u.at(n,1,b.zoom);I=!0,M=[B,B],z=B/(u.X*Math.pow(2,n.tileID.overscaledZ))*2*Math.PI*y}else I=!1,M=b.pixelsToGLUnits;return{u_camera_to_center_distance:b.cameraToCenterDistance,u_scale_with_map:+(s.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+I,u_device_pixel_ratio:w.pixelRatio,u_extrude_scale:M,u_globe_extrude_scale:z,u_translate:m}},j=w=>({u_pixel_extrude_scale:[1/w.width,1/w.height]}),Y=w=>({u_viewport_size:[w.width,w.height]}),ye=(w,n=1)=>({u_color:w,u_overlay:0,u_overlay_scale:n}),nt=(w,n,s,m)=>{const y=u.at(w,1,n)/(u.X*Math.pow(2,w.tileID.overscaledZ))*2*Math.PI*m;return{u_extrude_scale:u.at(w,1,n),u_intensity:s,u_globe_extrude_scale:y}},ft=(w,n,s,m)=>{const y=u.H();u.bL(y,0,w.width,w.height,0,0,1);const b=w.context.gl;return{u_matrix:y,u_world:[b.drawingBufferWidth,b.drawingBufferHeight],u_image:s,u_color_ramp:m,u_opacity:n.paint.get("heatmap-opacity")}},Zt=(w,n,s)=>{const m=s.paint.get("hillshade-shadow-color"),y=s.paint.get("hillshade-highlight-color"),b=s.paint.get("hillshade-accent-color");let I=s.paint.get("hillshade-illumination-direction")*(Math.PI/180);return s.paint.get("hillshade-illumination-anchor")==="viewport"&&(I+=w.transform.bearingInRadians),{u_image:0,u_latrange:cr(0,n.tileID),u_light:[s.paint.get("hillshade-exaggeration"),I],u_shadow:m,u_highlight:y,u_accent:b}},Pi=(w,n)=>{const s=n.stride,m=u.H();return u.bL(m,0,u.X,-8192,0,0,1),u.J(m,m,[0,-8192,0]),{u_matrix:m,u_image:1,u_dimension:[s,s],u_zoom:w.overscaledZ,u_unpack:n.getUnpackVector()}};function cr(w,n){const s=Math.pow(2,n.canonical.z),m=n.canonical.y;return[new u.Y(0,m/s).toLngLat().lat,new u.Y(0,(m+1)/s).toLngLat().lat]}const ai=(w,n,s,m)=>{const y=w.transform;return{u_translation:Wa(w,n,s),u_ratio:m/u.at(n,1,y.zoom),u_device_pixel_ratio:w.pixelRatio,u_units_to_pixels:[1/y.pixelsToGLUnits[0],1/y.pixelsToGLUnits[1]]}},wi=(w,n,s,m,y)=>u.e(ai(w,n,s,m),{u_image:0,u_image_height:y}),sr=(w,n,s,m,y)=>{const b=w.transform,I=gr(n,b);return{u_translation:Wa(w,n,s),u_texsize:n.imageAtlasTexture.size,u_ratio:m/u.at(n,1,b.zoom),u_device_pixel_ratio:w.pixelRatio,u_image:0,u_scale:[I,y.fromScale,y.toScale],u_fade:y.t,u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]]}},Ms=(w,n,s,m,y,b)=>{const I=w.lineAtlas,M=gr(n,w.transform),z=s.layout.get("line-cap")==="round",B=I.getDash(y.from,z),q=I.getDash(y.to,z),W=B.width*b.fromScale,K=q.width*b.toScale;return u.e(ai(w,n,s,m),{u_patternscale_a:[M/W,-B.height/2],u_patternscale_b:[M/K,-q.height/2],u_sdfgamma:I.width/(256*Math.min(W,K)*w.pixelRatio)/2,u_image:0,u_tex_y_a:B.y,u_tex_y_b:q.y,u_mix:b.t})};function gr(w,n){return 1/u.at(w,1,n.tileZoom)}function Wa(w,n,s){return u.au(w.transform,n,s.paint.get("line-translate"),s.paint.get("line-translate-anchor"))}const Rs=(w,n,s,m,y)=>{return{u_tl_parent:w,u_scale_parent:n,u_buffer_scale:1,u_fade_t:s.mix,u_opacity:s.opacity*m.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:m.paint.get("raster-brightness-min"),u_brightness_high:m.paint.get("raster-brightness-max"),u_saturation_factor:(I=m.paint.get("raster-saturation"),I>0?1-1/(1.001-I):-I),u_contrast_factor:(b=m.paint.get("raster-contrast"),b>0?1/(1-b):1+b),u_spin_weights:Cc(m.paint.get("raster-hue-rotate")),u_coords_top:[y[0].x,y[0].y,y[1].x,y[1].y],u_coords_bottom:[y[3].x,y[3].y,y[2].x,y[2].y]};var b,I};function Cc(w){w*=Math.PI/180;const n=Math.sin(w),s=Math.cos(w);return[(2*s+1)/3,(-Math.sqrt(3)*n-s+1)/3,(Math.sqrt(3)*n-s+1)/3]}const yl=(w,n,s,m,y,b,I,M,z,B,q,W,K)=>{const oe=I.transform;return{u_is_size_zoom_constant:+(w==="constant"||w==="source"),u_is_size_feature_constant:+(w==="constant"||w==="camera"),u_size_t:n?n.uSizeT:0,u_size:n?n.uSize:0,u_camera_to_center_distance:oe.cameraToCenterDistance,u_pitch:oe.pitch/360*2*Math.PI,u_rotate_symbol:+s,u_aspect_ratio:oe.width/oe.height,u_fade_change:I.options.fadeDuration?I.symbolFadeChange:1,u_label_plane_matrix:M,u_coord_matrix:z,u_is_text:+q,u_pitch_with_map:+m,u_is_along_line:y,u_is_variable_anchor:b,u_texsize:W,u_texture:0,u_translation:B,u_pitched_scale:K}},ql=(w,n,s,m,y,b,I,M,z,B,q,W,K,oe)=>{const le=I.transform;return u.e(yl(w,n,s,m,y,b,I,M,z,B,q,W,oe),{u_gamma_scale:m?Math.cos(le.pitch*Math.PI/180)*le.cameraToCenterDistance:1,u_device_pixel_ratio:I.pixelRatio,u_is_halo:1})},io=(w,n,s,m,y,b,I,M,z,B,q,W,K)=>u.e(ql(w,n,s,m,y,b,I,M,z,B,!0,q,0,K),{u_texsize_icon:W,u_texture_icon:1}),yh=(w,n)=>({u_opacity:w,u_color:n}),Sa=(w,n,s,m,y)=>u.e(function(b,I,M,z){const B=M.imageManager.getPattern(b.from.toString()),q=M.imageManager.getPattern(b.to.toString()),{width:W,height:K}=M.imageManager.getPixelSize(),oe=Math.pow(2,z.tileID.overscaledZ),le=z.tileSize*Math.pow(2,M.transform.tileZoom)/oe,we=le*(z.tileID.canonical.x+z.tileID.wrap*oe),ge=le*z.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:B.tl,u_pattern_br_a:B.br,u_pattern_tl_b:q.tl,u_pattern_br_b:q.br,u_texsize:[W,K],u_mix:I.t,u_pattern_size_a:B.displaySize,u_pattern_size_b:q.displaySize,u_scale_a:I.fromScale,u_scale_b:I.toScale,u_tile_units_to_pixels:1/u.at(z,1,M.transform.tileZoom),u_pixel_coord_upper:[we>>16,ge>>16],u_pixel_coord_lower:[65535&we,65535&ge]}}(s,y,n,m),{u_opacity:w}),Gl=(w,n)=>{},vh={fillExtrusion:(w,n)=>({u_lightpos:new u.bG(w,n.u_lightpos),u_lightpos_globe:new u.bG(w,n.u_lightpos_globe),u_lightintensity:new u.b5(w,n.u_lightintensity),u_lightcolor:new u.bG(w,n.u_lightcolor),u_vertical_gradient:new u.b5(w,n.u_vertical_gradient),u_opacity:new u.b5(w,n.u_opacity),u_fill_translate:new u.bH(w,n.u_fill_translate)}),fillExtrusionPattern:(w,n)=>({u_lightpos:new u.bG(w,n.u_lightpos),u_lightpos_globe:new u.bG(w,n.u_lightpos_globe),u_lightintensity:new u.b5(w,n.u_lightintensity),u_lightcolor:new u.bG(w,n.u_lightcolor),u_vertical_gradient:new u.b5(w,n.u_vertical_gradient),u_height_factor:new u.b5(w,n.u_height_factor),u_opacity:new u.b5(w,n.u_opacity),u_fill_translate:new u.bH(w,n.u_fill_translate),u_image:new u.bC(w,n.u_image),u_texsize:new u.bH(w,n.u_texsize),u_pixel_coord_upper:new u.bH(w,n.u_pixel_coord_upper),u_pixel_coord_lower:new u.bH(w,n.u_pixel_coord_lower),u_scale:new u.bG(w,n.u_scale),u_fade:new u.b5(w,n.u_fade)}),fill:(w,n)=>({u_fill_translate:new u.bH(w,n.u_fill_translate)}),fillPattern:(w,n)=>({u_image:new u.bC(w,n.u_image),u_texsize:new u.bH(w,n.u_texsize),u_pixel_coord_upper:new u.bH(w,n.u_pixel_coord_upper),u_pixel_coord_lower:new u.bH(w,n.u_pixel_coord_lower),u_scale:new u.bG(w,n.u_scale),u_fade:new u.b5(w,n.u_fade),u_fill_translate:new u.bH(w,n.u_fill_translate)}),fillOutline:(w,n)=>({u_world:new u.bH(w,n.u_world),u_fill_translate:new u.bH(w,n.u_fill_translate)}),fillOutlinePattern:(w,n)=>({u_world:new u.bH(w,n.u_world),u_image:new u.bC(w,n.u_image),u_texsize:new u.bH(w,n.u_texsize),u_pixel_coord_upper:new u.bH(w,n.u_pixel_coord_upper),u_pixel_coord_lower:new u.bH(w,n.u_pixel_coord_lower),u_scale:new u.bG(w,n.u_scale),u_fade:new u.b5(w,n.u_fade),u_fill_translate:new u.bH(w,n.u_fill_translate)}),circle:(w,n)=>({u_camera_to_center_distance:new u.b5(w,n.u_camera_to_center_distance),u_scale_with_map:new u.bC(w,n.u_scale_with_map),u_pitch_with_map:new u.bC(w,n.u_pitch_with_map),u_extrude_scale:new u.bH(w,n.u_extrude_scale),u_device_pixel_ratio:new u.b5(w,n.u_device_pixel_ratio),u_globe_extrude_scale:new u.b5(w,n.u_globe_extrude_scale),u_translate:new u.bH(w,n.u_translate)}),collisionBox:(w,n)=>({u_pixel_extrude_scale:new u.bH(w,n.u_pixel_extrude_scale)}),collisionCircle:(w,n)=>({u_viewport_size:new u.bH(w,n.u_viewport_size)}),debug:(w,n)=>({u_color:new u.bF(w,n.u_color),u_overlay:new u.bC(w,n.u_overlay),u_overlay_scale:new u.b5(w,n.u_overlay_scale)}),depth:Gl,clippingMask:Gl,heatmap:(w,n)=>({u_extrude_scale:new u.b5(w,n.u_extrude_scale),u_intensity:new u.b5(w,n.u_intensity),u_globe_extrude_scale:new u.b5(w,n.u_globe_extrude_scale)}),heatmapTexture:(w,n)=>({u_matrix:new u.bD(w,n.u_matrix),u_world:new u.bH(w,n.u_world),u_image:new u.bC(w,n.u_image),u_color_ramp:new u.bC(w,n.u_color_ramp),u_opacity:new u.b5(w,n.u_opacity)}),hillshade:(w,n)=>({u_image:new u.bC(w,n.u_image),u_latrange:new u.bH(w,n.u_latrange),u_light:new u.bH(w,n.u_light),u_shadow:new u.bF(w,n.u_shadow),u_highlight:new u.bF(w,n.u_highlight),u_accent:new u.bF(w,n.u_accent)}),hillshadePrepare:(w,n)=>({u_matrix:new u.bD(w,n.u_matrix),u_image:new u.bC(w,n.u_image),u_dimension:new u.bH(w,n.u_dimension),u_zoom:new u.b5(w,n.u_zoom),u_unpack:new u.bE(w,n.u_unpack)}),line:(w,n)=>({u_translation:new u.bH(w,n.u_translation),u_ratio:new u.b5(w,n.u_ratio),u_device_pixel_ratio:new u.b5(w,n.u_device_pixel_ratio),u_units_to_pixels:new u.bH(w,n.u_units_to_pixels)}),lineGradient:(w,n)=>({u_translation:new u.bH(w,n.u_translation),u_ratio:new u.b5(w,n.u_ratio),u_device_pixel_ratio:new u.b5(w,n.u_device_pixel_ratio),u_units_to_pixels:new u.bH(w,n.u_units_to_pixels),u_image:new u.bC(w,n.u_image),u_image_height:new u.b5(w,n.u_image_height)}),linePattern:(w,n)=>({u_translation:new u.bH(w,n.u_translation),u_texsize:new u.bH(w,n.u_texsize),u_ratio:new u.b5(w,n.u_ratio),u_device_pixel_ratio:new u.b5(w,n.u_device_pixel_ratio),u_image:new u.bC(w,n.u_image),u_units_to_pixels:new u.bH(w,n.u_units_to_pixels),u_scale:new u.bG(w,n.u_scale),u_fade:new u.b5(w,n.u_fade)}),lineSDF:(w,n)=>({u_translation:new u.bH(w,n.u_translation),u_ratio:new u.b5(w,n.u_ratio),u_device_pixel_ratio:new u.b5(w,n.u_device_pixel_ratio),u_units_to_pixels:new u.bH(w,n.u_units_to_pixels),u_patternscale_a:new u.bH(w,n.u_patternscale_a),u_patternscale_b:new u.bH(w,n.u_patternscale_b),u_sdfgamma:new u.b5(w,n.u_sdfgamma),u_image:new u.bC(w,n.u_image),u_tex_y_a:new u.b5(w,n.u_tex_y_a),u_tex_y_b:new u.b5(w,n.u_tex_y_b),u_mix:new u.b5(w,n.u_mix)}),raster:(w,n)=>({u_tl_parent:new u.bH(w,n.u_tl_parent),u_scale_parent:new u.b5(w,n.u_scale_parent),u_buffer_scale:new u.b5(w,n.u_buffer_scale),u_fade_t:new u.b5(w,n.u_fade_t),u_opacity:new u.b5(w,n.u_opacity),u_image0:new u.bC(w,n.u_image0),u_image1:new u.bC(w,n.u_image1),u_brightness_low:new u.b5(w,n.u_brightness_low),u_brightness_high:new u.b5(w,n.u_brightness_high),u_saturation_factor:new u.b5(w,n.u_saturation_factor),u_contrast_factor:new u.b5(w,n.u_contrast_factor),u_spin_weights:new u.bG(w,n.u_spin_weights),u_coords_top:new u.bE(w,n.u_coords_top),u_coords_bottom:new u.bE(w,n.u_coords_bottom)}),symbolIcon:(w,n)=>({u_is_size_zoom_constant:new u.bC(w,n.u_is_size_zoom_constant),u_is_size_feature_constant:new u.bC(w,n.u_is_size_feature_constant),u_size_t:new u.b5(w,n.u_size_t),u_size:new u.b5(w,n.u_size),u_camera_to_center_distance:new u.b5(w,n.u_camera_to_center_distance),u_pitch:new u.b5(w,n.u_pitch),u_rotate_symbol:new u.bC(w,n.u_rotate_symbol),u_aspect_ratio:new u.b5(w,n.u_aspect_ratio),u_fade_change:new u.b5(w,n.u_fade_change),u_label_plane_matrix:new u.bD(w,n.u_label_plane_matrix),u_coord_matrix:new u.bD(w,n.u_coord_matrix),u_is_text:new u.bC(w,n.u_is_text),u_pitch_with_map:new u.bC(w,n.u_pitch_with_map),u_is_along_line:new u.bC(w,n.u_is_along_line),u_is_variable_anchor:new u.bC(w,n.u_is_variable_anchor),u_texsize:new u.bH(w,n.u_texsize),u_texture:new u.bC(w,n.u_texture),u_translation:new u.bH(w,n.u_translation),u_pitched_scale:new u.b5(w,n.u_pitched_scale)}),symbolSDF:(w,n)=>({u_is_size_zoom_constant:new u.bC(w,n.u_is_size_zoom_constant),u_is_size_feature_constant:new u.bC(w,n.u_is_size_feature_constant),u_size_t:new u.b5(w,n.u_size_t),u_size:new u.b5(w,n.u_size),u_camera_to_center_distance:new u.b5(w,n.u_camera_to_center_distance),u_pitch:new u.b5(w,n.u_pitch),u_rotate_symbol:new u.bC(w,n.u_rotate_symbol),u_aspect_ratio:new u.b5(w,n.u_aspect_ratio),u_fade_change:new u.b5(w,n.u_fade_change),u_label_plane_matrix:new u.bD(w,n.u_label_plane_matrix),u_coord_matrix:new u.bD(w,n.u_coord_matrix),u_is_text:new u.bC(w,n.u_is_text),u_pitch_with_map:new u.bC(w,n.u_pitch_with_map),u_is_along_line:new u.bC(w,n.u_is_along_line),u_is_variable_anchor:new u.bC(w,n.u_is_variable_anchor),u_texsize:new u.bH(w,n.u_texsize),u_texture:new u.bC(w,n.u_texture),u_gamma_scale:new u.b5(w,n.u_gamma_scale),u_device_pixel_ratio:new u.b5(w,n.u_device_pixel_ratio),u_is_halo:new u.bC(w,n.u_is_halo),u_translation:new u.bH(w,n.u_translation),u_pitched_scale:new u.b5(w,n.u_pitched_scale)}),symbolTextAndIcon:(w,n)=>({u_is_size_zoom_constant:new u.bC(w,n.u_is_size_zoom_constant),u_is_size_feature_constant:new u.bC(w,n.u_is_size_feature_constant),u_size_t:new u.b5(w,n.u_size_t),u_size:new u.b5(w,n.u_size),u_camera_to_center_distance:new u.b5(w,n.u_camera_to_center_distance),u_pitch:new u.b5(w,n.u_pitch),u_rotate_symbol:new u.bC(w,n.u_rotate_symbol),u_aspect_ratio:new u.b5(w,n.u_aspect_ratio),u_fade_change:new u.b5(w,n.u_fade_change),u_label_plane_matrix:new u.bD(w,n.u_label_plane_matrix),u_coord_matrix:new u.bD(w,n.u_coord_matrix),u_is_text:new u.bC(w,n.u_is_text),u_pitch_with_map:new u.bC(w,n.u_pitch_with_map),u_is_along_line:new u.bC(w,n.u_is_along_line),u_is_variable_anchor:new u.bC(w,n.u_is_variable_anchor),u_texsize:new u.bH(w,n.u_texsize),u_texsize_icon:new u.bH(w,n.u_texsize_icon),u_texture:new u.bC(w,n.u_texture),u_texture_icon:new u.bC(w,n.u_texture_icon),u_gamma_scale:new u.b5(w,n.u_gamma_scale),u_device_pixel_ratio:new u.b5(w,n.u_device_pixel_ratio),u_is_halo:new u.bC(w,n.u_is_halo),u_translation:new u.bH(w,n.u_translation),u_pitched_scale:new u.b5(w,n.u_pitched_scale)}),background:(w,n)=>({u_opacity:new u.b5(w,n.u_opacity),u_color:new u.bF(w,n.u_color)}),backgroundPattern:(w,n)=>({u_opacity:new u.b5(w,n.u_opacity),u_image:new u.bC(w,n.u_image),u_pattern_tl_a:new u.bH(w,n.u_pattern_tl_a),u_pattern_br_a:new u.bH(w,n.u_pattern_br_a),u_pattern_tl_b:new u.bH(w,n.u_pattern_tl_b),u_pattern_br_b:new u.bH(w,n.u_pattern_br_b),u_texsize:new u.bH(w,n.u_texsize),u_mix:new u.b5(w,n.u_mix),u_pattern_size_a:new u.bH(w,n.u_pattern_size_a),u_pattern_size_b:new u.bH(w,n.u_pattern_size_b),u_scale_a:new u.b5(w,n.u_scale_a),u_scale_b:new u.b5(w,n.u_scale_b),u_pixel_coord_upper:new u.bH(w,n.u_pixel_coord_upper),u_pixel_coord_lower:new u.bH(w,n.u_pixel_coord_lower),u_tile_units_to_pixels:new u.b5(w,n.u_tile_units_to_pixels)}),terrain:(w,n)=>({u_texture:new u.bC(w,n.u_texture),u_ele_delta:new u.b5(w,n.u_ele_delta),u_fog_matrix:new u.bD(w,n.u_fog_matrix),u_fog_color:new u.bF(w,n.u_fog_color),u_fog_ground_blend:new u.b5(w,n.u_fog_ground_blend),u_fog_ground_blend_opacity:new u.b5(w,n.u_fog_ground_blend_opacity),u_horizon_color:new u.bF(w,n.u_horizon_color),u_horizon_fog_blend:new u.b5(w,n.u_horizon_fog_blend),u_is_globe_mode:new u.b5(w,n.u_is_globe_mode)}),terrainDepth:(w,n)=>({u_ele_delta:new u.b5(w,n.u_ele_delta)}),terrainCoords:(w,n)=>({u_texture:new u.bC(w,n.u_texture),u_terrain_coords_id:new u.b5(w,n.u_terrain_coords_id),u_ele_delta:new u.b5(w,n.u_ele_delta)}),projectionErrorMeasurement:(w,n)=>({u_input:new u.b5(w,n.u_input),u_output_expected:new u.b5(w,n.u_output_expected)}),atmosphere:(w,n)=>({u_sun_pos:new u.bG(w,n.u_sun_pos),u_atmosphere_blend:new u.b5(w,n.u_atmosphere_blend),u_globe_position:new u.bG(w,n.u_globe_position),u_globe_radius:new u.b5(w,n.u_globe_radius),u_inv_proj_matrix:new u.bD(w,n.u_inv_proj_matrix)}),sky:(w,n)=>({u_sky_color:new u.bF(w,n.u_sky_color),u_horizon_color:new u.bF(w,n.u_horizon_color),u_horizon:new u.bH(w,n.u_horizon),u_horizon_normal:new u.bH(w,n.u_horizon_normal),u_sky_horizon_blend:new u.b5(w,n.u_sky_horizon_blend),u_sky_blend:new u.b5(w,n.u_sky_blend)})};class xu{constructor(n,s,m){this.context=n;const y=n.gl;this.buffer=y.createBuffer(),this.dynamicDraw=!!m,this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),y.bufferData(y.ELEMENT_ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){const s=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Xs={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Co{constructor(n,s,m,y){this.length=s.length,this.attributes=m,this.itemSize=s.bytesPerElement,this.dynamicDraw=y,this.context=n;const b=n.gl;this.buffer=b.createBuffer(),n.bindVertexBuffer.set(this.buffer),b.bufferData(b.ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(n){if(n.length!==this.length)throw new Error(`Length of new data is ${n.length}, which doesn't match current length of ${this.length}`);const s=this.context.gl;this.bind(),s.bufferSubData(s.ARRAY_BUFFER,0,n.arrayBuffer)}enableAttributes(n,s){for(let m=0;m<this.attributes.length;m++){const y=s.attributes[this.attributes[m].name];y!==void 0&&n.enableVertexAttribArray(y)}}setVertexAttribPointers(n,s,m){for(let y=0;y<this.attributes.length;y++){const b=this.attributes[y],I=s.attributes[b.name];I!==void 0&&n.vertexAttribPointer(I,b.components,n[Xs[b.type]],!1,this.itemSize,b.offset+this.itemSize*(m||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class _i{constructor(n){this.gl=n.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(n){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Ka extends _i{getDefault(){return u.b4.transparent}set(n){const s=this.current;(n.r!==s.r||n.g!==s.g||n.b!==s.b||n.a!==s.a||this.dirty)&&(this.gl.clearColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class qd extends _i{getDefault(){return 1}set(n){(n!==this.current||this.dirty)&&(this.gl.clearDepth(n),this.current=n,this.dirty=!1)}}class Ea extends _i{getDefault(){return 0}set(n){(n!==this.current||this.dirty)&&(this.gl.clearStencil(n),this.current=n,this.dirty=!1)}}class Zl extends _i{getDefault(){return[!0,!0,!0,!0]}set(n){const s=this.current;(n[0]!==s[0]||n[1]!==s[1]||n[2]!==s[2]||n[3]!==s[3]||this.dirty)&&(this.gl.colorMask(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class Ac extends _i{getDefault(){return!0}set(n){(n!==this.current||this.dirty)&&(this.gl.depthMask(n),this.current=n,this.dirty=!1)}}class Hu extends _i{getDefault(){return 255}set(n){(n!==this.current||this.dirty)&&(this.gl.stencilMask(n),this.current=n,this.dirty=!1)}}class vl extends _i{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(n){const s=this.current;(n.func!==s.func||n.ref!==s.ref||n.mask!==s.mask||this.dirty)&&(this.gl.stencilFunc(n.func,n.ref,n.mask),this.current=n,this.dirty=!1)}}class Wl extends _i{getDefault(){const n=this.gl;return[n.KEEP,n.KEEP,n.KEEP]}set(n){const s=this.current;(n[0]!==s[0]||n[1]!==s[1]||n[2]!==s[2]||this.dirty)&&(this.gl.stencilOp(n[0],n[1],n[2]),this.current=n,this.dirty=!1)}}class Kl extends _i{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const s=this.gl;n?s.enable(s.STENCIL_TEST):s.disable(s.STENCIL_TEST),this.current=n,this.dirty=!1}}class xl extends _i{getDefault(){return[0,1]}set(n){const s=this.current;(n[0]!==s[0]||n[1]!==s[1]||this.dirty)&&(this.gl.depthRange(n[0],n[1]),this.current=n,this.dirty=!1)}}class Ia extends _i{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const s=this.gl;n?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST),this.current=n,this.dirty=!1}}class wl extends _i{getDefault(){return this.gl.LESS}set(n){(n!==this.current||this.dirty)&&(this.gl.depthFunc(n),this.current=n,this.dirty=!1)}}class us extends _i{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const s=this.gl;n?s.enable(s.BLEND):s.disable(s.BLEND),this.current=n,this.dirty=!1}}class Ls extends _i{getDefault(){const n=this.gl;return[n.ONE,n.ZERO]}set(n){const s=this.current;(n[0]!==s[0]||n[1]!==s[1]||this.dirty)&&(this.gl.blendFunc(n[0],n[1]),this.current=n,this.dirty=!1)}}class Xa extends _i{getDefault(){return u.b4.transparent}set(n){const s=this.current;(n.r!==s.r||n.g!==s.g||n.b!==s.b||n.a!==s.a||this.dirty)&&(this.gl.blendColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class kc extends _i{getDefault(){return this.gl.FUNC_ADD}set(n){(n!==this.current||this.dirty)&&(this.gl.blendEquation(n),this.current=n,this.dirty=!1)}}class Ya extends _i{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const s=this.gl;n?s.enable(s.CULL_FACE):s.disable(s.CULL_FACE),this.current=n,this.dirty=!1}}class qu extends _i{getDefault(){return this.gl.BACK}set(n){(n!==this.current||this.dirty)&&(this.gl.cullFace(n),this.current=n,this.dirty=!1)}}class wu extends _i{getDefault(){return this.gl.CCW}set(n){(n!==this.current||this.dirty)&&(this.gl.frontFace(n),this.current=n,this.dirty=!1)}}class Xl extends _i{getDefault(){return null}set(n){(n!==this.current||this.dirty)&&(this.gl.useProgram(n),this.current=n,this.dirty=!1)}}class cs extends _i{getDefault(){return this.gl.TEXTURE0}set(n){(n!==this.current||this.dirty)&&(this.gl.activeTexture(n),this.current=n,this.dirty=!1)}}class Gu extends _i{getDefault(){const n=this.gl;return[0,0,n.drawingBufferWidth,n.drawingBufferHeight]}set(n){const s=this.current;(n[0]!==s[0]||n[1]!==s[1]||n[2]!==s[2]||n[3]!==s[3]||this.dirty)&&(this.gl.viewport(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class Ys extends _i{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const s=this.gl;s.bindFramebuffer(s.FRAMEBUFFER,n),this.current=n,this.dirty=!1}}class Qs extends _i{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const s=this.gl;s.bindRenderbuffer(s.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class bu extends _i{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const s=this.gl;s.bindTexture(s.TEXTURE_2D,n),this.current=n,this.dirty=!1}}class Tu extends _i{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const s=this.gl;s.bindBuffer(s.ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class li extends _i{getDefault(){return null}set(n){const s=this.gl;s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class Js extends _i{getDefault(){return null}set(n){var s;if(n===this.current&&!this.dirty)return;const m=this.gl;Xi(m)?m.bindVertexArray(n):(s=m.getExtension("OES_vertex_array_object"))===null||s===void 0||s.bindVertexArrayOES(n),this.current=n,this.dirty=!1}}class Su extends _i{getDefault(){return 4}set(n){if(n===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,n),this.current=n,this.dirty=!1}}class Qa extends _i{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n),this.current=n,this.dirty=!1}}class Yl extends _i{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,n),this.current=n,this.dirty=!1}}class Ql extends _i{constructor(n,s){super(n),this.context=n,this.parent=s}getDefault(){return null}}class rd extends Ql{setDirty(){this.dirty=!0}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class ea extends Ql{set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class xh extends Ql{set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,n),this.current=n,this.dirty=!1}}const Eu="Framebuffer is not complete";class Ja{constructor(n,s,m,y,b){this.context=n,this.width=s,this.height=m;const I=n.gl,M=this.framebuffer=I.createFramebuffer();if(this.colorAttachment=new rd(n,M),y)this.depthAttachment=b?new xh(n,M):new ea(n,M);else if(b)throw new Error("Stencil cannot be set without depth");if(I.checkFramebufferStatus(I.FRAMEBUFFER)!==I.FRAMEBUFFER_COMPLETE)throw new Error(Eu)}destroy(){const n=this.context.gl,s=this.colorAttachment.get();if(s&&n.deleteTexture(s),this.depthAttachment){const m=this.depthAttachment.get();m&&n.deleteRenderbuffer(m)}n.deleteFramebuffer(this.framebuffer)}}class Zu{constructor(n){var s,m;if(this.gl=n,this.clearColor=new Ka(this),this.clearDepth=new qd(this),this.clearStencil=new Ea(this),this.colorMask=new Zl(this),this.depthMask=new Ac(this),this.stencilMask=new Hu(this),this.stencilFunc=new vl(this),this.stencilOp=new Wl(this),this.stencilTest=new Kl(this),this.depthRange=new xl(this),this.depthTest=new Ia(this),this.depthFunc=new wl(this),this.blend=new us(this),this.blendFunc=new Ls(this),this.blendColor=new Xa(this),this.blendEquation=new kc(this),this.cullFace=new Ya(this),this.cullFaceSide=new qu(this),this.frontFace=new wu(this),this.program=new Xl(this),this.activeTexture=new cs(this),this.viewport=new Gu(this),this.bindFramebuffer=new Ys(this),this.bindRenderbuffer=new Qs(this),this.bindTexture=new bu(this),this.bindVertexBuffer=new Tu(this),this.bindElementBuffer=new li(this),this.bindVertexArray=new Js(this),this.pixelStoreUnpack=new Su(this),this.pixelStoreUnpackPremultiplyAlpha=new Qa(this),this.pixelStoreUnpackFlipY=new Yl(this),this.extTextureFilterAnisotropic=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=n.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE),Xi(n)){this.HALF_FLOAT=n.HALF_FLOAT;const y=n.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(s=n.RGBA16F)!==null&&s!==void 0?s:y?.RGBA16F_EXT,this.RGB16F=(m=n.RGB16F)!==null&&m!==void 0?m:y?.RGB16F_EXT,n.getExtension("EXT_color_buffer_float")}else{n.getExtension("EXT_color_buffer_half_float"),n.getExtension("OES_texture_half_float_linear");const y=n.getExtension("OES_texture_half_float");this.HALF_FLOAT=y?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(n,s){return new xu(this,n,s)}createVertexBuffer(n,s,m){return new Co(this,n,s,m)}createRenderbuffer(n,s,m){const y=this.gl,b=y.createRenderbuffer();return this.bindRenderbuffer.set(b),y.renderbufferStorage(y.RENDERBUFFER,n,s,m),this.bindRenderbuffer.set(null),b}createFramebuffer(n,s,m,y){return new Ja(this,n,s,m,y)}clear({color:n,depth:s,stencil:m}){const y=this.gl;let b=0;n&&(b|=y.COLOR_BUFFER_BIT,this.clearColor.set(n),this.colorMask.set([!0,!0,!0,!0])),s!==void 0&&(b|=y.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(s),this.depthMask.set(!0)),m!==void 0&&(b|=y.STENCIL_BUFFER_BIT,this.clearStencil.set(m),this.stencilMask.set(255)),y.clear(b)}setCullFace(n){n.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(n.mode),this.frontFace.set(n.frontFace))}setDepthMode(n){n.func!==this.gl.ALWAYS||n.mask?(this.depthTest.set(!0),this.depthFunc.set(n.func),this.depthMask.set(n.mask),this.depthRange.set(n.range)):this.depthTest.set(!1)}setStencilMode(n){n.test.func!==this.gl.ALWAYS||n.mask?(this.stencilTest.set(!0),this.stencilMask.set(n.mask),this.stencilOp.set([n.fail,n.depthFail,n.pass]),this.stencilFunc.set({func:n.test.func,ref:n.ref,mask:n.test.mask})):this.stencilTest.set(!1)}setColorMode(n){u.bz(n.blendFunction,Kn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(n.blendFunction),this.blendColor.set(n.blendColor)),this.colorMask.set(n.mask)}createVertexArray(){var n;return Xi(this.gl)?this.gl.createVertexArray():(n=this.gl.getExtension("OES_vertex_array_object"))===null||n===void 0?void 0:n.createVertexArrayOES()}deleteVertexArray(n){var s;return Xi(this.gl)?this.gl.deleteVertexArray(n):(s=this.gl.getExtension("OES_vertex_array_object"))===null||s===void 0?void 0:s.deleteVertexArrayOES(n)}unbindVAO(){this.bindVertexArray.set(null)}}let go;function Pa(w,n,s,m,y){const b=w.context,I=w.transform,M=b.gl,z=w.useProgram("collisionBox"),B=[];let q=0,W=0;for(let Te=0;Te<m.length;Te++){const Ie=m[Te],Re=n.getTile(Ie).getBucket(s);if(!Re)continue;const ze=y?Re.textCollisionBox:Re.iconCollisionBox,Fe=Re.collisionCircleArray;Fe.length>0&&(B.push({circleArray:Fe,circleOffset:W,coord:Ie}),q+=Fe.length/4,W=q),ze&&z.draw(b,M.LINES,xn.disabled,Hn.disabled,w.colorModeForRenderPass(),Wn.disabled,j(w.transform),w.style.map.terrain&&w.style.map.terrain.getTerrainData(Ie),I.getProjectionData({overscaledTileID:Ie,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),s.id,ze.layoutVertexBuffer,ze.indexBuffer,ze.segments,null,w.transform.zoom,null,null,ze.collisionVertexBuffer)}if(!y||!B.length)return;const K=w.useProgram("collisionCircle"),oe=new u.bM;oe.resize(4*q),oe._trim();let le=0;for(const Te of B)for(let Ie=0;Ie<Te.circleArray.length/4;Ie++){const Re=4*Ie,ze=Te.circleArray[Re+0],Fe=Te.circleArray[Re+1],Ve=Te.circleArray[Re+2],Ne=Te.circleArray[Re+3];oe.emplace(le++,ze,Fe,Ve,Ne,0),oe.emplace(le++,ze,Fe,Ve,Ne,1),oe.emplace(le++,ze,Fe,Ve,Ne,2),oe.emplace(le++,ze,Fe,Ve,Ne,3)}(!go||go.length<2*q)&&(go=function(Te){const Ie=2*Te,Re=new u.bO;Re.resize(Ie),Re._trim();for(let ze=0;ze<Ie;ze++){const Fe=6*ze;Re.uint16[Fe+0]=4*ze+0,Re.uint16[Fe+1]=4*ze+1,Re.uint16[Fe+2]=4*ze+2,Re.uint16[Fe+3]=4*ze+2,Re.uint16[Fe+4]=4*ze+3,Re.uint16[Fe+5]=4*ze+0}return Re}(q));const we=b.createIndexBuffer(go,!0),ge=b.createVertexBuffer(oe,u.bN.members,!0);for(const Te of B){const Ie=Y(w.transform);K.draw(b,M.TRIANGLES,xn.disabled,Hn.disabled,w.colorModeForRenderPass(),Wn.disabled,Ie,w.style.map.terrain&&w.style.map.terrain.getTerrainData(Te.coord),null,s.id,ge,we,u.aD.simpleSegment(0,2*Te.circleOffset,Te.circleArray.length,Te.circleArray.length/2),null,w.transform.zoom,null,null,null)}ge.destroy(),we.destroy()}const Wu=u.aq(new Float32Array(16));function Ku(w,n,s,m,y,b){const{horizontalAlign:I,verticalAlign:M}=u.ay(w);return new u.P((-(I-.5)*n/y+m[0])*b,(-(M-.5)*s/y+m[1])*b)}function Mc(w,n,s,m,y,b){const I=n.tileAnchorPoint.add(new u.P(n.translation[0],n.translation[1]));if(n.pitchWithMap){let M=m.mult(b);s||(M=M.rotate(-y));const z=I.add(M);return ut(z.x,z.y,n.pitchedLabelPlaneMatrix,n.getElevation).point}if(s){const M=$t(n.tileAnchorPoint.x+1,n.tileAnchorPoint.y,n).point.sub(w),z=Math.atan(M.y/M.x)+(M.x<0?Math.PI:0);return w.add(m.rotate(z))}return w.add(m)}function bl(w,n,s,m,y,b,I,M,z,B,q,W){const K=w.text.placedSymbolArray,oe=w.text.dynamicLayoutVertexArray,le=w.icon.dynamicLayoutVertexArray,we={};oe.clear();for(let ge=0;ge<K.length;ge++){const Te=K.get(ge),Ie=Te.hidden||!Te.crossTileID||w.allowVerticalPlacement&&!Te.placedOrientation?null:m[Te.crossTileID];if(Ie){const Re=new u.P(Te.anchorX,Te.anchorY),ze={getElevation:W,width:y.width,height:y.height,pitchedLabelPlaneMatrix:b,pitchWithMap:s,transform:y,tileAnchorPoint:Re,translation:B,unwrappedTileID:q},Fe=s?Nn(Re.x,Re.y,ze):$t(Re.x,Re.y,ze),Ve=Xe(y.cameraToCenterDistance,Fe.signedDistanceFromCamera);let Ne=u.aj(w.textSizeData,M,Te)*Ve/u.as;s&&(Ne*=w.tilePixelRatio/I);const{width:Qe,height:Je,anchor:yt,textOffset:xt,textBoxScale:pt}=Ie,Ut=Ku(yt,Qe,Je,xt,pt,Ne),At=y.getPitchedTextCorrection(Re.x+B[0],Re.y+B[1],q),Et=Mc(Fe.point,ze,n,Ut,-y.bearingInRadians,At),Ht=w.allowVerticalPlacement&&Te.placedOrientation===u.ai.vertical?Math.PI/2:0;for(let Vn=0;Vn<Te.numGlyphs;Vn++)u.ak(oe,Et,Ht);z&&Te.associatedIconIndex>=0&&(we[Te.associatedIconIndex]={shiftedAnchor:Et,angle:Ht})}else Si(Te.numGlyphs,oe)}if(z){le.clear();const ge=w.icon.placedSymbolArray;for(let Te=0;Te<ge.length;Te++){const Ie=ge.get(Te);if(Ie.hidden)Si(Ie.numGlyphs,le);else{const Re=we[Te];if(Re)for(let ze=0;ze<Ie.numGlyphs;ze++)u.ak(le,Re.shiftedAnchor,Re.angle);else Si(Ie.numGlyphs,le)}}w.icon.dynamicLayoutVertexBuffer.updateData(le)}w.text.dynamicLayoutVertexBuffer.updateData(oe)}function od(w,n,s){return s.iconsInText&&n?"symbolTextAndIcon":w?"symbolSDF":"symbolIcon"}function Iu(w,n,s,m,y,b,I,M,z,B,q,W,K){const oe=w.context,le=oe.gl,we=w.transform,ge=M==="map",Te=z==="map",Ie=M!=="viewport"&&s.layout.get("symbol-placement")!=="point",Re=ge&&!Te&&!Ie,ze=!s.layout.get("symbol-sort-key").isConstant();let Fe=!1;const Ve=w.getDepthModeForSublayer(0,xn.ReadOnly),Ne=s._unevaluatedLayout.hasValue("text-variable-anchor")||s._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Qe=[],Je=we.getCircleRadiusCorrection();for(const yt of m){const xt=n.getTile(yt),pt=xt.getBucket(s);if(!pt)continue;const Ut=y?pt.text:pt.icon;if(!Ut||!Ut.segments.get().length||!Ut.hasVisibleVertices)continue;const At=Ut.programConfigurations.get(s.id),Et=y||pt.sdfIcons,Ht=y?pt.textSizeData:pt.iconSizeData,Vn=Te||we.pitch!==0,Zn=w.useProgram(od(Et,y,pt),At),pi=u.ah(Ht,we.zoom),Ti=w.style.map.terrain&&w.style.map.terrain.getTerrainData(yt);let ar,Oi,Fi,Hi,yo=[0,0],Or=null;if(y)Oi=xt.glyphAtlasTexture,Fi=le.LINEAR,ar=xt.glyphAtlasTexture.size,pt.iconsInText&&(yo=xt.imageAtlasTexture.size,Or=xt.imageAtlasTexture,Hi=Vn||w.options.rotating||w.options.zooming||Ht.kind==="composite"||Ht.kind==="camera"?le.LINEAR:le.NEAREST);else{const qi=s.layout.get("icon-size").constantOr(0)!==1||pt.iconsNeedLinear;Oi=xt.imageAtlasTexture,Fi=Et||w.options.rotating||w.options.zooming||qi||Vn?le.LINEAR:le.NEAREST,ar=xt.imageAtlasTexture.size}const Fr=u.at(xt,1,w.transform.zoom),$o=tt(ge,w.transform,Fr),kl=u.H();u.an(kl,$o);const il=Ge(Te,ge,w.transform,Fr),ko=u.au(we,xt,b,I),Ml=we.getProjectionData({overscaledTileID:yt,applyGlobeMatrix:!K,applyTerrainMatrix:!0}),Ru=Ne&&pt.hasTextData(),Lu=s.layout.get("icon-text-fit")!=="none"&&Ru&&pt.hasIconData();if(Ie){const qi=w.style.map.terrain?(Fs,yr)=>w.style.map.terrain.getElevation(yt,Fs,yr):null,lr=s.layout.get("text-rotation-alignment")==="map";zt(pt,w,y,$o,kl,Te,B,lr,yt.toUnwrapped(),we.width,we.height,ko,qi)}const ec=y&&Ne||Lu,Ho=Ie||ec?Wu:Te?$o:w.transform.clipSpaceToPixelsMatrix,ra=Et&&s.paint.get(y?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let oa;oa=Et?pt.iconsInText?io(Ht.kind,pi,Re,Te,Ie,ec,w,Ho,il,ko,ar,yo,Je):ql(Ht.kind,pi,Re,Te,Ie,ec,w,Ho,il,ko,y,ar,0,Je):yl(Ht.kind,pi,Re,Te,Ie,ec,w,Ho,il,ko,y,ar,Je);const Os={program:Zn,buffers:Ut,uniformValues:oa,projectionData:Ml,atlasTexture:Oi,atlasTextureIcon:Or,atlasInterpolation:Fi,atlasInterpolationIcon:Hi,isSDF:Et,hasHalo:ra};if(ze&&pt.canOverlap){Fe=!0;const qi=Ut.segments.get();for(const lr of qi)Qe.push({segments:new u.aD([lr]),sortKey:lr.sortKey,state:Os,terrainData:Ti})}else Qe.push({segments:Ut.segments,sortKey:0,state:Os,terrainData:Ti})}Fe&&Qe.sort((yt,xt)=>yt.sortKey-xt.sortKey);for(const yt of Qe){const xt=yt.state;if(oe.activeTexture.set(le.TEXTURE0),xt.atlasTexture.bind(xt.atlasInterpolation,le.CLAMP_TO_EDGE),xt.atlasTextureIcon&&(oe.activeTexture.set(le.TEXTURE1),xt.atlasTextureIcon&&xt.atlasTextureIcon.bind(xt.atlasInterpolationIcon,le.CLAMP_TO_EDGE)),xt.isSDF){const pt=xt.uniformValues;xt.hasHalo&&(pt.u_is_halo=1,Rc(xt.buffers,yt.segments,s,w,xt.program,Ve,q,W,pt,xt.projectionData,yt.terrainData)),pt.u_is_halo=0}Rc(xt.buffers,yt.segments,s,w,xt.program,Ve,q,W,xt.uniformValues,xt.projectionData,yt.terrainData)}}function Rc(w,n,s,m,y,b,I,M,z,B,q){const W=m.context;y.draw(W,W.gl.TRIANGLES,b,I,M,Wn.backCCW,z,q,B,s.id,w.layoutVertexBuffer,w.indexBuffer,n,s.paint,m.transform.zoom,w.programConfigurations.get(s.id),w.dynamicLayoutVertexBuffer,w.opacityVertexBuffer)}function Yi(w,n,s,m,y){const b=w.context,I=b.gl,M=Hn.disabled,z=new Kn([I.ONE,I.ONE],u.b4.transparent,[!0,!0,!0,!0]),B=n.getBucket(s);if(!B)return;const q=m.key;let W=s.heatmapFbos.get(q);W||(W=Tl(b,n.tileSize,n.tileSize),s.heatmapFbos.set(q,W)),b.bindFramebuffer.set(W.framebuffer),b.viewport.set([0,0,n.tileSize,n.tileSize]),b.clear({color:u.b4.transparent});const K=B.programConfigurations.get(s.id),oe=w.useProgram("heatmap",K,!y),le=w.transform.getProjectionData({overscaledTileID:n.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),we=w.style.map.terrain.getTerrainData(m);oe.draw(b,I.TRIANGLES,xn.disabled,M,z,Wn.disabled,nt(n,w.transform.zoom,s.paint.get("heatmap-intensity"),1),we,le,s.id,B.layoutVertexBuffer,B.indexBuffer,B.segments,s.paint,w.transform.zoom,K)}function Pu(w,n,s,m,y){const b=w.context,I=b.gl,M=w.transform;b.setColorMode(w.colorModeForRenderPass());const z=Sl(b,n),B=s.key,q=n.heatmapFbos.get(B);if(!q)return;b.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,q.colorAttachment.get()),b.activeTexture.set(I.TEXTURE1),z.bind(I.LINEAR,I.CLAMP_TO_EDGE);const W=M.getProjectionData({overscaledTileID:s,applyTerrainMatrix:y,applyGlobeMatrix:!m});w.useProgram("heatmapTexture").draw(b,I.TRIANGLES,xn.disabled,Hn.disabled,w.colorModeForRenderPass(),Wn.disabled,ft(w,n,0,1),null,W,n.id,w.rasterBoundsBuffer,w.quadTriangleIndexBuffer,w.rasterBoundsSegments,n.paint,M.zoom),q.destroy(),n.heatmapFbos.delete(B)}function Tl(w,n,s){var m,y;const b=w.gl,I=b.createTexture();b.bindTexture(b.TEXTURE_2D,I),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.LINEAR),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.LINEAR);const M=(m=w.HALF_FLOAT)!==null&&m!==void 0?m:b.UNSIGNED_BYTE,z=(y=w.RGBA16F)!==null&&y!==void 0?y:b.RGBA;b.texImage2D(b.TEXTURE_2D,0,z,n,s,0,b.RGBA,M,null);const B=w.createFramebuffer(n,s,!1,!1);return B.colorAttachment.set(I),B}function Sl(w,n){return n.colorRampTexture||(n.colorRampTexture=new te(w,n.colorRamp,w.gl.RGBA)),n.colorRampTexture}function Lc(w,n,s,m,y){if(!s||!m||!m.imageAtlas)return;const b=m.imageAtlas.patternPositions;let I=b[s.to.toString()],M=b[s.from.toString()];if(!I&&M&&(I=M),!M&&I&&(M=I),!I||!M){const z=y.getPaintProperty(n);I=b[z],M=b[z]}I&&M&&w.setConstantPatternPositions(I,M)}function d(w,n,s,m,y,b,I,M){const z=w.context.gl,B="fill-pattern",q=s.paint.get(B),W=q&&q.constantOr(1),K=s.getCrossfadeParameters();let oe,le,we,ge,Te;const Ie=w.transform,Re=s.paint.get("fill-translate"),ze=s.paint.get("fill-translate-anchor");I?(le=W&&!s.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",oe=z.LINES):(le=W?"fillPattern":"fill",oe=z.TRIANGLES);const Fe=q.constantOr(null);for(const Ve of m){const Ne=n.getTile(Ve);if(W&&!Ne.patternsLoaded())continue;const Qe=Ne.getBucket(s);if(!Qe)continue;const Je=Qe.programConfigurations.get(s.id),yt=w.useProgram(le,Je),xt=w.style.map.terrain&&w.style.map.terrain.getTerrainData(Ve);W&&(w.context.activeTexture.set(z.TEXTURE0),Ne.imageAtlasTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),Je.updatePaintBuffers(K)),Lc(Je,B,Fe,Ne,s);const pt=Ie.getProjectionData({overscaledTileID:Ve,applyGlobeMatrix:!M,applyTerrainMatrix:!0}),Ut=u.au(Ie,Ne,Re,ze);if(I){ge=Qe.indexBuffer2,Te=Qe.segments2;const Et=[z.drawingBufferWidth,z.drawingBufferHeight];we=le==="fillOutlinePattern"&&W?Po(w,K,Ne,Et,Ut):Pc(Et,Ut)}else ge=Qe.indexBuffer,Te=Qe.segments,we=W?ks(w,K,Ne,Ut):{u_fill_translate:Ut};let At;if(w.renderPass==="translucent"&&M){const[Et]=w.getStencilConfigForOverlapAndUpdateStencilID(m);At=Et[Ve.overscaledZ]}else At=w.stencilModeForClipping(Ve);yt.draw(w.context,oe,y,At,b,Wn.backCCW,we,xt,pt,s.id,Qe.layoutVertexBuffer,ge,Te,s.paint,w.transform.zoom,Je)}}function x(w,n,s,m,y,b,I,M){const z=w.context,B=z.gl,q="fill-extrusion-pattern",W=s.paint.get(q),K=W.constantOr(1),oe=s.getCrossfadeParameters(),le=s.paint.get("fill-extrusion-opacity"),we=W.constantOr(null),ge=w.transform;for(const Te of m){const Ie=n.getTile(Te),Re=Ie.getBucket(s);if(!Re)continue;const ze=w.style.map.terrain&&w.style.map.terrain.getTerrainData(Te),Fe=Re.programConfigurations.get(s.id),Ve=w.useProgram(K?"fillExtrusionPattern":"fillExtrusion",Fe);K&&(w.context.activeTexture.set(B.TEXTURE0),Ie.imageAtlasTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),Fe.updatePaintBuffers(oe));const Ne=ge.getProjectionData({overscaledTileID:Te,applyGlobeMatrix:!M,applyTerrainMatrix:!0});Lc(Fe,q,we,Ie,s);const Qe=u.au(ge,Ie,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),Je=s.paint.get("fill-extrusion-vertical-gradient"),yt=K?Wr(w,Je,le,Qe,Te,oe,Ie):ls(w,Je,le,Qe);Ve.draw(z,z.gl.TRIANGLES,y,b,I,Wn.backCCW,yt,ze,Ne,s.id,Re.layoutVertexBuffer,Re.indexBuffer,Re.segments,s.paint,w.transform.zoom,Fe,w.style.map.terrain&&Re.centroidVertexBuffer)}}function A(w,n,s,m,y,b,I,M,z){var B;const q=w.style.projection,W=w.context,K=w.transform,oe=W.gl,le=w.useProgram("hillshade"),we=!w.options.moving;for(const ge of m){const Te=n.getTile(ge),Ie=Te.fbo;if(!Ie)continue;const Re=q.getMeshFromTileID(W,ge.canonical,M,!0,"raster"),ze=(B=w.style.map.terrain)===null||B===void 0?void 0:B.getTerrainData(ge);W.activeTexture.set(oe.TEXTURE0),oe.bindTexture(oe.TEXTURE_2D,Ie.colorAttachment.get());const Fe=K.getProjectionData({overscaledTileID:ge,aligned:we,applyGlobeMatrix:!z,applyTerrainMatrix:!0});le.draw(W,oe.TRIANGLES,b,y[ge.overscaledZ],I,Wn.backCCW,Zt(w,Te,s),ze,Fe,s.id,Re.vertexBuffer,Re.indexBuffer,Re.segments)}}const F=[new u.P(0,0),new u.P(u.X,0),new u.P(u.X,u.X),new u.P(0,u.X)];function Z(w,n,s,m,y,b,I,M,z=!1,B=!1){const q=m[m.length-1].overscaledZ,W=w.context,K=W.gl,oe=w.useProgram("raster"),le=w.transform,we=w.style.projection,ge=w.colorModeForRenderPass(),Te=!w.options.moving;for(const Ie of m){const Re=w.getDepthModeForSublayer(Ie.overscaledZ-q,s.paint.get("raster-opacity")===1?xn.ReadWrite:xn.ReadOnly,K.LESS),ze=n.getTile(Ie);ze.registerFadeDuration(s.paint.get("raster-fade-duration"));const Fe=n.findLoadedParent(Ie,0),Ve=n.findLoadedSibling(Ie),Ne=he(ze,Fe||Ve||null,n,s,w.transform,w.style.map.terrain);let Qe,Je;const yt=s.paint.get("raster-resampling")==="nearest"?K.NEAREST:K.LINEAR;W.activeTexture.set(K.TEXTURE0),ze.texture.bind(yt,K.CLAMP_TO_EDGE,K.LINEAR_MIPMAP_NEAREST),W.activeTexture.set(K.TEXTURE1),Fe?(Fe.texture.bind(yt,K.CLAMP_TO_EDGE,K.LINEAR_MIPMAP_NEAREST),Qe=Math.pow(2,Fe.tileID.overscaledZ-ze.tileID.overscaledZ),Je=[ze.tileID.canonical.x*Qe%1,ze.tileID.canonical.y*Qe%1]):ze.texture.bind(yt,K.CLAMP_TO_EDGE,K.LINEAR_MIPMAP_NEAREST),ze.texture.useMipmap&&W.extTextureFilterAnisotropic&&w.transform.pitch>20&&K.texParameterf(K.TEXTURE_2D,W.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,W.extTextureFilterAnisotropicMax);const xt=w.style.map.terrain&&w.style.map.terrain.getTerrainData(Ie),pt=le.getProjectionData({overscaledTileID:Ie,aligned:Te,applyGlobeMatrix:!B,applyTerrainMatrix:!0}),Ut=Rs(Je||[0,0],Qe||1,Ne,s,M),At=we.getMeshFromTileID(W,Ie.canonical,b,I,"raster");oe.draw(W,K.TRIANGLES,Re,y?y[Ie.overscaledZ]:Hn.disabled,ge,z?Wn.frontCCW:Wn.backCCW,Ut,xt,pt,s.id,At.vertexBuffer,At.indexBuffer,At.segments)}}function he(w,n,s,m,y,b){const I=m.paint.get("raster-fade-duration");if(!b&&I>0){const M=re.now(),z=(M-w.timeAdded)/I,B=n?(M-n.timeAdded)/I:-1,q=s.getSource(),W=Bo(y,{tileSize:q.tileSize,roundZoom:q.roundZoom}),K=!n||Math.abs(n.tileID.overscaledZ-W)>Math.abs(w.tileID.overscaledZ-W),oe=K&&w.refreshedUponExpiration?1:u.ab(K?z:1-B,0,1);return w.refreshedUponExpiration&&z>=1&&(w.refreshedUponExpiration=!1),n?{opacity:1,mix:1-oe}:{opacity:oe,mix:0}}return{opacity:1,mix:0}}const Oe=new u.b4(1,0,0,1),rt=new u.b4(0,1,0,1),dt=new u.b4(0,0,1,1),kt=new u.b4(1,0,1,1),tn=new u.b4(0,1,1,1);function Sn(w,n,s,m){Cr(w,0,n+s/2,w.transform.width,s,m)}function Gn(w,n,s,m){Cr(w,n-s/2,0,s,w.transform.height,m)}function Cr(w,n,s,m,y,b){const I=w.context,M=I.gl;M.enable(M.SCISSOR_TEST),M.scissor(n*w.pixelRatio,s*w.pixelRatio,m*w.pixelRatio,y*w.pixelRatio),I.clear({color:b}),M.disable(M.SCISSOR_TEST)}function Nr(w,n,s){const m=w.context,y=m.gl,b=w.useProgram("debug"),I=xn.disabled,M=Hn.disabled,z=w.colorModeForRenderPass(),B="$debug",q=w.style.map.terrain&&w.style.map.terrain.getTerrainData(s);m.activeTexture.set(y.TEXTURE0);const W=n.getTileByID(s.key).latestRawTileData,K=Math.floor((W&&W.byteLength||0)/1024),oe=n.getTile(s).tileSize,le=512/Math.min(oe,512)*(s.overscaledZ/w.transform.zoom)*.5;let we=s.canonical.toString();s.overscaledZ!==s.canonical.z&&(we+=` => ${s.overscaledZ}`),function(Te,Ie){Te.initDebugOverlayCanvas();const Re=Te.debugOverlayCanvas,ze=Te.context.gl,Fe=Te.debugOverlayCanvas.getContext("2d");Fe.clearRect(0,0,Re.width,Re.height),Fe.shadowColor="white",Fe.shadowBlur=2,Fe.lineWidth=1.5,Fe.strokeStyle="white",Fe.textBaseline="top",Fe.font="bold 36px Open Sans, sans-serif",Fe.fillText(Ie,5,5),Fe.strokeText(Ie,5,5),Te.debugOverlayTexture.update(Re),Te.debugOverlayTexture.bind(ze.LINEAR,ze.CLAMP_TO_EDGE)}(w,`${we} ${K}kB`);const ge=w.transform.getProjectionData({overscaledTileID:s,applyGlobeMatrix:!0,applyTerrainMatrix:!0});b.draw(m,y.TRIANGLES,I,M,Kn.alphaBlended,Wn.disabled,ye(u.b4.transparent,le),null,ge,B,w.debugBuffer,w.quadTriangleIndexBuffer,w.debugSegments),b.draw(m,y.LINE_STRIP,I,M,z,Wn.disabled,ye(u.b4.red),q,ge,B,w.debugBuffer,w.tileBorderIndexBuffer,w.debugSegments)}function Ao(w,n,s,m){const{isRenderingGlobe:y}=m,b=w.context,I=b.gl,M=w.transform,z=w.colorModeForRenderPass(),B=w.getDepthModeFor3D(),q=w.useProgram("terrain");b.bindFramebuffer.set(null),b.viewport.set([0,0,w.width,w.height]);for(const W of s){const K=n.getTerrainMesh(W.tileID),oe=w.renderToTexture.getTexture(W),le=n.getTerrainData(W.tileID);b.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,oe.texture);const we=n.getMeshFrameDelta(M.zoom),ge=M.calculateFogMatrix(W.tileID.toUnwrapped()),Te=as(we,ge,w.style.sky,M.pitch,y),Ie=M.getProjectionData({overscaledTileID:W.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});q.draw(b,I.TRIANGLES,B,Hn.disabled,z,Wn.backCCW,Te,le,Ie,"terrain",K.vertexBuffer,K.indexBuffer,K.segments)}}function _o(w,n){if(!n.mesh){const s=new u.aC;s.emplaceBack(-1,-1),s.emplaceBack(1,-1),s.emplaceBack(1,1),s.emplaceBack(-1,1);const m=new u.aE;m.emplaceBack(0,1,2),m.emplaceBack(0,2,3),n.mesh=new ho(w.createVertexBuffer(s,kn.members),w.createIndexBuffer(m),u.aD.simpleSegment(0,0,s.length,m.length))}return n.mesh}class Jl{constructor(n,s){this.context=new Zu(n),this.transform=s,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:u.aq(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=se.maxUnderzooming+se.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new fi}resize(n,s,m){if(this.width=Math.floor(n*m),this.height=Math.floor(s*m),this.pixelRatio=m,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const y of this.style._order)this.style._layers[y].resize()}setup(){const n=this.context,s=new u.aC;s.emplaceBack(0,0),s.emplaceBack(u.X,0),s.emplaceBack(0,u.X),s.emplaceBack(u.X,u.X),this.tileExtentBuffer=n.createVertexBuffer(s,kn.members),this.tileExtentSegments=u.aD.simpleSegment(0,0,4,2);const m=new u.aC;m.emplaceBack(0,0),m.emplaceBack(u.X,0),m.emplaceBack(0,u.X),m.emplaceBack(u.X,u.X),this.debugBuffer=n.createVertexBuffer(m,kn.members),this.debugSegments=u.aD.simpleSegment(0,0,4,5);const y=new u.bT;y.emplaceBack(0,0,0,0),y.emplaceBack(u.X,0,u.X,0),y.emplaceBack(0,u.X,0,u.X),y.emplaceBack(u.X,u.X,u.X,u.X),this.rasterBoundsBuffer=n.createVertexBuffer(y,Ul.members),this.rasterBoundsSegments=u.aD.simpleSegment(0,0,4,2);const b=new u.aC;b.emplaceBack(0,0),b.emplaceBack(u.X,0),b.emplaceBack(0,u.X),b.emplaceBack(u.X,u.X),this.rasterBoundsBufferPosOnly=n.createVertexBuffer(b,kn.members),this.rasterBoundsSegmentsPosOnly=u.aD.simpleSegment(0,0,4,5);const I=new u.aC;I.emplaceBack(0,0),I.emplaceBack(1,0),I.emplaceBack(0,1),I.emplaceBack(1,1),this.viewportBuffer=n.createVertexBuffer(I,kn.members),this.viewportSegments=u.aD.simpleSegment(0,0,4,2);const M=new u.bU;M.emplaceBack(0),M.emplaceBack(1),M.emplaceBack(3),M.emplaceBack(2),M.emplaceBack(0),this.tileBorderIndexBuffer=n.createIndexBuffer(M);const z=new u.aE;z.emplaceBack(1,0,2),z.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=n.createIndexBuffer(z);const B=this.context.gl;this.stencilClearMode=new Hn({func:B.ALWAYS,mask:0},0,255,B.ZERO,B.ZERO,B.ZERO),this.tileExtentMesh=new ho(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const n=this.context,s=n.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const m=u.H();u.bL(m,0,this.width,this.height,0,0,1),u.K(m,m,[s.drawingBufferWidth,s.drawingBufferHeight,0]);const y={mainMatrix:m,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:m};this.useProgram("clippingMask",null,!0).draw(n,s.TRIANGLES,xn.disabled,this.stencilClearMode,Kn.disabled,Wn.disabled,null,null,y,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(n,s,m){if(this.currentStencilSource===n.source||!n.isTileClipped()||!s||!s.length)return;this.currentStencilSource=n.source,this.nextStencilID+s.length>256&&this.clearStencil();const y=this.context;y.setColorMode(Kn.disabled),y.setDepthMode(xn.disabled);const b={};for(const I of s)b[I.key]=this.nextStencilID++;this._renderTileMasks(b,s,m,!0),this._renderTileMasks(b,s,m,!1),this._tileClippingMaskIDs=b}_renderTileMasks(n,s,m,y){const b=this.context,I=b.gl,M=this.style.projection,z=this.transform,B=this.useProgram("clippingMask");for(const q of s){const W=n[q.key],K=this.style.map.terrain&&this.style.map.terrain.getTerrainData(q),oe=M.getMeshFromTileID(this.context,q.canonical,y,!0,"stencil"),le=z.getProjectionData({overscaledTileID:q,applyGlobeMatrix:!0,applyTerrainMatrix:!0});B.draw(b,I.TRIANGLES,xn.disabled,new Hn({func:I.ALWAYS,mask:0},W,255,I.KEEP,I.KEEP,I.REPLACE),Kn.disabled,m?Wn.disabled:Wn.backCCW,null,K,le,"$clipping",oe.vertexBuffer,oe.indexBuffer,oe.segments)}}_renderTilesDepthBuffer(){const n=this.context,s=n.gl,m=this.style.projection,y=this.transform,b=this.useProgram("depth"),I=this.getDepthModeFor3D(),M=ve(y,{tileSize:y.tileSize});for(const z of M){const B=this.style.map.terrain&&this.style.map.terrain.getTerrainData(z),q=m.getMeshFromTileID(this.context,z.canonical,!0,!0,"raster"),W=y.getProjectionData({overscaledTileID:z,applyGlobeMatrix:!0,applyTerrainMatrix:!0});b.draw(n,s.TRIANGLES,I,Hn.disabled,Kn.disabled,Wn.backCCW,null,B,W,"$clipping",q.vertexBuffer,q.indexBuffer,q.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const n=this.nextStencilID++,s=this.context.gl;return new Hn({func:s.NOTEQUAL,mask:255},n,255,s.KEEP,s.KEEP,s.REPLACE)}stencilModeForClipping(n){const s=this.context.gl;return new Hn({func:s.EQUAL,mask:255},this._tileClippingMaskIDs[n.key],0,s.KEEP,s.KEEP,s.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(n){const s=this.context.gl,m=n.sort((I,M)=>M.overscaledZ-I.overscaledZ),y=m[m.length-1].overscaledZ,b=m[0].overscaledZ-y+1;if(b>1){this.currentStencilSource=void 0,this.nextStencilID+b>256&&this.clearStencil();const I={};for(let M=0;M<b;M++)I[M+y]=new Hn({func:s.GEQUAL,mask:255},M+this.nextStencilID,255,s.KEEP,s.KEEP,s.REPLACE);return this.nextStencilID+=b,[I,m]}return[{[y]:Hn.disabled},m]}stencilConfigForOverlapTwoPass(n){const s=this.context.gl,m=n.sort((I,M)=>M.overscaledZ-I.overscaledZ),y=m[m.length-1].overscaledZ,b=m[0].overscaledZ-y+1;if(this.clearStencil(),b>1){const I={},M={};for(let z=0;z<b;z++)I[z+y]=new Hn({func:s.GREATER,mask:255},b+1+z,255,s.KEEP,s.KEEP,s.REPLACE),M[z+y]=new Hn({func:s.GREATER,mask:255},1+z,255,s.KEEP,s.KEEP,s.REPLACE);return this.nextStencilID=2*b+1,[I,M,m]}return this.nextStencilID=3,[{[y]:new Hn({func:s.GREATER,mask:255},2,255,s.KEEP,s.KEEP,s.REPLACE)},{[y]:new Hn({func:s.GREATER,mask:255},1,255,s.KEEP,s.KEEP,s.REPLACE)},m]}colorModeForRenderPass(){const n=this.context.gl;return this._showOverdrawInspector?new Kn([n.CONSTANT_COLOR,n.ONE],new u.b4(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Kn.unblended:Kn.alphaBlended}getDepthModeForSublayer(n,s,m){if(!this.opaquePassEnabledForLayer())return xn.disabled;const y=1-((1+this.currentLayer)*this.numSublayers+n)*this.depthEpsilon;return new xn(m||this.context.gl.LEQUAL,s,[y,y])}getDepthModeFor3D(){return new xn(this.context.gl.LEQUAL,xn.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(n,s){var m,y;this.style=n,this.options=s,this.lineAtlas=n.lineAtlas,this.imageManager=n.imageManager,this.glyphManager=n.glyphManager,this.symbolFadeChange=n.placement.symbolFadeChange(re.now()),this.imageManager.beginFrame();const b=this.style._order,I=this.style.sourceCaches,M={},z={},B={},q={isRenderingToTexture:!1,isRenderingGlobe:((m=n.projection)===null||m===void 0?void 0:m.transitionState)>0};for(const K in I){const oe=I[K];oe.used&&oe.prepare(this.context),M[K]=oe.getVisibleCoordinates(!1),z[K]=M[K].slice().reverse(),B[K]=oe.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let K=0;K<b.length;K++)if(this.style._layers[b[K]].is3D()){this.opaquePassCutoff=K;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const K of b){const oe=this.style._layers[K];if(!oe.hasOffscreenPass()||oe.isHidden(this.transform.zoom))continue;const le=z[oe.source];(oe.type==="custom"||le.length)&&this.renderLayer(this,I[oe.source],oe,le,q)}if((y=this.style.projection)===null||y===void 0||y.updateGPUdependent({context:this.context,useProgram:K=>this.useProgram(K)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:s.showOverdrawInspector?u.b4.black:u.b4.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(K,oe){const le=K.context,we=le.gl,ge=((Ve,Ne,Qe)=>{const Je=Math.cos(Ne.rollInRadians),yt=Math.sin(Ne.rollInRadians),xt=zi(Ne),pt=Ne.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:Ve.properties.get("sky-color"),u_horizon_color:Ve.properties.get("horizon-color"),u_horizon:[(Ne.width/2-xt*yt)*Qe,(Ne.height/2+xt*Je)*Qe],u_horizon_normal:[-yt,Je],u_sky_horizon_blend:Ve.properties.get("sky-horizon-blend")*Ne.height/2*Qe,u_sky_blend:pt}})(oe,K.style.map.transform,K.pixelRatio),Te=new xn(we.LEQUAL,xn.ReadWrite,[0,1]),Ie=Hn.disabled,Re=K.colorModeForRenderPass(),ze=K.useProgram("sky"),Fe=_o(le,oe);ze.draw(le,we.TRIANGLES,Te,Ie,Re,Wn.disabled,ge,null,void 0,"sky",Fe.vertexBuffer,Fe.indexBuffer,Fe.segments)}(this,this.style.sky),this._showOverdrawInspector=s.showOverdrawInspector,this.depthRangeFor3D=[0,1-(n._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=b.length-1;this.currentLayer>=0;this.currentLayer--){const K=this.style._layers[b[this.currentLayer]],oe=I[K.source],le=M[K.source];this._renderTileClippingMasks(K,le,!1),this.renderLayer(this,oe,K,le,q)}this.renderPass="translucent";let W=!1;for(this.currentLayer=0;this.currentLayer<b.length;this.currentLayer++){const K=this.style._layers[b[this.currentLayer]],oe=I[K.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(K,q))continue;this.opaquePassEnabledForLayer()||W||(W=!0,q.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const le=(K.type==="symbol"?B:z)[K.source];this._renderTileClippingMasks(K,M[K.source],!1),this.renderLayer(this,oe,K,le,q)}if(q.isRenderingGlobe&&function(K,oe,le){const we=K.context,ge=we.gl,Te=K.useProgram("atmosphere"),Ie=new xn(ge.LEQUAL,xn.ReadOnly,[0,1]),Re=K.transform,ze=function(pt,Ut){const At=pt.properties.get("position"),Et=[-At.x,-At.y,-At.z],Ht=u.aq(new Float64Array(16));return pt.properties.get("anchor")==="map"&&(u.aX(Ht,Ht,Ut.rollInRadians),u.aY(Ht,Ht,-Ut.pitchInRadians),u.aX(Ht,Ht,Ut.bearingInRadians),u.aY(Ht,Ht,Ut.center.lat*Math.PI/180),u.bj(Ht,Ht,-Ut.center.lng*Math.PI/180)),u.bS(Et,Et,Ht),Et}(le,K.transform),Fe=Re.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),Ve=oe.properties.get("atmosphere-blend")*Fe.projectionTransition;if(Ve===0)return;const Ne=mr(Re.worldSize,Re.center.lat),Qe=Re.inverseProjectionMatrix,Je=new Float64Array(4);Je[3]=1,u.al(Je,Je,Re.modelViewProjectionMatrix),Je[0]/=Je[3],Je[1]/=Je[3],Je[2]/=Je[3],Je[3]=1,u.al(Je,Je,Qe),Je[0]/=Je[3],Je[1]/=Je[3],Je[2]/=Je[3],Je[3]=1;const yt=((pt,Ut,At,Et,Ht)=>({u_sun_pos:pt,u_atmosphere_blend:Ut,u_globe_position:At,u_globe_radius:Et,u_inv_proj_matrix:Ht}))(ze,Ve,[Je[0],Je[1],Je[2]],Ne,Qe),xt=_o(we,oe);Te.draw(we,ge.TRIANGLES,Ie,Hn.disabled,Kn.alphaBlended,Wn.disabled,yt,null,null,"atmosphere",xt.vertexBuffer,xt.indexBuffer,xt.segments)}(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const K=function(oe,le){let we=null;const ge=Object.values(oe._layers).flatMap(ze=>ze.source&&!ze.isHidden(le)?[oe.sourceCaches[ze.source]]:[]),Te=ge.filter(ze=>ze.getSource().type==="vector"),Ie=ge.filter(ze=>ze.getSource().type!=="vector"),Re=ze=>{(!we||we.getSource().maxzoom<ze.getSource().maxzoom)&&(we=ze)};return Te.forEach(ze=>Re(ze)),we||Ie.forEach(ze=>Re(ze)),we}(this.style,this.transform.zoom);K&&function(oe,le,we){for(let ge=0;ge<we.length;ge++)Nr(oe,le,we[ge])}(this,K,K.getVisibleCoordinates())}this.options.showPadding&&function(K){const oe=K.transform.padding;Sn(K,K.transform.height-(oe.top||0),3,Oe),Sn(K,oe.bottom||0,3,rt),Gn(K,oe.left||0,3,dt),Gn(K,K.transform.width-(oe.right||0),3,kt);const le=K.transform.centerPoint;(function(we,ge,Te,Ie){Cr(we,ge-1,Te-10,2,20,Ie),Cr(we,ge-10,Te-1,20,2,Ie)})(K,le.x,K.transform.height-le.y,tn)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(n){if(!this.style||!this.style.map||!this.style.map.terrain)return;const s=this.terrainFacilitator.matrix,m=this.transform.modelViewProjectionMatrix;let y=this.terrainFacilitator.dirty;y||(y=n?!u.bV(s,m):!u.bW(s,m)),y||(y=this.style.map.terrain.sourceCache.anyTilesAfterTime(this.terrainFacilitator.renderTime)),y&&(u.bX(s,m),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(b,I){const M=b.context,z=M.gl,B=b.transform,q=Kn.unblended,W=new xn(z.LEQUAL,xn.ReadWrite,[0,1]),K=I.sourceCache.getRenderableTiles(),oe=b.useProgram("terrainDepth");M.bindFramebuffer.set(I.getFramebuffer("depth").framebuffer),M.viewport.set([0,0,b.width/devicePixelRatio,b.height/devicePixelRatio]),M.clear({color:u.b4.transparent,depth:1});for(const le of K){const we=I.getTerrainMesh(le.tileID),ge=I.getTerrainData(le.tileID),Te=B.getProjectionData({overscaledTileID:le.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),Ie={u_ele_delta:I.getMeshFrameDelta(B.zoom)};oe.draw(M,z.TRIANGLES,W,Hn.disabled,q,Wn.backCCW,Ie,ge,Te,"terrain",we.vertexBuffer,we.indexBuffer,we.segments)}M.bindFramebuffer.set(null),M.viewport.set([0,0,b.width,b.height])}(this,this.style.map.terrain),function(b,I){const M=b.context,z=M.gl,B=b.transform,q=Kn.unblended,W=new xn(z.LEQUAL,xn.ReadWrite,[0,1]),K=I.getCoordsTexture(),oe=I.sourceCache.getRenderableTiles(),le=b.useProgram("terrainCoords");M.bindFramebuffer.set(I.getFramebuffer("coords").framebuffer),M.viewport.set([0,0,b.width/devicePixelRatio,b.height/devicePixelRatio]),M.clear({color:u.b4.transparent,depth:1}),I.coordsIndex=[];for(const we of oe){const ge=I.getTerrainMesh(we.tileID),Te=I.getTerrainData(we.tileID);M.activeTexture.set(z.TEXTURE0),z.bindTexture(z.TEXTURE_2D,K.texture);const Ie={u_terrain_coords_id:(255-I.coordsIndex.length)/255,u_texture:0,u_ele_delta:I.getMeshFrameDelta(B.zoom)},Re=B.getProjectionData({overscaledTileID:we.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});le.draw(M,z.TRIANGLES,W,Hn.disabled,q,Wn.backCCW,Ie,Te,Re,"terrain",ge.vertexBuffer,ge.indexBuffer,ge.segments),I.coordsIndex.push(we.tileID.key)}M.bindFramebuffer.set(null),M.viewport.set([0,0,b.width,b.height])}(this,this.style.map.terrain))}renderLayer(n,s,m,y,b){m.isHidden(this.transform.zoom)||(m.type==="background"||m.type==="custom"||(y||[]).length)&&(this.id=m.id,u.bY(m)?function(I,M,z,B,q,W){if(I.renderPass!=="translucent")return;const{isRenderingToTexture:K}=W,oe=Hn.disabled,le=I.colorModeForRenderPass();(z._unevaluatedLayout.hasValue("text-variable-anchor")||z._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(we,ge,Te,Ie,Re,ze,Fe,Ve,Ne){const Qe=ge.transform,Je=ge.style.map.terrain,yt=Re==="map",xt=ze==="map";for(const pt of we){const Ut=Ie.getTile(pt),At=Ut.getBucket(Te);if(!At||!At.text||!At.text.segments.get().length)continue;const Et=u.ah(At.textSizeData,Qe.zoom),Ht=u.at(Ut,1,ge.transform.zoom),Vn=tt(yt,ge.transform,Ht),Zn=Te.layout.get("icon-text-fit")!=="none"&&At.hasIconData();{const pi=Math.pow(2,Qe.zoom-Ut.tileID.overscaledZ),Ti=Je?(ar,Oi)=>Je.getElevation(pt,ar,Oi):null;bl(At,yt,xt,Ne,Qe,Vn,pi,Et,Zn,u.au(Qe,Ut,Fe,Ve),pt.toUnwrapped(),Ti)}}}(B,I,z,M,z.layout.get("text-rotation-alignment"),z.layout.get("text-pitch-alignment"),z.paint.get("text-translate"),z.paint.get("text-translate-anchor"),q),z.paint.get("icon-opacity").constantOr(1)!==0&&Iu(I,M,z,B,!1,z.paint.get("icon-translate"),z.paint.get("icon-translate-anchor"),z.layout.get("icon-rotation-alignment"),z.layout.get("icon-pitch-alignment"),z.layout.get("icon-keep-upright"),oe,le,K),z.paint.get("text-opacity").constantOr(1)!==0&&Iu(I,M,z,B,!0,z.paint.get("text-translate"),z.paint.get("text-translate-anchor"),z.layout.get("text-rotation-alignment"),z.layout.get("text-pitch-alignment"),z.layout.get("text-keep-upright"),oe,le,K),M.map.showCollisionBoxes&&(Pa(I,M,z,B,!0),Pa(I,M,z,B,!1))}(n,s,m,y,this.style.placement.variableOffsets,b):u.bZ(m)?function(I,M,z,B,q){if(I.renderPass!=="translucent")return;const{isRenderingToTexture:W}=q,K=z.paint.get("circle-opacity"),oe=z.paint.get("circle-stroke-width"),le=z.paint.get("circle-stroke-opacity"),we=!z.layout.get("circle-sort-key").isConstant();if(K.constantOr(1)===0&&(oe.constantOr(1)===0||le.constantOr(1)===0))return;const ge=I.context,Te=ge.gl,Ie=I.transform,Re=I.getDepthModeForSublayer(0,xn.ReadOnly),ze=Hn.disabled,Fe=I.colorModeForRenderPass(),Ve=[],Ne=Ie.getCircleRadiusCorrection();for(let Qe=0;Qe<B.length;Qe++){const Je=B[Qe],yt=M.getTile(Je),xt=yt.getBucket(z);if(!xt)continue;const pt=z.paint.get("circle-translate"),Ut=z.paint.get("circle-translate-anchor"),At=u.au(Ie,yt,pt,Ut),Et=xt.programConfigurations.get(z.id),Ht=I.useProgram("circle",Et),Vn=xt.layoutVertexBuffer,Zn=xt.indexBuffer,pi=I.style.map.terrain&&I.style.map.terrain.getTerrainData(Je),Ti={programConfiguration:Et,program:Ht,layoutVertexBuffer:Vn,indexBuffer:Zn,uniformValues:P(I,yt,z,At,Ne),terrainData:pi,projectionData:Ie.getProjectionData({overscaledTileID:Je,applyGlobeMatrix:!W,applyTerrainMatrix:!0})};if(we){const ar=xt.segments.get();for(const Oi of ar)Ve.push({segments:new u.aD([Oi]),sortKey:Oi.sortKey,state:Ti})}else Ve.push({segments:xt.segments,sortKey:0,state:Ti})}we&&Ve.sort((Qe,Je)=>Qe.sortKey-Je.sortKey);for(const Qe of Ve){const{programConfiguration:Je,program:yt,layoutVertexBuffer:xt,indexBuffer:pt,uniformValues:Ut,terrainData:At,projectionData:Et}=Qe.state;yt.draw(ge,Te.TRIANGLES,Re,ze,Fe,Wn.backCCW,Ut,At,Et,z.id,xt,pt,Qe.segments,z.paint,I.transform.zoom,Je)}}(n,s,m,y,b):u.b_(m)?function(I,M,z,B,q){if(z.paint.get("heatmap-opacity")===0)return;const W=I.context,{isRenderingToTexture:K,isRenderingGlobe:oe}=q;if(I.style.map.terrain){for(const le of B){const we=M.getTile(le);M.hasRenderableParent(le)||(I.renderPass==="offscreen"?Yi(I,we,z,le,oe):I.renderPass==="translucent"&&Pu(I,z,le,K,oe))}W.viewport.set([0,0,I.width,I.height])}else I.renderPass==="offscreen"?function(le,we,ge,Te){const Ie=le.context,Re=Ie.gl,ze=le.transform,Fe=Hn.disabled,Ve=new Kn([Re.ONE,Re.ONE],u.b4.transparent,[!0,!0,!0,!0]);(function(Ne,Qe,Je){const yt=Ne.gl;Ne.activeTexture.set(yt.TEXTURE1),Ne.viewport.set([0,0,Qe.width/4,Qe.height/4]);let xt=Je.heatmapFbos.get(u.bP);xt?(yt.bindTexture(yt.TEXTURE_2D,xt.colorAttachment.get()),Ne.bindFramebuffer.set(xt.framebuffer)):(xt=Tl(Ne,Qe.width/4,Qe.height/4),Je.heatmapFbos.set(u.bP,xt))})(Ie,le,ge),Ie.clear({color:u.b4.transparent});for(let Ne=0;Ne<Te.length;Ne++){const Qe=Te[Ne];if(we.hasRenderableParent(Qe))continue;const Je=we.getTile(Qe),yt=Je.getBucket(ge);if(!yt)continue;const xt=yt.programConfigurations.get(ge.id),pt=le.useProgram("heatmap",xt),Ut=ze.getProjectionData({overscaledTileID:Qe,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),At=ze.getCircleRadiusCorrection();pt.draw(Ie,Re.TRIANGLES,xn.disabled,Fe,Ve,Wn.backCCW,nt(Je,ze.zoom,ge.paint.get("heatmap-intensity"),At),null,Ut,ge.id,yt.layoutVertexBuffer,yt.indexBuffer,yt.segments,ge.paint,ze.zoom,xt)}Ie.viewport.set([0,0,le.width,le.height])}(I,M,z,B):I.renderPass==="translucent"&&function(le,we){const ge=le.context,Te=ge.gl;ge.setColorMode(le.colorModeForRenderPass());const Ie=we.heatmapFbos.get(u.bP);Ie&&(ge.activeTexture.set(Te.TEXTURE0),Te.bindTexture(Te.TEXTURE_2D,Ie.colorAttachment.get()),ge.activeTexture.set(Te.TEXTURE1),Sl(ge,we).bind(Te.LINEAR,Te.CLAMP_TO_EDGE),le.useProgram("heatmapTexture").draw(ge,Te.TRIANGLES,xn.disabled,Hn.disabled,le.colorModeForRenderPass(),Wn.disabled,ft(le,we,0,1),null,null,we.id,le.viewportBuffer,le.quadTriangleIndexBuffer,le.viewportSegments,we.paint,le.transform.zoom))}(I,z)}(n,s,m,y,b):u.b$(m)?function(I,M,z,B,q){if(I.renderPass!=="translucent")return;const{isRenderingToTexture:W}=q,K=z.paint.get("line-opacity"),oe=z.paint.get("line-width");if(K.constantOr(1)===0||oe.constantOr(1)===0)return;const le=I.getDepthModeForSublayer(0,xn.ReadOnly),we=I.colorModeForRenderPass(),ge=z.paint.get("line-dasharray"),Te=z.paint.get("line-pattern"),Ie=Te.constantOr(1),Re=z.paint.get("line-gradient"),ze=z.getCrossfadeParameters(),Fe=Ie?"linePattern":ge?"lineSDF":Re?"lineGradient":"line",Ve=I.context,Ne=Ve.gl,Qe=I.transform;let Je=!0;for(const yt of B){const xt=M.getTile(yt);if(Ie&&!xt.patternsLoaded())continue;const pt=xt.getBucket(z);if(!pt)continue;const Ut=pt.programConfigurations.get(z.id),At=I.context.program.get(),Et=I.useProgram(Fe,Ut),Ht=Je||Et.program!==At,Vn=I.style.map.terrain&&I.style.map.terrain.getTerrainData(yt),Zn=Te.constantOr(null);if(Zn&&xt.imageAtlas){const Fi=xt.imageAtlas,Hi=Fi.patternPositions[Zn.to.toString()],yo=Fi.patternPositions[Zn.from.toString()];Hi&&yo&&Ut.setConstantPatternPositions(Hi,yo)}const pi=Qe.getProjectionData({overscaledTileID:yt,applyGlobeMatrix:!W,applyTerrainMatrix:!0}),Ti=Qe.getPixelScale(),ar=Ie?sr(I,xt,z,Ti,ze):ge?Ms(I,xt,z,Ti,ge,ze):Re?wi(I,xt,z,Ti,pt.lineClipsArray.length):ai(I,xt,z,Ti);if(Ie)Ve.activeTexture.set(Ne.TEXTURE0),xt.imageAtlasTexture.bind(Ne.LINEAR,Ne.CLAMP_TO_EDGE),Ut.updatePaintBuffers(ze);else if(ge&&(Ht||I.lineAtlas.dirty))Ve.activeTexture.set(Ne.TEXTURE0),I.lineAtlas.bind(Ve);else if(Re){const Fi=pt.gradients[z.id];let Hi=Fi.texture;if(z.gradientVersion!==Fi.version){let yo=256;if(z.stepInterpolant){const Or=M.getSource().maxzoom,Fr=yt.canonical.z===Or?Math.ceil(1<<I.transform.maxZoom-yt.canonical.z):1;yo=u.ab(u.bQ(pt.maxLineLength/u.X*1024*Fr),256,Ve.maxTextureSize)}Fi.gradient=u.bR({expression:z.gradientExpression(),evaluationKey:"lineProgress",resolution:yo,image:Fi.gradient||void 0,clips:pt.lineClipsArray}),Fi.texture?Fi.texture.update(Fi.gradient):Fi.texture=new te(Ve,Fi.gradient,Ne.RGBA),Fi.version=z.gradientVersion,Hi=Fi.texture}Ve.activeTexture.set(Ne.TEXTURE0),Hi.bind(z.stepInterpolant?Ne.NEAREST:Ne.LINEAR,Ne.CLAMP_TO_EDGE)}let Oi;if(W){const[Fi]=I.getStencilConfigForOverlapAndUpdateStencilID(B);Oi=Fi[yt.overscaledZ]}else Oi=I.stencilModeForClipping(yt);Et.draw(Ve,Ne.TRIANGLES,le,Oi,we,Wn.disabled,ar,Vn,pi,z.id,pt.layoutVertexBuffer,pt.indexBuffer,pt.segments,z.paint,I.transform.zoom,Ut,pt.layoutVertexBuffer2),Je=!1}}(n,s,m,y,b):u.c0(m)?function(I,M,z,B,q){const W=z.paint.get("fill-color"),K=z.paint.get("fill-opacity");if(K.constantOr(1)===0)return;const{isRenderingToTexture:oe}=q,le=I.colorModeForRenderPass(),we=z.paint.get("fill-pattern"),ge=I.opaquePassEnabledForLayer()&&!we.constantOr(1)&&W.constantOr(u.b4.transparent).a===1&&K.constantOr(0)===1?"opaque":"translucent";if(I.renderPass===ge){const Te=I.getDepthModeForSublayer(1,I.renderPass==="opaque"?xn.ReadWrite:xn.ReadOnly);d(I,M,z,B,Te,le,!1,oe)}if(I.renderPass==="translucent"&&z.paint.get("fill-antialias")){const Te=I.getDepthModeForSublayer(z.getPaintProperty("fill-outline-color")?2:0,xn.ReadOnly);d(I,M,z,B,Te,le,!0,oe)}}(n,s,m,y,b):u.c1(m)?function(I,M,z,B,q){const W=z.paint.get("fill-extrusion-opacity");if(W===0)return;const{isRenderingToTexture:K}=q;if(I.renderPass==="translucent"){const oe=new xn(I.context.gl.LEQUAL,xn.ReadWrite,I.depthRangeFor3D);if(W!==1||z.paint.get("fill-extrusion-pattern").constantOr(1))x(I,M,z,B,oe,Hn.disabled,Kn.disabled,K),x(I,M,z,B,oe,I.stencilModeFor3D(),I.colorModeForRenderPass(),K);else{const le=I.colorModeForRenderPass();x(I,M,z,B,oe,Hn.disabled,le,K)}}}(n,s,m,y,b):u.c2(m)?function(I,M,z,B,q){if(I.renderPass!=="offscreen"&&I.renderPass!=="translucent")return;const{isRenderingToTexture:W}=q,K=I.context,oe=I.style.projection.useSubdivision,le=I.getDepthModeForSublayer(0,xn.ReadOnly),we=I.colorModeForRenderPass();if(I.renderPass==="offscreen")(function(ge,Te,Ie,Re,ze,Fe,Ve){const Ne=ge.context,Qe=Ne.gl;for(const Je of Ie){const yt=Te.getTile(Je),xt=yt.dem;if(!xt||!xt.data||!yt.needsHillshadePrepare)continue;const pt=xt.dim,Ut=xt.stride,At=xt.getPixels();if(Ne.activeTexture.set(Qe.TEXTURE1),Ne.pixelStoreUnpackPremultiplyAlpha.set(!1),yt.demTexture=yt.demTexture||ge.getTileTexture(Ut),yt.demTexture){const Ht=yt.demTexture;Ht.update(At,{premultiply:!1}),Ht.bind(Qe.NEAREST,Qe.CLAMP_TO_EDGE)}else yt.demTexture=new te(Ne,At,Qe.RGBA,{premultiply:!1}),yt.demTexture.bind(Qe.NEAREST,Qe.CLAMP_TO_EDGE);Ne.activeTexture.set(Qe.TEXTURE0);let Et=yt.fbo;if(!Et){const Ht=new te(Ne,{width:pt,height:pt,data:null},Qe.RGBA);Ht.bind(Qe.LINEAR,Qe.CLAMP_TO_EDGE),Et=yt.fbo=Ne.createFramebuffer(pt,pt,!0,!1),Et.colorAttachment.set(Ht.texture)}Ne.bindFramebuffer.set(Et.framebuffer),Ne.viewport.set([0,0,pt,pt]),ge.useProgram("hillshadePrepare").draw(Ne,Qe.TRIANGLES,ze,Fe,Ve,Wn.disabled,Pi(yt.tileID,xt),null,null,Re.id,ge.rasterBoundsBuffer,ge.quadTriangleIndexBuffer,ge.rasterBoundsSegments),yt.needsHillshadePrepare=!1}})(I,M,B,z,le,Hn.disabled,we),K.viewport.set([0,0,I.width,I.height]);else if(I.renderPass==="translucent")if(oe){const[ge,Te,Ie]=I.stencilConfigForOverlapTwoPass(B);A(I,M,z,Ie,ge,le,we,!1,W),A(I,M,z,Ie,Te,le,we,!0,W)}else{const[ge,Te]=I.getStencilConfigForOverlapAndUpdateStencilID(B);A(I,M,z,Te,ge,le,we,!1,W)}}(n,s,m,y,b):u.c3(m)?function(I,M,z,B,q){if(I.renderPass!=="translucent"||z.paint.get("raster-opacity")===0||!B.length)return;const{isRenderingToTexture:W}=q,K=M.getSource(),oe=I.style.projection.useSubdivision;if(K instanceof vr)Z(I,M,z,B,null,!1,!1,K.tileCoords,K.flippedWindingOrder,W);else if(oe){const[le,we,ge]=I.stencilConfigForOverlapTwoPass(B);Z(I,M,z,ge,le,!1,!0,F,!1,W),Z(I,M,z,ge,we,!0,!0,F,!1,W)}else{const[le,we]=I.getStencilConfigForOverlapAndUpdateStencilID(B);Z(I,M,z,we,le,!1,!0,F,!1,W)}}(n,s,m,y,b):u.c4(m)?function(I,M,z,B,q){const W=z.paint.get("background-color"),K=z.paint.get("background-opacity");if(K===0)return;const{isRenderingToTexture:oe}=q,le=I.context,we=le.gl,ge=I.style.projection,Te=I.transform,Ie=Te.tileSize,Re=z.paint.get("background-pattern");if(I.isPatternMissing(Re))return;const ze=!Re&&W.a===1&&K===1&&I.opaquePassEnabledForLayer()?"opaque":"translucent";if(I.renderPass!==ze)return;const Fe=Hn.disabled,Ve=I.getDepthModeForSublayer(0,ze==="opaque"?xn.ReadWrite:xn.ReadOnly),Ne=I.colorModeForRenderPass(),Qe=I.useProgram(Re?"backgroundPattern":"background"),Je=B||ve(Te,{tileSize:Ie,terrain:I.style.map.terrain});Re&&(le.activeTexture.set(we.TEXTURE0),I.imageManager.bind(I.context));const yt=z.getCrossfadeParameters();for(const xt of Je){const pt=Te.getProjectionData({overscaledTileID:xt,applyGlobeMatrix:!oe,applyTerrainMatrix:!0}),Ut=Re?Sa(K,I,Re,{tileID:xt,tileSize:Ie},yt):yh(K,W),At=I.style.map.terrain&&I.style.map.terrain.getTerrainData(xt),Et=ge.getMeshFromTileID(le,xt.canonical,!1,!0,"raster");Qe.draw(le,we.TRIANGLES,Ve,Fe,Ne,Wn.backCCW,Ut,At,pt,z.id,Et.vertexBuffer,Et.indexBuffer,Et.segments)}}(n,0,m,y,b):u.c5(m)&&function(I,M,z,B){const{isRenderingGlobe:q}=B,W=I.context,K=z.implementation,oe=I.style.projection,le=I.transform,we=le.getProjectionDataForCustomLayer(q),ge={farZ:le.farZ,nearZ:le.nearZ,fov:le.fov*Math.PI/180,modelViewProjectionMatrix:le.modelViewProjectionMatrix,projectionMatrix:le.projectionMatrix,shaderData:{variantName:oe.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${oe.shaderPreludeCode.vertexSource}`,define:oe.shaderDefine},defaultProjectionData:we},Te=K.renderingMode?K.renderingMode:"2d";if(I.renderPass==="offscreen"){const Ie=K.prerender;Ie&&(I.setCustomLayerDefaults(),W.setColorMode(I.colorModeForRenderPass()),Ie.call(K,W.gl,ge),W.setDirty(),I.setBaseState())}else if(I.renderPass==="translucent"){I.setCustomLayerDefaults(),W.setColorMode(I.colorModeForRenderPass()),W.setStencilMode(Hn.disabled);const Ie=Te==="3d"?I.getDepthModeFor3D():I.getDepthModeForSublayer(0,xn.ReadOnly);W.setDepthMode(Ie),K.render(W.gl,ge),W.setDirty(),I.setBaseState(),W.bindFramebuffer.set(null)}}(n,0,m,b))}saveTileTexture(n){const s=this._tileTextures[n.size[0]];s?s.push(n):this._tileTextures[n.size[0]]=[n]}getTileTexture(n){const s=this._tileTextures[n];return s&&s.length>0?s.pop():null}isPatternMissing(n){if(!n)return!1;if(!n.from||!n.to)return!0;const s=this.imageManager.getPattern(n.from.toString()),m=this.imageManager.getPattern(n.to.toString());return!s||!m}useProgram(n,s,m=!1){this.cache=this.cache||{};const y=!!this.style.map.terrain,b=this.style.projection,I=n+(s?s.cacheKey:"")+`/${m?On:b.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(y?"/terrain":"");return this.cache[I]||(this.cache[I]=new $l(this.context,Sr[n],s,vh[n],this._showOverdrawInspector,y,m?Sr.projectionMercator:b.shaderPreludeCode,m?eo:b.shaderDefine)),this.cache[I]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const n=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(n.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new te(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:n,drawingBufferHeight:s}=this.context.gl;return this.width!==n||this.height!==s}}function Ca(w,n){let s,m=!1,y=null,b=null;const I=()=>{y=null,m&&(w.apply(b,s),y=setTimeout(I,n),m=!1)};return(...M)=>(m=!0,b=this,s=M,y||I(),y)}class Aa{constructor(n){this._getCurrentHash=()=>{const s=window.location.hash.replace("#","");if(this._hashName){let m;return s.split("&").map(y=>y.split("=")).forEach(y=>{y[0]===this._hashName&&(m=y)}),(m&&m[1]||"").split("/")}return s.split("/")},this._onHashChange=()=>{const s=this._getCurrentHash();if(!this._isValidHash(s))return!1;const m=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(s[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+s[2],+s[1]],zoom:+s[0],bearing:m,pitch:+(s[4]||0)}),!0},this._updateHashUnthrottled=()=>{const s=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,s)},this._removeHash=()=>{const s=this._getCurrentHash();if(s.length===0)return;const m=s.join("/");let y=m;y.split("&").length>0&&(y=y.split("&")[0]),this._hashName&&(y=`${this._hashName}=${m}`);let b=window.location.hash.replace(y,"");b.startsWith("#&")?b=b.slice(0,1)+b.slice(2):b==="#"&&(b="");let I=window.location.href.replace(/(#.+)?$/,b);I=I.replace("&&","&"),window.history.replaceState(window.history.state,null,I)},this._updateHash=Ca(this._updateHashUnthrottled,300),this._hashName=n&&encodeURIComponent(n)}addTo(n){return this._map=n,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(n){const s=this._map.getCenter(),m=Math.round(100*this._map.getZoom())/100,y=Math.ceil((m*Math.LN2+Math.log(512/360/.5))/Math.LN10),b=Math.pow(10,y),I=Math.round(s.lng*b)/b,M=Math.round(s.lat*b)/b,z=this._map.getBearing(),B=this._map.getPitch();let q="";if(q+=n?`/${I}/${M}/${m}`:`${m}/${M}/${I}`,(z||B)&&(q+="/"+Math.round(10*z)/10),B&&(q+=`/${Math.round(B)}`),this._hashName){const W=this._hashName;let K=!1;const oe=window.location.hash.slice(1).split("&").map(le=>{const we=le.split("=")[0];return we===W?(K=!0,`${we}=${q}`):le}).filter(le=>le);return K||oe.push(`${W}=${q}`),`#${oe.join("&")}`}return`#${q}`}_isValidHash(n){if(n.length<3||n.some(isNaN))return!1;try{new u.N(+n[2],+n[1])}catch{return!1}const s=+n[0],m=+(n[3]||0),y=+(n[4]||0);return s>=this._map.getMinZoom()&&s<=this._map.getMaxZoom()&&m>=0&&m<=180&&y>=this._map.getMinPitch()&&y<=this._map.getMaxPitch()}}const eu={linearity:.3,easing:u.c6(0,0,.3,1)},El=u.e({deceleration:2500,maxSpeed:1400},eu),ta=u.e({deceleration:20,maxSpeed:1400},eu),tu=u.e({deceleration:1e3,maxSpeed:360},eu),Ni=u.e({deceleration:1e3,maxSpeed:90},eu),nu=u.e({deceleration:1e3,maxSpeed:360},eu);class Dc{constructor(n){this._map=n,this.clear()}clear(){this._inertiaBuffer=[]}record(n){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:re.now(),settings:n})}_drainInertiaBuffer(){const n=this._inertiaBuffer,s=re.now();for(;n.length>0&&s-n[0].time>160;)n.shift()}_onMoveEnd(n){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const s={zoom:0,bearing:0,pitch:0,roll:0,pan:new u.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:b}of this._inertiaBuffer)s.zoom+=b.zoomDelta||0,s.bearing+=b.bearingDelta||0,s.pitch+=b.pitchDelta||0,s.roll+=b.rollDelta||0,b.panDelta&&s.pan._add(b.panDelta),b.around&&(s.around=b.around),b.pinchAround&&(s.pinchAround=b.pinchAround);const m=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,y={};if(s.pan.mag()){const b=Ar(s.pan.mag(),m,u.e({},El,n||{})),I=s.pan.mult(b.amount/s.pan.mag()),M=this._map.cameraHelper.handlePanInertia(I,this._map.transform);y.center=M.easingCenter,y.offset=M.easingOffset,Cu(y,b)}if(s.zoom){const b=Ar(s.zoom,m,ta);y.zoom=this._map.transform.zoom+b.amount,Cu(y,b)}if(s.bearing){const b=Ar(s.bearing,m,tu);y.bearing=this._map.transform.bearing+u.ab(b.amount,-179,179),Cu(y,b)}if(s.pitch){const b=Ar(s.pitch,m,Ni);y.pitch=this._map.transform.pitch+b.amount,Cu(y,b)}if(s.roll){const b=Ar(s.roll,m,nu);y.roll=this._map.transform.roll+u.ab(b.amount,-179,179),Cu(y,b)}if(y.zoom||y.bearing){const b=s.pinchAround===void 0?s.around:s.pinchAround;y.around=b?this._map.unproject(b):this._map.getCenter()}return this.clear(),u.e(y,{noMoveStart:!0})}}function Cu(w,n){(!w.duration||w.duration<n.duration)&&(w.duration=n.duration,w.easing=n.easing)}function Ar(w,n,s){const{maxSpeed:m,linearity:y,deceleration:b}=s,I=u.ab(w*y/(n/1e3),-m,m),M=Math.abs(I)/(b*y);return{easing:s.easing,duration:1e3*M,amount:I*(M/2)}}class $i extends u.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,s,m,y={}){const b=Q.mousePos(s.getCanvas(),m),I=s.unproject(b);super(n,u.e({point:b,lngLat:I,originalEvent:m},y)),this._defaultPrevented=!1,this.target=s}}class Ds extends u.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,s,m){const y=n==="touchend"?m.changedTouches:m.touches,b=Q.touchPos(s.getCanvasContainer(),y),I=b.map(z=>s.unproject(z)),M=b.reduce((z,B,q,W)=>z.add(B.div(W.length)),new u.P(0,0));super(n,{points:b,point:M,lngLats:I,lngLat:s.unproject(M),originalEvent:m}),this._defaultPrevented=!1}}class Uo extends u.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,s,m){super(n,{originalEvent:m}),this._defaultPrevented=!1}}class Au{constructor(n,s){this._map=n,this._clickTolerance=s.clickTolerance}reset(){delete this._mousedownPos}wheel(n){return this._firePreventable(new Uo(n.type,this._map,n))}mousedown(n,s){return this._mousedownPos=s,this._firePreventable(new $i(n.type,this._map,n))}mouseup(n){this._map.fire(new $i(n.type,this._map,n))}click(n,s){this._mousedownPos&&this._mousedownPos.dist(s)>=this._clickTolerance||this._map.fire(new $i(n.type,this._map,n))}dblclick(n){return this._firePreventable(new $i(n.type,this._map,n))}mouseover(n){this._map.fire(new $i(n.type,this._map,n))}mouseout(n){this._map.fire(new $i(n.type,this._map,n))}touchstart(n){return this._firePreventable(new Ds(n.type,this._map,n))}touchmove(n){this._map.fire(new Ds(n.type,this._map,n))}touchend(n){this._map.fire(new Ds(n.type,this._map,n))}touchcancel(n){this._map.fire(new Ds(n.type,this._map,n))}_firePreventable(n){if(this._map.fire(n),n.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class zc{constructor(n){this._map=n}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(n){this._map.fire(new $i(n.type,this._map,n))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new $i("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(n){this._delayContextMenu?this._contextMenuEvent=n:this._ignoreContextMenu||this._map.fire(new $i(n.type,this._map,n)),this._map.listens("contextmenu")&&n.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ka{constructor(n){this._map=n}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(n){return this.transform.screenPointToLocation(u.P.convert(n),this._map.terrain)}}class hr{constructor(n,s){this._map=n,this._tr=new ka(n),this._el=n.getCanvasContainer(),this._container=n.getContainer(),this._clickTolerance=s.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(n,s){this.isEnabled()&&n.shiftKey&&n.button===0&&(Q.disableDrag(),this._startPos=this._lastPos=s,this._active=!0)}mousemoveWindow(n,s){if(!this._active)return;const m=s;if(this._lastPos.equals(m)||!this._box&&m.dist(this._startPos)<this._clickTolerance)return;const y=this._startPos;this._lastPos=m,this._box||(this._box=Q.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",n));const b=Math.min(y.x,m.x),I=Math.max(y.x,m.x),M=Math.min(y.y,m.y),z=Math.max(y.y,m.y);Q.setTransform(this._box,`translate(${b}px,${M}px)`),this._box.style.width=I-b+"px",this._box.style.height=z-M+"px"}mouseupWindow(n,s){if(!this._active||n.button!==0)return;const m=this._startPos,y=s;if(this.reset(),Q.suppressClick(),m.x!==y.x||m.y!==y.y)return this._map.fire(new u.k("boxzoomend",{originalEvent:n})),{cameraAnimation:b=>b.fitScreenCoordinates(m,y,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",n)}keydown(n){this._active&&n.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",n))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(Q.remove(this._box),this._box=null),Q.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(n,s){return this._map.fire(new u.k(n,{originalEvent:s}))}}function nr(w,n){if(w.length!==n.length)throw new Error(`The number of touches and points are not equal - touches ${w.length}, points ${n.length}`);const s={};for(let m=0;m<w.length;m++)s[w[m].identifier]=n[m];return s}class iu{constructor(n){this.reset(),this.numTouches=n.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(n,s,m){(this.centroid||m.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=n.timeStamp),m.length===this.numTouches&&(this.centroid=function(y){const b=new u.P(0,0);for(const I of y)b._add(I);return b.div(y.length)}(s),this.touches=nr(m,s)))}touchmove(n,s,m){if(this.aborted||!this.centroid)return;const y=nr(m,s);for(const b in this.touches){const I=y[b];(!I||I.dist(this.touches[b])>30)&&(this.aborted=!0)}}touchend(n,s,m){if((!this.centroid||n.timeStamp-this.startTime>500)&&(this.aborted=!0),m.length===0){const y=!this.aborted&&this.centroid;if(this.reset(),y)return y}}}class Mr{constructor(n){this.singleTap=new iu(n),this.numTaps=n.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(n,s,m){this.singleTap.touchstart(n,s,m)}touchmove(n,s,m){this.singleTap.touchmove(n,s,m)}touchend(n,s,m){const y=this.singleTap.touchend(n,s,m);if(y){const b=n.timeStamp-this.lastTime<500,I=!this.lastTap||this.lastTap.dist(y)<30;if(b&&I||this.reset(),this.count++,this.lastTime=n.timeStamp,this.lastTap=y,this.count===this.numTaps)return this.reset(),y}}}class Rr{constructor(n){this._tr=new ka(n),this._zoomIn=new Mr({numTouches:1,numTaps:2}),this._zoomOut=new Mr({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(n,s,m){this._zoomIn.touchstart(n,s,m),this._zoomOut.touchstart(n,s,m)}touchmove(n,s,m){this._zoomIn.touchmove(n,s,m),this._zoomOut.touchmove(n,s,m)}touchend(n,s,m){const y=this._zoomIn.touchend(n,s,m),b=this._zoomOut.touchend(n,s,m),I=this._tr;return y?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:M=>M.easeTo({duration:300,zoom:I.zoom+1,around:I.unproject(y)},{originalEvent:n})}):b?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:M=>M.easeTo({duration:300,zoom:I.zoom-1,around:I.unproject(b)},{originalEvent:n})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Gt{constructor(n){this._enabled=!!n.enable,this._moveStateManager=n.moveStateManager,this._clickTolerance=n.clickTolerance||1,this._moveFunction=n.move,this._activateOnStart=!!n.activateOnStart,n.assignEvents(this),this.reset()}reset(n){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(n)}_move(...n){const s=this._moveFunction(...n);if(s.bearingDelta||s.pitchDelta||s.rollDelta||s.around||s.panDelta)return this._active=!0,s}dragStart(n,s){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(n)&&(this._moveStateManager.startMove(n),this._lastPoint=Array.isArray(s)?s[0]:s,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(n,s){if(!this.isEnabled())return;const m=this._lastPoint;if(!m)return;if(n.preventDefault(),!this._moveStateManager.isValidMoveEvent(n))return void this.reset(n);const y=Array.isArray(s)?s[0]:s;return!this._moved&&y.dist(m)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=y,this._move(m,y))}dragEnd(n){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(n)&&(this._moved&&Q.suppressClick(),this.reset(n))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Xu={0:1,2:2};class Kr{constructor(n){this._correctEvent=n.checkCorrectEvent}startMove(n){const s=Q.mouseButton(n);this._eventButton=s}endMove(n){delete this._eventButton}isValidStartEvent(n){return this._correctEvent(n)}isValidMoveEvent(n){return!function(s,m){const y=Xu[m];return s.buttons===void 0||(s.buttons&y)!==y}(n,this._eventButton)}isValidEndEvent(n){return Q.mouseButton(n)===this._eventButton}}class wh{constructor(){this._firstTouch=void 0}_isOneFingerTouch(n){return n.targetTouches.length===1}_isSameTouchEvent(n){return n.targetTouches[0].identifier===this._firstTouch}startMove(n){this._firstTouch=n.targetTouches[0].identifier}endMove(n){delete this._firstTouch}isValidStartEvent(n){return this._isOneFingerTouch(n)}isValidMoveEvent(n){return this._isOneFingerTouch(n)&&this._isSameTouchEvent(n)}isValidEndEvent(n){return this._isOneFingerTouch(n)&&this._isSameTouchEvent(n)}}class Nc{constructor(n=new Kr({checkCorrectEvent:()=>!0}),s=new wh){this.mouseMoveStateManager=n,this.oneFingerTouchMoveStateManager=s}_executeRelevantHandler(n,s,m){return n instanceof MouseEvent?s(n):typeof TouchEvent<"u"&&n instanceof TouchEvent?m(n):void 0}startMove(n){this._executeRelevantHandler(n,s=>this.mouseMoveStateManager.startMove(s),s=>this.oneFingerTouchMoveStateManager.startMove(s))}endMove(n){this._executeRelevantHandler(n,s=>this.mouseMoveStateManager.endMove(s),s=>this.oneFingerTouchMoveStateManager.endMove(s))}isValidStartEvent(n){return this._executeRelevantHandler(n,s=>this.mouseMoveStateManager.isValidStartEvent(s),s=>this.oneFingerTouchMoveStateManager.isValidStartEvent(s))}isValidMoveEvent(n){return this._executeRelevantHandler(n,s=>this.mouseMoveStateManager.isValidMoveEvent(s),s=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(s))}isValidEndEvent(n){return this._executeRelevantHandler(n,s=>this.mouseMoveStateManager.isValidEndEvent(s),s=>this.oneFingerTouchMoveStateManager.isValidEndEvent(s))}}const ru=w=>{w.mousedown=w.dragStart,w.mousemoveWindow=w.dragMove,w.mouseup=w.dragEnd,w.contextmenu=n=>{n.preventDefault()}};class bh{constructor(n,s){this._clickTolerance=n.clickTolerance||1,this._map=s,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new u.P(0,0)}_shouldBePrevented(n){return n<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(n,s,m){return this._calculateTransform(n,s,m)}touchmove(n,s,m){if(this._active){if(!this._shouldBePrevented(m.length))return n.preventDefault(),this._calculateTransform(n,s,m);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",n)}}touchend(n,s,m){this._calculateTransform(n,s,m),this._active&&this._shouldBePrevented(m.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(n,s,m){m.length>0&&(this._active=!0);const y=nr(m,s),b=new u.P(0,0),I=new u.P(0,0);let M=0;for(const B in y){const q=y[B],W=this._touches[B];W&&(b._add(q),I._add(q.sub(W)),M++,y[B]=q)}if(this._touches=y,this._shouldBePrevented(M)||!I.mag())return;const z=I.div(M);return this._sum._add(z),this._sum.mag()<this._clickTolerance?void 0:{around:b.div(M),panDelta:z}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ti{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(n,s,m){this._firstTwoTouches||m.length<2||(this._firstTwoTouches=[m[0].identifier,m[1].identifier],this._start([s[0],s[1]]))}touchmove(n,s,m){if(!this._firstTwoTouches)return;n.preventDefault();const[y,b]=this._firstTwoTouches,I=zs(m,s,y),M=zs(m,s,b);if(!I||!M)return;const z=this._aroundCenter?null:I.add(M).div(2);return this._move([I,M],z,n)}touchend(n,s,m){if(!this._firstTwoTouches)return;const[y,b]=this._firstTwoTouches,I=zs(m,s,y),M=zs(m,s,b);I&&M||(this._active&&Q.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(n){this._enabled=!0,this._aroundCenter=!!n&&n.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function zs(w,n,s){for(let m=0;m<w.length;m++)if(w[m].identifier===s)return n[m]}function Th(w,n){return Math.log(w/n)/Math.LN2}class Oc extends ti{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(n){this._startDistance=this._distance=n[0].dist(n[1])}_move(n,s){const m=this._distance;if(this._distance=n[0].dist(n[1]),this._active||!(Math.abs(Th(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Th(this._distance,m),pinchAround:s}}}function Gd(w,n){return 180*w.angleWith(n)/Math.PI}class Hp extends ti{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(n){this._startVector=this._vector=n[0].sub(n[1]),this._minDiameter=n[0].dist(n[1])}_move(n,s,m){const y=this._vector;if(this._vector=n[0].sub(n[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Gd(this._vector,y),pinchAround:s}}_isBelowThreshold(n){this._minDiameter=Math.min(this._minDiameter,n.mag());const s=25/(Math.PI*this._minDiameter)*360,m=Gd(n,this._startVector);return Math.abs(m)<s}}function el(w){return Math.abs(w.y)>Math.abs(w.x)}class ou extends ti{constructor(n){super(),this._currentTouchCount=0,this._map=n}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(n,s,m){super.touchstart(n,s,m),this._currentTouchCount=m.length}_start(n){this._lastPoints=n,el(n[0].sub(n[1]))&&(this._valid=!1)}_move(n,s,m){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const y=n[0].sub(this._lastPoints[0]),b=n[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(y,b,m.timeStamp),this._valid?(this._lastPoints=n,this._active=!0,{pitchDelta:(y.y+b.y)/2*-.5}):void 0}gestureBeginsVertically(n,s,m){if(this._valid!==void 0)return this._valid;const y=n.mag()>=2,b=s.mag()>=2;if(!y&&!b)return;if(!y||!b)return this._firstMove===void 0&&(this._firstMove=m),m-this._firstMove<100&&void 0;const I=n.y>0==s.y>0;return el(n)&&el(s)&&I}}const Yu={panStep:100,bearingStep:15,pitchStep:10};class Sh{constructor(n){this._tr=new ka(n);const s=Yu;this._panStep=s.panStep,this._bearingStep=s.bearingStep,this._pitchStep=s.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(n){if(n.altKey||n.ctrlKey||n.metaKey)return;let s=0,m=0,y=0,b=0,I=0;switch(n.keyCode){case 61:case 107:case 171:case 187:s=1;break;case 189:case 109:case 173:s=-1;break;case 37:n.shiftKey?m=-1:(n.preventDefault(),b=-1);break;case 39:n.shiftKey?m=1:(n.preventDefault(),b=1);break;case 38:n.shiftKey?y=1:(n.preventDefault(),I=-1);break;case 40:n.shiftKey?y=-1:(n.preventDefault(),I=1);break;default:return}return this._rotationDisabled&&(m=0,y=0),{cameraAnimation:M=>{const z=this._tr;M.easeTo({duration:300,easeId:"keyboardHandler",easing:Eh,zoom:s?Math.round(z.zoom)+s*(n.shiftKey?2:1):z.zoom,bearing:z.bearing+m*this._bearingStep,pitch:z.pitch+y*this._pitchStep,offset:[-b*this._panStep,-I*this._panStep],center:z.center},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Eh(w){return w*(2-w)}const na=4.000244140625;class ia{constructor(n,s){this._onTimeout=m=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(m)},this._map=n,this._tr=new ka(n),this._triggerRenderFrame=s,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(n){this._defaultZoomRate=n}setWheelZoomRate(n){this._wheelZoomRate=n}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(n){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!n&&n.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(n){return!!this._map.cooperativeGestures.isEnabled()&&!(n.ctrlKey||this._map.cooperativeGestures.isBypassed(n))}wheel(n){if(!this.isEnabled())return;if(this._shouldBePrevented(n))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",n);let s=n.deltaMode===WheelEvent.DOM_DELTA_LINE?40*n.deltaY:n.deltaY;const m=re.now(),y=m-(this._lastWheelEventTime||0);this._lastWheelEventTime=m,s!==0&&s%na==0?this._type="wheel":s!==0&&Math.abs(s)<4?this._type="trackpad":y>400?(this._type=null,this._lastValue=s,this._timeout=setTimeout(this._onTimeout,40,n)):this._type||(this._type=Math.abs(y*s)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,s+=this._lastValue)),n.shiftKey&&s&&(s/=4),this._type&&(this._lastWheelEvent=n,this._delta-=s,this._active||this._start(n)),n.preventDefault()}_start(n){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const s=Q.mousePos(this._map.getCanvas(),n),m=this._tr;this._aroundPoint=this._aroundCenter?m.transform.locationToScreenPoint(u.N.convert(m.center)):s,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const n=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const M=n.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=M),typeof this._targetZoom=="number"&&(this._targetZoom+=M)}if(this._delta!==0){const M=this._type==="wheel"&&Math.abs(this._delta)>na?this._wheelZoomRate:this._defaultZoomRate;let z=2/(1+Math.exp(-Math.abs(this._delta*M)));this._delta<0&&z!==0&&(z=1/z);const B=typeof this._targetZoom!="number"?n.scale:u.aG(this._targetZoom);this._targetZoom=Math.min(n.maxZoom,Math.max(n.minZoom,u.a8(B*z))),this._type==="wheel"&&(this._startZoom=n.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const s=typeof this._targetZoom!="number"?n.zoom:this._targetZoom,m=this._startZoom,y=this._easing;let b,I=!1;if(this._type==="wheel"&&m&&y){const M=re.now()-this._lastWheelEventTime,z=Math.min((M+5)/200,1),B=y(z);b=u.y.number(m,s,B),z<1?this._frameId||(this._frameId=!0):I=!0}else b=s,I=!0;return this._active=!0,I&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout},200)),this._lastExpectedZoom=b,{noInertia:!0,needsRenderFrame:!I,zoomDelta:b-n.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(n){let s=u.c8;if(this._prevEase){const m=this._prevEase,y=(re.now()-m.start)/m.duration,b=m.easing(y+.01)-m.easing(y),I=.27/Math.sqrt(b*b+1e-4)*.01,M=Math.sqrt(.0729-I*I);s=u.c6(I,M,.25,1)}return this._prevEase={start:re.now(),duration:n,easing:s},s}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class hs{constructor(n,s){this._clickZoom=n,this._tapZoom=s}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class bi{constructor(n){this._tr=new ka(n),this.reset()}reset(){this._active=!1}dblclick(n,s){return n.preventDefault(),{cameraAnimation:m=>{m.easeTo({duration:300,zoom:this._tr.zoom+(n.shiftKey?-1:1),around:this._tr.unproject(s)},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ma{constructor(){this._tap=new Mr({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(n,s,m){if(!this._swipePoint)if(this._tapTime){const y=s[0],b=n.timeStamp-this._tapTime<500,I=this._tapPoint.dist(y)<30;b&&I?m.length>0&&(this._swipePoint=y,this._swipeTouch=m[0].identifier):this.reset()}else this._tap.touchstart(n,s,m)}touchmove(n,s,m){if(this._tapTime){if(this._swipePoint){if(m[0].identifier!==this._swipeTouch)return;const y=s[0],b=y.y-this._swipePoint.y;return this._swipePoint=y,n.preventDefault(),this._active=!0,{zoomDelta:b/128}}}else this._tap.touchmove(n,s,m)}touchend(n,s,m){if(this._tapTime)this._swipePoint&&m.length===0&&this.reset();else{const y=this._tap.touchend(n,s,m);y&&(this._tapTime=n.timeStamp,this._tapPoint=y)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Il{constructor(n,s,m){this._el=n,this._mousePan=s,this._touchPan=m}enable(n){this._inertiaOptions=n||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class sd{constructor(n,s,m,y){this._pitchWithRotate=n.pitchWithRotate,this._rollEnabled=n.rollEnabled,this._mouseRotate=s,this._mousePitch=m,this._mouseRoll=y}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class Ih{constructor(n,s,m,y){this._el=n,this._touchZoom=s,this._touchRotate=m,this._tapDragZoom=y,this._rotationDisabled=!1,this._enabled=!0}enable(n){this._touchZoom.enable(n),this._rotationDisabled||this._touchRotate.enable(n),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Ph{constructor(n,s){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=n,this._options=s,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const n=this._map.getCanvasContainer();n.classList.add("maplibregl-cooperative-gestures"),this._container=Q.create("div","maplibregl-cooperative-gesture-screen",n);let s=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(s=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const m=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),y=document.createElement("div");y.className="maplibregl-desktop-message",y.textContent=s,this._container.appendChild(y);const b=document.createElement("div");b.className="maplibregl-mobile-message",b.textContent=m,this._container.appendChild(b),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(Q.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(n){return n[this._bypassKey]}notifyGestureBlocked(n,s){this._enabled&&(this._map.fire(new u.k("cooperativegestureprevented",{gestureType:n,originalEvent:s})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const jo=w=>w.zoom||w.drag||w.roll||w.pitch||w.rotate;class Lr extends u.k{}function Qi(w){return w.panDelta&&w.panDelta.mag()||w.zoomDelta||w.bearingDelta||w.pitchDelta||w.rollDelta}class rn{constructor(n,s){this.handleWindowEvent=y=>{this.handleEvent(y,`${y.type}Window`)},this.handleEvent=(y,b)=>{if(y.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const I=y.type==="renderFrame"?void 0:y,M={needsRenderFrame:!1},z={},B={},q=y.touches,W=q?this._getMapTouches(q):void 0,K=W?Q.touchPos(this._map.getCanvas(),W):Q.mousePos(this._map.getCanvas(),y);for(const{handlerName:we,handler:ge,allowed:Te}of this._handlers){if(!ge.isEnabled())continue;let Ie;this._blockedByActive(B,Te,we)?ge.reset():ge[b||y.type]&&(Ie=ge[b||y.type](y,K,W),this.mergeHandlerResult(M,z,Ie,we,I),Ie&&Ie.needsRenderFrame&&this._triggerRenderFrame()),(Ie||ge.isActive())&&(B[we]=ge)}const oe={};for(const we in this._previousActiveHandlers)B[we]||(oe[we]=I);this._previousActiveHandlers=B,(Object.keys(oe).length||Qi(M))&&(this._changes.push([M,z,oe]),this._triggerRenderFrame()),(Object.keys(B).length||Qi(M))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:le}=M;le&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],le(this._map))},this._map=n,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Dc(n),this._bearingSnap=s.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(s);const m=this._el;this._listeners=[[m,"touchstart",{passive:!0}],[m,"touchmove",{passive:!1}],[m,"touchend",void 0],[m,"touchcancel",void 0],[m,"mousedown",void 0],[m,"mousemove",void 0],[m,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[m,"mouseover",void 0],[m,"mouseout",void 0],[m,"dblclick",void 0],[m,"click",void 0],[m,"keydown",{capture:!1}],[m,"keyup",void 0],[m,"wheel",{passive:!1}],[m,"contextmenu",void 0],[window,"blur",void 0]];for(const[y,b,I]of this._listeners)Q.addEventListener(y,b,y===document?this.handleWindowEvent:this.handleEvent,I)}destroy(){for(const[n,s,m]of this._listeners)Q.removeEventListener(n,s,n===document?this.handleWindowEvent:this.handleEvent,m)}_addDefaultHandlers(n){const s=this._map,m=s.getCanvasContainer();this._add("mapEvent",new Au(s,n));const y=s.boxZoom=new hr(s,n);this._add("boxZoom",y),n.interactive&&n.boxZoom&&y.enable();const b=s.cooperativeGestures=new Ph(s,n.cooperativeGestures);this._add("cooperativeGestures",b),n.cooperativeGestures&&b.enable();const I=new Rr(s),M=new bi(s);s.doubleClickZoom=new hs(M,I),this._add("tapZoom",I),this._add("clickZoom",M),n.interactive&&n.doubleClickZoom&&s.doubleClickZoom.enable();const z=new Ma;this._add("tapDragZoom",z);const B=s.touchPitch=new ou(s);this._add("touchPitch",B),n.interactive&&n.touchPitch&&s.touchPitch.enable(n.touchPitch);const q=()=>s.project(s.getCenter()),W=function({enable:ze,clickTolerance:Fe,aroundCenter:Ve=!0,minPixelCenterThreshold:Ne=100,rotateDegreesPerPixelMoved:Qe=.8},Je){const yt=new Kr({checkCorrectEvent:xt=>Q.mouseButton(xt)===0&&xt.ctrlKey||Q.mouseButton(xt)===2&&!xt.ctrlKey});return new Gt({clickTolerance:Fe,move:(xt,pt)=>{const Ut=Je();if(Ve&&Math.abs(Ut.y-xt.y)>Ne)return{bearingDelta:u.c7(new u.P(xt.x,pt.y),pt,Ut)};let At=(pt.x-xt.x)*Qe;return Ve&&pt.y<Ut.y&&(At=-At),{bearingDelta:At}},moveStateManager:yt,enable:ze,assignEvents:ru})}(n,q),K=function({enable:ze,clickTolerance:Fe,pitchDegreesPerPixelMoved:Ve=-.5}){const Ne=new Kr({checkCorrectEvent:Qe=>Q.mouseButton(Qe)===0&&Qe.ctrlKey||Q.mouseButton(Qe)===2});return new Gt({clickTolerance:Fe,move:(Qe,Je)=>({pitchDelta:(Je.y-Qe.y)*Ve}),moveStateManager:Ne,enable:ze,assignEvents:ru})}(n),oe=function({enable:ze,clickTolerance:Fe,rollDegreesPerPixelMoved:Ve=.3},Ne){const Qe=new Kr({checkCorrectEvent:Je=>Q.mouseButton(Je)===2&&Je.ctrlKey});return new Gt({clickTolerance:Fe,move:(Je,yt)=>{const xt=Ne();let pt=(yt.x-Je.x)*Ve;return yt.y<xt.y&&(pt=-pt),{rollDelta:pt}},moveStateManager:Qe,enable:ze,assignEvents:ru})}(n,q);s.dragRotate=new sd(n,W,K,oe),this._add("mouseRotate",W,["mousePitch"]),this._add("mousePitch",K,["mouseRotate","mouseRoll"]),this._add("mouseRoll",oe,["mousePitch"]),n.interactive&&n.dragRotate&&s.dragRotate.enable();const le=function({enable:ze,clickTolerance:Fe}){const Ve=new Kr({checkCorrectEvent:Ne=>Q.mouseButton(Ne)===0&&!Ne.ctrlKey});return new Gt({clickTolerance:Fe,move:(Ne,Qe)=>({around:Qe,panDelta:Qe.sub(Ne)}),activateOnStart:!0,moveStateManager:Ve,enable:ze,assignEvents:ru})}(n),we=new bh(n,s);s.dragPan=new Il(m,le,we),this._add("mousePan",le),this._add("touchPan",we,["touchZoom","touchRotate"]),n.interactive&&n.dragPan&&s.dragPan.enable(n.dragPan);const ge=new Hp,Te=new Oc;s.touchZoomRotate=new Ih(m,Te,ge,z),this._add("touchRotate",ge,["touchPan","touchZoom"]),this._add("touchZoom",Te,["touchPan","touchRotate"]),n.interactive&&n.touchZoomRotate&&s.touchZoomRotate.enable(n.touchZoomRotate);const Ie=s.scrollZoom=new ia(s,()=>this._triggerRenderFrame());this._add("scrollZoom",Ie,["mousePan"]),n.interactive&&n.scrollZoom&&s.scrollZoom.enable(n.scrollZoom);const Re=s.keyboard=new Sh(s);this._add("keyboard",Re),n.interactive&&n.keyboard&&s.keyboard.enable(),this._add("blockableMapEvent",new zc(s))}_add(n,s,m){this._handlers.push({handlerName:n,handler:s,allowed:m}),this._handlersById[n]=s}stop(n){if(!this._updatingCamera){for(const{handler:s}of this._handlers)s.reset();this._inertia.clear(),this._fireEvents({},{},n),this._changes=[]}}isActive(){for(const{handler:n}of this._handlers)if(n.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!jo(this._eventsInProgress)||this.isZooming()}_blockedByActive(n,s,m){for(const y in n)if(y!==m&&(!s||s.indexOf(y)<0))return!0;return!1}_getMapTouches(n){const s=[];for(const m of n)this._el.contains(m.target)&&s.push(m);return s}mergeHandlerResult(n,s,m,y,b){if(!m)return;u.e(n,m);const I={handlerName:y,originalEvent:m.originalEvent||b};m.zoomDelta!==void 0&&(s.zoom=I),m.panDelta!==void 0&&(s.drag=I),m.rollDelta!==void 0&&(s.roll=I),m.pitchDelta!==void 0&&(s.pitch=I),m.bearingDelta!==void 0&&(s.rotate=I)}_applyChanges(){const n={},s={},m={};for(const[y,b,I]of this._changes)y.panDelta&&(n.panDelta=(n.panDelta||new u.P(0,0))._add(y.panDelta)),y.zoomDelta&&(n.zoomDelta=(n.zoomDelta||0)+y.zoomDelta),y.bearingDelta&&(n.bearingDelta=(n.bearingDelta||0)+y.bearingDelta),y.pitchDelta&&(n.pitchDelta=(n.pitchDelta||0)+y.pitchDelta),y.rollDelta&&(n.rollDelta=(n.rollDelta||0)+y.rollDelta),y.around!==void 0&&(n.around=y.around),y.pinchAround!==void 0&&(n.pinchAround=y.pinchAround),y.noInertia&&(n.noInertia=y.noInertia),u.e(s,b),u.e(m,I);this._updateMapTransform(n,s,m),this._changes=[]}_updateMapTransform(n,s,m){const y=this._map,b=y._getTransformForUpdate(),I=y.terrain;if(!(Qi(n)||I&&this._terrainMovement))return this._fireEvents(s,m,!0);y._stop(!0);let{panDelta:M,zoomDelta:z,bearingDelta:B,pitchDelta:q,rollDelta:W,around:K,pinchAround:oe}=n;oe!==void 0&&(K=oe),K=K||y.transform.centerPoint,I&&!b.isPointOnMapSurface(K)&&(K=b.centerPoint);const le={panDelta:M,zoomDelta:z,rollDelta:W,pitchDelta:q,bearingDelta:B,around:K};this._map.cameraHelper.useGlobeControls&&!b.isPointOnMapSurface(K)&&(K=b.centerPoint);const we=K.distSqr(b.centerPoint)<.01?b.center:b.screenPointToLocation(M?K.sub(M):K);I?(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(le,b),this._terrainMovement||!s.drag&&!s.zoom?s.drag&&this._terrainMovement?b.setCenter(b.screenPointToLocation(b.centerPoint.sub(M))):this._map.cameraHelper.handleMapControlsPan(le,b,we):(this._terrainMovement=!0,this._map._elevationFreeze=!0,this._map.cameraHelper.handleMapControlsPan(le,b,we))):(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(le,b),this._map.cameraHelper.handleMapControlsPan(le,b,we)),y._applyUpdatedTransform(b),this._map._update(),n.noInertia||this._inertia.record(n),this._fireEvents(s,m,!0)}_fireEvents(n,s,m){const y=jo(this._eventsInProgress),b=jo(n),I={};for(const W in n){const{originalEvent:K}=n[W];this._eventsInProgress[W]||(I[`${W}start`]=K),this._eventsInProgress[W]=n[W]}!y&&b&&this._fireEvent("movestart",b.originalEvent);for(const W in I)this._fireEvent(W,I[W]);b&&this._fireEvent("move",b.originalEvent);for(const W in n){const{originalEvent:K}=n[W];this._fireEvent(W,K)}const M={};let z;for(const W in this._eventsInProgress){const{handlerName:K,originalEvent:oe}=this._eventsInProgress[W];this._handlersById[K].isActive()||(delete this._eventsInProgress[W],z=s[K]||oe,M[`${W}end`]=z)}for(const W in M)this._fireEvent(W,M[W]);const B=jo(this._eventsInProgress),q=(y||b)&&!B;if(q&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const W=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&W.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(W)}if(m&&q){this._updatingCamera=!0;const W=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),K=oe=>oe!==0&&-this._bearingSnap<oe&&oe<this._bearingSnap;!W||!W.essential&&re.prefersReducedMotion?(this._map.fire(new u.k("moveend",{originalEvent:z})),K(this._map.getBearing())&&this._map.resetNorth()):(K(W.bearing||this._map.getBearing())&&(W.bearing=0),W.freezeElevation=!0,this._map.easeTo(W,{originalEvent:z})),this._updatingCamera=!1}}_fireEvent(n,s){this._map.fire(new u.k(n,s?{originalEvent:s}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(n=>{delete this._frameId,this.handleEvent(new Lr("renderFrame",{timeStamp:n})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class En extends u.E{constructor(n,s,m){super(),this._renderFrameCallback=()=>{const y=Math.min((re.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(y)),y<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=n,this._bearingSnap=m.bearingSnap,this.cameraHelper=s,this.on("moveend",()=>{delete this._requestedCameraState})}migrateProjection(n,s){n.apply(this.transform),this.transform=n,this.cameraHelper=s}getCenter(){return new u.N(this.transform.center.lng,this.transform.center.lat)}setCenter(n,s){return this.jumpTo({center:n},s)}getCenterElevation(){return this.transform.elevation}setCenterElevation(n,s){return this.jumpTo({elevation:n},s),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(n){this._centerClampedToGround=n}panBy(n,s,m){return n=u.P.convert(n).mult(-1),this.panTo(this.transform.center,u.e({offset:n},s),m)}panTo(n,s,m){return this.easeTo(u.e({center:n},s),m)}getZoom(){return this.transform.zoom}setZoom(n,s){return this.jumpTo({zoom:n},s),this}zoomTo(n,s,m){return this.easeTo(u.e({zoom:n},s),m)}zoomIn(n,s){return this.zoomTo(this.getZoom()+1,n,s),this}zoomOut(n,s){return this.zoomTo(this.getZoom()-1,n,s),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(n,s){return n!=this.transform.fov&&(this.transform.setFov(n),this.fire(new u.k("movestart",s)).fire(new u.k("move",s)).fire(new u.k("moveend",s))),this}getBearing(){return this.transform.bearing}setBearing(n,s){return this.jumpTo({bearing:n},s),this}getPadding(){return this.transform.padding}setPadding(n,s){return this.jumpTo({padding:n},s),this}rotateTo(n,s,m){return this.easeTo(u.e({bearing:n},s),m)}resetNorth(n,s){return this.rotateTo(0,u.e({duration:1e3},n),s),this}resetNorthPitch(n,s){return this.easeTo(u.e({bearing:0,pitch:0,roll:0,duration:1e3},n),s),this}snapToNorth(n,s){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(n,s):this}getPitch(){return this.transform.pitch}setPitch(n,s){return this.jumpTo({pitch:n},s),this}getRoll(){return this.transform.roll}setRoll(n,s){return this.jumpTo({roll:n},s),this}cameraForBounds(n,s){n=Wi.convert(n).adjustAntiMeridian();const m=s&&s.bearing||0;return this._cameraForBoxAndBearing(n.getNorthWest(),n.getSouthEast(),m,s)}_cameraForBoxAndBearing(n,s,m,y){const b={top:0,bottom:0,right:0,left:0};if(typeof(y=u.e({padding:b,offset:[0,0],maxZoom:this.transform.maxZoom},y)).padding=="number"){const B=y.padding;y.padding={top:B,bottom:B,right:B,left:B}}const I=u.e(b,y.padding);y.padding=I;const M=this.transform,z=new Wi(n,s);return this.cameraHelper.cameraForBoxAndBearing(y,I,z,m,M)}fitBounds(n,s,m){return this._fitInternal(this.cameraForBounds(n,s),s,m)}fitScreenCoordinates(n,s,m,y,b){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(u.P.convert(n)),this.transform.screenPointToLocation(u.P.convert(s)),m,y),y,b)}_fitInternal(n,s,m){return n?(delete(s=u.e(n,s)).padding,s.linear?this.easeTo(s,m):this.flyTo(s,m)):this}jumpTo(n,s){this.stop();const m=this._getTransformForUpdate();let y=!1,b=!1,I=!1;const M=m.zoom;this.cameraHelper.handleJumpToCenterZoom(m,n);const z=m.zoom!==M;return"elevation"in n&&m.elevation!==+n.elevation&&m.setElevation(+n.elevation),"bearing"in n&&m.bearing!==+n.bearing&&(y=!0,m.setBearing(+n.bearing)),"pitch"in n&&m.pitch!==+n.pitch&&(b=!0,m.setPitch(+n.pitch)),"roll"in n&&m.roll!==+n.roll&&(I=!0,m.setRoll(+n.roll)),n.padding==null||m.isPaddingEqual(n.padding)||m.setPadding(n.padding),this._applyUpdatedTransform(m),this.fire(new u.k("movestart",s)).fire(new u.k("move",s)),z&&this.fire(new u.k("zoomstart",s)).fire(new u.k("zoom",s)).fire(new u.k("zoomend",s)),y&&this.fire(new u.k("rotatestart",s)).fire(new u.k("rotate",s)).fire(new u.k("rotateend",s)),b&&this.fire(new u.k("pitchstart",s)).fire(new u.k("pitch",s)).fire(new u.k("pitchend",s)),I&&this.fire(new u.k("rollstart",s)).fire(new u.k("roll",s)).fire(new u.k("rollend",s)),this.fire(new u.k("moveend",s))}calculateCameraOptionsFromTo(n,s,m,y=0){const b=u.Y.fromLngLat(n,s),I=u.Y.fromLngLat(m,y),M=I.x-b.x,z=I.y-b.y,B=I.z-b.z,q=Math.hypot(M,z,B);if(q===0)throw new Error("Can't calculate camera options with same From and To");const W=Math.hypot(M,z),K=u.a8(this.transform.cameraToCenterDistance/q/this.transform.tileSize),oe=180*Math.atan2(M,-z)/Math.PI;let le=180*Math.acos(W/q)/Math.PI;return le=B<0?90-le:90+le,{center:I.toLngLat(),elevation:y,zoom:K,pitch:le,bearing:oe}}calculateCameraOptionsFromCameraLngLatAltRotation(n,s,m,y,b){const I=this.transform.calculateCenterFromCameraLngLatAlt(n,s,m,y);return{center:I.center,elevation:I.elevation,zoom:I.zoom,bearing:m,pitch:y,roll:b}}easeTo(n,s){this._stop(!1,n.easeId),((n=u.e({offset:[0,0],duration:500,easing:u.c8},n)).animate===!1||!n.essential&&re.prefersReducedMotion)&&(n.duration=0);const m=this._getTransformForUpdate(),y=this.getBearing(),b=m.pitch,I=m.roll,M="bearing"in n?this._normalizeBearing(n.bearing,y):y,z="pitch"in n?+n.pitch:b,B="roll"in n?this._normalizeBearing(n.roll,I):I,q="padding"in n?n.padding:m.padding,W=u.P.convert(n.offset);let K,oe;n.around&&(K=u.N.convert(n.around),oe=m.locationToScreenPoint(K));const le={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},we=this.cameraHelper.handleEaseTo(m,{bearing:M,pitch:z,roll:B,padding:q,around:K,aroundPoint:oe,offsetAsPoint:W,offset:n.offset,zoom:n.zoom,center:n.center});return this._rotating=this._rotating||y!==M,this._pitching=this._pitching||z!==b,this._rolling=this._rolling||B!==I,this._padding=!m.isPaddingEqual(q),this._zooming=this._zooming||we.isZooming,this._easeId=n.easeId,this._prepareEase(s,n.noMoveStart,le),this.terrain&&this._prepareElevation(we.elevationCenter),this._ease(ge=>{we.easeFunc(ge),this.terrain&&!n.freezeElevation&&this._updateElevation(ge),this._applyUpdatedTransform(m),this._fireMoveEvents(s)},ge=>{this.terrain&&n.freezeElevation&&this._finalizeElevation(),this._afterEase(s,ge)},n),this}_prepareEase(n,s,m={}){this._moving=!0,s||m.moving||this.fire(new u.k("movestart",n)),this._zooming&&!m.zooming&&this.fire(new u.k("zoomstart",n)),this._rotating&&!m.rotating&&this.fire(new u.k("rotatestart",n)),this._pitching&&!m.pitching&&this.fire(new u.k("pitchstart",n)),this._rolling&&!m.rolling&&this.fire(new u.k("rollstart",n))}_prepareElevation(n){this._elevationCenter=n,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(n,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(n){this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const s=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(n<1&&s!==this._elevationTarget){const m=this._elevationTarget-this._elevationStart;this._elevationStart+=n*(m-(s-(m*n+this._elevationStart))/(1-n)),this._elevationTarget=s}this.transform.setElevation(u.y.number(this._elevationStart,this._elevationTarget,n))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(n){if(!this.terrain&&n.elevation>=0&&n.pitch<=90)return{};const s=n.getCameraLngLat(),m=n.getCameraAltitude(),y=this.terrain?this.terrain.getElevationForLngLatZoom(s,n.zoom):0;if(m<y){const b=this.calculateCameraOptionsFromTo(s,y,n.center,n.elevation);return{pitch:b.pitch,zoom:b.zoom}}return{}}_applyUpdatedTransform(n){const s=[];if(s.push(y=>this._elevateCameraIfInsideTerrain(y)),this.transformCameraUpdate&&s.push(y=>this.transformCameraUpdate(y)),!s.length)return;const m=n.clone();for(const y of s){const b=m.clone(),{center:I,zoom:M,roll:z,pitch:B,bearing:q,elevation:W}=y(b);I&&b.setCenter(I),W!==void 0&&b.setElevation(W),M!==void 0&&b.setZoom(M),z!==void 0&&b.setRoll(z),B!==void 0&&b.setPitch(B),q!==void 0&&b.setBearing(q),m.apply(b)}this.transform.apply(m)}_fireMoveEvents(n){this.fire(new u.k("move",n)),this._zooming&&this.fire(new u.k("zoom",n)),this._rotating&&this.fire(new u.k("rotate",n)),this._pitching&&this.fire(new u.k("pitch",n)),this._rolling&&this.fire(new u.k("roll",n))}_afterEase(n,s){if(this._easeId&&s&&this._easeId===s)return;delete this._easeId;const m=this._zooming,y=this._rotating,b=this._pitching,I=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,m&&this.fire(new u.k("zoomend",n)),y&&this.fire(new u.k("rotateend",n)),b&&this.fire(new u.k("pitchend",n)),I&&this.fire(new u.k("rollend",n)),this.fire(new u.k("moveend",n))}flyTo(n,s){if(!n.essential&&re.prefersReducedMotion){const pt=u.M(n,["center","zoom","bearing","pitch","roll","elevation"]);return this.jumpTo(pt,s)}this.stop(),n=u.e({offset:[0,0],speed:1.2,curve:1.42,easing:u.c8},n);const m=this._getTransformForUpdate(),y=m.bearing,b=m.pitch,I=m.roll,M=m.padding,z="bearing"in n?this._normalizeBearing(n.bearing,y):y,B="pitch"in n?+n.pitch:b,q="roll"in n?this._normalizeBearing(n.roll,I):I,W="padding"in n?n.padding:m.padding,K=u.P.convert(n.offset);let oe=m.centerPoint.add(K);const le=m.screenPointToLocation(oe),we=this.cameraHelper.handleFlyTo(m,{bearing:z,pitch:B,roll:q,padding:W,locationAtOffset:le,offsetAsPoint:K,center:n.center,minZoom:n.minZoom,zoom:n.zoom});let ge=n.curve;const Te=Math.max(m.width,m.height),Ie=Te/we.scaleOfZoom,Re=we.pixelPathLength;typeof we.scaleOfMinZoom=="number"&&(ge=Math.sqrt(Te/we.scaleOfMinZoom/Re*2));const ze=ge*ge;function Fe(pt){const Ut=(Ie*Ie-Te*Te+(pt?-1:1)*ze*ze*Re*Re)/(2*(pt?Ie:Te)*ze*Re);return Math.log(Math.sqrt(Ut*Ut+1)-Ut)}function Ve(pt){return(Math.exp(pt)-Math.exp(-pt))/2}function Ne(pt){return(Math.exp(pt)+Math.exp(-pt))/2}const Qe=Fe(!1);let Je=function(pt){return Ne(Qe)/Ne(Qe+ge*pt)},yt=function(pt){return Te*((Ne(Qe)*(Ve(Ut=Qe+ge*pt)/Ne(Ut))-Ve(Qe))/ze)/Re;var Ut},xt=(Fe(!0)-Qe)/ge;if(Math.abs(Re)<2e-6||!isFinite(xt)){if(Math.abs(Te-Ie)<1e-6)return this.easeTo(n,s);const pt=Ie<Te?-1:1;xt=Math.abs(Math.log(Ie/Te))/ge,yt=()=>0,Je=Ut=>Math.exp(pt*ge*Ut)}return n.duration="duration"in n?+n.duration:1e3*xt/("screenSpeed"in n?+n.screenSpeed/ge:+n.speed),n.maxDuration&&n.duration>n.maxDuration&&(n.duration=0),this._zooming=!0,this._rotating=y!==z,this._pitching=B!==b,this._rolling=q!==I,this._padding=!m.isPaddingEqual(W),this._prepareEase(s,!1),this.terrain&&this._prepareElevation(we.targetCenter),this._ease(pt=>{const Ut=pt*xt,At=1/Je(Ut),Et=yt(Ut);this._rotating&&m.setBearing(u.y.number(y,z,pt)),this._pitching&&m.setPitch(u.y.number(b,B,pt)),this._rolling&&m.setRoll(u.y.number(I,q,pt)),this._padding&&(m.interpolatePadding(M,W,pt),oe=m.centerPoint.add(K)),we.easeFunc(pt,At,Et,oe),this.terrain&&!n.freezeElevation&&this._updateElevation(pt),this._applyUpdatedTransform(m),this._fireMoveEvents(s)},()=>{this.terrain&&n.freezeElevation&&this._finalizeElevation(),this._afterEase(s)},n),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(n,s){var m;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const y=this._onEaseEnd;delete this._onEaseEnd,y.call(this,s)}return n||(m=this.handlers)===null||m===void 0||m.stop(!1),this}_ease(n,s,m){m.animate===!1||m.duration===0?(n(1),s()):(this._easeStart=re.now(),this._easeOptions=m,this._onEaseFrame=n,this._onEaseEnd=s,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(n,s){n=u.aI(n,-180,180);const m=Math.abs(n-s);return Math.abs(n-360-s)<m&&(n-=360),Math.abs(n+360-s)<m&&(n+=360),n}queryTerrainElevation(n){return this.terrain?this.terrain.getElevationForLngLatZoom(u.N.convert(n),this.transform.tileZoom):null}}const Fc={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Bc{constructor(n=Fc){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=s=>{!s||s.sourceDataType!=="metadata"&&s.sourceDataType!=="visibility"&&s.dataType!=="style"&&s.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=n}getDefaultPosition(){return"bottom-right"}onAdd(n){return this._map=n,this._compact=this.options.compact,this._container=Q.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=Q.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Q.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){Q.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._sanitizedAttributionHTML=void 0}_setElementTitle(n,s){const m=this._map._getUIString(`AttributionControl.${s}`);n.title=m,n.setAttribute("aria-label",m)}_updateAttributions(){if(!this._map.style)return;let n=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?n=n.concat(this.options.customAttribution.map(y=>typeof y!="string"?"":y)):typeof this.options.customAttribution=="string"&&n.push(this.options.customAttribution)),this._map.style.stylesheet){const y=this._map.style.stylesheet;this.styleOwner=y.owner,this.styleId=y.id}const s=this._map.style.sourceCaches;for(const y in s){const b=s[y];if(b.used||b.usedForTerrain){const I=b.getSource();I.attribution&&n.indexOf(I.attribution)<0&&n.push(I.attribution)}}n=n.filter(y=>String(y).trim()),n.sort((y,b)=>y.length-b.length),n=n.filter((y,b)=>{for(let I=b+1;I<n.length;I++)if(n[I].indexOf(y)>=0)return!1;return!0});const m=n.join(" | ");m!==this._sanitizedAttributionHTML&&(this._sanitizedAttributionHTML=Q.sanitize(m),n.length?(this._innerContainer.innerHTML=this._sanitizedAttributionHTML,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Vc{constructor(n={}){this._updateCompact=()=>{const s=this._container.children;if(s.length){const m=s[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&m.classList.add("maplibregl-compact"):m.classList.remove("maplibregl-compact")}},this.options=n}getDefaultPosition(){return"bottom-left"}onAdd(n){this._map=n,this._compact=this.options&&this.options.compact,this._container=Q.create("div","maplibregl-ctrl");const s=Q.create("a","maplibregl-ctrl-logo");return s.target="_blank",s.rel="noopener nofollow",s.href="https://maplibre.org/",s.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),s.setAttribute("rel","noopener nofollow"),this._container.appendChild(s),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){Q.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class ds{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(n){const s=++this._id;return this._queue.push({callback:n,id:s,cancelled:!1}),s}remove(n){const s=this._currentlyRunning,m=s?this._queue.concat(s):this._queue;for(const y of m)if(y.id===n)return void(y.cancelled=!0)}run(n=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const s=this._currentlyRunning=this._queue;this._queue=[];for(const m of s)if(!m.cancelled&&(m.callback(n),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Ch=u.aA([{name:"a_pos3d",type:"Int16",components:3}]);class tl extends u.E{constructor(n){super(),this._lastTilesetChange=re.now(),this.sourceCache=n,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=n._source.tileSize*2**this.deltaZoom,n.usedForTerrain=!0,n.tileSize=this.tileSize}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(n,s){this.sourceCache.update(n,s),this._renderableTilesKeys=[];const m={};for(const y of ve(n,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:s,calculateTileZoom:this.sourceCache._source.calculateTileZoom}))m[y.key]=!0,this._renderableTilesKeys.push(y.key),this._tiles[y.key]||(y.terrainRttPosMatrix32f=new Float64Array(16),u.bL(y.terrainRttPosMatrix32f,0,u.X,u.X,0,0,1),this._tiles[y.key]=new qs(y,this.tileSize),this._lastTilesetChange=re.now());for(const y in this._tiles)m[y]||delete this._tiles[y]}freeRtt(n){for(const s in this._tiles){const m=this._tiles[s];(!n||m.tileID.equals(n)||m.tileID.isChildOf(n)||n.isChildOf(m.tileID))&&(m.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(n=>this.getTileByID(n))}getTileByID(n){return this._tiles[n]}getTerrainCoords(n){const s={};for(const m of this._renderableTilesKeys){const y=this._tiles[m].tileID,b=n.clone(),I=u.a$();if(y.canonical.equals(n.canonical))u.bL(I,0,u.X,u.X,0,0,1);else if(y.canonical.isChildOf(n.canonical)){const M=y.canonical.z-n.canonical.z,z=y.canonical.x-(y.canonical.x>>M<<M),B=y.canonical.y-(y.canonical.y>>M<<M),q=u.X>>M;u.bL(I,0,q,q,0,0,1),u.J(I,I,[-z*q,-B*q,0])}else{if(!n.canonical.isChildOf(y.canonical))continue;{const M=n.canonical.z-y.canonical.z,z=n.canonical.x-(n.canonical.x>>M<<M),B=n.canonical.y-(n.canonical.y>>M<<M),q=u.X>>M;u.bL(I,0,u.X,u.X,0,0,1),u.J(I,I,[z*q,B*q,0]),u.K(I,I,[1/2**M,1/2**M,0])}}b.terrainRttPosMatrix32f=new Float32Array(I),s[m]=b}return s}getSourceTile(n,s){const m=this.sourceCache._source;let y=n.overscaledZ-this.deltaZoom;if(y>m.maxzoom&&(y=m.maxzoom),y<m.minzoom)return null;this._sourceTileCache[n.key]||(this._sourceTileCache[n.key]=n.scaledTo(y).key);let b=this.sourceCache.getTileByID(this._sourceTileCache[n.key]);if((!b||!b.dem)&&s)for(;y>=m.minzoom&&(!b||!b.dem);)b=this.sourceCache.getTileByID(n.scaledTo(y--).key);return b}anyTilesAfterTime(n=Date.now()){return this._lastTilesetChange>=n}}class Uc{constructor(n,s,m){this._meshCache={},this.painter=n,this.sourceCache=new tl(s),this.options=m,this.exaggeration=typeof m.exaggeration=="number"?m.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(n,s,m,y=u.X){var b;if(!(s>=0&&s<y&&m>=0&&m<y))return 0;const I=this.getTerrainData(n),M=(b=I.tile)===null||b===void 0?void 0:b.dem;if(!M)return 0;const z=u.c9([],[s/y*u.X,m/y*u.X],I.u_terrain_matrix),B=[z[0]*M.dim,z[1]*M.dim],q=Math.floor(B[0]),W=Math.floor(B[1]),K=B[0]-q,oe=B[1]-W;return M.get(q,W)*(1-K)*(1-oe)+M.get(q+1,W)*K*(1-oe)+M.get(q,W+1)*(1-K)*oe+M.get(q+1,W+1)*K*oe}getElevationForLngLatZoom(n,s){if(!u.ca(s,n.wrap()))return 0;const{tileID:m,mercatorX:y,mercatorY:b}=this._getOverscaledTileIDFromLngLatZoom(n,s);return this.getElevation(m,y%u.X,b%u.X,u.X)}getElevation(n,s,m,y=u.X){return this.getDEMElevation(n,s,m,y)*this.exaggeration}getTerrainData(n){if(!this._emptyDemTexture){const y=this.painter.context,b=new u.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new te(y,b,y.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new te(y,new u.R({width:1,height:1}),y.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(y.gl.NEAREST,y.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=u.aq([])}const s=this.sourceCache.getSourceTile(n,!0);if(s&&s.dem&&(!s.demTexture||s.needsTerrainPrepare)){const y=this.painter.context;s.demTexture=this.painter.getTileTexture(s.dem.stride),s.demTexture?s.demTexture.update(s.dem.getPixels(),{premultiply:!1}):s.demTexture=new te(y,s.dem.getPixels(),y.gl.RGBA,{premultiply:!1}),s.demTexture.bind(y.gl.NEAREST,y.gl.CLAMP_TO_EDGE),s.needsTerrainPrepare=!1}const m=s&&s+s.tileID.key+n.key;if(m&&!this._demMatrixCache[m]){const y=this.sourceCache.sourceCache._source.maxzoom;let b=n.canonical.z-s.tileID.canonical.z;n.overscaledZ>n.canonical.z&&(n.canonical.z>=y?b=n.canonical.z-y:u.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const I=n.canonical.x-(n.canonical.x>>b<<b),M=n.canonical.y-(n.canonical.y>>b<<b),z=u.cb(new Float64Array(16),[1/(u.X<<b),1/(u.X<<b),0]);u.J(z,z,[I*u.X,M*u.X,0]),this._demMatrixCache[n.key]={matrix:z,coord:n}}return{u_depth:2,u_terrain:3,u_terrain_dim:s&&s.dem&&s.dem.dim||1,u_terrain_matrix:m?this._demMatrixCache[n.key].matrix:this._emptyDemMatrix,u_terrain_unpack:s&&s.dem&&s.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(s&&s.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:s}}getFramebuffer(n){const s=this.painter,m=s.width/devicePixelRatio,y=s.height/devicePixelRatio;return!this._fbo||this._fbo.width===m&&this._fbo.height===y||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new te(s.context,{width:m,height:y,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new te(s.context,{width:m,height:y,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=s.context.createFramebuffer(m,y,!0,!1),this._fbo.depthAttachment.set(s.context.createRenderbuffer(s.context.gl.DEPTH_COMPONENT16,m,y))),this._fbo.colorAttachment.set(n==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const n=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const s=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let b=0,I=0;b<this._coordsTextureSize;b++)for(let M=0;M<this._coordsTextureSize;M++,I+=4)s[I+0]=255&M,s[I+1]=255&b,s[I+2]=M>>8<<4|b>>8,s[I+3]=0;const m=new u.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(s.buffer)),y=new te(n,m,n.gl.RGBA,{premultiply:!1});return y.bind(n.gl.NEAREST,n.gl.CLAMP_TO_EDGE),this._coordsTexture=y,y}pointCoordinate(n){this.painter.maybeDrawDepthAndCoords(!0);const s=new Uint8Array(4),m=this.painter.context,y=m.gl,b=Math.round(n.x*this.painter.pixelRatio/devicePixelRatio),I=Math.round(n.y*this.painter.pixelRatio/devicePixelRatio),M=Math.round(this.painter.height/devicePixelRatio);m.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),y.readPixels(b,M-I-1,1,1,y.RGBA,y.UNSIGNED_BYTE,s),m.bindFramebuffer.set(null);const z=s[0]+(s[2]>>4<<8),B=s[1]+((15&s[2])<<8),q=this.coordsIndex[255-s[3]],W=q&&this.sourceCache.getTileByID(q);if(!W)return null;const K=this._coordsTextureSize,oe=(1<<W.tileID.canonical.z)*K;return new u.Y((W.tileID.canonical.x*K+z)/oe+W.tileID.wrap,(W.tileID.canonical.y*K+B)/oe,this.getElevation(W.tileID,z,B,K))}depthAtPoint(n){const s=new Uint8Array(4),m=this.painter.context,y=m.gl;return m.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),y.readPixels(n.x,this.painter.height/devicePixelRatio-n.y-1,1,1,y.RGBA,y.UNSIGNED_BYTE,s),m.bindFramebuffer.set(null),(s[0]/16777216+s[1]/65536+s[2]/256+s[3])/256}getTerrainMesh(n){var s;const m=((s=this.painter.style.projection)===null||s===void 0?void 0:s.transitionState)>0,y=m&&n.canonical.y===0,b=m&&n.canonical.y===(1<<n.canonical.z)-1,I=`m_${y?"n":""}_${b?"s":""}`;if(this._meshCache[I])return this._meshCache[I];const M=this.painter.context,z=new u.cc,B=new u.aE,q=this.meshSize,W=u.X/q,K=q*q;for(let Ne=0;Ne<=q;Ne++)for(let Qe=0;Qe<=q;Qe++)z.emplaceBack(Qe*W,Ne*W,0);for(let Ne=0;Ne<K;Ne+=q+1)for(let Qe=0;Qe<q;Qe++)B.emplaceBack(Qe+Ne,q+Qe+Ne+1,q+Qe+Ne+2),B.emplaceBack(Qe+Ne,q+Qe+Ne+2,Qe+Ne+1);const oe=z.length,le=oe+(q+1),we=(q+1)*q,ge=y?u.b6:0,Te=y?0:1,Ie=b?u.b7:u.X,Re=b?0:1;for(let Ne=0;Ne<=q;Ne++)z.emplaceBack(Ne*W,ge,Te);for(let Ne=0;Ne<=q;Ne++)z.emplaceBack(Ne*W,Ie,Re);for(let Ne=0;Ne<q;Ne++)B.emplaceBack(we+Ne,le+Ne,le+Ne+1),B.emplaceBack(we+Ne,le+Ne+1,we+Ne+1),B.emplaceBack(0+Ne,oe+Ne+1,oe+Ne),B.emplaceBack(0+Ne,0+Ne+1,oe+Ne+1);const ze=z.length,Fe=ze+2*(q+1);for(const Ne of[0,1])for(let Qe=0;Qe<=q;Qe++)for(const Je of[0,1])z.emplaceBack(Ne*u.X,Qe*W,Je);for(let Ne=0;Ne<2*q;Ne+=2)B.emplaceBack(ze+Ne,ze+Ne+1,ze+Ne+3),B.emplaceBack(ze+Ne,ze+Ne+3,ze+Ne+2),B.emplaceBack(Fe+Ne,Fe+Ne+3,Fe+Ne+1),B.emplaceBack(Fe+Ne,Fe+Ne+2,Fe+Ne+3);const Ve=new ho(M.createVertexBuffer(z,Ch.members),M.createIndexBuffer(B),u.aD.simpleSegment(0,0,z.length,B.length));return this._meshCache[I]=Ve,Ve}getMeshFrameDelta(n){return 2*Math.PI*u.bo/Math.pow(2,Math.max(n,0))/5}getMinTileElevationForLngLatZoom(n,s){var m;const{tileID:y}=this._getOverscaledTileIDFromLngLatZoom(n,s);return(m=this.getMinMaxElevation(y).minElevation)!==null&&m!==void 0?m:0}getMinMaxElevation(n){const s=this.getTerrainData(n).tile,m={minElevation:null,maxElevation:null};return s&&s.dem&&(m.minElevation=s.dem.min*this.exaggeration,m.maxElevation=s.dem.max*this.exaggeration),m}_getOverscaledTileIDFromLngLatZoom(n,s){const m=u.Y.fromLngLat(n.wrap()),y=(1<<s)*u.X,b=m.x*y,I=m.y*y,M=Math.floor(b/u.X),z=Math.floor(I/u.X);return{tileID:new u.S(s,0,s,M,z),mercatorX:b,mercatorY:I}}}class Qu{constructor(n,s,m){this._context=n,this._size=s,this._tileSize=m,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const n of this._objects)n.texture.destroy(),n.fbo.destroy()}_createObject(n){const s=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),m=new te(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return m.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),s.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),s.colorAttachment.set(m.texture),{id:n,fbo:s,texture:m,stamp:-1,inUse:!1}}getObjectForId(n){return this._objects[n]}useObject(n){n.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(s=>n.id!==s),this._recentlyUsed.push(n.id)}stampObject(n){n.stamp=++this._stamp}getOrCreateFreeObject(){for(const s of this._recentlyUsed)if(!this._objects[s].inUse)return this._objects[s];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const n=this._createObject(this._objects.length);return this._objects.push(n),n}freeObject(n){n.inUse=!1}freeAllObjects(){for(const n of this._objects)this.freeObject(n)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(n=>!n.inUse)===!1}}const ir={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class _r{constructor(n,s){this.painter=n,this.terrain=s,this.pool=new Qu(n.context,30,s.sourceCache.tileSize*s.qualityFactor)}destruct(){this.pool.destruct()}getTexture(n){return this.pool.getObjectForId(n.rtt[this._stacks.length-1].id).texture}prepareForRender(n,s){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=n._order.filter(m=>!n._layers[m].isHidden(s)),this._coordsAscending={};for(const m in n.sourceCaches){this._coordsAscending[m]={};const y=n.sourceCaches[m].getVisibleCoordinates();for(const b of y){const I=this.terrain.sourceCache.getTerrainCoords(b);for(const M in I)this._coordsAscending[m][M]||(this._coordsAscending[m][M]=[]),this._coordsAscending[m][M].push(I[M])}}this._coordsAscendingStr={};for(const m of n._order){const y=n._layers[m],b=y.source;if(ir[y.type]&&!this._coordsAscendingStr[b]){this._coordsAscendingStr[b]={};for(const I in this._coordsAscending[b])this._coordsAscendingStr[b][I]=this._coordsAscending[b][I].map(M=>M.key).sort().join()}}for(const m of this._renderableTiles)for(const y in this._coordsAscendingStr){const b=this._coordsAscendingStr[y][m.tileID.key];b&&b!==m.rttCoords[y]&&(m.rtt=[])}}renderLayer(n,s){if(n.isHidden(this.painter.transform.zoom))return!1;const m=Object.assign(Object.assign({},s),{isRenderingToTexture:!0}),y=n.type,b=this.painter,I=this._renderableLayerIds[this._renderableLayerIds.length-1]===n.id;if(ir[y]&&(this._prevType&&ir[this._prevType]||this._stacks.push([]),this._prevType=y,this._stacks[this._stacks.length-1].push(n.id),!I))return!0;if(ir[this._prevType]||ir[y]&&I){this._prevType=y;const M=this._stacks.length-1,z=this._stacks[M]||[];for(const B of this._renderableTiles){if(this.pool.isFull()&&(Ao(this.painter,this.terrain,this._rttTiles,m),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(B),B.rtt[M]){const W=this.pool.getObjectForId(B.rtt[M].id);if(W.stamp===B.rtt[M].stamp){this.pool.useObject(W);continue}}const q=this.pool.getOrCreateFreeObject();this.pool.useObject(q),this.pool.stampObject(q),B.rtt[M]={id:q.id,stamp:q.stamp},b.context.bindFramebuffer.set(q.fbo.framebuffer),b.context.clear({color:u.b4.transparent,stencil:0}),b.currentStencilSource=void 0;for(let W=0;W<z.length;W++){const K=b.style._layers[z[W]],oe=K.source?this._coordsAscending[K.source][B.tileID.key]:[B.tileID];b.context.viewport.set([0,0,q.fbo.width,q.fbo.height]),b._renderTileClippingMasks(K,oe,!0),b.renderLayer(b,b.style.sourceCaches[K.source],K,oe,m),K.source&&(B.rttCoords[K.source]=this._coordsAscendingStr[K.source][B.tileID.key])}}return Ao(this.painter,this.terrain,this._rttTiles,m),this._rttTiles=[],this.pool.freeAllObjects(),ir[y]}return!1}}const Ah={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use ⌘ + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},jc=R,$c={hash:!1,interactive:!0,bearingSnap:7,attributionControl:Fc,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:u.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0},ku={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class ad{constructor(n,s,m=!1){this.mousedown=b=>{this.startMove(b,Q.mousePos(this.element,b)),Q.addEventListener(window,"mousemove",this.mousemove),Q.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=b=>{this.move(b,Q.mousePos(this.element,b))},this.mouseup=b=>{this._rotatePitchHanlder.dragEnd(b),this.offTemp()},this.touchstart=b=>{b.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Q.touchPos(this.element,b.targetTouches)[0],this.startMove(b,this._startPos),Q.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),Q.addEventListener(window,"touchend",this.touchend))},this.touchmove=b=>{b.targetTouches.length!==1?this.reset():(this._lastPos=Q.touchPos(this.element,b.targetTouches)[0],this.move(b,this._lastPos))},this.touchend=b=>{b.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHanlder.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=s;const y=new Nc;this._rotatePitchHanlder=new Gt({clickTolerance:3,move:(b,I)=>{const M=s.getBoundingClientRect(),z=new u.P((M.bottom-M.top)/2,(M.right-M.left)/2);return{bearingDelta:u.c7(new u.P(b.x,I.y),I,z),pitchDelta:m?-.5*(I.y-b.y):void 0}},moveStateManager:y,enable:!0,assignEvents:()=>{}}),this.map=n,Q.addEventListener(s,"mousedown",this.mousedown),Q.addEventListener(s,"touchstart",this.touchstart,{passive:!1}),Q.addEventListener(s,"touchcancel",this.reset)}startMove(n,s){this._rotatePitchHanlder.dragStart(n,s),Q.disableDrag()}move(n,s){const m=this.map,{bearingDelta:y,pitchDelta:b}=this._rotatePitchHanlder.dragMove(n,s)||{};y&&m.setBearing(m.getBearing()+y),b&&m.setPitch(m.getPitch()+b)}off(){const n=this.element;Q.removeEventListener(n,"mousedown",this.mousedown),Q.removeEventListener(n,"touchstart",this.touchstart,{passive:!1}),Q.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),Q.removeEventListener(window,"touchend",this.touchend),Q.removeEventListener(n,"touchcancel",this.reset),this.offTemp()}offTemp(){Q.enableDrag(),Q.removeEventListener(window,"mousemove",this.mousemove),Q.removeEventListener(window,"mouseup",this.mouseup),Q.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),Q.removeEventListener(window,"touchend",this.touchend)}}let Ra;function su(w,n,s){const m=new u.N(w.lng,w.lat);if(w=new u.N(w.lng,w.lat),n){const y=new u.N(w.lng-360,w.lat),b=new u.N(w.lng+360,w.lat),I=s.locationToScreenPoint(w).distSqr(n);s.locationToScreenPoint(y).distSqr(n)<I?w=y:s.locationToScreenPoint(b).distSqr(n)<I&&(w=b)}for(;Math.abs(w.lng-s.center.lng)>180;){const y=s.locationToScreenPoint(w);if(y.x>=0&&y.y>=0&&y.x<=s.width&&y.y<=s.height)break;w.lng>s.center.lng?w.lng-=360:w.lng+=360}return w.lng!==m.lng&&s.isPointOnMapSurface(s.locationToScreenPoint(w))?w:m}const Pl={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Hc(w,n,s){const m=w.classList;for(const y in Pl)m.remove(`maplibregl-${s}-anchor-${y}`);m.add(`maplibregl-${s}-anchor-${n}`)}class Ju extends u.E{constructor(n){if(super(),this._onKeyPress=s=>{const m=s.code,y=s.charCode||s.keyCode;m!=="Space"&&m!=="Enter"&&y!==32&&y!==13||this.togglePopup()},this._onMapClick=s=>{const m=s.originalEvent.target,y=this._element;this._popup&&(m===y||y.contains(m))&&this.togglePopup()},this._update=s=>{var m;if(!this._map)return;const y=this._map.loaded()&&!this._map.isMoving();(s?.type==="terrain"||s?.type==="render"&&!y)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?su(this._lngLat,this._flatPos,this._map.transform):(m=this._lngLat)===null||m===void 0?void 0:m.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let b="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?b=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(b=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let I="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?I="rotateX(0deg)":this._pitchAlignment==="map"&&(I=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||s&&s.type!=="moveend"||(this._pos=this._pos.round()),Q.setTransform(this._element,`${Pl[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${I} ${b}`),re.frameAsync(new AbortController).then(()=>{this._updateOpacity(s&&s.type==="moveend")}).catch(()=>{})},this._onMove=s=>{if(!this._isDragging){const m=this._clickTolerance||this._map._clickTolerance;this._isDragging=s.point.dist(this._pointerdownPos)>=m}this._isDragging&&(this._pos=s.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new u.k("dragstart"))),this.fire(new u.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new u.k("dragend")),this._state="inactive"},this._addDragHandler=s=>{this._element.contains(s.originalEvent.target)&&(s.preventDefault(),this._positionDelta=s.point.sub(this._pos).add(this._offset),this._pointerdownPos=s.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=n&&n.anchor||"center",this._color=n&&n.color||"#3FB1CE",this._scale=n&&n.scale||1,this._draggable=n&&n.draggable||!1,this._clickTolerance=n&&n.clickTolerance||0,this._subpixelPositioning=n&&n.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=n&&n.rotation||0,this._rotationAlignment=n&&n.rotationAlignment||"auto",this._pitchAlignment=n&&n.pitchAlignment&&n.pitchAlignment!=="auto"?n.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(n?.opacity,n?.opacityWhenCovered),n&&n.element)this._element=n.element,this._offset=u.P.convert(n&&n.offset||[0,0]);else{this._defaultMarker=!0,this._element=Q.create("div");const s=Q.createNS("http://www.w3.org/2000/svg","svg"),m=41,y=27;s.setAttributeNS(null,"display","block"),s.setAttributeNS(null,"height",`${m}px`),s.setAttributeNS(null,"width",`${y}px`),s.setAttributeNS(null,"viewBox",`0 0 ${y} ${m}`);const b=Q.createNS("http://www.w3.org/2000/svg","g");b.setAttributeNS(null,"stroke","none"),b.setAttributeNS(null,"stroke-width","1"),b.setAttributeNS(null,"fill","none"),b.setAttributeNS(null,"fill-rule","evenodd");const I=Q.createNS("http://www.w3.org/2000/svg","g");I.setAttributeNS(null,"fill-rule","nonzero");const M=Q.createNS("http://www.w3.org/2000/svg","g");M.setAttributeNS(null,"transform","translate(3.0, 29.0)"),M.setAttributeNS(null,"fill","#000000");const z=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Te of z){const Ie=Q.createNS("http://www.w3.org/2000/svg","ellipse");Ie.setAttributeNS(null,"opacity","0.04"),Ie.setAttributeNS(null,"cx","10.5"),Ie.setAttributeNS(null,"cy","5.80029008"),Ie.setAttributeNS(null,"rx",Te.rx),Ie.setAttributeNS(null,"ry",Te.ry),M.appendChild(Ie)}const B=Q.createNS("http://www.w3.org/2000/svg","g");B.setAttributeNS(null,"fill",this._color);const q=Q.createNS("http://www.w3.org/2000/svg","path");q.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),B.appendChild(q);const W=Q.createNS("http://www.w3.org/2000/svg","g");W.setAttributeNS(null,"opacity","0.25"),W.setAttributeNS(null,"fill","#000000");const K=Q.createNS("http://www.w3.org/2000/svg","path");K.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),W.appendChild(K);const oe=Q.createNS("http://www.w3.org/2000/svg","g");oe.setAttributeNS(null,"transform","translate(6.0, 7.0)"),oe.setAttributeNS(null,"fill","#FFFFFF");const le=Q.createNS("http://www.w3.org/2000/svg","g");le.setAttributeNS(null,"transform","translate(8.0, 8.0)");const we=Q.createNS("http://www.w3.org/2000/svg","circle");we.setAttributeNS(null,"fill","#000000"),we.setAttributeNS(null,"opacity","0.25"),we.setAttributeNS(null,"cx","5.5"),we.setAttributeNS(null,"cy","5.5"),we.setAttributeNS(null,"r","5.4999962");const ge=Q.createNS("http://www.w3.org/2000/svg","circle");ge.setAttributeNS(null,"fill","#FFFFFF"),ge.setAttributeNS(null,"cx","5.5"),ge.setAttributeNS(null,"cy","5.5"),ge.setAttributeNS(null,"r","5.4999962"),le.appendChild(we),le.appendChild(ge),I.appendChild(M),I.appendChild(B),I.appendChild(W),I.appendChild(oe),I.appendChild(le),s.appendChild(I),s.setAttributeNS(null,"height",m*this._scale+"px"),s.setAttributeNS(null,"width",y*this._scale+"px"),this._element.appendChild(s),this._offset=u.P.convert(n&&n.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",s=>{s.preventDefault()}),this._element.addEventListener("mousedown",s=>{s.preventDefault()}),Hc(this._element,this._anchor,"marker"),n&&n.className)for(const s of n.className.split(" "))this._element.classList.add(s);this._popup=null}addTo(n){return this.remove(),this._map=n,this._element.setAttribute("aria-label",n._getUIString("Marker.Title")),n.getCanvasContainer().appendChild(this._element),n.on("move",this._update),n.on("moveend",this._update),n.on("terrain",this._update),n.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),Q.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(n){return this._lngLat=u.N.convert(n),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(n){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),n){if(!("offset"in n.options)){const y=Math.abs(13.5)/Math.SQRT2;n.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[y,-1*(38.1-13.5+y)],"bottom-right":[-y,-1*(38.1-13.5+y)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=n,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(n){return this._subpixelPositioning=n,this}getPopup(){return this._popup}togglePopup(){const n=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:n?(n.isOpen()?n.remove():(n.setLngLat(this._lngLat),n.addTo(this._map)),this):this}_updateOpacity(n=!1){var s,m;if(!(!((s=this._map)===null||s===void 0)&&s.terrain)){const W=this._map.transform.isLocationOccluded(this._lngLat)?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==W&&(this._element.style.opacity=W))}if(n)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const y=this._map,b=y.terrain.depthAtPoint(this._pos),I=y.terrain.getElevationForLngLatZoom(this._lngLat,y.transform.tileZoom);if(y.transform.lngLatToCameraDepth(this._lngLat,I)-b<.006)return void(this._element.style.opacity=this._opacity);const M=-this._offset.y/y.transform.pixelsPerMeter,z=Math.sin(y.getPitch()*Math.PI/180)*M,B=y.terrain.depthAtPoint(new u.P(this._pos.x,this._pos.y-this._offset.y)),q=y.transform.lngLatToCameraDepth(this._lngLat,I+z)-B>.006;!((m=this._popup)===null||m===void 0)&&m.isOpen()&&q&&this._popup.remove(),this._element.style.opacity=q?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(n){return this._offset=u.P.convert(n),this._update(),this}addClassName(n){this._element.classList.add(n)}removeClassName(n){this._element.classList.remove(n)}toggleClassName(n){return this._element.classList.toggle(n)}setDraggable(n){return this._draggable=!!n,this._map&&(n?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(n){return this._rotation=n||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(n){return this._rotationAlignment=n||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(n){return this._pitchAlignment=n&&n!=="auto"?n:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(n,s){return n===void 0&&s===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),n!==void 0&&(this._opacity=n),s!==void 0&&(this._opacityWhenCovered=s),this._map&&this._updateOpacity(!0),this}}const kh={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Mu=0,La=!1;const Ns={maxWidth:100,unit:"metric"};function Cl(w,n,s){const m=s&&s.maxWidth||100,y=w._container.clientHeight/2,b=w._container.clientWidth/2,I=w.unproject([b-m/2,y]),M=w.unproject([b+m/2,y]),z=Math.round(w.project(M).x-w.project(I).x),B=Math.min(m,z,w._container.clientWidth),q=I.distanceTo(M);if(s&&s.unit==="imperial"){const W=3.2808*q;W>5280?Al(n,B,W/5280,w._getUIString("ScaleControl.Miles")):Al(n,B,W,w._getUIString("ScaleControl.Feet"))}else s&&s.unit==="nautical"?Al(n,B,q/1852,w._getUIString("ScaleControl.NauticalMiles")):q>=1e3?Al(n,B,q/1e3,w._getUIString("ScaleControl.Kilometers")):Al(n,B,q,w._getUIString("ScaleControl.Meters"))}function Al(w,n,s,m){const y=function(b){const I=Math.pow(10,`${Math.floor(b)}`.length-1);let M=b/I;return M=M>=10?10:M>=5?5:M>=3?3:M>=2?2:M>=1?1:function(z){const B=Math.pow(10,Math.ceil(-Math.log(z)/Math.LN10));return Math.round(z*B)/B}(M),I*M}(s);w.style.width=n*(y/s)+"px",w.innerHTML=`${y}&nbsp;${m}`}const ld={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},nl=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Da(w){if(w){if(typeof w=="number"){const n=Math.round(Math.abs(w)/Math.SQRT2);return{center:new u.P(0,0),top:new u.P(0,w),"top-left":new u.P(n,n),"top-right":new u.P(-n,n),bottom:new u.P(0,-w),"bottom-left":new u.P(n,-n),"bottom-right":new u.P(-n,-n),left:new u.P(w,0),right:new u.P(-w,0)}}if(w instanceof u.P||Array.isArray(w)){const n=u.P.convert(w);return{center:n,top:n,"top-left":n,"top-right":n,bottom:n,"bottom-left":n,"bottom-right":n,left:n,right:n}}return{center:u.P.convert(w.center||[0,0]),top:u.P.convert(w.top||[0,0]),"top-left":u.P.convert(w["top-left"]||[0,0]),"top-right":u.P.convert(w["top-right"]||[0,0]),bottom:u.P.convert(w.bottom||[0,0]),"bottom-left":u.P.convert(w["bottom-left"]||[0,0]),"bottom-right":u.P.convert(w["bottom-right"]||[0,0]),left:u.P.convert(w.left||[0,0]),right:u.P.convert(w.right||[0,0])}}return Da(new u.P(0,0))}const Mh=R;_.AJAXError=u.cg,_.Event=u.k,_.Evented=u.E,_.LngLat=u.N,_.MercatorCoordinate=u.Y,_.Point=u.P,_.addProtocol=u.ch,_.config=u.a,_.removeProtocol=u.ci,_.AttributionControl=Bc,_.BoxZoomHandler=hr,_.CanvasSource=Ts,_.CooperativeGesturesHandler=Ph,_.DoubleClickZoomHandler=hs,_.DragPanHandler=Il,_.DragRotateHandler=sd,_.EdgeInsets=Ir,_.FullscreenControl=class extends u.E{constructor(w={}){super(),this._onFullscreenChange=()=>{var n;let s=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((n=s?.shadowRoot)===null||n===void 0)&&n.fullscreenElement;)s=s.shadowRoot.fullscreenElement;s===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,w&&w.container&&(w.container instanceof HTMLElement?this._container=w.container:u.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(w){return this._map=w,this._container||(this._container=this._map.getContainer()),this._controlContainer=Q.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){Q.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const w=this._fullscreenButton=Q.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);Q.create("span","maplibregl-ctrl-icon",w).setAttribute("aria-hidden","true"),w.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const w=this._getTitle();this._fullscreenButton.setAttribute("aria-label",w),this._fullscreenButton.title=w}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new u.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new u.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},_.GeoJSONSource=Jo,_.GeolocateControl=class extends u.E{constructor(w){super(),this._onSuccess=n=>{if(this._map){if(this._isOutOfMapMaxBounds(n))return this._setErrorState(),this.fire(new u.k("outofmaxbounds",n)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=n,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(n),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(n),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new u.k("geolocate",n)),this._finish()}},this._updateCamera=n=>{const s=new u.N(n.coords.longitude,n.coords.latitude),m=n.coords.accuracy,y=this._map.getBearing(),b=u.e({bearing:y},this.options.fitBoundsOptions),I=Wi.fromLngLat(s,m);this._map.fitBounds(I,b,{geolocateSource:!0})},this._updateMarker=n=>{if(n){const s=new u.N(n.coords.longitude,n.coords.latitude);this._accuracyCircleMarker.setLngLat(s).addTo(this._map),this._userLocationDotMarker.setLngLat(s).addTo(this._map),this._accuracy=n.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=n=>{if(this._map){if(this.options.trackUserLocation)if(n.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(n.code===3&&La)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new u.k("error",n)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",n=>n.preventDefault()),this._geolocateButton=Q.create("button","maplibregl-ctrl-geolocate",this._container),Q.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=n=>{if(this._map){if(n===!1){u.w("Geolocation support is not available so the GeolocateControl will be disabled.");const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s)}else{const s=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Q.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Ju({element:this._dotElement}),this._circleElement=Q.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ju({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",s=>{s.geolocateSource||this._watchState!=="ACTIVE_LOCK"||s.originalEvent&&s.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new u.k("trackuserlocationend")),this.fire(new u.k("userlocationlostfocus")))})}},this.options=u.e({},kh,w)}onAdd(w){return this._map=w,this._container=Q.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return u._(this,arguments,void 0,function*(n=!1){if(Ra!==void 0&&!n)return Ra;if(window.navigator.permissions===void 0)return Ra=!!window.navigator.geolocation,Ra;try{Ra=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Ra=!!window.navigator.geolocation}return Ra})}().then(n=>this._finishSetupUI(n)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),Q.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Mu=0,La=!1}_isOutOfMapMaxBounds(w){const n=this._map.getMaxBounds(),s=w.coords;return n&&(s.longitude<n.getWest()||s.longitude>n.getEast()||s.latitude<n.getSouth()||s.latitude>n.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const w=this._map.getBounds(),n=w.getSouthEast(),s=w.getNorthEast(),m=n.distanceTo(s),y=Math.ceil(this._accuracy/(m/this._map._container.clientHeight)*2);this._circleElement.style.width=`${y}px`,this._circleElement.style.height=`${y}px`}trigger(){if(!this._setup)return u.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new u.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Mu--,La=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new u.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new u.k("trackuserlocationstart")),this.fire(new u.k("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let w;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Mu++,Mu>1?(w={maximumAge:6e5,timeout:0},La=!0):(w=this.options.positionOptions,La=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,w)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},_.GlobeControl=class{constructor(){this._toggleProjection=()=>{var w;const n=(w=this._map.getProjection())===null||w===void 0?void 0:w.type;this._map.setProjection(n!=="mercator"&&n?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var w;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((w=this._map.getProjection())===null||w===void 0?void 0:w.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(w){return this._map=w,this._container=Q.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=Q.create("button","maplibregl-ctrl-globe",this._container),Q.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){Q.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},_.Hash=Aa,_.ImageSource=vr,_.KeyboardHandler=Sh,_.LngLatBounds=Wi,_.LogoControl=Vc,_.Map=class extends En{constructor(w){var n,s;u.cd.mark(u.ce.create);const m=Object.assign(Object.assign(Object.assign({},$c),w),{canvasContextAttributes:Object.assign(Object.assign({},$c.canvasContextAttributes),w.canvasContextAttributes)});if(m.minZoom!=null&&m.maxZoom!=null&&m.minZoom>m.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(m.minPitch!=null&&m.maxPitch!=null&&m.minPitch>m.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(m.minPitch!=null&&m.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(m.maxPitch!=null&&m.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const y=new fo,b=new fl;if(m.minZoom!==void 0&&y.setMinZoom(m.minZoom),m.maxZoom!==void 0&&y.setMaxZoom(m.maxZoom),m.minPitch!==void 0&&y.setMinPitch(m.minPitch),m.maxPitch!==void 0&&y.setMaxPitch(m.maxPitch),m.renderWorldCopies!==void 0&&y.setRenderWorldCopies(m.renderWorldCopies),super(y,b,{bearingSnap:m.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new ds,this._controls=[],this._mapId=u.a1(),this._contextLost=M=>{M.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new u.k("webglcontextlost",{originalEvent:M}))},this._contextRestored=M=>{this._setupPainter(),this.resize(),this._update(),this.fire(new u.k("webglcontextrestored",{originalEvent:M}))},this._onMapScroll=M=>{if(M.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=m.interactive,this._maxTileCacheSize=m.maxTileCacheSize,this._maxTileCacheZoomLevels=m.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},m.canvasContextAttributes),this._trackResize=m.trackResize===!0,this._bearingSnap=m.bearingSnap,this._centerClampedToGround=m.centerClampedToGround,this._refreshExpiredTiles=m.refreshExpiredTiles===!0,this._fadeDuration=m.fadeDuration,this._crossSourceCollisions=m.crossSourceCollisions===!0,this._collectResourceTiming=m.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},Ah),m.locale),this._clickTolerance=m.clickTolerance,this._overridePixelRatio=m.pixelRatio,this._maxCanvasSize=m.maxCanvasSize,this.transformCameraUpdate=m.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=m.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=Ye.addThrottleControl(()=>this.isMoving()),this._requestManager=new it(m.transformRequest),typeof m.container=="string"){if(this._container=document.getElementById(m.container),!this._container)throw new Error(`Container '${m.container}' not found.`)}else{if(!(m.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=m.container}if(m.maxBounds&&this.setMaxBounds(m.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let M=!1;const z=Ca(B=>{this._trackResize&&!this._removed&&(this.resize(B),this.redraw())},50);this._resizeObserver=new ResizeObserver(B=>{M?z(B):M=!0}),this._resizeObserver.observe(this._container)}this.handlers=new rn(this,m),this._hash=m.hash&&new Aa(typeof m.hash=="string"&&m.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:m.center,elevation:m.elevation,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch,roll:m.roll}),m.bounds&&(this.resize(),this.fitBounds(m.bounds,u.e({},m.fitBoundsOptions,{duration:0}))));const I=typeof m.style=="string"||((s=(n=m.style)===null||n===void 0?void 0:n.projection)===null||s===void 0?void 0:s.type)!=="globe";this.resize(null,I),this._localIdeographFontFamily=m.localIdeographFontFamily,this._validateStyle=m.validateStyle,m.style&&this.setStyle(m.style,{localIdeographFontFamily:m.localIdeographFontFamily}),m.attributionControl&&this.addControl(new Bc(typeof m.attributionControl=="boolean"?void 0:m.attributionControl)),m.maplibreLogo&&this.addControl(new Vc,m.logoPosition),this.on("style.load",()=>{if(I||this._resizeTransform(),this.transform.unmodified){const M=u.M(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(M)}}),this.on("data",M=>{this._update(M.dataType==="style"),this.fire(new u.k(`${M.dataType}data`,M))}),this.on("dataloading",M=>{this.fire(new u.k(`${M.dataType}dataloading`,M))}),this.on("dataabort",M=>{this.fire(new u.k("sourcedataabort",M))})}_getMapId(){return this._mapId}addControl(w,n){if(n===void 0&&(n=w.getDefaultPosition?w.getDefaultPosition():"top-right"),!w||!w.onAdd)return this.fire(new u.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const s=w.onAdd(this);this._controls.push(w);const m=this._controlPositions[n];return n.indexOf("bottom")!==-1?m.insertBefore(s,m.firstChild):m.appendChild(s),this}removeControl(w){if(!w||!w.onRemove)return this.fire(new u.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const n=this._controls.indexOf(w);return n>-1&&this._controls.splice(n,1),w.onRemove(this),this}hasControl(w){return this._controls.indexOf(w)>-1}calculateCameraOptionsFromTo(w,n,s,m){return m==null&&this.terrain&&(m=this.terrain.getElevationForLngLatZoom(s,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(w,n,s,m)}resize(w,n=!0){const[s,m]=this._containerDimensions(),y=this._getClampedPixelRatio(s,m);if(this._resizeCanvas(s,m,y),this.painter.resize(s,m,y),this.painter.overLimit()){const I=this.painter.context.gl;this._maxCanvasSize=[I.drawingBufferWidth,I.drawingBufferHeight];const M=this._getClampedPixelRatio(s,m);this._resizeCanvas(s,m,M),this.painter.resize(s,m,M)}this._resizeTransform(n);const b=!this._moving;return b&&(this.stop(),this.fire(new u.k("movestart",w)).fire(new u.k("move",w))),this.fire(new u.k("resize",w)),b&&this.fire(new u.k("moveend",w)),this}_resizeTransform(w=!0){var n;const[s,m]=this._containerDimensions();this.transform.resize(s,m,w),(n=this._requestedCameraState)===null||n===void 0||n.resize(s,m,w)}_getClampedPixelRatio(w,n){const{0:s,1:m}=this._maxCanvasSize,y=this.getPixelRatio(),b=w*y,I=n*y;return Math.min(b>s?s/b:1,I>m?m/I:1)*y}getPixelRatio(){var w;return(w=this._overridePixelRatio)!==null&&w!==void 0?w:devicePixelRatio}setPixelRatio(w){this._overridePixelRatio=w,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(w){return this.transform.setMaxBounds(Wi.convert(w)),this._update()}setMinZoom(w){if((w=w??-2)>=-2&&w<=this.transform.maxZoom)return this.transform.setMinZoom(w),this._update(),this.getZoom()<w&&this.setZoom(w),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(w){if((w=w??22)>=this.transform.minZoom)return this.transform.setMaxZoom(w),this._update(),this.getZoom()>w&&this.setZoom(w),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(w){if((w=w??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(w>=0&&w<=this.transform.maxPitch)return this.transform.setMinPitch(w),this._update(),this.getPitch()<w&&this.setPitch(w),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(w){if((w=w??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(w>=this.transform.minPitch)return this.transform.setMaxPitch(w),this._update(),this.getPitch()>w&&this.setPitch(w),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(w){return this.transform.setRenderWorldCopies(w),this._update()}project(w){return this.transform.locationToScreenPoint(u.N.convert(w),this.style&&this.terrain)}unproject(w){return this.transform.screenPointToLocation(u.P.convert(w),this.terrain)}isMoving(){var w;return this._moving||((w=this.handlers)===null||w===void 0?void 0:w.isMoving())}isZooming(){var w;return this._zooming||((w=this.handlers)===null||w===void 0?void 0:w.isZooming())}isRotating(){var w;return this._rotating||((w=this.handlers)===null||w===void 0?void 0:w.isRotating())}_createDelegatedListener(w,n,s){if(w==="mouseenter"||w==="mouseover"){let m=!1;return{layers:n,listener:s,delegates:{mousemove:b=>{const I=n.filter(z=>this.getLayer(z)),M=I.length!==0?this.queryRenderedFeatures(b.point,{layers:I}):[];M.length?m||(m=!0,s.call(this,new $i(w,this,b.originalEvent,{features:M}))):m=!1},mouseout:()=>{m=!1}}}}if(w==="mouseleave"||w==="mouseout"){let m=!1;return{layers:n,listener:s,delegates:{mousemove:I=>{const M=n.filter(z=>this.getLayer(z));(M.length!==0?this.queryRenderedFeatures(I.point,{layers:M}):[]).length?m=!0:m&&(m=!1,s.call(this,new $i(w,this,I.originalEvent)))},mouseout:I=>{m&&(m=!1,s.call(this,new $i(w,this,I.originalEvent)))}}}}{const m=y=>{const b=n.filter(M=>this.getLayer(M)),I=b.length!==0?this.queryRenderedFeatures(y.point,{layers:b}):[];I.length&&(y.features=I,s.call(this,y),delete y.features)};return{layers:n,listener:s,delegates:{[w]:m}}}}_saveDelegatedListener(w,n){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[w]=this._delegatedListeners[w]||[],this._delegatedListeners[w].push(n)}_removeDelegatedListener(w,n,s){if(!this._delegatedListeners||!this._delegatedListeners[w])return;const m=this._delegatedListeners[w];for(let y=0;y<m.length;y++){const b=m[y];if(b.listener===s&&b.layers.length===n.length&&b.layers.every(I=>n.includes(I))){for(const I in b.delegates)this.off(I,b.delegates[I]);return void m.splice(y,1)}}}on(w,n,s){if(s===void 0)return super.on(w,n);const m=typeof n=="string"?[n]:n,y=this._createDelegatedListener(w,m,s);this._saveDelegatedListener(w,y);for(const b in y.delegates)this.on(b,y.delegates[b]);return{unsubscribe:()=>{this._removeDelegatedListener(w,m,s)}}}once(w,n,s){if(s===void 0)return super.once(w,n);const m=typeof n=="string"?[n]:n,y=this._createDelegatedListener(w,m,s);for(const b in y.delegates){const I=y.delegates[b];y.delegates[b]=(...M)=>{this._removeDelegatedListener(w,m,s),I(...M)}}this._saveDelegatedListener(w,y);for(const b in y.delegates)this.once(b,y.delegates[b]);return this}off(w,n,s){return s===void 0?super.off(w,n):(this._removeDelegatedListener(w,typeof n=="string"?[n]:n,s),this)}queryRenderedFeatures(w,n){if(!this.style)return[];let s;const m=w instanceof u.P||Array.isArray(w),y=m?w:[[0,0],[this.transform.width,this.transform.height]];if(n=n||(m?{}:w)||{},y instanceof u.P||typeof y[0]=="number")s=[u.P.convert(y)];else{const b=u.P.convert(y[0]),I=u.P.convert(y[1]);s=[b,new u.P(I.x,b.y),I,new u.P(b.x,I.y),b]}return this.style.queryRenderedFeatures(s,n,this.transform)}querySourceFeatures(w,n){return this.style.querySourceFeatures(w,n)}setStyle(w,n){return(n=u.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},n)).diff!==!1&&n.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&w?(this._diffStyle(w,n),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._updateStyle(w,n))}setTransformRequest(w){return this._requestManager.setTransformRequest(w),this}_getUIString(w){const n=this._locale[w];if(n==null)throw new Error(`Missing UI string '${w}'`);return n}_updateStyle(w,n){var s,m;if(n.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(w,n));const y=this.style&&n.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!w)),w?(this.style=new no(this,n||{}),this.style.setEventedParent(this,{style:this.style}),typeof w=="string"?this.style.loadURL(w,n,y):this.style.loadJSON(w,n,y),this):((m=(s=this.style)===null||s===void 0?void 0:s.projection)===null||m===void 0||m.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new no(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(w,n){if(typeof w=="string"){const s=this._requestManager.transformRequest(w,"Style");u.h(s,new AbortController).then(m=>{this._updateDiff(m.data,n)}).catch(m=>{m&&this.fire(new u.j(m))})}else typeof w=="object"&&this._updateDiff(w,n)}_updateDiff(w,n){try{this.style.setState(w,n)&&this._update(!0)}catch(s){u.w(`Unable to perform style diff: ${s.message||s.error||s}.  Rebuilding the style from scratch.`),this._updateStyle(w,n)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():u.w("There is no style added to the map.")}addSource(w,n){return this._lazyInitEmptyStyle(),this.style.addSource(w,n),this._update(!0)}isSourceLoaded(w){const n=this.style&&this.style.sourceCaches[w];if(n!==void 0)return n.loaded();this.fire(new u.j(new Error(`There is no source with ID '${w}'`)))}setTerrain(w){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),w){const n=this.style.sourceCaches[w.source];if(!n)throw new Error(`cannot load terrain, because there exists no source with ID: ${w.source}`);this.terrain===null&&n.reload();for(const s in this.style._layers){const m=this.style._layers[s];m.type==="hillshade"&&m.source===w.source&&u.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Uc(this.painter,n,w),this.painter.renderToTexture=new _r(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=s=>{s.dataType==="style"?this.terrain.sourceCache.freeRtt():s.dataType==="source"&&s.tile&&(s.sourceId!==w.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),this.terrain.sourceCache.freeRtt(s.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new u.k("terrain",{terrain:w})),this}getTerrain(){var w,n;return(n=(w=this.terrain)===null||w===void 0?void 0:w.options)!==null&&n!==void 0?n:null}areTilesLoaded(){const w=this.style&&this.style.sourceCaches;for(const n in w){const s=w[n]._tiles;for(const m in s){const y=s[m];if(y.state!=="loaded"&&y.state!=="errored")return!1}}return!0}removeSource(w){return this.style.removeSource(w),this._update(!0)}getSource(w){return this.style.getSource(w)}addImage(w,n,s={}){const{pixelRatio:m=1,sdf:y=!1,stretchX:b,stretchY:I,content:M,textFitWidth:z,textFitHeight:B}=s;if(this._lazyInitEmptyStyle(),!(n instanceof HTMLImageElement||u.b(n))){if(n.width===void 0||n.height===void 0)return this.fire(new u.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:q,height:W,data:K}=n,oe=n;return this.style.addImage(w,{data:new u.R({width:q,height:W},new Uint8Array(K)),pixelRatio:m,stretchX:b,stretchY:I,content:M,textFitWidth:z,textFitHeight:B,sdf:y,version:0,userImage:oe}),oe.onAdd&&oe.onAdd(this,w),this}}{const{width:q,height:W,data:K}=re.getImageData(n);this.style.addImage(w,{data:new u.R({width:q,height:W},K),pixelRatio:m,stretchX:b,stretchY:I,content:M,textFitWidth:z,textFitHeight:B,sdf:y,version:0})}}updateImage(w,n){const s=this.style.getImage(w);if(!s)return this.fire(new u.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const m=n instanceof HTMLImageElement||u.b(n)?re.getImageData(n):n,{width:y,height:b,data:I}=m;if(y===void 0||b===void 0)return this.fire(new u.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(y!==s.data.width||b!==s.data.height)return this.fire(new u.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const M=!(n instanceof HTMLImageElement||u.b(n));return s.data.replace(I,M),this.style.updateImage(w,s),this}getImage(w){return this.style.getImage(w)}hasImage(w){return w?!!this.style.getImage(w):(this.fire(new u.j(new Error("Missing required image id"))),!1)}removeImage(w){this.style.removeImage(w)}loadImage(w){return Ye.getImage(this._requestManager.transformRequest(w,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(w,n){return this._lazyInitEmptyStyle(),this.style.addLayer(w,n),this._update(!0)}moveLayer(w,n){return this.style.moveLayer(w,n),this._update(!0)}removeLayer(w){return this.style.removeLayer(w),this._update(!0)}getLayer(w){return this.style.getLayer(w)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(w,n,s){return this.style.setLayerZoomRange(w,n,s),this._update(!0)}setFilter(w,n,s={}){return this.style.setFilter(w,n,s),this._update(!0)}getFilter(w){return this.style.getFilter(w)}setPaintProperty(w,n,s,m={}){return this.style.setPaintProperty(w,n,s,m),this._update(!0)}getPaintProperty(w,n){return this.style.getPaintProperty(w,n)}setLayoutProperty(w,n,s,m={}){return this.style.setLayoutProperty(w,n,s,m),this._update(!0)}getLayoutProperty(w,n){return this.style.getLayoutProperty(w,n)}setGlyphs(w,n={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(w,n),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(w,n,s={}){return this._lazyInitEmptyStyle(),this.style.addSprite(w,n,s,m=>{m||this._update(!0)}),this}removeSprite(w){return this._lazyInitEmptyStyle(),this.style.removeSprite(w),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(w,n={}){return this._lazyInitEmptyStyle(),this.style.setSprite(w,n,s=>{s||this._update(!0)}),this}setLight(w,n={}){return this._lazyInitEmptyStyle(),this.style.setLight(w,n),this._update(!0)}getLight(){return this.style.getLight()}setSky(w,n={}){return this._lazyInitEmptyStyle(),this.style.setSky(w,n),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(w,n){return this.style.setFeatureState(w,n),this._update()}removeFeatureState(w,n){return this.style.removeFeatureState(w,n),this._update()}getFeatureState(w){return this.style.getFeatureState(w)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let w=0,n=0;return this._container&&(w=this._container.clientWidth||400,n=this._container.clientHeight||300),[w,n]}_setupContainer(){const w=this._container;w.classList.add("maplibregl-map");const n=this._canvasContainer=Q.create("div","maplibregl-canvas-container",w);this._interactive&&n.classList.add("maplibregl-interactive"),this._canvas=Q.create("canvas","maplibregl-canvas",n),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const s=this._containerDimensions(),m=this._getClampedPixelRatio(s[0],s[1]);this._resizeCanvas(s[0],s[1],m);const y=this._controlContainer=Q.create("div","maplibregl-control-container",w),b=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(I=>{b[I]=Q.create("div",`maplibregl-ctrl-${I} `,y)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(w,n,s){this._canvas.width=Math.floor(s*w),this._canvas.height=Math.floor(s*n),this._canvas.style.width=`${w}px`,this._canvas.style.height=`${n}px`}_setupPainter(){const w=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let n=null;this._canvas.addEventListener("webglcontextcreationerror",m=>{n={requestedAttributes:w},m&&(n.statusMessage=m.statusMessage,n.type=m.type)},{once:!0});let s=null;if(s=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,w):this._canvas.getContext("webgl2",w)||this._canvas.getContext("webgl",w),!s){const m="Failed to initialize WebGL";throw n?(n.message=m,new Error(JSON.stringify(n))):new Error(m)}this.painter=new Jl(s,this.transform),de.testSupport(s)}migrateProjection(w,n){super.migrateProjection(w,n),this.painter.transform=w,this.fire(new u.k("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(w){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||w,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(w){return this._update(),this._renderTaskQueue.add(w)}_cancelRenderFrame(w){this._renderTaskQueue.remove(w)}_render(w){var n,s,m,y,b;const I=this._idleTriggered?this._fadeDuration:0,M=((n=this.style.projection)===null||n===void 0?void 0:n.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(w),this._removed)return;let z=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const W=this.transform.zoom,K=re.now();this.style.zoomHistory.update(W,K);const oe=new u.z(W,{now:K,fadeDuration:I,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),le=oe.crossFadingFactor();le===1&&le===this._crossFadingFactor||(z=!0,this._crossFadingFactor=le),this.style.update(oe)}const B=((s=this.style.projection)===null||s===void 0?void 0:s.transitionState)>0!==M;(m=this.style.projection)===null||m===void 0||m.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((y=this.style.projection)===null||y===void 0?void 0:y.transitionState,(b=this.style.projection)===null||b===void 0?void 0:b.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||B)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,I,this._crossSourceCollisions,B),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:I,showPadding:this.showPadding}),this.fire(new u.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,u.cd.mark(u.ce.load),this.fire(new u.k("load"))),this.style&&(this.style.hasTransitions()||z)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const q=this._sourcesDirty||this._styleDirty||this._placementDirty;return q||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new u.k("idle")),!this._loaded||this._fullyLoaded||q||(this._fullyLoaded=!0,u.cd.mark(u.ce.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var w;this._hash&&this._hash.remove();for(const s of this._controls)s.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),Ye.removeThrottleControl(this._imageQueueHandle),(w=this._resizeObserver)===null||w===void 0||w.disconnect();const n=this.painter.context.gl.getExtension("WEBGL_lose_context");n?.loseContext&&n.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),Q.remove(this._canvasContainer),Q.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),u.cd.clearMetrics(),this._removed=!0,this.fire(new u.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,re.frame(this._frameRequest,w=>{u.cd.frame(w),this._frameRequest=null;try{this._render(w)}catch(n){if(!u.cf(n)&&!function(s){return s.message===Eu}(n))throw n}},()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(w){this._showTileBoundaries!==w&&(this._showTileBoundaries=w,this._update())}get showPadding(){return!!this._showPadding}set showPadding(w){this._showPadding!==w&&(this._showPadding=w,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(w){this._showCollisionBoxes!==w&&(this._showCollisionBoxes=w,w?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(w){this._showOverdrawInspector!==w&&(this._showOverdrawInspector=w,this._update())}get repaint(){return!!this._repaint}set repaint(w){this._repaint!==w&&(this._repaint=w,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(w){this._vertices=w,this._update()}get version(){return jc}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(w){return this._lazyInitEmptyStyle(),this.style.setProjection(w),this._update(!0)}},_.MapMouseEvent=$i,_.MapTouchEvent=Ds,_.MapWheelEvent=Uo,_.Marker=Ju,_.NavigationControl=class{constructor(w){this._updateZoomButtons=()=>{const n=this._map.getZoom(),s=n===this._map.getMaxZoom(),m=n===this._map.getMinZoom();this._zoomInButton.disabled=s,this._zoomOutButton.disabled=m,this._zoomInButton.setAttribute("aria-disabled",s.toString()),this._zoomOutButton.setAttribute("aria-disabled",m.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(n,s)=>{const m=this._map._getUIString(`NavigationControl.${s}`);n.title=m,n.setAttribute("aria-label",m)},this.options=u.e({},ku,w),this._container=Q.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",n=>n.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",n=>this._map.zoomIn({},{originalEvent:n})),Q.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",n=>this._map.zoomOut({},{originalEvent:n})),Q.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",n=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:n}):this._map.resetNorth({},{originalEvent:n})}),this._compassIcon=Q.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(w){return this._map=w,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new ad(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){Q.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(w,n){const s=Q.create("button",w,this._container);return s.type="button",s.addEventListener("click",n),s}},_.Popup=class extends u.E{constructor(w){super(),this.remove=()=>(this._content&&Q.remove(this._content),this._container&&(Q.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new u.k("close"))),this),this._onMouseUp=n=>{this._update(n.point)},this._onMouseMove=n=>{this._update(n.point)},this._onDrag=n=>{this._update(n.point)},this._update=n=>{var s;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=Q.create("div","maplibregl-popup",this._map.getContainer()),this._tip=Q.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const M of this.options.className.split(" "))this._container.classList.add(M);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?su(this._lngLat,this._flatPos,this._map.transform):(s=this._lngLat)===null||s===void 0?void 0:s.wrap(),this._trackPointer&&!n)return;const m=this._flatPos=this._pos=this._trackPointer&&n?n:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&n?n:this._map.transform.locationToScreenPoint(this._lngLat));let y=this.options.anchor;const b=Da(this.options.offset);if(!y){const M=this._container.offsetWidth,z=this._container.offsetHeight;let B;B=m.y+b.bottom.y<z?["top"]:m.y>this._map.transform.height-z?["bottom"]:[],m.x<M/2?B.push("left"):m.x>this._map.transform.width-M/2&&B.push("right"),y=B.length===0?"bottom":B.join("-")}let I=m.add(b[y]);this.options.subpixelPositioning||(I=I.round()),Q.setTransform(this._container,`${Pl[y]} translate(${I.x}px,${I.y}px)`),Hc(this._container,y,"popup")},this._onClose=()=>{this.remove()},this.options=u.e(Object.create(ld),w)}addTo(w){return this._map&&this.remove(),this._map=w,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new u.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(w){return this._lngLat=u.N.convert(w),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(w){return this.setDOMContent(document.createTextNode(w))}setHTML(w){const n=document.createDocumentFragment(),s=document.createElement("body");let m;for(s.innerHTML=w;m=s.firstChild,m;)n.appendChild(m);return this.setDOMContent(n)}getMaxWidth(){var w;return(w=this._container)===null||w===void 0?void 0:w.style.maxWidth}setMaxWidth(w){return this.options.maxWidth=w,this._update(),this}setDOMContent(w){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=Q.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(w),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(w){return this._container&&this._container.classList.add(w),this}removeClassName(w){return this._container&&this._container.classList.remove(w),this}setOffset(w){return this.options.offset=w,this._update(),this}toggleClassName(w){if(this._container)return this._container.classList.toggle(w)}setSubpixelPositioning(w){this.options.subpixelPositioning=w}_createCloseButton(){this.options.closeButton&&(this._closeButton=Q.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const w=this._container.querySelector(nl);w&&w.focus()}},_.RasterDEMTileSource=Oo,_.RasterTileSource=Qr,_.ScaleControl=class{constructor(w){this._onMove=()=>{Cl(this._map,this._container,this.options)},this.setUnit=n=>{this.options.unit=n,Cl(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Ns),w)}getDefaultPosition(){return"bottom-left"}onAdd(w){return this._map=w,this._container=Q.create("div","maplibregl-ctrl maplibregl-ctrl-scale",w.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){Q.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},_.ScrollZoomHandler=ia,_.Style=no,_.TerrainControl=class{constructor(w){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=w}onAdd(w){return this._map=w,this._container=Q.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=Q.create("button","maplibregl-ctrl-terrain",this._container),Q.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){Q.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},_.TwoFingersTouchPitchHandler=ou,_.TwoFingersTouchRotateHandler=Hp,_.TwoFingersTouchZoomHandler=Oc,_.TwoFingersTouchZoomRotateHandler=Ih,_.VectorTileSource=bs,_.VideoSource=Jr,_.addSourceType=(w,n)=>u._(void 0,void 0,void 0,function*(){if(_a(w))throw new Error(`A source type called "${w}" already exists.`);((s,m)=>{Fo[s]=m})(w,n)}),_.clearPrewarmedResources=function(){const w=sn;w&&(w.isPreloaded()&&w.numActive()===1?(w.release(Ze),sn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},_.createTileMesh=ji,_.getMaxParallelImageRequests=function(){return u.a.MAX_PARALLEL_IMAGE_REQUESTS},_.getRTLTextPluginStatus=function(){return qr().getRTLTextPluginStatus()},_.getVersion=function(){return Mh},_.getWorkerCount=function(){return wt.workerCount},_.getWorkerUrl=function(){return u.a.WORKER_URL},_.importScriptInWorkers=function(w){return $n().broadcast("IS",w)},_.prewarm=function(){nn().acquire(Ze)},_.setMaxParallelImageRequests=function(w){u.a.MAX_PARALLEL_IMAGE_REQUESTS=w},_.setRTLTextPlugin=function(w,n){return qr().setRTLTextPlugin(w,n)},_.setWorkerCount=function(w){wt.workerCount=w},_.setWorkerUrl=function(w){u.a.WORKER_URL=w}});var g=t;return g})}(ey)),ey.exports}var NN=zN();const In=Rg(NN);function ON(){return typeof self<"u"?fetch.bind(self):typeof global<"u"&&global.fetch?global.fetch:null}class FN{constructor(){this._apiKey="",this._fetch=ON(),this.tileCacheSize=200}set apiKey(e){this._apiKey=e}get apiKey(){return this._apiKey}set fetch(e){this._fetch=e}get fetch(){return this._fetch}}const jf=new FN,BN={AUTO:{code:null,flag:"auto",name:"Auto",latin:!1,isMode:!0,geocoding:!0},LATIN:{code:"latin",flag:"name:latin",name:"Latin",latin:!0,isMode:!1,geocoding:!1},NON_LATIN:{code:"nonlatin",flag:"name:nonlatin",name:"Non Latin",latin:!1,isMode:!1,geocoding:!1},LOCAL:{code:null,flag:"name",name:"Local",latin:!0,isMode:!1,geocoding:!1}},VN={ALBANIAN:{code:"sq",flag:"name:sq",name:"Albanian",latin:!0,isMode:!1,geocoding:!0},AMHARIC:{code:"am",flag:"name:am",name:"Amharic",latin:!1,isMode:!1,geocoding:!1},ARABIC:{code:"ar",flag:"name:ar",name:"Arabic",latin:!1,isMode:!1,geocoding:!0},ARMENIAN:{code:"hy",flag:"name:hy",name:"Armenian",latin:!1,isMode:!1,geocoding:!0},AZERBAIJANI:{code:"az",flag:"name:az",name:"Azerbaijani",latin:!0,isMode:!1,geocoding:!0},BASQUE:{code:"eu",flag:"name:eu",name:"Basque",latin:!0,isMode:!1,geocoding:!1},BELARUSIAN:{code:"be",flag:"name:be",name:"Belarusian",latin:!1,isMode:!1,geocoding:!0},BENGALI:{code:"bn",flag:"name:bn",name:"Bengali",latin:!0,isMode:!1,geocoding:!1},BOSNIAN:{code:"bs",flag:"name:bs",name:"Bosnian",latin:!0,isMode:!1,geocoding:!0},BRETON:{code:"br",flag:"name:br",name:"Breton",latin:!0,isMode:!1,geocoding:!0},BULGARIAN:{code:"bg",flag:"bg",name:"Bulgarian",latin:!1,isMode:!1,geocoding:!0},CATALAN:{code:"ca",flag:"name:ca",name:"Catalan",latin:!0,isMode:!1,geocoding:!0},CHINESE:{code:"zh",flag:"name:zh",name:"Chinese",latin:!1,isMode:!1,geocoding:!0},TRADITIONAL_CHINESE:{code:"zh-Hant",flag:"name:zh-Hant",name:"Chinese (traditional)",latin:!1,isMode:!1,geocoding:!1},SIMPLIFIED_CHINESE:{code:"zh-Hans",flag:"name:zh-Hans",name:"Chinese (simplified)",latin:!1,isMode:!1,geocoding:!1},CORSICAN:{code:"co",flag:"name:co",name:"Corsican",latin:!0,isMode:!1,geocoding:!1},CROATIAN:{code:"hr",flag:"name:hr",name:"Croatian",latin:!0,isMode:!1,geocoding:!0},CZECH:{code:"cs",flag:"name:cs",name:"Czech",latin:!0,isMode:!1,geocoding:!0},DANISH:{code:"da",flag:"name:da",name:"Danish",latin:!0,isMode:!1,geocoding:!0},DUTCH:{code:"nl",flag:"name:nl",name:"Dutch",latin:!0,isMode:!1,geocoding:!0},GERMAN:{code:"de",flag:"name:de",name:"German",latin:!0,isMode:!1,geocoding:!0},GREEK:{code:"el",flag:"name:el",name:"Greek",latin:!1,isMode:!1,geocoding:!0},ENGLISH:{code:"en",flag:"name:en",name:"English",latin:!0,isMode:!1,geocoding:!0},ESPERANTO:{code:"eo",flag:"name:eo",name:"Esperanto",latin:!0,isMode:!1,geocoding:!0},ESTONIAN:{code:"et",flag:"name:et",name:"Estonian",latin:!0,isMode:!1,geocoding:!0},FINNISH:{code:"fi",flag:"name:fi",name:"Finnish",latin:!0,isMode:!1,geocoding:!0},FRENCH:{code:"fr",flag:"name:fr",name:"French",latin:!0,isMode:!1,geocoding:!0},FRISIAN:{code:"fy",flag:"name:fy",name:"Frisian (West)",latin:!0,isMode:!1,geocoding:!0},GEORGIAN:{code:"ka",flag:"name:ka",name:"Georgian",latin:!1,isMode:!1,geocoding:!0},HEBREW:{code:"he",flag:"name:he",name:"Hebrew",latin:!1,isMode:!1,geocoding:!0},HINDI:{code:"hi",flag:"name:hi",name:"Hindi",latin:!1,isMode:!1,geocoding:!1},HUNGARIAN:{code:"hu",flag:"name:hu",name:"Hungarian",latin:!0,isMode:!1,geocoding:!0},ICELANDIC:{code:"is",flag:"name:is",name:"Icelandic",latin:!0,isMode:!1,geocoding:!0},INDONESIAN:{code:"id",flag:"name:id",name:"Indonesian",latin:!0,isMode:!1,geocoding:!1},IRISH:{code:"ga",flag:"name:ga",name:"Irish",latin:!0,isMode:!1,geocoding:!0},ITALIAN:{code:"it",flag:"name:it",name:"Italian",latin:!0,isMode:!1,geocoding:!0},JAPANESE:{code:"ja",flag:"name:ja",name:"Japanese",latin:!1,isMode:!1,geocoding:!0},JAPANESE_HIRAGANA:{code:"ja-Hira",flag:"name:ja-Hira",name:"Japanese Hiragana form",latin:!1,isMode:!1,geocoding:!1},JAPANESE_2018:{code:"ja-Latn",flag:"name:ja-Latn",name:"Japanese (Latin 2018)",latin:!0,isMode:!1,geocoding:!1},JAPANESE_KANA:{code:"ja_kana",flag:"name:ja_kana",name:"Japanese (Kana)",latin:!1,isMode:!1,geocoding:!1},JAPANESE_LATIN:{code:"ja_rm",flag:"name:ja_rm",name:"Japanese (Latin script)",latin:!0,isMode:!1,geocoding:!1},KANNADA:{code:"kn",flag:"name:kn",name:"Kannada",latin:!0,isMode:!1,geocoding:!0},KAZAKH:{code:"kk",flag:"name:kk",name:"Kazakh",latin:!1,isMode:!1,geocoding:!0},KOREAN:{code:"ko",flag:"name:ko",name:"Korean",latin:!1,isMode:!1,geocoding:!0},KOREAN_LATIN:{code:"ko-Latn",flag:"name:ko-Latn",name:"Korean (Latin script)",latin:!0,isMode:!1,geocoding:!1},KURDISH:{code:"ku",flag:"name:ku",name:"Kurdish",latin:!0,isMode:!1,geocoding:!1},CLASSICAL_LATIN:{code:"la",flag:"name:la",name:"Latin",latin:!0,isMode:!1,geocoding:!0},LATVIAN:{code:"lv",flag:"name:lv",name:"Latvian",latin:!0,isMode:!1,geocoding:!0},LITHUANIAN:{code:"lt",flag:"name:lt",name:"Lithuanian",latin:!0,isMode:!1,geocoding:!0},LUXEMBOURGISH:{code:"lb",flag:"name:lb",name:"Luxembourgish",latin:!0,isMode:!1,geocoding:!0},MACEDONIAN:{code:"mk",flag:"name:mk",name:"Macedonian",latin:!1,isMode:!1,geocoding:!0},MALAYALAM:{code:"ml",flag:"name:ml",name:"Malayalam",latin:!1,isMode:!1,geocoding:!1},MALTESE:{code:"mt",flag:"name:mt",name:"Maltese",latin:!0,isMode:!1,geocoding:!0},NORWEGIAN:{code:"no",flag:"name:no",name:"Norwegian",latin:!0,isMode:!1,geocoding:!0},OCCITAN:{code:"oc",flag:"name:oc",name:"Occitan",latin:!0,isMode:!1,geocoding:!1},PERSIAN:{code:"fa",flag:"name:fa",name:"Persian",latin:!1,isMode:!1,geocoding:!1},POLISH:{code:"pl",flag:"name:pl",name:"Polish",latin:!0,isMode:!1,geocoding:!0},PORTUGUESE:{code:"pt",flag:"name:pt",name:"Portuguese",latin:!0,isMode:!1,geocoding:!0},PUNJABI:{code:"pa",flag:"name:pa",name:"Punjabi",latin:!1,isMode:!1,geocoding:!1},WESTERN_PUNJABI:{code:"pnb",flag:"name:pnb",name:"Western Punjabi",latin:!1,isMode:!1,geocoding:!1},ROMANIAN:{code:"ro",flag:"name:ro",name:"Romanian",latin:!0,isMode:!1,geocoding:!0},ROMANSH:{code:"rm",flag:"name:rm",name:"Romansh",latin:!0,isMode:!1,geocoding:!0},RUSSIAN:{code:"ru",flag:"name:ru",name:"Russian",latin:!1,isMode:!1,geocoding:!0},SERBIAN_CYRILLIC:{code:"sr",flag:"name:sr",name:"Serbian (Cyrillic script)",latin:!1,isMode:!1,geocoding:!0},SERBIAN_LATIN:{code:"sr-Latn",flag:"name:sr-Latn",name:"Serbian (Latin script)",latin:!0,isMode:!1,geocoding:!1},SCOTTISH_GAELIC:{code:"gd",flag:"name:gd",name:"Scottish Gaelic",latin:!0,isMode:!1,geocoding:!0},SLOVAK:{code:"sk",flag:"name:sk",name:"Slovak",latin:!0,isMode:!1,geocoding:!0},SLOVENE:{code:"sl",flag:"name:sl",name:"Slovene",latin:!0,isMode:!1,geocoding:!0},SPANISH:{code:"es",flag:"name:es",name:"Spanish",latin:!0,isMode:!1,geocoding:!0},SWEDISH:{code:"sv",flag:"name:sv",name:"Swedish",latin:!0,isMode:!1,geocoding:!0},TAMIL:{code:"ta",flag:"name:ta",name:"Tamil",latin:!1,isMode:!1,geocoding:!1},TELUGU:{code:"te",flag:"name:te",name:"Telugu",latin:!1,isMode:!1,geocoding:!1},THAI:{code:"th",flag:"name:th",name:"Thai",latin:!1,isMode:!1,geocoding:!0},TURKISH:{code:"tr",flag:"name:tr",name:"Turkish",latin:!0,isMode:!1,geocoding:!0},UKRAINIAN:{code:"uk",flag:"name:uk",name:"Ukrainian",latin:!1,isMode:!1,geocoding:!0},VIETNAMESE:{code:"vi",flag:"name:vi",name:"Vietnamese (Latin script)",latin:!0,isMode:!1,geocoding:!1},WELSH:{code:"cy",flag:"name:cy",name:"Welsh",latin:!0,isMode:!1,geocoding:!0}},Hg={...BN,...VN};function UN(i,e=Hg){return i in e?i[i]:null}function V0(i,e=Hg){for(const t of Object.values(e))if(t.code===i)return t;return null}function U0(i,e=Hg){for(const t of Object.values(e))if(t.flag===i)return t;return null}function jN(i){return i!==null&&typeof i=="object"&&"code"in i&&"flag"in i&&"name"in i&&"latin"in i&&"isMode"in i&&"geocoding"in i&&(typeof i.code=="string"||i.code===null)&&typeof i.flag=="string"&&typeof i.name=="string"&&typeof i.latin=="boolean"&&typeof i.isMode=="boolean"&&typeof i.geocoding=="boolean"}function Y1(i,e=Hg){return jN(i)?U0(i.flag,e):typeof i!="string"?null:UN(i,e)||V0(i,e)||U0(i,e)||null}async function $N(i,e={}){if(jf.fetch===null)throw new Error("The fetch function was not found. If on NodeJS < 18 please specify the fetch function with config.fetch");if(new URL(i).searchParams.get("key").trim()==="")throw new Error("The MapTiler Cloud API key is missing. Set it in `config.apiKey` or get one for free at https://maptiler.com");return jf.fetch(i,e)}const WE={maptilerApiURL:"https://api.maptiler.com/",mapStyle:"streets-v2"};Object.freeze(WE);class HN extends Error{constructor(e,t=""){super(`Call to enpoint ${e.url} failed with the status code ${e.status}. ${t}`),this.res=e}}const Q1={403:"Key is missing, invalid or restricted"};async function qN(i={}){const e=new URL("geolocation/ip.json",WE.maptilerApiURL);e.searchParams.set("key",i.apiKey??jf.apiKey);const t=e.toString(),o=await $N(t);if(!o.ok)throw new HN(o,o.status in Q1?Q1[o.status]:"");return await o.json()}const J1={info:qN};function KE(i){const e=/^maptiler:\/\/(.*)/;let t;const o=i.trim();let h;return o.startsWith("http://")||o.startsWith("https://")?h=o:(t=e.exec(o))!==null?h=`https://api.maptiler.com/maps/${t[1]}/style.json`:h=`https://api.maptiler.com/maps/${o}/style.json`,h}class XE{constructor(e,t,o,h,g,_){this.name=e,this.variantType=t,this.id=o,this.referenceStyle=h,this.description=g,this.imageURL=_}getName(){return this.name}getFullName(){return`${this.referenceStyle.getName()} ${this.name}`}getType(){return this.variantType}getId(){return this.id}getDescription(){return this.description}getReferenceStyle(){return this.referenceStyle}hasVariant(e){return this.referenceStyle.hasVariant(e)}getVariant(e){return this.referenceStyle.getVariant(e)}getVariants(){return this.referenceStyle.getVariants().filter(e=>e!==this)}getImageURL(){return this.imageURL}getExpandedStyleURL(){return KE(this.getId())}}class YE{constructor(e,t){this.name=e,this.id=t,this.variants={},this.orderedVariants=[]}getName(){return this.name}getId(){return this.id}addVariant(e){this.variants[e.getType()]=e,this.orderedVariants.push(e)}hasVariant(e){return e in this.variants}getVariant(e){return e in this.variants?this.variants[e]:this.orderedVariants[0]}getVariants(){return Object.values(this.variants)}getDefaultVariant(){return this.orderedVariants[0]}}const dg=[{referenceStyleID:"STREETS",name:"Streets",description:"",variants:[{id:"streets-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"streets-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"streets-v2-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""},{id:"streets-v2-night",name:"Night",variantType:"NIGHT",description:"",imageURL:""},{id:"streets-v2-pastel",name:"Pastel",variantType:"PASTEL",description:"",imageURL:""}]},{referenceStyleID:"OUTDOOR",name:"Outdoor",description:"",variants:[{id:"outdoor-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"outdoor-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""}]},{referenceStyleID:"WINTER",name:"Winter",description:"",variants:[{id:"winter-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"winter-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""}]},{referenceStyleID:"SATELLITE",name:"Satellite",description:"",variants:[{id:"satellite",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"HYBRID",name:"Hybrid",description:"",variants:[{id:"hybrid",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"BASIC",name:"Basic",description:"",variants:[{id:"basic-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"basic-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"basic-v2-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""}]},{referenceStyleID:"BRIGHT",name:"Bright",description:"",variants:[{id:"bright-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"bright-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"bright-v2-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""},{id:"bright-v2-pastel",name:"Pastel",variantType:"PASTEL",description:"",imageURL:""}]},{referenceStyleID:"OPENSTREETMAP",name:"OpenStreetMap",description:"",variants:[{id:"openstreetmap",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"TOPO",name:"Topo",description:"",variants:[{id:"topo-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"topo-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"topo-v2-shiny",name:"Shiny",variantType:"SHINY",description:"",imageURL:""},{id:"topo-v2-pastel",name:"Pastel",variantType:"PASTEL",description:"",imageURL:""},{id:"topo-v2-topographique",name:"Topographique",variantType:"TOPOGRAPHIQUE",description:"",imageURL:""}]},{referenceStyleID:"VOYAGER",name:"Voyager",description:"",variants:[{id:"voyager-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"voyager-v2-darkmatter",name:"Darkmatter",variantType:"DARK",description:"",imageURL:""},{id:"voyager-v2-positron",name:"Positron",variantType:"LIGHT",description:"",imageURL:""},{id:"voyager-v2-vintage",name:"Vintage",variantType:"VINTAGE",description:"",imageURL:""}]},{referenceStyleID:"TONER",name:"Toner",description:"",variants:[{id:"toner-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"toner-v2-background",name:"Background",variantType:"BACKGROUND",description:"",imageURL:""},{id:"toner-v2-lite",name:"Lite",variantType:"LITE",description:"",imageURL:""},{id:"toner-v2-lines",name:"Lines",variantType:"LINES",description:"",imageURL:""}]},{referenceStyleID:"DATAVIZ",name:"Dataviz",description:"",variants:[{id:"dataviz",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"dataviz-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"dataviz-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""}]},{referenceStyleID:"BACKDROP",name:"Backdrop",description:"",variants:[{id:"backdrop",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"backdrop-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"backdrop-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""}]},{referenceStyleID:"OCEAN",name:"Ocean",description:"",variants:[{id:"ocean",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]}];function GN(i){return new Proxy(i,{get(e,t,o){return e.hasVariant(t)?e.getVariant(t):t.toString().toUpperCase()===t?i.getDefaultVariant():Reflect.get(e,t,o)}})}function ZN(){const i={};for(let e=0;e<dg.length;e+=1){const t=dg[e],o=GN(new YE(t.name,t.referenceStyleID));for(let h=0;h<t.variants.length;h+=1){const g=t.variants[h],_=new XE(g.name,g.variantType,g.id,o,g.description,g.imageURL);o.addVariant(_)}i[t.referenceStyleID]=o}return i}const pg=ZN();var N_={exports:{}},eT;function WN(){if(eT)return N_.exports;eT=1;var i=typeof Reflect=="object"?Reflect:null,e=i&&typeof i.apply=="function"?i.apply:function(it,at,be){return Function.prototype.apply.call(it,at,be)},t;i&&typeof i.ownKeys=="function"?t=i.ownKeys:Object.getOwnPropertySymbols?t=function(it){return Object.getOwnPropertyNames(it).concat(Object.getOwnPropertySymbols(it))}:t=function(it){return Object.getOwnPropertyNames(it)};function o(Ye){console&&console.warn&&console.warn(Ye)}var h=Number.isNaN||function(it){return it!==it};function g(){g.init.call(this)}N_.exports=g,N_.exports.once=Ke,g.EventEmitter=g,g.prototype._events=void 0,g.prototype._eventsCount=0,g.prototype._maxListeners=void 0;var _=10;function u(Ye){if(typeof Ye!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof Ye)}Object.defineProperty(g,"defaultMaxListeners",{enumerable:!0,get:function(){return _},set:function(Ye){if(typeof Ye!="number"||Ye<0||h(Ye))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+Ye+".");_=Ye}}),g.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},g.prototype.setMaxListeners=function(it){if(typeof it!="number"||it<0||h(it))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+it+".");return this._maxListeners=it,this};function R(Ye){return Ye._maxListeners===void 0?g.defaultMaxListeners:Ye._maxListeners}g.prototype.getMaxListeners=function(){return R(this)},g.prototype.emit=function(it){for(var at=[],be=1;be<arguments.length;be++)at.push(arguments[be]);var te=it==="error",pe=this._events;if(pe!==void 0)te=te&&pe.error===void 0;else if(!te)return!1;if(te){var xe;if(at.length>0&&(xe=at[0]),xe instanceof Error)throw xe;var Ae=new Error("Unhandled error."+(xe?" ("+xe.message+")":""));throw Ae.context=xe,Ae}var $e=pe[it];if($e===void 0)return!1;if(typeof $e=="function")e($e,this,at);else for(var Ce=$e.length,pn=de($e,Ce),be=0;be<Ce;++be)e(pn[be],this,at);return!0};function O(Ye,it,at,be){var te,pe,xe;if(u(at),pe=Ye._events,pe===void 0?(pe=Ye._events=Object.create(null),Ye._eventsCount=0):(pe.newListener!==void 0&&(Ye.emit("newListener",it,at.listener?at.listener:at),pe=Ye._events),xe=pe[it]),xe===void 0)xe=pe[it]=at,++Ye._eventsCount;else if(typeof xe=="function"?xe=pe[it]=be?[at,xe]:[xe,at]:be?xe.unshift(at):xe.push(at),te=R(Ye),te>0&&xe.length>te&&!xe.warned){xe.warned=!0;var Ae=new Error("Possible EventEmitter memory leak detected. "+xe.length+" "+String(it)+" listeners added. Use emitter.setMaxListeners() to increase limit");Ae.name="MaxListenersExceededWarning",Ae.emitter=Ye,Ae.type=it,Ae.count=xe.length,o(Ae)}return Ye}g.prototype.addListener=function(it,at){return O(this,it,at,!1)},g.prototype.on=g.prototype.addListener,g.prototype.prependListener=function(it,at){return O(this,it,at,!0)};function G(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function ne(Ye,it,at){var be={fired:!1,wrapFn:void 0,target:Ye,type:it,listener:at},te=G.bind(be);return te.listener=at,be.wrapFn=te,te}g.prototype.once=function(it,at){return u(at),this.on(it,ne(this,it,at)),this},g.prototype.prependOnceListener=function(it,at){return u(at),this.prependListener(it,ne(this,it,at)),this},g.prototype.removeListener=function(it,at){var be,te,pe,xe,Ae;if(u(at),te=this._events,te===void 0)return this;if(be=te[it],be===void 0)return this;if(be===at||be.listener===at)--this._eventsCount===0?this._events=Object.create(null):(delete te[it],te.removeListener&&this.emit("removeListener",it,be.listener||at));else if(typeof be!="function"){for(pe=-1,xe=be.length-1;xe>=0;xe--)if(be[xe]===at||be[xe].listener===at){Ae=be[xe].listener,pe=xe;break}if(pe<0)return this;pe===0?be.shift():Se(be,pe),be.length===1&&(te[it]=be[0]),te.removeListener!==void 0&&this.emit("removeListener",it,Ae||at)}return this},g.prototype.off=g.prototype.removeListener,g.prototype.removeAllListeners=function(it){var at,be,te;if(be=this._events,be===void 0)return this;if(be.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):be[it]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete be[it]),this;if(arguments.length===0){var pe=Object.keys(be),xe;for(te=0;te<pe.length;++te)xe=pe[te],xe!=="removeListener"&&this.removeAllListeners(xe);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(at=be[it],typeof at=="function")this.removeListener(it,at);else if(at!==void 0)for(te=at.length-1;te>=0;te--)this.removeListener(it,at[te]);return this};function re(Ye,it,at){var be=Ye._events;if(be===void 0)return[];var te=be[it];return te===void 0?[]:typeof te=="function"?at?[te.listener||te]:[te]:at?De(te):de(te,te.length)}g.prototype.listeners=function(it){return re(this,it,!0)},g.prototype.rawListeners=function(it){return re(this,it,!1)},g.listenerCount=function(Ye,it){return typeof Ye.listenerCount=="function"?Ye.listenerCount(it):Q.call(Ye,it)},g.prototype.listenerCount=Q;function Q(Ye){var it=this._events;if(it!==void 0){var at=it[Ye];if(typeof at=="function")return 1;if(at!==void 0)return at.length}return 0}g.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]};function de(Ye,it){for(var at=new Array(it),be=0;be<it;++be)at[be]=Ye[be];return at}function Se(Ye,it){for(;it+1<Ye.length;it++)Ye[it]=Ye[it+1];Ye.pop()}function De(Ye){for(var it=new Array(Ye.length),at=0;at<it.length;++at)it[at]=Ye[at].listener||Ye[at];return it}function Ke(Ye,it){return new Promise(function(at,be){function te(xe){Ye.removeListener(it,pe),be(xe)}function pe(){typeof Ye.removeListener=="function"&&Ye.removeListener("error",te),at([].slice.call(arguments))}vt(Ye,it,pe,{once:!0}),it!=="error"&&et(Ye,te,{once:!0})})}function et(Ye,it,at){typeof Ye.on=="function"&&vt(Ye,"error",it,at)}function vt(Ye,it,at,be){if(typeof Ye.on=="function")be.once?Ye.once(it,at):Ye.on(it,at);else if(typeof Ye.addEventListener=="function")Ye.addEventListener(it,function te(pe){be.once&&Ye.removeEventListener(it,te),at(pe)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof Ye)}return N_.exports}var KN=WN();const XN=Rg(KN),da=[];for(let i=0;i<256;++i)da.push((i+256).toString(16).slice(1));function YN(i,e=0){return(da[i[e+0]]+da[i[e+1]]+da[i[e+2]]+da[i[e+3]]+"-"+da[i[e+4]]+da[i[e+5]]+"-"+da[i[e+6]]+da[i[e+7]]+"-"+da[i[e+8]]+da[i[e+9]]+"-"+da[i[e+10]]+da[i[e+11]]+da[i[e+12]]+da[i[e+13]]+da[i[e+14]]+da[i[e+15]]).toLowerCase()}let r0;const QN=new Uint8Array(16);function JN(){if(!r0){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");r0=crypto.getRandomValues.bind(crypto)}return r0(QN)}const eO=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),tT={randomUUID:eO};function tO(i,e,t){if(tT.randomUUID&&!i)return tT.randomUUID();i=i||{};const o=i.random??i.rng?.()??JN();if(o.length<16)throw new Error("Random bytes length must be >= 16");return o[6]=o[6]&15|64,o[8]=o[8]&63|128,YN(o)}const QE="3.7.7",nO=QE,hm=typeof Buffer=="function",nT=typeof TextDecoder=="function"?new TextDecoder:void 0,iT=typeof TextEncoder=="function"?new TextEncoder:void 0,iO="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",og=Array.prototype.slice.call(iO),O_=(i=>{let e={};return i.forEach((t,o)=>e[t]=o),e})(og),rO=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,pa=String.fromCharCode.bind(String),rT=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):i=>new Uint8Array(Array.prototype.slice.call(i,0)),JE=i=>i.replace(/=/g,"").replace(/[+\/]/g,e=>e=="+"?"-":"_"),eI=i=>i.replace(/[^A-Za-z0-9\+\/]/g,""),tI=i=>{let e,t,o,h,g="";const _=i.length%3;for(let u=0;u<i.length;){if((t=i.charCodeAt(u++))>255||(o=i.charCodeAt(u++))>255||(h=i.charCodeAt(u++))>255)throw new TypeError("invalid character found");e=t<<16|o<<8|h,g+=og[e>>18&63]+og[e>>12&63]+og[e>>6&63]+og[e&63]}return _?g.slice(0,_-3)+"===".substring(_):g},ow=typeof btoa=="function"?i=>btoa(i):hm?i=>Buffer.from(i,"binary").toString("base64"):tI,j0=hm?i=>Buffer.from(i).toString("base64"):i=>{let t=[];for(let o=0,h=i.length;o<h;o+=4096)t.push(pa.apply(null,i.subarray(o,o+4096)));return ow(t.join(""))},ty=(i,e=!1)=>e?JE(j0(i)):j0(i),oO=i=>{if(i.length<2){var e=i.charCodeAt(0);return e<128?i:e<2048?pa(192|e>>>6)+pa(128|e&63):pa(224|e>>>12&15)+pa(128|e>>>6&63)+pa(128|e&63)}else{var e=65536+(i.charCodeAt(0)-55296)*1024+(i.charCodeAt(1)-56320);return pa(240|e>>>18&7)+pa(128|e>>>12&63)+pa(128|e>>>6&63)+pa(128|e&63)}},sO=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,nI=i=>i.replace(sO,oO),oT=hm?i=>Buffer.from(i,"utf8").toString("base64"):iT?i=>j0(iT.encode(i)):i=>ow(nI(i)),$f=(i,e=!1)=>e?JE(oT(i)):oT(i),sT=i=>$f(i,!0),aO=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,lO=i=>{switch(i.length){case 4:var e=(7&i.charCodeAt(0))<<18|(63&i.charCodeAt(1))<<12|(63&i.charCodeAt(2))<<6|63&i.charCodeAt(3),t=e-65536;return pa((t>>>10)+55296)+pa((t&1023)+56320);case 3:return pa((15&i.charCodeAt(0))<<12|(63&i.charCodeAt(1))<<6|63&i.charCodeAt(2));default:return pa((31&i.charCodeAt(0))<<6|63&i.charCodeAt(1))}},iI=i=>i.replace(aO,lO),rI=i=>{if(i=i.replace(/\s+/g,""),!rO.test(i))throw new TypeError("malformed base64.");i+="==".slice(2-(i.length&3));let e,t="",o,h;for(let g=0;g<i.length;)e=O_[i.charAt(g++)]<<18|O_[i.charAt(g++)]<<12|(o=O_[i.charAt(g++)])<<6|(h=O_[i.charAt(g++)]),t+=o===64?pa(e>>16&255):h===64?pa(e>>16&255,e>>8&255):pa(e>>16&255,e>>8&255,e&255);return t},sw=typeof atob=="function"?i=>atob(eI(i)):hm?i=>Buffer.from(i,"base64").toString("binary"):rI,oI=hm?i=>rT(Buffer.from(i,"base64")):i=>rT(sw(i).split("").map(e=>e.charCodeAt(0))),sI=i=>oI(aI(i)),uO=hm?i=>Buffer.from(i,"base64").toString("utf8"):nT?i=>nT.decode(oI(i)):i=>iI(sw(i)),aI=i=>eI(i.replace(/[-_]/g,e=>e=="-"?"+":"/")),$0=i=>uO(aI(i)),cO=i=>{if(typeof i!="string")return!1;const e=i.replace(/\s+/g,"").replace(/={0,2}$/,"");return!/[^\s0-9a-zA-Z\+/]/.test(e)||!/[^\s0-9a-zA-Z\-_]/.test(e)},lI=i=>({value:i,enumerable:!1,writable:!0,configurable:!0}),uI=function(){const i=(e,t)=>Object.defineProperty(String.prototype,e,lI(t));i("fromBase64",function(){return $0(this)}),i("toBase64",function(e){return $f(this,e)}),i("toBase64URI",function(){return $f(this,!0)}),i("toBase64URL",function(){return $f(this,!0)}),i("toUint8Array",function(){return sI(this)})},cI=function(){const i=(e,t)=>Object.defineProperty(Uint8Array.prototype,e,lI(t));i("toBase64",function(e){return ty(this,e)}),i("toBase64URI",function(){return ty(this,!0)}),i("toBase64URL",function(){return ty(this,!0)})},hO=()=>{uI(),cI()},dO={version:QE,VERSION:nO,atob:sw,atobPolyfill:rI,btoa:ow,btoaPolyfill:tI,fromBase64:$0,toBase64:$f,encode:$f,encodeURI:sT,encodeURL:sT,utob:nI,btou:iI,decode:$0,isValid:cO,fromUint8Array:ty,toUint8Array:sI,extendString:uI,extendUint8Array:cI,extendBuiltins:hO};var pO=Object.defineProperty,hI=i=>{throw TypeError(i)},fO=(i,e,t)=>e in i?pO(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,hi=(i,e,t)=>fO(i,typeof e!="symbol"?e+"":e,t),aw=(i,e,t)=>e.has(i)||hI("Cannot "+t),Bi=(i,e,t)=>(aw(i,e,"read from private field"),t?t.call(i):e.get(i)),gp=(i,e,t)=>e.has(i)?hI("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(i):e.set(i,t),Df=(i,e,t,o)=>(aw(i,e,"write to private field"),e.set(i,t),t),fu=(i,e,t)=>(aw(i,e,"access private method"),t);const mO="3.0.1",gO={version:mO},Zi={VISITOR:{code:null,flag:"visitor",name:"Visitor",latin:!0,isMode:!0,geocoding:!1},VISITOR_ENGLISH:{code:null,flag:"visitor_en",name:"Visitor English",latin:!0,isMode:!0,geocoding:!1},STYLE:{code:null,flag:"style",name:"Style",latin:!1,isMode:!0,geocoding:!1},STYLE_LOCK:{code:null,flag:"style_lock",name:"Style Lock",latin:!1,isMode:!0,geocoding:!1},...Hg};function aT(){if(typeof navigator>"u"){const i=Intl.DateTimeFormat().resolvedOptions().locale.split("-")[0];return V0(i)||Zi.ENGLISH}return Array.from(new Set(navigator.languages.map(i=>i.split("-")[0]))).map(i=>V0(i)).filter(i=>i)[0]??Zi.LOCAL}const ll={maptilerLogoURL:"https://api.maptiler.com/resources/logo.svg",maptilerURL:"https://www.maptiler.com/",maptilerApiHost:"api.maptiler.com",telemetryURL:"https://api.maptiler.com/metrics",rtlPluginURL:"https://cdn.maptiler.com/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.min.js",primaryLanguage:Zi.STYLE,secondaryLanguage:Zi.LOCAL,terrainSourceURL:"https://api.maptiler.com/tiles/terrain-rgb-v2/tiles.json",terrainSourceId:"maptiler-terrain"};Object.freeze(ll);const lw=tO();class _O extends XN{constructor(){super(...arguments),hi(this,"primaryLanguage",ll.primaryLanguage),hi(this,"secondaryLanguage"),hi(this,"session",!0),hi(this,"caching",!0),hi(this,"telemetry",!0),hi(this,"_unit","metric"),hi(this,"_apiKey","")}set unit(e){this._unit=e,this.emit("unit",e)}get unit(){return this._unit}set apiKey(e){this._apiKey=e,jf.apiKey=e,this.emit("apiKey",e)}get apiKey(){return this._apiKey}set fetch(e){jf.fetch=e}get fetch(){return jf.fetch}}const xo=new _O,{addProtocol:lT}=In,H0="localcache_source",q0="localcache",yO="maptiler_sdk",vO=1e3,xO=100,G0=typeof caches<"u";function wO(i,e){if(G0&&xo.caching&&xo.session&&i.host===ll.maptilerApiHost){if(e==="Source"&&i.href.includes("tiles.json"))return i.href.replace("https://",`${H0}://`);if(e==="Tile"||e==="Glyphs")return i.href.replace("https://",`${q0}://`)}return i.href}let o0;async function dI(){return o0||(o0=await caches.open(yO)),o0}let uT=0;async function bO(){const i=await dI(),e=await i.keys(),t=e.slice(0,Math.max(e.length-vO,0));for(const o of t)i.delete(o)}function TO(){lT(H0,async(i,e)=>{if(!i.url)throw new Error("");i.url=i.url.replace(`${H0}://`,"https://");const t=i;t.signal=e.signal;const o=await fetch(i.url,t),h=await o.json();return h.tiles&&h.tiles.length>0&&(h.tiles[0]+=`&last-modified=${o.headers.get("Last-Modified")}`),{data:h,cacheControl:o.headers.get("Cache-Control"),expires:o.headers.get("Expires")}}),lT(q0,async(i,e)=>{if(!i.url)throw new Error("");i.url=i.url.replace(`${q0}://`,"https://");const t=new URL(i.url),o=new URL(t);o.searchParams.delete("mtsid"),o.searchParams.delete("key");const h=o.toString(),g=new URL(t);g.searchParams.delete("last-modified");const _=g.toString(),u=async re=>({data:await re.arrayBuffer(),cacheControl:re.headers.get("Cache-Control"),expires:re.headers.get("Expires")}),R=await dI(),O=await R.match(h);if(O)return u(O);const G=i;G.signal=e.signal;const ne=await fetch(_,G);return ne.status>=200&&ne.status<300&&(R.put(h,ne.clone()).catch(()=>{}),++uT>xO&&(bO(),uT=0)),u(ne)})}function SO(){if(typeof window>"u")return;const i=In.getRTLTextPluginStatus();if(i==="unavailable"||i==="requested")try{In.setRTLTextPlugin(ll.rtlPluginURL,!0)}catch{}}function EO(i,e){for(const t of i)typeof e[t]=="function"&&(e[t]=e[t].bind(e))}function Wh(i,e,t){const o=window.document.createElement(i);return e!==void 0&&(o.className=e),t&&t.appendChild(o),o}function uw(i){i.parentNode&&i.parentNode.removeChild(i)}function cT(i,e){let t=null;try{t=new URL(i)}catch{return{url:i}}return t.host===ll.maptilerApiHost&&(t.searchParams.has("key")||t.searchParams.append("key",xo.apiKey),xo.session&&t.searchParams.append("mtsid",lw)),{url:wO(t,e)}}function hT(i){return(e,t)=>{if(i!=null){const o=i(e,t),h=cT(o?.url??"",t);return{...o,...h}}return cT(e,t)}}function pI(){return Math.random().toString(36).substring(2)}function iv(i){return/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/gi.test(i)}function IO(i){try{return JSON.parse(i)}catch{}return null}function PO(){return document.createElement("canvas").getContext("webgl2")?null:typeof WebGL2RenderingContext<"u"?"Graphic rendering with WebGL2 has been disabled or is not supported by your graphic card. The map cannot be displayed.":"Your browser does not support graphic rendering with WebGL2. The map cannot be displayed."}function CO(i){const e=PO();if(!e)return;let t=null;if(typeof i=="string"?t=document.getElementById(i):i instanceof HTMLElement&&(t=i),!t)throw new Error("The Map container must be provided.");const o=document.createElement("div");throw o.innerHTML=e,o.classList.add("webgl-warning-div"),t.appendChild(o),new Error(e)}function AO(i){const e="The WebGL context was lost.";let t=null;if(typeof i=="string"?t=document.getElementById(i):i instanceof HTMLElement&&(t=i),!t)throw new Error("The Map container must be provided.");const o=document.createElement("div");o.innerHTML=e,o.classList.add("webgl-warning-div"),t.appendChild(o)}function dT(i,e){return!(!Array.isArray(i)||i.length!==2||i[0]!=="get"||typeof i[1]!="string"||e&&!i[1].startsWith("name:")||!e&&i[1]!=="name")}function kO(i,e,t){const o=structuredClone(i),h=g=>{if(typeof g!="string")for(let _=0;_<g.length;_+=1)dT(g[_],t)?g[_]=structuredClone(e):h(g[_])};return dT(o,t)?e:(h(o),o)}function MO(i,e){const t=e?/\{name:\S+\}/:/\{name\}/;return{contains:t.test(i),exactMatch:new RegExp(`^${t.source}$`).test(i)}}function RO(i,e,t){const o=t?/\{name:\S+\}/:/\{name\}/,h=i.split(o);return["concat",...h.flatMap((g,_)=>_===h.length-1?[g]:[g,e])]}function LO(i){var e;const t=/\{name(?:\:(?<language>\S+))?\}/g,o=[];for(;;){const h=t.exec(i);if(!h)break;const g=((e=h.groups)==null?void 0:e.language)??null;o.push(g)}return o}function DO(i){return!Array.isArray(i)||i.length!==2||i[0]!=="get"||typeof i[1]!="string"?null:i[1].trim()==="name"?{isLanguage:!0,localization:null}:i[1].trim().startsWith("name:")?{isLanguage:!0,localization:i[1].trim().split(":").pop()}:null}function zO(i){const e=[],t=structuredClone(i),o=h=>{if(typeof h!="string")for(let g=0;g<h.length;g+=1){const _=DO(h[g]);_?e.push(_.localization):o(h[g])}};return o([t]),e}function NO(i,e){const t=[];for(const g of i){if(g.type!=="symbol")continue;const _=g,{id:u,layout:R}=_;if(!R||!("text-field"in R))continue;const O=e.getLayoutProperty(u,"text-field");if(O)if(typeof O=="string"){const G=LO(O);t.push(G)}else{const G=zO(O);t.push(G)}}const o=t.flat(),h={unlocalized:0,localized:{}};for(const g of o)g===null?h.unlocalized+=1:(g in h.localized||(h.localized[g]=0),h.localized[g]+=1);return h}(class extends In.Marker{addTo(i){return super.addTo(i)}});class LF extends In.Popup{addTo(e){return super.addTo(e)}}class DF extends In.Style{constructor(e,t={}){super(e,t)}}class zF extends In.CanvasSource{onAdd(e){super.onAdd(e)}}class NF extends In.GeoJSONSource{onAdd(e){super.onAdd(e)}}class OF extends In.ImageSource{onAdd(e){super.onAdd(e)}}class FF extends In.RasterTileSource{onAdd(e){super.onAdd(e)}}class BF extends In.RasterDEMTileSource{onAdd(e){super.onAdd(e)}}class VF extends In.VectorTileSource{onAdd(e){super.onAdd(e)}}class UF extends In.VideoSource{onAdd(e){super.onAdd(e)}}class OO extends In.NavigationControl{onAdd(e){return super.onAdd(e)}}class FO extends In.GeolocateControl{onAdd(e){return super.onAdd(e)}}class jF extends In.AttributionControl{onAdd(e){return super.onAdd(e)}}class BO extends In.LogoControl{onAdd(e){return super.onAdd(e)}}class VO extends In.ScaleControl{onAdd(e){return super.onAdd(e)}}class UO extends In.FullscreenControl{onAdd(e){return super.onAdd(e)}}class $F extends In.TerrainControl{onAdd(e){return super.onAdd(e)}}class HF extends In.BoxZoomHandler{constructor(e,t){super(e,t)}}class qF extends In.ScrollZoomHandler{constructor(e,t){super(e,t)}}class GF extends In.CooperativeGesturesHandler{constructor(e,t){super(e,t)}}class ZF extends In.KeyboardHandler{constructor(e){super(e)}}class WF extends In.TwoFingersTouchPitchHandler{constructor(e){super(e)}}class KF extends In.MapWheelEvent{constructor(e,t,o){super(e,t,o)}}class XF extends In.MapTouchEvent{constructor(e,t,o){super(e,t,o)}}class YF extends In.MapMouseEvent{constructor(e,t,o,h={}){super(e,t,o,h)}}class pT extends BO{constructor(e={}){super(e),hi(this,"logoURL",""),hi(this,"linkURL",""),this.logoURL=e.logoURL??ll.maptilerLogoURL,this.linkURL=e.linkURL??ll.maptilerURL}onAdd(e){this._map=e,this._compact=this.options.compact??!1,this._container=window.document.createElement("div"),this._container.className="maplibregl-ctrl";const t=window.document.createElement("a");return t.style.backgroundRepeat="no-repeat",t.style.cursor="pointer",t.style.display="block",t.style.height="23px",t.style.margin="0 0 -4px -4px",t.style.overflow="hidden",t.style.width="88px",t.style.backgroundImage=`url(${this.logoURL})`,t.style.backgroundSize="100px 30px",t.style.width="100px",t.style.height="30px",t.target="_blank",t.rel="noopener",t.href=this.linkURL,t.setAttribute("aria-label","MapTiler logo"),t.setAttribute("rel","noopener"),this._container.appendChild(t),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}}var jO=8,$O={version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},HO={"*":{type:"source"}},qO=["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],GO={type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},ZO={type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},WO={type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},KO={type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},XO={type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},YO={type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},QO={id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},JO=["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],e3={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},t3={"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},n3={"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},i3={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},r3={"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},o3={"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},s3={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},a3={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},l3={type:"array",value:"*"},u3={type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},c3={type:"enum",values:{Point:{},LineString:{},Polygon:{}}},h3={type:"array",minimum:0,maximum:24,value:["number","color"],length:2},d3={type:"array",value:"*",minimum:1},p3={anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},f3={"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},m3={source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},g3={type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},_3=["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],y3={"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},v3={"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},x3={"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},w3={"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},b3={"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},T3={"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},S3={"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},E3={"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},I3={duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},P3={"*":{type:"string"}},C3={$version:jO,$root:$O,sources:HO,source:qO,source_vector:GO,source_raster:ZO,source_raster_dem:WO,source_geojson:KO,source_video:XO,source_image:YO,layer:QO,layout:JO,layout_background:e3,layout_fill:t3,layout_circle:n3,layout_heatmap:i3,"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:r3,layout_symbol:o3,layout_raster:s3,layout_hillshade:a3,filter:l3,filter_operator:u3,geometry_type:c3,function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:h3,expression:d3,light:p3,sky:f3,terrain:m3,projection:g3,paint:_3,paint_fill:y3,"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:v3,paint_circle:x3,paint_heatmap:w3,paint_symbol:b3,paint_raster:T3,paint_hillshade:S3,paint_background:E3,transition:I3,"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:P3};let Wt=class{constructor(e,t,o,h){this.message=(e?`${e}: `:"")+o,h&&(this.identifier=h),t!=null&&t.__line__&&(this.line=t.__line__)}};function Iy(i,...e){for(const t of e)for(const o in t)i[o]=t[o];return i}class ih extends Error{constructor(e,t){super(t),this.message=t,this.key=e}}class cw{constructor(e,t=[]){this.parent=e,this.bindings={};for(const[o,h]of t)this.bindings[o]=h}concat(e){return new cw(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return this.bindings[e]?!0:this.parent?this.parent.has(e):!1}}const rv={kind:"null"},Jt={kind:"number"},mi={kind:"string"},ui={kind:"boolean"},lh={kind:"color"},ov={kind:"projectionDefinition"},Hf={kind:"object"},ci={kind:"value"},A3={kind:"error"},sv={kind:"collator"},av={kind:"formatted"},lv={kind:"padding"},qg={kind:"resolvedImage"},uv={kind:"variableAnchorOffsetCollection"};function gu(i,e){return{kind:"array",itemType:i,N:e}}function Yr(i){if(i.kind==="array"){const e=Yr(i.itemType);return typeof i.N=="number"?`array<${e}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${e}>`}else return i.kind}const k3=[rv,Jt,mi,ui,lh,ov,av,Hf,gu(ci),lv,qg,uv];function Ig(i,e){if(e.kind==="error")return null;if(i.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Ig(i.itemType,e.itemType))&&(typeof i.N!="number"||i.N===e.N))return null}else{if(i.kind===e.kind)return null;if(i.kind==="value"){for(const t of k3)if(!Ig(t,e))return null}}return`Expected ${Yr(i)} but found ${Yr(e)} instead.`}function hw(i,e){return e.some(t=>t.kind===i.kind)}function Ep(i,e){return e.some(t=>t==="null"?i===null:t==="array"?Array.isArray(i):t==="object"?i&&!Array.isArray(i)&&typeof i=="object":t===typeof i)}function Af(i,e){return i.kind==="array"&&e.kind==="array"?i.itemType.kind===e.itemType.kind&&typeof i.N=="number":i.kind===e.kind}const fI=.96422,mI=1,gI=.82521,_I=4/29,qf=6/29,yI=3*qf*qf,M3=qf*qf*qf,R3=Math.PI/180,L3=180/Math.PI;function vI(i){return i=i%360,i<0&&(i+=360),i}function xI([i,e,t,o]){i=s0(i),e=s0(e),t=s0(t);let h,g;const _=a0((.2225045*i+.7168786*e+.0606169*t)/mI);i===e&&e===t?h=g=_:(h=a0((.4360747*i+.3850649*e+.1430804*t)/fI),g=a0((.0139322*i+.0971045*e+.7141733*t)/gI));const u=116*_-16;return[u<0?0:u,500*(h-_),200*(_-g),o]}function s0(i){return i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function a0(i){return i>M3?Math.pow(i,1/3):i/yI+_I}function wI([i,e,t,o]){let h=(i+16)/116,g=isNaN(e)?h:h+e/500,_=isNaN(t)?h:h-t/200;return h=mI*u0(h),g=fI*u0(g),_=gI*u0(_),[l0(3.1338561*g-1.6168667*h-.4906146*_),l0(-.9787684*g+1.9161415*h+.033454*_),l0(.0719453*g-.2289914*h+1.4052427*_),o]}function l0(i){return i=i<=.00304?12.92*i:1.055*Math.pow(i,1/2.4)-.055,i<0?0:i>1?1:i}function u0(i){return i>qf?i*i*i:yI*(i-_I)}function D3(i){const[e,t,o,h]=xI(i),g=Math.sqrt(t*t+o*o);return[Math.round(g*1e4)?vI(Math.atan2(o,t)*L3):NaN,g,e,h]}function z3([i,e,t,o]){return i=isNaN(i)?0:i*R3,wI([t,Math.cos(i)*e,Math.sin(i)*e,o])}function N3([i,e,t,o]){i=vI(i),e/=100,t/=100;function h(g){const _=(g+i/30)%12,u=e*Math.min(t,1-t);return t-u*Math.max(-1,Math.min(_-3,9-_,1))}return[h(0),h(8),h(4),o]}function O3(i){if(i=i.toLowerCase().trim(),i==="transparent")return[0,0,0,0];const e=F3[i];if(e){const[h,g,_]=e;return[h/255,g/255,_/255,1]}if(i.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(i)){const h=i.length<6?1:2;let g=1;return[F_(i.slice(g,g+=h)),F_(i.slice(g,g+=h)),F_(i.slice(g,g+=h)),F_(i.slice(g,g+h)||"ff")]}if(i.startsWith("rgb")){const h=/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/,g=i.match(h);if(g){const[_,u,R,O,G,ne,re,Q,de,Se,De,Ke]=g,et=[O||" ",re||" ",Se].join("");if(et==="  "||et==="  /"||et===",,"||et===",,,"){const vt=[R,ne,de].join(""),Ye=vt==="%%%"?100:vt===""?255:0;if(Ye){const it=[zf(+u/Ye,0,1),zf(+G/Ye,0,1),zf(+Q/Ye,0,1),De?fT(+De,Ke):1];if(mT(it))return it}}return}}const t=/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/,o=i.match(t);if(o){const[h,g,_,u,R,O,G,ne,re]=o,Q=[_||" ",R||" ",G].join("");if(Q==="  "||Q==="  /"||Q===",,"||Q===",,,"){const de=[+g,zf(+u,0,100),zf(+O,0,100),ne?fT(+ne,re):1];if(mT(de))return N3(de)}}}function F_(i){return parseInt(i.padEnd(2,i),16)/255}function fT(i,e){return zf(e?i/100:i,0,1)}function zf(i,e,t){return Math.min(Math.max(e,i),t)}function mT(i){return!i.some(Number.isNaN)}const F3={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function Ip(i,e,t){return i+t*(e-i)}function Py(i,e,t){return i.map((o,h)=>Ip(o,e[h],t))}class kr{constructor(e,t,o,h=1,g=!0){this.r=e,this.g=t,this.b=o,this.a=h,g||(this.r*=h,this.g*=h,this.b*=h,h||this.overwriteGetter("rgb",[e,t,o,h]))}static parse(e){if(e instanceof kr)return e;if(typeof e!="string")return;const t=O3(e);if(t)return new kr(...t,!1)}get rgb(){const{r:e,g:t,b:o,a:h}=this,g=h||1/0;return this.overwriteGetter("rgb",[e/g,t/g,o/g,h])}get hcl(){return this.overwriteGetter("hcl",D3(this.rgb))}get lab(){return this.overwriteGetter("lab",xI(this.rgb))}overwriteGetter(e,t){return Object.defineProperty(this,e,{value:t}),t}toString(){const[e,t,o,h]=this.rgb;return`rgba(${[e,t,o].map(g=>Math.round(g*255)).join(",")},${h})`}static interpolate(e,t,o,h="rgb"){switch(h){case"rgb":{const[g,_,u,R]=Py(e.rgb,t.rgb,o);return new kr(g,_,u,R,!1)}case"hcl":{const[g,_,u,R]=e.hcl,[O,G,ne,re]=t.hcl;let Q,de;if(!isNaN(g)&&!isNaN(O)){let vt=O-g;O>g&&vt>180?vt-=360:O<g&&g-O>180&&(vt+=360),Q=g+o*vt}else isNaN(g)?isNaN(O)?Q=NaN:(Q=O,(u===1||u===0)&&(de=G)):(Q=g,(ne===1||ne===0)&&(de=_));const[Se,De,Ke,et]=z3([Q,de??Ip(_,G,o),Ip(u,ne,o),Ip(R,re,o)]);return new kr(Se,De,Ke,et,!1)}case"lab":{const[g,_,u,R]=wI(Py(e.lab,t.lab,o));return new kr(g,_,u,R,!1)}}}}kr.black=new kr(0,0,0,1);kr.white=new kr(1,1,1,1);kr.transparent=new kr(0,0,0,0);kr.red=new kr(1,0,0,1);class dw{constructor(e,t,o){e?this.sensitivity=t?"variant":"case":this.sensitivity=t?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,t){return this.collator.compare(e,t)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Z0{constructor(e,t,o,h,g){this.text=e,this.image=t,this.scale=o,this.fontStack=h,this.textColor=g}}class Kh{constructor(e){this.sections=e}static fromString(e){return new Kh([new Z0(e,null,null,null,null)])}isEmpty(){return this.sections.length===0?!0:!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof Kh?e:Kh.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}}class bc{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof bc)return e;if(typeof e=="number")return new bc([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const t of e)if(typeof t!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]];break}return new bc(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,t,o){return new bc(Py(e.values,t.values,o))}}class No{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const B3=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class uh{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof uh)return e;if(!(!Array.isArray(e)||e.length<1||e.length%2!==0)){for(let t=0;t<e.length;t+=2){const o=e[t],h=e[t+1];if(typeof o!="string"||!B3.has(o)||!Array.isArray(h)||h.length!==2||typeof h[0]!="number"||typeof h[1]!="number")return}return new uh(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,t,o){const h=e.values,g=t.values;if(h.length!==g.length)throw new No(`Cannot interpolate values of different length. from: ${e.toString()}, to: ${t.toString()}`);const _=[];for(let u=0;u<h.length;u+=2){if(h[u]!==g[u])throw new No(`Cannot interpolate values containing mismatched anchors. from[${u}]: ${h[u]}, to[${u}]: ${g[u]}`);_.push(h[u]);const[R,O]=h[u+1],[G,ne]=g[u+1];_.push([Ip(R,G,o),Ip(O,ne,o)])}return new uh(_)}}class Hd{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Hd({name:e,available:!1}):null}}class vc{constructor(e,t,o){this.from=e,this.to=t,this.transition=o}static interpolate(e,t,o){return new vc(e,t,o)}static parse(e){if(e instanceof vc)return e;if(Array.isArray(e)&&e.length===3&&typeof e[0]=="string"&&typeof e[1]=="string"&&typeof e[2]=="number")return new vc(e[0],e[1],e[2]);if(typeof e=="object"&&typeof e.from=="string"&&typeof e.to=="string"&&typeof e.transition=="number")return new vc(e.from,e.to,e.transition);if(typeof e=="string")return new vc(e,e,1)}}function bI(i,e,t,o){return typeof i=="number"&&i>=0&&i<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof t=="number"&&t>=0&&t<=255?typeof o>"u"||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[i,e,t,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[i,e,t,o]:[i,e,t]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Pg(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof vc||i instanceof kr||i instanceof dw||i instanceof Kh||i instanceof bc||i instanceof uh||i instanceof Hd)return!0;if(Array.isArray(i)){for(const e of i)if(!Pg(e))return!1;return!0}else if(typeof i=="object"){for(const e in i)if(!Pg(i[e]))return!1;return!0}else return!1}function vs(i){if(i===null)return rv;if(typeof i=="string")return mi;if(typeof i=="boolean")return ui;if(typeof i=="number")return Jt;if(i instanceof kr)return lh;if(i instanceof vc)return ov;if(i instanceof dw)return sv;if(i instanceof Kh)return av;if(i instanceof bc)return lv;if(i instanceof uh)return uv;if(i instanceof Hd)return qg;if(Array.isArray(i)){const e=i.length;let t;for(const o of i){const h=vs(o);if(!t)t=h;else{if(t===h)continue;t=ci;break}}return gu(t||ci,e)}else return Hf}function fg(i){const e=typeof i;return i===null?"":e==="string"||e==="number"||e==="boolean"?String(i):i instanceof kr||i instanceof vc||i instanceof Kh||i instanceof bc||i instanceof uh||i instanceof Hd?i.toString():JSON.stringify(i)}class em{constructor(e,t){this.type=e,this.value=t}static parse(e,t){if(e.length!==2)return t.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Pg(e[1]))return t.error("invalid value");const o=e[1];let h=vs(o);const g=t.expectedType;return h.kind==="array"&&h.N===0&&g&&g.kind==="array"&&(typeof g.N!="number"||g.N===0)&&(h=g),new em(h,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const B_={string:mi,number:Jt,boolean:ui,object:Hf};class xc{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");let o=1,h;const g=e[0];if(g==="array"){let u;if(e.length>2){const O=e[1];if(typeof O!="string"||!(O in B_)||O==="object")return t.error('The item type argument of "array" must be one of string, number, boolean',1);u=B_[O],o++}else u=ci;let R;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return t.error('The length argument to "array" must be a positive integer literal',2);R=e[2],o++}h=gu(u,R)}else{if(!B_[g])throw new Error(`Types doesn't contain name = ${g}`);h=B_[g]}const _=[];for(;o<e.length;o++){const u=t.parse(e[o],o,ci);if(!u)return null;_.push(u)}return new xc(h,_)}evaluate(e){for(let t=0;t<this.args.length;t++){const o=this.args[t].evaluate(e);if(Ig(this.type,vs(o))){if(t===this.args.length-1)throw new No(`Expected value to be of type ${Yr(this.type)}, but found ${Yr(vs(o))} instead.`)}else return o}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const gT={"to-boolean":ui,"to-color":lh,"to-number":Jt,"to-string":mi};class Rd{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const o=e[0];if(!gT[o])throw new Error(`Can't parse ${o} as it is not part of the known types`);if((o==="to-boolean"||o==="to-string")&&e.length!==2)return t.error("Expected one argument.");const h=gT[o],g=[];for(let _=1;_<e.length;_++){const u=t.parse(e[_],_,ci);if(!u)return null;g.push(u)}return new Rd(h,g)}evaluate(e){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(e);case"color":{let t,o;for(const h of this.args){if(t=h.evaluate(e),o=null,t instanceof kr)return t;if(typeof t=="string"){const g=e.parseColor(t);if(g)return g}else if(Array.isArray(t)&&(t.length<3||t.length>4?o=`Invalid rgba value ${JSON.stringify(t)}: expected an array containing either three or four numeric values.`:o=bI(t[0],t[1],t[2],t[3]),!o))return new kr(t[0]/255,t[1]/255,t[2]/255,t[3])}throw new No(o||`Could not parse color from value '${typeof t=="string"?t:JSON.stringify(t)}'`)}case"padding":{let t;for(const o of this.args){t=o.evaluate(e);const h=bc.parse(t);if(h)return h}throw new No(`Could not parse padding from value '${typeof t=="string"?t:JSON.stringify(t)}'`)}case"variableAnchorOffsetCollection":{let t;for(const o of this.args){t=o.evaluate(e);const h=uh.parse(t);if(h)return h}throw new No(`Could not parse variableAnchorOffsetCollection from value '${typeof t=="string"?t:JSON.stringify(t)}'`)}case"number":{let t=null;for(const o of this.args){if(t=o.evaluate(e),t===null)return 0;const h=Number(t);if(!isNaN(h))return h}throw new No(`Could not convert ${JSON.stringify(t)} to number.`)}case"formatted":return Kh.fromString(fg(this.args[0].evaluate(e)));case"resolvedImage":return Hd.fromString(fg(this.args[0].evaluate(e)));case"projectionDefinition":return this.args[0].evaluate(e);default:return fg(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const V3=["Unknown","Point","LineString","Polygon"];class TI{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?V3[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let t=this._parseColorCache[e];return t||(t=this._parseColorCache[e]=kr.parse(e)),t}}class cv{constructor(e,t,o=[],h,g=new cw,_=[]){this.registry=e,this.path=o,this.key=o.map(u=>`[${u}]`).join(""),this.scope=g,this.errors=_,this.expectedType=h,this._isConstant=t}parse(e,t,o,h,g={}){return t?this.concat(t,o,h)._parse(e,g):this._parse(e,g)}_parse(e,t){(e===null||typeof e=="string"||typeof e=="boolean"||typeof e=="number")&&(e=["literal",e]);function o(h,g,_){return _==="assert"?new xc(g,[h]):_==="coerce"?new Rd(g,[h]):h}if(Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const h=e[0];if(typeof h!="string")return this.error(`Expression name must be a string, but found ${typeof h} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const g=this.registry[h];if(g){let _=g.parse(e,this);if(!_)return null;if(this.expectedType){const u=this.expectedType,R=_.type;if((u.kind==="string"||u.kind==="number"||u.kind==="boolean"||u.kind==="object"||u.kind==="array")&&R.kind==="value")_=o(_,u,t.typeAnnotation||"assert");else if(u.kind==="projectionDefinition"&&(R.kind==="string"||R.kind==="array"))_=o(_,u,t.typeAnnotation||"coerce");else if((u.kind==="color"||u.kind==="formatted"||u.kind==="resolvedImage")&&(R.kind==="value"||R.kind==="string"))_=o(_,u,t.typeAnnotation||"coerce");else if(u.kind==="padding"&&(R.kind==="value"||R.kind==="number"||R.kind==="array"))_=o(_,u,t.typeAnnotation||"coerce");else if(u.kind==="variableAnchorOffsetCollection"&&(R.kind==="value"||R.kind==="array"))_=o(_,u,t.typeAnnotation||"coerce");else if(this.checkSubtype(u,R))return null}if(!(_ instanceof em)&&_.type.kind!=="resolvedImage"&&this._isConstant(_)){const u=new TI;try{_=new em(_.type,_.evaluate(u))}catch(R){return this.error(R.message),null}}return _}return this.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0)}else return typeof e>"u"?this.error("'undefined' value invalid. Use null instead."):typeof e=="object"?this.error('Bare objects invalid. Use ["literal", {...}] instead.'):this.error(`Expected an array, but found ${typeof e} instead.`)}concat(e,t,o){const h=typeof e=="number"?this.path.concat(e):this.path,g=o?this.scope.concat(o):this.scope;return new cv(this.registry,this._isConstant,h,t||null,g,this.errors)}error(e,...t){const o=`${this.key}${t.map(h=>`[${h}]`).join("")}`;this.errors.push(new ih(o,e))}checkSubtype(e,t){const o=Ig(e,t);return o&&this.error(o),o}}class hv{constructor(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const t of this.bindings)e(t[1]);e(this.result)}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const o=[];for(let g=1;g<e.length-1;g+=2){const _=e[g];if(typeof _!="string")return t.error(`Expected string, but found ${typeof _} instead.`,g);if(/[^a-zA-Z0-9_]/.test(_))return t.error("Variable names must contain only alphanumeric characters or '_'.",g);const u=t.parse(e[g+1],g+1);if(!u)return null;o.push([_,u])}const h=t.parse(e[e.length-1],e.length-1,t.expectedType,o);return h?new hv(o,h):null}outputDefined(){return this.result.outputDefined()}}class dv{constructor(e,t){this.type=t.type,this.name=e,this.boundExpression=t}static parse(e,t){if(e.length!==2||typeof e[1]!="string")return t.error("'var' expression requires exactly one string literal argument.");const o=e[1];return t.scope.has(o)?new dv(o,t.scope.get(o)):t.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class pw{constructor(e,t,o){this.type=e,this.index=t,this.input=o}static parse(e,t){if(e.length!==3)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=t.parse(e[1],1,Jt),h=t.parse(e[2],2,gu(t.expectedType||ci));if(!o||!h)return null;const g=h.type;return new pw(g.itemType,o,h)}evaluate(e){const t=this.index.evaluate(e),o=this.input.evaluate(e);if(t<0)throw new No(`Array index out of bounds: ${t} < 0.`);if(t>=o.length)throw new No(`Array index out of bounds: ${t} > ${o.length-1}.`);if(t!==Math.floor(t))throw new No(`Array index must be an integer, but found ${t} instead.`);return o[t]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class fw{constructor(e,t){this.type=ui,this.needle=e,this.haystack=t}static parse(e,t){if(e.length!==3)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=t.parse(e[1],1,ci),h=t.parse(e[2],2,ci);return!o||!h?null:hw(o.type,[ui,mi,Jt,rv,ci])?new fw(o,h):t.error(`Expected first argument to be of type boolean, string, number or null, but found ${Yr(o.type)} instead`)}evaluate(e){const t=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!o)return!1;if(!Ep(t,["boolean","string","number","null"]))throw new No(`Expected first argument to be of type boolean, string, number or null, but found ${Yr(vs(t))} instead.`);if(!Ep(o,["string","array"]))throw new No(`Expected second argument to be of type array or string, but found ${Yr(vs(o))} instead.`);return o.indexOf(t)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class Cy{constructor(e,t,o){this.type=Jt,this.needle=e,this.haystack=t,this.fromIndex=o}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const o=t.parse(e[1],1,ci),h=t.parse(e[2],2,ci);if(!o||!h)return null;if(!hw(o.type,[ui,mi,Jt,rv,ci]))return t.error(`Expected first argument to be of type boolean, string, number or null, but found ${Yr(o.type)} instead`);if(e.length===4){const g=t.parse(e[3],3,Jt);return g?new Cy(o,h,g):null}else return new Cy(o,h)}evaluate(e){const t=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!Ep(t,["boolean","string","number","null"]))throw new No(`Expected first argument to be of type boolean, string, number or null, but found ${Yr(vs(t))} instead.`);let h;if(this.fromIndex&&(h=this.fromIndex.evaluate(e)),Ep(o,["string"])){const g=o.indexOf(t,h);return g===-1?-1:[...o.slice(0,g)].length}else{if(Ep(o,["array"]))return o.indexOf(t,h);throw new No(`Expected second argument to be of type array or string, but found ${Yr(vs(o))} instead.`)}}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class mw{constructor(e,t,o,h,g,_){this.inputType=e,this.type=t,this.input=o,this.cases=h,this.outputs=g,this.otherwise=_}static parse(e,t){if(e.length<5)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!==1)return t.error("Expected an even number of arguments.");let o,h;t.expectedType&&t.expectedType.kind!=="value"&&(h=t.expectedType);const g={},_=[];for(let O=2;O<e.length-1;O+=2){let G=e[O];const ne=e[O+1];Array.isArray(G)||(G=[G]);const re=t.concat(O);if(G.length===0)return re.error("Expected at least one branch label.");for(const de of G){if(typeof de!="number"&&typeof de!="string")return re.error("Branch labels must be numbers or strings.");if(typeof de=="number"&&Math.abs(de)>Number.MAX_SAFE_INTEGER)return re.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof de=="number"&&Math.floor(de)!==de)return re.error("Numeric branch labels must be integer values.");if(!o)o=vs(de);else if(re.checkSubtype(o,vs(de)))return null;if(typeof g[String(de)]<"u")return re.error("Branch labels must be unique.");g[String(de)]=_.length}const Q=t.parse(ne,O,h);if(!Q)return null;h=h||Q.type,_.push(Q)}const u=t.parse(e[1],1,ci);if(!u)return null;const R=t.parse(e[e.length-1],e.length-1,h);return!R||u.type.kind!=="value"&&t.concat(1).checkSubtype(o,u.type)?null:new mw(o,h,u,g,_,R)}evaluate(e){const t=this.input.evaluate(e);return(vs(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}}class gw{constructor(e,t,o){this.type=e,this.branches=t,this.otherwise=o}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!==0)return t.error("Expected an odd number of arguments.");let o;t.expectedType&&t.expectedType.kind!=="value"&&(o=t.expectedType);const h=[];for(let _=1;_<e.length-1;_+=2){const u=t.parse(e[_],_,ui);if(!u)return null;const R=t.parse(e[_+1],_+1,o);if(!R)return null;h.push([u,R]),o=o||R.type}const g=t.parse(e[e.length-1],e.length-1,o);if(!g)return null;if(!o)throw new Error("Can't infer output type");return new gw(o,h,g)}evaluate(e){for(const[t,o]of this.branches)if(t.evaluate(e))return o.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[t,o]of this.branches)e(t),e(o);e(this.otherwise)}outputDefined(){return this.branches.every(([e,t])=>t.outputDefined())&&this.otherwise.outputDefined()}}class Ay{constructor(e,t,o,h){this.type=e,this.input=t,this.beginIndex=o,this.endIndex=h}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const o=t.parse(e[1],1,ci),h=t.parse(e[2],2,Jt);if(!o||!h)return null;if(!hw(o.type,[gu(ci),mi,ci]))return t.error(`Expected first argument to be of type array or string, but found ${Yr(o.type)} instead`);if(e.length===4){const g=t.parse(e[3],3,Jt);return g?new Ay(o.type,o,h,g):null}else return new Ay(o.type,o,h)}evaluate(e){const t=this.input.evaluate(e),o=this.beginIndex.evaluate(e);let h;if(this.endIndex&&(h=this.endIndex.evaluate(e)),Ep(t,["string"]))return[...t].slice(o,h).join("");if(Ep(t,["array"]))return t.slice(o,h);throw new No(`Expected first argument to be of type array or string, but found ${Yr(vs(t))} instead.`)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function SI(i,e){const t=i.length-1;let o=0,h=t,g=0,_,u;for(;o<=h;)if(g=Math.floor((o+h)/2),_=i[g],u=i[g+1],_<=e){if(g===t||e<u)return g;o=g+1}else if(_>e)h=g-1;else throw new No("Input is not a number.");return 0}class pv{constructor(e,t,o){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(const[h,g]of o)this.labels.push(h),this.outputs.push(g)}static parse(e,t){if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!==0)return t.error("Expected an even number of arguments.");const o=t.parse(e[1],1,Jt);if(!o)return null;const h=[];let g=null;t.expectedType&&t.expectedType.kind!=="value"&&(g=t.expectedType);for(let _=1;_<e.length;_+=2){const u=_===1?-1/0:e[_],R=e[_+1],O=_,G=_+1;if(typeof u!="number")return t.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',O);if(h.length&&h[h.length-1][0]>=u)return t.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',O);const ne=t.parse(R,G,g);if(!ne)return null;g=g||ne.type,h.push([u,ne])}return new pv(g,o,h)}evaluate(e){const t=this.labels,o=this.outputs;if(t.length===1)return o[0].evaluate(e);const h=this.input.evaluate(e);if(h<=t[0])return o[0].evaluate(e);const g=t.length;if(h>=t[g-1])return o[g-1].evaluate(e);const _=SI(t,h);return o[_].evaluate(e)}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function U3(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var c0,_T;function j3(){if(_T)return c0;_T=1,c0=i;function i(e,t,o,h){this.cx=3*e,this.bx=3*(o-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(h-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=t,this.p2x=o,this.p2y=h}return i.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,t){if(t===void 0&&(t=1e-6),e<0)return 0;if(e>1)return 1;for(var o=e,h=0;h<8;h++){var g=this.sampleCurveX(o)-e;if(Math.abs(g)<t)return o;var _=this.sampleCurveDerivativeX(o);if(Math.abs(_)<1e-6)break;o=o-g/_}var u=0,R=1;for(o=e,h=0;h<20&&(g=this.sampleCurveX(o),!(Math.abs(g-e)<t));h++)e>g?u=o:R=o,o=(R-u)*.5+u;return o},solve:function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))}},c0}var $3=j3(),H3=U3($3);class ch{constructor(e,t,o,h,g){this.type=e,this.operator=t,this.interpolation=o,this.input=h,this.labels=[],this.outputs=[];for(const[_,u]of g)this.labels.push(_),this.outputs.push(u)}static interpolationFactor(e,t,o,h){let g=0;if(e.name==="exponential")g=h0(t,e.base,o,h);else if(e.name==="linear")g=h0(t,1,o,h);else if(e.name==="cubic-bezier"){const _=e.controlPoints;g=new H3(_[0],_[1],_[2],_[3]).solve(h0(t,1,o,h))}return g}static parse(e,t){let[o,h,g,..._]=e;if(!Array.isArray(h)||h.length===0)return t.error("Expected an interpolation type expression.",1);if(h[0]==="linear")h={name:"linear"};else if(h[0]==="exponential"){const O=h[1];if(typeof O!="number")return t.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:O}}else if(h[0]==="cubic-bezier"){const O=h.slice(1);if(O.length!==4||O.some(G=>typeof G!="number"||G<0||G>1))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:O}}else return t.error(`Unknown interpolation type ${String(h[0])}`,1,0);if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!==0)return t.error("Expected an even number of arguments.");if(g=t.parse(g,2,Jt),!g)return null;const u=[];let R=null;o==="interpolate-hcl"||o==="interpolate-lab"?R=lh:t.expectedType&&t.expectedType.kind!=="value"&&(R=t.expectedType);for(let O=0;O<_.length;O+=2){const G=_[O],ne=_[O+1],re=O+3,Q=O+4;if(typeof G!="number")return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',re);if(u.length&&u[u.length-1][0]>=G)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',re);const de=t.parse(ne,Q,R);if(!de)return null;R=R||de.type,u.push([G,de])}return!Af(R,Jt)&&!Af(R,ov)&&!Af(R,lh)&&!Af(R,lv)&&!Af(R,uv)&&!Af(R,gu(Jt))?t.error(`Type ${Yr(R)} is not interpolatable.`):new ch(R,o,h,g,u)}evaluate(e){const t=this.labels,o=this.outputs;if(t.length===1)return o[0].evaluate(e);const h=this.input.evaluate(e);if(h<=t[0])return o[0].evaluate(e);const g=t.length;if(h>=t[g-1])return o[g-1].evaluate(e);const _=SI(t,h),u=t[_],R=t[_+1],O=ch.interpolationFactor(this.interpolation,h,u,R),G=o[_].evaluate(e),ne=o[_+1].evaluate(e);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return Ip(G,ne,O);case"color":return kr.interpolate(G,ne,O);case"padding":return bc.interpolate(G,ne,O);case"variableAnchorOffsetCollection":return uh.interpolate(G,ne,O);case"array":return Py(G,ne,O);case"projectionDefinition":return vc.interpolate(G,ne,O)}case"interpolate-hcl":return kr.interpolate(G,ne,O,"hcl");case"interpolate-lab":return kr.interpolate(G,ne,O,"lab")}}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function h0(i,e,t,o){const h=o-t,g=i-t;return h===0?0:e===1?g/h:(Math.pow(e,g)-1)/(Math.pow(e,h)-1)}class Cg{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");let o=null;const h=t.expectedType;h&&h.kind!=="value"&&(o=h);const g=[];for(const _ of e.slice(1)){const u=t.parse(_,1+g.length,o,void 0,{typeAnnotation:"omit"});if(!u)return null;o=o||u.type,g.push(u)}if(!o)throw new Error("No output type");return h&&g.some(_=>Ig(h,_.type))?new Cg(ci,g):new Cg(o,g)}evaluate(e){let t=null,o=0,h;for(const g of this.args)if(o++,t=g.evaluate(e),t&&t instanceof Hd&&!t.available&&(h||(h=t.name),t=null,o===this.args.length&&(t=h)),t!==null)break;return t}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}function yT(i,e){return i==="=="||i==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function q3(i,e,t){return e===t}function G3(i,e,t){return e!==t}function Z3(i,e,t){return e<t}function W3(i,e,t){return e>t}function K3(i,e,t){return e<=t}function X3(i,e,t){return e>=t}function EI(i,e,t,o){return o.compare(e,t)===0}function Y3(i,e,t,o){return!EI(i,e,t,o)}function Q3(i,e,t,o){return o.compare(e,t)<0}function J3(i,e,t,o){return o.compare(e,t)>0}function e4(i,e,t,o){return o.compare(e,t)<=0}function t4(i,e,t,o){return o.compare(e,t)>=0}function dm(i,e,t){const o=i!=="=="&&i!=="!=";return class II{constructor(g,_,u){this.type=ui,this.lhs=g,this.rhs=_,this.collator=u,this.hasUntypedArgument=g.type.kind==="value"||_.type.kind==="value"}static parse(g,_){if(g.length!==3&&g.length!==4)return _.error("Expected two or three arguments.");const u=g[0];let R=_.parse(g[1],1,ci);if(!R)return null;if(!yT(u,R.type))return _.concat(1).error(`"${u}" comparisons are not supported for type '${Yr(R.type)}'.`);let O=_.parse(g[2],2,ci);if(!O)return null;if(!yT(u,O.type))return _.concat(2).error(`"${u}" comparisons are not supported for type '${Yr(O.type)}'.`);if(R.type.kind!==O.type.kind&&R.type.kind!=="value"&&O.type.kind!=="value")return _.error(`Cannot compare types '${Yr(R.type)}' and '${Yr(O.type)}'.`);o&&(R.type.kind==="value"&&O.type.kind!=="value"?R=new xc(O.type,[R]):R.type.kind!=="value"&&O.type.kind==="value"&&(O=new xc(R.type,[O])));let G=null;if(g.length===4){if(R.type.kind!=="string"&&O.type.kind!=="string"&&R.type.kind!=="value"&&O.type.kind!=="value")return _.error("Cannot use collator to compare non-string types.");if(G=_.parse(g[3],3,sv),!G)return null}return new II(R,O,G)}evaluate(g){const _=this.lhs.evaluate(g),u=this.rhs.evaluate(g);if(o&&this.hasUntypedArgument){const R=vs(_),O=vs(u);if(R.kind!==O.kind||!(R.kind==="string"||R.kind==="number"))throw new No(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${R.kind}, ${O.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const R=vs(_),O=vs(u);if(R.kind!=="string"||O.kind!=="string")return e(g,_,u)}return this.collator?t(g,_,u,this.collator.evaluate(g)):e(g,_,u)}eachChild(g){g(this.lhs),g(this.rhs),this.collator&&g(this.collator)}outputDefined(){return!0}}}const n4=dm("==",q3,EI),i4=dm("!=",G3,Y3),r4=dm("<",Z3,Q3),o4=dm(">",W3,J3),s4=dm("<=",K3,e4),a4=dm(">=",X3,t4);class fv{constructor(e,t,o){this.type=sv,this.locale=o,this.caseSensitive=e,this.diacriticSensitive=t}static parse(e,t){if(e.length!==2)return t.error("Expected one argument.");const o=e[1];if(typeof o!="object"||Array.isArray(o))return t.error("Collator options argument must be an object.");const h=t.parse(o["case-sensitive"]===void 0?!1:o["case-sensitive"],1,ui);if(!h)return null;const g=t.parse(o["diacritic-sensitive"]===void 0?!1:o["diacritic-sensitive"],1,ui);if(!g)return null;let _=null;return o.locale&&(_=t.parse(o.locale,1,mi),!_)?null:new fv(h,g,_)}evaluate(e){return new dw(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}class _w{constructor(e,t,o,h,g){this.type=mi,this.number=e,this.locale=t,this.currency=o,this.minFractionDigits=h,this.maxFractionDigits=g}static parse(e,t){if(e.length!==3)return t.error("Expected two arguments.");const o=t.parse(e[1],1,Jt);if(!o)return null;const h=e[2];if(typeof h!="object"||Array.isArray(h))return t.error("NumberFormat options argument must be an object.");let g=null;if(h.locale&&(g=t.parse(h.locale,1,mi),!g))return null;let _=null;if(h.currency&&(_=t.parse(h.currency,1,mi),!_))return null;let u=null;if(h["min-fraction-digits"]&&(u=t.parse(h["min-fraction-digits"],1,Jt),!u))return null;let R=null;return h["max-fraction-digits"]&&(R=t.parse(h["max-fraction-digits"],1,Jt),!R)?null:new _w(o,g,_,u,R)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class yw{constructor(e){this.type=av,this.sections=e}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const o=e[1];if(!Array.isArray(o)&&typeof o=="object")return t.error("First argument must be an image or text section.");const h=[];let g=!1;for(let _=1;_<=e.length-1;++_){const u=e[_];if(g&&typeof u=="object"&&!Array.isArray(u)){g=!1;let R=null;if(u["font-scale"]&&(R=t.parse(u["font-scale"],1,Jt),!R))return null;let O=null;if(u["text-font"]&&(O=t.parse(u["text-font"],1,gu(mi)),!O))return null;let G=null;if(u["text-color"]&&(G=t.parse(u["text-color"],1,lh),!G))return null;const ne=h[h.length-1];ne.scale=R,ne.font=O,ne.textColor=G}else{const R=t.parse(e[_],1,ci);if(!R)return null;const O=R.type.kind;if(O!=="string"&&O!=="value"&&O!=="null"&&O!=="resolvedImage")return t.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");g=!0,h.push({content:R,scale:null,font:null,textColor:null})}}return new yw(h)}evaluate(e){const t=o=>{const h=o.content.evaluate(e);return vs(h)===qg?new Z0("",h,null,null,null):new Z0(fg(h),null,o.scale?o.scale.evaluate(e):null,o.font?o.font.evaluate(e).join(","):null,o.textColor?o.textColor.evaluate(e):null)};return new Kh(this.sections.map(t))}eachChild(e){for(const t of this.sections)e(t.content),t.scale&&e(t.scale),t.font&&e(t.font),t.textColor&&e(t.textColor)}outputDefined(){return!1}}class vw{constructor(e){this.type=qg,this.input=e}static parse(e,t){if(e.length!==2)return t.error("Expected two arguments.");const o=t.parse(e[1],1,mi);return o?new vw(o):t.error("No image name provided.")}evaluate(e){const t=this.input.evaluate(e),o=Hd.fromString(t);return o&&e.availableImages&&(o.available=e.availableImages.indexOf(t)>-1),o}eachChild(e){e(this.input)}outputDefined(){return!1}}class xw{constructor(e){this.type=Jt,this.input=e}static parse(e,t){if(e.length!==2)return t.error(`Expected 1 argument, but found ${e.length-1} instead.`);const o=t.parse(e[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?t.error(`Expected argument of type string or array, but found ${Yr(o.type)} instead.`):new xw(o):null}evaluate(e){const t=this.input.evaluate(e);if(typeof t=="string")return[...t].length;if(Array.isArray(t))return t.length;throw new No(`Expected value to be of type string or array, but found ${Yr(vs(t))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const hh=8192;function l4(i,e){const t=u4(i[0]),o=h4(i[1]),h=Math.pow(2,e.z);return[Math.round(t*h*hh),Math.round(o*h*hh)]}function ww(i,e){const t=Math.pow(2,e.z),o=(i[0]/hh+e.x)/t,h=(i[1]/hh+e.y)/t;return[c4(o),d4(h)]}function u4(i){return(180+i)/360}function c4(i){return i*360-180}function h4(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function d4(i){return 360/Math.PI*Math.atan(Math.exp((180-i*360)*Math.PI/180))-90}function Gg(i,e){i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),i[2]=Math.max(i[2],e[0]),i[3]=Math.max(i[3],e[1])}function Ag(i,e){return!(i[0]<=e[0]||i[2]>=e[2]||i[1]<=e[1]||i[3]>=e[3])}function p4(i,e,t){return e[1]>i[1]!=t[1]>i[1]&&i[0]<(t[0]-e[0])*(i[1]-e[1])/(t[1]-e[1])+e[0]}function f4(i,e,t){const o=i[0]-e[0],h=i[1]-e[1],g=i[0]-t[0],_=i[1]-t[1];return o*_-g*h===0&&o*g<=0&&h*_<=0}function mv(i,e,t,o){const h=[e[0]-i[0],e[1]-i[1]],g=[o[0]-t[0],o[1]-t[1]];return y4(g,h)===0?!1:!!(vT(i,e,t,o)&&vT(t,o,i,e))}function m4(i,e,t){for(const o of t)for(let h=0;h<o.length-1;++h)if(mv(i,e,o[h],o[h+1]))return!0;return!1}function pm(i,e,t=!1){let o=!1;for(const h of e)for(let g=0;g<h.length-1;g++){if(f4(i,h[g],h[g+1]))return t;p4(i,h[g],h[g+1])&&(o=!o)}return o}function g4(i,e){for(const t of e)if(pm(i,t))return!0;return!1}function PI(i,e){for(const t of i)if(!pm(t,e))return!1;for(let t=0;t<i.length-1;++t)if(m4(i[t],i[t+1],e))return!1;return!0}function _4(i,e){for(const t of e)if(PI(i,t))return!0;return!1}function y4(i,e){return i[0]*e[1]-i[1]*e[0]}function vT(i,e,t,o){const h=i[0]-t[0],g=i[1]-t[1],_=e[0]-t[0],u=e[1]-t[1],R=o[0]-t[0],O=o[1]-t[1],G=h*O-R*g,ne=_*O-R*u;return G>0&&ne<0||G<0&&ne>0}function bw(i,e,t){const o=[];for(let h=0;h<i.length;h++){const g=[];for(let _=0;_<i[h].length;_++){const u=l4(i[h][_],t);Gg(e,u),g.push(u)}o.push(g)}return o}function CI(i,e,t){const o=[];for(let h=0;h<i.length;h++){const g=bw(i[h],e,t);o.push(g)}return o}function AI(i,e,t,o){if(i[0]<t[0]||i[0]>t[2]){const h=o*.5;let g=i[0]-t[0]>h?-o:t[0]-i[0]>h?o:0;g===0&&(g=i[0]-t[2]>h?-o:t[2]-i[0]>h?o:0),i[0]+=g}Gg(e,i)}function v4(i){i[0]=i[1]=1/0,i[2]=i[3]=-1/0}function xT(i,e,t,o){const h=Math.pow(2,o.z)*hh,g=[o.x*hh,o.y*hh],_=[];for(const u of i)for(const R of u){const O=[R.x+g[0],R.y+g[1]];AI(O,e,t,h),_.push(O)}return _}function wT(i,e,t,o){const h=Math.pow(2,o.z)*hh,g=[o.x*hh,o.y*hh],_=[];for(const u of i){const R=[];for(const O of u){const G=[O.x+g[0],O.y+g[1]];Gg(e,G),R.push(G)}_.push(R)}if(e[2]-e[0]<=h/2){v4(e);for(const u of _)for(const R of u)AI(R,e,t,h)}return _}function x4(i,e){const t=[1/0,1/0,-1/0,-1/0],o=[1/0,1/0,-1/0,-1/0],h=i.canonicalID();if(e.type==="Polygon"){const g=bw(e.coordinates,o,h),_=xT(i.geometry(),t,o,h);if(!Ag(t,o))return!1;for(const u of _)if(!pm(u,g))return!1}if(e.type==="MultiPolygon"){const g=CI(e.coordinates,o,h),_=xT(i.geometry(),t,o,h);if(!Ag(t,o))return!1;for(const u of _)if(!g4(u,g))return!1}return!0}function w4(i,e){const t=[1/0,1/0,-1/0,-1/0],o=[1/0,1/0,-1/0,-1/0],h=i.canonicalID();if(e.type==="Polygon"){const g=bw(e.coordinates,o,h),_=wT(i.geometry(),t,o,h);if(!Ag(t,o))return!1;for(const u of _)if(!PI(u,g))return!1}if(e.type==="MultiPolygon"){const g=CI(e.coordinates,o,h),_=wT(i.geometry(),t,o,h);if(!Ag(t,o))return!1;for(const u of _)if(!_4(u,g))return!1}return!0}class Pp{constructor(e,t){this.type=ui,this.geojson=e,this.geometries=t}static parse(e,t){if(e.length!==2)return t.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Pg(e[1])){const o=e[1];if(o.type==="FeatureCollection"){const h=[];for(const g of o.features){const{type:_,coordinates:u}=g.geometry;_==="Polygon"&&h.push(u),_==="MultiPolygon"&&h.push(...u)}if(h.length){const g={type:"MultiPolygon",coordinates:h};return new Pp(o,g)}}else if(o.type==="Feature"){const h=o.geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new Pp(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new Pp(o,o)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return x4(e,this.geometries);if(e.geometryType()==="LineString")return w4(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class kI{constructor(e=[],t=(o,h)=>o<h?-1:o>h?1:0){if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:t,compare:o}=this,h=t[e];for(;e>0;){const g=e-1>>1,_=t[g];if(o(h,_)>=0)break;t[e]=_,e=g}t[e]=h}_down(e){const{data:t,compare:o}=this,h=this.length>>1,g=t[e];for(;e<h;){let _=(e<<1)+1;const u=_+1;if(u<this.length&&o(t[u],t[_])<0&&(_=u),o(t[_],g)>=0)break;t[e]=t[_],e=_}t[e]=g}}function b4(i,e){if(i.length<=1)return[i];const t=[];let o,h;for(const g of i){const _=T4(g);_!==0&&(g.area=Math.abs(_),h===void 0&&(h=_<0),h===_<0?(o&&t.push(o),o=[g]):o.push(g))}return o&&t.push(o),t}function T4(i){let e=0;for(let t=0,o=i.length,h=o-1,g,_;t<o;h=t++)g=i[t],_=i[h],e+=(_.x-g.x)*(g.y+_.y);return e}const S4=6378.137,bT=1/298.257223563,TT=bT*(2-bT),ST=Math.PI/180;class Tw{constructor(e){const t=ST*S4*1e3,o=Math.cos(e*ST),h=1/(1-TT*(1-o*o)),g=Math.sqrt(h);this.kx=t*g*o,this.ky=t*g*h*(1-TT)}distance(e,t){const o=this.wrap(e[0]-t[0])*this.kx,h=(e[1]-t[1])*this.ky;return Math.sqrt(o*o+h*h)}pointOnLine(e,t){let o=1/0,h,g,_,u;for(let R=0;R<e.length-1;R++){let O=e[R][0],G=e[R][1],ne=this.wrap(e[R+1][0]-O)*this.kx,re=(e[R+1][1]-G)*this.ky,Q=0;(ne!==0||re!==0)&&(Q=(this.wrap(t[0]-O)*this.kx*ne+(t[1]-G)*this.ky*re)/(ne*ne+re*re),Q>1?(O=e[R+1][0],G=e[R+1][1]):Q>0&&(O+=ne/this.kx*Q,G+=re/this.ky*Q)),ne=this.wrap(t[0]-O)*this.kx,re=(t[1]-G)*this.ky;const de=ne*ne+re*re;de<o&&(o=de,h=O,g=G,_=R,u=Q)}return{point:[h,g],index:_,t:Math.max(0,Math.min(1,u))}}wrap(e){for(;e<-180;)e+=360;for(;e>180;)e-=360;return e}}const W0=100,K0=50;function MI(i,e){return e[0]-i[0]}function ky(i){return i[1]-i[0]+1}function nd(i,e){return i[1]>=i[0]&&i[1]<e}function X0(i,e){if(i[0]>i[1])return[null,null];const t=ky(i);if(e){if(t===2)return[i,null];const h=Math.floor(t/2);return[[i[0],i[0]+h],[i[0]+h,i[1]]]}if(t===1)return[i,null];const o=Math.floor(t/2)-1;return[[i[0],i[0]+o],[i[0]+o+1,i[1]]]}function Y0(i,e){if(!nd(e,i.length))return[1/0,1/0,-1/0,-1/0];const t=[1/0,1/0,-1/0,-1/0];for(let o=e[0];o<=e[1];++o)Gg(t,i[o]);return t}function Q0(i){const e=[1/0,1/0,-1/0,-1/0];for(const t of i)for(const o of t)Gg(e,o);return e}function ET(i){return i[0]!==-1/0&&i[1]!==-1/0&&i[2]!==1/0&&i[3]!==1/0}function Sw(i,e,t){if(!ET(i)||!ET(e))return NaN;let o=0,h=0;return i[2]<e[0]&&(o=e[0]-i[2]),i[0]>e[2]&&(o=i[0]-e[2]),i[1]>e[3]&&(h=i[1]-e[3]),i[3]<e[1]&&(h=e[1]-i[3]),t.distance([0,0],[o,h])}function Tp(i,e,t){const o=t.pointOnLine(e,i);return t.distance(i,o.point)}function Ew(i,e,t,o,h){const g=Math.min(Tp(i,[t,o],h),Tp(e,[t,o],h)),_=Math.min(Tp(t,[i,e],h),Tp(o,[i,e],h));return Math.min(g,_)}function E4(i,e,t,o,h){if(!(nd(e,i.length)&&nd(o,t.length)))return 1/0;let g=1/0;for(let _=e[0];_<e[1];++_){const u=i[_],R=i[_+1];for(let O=o[0];O<o[1];++O){const G=t[O],ne=t[O+1];if(mv(u,R,G,ne))return 0;g=Math.min(g,Ew(u,R,G,ne,h))}}return g}function I4(i,e,t,o,h){if(!(nd(e,i.length)&&nd(o,t.length)))return NaN;let g=1/0;for(let _=e[0];_<=e[1];++_)for(let u=o[0];u<=o[1];++u)if(g=Math.min(g,h.distance(i[_],t[u])),g===0)return g;return g}function P4(i,e,t){if(pm(i,e,!0))return 0;let o=1/0;for(const h of e){const g=h[0],_=h[h.length-1];if(g!==_&&(o=Math.min(o,Tp(i,[_,g],t)),o===0))return o;const u=t.pointOnLine(h,i);if(o=Math.min(o,t.distance(i,u.point)),o===0)return o}return o}function C4(i,e,t,o){if(!nd(e,i.length))return NaN;for(let g=e[0];g<=e[1];++g)if(pm(i[g],t,!0))return 0;let h=1/0;for(let g=e[0];g<e[1];++g){const _=i[g],u=i[g+1];for(const R of t)for(let O=0,G=R.length,ne=G-1;O<G;ne=O++){const re=R[ne],Q=R[O];if(mv(_,u,re,Q))return 0;h=Math.min(h,Ew(_,u,re,Q,o))}}return h}function IT(i,e){for(const t of i)for(const o of t)if(pm(o,e,!0))return!0;return!1}function A4(i,e,t,o=1/0){const h=Q0(i),g=Q0(e);if(o!==1/0&&Sw(h,g,t)>=o)return o;if(Ag(h,g)){if(IT(i,e))return 0}else if(IT(e,i))return 0;let _=1/0;for(const u of i)for(let R=0,O=u.length,G=O-1;R<O;G=R++){const ne=u[G],re=u[R];for(const Q of e)for(let de=0,Se=Q.length,De=Se-1;de<Se;De=de++){const Ke=Q[De],et=Q[de];if(mv(ne,re,Ke,et))return 0;_=Math.min(_,Ew(ne,re,Ke,et,t))}}return _}function PT(i,e,t,o,h,g){if(!g)return;const _=Sw(Y0(o,g),h,t);_<e&&i.push([_,g,[0,0]])}function V_(i,e,t,o,h,g,_){if(!g||!_)return;const u=Sw(Y0(o,g),Y0(h,_),t);u<e&&i.push([u,g,_])}function My(i,e,t,o,h=1/0){let g=Math.min(o.distance(i[0],t[0][0]),h);if(g===0)return g;const _=new kI([[0,[0,i.length-1],[0,0]]],MI),u=Q0(t);for(;_.length>0;){const R=_.pop();if(R[0]>=g)continue;const O=R[1],G=e?K0:W0;if(ky(O)<=G){if(!nd(O,i.length))return NaN;if(e){const ne=C4(i,O,t,o);if(isNaN(ne)||ne===0)return ne;g=Math.min(g,ne)}else for(let ne=O[0];ne<=O[1];++ne){const re=P4(i[ne],t,o);if(g=Math.min(g,re),g===0)return 0}}else{const ne=X0(O,e);PT(_,g,o,i,u,ne[0]),PT(_,g,o,i,u,ne[1])}}return g}function Ry(i,e,t,o,h,g=1/0){let _=Math.min(g,h.distance(i[0],t[0]));if(_===0)return _;const u=new kI([[0,[0,i.length-1],[0,t.length-1]]],MI);for(;u.length>0;){const R=u.pop();if(R[0]>=_)continue;const O=R[1],G=R[2],ne=e?K0:W0,re=o?K0:W0;if(ky(O)<=ne&&ky(G)<=re){if(!nd(O,i.length)&&nd(G,t.length))return NaN;let Q;if(e&&o)Q=E4(i,O,t,G,h),_=Math.min(_,Q);else if(e&&!o){const de=i.slice(O[0],O[1]+1);for(let Se=G[0];Se<=G[1];++Se)if(Q=Tp(t[Se],de,h),_=Math.min(_,Q),_===0)return _}else if(!e&&o){const de=t.slice(G[0],G[1]+1);for(let Se=O[0];Se<=O[1];++Se)if(Q=Tp(i[Se],de,h),_=Math.min(_,Q),_===0)return _}else Q=I4(i,O,t,G,h),_=Math.min(_,Q)}else{const Q=X0(O,e),de=X0(G,o);V_(u,_,h,i,t,Q[0],de[0]),V_(u,_,h,i,t,Q[0],de[1]),V_(u,_,h,i,t,Q[1],de[0]),V_(u,_,h,i,t,Q[1],de[1])}}return _}function k4(i,e){const t=i.geometry(),o=t.flat().map(_=>ww([_.x,_.y],i.canonical));if(t.length===0)return NaN;const h=new Tw(o[0][1]);let g=1/0;for(const _ of e){switch(_.type){case"Point":g=Math.min(g,Ry(o,!1,[_.coordinates],!1,h,g));break;case"LineString":g=Math.min(g,Ry(o,!1,_.coordinates,!0,h,g));break;case"Polygon":g=Math.min(g,My(o,!1,_.coordinates,h,g));break}if(g===0)return g}return g}function M4(i,e){const t=i.geometry(),o=t.flat().map(_=>ww([_.x,_.y],i.canonical));if(t.length===0)return NaN;const h=new Tw(o[0][1]);let g=1/0;for(const _ of e){switch(_.type){case"Point":g=Math.min(g,Ry(o,!0,[_.coordinates],!1,h,g));break;case"LineString":g=Math.min(g,Ry(o,!0,_.coordinates,!0,h,g));break;case"Polygon":g=Math.min(g,My(o,!0,_.coordinates,h,g));break}if(g===0)return g}return g}function R4(i,e){const t=i.geometry();if(t.length===0||t[0].length===0)return NaN;const o=b4(t).map(_=>_.map(u=>u.map(R=>ww([R.x,R.y],i.canonical)))),h=new Tw(o[0][0][0][1]);let g=1/0;for(const _ of e)for(const u of o){switch(_.type){case"Point":g=Math.min(g,My([_.coordinates],!1,u,h,g));break;case"LineString":g=Math.min(g,My(_.coordinates,!0,u,h,g));break;case"Polygon":g=Math.min(g,A4(u,_.coordinates,h,g));break}if(g===0)return g}return g}function d0(i){return i.type==="MultiPolygon"?i.coordinates.map(e=>({type:"Polygon",coordinates:e})):i.type==="MultiLineString"?i.coordinates.map(e=>({type:"LineString",coordinates:e})):i.type==="MultiPoint"?i.coordinates.map(e=>({type:"Point",coordinates:e})):[i]}class Cp{constructor(e,t){this.type=Jt,this.geojson=e,this.geometries=t}static parse(e,t){if(e.length!==2)return t.error(`'distance' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Pg(e[1])){const o=e[1];if(o.type==="FeatureCollection")return new Cp(o,o.features.map(h=>d0(h.geometry)).flat());if(o.type==="Feature")return new Cp(o,d0(o.geometry));if("type"in o&&"coordinates"in o)return new Cp(o,d0(o))}return t.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return k4(e,this.geometries);if(e.geometryType()==="LineString")return M4(e,this.geometries);if(e.geometryType()==="Polygon")return R4(e,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const Iw={"==":n4,"!=":i4,">":o4,"<":r4,">=":a4,"<=":s4,array:xc,at:pw,boolean:xc,case:gw,coalesce:Cg,collator:fv,format:yw,image:vw,in:fw,"index-of":Cy,interpolate:ch,"interpolate-hcl":ch,"interpolate-lab":ch,length:xw,let:hv,literal:em,match:mw,number:xc,"number-format":_w,object:xc,slice:Ay,step:pv,string:xc,"to-boolean":Rd,"to-color":Rd,"to-number":Rd,"to-string":Rd,var:dv,within:Pp,distance:Cp};class Tc{constructor(e,t,o,h){this.name=e,this.type=t,this._evaluate=o,this.args=h}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,t){const o=e[0],h=Tc.definitions[o];if(!h)return t.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);const g=Array.isArray(h)?h[0]:h.type,_=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,u=_.filter(([O])=>!Array.isArray(O)||O.length===e.length-1);let R=null;for(const[O,G]of u){R=new cv(t.registry,Ly,t.path,null,t.scope);const ne=[];let re=!1;for(let Q=1;Q<e.length;Q++){const de=e[Q],Se=Array.isArray(O)?O[Q-1]:O.type,De=R.parse(de,1+ne.length,Se);if(!De){re=!0;break}ne.push(De)}if(!re){if(Array.isArray(O)&&O.length!==ne.length){R.error(`Expected ${O.length} arguments, but found ${ne.length} instead.`);continue}for(let Q=0;Q<ne.length;Q++){const de=Array.isArray(O)?O[Q]:O.type,Se=ne[Q];R.concat(Q+1).checkSubtype(de,Se.type)}if(R.errors.length===0)return new Tc(o,g,G,ne)}}if(u.length===1)t.errors.push(...R.errors);else{const O=(u.length?u:_).map(([ne])=>D4(ne)).join(" | "),G=[];for(let ne=1;ne<e.length;ne++){const re=t.parse(e[ne],1+G.length);if(!re)return null;G.push(Yr(re.type))}t.error(`Expected arguments of type ${O}, but found (${G.join(", ")}) instead.`)}return null}static register(e,t){Tc.definitions=t;for(const o in t)e[o]=Tc}}function CT(i,[e,t,o,h]){e=e.evaluate(i),t=t.evaluate(i),o=o.evaluate(i);const g=h?h.evaluate(i):1,_=bI(e,t,o,g);if(_)throw new No(_);return new kr(e/255,t/255,o/255,g,!1)}function AT(i,e){return i in e}function p0(i,e){const t=e[i];return typeof t>"u"?null:t}function L4(i,e,t,o){for(;t<=o;){const h=t+o>>1;if(e[h]===i)return!0;e[h]>i?o=h-1:t=h+1}return!1}function _p(i){return{type:i}}Tc.register(Iw,{error:[A3,[mi],(i,[e])=>{throw new No(e.evaluate(i))}],typeof:[mi,[ci],(i,[e])=>Yr(vs(e.evaluate(i)))],"to-rgba":[gu(Jt,4),[lh],(i,[e])=>{const[t,o,h,g]=e.evaluate(i).rgb;return[t*255,o*255,h*255,g]}],rgb:[lh,[Jt,Jt,Jt],CT],rgba:[lh,[Jt,Jt,Jt,Jt],CT],has:{type:ui,overloads:[[[mi],(i,[e])=>AT(e.evaluate(i),i.properties())],[[mi,Hf],(i,[e,t])=>AT(e.evaluate(i),t.evaluate(i))]]},get:{type:ci,overloads:[[[mi],(i,[e])=>p0(e.evaluate(i),i.properties())],[[mi,Hf],(i,[e,t])=>p0(e.evaluate(i),t.evaluate(i))]]},"feature-state":[ci,[mi],(i,[e])=>p0(e.evaluate(i),i.featureState||{})],properties:[Hf,[],i=>i.properties()],"geometry-type":[mi,[],i=>i.geometryType()],id:[ci,[],i=>i.id()],zoom:[Jt,[],i=>i.globals.zoom],"heatmap-density":[Jt,[],i=>i.globals.heatmapDensity||0],"line-progress":[Jt,[],i=>i.globals.lineProgress||0],accumulated:[ci,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[Jt,_p(Jt),(i,e)=>{let t=0;for(const o of e)t+=o.evaluate(i);return t}],"*":[Jt,_p(Jt),(i,e)=>{let t=1;for(const o of e)t*=o.evaluate(i);return t}],"-":{type:Jt,overloads:[[[Jt,Jt],(i,[e,t])=>e.evaluate(i)-t.evaluate(i)],[[Jt],(i,[e])=>-e.evaluate(i)]]},"/":[Jt,[Jt,Jt],(i,[e,t])=>e.evaluate(i)/t.evaluate(i)],"%":[Jt,[Jt,Jt],(i,[e,t])=>e.evaluate(i)%t.evaluate(i)],ln2:[Jt,[],()=>Math.LN2],pi:[Jt,[],()=>Math.PI],e:[Jt,[],()=>Math.E],"^":[Jt,[Jt,Jt],(i,[e,t])=>Math.pow(e.evaluate(i),t.evaluate(i))],sqrt:[Jt,[Jt],(i,[e])=>Math.sqrt(e.evaluate(i))],log10:[Jt,[Jt],(i,[e])=>Math.log(e.evaluate(i))/Math.LN10],ln:[Jt,[Jt],(i,[e])=>Math.log(e.evaluate(i))],log2:[Jt,[Jt],(i,[e])=>Math.log(e.evaluate(i))/Math.LN2],sin:[Jt,[Jt],(i,[e])=>Math.sin(e.evaluate(i))],cos:[Jt,[Jt],(i,[e])=>Math.cos(e.evaluate(i))],tan:[Jt,[Jt],(i,[e])=>Math.tan(e.evaluate(i))],asin:[Jt,[Jt],(i,[e])=>Math.asin(e.evaluate(i))],acos:[Jt,[Jt],(i,[e])=>Math.acos(e.evaluate(i))],atan:[Jt,[Jt],(i,[e])=>Math.atan(e.evaluate(i))],min:[Jt,_p(Jt),(i,e)=>Math.min(...e.map(t=>t.evaluate(i)))],max:[Jt,_p(Jt),(i,e)=>Math.max(...e.map(t=>t.evaluate(i)))],abs:[Jt,[Jt],(i,[e])=>Math.abs(e.evaluate(i))],round:[Jt,[Jt],(i,[e])=>{const t=e.evaluate(i);return t<0?-Math.round(-t):Math.round(t)}],floor:[Jt,[Jt],(i,[e])=>Math.floor(e.evaluate(i))],ceil:[Jt,[Jt],(i,[e])=>Math.ceil(e.evaluate(i))],"filter-==":[ui,[mi,ci],(i,[e,t])=>i.properties()[e.value]===t.value],"filter-id-==":[ui,[ci],(i,[e])=>i.id()===e.value],"filter-type-==":[ui,[mi],(i,[e])=>i.geometryType()===e.value],"filter-<":[ui,[mi,ci],(i,[e,t])=>{const o=i.properties()[e.value],h=t.value;return typeof o==typeof h&&o<h}],"filter-id-<":[ui,[ci],(i,[e])=>{const t=i.id(),o=e.value;return typeof t==typeof o&&t<o}],"filter->":[ui,[mi,ci],(i,[e,t])=>{const o=i.properties()[e.value],h=t.value;return typeof o==typeof h&&o>h}],"filter-id->":[ui,[ci],(i,[e])=>{const t=i.id(),o=e.value;return typeof t==typeof o&&t>o}],"filter-<=":[ui,[mi,ci],(i,[e,t])=>{const o=i.properties()[e.value],h=t.value;return typeof o==typeof h&&o<=h}],"filter-id-<=":[ui,[ci],(i,[e])=>{const t=i.id(),o=e.value;return typeof t==typeof o&&t<=o}],"filter->=":[ui,[mi,ci],(i,[e,t])=>{const o=i.properties()[e.value],h=t.value;return typeof o==typeof h&&o>=h}],"filter-id->=":[ui,[ci],(i,[e])=>{const t=i.id(),o=e.value;return typeof t==typeof o&&t>=o}],"filter-has":[ui,[ci],(i,[e])=>e.value in i.properties()],"filter-has-id":[ui,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[ui,[gu(mi)],(i,[e])=>e.value.indexOf(i.geometryType())>=0],"filter-id-in":[ui,[gu(ci)],(i,[e])=>e.value.indexOf(i.id())>=0],"filter-in-small":[ui,[mi,gu(ci)],(i,[e,t])=>t.value.indexOf(i.properties()[e.value])>=0],"filter-in-large":[ui,[mi,gu(ci)],(i,[e,t])=>L4(i.properties()[e.value],t.value,0,t.value.length-1)],all:{type:ui,overloads:[[[ui,ui],(i,[e,t])=>e.evaluate(i)&&t.evaluate(i)],[_p(ui),(i,e)=>{for(const t of e)if(!t.evaluate(i))return!1;return!0}]]},any:{type:ui,overloads:[[[ui,ui],(i,[e,t])=>e.evaluate(i)||t.evaluate(i)],[_p(ui),(i,e)=>{for(const t of e)if(t.evaluate(i))return!0;return!1}]]},"!":[ui,[ui],(i,[e])=>!e.evaluate(i)],"is-supported-script":[ui,[mi],(i,[e])=>{const t=i.globals&&i.globals.isSupportedScript;return t?t(e.evaluate(i)):!0}],upcase:[mi,[mi],(i,[e])=>e.evaluate(i).toUpperCase()],downcase:[mi,[mi],(i,[e])=>e.evaluate(i).toLowerCase()],concat:[mi,_p(ci),(i,e)=>e.map(t=>fg(t.evaluate(i))).join("")],"resolved-locale":[mi,[sv],(i,[e])=>e.evaluate(i).resolvedLocale()]});function D4(i){return Array.isArray(i)?`(${i.map(Yr).join(", ")})`:`(${Yr(i.type)}...)`}function Ly(i){if(i instanceof dv)return Ly(i.boundExpression);if(i instanceof Tc&&i.name==="error"||i instanceof fv||i instanceof Pp||i instanceof Cp)return!1;const e=i instanceof Rd||i instanceof xc;let t=!0;return i.eachChild(o=>{e?t=t&&Ly(o):t=t&&o instanceof em}),t?gv(i)&&_v(i,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"]):!1}function gv(i){if(i instanceof Tc&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof Pp||i instanceof Cp)return!1;let e=!0;return i.eachChild(t=>{e&&!gv(t)&&(e=!1)}),e}function kg(i){if(i instanceof Tc&&i.name==="feature-state")return!1;let e=!0;return i.eachChild(t=>{e&&!kg(t)&&(e=!1)}),e}function _v(i,e){if(i instanceof Tc&&e.indexOf(i.name)>=0)return!1;let t=!0;return i.eachChild(o=>{t&&!_v(o,e)&&(t=!1)}),t}function J0(i){return{result:"success",value:i}}function Nf(i){return{result:"error",value:i}}function Dy(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function RI(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function LI(i){return!!i.expression&&i.expression.interpolated}function rr(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function Pw(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}class z4{constructor(e,t){this.expression=e,this._warningHistory={},this._evaluator=new TI,this._defaultValue=t?F4(t):null,this._enumValues=t&&t.type==="enum"?t.values:null}evaluateWithoutErrorHandling(e,t,o,h,g,_){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=o,this._evaluator.canonical=h,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=_,this.expression.evaluate(this._evaluator)}evaluate(e,t,o,h,g,_){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=o||null,this._evaluator.canonical=h,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=_||null;try{const u=this.expression.evaluate(this._evaluator);if(u==null||typeof u=="number"&&u!==u)return this._defaultValue;if(this._enumValues&&!(u in this._enumValues))throw new No(`Expected value to be one of ${Object.keys(this._enumValues).map(R=>JSON.stringify(R)).join(", ")}, but found ${JSON.stringify(u)} instead.`);return u}catch(u){return this._warningHistory[u.message]||(this._warningHistory[u.message]=!0,typeof console<"u"&&console.warn(u.message)),this._defaultValue}}}function DI(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in Iw}function zI(i,e){const t=new cv(Iw,Ly,[],e?O4(e):void 0),o=t.parse(i,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return o?J0(new z4(o,e)):Nf(t.errors)}class kT{constructor(e,t){this.kind=e,this._styleExpression=t,this.isStateDependent=e!=="constant"&&!kg(t.expression)}evaluateWithoutErrorHandling(e,t,o,h,g,_){return this._styleExpression.evaluateWithoutErrorHandling(e,t,o,h,g,_)}evaluate(e,t,o,h,g,_){return this._styleExpression.evaluate(e,t,o,h,g,_)}}class MT{constructor(e,t,o,h){this.kind=e,this.zoomStops=o,this._styleExpression=t,this.isStateDependent=e!=="camera"&&!kg(t.expression),this.interpolationType=h}evaluateWithoutErrorHandling(e,t,o,h,g,_){return this._styleExpression.evaluateWithoutErrorHandling(e,t,o,h,g,_)}evaluate(e,t,o,h,g,_){return this._styleExpression.evaluate(e,t,o,h,g,_)}interpolationFactor(e,t,o){return this.interpolationType?ch.interpolationFactor(this.interpolationType,e,t,o):0}}function N4(i,e){const t=zI(i,e);if(t.result==="error")return t;const o=t.value.expression,h=gv(o);if(!h&&!Dy(e))return Nf([new ih("","data expressions not supported")]);const g=_v(o,["zoom"]);if(!g&&!RI(e))return Nf([new ih("","zoom expressions not supported")]);const _=ny(o);if(!_&&!g)return Nf([new ih("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')]);if(_ instanceof ih)return Nf([_]);if(_ instanceof ch&&!LI(e))return Nf([new ih("",'"interpolate" expressions cannot be used with this property')]);if(!_)return J0(h?new kT("constant",t.value):new kT("source",t.value));const u=_ instanceof ch?_.interpolation:void 0;return J0(h?new MT("camera",t.value,_.labels,u):new MT("composite",t.value,_.labels,u))}function ny(i){let e=null;if(i instanceof hv)e=ny(i.result);else if(i instanceof Cg){for(const t of i.args)if(e=ny(t),e)break}else(i instanceof pv||i instanceof ch)&&i.input instanceof Tc&&i.input.name==="zoom"&&(e=i);return e instanceof ih||i.eachChild(t=>{const o=ny(t);o instanceof ih?e=o:!e&&o?e=new ih("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&o&&e!==o&&(e=new ih("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function O4(i){const e={color:lh,string:mi,number:Jt,enum:mi,boolean:ui,formatted:av,padding:lv,projectionDefinition:ov,resolvedImage:qg,variableAnchorOffsetCollection:uv};return i.type==="array"?gu(e[i.value]||ci,i.length):e[i.type]}function F4(i){return i.type==="color"&&Pw(i.default)?new kr(0,0,0,0):i.type==="color"?kr.parse(i.default)||null:i.type==="padding"?bc.parse(i.default)||null:i.type==="variableAnchorOffsetCollection"?uh.parse(i.default)||null:i.type==="projectionDefinition"?vc.parse(i.default)||null:i.default===void 0?null:i.default}function NI(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const e of i.slice(1))if(!NI(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function OI(i){const e=i.key,t=i.value;return t?[new Wt(e,t,"constants have been deprecated as of v8")]:[]}function wo(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function zp(i){if(Array.isArray(i))return i.map(zp);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const e={};for(const t in i)e[t]=zp(i[t]);return e}return wo(i)}function Bu(i){const e=i.key,t=i.value,o=i.valueSpec||{},h=i.objectElementValidators||{},g=i.style,_=i.styleSpec,u=i.validateSpec;let R=[];const O=rr(t);if(O!=="object")return[new Wt(e,t,`object expected, ${O} found`)];for(const G in t){const ne=G.split(".")[0],re=o[ne]||o["*"];let Q;if(h[ne])Q=h[ne];else if(o[ne])Q=u;else if(h["*"])Q=h["*"];else if(o["*"])Q=u;else{R.push(new Wt(e,t[G],`unknown property "${G}"`));continue}R=R.concat(Q({key:(e&&`${e}.`)+G,value:t[G],valueSpec:re,style:g,styleSpec:_,object:t,objectKey:G,validateSpec:u},t))}for(const G in o)h[G]||o[G].required&&o[G].default===void 0&&t[G]===void 0&&R.push(new Wt(e,t,`missing required property "${G}"`));return R}function Cw(i){const e=i.value,t=i.valueSpec,o=i.validateSpec,h=i.style,g=i.styleSpec,_=i.key,u=i.arrayElementValidator||o;if(rr(e)!=="array")return[new Wt(_,e,`array expected, ${rr(e)} found`)];if(t.length&&e.length!==t.length)return[new Wt(_,e,`array length ${t.length} expected, length ${e.length} found`)];if(t["min-length"]&&e.length<t["min-length"])return[new Wt(_,e,`array length at least ${t["min-length"]} expected, length ${e.length} found`)];let R={type:t.value,values:t.values};g.$version<7&&(R.function=t.function),rr(t.value)==="object"&&(R=t.value);let O=[];for(let G=0;G<e.length;G++)O=O.concat(u({array:e,arrayIndex:G,value:e[G],valueSpec:R,validateSpec:i.validateSpec,style:h,styleSpec:g,key:`${_}[${G}]`}));return O}function Aw(i){const e=i.key,t=i.value,o=i.valueSpec;let h=rr(t);return h==="number"&&t!==t&&(h="NaN"),h!=="number"?[new Wt(e,t,`number expected, ${h} found`)]:"minimum"in o&&t<o.minimum?[new Wt(e,t,`${t} is less than the minimum value ${o.minimum}`)]:"maximum"in o&&t>o.maximum?[new Wt(e,t,`${t} is greater than the maximum value ${o.maximum}`)]:[]}function FI(i){const e=i.valueSpec,t=wo(i.value.type);let o,h={},g,_;const u=t!=="categorical"&&i.value.property===void 0,R=!u,O=rr(i.value.stops)==="array"&&rr(i.value.stops[0])==="array"&&rr(i.value.stops[0][0])==="object",G=Bu({key:i.key,value:i.value,valueSpec:i.styleSpec.function,validateSpec:i.validateSpec,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:ne,default:de}});return t==="identity"&&u&&G.push(new Wt(i.key,i.value,'missing required property "property"')),t!=="identity"&&!i.value.stops&&G.push(new Wt(i.key,i.value,'missing required property "stops"')),t==="exponential"&&i.valueSpec.expression&&!LI(i.valueSpec)&&G.push(new Wt(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(R&&!Dy(i.valueSpec)?G.push(new Wt(i.key,i.value,"property functions not supported")):u&&!RI(i.valueSpec)&&G.push(new Wt(i.key,i.value,"zoom functions not supported"))),(t==="categorical"||O)&&i.value.property===void 0&&G.push(new Wt(i.key,i.value,'"property" property is required')),G;function ne(Se){if(t==="identity")return[new Wt(Se.key,Se.value,'identity function may not have a "stops" property')];let De=[];const Ke=Se.value;return De=De.concat(Cw({key:Se.key,value:Ke,valueSpec:Se.valueSpec,validateSpec:Se.validateSpec,style:Se.style,styleSpec:Se.styleSpec,arrayElementValidator:re})),rr(Ke)==="array"&&Ke.length===0&&De.push(new Wt(Se.key,Ke,"array must have at least one stop")),De}function re(Se){let De=[];const Ke=Se.value,et=Se.key;if(rr(Ke)!=="array")return[new Wt(et,Ke,`array expected, ${rr(Ke)} found`)];if(Ke.length!==2)return[new Wt(et,Ke,`array length 2 expected, length ${Ke.length} found`)];if(O){if(rr(Ke[0])!=="object")return[new Wt(et,Ke,`object expected, ${rr(Ke[0])} found`)];if(Ke[0].zoom===void 0)return[new Wt(et,Ke,"object stop key must have zoom")];if(Ke[0].value===void 0)return[new Wt(et,Ke,"object stop key must have value")];if(_&&_>wo(Ke[0].zoom))return[new Wt(et,Ke[0].zoom,"stop zoom values must appear in ascending order")];wo(Ke[0].zoom)!==_&&(_=wo(Ke[0].zoom),g=void 0,h={}),De=De.concat(Bu({key:`${et}[0]`,value:Ke[0],valueSpec:{zoom:{}},validateSpec:Se.validateSpec,style:Se.style,styleSpec:Se.styleSpec,objectElementValidators:{zoom:Aw,value:Q}}))}else De=De.concat(Q({key:`${et}[0]`,value:Ke[0],validateSpec:Se.validateSpec,style:Se.style,styleSpec:Se.styleSpec},Ke));return DI(zp(Ke[1]))?De.concat([new Wt(`${et}[1]`,Ke[1],"expressions are not allowed in function stops.")]):De.concat(Se.validateSpec({key:`${et}[1]`,value:Ke[1],valueSpec:e,validateSpec:Se.validateSpec,style:Se.style,styleSpec:Se.styleSpec}))}function Q(Se,De){const Ke=rr(Se.value),et=wo(Se.value),vt=Se.value!==null?Se.value:De;if(!o)o=Ke;else if(Ke!==o)return[new Wt(Se.key,vt,`${Ke} stop domain type must match previous stop domain type ${o}`)];if(Ke!=="number"&&Ke!=="string"&&Ke!=="boolean")return[new Wt(Se.key,vt,"stop domain value must be a number, string, or boolean")];if(Ke!=="number"&&t!=="categorical"){let Ye=`number expected, ${Ke} found`;return Dy(e)&&t===void 0&&(Ye+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Wt(Se.key,vt,Ye)]}return t==="categorical"&&Ke==="number"&&(!isFinite(et)||Math.floor(et)!==et)?[new Wt(Se.key,vt,`integer expected, found ${et}`)]:t!=="categorical"&&Ke==="number"&&g!==void 0&&et<g?[new Wt(Se.key,vt,"stop domain values must appear in ascending order")]:(g=et,t==="categorical"&&et in h?[new Wt(Se.key,vt,"stop domain values must be unique")]:(h[et]=!0,[]))}function de(Se){return Se.validateSpec({key:Se.key,value:Se.value,valueSpec:e,validateSpec:Se.validateSpec,style:Se.style,styleSpec:Se.styleSpec})}}function tm(i){const e=(i.expressionContext==="property"?N4:zI)(zp(i.value),i.valueSpec);if(e.result==="error")return e.value.map(o=>new Wt(`${i.key}${o.key}`,i.value,o.message));const t=e.value.expression||e.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!t.outputDefined())return[new Wt(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!kg(t))return[new Wt(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!kg(t))return[new Wt(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!_v(t,["zoom","feature-state"]))return[new Wt(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!gv(t))return[new Wt(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function B4(i){const e=i.value,t=i.key,o=rr(e);return o!=="boolean"?[new Wt(t,e,`boolean expected, ${o} found`)]:[]}function V4(i){const e=i.key,t=i.value,o=rr(t);return o!=="string"?[new Wt(e,t,`color expected, ${o} found`)]:kr.parse(String(t))?[]:[new Wt(e,t,`color expected, "${t}" found`)]}function Mg(i){const e=i.key,t=i.value,o=i.valueSpec,h=[];return Array.isArray(o.values)?o.values.indexOf(wo(t))===-1&&h.push(new Wt(e,t,`expected one of [${o.values.join(", ")}], ${JSON.stringify(t)} found`)):Object.keys(o.values).indexOf(wo(t))===-1&&h.push(new Wt(e,t,`expected one of [${Object.keys(o.values).join(", ")}], ${JSON.stringify(t)} found`)),h}function kw(i){return NI(zp(i.value))?tm(Iy({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):BI(i)}function BI(i){const e=i.value,t=i.key;if(rr(e)!=="array")return[new Wt(t,e,`array expected, ${rr(e)} found`)];const o=i.styleSpec;let h,g=[];if(e.length<1)return[new Wt(t,e,"filter array must have at least 1 element")];switch(g=g.concat(Mg({key:`${t}[0]`,value:e[0],valueSpec:o.filter_operator,style:i.style,styleSpec:i.styleSpec})),wo(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&wo(e[1])==="$type"&&g.push(new Wt(t,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&g.push(new Wt(t,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(h=rr(e[1]),h!=="string"&&g.push(new Wt(`${t}[1]`,e[1],`string expected, ${h} found`)));for(let _=2;_<e.length;_++)h=rr(e[_]),wo(e[1])==="$type"?g=g.concat(Mg({key:`${t}[${_}]`,value:e[_],valueSpec:o.geometry_type,style:i.style,styleSpec:i.styleSpec})):h!=="string"&&h!=="number"&&h!=="boolean"&&g.push(new Wt(`${t}[${_}]`,e[_],`string, number, or boolean expected, ${h} found`));break;case"any":case"all":case"none":for(let _=1;_<e.length;_++)g=g.concat(BI({key:`${t}[${_}]`,value:e[_],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":h=rr(e[1]),e.length!==2?g.push(new Wt(t,e,`filter array for "${e[0]}" operator must have 2 elements`)):h!=="string"&&g.push(new Wt(`${t}[1]`,e[1],`string expected, ${h} found`));break}return g}function VI(i,e){const t=i.key,o=i.validateSpec,h=i.style,g=i.styleSpec,_=i.value,u=i.objectKey,R=g[`${e}_${i.layerType}`];if(!R)return[];const O=u.match(/^(.*)-transition$/);if(e==="paint"&&O&&R[O[1]]&&R[O[1]].transition)return o({key:t,value:_,valueSpec:g.transition,style:h,styleSpec:g});const G=i.valueSpec||R[u];if(!G)return[new Wt(t,_,`unknown property "${u}"`)];let ne;if(rr(_)==="string"&&Dy(G)&&!G.tokens&&(ne=/^{([^}]+)}$/.exec(_)))return[new Wt(t,_,`"${u}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(ne[1])} }\`.`)];const re=[];return i.layerType==="symbol"&&(u==="text-field"&&h&&!h.glyphs&&re.push(new Wt(t,_,'use of "text-field" requires a style "glyphs" property')),u==="text-font"&&Pw(zp(_))&&wo(_.type)==="identity"&&re.push(new Wt(t,_,'"text-font" does not support identity functions'))),re.concat(o({key:i.key,value:_,valueSpec:G,style:h,styleSpec:g,expressionContext:"property",propertyType:e,propertyKey:u}))}function UI(i){return VI(i,"paint")}function jI(i){return VI(i,"layout")}function $I(i){let e=[];const t=i.value,o=i.key,h=i.style,g=i.styleSpec;!t.type&&!t.ref&&e.push(new Wt(o,t,'either "type" or "ref" is required'));let _=wo(t.type);const u=wo(t.ref);if(t.id){const R=wo(t.id);for(let O=0;O<i.arrayIndex;O++){const G=h.layers[O];wo(G.id)===R&&e.push(new Wt(o,t.id,`duplicate layer id "${t.id}", previously used at line ${G.id.__line__}`))}}if("ref"in t){["type","source","source-layer","filter","layout"].forEach(O=>{O in t&&e.push(new Wt(o,t[O],`"${O}" is prohibited for ref layers`))});let R;h.layers.forEach(O=>{wo(O.id)===u&&(R=O)}),R?R.ref?e.push(new Wt(o,t.ref,"ref cannot reference another ref layer")):_=wo(R.type):e.push(new Wt(o,t.ref,`ref layer "${u}" not found`))}else if(_!=="background")if(!t.source)e.push(new Wt(o,t,'missing required property "source"'));else{const R=h.sources&&h.sources[t.source],O=R&&wo(R.type);R?O==="vector"&&_==="raster"?e.push(new Wt(o,t.source,`layer "${t.id}" requires a raster source`)):O!=="raster-dem"&&_==="hillshade"?e.push(new Wt(o,t.source,`layer "${t.id}" requires a raster-dem source`)):O==="raster"&&_!=="raster"?e.push(new Wt(o,t.source,`layer "${t.id}" requires a vector source`)):O==="vector"&&!t["source-layer"]?e.push(new Wt(o,t,`layer "${t.id}" must specify a "source-layer"`)):O==="raster-dem"&&_!=="hillshade"?e.push(new Wt(o,t.source,"raster-dem source can only be used with layer type 'hillshade'.")):_==="line"&&t.paint&&t.paint["line-gradient"]&&(O!=="geojson"||!R.lineMetrics)&&e.push(new Wt(o,t,`layer "${t.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Wt(o,t.source,`source "${t.source}" not found`))}return e=e.concat(Bu({key:o,value:t,valueSpec:g.layer,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,objectElementValidators:{"*"(){return[]},type(){return i.validateSpec({key:`${o}.type`,value:t.type,valueSpec:g.layer.type,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,object:t,objectKey:"type"})},filter:kw,layout(R){return Bu({layer:t,key:R.key,value:R.value,style:R.style,styleSpec:R.styleSpec,validateSpec:R.validateSpec,objectElementValidators:{"*"(O){return jI(Iy({layerType:_},O))}}})},paint(R){return Bu({layer:t,key:R.key,value:R.value,style:R.style,styleSpec:R.styleSpec,validateSpec:R.validateSpec,objectElementValidators:{"*"(O){return UI(Iy({layerType:_},O))}}})}}})),e}function Np(i){const e=i.value,t=i.key,o=rr(e);return o!=="string"?[new Wt(t,e,`string expected, ${o} found`)]:[]}function U4(i){var e;const t=(e=i.sourceName)!==null&&e!==void 0?e:"",o=i.value,h=i.styleSpec,g=h.source_raster_dem,_=i.style;let u=[];const R=rr(o);if(o===void 0)return u;if(R!=="object")return u.push(new Wt("source_raster_dem",o,`object expected, ${R} found`)),u;const O=wo(o.encoding)==="custom",G=["redFactor","greenFactor","blueFactor","baseShift"],ne=i.value.encoding?`"${i.value.encoding}"`:"Default";for(const re in o)!O&&G.includes(re)?u.push(new Wt(re,o[re],`In "${t}": "${re}" is only valid when "encoding" is set to "custom". ${ne} encoding found`)):g[re]?u=u.concat(i.validateSpec({key:re,value:o[re],valueSpec:g[re],validateSpec:i.validateSpec,style:_,styleSpec:h})):u.push(new Wt(re,o[re],`unknown property "${re}"`));return u}const RT={promoteId:j4};function HI(i){const e=i.value,t=i.key,o=i.styleSpec,h=i.style,g=i.validateSpec;if(!e.type)return[new Wt(t,e,'"type" is required')];const _=wo(e.type);let u;switch(_){case"vector":case"raster":return u=Bu({key:t,value:e,valueSpec:o[`source_${_.replace("-","_")}`],style:i.style,styleSpec:o,objectElementValidators:RT,validateSpec:g}),u;case"raster-dem":return u=U4({sourceName:t,value:e,style:i.style,styleSpec:o,validateSpec:g}),u;case"geojson":if(u=Bu({key:t,value:e,valueSpec:o.source_geojson,style:h,styleSpec:o,validateSpec:g,objectElementValidators:RT}),e.cluster)for(const R in e.clusterProperties){const[O,G]=e.clusterProperties[R],ne=typeof O=="string"?[O,["accumulated"],["get",R]]:O;u.push(...tm({key:`${t}.${R}.map`,value:G,expressionContext:"cluster-map"})),u.push(...tm({key:`${t}.${R}.reduce`,value:ne,expressionContext:"cluster-reduce"}))}return u;case"video":return Bu({key:t,value:e,valueSpec:o.source_video,style:h,validateSpec:g,styleSpec:o});case"image":return Bu({key:t,value:e,valueSpec:o.source_image,style:h,validateSpec:g,styleSpec:o});case"canvas":return[new Wt(t,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Mg({key:`${t}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function j4({key:i,value:e}){if(rr(e)==="string")return Np({key:i,value:e});{const t=[];for(const o in e)t.push(...Np({key:`${i}.${o}`,value:e[o]}));return t}}function qI(i){const e=i.value,t=i.styleSpec,o=t.light,h=i.style;let g=[];const _=rr(e);if(e===void 0)return g;if(_!=="object")return g=g.concat([new Wt("light",e,`object expected, ${_} found`)]),g;for(const u in e){const R=u.match(/^(.*)-transition$/);R&&o[R[1]]&&o[R[1]].transition?g=g.concat(i.validateSpec({key:u,value:e[u],valueSpec:t.transition,validateSpec:i.validateSpec,style:h,styleSpec:t})):o[u]?g=g.concat(i.validateSpec({key:u,value:e[u],valueSpec:o[u],validateSpec:i.validateSpec,style:h,styleSpec:t})):g=g.concat([new Wt(u,e[u],`unknown property "${u}"`)])}return g}function GI(i){const e=i.value,t=i.styleSpec,o=t.sky,h=i.style,g=rr(e);if(e===void 0)return[];if(g!=="object")return[new Wt("sky",e,`object expected, ${g} found`)];let _=[];for(const u in e)o[u]?_=_.concat(i.validateSpec({key:u,value:e[u],valueSpec:o[u],style:h,styleSpec:t})):_=_.concat([new Wt(u,e[u],`unknown property "${u}"`)]);return _}function ZI(i){const e=i.value,t=i.styleSpec,o=t.terrain,h=i.style;let g=[];const _=rr(e);if(e===void 0)return g;if(_!=="object")return g=g.concat([new Wt("terrain",e,`object expected, ${_} found`)]),g;for(const u in e)o[u]?g=g.concat(i.validateSpec({key:u,value:e[u],valueSpec:o[u],validateSpec:i.validateSpec,style:h,styleSpec:t})):g=g.concat([new Wt(u,e[u],`unknown property "${u}"`)]);return g}function $4(i){return Np(i).length===0?[]:tm(i)}function H4(i){return Np(i).length===0?[]:tm(i)}function q4(i){const e=i.key,t=i.value;if(rr(t)==="array"){if(t.length<1||t.length>4)return[new Wt(e,t,`padding requires 1 to 4 values; ${t.length} values found`)];const o={type:"number"};let h=[];for(let g=0;g<t.length;g++)h=h.concat(i.validateSpec({key:`${e}[${g}]`,value:t[g],validateSpec:i.validateSpec,valueSpec:o}));return h}else return Aw({key:e,value:t,valueSpec:{}})}function G4(i){const e=i.key,t=i.value,o=rr(t),h=i.styleSpec;if(o!=="array"||t.length<1||t.length%2!==0)return[new Wt(e,t,"variableAnchorOffsetCollection requires a non-empty array of even length")];let g=[];for(let _=0;_<t.length;_+=2)g=g.concat(Mg({key:`${e}[${_}]`,value:t[_],valueSpec:h.layout_symbol["text-anchor"]})),g=g.concat(Cw({key:`${e}[${_+1}]`,value:t[_+1],valueSpec:{length:2,value:"number"},validateSpec:i.validateSpec,style:i.style,styleSpec:h}));return g}function WI(i){let e=[];const t=i.value,o=i.key;if(Array.isArray(t)){const h=[],g=[];for(const _ in t){t[_].id&&h.includes(t[_].id)&&e.push(new Wt(o,t,`all the sprites' ids must be unique, but ${t[_].id} is duplicated`)),h.push(t[_].id),t[_].url&&g.includes(t[_].url)&&e.push(new Wt(o,t,`all the sprites' URLs must be unique, but ${t[_].url} is duplicated`)),g.push(t[_].url);const u={id:{type:"string",required:!0},url:{type:"string",required:!0}};e=e.concat(Bu({key:`${o}[${_}]`,value:t[_],valueSpec:u,validateSpec:i.validateSpec}))}return e}else return Np({key:o,value:t})}function Z4(i){const e=i.value,t=i.styleSpec,o=t.projection,h=i.style,g=rr(e);if(e===void 0)return[];if(g!=="object")return[new Wt("projection",e,`object expected, ${g} found`)];let _=[];for(const u in e)o[u]?_=_.concat(i.validateSpec({key:u,value:e[u],valueSpec:o[u],style:h,styleSpec:t})):_=_.concat([new Wt(u,e[u],`unknown property "${u}"`)]);return _}function W4(i){const e=i.key;let t=i.value;t=t instanceof String?t.valueOf():t;const o=rr(t);return o==="array"&&!X4(t)&&!K4(t)?[new Wt(e,t,`projection expected, invalid array ${JSON.stringify(t)} found`)]:["array","string"].includes(o)?[]:[new Wt(e,t,`projection expected, invalid type "${o}" found`)]}function K4(i){return!!["interpolate","step","literal"].includes(i[0])}function X4(i){return Array.isArray(i)&&i.length===3&&typeof i[0]=="string"&&typeof i[1]=="string"&&typeof i[2]=="number"}const LT={"*"(){return[]},array:Cw,boolean:B4,number:Aw,color:V4,constants:OI,enum:Mg,filter:kw,function:FI,layer:$I,object:Bu,source:HI,light:qI,sky:GI,terrain:ZI,projection:Z4,projectionDefinition:W4,string:Np,formatted:$4,resolvedImage:H4,padding:q4,variableAnchorOffsetCollection:G4,sprite:WI};function zy(i){const e=i.value,t=i.valueSpec,o=i.styleSpec;return i.validateSpec=zy,t.expression&&Pw(wo(e))?FI(i):t.expression&&DI(zp(e))?tm(i):t.type&&LT[t.type]?LT[t.type](i):Bu(Iy({},i,{valueSpec:t.type?o[t.type]:t}))}function KI(i){const e=i.value,t=i.key,o=Np(i);return o.length||(e.indexOf("{fontstack}")===-1&&o.push(new Wt(t,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&o.push(new Wt(t,e,'"glyphs" url must include a "{range}" token'))),o}function ju(i,e=C3){let t=[];return t=t.concat(zy({key:"",value:i,valueSpec:e.$root,styleSpec:e,style:i,validateSpec:zy,objectElementValidators:{glyphs:KI,"*"(){return[]}}})),i.constants&&(t=t.concat(OI({key:"constants",value:i.constants}))),XI(t)}ju.source=_h(gh(HI));ju.sprite=_h(gh(WI));ju.glyphs=_h(gh(KI));ju.light=_h(gh(qI));ju.sky=_h(gh(GI));ju.terrain=_h(gh(ZI));ju.layer=_h(gh($I));ju.filter=_h(gh(kw));ju.paintProperty=_h(gh(UI));ju.layoutProperty=_h(gh(jI));function gh(i){return function(e){return i({...e,validateSpec:zy})}}function XI(i){return[].concat(i).sort((e,t)=>e.line-t.line)}function _h(i){return function(...e){return XI(i.apply(this,e))}}function DT(i){if(!i)return{style:pg[dg[0].referenceStyleID].getDefaultVariant().getExpandedStyleURL(),requiresUrlMonitoring:!1,isFallback:!0};if(typeof i=="string"){const e=Q4(i);return e.isValidStyle?{style:e.styleObject,requiresUrlMonitoring:!1,isFallback:!1}:e.isValidJSON?{style:pg[dg[0].referenceStyleID].getDefaultVariant().getExpandedStyleURL(),requiresUrlMonitoring:!1,isFallback:!0}:i.startsWith("http")?{style:i,requiresUrlMonitoring:!0,isFallback:!1}:i.toLowerCase().includes(".json")?{style:Y4(i),requiresUrlMonitoring:!0,isFallback:!1}:{style:KE(i),requiresUrlMonitoring:!0,isFallback:!1}}return i instanceof XE?{style:i.getExpandedStyleURL(),requiresUrlMonitoring:!1,isFallback:!1}:i instanceof YE?{style:i.getDefaultVariant().getExpandedStyleURL(),requiresUrlMonitoring:!1,isFallback:!1}:ju(i).length===0?{style:i,requiresUrlMonitoring:!1,isFallback:!1}:{style:pg[dg[0].referenceStyleID].getDefaultVariant().getExpandedStyleURL(),requiresUrlMonitoring:!1,isFallback:!0}}function Y4(i){try{return new URL(i).href}catch{}return new URL(i,location.origin).href}function Q4(i){try{const e=JSON.parse(i),t=ju(e);return{isValidJSON:!0,isValidStyle:t.length===0,styleObject:t.length===0?e:null}}catch{return{isValidJSON:!1,isValidStyle:!1,styleObject:null}}}class J4{constructor(){hi(this,"_map"),hi(this,"_container"),hi(this,"_terrainButton"),EO(["_toggleTerrain","_updateTerrainIcon"],this)}onAdd(e){return this._map=e,this._container=Wh("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=Wh("button","maplibregl-ctrl-terrain",this._container),Wh("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){uw(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}_toggleTerrain(){this._map.hasTerrain()?this._map.disableTerrain():this._map.enableTerrain(),this._updateTerrainIcon()}_updateTerrainIcon(){this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.hasTerrain()?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))}}class eF extends OO{constructor(e={}){super({showCompass:e.showCompass??!0,showZoom:e.showZoom??!0,visualizePitch:e.visualizePitch??!0}),hi(this,"_rotateCompassArrow",()=>{const t=this._map.getBearing(),o=this._map.getPitch(),h=this.options.visualizePitch?`scale(${Math.min(1.5,1/Math.cos(o*(Math.PI/180))**.5)}) rotateX(${Math.min(70,o)}deg) rotateZ(${-t}deg)`:`rotate(${-t}deg)`;this._compassIcon.style.transform=h}),this._compass&&(this._compass.removeEventListener("click",this._compass.clickFunction),this._compass.addEventListener("click",t=>{this._map.getPitch()===0?this._map.easeTo({pitch:Math.min(this._map.getMaxPitch(),80)}):this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})}))}_createButton(e,t){const o=super._createButton(e,t);return o.clickFunction=t,o}}const zT=In.Marker,NT=In.LngLat,tF=In.LngLatBounds;class nF extends FO{constructor(){super(...arguments),hi(this,"lastUpdatedCenter",new NT(0,0)),hi(this,"_updateCamera",e=>{var t,o;const h=new NT(e.coords.longitude,e.coords.latitude),g=e.coords.accuracy,_={bearing:this._map.getBearing(),...this.options.fitBoundsOptions,linear:!0},u=this._map.getZoom();u>(((o=(t=this.options)==null?void 0:t.fitBoundsOptions)==null?void 0:o.maxZoom)??30)&&(_.zoom=u),this._map.fitBounds(tF.fromLngLat(h,g),_,{geolocateSource:!0});let R=!1;const O=()=>{R=!0};this._map.once("click",O),this._map.once("dblclick",O),this._map.once("dragstart",O),this._map.once("mousedown",O),this._map.once("touchstart",O),this._map.once("wheel",O),this._map.once("moveend",()=>{this._map.off("click",O),this._map.off("dblclick",O),this._map.off("dragstart",O),this._map.off("mousedown",O),this._map.off("touchstart",O),this._map.off("wheel",O),!R&&(this.lastUpdatedCenter=this._map.getCenter())})}),hi(this,"_finishSetupUI",e=>{if(this._map){if(e===!1){const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Wh("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new zT({element:this._dotElement}),this._circleElement=Wh("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new zT({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("move",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("moveend",t=>{const o=t.originalEvent&&t.originalEvent.type==="resize",h=this.lastUpdatedCenter.distanceTo(this._map.getCenter());!t.geolocateSource&&this._watchState==="ACTIVE_LOCK"&&!o&&h>1&&(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new Event("trackuserlocationend")))})}}),hi(this,"_onZoom",()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()})}_updateCircleRadius(){if(this._watchState!=="BACKGROUND"&&this._watchState!=="ACTIVE_LOCK")return;const e=[this._lastKnownPosition.coords.longitude,this._lastKnownPosition.coords.latitude],t=this._map.project(e),o=this._map.unproject([t.x,t.y]),h=this._map.unproject([t.x+20,t.y]),g=o.distanceTo(h)/20,_=Math.ceil(2*this._accuracy/g);this._circleElement.style.width=`${_}px`,this._circleElement.style.height=`${_}px`}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;case"BACKGROUND_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}}var mu,th,vp,xp,Nu,iy,al,YI,Ou,QI;class f0{constructor(e,t){gp(this,al),gp(this,mu),hi(this,"map"),gp(this,th),gp(this,vp),gp(this,xp),gp(this,Nu,!1),gp(this,iy),e.style!==void 0&&Df(this,Nu,!0),Df(this,mu,{zoomAdjust:-4,position:"top-right",...t,forceNoAttributionControl:!0,attributionControl:!1,navigationControl:!1,geolocateControl:!1,maptilerLogo:!1,minimap:!1,hash:!1,pitchAdjust:!1,...e,containerStyle:{border:"1px solid #000",width:"400px",height:"300px",...e.containerStyle??{}}}),e.lockZoom!==void 0&&(Bi(this,mu).minZoom=e.lockZoom,Bi(this,mu).maxZoom=e.lockZoom)}setStyle(e,t){Bi(this,Nu)||this.map.setStyle(e,t),fu(this,al,Ou).call(this)}addLayer(e,t){return Bi(this,Nu)||this.map.addLayer(e,t),fu(this,al,Ou).call(this),this.map}moveLayer(e,t){return Bi(this,Nu)||this.map.moveLayer(e,t),fu(this,al,Ou).call(this),this.map}removeLayer(e){return Bi(this,Nu)||this.map.removeLayer(e),fu(this,al,Ou).call(this),this}setLayerZoomRange(e,t,o){return Bi(this,Nu)||this.map.setLayerZoomRange(e,t,o),fu(this,al,Ou).call(this),this}setFilter(e,t,o){return Bi(this,Nu)||this.map.setFilter(e,t,o),fu(this,al,Ou).call(this),this}setPaintProperty(e,t,o,h){return Bi(this,Nu)||this.map.setPaintProperty(e,t,o,h),fu(this,al,Ou).call(this),this}setLayoutProperty(e,t,o,h){return Bi(this,Nu)||this.map.setLayoutProperty(e,t,o,h),fu(this,al,Ou).call(this),this}setGlyphs(e,t){return Bi(this,Nu)||this.map.setGlyphs(e,t),fu(this,al,Ou).call(this),this}onAdd(e){Df(this,th,e),Df(this,vp,Wh("div","maplibregl-ctrl maplibregl-ctrl-group"));for(const[t,o]of Object.entries(Bi(this,mu).containerStyle))Bi(this,vp).style.setProperty(t,o);return Bi(this,mu).container=Bi(this,vp),Bi(this,mu).zoom=e.getZoom()+Bi(this,mu).zoomAdjust,this.map=new JI(Bi(this,mu)),this.map.once("style.load",()=>{this.map.resize()}),this.map.once("load",()=>{fu(this,al,YI).call(this,Bi(this,mu).parentRect),Df(this,iy,fu(this,al,QI).call(this))}),Bi(this,vp)}onRemove(){var e;(e=Bi(this,iy))==null||e.call(this),uw(Bi(this,vp))}}mu=new WeakMap,th=new WeakMap,vp=new WeakMap,xp=new WeakMap,Nu=new WeakMap,iy=new WeakMap,al=new WeakSet,YI=function(i){i===void 0||i.linePaint===void 0&&i.fillPaint===void 0||(Df(this,xp,{type:"Feature",properties:{name:"parentRect"},geometry:{type:"Polygon",coordinates:[[[],[],[],[],[]]]}}),this.map.addSource("parentRect",{type:"geojson",data:Bi(this,xp)}),(i.lineLayout!==void 0||i.linePaint!==void 0)&&this.map.addLayer({id:"parentRectOutline",type:"line",source:"parentRect",layout:{...i.lineLayout},paint:{"line-color":"#FFF","line-width":1,"line-opacity":.85,...i.linePaint}}),i.fillPaint!==void 0&&this.map.addLayer({id:"parentRectFill",type:"fill",source:"parentRect",layout:{},paint:{"fill-color":"#08F","fill-opacity":.135,...i.fillPaint}}),fu(this,al,Ou).call(this))},Ou=function(){if(Bi(this,xp)===void 0)return;const{devicePixelRatio:i}=window,e=Bi(this,th).getCanvas(),t=e.width/i,o=e.height/i,h=Bi(this,th).unproject.bind(Bi(this,th)),g=h([0,0]),_=h([t,0]),u=h([0,o]),R=h([t,o]);Bi(this,xp).geometry.coordinates=[[u.toArray(),R.toArray(),_.toArray(),g.toArray(),u.toArray()]],this.map.getSource("parentRect").setData(Bi(this,xp))},QI=function(){const{pitchAdjust:i}=Bi(this,mu),e=()=>{g("parent")},t=()=>{g("minimap")},o=()=>{Bi(this,th).on("move",e),this.map.on("move",t)},h=()=>{Bi(this,th).off("move",e),this.map.off("move",t)},g=_=>{h();const u=_==="parent"?Bi(this,th):this.map,R=_==="parent"?this.map:Bi(this,th),O=u.getCenter(),G=u.getZoom()+Bi(this,mu).zoomAdjust*(_==="parent"?1:-1),ne=u.getBearing(),re=u.getPitch();R.jumpTo({center:O,zoom:G,bearing:ne,pitch:i?re:0}),fu(this,al,Ou).call(this),o()};return o(),()=>{h()}};class iF{constructor(){hi(this,"map"),hi(this,"container"),hi(this,"projectionButton")}onAdd(e){return this.map=e,this.container=Wh("div","maplibregl-ctrl maplibregl-ctrl-group"),this.projectionButton=Wh("button","maplibregl-ctrl-projection",this.container),Wh("span","maplibregl-ctrl-icon",this.projectionButton).setAttribute("aria-hidden","true"),this.projectionButton.type="button",this.projectionButton.addEventListener("click",this.toggleProjection.bind(this)),e.on("projectiontransition",this.updateProjectionIcon.bind(this)),this.updateProjectionIcon(),this.container}onRemove(){uw(this.container),this.map.off("projectiontransition",this.updateProjectionIcon),this.map=void 0}toggleProjection(){this.map.getProjection()===void 0&&this.map.setProjection({type:"mercator"}),this.map.isGlobeProjection()?this.map.enableMercatorProjection():this.map.enableGlobeProjection(),this.updateProjectionIcon()}updateProjectionIcon(){this.projectionButton.classList.remove("maplibregl-ctrl-projection-globe"),this.projectionButton.classList.remove("maplibregl-ctrl-projection-mercator"),this.map.isGlobeProjection()?(this.projectionButton.classList.add("maplibregl-ctrl-projection-mercator"),this.projectionButton.title="Enable Mercator projection"):(this.projectionButton.classList.add("maplibregl-ctrl-projection-globe"),this.projectionButton.title="Enable Globe projection")}}class rF{constructor(e,t=2e3){hi(this,"map"),hi(this,"registeredModules",new Set),this.map=e,setTimeout(async()=>{if(!xo.telemetry)return;const o=this.preparePayload();try{(await fetch(o,{method:"POST"})).ok||console.warn("The metrics could not be sent to MapTiler Cloud")}catch(h){console.warn("The metrics could not be sent to MapTiler Cloud",h)}},Math.max(1e3,t))}registerModule(e,t){this.registeredModules.add(`${e}:${t}`)}preparePayload(){const e=new URL(ll.telemetryURL);return e.searchParams.append("sdk",gO.version),e.searchParams.append("key",xo.apiKey),e.searchParams.append("mtsid",lw),e.searchParams.append("session",xo.session?"1":"0"),e.searchParams.append("caching",xo.caching?"1":"0"),e.searchParams.append("lang-updated",this.map.isLanguageUpdated()?"1":"0"),e.searchParams.append("terrain",this.map.getTerrain()?"1":"0"),e.searchParams.append("globe",this.map.isGlobeProjection()?"1":"0"),this.registeredModules.size>0&&e.searchParams.append("modules",Array.from(this.registeredModules).join("|")),e.href}}const oF={POINT:"POINT",COUNTRY:"COUNTRY"};class JI extends In.Map{constructor(e){CO(e.container),e.apiKey&&(xo.apiKey=e.apiKey);const{style:t,requiresUrlMonitoring:o,isFallback:h}=DT(e.style);h&&console.warn("Invalid style. A style must be a valid URL to a style.json, a JSON string representing a valid StyleSpecification or a valid StyleSpecification object. Fallback to default MapTiler style."),xo.apiKey||console.warn("MapTiler Cloud API key is not set. Visit https://maptiler.com and try Cloud for free!");const g=location.hash;let _={compact:!1};e.customAttribution?_.customAttribution=e.customAttribution:e.attributionControl&&typeof e.attributionControl=="object"&&(_={..._,...e.attributionControl});const u={...e,style:t,maplibreLogo:!1,transformRequest:hT(e.transformRequest),attributionControl:e.forceNoAttributionControl===!0?!1:_};delete u.style,super(u),hi(this,"telemetry"),hi(this,"isTerrainEnabled",!1),hi(this,"terrainExaggeration",1),hi(this,"primaryLanguage"),hi(this,"terrainGrowing",!1),hi(this,"terrainFlattening",!1),hi(this,"minimap"),hi(this,"forceLanguageUpdate"),hi(this,"languageAlwaysBeenStyle"),hi(this,"isReady",!1),hi(this,"terrainAnimationDuration",1e3),hi(this,"monitoredStyleUrls"),hi(this,"styleInProcess",!1),hi(this,"curentProjection"),hi(this,"originalLabelStyle",new window.Map),hi(this,"isStyleLocalized",!1),hi(this,"languageIsUpdated",!1),this.setStyle(t),o&&this.monitorStyleUrl(t);const R=()=>{let Q="The distant style could not be loaded.";this.getStyle()?Q+="Leaving the style as is.":(this.setStyle(pg.STREETS),Q+=`Loading default MapTiler Cloud style "${pg.STREETS.getDefaultVariant().getId()}" as a fallback.`),console.warn(Q)};if(this.on("style.load",()=>{this.styleInProcess=!1}),this.on("error",Q=>{if(Q.error instanceof In.AJAXError){const de=Q.error.url,Se=new URL(de);Se.search="";const De=Se.href;this.monitoredStyleUrls&&this.monitoredStyleUrls.has(De)&&(this.monitoredStyleUrls.delete(De),R());return}if(this.styleInProcess)return R()}),xo.caching&&!G0&&console.warn("The cache API is only available in secure contexts. More info at https://developer.mozilla.org/en-US/docs/Web/API/Cache"),xo.caching&&G0&&TO(),typeof e.language>"u")this.primaryLanguage=xo.primaryLanguage;else{const Q=Y1(e.language,Zi);this.primaryLanguage=Q??xo.primaryLanguage}this.forceLanguageUpdate=!(this.primaryLanguage===Zi.STYLE||this.primaryLanguage===Zi.STYLE_LOCK),this.languageAlwaysBeenStyle=this.primaryLanguage===Zi.STYLE,this.terrainExaggeration=e.terrainExaggeration??this.terrainExaggeration,this.curentProjection=e.projection,this.on("styledata",()=>{this.curentProjection==="mercator"?this.setProjection({type:"mercator"}):this.curentProjection==="globe"&&this.setProjection({type:"globe"})}),this.once("styledata",async()=>{if(!e.geolocate||e.center||e.hash&&g)return;try{if(e.geolocate===oF.COUNTRY){await this.fitToIpBounds();return}}catch(de){console.warn(de.message)}let Q;try{await this.centerOnIpPoint(e.zoom),Q=this.getCameraHash()}catch(de){console.warn(de.message)}(await navigator.permissions.query({name:"geolocation"})).state==="granted"&&navigator.geolocation.getCurrentPosition(de=>{Q===this.getCameraHash()&&(this.terrain?this.easeTo({center:[de.coords.longitude,de.coords.latitude],zoom:e.zoom||12,duration:2e3}):this.once("terrain",()=>{this.easeTo({center:[de.coords.longitude,de.coords.latitude],zoom:e.zoom||12,duration:2e3})}))},null,{maximumAge:24*3600*1e3,timeout:5e3,enableHighAccuracy:!1})}),this.on("styledata",()=>{this.setPrimaryLanguage(this.primaryLanguage)}),this.on("styledata",()=>{this.getTerrain()===null&&this.isTerrainEnabled&&this.enableTerrain(this.terrainExaggeration)}),this.once("load",async()=>{let Q={logo:null};try{const de=Object.keys(this.style.sourceCaches).map(De=>this.getSource(De)).filter(De=>De&&"url"in De&&typeof De.url=="string"&&De?.url.includes("tiles.json")),Se=new URL(de[0].url);Se.searchParams.has("key")||Se.searchParams.append("key",xo.apiKey),Q=await(await fetch(Se.href)).json()}catch{}if(e.forceNoAttributionControl!==!0)if("logo"in Q&&Q.logo){const de=Q.logo;this.addControl(new pT({logoURL:de}),e.logoPosition)}else e.maptilerLogo&&this.addControl(new pT,e.logoPosition);if(e.scaleControl){const de=e.scaleControl===!0||e.scaleControl===void 0?"bottom-right":e.scaleControl,Se=new VO({unit:xo.unit});this.addControl(Se,de),xo.on("unit",De=>{Se.setUnit(De)})}if(e.navigationControl!==!1){const de=e.navigationControl===!0||e.navigationControl===void 0?"top-right":e.navigationControl;this.addControl(new eF,de)}if(e.geolocateControl!==!1){const de=e.geolocateControl===!0||e.geolocateControl===void 0?"top-right":e.geolocateControl;this.addControl(new nF({positionOptions:{enableHighAccuracy:!0,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!0,showAccuracyCircle:!0,showUserLocation:!0}),de)}if(e.terrainControl){const de=e.terrainControl===!0||e.terrainControl===void 0?"top-right":e.terrainControl;this.addControl(new J4,de)}if(e.projectionControl){const de=e.projectionControl===!0||e.projectionControl===void 0?"top-right":e.projectionControl;this.addControl(new iF,de)}if(e.fullscreenControl){const de=e.fullscreenControl===!0||e.fullscreenControl===void 0?"top-right":e.fullscreenControl;this.addControl(new UO({}),de)}this.isReady=!0,this.fire("ready",{target:this})});let O=!1,G=!1,ne;this.once("ready",()=>{O=!0,G&&this.fire("loadWithTerrain",ne)}),this.once("style.load",()=>{const{minimap:Q}=e;if(typeof Q=="object"){const{zoom:de,center:Se,style:De,language:Ke,apiKey:et,maptilerLogo:vt,canvasContextAttributes:Ye,refreshExpiredTiles:it,maxBounds:at,scrollZoom:be,minZoom:te,maxZoom:pe,boxZoom:xe,locale:Ae,fadeDuration:$e,crossSourceCollisions:Ce,clickTolerance:pn,bounds:ri,fitBoundsOptions:dn,pixelRatio:jn,validateStyle:Tt}=e;this.minimap=new f0(Q,{zoom:de,center:Se,style:De,language:Ke,apiKey:et,container:"null",maptilerLogo:vt,canvasContextAttributes:Ye,refreshExpiredTiles:it,maxBounds:at,scrollZoom:be,minZoom:te,maxZoom:pe,boxZoom:xe,locale:Ae,fadeDuration:$e,crossSourceCollisions:Ce,clickTolerance:pn,bounds:ri,fitBoundsOptions:dn,pixelRatio:jn,validateStyle:Tt}),this.addControl(this.minimap,Q.position??"bottom-left")}else Q===!0?(this.minimap=new f0({},e),this.addControl(this.minimap,"bottom-left")):Q!==void 0&&Q!==!1&&(this.minimap=new f0({},e),this.addControl(this.minimap,Q))});const re=Q=>{Q.terrain&&(G=!0,ne={type:"loadWithTerrain",target:this,terrain:Q.terrain},this.off("terrain",re),O&&this.fire("loadWithTerrain",ne))};this.on("terrain",re),e.terrain&&this.enableTerrain(e.terrainExaggeration??this.terrainExaggeration),this.once("load",()=>{this.getCanvas().addEventListener("webglcontextlost",Q=>{console.warn(Q),AO(e.container),this.fire("webglContextLost",{error:Q})})}),this.telemetry=new rF(this)}setTerrainAnimationDuration(e){this.terrainAnimationDuration=Math.max(e,0)}async onLoadAsync(){return new Promise(e=>{if(this.loaded())return e(this);this.once("load",()=>{e(this)})})}async onReadyAsync(){return new Promise(e=>{if(this.isReady)return e(this);this.once("ready",()=>{e(this)})})}async onLoadWithTerrainAsync(){return new Promise(e=>{if(this.isReady&&this.terrain)return e(this);this.once("loadWithTerrain",()=>{e(this)})})}monitorStyleUrl(e){typeof this.monitoredStyleUrls>"u"&&(this.monitoredStyleUrls=new Set);const t=new URL(e);t.search="",this.monitoredStyleUrls.add(t.href)}setStyle(e,t){var o;this.originalLabelStyle.clear(),(o=this.minimap)==null||o.setStyle(e),this.forceLanguageUpdate=!0,this.once("idle",()=>{this.forceLanguageUpdate=!1});const h=DT(e);if(h.requiresUrlMonitoring&&this.monitorStyleUrl(h.style),h.isFallback){if(this.getStyle())return console.warn("Invalid style. A style must be a valid URL to a style.json, a JSON string representing a valid StyleSpecification or a valid StyleSpecification object. Keeping the curent style instead."),this;console.warn("Invalid style. A style must be a valid URL to a style.json, a JSON string representing a valid StyleSpecification or a valid StyleSpecification object. Fallback to default MapTiler style.")}return this.styleInProcess=!0,super.setStyle(h.style,t),this}addLayer(e,t){var o;return(o=this.minimap)==null||o.addLayer(e,t),super.addLayer(e,t)}moveLayer(e,t){var o;return(o=this.minimap)==null||o.moveLayer(e,t),super.moveLayer(e,t)}removeLayer(e){var t;return(t=this.minimap)==null||t.removeLayer(e),super.removeLayer(e)}setLayerZoomRange(e,t,o){var h;return(h=this.minimap)==null||h.setLayerZoomRange(e,t,o),super.setLayerZoomRange(e,t,o)}setFilter(e,t,o){var h;return(h=this.minimap)==null||h.setFilter(e,t,o),super.setFilter(e,t,o)}setPaintProperty(e,t,o,h){var g;return(g=this.minimap)==null||g.setPaintProperty(e,t,o,h),super.setPaintProperty(e,t,o,h)}setLayoutProperty(e,t,o,h){var g;return(g=this.minimap)==null||g.setLayoutProperty(e,t,o,h),super.setLayoutProperty(e,t,o,h)}setGlyphs(e,t){var o;return(o=this.minimap)==null||o.setGlyphs(e,t),super.setGlyphs(e,t)}getStyleLanguage(){return!this.style||!this.style.stylesheet||!this.style.stylesheet.metadata||typeof this.style.stylesheet.metadata!="object"?null:"maptiler:language"in this.style.stylesheet.metadata&&typeof this.style.stylesheet.metadata["maptiler:language"]=="string"?U0(this.style.stylesheet.metadata["maptiler:language"]):null}setLanguage(e){var t,o;(o=(t=this.minimap)==null?void 0:t.map)==null||o.setLanguage(e),this.onStyleReady(()=>{this.setPrimaryLanguage(e)})}setPrimaryLanguage(e){const t=this.getStyleLanguage(),o=Y1(e,Zi);if(!o){console.warn(`The language "${o}" is not supported.`);return}if(!(o.flag===Zi.STYLE.flag&&t&&(t.flag===Zi.AUTO.flag||t.flag===Zi.VISITOR.flag))&&(o.flag!==Zi.STYLE.flag&&(this.languageAlwaysBeenStyle=!1),this.languageAlwaysBeenStyle||this.primaryLanguage===o&&!this.forceLanguageUpdate))return;if(this.primaryLanguage.flag===Zi.STYLE_LOCK.flag){console.warn("The language cannot be changed because this map has been instantiated with the STYLE_LOCK language flag.");return}this.primaryLanguage=o;let h=o;if(o.flag===Zi.STYLE.flag){if(!t){console.warn("The style has no default languages or has an invalid one.");return}h=t}let g=Zi.LOCAL.flag,_=["get",g];h.flag===Zi.VISITOR.flag?(g=aT().flag,_=["case",["all",["has",g],["has",Zi.LOCAL.flag]],["case",["==",["get",g],["get",Zi.LOCAL.flag]],["get",Zi.LOCAL.flag],["format",["get",g],{"font-scale":.8},`
`,["get",Zi.LOCAL.flag],{"font-scale":1.1}]],["get",Zi.LOCAL.flag]]):h.flag===Zi.VISITOR_ENGLISH.flag?(g=Zi.ENGLISH.flag,_=["case",["all",["has",g],["has",Zi.LOCAL.flag]],["case",["==",["get",g],["get",Zi.LOCAL.flag]],["get",Zi.LOCAL.flag],["format",["get",g],{"font-scale":.8},`
`,["get",Zi.LOCAL.flag],{"font-scale":1.1}]],["get",Zi.LOCAL.flag]]):h.flag===Zi.AUTO.flag?(g=aT().flag,_=["coalesce",["get",g],["get",Zi.LOCAL.flag]]):h===Zi.LOCAL?(g=Zi.LOCAL.flag,_=["get",g]):(g=h.flag,_=["coalesce",["get",g],["get",Zi.LOCAL.flag]]);const{layers:u}=this.getStyle(),R=this.originalLabelStyle.size===0;if(R){const O=NO(u,this);this.isStyleLocalized=Object.keys(O.localized).length>0}for(const O of u){if(O.type!=="symbol")continue;const G=O,ne=this.getSource(G.source);if(!ne||!("url"in ne&&typeof ne.url=="string")||new URL(ne.url).host!==ll.maptilerApiHost)continue;const{id:re,layout:Q}=G;if(!Q||!("text-field"in Q))continue;let de;if(R?(de=this.getLayoutProperty(re,"text-field"),this.originalLabelStyle.set(re,de)):de=this.originalLabelStyle.get(re),typeof de=="string"){const{contains:Se,exactMatch:De}=MO(de,this.isStyleLocalized);if(!Se)continue;if(De)this.setLayoutProperty(re,"text-field",_);else{const Ke=RO(de,_,this.isStyleLocalized);this.setLayoutProperty(re,"text-field",Ke)}}else{const Se=kO(de,_,this.isStyleLocalized);this.setLayoutProperty(re,"text-field",Se)}}this.languageIsUpdated=!0}getPrimaryLanguage(){return this.primaryLanguage}getTerrainExaggeration(){return this.terrainExaggeration}hasTerrain(){return this.isTerrainEnabled}growTerrain(e){if(!this.terrain)return;const t=performance.now(),o=this.terrain.exaggeration,h=e-o,g=()=>{if(!this.terrain||this.terrainFlattening)return;const _=(performance.now()-t)/this.terrainAnimationDuration;if(_<.99){const u=1-(1-_)**4,R=o+u*h;this.terrain.exaggeration=R,requestAnimationFrame(g)}else this.terrainGrowing=!1,this.terrainFlattening=!1,this.terrain.exaggeration=e,this.fire("terrainAnimationStop",{terrain:this.terrain});this._elevationFreeze=!1,this.triggerRepaint()};!this.terrainGrowing&&!this.terrainFlattening&&this.fire("terrainAnimationStart",{terrain:this.terrain}),this.terrainGrowing=!0,this.terrainFlattening=!1,requestAnimationFrame(g)}enableTerrain(e=this.terrainExaggeration){if(e<0){console.warn("Terrain exaggeration cannot be negative.");return}const t=async h=>{!this.terrain||h.type!=="data"||h.dataType!=="source"||!("source"in h)||h.sourceId!=="maptiler-terrain"||h.source.type!=="raster-dem"||h.isSourceLoaded&&(this.off("data",t),this.growTerrain(e))},o=()=>{this.isTerrainEnabled=!0,this.terrainExaggeration=e,this.on("data",t),this.addSource(ll.terrainSourceId,{type:"raster-dem",url:ll.terrainSourceURL}),this.setTerrain({source:ll.terrainSourceId,exaggeration:0})};if(this.getTerrain()){this.isTerrainEnabled=!0,this.growTerrain(e);return}this.loaded()||this.isTerrainEnabled?o():this.once("load",()=>{this.getTerrain()&&this.getSource(ll.terrainSourceId)||o()})}disableTerrain(){if(!this.terrain)return;this.isTerrainEnabled=!1;const e=performance.now(),t=this.terrain.exaggeration,o=()=>{if(!this.terrain||this.terrainGrowing)return;const h=(performance.now()-e)/this.terrainAnimationDuration;if(this._elevationFreeze=!1,h<.99){const g=(1-h)**4,_=t*g;this.terrain.exaggeration=_,requestAnimationFrame(o)}else this.terrain.exaggeration=0,this.terrainGrowing=!1,this.terrainFlattening=!1,this.setTerrain(),this.getSource(ll.terrainSourceId)&&this.removeSource(ll.terrainSourceId),this.fire("terrainAnimationStop",{terrain:null});this.triggerRepaint()};!this.terrainGrowing&&!this.terrainFlattening&&this.fire("terrainAnimationStart",{terrain:this.terrain}),this.terrainGrowing=!1,this.terrainFlattening=!0,requestAnimationFrame(o)}setTerrainExaggeration(e,t=!0){!t&&this.terrain?(this.terrainExaggeration=e,this.terrain.exaggeration=e,this.triggerRepaint()):this.enableTerrain(e)}onStyleReady(e){this.isStyleLoaded()?e():this.once("styledata",()=>{e()})}async fitToIpBounds(){const e=await J1.info();this.fitBounds(e.country_bounds,{duration:0,padding:100})}async centerOnIpPoint(e){const t=await J1.info();this.jumpTo({center:[t?.longitude??0,t?.latitude??0],zoom:e||11})}getCameraHash(){const e=new Float32Array(5),t=this.getCenter();return e[0]=t.lng,e[1]=t.lat,e[2]=this.getZoom(),e[3]=this.getPitch(),e[4]=this.getBearing(),dO.fromUint8Array(new Uint8Array(e.buffer))}getSdkConfig(){return xo}getMaptilerSessionId(){return lw}setTransformRequest(e){return super.setTransformRequest(hT(e)),this}isGlobeProjection(){const e=this.getProjection();return e?.type==="globe"}enableGlobeProjection(){this.isGlobeProjection()!==!0&&(this.setProjection({type:"globe"}),this.curentProjection="globe")}enableMercatorProjection(){this.isGlobeProjection()!==!1&&(this.setProjection({type:"mercator"}),this.curentProjection="mercator")}isLanguageUpdated(){return this.languageIsUpdated}}function Mw(i){if(typeof DOMParser<"u"){const e=new DOMParser().parseFromString(i,"application/xml");if(e.querySelector("parsererror"))throw new Error("The provided string is not valid XML");return e}throw new Error("No XML parser found")}function eP(i,e){if(!i.hasChildNodes())return!1;for(const t of Array.from(i.childNodes)){const o=t.nodeName;if(typeof o=="string"&&o.trim().toLowerCase()===e.toLowerCase())return!0}return!1}function OT(i){if(typeof XMLSerializer<"u")return new XMLSerializer().serializeToString(i);throw new Error("No XML serializer found")}function tP(i){const e=typeof i=="string"?Mw(i):i;if(!eP(e,"gpx"))throw new Error("The XML document is not valid GPX");const t=$s(e,"trk"),o=$s(e,"rte"),h=$s(e,"wpt"),g={type:"FeatureCollection",features:[]};for(const _ of Array.from(t)){const u=uF(_);u&&g.features.push(u)}for(const _ of Array.from(o)){const u=cF(_);u&&g.features.push(u)}for(const _ of Array.from(h))g.features.push(hF(_));return g}function nP(i,e){let t=i;if(typeof t=="string"&&(t=Mw(t)),!eP(t,"kml"))throw new Error("The XML document is not valid KML");const o={type:"FeatureCollection",features:[]},h={},g={},_={},u=$s(t,"Placemark"),R=$s(t,"Style"),O=$s(t,"StyleMap");for(const G of Array.from(R)){const ne=BT(OT(G)).toString(16);h[`#${Ap(G,"id")}`]=ne,g[ne]=G}for(const G of Array.from(O)){h[`#${Ap(G,"id")}`]=BT(OT(G)).toString(16);const ne=$s(G,"Pair"),re={};for(const Q of Array.from(ne))re[dr(Yn(Q,"key"))??""]=dr(Yn(Q,"styleUrl"));_[`#${Ap(G,"id")}`]=re}for(const G of Array.from(u))o.features=o.features.concat(lF(G,h,g,_));return o}function FT(i){if(i===null)return["#000000",1];let e="",t=1,o=i;return o.substring(0,1)==="#"&&(o=o.substring(1)),(o.length===6||o.length===3)&&(e=o),o.length===8&&(t=Number.parseInt(o.substring(0,2),16)/255,e=`#${o.substring(6,8)}${o.substring(4,6)}${o.substring(2,4)}`),[e??"#000000",t??1]}function sF(i){return oP(i.split(" "))}function aF(i){let e=$s(i,"coord");const t=[],o=[];e.length===0&&(e=$s(i,"gx:coord"));for(const g of Array.from(e))t.push(sF(dr(g)??""));const h=$s(i,"when");for(const g of Array.from(h))o.push(dr(g));return{coords:t,times:o}}function ry(i){const e=["Polygon","LineString","Point","Track","gx:Track"];let t,o,h,g,_;const u=[],R=[];if(Yn(i,"MultiGeometry")!==null)return ry(Yn(i,"MultiGeometry"));if(Yn(i,"MultiTrack")!==null)return ry(Yn(i,"MultiTrack"));if(Yn(i,"gx:MultiTrack")!==null)return ry(Yn(i,"gx:MultiTrack"));for(h=0;h<e.length;h++)if(o=$s(i,e[h]),o){for(g=0;g<o.length;g++)if(t=o[g],e[h]==="Point")u.push({type:"Point",coordinates:sP(dr(Yn(t,"coordinates"))??"")});else if(e[h]==="LineString")u.push({type:"LineString",coordinates:UT(dr(Yn(t,"coordinates"))??"")});else if(e[h]==="Polygon"){const O=$s(t,"LinearRing"),G=[];for(_=0;_<O.length;_++)G.push(UT(dr(Yn(O[_],"coordinates"))??""));u.push({type:"Polygon",coordinates:G})}else if(e[h]==="Track"||e[h]==="gx:Track"){const O=aF(t);u.push({type:"LineString",coordinates:O.coords}),O.times.length&&R.push(O.times)}}return{geoms:u,coordTimes:R}}function lF(i,e,t,o){const h=ry(i),g={},_=dr(Yn(i,"name")),u=dr(Yn(i,"address")),R=dr(Yn(i,"description")),O=Yn(i,"TimeSpan"),G=Yn(i,"TimeStamp"),ne=Yn(i,"ExtendedData"),re=Yn(i,"visibility");let Q,de=dr(Yn(i,"styleUrl")),Se=Yn(i,"LineStyle"),De=Yn(i,"PolyStyle");if(!h.geoms.length)return[];if(_&&(g.name=_),u&&(g.address=u),de){de[0]!=="#"&&(de=`#${de}`),g.styleUrl=de,e[de]&&(g.styleHash=e[de]),o[de]&&(g.styleMapHash=o[de],g.styleHash=e[o[de].normal??""]);const et=t[g.styleHash??""];if(et){Se||(Se=Yn(et,"LineStyle")),De||(De=Yn(et,"PolyStyle"));const vt=Yn(et,"IconStyle");if(vt){const Ye=Yn(vt,"Icon");if(Ye){const it=dr(Yn(Ye,"href"));it&&(g.icon=it)}}}}if(R&&(g.description=R),O){const et=dr(Yn(O,"begin")),vt=dr(Yn(O,"end"));et&&vt&&(g.timespan={begin:et,end:vt})}if(G!==null&&(g.timestamp=dr(Yn(G,"when"))??new Date().toISOString()),Se!==null){const et=FT(dr(Yn(Se,"color"))),vt=et[0],Ye=et[1],it=Number.parseFloat(dr(Yn(Se,"width"))??"");vt&&(g.stroke=vt),Number.isNaN(Ye)||(g["stroke-opacity"]=Ye),Number.isNaN(it)||(g["stroke-width"]=it)}if(De){const et=FT(dr(Yn(De,"color"))),vt=et[0],Ye=et[1],it=dr(Yn(De,"fill")),at=dr(Yn(De,"outline"));vt&&(g.fill=vt),Number.isNaN(Ye)||(g["fill-opacity"]=Ye),it&&(g["fill-opacity"]=it==="1"?g["fill-opacity"]||1:0),at&&(g["stroke-opacity"]=at==="1"?g["stroke-opacity"]||1:0)}if(ne){const et=$s(ne,"Data"),vt=$s(ne,"SimpleData");for(Q=0;Q<et.length;Q++)g[et[Q].getAttribute("name")??""]=dr(Yn(et[Q],"value"))??"";for(Q=0;Q<vt.length;Q++)g[vt[Q].getAttribute("name")??""]=dr(vt[Q])??""}re!==null&&(g.visibility=dr(re)??""),h.coordTimes.length!==0&&(g.coordTimes=h.coordTimes.length===1?h.coordTimes[0]:h.coordTimes);const Ke={type:"Feature",geometry:h.geoms.length===1?h.geoms[0]:{type:"GeometryCollection",geometries:h.geoms},properties:g};return Ap(i,"id")&&(Ke.id=Ap(i,"id")??void 0),[Ke]}function iP(i,e){const t=$s(i,e),o=[],h=[];let g=[];const _=t.length;if(!(_<2)){for(let u=0;u<_;u++){const R=aP(t[u]);o.push(R.coordinates),R.time&&h.push(R.time),(R.heartRate||g.length)&&(g.length===0&&(g=new Array(u).fill(null)),g.push(R.heartRate))}return{line:o,times:h,heartRates:g}}}function uF(i){const e=$s(i,"trkseg"),t=[],o=[],h=[];let g;for(let u=0;u<e.length;u++)if(g=iP(e[u],"trkpt"),g!==void 0&&(g.line&&t.push(g.line),g.times&&g.times.length&&o.push(g.times),h.length||g.heartRates&&g.heartRates.length)){if(!h.length)for(let R=0;R<u;R++)h.push(new Array(t[R].length).fill(null));g.heartRates&&g.heartRates.length?h.push(g.heartRates):h.push(new Array(g.line.length).fill(null))}if(t.length===0)return;const _={...Rw(i),...rP(Yn(i,"extensions"))};return o.length!==0&&(_.coordTimes=t.length===1?o[0]:o),h.length!==0&&(_.heartRates=t.length===1?h[0]:h),t.length===1?{type:"Feature",properties:_,geometry:{type:"LineString",coordinates:t[0]}}:{type:"Feature",properties:_,geometry:{type:"MultiLineString",coordinates:t}}}function cF(i){const e=iP(i,"rtept");return e===void 0?void 0:{type:"Feature",properties:{...Rw(i),...rP(Yn(i,"extensions"))},geometry:{type:"LineString",coordinates:e.line}}}function hF(i){return{type:"Feature",properties:{...Rw(i),...ex(i,["sym"])},geometry:{type:"Point",coordinates:aP(i).coordinates}}}function rP(i){const e={};if(i){const t=Yn(i,"line");if(t){const o=dr(Yn(t,"color")),h=Number.parseFloat(dr(Yn(t,"opacity"))??"0"),g=Number.parseFloat(dr(Yn(t,"width"))??"0");o&&(e.stroke=o),Number.isNaN(h)||(e["stroke-opacity"]=h),Number.isNaN(g)||(e["stroke-width"]=g*96/25.4)}}return e}function Rw(i){const e=ex(i,["name","cmt","desc","type","time","keywords"]),t=$s(i,"link");if(t.length!==0){e.links=[];for(const o of Array.from(t)){const h={href:Ap(o,"href"),...ex(o,["text","type"])};e.links.push(h)}}return e}function BT(i){let e=0;if(!i||!i.length)return e;for(let t=0;t<i.length;t++)e=(e<<5)-e+i.charCodeAt(t)|0;return e}function $s(i,e){return i.getElementsByTagName(e)}function Ap(i,e){return i.getAttribute(e)}function VT(i,e){return Number.parseFloat(Ap(i,e)??"0")}function Yn(i,e){const t=$s(i,e);return t.length?t[0]:null}function dF(i){return i.normalize&&i.normalize(),i}function oP(i){return i.map(Number.parseFloat).map(e=>Number.isNaN(e)?null:e)}function dr(i){return i&&dF(i),i&&i.textContent}function ex(i,e){const t={};let o,h;for(h=0;h<e.length;h++)o=Yn(i,e[h]),o&&(t[e[h]]=dr(o)??"");return t}function sP(i){return oP(i.replace(/\s*/g,"").split(","))}function UT(i){const e=i.replace(/^\s*|\s*$/g,"").split(/\s+/),t=[];for(const o of e)t.push(sP(o));return t}function aP(i){const e=[VT(i,"lon"),VT(i,"lat")],t=Yn(i,"ele"),o=Yn(i,"gpxtpx:hr")||Yn(i,"hr"),h=Yn(i,"time");let g;return t&&(g=Number.parseFloat(dr(t)??"0"),Number.isNaN(g)||e.push(g)),{coordinates:e,time:h?dr(h):null,heartRate:o!==null?Number.parseFloat(dr(o)??"0"):null}}function pF(i){let e=i;try{typeof e=="string"&&(e=Mw(e))}catch{return null}try{return tP(e)}catch{}try{return nP(e)}catch{}return null}function U_(i){const e=i.toString(16);return e.length===1?`0${e}`:e}function fF(i){return`#${U_(i[0])}${U_(i[1])}${U_(i[2])}${i.length===4?U_(i[3]):""}`}class Ln extends Array{constructor(e={}){super(),hi(this,"min",0),hi(this,"max",1),"min"in e&&(this.min=e.min),"max"in e&&(this.max=e.max),"stops"in e&&this.setStops(e.stops,{clone:!1})}static fromArrayDefinition(e){return new Ln({stops:e.map(t=>({value:t[0],color:t[1]}))})}setStops(e,t={clone:!0}){const o=t.clone?this.clone():this;o.length=0;let h=Number.POSITIVE_INFINITY,g=Number.NEGATIVE_INFINITY;for(let _=0;_<e.length;_+=1)h=Math.min(h,e[_].value),g=Math.max(g,e[_].value),o.push({value:e[_].value,color:e[_].color.slice()});return o.sort((_,u)=>_.value<u.value?-1:1),this.min=h,this.max=g,o}scale(e,t,o={clone:!0}){const h=o.clone,g=this[0].value,_=this.at(-1).value-g,u=t-e,R=[];for(let O=0;O<this.length;O+=1){const G=(this[O].value-g)/_*u+e;h?R.push({value:G,color:this[O].color.slice()}):this[O].value=G}return h?new Ln({stops:R}):this}at(e){return e<0?this[this.length+e]:this[e]}clone(){return new Ln({stops:this.getRawColorStops()})}getRawColorStops(){const e=[];for(let t=0;t<this.length;t+=1)e.push({value:this[t].value,color:this[t].color});return e}reverse(e={clone:!0}){const t=e.clone?this.clone():this;for(let o=0;o<~~(t.length/2);o+=1){const h=t[o].color;t[o].color=t.at(-(o+1)).color,t.at(-(o+1)).color=h}return t}getBounds(){return{min:this.min,max:this.max}}getColor(e,t={smooth:!0}){if(e<=this[0].value)return this[0].color;if(e>=this.at(-1).value)return this.at(-1).color;for(let o=0;o<this.length-1;o+=1){if(e>this[o+1].value)continue;const h=this[o].color;if(!t.smooth)return h.slice();const g=this[o].value,_=this[o+1].value,u=this[o+1].color,R=(_-e)/(_-g);return h.map((O,G)=>Math.round(O*R+u[G]*(1-R)))}return[0,0,0]}getColorHex(e,t={smooth:!0,withAlpha:!1}){return fF(this.getColor(e,t))}getColorRelative(e,t={smooth:!0}){const o=this.getBounds();return this.getColor(o.min+e*(o.max-o.min),t)}getCanvasStrip(e={horizontal:!0,size:512,smooth:!0}){const t=document.createElement("canvas");t.width=e.horizontal?e.size:1,t.height=e.horizontal?1:e.size;const o=t.getContext("2d");if(!o)throw new Error("Canvs context is missing");const h=o.getImageData(0,0,t.width,t.height),g=h.data,_=e.size,u=this[0].value,R=(this.at(-1).value-u)/_;for(let O=0;O<_;O+=1){const G=this.getColor(u+O*R,{smooth:e.smooth});g[O*4]=G[0],g[O*4+1]=G[1],g[O*4+2]=G[2],g[O*4+3]=G.length>3?G[3]:255}return o.putImageData(h,0,0),t}resample(e,t=15){const o=this.getBounds(),h=this.scale(0,1),g=1/(t-1);let _;if(e==="ease-in-square")_=Array.from({length:t},(u,R)=>{const O=R*g,G=O**2,ne=h.getColor(G);return{value:O,color:ne}});else if(e==="ease-out-square")_=Array.from({length:t},(u,R)=>{const O=R*g,G=1-(1-O)**2,ne=h.getColor(G);return{value:O,color:ne}});else if(e==="ease-out-sqrt")_=Array.from({length:t},(u,R)=>{const O=R*g,G=O**.5,ne=h.getColor(G);return{value:O,color:ne}});else if(e==="ease-in-sqrt")_=Array.from({length:t},(u,R)=>{const O=R*g,G=1-(1-O)**.5,ne=h.getColor(G);return{value:O,color:ne}});else if(e==="ease-out-exp")_=Array.from({length:t},(u,R)=>{const O=R*g,G=1-2**(-10*O),ne=h.getColor(G);return{value:O,color:ne}});else if(e==="ease-in-exp")_=Array.from({length:t},(u,R)=>{const O=R*g,G=2**(10*O-10),ne=h.getColor(G);return{value:O,color:ne}});else throw new Error("Invalid ressampling method.");return new Ln({stops:_}).scale(o.min,o.max)}transparentStart(){const e=this.getRawColorStops();e.unshift({value:e[0].value,color:e[0].color.slice()}),e[1].value+=.001;for(const t of e)t.color.length===3&&t.color.push(255);return e[0].color[3]=0,new Ln({stops:e})}hasTransparentStart(){return this[0].color.length===4&&this[0].color[3]===0}}const lP={NULL:new Ln({stops:[{value:0,color:[0,0,0,0]},{value:1,color:[0,0,0,0]}]}),GRAY:new Ln({stops:[{value:0,color:[0,0,0]},{value:1,color:[255,255,255]}]}),JET:new Ln({stops:[{value:0,color:[0,0,131]},{value:.125,color:[0,60,170]},{value:.375,color:[5,255,255]},{value:.625,color:[255,255,0]},{value:.875,color:[250,0,0]},{value:1,color:[128,0,0]}]}),HSV:new Ln({stops:[{value:0,color:[255,0,0]},{value:.169,color:[253,255,2]},{value:.173,color:[247,255,2]},{value:.337,color:[0,252,4]},{value:.341,color:[0,252,10]},{value:.506,color:[1,249,255]},{value:.671,color:[2,0,253]},{value:.675,color:[8,0,253]},{value:.839,color:[255,0,251]},{value:.843,color:[255,0,245]},{value:1,color:[255,0,6]}]}),HOT:new Ln({stops:[{value:0,color:[0,0,0]},{value:.3,color:[230,0,0]},{value:.6,color:[255,210,0]},{value:1,color:[255,255,255]}]}),SPRING:new Ln({stops:[{value:0,color:[255,0,255]},{value:1,color:[255,255,0]}]}),SUMMER:new Ln({stops:[{value:0,color:[0,128,102]},{value:1,color:[255,255,102]}]}),AUTOMN:new Ln({stops:[{value:0,color:[255,0,0]},{value:1,color:[255,255,0]}]}),WINTER:new Ln({stops:[{value:0,color:[0,0,255]},{value:1,color:[0,255,128]}]}),BONE:new Ln({stops:[{value:0,color:[0,0,0]},{value:.376,color:[84,84,116]},{value:.753,color:[169,200,200]},{value:1,color:[255,255,255]}]}),COPPER:new Ln({stops:[{value:0,color:[0,0,0]},{value:.804,color:[255,160,102]},{value:1,color:[255,199,127]}]}),GREYS:new Ln({stops:[{value:0,color:[0,0,0]},{value:1,color:[255,255,255]}]}),YIGNBU:new Ln({stops:[{value:0,color:[8,29,88]},{value:.125,color:[37,52,148]},{value:.25,color:[34,94,168]},{value:.375,color:[29,145,192]},{value:.5,color:[65,182,196]},{value:.625,color:[127,205,187]},{value:.75,color:[199,233,180]},{value:.875,color:[237,248,217]},{value:1,color:[255,255,217]}]}),GREENS:new Ln({stops:[{value:0,color:[0,68,27]},{value:.125,color:[0,109,44]},{value:.25,color:[35,139,69]},{value:.375,color:[65,171,93]},{value:.5,color:[116,196,118]},{value:.625,color:[161,217,155]},{value:.75,color:[199,233,192]},{value:.875,color:[229,245,224]},{value:1,color:[247,252,245]}]}),YIORRD:new Ln({stops:[{value:0,color:[128,0,38]},{value:.125,color:[189,0,38]},{value:.25,color:[227,26,28]},{value:.375,color:[252,78,42]},{value:.5,color:[253,141,60]},{value:.625,color:[254,178,76]},{value:.75,color:[254,217,118]},{value:.875,color:[255,237,160]},{value:1,color:[255,255,204]}]}),BLUERED:new Ln({stops:[{value:0,color:[0,0,255]},{value:1,color:[255,0,0]}]}),RDBU:new Ln({stops:[{value:0,color:[5,10,172]},{value:.35,color:[106,137,247]},{value:.5,color:[190,190,190]},{value:.6,color:[220,170,132]},{value:.7,color:[230,145,90]},{value:1,color:[178,10,28]}]}),PICNIC:new Ln({stops:[{value:0,color:[0,0,255]},{value:.1,color:[51,153,255]},{value:.2,color:[102,204,255]},{value:.3,color:[153,204,255]},{value:.4,color:[204,204,255]},{value:.5,color:[255,255,255]},{value:.6,color:[255,204,255]},{value:.7,color:[255,153,255]},{value:.8,color:[255,102,204]},{value:.9,color:[255,102,102]},{value:1,color:[255,0,0]}]}),RAINBOW:new Ln({stops:[{value:0,color:[150,0,90]},{value:.125,color:[0,0,200]},{value:.25,color:[0,25,255]},{value:.375,color:[0,152,255]},{value:.5,color:[44,255,150]},{value:.625,color:[151,255,0]},{value:.75,color:[255,234,0]},{value:.875,color:[255,111,0]},{value:1,color:[255,0,0]}]}),PORTLAND:new Ln({stops:[{value:0,color:[12,51,131]},{value:.25,color:[10,136,186]},{value:.5,color:[242,211,56]},{value:.75,color:[242,143,56]},{value:1,color:[217,30,30]}]}),BLACKBODY:new Ln({stops:[{value:0,color:[0,0,0]},{value:.2,color:[230,0,0]},{value:.4,color:[230,210,0]},{value:.7,color:[255,255,255]},{value:1,color:[160,200,255]}]}),EARTH:new Ln({stops:[{value:0,color:[0,0,130]},{value:.1,color:[0,180,180]},{value:.2,color:[40,210,40]},{value:.4,color:[230,230,50]},{value:.6,color:[120,70,20]},{value:1,color:[255,255,255]}]}),ELECTRIC:new Ln({stops:[{value:0,color:[0,0,0]},{value:.15,color:[30,0,100]},{value:.4,color:[120,0,100]},{value:.6,color:[160,90,0]},{value:.8,color:[230,200,0]},{value:1,color:[255,250,220]}]}),VIRIDIS:new Ln({stops:[{value:0,color:[68,1,84]},{value:.13,color:[71,44,122]},{value:.25,color:[59,81,139]},{value:.38,color:[44,113,142]},{value:.5,color:[33,144,141]},{value:.63,color:[39,173,129]},{value:.75,color:[92,200,99]},{value:.88,color:[170,220,50]},{value:1,color:[253,231,37]}]}),INFERNO:new Ln({stops:[{value:0,color:[0,0,4]},{value:.13,color:[31,12,72]},{value:.25,color:[85,15,109]},{value:.38,color:[136,34,106]},{value:.5,color:[186,54,85]},{value:.63,color:[227,89,51]},{value:.75,color:[249,140,10]},{value:.88,color:[249,201,50]},{value:1,color:[252,255,164]}]}),MAGMA:new Ln({stops:[{value:0,color:[0,0,4]},{value:.13,color:[28,16,68]},{value:.25,color:[79,18,123]},{value:.38,color:[129,37,129]},{value:.5,color:[181,54,122]},{value:.63,color:[229,80,100]},{value:.75,color:[251,135,97]},{value:.88,color:[254,194,135]},{value:1,color:[252,253,191]}]}),PLASMA:new Ln({stops:[{value:0,color:[13,8,135]},{value:.13,color:[75,3,161]},{value:.25,color:[125,3,168]},{value:.38,color:[168,34,150]},{value:.5,color:[203,70,121]},{value:.63,color:[229,107,93]},{value:.75,color:[248,148,65]},{value:.88,color:[253,195,40]},{value:1,color:[240,249,33]}]}),WARM:new Ln({stops:[{value:0,color:[125,0,179]},{value:.13,color:[172,0,187]},{value:.25,color:[219,0,170]},{value:.38,color:[255,0,130]},{value:.5,color:[255,63,74]},{value:.63,color:[255,123,0]},{value:.75,color:[234,176,0]},{value:.88,color:[190,228,0]},{value:1,color:[147,255,0]}]}),COOL:new Ln({stops:[{value:0,color:[125,0,179]},{value:.13,color:[116,0,218]},{value:.25,color:[98,74,237]},{value:.38,color:[68,146,231]},{value:.5,color:[0,204,197]},{value:.63,color:[0,247,146]},{value:.75,color:[0,255,88]},{value:.88,color:[40,255,8]},{value:1,color:[147,255,0]}]}),RAINBOW_SOFT:new Ln({stops:[{value:0,color:[125,0,179]},{value:.1,color:[199,0,180]},{value:.2,color:[255,0,121]},{value:.3,color:[255,108,0]},{value:.4,color:[222,194,0]},{value:.5,color:[150,255,0]},{value:.6,color:[0,255,55]},{value:.7,color:[0,246,150]},{value:.8,color:[50,167,222]},{value:.9,color:[103,51,235]},{value:1,color:[124,0,186]}]}),BATHYMETRY:new Ln({stops:[{value:0,color:[40,26,44]},{value:.13,color:[59,49,90]},{value:.25,color:[64,76,139]},{value:.38,color:[63,110,151]},{value:.5,color:[72,142,158]},{value:.63,color:[85,174,163]},{value:.75,color:[120,206,163]},{value:.88,color:[187,230,172]},{value:1,color:[253,254,204]}]}),CDOM:new Ln({stops:[{value:0,color:[47,15,62]},{value:.13,color:[87,23,86]},{value:.25,color:[130,28,99]},{value:.38,color:[171,41,96]},{value:.5,color:[206,67,86]},{value:.63,color:[230,106,84]},{value:.75,color:[242,149,103]},{value:.88,color:[249,193,135]},{value:1,color:[254,237,176]}]}),CHLOROPHYLL:new Ln({stops:[{value:0,color:[18,36,20]},{value:.13,color:[25,63,41]},{value:.25,color:[24,91,59]},{value:.38,color:[13,119,72]},{value:.5,color:[18,148,80]},{value:.63,color:[80,173,89]},{value:.75,color:[132,196,122]},{value:.88,color:[175,221,162]},{value:1,color:[215,249,208]}]}),DENSITY:new Ln({stops:[{value:0,color:[54,14,36]},{value:.13,color:[89,23,80]},{value:.25,color:[110,45,132]},{value:.38,color:[120,77,178]},{value:.5,color:[120,113,213]},{value:.63,color:[115,151,228]},{value:.75,color:[134,185,227]},{value:.88,color:[177,214,227]},{value:1,color:[230,241,241]}]}),FREESURFACE_BLUE:new Ln({stops:[{value:0,color:[30,4,110]},{value:.13,color:[47,14,176]},{value:.25,color:[41,45,236]},{value:.38,color:[25,99,212]},{value:.5,color:[68,131,200]},{value:.63,color:[114,156,197]},{value:.75,color:[157,181,203]},{value:.88,color:[200,208,216]},{value:1,color:[241,237,236]}]}),FREESURFACE_RED:new Ln({stops:[{value:0,color:[60,9,18]},{value:.13,color:[100,17,27]},{value:.25,color:[142,20,29]},{value:.38,color:[177,43,27]},{value:.5,color:[192,87,63]},{value:.63,color:[205,125,105]},{value:.75,color:[216,162,148]},{value:.88,color:[227,199,193]},{value:1,color:[241,237,236]}]}),OXYGEN:new Ln({stops:[{value:0,color:[64,5,5]},{value:.13,color:[106,6,15]},{value:.25,color:[144,26,7]},{value:.38,color:[168,64,3]},{value:.5,color:[188,100,4]},{value:.63,color:[206,136,11]},{value:.75,color:[220,174,25]},{value:.88,color:[231,215,44]},{value:1,color:[248,254,105]}]}),PAR:new Ln({stops:[{value:0,color:[51,20,24]},{value:.13,color:[90,32,35]},{value:.25,color:[129,44,34]},{value:.38,color:[159,68,25]},{value:.5,color:[182,99,19]},{value:.63,color:[199,134,22]},{value:.75,color:[212,171,35]},{value:.88,color:[221,210,54]},{value:1,color:[225,253,75]}]}),PHASE:new Ln({stops:[{value:0,color:[145,105,18]},{value:.13,color:[184,71,38]},{value:.25,color:[186,58,115]},{value:.38,color:[160,71,185]},{value:.5,color:[110,97,218]},{value:.63,color:[50,123,164]},{value:.75,color:[31,131,110]},{value:.88,color:[77,129,34]},{value:1,color:[145,105,18]}]}),SALINITY:new Ln({stops:[{value:0,color:[42,24,108]},{value:.13,color:[33,50,162]},{value:.25,color:[15,90,145]},{value:.38,color:[40,118,137]},{value:.5,color:[59,146,135]},{value:.63,color:[79,175,126]},{value:.75,color:[120,203,104]},{value:.88,color:[193,221,100]},{value:1,color:[253,239,154]}]}),TEMPERATURE:new Ln({stops:[{value:0,color:[4,35,51]},{value:.13,color:[23,51,122]},{value:.25,color:[85,59,157]},{value:.38,color:[129,79,143]},{value:.5,color:[175,95,130]},{value:.63,color:[222,112,101]},{value:.75,color:[249,146,66]},{value:.88,color:[249,196,65]},{value:1,color:[232,250,91]}]}),TURBIDITY:new Ln({stops:[{value:0,color:[34,31,27]},{value:.13,color:[65,50,41]},{value:.25,color:[98,69,52]},{value:.38,color:[131,89,57]},{value:.5,color:[161,112,59]},{value:.63,color:[185,140,66]},{value:.75,color:[202,174,88]},{value:.88,color:[216,209,126]},{value:1,color:[233,246,171]}]}),VELOCITY_BLUE:new Ln({stops:[{value:0,color:[17,32,64]},{value:.13,color:[35,52,116]},{value:.25,color:[29,81,156]},{value:.38,color:[31,113,162]},{value:.5,color:[50,144,169]},{value:.63,color:[87,173,176]},{value:.75,color:[149,196,189]},{value:.88,color:[203,221,211]},{value:1,color:[254,251,230]}]}),VELOCITY_GREEN:new Ln({stops:[{value:0,color:[23,35,19]},{value:.13,color:[24,64,38]},{value:.25,color:[11,95,45]},{value:.38,color:[39,123,35]},{value:.5,color:[95,146,12]},{value:.63,color:[152,165,18]},{value:.75,color:[201,186,69]},{value:.88,color:[233,216,137]},{value:1,color:[255,253,205]}]}),CUBEHELIX:new Ln({stops:[{value:0,color:[0,0,0]},{value:.07,color:[22,5,59]},{value:.13,color:[60,4,105]},{value:.2,color:[109,1,135]},{value:.27,color:[161,0,147]},{value:.33,color:[210,2,142]},{value:.4,color:[251,11,123]},{value:.47,color:[255,29,97]},{value:.53,color:[255,54,69]},{value:.6,color:[255,85,46]},{value:.67,color:[255,120,34]},{value:.73,color:[255,157,37]},{value:.8,color:[241,191,57]},{value:.87,color:[224,220,93]},{value:.93,color:[218,241,142]},{value:1,color:[227,253,198]}]}),CIVIDIS:new Ln({stops:[{value:0,color:[0,32,77,255]},{value:.125,color:[5,54,110,255]},{value:.25,color:[65,77,108,255]},{value:.375,color:[97,100,111,255]},{value:.5,color:[125,124,121,255]},{value:.625,color:[156,149,120,255]},{value:.75,color:[190,175,111,255]},{value:.875,color:[225,204,94,255]},{value:1,color:[255,235,70,255]}]}),TURBO:new Ln({stops:[{value:0,color:[48,18,59,255]},{value:.125,color:[70,107,227,255]},{value:.25,color:[40,187,236,255]},{value:.375,color:[49,242,153,255]},{value:.5,color:[162,252,60,255]},{value:.625,color:[237,208,58,255]},{value:.75,color:[251,128,34,255]},{value:.875,color:[210,49,5,255]},{value:1,color:[122,4,3,255]}]}),ROCKET:new Ln({stops:[{value:0,color:[250,235,221,0]},{value:.133,color:[250,235,221,255]},{value:.266,color:[246,170,130,255]},{value:.4,color:[240,96,67,255]},{value:.533,color:[203,27,79,255]},{value:.666,color:[132,30,90,255]},{value:.8,color:[63,27,68,255]},{value:1,color:[3,5,26,255]}]}),MAKO:new Ln({stops:[{value:0,color:[11,4,5,255]},{value:.125,color:[43,28,53,255]},{value:.25,color:[62,53,107,255]},{value:.375,color:[59,86,152,255]},{value:.5,color:[53,123,162,255]},{value:.625,color:[53,158,170,255]},{value:.75,color:[73,193,173,255]},{value:.875,color:[150,221,181,255]},{value:1,color:[222,245,229,255]}]})};async function mF(i,e={}){const t=e.download??!1,o=await gF(i);if(t){const h=e.filename??"maptiler_screenshot.png",g=document.createElement("a");g.style.display="none",document.body.appendChild(g),g.href=URL.createObjectURL(o),g.download=h,g.click(),setTimeout(()=>{document.body.removeChild(g),URL.revokeObjectURL(g.href)},0)}return o}function gF(i){return new Promise((e,t)=>{i.redraw(),i.once("idle",()=>{i.getCanvas().toBlob(o=>{if(!o)return t(Error("Screenshot could not be created."));e(o)},"image/png")})})}const jT=[["#1D5B79","#468B97","#EF6262","#F3AA60"],["#614BC3","#33BBC5","#85E6C5","#C8FFE0"],["#461959","#7A316F","#CD6688","#AED8CC"],["#0079FF","#00DFA2","#F6FA70","#FF0060"],["#39B5E0","#A31ACB","#FF78F0","#F5EA5A"],["#37E2D5","#590696","#C70A80","#FBCB0A"],["#FFD36E","#FFF56D","#99FFCD","#9FB4FF"],["#00EAD3","#FFF5B7","#FF449F","#005F99"],["#10A19D","#540375","#FF7000","#FFBF00"]];function Lw(){return jT[~~(Math.random()*jT.length)][~~(Math.random()*4)]}function yv(){return`maptiler_source_${pI()}`}function vv(){return`maptiler_layer_${pI()}`}function $T(i,e){if(e<=i[0].zoom)return i[0].value;if(e>=i[i.length-1].zoom)return i[i.length-1].value;for(let t=0;t<i.length-1;t+=1)if(e>=i[t].zoom&&e<i[t+1].zoom){const o=i[t+1].zoom-i[t].zoom,h=(e-i[t].zoom)/o;return h*i[t+1].value+(1-h)*i[t].value}return 0}function kp(i){return["interpolate",["linear"],["zoom"],...i.flatMap(e=>[e.zoom,e.value])]}function pr(i){return["interpolate",["linear"],["zoom"],...i.flatMap(e=>[e.zoom,e.value])]}function _F(i,e){if(typeof e=="number"&&typeof i=="number")return 2*e+i;if(typeof e=="number"&&Array.isArray(i))return["interpolate",["linear"],["zoom"],...i.flatMap(t=>[t.zoom,2*e+t.value])];if(typeof i=="number"&&Array.isArray(e))return["interpolate",["linear"],["zoom"],...e.flatMap(t=>[t.zoom,2*t.value+i])];if(Array.isArray(i)&&Array.isArray(e)){const t=Array.from(new Set([...i.map(o=>o.zoom),...e.map(o=>o.zoom)])).sort((o,h)=>o<h?-1:1);return["interpolate",["linear"],["zoom"],...t.flatMap(o=>[o,2*$T(e,o)+$T(i,o)])]}return 0}function yF(i,e){return["interpolate",["linear"],["get",e],...i.flatMap(t=>[t.propertyValue,t.value])]}function uP(i){const e=i.trimStart(),t=`${e}${" ".repeat(i.length-e.length)}`,o=Array.from(t);if(!o.every(g=>g===" "||g==="_"))throw new Error("A dash pattern must be composed only of whitespace and underscore characters.");if(!(o.some(g=>g==="_")&&o.some(g=>g===" ")))throw new Error("A dash pattern must contain at least one underscore and one whitespace character");const h=[1];for(let g=1;g<o.length;g+=1){const _=o[g-1],u=o[g];_===u?h[h.length-1]+=1:h.push(1)}return h}function HT(i,e){return["interpolate",["linear"],["get",e],...i.flatMap(t=>[t.value,t.color])]}function qT(i,e,t=!0){return t?["interpolate",["linear"],["zoom"],0,["interpolate",["linear"],["get",e],...i.flatMap(o=>[o.value,o.pointRadius*.025])],2,["interpolate",["linear"],["get",e],...i.flatMap(o=>[o.value,o.pointRadius*.05])],4,["interpolate",["linear"],["get",e],...i.flatMap(o=>[o.value,o.pointRadius*.1])],8,["interpolate",["linear"],["get",e],...i.flatMap(o=>[o.value,o.pointRadius*.25])],16,["interpolate",["linear"],["get",e],...i.flatMap(o=>[o.value,o.pointRadius])]]:["interpolate",["linear"],["get",e],...i.flatMap(o=>[o.value,o.pointRadius])]}function vF(i,e,t=!0){return t?["interpolate",["linear"],["zoom"],0,["interpolate",["linear"],["get",e],...i.flatMap(o=>[o.propertyValue,o.value*.025])],2,["interpolate",["linear"],["get",e],...i.flatMap(o=>[o.propertyValue,o.value*.05])],4,["interpolate",["linear"],["get",e],...i.flatMap(o=>[o.propertyValue,o.value*.1])],8,["interpolate",["linear"],["get",e],...i.flatMap(o=>[o.propertyValue,o.value*.25])],16,["interpolate",["linear"],["get",e],...i.flatMap(o=>[o.propertyValue,o.value])]]:["interpolate",["linear"],["get",e],...i.flatMap(o=>[o.propertyValue,o.value])]}function GT(i,e){return i.every(t=>t.color[3]===i[0].color[3])?i[0].color[3]?i[0].color[3]/255:1:["interpolate",["linear"],["get",e],...i.getRawColorStops().flatMap(t=>{const o=t.value,h=t.color;return[o,h.length===4?h[3]/255:1]})]}function xF(i,e=10){return["interpolate",["linear"],["heatmap-density"],...Array.from({length:e+1},(t,o)=>{const h=o/e;return[h,i.getColorHex(h)]}).flat()]}async function wF(i,e,t={}){var o,h;if(!e.sourceId&&!e.data)throw new Error("Creating a polyline layer requires an existing .sourceId or a valid .data property");let g=e.data;if(typeof g=="string"){if(iv(g))g=`https://api.maptiler.com/data/${e.data}/features.json?key=${xo.apiKey}`;else if(((o=g.split(".").pop())==null?void 0:o.toLowerCase().trim())==="gpx"){const _=await(await fetch(g,t)).text();g=tP(_)}else if(((h=g.split(".").pop())==null?void 0:h.toLowerCase().trim())==="kml"){const _=await(await fetch(g,t)).text();g=nP(_)}else{const _=IO(g)??pF(g);_&&(g=_)}if(!g)throw new Error("Polyline data was provided as string but is incompatible with valid formats.")}return bF(i,{...e,data:g})}function bF(i,e){if(e.layerId&&i.getLayer(e.layerId))throw new Error(`A layer already exists with the layer id: ${e.layerId}`);const t=e.sourceId??yv(),o=e.layerId??vv(),h={polylineLayerId:o,polylineOutlineLayerId:"",polylineSourceId:t};e.data&&!i.getSource(t)&&i.addSource(t,{type:"geojson",data:e.data});const g=e.lineWidth??3,_=e.lineColor??Lw(),u=e.lineOpacity??1,R=e.lineBlur??0,O=e.lineGapWidth??0;let G=e.lineDashArray??null;const ne=e.outlineWidth??1,re=e.outlineColor??"#FFFFFF",Q=e.outlineOpacity??1,de=e.outlineBlur??0;if(typeof G=="string"&&(G=uP(G)),e.outline===!0){const Se=`${o}_outline`;h.polylineOutlineLayerId=Se,i.addLayer({id:Se,type:"line",source:t,layout:{"line-join":e.lineJoin??"round","line-cap":e.lineCap??"round"},minzoom:e.minzoom??0,maxzoom:e.maxzoom??23,paint:{"line-opacity":typeof Q=="number"?Q:pr(Q),"line-color":typeof re=="string"?re:kp(re),"line-width":_F(g,ne),"line-blur":typeof de=="number"?de:pr(de)}},e.beforeId)}return i.addLayer({id:o,type:"line",source:t,layout:{"line-join":e.lineJoin??"round","line-cap":e.lineCap??"round"},minzoom:e.minzoom??0,maxzoom:e.maxzoom??23,paint:{"line-opacity":typeof u=="number"?u:pr(u),"line-color":typeof _=="string"?_:kp(_),"line-width":typeof g=="number"?g:pr(g),"line-blur":typeof R=="number"?R:pr(R),"line-gap-width":typeof O=="number"?O:pr(O),...G&&{"line-dasharray":G}}},e.beforeId),h}function TF(i,e){if(e.layerId&&i.getLayer(e.layerId))throw new Error(`A layer already exists with the layer id: ${e.layerId}`);const t=e.sourceId??yv(),o=e.layerId??vv(),h={polygonLayerId:o,polygonOutlineLayerId:e.outline?`${o}_outline`:"",polygonSourceId:t};if(e.data&&!i.getSource(t)){let Se=e.data;typeof Se=="string"&&iv(Se)&&(Se=`https://api.maptiler.com/data/${Se}/features.json?key=${xo.apiKey}`),i.addSource(t,{type:"geojson",data:Se})}let g=e.outlineDashArray??null;const _=e.outlineWidth??1,u=e.outlineColor??"#FFFFFF",R=e.outlineOpacity??1,O=e.outlineBlur??0,G=e.fillColor??Lw(),ne=e.fillOpacity??1,re=e.outlinePosition??"center",Q=e.pattern??null;typeof g=="string"&&(g=uP(g));const de=(Se=null)=>{if(i.addLayer({id:o,type:"fill",source:t,minzoom:e.minzoom??0,maxzoom:e.maxzoom??23,paint:{"fill-color":typeof G=="string"?G:kp(G),"fill-opacity":typeof ne=="number"?ne:pr(ne),...Se&&{"fill-pattern":Se}}},e.beforeId),e.outline===!0){let De;re==="inside"?typeof _=="number"?De=.5*_:De=pr(_.map(({zoom:Ke,value:et})=>({zoom:Ke,value:.5*et}))):re==="outside"?typeof _=="number"?De=-.5*_:De=pr(_.map(Ke=>({zoom:Ke.zoom,value:-.5*Ke.value}))):De=0,i.addLayer({id:h.polygonOutlineLayerId,type:"line",source:t,layout:{"line-join":e.outlineJoin??"round","line-cap":e.outlineCap??"butt"},minzoom:e.minzoom??0,maxzoom:e.maxzoom??23,paint:{"line-opacity":typeof R=="number"?R:pr(R),"line-color":typeof u=="string"?u:kp(u),"line-width":typeof _=="number"?_:pr(_),"line-blur":typeof O=="number"?O:pr(O),"line-offset":De,...g&&{"line-dasharray":g}}},e.beforeId)}};return Q?i.hasImage(Q)?de(Q):i.loadImage(Q).then(Se=>{i.addImage(Q,Se.data),de(Q)}).catch(Se=>(console.error("Could not load the pattern image.",Se.message),de())):de(),h}function SF(i,e){if(e.layerId&&i.getLayer(e.layerId))throw new Error(`A layer already exists with the layer id: ${e.layerId}`);const t=e.minPointRadius??10,o=e.maxPointRadius??50,h=e.cluster??!1,g=20,_=Array.isArray(e.pointColor)?e.pointColor:lP.TURBO.scale(10,e.cluster?1e4:1e3).resample("ease-out-square"),u=_.getBounds(),R=e.sourceId??yv(),O=e.layerId??vv(),G=e.showLabel??h,ne=e.alignOnViewport??!0,re=e.outline??!1,Q=e.outlineOpacity??1,de=e.outlineWidth??1,Se=e.outlineColor??"#FFFFFF";let De;const Ke=e.zoomCompensation??!0,et=e.minzoom??0,vt=e.maxzoom??23;typeof e.pointOpacity=="number"?De=e.pointOpacity:Array.isArray(e.pointOpacity)?De=pr(e.pointOpacity):e.cluster?De=GT(_,"point_count"):e.property?De=GT(_,e.property):De=pr([{zoom:et,value:0},{zoom:et+.25,value:1},{zoom:vt-.25,value:1},{zoom:vt,value:0}]);const Ye={pointLayerId:O,clusterLayerId:"",labelLayerId:"",pointSourceId:R};if(e.data&&!i.getSource(R)){let it=e.data;typeof it=="string"&&iv(it)&&(it=`https://api.maptiler.com/data/${it}/features.json?key=${xo.apiKey}`),i.addSource(R,{type:"geojson",data:it,cluster:h})}if(h){Ye.clusterLayerId=`${O}_cluster`;const it=Array.from({length:g},(at,be)=>{const te=u.min+be*(u.max-u.min)/(g-1);return{value:te,pointRadius:t+(o-t)*(be/(g-1))**.5,color:_.getColorHex(te)}});i.addLayer({id:Ye.clusterLayerId,type:"circle",source:R,filter:["has","point_count"],paint:{"circle-color":typeof e.pointColor=="string"?e.pointColor:HT(it,"point_count"),"circle-radius":typeof e.pointRadius=="number"?e.pointRadius:Array.isArray(e.pointRadius)?pr(e.pointRadius):qT(it,"point_count",!1),"circle-pitch-alignment":ne?"viewport":"map","circle-pitch-scale":"map","circle-opacity":De,...re&&{"circle-stroke-opacity":typeof Q=="number"?Q:pr(Q),"circle-stroke-width":typeof de=="number"?de:pr(de),"circle-stroke-color":typeof Se=="string"?Se:kp(Se)}},minzoom:et,maxzoom:vt},e.beforeId),i.addLayer({id:Ye.pointLayerId,type:"circle",source:R,filter:["!",["has","point_count"]],paint:{"circle-pitch-alignment":ne?"viewport":"map","circle-pitch-scale":"map","circle-color":typeof e.pointColor=="string"?e.pointColor:_.getColorHex(_.getBounds().min),"circle-radius":typeof e.pointRadius=="number"?e.pointRadius:Array.isArray(e.pointRadius)?pr(e.pointRadius):it[0].pointRadius*.75,"circle-opacity":De,...re&&{"circle-stroke-opacity":typeof Q=="number"?Q:pr(Q),"circle-stroke-width":typeof de=="number"?de:pr(de),"circle-stroke-color":typeof Se=="string"?Se:kp(Se)}},minzoom:et,maxzoom:vt},e.beforeId)}else{let it=typeof e.pointColor=="string"?e.pointColor:Array.isArray(e.pointColor)?e.pointColor.getColorHex(e.pointColor.getBounds().min):Lw(),at=typeof e.pointRadius=="number"?Ke?pr([{zoom:0,value:e.pointRadius*.025},{zoom:2,value:e.pointRadius*.05},{zoom:4,value:e.pointRadius*.1},{zoom:8,value:e.pointRadius*.25},{zoom:16,value:e.pointRadius*1}]):e.pointRadius:Array.isArray(e.pointRadius)?pr(e.pointRadius):Ke?pr([{zoom:0,value:t*.05},{zoom:2,value:t*.1},{zoom:4,value:t*.2},{zoom:8,value:t*.5},{zoom:16,value:t*1}]):t;if(e.property&&Array.isArray(e.pointColor)){const be=Array.from({length:g},(te,pe)=>{const xe=u.min+pe*(u.max-u.min)/(g-1);return{value:xe,pointRadius:typeof e.pointRadius=="number"?e.pointRadius:t+(o-t)*(pe/(g-1))**.5,color:typeof e.pointColor=="string"?e.pointColor:_.getColorHex(xe)}});it=HT(be,e.property),at=qT(be,e.property,Ke)}i.addLayer({id:Ye.pointLayerId,type:"circle",source:R,layout:{"circle-sort-key":e.property?["/",1,["get",e.property]]:0},paint:{"circle-pitch-alignment":ne?"viewport":"map","circle-pitch-scale":"map","circle-color":it,"circle-opacity":De,"circle-radius":at,...re&&{"circle-stroke-opacity":typeof Q=="number"?Q:pr(Q),"circle-stroke-width":typeof de=="number"?de:pr(de),"circle-stroke-color":typeof Se=="string"?Se:kp(Se)}},minzoom:et,maxzoom:vt},e.beforeId)}if(G!==!1&&(e.cluster||e.property)){Ye.labelLayerId=`${O}_label`;const it=e.labelColor??"#fff",at=e.labelSize??12;i.addLayer({id:Ye.labelLayerId,type:"symbol",source:R,filter:["has",e.cluster?"point_count":e.property],layout:{"text-field":e.cluster?"{point_count_abbreviated}":`{${e.property}}`,"text-font":["Noto Sans Regular"],"text-size":at,"text-pitch-alignment":ne?"viewport":"map","symbol-sort-key":["/",1,["get",e.cluster?"point_count":e.property]]},paint:{"text-color":it,"text-opacity":De},minzoom:et,maxzoom:vt},e.beforeId)}return Ye}function EF(i,e){if(e.layerId&&i.getLayer(e.layerId))throw new Error(`A layer already exists with the layer id: ${e.layerId}`);const t=e.sourceId??yv(),o=e.layerId??vv(),h=e.minzoom??0,g=e.maxzoom??23,_=e.zoomCompensation??!0,u=e.opacity??[{zoom:h,value:0},{zoom:h+.25,value:1},{zoom:g-.25,value:1},{zoom:g,value:0}];let R=Array.isArray(e.colorRamp)?e.colorRamp:lP.TURBO.transparentStart();const O=R.getBounds();(O.min!==0||O.max!==1)&&(R=R.scale(0,1)),R.hasTransparentStart()||(R=R.transparentStart());const G=e.intensity??[{zoom:0,value:.01},{zoom:4,value:.2},{zoom:16,value:1}],ne=e.property??null,re=e.weight??1;let Q=1;ne?typeof re=="number"?(Q=re,typeof e.weight=="number"&&console.warn("The option `.property` is ignored when `.propertyValueWeights` is not of type `PropertyValueWeights`")):Array.isArray(re)?Q=yF(re,ne):console.warn("The option `.property` is ignored when `.propertyValueWeights` is not of type `PropertyValueWeights`"):typeof re=="number"?Q=re:Array.isArray(re)&&console.warn("The options `.propertyValueWeights` can only be used when `.property` is provided.");const de=[{zoom:0,value:50*.025},{zoom:2,value:50*.05},{zoom:4,value:50*.1},{zoom:8,value:50*.25},{zoom:16,value:50}],Se=e.radius??(_?de:10);let De=1;typeof Se=="number"?De=Se:Array.isArray(Se)&&"zoom"in Se[0]?De=pr(Se):ne&&Array.isArray(Se)&&"propertyValue"in Se[0]?De=vF(Se,ne,_):!ne&&Array.isArray(Se)&&"propertyValue"in Se[0]?(De=pr(de),console.warn("The option `.radius` can only be property-driven if the option `.property` is provided.")):De=pr(de);const Ke={heatmapLayerId:o,heatmapSourceId:t};if(e.data&&!i.getSource(t)){let et=e.data;typeof et=="string"&&iv(et)&&(et=`https://api.maptiler.com/data/${et}/features.json?key=${xo.apiKey}`),i.addSource(t,{type:"geojson",data:et})}return i.addLayer({id:o,type:"heatmap",source:t,minzoom:h,maxzoom:g,paint:{"heatmap-weight":Q,"heatmap-intensity":typeof G=="number"?G:pr(G),"heatmap-color":xF(R),"heatmap-radius":De,"heatmap-opacity":typeof u=="number"?u:pr(u)}},e.beforeId),Ke}const Ym={addPolyline:wF,addPolygon:TF,addPoint:SF,addHeatmap:EF,takeScreenshot:mF};SO();In.Map;In.Marker;In.Popup;In.Style;In.CanvasSource;In.GeoJSONSource;In.ImageSource;In.RasterTileSource;In.RasterDEMTileSource;In.VectorTileSource;In.VideoSource;In.NavigationControl;In.GeolocateControl;In.AttributionControl;In.LogoControl;In.ScaleControl;In.FullscreenControl;In.TerrainControl;In.BoxZoomHandler;In.ScrollZoomHandler;In.CooperativeGesturesHandler;In.KeyboardHandler;In.TwoFingersTouchPitchHandler;In.MapWheelEvent;In.MapTouchEvent;In.MapMouseEvent;In.config;In.getVersion;const{setRTLTextPlugin:JF,getRTLTextPluginStatus:eB,LngLat:tB,LngLatBounds:nB,MercatorCoordinate:iB,Evented:rB,AJAXError:oB,prewarm:sB,clearPrewarmedResources:aB,Hash:lB,Point:uB,EdgeInsets:cB,DragRotateHandler:hB,DragPanHandler:dB,TwoFingersTouchZoomRotateHandler:pB,DoubleClickZoomHandler:fB,TwoFingersTouchZoomHandler:mB,TwoFingersTouchRotateHandler:gB,getWorkerCount:_B,setWorkerCount:yB,getMaxParallelImageRequests:vB,setMaxParallelImageRequests:xB,getWorkerUrl:wB,setWorkerUrl:bB,addSourceType:TB,importScriptInWorkers:SB,addProtocol:EB,removeProtocol:IB}=In,IF="@maptiler/leaflet-maptilersdk",PF="4.0.2",CF=zr.Layer.extend({options:{updateInterval:32,padding:.1,interactive:!1,pane:"tilePane"},map:null,initialize:function(i){zr.setOptions(this,i),this._throttledUpdate=zr.Util.throttle(this._update,this.options.updateInterval,this)},onAdd:function(i){var e;this._container||this._initContainer();const t=this.getPaneName();(e=i.getPane(t))==null||e.appendChild(this._container),this._initMaptilerSDK(),this._offset=this._map.containerPointToLayerPoint([0,0]),i.options.zoomAnimation&&zr.DomEvent.on(i._proxy,zr.DomUtil.TRANSITION_END,this._transitionEnd,this),i.attributionControl.addAttribution('<a href="https://www.maptiler.com/copyright/" target="_blank">&copy; MapTiler</a> <a href="https://www.openstreetmap.org/copyright" target="_blank">&copy; OpenStreetMap contributors</a>')},onRemove:function(i){var e;this._map._proxy&&this._map.options.zoomAnimation&&zr.DomEvent.off(this._map._proxy,zr.DomUtil.TRANSITION_END,this._transitionEnd,this);const t=this.getPaneName();(e=i.getPane(t))==null||e.removeChild(this._container),this._maptilerMap.remove(),this._maptilerMap=null},getEvents:function(){return{move:this._throttledUpdate,zoomanim:this._animateZoom,zoom:this._pinchZoom,zoomstart:this._zoomStart,zoomend:this._zoomEnd,resize:this._resize}},getMaptilerSDKMap:function(){return this._maptilerMap},getCanvas:function(){return this._maptilerMap.getCanvas()},getSize:function(){return this._map.getSize().multiplyBy(1+this.options.padding*2)},getBounds:function(){const i=this.getSize().multiplyBy(.5),e=this._map.latLngToContainerPoint(this._map.getCenter());return zr.latLngBounds(this._map.containerPointToLatLng(e.subtract(i)),this._map.containerPointToLatLng(e.add(i)))},getContainer:function(){return this._container},getPaneName:function(){return this._map.getPane(this.options.pane)?this.options.pane:"tilePane"},setStyle:function(i){this._maptilerMap.setStyle(i)},setLanguage:function(i){this._maptilerMap.setLanguage(i)},_roundPoint:i=>({x:Math.round(i.x),y:Math.round(i.y)}),_initContainer:function(){this._container=zr.DomUtil.create("div","leaflet-gl-layer");const i=this.getSize(),e=this._map.getSize().multiplyBy(this.options.padding);this._container.style.width=`${i.x}px`,this._container.style.height=`${i.y}px`;const t=this._map.containerPointToLayerPoint([0,0]).subtract(e);zr.DomUtil.setPosition(this._container,this._roundPoint(t))},_initMaptilerSDK:function(){const i=this._map.getCenter(),e={...this.options,projection:"mercator",container:this._container,center:[i.lng,i.lat],zoom:this._map.getZoom()-1,attributionControl:!1};this.options.geolocate&&(e.center=void 0,e.zoom=void 0),this._maptilerMap=new JI(e),this._maptilerMap.telemetry.registerModule(IF,PF),this._maptilerMap.once("load",()=>{this.fire("ready")}),this._maptilerMap.once("load",async()=>{let o={logo:null};try{const h=Object.keys(this._maptilerMap.style.sourceCaches).map(_=>this._maptilerMap.getSource(_)).filter(_=>_&&"url"in _&&typeof _.url=="string"&&_?.url.includes("tiles.json")),g=new URL(h[0].url);g.searchParams.has("key")||g.searchParams.append("key",e.apiKey),o=await(await fetch(g.href)).json()}catch{}if(o.logo||e.maptilerLogo){const h=o.logo??"https://api.maptiler.com/resources/logo.svg",g=document.createElement("a");g.href="https://www.maptiler.com",g.style.setProperty("position","absolute"),g.style.setProperty("left","10px"),g.style.setProperty("bottom","2px"),g.style.setProperty("z-index","999");const _=document.createElement("img");_.src=h,_.alt="MapTiler logo",_.width=100,_.height=30,g.appendChild(_),this._map.getContainer().appendChild(g)}}),this._maptilerMap.transform.freezeElevation=!0,this.options.geolocate&&this._maptilerMap.on("load",()=>{this._map.setView(this._maptilerMap.getCenter(),this._maptilerMap.getZoom()+1)}),this._transformGL(),this._maptilerMap._actualCanvas=this._maptilerMap._canvas;const t=this._maptilerMap._actualCanvas;zr.DomUtil.addClass(t,"leaflet-image-layer"),zr.DomUtil.addClass(t,"leaflet-zoom-animated"),this.options.interactive&&zr.DomUtil.addClass(t,"leaflet-interactive"),this.options.className&&zr.DomUtil.addClass(t,this.options.className),this.addHeatmap=o=>Ym.addHeatmap(this._maptilerMap,o),this.addPolygon=o=>Ym.addPolygon(this._maptilerMap,o),this.addPoint=o=>Ym.addPoint(this._maptilerMap,o),this.addPolyline=o=>Ym.addPolyline(this._maptilerMap,o),this.takeScreenshot=o=>Ym.takeScreenshot(this._maptilerMap,o)},_update:function(){if(this._offset=this._map.containerPointToLayerPoint([0,0]),this._zooming)return;const i=this.getSize(),e=this._map.getSize().multiplyBy(this.options.padding),t=this._map.containerPointToLayerPoint([0,0]).subtract(e);zr.DomUtil.setPosition(this._container,this._roundPoint(t)),this._transformGL(),this._maptilerMap.transform.width!==i.x||this._maptilerMap.transform.height!==i.y?(this._container.style.width=`${i.x}px`,this._container.style.height=`${i.y}px`,this._maptilerMap._resize!==null&&this._maptilerMap._resize!==void 0?this._maptilerMap._resize():this._maptilerMap.resize()):this._maptilerMap._update!==null&&this._maptilerMap._update!==void 0?this._maptilerMap._update():this._maptilerMap.update()},_transformGL:function(){this._maptilerMap.setCenter(this._map.getCenter()),this._maptilerMap.setZoom(this._map.getZoom()-1)},_pinchZoom:function(){this._maptilerMap.jumpTo({zoom:this._map.getZoom()-1,center:this._map.getCenter()})},_animateZoom:function(i){const e=this._map.getZoomScale(i.zoom),t=this._map.getSize().multiplyBy(this.options.padding*e),o=this.getSize()._divideBy(2),h=this._map.project(i.center,i.zoom)._subtract(o)._add(this._map._getMapPanePos().add(t))._round(),g=this._map.project(this._map.getBounds().getNorthWest(),i.zoom)._subtract(h);zr.DomUtil.setTransform(this._maptilerMap.getCanvas(),g.subtract(this._offset),e)},_zoomStart:function(){this._zooming=!0},_zoomEnd:function(){const i=this._map.getZoomScale(this._map.getZoom());zr.DomUtil.setTransform(this._maptilerMap.getCanvas(),new zr.Point(0,0),i),this._zooming=!1,this._update()},_transitionEnd:function(){zr.Util.requestAnimFrame(()=>{const i=this._map.getZoom(),e=this._map.getCenter(),t=this._map.latLngToContainerPoint(this._map.getBounds().getNorthWest());zr.DomUtil.setTransform(this._maptilerMap._actualCanvas,t,1),this._maptilerMap.once("moveend",zr.Util.bind(()=>{this._zoomEnd()},this)),this._maptilerMap.jumpTo({center:e,zoom:i-1})},this)},_resize:function(i){this._transitionEnd(i)}});function ZT({reports:i=[],onReportClick:e}){const[t,o]=It.useState([]),[h,g]=It.useState([]),[_,u]=It.useState([]),[R,O]=It.useState(!0),[G,ne]=It.useState(null),[re,Q]=It.useState({selectedCampus:"All",selectedMonth:"All",selectedTypes:[],showMenu:!1}),de=It.useRef(null),Se=["All",...Array.from(new Set(Jm.map(te=>te.location)))],De=()=>{const te=new Set;return t.forEach(pe=>{const xe=new Date(pe.Time),Ae=`${xe.getFullYear()}-${String(xe.getMonth()+1).padStart(2,"0")}`;te.add(Ae)}),["All",...Array.from(te).sort().reverse()]},Ke=[{id:0,name:"Uncomfortable Situation",color:"#de9e36"},{id:1,name:"Sexual Misconduct",color:"#ca3c25"},{id:2,name:"Physical Aggression",color:"#701d52"},{id:3,name:"Verbal Aggression",color:"#212475"},{id:4,name:"Discrimination",color:"#1d1a05"}],et=()=>{const te={};return Jm.forEach(pe=>{te[pe.name]={hallName:pe.name,coordinates:[pe.latitude,pe.longitude],totalIncidents:0,incidentCounts:{0:0,1:0,2:0,3:0,4:0},buildingType:pe.buildingType,location:pe.location,recentIncidents:[]}}),te},vt=te=>te.filter(pe=>{if(re.selectedCampus!=="All"){const xe=Jm.find(Ae=>Ae.name===pe.Dorm);if(!xe||xe.location!==re.selectedCampus)return!1}if(re.selectedMonth!=="All"){const xe=new Date(pe.Time);if(`${xe.getFullYear()}-${String(xe.getMonth()+1).padStart(2,"0")}`!==re.selectedMonth)return!1}return!(re.selectedTypes.length>0&&!re.selectedTypes.includes(pe.Type))}),Ye=(te,pe)=>{Q(xe=>({...xe,[te]:pe}))},it=te=>{Q(pe=>({...pe,selectedTypes:pe.selectedTypes.includes(te)?pe.selectedTypes.filter(xe=>xe!==te):[...pe.selectedTypes,te]}))},at=te=>{if(de.current)if(te==="All")de.current.setView([41.7002,-86.2379],15);else{const pe=Jm.filter(xe=>xe.location===te);if(pe.length>0){const xe=zr.latLngBounds(pe.map(Ae=>[Ae.latitude,Ae.longitude]));de.current.fitBounds(xe,{padding:[50,50]})}}};It.useEffect(()=>{const te=async()=>{try{O(!0),ne(null);const pe=await Ey.getReports(1e3);if(pe.length===0){const $e=(await(await fetch("https://red-report.vercel.app/api/import")).json()).map(Ce=>({id:Ce.id,Dorm:Ce.Dorm,Time:new Date(Ce.Time),Type:Ce.Type}));o($e)}else o(pe)}catch(pe){console.error("Error fetching data:",pe),ne("Failed to load incident data")}finally{O(!1)}};de.current||(de.current=zr.map("map",{maxZoom:19}).setView([41.7002,-86.2379],15).setMinZoom(15).setMaxBounds([[41.7852,-86.1779],[41.5852,-86.2879]]),new CF({style:"80390579-ac14-4623-ba3e-80bdbcb7bd5f",apiKey:"0UGrg19TXtYRROinsJ9a"}).addTo(de.current)),te()},[]),It.useEffect(()=>{g(vt(t))},[t,re]),It.useEffect(()=>{if(!de.current||h.length===0)return;de.current.eachLayer(pe=>{pe instanceof zr.Circle&&de.current.removeLayer(pe)});const te=et();h.forEach(pe=>{try{const xe=pe.Dorm;te[xe]&&(te[xe].totalIncidents++,te[xe].incidentCounts[pe.Type]++,te[xe].recentIncidents.push(pe),te[xe].recentIncidents.length>10&&te[xe].recentIncidents.shift())}catch(xe){console.warn(`Error processing incident for ${pe.Dorm}:`,xe)}}),u(Object.values(te)),Object.values(te).forEach(pe=>{if(pe.totalIncidents>0){const xe=Math.min(pe.totalIncidents*10+15,100),Ae=Object.entries(pe.incidentCounts).sort(([,dn],[,jn])=>jn-dn)[0][0],Ce={0:"#de9e36",1:"#ca3c25",2:"#701d52",3:"#212475",4:"#1d1a05"}[parseInt(Ae)]||"#666666",pn=be(pe);zr.circle(pe.coordinates,{color:Ce,fillColor:Ce,fillOpacity:.7,radius:xe,weight:2}).addTo(de.current).bindPopup(pn,{maxWidth:400,className:"enhanced-popup"});let ri="black";pe.location==="Notre Dame"?ri="#FFD700":pe.location==="Holy Cross"?ri="#fff":pe.location==="Saint Mary's"&&(ri="#87CEEB"),zr.circle(pe.coordinates,{fillColor:ri,fillOpacity:.5,color:ri,radius:15}).addTo(de.current).bindPopup(pn,{maxWidth:400,className:"enhanced-popup"})}}),ig.logMapView()},[h]);const be=te=>{const pe=new Date;pe.setDate(pe.getDate()-7);const xe=te.recentIncidents.filter(pn=>new Date(pn.Time)>=pe);let Ae=1;xe.length>=5?Ae=5:xe.length>=3?Ae=4:xe.length>=2?Ae=3:xe.length>=1?Ae=2:Ae=1;const $e=Ae>=4?"#ca3c25":Ae>=3?"#de9e36":Ae>=2?"#212475":"#28a745",Ce=[{name:"Uncomfortable Situation",color:"#de9e36"},{name:"Sexual Misconduct",color:"#ca3c25"},{name:"Physical Aggression",color:"#701d52"},{name:"Verbal Aggression",color:"#212475"},{name:"Discrimination",color:"#1d1a05"}];return`
      <div class="enhanced-popup-content">
        <h3 style="margin: 0 0 10px 0; color: #333;">${te.hallName}</h3>
        
        <div style="margin-bottom: 10px;">
          <span style="font-weight: bold; color: #666;">Location:</span> ${te.location}<br>
          <span style="font-weight: bold; color: #666;">Building Type:</span> ${te.buildingType}
        </div>
        
        <div style="margin-bottom: 10px;">
          <span style="font-weight: bold; color: #666;">Total Cases:</span> ${te.totalIncidents}
        </div>
        
        <div style="margin-bottom: 10px;">
          <span style="font-weight: bold; color: #666;">Cases by Type:</span><br>
          ${Object.entries(te.incidentCounts).filter(([,pn])=>pn>0).map(([pn,ri])=>{const dn=parseInt(pn),jn=Ce[dn];return`<div style="margin: 2px 0; font-size: 12px;">
                <span style="color: ${jn.color}; font-weight: bold;">●</span> 
                ${jn.name}: ${ri}
              </div>`}).join("")}
        </div>
        
        <div style="margin-bottom: 10px;">
          <span style="font-weight: bold; color: #666;">Risk Score:</span> 
          <span style="color: ${$e}; font-weight: bold; font-size: 16px;">
            ${Ae}/5
          </span>
          ${xe.length>0?`<br><span style="font-size: 12px; color: #666;">
              (${xe.length} recent case${xe.length>1?"s":""} in last 7 days)
            </span>`:'<br><span style="font-size: 12px; color: #28a745;">(No recent activity)</span>'}
        </div>
      </div>
    `};return Kt.createElement("div",{className:"fullscreen-map-container"},Kt.createElement("div",{className:`map-filter-menu m-3 ${re.showMenu?" open":""}`},Kt.createElement("button",{className:"menu-toggle-btn",onClick:()=>Ye("showMenu",!re.showMenu)},re.showMenu?"✕":"☰"),re.showMenu&&Kt.createElement("div",{className:"filter-content"},Kt.createElement("h3",null,"Map Filters"),Kt.createElement("div",{className:"filter-section"},Kt.createElement("label",null,"Campus:"),Kt.createElement("select",{value:re.selectedCampus,onChange:te=>{Ye("selectedCampus",te.target.value),at(te.target.value)}},Se.map(te=>Kt.createElement("option",{key:te,value:te},te)))),Kt.createElement("div",{className:"filter-section"},Kt.createElement("label",null,"Month:"),Kt.createElement("select",{value:re.selectedMonth,onChange:te=>Ye("selectedMonth",te.target.value)},De().map(te=>Kt.createElement("option",{key:te,value:te},te==="All"?"All Time":te)))),Kt.createElement("div",{className:"filter-section"},Kt.createElement("label",null,"Incident Types:"),Kt.createElement("div",{className:"type-filters"},Ke.map(te=>Kt.createElement("label",{key:te.id,className:"type-checkbox custom-circle-checkbox",style:{cursor:"pointer"}},Kt.createElement("input",{type:"checkbox",checked:re.selectedTypes.includes(te.id),onChange:()=>it(te.id),style:{display:"none"}}),Kt.createElement("span",{className:`type-color-dot-circle ${re.selectedTypes.includes(te.id)?"selected":""}`,style:{backgroundColor:te.color,borderColor:te.color}},re.selectedTypes.includes(te.id)&&Kt.createElement("svg",{width:"16",height:"16",viewBox:"0 0 16 16",style:{display:"block",margin:"auto"}},Kt.createElement("circle",{cx:"13",cy:"13",r:"10",fill:"#fff",opacity:"0.8"}))),Kt.createElement("span",{style:{marginLeft:8}},te.name))))),Kt.createElement("button",{className:"clear-filters-btn",onClick:()=>Q({selectedCampus:"All",selectedMonth:"All",selectedTypes:[],showMenu:re.showMenu})},"Clear All Filters"),Kt.createElement("div",{className:"results-summary"},Kt.createElement("p",null,"Showing ",h.length," incidents"),re.selectedCampus!=="All"&&Kt.createElement("p",null,"Campus: ",re.selectedCampus),re.selectedMonth!=="All"&&Kt.createElement("p",null,"Period: ",re.selectedMonth),re.selectedTypes.length>0&&Kt.createElement("p",null,"Types:"," ",re.selectedTypes.map(te=>Ke.find(pe=>pe.id===te)?.name).join(", "))))),Kt.createElement("div",null,Kt.createElement("a",{href:"../",className:"back-button"},Kt.createElement("button",{className:"option abs right small"},"Back")),Kt.createElement("a",{"data-az-l":"1e9e1abc-2335-4838-949d-8ab8af0dd8c9",className:"back-button"},Kt.createElement("button",{className:"option abs right mt-5 small"},"Leave Feedback"))),R&&Kt.createElement("div",{className:"loading-overlay"},Kt.createElement("div",{className:"loading-content"},"Loading incident data...")),G&&Kt.createElement("div",{className:"error-overlay"},G),Kt.createElement("div",{id:"map",className:"fullscreen-map"}))}FP.createRoot(document.getElementById("root")).render(Kt.createElement(Kt.StrictMode,null,Kt.createElement(JC,null,Kt.createElement(AC,null,Kt.createElement(Qm,{path:"/",element:Kt.createElement(W1,null)}),Kt.createElement(Qm,{path:"/client",element:Kt.createElement(W1,null)}),Kt.createElement(Qm,{path:"/map",element:Kt.createElement(ZT,null)}),Kt.createElement(Qm,{path:"/client/map",element:Kt.createElement(ZT,null)})))));
