(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))a(d);new MutationObserver(d=>{for(const m of d)if(m.type==="childList")for(const g of m.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&a(g)}).observe(document,{childList:!0,subtree:!0});function t(d){const m={};return d.integrity&&(m.integrity=d.integrity),d.referrerPolicy&&(m.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?m.credentials="include":d.crossOrigin==="anonymous"?m.credentials="omit":m.credentials="same-origin",m}function a(d){if(d.ep)return;d.ep=!0;const m=t(d);fetch(d.href,m)}})();function Ry(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var fx={exports:{}},B_={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $2;function cR(){if($2)return B_;$2=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(a,d,m){var g=null;if(m!==void 0&&(g=""+m),d.key!==void 0&&(g=""+d.key),"key"in d){m={};for(var c in d)c!=="key"&&(m[c]=d[c])}else m=d;return d=m.ref,{$$typeof:n,type:a,key:g,ref:d!==void 0?d:null,props:m}}return B_.Fragment=e,B_.jsx=t,B_.jsxs=t,B_}var q2;function hR(){return q2||(q2=1,fx.exports=cR()),fx.exports}var Ee=hR(),px={exports:{}},ai={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var G2;function dR(){if(G2)return ai;G2=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),d=Symbol.for("react.profiler"),m=Symbol.for("react.consumer"),g=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),C=Symbol.for("react.suspense"),R=Symbol.for("react.memo"),V=Symbol.for("react.lazy"),q=Symbol.for("react.activity"),J=Symbol.iterator;function Y(Le){return Le===null||typeof Le!="object"?null:(Le=J&&Le[J]||Le["@@iterator"],typeof Le=="function"?Le:null)}var xe={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},be=Object.assign,Oe={};function et(Le,vt,Ot){this.props=Le,this.context=vt,this.refs=Oe,this.updater=Ot||xe}et.prototype.isReactComponent={},et.prototype.setState=function(Le,vt){if(typeof Le!="object"&&typeof Le!="function"&&Le!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,Le,vt,"setState")},et.prototype.forceUpdate=function(Le){this.updater.enqueueForceUpdate(this,Le,"forceUpdate")};function Je(){}Je.prototype=et.prototype;function qe(Le,vt,Ot){this.props=Le,this.context=vt,this.refs=Oe,this.updater=Ot||xe}var Ze=qe.prototype=new Je;Ze.constructor=qe,be(Ze,et.prototype),Ze.isPureReactComponent=!0;var je=Array.isArray;function Be(){}var de={H:null,A:null,T:null,S:null},ce=Object.prototype.hasOwnProperty;function _e(Le,vt,Ot){var Ut=Ot.ref;return{$$typeof:n,type:Le,key:vt,ref:Ut!==void 0?Ut:null,props:Ot}}function Ae(Le,vt){return _e(Le.type,vt,Le.props)}function Me(Le){return typeof Le=="object"&&Le!==null&&Le.$$typeof===n}function Ge(Le){var vt={"=":"=0",":":"=2"};return"$"+Le.replace(/[=:]/g,function(Ot){return vt[Ot]})}var Re=/\/+/g;function Pn(Le,vt){return typeof Le=="object"&&Le!==null&&Le.key!=null?Ge(""+Le.key):vt.toString(36)}function ei(Le){switch(Le.status){case"fulfilled":return Le.value;case"rejected":throw Le.reason;default:switch(typeof Le.status=="string"?Le.then(Be,Be):(Le.status="pending",Le.then(function(vt){Le.status==="pending"&&(Le.status="fulfilled",Le.value=vt)},function(vt){Le.status==="pending"&&(Le.status="rejected",Le.reason=vt)})),Le.status){case"fulfilled":return Le.value;case"rejected":throw Le.reason}}throw Le}function mt(Le,vt,Ot,Ut,Jt){var Wt=typeof Le;(Wt==="undefined"||Wt==="boolean")&&(Le=null);var Fn=!1;if(Le===null)Fn=!0;else switch(Wt){case"bigint":case"string":case"number":Fn=!0;break;case"object":switch(Le.$$typeof){case n:case e:Fn=!0;break;case V:return Fn=Le._init,mt(Fn(Le._payload),vt,Ot,Ut,Jt)}}if(Fn)return Jt=Jt(Le),Fn=Ut===""?"."+Pn(Le,0):Ut,je(Jt)?(Ot="",Fn!=null&&(Ot=Fn.replace(Re,"$&/")+"/"),mt(Jt,vt,Ot,"",function(fs){return fs})):Jt!=null&&(Me(Jt)&&(Jt=Ae(Jt,Ot+(Jt.key==null||Le&&Le.key===Jt.key?"":(""+Jt.key).replace(Re,"$&/")+"/")+Fn)),vt.push(Jt)),1;Fn=0;var oi=Ut===""?".":Ut+":";if(je(Le))for(var fi=0;fi<Le.length;fi++)Ut=Le[fi],Wt=oi+Pn(Ut,fi),Fn+=mt(Ut,vt,Ot,Wt,Jt);else if(fi=Y(Le),typeof fi=="function")for(Le=fi.call(Le),fi=0;!(Ut=Le.next()).done;)Ut=Ut.value,Wt=oi+Pn(Ut,fi++),Fn+=mt(Ut,vt,Ot,Wt,Jt);else if(Wt==="object"){if(typeof Le.then=="function")return mt(ei(Le),vt,Ot,Ut,Jt);throw vt=String(Le),Error("Objects are not valid as a React child (found: "+(vt==="[object Object]"?"object with keys {"+Object.keys(Le).join(", ")+"}":vt)+"). If you meant to render a collection of children, use an array instead.")}return Fn}function $t(Le,vt,Ot){if(Le==null)return Le;var Ut=[],Jt=0;return mt(Le,Ut,"","",function(Wt){return vt.call(Ot,Wt,Jt++)}),Ut}function Tt(Le){if(Le._status===-1){var vt=Le._result;vt=vt(),vt.then(function(Ot){(Le._status===0||Le._status===-1)&&(Le._status=1,Le._result=Ot)},function(Ot){(Le._status===0||Le._status===-1)&&(Le._status=2,Le._result=Ot)}),Le._status===-1&&(Le._status=0,Le._result=vt)}if(Le._status===1)return Le._result.default;throw Le._result}var zt=typeof reportError=="function"?reportError:function(Le){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var vt=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof Le=="object"&&Le!==null&&typeof Le.message=="string"?String(Le.message):String(Le),error:Le});if(!window.dispatchEvent(vt))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",Le);return}console.error(Le)},Bt={map:$t,forEach:function(Le,vt,Ot){$t(Le,function(){vt.apply(this,arguments)},Ot)},count:function(Le){var vt=0;return $t(Le,function(){vt++}),vt},toArray:function(Le){return $t(Le,function(vt){return vt})||[]},only:function(Le){if(!Me(Le))throw Error("React.Children.only expected to receive a single React element child.");return Le}};return ai.Activity=q,ai.Children=Bt,ai.Component=et,ai.Fragment=t,ai.Profiler=d,ai.PureComponent=qe,ai.StrictMode=a,ai.Suspense=C,ai.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=de,ai.__COMPILER_RUNTIME={__proto__:null,c:function(Le){return de.H.useMemoCache(Le)}},ai.cache=function(Le){return function(){return Le.apply(null,arguments)}},ai.cacheSignal=function(){return null},ai.cloneElement=function(Le,vt,Ot){if(Le==null)throw Error("The argument must be a React element, but you passed "+Le+".");var Ut=be({},Le.props),Jt=Le.key;if(vt!=null)for(Wt in vt.key!==void 0&&(Jt=""+vt.key),vt)!ce.call(vt,Wt)||Wt==="key"||Wt==="__self"||Wt==="__source"||Wt==="ref"&&vt.ref===void 0||(Ut[Wt]=vt[Wt]);var Wt=arguments.length-2;if(Wt===1)Ut.children=Ot;else if(1<Wt){for(var Fn=Array(Wt),oi=0;oi<Wt;oi++)Fn[oi]=arguments[oi+2];Ut.children=Fn}return _e(Le.type,Jt,Ut)},ai.createContext=function(Le){return Le={$$typeof:g,_currentValue:Le,_currentValue2:Le,_threadCount:0,Provider:null,Consumer:null},Le.Provider=Le,Le.Consumer={$$typeof:m,_context:Le},Le},ai.createElement=function(Le,vt,Ot){var Ut,Jt={},Wt=null;if(vt!=null)for(Ut in vt.key!==void 0&&(Wt=""+vt.key),vt)ce.call(vt,Ut)&&Ut!=="key"&&Ut!=="__self"&&Ut!=="__source"&&(Jt[Ut]=vt[Ut]);var Fn=arguments.length-2;if(Fn===1)Jt.children=Ot;else if(1<Fn){for(var oi=Array(Fn),fi=0;fi<Fn;fi++)oi[fi]=arguments[fi+2];Jt.children=oi}if(Le&&Le.defaultProps)for(Ut in Fn=Le.defaultProps,Fn)Jt[Ut]===void 0&&(Jt[Ut]=Fn[Ut]);return _e(Le,Wt,Jt)},ai.createRef=function(){return{current:null}},ai.forwardRef=function(Le){return{$$typeof:c,render:Le}},ai.isValidElement=Me,ai.lazy=function(Le){return{$$typeof:V,_payload:{_status:-1,_result:Le},_init:Tt}},ai.memo=function(Le,vt){return{$$typeof:R,type:Le,compare:vt===void 0?null:vt}},ai.startTransition=function(Le){var vt=de.T,Ot={};de.T=Ot;try{var Ut=Le(),Jt=de.S;Jt!==null&&Jt(Ot,Ut),typeof Ut=="object"&&Ut!==null&&typeof Ut.then=="function"&&Ut.then(Be,zt)}catch(Wt){zt(Wt)}finally{vt!==null&&Ot.types!==null&&(vt.types=Ot.types),de.T=vt}},ai.unstable_useCacheRefresh=function(){return de.H.useCacheRefresh()},ai.use=function(Le){return de.H.use(Le)},ai.useActionState=function(Le,vt,Ot){return de.H.useActionState(Le,vt,Ot)},ai.useCallback=function(Le,vt){return de.H.useCallback(Le,vt)},ai.useContext=function(Le){return de.H.useContext(Le)},ai.useDebugValue=function(){},ai.useDeferredValue=function(Le,vt){return de.H.useDeferredValue(Le,vt)},ai.useEffect=function(Le,vt){return de.H.useEffect(Le,vt)},ai.useEffectEvent=function(Le){return de.H.useEffectEvent(Le)},ai.useId=function(){return de.H.useId()},ai.useImperativeHandle=function(Le,vt,Ot){return de.H.useImperativeHandle(Le,vt,Ot)},ai.useInsertionEffect=function(Le,vt){return de.H.useInsertionEffect(Le,vt)},ai.useLayoutEffect=function(Le,vt){return de.H.useLayoutEffect(Le,vt)},ai.useMemo=function(Le,vt){return de.H.useMemo(Le,vt)},ai.useOptimistic=function(Le,vt){return de.H.useOptimistic(Le,vt)},ai.useReducer=function(Le,vt,Ot){return de.H.useReducer(Le,vt,Ot)},ai.useRef=function(Le){return de.H.useRef(Le)},ai.useState=function(Le){return de.H.useState(Le)},ai.useSyncExternalStore=function(Le,vt,Ot){return de.H.useSyncExternalStore(Le,vt,Ot)},ai.useTransition=function(){return de.H.useTransition()},ai.version="19.2.0",ai}var H2;function aw(){return H2||(H2=1,px.exports=dR()),px.exports}var wt=aw();const dA=Ry(wt);var mx={exports:{}},F_={},gx={exports:{}},_x={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Z2;function fR(){return Z2||(Z2=1,(function(n){function e(mt,$t){var Tt=mt.length;mt.push($t);e:for(;0<Tt;){var zt=Tt-1>>>1,Bt=mt[zt];if(0<d(Bt,$t))mt[zt]=$t,mt[Tt]=Bt,Tt=zt;else break e}}function t(mt){return mt.length===0?null:mt[0]}function a(mt){if(mt.length===0)return null;var $t=mt[0],Tt=mt.pop();if(Tt!==$t){mt[0]=Tt;e:for(var zt=0,Bt=mt.length,Le=Bt>>>1;zt<Le;){var vt=2*(zt+1)-1,Ot=mt[vt],Ut=vt+1,Jt=mt[Ut];if(0>d(Ot,Tt))Ut<Bt&&0>d(Jt,Ot)?(mt[zt]=Jt,mt[Ut]=Tt,zt=Ut):(mt[zt]=Ot,mt[vt]=Tt,zt=vt);else if(Ut<Bt&&0>d(Jt,Tt))mt[zt]=Jt,mt[Ut]=Tt,zt=Ut;else break e}}return $t}function d(mt,$t){var Tt=mt.sortIndex-$t.sortIndex;return Tt!==0?Tt:mt.id-$t.id}if(n.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var m=performance;n.unstable_now=function(){return m.now()}}else{var g=Date,c=g.now();n.unstable_now=function(){return g.now()-c}}var C=[],R=[],V=1,q=null,J=3,Y=!1,xe=!1,be=!1,Oe=!1,et=typeof setTimeout=="function"?setTimeout:null,Je=typeof clearTimeout=="function"?clearTimeout:null,qe=typeof setImmediate<"u"?setImmediate:null;function Ze(mt){for(var $t=t(R);$t!==null;){if($t.callback===null)a(R);else if($t.startTime<=mt)a(R),$t.sortIndex=$t.expirationTime,e(C,$t);else break;$t=t(R)}}function je(mt){if(be=!1,Ze(mt),!xe)if(t(C)!==null)xe=!0,Be||(Be=!0,Ge());else{var $t=t(R);$t!==null&&ei(je,$t.startTime-mt)}}var Be=!1,de=-1,ce=5,_e=-1;function Ae(){return Oe?!0:!(n.unstable_now()-_e<ce)}function Me(){if(Oe=!1,Be){var mt=n.unstable_now();_e=mt;var $t=!0;try{e:{xe=!1,be&&(be=!1,Je(de),de=-1),Y=!0;var Tt=J;try{t:{for(Ze(mt),q=t(C);q!==null&&!(q.expirationTime>mt&&Ae());){var zt=q.callback;if(typeof zt=="function"){q.callback=null,J=q.priorityLevel;var Bt=zt(q.expirationTime<=mt);if(mt=n.unstable_now(),typeof Bt=="function"){q.callback=Bt,Ze(mt),$t=!0;break t}q===t(C)&&a(C),Ze(mt)}else a(C);q=t(C)}if(q!==null)$t=!0;else{var Le=t(R);Le!==null&&ei(je,Le.startTime-mt),$t=!1}}break e}finally{q=null,J=Tt,Y=!1}$t=void 0}}finally{$t?Ge():Be=!1}}}var Ge;if(typeof qe=="function")Ge=function(){qe(Me)};else if(typeof MessageChannel<"u"){var Re=new MessageChannel,Pn=Re.port2;Re.port1.onmessage=Me,Ge=function(){Pn.postMessage(null)}}else Ge=function(){et(Me,0)};function ei(mt,$t){de=et(function(){mt(n.unstable_now())},$t)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(mt){mt.callback=null},n.unstable_forceFrameRate=function(mt){0>mt||125<mt?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ce=0<mt?Math.floor(1e3/mt):5},n.unstable_getCurrentPriorityLevel=function(){return J},n.unstable_next=function(mt){switch(J){case 1:case 2:case 3:var $t=3;break;default:$t=J}var Tt=J;J=$t;try{return mt()}finally{J=Tt}},n.unstable_requestPaint=function(){Oe=!0},n.unstable_runWithPriority=function(mt,$t){switch(mt){case 1:case 2:case 3:case 4:case 5:break;default:mt=3}var Tt=J;J=mt;try{return $t()}finally{J=Tt}},n.unstable_scheduleCallback=function(mt,$t,Tt){var zt=n.unstable_now();switch(typeof Tt=="object"&&Tt!==null?(Tt=Tt.delay,Tt=typeof Tt=="number"&&0<Tt?zt+Tt:zt):Tt=zt,mt){case 1:var Bt=-1;break;case 2:Bt=250;break;case 5:Bt=1073741823;break;case 4:Bt=1e4;break;default:Bt=5e3}return Bt=Tt+Bt,mt={id:V++,callback:$t,priorityLevel:mt,startTime:Tt,expirationTime:Bt,sortIndex:-1},Tt>zt?(mt.sortIndex=Tt,e(R,mt),t(C)===null&&mt===t(R)&&(be?(Je(de),de=-1):be=!0,ei(je,Tt-zt))):(mt.sortIndex=Bt,e(C,mt),xe||Y||(xe=!0,Be||(Be=!0,Ge()))),mt},n.unstable_shouldYield=Ae,n.unstable_wrapCallback=function(mt){var $t=J;return function(){var Tt=J;J=$t;try{return mt.apply(this,arguments)}finally{J=Tt}}}})(_x)),_x}var W2;function pR(){return W2||(W2=1,gx.exports=fR()),gx.exports}var yx={exports:{}},Il={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var K2;function mR(){if(K2)return Il;K2=1;var n=aw();function e(C){var R="https://react.dev/errors/"+C;if(1<arguments.length){R+="?args[]="+encodeURIComponent(arguments[1]);for(var V=2;V<arguments.length;V++)R+="&args[]="+encodeURIComponent(arguments[V])}return"Minified React error #"+C+"; visit "+R+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var a={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},d=Symbol.for("react.portal");function m(C,R,V){var q=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:d,key:q==null?null:""+q,children:C,containerInfo:R,implementation:V}}var g=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function c(C,R){if(C==="font")return"";if(typeof R=="string")return R==="use-credentials"?R:""}return Il.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=a,Il.createPortal=function(C,R){var V=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!R||R.nodeType!==1&&R.nodeType!==9&&R.nodeType!==11)throw Error(e(299));return m(C,R,null,V)},Il.flushSync=function(C){var R=g.T,V=a.p;try{if(g.T=null,a.p=2,C)return C()}finally{g.T=R,a.p=V,a.d.f()}},Il.preconnect=function(C,R){typeof C=="string"&&(R?(R=R.crossOrigin,R=typeof R=="string"?R==="use-credentials"?R:"":void 0):R=null,a.d.C(C,R))},Il.prefetchDNS=function(C){typeof C=="string"&&a.d.D(C)},Il.preinit=function(C,R){if(typeof C=="string"&&R&&typeof R.as=="string"){var V=R.as,q=c(V,R.crossOrigin),J=typeof R.integrity=="string"?R.integrity:void 0,Y=typeof R.fetchPriority=="string"?R.fetchPriority:void 0;V==="style"?a.d.S(C,typeof R.precedence=="string"?R.precedence:void 0,{crossOrigin:q,integrity:J,fetchPriority:Y}):V==="script"&&a.d.X(C,{crossOrigin:q,integrity:J,fetchPriority:Y,nonce:typeof R.nonce=="string"?R.nonce:void 0})}},Il.preinitModule=function(C,R){if(typeof C=="string")if(typeof R=="object"&&R!==null){if(R.as==null||R.as==="script"){var V=c(R.as,R.crossOrigin);a.d.M(C,{crossOrigin:V,integrity:typeof R.integrity=="string"?R.integrity:void 0,nonce:typeof R.nonce=="string"?R.nonce:void 0})}}else R==null&&a.d.M(C)},Il.preload=function(C,R){if(typeof C=="string"&&typeof R=="object"&&R!==null&&typeof R.as=="string"){var V=R.as,q=c(V,R.crossOrigin);a.d.L(C,V,{crossOrigin:q,integrity:typeof R.integrity=="string"?R.integrity:void 0,nonce:typeof R.nonce=="string"?R.nonce:void 0,type:typeof R.type=="string"?R.type:void 0,fetchPriority:typeof R.fetchPriority=="string"?R.fetchPriority:void 0,referrerPolicy:typeof R.referrerPolicy=="string"?R.referrerPolicy:void 0,imageSrcSet:typeof R.imageSrcSet=="string"?R.imageSrcSet:void 0,imageSizes:typeof R.imageSizes=="string"?R.imageSizes:void 0,media:typeof R.media=="string"?R.media:void 0})}},Il.preloadModule=function(C,R){if(typeof C=="string")if(R){var V=c(R.as,R.crossOrigin);a.d.m(C,{as:typeof R.as=="string"&&R.as!=="script"?R.as:void 0,crossOrigin:V,integrity:typeof R.integrity=="string"?R.integrity:void 0})}else a.d.m(C)},Il.requestFormReset=function(C){a.d.r(C)},Il.unstable_batchedUpdates=function(C,R){return C(R)},Il.useFormState=function(C,R,V){return g.H.useFormState(C,R,V)},Il.useFormStatus=function(){return g.H.useHostTransitionStatus()},Il.version="19.2.0",Il}var X2;function gR(){if(X2)return yx.exports;X2=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),yx.exports=mR(),yx.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Y2;function _R(){if(Y2)return F_;Y2=1;var n=pR(),e=aw(),t=gR();function a(s){var h="https://react.dev/errors/"+s;if(1<arguments.length){h+="?args[]="+encodeURIComponent(arguments[1]);for(var y=2;y<arguments.length;y++)h+="&args[]="+encodeURIComponent(arguments[y])}return"Minified React error #"+s+"; visit "+h+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function d(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11)}function m(s){var h=s,y=s;if(s.alternate)for(;h.return;)h=h.return;else{s=h;do h=s,(h.flags&4098)!==0&&(y=h.return),s=h.return;while(s)}return h.tag===3?y:null}function g(s){if(s.tag===13){var h=s.memoizedState;if(h===null&&(s=s.alternate,s!==null&&(h=s.memoizedState)),h!==null)return h.dehydrated}return null}function c(s){if(s.tag===31){var h=s.memoizedState;if(h===null&&(s=s.alternate,s!==null&&(h=s.memoizedState)),h!==null)return h.dehydrated}return null}function C(s){if(m(s)!==s)throw Error(a(188))}function R(s){var h=s.alternate;if(!h){if(h=m(s),h===null)throw Error(a(188));return h!==s?null:s}for(var y=s,w=h;;){var D=y.return;if(D===null)break;var B=D.alternate;if(B===null){if(w=D.return,w!==null){y=w;continue}break}if(D.child===B.child){for(B=D.child;B;){if(B===y)return C(D),s;if(B===w)return C(D),h;B=B.sibling}throw Error(a(188))}if(y.return!==w.return)y=D,w=B;else{for(var Q=!1,he=D.child;he;){if(he===y){Q=!0,y=D,w=B;break}if(he===w){Q=!0,w=D,y=B;break}he=he.sibling}if(!Q){for(he=B.child;he;){if(he===y){Q=!0,y=B,w=D;break}if(he===w){Q=!0,w=B,y=D;break}he=he.sibling}if(!Q)throw Error(a(189))}}if(y.alternate!==w)throw Error(a(190))}if(y.tag!==3)throw Error(a(188));return y.stateNode.current===y?s:h}function V(s){var h=s.tag;if(h===5||h===26||h===27||h===6)return s;for(s=s.child;s!==null;){if(h=V(s),h!==null)return h;s=s.sibling}return null}var q=Object.assign,J=Symbol.for("react.element"),Y=Symbol.for("react.transitional.element"),xe=Symbol.for("react.portal"),be=Symbol.for("react.fragment"),Oe=Symbol.for("react.strict_mode"),et=Symbol.for("react.profiler"),Je=Symbol.for("react.consumer"),qe=Symbol.for("react.context"),Ze=Symbol.for("react.forward_ref"),je=Symbol.for("react.suspense"),Be=Symbol.for("react.suspense_list"),de=Symbol.for("react.memo"),ce=Symbol.for("react.lazy"),_e=Symbol.for("react.activity"),Ae=Symbol.for("react.memo_cache_sentinel"),Me=Symbol.iterator;function Ge(s){return s===null||typeof s!="object"?null:(s=Me&&s[Me]||s["@@iterator"],typeof s=="function"?s:null)}var Re=Symbol.for("react.client.reference");function Pn(s){if(s==null)return null;if(typeof s=="function")return s.$$typeof===Re?null:s.displayName||s.name||null;if(typeof s=="string")return s;switch(s){case be:return"Fragment";case et:return"Profiler";case Oe:return"StrictMode";case je:return"Suspense";case Be:return"SuspenseList";case _e:return"Activity"}if(typeof s=="object")switch(s.$$typeof){case xe:return"Portal";case qe:return s.displayName||"Context";case Je:return(s._context.displayName||"Context")+".Consumer";case Ze:var h=s.render;return s=s.displayName,s||(s=h.displayName||h.name||"",s=s!==""?"ForwardRef("+s+")":"ForwardRef"),s;case de:return h=s.displayName||null,h!==null?h:Pn(s.type)||"Memo";case ce:h=s._payload,s=s._init;try{return Pn(s(h))}catch{}}return null}var ei=Array.isArray,mt=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,$t=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Tt={pending:!1,data:null,method:null,action:null},zt=[],Bt=-1;function Le(s){return{current:s}}function vt(s){0>Bt||(s.current=zt[Bt],zt[Bt]=null,Bt--)}function Ot(s,h){Bt++,zt[Bt]=s.current,s.current=h}var Ut=Le(null),Jt=Le(null),Wt=Le(null),Fn=Le(null);function oi(s,h){switch(Ot(Wt,h),Ot(Jt,s),Ot(Ut,null),h.nodeType){case 9:case 11:s=(s=h.documentElement)&&(s=s.namespaceURI)?Sp(s):0;break;default:if(s=h.tagName,h=h.namespaceURI)h=Sp(h),s=Ep(h,s);else switch(s){case"svg":s=1;break;case"math":s=2;break;default:s=0}}vt(Ut),Ot(Ut,s)}function fi(){vt(Ut),vt(Jt),vt(Wt)}function fs(s){s.memoizedState!==null&&Ot(Fn,s);var h=Ut.current,y=Ep(h,s.type);h!==y&&(Ot(Jt,s),Ot(Ut,y))}function Bs(s){Jt.current===s&&(vt(Ut),vt(Jt)),Fn.current===s&&(vt(Fn),Qn._currentValue=Tt)}var Dr,Fi;function Mi(s){if(Dr===void 0)try{throw Error()}catch(y){var h=y.stack.trim().match(/\n( *(at )?)/);Dr=h&&h[1]||"",Fi=-1<y.stack.indexOf(`
    at`)?" (<anonymous>)":-1<y.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Dr+s+Fi}var Ua=!1;function Sa(s,h){if(!s||Ua)return"";Ua=!0;var y=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var w={DetermineComponentFrameRoot:function(){try{if(h){var Et=function(){throw Error()};if(Object.defineProperty(Et.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Et,[])}catch(yt){var ft=yt}Reflect.construct(s,[],Et)}else{try{Et.call()}catch(yt){ft=yt}s.call(Et.prototype)}}else{try{throw Error()}catch(yt){ft=yt}(Et=s())&&typeof Et.catch=="function"&&Et.catch(function(){})}}catch(yt){if(yt&&ft&&typeof yt.stack=="string")return[yt.stack,ft.stack]}return[null,null]}};w.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var D=Object.getOwnPropertyDescriptor(w.DetermineComponentFrameRoot,"name");D&&D.configurable&&Object.defineProperty(w.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var B=w.DetermineComponentFrameRoot(),Q=B[0],he=B[1];if(Q&&he){var Ue=Q.split(`
`),dt=he.split(`
`);for(D=w=0;w<Ue.length&&!Ue[w].includes("DetermineComponentFrameRoot");)w++;for(;D<dt.length&&!dt[D].includes("DetermineComponentFrameRoot");)D++;if(w===Ue.length||D===dt.length)for(w=Ue.length-1,D=dt.length-1;1<=w&&0<=D&&Ue[w]!==dt[D];)D--;for(;1<=w&&0<=D;w--,D--)if(Ue[w]!==dt[D]){if(w!==1||D!==1)do if(w--,D--,0>D||Ue[w]!==dt[D]){var bt=`
`+Ue[w].replace(" at new "," at ");return s.displayName&&bt.includes("<anonymous>")&&(bt=bt.replace("<anonymous>",s.displayName)),bt}while(1<=w&&0<=D);break}}}finally{Ua=!1,Error.prepareStackTrace=y}return(y=s?s.displayName||s.name:"")?Mi(y):""}function Fs(s,h){switch(s.tag){case 26:case 27:case 5:return Mi(s.type);case 16:return Mi("Lazy");case 13:return s.child!==h&&h!==null?Mi("Suspense Fallback"):Mi("Suspense");case 19:return Mi("SuspenseList");case 0:case 15:return Sa(s.type,!1);case 11:return Sa(s.type.render,!1);case 1:return Sa(s.type,!0);case 31:return Mi("Activity");default:return""}}function Ea(s){try{var h="",y=null;do h+=Fs(s,y),y=s,s=s.return;while(s);return h}catch(w){return`
Error generating stack: `+w.message+`
`+w.stack}}var Vi=Object.prototype.hasOwnProperty,pr=n.unstable_scheduleCallback,Aa=n.unstable_cancelCallback,Eo=n.unstable_shouldYield,oo=n.unstable_requestPaint,qr=n.unstable_now,ps=n.unstable_getCurrentPriorityLevel,ms=n.unstable_ImmediatePriority,Vs=n.unstable_UserBlockingPriority,gs=n.unstable_NormalPriority,Xe=n.unstable_LowPriority,se=n.unstable_IdlePriority,le=n.log,fe=n.unstable_setDisableYieldValue,Se=null,De=null;function He(s){if(typeof le=="function"&&fe(s),De&&typeof De.setStrictMode=="function")try{De.setStrictMode(Se,s)}catch{}}var tt=Math.clz32?Math.clz32:Pt,We=Math.log,_t=Math.LN2;function Pt(s){return s>>>=0,s===0?32:31-(We(s)/_t|0)|0}var xt=256,tn=262144,$e=4194304;function vn(s){var h=s&42;if(h!==0)return h;switch(s&-s){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return s&261888;case 262144:case 524288:case 1048576:case 2097152:return s&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return s&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return s}}function Rn(s,h,y){var w=s.pendingLanes;if(w===0)return 0;var D=0,B=s.suspendedLanes,Q=s.pingedLanes;s=s.warmLanes;var he=w&134217727;return he!==0?(w=he&~B,w!==0?D=vn(w):(Q&=he,Q!==0?D=vn(Q):y||(y=he&~s,y!==0&&(D=vn(y))))):(he=w&~B,he!==0?D=vn(he):Q!==0?D=vn(Q):y||(y=w&~s,y!==0&&(D=vn(y)))),D===0?0:h!==0&&h!==D&&(h&B)===0&&(B=D&-D,y=h&-h,B>=y||B===32&&(y&4194048)!==0)?h:D}function nn(s,h){return(s.pendingLanes&~(s.suspendedLanes&~s.pingedLanes)&h)===0}function Nn(s,h){switch(s){case 1:case 2:case 4:case 8:case 64:return h+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return h+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Ri(){var s=$e;return $e<<=1,($e&62914560)===0&&($e=4194304),s}function Gi(s){for(var h=[],y=0;31>y;y++)h.push(s);return h}function tr(s,h){s.pendingLanes|=h,h!==268435456&&(s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0)}function Ir(s,h,y,w,D,B){var Q=s.pendingLanes;s.pendingLanes=y,s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0,s.expiredLanes&=y,s.entangledLanes&=y,s.errorRecoveryDisabledLanes&=y,s.shellSuspendCounter=0;var he=s.entanglements,Ue=s.expirationTimes,dt=s.hiddenUpdates;for(y=Q&~y;0<y;){var bt=31-tt(y),Et=1<<bt;he[bt]=0,Ue[bt]=-1;var ft=dt[bt];if(ft!==null)for(dt[bt]=null,bt=0;bt<ft.length;bt++){var yt=ft[bt];yt!==null&&(yt.lane&=-536870913)}y&=~Et}w!==0&&Vn(s,w,0),B!==0&&D===0&&s.tag!==0&&(s.suspendedLanes|=B&~(Q&~h))}function Vn(s,h,y){s.pendingLanes|=h,s.suspendedLanes&=~h;var w=31-tt(h);s.entangledLanes|=h,s.entanglements[w]=s.entanglements[w]|1073741824|y&261930}function Xn(s,h){var y=s.entangledLanes|=h;for(s=s.entanglements;y;){var w=31-tt(y),D=1<<w;D&h|s[w]&h&&(s[w]|=h),y&=~D}}function br(s,h){var y=h&-h;return y=(y&42)!==0?1:Mt(y),(y&(s.suspendedLanes|h))!==0?0:y}function Mt(s){switch(s){case 2:s=1;break;case 8:s=4;break;case 32:s=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:s=128;break;case 268435456:s=134217728;break;default:s=0}return s}function en(s){return s&=-s,2<s?8<s?(s&134217727)!==0?32:268435456:8:2}function nr(){var s=$t.p;return s!==0?s:(s=window.event,s===void 0?32:Na(s.type))}function na(s,h){var y=$t.p;try{return $t.p=s,h()}finally{$t.p=y}}var Ca=Math.random().toString(36).slice(2),kt="__reactFiber$"+Ca,yn="__reactProps$"+Ca,In="__reactContainer$"+Ca,ir="__reactEvents$"+Ca,rl="__reactListeners$"+Ca,Ao="__reactHandles$"+Ca,Bn="__reactResources$"+Ca,Us="__reactMarker$"+Ca;function js(s){delete s[kt],delete s[yn],delete s[ir],delete s[rl],delete s[Ao]}function _s(s){var h=s[kt];if(h)return h;for(var y=s.parentNode;y;){if(h=y[In]||y[kt]){if(y=h.alternate,h.child!==null||y!==null&&y.child!==null)for(s=Ip(s);s!==null;){if(y=s[kt])return y;s=Ip(s)}return h}s=y,y=s.parentNode}return null}function Gr(s){if(s=s[kt]||s[In]){var h=s.tag;if(h===5||h===6||h===13||h===31||h===26||h===27||h===3)return s}return null}function Hr(s){var h=s.tag;if(h===5||h===26||h===27||h===6)return s.stateNode;throw Error(a(33))}function Ei(s){var h=s[Bn];return h||(h=s[Bn]={hoistableStyles:new Map,hoistableScripts:new Map}),h}function Pr(s){s[Us]=!0}var fa=new Set,wi={};function Co(s,h){ja(s,h),ja(s+"Capture",h)}function ja(s,h){for(wi[s]=h,s=0;s<h.length;s++)fa.add(h[s])}var Io=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),$s={},qs={};function al(s){return Vi.call(qs,s)?!0:Vi.call($s,s)?!1:Io.test(s)?qs[s]=!0:($s[s]=!0,!1)}function ii(s,h,y){if(al(h))if(y===null)s.removeAttribute(h);else{switch(typeof y){case"undefined":case"function":case"symbol":s.removeAttribute(h);return;case"boolean":var w=h.toLowerCase().slice(0,5);if(w!=="data-"&&w!=="aria-"){s.removeAttribute(h);return}}s.setAttribute(h,""+y)}}function hi(s,h,y){if(y===null)s.removeAttribute(h);else{switch(typeof y){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(h);return}s.setAttribute(h,""+y)}}function Hi(s,h,y,w){if(w===null)s.removeAttribute(y);else{switch(typeof w){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(y);return}s.setAttributeNS(h,y,""+w)}}function xr(s){switch(typeof s){case"bigint":case"boolean":case"number":case"string":case"undefined":return s;case"object":return s;default:return""}}function Gs(s){var h=s.type;return(s=s.nodeName)&&s.toLowerCase()==="input"&&(h==="checkbox"||h==="radio")}function fu(s,h,y){var w=Object.getOwnPropertyDescriptor(s.constructor.prototype,h);if(!s.hasOwnProperty(h)&&typeof w<"u"&&typeof w.get=="function"&&typeof w.set=="function"){var D=w.get,B=w.set;return Object.defineProperty(s,h,{configurable:!0,get:function(){return D.call(this)},set:function(Q){y=""+Q,B.call(this,Q)}}),Object.defineProperty(s,h,{enumerable:w.enumerable}),{getValue:function(){return y},setValue:function(Q){y=""+Q},stopTracking:function(){s._valueTracker=null,delete s[h]}}}}function on(s){if(!s._valueTracker){var h=Gs(s)?"checked":"value";s._valueTracker=fu(s,h,""+s[h])}}function Ui(s){if(!s)return!1;var h=s._valueTracker;if(!h)return!0;var y=h.getValue(),w="";return s&&(w=Gs(s)?s.checked?"true":"false":s.value),s=w,s!==y?(h.setValue(s),!0):!1}function Ia(s){if(s=s||(typeof document<"u"?document:void 0),typeof s>"u")return null;try{return s.activeElement||s.body}catch{return s.body}}var lo=/[\n"\\]/g;function rr(s){return s.replace(lo,function(h){return"\\"+h.charCodeAt(0).toString(16)+" "})}function Po(s,h,y,w,D,B,Q,he){s.name="",Q!=null&&typeof Q!="function"&&typeof Q!="symbol"&&typeof Q!="boolean"?s.type=Q:s.removeAttribute("type"),h!=null?Q==="number"?(h===0&&s.value===""||s.value!=h)&&(s.value=""+xr(h)):s.value!==""+xr(h)&&(s.value=""+xr(h)):Q!=="submit"&&Q!=="reset"||s.removeAttribute("value"),h!=null?Hs(s,Q,xr(h)):y!=null?Hs(s,Q,xr(y)):w!=null&&s.removeAttribute("value"),D==null&&B!=null&&(s.defaultChecked=!!B),D!=null&&(s.checked=D&&typeof D!="function"&&typeof D!="symbol"),he!=null&&typeof he!="function"&&typeof he!="symbol"&&typeof he!="boolean"?s.name=""+xr(he):s.removeAttribute("name")}function Dl(s,h,y,w,D,B,Q,he){if(B!=null&&typeof B!="function"&&typeof B!="symbol"&&typeof B!="boolean"&&(s.type=B),h!=null||y!=null){if(!(B!=="submit"&&B!=="reset"||h!=null)){on(s);return}y=y!=null?""+xr(y):"",h=h!=null?""+xr(h):y,he||h===s.value||(s.value=h),s.defaultValue=h}w=w??D,w=typeof w!="function"&&typeof w!="symbol"&&!!w,s.checked=he?s.checked:!!w,s.defaultChecked=!!w,Q!=null&&typeof Q!="function"&&typeof Q!="symbol"&&typeof Q!="boolean"&&(s.name=Q),on(s)}function Hs(s,h,y){h==="number"&&Ia(s.ownerDocument)===s||s.defaultValue===""+y||(s.defaultValue=""+y)}function ar(s,h,y,w){if(s=s.options,h){h={};for(var D=0;D<y.length;D++)h["$"+y[D]]=!0;for(y=0;y<s.length;y++)D=h.hasOwnProperty("$"+s[y].value),s[y].selected!==D&&(s[y].selected=D),D&&w&&(s[y].defaultSelected=!0)}else{for(y=""+xr(y),h=null,D=0;D<s.length;D++){if(s[D].value===y){s[D].selected=!0,w&&(s[D].defaultSelected=!0);return}h!==null||s[D].disabled||(h=s[D])}h!==null&&(h.selected=!0)}}function Ja(s,h,y){if(h!=null&&(h=""+xr(h),h!==s.value&&(s.value=h),y==null)){s.defaultValue!==h&&(s.defaultValue=h);return}s.defaultValue=y!=null?""+xr(y):""}function $a(s,h,y,w){if(h==null){if(w!=null){if(y!=null)throw Error(a(92));if(ei(w)){if(1<w.length)throw Error(a(93));w=w[0]}y=w}y==null&&(y=""),h=y}y=xr(h),s.defaultValue=y,w=s.textContent,w===y&&w!==""&&w!==null&&(s.value=w),on(s)}function Zi(s,h){if(h){var y=s.firstChild;if(y&&y===s.lastChild&&y.nodeType===3){y.nodeValue=h;return}}s.textContent=h}var Un=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function es(s,h,y){var w=h.indexOf("--")===0;y==null||typeof y=="boolean"||y===""?w?s.setProperty(h,""):h==="float"?s.cssFloat="":s[h]="":w?s.setProperty(h,y):typeof y!="number"||y===0||Un.has(h)?h==="float"?s.cssFloat=y:s[h]=(""+y).trim():s[h]=y+"px"}function ys(s,h,y){if(h!=null&&typeof h!="object")throw Error(a(62));if(s=s.style,y!=null){for(var w in y)!y.hasOwnProperty(w)||h!=null&&h.hasOwnProperty(w)||(w.indexOf("--")===0?s.setProperty(w,""):w==="float"?s.cssFloat="":s[w]="");for(var D in h)w=h[D],h.hasOwnProperty(D)&&y[D]!==w&&es(s,D,w)}else for(var B in h)h.hasOwnProperty(B)&&es(s,B,h[B])}function qa(s){if(s.indexOf("-")===-1)return!1;switch(s){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Zs=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),kn=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function vs(s){return kn.test(""+s)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":s}function Pa(){}var zl=null;function Wi(s){return s=s.target||s.srcElement||window,s.correspondingUseElement&&(s=s.correspondingUseElement),s.nodeType===3?s.parentNode:s}var mr=null,hn=null;function pi(s){var h=Gr(s);if(h&&(s=h.stateNode)){var y=s[yn]||null;e:switch(s=h.stateNode,h.type){case"input":if(Po(s,y.value,y.defaultValue,y.defaultValue,y.checked,y.defaultChecked,y.type,y.name),h=y.name,y.type==="radio"&&h!=null){for(y=s;y.parentNode;)y=y.parentNode;for(y=y.querySelectorAll('input[name="'+rr(""+h)+'"][type="radio"]'),h=0;h<y.length;h++){var w=y[h];if(w!==s&&w.form===s.form){var D=w[yn]||null;if(!D)throw Error(a(90));Po(w,D.value,D.defaultValue,D.defaultValue,D.checked,D.defaultChecked,D.type,D.name)}}for(h=0;h<y.length;h++)w=y[h],w.form===s.form&&Ui(w)}break e;case"textarea":Ja(s,y.value,y.defaultValue);break e;case"select":h=y.value,h!=null&&ar(s,!!y.multiple,h,!1)}}}var xn=!1;function sl(s,h,y){if(xn)return s(h,y);xn=!0;try{var w=s(h);return w}finally{if(xn=!1,(mr!==null||hn!==null)&&(Rd(),mr&&(h=mr,s=hn,hn=mr=null,pi(h),s)))for(h=0;h<s.length;h++)pi(s[h])}}function sr(s,h){var y=s.stateNode;if(y===null)return null;var w=y[yn]||null;if(w===null)return null;y=w[h];e:switch(h){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(w=!w.disabled)||(s=s.type,w=!(s==="button"||s==="input"||s==="select"||s==="textarea")),s=!w;break e;default:s=!1}if(s)return null;if(y&&typeof y!="function")throw Error(a(231,h,typeof y));return y}var cr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),wr=!1;if(cr)try{var bn={};Object.defineProperty(bn,"passive",{get:function(){wr=!0}}),window.addEventListener("test",bn,bn),window.removeEventListener("test",bn,bn)}catch{wr=!1}var pa=null,fn=null,sn=null;function ia(){if(sn)return sn;var s,h=fn,y=h.length,w,D="value"in pa?pa.value:pa.textContent,B=D.length;for(s=0;s<y&&h[s]===D[s];s++);var Q=y-s;for(w=1;w<=Q&&h[y-w]===D[B-w];w++);return sn=D.slice(s,1<w?1-w:void 0)}function $n(s){var h=s.keyCode;return"charCode"in s?(s=s.charCode,s===0&&h===13&&(s=13)):s=h,s===10&&(s=13),32<=s||s===13?s:0}function zr(){return!0}function Qr(){return!1}function or(s){function h(y,w,D,B,Q){this._reactName=y,this._targetInst=D,this.type=w,this.nativeEvent=B,this.target=Q,this.currentTarget=null;for(var he in s)s.hasOwnProperty(he)&&(y=s[he],this[he]=y?y(B):B[he]);return this.isDefaultPrevented=(B.defaultPrevented!=null?B.defaultPrevented:B.returnValue===!1)?zr:Qr,this.isPropagationStopped=Qr,this}return q(h.prototype,{preventDefault:function(){this.defaultPrevented=!0;var y=this.nativeEvent;y&&(y.preventDefault?y.preventDefault():typeof y.returnValue!="unknown"&&(y.returnValue=!1),this.isDefaultPrevented=zr)},stopPropagation:function(){var y=this.nativeEvent;y&&(y.stopPropagation?y.stopPropagation():typeof y.cancelBubble!="unknown"&&(y.cancelBubble=!0),this.isPropagationStopped=zr)},persist:function(){},isPersistent:zr}),h}var bs={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(s){return s.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},uo=or(bs),xs=q({},bs,{view:0,detail:0}),Wn=or(xs),Mo,ra,Ma,Ra=q({},xs,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:co,button:0,buttons:0,relatedTarget:function(s){return s.relatedTarget===void 0?s.fromElement===s.srcElement?s.toElement:s.fromElement:s.relatedTarget},movementX:function(s){return"movementX"in s?s.movementX:(s!==Ma&&(Ma&&s.type==="mousemove"?(Mo=s.screenX-Ma.screenX,ra=s.screenY-Ma.screenY):ra=Mo=0,Ma=s),Mo)},movementY:function(s){return"movementY"in s?s.movementY:ra}}),Or=or(Ra),ws=q({},Ra,{dataTransfer:0}),Zl=or(ws),Ro=q({},xs,{relatedTarget:0}),Ki=or(Ro),Zu=q({},bs,{animationName:0,elapsedTime:0,pseudoElement:0}),ol=or(Zu),Wl=q({},bs,{clipboardData:function(s){return"clipboardData"in s?s.clipboardData:window.clipboardData}}),Ws=or(Wl),Ol=q({},bs,{data:0}),lr=or(Ol),ts={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Ts={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Nl={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function ll(s){var h=this.nativeEvent;return h.getModifierState?h.getModifierState(s):(s=Nl[s])?!!h[s]:!1}function co(){return ll}var Ai=q({},xs,{key:function(s){if(s.key){var h=ts[s.key]||s.key;if(h!=="Unidentified")return h}return s.type==="keypress"?(s=$n(s),s===13?"Enter":String.fromCharCode(s)):s.type==="keydown"||s.type==="keyup"?Ts[s.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:co,charCode:function(s){return s.type==="keypress"?$n(s):0},keyCode:function(s){return s.type==="keydown"||s.type==="keyup"?s.keyCode:0},which:function(s){return s.type==="keypress"?$n(s):s.type==="keydown"||s.type==="keyup"?s.keyCode:0}}),Wu=or(Ai),pu=q({},Ra,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Bl=or(pu),M=q({},xs,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:co}),H=or(M),ne=q({},bs,{propertyName:0,elapsedTime:0,pseudoElement:0}),ye=or(ne),at=q({},Ra,{deltaX:function(s){return"deltaX"in s?s.deltaX:"wheelDeltaX"in s?-s.wheelDeltaX:0},deltaY:function(s){return"deltaY"in s?s.deltaY:"wheelDeltaY"in s?-s.wheelDeltaY:"wheelDelta"in s?-s.wheelDelta:0},deltaZ:0,deltaMode:0}),ht=or(at),Kt=q({},bs,{newState:0,oldState:0}),Ln=or(Kt),Kn=[9,13,27,32],Ti=cr&&"CompositionEvent"in window,Xi=null;cr&&"documentMode"in document&&(Xi=document.documentMode);var Ga=cr&&"TextEvent"in window&&!Xi,Ha=cr&&(!Ti||Xi&&8<Xi&&11>=Xi),Ks=" ",Ss=!1;function mu(s,h){switch(s){case"keyup":return Kn.indexOf(h.keyCode)!==-1;case"keydown":return h.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Xs(s){return s=s.detail,typeof s=="object"&&"data"in s?s.data:null}var gu=!1;function Ys(s,h){switch(s){case"compositionend":return Xs(h);case"keypress":return h.which!==32?null:(Ss=!0,Ks);case"textInput":return s=h.data,s===Ks&&Ss?null:s;default:return null}}function Ku(s,h){if(gu)return s==="compositionend"||!Ti&&mu(s,h)?(s=ia(),sn=fn=pa=null,gu=!1,s):null;switch(s){case"paste":return null;case"keypress":if(!(h.ctrlKey||h.altKey||h.metaKey)||h.ctrlKey&&h.altKey){if(h.char&&1<h.char.length)return h.char;if(h.which)return String.fromCharCode(h.which)}return null;case"compositionend":return Ha&&h.locale!=="ko"?null:h.data;default:return null}}var Jd={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function ho(s){var h=s&&s.nodeName&&s.nodeName.toLowerCase();return h==="input"?!!Jd[s.type]:h==="textarea"}function rd(s,h,y,w){mr?hn?hn.push(w):hn=[w]:mr=w,h=Tp(h,"onChange"),0<h.length&&(y=new uo("onChange","change",null,y,w),s.push({event:y,listeners:h}))}var Qs=null,Xu=null;function Yu(s){zm(s,0)}function ko(s){var h=Hr(s);if(Ui(h))return s}function _u(s,h){if(s==="change")return h}var yh=!1;if(cr){var Es;if(cr){var Qu="oninput"in document;if(!Qu){var Ju=document.createElement("div");Ju.setAttribute("oninput","return;"),Qu=typeof Ju.oninput=="function"}Es=Qu}else Es=!1;yh=Es&&(!document.documentMode||9<document.documentMode)}function Fc(){Qs&&(Qs.detachEvent("onpropertychange",ef),Xu=Qs=null)}function ef(s){if(s.propertyName==="value"&&ko(Xu)){var h=[];rd(h,Xu,s,Wi(s)),sl(Yu,h)}}function ul(s,h,y){s==="focusin"?(Fc(),Qs=h,Xu=y,Qs.attachEvent("onpropertychange",ef)):s==="focusout"&&Fc()}function tf(s){if(s==="selectionchange"||s==="keyup"||s==="keydown")return ko(Xu)}function Kl(s,h){if(s==="click")return ko(h)}function ad(s,h){if(s==="input"||s==="change")return ko(h)}function cl(s,h){return s===h&&(s!==0||1/s===1/h)||s!==s&&h!==h}var aa=typeof Object.is=="function"?Object.is:cl;function As(s,h){if(aa(s,h))return!0;if(typeof s!="object"||s===null||typeof h!="object"||h===null)return!1;var y=Object.keys(s),w=Object.keys(h);if(y.length!==w.length)return!1;for(w=0;w<y.length;w++){var D=y[w];if(!Vi.call(h,D)||!aa(s[D],h[D]))return!1}return!0}function li(s){for(;s&&s.firstChild;)s=s.firstChild;return s}function yu(s,h){var y=li(s);s=0;for(var w;y;){if(y.nodeType===3){if(w=s+y.textContent.length,s<=h&&w>=h)return{node:y,offset:h-s};s=w}e:{for(;y;){if(y.nextSibling){y=y.nextSibling;break e}y=y.parentNode}y=void 0}y=li(y)}}function ec(s,h){return s&&h?s===h?!0:s&&s.nodeType===3?!1:h&&h.nodeType===3?ec(s,h.parentNode):"contains"in s?s.contains(h):s.compareDocumentPosition?!!(s.compareDocumentPosition(h)&16):!1:!1}function tc(s){s=s!=null&&s.ownerDocument!=null&&s.ownerDocument.defaultView!=null?s.ownerDocument.defaultView:window;for(var h=Ia(s.document);h instanceof s.HTMLIFrameElement;){try{var y=typeof h.contentWindow.location.href=="string"}catch{y=!1}if(y)s=h.contentWindow;else break;h=Ia(s.document)}return h}function hl(s){var h=s&&s.nodeName&&s.nodeName.toLowerCase();return h&&(h==="input"&&(s.type==="text"||s.type==="search"||s.type==="tel"||s.type==="url"||s.type==="password")||h==="textarea"||s.contentEditable==="true")}var dl=cr&&"documentMode"in document&&11>=document.documentMode,fl=null,vh=null,Vc=null,nc=!1;function nf(s,h,y){var w=y.window===y?y.document:y.nodeType===9?y:y.ownerDocument;nc||fl==null||fl!==Ia(w)||(w=fl,"selectionStart"in w&&hl(w)?w={start:w.selectionStart,end:w.selectionEnd}:(w=(w.ownerDocument&&w.ownerDocument.defaultView||window).getSelection(),w={anchorNode:w.anchorNode,anchorOffset:w.anchorOffset,focusNode:w.focusNode,focusOffset:w.focusOffset}),Vc&&As(Vc,w)||(Vc=w,w=Tp(vh,"onSelect"),0<w.length&&(h=new uo("onSelect","select",null,h,y),s.push({event:h,listeners:w}),h.target=fl)))}function Fl(s,h){var y={};return y[s.toLowerCase()]=h.toLowerCase(),y["Webkit"+s]="webkit"+h,y["Moz"+s]="moz"+h,y}var ic={animationend:Fl("Animation","AnimationEnd"),animationiteration:Fl("Animation","AnimationIteration"),animationstart:Fl("Animation","AnimationStart"),transitionrun:Fl("Transition","TransitionRun"),transitionstart:Fl("Transition","TransitionStart"),transitioncancel:Fl("Transition","TransitionCancel"),transitionend:Fl("Transition","TransitionEnd")},Uc={},jc={};cr&&(jc=document.createElement("div").style,"AnimationEvent"in window||(delete ic.animationend.animation,delete ic.animationiteration.animation,delete ic.animationstart.animation),"TransitionEvent"in window||delete ic.transitionend.transition);function sa(s){if(Uc[s])return Uc[s];if(!ic[s])return s;var h=ic[s],y;for(y in h)if(h.hasOwnProperty(y)&&y in jc)return Uc[s]=h[y];return s}var Xl=sa("animationend"),bh=sa("animationiteration"),Lo=sa("animationstart"),$c=sa("transitionrun"),vu=sa("transitionstart"),fo=sa("transitioncancel"),bu=sa("transitionend"),sd=new Map,pl="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");pl.push("scrollEnd");function ma(s,h){sd.set(s,h),Co(h,[s])}var Yl=typeof reportError=="function"?reportError:function(s){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var h=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof s=="object"&&s!==null&&typeof s.message=="string"?String(s.message):String(s),error:s});if(!window.dispatchEvent(h))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",s);return}console.error(s)},ns=[],ga=0,xu=0;function rc(){for(var s=ga,h=xu=ga=0;h<s;){var y=ns[h];ns[h++]=null;var w=ns[h];ns[h++]=null;var D=ns[h];ns[h++]=null;var B=ns[h];if(ns[h++]=null,w!==null&&D!==null){var Q=w.pending;Q===null?D.next=D:(D.next=Q.next,Q.next=D),w.pending=D}B!==0&&Ql(y,D,B)}}function Js(s,h,y,w){ns[ga++]=s,ns[ga++]=h,ns[ga++]=y,ns[ga++]=w,xu|=w,s.lanes|=w,s=s.alternate,s!==null&&(s.lanes|=w)}function ml(s,h,y,w){return Js(s,h,y,w),qn(s)}function Do(s,h){return Js(s,null,null,h),qn(s)}function Ql(s,h,y){s.lanes|=y;var w=s.alternate;w!==null&&(w.lanes|=y);for(var D=!1,B=s.return;B!==null;)B.childLanes|=y,w=B.alternate,w!==null&&(w.childLanes|=y),B.tag===22&&(s=B.stateNode,s===null||s._visibility&1||(D=!0)),s=B,B=B.return;return s.tag===3?(B=s.stateNode,D&&h!==null&&(D=31-tt(y),s=B.hiddenUpdates,w=s[D],w===null?s[D]=[h]:w.push(h),h.lane=y|536870912),B):null}function qn(s){if(50<_p)throw _p=0,m_=null,Error(a(185));for(var h=s.return;h!==null;)s=h,h=s.return;return s.tag===3?s.stateNode:null}var zo={};function Jf(s,h,y,w){this.tag=s,this.key=y,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=h,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=w,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function is(s,h,y,w){return new Jf(s,h,y,w)}function Oo(s){return s=s.prototype,!(!s||!s.isReactComponent)}function No(s,h){var y=s.alternate;return y===null?(y=is(s.tag,h,s.key,s.mode),y.elementType=s.elementType,y.type=s.type,y.stateNode=s.stateNode,y.alternate=s,s.alternate=y):(y.pendingProps=h,y.type=s.type,y.flags=0,y.subtreeFlags=0,y.deletions=null),y.flags=s.flags&65011712,y.childLanes=s.childLanes,y.lanes=s.lanes,y.child=s.child,y.memoizedProps=s.memoizedProps,y.memoizedState=s.memoizedState,y.updateQueue=s.updateQueue,h=s.dependencies,y.dependencies=h===null?null:{lanes:h.lanes,firstContext:h.firstContext},y.sibling=s.sibling,y.index=s.index,y.ref=s.ref,y.refCleanup=s.refCleanup,y}function od(s,h){s.flags&=65011714;var y=s.alternate;return y===null?(s.childLanes=0,s.lanes=h,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=y.childLanes,s.lanes=y.lanes,s.child=y.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=y.memoizedProps,s.memoizedState=y.memoizedState,s.updateQueue=y.updateQueue,s.type=y.type,h=y.dependencies,s.dependencies=h===null?null:{lanes:h.lanes,firstContext:h.firstContext}),s}function ac(s,h,y,w,D,B){var Q=0;if(w=s,typeof s=="function")Oo(s)&&(Q=1);else if(typeof s=="string")Q=Ht(s,y,Ut.current)?26:s==="html"||s==="head"||s==="body"?27:5;else e:switch(s){case _e:return s=is(31,y,h,D),s.elementType=_e,s.lanes=B,s;case be:return wu(y.children,D,B,h);case Oe:Q=8,D|=24;break;case et:return s=is(12,y,h,D|2),s.elementType=et,s.lanes=B,s;case je:return s=is(13,y,h,D),s.elementType=je,s.lanes=B,s;case Be:return s=is(19,y,h,D),s.elementType=Be,s.lanes=B,s;default:if(typeof s=="object"&&s!==null)switch(s.$$typeof){case qe:Q=10;break e;case Je:Q=9;break e;case Ze:Q=11;break e;case de:Q=14;break e;case ce:Q=16,w=null;break e}Q=29,y=Error(a(130,s===null?"null":typeof s,"")),w=null}return h=is(Q,y,h,D),h.elementType=s,h.type=w,h.lanes=B,h}function wu(s,h,y,w){return s=is(7,s,w,h),s.lanes=y,s}function sc(s,h,y){return s=is(6,s,null,h),s.lanes=y,s}function oc(s){var h=is(18,null,null,0);return h.stateNode=s,h}function Tu(s,h,y){return h=is(4,s.children!==null?s.children:[],s.key,h),h.lanes=y,h.stateNode={containerInfo:s.containerInfo,pendingChildren:null,implementation:s.implementation},h}var f=new WeakMap;function x(s,h){if(typeof s=="object"&&s!==null){var y=f.get(s);return y!==void 0?y:(h={value:s,source:h,stack:Ea(h)},f.set(s,h),h)}return{value:s,source:h,stack:Ea(h)}}var k=[],U=0,X=null,ue=0,Ne=[],nt=0,ut=null,It=1,Xt="";function pn(s,h){k[U++]=ue,k[U++]=X,X=s,ue=h}function Yn(s,h,y){Ne[nt++]=It,Ne[nt++]=Xt,Ne[nt++]=ut,ut=s;var w=It;s=Xt;var D=32-tt(w)-1;w&=~(1<<D),y+=1;var B=32-tt(h)+D;if(30<B){var Q=D-D%5;B=(w&(1<<Q)-1).toString(32),w>>=Q,D-=Q,It=1<<32-tt(h)+D|y<<D|w,Xt=B+s}else It=1<<B|y<<D|w,Xt=s}function _a(s){s.return!==null&&(pn(s,1),Yn(s,1,0))}function Zr(s){for(;s===X;)X=k[--U],k[U]=null,ue=k[--U],k[U]=null;for(;s===ut;)ut=Ne[--nt],Ne[nt]=null,Xt=Ne[--nt],Ne[nt]=null,It=Ne[--nt],Ne[nt]=null}function Za(s,h){Ne[nt++]=It,Ne[nt++]=Xt,Ne[nt++]=ut,It=h.id,Xt=h.overflow,ut=s}var Si=null,ki=null,ui=!1,Li=null,Wr=!1,rs=Error(a(519));function Bo(s){var h=Error(a(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Eu(x(h,s)),rs}function Su(s){var h=s.stateNode,y=s.type,w=s.memoizedProps;switch(h[kt]=s,h[yn]=w,y){case"dialog":yi("cancel",h),yi("close",h);break;case"iframe":case"object":case"embed":yi("load",h);break;case"video":case"audio":for(y=0;y<rh.length;y++)yi(rh[y],h);break;case"source":yi("error",h);break;case"img":case"image":case"link":yi("error",h),yi("load",h);break;case"details":yi("toggle",h);break;case"input":yi("invalid",h),Dl(h,w.value,w.defaultValue,w.checked,w.defaultChecked,w.type,w.name,!0);break;case"select":yi("invalid",h);break;case"textarea":yi("invalid",h),$a(h,w.value,w.defaultValue,w.children)}y=w.children,typeof y!="string"&&typeof y!="number"&&typeof y!="bigint"||h.textContent===""+y||w.suppressHydrationWarning===!0||R_(h.textContent,y)?(w.popover!=null&&(yi("beforetoggle",h),yi("toggle",h)),w.onScroll!=null&&yi("scroll",h),w.onScrollEnd!=null&&yi("scrollend",h),w.onClick!=null&&(h.onclick=Pa),h=!0):h=!1,h||Bo(s,!0)}function Nr(s){for(Si=s.return;Si;)switch(Si.tag){case 5:case 31:case 13:Wr=!1;return;case 27:case 3:Wr=!0;return;default:Si=Si.return}}function as(s){if(s!==Si)return!1;if(!ui)return Nr(s),ui=!0,!1;var h=s.tag,y;if((y=h!==3&&h!==27)&&((y=h===5)&&(y=s.type,y=!(y!=="form"&&y!=="button")||L_(s.type,s.memoizedProps)),y=!y),y&&ki&&Bo(s),Nr(s),h===13){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(a(317));ki=qm(s)}else if(h===31){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(a(317));ki=qm(s)}else h===27?(h=ki,Cc(s.type)?(s=$m,$m=null,ki=s):ki=h):ki=Si?Sl(s.stateNode.nextSibling):null;return!0}function gl(){ki=Si=null,ui=!1}function Fo(){var s=Li;return s!==null&&(Ko===null?Ko=s:Ko.push.apply(Ko,s),Li=null),s}function Eu(s){Li===null?Li=[s]:Li.push(s)}var lc=Le(null),Vl=null,_l=null;function Au(s,h,y){Ot(lc,h._currentValue),h._currentValue=y}function Jl(s){s._currentValue=lc.current,vt(lc)}function Vo(s,h,y){for(;s!==null;){var w=s.alternate;if((s.childLanes&h)!==h?(s.childLanes|=h,w!==null&&(w.childLanes|=h)):w!==null&&(w.childLanes&h)!==h&&(w.childLanes|=h),s===y)break;s=s.return}}function uc(s,h,y,w){var D=s.child;for(D!==null&&(D.return=s);D!==null;){var B=D.dependencies;if(B!==null){var Q=D.child;B=B.firstContext;e:for(;B!==null;){var he=B;B=D;for(var Ue=0;Ue<h.length;Ue++)if(he.context===h[Ue]){B.lanes|=y,he=B.alternate,he!==null&&(he.lanes|=y),Vo(B.return,y,s),w||(Q=null);break e}B=he.next}}else if(D.tag===18){if(Q=D.return,Q===null)throw Error(a(341));Q.lanes|=y,B=Q.alternate,B!==null&&(B.lanes|=y),Vo(Q,y,s),Q=null}else Q=D.child;if(Q!==null)Q.return=D;else for(Q=D;Q!==null;){if(Q===s){Q=null;break}if(D=Q.sibling,D!==null){D.return=Q.return,Q=D;break}Q=Q.return}D=Q}}function ka(s,h,y,w){s=null;for(var D=h,B=!1;D!==null;){if(!B){if((D.flags&524288)!==0)B=!0;else if((D.flags&262144)!==0)break}if(D.tag===10){var Q=D.alternate;if(Q===null)throw Error(a(387));if(Q=Q.memoizedProps,Q!==null){var he=D.type;aa(D.pendingProps.value,Q.value)||(s!==null?s.push(he):s=[he])}}else if(D===Fn.current){if(Q=D.alternate,Q===null)throw Error(a(387));Q.memoizedState.memoizedState!==D.memoizedState.memoizedState&&(s!==null?s.push(Qn):s=[Qn])}D=D.return}s!==null&&uc(h,s,y,w),h.flags|=262144}function Cu(s){for(s=s.firstContext;s!==null;){if(!aa(s.context._currentValue,s.memoizedValue))return!0;s=s.next}return!1}function Iu(s){Vl=s,_l=null,s=s.dependencies,s!==null&&(s.firstContext=null)}function Wa(s){return qc(Vl,s)}function ld(s,h){return Vl===null&&Iu(s),qc(s,h)}function qc(s,h){var y=h._currentValue;if(h={context:h,memoizedValue:y,next:null},_l===null){if(s===null)throw Error(a(308));_l=h,s.dependencies={lanes:0,firstContext:h},s.flags|=524288}else _l=_l.next=h;return y}var ep=typeof AbortController<"u"?AbortController:function(){var s=[],h=this.signal={aborted:!1,addEventListener:function(y,w){s.push(w)}};this.abort=function(){h.aborted=!0,s.forEach(function(y){return y()})}},xh=n.unstable_scheduleCallback,cm=n.unstable_NormalPriority,Ci={$$typeof:qe,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Uo(){return{controller:new ep,data:new Map,refCount:0}}function eu(s){s.refCount--,s.refCount===0&&xh(cm,function(){s.controller.abort()})}var eo=null,cc=0,wh=0,tu=null;function Bg(s,h){if(eo===null){var y=eo=[];cc=0,wh=Ac(),tu={status:"pending",value:void 0,then:function(w){y.push(w)}}}return cc++,h.then(hm,hm),h}function hm(){if(--cc===0&&eo!==null){tu!==null&&(tu.status="fulfilled");var s=eo;eo=null,wh=0,tu=null;for(var h=0;h<s.length;h++)(0,s[h])()}}function ud(s,h){var y=[],w={status:"pending",value:null,reason:null,then:function(D){y.push(D)}};return s.then(function(){w.status="fulfilled",w.value=h;for(var D=0;D<y.length;D++)(0,y[D])(h)},function(D){for(w.status="rejected",w.reason=D,D=0;D<y.length;D++)(0,y[D])(void 0)}),w}var Th=mt.S;mt.S=function(s,h){Md=qr(),typeof h=="object"&&h!==null&&typeof h.then=="function"&&Bg(s,h),Th!==null&&Th(s,h)};var ss=Le(null);function Yt(){var s=ss.current;return s!==null?s:Sr.pooledCache}function Sh(s,h){h===null?Ot(ss,ss.current):Ot(ss,h.pool)}function cd(){var s=Yt();return s===null?null:{parent:Ci._currentValue,pool:s}}var hc=Error(a(460)),dc=Error(a(474)),nu=Error(a(542)),Gc={then:function(){}};function ri(s){return s=s.status,s==="fulfilled"||s==="rejected"}function hd(s,h,y){switch(y=s[y],y===void 0?s.push(h):y!==h&&(h.then(Pa,Pa),h=y),h.status){case"fulfilled":return h.value;case"rejected":throw s=h.reason,tp(s),s;default:if(typeof h.status=="string")h.then(Pa,Pa);else{if(s=Sr,s!==null&&100<s.shellSuspendCounter)throw Error(a(482));s=h,s.status="pending",s.then(function(w){if(h.status==="pending"){var D=h;D.status="fulfilled",D.value=w}},function(w){if(h.status==="pending"){var D=h;D.status="rejected",D.reason=w}})}switch(h.status){case"fulfilled":return h.value;case"rejected":throw s=h.reason,tp(s),s}throw iu=h,hc}}function Hc(s){try{var h=s._init;return h(s._payload)}catch(y){throw y!==null&&typeof y=="object"&&typeof y.then=="function"?(iu=y,hc):y}}var iu=null;function dm(){if(iu===null)throw Error(a(459));var s=iu;return iu=null,s}function tp(s){if(s===hc||s===nu)throw Error(a(483))}var fc=null,Zc=0;function dd(s){var h=Zc;return Zc+=1,fc===null&&(fc=[]),hd(fc,s,h)}function Eh(s,h){h=h.props.ref,s.ref=h!==void 0?h:null}function Ah(s,h){throw h.$$typeof===J?Error(a(525)):(s=Object.prototype.toString.call(h),Error(a(31,s==="[object Object]"?"object with keys {"+Object.keys(h).join(", ")+"}":s)))}function np(s){function h(it,Qe){if(s){var pt=it.deletions;pt===null?(it.deletions=[Qe],it.flags|=16):pt.push(Qe)}}function y(it,Qe){if(!s)return null;for(;Qe!==null;)h(it,Qe),Qe=Qe.sibling;return null}function w(it){for(var Qe=new Map;it!==null;)it.key!==null?Qe.set(it.key,it):Qe.set(it.index,it),it=it.sibling;return Qe}function D(it,Qe){return it=No(it,Qe),it.index=0,it.sibling=null,it}function B(it,Qe,pt){return it.index=pt,s?(pt=it.alternate,pt!==null?(pt=pt.index,pt<Qe?(it.flags|=67108866,Qe):pt):(it.flags|=67108866,Qe)):(it.flags|=1048576,Qe)}function Q(it){return s&&it.alternate===null&&(it.flags|=67108866),it}function he(it,Qe,pt,Rt){return Qe===null||Qe.tag!==6?(Qe=sc(pt,it.mode,Rt),Qe.return=it,Qe):(Qe=D(Qe,pt),Qe.return=it,Qe)}function Ue(it,Qe,pt,Rt){var Dn=pt.type;return Dn===be?bt(it,Qe,pt.props.children,Rt,pt.key):Qe!==null&&(Qe.elementType===Dn||typeof Dn=="object"&&Dn!==null&&Dn.$$typeof===ce&&Hc(Dn)===Qe.type)?(Qe=D(Qe,pt.props),Eh(Qe,pt),Qe.return=it,Qe):(Qe=ac(pt.type,pt.key,pt.props,null,it.mode,Rt),Eh(Qe,pt),Qe.return=it,Qe)}function dt(it,Qe,pt,Rt){return Qe===null||Qe.tag!==4||Qe.stateNode.containerInfo!==pt.containerInfo||Qe.stateNode.implementation!==pt.implementation?(Qe=Tu(pt,it.mode,Rt),Qe.return=it,Qe):(Qe=D(Qe,pt.children||[]),Qe.return=it,Qe)}function bt(it,Qe,pt,Rt,Dn){return Qe===null||Qe.tag!==7?(Qe=wu(pt,it.mode,Rt,Dn),Qe.return=it,Qe):(Qe=D(Qe,pt),Qe.return=it,Qe)}function Et(it,Qe,pt){if(typeof Qe=="string"&&Qe!==""||typeof Qe=="number"||typeof Qe=="bigint")return Qe=sc(""+Qe,it.mode,pt),Qe.return=it,Qe;if(typeof Qe=="object"&&Qe!==null){switch(Qe.$$typeof){case Y:return pt=ac(Qe.type,Qe.key,Qe.props,null,it.mode,pt),Eh(pt,Qe),pt.return=it,pt;case xe:return Qe=Tu(Qe,it.mode,pt),Qe.return=it,Qe;case ce:return Qe=Hc(Qe),Et(it,Qe,pt)}if(ei(Qe)||Ge(Qe))return Qe=wu(Qe,it.mode,pt,null),Qe.return=it,Qe;if(typeof Qe.then=="function")return Et(it,dd(Qe),pt);if(Qe.$$typeof===qe)return Et(it,ld(it,Qe),pt);Ah(it,Qe)}return null}function ft(it,Qe,pt,Rt){var Dn=Qe!==null?Qe.key:null;if(typeof pt=="string"&&pt!==""||typeof pt=="number"||typeof pt=="bigint")return Dn!==null?null:he(it,Qe,""+pt,Rt);if(typeof pt=="object"&&pt!==null){switch(pt.$$typeof){case Y:return pt.key===Dn?Ue(it,Qe,pt,Rt):null;case xe:return pt.key===Dn?dt(it,Qe,pt,Rt):null;case ce:return pt=Hc(pt),ft(it,Qe,pt,Rt)}if(ei(pt)||Ge(pt))return Dn!==null?null:bt(it,Qe,pt,Rt,null);if(typeof pt.then=="function")return ft(it,Qe,dd(pt),Rt);if(pt.$$typeof===qe)return ft(it,Qe,ld(it,pt),Rt);Ah(it,pt)}return null}function yt(it,Qe,pt,Rt,Dn){if(typeof Rt=="string"&&Rt!==""||typeof Rt=="number"||typeof Rt=="bigint")return it=it.get(pt)||null,he(Qe,it,""+Rt,Dn);if(typeof Rt=="object"&&Rt!==null){switch(Rt.$$typeof){case Y:return it=it.get(Rt.key===null?pt:Rt.key)||null,Ue(Qe,it,Rt,Dn);case xe:return it=it.get(Rt.key===null?pt:Rt.key)||null,dt(Qe,it,Rt,Dn);case ce:return Rt=Hc(Rt),yt(it,Qe,pt,Rt,Dn)}if(ei(Rt)||Ge(Rt))return it=it.get(pt)||null,bt(Qe,it,Rt,Dn,null);if(typeof Rt.then=="function")return yt(it,Qe,pt,dd(Rt),Dn);if(Rt.$$typeof===qe)return yt(it,Qe,pt,ld(Qe,Rt),Dn);Ah(Qe,Rt)}return null}function cn(it,Qe,pt,Rt){for(var Dn=null,dr=null,Cn=Qe,mi=Qe=0,zi=null;Cn!==null&&mi<pt.length;mi++){Cn.index>mi?(zi=Cn,Cn=null):zi=Cn.sibling;var fr=ft(it,Cn,pt[mi],Rt);if(fr===null){Cn===null&&(Cn=zi);break}s&&Cn&&fr.alternate===null&&h(it,Cn),Qe=B(fr,Qe,mi),dr===null?Dn=fr:dr.sibling=fr,dr=fr,Cn=zi}if(mi===pt.length)return y(it,Cn),ui&&pn(it,mi),Dn;if(Cn===null){for(;mi<pt.length;mi++)Cn=Et(it,pt[mi],Rt),Cn!==null&&(Qe=B(Cn,Qe,mi),dr===null?Dn=Cn:dr.sibling=Cn,dr=Cn);return ui&&pn(it,mi),Dn}for(Cn=w(Cn);mi<pt.length;mi++)zi=yt(Cn,it,mi,pt[mi],Rt),zi!==null&&(s&&zi.alternate!==null&&Cn.delete(zi.key===null?mi:zi.key),Qe=B(zi,Qe,mi),dr===null?Dn=zi:dr.sibling=zi,dr=zi);return s&&Cn.forEach(function(Cf){return h(it,Cf)}),ui&&pn(it,mi),Dn}function En(it,Qe,pt,Rt){if(pt==null)throw Error(a(151));for(var Dn=null,dr=null,Cn=Qe,mi=Qe=0,zi=null,fr=pt.next();Cn!==null&&!fr.done;mi++,fr=pt.next()){Cn.index>mi?(zi=Cn,Cn=null):zi=Cn.sibling;var Cf=ft(it,Cn,fr.value,Rt);if(Cf===null){Cn===null&&(Cn=zi);break}s&&Cn&&Cf.alternate===null&&h(it,Cn),Qe=B(Cf,Qe,mi),dr===null?Dn=Cf:dr.sibling=Cf,dr=Cf,Cn=zi}if(fr.done)return y(it,Cn),ui&&pn(it,mi),Dn;if(Cn===null){for(;!fr.done;mi++,fr=pt.next())fr=Et(it,fr.value,Rt),fr!==null&&(Qe=B(fr,Qe,mi),dr===null?Dn=fr:dr.sibling=fr,dr=fr);return ui&&pn(it,mi),Dn}for(Cn=w(Cn);!fr.done;mi++,fr=pt.next())fr=yt(Cn,it,mi,fr.value,Rt),fr!==null&&(s&&fr.alternate!==null&&Cn.delete(fr.key===null?mi:fr.key),Qe=B(fr,Qe,mi),dr===null?Dn=fr:dr.sibling=fr,dr=fr);return s&&Cn.forEach(function(uR){return h(it,uR)}),ui&&pn(it,mi),Dn}function jr(it,Qe,pt,Rt){if(typeof pt=="object"&&pt!==null&&pt.type===be&&pt.key===null&&(pt=pt.props.children),typeof pt=="object"&&pt!==null){switch(pt.$$typeof){case Y:e:{for(var Dn=pt.key;Qe!==null;){if(Qe.key===Dn){if(Dn=pt.type,Dn===be){if(Qe.tag===7){y(it,Qe.sibling),Rt=D(Qe,pt.props.children),Rt.return=it,it=Rt;break e}}else if(Qe.elementType===Dn||typeof Dn=="object"&&Dn!==null&&Dn.$$typeof===ce&&Hc(Dn)===Qe.type){y(it,Qe.sibling),Rt=D(Qe,pt.props),Eh(Rt,pt),Rt.return=it,it=Rt;break e}y(it,Qe);break}else h(it,Qe);Qe=Qe.sibling}pt.type===be?(Rt=wu(pt.props.children,it.mode,Rt,pt.key),Rt.return=it,it=Rt):(Rt=ac(pt.type,pt.key,pt.props,null,it.mode,Rt),Eh(Rt,pt),Rt.return=it,it=Rt)}return Q(it);case xe:e:{for(Dn=pt.key;Qe!==null;){if(Qe.key===Dn)if(Qe.tag===4&&Qe.stateNode.containerInfo===pt.containerInfo&&Qe.stateNode.implementation===pt.implementation){y(it,Qe.sibling),Rt=D(Qe,pt.children||[]),Rt.return=it,it=Rt;break e}else{y(it,Qe);break}else h(it,Qe);Qe=Qe.sibling}Rt=Tu(pt,it.mode,Rt),Rt.return=it,it=Rt}return Q(it);case ce:return pt=Hc(pt),jr(it,Qe,pt,Rt)}if(ei(pt))return cn(it,Qe,pt,Rt);if(Ge(pt)){if(Dn=Ge(pt),typeof Dn!="function")throw Error(a(150));return pt=Dn.call(pt),En(it,Qe,pt,Rt)}if(typeof pt.then=="function")return jr(it,Qe,dd(pt),Rt);if(pt.$$typeof===qe)return jr(it,Qe,ld(it,pt),Rt);Ah(it,pt)}return typeof pt=="string"&&pt!==""||typeof pt=="number"||typeof pt=="bigint"?(pt=""+pt,Qe!==null&&Qe.tag===6?(y(it,Qe.sibling),Rt=D(Qe,pt),Rt.return=it,it=Rt):(y(it,Qe),Rt=sc(pt,it.mode,Rt),Rt.return=it,it=Rt),Q(it)):y(it,Qe)}return function(it,Qe,pt,Rt){try{Zc=0;var Dn=jr(it,Qe,pt,Rt);return fc=null,Dn}catch(Cn){if(Cn===hc||Cn===nu)throw Cn;var dr=is(29,Cn,null,it.mode);return dr.lanes=Rt,dr.return=it,dr}finally{}}}var pc=np(!0),yl=np(!1),Di=!1;function mc(s){s.updateQueue={baseState:s.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function fd(s,h){s=s.updateQueue,h.updateQueue===s&&(h.updateQueue={baseState:s.baseState,firstBaseUpdate:s.firstBaseUpdate,lastBaseUpdate:s.lastBaseUpdate,shared:s.shared,callbacks:null})}function Pu(s){return{lane:s,tag:0,payload:null,callback:null,next:null}}function ru(s,h,y){var w=s.updateQueue;if(w===null)return null;if(w=w.shared,(qi&2)!==0){var D=w.pending;return D===null?h.next=h:(h.next=D.next,D.next=h),w.pending=h,h=qn(s),Ql(s,null,y),h}return Js(s,w,h,y),qn(s)}function Wc(s,h,y){if(h=h.updateQueue,h!==null&&(h=h.shared,(y&4194048)!==0)){var w=h.lanes;w&=s.pendingLanes,y|=w,h.lanes=y,Xn(s,y)}}function rf(s,h){var y=s.updateQueue,w=s.alternate;if(w!==null&&(w=w.updateQueue,y===w)){var D=null,B=null;if(y=y.firstBaseUpdate,y!==null){do{var Q={lane:y.lane,tag:y.tag,payload:y.payload,callback:null,next:null};B===null?D=B=Q:B=B.next=Q,y=y.next}while(y!==null);B===null?D=B=h:B=B.next=h}else D=B=h;y={baseState:w.baseState,firstBaseUpdate:D,lastBaseUpdate:B,shared:w.shared,callbacks:w.callbacks},s.updateQueue=y;return}s=y.lastBaseUpdate,s===null?y.firstBaseUpdate=h:s.next=h,y.lastBaseUpdate=h}var vl=!1;function gc(){if(vl){var s=tu;if(s!==null)throw s}}function an(s,h,y,w){vl=!1;var D=s.updateQueue;Di=!1;var B=D.firstBaseUpdate,Q=D.lastBaseUpdate,he=D.shared.pending;if(he!==null){D.shared.pending=null;var Ue=he,dt=Ue.next;Ue.next=null,Q===null?B=dt:Q.next=dt,Q=Ue;var bt=s.alternate;bt!==null&&(bt=bt.updateQueue,he=bt.lastBaseUpdate,he!==Q&&(he===null?bt.firstBaseUpdate=dt:he.next=dt,bt.lastBaseUpdate=Ue))}if(B!==null){var Et=D.baseState;Q=0,bt=dt=Ue=null,he=B;do{var ft=he.lane&-536870913,yt=ft!==he.lane;if(yt?(xi&ft)===ft:(w&ft)===ft){ft!==0&&ft===wh&&(vl=!0),bt!==null&&(bt=bt.next={lane:0,tag:he.tag,payload:he.payload,callback:null,next:null});e:{var cn=s,En=he;ft=h;var jr=y;switch(En.tag){case 1:if(cn=En.payload,typeof cn=="function"){Et=cn.call(jr,Et,ft);break e}Et=cn;break e;case 3:cn.flags=cn.flags&-65537|128;case 0:if(cn=En.payload,ft=typeof cn=="function"?cn.call(jr,Et,ft):cn,ft==null)break e;Et=q({},Et,ft);break e;case 2:Di=!0}}ft=he.callback,ft!==null&&(s.flags|=64,yt&&(s.flags|=8192),yt=D.callbacks,yt===null?D.callbacks=[ft]:yt.push(ft))}else yt={lane:ft,tag:he.tag,payload:he.payload,callback:he.callback,next:null},bt===null?(dt=bt=yt,Ue=Et):bt=bt.next=yt,Q|=ft;if(he=he.next,he===null){if(he=D.shared.pending,he===null)break;yt=he,he=yt.next,yt.next=null,D.lastBaseUpdate=yt,D.shared.pending=null}}while(!0);bt===null&&(Ue=Et),D.baseState=Ue,D.firstBaseUpdate=dt,D.lastBaseUpdate=bt,B===null&&(D.shared.lanes=0),eh|=Q,s.lanes=Q,s.memoizedState=Et}}function Tn(s,h){if(typeof s!="function")throw Error(a(191,s));s.call(h)}function pd(s,h){var y=s.callbacks;if(y!==null)for(s.callbacks=null,s=0;s<y.length;s++)Tn(y[s],h)}var jo=Le(null),Kc=Le(0);function Cs(s,h){s=Jc,Ot(Kc,s),Ot(jo,h),Jc=s|h.baseLanes}function af(){Ot(Kc,Jc),Ot(jo,jo.current)}function po(){Jc=Kc.current,vt(jo),vt(Kc)}var $o=Le(null),Is=null;function gi(s){var h=s.alternate;Ot(Kr,Kr.current&1),Ot($o,s),Is===null&&(h===null||jo.current!==null||h.memoizedState!==null)&&(Is=s)}function Br(s){Ot(Kr,Kr.current),Ot($o,s),Is===null&&(Is=s)}function md(s){s.tag===22?(Ot(Kr,Kr.current),Ot($o,s),Is===null&&(Is=s)):qo()}function qo(){Ot(Kr,Kr.current),Ot($o,$o.current)}function Ka(s){vt($o),Is===s&&(Is=null),vt(Kr)}var Kr=Le(0);function Mu(s){for(var h=s;h!==null;){if(h.tag===13){var y=h.memoizedState;if(y!==null&&(y=y.dehydrated,y===null||Ap(y)||jm(y)))return h}else if(h.tag===19&&(h.memoizedProps.revealOrder==="forwards"||h.memoizedProps.revealOrder==="backwards"||h.memoizedProps.revealOrder==="unstable_legacy-backwards"||h.memoizedProps.revealOrder==="together")){if((h.flags&128)!==0)return h}else if(h.child!==null){h.child.return=h,h=h.child;continue}if(h===s)break;for(;h.sibling===null;){if(h.return===null||h.return===s)return null;h=h.return}h.sibling.return=h.return,h=h.sibling}return null}var to=0,Gn=null,ji=null,Tr=null,Ch=!1,_c=!1,au=!1,Ih=0,T=0,i=null,u=0;function _(){throw Error(a(321))}function b(s,h){if(h===null)return!1;for(var y=0;y<h.length&&y<s.length;y++)if(!aa(s[y],h[y]))return!1;return!0}function S(s,h,y,w,D,B){return to=B,Gn=h,h.memoizedState=null,h.updateQueue=null,h.lanes=0,mt.H=s===null||s.memoizedState===null?Vg:Ug,au=!1,B=y(w,D),au=!1,_c&&(B=O(h,y,w,D)),I(s),B}function I(s){mt.H=yd;var h=ji!==null&&ji.next!==null;if(to=0,Tr=ji=Gn=null,Ch=!1,T=0,i=null,h)throw Error(a(300));s===null||Da||(s=s.dependencies,s!==null&&Cu(s)&&(Da=!0))}function O(s,h,y,w){Gn=s;var D=0;do{if(_c&&(i=null),T=0,_c=!1,25<=D)throw Error(a(301));if(D+=1,Tr=ji=null,s.updateQueue!=null){var B=s.updateQueue;B.lastEffect=null,B.events=null,B.stores=null,B.memoCache!=null&&(B.memoCache.index=0)}mt.H=jg,B=h(y,w)}while(_c);return B}function N(){var s=mt.H,h=s.useState()[0];return h=typeof h.then=="function"?ge(h):h,s=s.useState()[0],(ji!==null?ji.memoizedState:null)!==s&&(Gn.flags|=1024),h}function j(){var s=Ih!==0;return Ih=0,s}function G(s,h,y){h.updateQueue=s.updateQueue,h.flags&=-2053,s.lanes&=~y}function K(s){if(Ch){for(s=s.memoizedState;s!==null;){var h=s.queue;h!==null&&(h.pending=null),s=s.next}Ch=!1}to=0,Tr=ji=Gn=null,_c=!1,T=Ih=0,i=null}function Z(){var s={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Tr===null?Gn.memoizedState=Tr=s:Tr=Tr.next=s,Tr}function ee(){if(ji===null){var s=Gn.alternate;s=s!==null?s.memoizedState:null}else s=ji.next;var h=Tr===null?Gn.memoizedState:Tr.next;if(h!==null)Tr=h,ji=s;else{if(s===null)throw Gn.alternate===null?Error(a(467)):Error(a(310));ji=s,s={memoizedState:ji.memoizedState,baseState:ji.baseState,baseQueue:ji.baseQueue,queue:ji.queue,next:null},Tr===null?Gn.memoizedState=Tr=s:Tr=Tr.next=s}return Tr}function ae(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function ge(s){var h=T;return T+=1,i===null&&(i=[]),s=hd(i,s,h),h=Gn,(Tr===null?h.memoizedState:Tr.next)===null&&(h=h.alternate,mt.H=h===null||h.memoizedState===null?Vg:Ug),s}function me(s){if(s!==null&&typeof s=="object"){if(typeof s.then=="function")return ge(s);if(s.$$typeof===qe)return Wa(s)}throw Error(a(438,String(s)))}function ve(s){var h=null,y=Gn.updateQueue;if(y!==null&&(h=y.memoCache),h==null){var w=Gn.alternate;w!==null&&(w=w.updateQueue,w!==null&&(w=w.memoCache,w!=null&&(h={data:w.data.map(function(D){return D.slice()}),index:0})))}if(h==null&&(h={data:[],index:0}),y===null&&(y=ae(),Gn.updateQueue=y),y.memoCache=h,y=h.data[h.index],y===void 0)for(y=h.data[h.index]=Array(s),w=0;w<s;w++)y[w]=Ae;return h.index++,y}function we(s,h){return typeof h=="function"?h(s):h}function Pe(s){var h=ee();return Ce(h,ji,s)}function Ce(s,h,y){var w=s.queue;if(w===null)throw Error(a(311));w.lastRenderedReducer=y;var D=s.baseQueue,B=w.pending;if(B!==null){if(D!==null){var Q=D.next;D.next=B.next,B.next=Q}h.baseQueue=D=B,w.pending=null}if(B=s.baseState,D===null)s.memoizedState=B;else{h=D.next;var he=Q=null,Ue=null,dt=h,bt=!1;do{var Et=dt.lane&-536870913;if(Et!==dt.lane?(xi&Et)===Et:(to&Et)===Et){var ft=dt.revertLane;if(ft===0)Ue!==null&&(Ue=Ue.next={lane:0,revertLane:0,gesture:null,action:dt.action,hasEagerState:dt.hasEagerState,eagerState:dt.eagerState,next:null}),Et===wh&&(bt=!0);else if((to&ft)===ft){dt=dt.next,ft===wh&&(bt=!0);continue}else Et={lane:0,revertLane:dt.revertLane,gesture:null,action:dt.action,hasEagerState:dt.hasEagerState,eagerState:dt.eagerState,next:null},Ue===null?(he=Ue=Et,Q=B):Ue=Ue.next=Et,Gn.lanes|=ft,eh|=ft;Et=dt.action,au&&y(B,Et),B=dt.hasEagerState?dt.eagerState:y(B,Et)}else ft={lane:Et,revertLane:dt.revertLane,gesture:dt.gesture,action:dt.action,hasEagerState:dt.hasEagerState,eagerState:dt.eagerState,next:null},Ue===null?(he=Ue=ft,Q=B):Ue=Ue.next=ft,Gn.lanes|=Et,eh|=Et;dt=dt.next}while(dt!==null&&dt!==h);if(Ue===null?Q=B:Ue.next=he,!aa(B,s.memoizedState)&&(Da=!0,bt&&(y=tu,y!==null)))throw y;s.memoizedState=B,s.baseState=Q,s.baseQueue=Ue,w.lastRenderedState=B}return D===null&&(w.lanes=0),[s.memoizedState,w.dispatch]}function ze(s){var h=ee(),y=h.queue;if(y===null)throw Error(a(311));y.lastRenderedReducer=s;var w=y.dispatch,D=y.pending,B=h.memoizedState;if(D!==null){y.pending=null;var Q=D=D.next;do B=s(B,Q.action),Q=Q.next;while(Q!==D);aa(B,h.memoizedState)||(Da=!0),h.memoizedState=B,h.baseQueue===null&&(h.baseState=B),y.lastRenderedState=B}return[B,w]}function Ve(s,h,y){var w=Gn,D=ee(),B=ui;if(B){if(y===void 0)throw Error(a(407));y=y()}else y=h();var Q=!aa((ji||D).memoizedState,y);if(Q&&(D.memoizedState=y,Da=!0),D=D.queue,su(ct.bind(null,w,D,s),[s]),D.getSnapshot!==h||Q||Tr!==null&&Tr.memoizedState.tag&1){if(w.flags|=2048,Vr(9,{destroy:void 0},Ye.bind(null,w,D,y,h),null),Sr===null)throw Error(a(349));B||(to&127)!==0||Ie(w,h,y)}return y}function Ie(s,h,y){s.flags|=16384,s={getSnapshot:h,value:y},h=Gn.updateQueue,h===null?(h=ae(),Gn.updateQueue=h,h.stores=[s]):(y=h.stores,y===null?h.stores=[s]:y.push(s))}function Ye(s,h,y,w){h.value=y,h.getSnapshot=w,rt(h)&&st(s)}function ct(s,h,y){return y(function(){rt(h)&&st(s)})}function rt(s){var h=s.getSnapshot;s=s.value;try{var y=h();return!aa(s,y)}catch{return!0}}function st(s){var h=Do(s,2);h!==null&&yo(h,s,2)}function lt(s){var h=Z();if(typeof s=="function"){var y=s;if(s=y(),au){He(!0);try{y()}finally{He(!1)}}}return h.memoizedState=h.baseState=s,h.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:we,lastRenderedState:s},h}function Nt(s,h,y,w){return s.baseState=y,Ce(s,ji,typeof w=="function"?w:we)}function Vt(s,h,y,w,D){if(wl(s))throw Error(a(485));if(s=h.action,s!==null){var B={payload:D,action:s,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(Q){B.listeners.push(Q)}};mt.T!==null?y(!0):B.isTransition=!1,w(B),y=h.pending,y===null?(B.next=h.pending=B,At(h,B)):(B.next=y.next,h.pending=y.next=B)}}function At(s,h){var y=h.action,w=h.payload,D=s.state;if(h.isTransition){var B=mt.T,Q={};mt.T=Q;try{var he=y(D,w),Ue=mt.S;Ue!==null&&Ue(Q,he),ln(s,h,he)}catch(dt){bi(s,h,dt)}finally{B!==null&&Q.types!==null&&(B.types=Q.types),mt.T=B}}else try{B=y(D,w),ln(s,h,B)}catch(dt){bi(s,h,dt)}}function ln(s,h,y){y!==null&&typeof y=="object"&&typeof y.then=="function"?y.then(function(w){Hn(s,h,w)},function(w){return bi(s,h,w)}):Hn(s,h,y)}function Hn(s,h,y){h.status="fulfilled",h.value=y,Yi(h),s.state=y,h=s.pending,h!==null&&(y=h.next,y===h?s.pending=null:(y=y.next,h.next=y,At(s,y)))}function bi(s,h,y){var w=s.pending;if(s.pending=null,w!==null){w=w.next;do h.status="rejected",h.reason=y,Yi(h),h=h.next;while(h!==w)}s.action=null}function Yi(s){s=s.listeners;for(var h=0;h<s.length;h++)(0,s[h])()}function $i(s,h){return h}function Mr(s,h){if(ui){var y=Sr.formState;if(y!==null){e:{var w=Gn;if(ui){if(ki){t:{for(var D=ki,B=Wr;D.nodeType!==8;){if(!B){D=null;break t}if(D=Sl(D.nextSibling),D===null){D=null;break t}}B=D.data,D=B==="F!"||B==="F"?D:null}if(D){ki=Sl(D.nextSibling),w=D.data==="F!";break e}}Bo(w)}w=!1}w&&(h=y[0])}}return y=Z(),y.memoizedState=y.baseState=h,w={pending:null,lanes:0,dispatch:null,lastRenderedReducer:$i,lastRenderedState:h},y.queue=w,y=_d.bind(null,Gn,w),w.dispatch=y,w=lt(!1),B=uu.bind(null,Gn,!1,w.queue),w=Z(),D={state:h,dispatch:null,action:s,pending:null},w.queue=D,y=Vt.bind(null,Gn,D,B,y),D.dispatch=y,w.memoizedState=s,[h,y,!1]}function Fr(s){var h=ee();return jn(h,ji,s)}function jn(s,h,y){if(h=Ce(s,h,$i)[0],s=Pe(we)[0],typeof h=="object"&&h!==null&&typeof h.then=="function")try{var w=ge(h)}catch(Q){throw Q===hc?nu:Q}else w=h;h=ee();var D=h.queue,B=D.dispatch;return y!==h.memoizedState&&(Gn.flags|=2048,Vr(9,{destroy:void 0},ur.bind(null,D,y),null)),[w,B,s]}function ur(s,h){s.action=h}function oa(s){var h=ee(),y=ji;if(y!==null)return jn(h,y,s);ee(),h=h.memoizedState,y=ee();var w=y.queue.dispatch;return y.memoizedState=s,[h,w,!1]}function Vr(s,h,y,w){return s={tag:s,create:y,deps:w,inst:h,next:null},h=Gn.updateQueue,h===null&&(h=ae(),Gn.updateQueue=h),y=h.lastEffect,y===null?h.lastEffect=s.next=s:(w=y.next,y.next=s,s.next=w,h.lastEffect=s),s}function La(){return ee().memoizedState}function Xa(s,h,y,w){var D=Z();Gn.flags|=s,D.memoizedState=Vr(1|h,{destroy:void 0},y,w===void 0?null:w)}function mo(s,h,y,w){var D=ee();w=w===void 0?null:w;var B=D.memoizedState.inst;ji!==null&&w!==null&&b(w,ji.memoizedState.deps)?D.memoizedState=Vr(h,B,y,w):(Gn.flags|=s,D.memoizedState=Vr(1|h,B,y,w))}function Ru(s,h){Xa(8390656,8,s,h)}function su(s,h){mo(2048,8,s,h)}function Ph(s){Gn.flags|=4;var h=Gn.updateQueue;if(h===null)h=ae(),Gn.updateQueue=h,h.events=[s];else{var y=h.events;y===null?h.events=[s]:y.push(s)}}function Xc(s){var h=ee().memoizedState;return Ph({ref:h,nextImpl:s}),function(){if((qi&2)!==0)throw Error(a(440));return h.impl.apply(void 0,arguments)}}function yc(s,h){return mo(4,2,s,h)}function vc(s,h){return mo(4,4,s,h)}function no(s,h){if(typeof h=="function"){s=s();var y=h(s);return function(){typeof y=="function"?y():h(null)}}if(h!=null)return s=s(),h.current=s,function(){h.current=null}}function bl(s,h,y){y=y!=null?y.concat([s]):null,mo(4,4,no.bind(null,h,s),y)}function os(){}function ku(s,h){var y=ee();h=h===void 0?null:h;var w=y.memoizedState;return h!==null&&b(h,w[1])?w[0]:(y.memoizedState=[s,h],s)}function la(s,h){var y=ee();h=h===void 0?null:h;var w=y.memoizedState;if(h!==null&&b(h,w[1]))return w[0];if(w=s(),au){He(!0);try{s()}finally{He(!1)}}return y.memoizedState=[w,h],w}function ua(s,h,y){return y===void 0||(to&1073741824)!==0&&(xi&261930)===0?s.memoizedState=h:(s.memoizedState=y,s=g_(),Gn.lanes|=s,eh|=s,y)}function Go(s,h,y,w){return aa(y,h)?y:jo.current!==null?(s=ua(s,y,w),aa(s,h)||(Da=!0),s):(to&42)===0||(to&1073741824)!==0&&(xi&261930)===0?(Da=!0,s.memoizedState=y):(s=g_(),Gn.lanes|=s,eh|=s,h)}function ca(s,h,y,w,D){var B=$t.p;$t.p=B!==0&&8>B?B:8;var Q=mt.T,he={};mt.T=he,uu(s,!1,h,y);try{var Ue=D(),dt=mt.S;if(dt!==null&&dt(he,Ue),Ue!==null&&typeof Ue=="object"&&typeof Ue.then=="function"){var bt=ud(Ue,w);xc(s,h,bt,jl(s))}else xc(s,h,w,jl(s))}catch(Et){xc(s,h,{then:function(){},status:"rejected",reason:Et},jl())}finally{$t.p=B,Q!==null&&he.types!==null&&(Q.types=he.types),mt.T=Q}}function gd(){}function bc(s,h,y,w){if(s.tag!==5)throw Error(a(476));var D=ou(s).queue;ca(s,D,h,Tt,y===null?gd:function(){return xl(s),y(w)})}function ou(s){var h=s.memoizedState;if(h!==null)return h;h={memoizedState:Tt,baseState:Tt,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:we,lastRenderedState:Tt},next:null};var y={};return h.next={memoizedState:y,baseState:y,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:we,lastRenderedState:y},next:null},s.memoizedState=h,s=s.alternate,s!==null&&(s.memoizedState=h),h}function xl(s){var h=ou(s);h.next===null&&(h=s.alternate.memoizedState),xc(s,h.next.queue,{},jl())}function lu(){return Wa(Qn)}function ip(){return ee().memoizedState}function go(){return ee().memoizedState}function fm(s){for(var h=s.return;h!==null;){switch(h.tag){case 24:case 3:var y=jl();s=Pu(y);var w=ru(h,s,y);w!==null&&(yo(w,h,y),Wc(w,h,y)),h={cache:Uo()},s.payload=h;return}h=h.return}}function rp(s,h,y){var w=jl();y={lane:w,revertLane:0,gesture:null,action:y,hasEagerState:!1,eagerState:null,next:null},wl(s)?Fg(h,y):(y=ml(s,h,y,w),y!==null&&(yo(y,s,w),Qy(y,h,w)))}function _d(s,h,y){var w=jl();xc(s,h,y,w)}function xc(s,h,y,w){var D={lane:w,revertLane:0,gesture:null,action:y,hasEagerState:!1,eagerState:null,next:null};if(wl(s))Fg(h,D);else{var B=s.alternate;if(s.lanes===0&&(B===null||B.lanes===0)&&(B=h.lastRenderedReducer,B!==null))try{var Q=h.lastRenderedState,he=B(Q,y);if(D.hasEagerState=!0,D.eagerState=he,aa(he,Q))return Js(s,h,D,0),Sr===null&&rc(),!1}catch{}finally{}if(y=ml(s,h,D,w),y!==null)return yo(y,s,w),Qy(y,h,w),!0}return!1}function uu(s,h,y,w){if(w={lane:2,revertLane:Ac(),gesture:null,action:w,hasEagerState:!1,eagerState:null,next:null},wl(s)){if(h)throw Error(a(479))}else h=ml(s,y,w,2),h!==null&&yo(h,s,2)}function wl(s){var h=s.alternate;return s===Gn||h!==null&&h===Gn}function Fg(s,h){_c=Ch=!0;var y=s.pending;y===null?h.next=h:(h.next=y.next,y.next=h),s.pending=h}function Qy(s,h,y){if((y&4194048)!==0){var w=h.lanes;w&=s.pendingLanes,y|=w,h.lanes=y,Xn(s,y)}}var yd={readContext:Wa,use:me,useCallback:_,useContext:_,useEffect:_,useImperativeHandle:_,useLayoutEffect:_,useInsertionEffect:_,useMemo:_,useReducer:_,useRef:_,useState:_,useDebugValue:_,useDeferredValue:_,useTransition:_,useSyncExternalStore:_,useId:_,useHostTransitionStatus:_,useFormState:_,useActionState:_,useOptimistic:_,useMemoCache:_,useCacheRefresh:_};yd.useEffectEvent=_;var Vg={readContext:Wa,use:me,useCallback:function(s,h){return Z().memoizedState=[s,h===void 0?null:h],s},useContext:Wa,useEffect:Ru,useImperativeHandle:function(s,h,y){y=y!=null?y.concat([s]):null,Xa(4194308,4,no.bind(null,h,s),y)},useLayoutEffect:function(s,h){return Xa(4194308,4,s,h)},useInsertionEffect:function(s,h){Xa(4,2,s,h)},useMemo:function(s,h){var y=Z();h=h===void 0?null:h;var w=s();if(au){He(!0);try{s()}finally{He(!1)}}return y.memoizedState=[w,h],w},useReducer:function(s,h,y){var w=Z();if(y!==void 0){var D=y(h);if(au){He(!0);try{y(h)}finally{He(!1)}}}else D=h;return w.memoizedState=w.baseState=D,s={pending:null,lanes:0,dispatch:null,lastRenderedReducer:s,lastRenderedState:D},w.queue=s,s=s.dispatch=rp.bind(null,Gn,s),[w.memoizedState,s]},useRef:function(s){var h=Z();return s={current:s},h.memoizedState=s},useState:function(s){s=lt(s);var h=s.queue,y=_d.bind(null,Gn,h);return h.dispatch=y,[s.memoizedState,y]},useDebugValue:os,useDeferredValue:function(s,h){var y=Z();return ua(y,s,h)},useTransition:function(){var s=lt(!1);return s=ca.bind(null,Gn,s.queue,!0,!1),Z().memoizedState=s,[!1,s]},useSyncExternalStore:function(s,h,y){var w=Gn,D=Z();if(ui){if(y===void 0)throw Error(a(407));y=y()}else{if(y=h(),Sr===null)throw Error(a(349));(xi&127)!==0||Ie(w,h,y)}D.memoizedState=y;var B={value:y,getSnapshot:h};return D.queue=B,Ru(ct.bind(null,w,B,s),[s]),w.flags|=2048,Vr(9,{destroy:void 0},Ye.bind(null,w,B,y,h),null),y},useId:function(){var s=Z(),h=Sr.identifierPrefix;if(ui){var y=Xt,w=It;y=(w&~(1<<32-tt(w)-1)).toString(32)+y,h="_"+h+"R_"+y,y=Ih++,0<y&&(h+="H"+y.toString(32)),h+="_"}else y=u++,h="_"+h+"r_"+y.toString(32)+"_";return s.memoizedState=h},useHostTransitionStatus:lu,useFormState:Mr,useActionState:Mr,useOptimistic:function(s){var h=Z();h.memoizedState=h.baseState=s;var y={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return h.queue=y,h=uu.bind(null,Gn,!0,y),y.dispatch=h,[s,h]},useMemoCache:ve,useCacheRefresh:function(){return Z().memoizedState=fm.bind(null,Gn)},useEffectEvent:function(s){var h=Z(),y={impl:s};return h.memoizedState=y,function(){if((qi&2)!==0)throw Error(a(440));return y.impl.apply(void 0,arguments)}}},Ug={readContext:Wa,use:me,useCallback:ku,useContext:Wa,useEffect:su,useImperativeHandle:bl,useInsertionEffect:yc,useLayoutEffect:vc,useMemo:la,useReducer:Pe,useRef:La,useState:function(){return Pe(we)},useDebugValue:os,useDeferredValue:function(s,h){var y=ee();return Go(y,ji.memoizedState,s,h)},useTransition:function(){var s=Pe(we)[0],h=ee().memoizedState;return[typeof s=="boolean"?s:ge(s),h]},useSyncExternalStore:Ve,useId:ip,useHostTransitionStatus:lu,useFormState:Fr,useActionState:Fr,useOptimistic:function(s,h){var y=ee();return Nt(y,ji,s,h)},useMemoCache:ve,useCacheRefresh:go};Ug.useEffectEvent=Xc;var jg={readContext:Wa,use:me,useCallback:ku,useContext:Wa,useEffect:su,useImperativeHandle:bl,useInsertionEffect:yc,useLayoutEffect:vc,useMemo:la,useReducer:ze,useRef:La,useState:function(){return ze(we)},useDebugValue:os,useDeferredValue:function(s,h){var y=ee();return ji===null?ua(y,s,h):Go(y,ji.memoizedState,s,h)},useTransition:function(){var s=ze(we)[0],h=ee().memoizedState;return[typeof s=="boolean"?s:ge(s),h]},useSyncExternalStore:Ve,useId:ip,useHostTransitionStatus:lu,useFormState:oa,useActionState:oa,useOptimistic:function(s,h){var y=ee();return ji!==null?Nt(y,ji,s,h):(y.baseState=s,[s,y.queue.dispatch])},useMemoCache:ve,useCacheRefresh:go};jg.useEffectEvent=Xc;function $g(s,h,y,w){h=s.memoizedState,y=y(w,h),y=y==null?h:q({},h,y),s.memoizedState=y,s.lanes===0&&(s.updateQueue.baseState=y)}var ap={enqueueSetState:function(s,h,y){s=s._reactInternals;var w=jl(),D=Pu(w);D.payload=h,y!=null&&(D.callback=y),h=ru(s,D,w),h!==null&&(yo(h,s,w),Wc(h,s,w))},enqueueReplaceState:function(s,h,y){s=s._reactInternals;var w=jl(),D=Pu(w);D.tag=1,D.payload=h,y!=null&&(D.callback=y),h=ru(s,D,w),h!==null&&(yo(h,s,w),Wc(h,s,w))},enqueueForceUpdate:function(s,h){s=s._reactInternals;var y=jl(),w=Pu(y);w.tag=2,h!=null&&(w.callback=h),h=ru(s,w,y),h!==null&&(yo(h,s,y),Wc(h,s,y))}};function Jy(s,h,y,w,D,B,Q){return s=s.stateNode,typeof s.shouldComponentUpdate=="function"?s.shouldComponentUpdate(w,B,Q):h.prototype&&h.prototype.isPureReactComponent?!As(y,w)||!As(D,B):!0}function pm(s,h,y,w){s=h.state,typeof h.componentWillReceiveProps=="function"&&h.componentWillReceiveProps(y,w),typeof h.UNSAFE_componentWillReceiveProps=="function"&&h.UNSAFE_componentWillReceiveProps(y,w),h.state!==s&&ap.enqueueReplaceState(h,h.state,null)}function Mh(s,h){var y=h;if("ref"in h){y={};for(var w in h)w!=="ref"&&(y[w]=h[w])}if(s=s.defaultProps){y===h&&(y=q({},y));for(var D in s)y[D]===void 0&&(y[D]=s[D])}return y}function qg(s){Yl(s)}function vd(s){console.error(s)}function ev(s){Yl(s)}function Rh(s,h){try{var y=s.onUncaughtError;y(h.value,{componentStack:h.stack})}catch(w){setTimeout(function(){throw w})}}function sp(s,h,y){try{var w=s.onCaughtError;w(y.value,{componentStack:y.stack,errorBoundary:h.tag===1?h.stateNode:null})}catch(D){setTimeout(function(){throw D})}}function sf(s,h,y){return y=Pu(y),y.tag=3,y.payload={element:null},y.callback=function(){Rh(s,h)},y}function Gg(s){return s=Pu(s),s.tag=3,s}function Hg(s,h,y,w){var D=y.type.getDerivedStateFromError;if(typeof D=="function"){var B=w.value;s.payload=function(){return D(B)},s.callback=function(){sp(h,y,w)}}var Q=y.stateNode;Q!==null&&typeof Q.componentDidCatch=="function"&&(s.callback=function(){sp(h,y,w),typeof D!="function"&&(Dh===null?Dh=new Set([this]):Dh.add(this));var he=w.stack;this.componentDidCatch(w.value,{componentStack:he!==null?he:""})})}function ex(s,h,y,w,D){if(y.flags|=32768,w!==null&&typeof w=="object"&&typeof w.then=="function"){if(h=y.alternate,h!==null&&ka(h,y,D,!0),y=$o.current,y!==null){switch(y.tag){case 31:case 13:return Is===null?vp():y.alternate===null&&ya===0&&(ya=3),y.flags&=-257,y.flags|=65536,y.lanes=D,w===Gc?y.flags|=16384:(h=y.updateQueue,h===null?y.updateQueue=new Set([w]):h.add(w),xp(s,w,D)),!1;case 22:return y.flags|=65536,w===Gc?y.flags|=16384:(h=y.updateQueue,h===null?(h={transitions:null,markerInstances:null,retryQueue:new Set([w])},y.updateQueue=h):(y=h.retryQueue,y===null?h.retryQueue=new Set([w]):y.add(w)),xp(s,w,D)),!1}throw Error(a(435,y.tag))}return xp(s,w,D),vp(),!1}if(ui)return h=$o.current,h!==null?((h.flags&65536)===0&&(h.flags|=256),h.flags|=65536,h.lanes=D,w!==rs&&(s=Error(a(422),{cause:w}),Eu(x(s,y)))):(w!==rs&&(h=Error(a(423),{cause:w}),Eu(x(h,y))),s=s.current.alternate,s.flags|=65536,D&=-D,s.lanes|=D,w=x(w,y),D=sf(s.stateNode,w,D),rf(s,D),ya!==4&&(ya=2)),!1;var B=Error(a(520),{cause:w});if(B=x(B,y),Pd===null?Pd=[B]:Pd.push(B),ya!==4&&(ya=2),h===null)return!0;w=x(w,y),y=h;do{switch(y.tag){case 3:return y.flags|=65536,s=D&-D,y.lanes|=s,s=sf(y.stateNode,w,s),rf(y,s),!1;case 1:if(h=y.type,B=y.stateNode,(y.flags&128)===0&&(typeof h.getDerivedStateFromError=="function"||B!==null&&typeof B.componentDidCatch=="function"&&(Dh===null||!Dh.has(B))))return y.flags|=65536,D&=-D,y.lanes|=D,D=Gg(D),Hg(D,s,y,w),rf(y,D),!1}y=y.return}while(y!==null);return!1}var Zg=Error(a(461)),Da=!1;function Ps(s,h,y,w){h.child=s===null?yl(h,null,y,w):pc(h,s.child,y,w)}function Wg(s,h,y,w,D){y=y.render;var B=h.ref;if("ref"in w){var Q={};for(var he in w)he!=="ref"&&(Q[he]=w[he])}else Q=w;return Iu(h),w=S(s,h,y,Q,B,D),he=j(),s!==null&&!Da?(G(s,h,D),Ho(s,h,D)):(ui&&he&&_a(h),h.flags|=1,Ps(s,h,w,D),h.child)}function tv(s,h,y,w,D){if(s===null){var B=y.type;return typeof B=="function"&&!Oo(B)&&B.defaultProps===void 0&&y.compare===null?(h.tag=15,h.type=B,mm(s,h,B,w,D)):(s=ac(y.type,null,w,h,h.mode,D),s.ref=h.ref,s.return=h,h.child=s)}if(B=s.child,!xd(s,D)){var Q=B.memoizedProps;if(y=y.compare,y=y!==null?y:As,y(Q,w)&&s.ref===h.ref)return Ho(s,h,D)}return h.flags|=1,s=No(B,w),s.ref=h.ref,s.return=h,h.child=s}function mm(s,h,y,w,D){if(s!==null){var B=s.memoizedProps;if(As(B,w)&&s.ref===h.ref)if(Da=!1,h.pendingProps=w=B,xd(s,D))(s.flags&131072)!==0&&(Da=!0);else return h.lanes=s.lanes,Ho(s,h,D)}return _m(s,h,y,w,D)}function Kg(s,h,y,w){var D=w.children,B=s!==null?s.memoizedState:null;if(s===null&&h.stateNode===null&&(h.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),w.mode==="hidden"){if((h.flags&128)!==0){if(B=B!==null?B.baseLanes|y:y,s!==null){for(w=h.child=s.child,D=0;w!==null;)D=D|w.lanes|w.childLanes,w=w.sibling;w=D&~B}else w=0,h.child=null;return of(s,h,B,y,w)}if((y&536870912)!==0)h.memoizedState={baseLanes:0,cachePool:null},s!==null&&Sh(h,B!==null?B.cachePool:null),B!==null?Cs(h,B):af(),md(h);else return w=h.lanes=536870912,of(s,h,B!==null?B.baseLanes|y:y,y,w)}else B!==null?(Sh(h,B.cachePool),Cs(h,B),qo(),h.memoizedState=null):(s!==null&&Sh(h,null),af(),qo());return Ps(s,h,D,y),h.child}function bd(s,h){return s!==null&&s.tag===22||h.stateNode!==null||(h.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),h.sibling}function of(s,h,y,w,D){var B=Yt();return B=B===null?null:{parent:Ci._currentValue,pool:B},h.memoizedState={baseLanes:y,cachePool:B},s!==null&&Sh(h,null),af(),md(h),s!==null&&ka(s,h,w,!0),h.childLanes=D,null}function Ms(s,h){return h=vm({mode:h.mode,children:h.children},s.mode),h.ref=s.ref,s.child=h,h.return=s,h}function Xg(s,h,y){return pc(h,s.child,null,y),s=Ms(h,h.pendingProps),s.flags|=2,Ka(h),h.memoizedState=null,s}function Yg(s,h,y){var w=h.pendingProps,D=(h.flags&128)!==0;if(h.flags&=-129,s===null){if(ui){if(w.mode==="hidden")return s=Ms(h,w),h.lanes=536870912,bd(null,s);if(Br(h),(s=ki)?(s=Um(s,Wr),s=s!==null&&s.data==="&"?s:null,s!==null&&(h.memoizedState={dehydrated:s,treeContext:ut!==null?{id:It,overflow:Xt}:null,retryLane:536870912,hydrationErrors:null},y=oc(s),y.return=h,h.child=y,Si=h,ki=null)):s=null,s===null)throw Bo(h);return h.lanes=536870912,null}return Ms(h,w)}var B=s.memoizedState;if(B!==null){var Q=B.dehydrated;if(Br(h),D)if(h.flags&256)h.flags&=-257,h=Xg(s,h,y);else if(h.memoizedState!==null)h.child=s.child,h.flags|=128,h=null;else throw Error(a(558));else if(Da||ka(s,h,y,!1),D=(y&s.childLanes)!==0,Da||D){if(w=Sr,w!==null&&(Q=br(w,y),Q!==0&&Q!==B.retryLane))throw B.retryLane=Q,Do(s,Q),yo(w,s,Q),Zg;vp(),h=Xg(s,h,y)}else s=B.treeContext,ki=Sl(Q.nextSibling),Si=h,ui=!0,Li=null,Wr=!1,s!==null&&Za(h,s),h=Ms(h,w),h.flags|=4096;return h}return s=No(s.child,{mode:w.mode,children:w.children}),s.ref=h.ref,h.child=s,s.return=h,s}function gm(s,h){var y=h.ref;if(y===null)s!==null&&s.ref!==null&&(h.flags|=4194816);else{if(typeof y!="function"&&typeof y!="object")throw Error(a(284));(s===null||s.ref!==y)&&(h.flags|=4194816)}}function _m(s,h,y,w,D){return Iu(h),y=S(s,h,y,w,void 0,D),w=j(),s!==null&&!Da?(G(s,h,D),Ho(s,h,D)):(ui&&w&&_a(h),h.flags|=1,Ps(s,h,y,D),h.child)}function nv(s,h,y,w,D,B){return Iu(h),h.updateQueue=null,y=O(h,w,y,D),I(s),w=j(),s!==null&&!Da?(G(s,h,B),Ho(s,h,B)):(ui&&w&&_a(h),h.flags|=1,Ps(s,h,y,B),h.child)}function iv(s,h,y,w,D){if(Iu(h),h.stateNode===null){var B=zo,Q=y.contextType;typeof Q=="object"&&Q!==null&&(B=Wa(Q)),B=new y(w,B),h.memoizedState=B.state!==null&&B.state!==void 0?B.state:null,B.updater=ap,h.stateNode=B,B._reactInternals=h,B=h.stateNode,B.props=w,B.state=h.memoizedState,B.refs={},mc(h),Q=y.contextType,B.context=typeof Q=="object"&&Q!==null?Wa(Q):zo,B.state=h.memoizedState,Q=y.getDerivedStateFromProps,typeof Q=="function"&&($g(h,y,Q,w),B.state=h.memoizedState),typeof y.getDerivedStateFromProps=="function"||typeof B.getSnapshotBeforeUpdate=="function"||typeof B.UNSAFE_componentWillMount!="function"&&typeof B.componentWillMount!="function"||(Q=B.state,typeof B.componentWillMount=="function"&&B.componentWillMount(),typeof B.UNSAFE_componentWillMount=="function"&&B.UNSAFE_componentWillMount(),Q!==B.state&&ap.enqueueReplaceState(B,B.state,null),an(h,w,B,D),gc(),B.state=h.memoizedState),typeof B.componentDidMount=="function"&&(h.flags|=4194308),w=!0}else if(s===null){B=h.stateNode;var he=h.memoizedProps,Ue=Mh(y,he);B.props=Ue;var dt=B.context,bt=y.contextType;Q=zo,typeof bt=="object"&&bt!==null&&(Q=Wa(bt));var Et=y.getDerivedStateFromProps;bt=typeof Et=="function"||typeof B.getSnapshotBeforeUpdate=="function",he=h.pendingProps!==he,bt||typeof B.UNSAFE_componentWillReceiveProps!="function"&&typeof B.componentWillReceiveProps!="function"||(he||dt!==Q)&&pm(h,B,w,Q),Di=!1;var ft=h.memoizedState;B.state=ft,an(h,w,B,D),gc(),dt=h.memoizedState,he||ft!==dt||Di?(typeof Et=="function"&&($g(h,y,Et,w),dt=h.memoizedState),(Ue=Di||Jy(h,y,Ue,w,ft,dt,Q))?(bt||typeof B.UNSAFE_componentWillMount!="function"&&typeof B.componentWillMount!="function"||(typeof B.componentWillMount=="function"&&B.componentWillMount(),typeof B.UNSAFE_componentWillMount=="function"&&B.UNSAFE_componentWillMount()),typeof B.componentDidMount=="function"&&(h.flags|=4194308)):(typeof B.componentDidMount=="function"&&(h.flags|=4194308),h.memoizedProps=w,h.memoizedState=dt),B.props=w,B.state=dt,B.context=Q,w=Ue):(typeof B.componentDidMount=="function"&&(h.flags|=4194308),w=!1)}else{B=h.stateNode,fd(s,h),Q=h.memoizedProps,bt=Mh(y,Q),B.props=bt,Et=h.pendingProps,ft=B.context,dt=y.contextType,Ue=zo,typeof dt=="object"&&dt!==null&&(Ue=Wa(dt)),he=y.getDerivedStateFromProps,(dt=typeof he=="function"||typeof B.getSnapshotBeforeUpdate=="function")||typeof B.UNSAFE_componentWillReceiveProps!="function"&&typeof B.componentWillReceiveProps!="function"||(Q!==Et||ft!==Ue)&&pm(h,B,w,Ue),Di=!1,ft=h.memoizedState,B.state=ft,an(h,w,B,D),gc();var yt=h.memoizedState;Q!==Et||ft!==yt||Di||s!==null&&s.dependencies!==null&&Cu(s.dependencies)?(typeof he=="function"&&($g(h,y,he,w),yt=h.memoizedState),(bt=Di||Jy(h,y,bt,w,ft,yt,Ue)||s!==null&&s.dependencies!==null&&Cu(s.dependencies))?(dt||typeof B.UNSAFE_componentWillUpdate!="function"&&typeof B.componentWillUpdate!="function"||(typeof B.componentWillUpdate=="function"&&B.componentWillUpdate(w,yt,Ue),typeof B.UNSAFE_componentWillUpdate=="function"&&B.UNSAFE_componentWillUpdate(w,yt,Ue)),typeof B.componentDidUpdate=="function"&&(h.flags|=4),typeof B.getSnapshotBeforeUpdate=="function"&&(h.flags|=1024)):(typeof B.componentDidUpdate!="function"||Q===s.memoizedProps&&ft===s.memoizedState||(h.flags|=4),typeof B.getSnapshotBeforeUpdate!="function"||Q===s.memoizedProps&&ft===s.memoizedState||(h.flags|=1024),h.memoizedProps=w,h.memoizedState=yt),B.props=w,B.state=yt,B.context=Ue,w=bt):(typeof B.componentDidUpdate!="function"||Q===s.memoizedProps&&ft===s.memoizedState||(h.flags|=4),typeof B.getSnapshotBeforeUpdate!="function"||Q===s.memoizedProps&&ft===s.memoizedState||(h.flags|=1024),w=!1)}return B=w,gm(s,h),w=(h.flags&128)!==0,B||w?(B=h.stateNode,y=w&&typeof y.getDerivedStateFromError!="function"?null:B.render(),h.flags|=1,s!==null&&w?(h.child=pc(h,s.child,null,D),h.child=pc(h,null,y,D)):Ps(s,h,y,D),h.memoizedState=B.state,s=h.child):s=Ho(s,h,D),s}function Qg(s,h,y,w){return gl(),h.flags|=256,Ps(s,h,y,w),h.child}var Jg={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function op(s){return{baseLanes:s,cachePool:cd()}}function ym(s,h,y){return s=s!==null?s.childLanes&~y:0,h&&(s|=io),s}function e_(s,h,y){var w=h.pendingProps,D=!1,B=(h.flags&128)!==0,Q;if((Q=B)||(Q=s!==null&&s.memoizedState===null?!1:(Kr.current&2)!==0),Q&&(D=!0,h.flags&=-129),Q=(h.flags&32)!==0,h.flags&=-33,s===null){if(ui){if(D?gi(h):qo(),(s=ki)?(s=Um(s,Wr),s=s!==null&&s.data!=="&"?s:null,s!==null&&(h.memoizedState={dehydrated:s,treeContext:ut!==null?{id:It,overflow:Xt}:null,retryLane:536870912,hydrationErrors:null},y=oc(s),y.return=h,h.child=y,Si=h,ki=null)):s=null,s===null)throw Bo(h);return jm(s)?h.lanes=32:h.lanes=536870912,null}var he=w.children;return w=w.fallback,D?(qo(),D=h.mode,he=vm({mode:"hidden",children:he},D),w=wu(w,D,y,null),he.return=h,w.return=h,he.sibling=w,h.child=he,w=h.child,w.memoizedState=op(y),w.childLanes=ym(s,Q,y),h.memoizedState=Jg,bd(null,w)):(gi(h),t_(h,he))}var Ue=s.memoizedState;if(Ue!==null&&(he=Ue.dehydrated,he!==null)){if(B)h.flags&256?(gi(h),h.flags&=-257,h=n_(s,h,y)):h.memoizedState!==null?(qo(),h.child=s.child,h.flags|=128,h=null):(qo(),he=w.fallback,D=h.mode,w=vm({mode:"visible",children:w.children},D),he=wu(he,D,y,null),he.flags|=2,w.return=h,he.return=h,w.sibling=he,h.child=w,pc(h,s.child,null,y),w=h.child,w.memoizedState=op(y),w.childLanes=ym(s,Q,y),h.memoizedState=Jg,h=bd(null,w));else if(gi(h),jm(he)){if(Q=he.nextSibling&&he.nextSibling.dataset,Q)var dt=Q.dgst;Q=dt,w=Error(a(419)),w.stack="",w.digest=Q,Eu({value:w,source:null,stack:null}),h=n_(s,h,y)}else if(Da||ka(s,h,y,!1),Q=(y&s.childLanes)!==0,Da||Q){if(Q=Sr,Q!==null&&(w=br(Q,y),w!==0&&w!==Ue.retryLane))throw Ue.retryLane=w,Do(s,w),yo(Q,s,w),Zg;Ap(he)||vp(),h=n_(s,h,y)}else Ap(he)?(h.flags|=192,h.child=s.child,h=null):(s=Ue.treeContext,ki=Sl(he.nextSibling),Si=h,ui=!0,Li=null,Wr=!1,s!==null&&Za(h,s),h=t_(h,w.children),h.flags|=4096);return h}return D?(qo(),he=w.fallback,D=h.mode,Ue=s.child,dt=Ue.sibling,w=No(Ue,{mode:"hidden",children:w.children}),w.subtreeFlags=Ue.subtreeFlags&65011712,dt!==null?he=No(dt,he):(he=wu(he,D,y,null),he.flags|=2),he.return=h,w.return=h,w.sibling=he,h.child=w,bd(null,w),w=h.child,he=s.child.memoizedState,he===null?he=op(y):(D=he.cachePool,D!==null?(Ue=Ci._currentValue,D=D.parent!==Ue?{parent:Ue,pool:Ue}:D):D=cd(),he={baseLanes:he.baseLanes|y,cachePool:D}),w.memoizedState=he,w.childLanes=ym(s,Q,y),h.memoizedState=Jg,bd(s.child,w)):(gi(h),y=s.child,s=y.sibling,y=No(y,{mode:"visible",children:w.children}),y.return=h,y.sibling=null,s!==null&&(Q=h.deletions,Q===null?(h.deletions=[s],h.flags|=16):Q.push(s)),h.child=y,h.memoizedState=null,y)}function t_(s,h){return h=vm({mode:"visible",children:h},s.mode),h.return=s,s.child=h}function vm(s,h){return s=is(22,s,null,h),s.lanes=0,s}function n_(s,h,y){return pc(h,s.child,null,y),s=t_(h,h.pendingProps.children),s.flags|=2,h.memoizedState=null,s}function bm(s,h,y){s.lanes|=h;var w=s.alternate;w!==null&&(w.lanes|=h),Vo(s.return,h,y)}function lp(s,h,y,w,D,B){var Q=s.memoizedState;Q===null?s.memoizedState={isBackwards:h,rendering:null,renderingStartTime:0,last:w,tail:y,tailMode:D,treeForkCount:B}:(Q.isBackwards=h,Q.rendering=null,Q.renderingStartTime=0,Q.last=w,Q.tail=y,Q.tailMode=D,Q.treeForkCount=B)}function i_(s,h,y){var w=h.pendingProps,D=w.revealOrder,B=w.tail;w=w.children;var Q=Kr.current,he=(Q&2)!==0;if(he?(Q=Q&1|2,h.flags|=128):Q&=1,Ot(Kr,Q),Ps(s,h,w,y),w=ui?ue:0,!he&&s!==null&&(s.flags&128)!==0)e:for(s=h.child;s!==null;){if(s.tag===13)s.memoizedState!==null&&bm(s,y,h);else if(s.tag===19)bm(s,y,h);else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===h)break e;for(;s.sibling===null;){if(s.return===null||s.return===h)break e;s=s.return}s.sibling.return=s.return,s=s.sibling}switch(D){case"forwards":for(y=h.child,D=null;y!==null;)s=y.alternate,s!==null&&Mu(s)===null&&(D=y),y=y.sibling;y=D,y===null?(D=h.child,h.child=null):(D=y.sibling,y.sibling=null),lp(h,!1,D,y,B,w);break;case"backwards":case"unstable_legacy-backwards":for(y=null,D=h.child,h.child=null;D!==null;){if(s=D.alternate,s!==null&&Mu(s)===null){h.child=D;break}s=D.sibling,D.sibling=y,y=D,D=s}lp(h,!0,y,null,B,w);break;case"together":lp(h,!1,null,null,void 0,w);break;default:h.memoizedState=null}return h.child}function Ho(s,h,y){if(s!==null&&(h.dependencies=s.dependencies),eh|=h.lanes,(y&h.childLanes)===0)if(s!==null){if(ka(s,h,y,!1),(y&h.childLanes)===0)return null}else return null;if(s!==null&&h.child!==s.child)throw Error(a(153));if(h.child!==null){for(s=h.child,y=No(s,s.pendingProps),h.child=y,y.return=h;s.sibling!==null;)s=s.sibling,y=y.sibling=No(s,s.pendingProps),y.return=h;y.sibling=null}return h.child}function xd(s,h){return(s.lanes&h)!==0?!0:(s=s.dependencies,!!(s!==null&&Cu(s)))}function tx(s,h,y){switch(h.tag){case 3:oi(h,h.stateNode.containerInfo),Au(h,Ci,s.memoizedState.cache),gl();break;case 27:case 5:fs(h);break;case 4:oi(h,h.stateNode.containerInfo);break;case 10:Au(h,h.type,h.memoizedProps.value);break;case 31:if(h.memoizedState!==null)return h.flags|=128,Br(h),null;break;case 13:var w=h.memoizedState;if(w!==null)return w.dehydrated!==null?(gi(h),h.flags|=128,null):(y&h.child.childLanes)!==0?e_(s,h,y):(gi(h),s=Ho(s,h,y),s!==null?s.sibling:null);gi(h);break;case 19:var D=(s.flags&128)!==0;if(w=(y&h.childLanes)!==0,w||(ka(s,h,y,!1),w=(y&h.childLanes)!==0),D){if(w)return i_(s,h,y);h.flags|=128}if(D=h.memoizedState,D!==null&&(D.rendering=null,D.tail=null,D.lastEffect=null),Ot(Kr,Kr.current),w)break;return null;case 22:return h.lanes=0,Kg(s,h,y,h.pendingProps);case 24:Au(h,Ci,s.memoizedState.cache)}return Ho(s,h,y)}function rv(s,h,y){if(s!==null)if(s.memoizedProps!==h.pendingProps)Da=!0;else{if(!xd(s,y)&&(h.flags&128)===0)return Da=!1,tx(s,h,y);Da=(s.flags&131072)!==0}else Da=!1,ui&&(h.flags&1048576)!==0&&Yn(h,ue,h.index);switch(h.lanes=0,h.tag){case 16:e:{var w=h.pendingProps;if(s=Hc(h.elementType),h.type=s,typeof s=="function")Oo(s)?(w=Mh(s,w),h.tag=1,h=iv(null,h,s,w,y)):(h.tag=0,h=_m(null,h,s,w,y));else{if(s!=null){var D=s.$$typeof;if(D===Ze){h.tag=11,h=Wg(null,h,s,w,y);break e}else if(D===de){h.tag=14,h=tv(null,h,s,w,y);break e}}throw h=Pn(s)||s,Error(a(306,h,""))}}return h;case 0:return _m(s,h,h.type,h.pendingProps,y);case 1:return w=h.type,D=Mh(w,h.pendingProps),iv(s,h,w,D,y);case 3:e:{if(oi(h,h.stateNode.containerInfo),s===null)throw Error(a(387));w=h.pendingProps;var B=h.memoizedState;D=B.element,fd(s,h),an(h,w,null,y);var Q=h.memoizedState;if(w=Q.cache,Au(h,Ci,w),w!==B.cache&&uc(h,[Ci],y,!0),gc(),w=Q.element,B.isDehydrated)if(B={element:w,isDehydrated:!1,cache:Q.cache},h.updateQueue.baseState=B,h.memoizedState=B,h.flags&256){h=Qg(s,h,w,y);break e}else if(w!==D){D=x(Error(a(424)),h),Eu(D),h=Qg(s,h,w,y);break e}else{switch(s=h.stateNode.containerInfo,s.nodeType){case 9:s=s.body;break;default:s=s.nodeName==="HTML"?s.ownerDocument.body:s}for(ki=Sl(s.firstChild),Si=h,ui=!0,Li=null,Wr=!0,y=yl(h,null,w,y),h.child=y;y;)y.flags=y.flags&-3|4096,y=y.sibling}else{if(gl(),w===D){h=Ho(s,h,y);break e}Ps(s,h,w,y)}h=h.child}return h;case 26:return gm(s,h),s===null?(y=te(h.type,null,h.pendingProps,null))?h.memoizedState=y:ui||(y=h.type,s=h.pendingProps,w=Dd(Wt.current).createElement(y),w[kt]=h,w[yn]=s,ro(w,y,s),Pr(w),h.stateNode=w):h.memoizedState=te(h.type,s.memoizedProps,h.pendingProps,s.memoizedState),null;case 27:return fs(h),s===null&&ui&&(w=h.stateNode=Tf(h.type,h.pendingProps,Wt.current),Si=h,Wr=!0,D=ki,Cc(h.type)?($m=D,ki=Sl(w.firstChild)):ki=D),Ps(s,h,h.pendingProps.children,y),gm(s,h),s===null&&(h.flags|=4194304),h.child;case 5:return s===null&&ui&&((D=w=ki)&&(w=hx(w,h.type,h.pendingProps,Wr),w!==null?(h.stateNode=w,Si=h,ki=Sl(w.firstChild),Wr=!1,D=!0):D=!1),D||Bo(h)),fs(h),D=h.type,B=h.pendingProps,Q=s!==null?s.memoizedProps:null,w=B.children,L_(D,B)?w=null:Q!==null&&L_(D,Q)&&(h.flags|=32),h.memoizedState!==null&&(D=S(s,h,N,null,null,y),Qn._currentValue=D),gm(s,h),Ps(s,h,w,y),h.child;case 6:return s===null&&ui&&((s=y=ki)&&(y=Bv(y,h.pendingProps,Wr),y!==null?(h.stateNode=y,Si=h,ki=null,s=!0):s=!1),s||Bo(h)),null;case 13:return e_(s,h,y);case 4:return oi(h,h.stateNode.containerInfo),w=h.pendingProps,s===null?h.child=pc(h,null,w,y):Ps(s,h,w,y),h.child;case 11:return Wg(s,h,h.type,h.pendingProps,y);case 7:return Ps(s,h,h.pendingProps,y),h.child;case 8:return Ps(s,h,h.pendingProps.children,y),h.child;case 12:return Ps(s,h,h.pendingProps.children,y),h.child;case 10:return w=h.pendingProps,Au(h,h.type,w.value),Ps(s,h,w.children,y),h.child;case 9:return D=h.type._context,w=h.pendingProps.children,Iu(h),D=Wa(D),w=w(D),h.flags|=1,Ps(s,h,w,y),h.child;case 14:return tv(s,h,h.type,h.pendingProps,y);case 15:return mm(s,h,h.type,h.pendingProps,y);case 19:return i_(s,h,y);case 31:return Yg(s,h,y);case 22:return Kg(s,h,y,h.pendingProps);case 24:return Iu(h),w=Wa(Ci),s===null?(D=Yt(),D===null&&(D=Sr,B=Uo(),D.pooledCache=B,B.refCount++,B!==null&&(D.pooledCacheLanes|=y),D=B),h.memoizedState={parent:w,cache:D},mc(h),Au(h,Ci,D)):((s.lanes&y)!==0&&(fd(s,h),an(h,null,null,y),gc()),D=s.memoizedState,B=h.memoizedState,D.parent!==w?(D={parent:w,cache:w},h.memoizedState=D,h.lanes===0&&(h.memoizedState=h.updateQueue.baseState=D),Au(h,Ci,w)):(w=B.cache,Au(h,Ci,w),w!==D.cache&&uc(h,[Ci],y,!0))),Ps(s,h,h.pendingProps.children,y),h.child;case 29:throw h.pendingProps}throw Error(a(156,h.tag))}function Yc(s){s.flags|=4}function r_(s,h,y,w,D){if((h=(s.mode&32)!==0)&&(h=!1),h){if(s.flags|=16777216,(D&335544128)===D)if(s.stateNode.complete)s.flags|=8192;else if(y_())s.flags|=8192;else throw iu=Gc,dc}else s.flags&=-16777217}function av(s,h){if(h.type!=="stylesheet"||(h.state.loading&4)!==0)s.flags&=-16777217;else if(s.flags|=16777216,!dn(h))if(y_())s.flags|=8192;else throw iu=Gc,dc}function xm(s,h){h!==null&&(s.flags|=4),s.flags&16384&&(h=s.tag!==22?Ri():536870912,s.lanes|=h,Xr|=h)}function up(s,h){if(!ui)switch(s.tailMode){case"hidden":h=s.tail;for(var y=null;h!==null;)h.alternate!==null&&(y=h),h=h.sibling;y===null?s.tail=null:y.sibling=null;break;case"collapsed":y=s.tail;for(var w=null;y!==null;)y.alternate!==null&&(w=y),y=y.sibling;w===null?h||s.tail===null?s.tail=null:s.tail.sibling=null:w.sibling=null}}function Rr(s){var h=s.alternate!==null&&s.alternate.child===s.child,y=0,w=0;if(h)for(var D=s.child;D!==null;)y|=D.lanes|D.childLanes,w|=D.subtreeFlags&65011712,w|=D.flags&65011712,D.return=s,D=D.sibling;else for(D=s.child;D!==null;)y|=D.lanes|D.childLanes,w|=D.subtreeFlags,w|=D.flags,D.return=s,D=D.sibling;return s.subtreeFlags|=w,s.childLanes=y,h}function nx(s,h,y){var w=h.pendingProps;switch(Zr(h),h.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Rr(h),null;case 1:return Rr(h),null;case 3:return y=h.stateNode,w=null,s!==null&&(w=s.memoizedState.cache),h.memoizedState.cache!==w&&(h.flags|=2048),Jl(Ci),fi(),y.pendingContext&&(y.context=y.pendingContext,y.pendingContext=null),(s===null||s.child===null)&&(as(h)?Yc(h):s===null||s.memoizedState.isDehydrated&&(h.flags&256)===0||(h.flags|=1024,Fo())),Rr(h),null;case 26:var D=h.type,B=h.memoizedState;return s===null?(Yc(h),B!==null?(Rr(h),av(h,B)):(Rr(h),r_(h,D,null,w,y))):B?B!==s.memoizedState?(Yc(h),Rr(h),av(h,B)):(Rr(h),h.flags&=-16777217):(s=s.memoizedProps,s!==w&&Yc(h),Rr(h),r_(h,D,s,w,y)),null;case 27:if(Bs(h),y=Wt.current,D=h.type,s!==null&&h.stateNode!=null)s.memoizedProps!==w&&Yc(h);else{if(!w){if(h.stateNode===null)throw Error(a(166));return Rr(h),null}s=Ut.current,as(h)?Su(h):(s=Tf(D,w,y),h.stateNode=s,Yc(h))}return Rr(h),null;case 5:if(Bs(h),D=h.type,s!==null&&h.stateNode!=null)s.memoizedProps!==w&&Yc(h);else{if(!w){if(h.stateNode===null)throw Error(a(166));return Rr(h),null}if(B=Ut.current,as(h))Su(h);else{var Q=Dd(Wt.current);switch(B){case 1:B=Q.createElementNS("http://www.w3.org/2000/svg",D);break;case 2:B=Q.createElementNS("http://www.w3.org/1998/Math/MathML",D);break;default:switch(D){case"svg":B=Q.createElementNS("http://www.w3.org/2000/svg",D);break;case"math":B=Q.createElementNS("http://www.w3.org/1998/Math/MathML",D);break;case"script":B=Q.createElement("div"),B.innerHTML="<script><\/script>",B=B.removeChild(B.firstChild);break;case"select":B=typeof w.is=="string"?Q.createElement("select",{is:w.is}):Q.createElement("select"),w.multiple?B.multiple=!0:w.size&&(B.size=w.size);break;default:B=typeof w.is=="string"?Q.createElement(D,{is:w.is}):Q.createElement(D)}}B[kt]=h,B[yn]=w;e:for(Q=h.child;Q!==null;){if(Q.tag===5||Q.tag===6)B.appendChild(Q.stateNode);else if(Q.tag!==4&&Q.tag!==27&&Q.child!==null){Q.child.return=Q,Q=Q.child;continue}if(Q===h)break e;for(;Q.sibling===null;){if(Q.return===null||Q.return===h)break e;Q=Q.return}Q.sibling.return=Q.return,Q=Q.sibling}h.stateNode=B;e:switch(ro(B,D,w),D){case"button":case"input":case"select":case"textarea":w=!!w.autoFocus;break e;case"img":w=!0;break e;default:w=!1}w&&Yc(h)}}return Rr(h),r_(h,h.type,s===null?null:s.memoizedProps,h.pendingProps,y),null;case 6:if(s&&h.stateNode!=null)s.memoizedProps!==w&&Yc(h);else{if(typeof w!="string"&&h.stateNode===null)throw Error(a(166));if(s=Wt.current,as(h)){if(s=h.stateNode,y=h.memoizedProps,w=null,D=Si,D!==null)switch(D.tag){case 27:case 5:w=D.memoizedProps}s[kt]=h,s=!!(s.nodeValue===y||w!==null&&w.suppressHydrationWarning===!0||R_(s.nodeValue,y)),s||Bo(h,!0)}else s=Dd(s).createTextNode(w),s[kt]=h,h.stateNode=s}return Rr(h),null;case 31:if(y=h.memoizedState,s===null||s.memoizedState!==null){if(w=as(h),y!==null){if(s===null){if(!w)throw Error(a(318));if(s=h.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(a(557));s[kt]=h}else gl(),(h.flags&128)===0&&(h.memoizedState=null),h.flags|=4;Rr(h),s=!1}else y=Fo(),s!==null&&s.memoizedState!==null&&(s.memoizedState.hydrationErrors=y),s=!0;if(!s)return h.flags&256?(Ka(h),h):(Ka(h),null);if((h.flags&128)!==0)throw Error(a(558))}return Rr(h),null;case 13:if(w=h.memoizedState,s===null||s.memoizedState!==null&&s.memoizedState.dehydrated!==null){if(D=as(h),w!==null&&w.dehydrated!==null){if(s===null){if(!D)throw Error(a(318));if(D=h.memoizedState,D=D!==null?D.dehydrated:null,!D)throw Error(a(317));D[kt]=h}else gl(),(h.flags&128)===0&&(h.memoizedState=null),h.flags|=4;Rr(h),D=!1}else D=Fo(),s!==null&&s.memoizedState!==null&&(s.memoizedState.hydrationErrors=D),D=!0;if(!D)return h.flags&256?(Ka(h),h):(Ka(h),null)}return Ka(h),(h.flags&128)!==0?(h.lanes=y,h):(y=w!==null,s=s!==null&&s.memoizedState!==null,y&&(w=h.child,D=null,w.alternate!==null&&w.alternate.memoizedState!==null&&w.alternate.memoizedState.cachePool!==null&&(D=w.alternate.memoizedState.cachePool.pool),B=null,w.memoizedState!==null&&w.memoizedState.cachePool!==null&&(B=w.memoizedState.cachePool.pool),B!==D&&(w.flags|=2048)),y!==s&&y&&(h.child.flags|=8192),xm(h,h.updateQueue),Rr(h),null);case 4:return fi(),s===null&&Ld(h.stateNode.containerInfo),Rr(h),null;case 10:return Jl(h.type),Rr(h),null;case 19:if(vt(Kr),w=h.memoizedState,w===null)return Rr(h),null;if(D=(h.flags&128)!==0,B=w.rendering,B===null)if(D)up(w,!1);else{if(ya!==0||s!==null&&(s.flags&128)!==0)for(s=h.child;s!==null;){if(B=Mu(s),B!==null){for(h.flags|=128,up(w,!1),s=B.updateQueue,h.updateQueue=s,xm(h,s),h.subtreeFlags=0,s=y,y=h.child;y!==null;)od(y,s),y=y.sibling;return Ot(Kr,Kr.current&1|2),ui&&pn(h,w.treeForkCount),h.child}s=s.sibling}w.tail!==null&&qr()>gp&&(h.flags|=128,D=!0,up(w,!1),h.lanes=4194304)}else{if(!D)if(s=Mu(B),s!==null){if(h.flags|=128,D=!0,s=s.updateQueue,h.updateQueue=s,xm(h,s),up(w,!0),w.tail===null&&w.tailMode==="hidden"&&!B.alternate&&!ui)return Rr(h),null}else 2*qr()-w.renderingStartTime>gp&&y!==536870912&&(h.flags|=128,D=!0,up(w,!1),h.lanes=4194304);w.isBackwards?(B.sibling=h.child,h.child=B):(s=w.last,s!==null?s.sibling=B:h.child=B,w.last=B)}return w.tail!==null?(s=w.tail,w.rendering=s,w.tail=s.sibling,w.renderingStartTime=qr(),s.sibling=null,y=Kr.current,Ot(Kr,D?y&1|2:y&1),ui&&pn(h,w.treeForkCount),s):(Rr(h),null);case 22:case 23:return Ka(h),po(),w=h.memoizedState!==null,s!==null?s.memoizedState!==null!==w&&(h.flags|=8192):w&&(h.flags|=8192),w?(y&536870912)!==0&&(h.flags&128)===0&&(Rr(h),h.subtreeFlags&6&&(h.flags|=8192)):Rr(h),y=h.updateQueue,y!==null&&xm(h,y.retryQueue),y=null,s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(y=s.memoizedState.cachePool.pool),w=null,h.memoizedState!==null&&h.memoizedState.cachePool!==null&&(w=h.memoizedState.cachePool.pool),w!==y&&(h.flags|=2048),s!==null&&vt(ss),null;case 24:return y=null,s!==null&&(y=s.memoizedState.cache),h.memoizedState.cache!==y&&(h.flags|=2048),Jl(Ci),Rr(h),null;case 25:return null;case 30:return null}throw Error(a(156,h.tag))}function sv(s,h){switch(Zr(h),h.tag){case 1:return s=h.flags,s&65536?(h.flags=s&-65537|128,h):null;case 3:return Jl(Ci),fi(),s=h.flags,(s&65536)!==0&&(s&128)===0?(h.flags=s&-65537|128,h):null;case 26:case 27:case 5:return Bs(h),null;case 31:if(h.memoizedState!==null){if(Ka(h),h.alternate===null)throw Error(a(340));gl()}return s=h.flags,s&65536?(h.flags=s&-65537|128,h):null;case 13:if(Ka(h),s=h.memoizedState,s!==null&&s.dehydrated!==null){if(h.alternate===null)throw Error(a(340));gl()}return s=h.flags,s&65536?(h.flags=s&-65537|128,h):null;case 19:return vt(Kr),null;case 4:return fi(),null;case 10:return Jl(h.type),null;case 22:case 23:return Ka(h),po(),s!==null&&vt(ss),s=h.flags,s&65536?(h.flags=s&-65537|128,h):null;case 24:return Jl(Ci),null;case 25:return null;default:return null}}function lf(s,h){switch(Zr(h),h.tag){case 3:Jl(Ci),fi();break;case 26:case 27:case 5:Bs(h);break;case 4:fi();break;case 31:h.memoizedState!==null&&Ka(h);break;case 13:Ka(h);break;case 19:vt(Kr);break;case 10:Jl(h.type);break;case 22:case 23:Ka(h),po(),s!==null&&vt(ss);break;case 24:Jl(Ci)}}function cp(s,h){try{var y=h.updateQueue,w=y!==null?y.lastEffect:null;if(w!==null){var D=w.next;y=D;do{if((y.tag&s)===s){w=void 0;var B=y.create,Q=y.inst;w=B(),Q.destroy=w}y=y.next}while(y!==D)}}catch(he){Qi(h,h.return,he)}}function hr(s,h,y){try{var w=h.updateQueue,D=w!==null?w.lastEffect:null;if(D!==null){var B=D.next;w=B;do{if((w.tag&s)===s){var Q=w.inst,he=Q.destroy;if(he!==void 0){Q.destroy=void 0,D=h;var Ue=y,dt=he;try{dt()}catch(bt){Qi(D,Ue,bt)}}}w=w.next}while(w!==B)}}catch(bt){Qi(h,h.return,bt)}}function wd(s){var h=s.updateQueue;if(h!==null){var y=s.stateNode;try{pd(h,y)}catch(w){Qi(s,s.return,w)}}}function a_(s,h,y){y.props=Mh(s.type,s.memoizedProps),y.state=s.memoizedState;try{y.componentWillUnmount()}catch(w){Qi(s,h,w)}}function kh(s,h){try{var y=s.ref;if(y!==null){switch(s.tag){case 26:case 27:case 5:var w=s.stateNode;break;case 30:w=s.stateNode;break;default:w=s.stateNode}typeof y=="function"?s.refCleanup=y(w):y.current=w}}catch(D){Qi(s,h,D)}}function Ul(s,h){var y=s.ref,w=s.refCleanup;if(y!==null)if(typeof w=="function")try{w()}catch(D){Qi(s,h,D)}finally{s.refCleanup=null,s=s.alternate,s!=null&&(s.refCleanup=null)}else if(typeof y=="function")try{y(null)}catch(D){Qi(s,h,D)}else y.current=null}function uf(s){var h=s.type,y=s.memoizedProps,w=s.stateNode;try{e:switch(h){case"button":case"input":case"select":case"textarea":y.autoFocus&&w.focus();break e;case"img":y.src?w.src=y.src:y.srcSet&&(w.srcset=y.srcSet)}}catch(D){Qi(s,s.return,D)}}function wm(s,h,y){try{var w=s.stateNode;ux(w,s.type,y,h),w[yn]=h}catch(D){Qi(s,s.return,D)}}function s_(s){return s.tag===5||s.tag===3||s.tag===26||s.tag===27&&Cc(s.type)||s.tag===4}function Td(s){e:for(;;){for(;s.sibling===null;){if(s.return===null||s_(s.return))return null;s=s.return}for(s.sibling.return=s.return,s=s.sibling;s.tag!==5&&s.tag!==6&&s.tag!==18;){if(s.tag===27&&Cc(s.type)||s.flags&2||s.child===null||s.tag===4)continue e;s.child.return=s,s=s.child}if(!(s.flags&2))return s.stateNode}}function hp(s,h,y){var w=s.tag;if(w===5||w===6)s=s.stateNode,h?(y.nodeType===9?y.body:y.nodeName==="HTML"?y.ownerDocument.body:y).insertBefore(s,h):(h=y.nodeType===9?y.body:y.nodeName==="HTML"?y.ownerDocument.body:y,h.appendChild(s),y=y._reactRootContainer,y!=null||h.onclick!==null||(h.onclick=Pa));else if(w!==4&&(w===27&&Cc(s.type)&&(y=s.stateNode,h=null),s=s.child,s!==null))for(hp(s,h,y),s=s.sibling;s!==null;)hp(s,h,y),s=s.sibling}function Qc(s,h,y){var w=s.tag;if(w===5||w===6)s=s.stateNode,h?y.insertBefore(s,h):y.appendChild(s);else if(w!==4&&(w===27&&Cc(s.type)&&(y=s.stateNode),s=s.child,s!==null))for(Qc(s,h,y),s=s.sibling;s!==null;)Qc(s,h,y),s=s.sibling}function dp(s){var h=s.stateNode,y=s.memoizedProps;try{for(var w=s.type,D=h.attributes;D.length;)h.removeAttributeNode(D[0]);ro(h,w,y),h[kt]=s,h[yn]=y}catch(B){Qi(s,s.return,B)}}var Tl=!1,Jr=!1,o_=!1,l_=typeof WeakSet=="function"?WeakSet:Set,ea=null;function ix(s,h){if(s=s.containerInfo,wf=ba,s=tc(s),hl(s)){if("selectionStart"in s)var y={start:s.selectionStart,end:s.selectionEnd};else e:{y=(y=s.ownerDocument)&&y.defaultView||window;var w=y.getSelection&&y.getSelection();if(w&&w.rangeCount!==0){y=w.anchorNode;var D=w.anchorOffset,B=w.focusNode;w=w.focusOffset;try{y.nodeType,B.nodeType}catch{y=null;break e}var Q=0,he=-1,Ue=-1,dt=0,bt=0,Et=s,ft=null;t:for(;;){for(var yt;Et!==y||D!==0&&Et.nodeType!==3||(he=Q+D),Et!==B||w!==0&&Et.nodeType!==3||(Ue=Q+w),Et.nodeType===3&&(Q+=Et.nodeValue.length),(yt=Et.firstChild)!==null;)ft=Et,Et=yt;for(;;){if(Et===s)break t;if(ft===y&&++dt===D&&(he=Q),ft===B&&++bt===w&&(Ue=Q),(yt=Et.nextSibling)!==null)break;Et=ft,ft=Et.parentNode}Et=yt}y=he===-1||Ue===-1?null:{start:he,end:Ue}}else y=null}y=y||{start:0,end:0}}else y=null;for(Bm={focusedElem:s,selectionRange:y},ba=!1,ea=h;ea!==null;)if(h=ea,s=h.child,(h.subtreeFlags&1028)!==0&&s!==null)s.return=h,ea=s;else for(;ea!==null;){switch(h=ea,B=h.alternate,s=h.flags,h.tag){case 0:if((s&4)!==0&&(s=h.updateQueue,s=s!==null?s.events:null,s!==null))for(y=0;y<s.length;y++)D=s[y],D.ref.impl=D.nextImpl;break;case 11:case 15:break;case 1:if((s&1024)!==0&&B!==null){s=void 0,y=h,D=B.memoizedProps,B=B.memoizedState,w=y.stateNode;try{var cn=Mh(y.type,D);s=w.getSnapshotBeforeUpdate(cn,B),w.__reactInternalSnapshotBeforeUpdate=s}catch(En){Qi(y,y.return,En)}}break;case 3:if((s&1024)!==0){if(s=h.stateNode.containerInfo,y=s.nodeType,y===9)Vm(s);else if(y===1)switch(s.nodeName){case"HEAD":case"HTML":case"BODY":Vm(s);break;default:s.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((s&1024)!==0)throw Error(a(163))}if(s=h.sibling,s!==null){s.return=h.return,ea=s;break}ea=h.return}}function u_(s,h,y){var w=y.flags;switch(y.tag){case 0:case 11:case 15:Tc(s,y),w&4&&cp(5,y);break;case 1:if(Tc(s,y),w&4)if(s=y.stateNode,h===null)try{s.componentDidMount()}catch(Q){Qi(y,y.return,Q)}else{var D=Mh(y.type,h.memoizedProps);h=h.memoizedState;try{s.componentDidUpdate(D,h,s.__reactInternalSnapshotBeforeUpdate)}catch(Q){Qi(y,y.return,Q)}}w&64&&wd(y),w&512&&kh(y,y.return);break;case 3:if(Tc(s,y),w&64&&(s=y.updateQueue,s!==null)){if(h=null,y.child!==null)switch(y.child.tag){case 27:case 5:h=y.child.stateNode;break;case 1:h=y.child.stateNode}try{pd(s,h)}catch(Q){Qi(y,y.return,Q)}}break;case 27:h===null&&w&4&&dp(y);case 26:case 5:Tc(s,y),h===null&&w&4&&uf(y),w&512&&kh(y,y.return);break;case 12:Tc(s,y);break;case 31:Tc(s,y),w&4&&lv(s,y);break;case 13:Tc(s,y),w&4&&uv(s,y),w&64&&(s=y.memoizedState,s!==null&&(s=s.dehydrated,s!==null&&(y=E_.bind(null,y),Cp(s,y))));break;case 22:if(w=y.memoizedState!==null||Tl,!w){h=h!==null&&h.memoizedState!==null||Jr,D=Tl;var B=Jr;Tl=w,(Jr=h)&&!B?Du(s,y,(y.subtreeFlags&8772)!==0):Tc(s,y),Tl=D,Jr=B}break;case 30:break;default:Tc(s,y)}}function cf(s){var h=s.alternate;h!==null&&(s.alternate=null,cf(h)),s.child=null,s.deletions=null,s.sibling=null,s.tag===5&&(h=s.stateNode,h!==null&&js(h)),s.stateNode=null,s.return=null,s.dependencies=null,s.memoizedProps=null,s.memoizedState=null,s.pendingProps=null,s.stateNode=null,s.updateQueue=null}var Ur=null,Zo=!1;function wc(s,h,y){for(y=y.child;y!==null;)ov(s,h,y),y=y.sibling}function ov(s,h,y){if(De&&typeof De.onCommitFiberUnmount=="function")try{De.onCommitFiberUnmount(Se,y)}catch{}switch(y.tag){case 26:Jr||Ul(y,h),wc(s,h,y),y.memoizedState?y.memoizedState.count--:y.stateNode&&(y=y.stateNode,y.parentNode.removeChild(y));break;case 27:Jr||Ul(y,h);var w=Ur,D=Zo;Cc(y.type)&&(Ur=y.stateNode,Zo=!1),wc(s,h,y),Od(y.stateNode),Ur=w,Zo=D;break;case 5:Jr||Ul(y,h);case 6:if(w=Ur,D=Zo,Ur=null,wc(s,h,y),Ur=w,Zo=D,Ur!==null)if(Zo)try{(Ur.nodeType===9?Ur.body:Ur.nodeName==="HTML"?Ur.ownerDocument.body:Ur).removeChild(y.stateNode)}catch(B){Qi(y,h,B)}else try{Ur.removeChild(y.stateNode)}catch(B){Qi(y,h,B)}break;case 18:Ur!==null&&(Zo?(s=Ur,Nv(s.nodeType===9?s.body:s.nodeName==="HTML"?s.ownerDocument.body:s,y.stateNode),Cl(s)):Nv(Ur,y.stateNode));break;case 4:w=Ur,D=Zo,Ur=y.stateNode.containerInfo,Zo=!0,wc(s,h,y),Ur=w,Zo=D;break;case 0:case 11:case 14:case 15:hr(2,y,h),Jr||hr(4,y,h),wc(s,h,y);break;case 1:Jr||(Ul(y,h),w=y.stateNode,typeof w.componentWillUnmount=="function"&&a_(y,h,w)),wc(s,h,y);break;case 21:wc(s,h,y);break;case 22:Jr=(w=Jr)||y.memoizedState!==null,wc(s,h,y),Jr=w;break;default:wc(s,h,y)}}function lv(s,h){if(h.memoizedState===null&&(s=h.alternate,s!==null&&(s=s.memoizedState,s!==null))){s=s.dehydrated;try{Cl(s)}catch(y){Qi(h,h.return,y)}}}function uv(s,h){if(h.memoizedState===null&&(s=h.alternate,s!==null&&(s=s.memoizedState,s!==null&&(s=s.dehydrated,s!==null))))try{Cl(s)}catch(y){Qi(h,h.return,y)}}function rx(s){switch(s.tag){case 31:case 13:case 19:var h=s.stateNode;return h===null&&(h=s.stateNode=new l_),h;case 22:return s=s.stateNode,h=s._retryCache,h===null&&(h=s._retryCache=new l_),h;default:throw Error(a(435,s.tag))}}function Tm(s,h){var y=rx(s);h.forEach(function(w){if(!y.has(w)){y.add(w);var D=vf.bind(null,s,w);w.then(D,D)}})}function ls(s,h){var y=h.deletions;if(y!==null)for(var w=0;w<y.length;w++){var D=y[w],B=s,Q=h,he=Q;e:for(;he!==null;){switch(he.tag){case 27:if(Cc(he.type)){Ur=he.stateNode,Zo=!1;break e}break;case 5:Ur=he.stateNode,Zo=!1;break e;case 3:case 4:Ur=he.stateNode.containerInfo,Zo=!0;break e}he=he.return}if(Ur===null)throw Error(a(160));ov(B,Q,D),Ur=null,Zo=!1,B=D.alternate,B!==null&&(B.return=null),D.return=null}if(h.subtreeFlags&13886)for(h=h.child;h!==null;)cv(h,s),h=h.sibling}var Lu=null;function cv(s,h){var y=s.alternate,w=s.flags;switch(s.tag){case 0:case 11:case 14:case 15:ls(h,s),Wo(s),w&4&&(hr(3,s,s.return),cp(3,s),hr(5,s,s.return));break;case 1:ls(h,s),Wo(s),w&512&&(Jr||y===null||Ul(y,y.return)),w&64&&Tl&&(s=s.updateQueue,s!==null&&(w=s.callbacks,w!==null&&(y=s.shared.hiddenCallbacks,s.shared.hiddenCallbacks=y===null?w:y.concat(w))));break;case 26:var D=Lu;if(ls(h,s),Wo(s),w&512&&(Jr||y===null||Ul(y,y.return)),w&4){var B=y!==null?y.memoizedState:null;if(w=s.memoizedState,y===null)if(w===null)if(s.stateNode===null){e:{w=s.type,y=s.memoizedProps,D=D.ownerDocument||D;t:switch(w){case"title":B=D.getElementsByTagName("title")[0],(!B||B[Us]||B[kt]||B.namespaceURI==="http://www.w3.org/2000/svg"||B.hasAttribute("itemprop"))&&(B=D.createElement(w),D.head.insertBefore(B,D.querySelector("head > title"))),ro(B,w,y),B[kt]=s,Pr(B),w=B;break e;case"link":var Q=Gt("link","href",D).get(w+(y.href||""));if(Q){for(var he=0;he<Q.length;he++)if(B=Q[he],B.getAttribute("href")===(y.href==null||y.href===""?null:y.href)&&B.getAttribute("rel")===(y.rel==null?null:y.rel)&&B.getAttribute("title")===(y.title==null?null:y.title)&&B.getAttribute("crossorigin")===(y.crossOrigin==null?null:y.crossOrigin)){Q.splice(he,1);break t}}B=D.createElement(w),ro(B,w,y),D.head.appendChild(B);break;case"meta":if(Q=Gt("meta","content",D).get(w+(y.content||""))){for(he=0;he<Q.length;he++)if(B=Q[he],B.getAttribute("content")===(y.content==null?null:""+y.content)&&B.getAttribute("name")===(y.name==null?null:y.name)&&B.getAttribute("property")===(y.property==null?null:y.property)&&B.getAttribute("http-equiv")===(y.httpEquiv==null?null:y.httpEquiv)&&B.getAttribute("charset")===(y.charSet==null?null:y.charSet)){Q.splice(he,1);break t}}B=D.createElement(w),ro(B,w,y),D.head.appendChild(B);break;default:throw Error(a(468,w))}B[kt]=s,Pr(B),w=B}s.stateNode=w}else Ft(D,s.type,s.stateNode);else s.stateNode=ke(D,w,s.memoizedProps);else B!==w?(B===null?y.stateNode!==null&&(y=y.stateNode,y.parentNode.removeChild(y)):B.count--,w===null?Ft(D,s.type,s.stateNode):ke(D,w,s.memoizedProps)):w===null&&s.stateNode!==null&&wm(s,s.memoizedProps,y.memoizedProps)}break;case 27:ls(h,s),Wo(s),w&512&&(Jr||y===null||Ul(y,y.return)),y!==null&&w&4&&wm(s,s.memoizedProps,y.memoizedProps);break;case 5:if(ls(h,s),Wo(s),w&512&&(Jr||y===null||Ul(y,y.return)),s.flags&32){D=s.stateNode;try{Zi(D,"")}catch(cn){Qi(s,s.return,cn)}}w&4&&s.stateNode!=null&&(D=s.memoizedProps,wm(s,D,y!==null?y.memoizedProps:D)),w&1024&&(o_=!0);break;case 6:if(ls(h,s),Wo(s),w&4){if(s.stateNode===null)throw Error(a(162));w=s.memoizedProps,y=s.stateNode;try{y.nodeValue=w}catch(cn){Qi(s,s.return,cn)}}break;case 3:if(Ct=null,D=Lu,Lu=Hm(h.containerInfo),ls(h,s),Lu=D,Wo(s),w&4&&y!==null&&y.memoizedState.isDehydrated)try{Cl(h.containerInfo)}catch(cn){Qi(s,s.return,cn)}o_&&(o_=!1,hv(s));break;case 4:w=Lu,Lu=Hm(s.stateNode.containerInfo),ls(h,s),Wo(s),Lu=w;break;case 12:ls(h,s),Wo(s);break;case 31:ls(h,s),Wo(s),w&4&&(w=s.updateQueue,w!==null&&(s.updateQueue=null,Tm(s,w)));break;case 13:ls(h,s),Wo(s),s.child.flags&8192&&s.memoizedState!==null!=(y!==null&&y.memoizedState!==null)&&(pf=qr()),w&4&&(w=s.updateQueue,w!==null&&(s.updateQueue=null,Tm(s,w)));break;case 22:D=s.memoizedState!==null;var Ue=y!==null&&y.memoizedState!==null,dt=Tl,bt=Jr;if(Tl=dt||D,Jr=bt||Ue,ls(h,s),Jr=bt,Tl=dt,Wo(s),w&8192)e:for(h=s.stateNode,h._visibility=D?h._visibility&-2:h._visibility|1,D&&(y===null||Ue||Tl||Jr||Sd(s)),y=null,h=s;;){if(h.tag===5||h.tag===26){if(y===null){Ue=y=h;try{if(B=Ue.stateNode,D)Q=B.style,typeof Q.setProperty=="function"?Q.setProperty("display","none","important"):Q.display="none";else{he=Ue.stateNode;var Et=Ue.memoizedProps.style,ft=Et!=null&&Et.hasOwnProperty("display")?Et.display:null;he.style.display=ft==null||typeof ft=="boolean"?"":(""+ft).trim()}}catch(cn){Qi(Ue,Ue.return,cn)}}}else if(h.tag===6){if(y===null){Ue=h;try{Ue.stateNode.nodeValue=D?"":Ue.memoizedProps}catch(cn){Qi(Ue,Ue.return,cn)}}}else if(h.tag===18){if(y===null){Ue=h;try{var yt=Ue.stateNode;D?z_(yt,!0):z_(Ue.stateNode,!1)}catch(cn){Qi(Ue,Ue.return,cn)}}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===s)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===s)break e;for(;h.sibling===null;){if(h.return===null||h.return===s)break e;y===h&&(y=null),h=h.return}y===h&&(y=null),h.sibling.return=h.return,h=h.sibling}w&4&&(w=s.updateQueue,w!==null&&(y=w.retryQueue,y!==null&&(w.retryQueue=null,Tm(s,y))));break;case 19:ls(h,s),Wo(s),w&4&&(w=s.updateQueue,w!==null&&(s.updateQueue=null,Tm(s,w)));break;case 30:break;case 21:break;default:ls(h,s),Wo(s)}}function Wo(s){var h=s.flags;if(h&2){try{for(var y,w=s.return;w!==null;){if(s_(w)){y=w;break}w=w.return}if(y==null)throw Error(a(160));switch(y.tag){case 27:var D=y.stateNode,B=Td(s);Qc(s,B,D);break;case 5:var Q=y.stateNode;y.flags&32&&(Zi(Q,""),y.flags&=-33);var he=Td(s);Qc(s,he,Q);break;case 3:case 4:var Ue=y.stateNode.containerInfo,dt=Td(s);hp(s,dt,Ue);break;default:throw Error(a(161))}}catch(bt){Qi(s,s.return,bt)}s.flags&=-3}h&4096&&(s.flags&=-4097)}function hv(s){if(s.subtreeFlags&1024)for(s=s.child;s!==null;){var h=s;hv(h),h.tag===5&&h.flags&1024&&h.stateNode.reset(),s=s.sibling}}function Tc(s,h){if(h.subtreeFlags&8772)for(h=h.child;h!==null;)u_(s,h.alternate,h),h=h.sibling}function Sd(s){for(s=s.child;s!==null;){var h=s;switch(h.tag){case 0:case 11:case 14:case 15:hr(4,h,h.return),Sd(h);break;case 1:Ul(h,h.return);var y=h.stateNode;typeof y.componentWillUnmount=="function"&&a_(h,h.return,y),Sd(h);break;case 27:Od(h.stateNode);case 26:case 5:Ul(h,h.return),Sd(h);break;case 22:h.memoizedState===null&&Sd(h);break;case 30:Sd(h);break;default:Sd(h)}s=s.sibling}}function Du(s,h,y){for(y=y&&(h.subtreeFlags&8772)!==0,h=h.child;h!==null;){var w=h.alternate,D=s,B=h,Q=B.flags;switch(B.tag){case 0:case 11:case 15:Du(D,B,y),cp(4,B);break;case 1:if(Du(D,B,y),w=B,D=w.stateNode,typeof D.componentDidMount=="function")try{D.componentDidMount()}catch(dt){Qi(w,w.return,dt)}if(w=B,D=w.updateQueue,D!==null){var he=w.stateNode;try{var Ue=D.shared.hiddenCallbacks;if(Ue!==null)for(D.shared.hiddenCallbacks=null,D=0;D<Ue.length;D++)Tn(Ue[D],he)}catch(dt){Qi(w,w.return,dt)}}y&&Q&64&&wd(B),kh(B,B.return);break;case 27:dp(B);case 26:case 5:Du(D,B,y),y&&w===null&&Q&4&&uf(B),kh(B,B.return);break;case 12:Du(D,B,y);break;case 31:Du(D,B,y),y&&Q&4&&lv(D,B);break;case 13:Du(D,B,y),y&&Q&4&&uv(D,B);break;case 22:B.memoizedState===null&&Du(D,B,y),kh(B,B.return);break;case 30:break;default:Du(D,B,y)}h=h.sibling}}function Ed(s,h){var y=null;s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(y=s.memoizedState.cachePool.pool),s=null,h.memoizedState!==null&&h.memoizedState.cachePool!==null&&(s=h.memoizedState.cachePool.pool),s!==y&&(s!=null&&s.refCount++,y!=null&&eu(y))}function fp(s,h){s=null,h.alternate!==null&&(s=h.alternate.memoizedState.cache),h=h.memoizedState.cache,h!==s&&(h.refCount++,s!=null&&eu(s))}function zu(s,h,y,w){if(h.subtreeFlags&10256)for(h=h.child;h!==null;)dv(s,h,y,w),h=h.sibling}function dv(s,h,y,w){var D=h.flags;switch(h.tag){case 0:case 11:case 15:zu(s,h,y,w),D&2048&&cp(9,h);break;case 1:zu(s,h,y,w);break;case 3:zu(s,h,y,w),D&2048&&(s=null,h.alternate!==null&&(s=h.alternate.memoizedState.cache),h=h.memoizedState.cache,h!==s&&(h.refCount++,s!=null&&eu(s)));break;case 12:if(D&2048){zu(s,h,y,w),s=h.stateNode;try{var B=h.memoizedProps,Q=B.id,he=B.onPostCommit;typeof he=="function"&&he(Q,h.alternate===null?"mount":"update",s.passiveEffectDuration,-0)}catch(Ue){Qi(h,h.return,Ue)}}else zu(s,h,y,w);break;case 31:zu(s,h,y,w);break;case 13:zu(s,h,y,w);break;case 23:break;case 22:B=h.stateNode,Q=h.alternate,h.memoizedState!==null?B._visibility&2?zu(s,h,y,w):hf(s,h):B._visibility&2?zu(s,h,y,w):(B._visibility|=2,Ad(s,h,y,w,(h.subtreeFlags&10256)!==0||!1)),D&2048&&Ed(Q,h);break;case 24:zu(s,h,y,w),D&2048&&fp(h.alternate,h);break;default:zu(s,h,y,w)}}function Ad(s,h,y,w,D){for(D=D&&((h.subtreeFlags&10256)!==0||!1),h=h.child;h!==null;){var B=s,Q=h,he=y,Ue=w,dt=Q.flags;switch(Q.tag){case 0:case 11:case 15:Ad(B,Q,he,Ue,D),cp(8,Q);break;case 23:break;case 22:var bt=Q.stateNode;Q.memoizedState!==null?bt._visibility&2?Ad(B,Q,he,Ue,D):hf(B,Q):(bt._visibility|=2,Ad(B,Q,he,Ue,D)),D&&dt&2048&&Ed(Q.alternate,Q);break;case 24:Ad(B,Q,he,Ue,D),D&&dt&2048&&fp(Q.alternate,Q);break;default:Ad(B,Q,he,Ue,D)}h=h.sibling}}function hf(s,h){if(h.subtreeFlags&10256)for(h=h.child;h!==null;){var y=s,w=h,D=w.flags;switch(w.tag){case 22:hf(y,w),D&2048&&Ed(w.alternate,w);break;case 24:hf(y,w),D&2048&&fp(w.alternate,w);break;default:hf(y,w)}h=h.sibling}}var pp=8192;function df(s,h,y){if(s.subtreeFlags&pp)for(s=s.child;s!==null;)ff(s,h,y),s=s.sibling}function ff(s,h,y){switch(s.tag){case 26:df(s,h,y),s.flags&pp&&s.memoizedState!==null&&qt(y,Lu,s.memoizedState,s.memoizedProps);break;case 5:df(s,h,y);break;case 3:case 4:var w=Lu;Lu=Hm(s.stateNode.containerInfo),df(s,h,y),Lu=w;break;case 22:s.memoizedState===null&&(w=s.alternate,w!==null&&w.memoizedState!==null?(w=pp,pp=16777216,df(s,h,y),pp=w):df(s,h,y));break;default:df(s,h,y)}}function c_(s){var h=s.alternate;if(h!==null&&(s=h.child,s!==null)){h.child=null;do h=s.sibling,s.sibling=null,s=h;while(s!==null)}}function mp(s){var h=s.deletions;if((s.flags&16)!==0){if(h!==null)for(var y=0;y<h.length;y++){var w=h[y];ea=w,pv(w,s)}c_(s)}if(s.subtreeFlags&10256)for(s=s.child;s!==null;)fv(s),s=s.sibling}function fv(s){switch(s.tag){case 0:case 11:case 15:mp(s),s.flags&2048&&hr(9,s,s.return);break;case 3:mp(s);break;case 12:mp(s);break;case 22:var h=s.stateNode;s.memoizedState!==null&&h._visibility&2&&(s.return===null||s.return.tag!==13)?(h._visibility&=-3,Sm(s)):mp(s);break;default:mp(s)}}function Sm(s){var h=s.deletions;if((s.flags&16)!==0){if(h!==null)for(var y=0;y<h.length;y++){var w=h[y];ea=w,pv(w,s)}c_(s)}for(s=s.child;s!==null;){switch(h=s,h.tag){case 0:case 11:case 15:hr(8,h,h.return),Sm(h);break;case 22:y=h.stateNode,y._visibility&2&&(y._visibility&=-3,Sm(h));break;default:Sm(h)}s=s.sibling}}function pv(s,h){for(;ea!==null;){var y=ea;switch(y.tag){case 0:case 11:case 15:hr(8,y,h);break;case 23:case 22:if(y.memoizedState!==null&&y.memoizedState.cachePool!==null){var w=y.memoizedState.cachePool.pool;w!=null&&w.refCount++}break;case 24:eu(y.memoizedState.cache)}if(w=y.child,w!==null)w.return=y,ea=w;else e:for(y=s;ea!==null;){w=ea;var D=w.sibling,B=w.return;if(cf(w),w===y){ea=null;break e}if(D!==null){D.return=B,ea=D;break e}ea=B}}}var ax={getCacheForType:function(s){var h=Wa(Ci),y=h.data.get(s);return y===void 0&&(y=s(),h.data.set(s,y)),y},cacheSignal:function(){return Wa(Ci).controller.signal}},mv=typeof WeakMap=="function"?WeakMap:Map,qi=0,Sr=null,_i=null,xi=0,gr=0,_o=null,Lh=!1,Cd=!1,h_=!1,Jc=0,ya=0,eh=0,Id=0,d_=0,io=0,Xr=0,Pd=null,Ko=null,Em=!1,pf=0,Md=0,gp=1/0,Am=null,Dh=null,us=0,zh=null,mf=null,th=0,f_=0,p_=null,gv=null,_p=0,m_=null;function jl(){return(qi&2)!==0&&xi!==0?xi&-xi:mt.T!==null?Ac():nr()}function g_(){if(io===0)if((xi&536870912)===0||ui){var s=tn;tn<<=1,(tn&3932160)===0&&(tn=262144),io=s}else io=536870912;return s=$o.current,s!==null&&(s.flags|=32),io}function yo(s,h,y){(s===Sr&&(gr===2||gr===9)||s.cancelPendingCommit!==null)&&(_f(s,0),$l(s,xi,io,!1)),tr(s,y),((qi&2)===0||s!==Sr)&&(s===Sr&&((qi&2)===0&&(Id|=y),ya===4&&$l(s,xi,io,!1)),Ec(s))}function __(s,h,y){if((qi&6)!==0)throw Error(a(327));var w=!y&&(h&127)===0&&(h&s.expiredLanes)===0||nn(s,h),D=w?x_(s,h):Cm(s,h,!0),B=w;do{if(D===0){Cd&&!w&&$l(s,h,0,!1);break}else{if(y=s.current.alternate,B&&!yp(y)){D=Cm(s,h,!1),B=!1;continue}if(D===2){if(B=h,s.errorRecoveryDisabledLanes&B)var Q=0;else Q=s.pendingLanes&-536870913,Q=Q!==0?Q:Q&536870912?536870912:0;if(Q!==0){h=Q;e:{var he=s;D=Pd;var Ue=he.current.memoizedState.isDehydrated;if(Ue&&(_f(he,Q).flags|=256),Q=Cm(he,Q,!1),Q!==2){if(h_&&!Ue){he.errorRecoveryDisabledLanes|=B,Id|=B,D=4;break e}B=Ko,Ko=D,B!==null&&(Ko===null?Ko=B:Ko.push.apply(Ko,B))}D=Q}if(B=!1,D!==2)continue}}if(D===1){_f(s,0),$l(s,h,0,!0);break}e:{switch(w=s,B=D,B){case 0:case 1:throw Error(a(345));case 4:if((h&4194048)!==h)break;case 6:$l(w,h,io,!Lh);break e;case 2:Ko=null;break;case 3:case 5:break;default:throw Error(a(329))}if((h&62914560)===h&&(D=pf+300-qr(),10<D)){if($l(w,h,io,!Lh),Rn(w,0,!0)!==0)break e;th=h,w.timeoutHandle=zd(nh.bind(null,w,y,Ko,Am,Em,h,io,Id,Xr,Lh,B,"Throttled",-0,0),D);break e}nh(w,y,Ko,Am,Em,h,io,Id,Xr,Lh,B,null,-0,0)}}break}while(!0);Ec(s)}function nh(s,h,y,w,D,B,Q,he,Ue,dt,bt,Et,ft,yt){if(s.timeoutHandle=-1,Et=h.subtreeFlags,Et&8192||(Et&16785408)===16785408){Et={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Pa},ff(h,B,Et);var cn=(B&62914560)===B?pf-qr():(B&4194048)===B?Md-qr():0;if(cn=St(Et,cn),cn!==null){th=B,s.cancelPendingCommit=cn(xv.bind(null,s,h,B,y,w,D,Q,he,Ue,bt,Et,null,ft,yt)),$l(s,B,Q,!dt);return}}xv(s,h,B,y,w,D,Q,he,Ue)}function yp(s){for(var h=s;;){var y=h.tag;if((y===0||y===11||y===15)&&h.flags&16384&&(y=h.updateQueue,y!==null&&(y=y.stores,y!==null)))for(var w=0;w<y.length;w++){var D=y[w],B=D.getSnapshot;D=D.value;try{if(!aa(B(),D))return!1}catch{return!1}}if(y=h.child,h.subtreeFlags&16384&&y!==null)y.return=h,h=y;else{if(h===s)break;for(;h.sibling===null;){if(h.return===null||h.return===s)return!0;h=h.return}h.sibling.return=h.return,h=h.sibling}}return!0}function $l(s,h,y,w){h&=~d_,h&=~Id,s.suspendedLanes|=h,s.pingedLanes&=~h,w&&(s.warmLanes|=h),w=s.expirationTimes;for(var D=h;0<D;){var B=31-tt(D),Q=1<<B;w[B]=-1,D&=~Q}y!==0&&Vn(s,y,h)}function Rd(){return(qi&6)===0?(bf(0),!1):!0}function gf(){if(_i!==null){if(gr===0)var s=_i.return;else s=_i,_l=Vl=null,K(s),fc=null,Zc=0,s=_i;for(;s!==null;)lf(s.alternate,s),s=s.return;_i=null}}function _f(s,h){var y=s.timeoutHandle;y!==-1&&(s.timeoutHandle=-1,Rs(y)),y=s.cancelPendingCommit,y!==null&&(s.cancelPendingCommit=null,y()),th=0,gf(),Sr=s,_i=y=No(s.current,null),xi=h,gr=0,_o=null,Lh=!1,Cd=nn(s,h),h_=!1,Xr=io=d_=Id=eh=ya=0,Ko=Pd=null,Em=!1,(h&8)!==0&&(h|=h&32);var w=s.entangledLanes;if(w!==0)for(s=s.entanglements,w&=h;0<w;){var D=31-tt(w),B=1<<D;h|=s[D],w&=~B}return Jc=h,rc(),y}function _v(s,h){Gn=null,mt.H=yd,h===hc||h===nu?(h=dm(),gr=3):h===dc?(h=dm(),gr=4):gr=h===Zg?8:h!==null&&typeof h=="object"&&typeof h.then=="function"?6:1,_o=h,_i===null&&(ya=1,Rh(s,x(h,s.current)))}function y_(){var s=$o.current;return s===null?!0:(xi&4194048)===xi?Is===null:(xi&62914560)===xi||(xi&536870912)!==0?s===Is:!1}function v_(){var s=mt.H;return mt.H=yd,s===null?yd:s}function yv(){var s=mt.A;return mt.A=ax,s}function vp(){ya=4,Lh||(xi&4194048)!==xi&&$o.current!==null||(Cd=!0),(eh&134217727)===0&&(Id&134217727)===0||Sr===null||$l(Sr,xi,io,!1)}function Cm(s,h,y){var w=qi;qi|=2;var D=v_(),B=yv();(Sr!==s||xi!==h)&&(Am=null,_f(s,h)),h=!1;var Q=ya;e:do try{if(gr!==0&&_i!==null){var he=_i,Ue=_o;switch(gr){case 8:gf(),Q=6;break e;case 3:case 2:case 9:case 6:$o.current===null&&(h=!0);var dt=gr;if(gr=0,_o=null,yf(s,he,Ue,dt),y&&Cd){Q=0;break e}break;default:dt=gr,gr=0,_o=null,yf(s,he,Ue,dt)}}b_(),Q=ya;break}catch(bt){_v(s,bt)}while(!0);return h&&s.shellSuspendCounter++,_l=Vl=null,qi=w,mt.H=D,mt.A=B,_i===null&&(Sr=null,xi=0,rc()),Q}function b_(){for(;_i!==null;)w_(_i)}function x_(s,h){var y=qi;qi|=2;var w=v_(),D=yv();Sr!==s||xi!==h?(Am=null,gp=qr()+500,_f(s,h)):Cd=nn(s,h);e:do try{if(gr!==0&&_i!==null){h=_i;var B=_o;t:switch(gr){case 1:gr=0,_o=null,yf(s,h,B,1);break;case 2:case 9:if(ri(B)){gr=0,_o=null,vv(h);break}h=function(){gr!==2&&gr!==9||Sr!==s||(gr=7),Ec(s)},B.then(h,h);break e;case 3:gr=7;break e;case 4:gr=5;break e;case 7:ri(B)?(gr=0,_o=null,vv(h)):(gr=0,_o=null,yf(s,h,B,7));break;case 5:var Q=null;switch(_i.tag){case 26:Q=_i.memoizedState;case 5:case 27:var he=_i;if(Q?dn(Q):he.stateNode.complete){gr=0,_o=null;var Ue=he.sibling;if(Ue!==null)_i=Ue;else{var dt=he.return;dt!==null?(_i=dt,Im(dt)):_i=null}break t}}gr=0,_o=null,yf(s,h,B,5);break;case 6:gr=0,_o=null,yf(s,h,B,6);break;case 8:gf(),ya=6;break e;default:throw Error(a(462))}}sx();break}catch(bt){_v(s,bt)}while(!0);return _l=Vl=null,mt.H=w,mt.A=D,qi=y,_i!==null?0:(Sr=null,xi=0,rc(),ya)}function sx(){for(;_i!==null&&!Eo();)w_(_i)}function w_(s){var h=rv(s.alternate,s,Jc);s.memoizedProps=s.pendingProps,h===null?Im(s):_i=h}function vv(s){var h=s,y=h.alternate;switch(h.tag){case 15:case 0:h=nv(y,h,h.pendingProps,h.type,void 0,xi);break;case 11:h=nv(y,h,h.pendingProps,h.type.render,h.ref,xi);break;case 5:K(h);default:lf(y,h),h=_i=od(h,Jc),h=rv(y,h,Jc)}s.memoizedProps=s.pendingProps,h===null?Im(s):_i=h}function yf(s,h,y,w){_l=Vl=null,K(h),fc=null,Zc=0;var D=h.return;try{if(ex(s,D,h,y,xi)){ya=1,Rh(s,x(y,s.current)),_i=null;return}}catch(B){if(D!==null)throw _i=D,B;ya=1,Rh(s,x(y,s.current)),_i=null;return}h.flags&32768?(ui||w===1?s=!0:Cd||(xi&536870912)!==0?s=!1:(Lh=s=!0,(w===2||w===9||w===3||w===6)&&(w=$o.current,w!==null&&w.tag===13&&(w.flags|=16384))),bv(h,s)):Im(h)}function Im(s){var h=s;do{if((h.flags&32768)!==0){bv(h,Lh);return}s=h.return;var y=nx(h.alternate,h,Jc);if(y!==null){_i=y;return}if(h=h.sibling,h!==null){_i=h;return}_i=h=s}while(h!==null);ya===0&&(ya=5)}function bv(s,h){do{var y=sv(s.alternate,s);if(y!==null){y.flags&=32767,_i=y;return}if(y=s.return,y!==null&&(y.flags|=32768,y.subtreeFlags=0,y.deletions=null),!h&&(s=s.sibling,s!==null)){_i=s;return}_i=s=y}while(s!==null);ya=6,_i=null}function xv(s,h,y,w,D,B,Q,he,Ue){s.cancelPendingCommit=null;do bp();while(us!==0);if((qi&6)!==0)throw Error(a(327));if(h!==null){if(h===s.current)throw Error(a(177));if(B=h.lanes|h.childLanes,B|=xu,Ir(s,y,B,Q,he,Ue),s===Sr&&(_i=Sr=null,xi=0),mf=h,zh=s,th=y,f_=B,p_=D,gv=w,(h.subtreeFlags&10256)!==0||(h.flags&10256)!==0?(s.callbackNode=null,s.callbackPriority=0,Tv(gs,function(){return Pm(),null})):(s.callbackNode=null,s.callbackPriority=0),w=(h.flags&13878)!==0,(h.subtreeFlags&13878)!==0||w){w=mt.T,mt.T=null,D=$t.p,$t.p=2,Q=qi,qi|=4;try{ix(s,h,y)}finally{qi=Q,$t.p=D,mt.T=w}}us=1,T_(),S_(),Sc()}}function T_(){if(us===1){us=0;var s=zh,h=mf,y=(h.flags&13878)!==0;if((h.subtreeFlags&13878)!==0||y){y=mt.T,mt.T=null;var w=$t.p;$t.p=2;var D=qi;qi|=4;try{cv(h,s);var B=Bm,Q=tc(s.containerInfo),he=B.focusedElem,Ue=B.selectionRange;if(Q!==he&&he&&he.ownerDocument&&ec(he.ownerDocument.documentElement,he)){if(Ue!==null&&hl(he)){var dt=Ue.start,bt=Ue.end;if(bt===void 0&&(bt=dt),"selectionStart"in he)he.selectionStart=dt,he.selectionEnd=Math.min(bt,he.value.length);else{var Et=he.ownerDocument||document,ft=Et&&Et.defaultView||window;if(ft.getSelection){var yt=ft.getSelection(),cn=he.textContent.length,En=Math.min(Ue.start,cn),jr=Ue.end===void 0?En:Math.min(Ue.end,cn);!yt.extend&&En>jr&&(Q=jr,jr=En,En=Q);var it=yu(he,En),Qe=yu(he,jr);if(it&&Qe&&(yt.rangeCount!==1||yt.anchorNode!==it.node||yt.anchorOffset!==it.offset||yt.focusNode!==Qe.node||yt.focusOffset!==Qe.offset)){var pt=Et.createRange();pt.setStart(it.node,it.offset),yt.removeAllRanges(),En>jr?(yt.addRange(pt),yt.extend(Qe.node,Qe.offset)):(pt.setEnd(Qe.node,Qe.offset),yt.addRange(pt))}}}}for(Et=[],yt=he;yt=yt.parentNode;)yt.nodeType===1&&Et.push({element:yt,left:yt.scrollLeft,top:yt.scrollTop});for(typeof he.focus=="function"&&he.focus(),he=0;he<Et.length;he++){var Rt=Et[he];Rt.element.scrollLeft=Rt.left,Rt.element.scrollTop=Rt.top}}ba=!!wf,Bm=wf=null}finally{qi=D,$t.p=w,mt.T=y}}s.current=h,us=2}}function S_(){if(us===2){us=0;var s=zh,h=mf,y=(h.flags&8772)!==0;if((h.subtreeFlags&8772)!==0||y){y=mt.T,mt.T=null;var w=$t.p;$t.p=2;var D=qi;qi|=4;try{u_(s,h.alternate,h)}finally{qi=D,$t.p=w,mt.T=y}}us=3}}function Sc(){if(us===4||us===3){us=0,oo();var s=zh,h=mf,y=th,w=gv;(h.subtreeFlags&10256)!==0||(h.flags&10256)!==0?us=5:(us=0,mf=zh=null,ih(s,s.pendingLanes));var D=s.pendingLanes;if(D===0&&(Dh=null),en(y),h=h.stateNode,De&&typeof De.onCommitFiberRoot=="function")try{De.onCommitFiberRoot(Se,h,void 0,(h.current.flags&128)===128)}catch{}if(w!==null){h=mt.T,D=$t.p,$t.p=2,mt.T=null;try{for(var B=s.onRecoverableError,Q=0;Q<w.length;Q++){var he=w[Q];B(he.value,{componentStack:he.stack})}}finally{mt.T=h,$t.p=D}}(th&3)!==0&&bp(),Ec(s),D=s.pendingLanes,(y&261930)!==0&&(D&42)!==0?s===m_?_p++:(_p=0,m_=s):_p=0,bf(0)}}function ih(s,h){(s.pooledCacheLanes&=h)===0&&(h=s.pooledCache,h!=null&&(s.pooledCache=null,eu(h)))}function bp(){return T_(),S_(),Sc(),Pm()}function Pm(){if(us!==5)return!1;var s=zh,h=f_;f_=0;var y=en(th),w=mt.T,D=$t.p;try{$t.p=32>y?32:y,mt.T=null,y=p_,p_=null;var B=zh,Q=th;if(us=0,mf=zh=null,th=0,(qi&6)!==0)throw Error(a(331));var he=qi;if(qi|=4,fv(B.current),dv(B,B.current,Q,y),qi=he,bf(0,!1),De&&typeof De.onPostCommitFiberRoot=="function")try{De.onPostCommitFiberRoot(Se,B)}catch{}return!0}finally{$t.p=D,mt.T=w,ih(s,h)}}function wv(s,h,y){h=x(y,h),h=sf(s.stateNode,h,2),s=ru(s,h,2),s!==null&&(tr(s,2),Ec(s))}function Qi(s,h,y){if(s.tag===3)wv(s,s,y);else for(;h!==null;){if(h.tag===3){wv(h,s,y);break}else if(h.tag===1){var w=h.stateNode;if(typeof h.type.getDerivedStateFromError=="function"||typeof w.componentDidCatch=="function"&&(Dh===null||!Dh.has(w))){s=x(y,s),y=Gg(2),w=ru(h,y,2),w!==null&&(Hg(y,w,h,s),tr(w,2),Ec(w));break}}h=h.return}}function xp(s,h,y){var w=s.pingCache;if(w===null){w=s.pingCache=new mv;var D=new Set;w.set(h,D)}else D=w.get(h),D===void 0&&(D=new Set,w.set(h,D));D.has(y)||(h_=!0,D.add(y),s=ox.bind(null,s,h,y),h.then(s,s))}function ox(s,h,y){var w=s.pingCache;w!==null&&w.delete(h),s.pingedLanes|=s.suspendedLanes&y,s.warmLanes&=~y,Sr===s&&(xi&y)===y&&(ya===4||ya===3&&(xi&62914560)===xi&&300>qr()-pf?(qi&2)===0&&_f(s,0):d_|=y,Xr===xi&&(Xr=0)),Ec(s)}function Mm(s,h){h===0&&(h=Ri()),s=Do(s,h),s!==null&&(tr(s,h),Ec(s))}function E_(s){var h=s.memoizedState,y=0;h!==null&&(y=h.retryLane),Mm(s,y)}function vf(s,h){var y=0;switch(s.tag){case 31:case 13:var w=s.stateNode,D=s.memoizedState;D!==null&&(y=D.retryLane);break;case 19:w=s.stateNode;break;case 22:w=s.stateNode._retryCache;break;default:throw Error(a(314))}w!==null&&w.delete(h),Mm(s,y)}function Tv(s,h){return pr(s,h)}var wp=null,Oh=null,Rm=!1,kd=!1,km=!1,Nh=0;function Ec(s){s!==Oh&&s.next===null&&(Oh===null?wp=Oh=s:Oh=Oh.next=s),kd=!0,Rm||(Rm=!0,A_())}function bf(s,h){if(!km&&kd){km=!0;do for(var y=!1,w=wp;w!==null;){if(s!==0){var D=w.pendingLanes;if(D===0)var B=0;else{var Q=w.suspendedLanes,he=w.pingedLanes;B=(1<<31-tt(42|s)+1)-1,B&=D&~(Q&~he),B=B&201326741?B&201326741|1:B?B|2:0}B!==0&&(y=!0,Cv(w,B))}else B=xi,B=Rn(w,w===Sr?B:0,w.cancelPendingCommit!==null||w.timeoutHandle!==-1),(B&3)===0||nn(w,B)||(y=!0,Cv(w,B));w=w.next}while(y);km=!1}}function lx(){Sv()}function Sv(){kd=Rm=!1;var s=0;Nh!==0&&cx()&&(s=Nh);for(var h=qr(),y=null,w=wp;w!==null;){var D=w.next,B=Ev(w,h);B===0?(w.next=null,y===null?wp=D:y.next=D,D===null&&(Oh=y)):(y=w,(s!==0||(B&3)!==0)&&(kd=!0)),w=D}us!==0&&us!==5||bf(s),Nh!==0&&(Nh=0)}function Ev(s,h){for(var y=s.suspendedLanes,w=s.pingedLanes,D=s.expirationTimes,B=s.pendingLanes&-62914561;0<B;){var Q=31-tt(B),he=1<<Q,Ue=D[Q];Ue===-1?((he&y)===0||(he&w)!==0)&&(D[Q]=Nn(he,h)):Ue<=h&&(s.expiredLanes|=he),B&=~he}if(h=Sr,y=xi,y=Rn(s,s===h?y:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),w=s.callbackNode,y===0||s===h&&(gr===2||gr===9)||s.cancelPendingCommit!==null)return w!==null&&w!==null&&Aa(w),s.callbackNode=null,s.callbackPriority=0;if((y&3)===0||nn(s,y)){if(h=y&-y,h===s.callbackPriority)return h;switch(w!==null&&Aa(w),en(y)){case 2:case 8:y=Vs;break;case 32:y=gs;break;case 268435456:y=se;break;default:y=gs}return w=Av.bind(null,s),y=pr(y,w),s.callbackPriority=h,s.callbackNode=y,h}return w!==null&&w!==null&&Aa(w),s.callbackPriority=2,s.callbackNode=null,2}function Av(s,h){if(us!==0&&us!==5)return s.callbackNode=null,s.callbackPriority=0,null;var y=s.callbackNode;if(bp()&&s.callbackNode!==y)return null;var w=xi;return w=Rn(s,s===Sr?w:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),w===0?null:(__(s,w,h),Ev(s,qr()),s.callbackNode!=null&&s.callbackNode===y?Av.bind(null,s):null)}function Cv(s,h){if(bp())return null;__(s,h,!0)}function A_(){zv(function(){(qi&6)!==0?pr(ms,lx):Sv()})}function Ac(){if(Nh===0){var s=wh;s===0&&(s=xt,xt<<=1,(xt&261888)===0&&(xt=256)),Nh=s}return Nh}function C_(s){return s==null||typeof s=="symbol"||typeof s=="boolean"?null:typeof s=="function"?s:vs(""+s)}function I_(s,h){var y=h.ownerDocument.createElement("input");return y.name=h.name,y.value=h.value,s.id&&y.setAttribute("form",s.id),h.parentNode.insertBefore(y,h),s=new FormData(s),y.parentNode.removeChild(y),s}function Iv(s,h,y,w,D){if(h==="submit"&&y&&y.stateNode===D){var B=C_((D[yn]||null).action),Q=w.submitter;Q&&(h=(h=Q[yn]||null)?C_(h.formAction):Q.getAttribute("formAction"),h!==null&&(B=h,Q=null));var he=new uo("action","action",null,w,D);s.push({event:he,listeners:[{instance:null,listener:function(){if(w.defaultPrevented){if(Nh!==0){var Ue=Q?I_(D,Q):new FormData(D);bc(y,{pending:!0,data:Ue,method:D.method,action:B},null,Ue)}}else typeof B=="function"&&(he.preventDefault(),Ue=Q?I_(D,Q):new FormData(D),bc(y,{pending:!0,data:Ue,method:D.method,action:B},B,Ue))},currentTarget:D}]})}}for(var Lm=0;Lm<pl.length;Lm++){var Dm=pl[Lm],P_=Dm.toLowerCase(),Pv=Dm[0].toUpperCase()+Dm.slice(1);ma(P_,"on"+Pv)}ma(Xl,"onAnimationEnd"),ma(bh,"onAnimationIteration"),ma(Lo,"onAnimationStart"),ma("dblclick","onDoubleClick"),ma("focusin","onFocus"),ma("focusout","onBlur"),ma($c,"onTransitionRun"),ma(vu,"onTransitionStart"),ma(fo,"onTransitionCancel"),ma(bu,"onTransitionEnd"),ja("onMouseEnter",["mouseout","mouseover"]),ja("onMouseLeave",["mouseout","mouseover"]),ja("onPointerEnter",["pointerout","pointerover"]),ja("onPointerLeave",["pointerout","pointerover"]),Co("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Co("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Co("onBeforeInput",["compositionend","keypress","textInput","paste"]),Co("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Co("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Co("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var rh="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Mv=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(rh));function zm(s,h){h=(h&4)!==0;for(var y=0;y<s.length;y++){var w=s[y],D=w.event;w=w.listeners;e:{var B=void 0;if(h)for(var Q=w.length-1;0<=Q;Q--){var he=w[Q],Ue=he.instance,dt=he.currentTarget;if(he=he.listener,Ue!==B&&D.isPropagationStopped())break e;B=he,D.currentTarget=dt;try{B(D)}catch(bt){Yl(bt)}D.currentTarget=null,B=Ue}else for(Q=0;Q<w.length;Q++){if(he=w[Q],Ue=he.instance,dt=he.currentTarget,he=he.listener,Ue!==B&&D.isPropagationStopped())break e;B=he,D.currentTarget=dt;try{B(D)}catch(bt){Yl(bt)}D.currentTarget=null,B=Ue}}}}function yi(s,h){var y=h[ir];y===void 0&&(y=h[ir]=new Set);var w=s+"__bubble";y.has(w)||(Bh(h,s,2,!1),y.add(w))}function Xo(s,h,y){var w=0;h&&(w|=4),Bh(y,s,w,h)}var ah="_reactListening"+Math.random().toString(36).slice(2);function Ld(s){if(!s[ah]){s[ah]=!0,fa.forEach(function(y){y!=="selectionchange"&&(Mv.has(y)||Xo(y,!1,s),Xo(y,!0,s))});var h=s.nodeType===9?s:s.ownerDocument;h===null||h[ah]||(h[ah]=!0,Xo("selectionchange",!1,h))}}function Bh(s,h,y,w){switch(Na(h)){case 2:var D=hs;break;case 8:D=bo;break;default:D=Yo}y=D.bind(null,h,y,s),D=void 0,!wr||h!=="touchstart"&&h!=="touchmove"&&h!=="wheel"||(D=!0),w?D!==void 0?s.addEventListener(h,y,{capture:!0,passive:D}):s.addEventListener(h,y,!0):D!==void 0?s.addEventListener(h,y,{passive:D}):s.addEventListener(h,y,!1)}function Om(s,h,y,w,D){var B=w;if((h&1)===0&&(h&2)===0&&w!==null)e:for(;;){if(w===null)return;var Q=w.tag;if(Q===3||Q===4){var he=w.stateNode.containerInfo;if(he===D)break;if(Q===4)for(Q=w.return;Q!==null;){var Ue=Q.tag;if((Ue===3||Ue===4)&&Q.stateNode.containerInfo===D)return;Q=Q.return}for(;he!==null;){if(Q=_s(he),Q===null)return;if(Ue=Q.tag,Ue===5||Ue===6||Ue===26||Ue===27){w=B=Q;continue e}he=he.parentNode}}w=w.return}sl(function(){var dt=B,bt=Wi(y),Et=[];e:{var ft=sd.get(s);if(ft!==void 0){var yt=uo,cn=s;switch(s){case"keypress":if($n(y)===0)break e;case"keydown":case"keyup":yt=Wu;break;case"focusin":cn="focus",yt=Ki;break;case"focusout":cn="blur",yt=Ki;break;case"beforeblur":case"afterblur":yt=Ki;break;case"click":if(y.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":yt=Or;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":yt=Zl;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":yt=H;break;case Xl:case bh:case Lo:yt=ol;break;case bu:yt=ye;break;case"scroll":case"scrollend":yt=Wn;break;case"wheel":yt=ht;break;case"copy":case"cut":case"paste":yt=Ws;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":yt=Bl;break;case"toggle":case"beforetoggle":yt=Ln}var En=(h&4)!==0,jr=!En&&(s==="scroll"||s==="scrollend"),it=En?ft!==null?ft+"Capture":null:ft;En=[];for(var Qe=dt,pt;Qe!==null;){var Rt=Qe;if(pt=Rt.stateNode,Rt=Rt.tag,Rt!==5&&Rt!==26&&Rt!==27||pt===null||it===null||(Rt=sr(Qe,it),Rt!=null&&En.push(xf(Qe,Rt,pt))),jr)break;Qe=Qe.return}0<En.length&&(ft=new yt(ft,cn,null,y,bt),Et.push({event:ft,listeners:En}))}}if((h&7)===0){e:{if(ft=s==="mouseover"||s==="pointerover",yt=s==="mouseout"||s==="pointerout",ft&&y!==zl&&(cn=y.relatedTarget||y.fromElement)&&(_s(cn)||cn[In]))break e;if((yt||ft)&&(ft=bt.window===bt?bt:(ft=bt.ownerDocument)?ft.defaultView||ft.parentWindow:window,yt?(cn=y.relatedTarget||y.toElement,yt=dt,cn=cn?_s(cn):null,cn!==null&&(jr=m(cn),En=cn.tag,cn!==jr||En!==5&&En!==27&&En!==6)&&(cn=null)):(yt=null,cn=dt),yt!==cn)){if(En=Or,Rt="onMouseLeave",it="onMouseEnter",Qe="mouse",(s==="pointerout"||s==="pointerover")&&(En=Bl,Rt="onPointerLeave",it="onPointerEnter",Qe="pointer"),jr=yt==null?ft:Hr(yt),pt=cn==null?ft:Hr(cn),ft=new En(Rt,Qe+"leave",yt,y,bt),ft.target=jr,ft.relatedTarget=pt,Rt=null,_s(bt)===dt&&(En=new En(it,Qe+"enter",cn,y,bt),En.target=pt,En.relatedTarget=jr,Rt=En),jr=Rt,yt&&cn)t:{for(En=Rv,it=yt,Qe=cn,pt=0,Rt=it;Rt;Rt=En(Rt))pt++;Rt=0;for(var Dn=Qe;Dn;Dn=En(Dn))Rt++;for(;0<pt-Rt;)it=En(it),pt--;for(;0<Rt-pt;)Qe=En(Qe),Rt--;for(;pt--;){if(it===Qe||Qe!==null&&it===Qe.alternate){En=it;break t}it=En(it),Qe=En(Qe)}En=null}else En=null;yt!==null&&kv(Et,ft,yt,En,!1),cn!==null&&jr!==null&&kv(Et,jr,cn,En,!0)}}e:{if(ft=dt?Hr(dt):window,yt=ft.nodeName&&ft.nodeName.toLowerCase(),yt==="select"||yt==="input"&&ft.type==="file")var dr=_u;else if(ho(ft))if(yh)dr=ad;else{dr=tf;var Cn=ul}else yt=ft.nodeName,!yt||yt.toLowerCase()!=="input"||ft.type!=="checkbox"&&ft.type!=="radio"?dt&&qa(dt.elementType)&&(dr=_u):dr=Kl;if(dr&&(dr=dr(s,dt))){rd(Et,dr,y,bt);break e}Cn&&Cn(s,ft,dt),s==="focusout"&&dt&&ft.type==="number"&&dt.memoizedProps.value!=null&&Hs(ft,"number",ft.value)}switch(Cn=dt?Hr(dt):window,s){case"focusin":(ho(Cn)||Cn.contentEditable==="true")&&(fl=Cn,vh=dt,Vc=null);break;case"focusout":Vc=vh=fl=null;break;case"mousedown":nc=!0;break;case"contextmenu":case"mouseup":case"dragend":nc=!1,nf(Et,y,bt);break;case"selectionchange":if(dl)break;case"keydown":case"keyup":nf(Et,y,bt)}var mi;if(Ti)e:{switch(s){case"compositionstart":var zi="onCompositionStart";break e;case"compositionend":zi="onCompositionEnd";break e;case"compositionupdate":zi="onCompositionUpdate";break e}zi=void 0}else gu?mu(s,y)&&(zi="onCompositionEnd"):s==="keydown"&&y.keyCode===229&&(zi="onCompositionStart");zi&&(Ha&&y.locale!=="ko"&&(gu||zi!=="onCompositionStart"?zi==="onCompositionEnd"&&gu&&(mi=ia()):(pa=bt,fn="value"in pa?pa.value:pa.textContent,gu=!0)),Cn=Tp(dt,zi),0<Cn.length&&(zi=new lr(zi,s,null,y,bt),Et.push({event:zi,listeners:Cn}),mi?zi.data=mi:(mi=Xs(y),mi!==null&&(zi.data=mi)))),(mi=Ga?Ys(s,y):Ku(s,y))&&(zi=Tp(dt,"onBeforeInput"),0<zi.length&&(Cn=new lr("onBeforeInput","beforeinput",null,y,bt),Et.push({event:Cn,listeners:zi}),Cn.data=mi)),Iv(Et,s,dt,y,bt)}zm(Et,h)})}function xf(s,h,y){return{instance:s,listener:h,currentTarget:y}}function Tp(s,h){for(var y=h+"Capture",w=[];s!==null;){var D=s,B=D.stateNode;if(D=D.tag,D!==5&&D!==26&&D!==27||B===null||(D=sr(s,y),D!=null&&w.unshift(xf(s,D,B)),D=sr(s,h),D!=null&&w.push(xf(s,D,B))),s.tag===3)return w;s=s.return}return[]}function Rv(s){if(s===null)return null;do s=s.return;while(s&&s.tag!==5&&s.tag!==27);return s||null}function kv(s,h,y,w,D){for(var B=h._reactName,Q=[];y!==null&&y!==w;){var he=y,Ue=he.alternate,dt=he.stateNode;if(he=he.tag,Ue!==null&&Ue===w)break;he!==5&&he!==26&&he!==27||dt===null||(Ue=dt,D?(dt=sr(y,B),dt!=null&&Q.unshift(xf(y,dt,Ue))):D||(dt=sr(y,B),dt!=null&&Q.push(xf(y,dt,Ue)))),y=y.return}Q.length!==0&&s.push({event:h,listeners:Q})}var Lv=/\r\n?/g,Fh=/\u0000|\uFFFD/g;function M_(s){return(typeof s=="string"?s:""+s).replace(Lv,`
`).replace(Fh,"")}function R_(s,h){return h=M_(h),M_(s)===h}function _r(s,h,y,w,D,B){switch(y){case"children":typeof w=="string"?h==="body"||h==="textarea"&&w===""||Zi(s,w):(typeof w=="number"||typeof w=="bigint")&&h!=="body"&&Zi(s,""+w);break;case"className":hi(s,"class",w);break;case"tabIndex":hi(s,"tabindex",w);break;case"dir":case"role":case"viewBox":case"width":case"height":hi(s,y,w);break;case"style":ys(s,w,B);break;case"data":if(h!=="object"){hi(s,"data",w);break}case"src":case"href":if(w===""&&(h!=="a"||y!=="href")){s.removeAttribute(y);break}if(w==null||typeof w=="function"||typeof w=="symbol"||typeof w=="boolean"){s.removeAttribute(y);break}w=vs(""+w),s.setAttribute(y,w);break;case"action":case"formAction":if(typeof w=="function"){s.setAttribute(y,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof B=="function"&&(y==="formAction"?(h!=="input"&&_r(s,h,"name",D.name,D,null),_r(s,h,"formEncType",D.formEncType,D,null),_r(s,h,"formMethod",D.formMethod,D,null),_r(s,h,"formTarget",D.formTarget,D,null)):(_r(s,h,"encType",D.encType,D,null),_r(s,h,"method",D.method,D,null),_r(s,h,"target",D.target,D,null)));if(w==null||typeof w=="symbol"||typeof w=="boolean"){s.removeAttribute(y);break}w=vs(""+w),s.setAttribute(y,w);break;case"onClick":w!=null&&(s.onclick=Pa);break;case"onScroll":w!=null&&yi("scroll",s);break;case"onScrollEnd":w!=null&&yi("scrollend",s);break;case"dangerouslySetInnerHTML":if(w!=null){if(typeof w!="object"||!("__html"in w))throw Error(a(61));if(y=w.__html,y!=null){if(D.children!=null)throw Error(a(60));s.innerHTML=y}}break;case"multiple":s.multiple=w&&typeof w!="function"&&typeof w!="symbol";break;case"muted":s.muted=w&&typeof w!="function"&&typeof w!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(w==null||typeof w=="function"||typeof w=="boolean"||typeof w=="symbol"){s.removeAttribute("xlink:href");break}y=vs(""+w),s.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",y);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":w!=null&&typeof w!="function"&&typeof w!="symbol"?s.setAttribute(y,""+w):s.removeAttribute(y);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":w&&typeof w!="function"&&typeof w!="symbol"?s.setAttribute(y,""):s.removeAttribute(y);break;case"capture":case"download":w===!0?s.setAttribute(y,""):w!==!1&&w!=null&&typeof w!="function"&&typeof w!="symbol"?s.setAttribute(y,w):s.removeAttribute(y);break;case"cols":case"rows":case"size":case"span":w!=null&&typeof w!="function"&&typeof w!="symbol"&&!isNaN(w)&&1<=w?s.setAttribute(y,w):s.removeAttribute(y);break;case"rowSpan":case"start":w==null||typeof w=="function"||typeof w=="symbol"||isNaN(w)?s.removeAttribute(y):s.setAttribute(y,w);break;case"popover":yi("beforetoggle",s),yi("toggle",s),ii(s,"popover",w);break;case"xlinkActuate":Hi(s,"http://www.w3.org/1999/xlink","xlink:actuate",w);break;case"xlinkArcrole":Hi(s,"http://www.w3.org/1999/xlink","xlink:arcrole",w);break;case"xlinkRole":Hi(s,"http://www.w3.org/1999/xlink","xlink:role",w);break;case"xlinkShow":Hi(s,"http://www.w3.org/1999/xlink","xlink:show",w);break;case"xlinkTitle":Hi(s,"http://www.w3.org/1999/xlink","xlink:title",w);break;case"xlinkType":Hi(s,"http://www.w3.org/1999/xlink","xlink:type",w);break;case"xmlBase":Hi(s,"http://www.w3.org/XML/1998/namespace","xml:base",w);break;case"xmlLang":Hi(s,"http://www.w3.org/XML/1998/namespace","xml:lang",w);break;case"xmlSpace":Hi(s,"http://www.w3.org/XML/1998/namespace","xml:space",w);break;case"is":ii(s,"is",w);break;case"innerText":case"textContent":break;default:(!(2<y.length)||y[0]!=="o"&&y[0]!=="O"||y[1]!=="n"&&y[1]!=="N")&&(y=Zs.get(y)||y,ii(s,y,w))}}function Nm(s,h,y,w,D,B){switch(y){case"style":ys(s,w,B);break;case"dangerouslySetInnerHTML":if(w!=null){if(typeof w!="object"||!("__html"in w))throw Error(a(61));if(y=w.__html,y!=null){if(D.children!=null)throw Error(a(60));s.innerHTML=y}}break;case"children":typeof w=="string"?Zi(s,w):(typeof w=="number"||typeof w=="bigint")&&Zi(s,""+w);break;case"onScroll":w!=null&&yi("scroll",s);break;case"onScrollEnd":w!=null&&yi("scrollend",s);break;case"onClick":w!=null&&(s.onclick=Pa);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!wi.hasOwnProperty(y))e:{if(y[0]==="o"&&y[1]==="n"&&(D=y.endsWith("Capture"),h=y.slice(2,D?y.length-7:void 0),B=s[yn]||null,B=B!=null?B[y]:null,typeof B=="function"&&s.removeEventListener(h,B,D),typeof w=="function")){typeof B!="function"&&B!==null&&(y in s?s[y]=null:s.hasAttribute(y)&&s.removeAttribute(y)),s.addEventListener(h,w,D);break e}y in s?s[y]=w:w===!0?s.setAttribute(y,""):ii(s,y,w)}}}function ro(s,h,y){switch(h){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":yi("error",s),yi("load",s);var w=!1,D=!1,B;for(B in y)if(y.hasOwnProperty(B)){var Q=y[B];if(Q!=null)switch(B){case"src":w=!0;break;case"srcSet":D=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(a(137,h));default:_r(s,h,B,Q,y,null)}}D&&_r(s,h,"srcSet",y.srcSet,y,null),w&&_r(s,h,"src",y.src,y,null);return;case"input":yi("invalid",s);var he=B=Q=D=null,Ue=null,dt=null;for(w in y)if(y.hasOwnProperty(w)){var bt=y[w];if(bt!=null)switch(w){case"name":D=bt;break;case"type":Q=bt;break;case"checked":Ue=bt;break;case"defaultChecked":dt=bt;break;case"value":B=bt;break;case"defaultValue":he=bt;break;case"children":case"dangerouslySetInnerHTML":if(bt!=null)throw Error(a(137,h));break;default:_r(s,h,w,bt,y,null)}}Dl(s,B,he,Ue,dt,Q,D,!1);return;case"select":yi("invalid",s),w=Q=B=null;for(D in y)if(y.hasOwnProperty(D)&&(he=y[D],he!=null))switch(D){case"value":B=he;break;case"defaultValue":Q=he;break;case"multiple":w=he;default:_r(s,h,D,he,y,null)}h=B,y=Q,s.multiple=!!w,h!=null?ar(s,!!w,h,!1):y!=null&&ar(s,!!w,y,!0);return;case"textarea":yi("invalid",s),B=D=w=null;for(Q in y)if(y.hasOwnProperty(Q)&&(he=y[Q],he!=null))switch(Q){case"value":w=he;break;case"defaultValue":D=he;break;case"children":B=he;break;case"dangerouslySetInnerHTML":if(he!=null)throw Error(a(91));break;default:_r(s,h,Q,he,y,null)}$a(s,w,D,B);return;case"option":for(Ue in y)if(y.hasOwnProperty(Ue)&&(w=y[Ue],w!=null))switch(Ue){case"selected":s.selected=w&&typeof w!="function"&&typeof w!="symbol";break;default:_r(s,h,Ue,w,y,null)}return;case"dialog":yi("beforetoggle",s),yi("toggle",s),yi("cancel",s),yi("close",s);break;case"iframe":case"object":yi("load",s);break;case"video":case"audio":for(w=0;w<rh.length;w++)yi(rh[w],s);break;case"image":yi("error",s),yi("load",s);break;case"details":yi("toggle",s);break;case"embed":case"source":case"link":yi("error",s),yi("load",s);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(dt in y)if(y.hasOwnProperty(dt)&&(w=y[dt],w!=null))switch(dt){case"children":case"dangerouslySetInnerHTML":throw Error(a(137,h));default:_r(s,h,dt,w,y,null)}return;default:if(qa(h)){for(bt in y)y.hasOwnProperty(bt)&&(w=y[bt],w!==void 0&&Nm(s,h,bt,w,y,void 0));return}}for(he in y)y.hasOwnProperty(he)&&(w=y[he],w!=null&&_r(s,h,he,w,y,null))}function ux(s,h,y,w){switch(h){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var D=null,B=null,Q=null,he=null,Ue=null,dt=null,bt=null;for(yt in y){var Et=y[yt];if(y.hasOwnProperty(yt)&&Et!=null)switch(yt){case"checked":break;case"value":break;case"defaultValue":Ue=Et;default:w.hasOwnProperty(yt)||_r(s,h,yt,null,w,Et)}}for(var ft in w){var yt=w[ft];if(Et=y[ft],w.hasOwnProperty(ft)&&(yt!=null||Et!=null))switch(ft){case"type":B=yt;break;case"name":D=yt;break;case"checked":dt=yt;break;case"defaultChecked":bt=yt;break;case"value":Q=yt;break;case"defaultValue":he=yt;break;case"children":case"dangerouslySetInnerHTML":if(yt!=null)throw Error(a(137,h));break;default:yt!==Et&&_r(s,h,ft,yt,w,Et)}}Po(s,Q,he,Ue,dt,bt,B,D);return;case"select":yt=Q=he=ft=null;for(B in y)if(Ue=y[B],y.hasOwnProperty(B)&&Ue!=null)switch(B){case"value":break;case"multiple":yt=Ue;default:w.hasOwnProperty(B)||_r(s,h,B,null,w,Ue)}for(D in w)if(B=w[D],Ue=y[D],w.hasOwnProperty(D)&&(B!=null||Ue!=null))switch(D){case"value":ft=B;break;case"defaultValue":he=B;break;case"multiple":Q=B;default:B!==Ue&&_r(s,h,D,B,w,Ue)}h=he,y=Q,w=yt,ft!=null?ar(s,!!y,ft,!1):!!w!=!!y&&(h!=null?ar(s,!!y,h,!0):ar(s,!!y,y?[]:"",!1));return;case"textarea":yt=ft=null;for(he in y)if(D=y[he],y.hasOwnProperty(he)&&D!=null&&!w.hasOwnProperty(he))switch(he){case"value":break;case"children":break;default:_r(s,h,he,null,w,D)}for(Q in w)if(D=w[Q],B=y[Q],w.hasOwnProperty(Q)&&(D!=null||B!=null))switch(Q){case"value":ft=D;break;case"defaultValue":yt=D;break;case"children":break;case"dangerouslySetInnerHTML":if(D!=null)throw Error(a(91));break;default:D!==B&&_r(s,h,Q,D,w,B)}Ja(s,ft,yt);return;case"option":for(var cn in y)if(ft=y[cn],y.hasOwnProperty(cn)&&ft!=null&&!w.hasOwnProperty(cn))switch(cn){case"selected":s.selected=!1;break;default:_r(s,h,cn,null,w,ft)}for(Ue in w)if(ft=w[Ue],yt=y[Ue],w.hasOwnProperty(Ue)&&ft!==yt&&(ft!=null||yt!=null))switch(Ue){case"selected":s.selected=ft&&typeof ft!="function"&&typeof ft!="symbol";break;default:_r(s,h,Ue,ft,w,yt)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var En in y)ft=y[En],y.hasOwnProperty(En)&&ft!=null&&!w.hasOwnProperty(En)&&_r(s,h,En,null,w,ft);for(dt in w)if(ft=w[dt],yt=y[dt],w.hasOwnProperty(dt)&&ft!==yt&&(ft!=null||yt!=null))switch(dt){case"children":case"dangerouslySetInnerHTML":if(ft!=null)throw Error(a(137,h));break;default:_r(s,h,dt,ft,w,yt)}return;default:if(qa(h)){for(var jr in y)ft=y[jr],y.hasOwnProperty(jr)&&ft!==void 0&&!w.hasOwnProperty(jr)&&Nm(s,h,jr,void 0,w,ft);for(bt in w)ft=w[bt],yt=y[bt],!w.hasOwnProperty(bt)||ft===yt||ft===void 0&&yt===void 0||Nm(s,h,bt,ft,w,yt);return}}for(var it in y)ft=y[it],y.hasOwnProperty(it)&&ft!=null&&!w.hasOwnProperty(it)&&_r(s,h,it,null,w,ft);for(Et in w)ft=w[Et],yt=y[Et],!w.hasOwnProperty(Et)||ft===yt||ft==null&&yt==null||_r(s,h,Et,ft,w,yt)}function k_(s){switch(s){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function Dv(){if(typeof performance.getEntriesByType=="function"){for(var s=0,h=0,y=performance.getEntriesByType("resource"),w=0;w<y.length;w++){var D=y[w],B=D.transferSize,Q=D.initiatorType,he=D.duration;if(B&&he&&k_(Q)){for(Q=0,he=D.responseEnd,w+=1;w<y.length;w++){var Ue=y[w],dt=Ue.startTime;if(dt>he)break;var bt=Ue.transferSize,Et=Ue.initiatorType;bt&&k_(Et)&&(Ue=Ue.responseEnd,Q+=bt*(Ue<he?1:(he-dt)/(Ue-dt)))}if(--w,h+=8*(B+Q)/(D.duration/1e3),s++,10<s)break}}if(0<s)return h/s/1e6}return navigator.connection&&(s=navigator.connection.downlink,typeof s=="number")?s:5}var wf=null,Bm=null;function Dd(s){return s.nodeType===9?s:s.ownerDocument}function Sp(s){switch(s){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Ep(s,h){if(s===0)switch(h){case"svg":return 1;case"math":return 2;default:return 0}return s===1&&h==="foreignObject"?0:s}function L_(s,h){return s==="textarea"||s==="noscript"||typeof h.children=="string"||typeof h.children=="number"||typeof h.children=="bigint"||typeof h.dangerouslySetInnerHTML=="object"&&h.dangerouslySetInnerHTML!==null&&h.dangerouslySetInnerHTML.__html!=null}var D_=null;function cx(){var s=window.event;return s&&s.type==="popstate"?s===D_?!1:(D_=s,!0):(D_=null,!1)}var zd=typeof setTimeout=="function"?setTimeout:void 0,Rs=typeof clearTimeout=="function"?clearTimeout:void 0,Fm=typeof Promise=="function"?Promise:void 0,zv=typeof queueMicrotask=="function"?queueMicrotask:typeof Fm<"u"?function(s){return Fm.resolve(null).then(s).catch(Ov)}:zd;function Ov(s){setTimeout(function(){throw s})}function Cc(s){return s==="head"}function Nv(s,h){var y=h,w=0;do{var D=y.nextSibling;if(s.removeChild(y),D&&D.nodeType===8)if(y=D.data,y==="/$"||y==="/&"){if(w===0){s.removeChild(D),Cl(h);return}w--}else if(y==="$"||y==="$?"||y==="$~"||y==="$!"||y==="&")w++;else if(y==="html")Od(s.ownerDocument.documentElement);else if(y==="head"){y=s.ownerDocument.head,Od(y);for(var B=y.firstChild;B;){var Q=B.nextSibling,he=B.nodeName;B[Us]||he==="SCRIPT"||he==="STYLE"||he==="LINK"&&B.rel.toLowerCase()==="stylesheet"||y.removeChild(B),B=Q}}else y==="body"&&Od(s.ownerDocument.body);y=D}while(y);Cl(h)}function z_(s,h){var y=s;s=0;do{var w=y.nextSibling;if(y.nodeType===1?h?(y._stashedDisplay=y.style.display,y.style.display="none"):(y.style.display=y._stashedDisplay||"",y.getAttribute("style")===""&&y.removeAttribute("style")):y.nodeType===3&&(h?(y._stashedText=y.nodeValue,y.nodeValue=""):y.nodeValue=y._stashedText||""),w&&w.nodeType===8)if(y=w.data,y==="/$"){if(s===0)break;s--}else y!=="$"&&y!=="$?"&&y!=="$~"&&y!=="$!"||s++;y=w}while(y)}function Vm(s){var h=s.firstChild;for(h&&h.nodeType===10&&(h=h.nextSibling);h;){var y=h;switch(h=h.nextSibling,y.nodeName){case"HTML":case"HEAD":case"BODY":Vm(y),js(y);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(y.rel.toLowerCase()==="stylesheet")continue}s.removeChild(y)}}function hx(s,h,y,w){for(;s.nodeType===1;){var D=y;if(s.nodeName.toLowerCase()!==h.toLowerCase()){if(!w&&(s.nodeName!=="INPUT"||s.type!=="hidden"))break}else if(w){if(!s[Us])switch(h){case"meta":if(!s.hasAttribute("itemprop"))break;return s;case"link":if(B=s.getAttribute("rel"),B==="stylesheet"&&s.hasAttribute("data-precedence"))break;if(B!==D.rel||s.getAttribute("href")!==(D.href==null||D.href===""?null:D.href)||s.getAttribute("crossorigin")!==(D.crossOrigin==null?null:D.crossOrigin)||s.getAttribute("title")!==(D.title==null?null:D.title))break;return s;case"style":if(s.hasAttribute("data-precedence"))break;return s;case"script":if(B=s.getAttribute("src"),(B!==(D.src==null?null:D.src)||s.getAttribute("type")!==(D.type==null?null:D.type)||s.getAttribute("crossorigin")!==(D.crossOrigin==null?null:D.crossOrigin))&&B&&s.hasAttribute("async")&&!s.hasAttribute("itemprop"))break;return s;default:return s}}else if(h==="input"&&s.type==="hidden"){var B=D.name==null?null:""+D.name;if(D.type==="hidden"&&s.getAttribute("name")===B)return s}else return s;if(s=Sl(s.nextSibling),s===null)break}return null}function Bv(s,h,y){if(h==="")return null;for(;s.nodeType!==3;)if((s.nodeType!==1||s.nodeName!=="INPUT"||s.type!=="hidden")&&!y||(s=Sl(s.nextSibling),s===null))return null;return s}function Um(s,h){for(;s.nodeType!==8;)if((s.nodeType!==1||s.nodeName!=="INPUT"||s.type!=="hidden")&&!h||(s=Sl(s.nextSibling),s===null))return null;return s}function Ap(s){return s.data==="$?"||s.data==="$~"}function jm(s){return s.data==="$!"||s.data==="$?"&&s.ownerDocument.readyState!=="loading"}function Cp(s,h){var y=s.ownerDocument;if(s.data==="$~")s._reactRetry=h;else if(s.data!=="$?"||y.readyState!=="loading")h();else{var w=function(){h(),y.removeEventListener("DOMContentLoaded",w)};y.addEventListener("DOMContentLoaded",w),s._reactRetry=w}}function Sl(s){for(;s!=null;s=s.nextSibling){var h=s.nodeType;if(h===1||h===3)break;if(h===8){if(h=s.data,h==="$"||h==="$!"||h==="$?"||h==="$~"||h==="&"||h==="F!"||h==="F")break;if(h==="/$"||h==="/&")return null}}return s}var $m=null;function qm(s){s=s.nextSibling;for(var h=0;s;){if(s.nodeType===8){var y=s.data;if(y==="/$"||y==="/&"){if(h===0)return Sl(s.nextSibling);h--}else y!=="$"&&y!=="$!"&&y!=="$?"&&y!=="$~"&&y!=="&"||h++}s=s.nextSibling}return null}function Ip(s){s=s.previousSibling;for(var h=0;s;){if(s.nodeType===8){var y=s.data;if(y==="$"||y==="$!"||y==="$?"||y==="$~"||y==="&"){if(h===0)return s;h--}else y!=="/$"&&y!=="/&"||h++}s=s.previousSibling}return null}function Tf(s,h,y){switch(h=Dd(y),s){case"html":if(s=h.documentElement,!s)throw Error(a(452));return s;case"head":if(s=h.head,!s)throw Error(a(453));return s;case"body":if(s=h.body,!s)throw Error(a(454));return s;default:throw Error(a(451))}}function Od(s){for(var h=s.attributes;h.length;)s.removeAttributeNode(h[0]);js(s)}var El=new Map,Gm=new Set;function Hm(s){return typeof s.getRootNode=="function"?s.getRootNode():s.nodeType===9?s:s.ownerDocument}var l=$t.d;$t.d={f:r,r:o,D:E,C:A,L:P,m:z,X:$,S:F,M:W};function r(){var s=l.f(),h=Rd();return s||h}function o(s){var h=Gr(s);h!==null&&h.tag===5&&h.type==="form"?xl(h):l.r(s)}var p=typeof document>"u"?null:document;function v(s,h,y){var w=p;if(w&&typeof h=="string"&&h){var D=rr(h);D='link[rel="'+s+'"][href="'+D+'"]',typeof y=="string"&&(D+='[crossorigin="'+y+'"]'),Gm.has(D)||(Gm.add(D),s={rel:s,crossOrigin:y,href:h},w.querySelector(D)===null&&(h=w.createElement("link"),ro(h,"link",s),Pr(h),w.head.appendChild(h)))}}function E(s){l.D(s),v("dns-prefetch",s,null)}function A(s,h){l.C(s,h),v("preconnect",s,h)}function P(s,h,y){l.L(s,h,y);var w=p;if(w&&s&&h){var D='link[rel="preload"][as="'+rr(h)+'"]';h==="image"&&y&&y.imageSrcSet?(D+='[imagesrcset="'+rr(y.imageSrcSet)+'"]',typeof y.imageSizes=="string"&&(D+='[imagesizes="'+rr(y.imageSizes)+'"]')):D+='[href="'+rr(s)+'"]';var B=D;switch(h){case"style":B=ie(s);break;case"script":B=Te(s)}El.has(B)||(s=q({rel:"preload",href:h==="image"&&y&&y.imageSrcSet?void 0:s,as:h},y),El.set(B,s),w.querySelector(D)!==null||h==="style"&&w.querySelector(re(B))||h==="script"&&w.querySelector(Ke(B))||(h=w.createElement("link"),ro(h,"link",s),Pr(h),w.head.appendChild(h)))}}function z(s,h){l.m(s,h);var y=p;if(y&&s){var w=h&&typeof h.as=="string"?h.as:"script",D='link[rel="modulepreload"][as="'+rr(w)+'"][href="'+rr(s)+'"]',B=D;switch(w){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":B=Te(s)}if(!El.has(B)&&(s=q({rel:"modulepreload",href:s},h),El.set(B,s),y.querySelector(D)===null)){switch(w){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(y.querySelector(Ke(B)))return}w=y.createElement("link"),ro(w,"link",s),Pr(w),y.head.appendChild(w)}}}function F(s,h,y){l.S(s,h,y);var w=p;if(w&&s){var D=Ei(w).hoistableStyles,B=ie(s);h=h||"default";var Q=D.get(B);if(!Q){var he={loading:0,preload:null};if(Q=w.querySelector(re(B)))he.loading=5;else{s=q({rel:"stylesheet",href:s,"data-precedence":h},y),(y=El.get(B))&&ot(s,y);var Ue=Q=w.createElement("link");Pr(Ue),ro(Ue,"link",s),Ue._p=new Promise(function(dt,bt){Ue.onload=dt,Ue.onerror=bt}),Ue.addEventListener("load",function(){he.loading|=1}),Ue.addEventListener("error",function(){he.loading|=2}),he.loading|=4,Fe(Q,h,w)}Q={type:"stylesheet",instance:Q,count:1,state:he},D.set(B,Q)}}}function $(s,h){l.X(s,h);var y=p;if(y&&s){var w=Ei(y).hoistableScripts,D=Te(s),B=w.get(D);B||(B=y.querySelector(Ke(D)),B||(s=q({src:s,async:!0},h),(h=El.get(D))&&gt(s,h),B=y.createElement("script"),Pr(B),ro(B,"link",s),y.head.appendChild(B)),B={type:"script",instance:B,count:1,state:null},w.set(D,B))}}function W(s,h){l.M(s,h);var y=p;if(y&&s){var w=Ei(y).hoistableScripts,D=Te(s),B=w.get(D);B||(B=y.querySelector(Ke(D)),B||(s=q({src:s,async:!0,type:"module"},h),(h=El.get(D))&&gt(s,h),B=y.createElement("script"),Pr(B),ro(B,"link",s),y.head.appendChild(B)),B={type:"script",instance:B,count:1,state:null},w.set(D,B))}}function te(s,h,y,w){var D=(D=Wt.current)?Hm(D):null;if(!D)throw Error(a(446));switch(s){case"meta":case"title":return null;case"style":return typeof y.precedence=="string"&&typeof y.href=="string"?(h=ie(y.href),y=Ei(D).hoistableStyles,w=y.get(h),w||(w={type:"style",instance:null,count:0,state:null},y.set(h,w)),w):{type:"void",instance:null,count:0,state:null};case"link":if(y.rel==="stylesheet"&&typeof y.href=="string"&&typeof y.precedence=="string"){s=ie(y.href);var B=Ei(D).hoistableStyles,Q=B.get(s);if(Q||(D=D.ownerDocument||D,Q={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},B.set(s,Q),(B=D.querySelector(re(s)))&&!B._p&&(Q.instance=B,Q.state.loading=5),El.has(s)||(y={rel:"preload",as:"style",href:y.href,crossOrigin:y.crossOrigin,integrity:y.integrity,media:y.media,hrefLang:y.hrefLang,referrerPolicy:y.referrerPolicy},El.set(s,y),B||pe(D,s,y,Q.state))),h&&w===null)throw Error(a(528,""));return Q}if(h&&w!==null)throw Error(a(529,""));return null;case"script":return h=y.async,y=y.src,typeof y=="string"&&h&&typeof h!="function"&&typeof h!="symbol"?(h=Te(y),y=Ei(D).hoistableScripts,w=y.get(h),w||(w={type:"script",instance:null,count:0,state:null},y.set(h,w)),w):{type:"void",instance:null,count:0,state:null};default:throw Error(a(444,s))}}function ie(s){return'href="'+rr(s)+'"'}function re(s){return'link[rel="stylesheet"]['+s+"]"}function oe(s){return q({},s,{"data-precedence":s.precedence,precedence:null})}function pe(s,h,y,w){s.querySelector('link[rel="preload"][as="style"]['+h+"]")?w.loading=1:(h=s.createElement("link"),w.preload=h,h.addEventListener("load",function(){return w.loading|=1}),h.addEventListener("error",function(){return w.loading|=2}),ro(h,"link",y),Pr(h),s.head.appendChild(h))}function Te(s){return'[src="'+rr(s)+'"]'}function Ke(s){return"script[async]"+s}function ke(s,h,y){if(h.count++,h.instance===null)switch(h.type){case"style":var w=s.querySelector('style[data-href~="'+rr(y.href)+'"]');if(w)return h.instance=w,Pr(w),w;var D=q({},y,{"data-href":y.href,"data-precedence":y.precedence,href:null,precedence:null});return w=(s.ownerDocument||s).createElement("style"),Pr(w),ro(w,"style",D),Fe(w,y.precedence,s),h.instance=w;case"stylesheet":D=ie(y.href);var B=s.querySelector(re(D));if(B)return h.state.loading|=4,h.instance=B,Pr(B),B;w=oe(y),(D=El.get(D))&&ot(w,D),B=(s.ownerDocument||s).createElement("link"),Pr(B);var Q=B;return Q._p=new Promise(function(he,Ue){Q.onload=he,Q.onerror=Ue}),ro(B,"link",w),h.state.loading|=4,Fe(B,y.precedence,s),h.instance=B;case"script":return B=Te(y.src),(D=s.querySelector(Ke(B)))?(h.instance=D,Pr(D),D):(w=y,(D=El.get(B))&&(w=q({},y),gt(w,D)),s=s.ownerDocument||s,D=s.createElement("script"),Pr(D),ro(D,"link",w),s.head.appendChild(D),h.instance=D);case"void":return null;default:throw Error(a(443,h.type))}else h.type==="stylesheet"&&(h.state.loading&4)===0&&(w=h.instance,h.state.loading|=4,Fe(w,y.precedence,s));return h.instance}function Fe(s,h,y){for(var w=y.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),D=w.length?w[w.length-1]:null,B=D,Q=0;Q<w.length;Q++){var he=w[Q];if(he.dataset.precedence===h)B=he;else if(B!==D)break}B?B.parentNode.insertBefore(s,B.nextSibling):(h=y.nodeType===9?y.head:y,h.insertBefore(s,h.firstChild))}function ot(s,h){s.crossOrigin==null&&(s.crossOrigin=h.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=h.referrerPolicy),s.title==null&&(s.title=h.title)}function gt(s,h){s.crossOrigin==null&&(s.crossOrigin=h.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=h.referrerPolicy),s.integrity==null&&(s.integrity=h.integrity)}var Ct=null;function Gt(s,h,y){if(Ct===null){var w=new Map,D=Ct=new Map;D.set(y,w)}else D=Ct,w=D.get(y),w||(w=new Map,D.set(y,w));if(w.has(s))return w;for(w.set(s,null),y=y.getElementsByTagName(s),D=0;D<y.length;D++){var B=y[D];if(!(B[Us]||B[kt]||s==="link"&&B.getAttribute("rel")==="stylesheet")&&B.namespaceURI!=="http://www.w3.org/2000/svg"){var Q=B.getAttribute(h)||"";Q=s+Q;var he=w.get(Q);he?he.push(B):w.set(Q,[B])}}return w}function Ft(s,h,y){s=s.ownerDocument||s,s.head.insertBefore(y,h==="title"?s.querySelector("head > title"):null)}function Ht(s,h,y){if(y===1||h.itemProp!=null)return!1;switch(s){case"meta":case"title":return!0;case"style":if(typeof h.precedence!="string"||typeof h.href!="string"||h.href==="")break;return!0;case"link":if(typeof h.rel!="string"||typeof h.href!="string"||h.href===""||h.onLoad||h.onError)break;switch(h.rel){case"stylesheet":return s=h.disabled,typeof h.precedence=="string"&&s==null;default:return!0}case"script":if(h.async&&typeof h.async!="function"&&typeof h.async!="symbol"&&!h.onLoad&&!h.onError&&h.src&&typeof h.src=="string")return!0}return!1}function dn(s){return!(s.type==="stylesheet"&&(s.state.loading&3)===0)}function qt(s,h,y,w){if(y.type==="stylesheet"&&(typeof w.media!="string"||matchMedia(w.media).matches!==!1)&&(y.state.loading&4)===0){if(y.instance===null){var D=ie(w.href),B=h.querySelector(re(D));if(B){h=B._p,h!==null&&typeof h=="object"&&typeof h.then=="function"&&(s.count++,s=Sn.bind(s),h.then(s,s)),y.state.loading|=4,y.instance=B,Pr(B);return}B=h.ownerDocument||h,w=oe(w),(D=El.get(D))&&ot(w,D),B=B.createElement("link"),Pr(B);var Q=B;Q._p=new Promise(function(he,Ue){Q.onload=he,Q.onerror=Ue}),ro(B,"link",w),y.instance=B}s.stylesheets===null&&(s.stylesheets=new Map),s.stylesheets.set(y,h),(h=y.state.preload)&&(y.state.loading&3)===0&&(s.count++,y=Sn.bind(s),h.addEventListener("load",y),h.addEventListener("error",y))}}var jt=0;function St(s,h){return s.stylesheets&&s.count===0&&mn(s,s.stylesheets),0<s.count||0<s.imgCount?function(y){var w=setTimeout(function(){if(s.stylesheets&&mn(s,s.stylesheets),s.unsuspend){var B=s.unsuspend;s.unsuspend=null,B()}},6e4+h);0<s.imgBytes&&jt===0&&(jt=62500*Dv());var D=setTimeout(function(){if(s.waitingForImages=!1,s.count===0&&(s.stylesheets&&mn(s,s.stylesheets),s.unsuspend)){var B=s.unsuspend;s.unsuspend=null,B()}},(s.imgBytes>jt?50:800)+h);return s.unsuspend=y,function(){s.unsuspend=null,clearTimeout(w),clearTimeout(D)}}:null}function Sn(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)mn(this,this.stylesheets);else if(this.unsuspend){var s=this.unsuspend;this.unsuspend=null,s()}}}var Mn=null;function mn(s,h){s.stylesheets=null,s.unsuspend!==null&&(s.count++,Mn=new Map,h.forEach(un,s),Mn=null,Sn.call(s))}function un(s,h){if(!(h.state.loading&4)){var y=Mn.get(s);if(y)var w=y.get(null);else{y=new Map,Mn.set(s,y);for(var D=s.querySelectorAll("link[data-precedence],style[data-precedence]"),B=0;B<D.length;B++){var Q=D[B];(Q.nodeName==="LINK"||Q.getAttribute("media")!=="not all")&&(y.set(Q.dataset.precedence,Q),w=Q)}w&&y.set(null,w)}D=h.instance,Q=D.getAttribute("data-precedence"),B=y.get(Q)||w,B===w&&y.set(null,D),y.set(Q,D),this.count++,w=Sn.bind(this),D.addEventListener("load",w),D.addEventListener("error",w),B?B.parentNode.insertBefore(D,B.nextSibling):(s=s.nodeType===9?s.head:s,s.insertBefore(D,s.firstChild)),h.state.loading|=4}}var Qn={$$typeof:qe,Provider:null,Consumer:null,_currentValue:Tt,_currentValue2:Tt,_threadCount:0};function Yr(s,h,y,w,D,B,Q,he,Ue){this.tag=1,this.containerInfo=s,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Gi(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Gi(0),this.hiddenUpdates=Gi(null),this.identifierPrefix=w,this.onUncaughtError=D,this.onCaughtError=B,this.onRecoverableError=Q,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=Ue,this.incompleteTransitions=new Map}function va(s,h,y,w,D,B,Q,he,Ue,dt,bt,Et){return s=new Yr(s,h,y,Q,Ue,dt,bt,Et,he),h=1,B===!0&&(h|=24),B=is(3,null,null,h),s.current=B,B.stateNode=s,h=Uo(),h.refCount++,s.pooledCache=h,h.refCount++,B.memoizedState={element:w,isDehydrated:y,cache:h},mc(B),s}function cs(s){return s?(s=zo,s):zo}function Al(s,h,y,w,D,B){D=cs(D),w.context===null?w.context=D:w.pendingContext=D,w=Pu(h),w.payload={element:y},B=B===void 0?null:B,B!==null&&(w.callback=B),y=ru(s,w,h),y!==null&&(yo(y,s,h),Wc(y,s,h))}function vo(s,h){if(s=s.memoizedState,s!==null&&s.dehydrated!==null){var y=s.retryLane;s.retryLane=y!==0&&y<h?y:h}}function za(s,h){vo(s,h),(s=s.alternate)&&vo(s,h)}function kr(s){if(s.tag===13||s.tag===31){var h=Do(s,67108864);h!==null&&yo(h,s,67108864),za(s,67108864)}}function Oa(s){if(s.tag===13||s.tag===31){var h=jl();h=Mt(h);var y=Do(s,h);y!==null&&yo(y,s,h),za(s,h)}}var ba=!0;function hs(s,h,y,w){var D=mt.T;mt.T=null;var B=$t.p;try{$t.p=2,Yo(s,h,y,w)}finally{$t.p=B,mt.T=D}}function bo(s,h,y,w){var D=mt.T;mt.T=null;var B=$t.p;try{$t.p=8,Yo(s,h,y,w)}finally{$t.p=B,mt.T=D}}function Yo(s,h,y,w){if(ba){var D=xa(w);if(D===null)Om(s,h,w,ks,y),Uh(s,w);else if(Ef(D,s,h,y,w))w.stopPropagation();else if(Uh(s,w),h&4&&-1<Sf.indexOf(s)){for(;D!==null;){var B=Gr(D);if(B!==null)switch(B.tag){case 3:if(B=B.stateNode,B.current.memoizedState.isDehydrated){var Q=vn(B.pendingLanes);if(Q!==0){var he=B;for(he.pendingLanes|=2,he.entangledLanes|=2;Q;){var Ue=1<<31-tt(Q);he.entanglements[1]|=Ue,Q&=~Ue}Ec(B),(qi&6)===0&&(gp=qr()+500,bf(0))}}break;case 31:case 13:he=Do(B,2),he!==null&&yo(he,B,2),Rd(),za(B,2)}if(B=xa(w),B===null&&Om(s,h,w,ks,y),B===D)break;D=B}D!==null&&w.stopPropagation()}else Om(s,h,w,null,y)}}function xa(s){return s=Wi(s),ha(s)}var ks=null;function ha(s){if(ks=null,s=_s(s),s!==null){var h=m(s);if(h===null)s=null;else{var y=h.tag;if(y===13){if(s=g(h),s!==null)return s;s=null}else if(y===31){if(s=c(h),s!==null)return s;s=null}else if(y===3){if(h.stateNode.current.memoizedState.isDehydrated)return h.tag===3?h.stateNode.containerInfo:null;s=null}else h!==s&&(s=null)}}return ks=s,null}function Na(s){switch(s){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(ps()){case ms:return 2;case Vs:return 8;case gs:case Xe:return 32;case se:return 268435456;default:return 32}default:return 32}}var wa=!1,yr=null,Ii=null,Ls=null,Ic=new Map,Qo=new Map,Vh=[],Sf="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Uh(s,h){switch(s){case"focusin":case"focusout":yr=null;break;case"dragenter":case"dragleave":Ii=null;break;case"mouseover":case"mouseout":Ls=null;break;case"pointerover":case"pointerout":Ic.delete(h.pointerId);break;case"gotpointercapture":case"lostpointercapture":Qo.delete(h.pointerId)}}function Pc(s,h,y,w,D,B){return s===null||s.nativeEvent!==B?(s={blockedOn:h,domEventName:y,eventSystemFlags:w,nativeEvent:B,targetContainers:[D]},h!==null&&(h=Gr(h),h!==null&&kr(h)),s):(s.eventSystemFlags|=w,h=s.targetContainers,D!==null&&h.indexOf(D)===-1&&h.push(D),s)}function Ef(s,h,y,w,D){switch(h){case"focusin":return yr=Pc(yr,s,h,y,w,D),!0;case"dragenter":return Ii=Pc(Ii,s,h,y,w,D),!0;case"mouseover":return Ls=Pc(Ls,s,h,y,w,D),!0;case"pointerover":var B=D.pointerId;return Ic.set(B,Pc(Ic.get(B)||null,s,h,y,w,D)),!0;case"gotpointercapture":return B=D.pointerId,Qo.set(B,Pc(Qo.get(B)||null,s,h,y,w,D)),!0}return!1}function Nd(s){var h=_s(s.target);if(h!==null){var y=m(h);if(y!==null){if(h=y.tag,h===13){if(h=g(y),h!==null){s.blockedOn=h,na(s.priority,function(){Oa(y)});return}}else if(h===31){if(h=c(y),h!==null){s.blockedOn=h,na(s.priority,function(){Oa(y)});return}}else if(h===3&&y.stateNode.current.memoizedState.isDehydrated){s.blockedOn=y.tag===3?y.stateNode.containerInfo:null;return}}}s.blockedOn=null}function Pp(s){if(s.blockedOn!==null)return!1;for(var h=s.targetContainers;0<h.length;){var y=xa(s.nativeEvent);if(y===null){y=s.nativeEvent;var w=new y.constructor(y.type,y);zl=w,y.target.dispatchEvent(w),zl=null}else return h=Gr(y),h!==null&&kr(h),s.blockedOn=y,!1;h.shift()}return!0}function O_(s,h,y){Pp(s)&&y.delete(h)}function Fv(){wa=!1,yr!==null&&Pp(yr)&&(yr=null),Ii!==null&&Pp(Ii)&&(Ii=null),Ls!==null&&Pp(Ls)&&(Ls=null),Ic.forEach(O_),Qo.forEach(O_)}function Mp(s,h){s.blockedOn===h&&(s.blockedOn=null,wa||(wa=!0,n.unstable_scheduleCallback(n.unstable_NormalPriority,Fv)))}var Af=null;function Zm(s){Af!==s&&(Af=s,n.unstable_scheduleCallback(n.unstable_NormalPriority,function(){Af===s&&(Af=null);for(var h=0;h<s.length;h+=3){var y=s[h],w=s[h+1],D=s[h+2];if(typeof w!="function"){if(ha(w||y)===null)continue;break}var B=Gr(y);B!==null&&(s.splice(h,3),h-=3,bc(B,{pending:!0,data:D,method:y.method,action:w},w,D))}}))}function Cl(s){function h(Ue){return Mp(Ue,s)}yr!==null&&Mp(yr,s),Ii!==null&&Mp(Ii,s),Ls!==null&&Mp(Ls,s),Ic.forEach(h),Qo.forEach(h);for(var y=0;y<Vh.length;y++){var w=Vh[y];w.blockedOn===s&&(w.blockedOn=null)}for(;0<Vh.length&&(y=Vh[0],y.blockedOn===null);)Nd(y),y.blockedOn===null&&Vh.shift();if(y=(s.ownerDocument||s).$$reactFormReplay,y!=null)for(w=0;w<y.length;w+=3){var D=y[w],B=y[w+1],Q=D[yn]||null;if(typeof B=="function")Q||Zm(y);else if(Q){var he=null;if(B&&B.hasAttribute("formAction")){if(D=B,Q=B[yn]||null)he=Q.formAction;else if(ha(D)!==null)continue}else he=Q.action;typeof he=="function"?y[w+1]=he:(y.splice(w,3),w-=3),Zm(y)}}}function N_(){function s(B){B.canIntercept&&B.info==="react-transition"&&B.intercept({handler:function(){return new Promise(function(Q){return D=Q})},focusReset:"manual",scroll:"manual"})}function h(){D!==null&&(D(),D=null),w||setTimeout(y,20)}function y(){if(!w&&!navigation.transition){var B=navigation.currentEntry;B&&B.url!=null&&navigation.navigate(B.url,{state:B.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var w=!1,D=null;return navigation.addEventListener("navigate",s),navigation.addEventListener("navigatesuccess",h),navigation.addEventListener("navigateerror",h),setTimeout(y,100),function(){w=!0,navigation.removeEventListener("navigate",s),navigation.removeEventListener("navigatesuccess",h),navigation.removeEventListener("navigateerror",h),D!==null&&(D(),D=null)}}}function Wm(s){this._internalRoot=s}Km.prototype.render=Wm.prototype.render=function(s){var h=this._internalRoot;if(h===null)throw Error(a(409));var y=h.current,w=jl();Al(y,w,s,h,null,null)},Km.prototype.unmount=Wm.prototype.unmount=function(){var s=this._internalRoot;if(s!==null){this._internalRoot=null;var h=s.containerInfo;Al(s.current,2,null,s,null,null),Rd(),h[In]=null}};function Km(s){this._internalRoot=s}Km.prototype.unstable_scheduleHydration=function(s){if(s){var h=nr();s={blockedOn:null,target:s,priority:h};for(var y=0;y<Vh.length&&h!==0&&h<Vh[y].priority;y++);Vh.splice(y,0,s),y===0&&Nd(s)}};var Vv=e.version;if(Vv!=="19.2.0")throw Error(a(527,Vv,"19.2.0"));$t.findDOMNode=function(s){var h=s._reactInternals;if(h===void 0)throw typeof s.render=="function"?Error(a(188)):(s=Object.keys(s).join(","),Error(a(268,s)));return s=R(h),s=s!==null?V(s):null,s=s===null?null:s.stateNode,s};var dx={bundleType:0,version:"19.2.0",rendererPackageName:"react-dom",currentDispatcherRef:mt,reconcilerVersion:"19.2.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Xm=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Xm.isDisabled&&Xm.supportsFiber)try{Se=Xm.inject(dx),De=Xm}catch{}}return F_.createRoot=function(s,h){if(!d(s))throw Error(a(299));var y=!1,w="",D=qg,B=vd,Q=ev;return h!=null&&(h.unstable_strictMode===!0&&(y=!0),h.identifierPrefix!==void 0&&(w=h.identifierPrefix),h.onUncaughtError!==void 0&&(D=h.onUncaughtError),h.onCaughtError!==void 0&&(B=h.onCaughtError),h.onRecoverableError!==void 0&&(Q=h.onRecoverableError)),h=va(s,1,!1,null,null,y,w,null,D,B,Q,N_),s[In]=h.current,Ld(s),new Wm(h)},F_.hydrateRoot=function(s,h,y){if(!d(s))throw Error(a(299));var w=!1,D="",B=qg,Q=vd,he=ev,Ue=null;return y!=null&&(y.unstable_strictMode===!0&&(w=!0),y.identifierPrefix!==void 0&&(D=y.identifierPrefix),y.onUncaughtError!==void 0&&(B=y.onUncaughtError),y.onCaughtError!==void 0&&(Q=y.onCaughtError),y.onRecoverableError!==void 0&&(he=y.onRecoverableError),y.formState!==void 0&&(Ue=y.formState)),h=va(s,1,!0,h,y??null,w,D,Ue,B,Q,he,N_),h.context=cs(null),y=h.current,w=jl(),w=Mt(w),D=Pu(w),D.callback=null,ru(y,D,w),y=w,h.current.lanes=y,tr(h,y),Ec(h),s[In]=h.current,Ld(s),new Km(h)},F_.version="19.2.0",F_}var Q2;function yR(){if(Q2)return mx.exports;Q2=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),mx.exports=_R(),mx.exports}var vR=yR();const bR=Ry(vR);/**
 * react-router v7.9.6
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var J2="popstate";function xR(n={}){function e(a,d){let{pathname:m,search:g,hash:c}=a.location;return t1("",{pathname:m,search:g,hash:c},d.state&&d.state.usr||null,d.state&&d.state.key||"default")}function t(a,d){return typeof d=="string"?d:uy(d)}return TR(e,t,null,n)}function Fa(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function fh(n,e){if(!n){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function wR(){return Math.random().toString(36).substring(2,10)}function eT(n,e){return{usr:n.state,key:n.key,idx:e}}function t1(n,e,t=null,a){return{pathname:typeof n=="string"?n:n.pathname,search:"",hash:"",...typeof e=="string"?Eg(e):e,state:t,key:e&&e.key||a||wR()}}function uy({pathname:n="/",search:e="",hash:t=""}){return e&&e!=="?"&&(n+=e.charAt(0)==="?"?e:"?"+e),t&&t!=="#"&&(n+=t.charAt(0)==="#"?t:"#"+t),n}function Eg(n){let e={};if(n){let t=n.indexOf("#");t>=0&&(e.hash=n.substring(t),n=n.substring(0,t));let a=n.indexOf("?");a>=0&&(e.search=n.substring(a),n=n.substring(0,a)),n&&(e.pathname=n)}return e}function TR(n,e,t,a={}){let{window:d=document.defaultView,v5Compat:m=!1}=a,g=d.history,c="POP",C=null,R=V();R==null&&(R=0,g.replaceState({...g.state,idx:R},""));function V(){return(g.state||{idx:null}).idx}function q(){c="POP";let Oe=V(),et=Oe==null?null:Oe-R;R=Oe,C&&C({action:c,location:be.location,delta:et})}function J(Oe,et){c="PUSH";let Je=t1(be.location,Oe,et);R=V()+1;let qe=eT(Je,R),Ze=be.createHref(Je);try{g.pushState(qe,"",Ze)}catch(je){if(je instanceof DOMException&&je.name==="DataCloneError")throw je;d.location.assign(Ze)}m&&C&&C({action:c,location:be.location,delta:1})}function Y(Oe,et){c="REPLACE";let Je=t1(be.location,Oe,et);R=V();let qe=eT(Je,R),Ze=be.createHref(Je);g.replaceState(qe,"",Ze),m&&C&&C({action:c,location:be.location,delta:0})}function xe(Oe){return SR(Oe)}let be={get action(){return c},get location(){return n(d,g)},listen(Oe){if(C)throw new Error("A history only accepts one active listener");return d.addEventListener(J2,q),C=Oe,()=>{d.removeEventListener(J2,q),C=null}},createHref(Oe){return e(d,Oe)},createURL:xe,encodeLocation(Oe){let et=xe(Oe);return{pathname:et.pathname,search:et.search,hash:et.hash}},push:J,replace:Y,go(Oe){return g.go(Oe)}};return be}function SR(n,e=!1){let t="http://localhost";typeof window<"u"&&(t=window.location.origin!=="null"?window.location.origin:window.location.href),Fa(t,"No window.location.(origin|href) available to create URL");let a=typeof n=="string"?n:uy(n);return a=a.replace(/ $/,"%20"),!e&&a.startsWith("//")&&(a=t+a),new URL(a,t)}function fA(n,e,t="/"){return ER(n,e,t,!1)}function ER(n,e,t,a){let d=typeof e=="string"?Eg(e):e,m=qd(d.pathname||"/",t);if(m==null)return null;let g=pA(n);AR(g);let c=null;for(let C=0;c==null&&C<g.length;++C){let R=NR(m);c=zR(g[C],R,a)}return c}function pA(n,e=[],t=[],a="",d=!1){let m=(g,c,C=d,R)=>{let V={relativePath:R===void 0?g.path||"":R,caseSensitive:g.caseSensitive===!0,childrenIndex:c,route:g};if(V.relativePath.startsWith("/")){if(!V.relativePath.startsWith(a)&&C)return;Fa(V.relativePath.startsWith(a),`Absolute route path "${V.relativePath}" nested under path "${a}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),V.relativePath=V.relativePath.slice(a.length)}let q=Vd([a,V.relativePath]),J=t.concat(V);g.children&&g.children.length>0&&(Fa(g.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${q}".`),pA(g.children,e,J,q,C)),!(g.path==null&&!g.index)&&e.push({path:q,score:LR(q,g.index),routesMeta:J})};return n.forEach((g,c)=>{var C;if(g.path===""||!((C=g.path)!=null&&C.includes("?")))m(g,c);else for(let R of mA(g.path))m(g,c,!0,R)}),e}function mA(n){let e=n.split("/");if(e.length===0)return[];let[t,...a]=e,d=t.endsWith("?"),m=t.replace(/\?$/,"");if(a.length===0)return d?[m,""]:[m];let g=mA(a.join("/")),c=[];return c.push(...g.map(C=>C===""?m:[m,C].join("/"))),d&&c.push(...g),c.map(C=>n.startsWith("/")&&C===""?"/":C)}function AR(n){n.sort((e,t)=>e.score!==t.score?t.score-e.score:DR(e.routesMeta.map(a=>a.childrenIndex),t.routesMeta.map(a=>a.childrenIndex)))}var CR=/^:[\w-]+$/,IR=3,PR=2,MR=1,RR=10,kR=-2,tT=n=>n==="*";function LR(n,e){let t=n.split("/"),a=t.length;return t.some(tT)&&(a+=kR),e&&(a+=PR),t.filter(d=>!tT(d)).reduce((d,m)=>d+(CR.test(m)?IR:m===""?MR:RR),a)}function DR(n,e){return n.length===e.length&&n.slice(0,-1).every((a,d)=>a===e[d])?n[n.length-1]-e[e.length-1]:0}function zR(n,e,t=!1){let{routesMeta:a}=n,d={},m="/",g=[];for(let c=0;c<a.length;++c){let C=a[c],R=c===a.length-1,V=m==="/"?e:e.slice(m.length)||"/",q=L0({path:C.relativePath,caseSensitive:C.caseSensitive,end:R},V),J=C.route;if(!q&&R&&t&&!a[a.length-1].route.index&&(q=L0({path:C.relativePath,caseSensitive:C.caseSensitive,end:!1},V)),!q)return null;Object.assign(d,q.params),g.push({params:d,pathname:Vd([m,q.pathname]),pathnameBase:jR(Vd([m,q.pathnameBase])),route:J}),q.pathnameBase!=="/"&&(m=Vd([m,q.pathnameBase]))}return g}function L0(n,e){typeof n=="string"&&(n={path:n,caseSensitive:!1,end:!0});let[t,a]=OR(n.path,n.caseSensitive,n.end),d=e.match(t);if(!d)return null;let m=d[0],g=m.replace(/(.)\/+$/,"$1"),c=d.slice(1);return{params:a.reduce((R,{paramName:V,isOptional:q},J)=>{if(V==="*"){let xe=c[J]||"";g=m.slice(0,m.length-xe.length).replace(/(.)\/+$/,"$1")}const Y=c[J];return q&&!Y?R[V]=void 0:R[V]=(Y||"").replace(/%2F/g,"/"),R},{}),pathname:m,pathnameBase:g,pattern:n}}function OR(n,e=!1,t=!0){fh(n==="*"||!n.endsWith("*")||n.endsWith("/*"),`Route path "${n}" will be treated as if it were "${n.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${n.replace(/\*$/,"/*")}".`);let a=[],d="^"+n.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(g,c,C)=>(a.push({paramName:c,isOptional:C!=null}),C?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return n.endsWith("*")?(a.push({paramName:"*"}),d+=n==="*"||n==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?d+="\\/*$":n!==""&&n!=="/"&&(d+="(?:(?=\\/|$))"),[new RegExp(d,e?void 0:"i"),a]}function NR(n){try{return n.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return fh(!1,`The URL path "${n}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),n}}function qd(n,e){if(e==="/")return n;if(!n.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,a=n.charAt(t);return a&&a!=="/"?null:n.slice(t)||"/"}var BR=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,FR=n=>BR.test(n);function VR(n,e="/"){let{pathname:t,search:a="",hash:d=""}=typeof n=="string"?Eg(n):n,m;if(t)if(FR(t))m=t;else{if(t.includes("//")){let g=t;t=t.replace(/\/\/+/g,"/"),fh(!1,`Pathnames cannot have embedded double slashes - normalizing ${g} -> ${t}`)}t.startsWith("/")?m=nT(t.substring(1),"/"):m=nT(t,e)}else m=e;return{pathname:m,search:$R(a),hash:qR(d)}}function nT(n,e){let t=e.replace(/\/+$/,"").split("/");return n.split("/").forEach(d=>{d===".."?t.length>1&&t.pop():d!=="."&&t.push(d)}),t.length>1?t.join("/"):"/"}function vx(n,e,t,a){return`Cannot include a '${n}' character in a manually specified \`to.${e}\` field [${JSON.stringify(a)}].  Please separate it out to the \`to.${t}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function UR(n){return n.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function gA(n){let e=UR(n);return e.map((t,a)=>a===e.length-1?t.pathname:t.pathnameBase)}function _A(n,e,t,a=!1){let d;typeof n=="string"?d=Eg(n):(d={...n},Fa(!d.pathname||!d.pathname.includes("?"),vx("?","pathname","search",d)),Fa(!d.pathname||!d.pathname.includes("#"),vx("#","pathname","hash",d)),Fa(!d.search||!d.search.includes("#"),vx("#","search","hash",d)));let m=n===""||d.pathname==="",g=m?"/":d.pathname,c;if(g==null)c=t;else{let q=e.length-1;if(!a&&g.startsWith("..")){let J=g.split("/");for(;J[0]==="..";)J.shift(),q-=1;d.pathname=J.join("/")}c=q>=0?e[q]:"/"}let C=VR(d,c),R=g&&g!=="/"&&g.endsWith("/"),V=(m||g===".")&&t.endsWith("/");return!C.pathname.endsWith("/")&&(R||V)&&(C.pathname+="/"),C}var Vd=n=>n.join("/").replace(/\/\/+/g,"/"),jR=n=>n.replace(/\/+$/,"").replace(/^\/*/,"/"),$R=n=>!n||n==="?"?"":n.startsWith("?")?n:"?"+n,qR=n=>!n||n==="#"?"":n.startsWith("#")?n:"#"+n;function GR(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.internal=="boolean"&&"data"in n}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var yA=["POST","PUT","PATCH","DELETE"];new Set(yA);var HR=["GET",...yA];new Set(HR);var Ag=wt.createContext(null);Ag.displayName="DataRouter";var db=wt.createContext(null);db.displayName="DataRouterState";wt.createContext(!1);var vA=wt.createContext({isTransitioning:!1});vA.displayName="ViewTransition";var ZR=wt.createContext(new Map);ZR.displayName="Fetchers";var WR=wt.createContext(null);WR.displayName="Await";var id=wt.createContext(null);id.displayName="Navigation";var ky=wt.createContext(null);ky.displayName="Location";var Yd=wt.createContext({outlet:null,matches:[],isDataRoute:!1});Yd.displayName="Route";var sw=wt.createContext(null);sw.displayName="RouteError";function KR(n,{relative:e}={}){Fa(Ly(),"useHref() may be used only in the context of a <Router> component.");let{basename:t,navigator:a}=wt.useContext(id),{hash:d,pathname:m,search:g}=Dy(n,{relative:e}),c=m;return t!=="/"&&(c=m==="/"?t:Vd([t,m])),a.createHref({pathname:c,search:g,hash:d})}function Ly(){return wt.useContext(ky)!=null}function am(){return Fa(Ly(),"useLocation() may be used only in the context of a <Router> component."),wt.useContext(ky).location}var bA="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function xA(n){wt.useContext(id).static||wt.useLayoutEffect(n)}function XR(){let{isDataRoute:n}=wt.useContext(Yd);return n?uk():YR()}function YR(){Fa(Ly(),"useNavigate() may be used only in the context of a <Router> component.");let n=wt.useContext(Ag),{basename:e,navigator:t}=wt.useContext(id),{matches:a}=wt.useContext(Yd),{pathname:d}=am(),m=JSON.stringify(gA(a)),g=wt.useRef(!1);return xA(()=>{g.current=!0}),wt.useCallback((C,R={})=>{if(fh(g.current,bA),!g.current)return;if(typeof C=="number"){t.go(C);return}let V=_A(C,JSON.parse(m),d,R.relative==="path");n==null&&e!=="/"&&(V.pathname=V.pathname==="/"?e:Vd([e,V.pathname])),(R.replace?t.replace:t.push)(V,R.state,R)},[e,t,m,d,n])}wt.createContext(null);function Dy(n,{relative:e}={}){let{matches:t}=wt.useContext(Yd),{pathname:a}=am(),d=JSON.stringify(gA(t));return wt.useMemo(()=>_A(n,JSON.parse(d),a,e==="path"),[n,d,a,e])}function QR(n,e){return wA(n,e)}function wA(n,e,t,a,d){var Je;Fa(Ly(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:m}=wt.useContext(id),{matches:g}=wt.useContext(Yd),c=g[g.length-1],C=c?c.params:{},R=c?c.pathname:"/",V=c?c.pathnameBase:"/",q=c&&c.route;{let qe=q&&q.path||"";TA(R,!q||qe.endsWith("*")||qe.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${R}" (under <Route path="${qe}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${qe}"> to <Route path="${qe==="/"?"*":`${qe}/*`}">.`)}let J=am(),Y;if(e){let qe=typeof e=="string"?Eg(e):e;Fa(V==="/"||((Je=qe.pathname)==null?void 0:Je.startsWith(V)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${V}" but pathname "${qe.pathname}" was given in the \`location\` prop.`),Y=qe}else Y=J;let xe=Y.pathname||"/",be=xe;if(V!=="/"){let qe=V.replace(/^\//,"").split("/");be="/"+xe.replace(/^\//,"").split("/").slice(qe.length).join("/")}let Oe=fA(n,{pathname:be});fh(q||Oe!=null,`No routes matched location "${Y.pathname}${Y.search}${Y.hash}" `),fh(Oe==null||Oe[Oe.length-1].route.element!==void 0||Oe[Oe.length-1].route.Component!==void 0||Oe[Oe.length-1].route.lazy!==void 0,`Matched leaf route at location "${Y.pathname}${Y.search}${Y.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let et=ik(Oe&&Oe.map(qe=>Object.assign({},qe,{params:Object.assign({},C,qe.params),pathname:Vd([V,m.encodeLocation?m.encodeLocation(qe.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:qe.pathname]),pathnameBase:qe.pathnameBase==="/"?V:Vd([V,m.encodeLocation?m.encodeLocation(qe.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:qe.pathnameBase])})),g,t,a,d);return e&&et?wt.createElement(ky.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...Y},navigationType:"POP"}},et):et}function JR(){let n=lk(),e=GR(n)?`${n.status} ${n.statusText}`:n instanceof Error?n.message:JSON.stringify(n),t=n instanceof Error?n.stack:null,a="rgba(200,200,200, 0.5)",d={padding:"0.5rem",backgroundColor:a},m={padding:"2px 4px",backgroundColor:a},g=null;return console.error("Error handled by React Router default ErrorBoundary:",n),g=wt.createElement(wt.Fragment,null,wt.createElement("p",null," Hey developer "),wt.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",wt.createElement("code",{style:m},"ErrorBoundary")," or"," ",wt.createElement("code",{style:m},"errorElement")," prop on your route.")),wt.createElement(wt.Fragment,null,wt.createElement("h2",null,"Unexpected Application Error!"),wt.createElement("h3",{style:{fontStyle:"italic"}},e),t?wt.createElement("pre",{style:d},t):null,g)}var ek=wt.createElement(JR,null),tk=class extends wt.Component{constructor(n){super(n),this.state={location:n.location,revalidation:n.revalidation,error:n.error}}static getDerivedStateFromError(n){return{error:n}}static getDerivedStateFromProps(n,e){return e.location!==n.location||e.revalidation!=="idle"&&n.revalidation==="idle"?{error:n.error,location:n.location,revalidation:n.revalidation}:{error:n.error!==void 0?n.error:e.error,location:e.location,revalidation:n.revalidation||e.revalidation}}componentDidCatch(n,e){this.props.onError?this.props.onError(n,e):console.error("React Router caught the following error during render",n)}render(){return this.state.error!==void 0?wt.createElement(Yd.Provider,{value:this.props.routeContext},wt.createElement(sw.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function nk({routeContext:n,match:e,children:t}){let a=wt.useContext(Ag);return a&&a.static&&a.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(a.staticContext._deepestRenderedBoundaryId=e.route.id),wt.createElement(Yd.Provider,{value:n},t)}function ik(n,e=[],t=null,a=null,d=null){if(n==null){if(!t)return null;if(t.errors)n=t.matches;else if(e.length===0&&!t.initialized&&t.matches.length>0)n=t.matches;else return null}let m=n,g=t==null?void 0:t.errors;if(g!=null){let V=m.findIndex(q=>q.route.id&&(g==null?void 0:g[q.route.id])!==void 0);Fa(V>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(g).join(",")}`),m=m.slice(0,Math.min(m.length,V+1))}let c=!1,C=-1;if(t)for(let V=0;V<m.length;V++){let q=m[V];if((q.route.HydrateFallback||q.route.hydrateFallbackElement)&&(C=V),q.route.id){let{loaderData:J,errors:Y}=t,xe=q.route.loader&&!J.hasOwnProperty(q.route.id)&&(!Y||Y[q.route.id]===void 0);if(q.route.lazy||xe){c=!0,C>=0?m=m.slice(0,C+1):m=[m[0]];break}}}let R=t&&a?(V,q)=>{var J,Y;a(V,{location:t.location,params:((Y=(J=t.matches)==null?void 0:J[0])==null?void 0:Y.params)??{},errorInfo:q})}:void 0;return m.reduceRight((V,q,J)=>{let Y,xe=!1,be=null,Oe=null;t&&(Y=g&&q.route.id?g[q.route.id]:void 0,be=q.route.errorElement||ek,c&&(C<0&&J===0?(TA("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),xe=!0,Oe=null):C===J&&(xe=!0,Oe=q.route.hydrateFallbackElement||null)));let et=e.concat(m.slice(0,J+1)),Je=()=>{let qe;return Y?qe=be:xe?qe=Oe:q.route.Component?qe=wt.createElement(q.route.Component,null):q.route.element?qe=q.route.element:qe=V,wt.createElement(nk,{match:q,routeContext:{outlet:V,matches:et,isDataRoute:t!=null},children:qe})};return t&&(q.route.ErrorBoundary||q.route.errorElement||J===0)?wt.createElement(tk,{location:t.location,revalidation:t.revalidation,component:be,error:Y,children:Je(),routeContext:{outlet:null,matches:et,isDataRoute:!0},onError:R}):Je()},null)}function ow(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function rk(n){let e=wt.useContext(Ag);return Fa(e,ow(n)),e}function ak(n){let e=wt.useContext(db);return Fa(e,ow(n)),e}function sk(n){let e=wt.useContext(Yd);return Fa(e,ow(n)),e}function lw(n){let e=sk(n),t=e.matches[e.matches.length-1];return Fa(t.route.id,`${n} can only be used on routes that contain a unique "id"`),t.route.id}function ok(){return lw("useRouteId")}function lk(){var a;let n=wt.useContext(sw),e=ak("useRouteError"),t=lw("useRouteError");return n!==void 0?n:(a=e.errors)==null?void 0:a[t]}function uk(){let{router:n}=rk("useNavigate"),e=lw("useNavigate"),t=wt.useRef(!1);return xA(()=>{t.current=!0}),wt.useCallback(async(d,m={})=>{fh(t.current,bA),t.current&&(typeof d=="number"?n.navigate(d):await n.navigate(d,{fromRouteId:e,...m}))},[n,e])}var iT={};function TA(n,e,t){!e&&!iT[n]&&(iT[n]=!0,fh(!1,t))}wt.memo(ck);function ck({routes:n,future:e,state:t,unstable_onError:a}){return wA(n,void 0,t,a,e)}function Lp(n){Fa(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function hk({basename:n="/",children:e=null,location:t,navigationType:a="POP",navigator:d,static:m=!1}){Fa(!Ly(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let g=n.replace(/^\/*/,"/"),c=wt.useMemo(()=>({basename:g,navigator:d,static:m,future:{}}),[g,d,m]);typeof t=="string"&&(t=Eg(t));let{pathname:C="/",search:R="",hash:V="",state:q=null,key:J="default"}=t,Y=wt.useMemo(()=>{let xe=qd(C,g);return xe==null?null:{location:{pathname:xe,search:R,hash:V,state:q,key:J},navigationType:a}},[g,C,R,V,q,J,a]);return fh(Y!=null,`<Router basename="${g}"> is not able to match the URL "${C}${R}${V}" because it does not start with the basename, so the <Router> won't render anything.`),Y==null?null:wt.createElement(id.Provider,{value:c},wt.createElement(ky.Provider,{children:e,value:Y}))}function dk({children:n,location:e}){return QR(n1(n),e)}function n1(n,e=[]){let t=[];return wt.Children.forEach(n,(a,d)=>{if(!wt.isValidElement(a))return;let m=[...e,d];if(a.type===wt.Fragment){t.push.apply(t,n1(a.props.children,m));return}Fa(a.type===Lp,`[${typeof a.type=="string"?a.type:a.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),Fa(!a.props.index||!a.props.children,"An index route cannot have child routes.");let g={id:a.props.id||m.join("-"),caseSensitive:a.props.caseSensitive,element:a.props.element,Component:a.props.Component,index:a.props.index,path:a.props.path,middleware:a.props.middleware,loader:a.props.loader,action:a.props.action,hydrateFallbackElement:a.props.hydrateFallbackElement,HydrateFallback:a.props.HydrateFallback,errorElement:a.props.errorElement,ErrorBoundary:a.props.ErrorBoundary,hasErrorBoundary:a.props.hasErrorBoundary===!0||a.props.ErrorBoundary!=null||a.props.errorElement!=null,shouldRevalidate:a.props.shouldRevalidate,handle:a.props.handle,lazy:a.props.lazy};a.props.children&&(g.children=n1(a.props.children,m)),t.push(g)}),t}var r0="get",a0="application/x-www-form-urlencoded";function fb(n){return n!=null&&typeof n.tagName=="string"}function fk(n){return fb(n)&&n.tagName.toLowerCase()==="button"}function pk(n){return fb(n)&&n.tagName.toLowerCase()==="form"}function mk(n){return fb(n)&&n.tagName.toLowerCase()==="input"}function gk(n){return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}function _k(n,e){return n.button===0&&(!e||e==="_self")&&!gk(n)}var Uv=null;function yk(){if(Uv===null)try{new FormData(document.createElement("form"),0),Uv=!1}catch{Uv=!0}return Uv}var vk=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function bx(n){return n!=null&&!vk.has(n)?(fh(!1,`"${n}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${a0}"`),null):n}function bk(n,e){let t,a,d,m,g;if(pk(n)){let c=n.getAttribute("action");a=c?qd(c,e):null,t=n.getAttribute("method")||r0,d=bx(n.getAttribute("enctype"))||a0,m=new FormData(n)}else if(fk(n)||mk(n)&&(n.type==="submit"||n.type==="image")){let c=n.form;if(c==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let C=n.getAttribute("formaction")||c.getAttribute("action");if(a=C?qd(C,e):null,t=n.getAttribute("formmethod")||c.getAttribute("method")||r0,d=bx(n.getAttribute("formenctype"))||bx(c.getAttribute("enctype"))||a0,m=new FormData(c,n),!yk()){let{name:R,type:V,value:q}=n;if(V==="image"){let J=R?`${R}.`:"";m.append(`${J}x`,"0"),m.append(`${J}y`,"0")}else R&&m.append(R,q)}}else{if(fb(n))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');t=r0,a=null,d=a0,g=n}return m&&d==="text/plain"&&(g=m,m=void 0),{action:a,method:t.toLowerCase(),encType:d,formData:m,body:g}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function uw(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function xk(n,e,t){let a=typeof n=="string"?new URL(n,typeof window>"u"?"server://singlefetch/":window.location.origin):n;return a.pathname==="/"?a.pathname=`_root.${t}`:e&&qd(a.pathname,e)==="/"?a.pathname=`${e.replace(/\/$/,"")}/_root.${t}`:a.pathname=`${a.pathname.replace(/\/$/,"")}.${t}`,a}async function wk(n,e){if(n.id in e)return e[n.id];try{let t=await import(n.module);return e[n.id]=t,t}catch(t){return console.error(`Error loading route module \`${n.module}\`, reloading page...`),console.error(t),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function Tk(n){return n==null?!1:n.href==null?n.rel==="preload"&&typeof n.imageSrcSet=="string"&&typeof n.imageSizes=="string":typeof n.rel=="string"&&typeof n.href=="string"}async function Sk(n,e,t){let a=await Promise.all(n.map(async d=>{let m=e.routes[d.route.id];if(m){let g=await wk(m,t);return g.links?g.links():[]}return[]}));return Ik(a.flat(1).filter(Tk).filter(d=>d.rel==="stylesheet"||d.rel==="preload").map(d=>d.rel==="stylesheet"?{...d,rel:"prefetch",as:"style"}:{...d,rel:"prefetch"}))}function rT(n,e,t,a,d,m){let g=(C,R)=>t[R]?C.route.id!==t[R].route.id:!0,c=(C,R)=>{var V;return t[R].pathname!==C.pathname||((V=t[R].route.path)==null?void 0:V.endsWith("*"))&&t[R].params["*"]!==C.params["*"]};return m==="assets"?e.filter((C,R)=>g(C,R)||c(C,R)):m==="data"?e.filter((C,R)=>{var q;let V=a.routes[C.route.id];if(!V||!V.hasLoader)return!1;if(g(C,R)||c(C,R))return!0;if(C.route.shouldRevalidate){let J=C.route.shouldRevalidate({currentUrl:new URL(d.pathname+d.search+d.hash,window.origin),currentParams:((q=t[0])==null?void 0:q.params)||{},nextUrl:new URL(n,window.origin),nextParams:C.params,defaultShouldRevalidate:!0});if(typeof J=="boolean")return J}return!0}):[]}function Ek(n,e,{includeHydrateFallback:t}={}){return Ak(n.map(a=>{let d=e.routes[a.route.id];if(!d)return[];let m=[d.module];return d.clientActionModule&&(m=m.concat(d.clientActionModule)),d.clientLoaderModule&&(m=m.concat(d.clientLoaderModule)),t&&d.hydrateFallbackModule&&(m=m.concat(d.hydrateFallbackModule)),d.imports&&(m=m.concat(d.imports)),m}).flat(1))}function Ak(n){return[...new Set(n)]}function Ck(n){let e={},t=Object.keys(n).sort();for(let a of t)e[a]=n[a];return e}function Ik(n,e){let t=new Set;return new Set(e),n.reduce((a,d)=>{let m=JSON.stringify(Ck(d));return t.has(m)||(t.add(m),a.push({key:m,link:d})),a},[])}function SA(){let n=wt.useContext(Ag);return uw(n,"You must render this element inside a <DataRouterContext.Provider> element"),n}function Pk(){let n=wt.useContext(db);return uw(n,"You must render this element inside a <DataRouterStateContext.Provider> element"),n}var cw=wt.createContext(void 0);cw.displayName="FrameworkContext";function EA(){let n=wt.useContext(cw);return uw(n,"You must render this element inside a <HydratedRouter> element"),n}function Mk(n,e){let t=wt.useContext(cw),[a,d]=wt.useState(!1),[m,g]=wt.useState(!1),{onFocus:c,onBlur:C,onMouseEnter:R,onMouseLeave:V,onTouchStart:q}=e,J=wt.useRef(null);wt.useEffect(()=>{if(n==="render"&&g(!0),n==="viewport"){let be=et=>{et.forEach(Je=>{g(Je.isIntersecting)})},Oe=new IntersectionObserver(be,{threshold:.5});return J.current&&Oe.observe(J.current),()=>{Oe.disconnect()}}},[n]),wt.useEffect(()=>{if(a){let be=setTimeout(()=>{g(!0)},100);return()=>{clearTimeout(be)}}},[a]);let Y=()=>{d(!0)},xe=()=>{d(!1),g(!1)};return t?n!=="intent"?[m,J,{}]:[m,J,{onFocus:V_(c,Y),onBlur:V_(C,xe),onMouseEnter:V_(R,Y),onMouseLeave:V_(V,xe),onTouchStart:V_(q,Y)}]:[!1,J,{}]}function V_(n,e){return t=>{n&&n(t),t.defaultPrevented||e(t)}}function Rk({page:n,...e}){let{router:t}=SA(),a=wt.useMemo(()=>fA(t.routes,n,t.basename),[t.routes,n,t.basename]);return a?wt.createElement(Lk,{page:n,matches:a,...e}):null}function kk(n){let{manifest:e,routeModules:t}=EA(),[a,d]=wt.useState([]);return wt.useEffect(()=>{let m=!1;return Sk(n,e,t).then(g=>{m||d(g)}),()=>{m=!0}},[n,e,t]),a}function Lk({page:n,matches:e,...t}){let a=am(),{manifest:d,routeModules:m}=EA(),{basename:g}=SA(),{loaderData:c,matches:C}=Pk(),R=wt.useMemo(()=>rT(n,e,C,d,a,"data"),[n,e,C,d,a]),V=wt.useMemo(()=>rT(n,e,C,d,a,"assets"),[n,e,C,d,a]),q=wt.useMemo(()=>{if(n===a.pathname+a.search+a.hash)return[];let xe=new Set,be=!1;if(e.forEach(et=>{var qe;let Je=d.routes[et.route.id];!Je||!Je.hasLoader||(!R.some(Ze=>Ze.route.id===et.route.id)&&et.route.id in c&&((qe=m[et.route.id])!=null&&qe.shouldRevalidate)||Je.hasClientLoader?be=!0:xe.add(et.route.id))}),xe.size===0)return[];let Oe=xk(n,g,"data");return be&&xe.size>0&&Oe.searchParams.set("_routes",e.filter(et=>xe.has(et.route.id)).map(et=>et.route.id).join(",")),[Oe.pathname+Oe.search]},[g,c,a,d,R,e,n,m]),J=wt.useMemo(()=>Ek(V,d),[V,d]),Y=kk(V);return wt.createElement(wt.Fragment,null,q.map(xe=>wt.createElement("link",{key:xe,rel:"prefetch",as:"fetch",href:xe,...t})),J.map(xe=>wt.createElement("link",{key:xe,rel:"modulepreload",href:xe,...t})),Y.map(({key:xe,link:be})=>wt.createElement("link",{key:xe,nonce:t.nonce,...be})))}function Dk(...n){return e=>{n.forEach(t=>{typeof t=="function"?t(e):t!=null&&(t.current=e)})}}var AA=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{AA&&(window.__reactRouterVersion="7.9.6")}catch{}function zk({basename:n,children:e,window:t}){let a=wt.useRef();a.current==null&&(a.current=xR({window:t,v5Compat:!0}));let d=a.current,[m,g]=wt.useState({action:d.action,location:d.location}),c=wt.useCallback(C=>{wt.startTransition(()=>g(C))},[g]);return wt.useLayoutEffect(()=>d.listen(c),[d,c]),wt.createElement(hk,{basename:n,children:e,location:m.location,navigationType:m.action,navigator:d})}var CA=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,IA=wt.forwardRef(function({onClick:e,discover:t="render",prefetch:a="none",relative:d,reloadDocument:m,replace:g,state:c,target:C,to:R,preventScrollReset:V,viewTransition:q,...J},Y){let{basename:xe}=wt.useContext(id),be=typeof R=="string"&&CA.test(R),Oe,et=!1;if(typeof R=="string"&&be&&(Oe=R,AA))try{let _e=new URL(window.location.href),Ae=R.startsWith("//")?new URL(_e.protocol+R):new URL(R),Me=qd(Ae.pathname,xe);Ae.origin===_e.origin&&Me!=null?R=Me+Ae.search+Ae.hash:et=!0}catch{fh(!1,`<Link to="${R}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let Je=KR(R,{relative:d}),[qe,Ze,je]=Mk(a,J),Be=Fk(R,{replace:g,state:c,target:C,preventScrollReset:V,relative:d,viewTransition:q});function de(_e){e&&e(_e),_e.defaultPrevented||Be(_e)}let ce=wt.createElement("a",{...J,...je,href:Oe||Je,onClick:et||m?e:de,ref:Dk(Y,Ze),target:C,"data-discover":!be&&t==="render"?"true":void 0});return qe&&!be?wt.createElement(wt.Fragment,null,ce,wt.createElement(Rk,{page:Je})):ce});IA.displayName="Link";var Ok=wt.forwardRef(function({"aria-current":e="page",caseSensitive:t=!1,className:a="",end:d=!1,style:m,to:g,viewTransition:c,children:C,...R},V){let q=Dy(g,{relative:R.relative}),J=am(),Y=wt.useContext(db),{navigator:xe,basename:be}=wt.useContext(id),Oe=Y!=null&&qk(q)&&c===!0,et=xe.encodeLocation?xe.encodeLocation(q).pathname:q.pathname,Je=J.pathname,qe=Y&&Y.navigation&&Y.navigation.location?Y.navigation.location.pathname:null;t||(Je=Je.toLowerCase(),qe=qe?qe.toLowerCase():null,et=et.toLowerCase()),qe&&be&&(qe=qd(qe,be)||qe);const Ze=et!=="/"&&et.endsWith("/")?et.length-1:et.length;let je=Je===et||!d&&Je.startsWith(et)&&Je.charAt(Ze)==="/",Be=qe!=null&&(qe===et||!d&&qe.startsWith(et)&&qe.charAt(et.length)==="/"),de={isActive:je,isPending:Be,isTransitioning:Oe},ce=je?e:void 0,_e;typeof a=="function"?_e=a(de):_e=[a,je?"active":null,Be?"pending":null,Oe?"transitioning":null].filter(Boolean).join(" ");let Ae=typeof m=="function"?m(de):m;return wt.createElement(IA,{...R,"aria-current":ce,className:_e,ref:V,style:Ae,to:g,viewTransition:c},typeof C=="function"?C(de):C)});Ok.displayName="NavLink";var Nk=wt.forwardRef(({discover:n="render",fetcherKey:e,navigate:t,reloadDocument:a,replace:d,state:m,method:g=r0,action:c,onSubmit:C,relative:R,preventScrollReset:V,viewTransition:q,...J},Y)=>{let xe=jk(),be=$k(c,{relative:R}),Oe=g.toLowerCase()==="get"?"get":"post",et=typeof c=="string"&&CA.test(c),Je=qe=>{if(C&&C(qe),qe.defaultPrevented)return;qe.preventDefault();let Ze=qe.nativeEvent.submitter,je=(Ze==null?void 0:Ze.getAttribute("formmethod"))||g;xe(Ze||qe.currentTarget,{fetcherKey:e,method:je,navigate:t,replace:d,state:m,relative:R,preventScrollReset:V,viewTransition:q})};return wt.createElement("form",{ref:Y,method:Oe,action:be,onSubmit:a?C:Je,...J,"data-discover":!et&&n==="render"?"true":void 0})});Nk.displayName="Form";function Bk(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function PA(n){let e=wt.useContext(Ag);return Fa(e,Bk(n)),e}function Fk(n,{target:e,replace:t,state:a,preventScrollReset:d,relative:m,viewTransition:g}={}){let c=XR(),C=am(),R=Dy(n,{relative:m});return wt.useCallback(V=>{if(_k(V,e)){V.preventDefault();let q=t!==void 0?t:uy(C)===uy(R);c(n,{replace:q,state:a,preventScrollReset:d,relative:m,viewTransition:g})}},[C,c,R,t,a,e,n,d,m,g])}var Vk=0,Uk=()=>`__${String(++Vk)}__`;function jk(){let{router:n}=PA("useSubmit"),{basename:e}=wt.useContext(id),t=ok();return wt.useCallback(async(a,d={})=>{let{action:m,method:g,encType:c,formData:C,body:R}=bk(a,e);if(d.navigate===!1){let V=d.fetcherKey||Uk();await n.fetch(V,t,d.action||m,{preventScrollReset:d.preventScrollReset,formData:C,body:R,formMethod:d.method||g,formEncType:d.encType||c,flushSync:d.flushSync})}else await n.navigate(d.action||m,{preventScrollReset:d.preventScrollReset,formData:C,body:R,formMethod:d.method||g,formEncType:d.encType||c,replace:d.replace,state:d.state,fromRouteId:t,flushSync:d.flushSync,viewTransition:d.viewTransition})},[n,e,t])}function $k(n,{relative:e}={}){let{basename:t}=wt.useContext(id),a=wt.useContext(Yd);Fa(a,"useFormAction must be used inside a RouteContext");let[d]=a.matches.slice(-1),m={...Dy(n||".",{relative:e})},g=am();if(n==null){m.search=g.search;let c=new URLSearchParams(m.search),C=c.getAll("index");if(C.some(V=>V==="")){c.delete("index"),C.filter(q=>q).forEach(q=>c.append("index",q));let V=c.toString();m.search=V?`?${V}`:""}}return(!n||n===".")&&d.route.index&&(m.search=m.search?m.search.replace(/^\?/,"?index&"):"?index"),t!=="/"&&(m.pathname=m.pathname==="/"?t:Vd([t,m.pathname])),uy(m)}function qk(n,{relative:e}={}){let t=wt.useContext(vA);Fa(t!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:a}=PA("useViewTransitionState"),d=Dy(n,{relative:e});if(!t.isTransitioning)return!1;let m=qd(t.currentLocation.pathname,a)||t.currentLocation.pathname,g=qd(t.nextLocation.pathname,a)||t.nextLocation.pathname;return L0(d.pathname,g)!=null||L0(d.pathname,m)!=null}const MA=()=>{const[n,e]=wt.useState(!1),t=()=>e(!n);return Ee.jsxs(Ee.Fragment,{children:[Ee.jsx("div",{className:"scroll-indicator"}),Ee.jsx("nav",{children:Ee.jsxs("div",{className:"nav-container",children:[Ee.jsxs("a",{href:"./#home",className:"logo",children:["Red",Ee.jsx("span",{className:"highlight",children:" Report "})]}),Ee.jsx("div",{className:"hamburger",onClick:t,children:Ee.jsx("span",{className:"hamburger-icon",children:""})}),Ee.jsxs("ul",{className:`nav-links${n?" open":""}`,children:[Ee.jsx("li",{children:Ee.jsx("a",{href:"./#home",children:"Home"})}),Ee.jsx("li",{children:Ee.jsx("a",{href:"./#mission",children:"Mission"})}),Ee.jsx("li",{children:Ee.jsx("a",{href:"./#timeline",children:"Timeline"})}),Ee.jsx("li",{children:Ee.jsx("a",{href:"/report",className:"report-btn",children:"REPORT"})}),Ee.jsx("li",{children:Ee.jsx("a",{href:"/map",className:"map-btn",children:"MAP"})})]})]})})]})},Gk=()=>Ee.jsx("section",{id:"home",className:"hero",children:Ee.jsxs("div",{className:"hero-container",children:[Ee.jsxs("div",{className:"hero-content",children:[Ee.jsxs("h1",{children:[Ee.jsx("span",{className:"highlight",children:"Student voices"}),Ee.jsx("br",{}),"SAFER CAMPUS"]}),Ee.jsx("p",{children:"Anonymous reporting tool built by and for students in the Notre Dame Tricampus community. Empowering students to share experiences without fear while creating meaningful change."}),Ee.jsx("a",{href:"#mission",className:"cta-button",children:"Learn more"})]}),Ee.jsx("div",{className:"hero-visual",children:Ee.jsx("div",{className:"campus-circle",children:Ee.jsx("img",{src:"/abstract.svg",alt:"Logo",className:"campus-image"})})})]})}),Hk=()=>Ee.jsxs("section",{id:"mission",className:"content-section",children:[Ee.jsxs("div",{className:"section-header",children:[Ee.jsxs("h2",{children:["Our ",Ee.jsx("span",{className:"highlight",children:"Mission"})]}),Ee.jsxs("p",{children:["Existing reporting systems are intimidating to the point nothing ever gets reported. ",Ee.jsx("span",{className:"highlight",children:"RedReport"})," makes everything entirely anonymous focusing on your safety."]})]}),Ee.jsxs("div",{className:"mission-grid",children:[Ee.jsxs("div",{className:"mission-card",children:[Ee.jsx("h3",{children:"Anonymous & Safe"}),Ee.jsx("p",{children:"Report experiences without fear of retaliation. We never collect any personal identifiers, our goal is to assist you when you are still not comfortable with a full report."})]}),Ee.jsxs("div",{className:"mission-card",children:[Ee.jsx("h3",{children:"Campus Wide Access to Data"}),Ee.jsx("p",{children:"We allow anyone on campus see current campus trends. No filter, we show the reality; the good, the bad, and the ugly."})]}),Ee.jsxs("div",{className:"mission-card",children:[Ee.jsx("h3",{children:"Working to prevent"}),Ee.jsx("p",{children:"We use our data to take action and prevent future cases. We wish our product didn't need to exist, so that's the goal we are working towards."})]})]}),Ee.jsxs("div",{className:"stats-grid",children:[Ee.jsxs("div",{className:"stat-card",children:[Ee.jsx("span",{className:"stat-number",children:"100%"}),Ee.jsx("span",{className:"stat-label",children:"Anonymous"})]}),Ee.jsxs("div",{className:"stat-card",children:[Ee.jsx("span",{className:"stat-number",children:"24/7"}),Ee.jsx("span",{className:"stat-label",children:"Available"})]}),Ee.jsxs("div",{className:"stat-card",children:[Ee.jsx("span",{className:"stat-number",children:"3"}),Ee.jsx("span",{className:"stat-label",children:"Campuses"})]}),Ee.jsxs("div",{className:"stat-card",children:[Ee.jsx("span",{className:"stat-number",children:""}),Ee.jsx("span",{className:"stat-label",children:"Impact"})]})]})]}),Zk=()=>Ee.jsxs("section",{id:"timeline",className:"content-section",children:[Ee.jsxs("div",{className:"section-header",children:[Ee.jsxs("h2",{children:["Our ",Ee.jsx("span",{className:"highlight",children:"Timeline"})]}),Ee.jsx("p",{children:"See how RedReport is evolving to better serve the Notre Dame Tricampus community"})]}),Ee.jsxs("div",{className:"timeline",children:[Ee.jsxs("div",{className:"timeline-item",children:[Ee.jsx("div",{className:"timeline-dot"}),Ee.jsxs("div",{className:"timeline-content",children:[Ee.jsx("h3",{children:"Phase 1: Idea phase"}),Ee.jsx("p",{children:"RedReport started coming to life in notes rough prototypes and small user tests."})]})]}),Ee.jsxs("div",{className:"timeline-item",children:[Ee.jsx("div",{className:"timeline-dot"}),Ee.jsxs("div",{className:"timeline-content",children:[Ee.jsx("h3",{children:"Phase 2: Research and Proposal"}),Ee.jsxs("p",{children:["Wrote several reports backed by in depth research receiving recognition"," ",Ee.jsx("a",{href:"https://library-research-award.library.nd.edu/2025.html",children:"Hesburgh Libraries"}),"."]})]})]}),Ee.jsxs("div",{className:"timeline-item",children:[Ee.jsx("div",{className:"timeline-dot"}),Ee.jsxs("div",{className:"timeline-content current",children:[Ee.jsx("h3",{className:"highlight",children:"Phase 3: Launch"}),Ee.jsx("p",{className:"highlight",children:"Forming a small team to start making actual change across campus. Continously updating our system to get stuff done."})]})]}),Ee.jsxs("div",{className:"timeline-item",children:[Ee.jsx("div",{className:"timeline-dot"}),Ee.jsxs("div",{className:"timeline-content",children:[Ee.jsx("h3",{children:"Phase 4: Analyze Campus Behavior & Take Action"}),Ee.jsx("p",{children:"Prepare reports, establish communication with dorms, and share insights on specific campus trends with the community."})]})]}),Ee.jsxs("div",{className:"timeline-item",children:[Ee.jsx("div",{className:"timeline-dot"}),Ee.jsxs("div",{className:"timeline-content",children:[Ee.jsx("h3",{children:"Phase 5: Expansion"}),Ee.jsx("p",{children:"Transform RedReport into a crowdsourced tool as a universal reporting system for included campus, offices ad residencial areas. Allowing individuals to review a community's in addition to their offerings."})]})]})]})]});function Wk(){return Ee.jsx(Ee.Fragment,{children:Ee.jsxs("div",{className:"",children:[Ee.jsx("div",{}),Ee.jsx("div",{})]})})}const aT=()=>(wt.useEffect(()=>{const n=()=>{const m=window.pageYOffset,g=document.body.scrollHeight-window.innerHeight,c=m/g*100,C=document.querySelector(".scroll-indicator");C&&(C.style.width=c+"%")},e=()=>{document.querySelectorAll('a[href^="#"]').forEach(m=>{m.addEventListener("click",function(g){g.preventDefault();const c=document.querySelector(this.getAttribute("href"));c&&c.scrollIntoView({behavior:"smooth",block:"start"})})})},t=()=>{const m=new IntersectionObserver(g=>{g.forEach(c=>{c.isIntersecting&&c.target.classList.add("visible")})},{threshold:.1});document.querySelectorAll(".content-section").forEach(g=>{m.observe(g)})},a=()=>{const m=document.querySelector("nav");m&&window.addEventListener("scroll",()=>{window.scrollY>100?m.style.background="rgba(255, 255, 255)":m.style.background="rgba(255, 255, 255, 0.4)"})};return e(),t(),a(),window.addEventListener("scroll",n),n(),(()=>{document.querySelectorAll(".stat-card").forEach(m=>{m.addEventListener("mouseenter",()=>{m.style.transform="scale(1.05) rotate(2deg)"}),m.addEventListener("mouseleave",()=>{m.style.transform="scale(1) rotate(0deg)"})})})(),()=>{window.removeEventListener("scroll",n)}},[]),Ee.jsxs("div",{className:"landing-page",children:[Ee.jsx(MA,{}),Ee.jsx(Gk,{}),Ee.jsx(Hk,{}),Ee.jsx(Wk,{}),Ee.jsx(Zk,{})]})),Kk=()=>{};var sT={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RA=function(n){const e=[];let t=0;for(let a=0;a<n.length;a++){let d=n.charCodeAt(a);d<128?e[t++]=d:d<2048?(e[t++]=d>>6|192,e[t++]=d&63|128):(d&64512)===55296&&a+1<n.length&&(n.charCodeAt(a+1)&64512)===56320?(d=65536+((d&1023)<<10)+(n.charCodeAt(++a)&1023),e[t++]=d>>18|240,e[t++]=d>>12&63|128,e[t++]=d>>6&63|128,e[t++]=d&63|128):(e[t++]=d>>12|224,e[t++]=d>>6&63|128,e[t++]=d&63|128)}return e},Xk=function(n){const e=[];let t=0,a=0;for(;t<n.length;){const d=n[t++];if(d<128)e[a++]=String.fromCharCode(d);else if(d>191&&d<224){const m=n[t++];e[a++]=String.fromCharCode((d&31)<<6|m&63)}else if(d>239&&d<365){const m=n[t++],g=n[t++],c=n[t++],C=((d&7)<<18|(m&63)<<12|(g&63)<<6|c&63)-65536;e[a++]=String.fromCharCode(55296+(C>>10)),e[a++]=String.fromCharCode(56320+(C&1023))}else{const m=n[t++],g=n[t++];e[a++]=String.fromCharCode((d&15)<<12|(m&63)<<6|g&63)}}return e.join("")},hw={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,a=[];for(let d=0;d<n.length;d+=3){const m=n[d],g=d+1<n.length,c=g?n[d+1]:0,C=d+2<n.length,R=C?n[d+2]:0,V=m>>2,q=(m&3)<<4|c>>4;let J=(c&15)<<2|R>>6,Y=R&63;C||(Y=64,g||(J=64)),a.push(t[V],t[q],t[J],t[Y])}return a.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(RA(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):Xk(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,a=[];for(let d=0;d<n.length;){const m=t[n.charAt(d++)],c=d<n.length?t[n.charAt(d)]:0;++d;const R=d<n.length?t[n.charAt(d)]:64;++d;const q=d<n.length?t[n.charAt(d)]:64;if(++d,m==null||c==null||R==null||q==null)throw new Yk;const J=m<<2|c>>4;if(a.push(J),R!==64){const Y=c<<4&240|R>>2;if(a.push(Y),q!==64){const xe=R<<6&192|q;a.push(xe)}}}return a},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class Yk extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Qk=function(n){const e=RA(n);return hw.encodeByteArray(e,!0)},D0=function(n){return Qk(n).replace(/\./g,"")},kA=function(n){try{return hw.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function LA(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jk=()=>LA().__FIREBASE_DEFAULTS__,eL=()=>{if(typeof process>"u"||typeof sT>"u")return;const n=sT.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},tL=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&kA(n[1]);return e&&JSON.parse(e)},pb=()=>{try{return Kk()||Jk()||eL()||tL()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},DA=n=>{var e,t;return(t=(e=pb())==null?void 0:e.emulatorHosts)==null?void 0:t[n]},nL=n=>{const e=DA(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const a=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),a]:[e.substring(0,t),a]},zA=()=>{var n;return(n=pb())==null?void 0:n.config},OA=n=>{var e;return(e=pb())==null?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cy{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,a)=>{t?this.reject(t):this.resolve(a),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,a))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cg(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function NA(n){return(await fetch(n,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iL(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},a=e||"demo-project",d=n.iat||0,m=n.sub||n.user_id;if(!m)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const g={iss:`https://securetoken.google.com/${a}`,aud:a,iat:d,exp:d+3600,auth_time:d,sub:m,user_id:m,firebase:{sign_in_provider:"custom",identities:{}},...n};return[D0(JSON.stringify(t)),D0(JSON.stringify(g)),""].join(".")}const Q_={};function rL(){const n={prod:[],emulator:[]};for(const e of Object.keys(Q_))Q_[e]?n.emulator.push(e):n.prod.push(e);return n}function aL(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let oT=!1;function BA(n,e){if(typeof window>"u"||typeof document>"u"||!Cg(window.location.host)||Q_[n]===e||Q_[n]||oT)return;Q_[n]=e;function t(J){return`__firebase__banner__${J}`}const a="__firebase__banner",m=rL().prod.length>0;function g(){const J=document.getElementById(a);J&&J.remove()}function c(J){J.style.display="flex",J.style.background="#7faaf0",J.style.position="fixed",J.style.bottom="5px",J.style.left="5px",J.style.padding=".5em",J.style.borderRadius="5px",J.style.alignItems="center"}function C(J,Y){J.setAttribute("width","24"),J.setAttribute("id",Y),J.setAttribute("height","24"),J.setAttribute("viewBox","0 0 24 24"),J.setAttribute("fill","none"),J.style.marginLeft="-6px"}function R(){const J=document.createElement("span");return J.style.cursor="pointer",J.style.marginLeft="16px",J.style.fontSize="24px",J.innerHTML=" &times;",J.onclick=()=>{oT=!0,g()},J}function V(J,Y){J.setAttribute("id",Y),J.innerText="Learn more",J.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",J.setAttribute("target","__blank"),J.style.paddingLeft="5px",J.style.textDecoration="underline"}function q(){const J=aL(a),Y=t("text"),xe=document.getElementById(Y)||document.createElement("span"),be=t("learnmore"),Oe=document.getElementById(be)||document.createElement("a"),et=t("preprendIcon"),Je=document.getElementById(et)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(J.created){const qe=J.element;c(qe),V(Oe,be);const Ze=R();C(Je,et),qe.append(Je,xe,Oe,Ze),document.body.appendChild(qe)}m?(xe.innerText="Preview backend disconnected.",Je.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(Je.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,xe.innerText="Preview backend running in this workspace."),xe.setAttribute("id",Y)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",q):q()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kl(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function sL(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(kl())}function oL(){var e;const n=(e=pb())==null?void 0:e.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function lL(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function FA(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function uL(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function cL(){const n=kl();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function hL(){return!oL()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function mb(){try{return typeof indexedDB=="object"}catch{return!1}}function VA(){return new Promise((n,e)=>{try{let t=!0;const a="validate-browser-context-for-indexeddb-analytics-module",d=self.indexedDB.open(a);d.onsuccess=()=>{d.result.close(),t||self.indexedDB.deleteDatabase(a),n(!0)},d.onupgradeneeded=()=>{t=!1},d.onerror=()=>{var m;e(((m=d.error)==null?void 0:m.message)||"")}}catch(t){e(t)}})}function dL(){return!(typeof navigator>"u"||!navigator.cookieEnabled)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fL="FirebaseError";class mh extends Error{constructor(e,t,a){super(t),this.code=e,this.customData=a,this.name=fL,Object.setPrototypeOf(this,mh.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Yf.prototype.create)}}class Yf{constructor(e,t,a){this.service=e,this.serviceName=t,this.errors=a}create(e,...t){const a=t[0]||{},d=`${this.service}/${e}`,m=this.errors[e],g=m?pL(m,a):"Error",c=`${this.serviceName}: ${g} (${d}).`;return new mh(d,c,a)}}function pL(n,e){return n.replace(mL,(t,a)=>{const d=e[a];return d!=null?String(d):`<${a}?>`})}const mL=/\{\$([^}]+)}/g;function gL(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function qf(n,e){if(n===e)return!0;const t=Object.keys(n),a=Object.keys(e);for(const d of t){if(!a.includes(d))return!1;const m=n[d],g=e[d];if(lT(m)&&lT(g)){if(!qf(m,g))return!1}else if(m!==g)return!1}for(const d of a)if(!t.includes(d))return!1;return!0}function lT(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zy(n){const e=[];for(const[t,a]of Object.entries(n))Array.isArray(a)?a.forEach(d=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(d))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(a));return e.length?"&"+e.join("&"):""}function _L(n,e){const t=new yL(n,e);return t.subscribe.bind(t)}class yL{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(a=>{this.error(a)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,a){let d;if(e===void 0&&t===void 0&&a===void 0)throw new Error("Missing Observer.");vL(e,["next","error","complete"])?d=e:d={next:e,error:t,complete:a},d.next===void 0&&(d.next=xx),d.error===void 0&&(d.error=xx),d.complete===void 0&&(d.complete=xx);const m=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?d.error(this.finalError):d.complete()}catch{}}),this.observers.push(d),m}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(a){typeof console<"u"&&console.error&&console.error(a)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function vL(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function xx(){}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bL=1e3,xL=2,wL=14400*1e3,TL=.5;function i1(n,e=bL,t=xL){const a=e*Math.pow(t,n),d=Math.round(TL*a*(Math.random()-.5)*2);return Math.min(wL,a+d)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ll(n){return n&&n._delegate?n._delegate:n}class Gu{constructor(e,t,a){this.name=e,this.instanceFactory=t,this.type=a,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dp="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SL{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const a=new cy;if(this.instancesDeferred.set(t,a),this.isInitialized(t)||this.shouldAutoInitialize())try{const d=this.getOrInitializeService({instanceIdentifier:t});d&&a.resolve(d)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),a=(e==null?void 0:e.optional)??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(d){if(a)return null;throw d}else{if(a)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(AL(e))try{this.getOrInitializeService({instanceIdentifier:Dp})}catch{}for(const[t,a]of this.instancesDeferred.entries()){const d=this.normalizeInstanceIdentifier(t);try{const m=this.getOrInitializeService({instanceIdentifier:d});a.resolve(m)}catch{}}}}clearInstance(e=Dp){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Dp){return this.instances.has(e)}getOptions(e=Dp){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,a=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(a))throw Error(`${this.name}(${a}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const d=this.getOrInitializeService({instanceIdentifier:a,options:t});for(const[m,g]of this.instancesDeferred.entries()){const c=this.normalizeInstanceIdentifier(m);a===c&&g.resolve(d)}return d}onInit(e,t){const a=this.normalizeInstanceIdentifier(t),d=this.onInitCallbacks.get(a)??new Set;d.add(e),this.onInitCallbacks.set(a,d);const m=this.instances.get(a);return m&&e(m,a),()=>{d.delete(e)}}invokeOnInitCallbacks(e,t){const a=this.onInitCallbacks.get(t);if(a)for(const d of a)try{d(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let a=this.instances.get(e);if(!a&&this.component&&(a=this.component.instanceFactory(this.container,{instanceIdentifier:EL(e),options:t}),this.instances.set(e,a),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(a,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,a)}catch{}return a||null}normalizeInstanceIdentifier(e=Dp){return this.component?this.component.multipleInstances?e:Dp:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function EL(n){return n===Dp?void 0:n}function AL(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CL{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new SL(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Oi;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(Oi||(Oi={}));const IL={debug:Oi.DEBUG,verbose:Oi.VERBOSE,info:Oi.INFO,warn:Oi.WARN,error:Oi.ERROR,silent:Oi.SILENT},PL=Oi.INFO,ML={[Oi.DEBUG]:"log",[Oi.VERBOSE]:"log",[Oi.INFO]:"info",[Oi.WARN]:"warn",[Oi.ERROR]:"error"},RL=(n,e,...t)=>{if(e<n.logLevel)return;const a=new Date().toISOString(),d=ML[e];if(d)console[d](`[${a}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Oy{constructor(e){this.name=e,this._logLevel=PL,this._logHandler=RL,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Oi))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?IL[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Oi.DEBUG,...e),this._logHandler(this,Oi.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Oi.VERBOSE,...e),this._logHandler(this,Oi.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Oi.INFO,...e),this._logHandler(this,Oi.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Oi.WARN,...e),this._logHandler(this,Oi.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Oi.ERROR,...e),this._logHandler(this,Oi.ERROR,...e)}}const kL=(n,e)=>e.some(t=>n instanceof t);let uT,cT;function LL(){return uT||(uT=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function DL(){return cT||(cT=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const UA=new WeakMap,r1=new WeakMap,jA=new WeakMap,wx=new WeakMap,dw=new WeakMap;function zL(n){const e=new Promise((t,a)=>{const d=()=>{n.removeEventListener("success",m),n.removeEventListener("error",g)},m=()=>{t(Bf(n.result)),d()},g=()=>{a(n.error),d()};n.addEventListener("success",m),n.addEventListener("error",g)});return e.then(t=>{t instanceof IDBCursor&&UA.set(t,n)}).catch(()=>{}),dw.set(e,n),e}function OL(n){if(r1.has(n))return;const e=new Promise((t,a)=>{const d=()=>{n.removeEventListener("complete",m),n.removeEventListener("error",g),n.removeEventListener("abort",g)},m=()=>{t(),d()},g=()=>{a(n.error||new DOMException("AbortError","AbortError")),d()};n.addEventListener("complete",m),n.addEventListener("error",g),n.addEventListener("abort",g)});r1.set(n,e)}let a1={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return r1.get(n);if(e==="objectStoreNames")return n.objectStoreNames||jA.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Bf(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function NL(n){a1=n(a1)}function BL(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const a=n.call(Tx(this),e,...t);return jA.set(a,e.sort?e.sort():[e]),Bf(a)}:DL().includes(n)?function(...e){return n.apply(Tx(this),e),Bf(UA.get(this))}:function(...e){return Bf(n.apply(Tx(this),e))}}function FL(n){return typeof n=="function"?BL(n):(n instanceof IDBTransaction&&OL(n),kL(n,LL())?new Proxy(n,a1):n)}function Bf(n){if(n instanceof IDBRequest)return zL(n);if(wx.has(n))return wx.get(n);const e=FL(n);return e!==n&&(wx.set(n,e),dw.set(e,n)),e}const Tx=n=>dw.get(n);function $A(n,e,{blocked:t,upgrade:a,blocking:d,terminated:m}={}){const g=indexedDB.open(n,e),c=Bf(g);return a&&g.addEventListener("upgradeneeded",C=>{a(Bf(g.result),C.oldVersion,C.newVersion,Bf(g.transaction),C)}),t&&g.addEventListener("blocked",C=>t(C.oldVersion,C.newVersion,C)),c.then(C=>{m&&C.addEventListener("close",()=>m()),d&&C.addEventListener("versionchange",R=>d(R.oldVersion,R.newVersion,R))}).catch(()=>{}),c}const VL=["get","getKey","getAll","getAllKeys","count"],UL=["put","add","delete","clear"],Sx=new Map;function hT(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(Sx.get(e))return Sx.get(e);const t=e.replace(/FromIndex$/,""),a=e!==t,d=UL.includes(t);if(!(t in(a?IDBIndex:IDBObjectStore).prototype)||!(d||VL.includes(t)))return;const m=async function(g,...c){const C=this.transaction(g,d?"readwrite":"readonly");let R=C.store;return a&&(R=R.index(c.shift())),(await Promise.all([R[t](...c),d&&C.done]))[0]};return Sx.set(e,m),m}NL(n=>({...n,get:(e,t,a)=>hT(e,t)||n.get(e,t,a),has:(e,t)=>!!hT(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jL{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if($L(t)){const a=t.getImmediate();return`${a.library}/${a.version}`}else return null}).filter(t=>t).join(" ")}}function $L(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const s1="@firebase/app",dT="0.14.6";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gd=new Oy("@firebase/app"),qL="@firebase/app-compat",GL="@firebase/analytics-compat",HL="@firebase/analytics",ZL="@firebase/app-check-compat",WL="@firebase/app-check",KL="@firebase/auth",XL="@firebase/auth-compat",YL="@firebase/database",QL="@firebase/data-connect",JL="@firebase/database-compat",eD="@firebase/functions",tD="@firebase/functions-compat",nD="@firebase/installations",iD="@firebase/installations-compat",rD="@firebase/messaging",aD="@firebase/messaging-compat",sD="@firebase/performance",oD="@firebase/performance-compat",lD="@firebase/remote-config",uD="@firebase/remote-config-compat",cD="@firebase/storage",hD="@firebase/storage-compat",dD="@firebase/firestore",fD="@firebase/ai",pD="@firebase/firestore-compat",mD="firebase",gD="12.6.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const o1="[DEFAULT]",_D={[s1]:"fire-core",[qL]:"fire-core-compat",[HL]:"fire-analytics",[GL]:"fire-analytics-compat",[WL]:"fire-app-check",[ZL]:"fire-app-check-compat",[KL]:"fire-auth",[XL]:"fire-auth-compat",[YL]:"fire-rtdb",[QL]:"fire-data-connect",[JL]:"fire-rtdb-compat",[eD]:"fire-fn",[tD]:"fire-fn-compat",[nD]:"fire-iid",[iD]:"fire-iid-compat",[rD]:"fire-fcm",[aD]:"fire-fcm-compat",[sD]:"fire-perf",[oD]:"fire-perf-compat",[lD]:"fire-rc",[uD]:"fire-rc-compat",[cD]:"fire-gcs",[hD]:"fire-gcs-compat",[dD]:"fire-fst",[pD]:"fire-fst-compat",[fD]:"fire-vertex","fire-js":"fire-js",[mD]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const z0=new Map,yD=new Map,l1=new Map;function fT(n,e){try{n.container.addComponent(e)}catch(t){Gd.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function Bc(n){const e=n.name;if(l1.has(e))return Gd.debug(`There were multiple attempts to register component ${e}.`),!1;l1.set(e,n);for(const t of z0.values())fT(t,n);for(const t of yD.values())fT(t,n);return!0}function Qd(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function qh(n){return n==null?!1:n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vD={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Ff=new Yf("app","Firebase",vD);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bD{constructor(e,t,a){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=a,this.container.addComponent(new Gu("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Ff.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ig=gD;function qA(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const a={name:o1,automaticDataCollectionEnabled:!0,...e},d=a.name;if(typeof d!="string"||!d)throw Ff.create("bad-app-name",{appName:String(d)});if(t||(t=zA()),!t)throw Ff.create("no-options");const m=z0.get(d);if(m){if(qf(t,m.options)&&qf(a,m.config))return m;throw Ff.create("duplicate-app",{appName:d})}const g=new CL(d);for(const C of l1.values())g.addComponent(C);const c=new bD(t,a,g);return z0.set(d,c),c}function gb(n=o1){const e=z0.get(n);if(!e&&n===o1&&zA())return qA();if(!e)throw Ff.create("no-app",{appName:n});return e}function $u(n,e,t){let a=_D[n]??n;t&&(a+=`-${t}`);const d=a.match(/\s|\//),m=e.match(/\s|\//);if(d||m){const g=[`Unable to register library "${a}" with version "${e}":`];d&&g.push(`library name "${a}" contains illegal characters (whitespace or "/")`),d&&m&&g.push("and"),m&&g.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Gd.warn(g.join(" "));return}Bc(new Gu(`${a}-version`,()=>({library:a,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xD="firebase-heartbeat-database",wD=1,hy="firebase-heartbeat-store";let Ex=null;function GA(){return Ex||(Ex=$A(xD,wD,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(hy)}catch(t){console.warn(t)}}}}).catch(n=>{throw Ff.create("idb-open",{originalErrorMessage:n.message})})),Ex}async function TD(n){try{const t=(await GA()).transaction(hy),a=await t.objectStore(hy).get(HA(n));return await t.done,a}catch(e){if(e instanceof mh)Gd.warn(e.message);else{const t=Ff.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Gd.warn(t.message)}}}async function pT(n,e){try{const a=(await GA()).transaction(hy,"readwrite");await a.objectStore(hy).put(e,HA(n)),await a.done}catch(t){if(t instanceof mh)Gd.warn(t.message);else{const a=Ff.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});Gd.warn(a.message)}}}function HA(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SD=1024,ED=30;class AD{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new ID(t),this._heartbeatsCachePromise=this._storage.read().then(a=>(this._heartbeatsCache=a,a))}async triggerHeartbeat(){var e,t;try{const d=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),m=mT();if(((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)==null?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===m||this._heartbeatsCache.heartbeats.some(g=>g.date===m))return;if(this._heartbeatsCache.heartbeats.push({date:m,agent:d}),this._heartbeatsCache.heartbeats.length>ED){const g=PD(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(g,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(a){Gd.warn(a)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=mT(),{heartbeatsToSend:a,unsentEntries:d}=CD(this._heartbeatsCache.heartbeats),m=D0(JSON.stringify({version:2,heartbeats:a}));return this._heartbeatsCache.lastSentHeartbeatDate=t,d.length>0?(this._heartbeatsCache.heartbeats=d,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),m}catch(t){return Gd.warn(t),""}}}function mT(){return new Date().toISOString().substring(0,10)}function CD(n,e=SD){const t=[];let a=n.slice();for(const d of n){const m=t.find(g=>g.agent===d.agent);if(m){if(m.dates.push(d.date),gT(t)>e){m.dates.pop();break}}else if(t.push({agent:d.agent,dates:[d.date]}),gT(t)>e){t.pop();break}a=a.slice(1)}return{heartbeatsToSend:t,unsentEntries:a}}class ID{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return mb()?VA().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await TD(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const a=await this.read();return pT(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??a.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const a=await this.read();return pT(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??a.lastSentHeartbeatDate,heartbeats:[...a.heartbeats,...e.heartbeats]})}else return}}function gT(n){return D0(JSON.stringify({version:2,heartbeats:n})).length}function PD(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let a=1;a<n.length;a++)n[a].date<t&&(t=n[a].date,e=a);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function MD(n){Bc(new Gu("platform-logger",e=>new jL(e),"PRIVATE")),Bc(new Gu("heartbeat",e=>new AD(e),"PRIVATE")),$u(s1,dT,n),$u(s1,dT,"esm2020"),$u("fire-js","")}MD("");var _T=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Vf,ZA;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(de,ce){function _e(){}_e.prototype=ce.prototype,de.F=ce.prototype,de.prototype=new _e,de.prototype.constructor=de,de.D=function(Ae,Me,Ge){for(var Re=Array(arguments.length-2),Pn=2;Pn<arguments.length;Pn++)Re[Pn-2]=arguments[Pn];return ce.prototype[Me].apply(Ae,Re)}}function t(){this.blockSize=-1}function a(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(a,t),a.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function d(de,ce,_e){_e||(_e=0);const Ae=Array(16);if(typeof ce=="string")for(var Me=0;Me<16;++Me)Ae[Me]=ce.charCodeAt(_e++)|ce.charCodeAt(_e++)<<8|ce.charCodeAt(_e++)<<16|ce.charCodeAt(_e++)<<24;else for(Me=0;Me<16;++Me)Ae[Me]=ce[_e++]|ce[_e++]<<8|ce[_e++]<<16|ce[_e++]<<24;ce=de.g[0],_e=de.g[1],Me=de.g[2];let Ge=de.g[3],Re;Re=ce+(Ge^_e&(Me^Ge))+Ae[0]+3614090360&4294967295,ce=_e+(Re<<7&4294967295|Re>>>25),Re=Ge+(Me^ce&(_e^Me))+Ae[1]+3905402710&4294967295,Ge=ce+(Re<<12&4294967295|Re>>>20),Re=Me+(_e^Ge&(ce^_e))+Ae[2]+606105819&4294967295,Me=Ge+(Re<<17&4294967295|Re>>>15),Re=_e+(ce^Me&(Ge^ce))+Ae[3]+3250441966&4294967295,_e=Me+(Re<<22&4294967295|Re>>>10),Re=ce+(Ge^_e&(Me^Ge))+Ae[4]+4118548399&4294967295,ce=_e+(Re<<7&4294967295|Re>>>25),Re=Ge+(Me^ce&(_e^Me))+Ae[5]+1200080426&4294967295,Ge=ce+(Re<<12&4294967295|Re>>>20),Re=Me+(_e^Ge&(ce^_e))+Ae[6]+2821735955&4294967295,Me=Ge+(Re<<17&4294967295|Re>>>15),Re=_e+(ce^Me&(Ge^ce))+Ae[7]+4249261313&4294967295,_e=Me+(Re<<22&4294967295|Re>>>10),Re=ce+(Ge^_e&(Me^Ge))+Ae[8]+1770035416&4294967295,ce=_e+(Re<<7&4294967295|Re>>>25),Re=Ge+(Me^ce&(_e^Me))+Ae[9]+2336552879&4294967295,Ge=ce+(Re<<12&4294967295|Re>>>20),Re=Me+(_e^Ge&(ce^_e))+Ae[10]+4294925233&4294967295,Me=Ge+(Re<<17&4294967295|Re>>>15),Re=_e+(ce^Me&(Ge^ce))+Ae[11]+2304563134&4294967295,_e=Me+(Re<<22&4294967295|Re>>>10),Re=ce+(Ge^_e&(Me^Ge))+Ae[12]+1804603682&4294967295,ce=_e+(Re<<7&4294967295|Re>>>25),Re=Ge+(Me^ce&(_e^Me))+Ae[13]+4254626195&4294967295,Ge=ce+(Re<<12&4294967295|Re>>>20),Re=Me+(_e^Ge&(ce^_e))+Ae[14]+2792965006&4294967295,Me=Ge+(Re<<17&4294967295|Re>>>15),Re=_e+(ce^Me&(Ge^ce))+Ae[15]+1236535329&4294967295,_e=Me+(Re<<22&4294967295|Re>>>10),Re=ce+(Me^Ge&(_e^Me))+Ae[1]+4129170786&4294967295,ce=_e+(Re<<5&4294967295|Re>>>27),Re=Ge+(_e^Me&(ce^_e))+Ae[6]+3225465664&4294967295,Ge=ce+(Re<<9&4294967295|Re>>>23),Re=Me+(ce^_e&(Ge^ce))+Ae[11]+643717713&4294967295,Me=Ge+(Re<<14&4294967295|Re>>>18),Re=_e+(Ge^ce&(Me^Ge))+Ae[0]+3921069994&4294967295,_e=Me+(Re<<20&4294967295|Re>>>12),Re=ce+(Me^Ge&(_e^Me))+Ae[5]+3593408605&4294967295,ce=_e+(Re<<5&4294967295|Re>>>27),Re=Ge+(_e^Me&(ce^_e))+Ae[10]+38016083&4294967295,Ge=ce+(Re<<9&4294967295|Re>>>23),Re=Me+(ce^_e&(Ge^ce))+Ae[15]+3634488961&4294967295,Me=Ge+(Re<<14&4294967295|Re>>>18),Re=_e+(Ge^ce&(Me^Ge))+Ae[4]+3889429448&4294967295,_e=Me+(Re<<20&4294967295|Re>>>12),Re=ce+(Me^Ge&(_e^Me))+Ae[9]+568446438&4294967295,ce=_e+(Re<<5&4294967295|Re>>>27),Re=Ge+(_e^Me&(ce^_e))+Ae[14]+3275163606&4294967295,Ge=ce+(Re<<9&4294967295|Re>>>23),Re=Me+(ce^_e&(Ge^ce))+Ae[3]+4107603335&4294967295,Me=Ge+(Re<<14&4294967295|Re>>>18),Re=_e+(Ge^ce&(Me^Ge))+Ae[8]+1163531501&4294967295,_e=Me+(Re<<20&4294967295|Re>>>12),Re=ce+(Me^Ge&(_e^Me))+Ae[13]+2850285829&4294967295,ce=_e+(Re<<5&4294967295|Re>>>27),Re=Ge+(_e^Me&(ce^_e))+Ae[2]+4243563512&4294967295,Ge=ce+(Re<<9&4294967295|Re>>>23),Re=Me+(ce^_e&(Ge^ce))+Ae[7]+1735328473&4294967295,Me=Ge+(Re<<14&4294967295|Re>>>18),Re=_e+(Ge^ce&(Me^Ge))+Ae[12]+2368359562&4294967295,_e=Me+(Re<<20&4294967295|Re>>>12),Re=ce+(_e^Me^Ge)+Ae[5]+4294588738&4294967295,ce=_e+(Re<<4&4294967295|Re>>>28),Re=Ge+(ce^_e^Me)+Ae[8]+2272392833&4294967295,Ge=ce+(Re<<11&4294967295|Re>>>21),Re=Me+(Ge^ce^_e)+Ae[11]+1839030562&4294967295,Me=Ge+(Re<<16&4294967295|Re>>>16),Re=_e+(Me^Ge^ce)+Ae[14]+4259657740&4294967295,_e=Me+(Re<<23&4294967295|Re>>>9),Re=ce+(_e^Me^Ge)+Ae[1]+2763975236&4294967295,ce=_e+(Re<<4&4294967295|Re>>>28),Re=Ge+(ce^_e^Me)+Ae[4]+1272893353&4294967295,Ge=ce+(Re<<11&4294967295|Re>>>21),Re=Me+(Ge^ce^_e)+Ae[7]+4139469664&4294967295,Me=Ge+(Re<<16&4294967295|Re>>>16),Re=_e+(Me^Ge^ce)+Ae[10]+3200236656&4294967295,_e=Me+(Re<<23&4294967295|Re>>>9),Re=ce+(_e^Me^Ge)+Ae[13]+681279174&4294967295,ce=_e+(Re<<4&4294967295|Re>>>28),Re=Ge+(ce^_e^Me)+Ae[0]+3936430074&4294967295,Ge=ce+(Re<<11&4294967295|Re>>>21),Re=Me+(Ge^ce^_e)+Ae[3]+3572445317&4294967295,Me=Ge+(Re<<16&4294967295|Re>>>16),Re=_e+(Me^Ge^ce)+Ae[6]+76029189&4294967295,_e=Me+(Re<<23&4294967295|Re>>>9),Re=ce+(_e^Me^Ge)+Ae[9]+3654602809&4294967295,ce=_e+(Re<<4&4294967295|Re>>>28),Re=Ge+(ce^_e^Me)+Ae[12]+3873151461&4294967295,Ge=ce+(Re<<11&4294967295|Re>>>21),Re=Me+(Ge^ce^_e)+Ae[15]+530742520&4294967295,Me=Ge+(Re<<16&4294967295|Re>>>16),Re=_e+(Me^Ge^ce)+Ae[2]+3299628645&4294967295,_e=Me+(Re<<23&4294967295|Re>>>9),Re=ce+(Me^(_e|~Ge))+Ae[0]+4096336452&4294967295,ce=_e+(Re<<6&4294967295|Re>>>26),Re=Ge+(_e^(ce|~Me))+Ae[7]+1126891415&4294967295,Ge=ce+(Re<<10&4294967295|Re>>>22),Re=Me+(ce^(Ge|~_e))+Ae[14]+2878612391&4294967295,Me=Ge+(Re<<15&4294967295|Re>>>17),Re=_e+(Ge^(Me|~ce))+Ae[5]+4237533241&4294967295,_e=Me+(Re<<21&4294967295|Re>>>11),Re=ce+(Me^(_e|~Ge))+Ae[12]+1700485571&4294967295,ce=_e+(Re<<6&4294967295|Re>>>26),Re=Ge+(_e^(ce|~Me))+Ae[3]+2399980690&4294967295,Ge=ce+(Re<<10&4294967295|Re>>>22),Re=Me+(ce^(Ge|~_e))+Ae[10]+4293915773&4294967295,Me=Ge+(Re<<15&4294967295|Re>>>17),Re=_e+(Ge^(Me|~ce))+Ae[1]+2240044497&4294967295,_e=Me+(Re<<21&4294967295|Re>>>11),Re=ce+(Me^(_e|~Ge))+Ae[8]+1873313359&4294967295,ce=_e+(Re<<6&4294967295|Re>>>26),Re=Ge+(_e^(ce|~Me))+Ae[15]+4264355552&4294967295,Ge=ce+(Re<<10&4294967295|Re>>>22),Re=Me+(ce^(Ge|~_e))+Ae[6]+2734768916&4294967295,Me=Ge+(Re<<15&4294967295|Re>>>17),Re=_e+(Ge^(Me|~ce))+Ae[13]+1309151649&4294967295,_e=Me+(Re<<21&4294967295|Re>>>11),Re=ce+(Me^(_e|~Ge))+Ae[4]+4149444226&4294967295,ce=_e+(Re<<6&4294967295|Re>>>26),Re=Ge+(_e^(ce|~Me))+Ae[11]+3174756917&4294967295,Ge=ce+(Re<<10&4294967295|Re>>>22),Re=Me+(ce^(Ge|~_e))+Ae[2]+718787259&4294967295,Me=Ge+(Re<<15&4294967295|Re>>>17),Re=_e+(Ge^(Me|~ce))+Ae[9]+3951481745&4294967295,de.g[0]=de.g[0]+ce&4294967295,de.g[1]=de.g[1]+(Me+(Re<<21&4294967295|Re>>>11))&4294967295,de.g[2]=de.g[2]+Me&4294967295,de.g[3]=de.g[3]+Ge&4294967295}a.prototype.v=function(de,ce){ce===void 0&&(ce=de.length);const _e=ce-this.blockSize,Ae=this.C;let Me=this.h,Ge=0;for(;Ge<ce;){if(Me==0)for(;Ge<=_e;)d(this,de,Ge),Ge+=this.blockSize;if(typeof de=="string"){for(;Ge<ce;)if(Ae[Me++]=de.charCodeAt(Ge++),Me==this.blockSize){d(this,Ae),Me=0;break}}else for(;Ge<ce;)if(Ae[Me++]=de[Ge++],Me==this.blockSize){d(this,Ae),Me=0;break}}this.h=Me,this.o+=ce},a.prototype.A=function(){var de=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);de[0]=128;for(var ce=1;ce<de.length-8;++ce)de[ce]=0;ce=this.o*8;for(var _e=de.length-8;_e<de.length;++_e)de[_e]=ce&255,ce/=256;for(this.v(de),de=Array(16),ce=0,_e=0;_e<4;++_e)for(let Ae=0;Ae<32;Ae+=8)de[ce++]=this.g[_e]>>>Ae&255;return de};function m(de,ce){var _e=c;return Object.prototype.hasOwnProperty.call(_e,de)?_e[de]:_e[de]=ce(de)}function g(de,ce){this.h=ce;const _e=[];let Ae=!0;for(let Me=de.length-1;Me>=0;Me--){const Ge=de[Me]|0;Ae&&Ge==ce||(_e[Me]=Ge,Ae=!1)}this.g=_e}var c={};function C(de){return-128<=de&&de<128?m(de,function(ce){return new g([ce|0],ce<0?-1:0)}):new g([de|0],de<0?-1:0)}function R(de){if(isNaN(de)||!isFinite(de))return q;if(de<0)return Oe(R(-de));const ce=[];let _e=1;for(let Ae=0;de>=_e;Ae++)ce[Ae]=de/_e|0,_e*=4294967296;return new g(ce,0)}function V(de,ce){if(de.length==0)throw Error("number format error: empty string");if(ce=ce||10,ce<2||36<ce)throw Error("radix out of range: "+ce);if(de.charAt(0)=="-")return Oe(V(de.substring(1),ce));if(de.indexOf("-")>=0)throw Error('number format error: interior "-" character');const _e=R(Math.pow(ce,8));let Ae=q;for(let Ge=0;Ge<de.length;Ge+=8){var Me=Math.min(8,de.length-Ge);const Re=parseInt(de.substring(Ge,Ge+Me),ce);Me<8?(Me=R(Math.pow(ce,Me)),Ae=Ae.j(Me).add(R(Re))):(Ae=Ae.j(_e),Ae=Ae.add(R(Re)))}return Ae}var q=C(0),J=C(1),Y=C(16777216);n=g.prototype,n.m=function(){if(be(this))return-Oe(this).m();let de=0,ce=1;for(let _e=0;_e<this.g.length;_e++){const Ae=this.i(_e);de+=(Ae>=0?Ae:4294967296+Ae)*ce,ce*=4294967296}return de},n.toString=function(de){if(de=de||10,de<2||36<de)throw Error("radix out of range: "+de);if(xe(this))return"0";if(be(this))return"-"+Oe(this).toString(de);const ce=R(Math.pow(de,6));var _e=this;let Ae="";for(;;){const Me=Ze(_e,ce).g;_e=et(_e,Me.j(ce));let Ge=((_e.g.length>0?_e.g[0]:_e.h)>>>0).toString(de);if(_e=Me,xe(_e))return Ge+Ae;for(;Ge.length<6;)Ge="0"+Ge;Ae=Ge+Ae}},n.i=function(de){return de<0?0:de<this.g.length?this.g[de]:this.h};function xe(de){if(de.h!=0)return!1;for(let ce=0;ce<de.g.length;ce++)if(de.g[ce]!=0)return!1;return!0}function be(de){return de.h==-1}n.l=function(de){return de=et(this,de),be(de)?-1:xe(de)?0:1};function Oe(de){const ce=de.g.length,_e=[];for(let Ae=0;Ae<ce;Ae++)_e[Ae]=~de.g[Ae];return new g(_e,~de.h).add(J)}n.abs=function(){return be(this)?Oe(this):this},n.add=function(de){const ce=Math.max(this.g.length,de.g.length),_e=[];let Ae=0;for(let Me=0;Me<=ce;Me++){let Ge=Ae+(this.i(Me)&65535)+(de.i(Me)&65535),Re=(Ge>>>16)+(this.i(Me)>>>16)+(de.i(Me)>>>16);Ae=Re>>>16,Ge&=65535,Re&=65535,_e[Me]=Re<<16|Ge}return new g(_e,_e[_e.length-1]&-2147483648?-1:0)};function et(de,ce){return de.add(Oe(ce))}n.j=function(de){if(xe(this)||xe(de))return q;if(be(this))return be(de)?Oe(this).j(Oe(de)):Oe(Oe(this).j(de));if(be(de))return Oe(this.j(Oe(de)));if(this.l(Y)<0&&de.l(Y)<0)return R(this.m()*de.m());const ce=this.g.length+de.g.length,_e=[];for(var Ae=0;Ae<2*ce;Ae++)_e[Ae]=0;for(Ae=0;Ae<this.g.length;Ae++)for(let Me=0;Me<de.g.length;Me++){const Ge=this.i(Ae)>>>16,Re=this.i(Ae)&65535,Pn=de.i(Me)>>>16,ei=de.i(Me)&65535;_e[2*Ae+2*Me]+=Re*ei,Je(_e,2*Ae+2*Me),_e[2*Ae+2*Me+1]+=Ge*ei,Je(_e,2*Ae+2*Me+1),_e[2*Ae+2*Me+1]+=Re*Pn,Je(_e,2*Ae+2*Me+1),_e[2*Ae+2*Me+2]+=Ge*Pn,Je(_e,2*Ae+2*Me+2)}for(de=0;de<ce;de++)_e[de]=_e[2*de+1]<<16|_e[2*de];for(de=ce;de<2*ce;de++)_e[de]=0;return new g(_e,0)};function Je(de,ce){for(;(de[ce]&65535)!=de[ce];)de[ce+1]+=de[ce]>>>16,de[ce]&=65535,ce++}function qe(de,ce){this.g=de,this.h=ce}function Ze(de,ce){if(xe(ce))throw Error("division by zero");if(xe(de))return new qe(q,q);if(be(de))return ce=Ze(Oe(de),ce),new qe(Oe(ce.g),Oe(ce.h));if(be(ce))return ce=Ze(de,Oe(ce)),new qe(Oe(ce.g),ce.h);if(de.g.length>30){if(be(de)||be(ce))throw Error("slowDivide_ only works with positive integers.");for(var _e=J,Ae=ce;Ae.l(de)<=0;)_e=je(_e),Ae=je(Ae);var Me=Be(_e,1),Ge=Be(Ae,1);for(Ae=Be(Ae,2),_e=Be(_e,2);!xe(Ae);){var Re=Ge.add(Ae);Re.l(de)<=0&&(Me=Me.add(_e),Ge=Re),Ae=Be(Ae,1),_e=Be(_e,1)}return ce=et(de,Me.j(ce)),new qe(Me,ce)}for(Me=q;de.l(ce)>=0;){for(_e=Math.max(1,Math.floor(de.m()/ce.m())),Ae=Math.ceil(Math.log(_e)/Math.LN2),Ae=Ae<=48?1:Math.pow(2,Ae-48),Ge=R(_e),Re=Ge.j(ce);be(Re)||Re.l(de)>0;)_e-=Ae,Ge=R(_e),Re=Ge.j(ce);xe(Ge)&&(Ge=J),Me=Me.add(Ge),de=et(de,Re)}return new qe(Me,de)}n.B=function(de){return Ze(this,de).h},n.and=function(de){const ce=Math.max(this.g.length,de.g.length),_e=[];for(let Ae=0;Ae<ce;Ae++)_e[Ae]=this.i(Ae)&de.i(Ae);return new g(_e,this.h&de.h)},n.or=function(de){const ce=Math.max(this.g.length,de.g.length),_e=[];for(let Ae=0;Ae<ce;Ae++)_e[Ae]=this.i(Ae)|de.i(Ae);return new g(_e,this.h|de.h)},n.xor=function(de){const ce=Math.max(this.g.length,de.g.length),_e=[];for(let Ae=0;Ae<ce;Ae++)_e[Ae]=this.i(Ae)^de.i(Ae);return new g(_e,this.h^de.h)};function je(de){const ce=de.g.length+1,_e=[];for(let Ae=0;Ae<ce;Ae++)_e[Ae]=de.i(Ae)<<1|de.i(Ae-1)>>>31;return new g(_e,de.h)}function Be(de,ce){const _e=ce>>5;ce%=32;const Ae=de.g.length-_e,Me=[];for(let Ge=0;Ge<Ae;Ge++)Me[Ge]=ce>0?de.i(Ge+_e)>>>ce|de.i(Ge+_e+1)<<32-ce:de.i(Ge+_e);return new g(Me,de.h)}a.prototype.digest=a.prototype.A,a.prototype.reset=a.prototype.u,a.prototype.update=a.prototype.v,ZA=a,g.prototype.add=g.prototype.add,g.prototype.multiply=g.prototype.j,g.prototype.modulo=g.prototype.B,g.prototype.compare=g.prototype.l,g.prototype.toNumber=g.prototype.m,g.prototype.toString=g.prototype.toString,g.prototype.getBits=g.prototype.i,g.fromNumber=R,g.fromString=V,Vf=g}).apply(typeof _T<"u"?_T:typeof self<"u"?self:typeof window<"u"?window:{});var jv=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var WA,$_,KA,s0,u1,XA,YA,QA;(function(){var n,e=Object.defineProperty;function t(M){M=[typeof globalThis=="object"&&globalThis,M,typeof window=="object"&&window,typeof self=="object"&&self,typeof jv=="object"&&jv];for(var H=0;H<M.length;++H){var ne=M[H];if(ne&&ne.Math==Math)return ne}throw Error("Cannot find global object")}var a=t(this);function d(M,H){if(H)e:{var ne=a;M=M.split(".");for(var ye=0;ye<M.length-1;ye++){var at=M[ye];if(!(at in ne))break e;ne=ne[at]}M=M[M.length-1],ye=ne[M],H=H(ye),H!=ye&&H!=null&&e(ne,M,{configurable:!0,writable:!0,value:H})}}d("Symbol.dispose",function(M){return M||Symbol("Symbol.dispose")}),d("Array.prototype.values",function(M){return M||function(){return this[Symbol.iterator]()}}),d("Object.entries",function(M){return M||function(H){var ne=[],ye;for(ye in H)Object.prototype.hasOwnProperty.call(H,ye)&&ne.push([ye,H[ye]]);return ne}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var m=m||{},g=this||self;function c(M){var H=typeof M;return H=="object"&&M!=null||H=="function"}function C(M,H,ne){return M.call.apply(M.bind,arguments)}function R(M,H,ne){return R=C,R.apply(null,arguments)}function V(M,H){var ne=Array.prototype.slice.call(arguments,1);return function(){var ye=ne.slice();return ye.push.apply(ye,arguments),M.apply(this,ye)}}function q(M,H){function ne(){}ne.prototype=H.prototype,M.Z=H.prototype,M.prototype=new ne,M.prototype.constructor=M,M.Ob=function(ye,at,ht){for(var Kt=Array(arguments.length-2),Ln=2;Ln<arguments.length;Ln++)Kt[Ln-2]=arguments[Ln];return H.prototype[at].apply(ye,Kt)}}var J=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?M=>M&&AsyncContext.Snapshot.wrap(M):M=>M;function Y(M){const H=M.length;if(H>0){const ne=Array(H);for(let ye=0;ye<H;ye++)ne[ye]=M[ye];return ne}return[]}function xe(M,H){for(let ye=1;ye<arguments.length;ye++){const at=arguments[ye];var ne=typeof at;if(ne=ne!="object"?ne:at?Array.isArray(at)?"array":ne:"null",ne=="array"||ne=="object"&&typeof at.length=="number"){ne=M.length||0;const ht=at.length||0;M.length=ne+ht;for(let Kt=0;Kt<ht;Kt++)M[ne+Kt]=at[Kt]}else M.push(at)}}class be{constructor(H,ne){this.i=H,this.j=ne,this.h=0,this.g=null}get(){let H;return this.h>0?(this.h--,H=this.g,this.g=H.next,H.next=null):H=this.i(),H}}function Oe(M){g.setTimeout(()=>{throw M},0)}function et(){var M=de;let H=null;return M.g&&(H=M.g,M.g=M.g.next,M.g||(M.h=null),H.next=null),H}class Je{constructor(){this.h=this.g=null}add(H,ne){const ye=qe.get();ye.set(H,ne),this.h?this.h.next=ye:this.g=ye,this.h=ye}}var qe=new be(()=>new Ze,M=>M.reset());class Ze{constructor(){this.next=this.g=this.h=null}set(H,ne){this.h=H,this.g=ne,this.next=null}reset(){this.next=this.g=this.h=null}}let je,Be=!1,de=new Je,ce=()=>{const M=Promise.resolve(void 0);je=()=>{M.then(_e)}};function _e(){for(var M;M=et();){try{M.h.call(M.g)}catch(ne){Oe(ne)}var H=qe;H.j(M),H.h<100&&(H.h++,M.next=H.g,H.g=M)}Be=!1}function Ae(){this.u=this.u,this.C=this.C}Ae.prototype.u=!1,Ae.prototype.dispose=function(){this.u||(this.u=!0,this.N())},Ae.prototype[Symbol.dispose]=function(){this.dispose()},Ae.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Me(M,H){this.type=M,this.g=this.target=H,this.defaultPrevented=!1}Me.prototype.h=function(){this.defaultPrevented=!0};var Ge=(function(){if(!g.addEventListener||!Object.defineProperty)return!1;var M=!1,H=Object.defineProperty({},"passive",{get:function(){M=!0}});try{const ne=()=>{};g.addEventListener("test",ne,H),g.removeEventListener("test",ne,H)}catch{}return M})();function Re(M){return/^[\s\xa0]*$/.test(M)}function Pn(M,H){Me.call(this,M?M.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,M&&this.init(M,H)}q(Pn,Me),Pn.prototype.init=function(M,H){const ne=this.type=M.type,ye=M.changedTouches&&M.changedTouches.length?M.changedTouches[0]:null;this.target=M.target||M.srcElement,this.g=H,H=M.relatedTarget,H||(ne=="mouseover"?H=M.fromElement:ne=="mouseout"&&(H=M.toElement)),this.relatedTarget=H,ye?(this.clientX=ye.clientX!==void 0?ye.clientX:ye.pageX,this.clientY=ye.clientY!==void 0?ye.clientY:ye.pageY,this.screenX=ye.screenX||0,this.screenY=ye.screenY||0):(this.clientX=M.clientX!==void 0?M.clientX:M.pageX,this.clientY=M.clientY!==void 0?M.clientY:M.pageY,this.screenX=M.screenX||0,this.screenY=M.screenY||0),this.button=M.button,this.key=M.key||"",this.ctrlKey=M.ctrlKey,this.altKey=M.altKey,this.shiftKey=M.shiftKey,this.metaKey=M.metaKey,this.pointerId=M.pointerId||0,this.pointerType=M.pointerType,this.state=M.state,this.i=M,M.defaultPrevented&&Pn.Z.h.call(this)},Pn.prototype.h=function(){Pn.Z.h.call(this);const M=this.i;M.preventDefault?M.preventDefault():M.returnValue=!1};var ei="closure_listenable_"+(Math.random()*1e6|0),mt=0;function $t(M,H,ne,ye,at){this.listener=M,this.proxy=null,this.src=H,this.type=ne,this.capture=!!ye,this.ha=at,this.key=++mt,this.da=this.fa=!1}function Tt(M){M.da=!0,M.listener=null,M.proxy=null,M.src=null,M.ha=null}function zt(M,H,ne){for(const ye in M)H.call(ne,M[ye],ye,M)}function Bt(M,H){for(const ne in M)H.call(void 0,M[ne],ne,M)}function Le(M){const H={};for(const ne in M)H[ne]=M[ne];return H}const vt="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Ot(M,H){let ne,ye;for(let at=1;at<arguments.length;at++){ye=arguments[at];for(ne in ye)M[ne]=ye[ne];for(let ht=0;ht<vt.length;ht++)ne=vt[ht],Object.prototype.hasOwnProperty.call(ye,ne)&&(M[ne]=ye[ne])}}function Ut(M){this.src=M,this.g={},this.h=0}Ut.prototype.add=function(M,H,ne,ye,at){const ht=M.toString();M=this.g[ht],M||(M=this.g[ht]=[],this.h++);const Kt=Wt(M,H,ye,at);return Kt>-1?(H=M[Kt],ne||(H.fa=!1)):(H=new $t(H,this.src,ht,!!ye,at),H.fa=ne,M.push(H)),H};function Jt(M,H){const ne=H.type;if(ne in M.g){var ye=M.g[ne],at=Array.prototype.indexOf.call(ye,H,void 0),ht;(ht=at>=0)&&Array.prototype.splice.call(ye,at,1),ht&&(Tt(H),M.g[ne].length==0&&(delete M.g[ne],M.h--))}}function Wt(M,H,ne,ye){for(let at=0;at<M.length;++at){const ht=M[at];if(!ht.da&&ht.listener==H&&ht.capture==!!ne&&ht.ha==ye)return at}return-1}var Fn="closure_lm_"+(Math.random()*1e6|0),oi={};function fi(M,H,ne,ye,at){if(Array.isArray(H)){for(let ht=0;ht<H.length;ht++)fi(M,H[ht],ne,ye,at);return null}return ne=Ea(ne),M&&M[ei]?M.J(H,ne,c(ye)?!!ye.capture:!1,at):fs(M,H,ne,!1,ye,at)}function fs(M,H,ne,ye,at,ht){if(!H)throw Error("Invalid event type");const Kt=c(at)?!!at.capture:!!at;let Ln=Sa(M);if(Ln||(M[Fn]=Ln=new Ut(M)),ne=Ln.add(H,ne,ye,Kt,ht),ne.proxy)return ne;if(ye=Bs(),ne.proxy=ye,ye.src=M,ye.listener=ne,M.addEventListener)Ge||(at=Kt),at===void 0&&(at=!1),M.addEventListener(H.toString(),ye,at);else if(M.attachEvent)M.attachEvent(Mi(H.toString()),ye);else if(M.addListener&&M.removeListener)M.addListener(ye);else throw Error("addEventListener and attachEvent are unavailable.");return ne}function Bs(){function M(ne){return H.call(M.src,M.listener,ne)}const H=Ua;return M}function Dr(M,H,ne,ye,at){if(Array.isArray(H))for(var ht=0;ht<H.length;ht++)Dr(M,H[ht],ne,ye,at);else ye=c(ye)?!!ye.capture:!!ye,ne=Ea(ne),M&&M[ei]?(M=M.i,ht=String(H).toString(),ht in M.g&&(H=M.g[ht],ne=Wt(H,ne,ye,at),ne>-1&&(Tt(H[ne]),Array.prototype.splice.call(H,ne,1),H.length==0&&(delete M.g[ht],M.h--)))):M&&(M=Sa(M))&&(H=M.g[H.toString()],M=-1,H&&(M=Wt(H,ne,ye,at)),(ne=M>-1?H[M]:null)&&Fi(ne))}function Fi(M){if(typeof M!="number"&&M&&!M.da){var H=M.src;if(H&&H[ei])Jt(H.i,M);else{var ne=M.type,ye=M.proxy;H.removeEventListener?H.removeEventListener(ne,ye,M.capture):H.detachEvent?H.detachEvent(Mi(ne),ye):H.addListener&&H.removeListener&&H.removeListener(ye),(ne=Sa(H))?(Jt(ne,M),ne.h==0&&(ne.src=null,H[Fn]=null)):Tt(M)}}}function Mi(M){return M in oi?oi[M]:oi[M]="on"+M}function Ua(M,H){if(M.da)M=!0;else{H=new Pn(H,this);const ne=M.listener,ye=M.ha||M.src;M.fa&&Fi(M),M=ne.call(ye,H)}return M}function Sa(M){return M=M[Fn],M instanceof Ut?M:null}var Fs="__closure_events_fn_"+(Math.random()*1e9>>>0);function Ea(M){return typeof M=="function"?M:(M[Fs]||(M[Fs]=function(H){return M.handleEvent(H)}),M[Fs])}function Vi(){Ae.call(this),this.i=new Ut(this),this.M=this,this.G=null}q(Vi,Ae),Vi.prototype[ei]=!0,Vi.prototype.removeEventListener=function(M,H,ne,ye){Dr(this,M,H,ne,ye)};function pr(M,H){var ne,ye=M.G;if(ye)for(ne=[];ye;ye=ye.G)ne.push(ye);if(M=M.M,ye=H.type||H,typeof H=="string")H=new Me(H,M);else if(H instanceof Me)H.target=H.target||M;else{var at=H;H=new Me(ye,M),Ot(H,at)}at=!0;let ht,Kt;if(ne)for(Kt=ne.length-1;Kt>=0;Kt--)ht=H.g=ne[Kt],at=Aa(ht,ye,!0,H)&&at;if(ht=H.g=M,at=Aa(ht,ye,!0,H)&&at,at=Aa(ht,ye,!1,H)&&at,ne)for(Kt=0;Kt<ne.length;Kt++)ht=H.g=ne[Kt],at=Aa(ht,ye,!1,H)&&at}Vi.prototype.N=function(){if(Vi.Z.N.call(this),this.i){var M=this.i;for(const H in M.g){const ne=M.g[H];for(let ye=0;ye<ne.length;ye++)Tt(ne[ye]);delete M.g[H],M.h--}}this.G=null},Vi.prototype.J=function(M,H,ne,ye){return this.i.add(String(M),H,!1,ne,ye)},Vi.prototype.K=function(M,H,ne,ye){return this.i.add(String(M),H,!0,ne,ye)};function Aa(M,H,ne,ye){if(H=M.i.g[String(H)],!H)return!0;H=H.concat();let at=!0;for(let ht=0;ht<H.length;++ht){const Kt=H[ht];if(Kt&&!Kt.da&&Kt.capture==ne){const Ln=Kt.listener,Kn=Kt.ha||Kt.src;Kt.fa&&Jt(M.i,Kt),at=Ln.call(Kn,ye)!==!1&&at}}return at&&!ye.defaultPrevented}function Eo(M,H){if(typeof M!="function")if(M&&typeof M.handleEvent=="function")M=R(M.handleEvent,M);else throw Error("Invalid listener argument");return Number(H)>2147483647?-1:g.setTimeout(M,H||0)}function oo(M){M.g=Eo(()=>{M.g=null,M.i&&(M.i=!1,oo(M))},M.l);const H=M.h;M.h=null,M.m.apply(null,H)}class qr extends Ae{constructor(H,ne){super(),this.m=H,this.l=ne,this.h=null,this.i=!1,this.g=null}j(H){this.h=arguments,this.g?this.i=!0:oo(this)}N(){super.N(),this.g&&(g.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ps(M){Ae.call(this),this.h=M,this.g={}}q(ps,Ae);var ms=[];function Vs(M){zt(M.g,function(H,ne){this.g.hasOwnProperty(ne)&&Fi(H)},M),M.g={}}ps.prototype.N=function(){ps.Z.N.call(this),Vs(this)},ps.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var gs=g.JSON.stringify,Xe=g.JSON.parse,se=class{stringify(M){return g.JSON.stringify(M,void 0)}parse(M){return g.JSON.parse(M,void 0)}};function le(){}function fe(){}var Se={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function De(){Me.call(this,"d")}q(De,Me);function He(){Me.call(this,"c")}q(He,Me);var tt={},We=null;function _t(){return We=We||new Vi}tt.Ia="serverreachability";function Pt(M){Me.call(this,tt.Ia,M)}q(Pt,Me);function xt(M){const H=_t();pr(H,new Pt(H))}tt.STAT_EVENT="statevent";function tn(M,H){Me.call(this,tt.STAT_EVENT,M),this.stat=H}q(tn,Me);function $e(M){const H=_t();pr(H,new tn(H,M))}tt.Ja="timingevent";function vn(M,H){Me.call(this,tt.Ja,M),this.size=H}q(vn,Me);function Rn(M,H){if(typeof M!="function")throw Error("Fn must not be null and must be a function");return g.setTimeout(function(){M()},H)}function nn(){this.g=!0}nn.prototype.ua=function(){this.g=!1};function Nn(M,H,ne,ye,at,ht){M.info(function(){if(M.g)if(ht){var Kt="",Ln=ht.split("&");for(let Ti=0;Ti<Ln.length;Ti++){var Kn=Ln[Ti].split("=");if(Kn.length>1){const Xi=Kn[0];Kn=Kn[1];const Ga=Xi.split("_");Kt=Ga.length>=2&&Ga[1]=="type"?Kt+(Xi+"="+Kn+"&"):Kt+(Xi+"=redacted&")}}}else Kt=null;else Kt=ht;return"XMLHTTP REQ ("+ye+") [attempt "+at+"]: "+H+`
`+ne+`
`+Kt})}function Ri(M,H,ne,ye,at,ht,Kt){M.info(function(){return"XMLHTTP RESP ("+ye+") [ attempt "+at+"]: "+H+`
`+ne+`
`+ht+" "+Kt})}function Gi(M,H,ne,ye){M.info(function(){return"XMLHTTP TEXT ("+H+"): "+Ir(M,ne)+(ye?" "+ye:"")})}function tr(M,H){M.info(function(){return"TIMEOUT: "+H})}nn.prototype.info=function(){};function Ir(M,H){if(!M.g)return H;if(!H)return null;try{const ht=JSON.parse(H);if(ht){for(M=0;M<ht.length;M++)if(Array.isArray(ht[M])){var ne=ht[M];if(!(ne.length<2)){var ye=ne[1];if(Array.isArray(ye)&&!(ye.length<1)){var at=ye[0];if(at!="noop"&&at!="stop"&&at!="close")for(let Kt=1;Kt<ye.length;Kt++)ye[Kt]=""}}}}return gs(ht)}catch{return H}}var Vn={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},Xn={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},br;function Mt(){}q(Mt,le),Mt.prototype.g=function(){return new XMLHttpRequest},br=new Mt;function en(M){return encodeURIComponent(String(M))}function nr(M){var H=1;M=M.split(":");const ne=[];for(;H>0&&M.length;)ne.push(M.shift()),H--;return M.length&&ne.push(M.join(":")),ne}function na(M,H,ne,ye){this.j=M,this.i=H,this.l=ne,this.S=ye||1,this.V=new ps(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new Ca}function Ca(){this.i=null,this.g="",this.h=!1}var kt={},yn={};function In(M,H,ne){M.M=1,M.A=Ui(Hi(H)),M.u=ne,M.R=!0,ir(M,null)}function ir(M,H){M.F=Date.now(),Us(M),M.B=Hi(M.A);var ne=M.B,ye=M.S;Array.isArray(ye)||(ye=[String(ye)]),qa(ne.i,"t",ye),M.C=0,ne=M.j.L,M.h=new Ca,M.g=Nl(M.j,ne?H:null,!M.u),M.P>0&&(M.O=new qr(R(M.Y,M,M.g),M.P)),H=M.V,ne=M.g,ye=M.ba;var at="readystatechange";Array.isArray(at)||(at&&(ms[0]=at.toString()),at=ms);for(let ht=0;ht<at.length;ht++){const Kt=fi(ne,at[ht],ye||H.handleEvent,!1,H.h||H);if(!Kt)break;H.g[Kt.key]=Kt}H=M.J?Le(M.J):{},M.u?(M.v||(M.v="POST"),H["Content-Type"]="application/x-www-form-urlencoded",M.g.ea(M.B,M.v,M.u,H)):(M.v="GET",M.g.ea(M.B,M.v,null,H)),xt(),Nn(M.i,M.v,M.B,M.l,M.S,M.u)}na.prototype.ba=function(M){M=M.target;const H=this.O;H&&Qr(M)==3?H.j():this.Y(M)},na.prototype.Y=function(M){try{if(M==this.g)e:{const Ln=Qr(this.g),Kn=this.g.ya(),Ti=this.g.ca();if(!(Ln<3)&&(Ln!=3||this.g&&(this.h.h||this.g.la()||or(this.g)))){this.K||Ln!=4||Kn==7||(Kn==8||Ti<=0?xt(3):xt(2)),_s(this);var H=this.g.ca();this.X=H;var ne=rl(this);if(this.o=H==200,Ri(this.i,this.v,this.B,this.l,this.S,Ln,H),this.o){if(this.U&&!this.L){t:{if(this.g){var ye,at=this.g;if((ye=at.g?at.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Re(ye)){var ht=ye;break t}}ht=null}if(M=ht)Gi(this.i,this.l,M,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Ei(this,M);else{this.o=!1,this.m=3,$e(12),Hr(this),Gr(this);break e}}if(this.R){M=!0;let Xi;for(;!this.K&&this.C<ne.length;)if(Xi=Bn(this,ne),Xi==yn){Ln==4&&(this.m=4,$e(14),M=!1),Gi(this.i,this.l,null,"[Incomplete Response]");break}else if(Xi==kt){this.m=4,$e(15),Gi(this.i,this.l,ne,"[Invalid Chunk]"),M=!1;break}else Gi(this.i,this.l,Xi,null),Ei(this,Xi);if(Ao(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Ln!=4||ne.length!=0||this.h.h||(this.m=1,$e(16),M=!1),this.o=this.o&&M,!M)Gi(this.i,this.l,ne,"[Invalid Chunked Response]"),Hr(this),Gr(this);else if(ne.length>0&&!this.W){this.W=!0;var Kt=this.j;Kt.g==this&&Kt.aa&&!Kt.P&&(Kt.j.info("Great, no buffering proxy detected. Bytes received: "+ne.length),Zu(Kt),Kt.P=!0,$e(11))}}else Gi(this.i,this.l,ne,null),Ei(this,ne);Ln==4&&Hr(this),this.o&&!this.K&&(Ln==4?Ws(this.j,this):(this.o=!1,Us(this)))}else bs(this.g),H==400&&ne.indexOf("Unknown SID")>0?(this.m=3,$e(12)):(this.m=0,$e(13)),Hr(this),Gr(this)}}}catch{}finally{}};function rl(M){if(!Ao(M))return M.g.la();const H=or(M.g);if(H==="")return"";let ne="";const ye=H.length,at=Qr(M.g)==4;if(!M.h.i){if(typeof TextDecoder>"u")return Hr(M),Gr(M),"";M.h.i=new g.TextDecoder}for(let ht=0;ht<ye;ht++)M.h.h=!0,ne+=M.h.i.decode(H[ht],{stream:!(at&&ht==ye-1)});return H.length=0,M.h.g+=ne,M.C=0,M.h.g}function Ao(M){return M.g?M.v=="GET"&&M.M!=2&&M.j.Aa:!1}function Bn(M,H){var ne=M.C,ye=H.indexOf(`
`,ne);return ye==-1?yn:(ne=Number(H.substring(ne,ye)),isNaN(ne)?kt:(ye+=1,ye+ne>H.length?yn:(H=H.slice(ye,ye+ne),M.C=ye+ne,H)))}na.prototype.cancel=function(){this.K=!0,Hr(this)};function Us(M){M.T=Date.now()+M.H,js(M,M.H)}function js(M,H){if(M.D!=null)throw Error("WatchDog timer not null");M.D=Rn(R(M.aa,M),H)}function _s(M){M.D&&(g.clearTimeout(M.D),M.D=null)}na.prototype.aa=function(){this.D=null;const M=Date.now();M-this.T>=0?(tr(this.i,this.B),this.M!=2&&(xt(),$e(17)),Hr(this),this.m=2,Gr(this)):js(this,this.T-M)};function Gr(M){M.j.I==0||M.K||Ws(M.j,M)}function Hr(M){_s(M);var H=M.O;H&&typeof H.dispose=="function"&&H.dispose(),M.O=null,Vs(M.V),M.g&&(H=M.g,M.g=null,H.abort(),H.dispose())}function Ei(M,H){try{var ne=M.j;if(ne.I!=0&&(ne.g==M||ja(ne.h,M))){if(!M.L&&ja(ne.h,M)&&ne.I==3){try{var ye=ne.Ba.g.parse(H)}catch{ye=null}if(Array.isArray(ye)&&ye.length==3){var at=ye;if(at[0]==0){e:if(!ne.v){if(ne.g)if(ne.g.F+3e3<M.F)Wl(ne),Mo(ne);else break e;Ki(ne),$e(18)}}else ne.xa=at[1],0<ne.xa-ne.K&&at[2]<37500&&ne.F&&ne.A==0&&!ne.C&&(ne.C=Rn(R(ne.Va,ne),6e3));Co(ne.h)<=1&&ne.ta&&(ne.ta=void 0)}else lr(ne,11)}else if((M.L||ne.g==M)&&Wl(ne),!Re(H))for(at=ne.Ba.g.parse(H),H=0;H<at.length;H++){let Ti=at[H];const Xi=Ti[0];if(!(Xi<=ne.K))if(ne.K=Xi,Ti=Ti[1],ne.I==2)if(Ti[0]=="c"){ne.M=Ti[1],ne.ba=Ti[2];const Ga=Ti[3];Ga!=null&&(ne.ka=Ga,ne.j.info("VER="+ne.ka));const Ha=Ti[4];Ha!=null&&(ne.za=Ha,ne.j.info("SVER="+ne.za));const Ks=Ti[5];Ks!=null&&typeof Ks=="number"&&Ks>0&&(ye=1.5*Ks,ne.O=ye,ne.j.info("backChannelRequestTimeoutMs_="+ye)),ye=ne;const Ss=M.g;if(Ss){const mu=Ss.g?Ss.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(mu){var ht=ye.h;ht.g||mu.indexOf("spdy")==-1&&mu.indexOf("quic")==-1&&mu.indexOf("h2")==-1||(ht.j=ht.l,ht.g=new Set,ht.h&&(Io(ht,ht.h),ht.h=null))}if(ye.G){const Xs=Ss.g?Ss.g.getResponseHeader("X-HTTP-Session-Id"):null;Xs&&(ye.wa=Xs,on(ye.J,ye.G,Xs))}}ne.I=3,ne.l&&ne.l.ra(),ne.aa&&(ne.T=Date.now()-M.F,ne.j.info("Handshake RTT: "+ne.T+"ms")),ye=ne;var Kt=M;if(ye.na=Ts(ye,ye.L?ye.ba:null,ye.W),Kt.L){$s(ye.h,Kt);var Ln=Kt,Kn=ye.O;Kn&&(Ln.H=Kn),Ln.D&&(_s(Ln),Us(Ln)),ye.g=Kt}else Ro(ye);ne.i.length>0&&Ma(ne)}else Ti[0]!="stop"&&Ti[0]!="close"||lr(ne,7);else ne.I==3&&(Ti[0]=="stop"||Ti[0]=="close"?Ti[0]=="stop"?lr(ne,7):Wn(ne):Ti[0]!="noop"&&ne.l&&ne.l.qa(Ti),ne.A=0)}}xt(4)}catch{}}var Pr=class{constructor(M,H){this.g=M,this.map=H}};function fa(M){this.l=M||10,g.PerformanceNavigationTiming?(M=g.performance.getEntriesByType("navigation"),M=M.length>0&&(M[0].nextHopProtocol=="hq"||M[0].nextHopProtocol=="h2")):M=!!(g.chrome&&g.chrome.loadTimes&&g.chrome.loadTimes()&&g.chrome.loadTimes().wasFetchedViaSpdy),this.j=M?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function wi(M){return M.h?!0:M.g?M.g.size>=M.j:!1}function Co(M){return M.h?1:M.g?M.g.size:0}function ja(M,H){return M.h?M.h==H:M.g?M.g.has(H):!1}function Io(M,H){M.g?M.g.add(H):M.h=H}function $s(M,H){M.h&&M.h==H?M.h=null:M.g&&M.g.has(H)&&M.g.delete(H)}fa.prototype.cancel=function(){if(this.i=qs(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const M of this.g.values())M.cancel();this.g.clear()}};function qs(M){if(M.h!=null)return M.i.concat(M.h.G);if(M.g!=null&&M.g.size!==0){let H=M.i;for(const ne of M.g.values())H=H.concat(ne.G);return H}return Y(M.i)}var al=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function ii(M,H){if(M){M=M.split("&");for(let ne=0;ne<M.length;ne++){const ye=M[ne].indexOf("=");let at,ht=null;ye>=0?(at=M[ne].substring(0,ye),ht=M[ne].substring(ye+1)):at=M[ne],H(at,ht?decodeURIComponent(ht.replace(/\+/g," ")):"")}}}function hi(M){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let H;M instanceof hi?(this.l=M.l,xr(this,M.j),this.o=M.o,this.g=M.g,Gs(this,M.u),this.h=M.h,fu(this,Zs(M.i)),this.m=M.m):M&&(H=String(M).match(al))?(this.l=!1,xr(this,H[1]||"",!0),this.o=Ia(H[2]||""),this.g=Ia(H[3]||"",!0),Gs(this,H[4]),this.h=Ia(H[5]||"",!0),fu(this,H[6]||"",!0),this.m=Ia(H[7]||"")):(this.l=!1,this.i=new $a(null,this.l))}hi.prototype.toString=function(){const M=[];var H=this.j;H&&M.push(lo(H,Po,!0),":");var ne=this.g;return(ne||H=="file")&&(M.push("//"),(H=this.o)&&M.push(lo(H,Po,!0),"@"),M.push(en(ne).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),ne=this.u,ne!=null&&M.push(":",String(ne))),(ne=this.h)&&(this.g&&ne.charAt(0)!="/"&&M.push("/"),M.push(lo(ne,ne.charAt(0)=="/"?Hs:Dl,!0))),(ne=this.i.toString())&&M.push("?",ne),(ne=this.m)&&M.push("#",lo(ne,Ja)),M.join("")},hi.prototype.resolve=function(M){const H=Hi(this);let ne=!!M.j;ne?xr(H,M.j):ne=!!M.o,ne?H.o=M.o:ne=!!M.g,ne?H.g=M.g:ne=M.u!=null;var ye=M.h;if(ne)Gs(H,M.u);else if(ne=!!M.h){if(ye.charAt(0)!="/")if(this.g&&!this.h)ye="/"+ye;else{var at=H.h.lastIndexOf("/");at!=-1&&(ye=H.h.slice(0,at+1)+ye)}if(at=ye,at==".."||at==".")ye="";else if(at.indexOf("./")!=-1||at.indexOf("/.")!=-1){ye=at.lastIndexOf("/",0)==0,at=at.split("/");const ht=[];for(let Kt=0;Kt<at.length;){const Ln=at[Kt++];Ln=="."?ye&&Kt==at.length&&ht.push(""):Ln==".."?((ht.length>1||ht.length==1&&ht[0]!="")&&ht.pop(),ye&&Kt==at.length&&ht.push("")):(ht.push(Ln),ye=!0)}ye=ht.join("/")}else ye=at}return ne?H.h=ye:ne=M.i.toString()!=="",ne?fu(H,Zs(M.i)):ne=!!M.m,ne&&(H.m=M.m),H};function Hi(M){return new hi(M)}function xr(M,H,ne){M.j=ne?Ia(H,!0):H,M.j&&(M.j=M.j.replace(/:$/,""))}function Gs(M,H){if(H){if(H=Number(H),isNaN(H)||H<0)throw Error("Bad port number "+H);M.u=H}else M.u=null}function fu(M,H,ne){H instanceof $a?(M.i=H,vs(M.i,M.l)):(ne||(H=lo(H,ar)),M.i=new $a(H,M.l))}function on(M,H,ne){M.i.set(H,ne)}function Ui(M){return on(M,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),M}function Ia(M,H){return M?H?decodeURI(M.replace(/%25/g,"%2525")):decodeURIComponent(M):""}function lo(M,H,ne){return typeof M=="string"?(M=encodeURI(M).replace(H,rr),ne&&(M=M.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),M):null}function rr(M){return M=M.charCodeAt(0),"%"+(M>>4&15).toString(16)+(M&15).toString(16)}var Po=/[#\/\?@]/g,Dl=/[#\?:]/g,Hs=/[#\?]/g,ar=/[#\?@]/g,Ja=/#/g;function $a(M,H){this.h=this.g=null,this.i=M||null,this.j=!!H}function Zi(M){M.g||(M.g=new Map,M.h=0,M.i&&ii(M.i,function(H,ne){M.add(decodeURIComponent(H.replace(/\+/g," ")),ne)}))}n=$a.prototype,n.add=function(M,H){Zi(this),this.i=null,M=kn(this,M);let ne=this.g.get(M);return ne||this.g.set(M,ne=[]),ne.push(H),this.h+=1,this};function Un(M,H){Zi(M),H=kn(M,H),M.g.has(H)&&(M.i=null,M.h-=M.g.get(H).length,M.g.delete(H))}function es(M,H){return Zi(M),H=kn(M,H),M.g.has(H)}n.forEach=function(M,H){Zi(this),this.g.forEach(function(ne,ye){ne.forEach(function(at){M.call(H,at,ye,this)},this)},this)};function ys(M,H){Zi(M);let ne=[];if(typeof H=="string")es(M,H)&&(ne=ne.concat(M.g.get(kn(M,H))));else for(M=Array.from(M.g.values()),H=0;H<M.length;H++)ne=ne.concat(M[H]);return ne}n.set=function(M,H){return Zi(this),this.i=null,M=kn(this,M),es(this,M)&&(this.h-=this.g.get(M).length),this.g.set(M,[H]),this.h+=1,this},n.get=function(M,H){return M?(M=ys(this,M),M.length>0?String(M[0]):H):H};function qa(M,H,ne){Un(M,H),ne.length>0&&(M.i=null,M.g.set(kn(M,H),Y(ne)),M.h+=ne.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const M=[],H=Array.from(this.g.keys());for(let ye=0;ye<H.length;ye++){var ne=H[ye];const at=en(ne);ne=ys(this,ne);for(let ht=0;ht<ne.length;ht++){let Kt=at;ne[ht]!==""&&(Kt+="="+en(ne[ht])),M.push(Kt)}}return this.i=M.join("&")};function Zs(M){const H=new $a;return H.i=M.i,M.g&&(H.g=new Map(M.g),H.h=M.h),H}function kn(M,H){return H=String(H),M.j&&(H=H.toLowerCase()),H}function vs(M,H){H&&!M.j&&(Zi(M),M.i=null,M.g.forEach(function(ne,ye){const at=ye.toLowerCase();ye!=at&&(Un(this,ye),qa(this,at,ne))},M)),M.j=H}function Pa(M,H){const ne=new nn;if(g.Image){const ye=new Image;ye.onload=V(Wi,ne,"TestLoadImage: loaded",!0,H,ye),ye.onerror=V(Wi,ne,"TestLoadImage: error",!1,H,ye),ye.onabort=V(Wi,ne,"TestLoadImage: abort",!1,H,ye),ye.ontimeout=V(Wi,ne,"TestLoadImage: timeout",!1,H,ye),g.setTimeout(function(){ye.ontimeout&&ye.ontimeout()},1e4),ye.src=M}else H(!1)}function zl(M,H){const ne=new nn,ye=new AbortController,at=setTimeout(()=>{ye.abort(),Wi(ne,"TestPingServer: timeout",!1,H)},1e4);fetch(M,{signal:ye.signal}).then(ht=>{clearTimeout(at),ht.ok?Wi(ne,"TestPingServer: ok",!0,H):Wi(ne,"TestPingServer: server error",!1,H)}).catch(()=>{clearTimeout(at),Wi(ne,"TestPingServer: error",!1,H)})}function Wi(M,H,ne,ye,at){try{at&&(at.onload=null,at.onerror=null,at.onabort=null,at.ontimeout=null),ye(ne)}catch{}}function mr(){this.g=new se}function hn(M){this.i=M.Sb||null,this.h=M.ab||!1}q(hn,le),hn.prototype.g=function(){return new pi(this.i,this.h)};function pi(M,H){Vi.call(this),this.H=M,this.o=H,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}q(pi,Vi),n=pi.prototype,n.open=function(M,H){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=M,this.D=H,this.readyState=1,sr(this)},n.send=function(M){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const H={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};M&&(H.body=M),(this.H||g).fetch(new Request(this.D,H)).then(this.Pa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,sl(this)),this.readyState=0},n.Pa=function(M){if(this.g&&(this.l=M,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=M.headers,this.readyState=2,sr(this)),this.g&&(this.readyState=3,sr(this),this.g)))if(this.responseType==="arraybuffer")M.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof g.ReadableStream<"u"&&"body"in M){if(this.j=M.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;xn(this)}else M.text().then(this.Oa.bind(this),this.ga.bind(this))};function xn(M){M.j.read().then(M.Ma.bind(M)).catch(M.ga.bind(M))}n.Ma=function(M){if(this.g){if(this.o&&M.value)this.response.push(M.value);else if(!this.o){var H=M.value?M.value:new Uint8Array(0);(H=this.B.decode(H,{stream:!M.done}))&&(this.response=this.responseText+=H)}M.done?sl(this):sr(this),this.readyState==3&&xn(this)}},n.Oa=function(M){this.g&&(this.response=this.responseText=M,sl(this))},n.Na=function(M){this.g&&(this.response=M,sl(this))},n.ga=function(){this.g&&sl(this)};function sl(M){M.readyState=4,M.l=null,M.j=null,M.B=null,sr(M)}n.setRequestHeader=function(M,H){this.A.append(M,H)},n.getResponseHeader=function(M){return this.h&&this.h.get(M.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const M=[],H=this.h.entries();for(var ne=H.next();!ne.done;)ne=ne.value,M.push(ne[0]+": "+ne[1]),ne=H.next();return M.join(`\r
`)};function sr(M){M.onreadystatechange&&M.onreadystatechange.call(M)}Object.defineProperty(pi.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(M){this.m=M?"include":"same-origin"}});function cr(M){let H="";return zt(M,function(ne,ye){H+=ye,H+=":",H+=ne,H+=`\r
`}),H}function wr(M,H,ne){e:{for(ye in ne){var ye=!1;break e}ye=!0}ye||(ne=cr(ne),typeof M=="string"?ne!=null&&en(ne):on(M,H,ne))}function bn(M){Vi.call(this),this.headers=new Map,this.L=M||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}q(bn,Vi);var pa=/^https?$/i,fn=["POST","PUT"];n=bn.prototype,n.Fa=function(M){this.H=M},n.ea=function(M,H,ne,ye){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+M);H=H?H.toUpperCase():"GET",this.D=M,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():br.g(),this.g.onreadystatechange=J(R(this.Ca,this));try{this.B=!0,this.g.open(H,String(M),!0),this.B=!1}catch(ht){sn(this,ht);return}if(M=ne||"",ne=new Map(this.headers),ye)if(Object.getPrototypeOf(ye)===Object.prototype)for(var at in ye)ne.set(at,ye[at]);else if(typeof ye.keys=="function"&&typeof ye.get=="function")for(const ht of ye.keys())ne.set(ht,ye.get(ht));else throw Error("Unknown input type for opt_headers: "+String(ye));ye=Array.from(ne.keys()).find(ht=>ht.toLowerCase()=="content-type"),at=g.FormData&&M instanceof g.FormData,!(Array.prototype.indexOf.call(fn,H,void 0)>=0)||ye||at||ne.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[ht,Kt]of ne)this.g.setRequestHeader(ht,Kt);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(M),this.v=!1}catch(ht){sn(this,ht)}};function sn(M,H){M.h=!1,M.g&&(M.j=!0,M.g.abort(),M.j=!1),M.l=H,M.o=5,ia(M),zr(M)}function ia(M){M.A||(M.A=!0,pr(M,"complete"),pr(M,"error"))}n.abort=function(M){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=M||7,pr(this,"complete"),pr(this,"abort"),zr(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),zr(this,!0)),bn.Z.N.call(this)},n.Ca=function(){this.u||(this.B||this.v||this.j?$n(this):this.Xa())},n.Xa=function(){$n(this)};function $n(M){if(M.h&&typeof m<"u"){if(M.v&&Qr(M)==4)setTimeout(M.Ca.bind(M),0);else if(pr(M,"readystatechange"),Qr(M)==4){M.h=!1;try{const ht=M.ca();e:switch(ht){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var H=!0;break e;default:H=!1}var ne;if(!(ne=H)){var ye;if(ye=ht===0){let Kt=String(M.D).match(al)[1]||null;!Kt&&g.self&&g.self.location&&(Kt=g.self.location.protocol.slice(0,-1)),ye=!pa.test(Kt?Kt.toLowerCase():"")}ne=ye}if(ne)pr(M,"complete"),pr(M,"success");else{M.o=6;try{var at=Qr(M)>2?M.g.statusText:""}catch{at=""}M.l=at+" ["+M.ca()+"]",ia(M)}}finally{zr(M)}}}}function zr(M,H){if(M.g){M.m&&(clearTimeout(M.m),M.m=null);const ne=M.g;M.g=null,H||pr(M,"ready");try{ne.onreadystatechange=null}catch{}}}n.isActive=function(){return!!this.g};function Qr(M){return M.g?M.g.readyState:0}n.ca=function(){try{return Qr(this)>2?this.g.status:-1}catch{return-1}},n.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.La=function(M){if(this.g){var H=this.g.responseText;return M&&H.indexOf(M)==0&&(H=H.substring(M.length)),Xe(H)}};function or(M){try{if(!M.g)return null;if("response"in M.g)return M.g.response;switch(M.F){case"":case"text":return M.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in M.g)return M.g.mozResponseArrayBuffer}return null}catch{return null}}function bs(M){const H={};M=(M.g&&Qr(M)>=2&&M.g.getAllResponseHeaders()||"").split(`\r
`);for(let ye=0;ye<M.length;ye++){if(Re(M[ye]))continue;var ne=nr(M[ye]);const at=ne[0];if(ne=ne[1],typeof ne!="string")continue;ne=ne.trim();const ht=H[at]||[];H[at]=ht,ht.push(ne)}Bt(H,function(ye){return ye.join(", ")})}n.ya=function(){return this.o},n.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function uo(M,H,ne){return ne&&ne.internalChannelParams&&ne.internalChannelParams[M]||H}function xs(M){this.za=0,this.i=[],this.j=new nn,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=uo("failFast",!1,M),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=uo("baseRetryDelayMs",5e3,M),this.Za=uo("retryDelaySeedMs",1e4,M),this.Ta=uo("forwardChannelMaxRetries",2,M),this.va=uo("forwardChannelRequestTimeoutMs",2e4,M),this.ma=M&&M.xmlHttpFactory||void 0,this.Ua=M&&M.Rb||void 0,this.Aa=M&&M.useFetchStreams||!1,this.O=void 0,this.L=M&&M.supportsCrossDomainXhr||!1,this.M="",this.h=new fa(M&&M.concurrentRequestLimit),this.Ba=new mr,this.S=M&&M.fastHandshake||!1,this.R=M&&M.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=M&&M.Pb||!1,M&&M.ua&&this.j.ua(),M&&M.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&M&&M.detectBufferingProxy||!1,this.ia=void 0,M&&M.longPollingTimeout&&M.longPollingTimeout>0&&(this.ia=M.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}n=xs.prototype,n.ka=8,n.I=1,n.connect=function(M,H,ne,ye){$e(0),this.W=M,this.H=H||{},ne&&ye!==void 0&&(this.H.OSID=ne,this.H.OAID=ye),this.F=this.X,this.J=Ts(this,null,this.W),Ma(this)};function Wn(M){if(ra(M),M.I==3){var H=M.V++,ne=Hi(M.J);if(on(ne,"SID",M.M),on(ne,"RID",H),on(ne,"TYPE","terminate"),ws(M,ne),H=new na(M,M.j,H),H.M=2,H.A=Ui(Hi(ne)),ne=!1,g.navigator&&g.navigator.sendBeacon)try{ne=g.navigator.sendBeacon(H.A.toString(),"")}catch{}!ne&&g.Image&&(new Image().src=H.A,ne=!0),ne||(H.g=Nl(H.j,null),H.g.ea(H.A)),H.F=Date.now(),Us(H)}ts(M)}function Mo(M){M.g&&(Zu(M),M.g.cancel(),M.g=null)}function ra(M){Mo(M),M.v&&(g.clearTimeout(M.v),M.v=null),Wl(M),M.h.cancel(),M.m&&(typeof M.m=="number"&&g.clearTimeout(M.m),M.m=null)}function Ma(M){if(!wi(M.h)&&!M.m){M.m=!0;var H=M.Ea;je||ce(),Be||(je(),Be=!0),de.add(H,M),M.D=0}}function Ra(M,H){return Co(M.h)>=M.h.j-(M.m?1:0)?!1:M.m?(M.i=H.G.concat(M.i),!0):M.I==1||M.I==2||M.D>=(M.Sa?0:M.Ta)?!1:(M.m=Rn(R(M.Ea,M,H),Ol(M,M.D)),M.D++,!0)}n.Ea=function(M){if(this.m)if(this.m=null,this.I==1){if(!M){this.V=Math.floor(Math.random()*1e5),M=this.V++;const at=new na(this,this.j,M);let ht=this.o;if(this.U&&(ht?(ht=Le(ht),Ot(ht,this.U)):ht=this.U),this.u!==null||this.R||(at.J=ht,ht=null),this.S)e:{for(var H=0,ne=0;ne<this.i.length;ne++){t:{var ye=this.i[ne];if("__data__"in ye.map&&(ye=ye.map.__data__,typeof ye=="string")){ye=ye.length;break t}ye=void 0}if(ye===void 0)break;if(H+=ye,H>4096){H=ne;break e}if(H===4096||ne===this.i.length-1){H=ne+1;break e}}H=1e3}else H=1e3;H=Zl(this,at,H),ne=Hi(this.J),on(ne,"RID",M),on(ne,"CVER",22),this.G&&on(ne,"X-HTTP-Session-Id",this.G),ws(this,ne),ht&&(this.R?H="headers="+en(cr(ht))+"&"+H:this.u&&wr(ne,this.u,ht)),Io(this.h,at),this.Ra&&on(ne,"TYPE","init"),this.S?(on(ne,"$req",H),on(ne,"SID","null"),at.U=!0,In(at,ne,null)):In(at,ne,H),this.I=2}}else this.I==3&&(M?Or(this,M):this.i.length==0||wi(this.h)||Or(this))};function Or(M,H){var ne;H?ne=H.l:ne=M.V++;const ye=Hi(M.J);on(ye,"SID",M.M),on(ye,"RID",ne),on(ye,"AID",M.K),ws(M,ye),M.u&&M.o&&wr(ye,M.u,M.o),ne=new na(M,M.j,ne,M.D+1),M.u===null&&(ne.J=M.o),H&&(M.i=H.G.concat(M.i)),H=Zl(M,ne,1e3),ne.H=Math.round(M.va*.5)+Math.round(M.va*.5*Math.random()),Io(M.h,ne),In(ne,ye,H)}function ws(M,H){M.H&&zt(M.H,function(ne,ye){on(H,ye,ne)}),M.l&&zt({},function(ne,ye){on(H,ye,ne)})}function Zl(M,H,ne){ne=Math.min(M.i.length,ne);const ye=M.l?R(M.l.Ka,M.l,M):null;e:{var at=M.i;let Ln=-1;for(;;){const Kn=["count="+ne];Ln==-1?ne>0?(Ln=at[0].g,Kn.push("ofs="+Ln)):Ln=0:Kn.push("ofs="+Ln);let Ti=!0;for(let Xi=0;Xi<ne;Xi++){var ht=at[Xi].g;const Ga=at[Xi].map;if(ht-=Ln,ht<0)Ln=Math.max(0,at[Xi].g-100),Ti=!1;else try{ht="req"+ht+"_"||"";try{var Kt=Ga instanceof Map?Ga:Object.entries(Ga);for(const[Ha,Ks]of Kt){let Ss=Ks;c(Ks)&&(Ss=gs(Ks)),Kn.push(ht+Ha+"="+encodeURIComponent(Ss))}}catch(Ha){throw Kn.push(ht+"type="+encodeURIComponent("_badmap")),Ha}}catch{ye&&ye(Ga)}}if(Ti){Kt=Kn.join("&");break e}}Kt=void 0}return M=M.i.splice(0,ne),H.G=M,Kt}function Ro(M){if(!M.g&&!M.v){M.Y=1;var H=M.Da;je||ce(),Be||(je(),Be=!0),de.add(H,M),M.A=0}}function Ki(M){return M.g||M.v||M.A>=3?!1:(M.Y++,M.v=Rn(R(M.Da,M),Ol(M,M.A)),M.A++,!0)}n.Da=function(){if(this.v=null,ol(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var M=4*this.T;this.j.info("BP detection timer enabled: "+M),this.B=Rn(R(this.Wa,this),M)}},n.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,$e(10),Mo(this),ol(this))};function Zu(M){M.B!=null&&(g.clearTimeout(M.B),M.B=null)}function ol(M){M.g=new na(M,M.j,"rpc",M.Y),M.u===null&&(M.g.J=M.o),M.g.P=0;var H=Hi(M.na);on(H,"RID","rpc"),on(H,"SID",M.M),on(H,"AID",M.K),on(H,"CI",M.F?"0":"1"),!M.F&&M.ia&&on(H,"TO",M.ia),on(H,"TYPE","xmlhttp"),ws(M,H),M.u&&M.o&&wr(H,M.u,M.o),M.O&&(M.g.H=M.O);var ne=M.g;M=M.ba,ne.M=1,ne.A=Ui(Hi(H)),ne.u=null,ne.R=!0,ir(ne,M)}n.Va=function(){this.C!=null&&(this.C=null,Mo(this),Ki(this),$e(19))};function Wl(M){M.C!=null&&(g.clearTimeout(M.C),M.C=null)}function Ws(M,H){var ne=null;if(M.g==H){Wl(M),Zu(M),M.g=null;var ye=2}else if(ja(M.h,H))ne=H.G,$s(M.h,H),ye=1;else return;if(M.I!=0){if(H.o)if(ye==1){ne=H.u?H.u.length:0,H=Date.now()-H.F;var at=M.D;ye=_t(),pr(ye,new vn(ye,ne)),Ma(M)}else Ro(M);else if(at=H.m,at==3||at==0&&H.X>0||!(ye==1&&Ra(M,H)||ye==2&&Ki(M)))switch(ne&&ne.length>0&&(H=M.h,H.i=H.i.concat(ne)),at){case 1:lr(M,5);break;case 4:lr(M,10);break;case 3:lr(M,6);break;default:lr(M,2)}}}function Ol(M,H){let ne=M.Qa+Math.floor(Math.random()*M.Za);return M.isActive()||(ne*=2),ne*H}function lr(M,H){if(M.j.info("Error code "+H),H==2){var ne=R(M.bb,M),ye=M.Ua;const at=!ye;ye=new hi(ye||"//www.google.com/images/cleardot.gif"),g.location&&g.location.protocol=="http"||xr(ye,"https"),Ui(ye),at?Pa(ye.toString(),ne):zl(ye.toString(),ne)}else $e(2);M.I=0,M.l&&M.l.pa(H),ts(M),ra(M)}n.bb=function(M){M?(this.j.info("Successfully pinged google.com"),$e(2)):(this.j.info("Failed to ping google.com"),$e(1))};function ts(M){if(M.I=0,M.ja=[],M.l){const H=qs(M.h);(H.length!=0||M.i.length!=0)&&(xe(M.ja,H),xe(M.ja,M.i),M.h.i.length=0,Y(M.i),M.i.length=0),M.l.oa()}}function Ts(M,H,ne){var ye=ne instanceof hi?Hi(ne):new hi(ne);if(ye.g!="")H&&(ye.g=H+"."+ye.g),Gs(ye,ye.u);else{var at=g.location;ye=at.protocol,H=H?H+"."+at.hostname:at.hostname,at=+at.port;const ht=new hi(null);ye&&xr(ht,ye),H&&(ht.g=H),at&&Gs(ht,at),ne&&(ht.h=ne),ye=ht}return ne=M.G,H=M.wa,ne&&H&&on(ye,ne,H),on(ye,"VER",M.ka),ws(M,ye),ye}function Nl(M,H,ne){if(H&&!M.L)throw Error("Can't create secondary domain capable XhrIo object.");return H=M.Aa&&!M.ma?new bn(new hn({ab:ne})):new bn(M.ma),H.Fa(M.L),H}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function ll(){}n=ll.prototype,n.ra=function(){},n.qa=function(){},n.pa=function(){},n.oa=function(){},n.isActive=function(){return!0},n.Ka=function(){};function co(){}co.prototype.g=function(M,H){return new Ai(M,H)};function Ai(M,H){Vi.call(this),this.g=new xs(H),this.l=M,this.h=H&&H.messageUrlParams||null,M=H&&H.messageHeaders||null,H&&H.clientProtocolHeaderRequired&&(M?M["X-Client-Protocol"]="webchannel":M={"X-Client-Protocol":"webchannel"}),this.g.o=M,M=H&&H.initMessageHeaders||null,H&&H.messageContentType&&(M?M["X-WebChannel-Content-Type"]=H.messageContentType:M={"X-WebChannel-Content-Type":H.messageContentType}),H&&H.sa&&(M?M["X-WebChannel-Client-Profile"]=H.sa:M={"X-WebChannel-Client-Profile":H.sa}),this.g.U=M,(M=H&&H.Qb)&&!Re(M)&&(this.g.u=M),this.A=H&&H.supportsCrossDomainXhr||!1,this.v=H&&H.sendRawJson||!1,(H=H&&H.httpSessionIdParam)&&!Re(H)&&(this.g.G=H,M=this.h,M!==null&&H in M&&(M=this.h,H in M&&delete M[H])),this.j=new Bl(this)}q(Ai,Vi),Ai.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},Ai.prototype.close=function(){Wn(this.g)},Ai.prototype.o=function(M){var H=this.g;if(typeof M=="string"){var ne={};ne.__data__=M,M=ne}else this.v&&(ne={},ne.__data__=gs(M),M=ne);H.i.push(new Pr(H.Ya++,M)),H.I==3&&Ma(H)},Ai.prototype.N=function(){this.g.l=null,delete this.j,Wn(this.g),delete this.g,Ai.Z.N.call(this)};function Wu(M){De.call(this),M.__headers__&&(this.headers=M.__headers__,this.statusCode=M.__status__,delete M.__headers__,delete M.__status__);var H=M.__sm__;if(H){e:{for(const ne in H){M=ne;break e}M=void 0}(this.i=M)&&(M=this.i,H=H!==null&&M in H?H[M]:void 0),this.data=H}else this.data=M}q(Wu,De);function pu(){He.call(this),this.status=1}q(pu,He);function Bl(M){this.g=M}q(Bl,ll),Bl.prototype.ra=function(){pr(this.g,"a")},Bl.prototype.qa=function(M){pr(this.g,new Wu(M))},Bl.prototype.pa=function(M){pr(this.g,new pu)},Bl.prototype.oa=function(){pr(this.g,"b")},co.prototype.createWebChannel=co.prototype.g,Ai.prototype.send=Ai.prototype.o,Ai.prototype.open=Ai.prototype.m,Ai.prototype.close=Ai.prototype.close,QA=function(){return new co},YA=function(){return _t()},XA=tt,u1={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},Vn.NO_ERROR=0,Vn.TIMEOUT=8,Vn.HTTP_ERROR=6,s0=Vn,Xn.COMPLETE="complete",KA=Xn,fe.EventType=Se,Se.OPEN="a",Se.CLOSE="b",Se.ERROR="c",Se.MESSAGE="d",Vi.prototype.listen=Vi.prototype.J,$_=fe,bn.prototype.listenOnce=bn.prototype.K,bn.prototype.getLastError=bn.prototype.Ha,bn.prototype.getLastErrorCode=bn.prototype.ya,bn.prototype.getStatus=bn.prototype.ca,bn.prototype.getResponseJson=bn.prototype.La,bn.prototype.getResponseText=bn.prototype.la,bn.prototype.send=bn.prototype.ea,bn.prototype.setWithCredentials=bn.prototype.Fa,WA=bn}).apply(typeof jv<"u"?jv:typeof self<"u"?self:typeof window<"u"?window:{});const yT="@firebase/firestore",vT="4.9.2";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ml{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Ml.UNAUTHENTICATED=new Ml(null),Ml.GOOGLE_CREDENTIALS=new Ml("google-credentials-uid"),Ml.FIRST_PARTY=new Ml("first-party-uid"),Ml.MOCK_USER=new Ml("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Pg="12.3.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qp=new Oy("@firebase/firestore");function Qm(){return Qp.logLevel}function gn(n,...e){if(Qp.logLevel<=Oi.DEBUG){const t=e.map(fw);Qp.debug(`Firestore (${Pg}): ${n}`,...t)}}function Hd(n,...e){if(Qp.logLevel<=Oi.ERROR){const t=e.map(fw);Qp.error(`Firestore (${Pg}): ${n}`,...t)}}function gg(n,...e){if(Qp.logLevel<=Oi.WARN){const t=e.map(fw);Qp.warn(`Firestore (${Pg}): ${n}`,...t)}}function fw(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return(function(t){return JSON.stringify(t)})(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zn(n,e,t){let a="Unexpected state";typeof e=="string"?a=e:t=e,JA(n,a,t)}function JA(n,e,t){let a=`FIRESTORE (${Pg}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{a+=" CONTEXT: "+JSON.stringify(t)}catch{a+=" CONTEXT: "+t}throw Hd(a),new Error(a)}function Cr(n,e,t,a){let d="Unexpected state";typeof t=="string"?d=t:a=t,n||JA(e,d,a)}function si(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lt={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class _n extends mh{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uf{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eC{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class RD{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(Ml.UNAUTHENTICATED)))}shutdown(){}}class kD{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class LD{constructor(e){this.t=e,this.currentUser=Ml.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){Cr(this.o===void 0,42304);let a=this.i;const d=C=>this.i!==a?(a=this.i,t(C)):Promise.resolve();let m=new Uf;this.o=()=>{this.i++,this.currentUser=this.u(),m.resolve(),m=new Uf,e.enqueueRetryable((()=>d(this.currentUser)))};const g=()=>{const C=m;e.enqueueRetryable((async()=>{await C.promise,await d(this.currentUser)}))},c=C=>{gn("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=C,this.o&&(this.auth.addAuthTokenListener(this.o),g())};this.t.onInit((C=>c(C))),setTimeout((()=>{if(!this.auth){const C=this.t.getImmediate({optional:!0});C?c(C):(gn("FirebaseAuthCredentialsProvider","Auth not yet detected"),m.resolve(),m=new Uf)}}),0),g()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((a=>this.i!==e?(gn("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):a?(Cr(typeof a.accessToken=="string",31837,{l:a}),new eC(a.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Cr(e===null||typeof e=="string",2055,{h:e}),new Ml(e)}}class DD{constructor(e,t,a){this.P=e,this.T=t,this.I=a,this.type="FirstParty",this.user=Ml.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class zD{constructor(e,t,a){this.P=e,this.T=t,this.I=a}getToken(){return Promise.resolve(new DD(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable((()=>t(Ml.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class bT{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class OD{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,qh(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){Cr(this.o===void 0,3512);const a=m=>{m.error!=null&&gn("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${m.error.message}`);const g=m.token!==this.m;return this.m=m.token,gn("FirebaseAppCheckTokenProvider",`Received ${g?"new":"existing"} token.`),g?t(m.token):Promise.resolve()};this.o=m=>{e.enqueueRetryable((()=>a(m)))};const d=m=>{gn("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=m,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((m=>d(m))),setTimeout((()=>{if(!this.appCheck){const m=this.V.getImmediate({optional:!0});m?d(m):gn("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new bT(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((t=>t?(Cr(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new bT(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ND(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let a=0;a<n;a++)t[a]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pw{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let a="";for(;a.length<20;){const d=ND(40);for(let m=0;m<d.length;++m)a.length<20&&d[m]<t&&(a+=e.charAt(d[m]%62))}return a}}function Ni(n,e){return n<e?-1:n>e?1:0}function c1(n,e){const t=Math.min(n.length,e.length);for(let a=0;a<t;a++){const d=n.charAt(a),m=e.charAt(a);if(d!==m)return Ax(d)===Ax(m)?Ni(d,m):Ax(d)?1:-1}return Ni(n.length,e.length)}const BD=55296,FD=57343;function Ax(n){const e=n.charCodeAt(0);return e>=BD&&e<=FD}function _g(n,e,t){return n.length===e.length&&n.every(((a,d)=>t(a,e[d])))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xT="__name__";class $h{constructor(e,t,a){t===void 0?t=0:t>e.length&&Zn(637,{offset:t,range:e.length}),a===void 0?a=e.length-t:a>e.length-t&&Zn(1746,{length:a,range:e.length-t}),this.segments=e,this.offset=t,this.len=a}get length(){return this.len}isEqual(e){return $h.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof $h?e.forEach((a=>{t.push(a)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,a=this.limit();t<a;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const a=Math.min(e.length,t.length);for(let d=0;d<a;d++){const m=$h.compareSegments(e.get(d),t.get(d));if(m!==0)return m}return Ni(e.length,t.length)}static compareSegments(e,t){const a=$h.isNumericId(e),d=$h.isNumericId(t);return a&&!d?-1:!a&&d?1:a&&d?$h.extractNumericId(e).compare($h.extractNumericId(t)):c1(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Vf.fromString(e.substring(4,e.length-2))}}class ta extends $h{construct(e,t,a){return new ta(e,t,a)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const a of e){if(a.indexOf("//")>=0)throw new _n(Lt.INVALID_ARGUMENT,`Invalid segment (${a}). Paths must not contain // in them.`);t.push(...a.split("/").filter((d=>d.length>0)))}return new ta(t)}static emptyPath(){return new ta([])}}const VD=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class nl extends $h{construct(e,t,a){return new nl(e,t,a)}static isValidIdentifier(e){return VD.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),nl.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===xT}static keyField(){return new nl([xT])}static fromServerFormat(e){const t=[];let a="",d=0;const m=()=>{if(a.length===0)throw new _n(Lt.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(a),a=""};let g=!1;for(;d<e.length;){const c=e[d];if(c==="\\"){if(d+1===e.length)throw new _n(Lt.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const C=e[d+1];if(C!=="\\"&&C!=="."&&C!=="`")throw new _n(Lt.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);a+=C,d+=2}else c==="`"?(g=!g,d++):c!=="."||g?(a+=c,d++):(m(),d++)}if(m(),g)throw new _n(Lt.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new nl(t)}static emptyPath(){return new nl([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class On{constructor(e){this.path=e}static fromPath(e){return new On(ta.fromString(e))}static fromName(e){return new On(ta.fromString(e).popFirst(5))}static empty(){return new On(ta.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&ta.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return ta.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new On(new ta(e.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tC(n,e,t){if(!t)throw new _n(Lt.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function UD(n,e,t,a){if(e===!0&&a===!0)throw new _n(Lt.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function wT(n){if(!On.isDocumentKey(n))throw new _n(Lt.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function TT(n){if(On.isDocumentKey(n))throw new _n(Lt.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function nC(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function _b(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=(function(a){return a.constructor?a.constructor.name:null})(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":Zn(12329,{type:typeof n})}function O0(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new _n(Lt.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=_b(n);throw new _n(Lt.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Os(n,e){const t={typeString:n};return e&&(t.value=e),t}function Ny(n,e){if(!nC(n))throw new _n(Lt.INVALID_ARGUMENT,"JSON must be an object");let t;for(const a in e)if(e[a]){const d=e[a].typeString,m="value"in e[a]?{value:e[a].value}:void 0;if(!(a in n)){t=`JSON missing required field: '${a}'`;break}const g=n[a];if(d&&typeof g!==d){t=`JSON field '${a}' must be a ${d}.`;break}if(m!==void 0&&g!==m.value){t=`Expected '${a}' field to equal '${m.value}'`;break}}if(t)throw new _n(Lt.INVALID_ARGUMENT,t);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ST=-62135596800,ET=1e6;class da{static now(){return da.fromMillis(Date.now())}static fromDate(e){return da.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),a=Math.floor((e-1e3*t)*ET);return new da(t,a)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new _n(Lt.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new _n(Lt.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<ST)throw new _n(Lt.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new _n(Lt.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/ET}_compareTo(e){return this.seconds===e.seconds?Ni(this.nanoseconds,e.nanoseconds):Ni(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:da._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(Ny(e,da._jsonSchema))return new da(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-ST;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}da._jsonSchemaVersion="firestore/timestamp/1.0",da._jsonSchema={type:Os("string",da._jsonSchemaVersion),seconds:Os("number"),nanoseconds:Os("number")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ni{static fromTimestamp(e){return new ni(e)}static min(){return new ni(new da(0,0))}static max(){return new ni(new da(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dy=-1;function jD(n,e){const t=n.toTimestamp().seconds,a=n.toTimestamp().nanoseconds+1,d=ni.fromTimestamp(a===1e9?new da(t+1,0):new da(t,a));return new Gf(d,On.empty(),e)}function $D(n){return new Gf(n.readTime,n.key,dy)}class Gf{constructor(e,t,a){this.readTime=e,this.documentKey=t,this.largestBatchId=a}static min(){return new Gf(ni.min(),On.empty(),dy)}static max(){return new Gf(ni.max(),On.empty(),dy)}}function qD(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=On.comparator(n.documentKey,e.documentKey),t!==0?t:Ni(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GD="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class HD{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Mg(n){if(n.code!==Lt.FAILED_PRECONDITION||n.message!==GD)throw n;gn("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dt{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Zn(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new Dt(((a,d)=>{this.nextCallback=m=>{this.wrapSuccess(e,m).next(a,d)},this.catchCallback=m=>{this.wrapFailure(t,m).next(a,d)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof Dt?t:Dt.resolve(t)}catch(t){return Dt.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):Dt.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):Dt.reject(t)}static resolve(e){return new Dt(((t,a)=>{t(e)}))}static reject(e){return new Dt(((t,a)=>{a(e)}))}static waitFor(e){return new Dt(((t,a)=>{let d=0,m=0,g=!1;e.forEach((c=>{++d,c.next((()=>{++m,g&&m===d&&t()}),(C=>a(C)))})),g=!0,m===d&&t()}))}static or(e){let t=Dt.resolve(!1);for(const a of e)t=t.next((d=>d?Dt.resolve(d):a()));return t}static forEach(e,t){const a=[];return e.forEach(((d,m)=>{a.push(t.call(this,d,m))})),this.waitFor(a)}static mapArray(e,t){return new Dt(((a,d)=>{const m=e.length,g=new Array(m);let c=0;for(let C=0;C<m;C++){const R=C;t(e[R]).next((V=>{g[R]=V,++c,c===m&&a(g)}),(V=>d(V)))}}))}static doWhile(e,t){return new Dt(((a,d)=>{const m=()=>{e()===!0?t().next((()=>{m()}),d):a()};m()}))}}function ZD(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function Rg(n){return n.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yb{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=a=>this.ae(a),this.ue=a=>t.writeSequenceNumber(a))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}yb.ce=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mw=-1;function vb(n){return n==null}function N0(n){return n===0&&1/n==-1/0}function WD(n){return typeof n=="number"&&Number.isInteger(n)&&!N0(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iC="";function KD(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=AT(e)),e=XD(n.get(t),e);return AT(e)}function XD(n,e){let t=e;const a=n.length;for(let d=0;d<a;d++){const m=n.charAt(d);switch(m){case"\0":t+="";break;case iC:t+="";break;default:t+=m}}return t}function AT(n){return n+iC+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function CT(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function sm(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function rC(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Va{constructor(e,t){this.comparator=e,this.root=t||tl.EMPTY}insert(e,t){return new Va(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,tl.BLACK,null,null))}remove(e){return new Va(this.comparator,this.root.remove(e,this.comparator).copy(null,null,tl.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const a=this.comparator(e,t.key);if(a===0)return t.value;a<0?t=t.left:a>0&&(t=t.right)}return null}indexOf(e){let t=0,a=this.root;for(;!a.isEmpty();){const d=this.comparator(e,a.key);if(d===0)return t+a.left.size;d<0?a=a.left:(t+=a.left.size+1,a=a.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,a)=>(e(t,a),!1)))}toString(){const e=[];return this.inorderTraversal(((t,a)=>(e.push(`${t}:${a}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new $v(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new $v(this.root,e,this.comparator,!1)}getReverseIterator(){return new $v(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new $v(this.root,e,this.comparator,!0)}}class $v{constructor(e,t,a,d){this.isReverse=d,this.nodeStack=[];let m=1;for(;!e.isEmpty();)if(m=t?a(e.key,t):1,t&&d&&(m*=-1),m<0)e=this.isReverse?e.left:e.right;else{if(m===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class tl{constructor(e,t,a,d,m){this.key=e,this.value=t,this.color=a??tl.RED,this.left=d??tl.EMPTY,this.right=m??tl.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,a,d,m){return new tl(e??this.key,t??this.value,a??this.color,d??this.left,m??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,a){let d=this;const m=a(e,d.key);return d=m<0?d.copy(null,null,null,d.left.insert(e,t,a),null):m===0?d.copy(null,t,null,null,null):d.copy(null,null,null,null,d.right.insert(e,t,a)),d.fixUp()}removeMin(){if(this.left.isEmpty())return tl.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let a,d=this;if(t(e,d.key)<0)d.left.isEmpty()||d.left.isRed()||d.left.left.isRed()||(d=d.moveRedLeft()),d=d.copy(null,null,null,d.left.remove(e,t),null);else{if(d.left.isRed()&&(d=d.rotateRight()),d.right.isEmpty()||d.right.isRed()||d.right.left.isRed()||(d=d.moveRedRight()),t(e,d.key)===0){if(d.right.isEmpty())return tl.EMPTY;a=d.right.min(),d=d.copy(a.key,a.value,null,null,d.right.removeMin())}d=d.copy(null,null,null,null,d.right.remove(e,t))}return d.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,tl.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,tl.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Zn(43730,{key:this.key,value:this.value});if(this.right.isRed())throw Zn(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw Zn(27949);return e+(this.isRed()?0:1)}}tl.EMPTY=null,tl.RED=!0,tl.BLACK=!1;tl.EMPTY=new class{constructor(){this.size=0}get key(){throw Zn(57766)}get value(){throw Zn(16141)}get color(){throw Zn(16727)}get left(){throw Zn(29726)}get right(){throw Zn(36894)}copy(e,t,a,d,m){return this}insert(e,t,a){return new tl(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ao{constructor(e){this.comparator=e,this.data=new Va(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,a)=>(e(t),!1)))}forEachInRange(e,t){const a=this.data.getIteratorFrom(e[0]);for(;a.hasNext();){const d=a.getNext();if(this.comparator(d.key,e[1])>=0)return;t(d.key)}}forEachWhile(e,t){let a;for(a=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();a.hasNext();)if(!e(a.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new IT(this.data.getIterator())}getIteratorFrom(e){return new IT(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((a=>{t=t.add(a)})),t}isEqual(e){if(!(e instanceof ao)||this.size!==e.size)return!1;const t=this.data.getIterator(),a=e.data.getIterator();for(;t.hasNext();){const d=t.getNext().key,m=a.getNext().key;if(this.comparator(d,m)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new ao(this.comparator);return t.data=e,t}}class IT{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lh{constructor(e){this.fields=e,e.sort(nl.comparator)}static empty(){return new lh([])}unionWith(e){let t=new ao(nl.comparator);for(const a of this.fields)t=t.add(a);for(const a of e)t=t.add(a);return new lh(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return _g(this.fields,e.fields,((t,a)=>t.isEqual(a)))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aC extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class il{constructor(e){this.binaryString=e}static fromBase64String(e){const t=(function(d){try{return atob(d)}catch(m){throw typeof DOMException<"u"&&m instanceof DOMException?new aC("Invalid base64 string: "+m):m}})(e);return new il(t)}static fromUint8Array(e){const t=(function(d){let m="";for(let g=0;g<d.length;++g)m+=String.fromCharCode(d[g]);return m})(e);return new il(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(t){return btoa(t)})(this.binaryString)}toUint8Array(){return(function(t){const a=new Uint8Array(t.length);for(let d=0;d<t.length;d++)a[d]=t.charCodeAt(d);return a})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Ni(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}il.EMPTY_BYTE_STRING=new il("");const YD=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Hf(n){if(Cr(!!n,39018),typeof n=="string"){let e=0;const t=YD.exec(n);if(Cr(!!t,46558,{timestamp:n}),t[1]){let d=t[1];d=(d+"000000000").substr(0,9),e=Number(d)}const a=new Date(n);return{seconds:Math.floor(a.getTime()/1e3),nanos:e}}return{seconds:ds(n.seconds),nanos:ds(n.nanos)}}function ds(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Zf(n){return typeof n=="string"?il.fromBase64String(n):il.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sC="server_timestamp",oC="__type__",lC="__previous_value__",uC="__local_write_time__";function gw(n){var t,a;return((a=(((t=n==null?void 0:n.mapValue)==null?void 0:t.fields)||{})[oC])==null?void 0:a.stringValue)===sC}function bb(n){const e=n.mapValue.fields[lC];return gw(e)?bb(e):e}function fy(n){const e=Hf(n.mapValue.fields[uC].timestampValue);return new da(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QD{constructor(e,t,a,d,m,g,c,C,R,V){this.databaseId=e,this.appId=t,this.persistenceKey=a,this.host=d,this.ssl=m,this.forceLongPolling=g,this.autoDetectLongPolling=c,this.longPollingOptions=C,this.useFetchStreams=R,this.isUsingEmulator=V}}const B0="(default)";class py{constructor(e,t){this.projectId=e,this.database=t||B0}static empty(){return new py("","")}get isDefaultDatabase(){return this.database===B0}isEqual(e){return e instanceof py&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cC="__type__",JD="__max__",qv={mapValue:{}},hC="__vector__",F0="value";function Wf(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?gw(n)?4:t5(n)?9007199254740991:e5(n)?10:11:Zn(28295,{value:n})}function nd(n,e){if(n===e)return!0;const t=Wf(n);if(t!==Wf(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return fy(n).isEqual(fy(e));case 3:return(function(d,m){if(typeof d.timestampValue=="string"&&typeof m.timestampValue=="string"&&d.timestampValue.length===m.timestampValue.length)return d.timestampValue===m.timestampValue;const g=Hf(d.timestampValue),c=Hf(m.timestampValue);return g.seconds===c.seconds&&g.nanos===c.nanos})(n,e);case 5:return n.stringValue===e.stringValue;case 6:return(function(d,m){return Zf(d.bytesValue).isEqual(Zf(m.bytesValue))})(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return(function(d,m){return ds(d.geoPointValue.latitude)===ds(m.geoPointValue.latitude)&&ds(d.geoPointValue.longitude)===ds(m.geoPointValue.longitude)})(n,e);case 2:return(function(d,m){if("integerValue"in d&&"integerValue"in m)return ds(d.integerValue)===ds(m.integerValue);if("doubleValue"in d&&"doubleValue"in m){const g=ds(d.doubleValue),c=ds(m.doubleValue);return g===c?N0(g)===N0(c):isNaN(g)&&isNaN(c)}return!1})(n,e);case 9:return _g(n.arrayValue.values||[],e.arrayValue.values||[],nd);case 10:case 11:return(function(d,m){const g=d.mapValue.fields||{},c=m.mapValue.fields||{};if(CT(g)!==CT(c))return!1;for(const C in g)if(g.hasOwnProperty(C)&&(c[C]===void 0||!nd(g[C],c[C])))return!1;return!0})(n,e);default:return Zn(52216,{left:n})}}function my(n,e){return(n.values||[]).find((t=>nd(t,e)))!==void 0}function yg(n,e){if(n===e)return 0;const t=Wf(n),a=Wf(e);if(t!==a)return Ni(t,a);switch(t){case 0:case 9007199254740991:return 0;case 1:return Ni(n.booleanValue,e.booleanValue);case 2:return(function(m,g){const c=ds(m.integerValue||m.doubleValue),C=ds(g.integerValue||g.doubleValue);return c<C?-1:c>C?1:c===C?0:isNaN(c)?isNaN(C)?0:-1:1})(n,e);case 3:return PT(n.timestampValue,e.timestampValue);case 4:return PT(fy(n),fy(e));case 5:return c1(n.stringValue,e.stringValue);case 6:return(function(m,g){const c=Zf(m),C=Zf(g);return c.compareTo(C)})(n.bytesValue,e.bytesValue);case 7:return(function(m,g){const c=m.split("/"),C=g.split("/");for(let R=0;R<c.length&&R<C.length;R++){const V=Ni(c[R],C[R]);if(V!==0)return V}return Ni(c.length,C.length)})(n.referenceValue,e.referenceValue);case 8:return(function(m,g){const c=Ni(ds(m.latitude),ds(g.latitude));return c!==0?c:Ni(ds(m.longitude),ds(g.longitude))})(n.geoPointValue,e.geoPointValue);case 9:return MT(n.arrayValue,e.arrayValue);case 10:return(function(m,g){var J,Y,xe,be;const c=m.fields||{},C=g.fields||{},R=(J=c[F0])==null?void 0:J.arrayValue,V=(Y=C[F0])==null?void 0:Y.arrayValue,q=Ni(((xe=R==null?void 0:R.values)==null?void 0:xe.length)||0,((be=V==null?void 0:V.values)==null?void 0:be.length)||0);return q!==0?q:MT(R,V)})(n.mapValue,e.mapValue);case 11:return(function(m,g){if(m===qv.mapValue&&g===qv.mapValue)return 0;if(m===qv.mapValue)return 1;if(g===qv.mapValue)return-1;const c=m.fields||{},C=Object.keys(c),R=g.fields||{},V=Object.keys(R);C.sort(),V.sort();for(let q=0;q<C.length&&q<V.length;++q){const J=c1(C[q],V[q]);if(J!==0)return J;const Y=yg(c[C[q]],R[V[q]]);if(Y!==0)return Y}return Ni(C.length,V.length)})(n.mapValue,e.mapValue);default:throw Zn(23264,{he:t})}}function PT(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return Ni(n,e);const t=Hf(n),a=Hf(e),d=Ni(t.seconds,a.seconds);return d!==0?d:Ni(t.nanos,a.nanos)}function MT(n,e){const t=n.values||[],a=e.values||[];for(let d=0;d<t.length&&d<a.length;++d){const m=yg(t[d],a[d]);if(m)return m}return Ni(t.length,a.length)}function vg(n){return h1(n)}function h1(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?(function(t){const a=Hf(t);return`time(${a.seconds},${a.nanos})`})(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?(function(t){return Zf(t).toBase64()})(n.bytesValue):"referenceValue"in n?(function(t){return On.fromName(t).toString()})(n.referenceValue):"geoPointValue"in n?(function(t){return`geo(${t.latitude},${t.longitude})`})(n.geoPointValue):"arrayValue"in n?(function(t){let a="[",d=!0;for(const m of t.values||[])d?d=!1:a+=",",a+=h1(m);return a+"]"})(n.arrayValue):"mapValue"in n?(function(t){const a=Object.keys(t.fields||{}).sort();let d="{",m=!0;for(const g of a)m?m=!1:d+=",",d+=`${g}:${h1(t.fields[g])}`;return d+"}"})(n.mapValue):Zn(61005,{value:n})}function o0(n){switch(Wf(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=bb(n);return e?16+o0(e):16;case 5:return 2*n.stringValue.length;case 6:return Zf(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return(function(a){return(a.values||[]).reduce(((d,m)=>d+o0(m)),0)})(n.arrayValue);case 10:case 11:return(function(a){let d=0;return sm(a.fields,((m,g)=>{d+=m.length+o0(g)})),d})(n.mapValue);default:throw Zn(13486,{value:n})}}function RT(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function d1(n){return!!n&&"integerValue"in n}function _w(n){return!!n&&"arrayValue"in n}function kT(n){return!!n&&"nullValue"in n}function LT(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function l0(n){return!!n&&"mapValue"in n}function e5(n){var t,a;return((a=(((t=n==null?void 0:n.mapValue)==null?void 0:t.fields)||{})[cC])==null?void 0:a.stringValue)===hC}function J_(n){if(n.geoPointValue)return{geoPointValue:{...n.geoPointValue}};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:{...n.timestampValue}};if(n.mapValue){const e={mapValue:{fields:{}}};return sm(n.mapValue.fields,((t,a)=>e.mapValue.fields[t]=J_(a))),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=J_(n.arrayValue.values[t]);return e}return{...n}}function t5(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===JD}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kc{constructor(e){this.value=e}static empty(){return new kc({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let a=0;a<e.length-1;++a)if(t=(t.mapValue.fields||{})[e.get(a)],!l0(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=J_(t)}setAll(e){let t=nl.emptyPath(),a={},d=[];e.forEach(((g,c)=>{if(!t.isImmediateParentOf(c)){const C=this.getFieldsMap(t);this.applyChanges(C,a,d),a={},d=[],t=c.popLast()}g?a[c.lastSegment()]=J_(g):d.push(c.lastSegment())}));const m=this.getFieldsMap(t);this.applyChanges(m,a,d)}delete(e){const t=this.field(e.popLast());l0(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return nd(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let a=0;a<e.length;++a){let d=t.mapValue.fields[e.get(a)];l0(d)&&d.mapValue.fields||(d={mapValue:{fields:{}}},t.mapValue.fields[e.get(a)]=d),t=d}return t.mapValue.fields}applyChanges(e,t,a){sm(t,((d,m)=>e[d]=m));for(const d of a)delete e[d]}clone(){return new kc(J_(this.value))}}function dC(n){const e=[];return sm(n.fields,((t,a)=>{const d=new nl([t]);if(l0(a)){const m=dC(a.mapValue).fields;if(m.length===0)e.push(d);else for(const g of m)e.push(d.child(g))}else e.push(d)})),new lh(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rl{constructor(e,t,a,d,m,g,c){this.key=e,this.documentType=t,this.version=a,this.readTime=d,this.createTime=m,this.data=g,this.documentState=c}static newInvalidDocument(e){return new Rl(e,0,ni.min(),ni.min(),ni.min(),kc.empty(),0)}static newFoundDocument(e,t,a,d){return new Rl(e,1,t,ni.min(),a,d,0)}static newNoDocument(e,t){return new Rl(e,2,t,ni.min(),ni.min(),kc.empty(),0)}static newUnknownDocument(e,t){return new Rl(e,3,t,ni.min(),ni.min(),kc.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(ni.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=kc.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=kc.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ni.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Rl&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Rl(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class V0{constructor(e,t){this.position=e,this.inclusive=t}}function DT(n,e,t){let a=0;for(let d=0;d<n.position.length;d++){const m=e[d],g=n.position[d];if(m.field.isKeyField()?a=On.comparator(On.fromName(g.referenceValue),t.key):a=yg(g,t.data.field(m.field)),m.dir==="desc"&&(a*=-1),a!==0)break}return a}function zT(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!nd(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class U0{constructor(e,t="asc"){this.field=e,this.dir=t}}function n5(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fC{}class zs extends fC{constructor(e,t,a){super(),this.field=e,this.op=t,this.value=a}static create(e,t,a){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,a):new r5(e,t,a):t==="array-contains"?new o5(e,a):t==="in"?new l5(e,a):t==="not-in"?new u5(e,a):t==="array-contains-any"?new c5(e,a):new zs(e,t,a)}static createKeyFieldInFilter(e,t,a){return t==="in"?new a5(e,a):new s5(e,a)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(yg(t,this.value)):t!==null&&Wf(this.value)===Wf(t)&&this.matchesComparison(yg(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Zn(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class ph extends fC{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new ph(e,t)}matches(e){return pC(this)?this.filters.find((t=>!t.matches(e)))===void 0:this.filters.find((t=>t.matches(e)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function pC(n){return n.op==="and"}function mC(n){return i5(n)&&pC(n)}function i5(n){for(const e of n.filters)if(e instanceof ph)return!1;return!0}function f1(n){if(n instanceof zs)return n.field.canonicalString()+n.op.toString()+vg(n.value);if(mC(n))return n.filters.map((e=>f1(e))).join(",");{const e=n.filters.map((t=>f1(t))).join(",");return`${n.op}(${e})`}}function gC(n,e){return n instanceof zs?(function(a,d){return d instanceof zs&&a.op===d.op&&a.field.isEqual(d.field)&&nd(a.value,d.value)})(n,e):n instanceof ph?(function(a,d){return d instanceof ph&&a.op===d.op&&a.filters.length===d.filters.length?a.filters.reduce(((m,g,c)=>m&&gC(g,d.filters[c])),!0):!1})(n,e):void Zn(19439)}function _C(n){return n instanceof zs?(function(t){return`${t.field.canonicalString()} ${t.op} ${vg(t.value)}`})(n):n instanceof ph?(function(t){return t.op.toString()+" {"+t.getFilters().map(_C).join(" ,")+"}"})(n):"Filter"}class r5 extends zs{constructor(e,t,a){super(e,t,a),this.key=On.fromName(a.referenceValue)}matches(e){const t=On.comparator(e.key,this.key);return this.matchesComparison(t)}}class a5 extends zs{constructor(e,t){super(e,"in",t),this.keys=yC("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class s5 extends zs{constructor(e,t){super(e,"not-in",t),this.keys=yC("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function yC(n,e){var t;return(((t=e.arrayValue)==null?void 0:t.values)||[]).map((a=>On.fromName(a.referenceValue)))}class o5 extends zs{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return _w(t)&&my(t.arrayValue,this.value)}}class l5 extends zs{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&my(this.value.arrayValue,t)}}class u5 extends zs{constructor(e,t){super(e,"not-in",t)}matches(e){if(my(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!my(this.value.arrayValue,t)}}class c5 extends zs{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!_w(t)||!t.arrayValue.values)&&t.arrayValue.values.some((a=>my(this.value.arrayValue,a)))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h5{constructor(e,t=null,a=[],d=[],m=null,g=null,c=null){this.path=e,this.collectionGroup=t,this.orderBy=a,this.filters=d,this.limit=m,this.startAt=g,this.endAt=c,this.Te=null}}function OT(n,e=null,t=[],a=[],d=null,m=null,g=null){return new h5(n,e,t,a,d,m,g)}function yw(n){const e=si(n);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((a=>f1(a))).join(","),t+="|ob:",t+=e.orderBy.map((a=>(function(m){return m.field.canonicalString()+m.dir})(a))).join(","),vb(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((a=>vg(a))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((a=>vg(a))).join(",")),e.Te=t}return e.Te}function vw(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!n5(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!gC(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!zT(n.startAt,e.startAt)&&zT(n.endAt,e.endAt)}function p1(n){return On.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class By{constructor(e,t=null,a=[],d=[],m=null,g="F",c=null,C=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=a,this.filters=d,this.limit=m,this.limitType=g,this.startAt=c,this.endAt=C,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function d5(n,e,t,a,d,m,g,c){return new By(n,e,t,a,d,m,g,c)}function vC(n){return new By(n)}function NT(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function bC(n){return n.collectionGroup!==null}function ey(n){const e=si(n);if(e.Ie===null){e.Ie=[];const t=new Set;for(const m of e.explicitOrderBy)e.Ie.push(m),t.add(m.field.canonicalString());const a=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(g){let c=new ao(nl.comparator);return g.filters.forEach((C=>{C.getFlattenedFilters().forEach((R=>{R.isInequality()&&(c=c.add(R.field))}))})),c})(e).forEach((m=>{t.has(m.canonicalString())||m.isKeyField()||e.Ie.push(new U0(m,a))})),t.has(nl.keyField().canonicalString())||e.Ie.push(new U0(nl.keyField(),a))}return e.Ie}function Hh(n){const e=si(n);return e.Ee||(e.Ee=f5(e,ey(n))),e.Ee}function f5(n,e){if(n.limitType==="F")return OT(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map((d=>{const m=d.dir==="desc"?"asc":"desc";return new U0(d.field,m)}));const t=n.endAt?new V0(n.endAt.position,n.endAt.inclusive):null,a=n.startAt?new V0(n.startAt.position,n.startAt.inclusive):null;return OT(n.path,n.collectionGroup,e,n.filters,n.limit,t,a)}}function m1(n,e){const t=n.filters.concat([e]);return new By(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function g1(n,e,t){return new By(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function xb(n,e){return vw(Hh(n),Hh(e))&&n.limitType===e.limitType}function xC(n){return`${yw(Hh(n))}|lt:${n.limitType}`}function Jm(n){return`Query(target=${(function(t){let a=t.path.canonicalString();return t.collectionGroup!==null&&(a+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(a+=`, filters: [${t.filters.map((d=>_C(d))).join(", ")}]`),vb(t.limit)||(a+=", limit: "+t.limit),t.orderBy.length>0&&(a+=`, orderBy: [${t.orderBy.map((d=>(function(g){return`${g.field.canonicalString()} (${g.dir})`})(d))).join(", ")}]`),t.startAt&&(a+=", startAt: ",a+=t.startAt.inclusive?"b:":"a:",a+=t.startAt.position.map((d=>vg(d))).join(",")),t.endAt&&(a+=", endAt: ",a+=t.endAt.inclusive?"a:":"b:",a+=t.endAt.position.map((d=>vg(d))).join(",")),`Target(${a})`})(Hh(n))}; limitType=${n.limitType})`}function wb(n,e){return e.isFoundDocument()&&(function(a,d){const m=d.key.path;return a.collectionGroup!==null?d.key.hasCollectionId(a.collectionGroup)&&a.path.isPrefixOf(m):On.isDocumentKey(a.path)?a.path.isEqual(m):a.path.isImmediateParentOf(m)})(n,e)&&(function(a,d){for(const m of ey(a))if(!m.field.isKeyField()&&d.data.field(m.field)===null)return!1;return!0})(n,e)&&(function(a,d){for(const m of a.filters)if(!m.matches(d))return!1;return!0})(n,e)&&(function(a,d){return!(a.startAt&&!(function(g,c,C){const R=DT(g,c,C);return g.inclusive?R<=0:R<0})(a.startAt,ey(a),d)||a.endAt&&!(function(g,c,C){const R=DT(g,c,C);return g.inclusive?R>=0:R>0})(a.endAt,ey(a),d))})(n,e)}function p5(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function wC(n){return(e,t)=>{let a=!1;for(const d of ey(n)){const m=m5(d,e,t);if(m!==0)return m;a=a||d.field.isKeyField()}return 0}}function m5(n,e,t){const a=n.field.isKeyField()?On.comparator(e.key,t.key):(function(m,g,c){const C=g.data.field(m),R=c.data.field(m);return C!==null&&R!==null?yg(C,R):Zn(42886)})(n.field,e,t);switch(n.dir){case"asc":return a;case"desc":return-1*a;default:return Zn(19790,{direction:n.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class om{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),a=this.inner[t];if(a!==void 0){for(const[d,m]of a)if(this.equalsFn(d,e))return m}}has(e){return this.get(e)!==void 0}set(e,t){const a=this.mapKeyFn(e),d=this.inner[a];if(d===void 0)return this.inner[a]=[[e,t]],void this.innerSize++;for(let m=0;m<d.length;m++)if(this.equalsFn(d[m][0],e))return void(d[m]=[e,t]);d.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),a=this.inner[t];if(a===void 0)return!1;for(let d=0;d<a.length;d++)if(this.equalsFn(a[d][0],e))return a.length===1?delete this.inner[t]:a.splice(d,1),this.innerSize--,!0;return!1}forEach(e){sm(this.inner,((t,a)=>{for(const[d,m]of a)e(d,m)}))}isEmpty(){return rC(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const g5=new Va(On.comparator);function Zd(){return g5}const TC=new Va(On.comparator);function q_(...n){let e=TC;for(const t of n)e=e.insert(t.key,t);return e}function SC(n){let e=TC;return n.forEach(((t,a)=>e=e.insert(t,a.overlayedDocument))),e}function Up(){return ty()}function EC(){return ty()}function ty(){return new om((n=>n.toString()),((n,e)=>n.isEqual(e)))}const _5=new Va(On.comparator),y5=new ao(On.comparator);function Bi(...n){let e=y5;for(const t of n)e=e.add(t);return e}const v5=new ao(Ni);function b5(){return v5}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bw(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:N0(e)?"-0":e}}function AC(n){return{integerValue:""+n}}function x5(n,e){return WD(e)?AC(e):bw(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tb{constructor(){this._=void 0}}function w5(n,e,t){return n instanceof gy?(function(d,m){const g={fields:{[oC]:{stringValue:sC},[uC]:{timestampValue:{seconds:d.seconds,nanos:d.nanoseconds}}}};return m&&gw(m)&&(m=bb(m)),m&&(g.fields[lC]=m),{mapValue:g}})(t,e):n instanceof _y?IC(n,e):n instanceof yy?PC(n,e):(function(d,m){const g=CC(d,m),c=BT(g)+BT(d.Ae);return d1(g)&&d1(d.Ae)?AC(c):bw(d.serializer,c)})(n,e)}function T5(n,e,t){return n instanceof _y?IC(n,e):n instanceof yy?PC(n,e):t}function CC(n,e){return n instanceof j0?(function(a){return d1(a)||(function(m){return!!m&&"doubleValue"in m})(a)})(e)?e:{integerValue:0}:null}class gy extends Tb{}class _y extends Tb{constructor(e){super(),this.elements=e}}function IC(n,e){const t=MC(e);for(const a of n.elements)t.some((d=>nd(d,a)))||t.push(a);return{arrayValue:{values:t}}}class yy extends Tb{constructor(e){super(),this.elements=e}}function PC(n,e){let t=MC(e);for(const a of n.elements)t=t.filter((d=>!nd(d,a)));return{arrayValue:{values:t}}}class j0 extends Tb{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function BT(n){return ds(n.integerValue||n.doubleValue)}function MC(n){return _w(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class S5{constructor(e,t){this.field=e,this.transform=t}}function E5(n,e){return n.field.isEqual(e.field)&&(function(a,d){return a instanceof _y&&d instanceof _y||a instanceof yy&&d instanceof yy?_g(a.elements,d.elements,nd):a instanceof j0&&d instanceof j0?nd(a.Ae,d.Ae):a instanceof gy&&d instanceof gy})(n.transform,e.transform)}class A5{constructor(e,t){this.version=e,this.transformResults=t}}class Ud{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Ud}static exists(e){return new Ud(void 0,e)}static updateTime(e){return new Ud(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function u0(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class Sb{}function RC(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new LC(n.key,Ud.none()):new Fy(n.key,n.data,Ud.none());{const t=n.data,a=kc.empty();let d=new ao(nl.comparator);for(let m of e.fields)if(!d.has(m)){let g=t.field(m);g===null&&m.length>1&&(m=m.popLast(),g=t.field(m)),g===null?a.delete(m):a.set(m,g),d=d.add(m)}return new lm(n.key,a,new lh(d.toArray()),Ud.none())}}function C5(n,e,t){n instanceof Fy?(function(d,m,g){const c=d.value.clone(),C=VT(d.fieldTransforms,m,g.transformResults);c.setAll(C),m.convertToFoundDocument(g.version,c).setHasCommittedMutations()})(n,e,t):n instanceof lm?(function(d,m,g){if(!u0(d.precondition,m))return void m.convertToUnknownDocument(g.version);const c=VT(d.fieldTransforms,m,g.transformResults),C=m.data;C.setAll(kC(d)),C.setAll(c),m.convertToFoundDocument(g.version,C).setHasCommittedMutations()})(n,e,t):(function(d,m,g){m.convertToNoDocument(g.version).setHasCommittedMutations()})(0,e,t)}function ny(n,e,t,a){return n instanceof Fy?(function(m,g,c,C){if(!u0(m.precondition,g))return c;const R=m.value.clone(),V=UT(m.fieldTransforms,C,g);return R.setAll(V),g.convertToFoundDocument(g.version,R).setHasLocalMutations(),null})(n,e,t,a):n instanceof lm?(function(m,g,c,C){if(!u0(m.precondition,g))return c;const R=UT(m.fieldTransforms,C,g),V=g.data;return V.setAll(kC(m)),V.setAll(R),g.convertToFoundDocument(g.version,V).setHasLocalMutations(),c===null?null:c.unionWith(m.fieldMask.fields).unionWith(m.fieldTransforms.map((q=>q.field)))})(n,e,t,a):(function(m,g,c){return u0(m.precondition,g)?(g.convertToNoDocument(g.version).setHasLocalMutations(),null):c})(n,e,t)}function I5(n,e){let t=null;for(const a of n.fieldTransforms){const d=e.data.field(a.field),m=CC(a.transform,d||null);m!=null&&(t===null&&(t=kc.empty()),t.set(a.field,m))}return t||null}function FT(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!(function(a,d){return a===void 0&&d===void 0||!(!a||!d)&&_g(a,d,((m,g)=>E5(m,g)))})(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class Fy extends Sb{constructor(e,t,a,d=[]){super(),this.key=e,this.value=t,this.precondition=a,this.fieldTransforms=d,this.type=0}getFieldMask(){return null}}class lm extends Sb{constructor(e,t,a,d,m=[]){super(),this.key=e,this.data=t,this.fieldMask=a,this.precondition=d,this.fieldTransforms=m,this.type=1}getFieldMask(){return this.fieldMask}}function kC(n){const e=new Map;return n.fieldMask.fields.forEach((t=>{if(!t.isEmpty()){const a=n.data.field(t);e.set(t,a)}})),e}function VT(n,e,t){const a=new Map;Cr(n.length===t.length,32656,{Re:t.length,Ve:n.length});for(let d=0;d<t.length;d++){const m=n[d],g=m.transform,c=e.data.field(m.field);a.set(m.field,T5(g,c,t[d]))}return a}function UT(n,e,t){const a=new Map;for(const d of n){const m=d.transform,g=t.data.field(d.field);a.set(d.field,w5(m,g,e))}return a}class LC extends Sb{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class P5 extends Sb{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class M5{constructor(e,t,a,d){this.batchId=e,this.localWriteTime=t,this.baseMutations=a,this.mutations=d}applyToRemoteDocument(e,t){const a=t.mutationResults;for(let d=0;d<this.mutations.length;d++){const m=this.mutations[d];m.key.isEqual(e.key)&&C5(m,e,a[d])}}applyToLocalView(e,t){for(const a of this.baseMutations)a.key.isEqual(e.key)&&(t=ny(a,e,t,this.localWriteTime));for(const a of this.mutations)a.key.isEqual(e.key)&&(t=ny(a,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const a=EC();return this.mutations.forEach((d=>{const m=e.get(d.key),g=m.overlayedDocument;let c=this.applyToLocalView(g,m.mutatedFields);c=t.has(d.key)?null:c;const C=RC(g,c);C!==null&&a.set(d.key,C),g.isValidDocument()||g.convertToNoDocument(ni.min())})),a}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),Bi())}isEqual(e){return this.batchId===e.batchId&&_g(this.mutations,e.mutations,((t,a)=>FT(t,a)))&&_g(this.baseMutations,e.baseMutations,((t,a)=>FT(t,a)))}}class xw{constructor(e,t,a,d){this.batch=e,this.commitVersion=t,this.mutationResults=a,this.docVersions=d}static from(e,t,a){Cr(e.mutations.length===a.length,58842,{me:e.mutations.length,fe:a.length});let d=(function(){return _5})();const m=e.mutations;for(let g=0;g<m.length;g++)d=d.insert(m[g].key,a[g].version);return new xw(e,t,a,d)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class R5{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class k5{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ds,Ji;function L5(n){switch(n){case Lt.OK:return Zn(64938);case Lt.CANCELLED:case Lt.UNKNOWN:case Lt.DEADLINE_EXCEEDED:case Lt.RESOURCE_EXHAUSTED:case Lt.INTERNAL:case Lt.UNAVAILABLE:case Lt.UNAUTHENTICATED:return!1;case Lt.INVALID_ARGUMENT:case Lt.NOT_FOUND:case Lt.ALREADY_EXISTS:case Lt.PERMISSION_DENIED:case Lt.FAILED_PRECONDITION:case Lt.ABORTED:case Lt.OUT_OF_RANGE:case Lt.UNIMPLEMENTED:case Lt.DATA_LOSS:return!0;default:return Zn(15467,{code:n})}}function DC(n){if(n===void 0)return Hd("GRPC error has no .code"),Lt.UNKNOWN;switch(n){case Ds.OK:return Lt.OK;case Ds.CANCELLED:return Lt.CANCELLED;case Ds.UNKNOWN:return Lt.UNKNOWN;case Ds.DEADLINE_EXCEEDED:return Lt.DEADLINE_EXCEEDED;case Ds.RESOURCE_EXHAUSTED:return Lt.RESOURCE_EXHAUSTED;case Ds.INTERNAL:return Lt.INTERNAL;case Ds.UNAVAILABLE:return Lt.UNAVAILABLE;case Ds.UNAUTHENTICATED:return Lt.UNAUTHENTICATED;case Ds.INVALID_ARGUMENT:return Lt.INVALID_ARGUMENT;case Ds.NOT_FOUND:return Lt.NOT_FOUND;case Ds.ALREADY_EXISTS:return Lt.ALREADY_EXISTS;case Ds.PERMISSION_DENIED:return Lt.PERMISSION_DENIED;case Ds.FAILED_PRECONDITION:return Lt.FAILED_PRECONDITION;case Ds.ABORTED:return Lt.ABORTED;case Ds.OUT_OF_RANGE:return Lt.OUT_OF_RANGE;case Ds.UNIMPLEMENTED:return Lt.UNIMPLEMENTED;case Ds.DATA_LOSS:return Lt.DATA_LOSS;default:return Zn(39323,{code:n})}}(Ji=Ds||(Ds={}))[Ji.OK=0]="OK",Ji[Ji.CANCELLED=1]="CANCELLED",Ji[Ji.UNKNOWN=2]="UNKNOWN",Ji[Ji.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Ji[Ji.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Ji[Ji.NOT_FOUND=5]="NOT_FOUND",Ji[Ji.ALREADY_EXISTS=6]="ALREADY_EXISTS",Ji[Ji.PERMISSION_DENIED=7]="PERMISSION_DENIED",Ji[Ji.UNAUTHENTICATED=16]="UNAUTHENTICATED",Ji[Ji.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Ji[Ji.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Ji[Ji.ABORTED=10]="ABORTED",Ji[Ji.OUT_OF_RANGE=11]="OUT_OF_RANGE",Ji[Ji.UNIMPLEMENTED=12]="UNIMPLEMENTED",Ji[Ji.INTERNAL=13]="INTERNAL",Ji[Ji.UNAVAILABLE=14]="UNAVAILABLE",Ji[Ji.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function D5(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const z5=new Vf([4294967295,4294967295],0);function jT(n){const e=D5().encode(n),t=new ZA;return t.update(e),new Uint8Array(t.digest())}function $T(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),a=e.getUint32(4,!0),d=e.getUint32(8,!0),m=e.getUint32(12,!0);return[new Vf([t,a],0),new Vf([d,m],0)]}class ww{constructor(e,t,a){if(this.bitmap=e,this.padding=t,this.hashCount=a,t<0||t>=8)throw new G_(`Invalid padding: ${t}`);if(a<0)throw new G_(`Invalid hash count: ${a}`);if(e.length>0&&this.hashCount===0)throw new G_(`Invalid hash count: ${a}`);if(e.length===0&&t!==0)throw new G_(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=Vf.fromNumber(this.ge)}ye(e,t,a){let d=e.add(t.multiply(Vf.fromNumber(a)));return d.compare(z5)===1&&(d=new Vf([d.getBits(0),d.getBits(1)],0)),d.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const t=jT(e),[a,d]=$T(t);for(let m=0;m<this.hashCount;m++){const g=this.ye(a,d,m);if(!this.we(g))return!1}return!0}static create(e,t,a){const d=e%8==0?0:8-e%8,m=new Uint8Array(Math.ceil(e/8)),g=new ww(m,d,t);return a.forEach((c=>g.insert(c))),g}insert(e){if(this.ge===0)return;const t=jT(e),[a,d]=$T(t);for(let m=0;m<this.hashCount;m++){const g=this.ye(a,d,m);this.Se(g)}}Se(e){const t=Math.floor(e/8),a=e%8;this.bitmap[t]|=1<<a}}class G_ extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Eb{constructor(e,t,a,d,m){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=a,this.documentUpdates=d,this.resolvedLimboDocuments=m}static createSynthesizedRemoteEventForCurrentChange(e,t,a){const d=new Map;return d.set(e,Vy.createSynthesizedTargetChangeForCurrentChange(e,t,a)),new Eb(ni.min(),d,new Va(Ni),Zd(),Bi())}}class Vy{constructor(e,t,a,d,m){this.resumeToken=e,this.current=t,this.addedDocuments=a,this.modifiedDocuments=d,this.removedDocuments=m}static createSynthesizedTargetChangeForCurrentChange(e,t,a){return new Vy(a,t,Bi(),Bi(),Bi())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c0{constructor(e,t,a,d){this.be=e,this.removedTargetIds=t,this.key=a,this.De=d}}class zC{constructor(e,t){this.targetId=e,this.Ce=t}}class OC{constructor(e,t,a=il.EMPTY_BYTE_STRING,d=null){this.state=e,this.targetIds=t,this.resumeToken=a,this.cause=d}}class qT{constructor(){this.ve=0,this.Fe=GT(),this.Me=il.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=Bi(),t=Bi(),a=Bi();return this.Fe.forEach(((d,m)=>{switch(m){case 0:e=e.add(d);break;case 2:t=t.add(d);break;case 1:a=a.add(d);break;default:Zn(38017,{changeType:m})}})),new Vy(this.Me,this.xe,e,t,a)}qe(){this.Oe=!1,this.Fe=GT()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,Cr(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class O5{constructor(e){this.Ge=e,this.ze=new Map,this.je=Zd(),this.Je=Gv(),this.He=Gv(),this.Ye=new Va(Ni)}Ze(e){for(const t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,(t=>{const a=this.nt(t);switch(e.state){case 0:this.rt(t)&&a.Le(e.resumeToken);break;case 1:a.Ke(),a.Ne||a.qe(),a.Le(e.resumeToken);break;case 2:a.Ke(),a.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(a.We(),a.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),a.Le(e.resumeToken));break;default:Zn(56790,{state:e.state})}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach(((a,d)=>{this.rt(d)&&t(d)}))}st(e){const t=e.targetId,a=e.Ce.count,d=this.ot(t);if(d){const m=d.target;if(p1(m))if(a===0){const g=new On(m.path);this.et(t,g,Rl.newNoDocument(g,ni.min()))}else Cr(a===1,20013,{expectedCount:a});else{const g=this._t(t);if(g!==a){const c=this.ut(e),C=c?this.ct(c,e,g):1;if(C!==0){this.it(t);const R=C===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(t,R)}}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:a="",padding:d=0},hashCount:m=0}=t;let g,c;try{g=Zf(a).toUint8Array()}catch(C){if(C instanceof aC)return gg("Decoding the base64 bloom filter in existence filter failed ("+C.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw C}try{c=new ww(g,d,m)}catch(C){return gg(C instanceof G_?"BloomFilter error: ":"Applying bloom filter failed: ",C),null}return c.ge===0?null:c}ct(e,t,a){return t.Ce.count===a-this.Pt(e,t.targetId)?0:2}Pt(e,t){const a=this.Ge.getRemoteKeysForTarget(t);let d=0;return a.forEach((m=>{const g=this.Ge.ht(),c=`projects/${g.projectId}/databases/${g.database}/documents/${m.path.canonicalString()}`;e.mightContain(c)||(this.et(t,m,null),d++)})),d}Tt(e){const t=new Map;this.ze.forEach(((m,g)=>{const c=this.ot(g);if(c){if(m.current&&p1(c.target)){const C=new On(c.target.path);this.It(C).has(g)||this.Et(g,C)||this.et(g,C,Rl.newNoDocument(C,e))}m.Be&&(t.set(g,m.ke()),m.qe())}}));let a=Bi();this.He.forEach(((m,g)=>{let c=!0;g.forEachWhile((C=>{const R=this.ot(C);return!R||R.purpose==="TargetPurposeLimboResolution"||(c=!1,!1)})),c&&(a=a.add(m))})),this.je.forEach(((m,g)=>g.setReadTime(e)));const d=new Eb(e,t,this.Ye,this.je,a);return this.je=Zd(),this.Je=Gv(),this.He=Gv(),this.Ye=new Va(Ni),d}Xe(e,t){if(!this.rt(e))return;const a=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,a),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,a){if(!this.rt(e))return;const d=this.nt(e);this.Et(e,t)?d.Qe(t,1):d.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),a&&(this.je=this.je.insert(t,a))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new qT,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new ao(Ni),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new ao(Ni),this.Je=this.Je.insert(e,t)),t}rt(e){const t=this.ot(e)!==null;return t||gn("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new qT),this.Ge.getRemoteKeysForTarget(e).forEach((t=>{this.et(e,t,null)}))}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function Gv(){return new Va(On.comparator)}function GT(){return new Va(On.comparator)}const N5={asc:"ASCENDING",desc:"DESCENDING"},B5={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},F5={and:"AND",or:"OR"};class V5{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function _1(n,e){return n.useProto3Json||vb(e)?e:{value:e}}function $0(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function NC(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function U5(n,e){return $0(n,e.toTimestamp())}function Zh(n){return Cr(!!n,49232),ni.fromTimestamp((function(t){const a=Hf(t);return new da(a.seconds,a.nanos)})(n))}function Tw(n,e){return y1(n,e).canonicalString()}function y1(n,e){const t=(function(d){return new ta(["projects",d.projectId,"databases",d.database])})(n).child("documents");return e===void 0?t:t.child(e)}function BC(n){const e=ta.fromString(n);return Cr($C(e),10190,{key:e.toString()}),e}function v1(n,e){return Tw(n.databaseId,e.path)}function Cx(n,e){const t=BC(e);if(t.get(1)!==n.databaseId.projectId)throw new _n(Lt.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new _n(Lt.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new On(VC(t))}function FC(n,e){return Tw(n.databaseId,e)}function j5(n){const e=BC(n);return e.length===4?ta.emptyPath():VC(e)}function b1(n){return new ta(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function VC(n){return Cr(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function HT(n,e,t){return{name:v1(n,e),fields:t.value.mapValue.fields}}function $5(n,e){let t;if("targetChange"in e){e.targetChange;const a=(function(R){return R==="NO_CHANGE"?0:R==="ADD"?1:R==="REMOVE"?2:R==="CURRENT"?3:R==="RESET"?4:Zn(39313,{state:R})})(e.targetChange.targetChangeType||"NO_CHANGE"),d=e.targetChange.targetIds||[],m=(function(R,V){return R.useProto3Json?(Cr(V===void 0||typeof V=="string",58123),il.fromBase64String(V||"")):(Cr(V===void 0||V instanceof Buffer||V instanceof Uint8Array,16193),il.fromUint8Array(V||new Uint8Array))})(n,e.targetChange.resumeToken),g=e.targetChange.cause,c=g&&(function(R){const V=R.code===void 0?Lt.UNKNOWN:DC(R.code);return new _n(V,R.message||"")})(g);t=new OC(a,d,m,c||null)}else if("documentChange"in e){e.documentChange;const a=e.documentChange;a.document,a.document.name,a.document.updateTime;const d=Cx(n,a.document.name),m=Zh(a.document.updateTime),g=a.document.createTime?Zh(a.document.createTime):ni.min(),c=new kc({mapValue:{fields:a.document.fields}}),C=Rl.newFoundDocument(d,m,g,c),R=a.targetIds||[],V=a.removedTargetIds||[];t=new c0(R,V,C.key,C)}else if("documentDelete"in e){e.documentDelete;const a=e.documentDelete;a.document;const d=Cx(n,a.document),m=a.readTime?Zh(a.readTime):ni.min(),g=Rl.newNoDocument(d,m),c=a.removedTargetIds||[];t=new c0([],c,g.key,g)}else if("documentRemove"in e){e.documentRemove;const a=e.documentRemove;a.document;const d=Cx(n,a.document),m=a.removedTargetIds||[];t=new c0([],m,d,null)}else{if(!("filter"in e))return Zn(11601,{Rt:e});{e.filter;const a=e.filter;a.targetId;const{count:d=0,unchangedNames:m}=a,g=new k5(d,m),c=a.targetId;t=new zC(c,g)}}return t}function q5(n,e){let t;if(e instanceof Fy)t={update:HT(n,e.key,e.value)};else if(e instanceof LC)t={delete:v1(n,e.key)};else if(e instanceof lm)t={update:HT(n,e.key,e.data),updateMask:J5(e.fieldMask)};else{if(!(e instanceof P5))return Zn(16599,{Vt:e.type});t={verify:v1(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map((a=>(function(m,g){const c=g.transform;if(c instanceof gy)return{fieldPath:g.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(c instanceof _y)return{fieldPath:g.field.canonicalString(),appendMissingElements:{values:c.elements}};if(c instanceof yy)return{fieldPath:g.field.canonicalString(),removeAllFromArray:{values:c.elements}};if(c instanceof j0)return{fieldPath:g.field.canonicalString(),increment:c.Ae};throw Zn(20930,{transform:g.transform})})(0,a)))),e.precondition.isNone||(t.currentDocument=(function(d,m){return m.updateTime!==void 0?{updateTime:U5(d,m.updateTime)}:m.exists!==void 0?{exists:m.exists}:Zn(27497)})(n,e.precondition)),t}function G5(n,e){return n&&n.length>0?(Cr(e!==void 0,14353),n.map((t=>(function(d,m){let g=d.updateTime?Zh(d.updateTime):Zh(m);return g.isEqual(ni.min())&&(g=Zh(m)),new A5(g,d.transformResults||[])})(t,e)))):[]}function H5(n,e){return{documents:[FC(n,e.path)]}}function Z5(n,e){const t={structuredQuery:{}},a=e.path;let d;e.collectionGroup!==null?(d=a,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(d=a.popLast(),t.structuredQuery.from=[{collectionId:a.lastSegment()}]),t.parent=FC(n,d);const m=(function(R){if(R.length!==0)return jC(ph.create(R,"and"))})(e.filters);m&&(t.structuredQuery.where=m);const g=(function(R){if(R.length!==0)return R.map((V=>(function(J){return{field:eg(J.field),direction:X5(J.dir)}})(V)))})(e.orderBy);g&&(t.structuredQuery.orderBy=g);const c=_1(n,e.limit);return c!==null&&(t.structuredQuery.limit=c),e.startAt&&(t.structuredQuery.startAt=(function(R){return{before:R.inclusive,values:R.position}})(e.startAt)),e.endAt&&(t.structuredQuery.endAt=(function(R){return{before:!R.inclusive,values:R.position}})(e.endAt)),{ft:t,parent:d}}function W5(n){let e=j5(n.parent);const t=n.structuredQuery,a=t.from?t.from.length:0;let d=null;if(a>0){Cr(a===1,65062);const V=t.from[0];V.allDescendants?d=V.collectionId:e=e.child(V.collectionId)}let m=[];t.where&&(m=(function(q){const J=UC(q);return J instanceof ph&&mC(J)?J.getFilters():[J]})(t.where));let g=[];t.orderBy&&(g=(function(q){return q.map((J=>(function(xe){return new U0(tg(xe.field),(function(Oe){switch(Oe){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(xe.direction))})(J)))})(t.orderBy));let c=null;t.limit&&(c=(function(q){let J;return J=typeof q=="object"?q.value:q,vb(J)?null:J})(t.limit));let C=null;t.startAt&&(C=(function(q){const J=!!q.before,Y=q.values||[];return new V0(Y,J)})(t.startAt));let R=null;return t.endAt&&(R=(function(q){const J=!q.before,Y=q.values||[];return new V0(Y,J)})(t.endAt)),d5(e,d,g,m,c,"F",C,R)}function K5(n,e){const t=(function(d){switch(d){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Zn(28987,{purpose:d})}})(e.purpose);return t==null?null:{"goog-listen-tags":t}}function UC(n){return n.unaryFilter!==void 0?(function(t){switch(t.unaryFilter.op){case"IS_NAN":const a=tg(t.unaryFilter.field);return zs.create(a,"==",{doubleValue:NaN});case"IS_NULL":const d=tg(t.unaryFilter.field);return zs.create(d,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const m=tg(t.unaryFilter.field);return zs.create(m,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const g=tg(t.unaryFilter.field);return zs.create(g,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return Zn(61313);default:return Zn(60726)}})(n):n.fieldFilter!==void 0?(function(t){return zs.create(tg(t.fieldFilter.field),(function(d){switch(d){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return Zn(58110);default:return Zn(50506)}})(t.fieldFilter.op),t.fieldFilter.value)})(n):n.compositeFilter!==void 0?(function(t){return ph.create(t.compositeFilter.filters.map((a=>UC(a))),(function(d){switch(d){case"AND":return"and";case"OR":return"or";default:return Zn(1026)}})(t.compositeFilter.op))})(n):Zn(30097,{filter:n})}function X5(n){return N5[n]}function Y5(n){return B5[n]}function Q5(n){return F5[n]}function eg(n){return{fieldPath:n.canonicalString()}}function tg(n){return nl.fromServerFormat(n.fieldPath)}function jC(n){return n instanceof zs?(function(t){if(t.op==="=="){if(LT(t.value))return{unaryFilter:{field:eg(t.field),op:"IS_NAN"}};if(kT(t.value))return{unaryFilter:{field:eg(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(LT(t.value))return{unaryFilter:{field:eg(t.field),op:"IS_NOT_NAN"}};if(kT(t.value))return{unaryFilter:{field:eg(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:eg(t.field),op:Y5(t.op),value:t.value}}})(n):n instanceof ph?(function(t){const a=t.getFilters().map((d=>jC(d)));return a.length===1?a[0]:{compositeFilter:{op:Q5(t.op),filters:a}}})(n):Zn(54877,{filter:n})}function J5(n){const e=[];return n.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function $C(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Df{constructor(e,t,a,d,m=ni.min(),g=ni.min(),c=il.EMPTY_BYTE_STRING,C=null){this.target=e,this.targetId=t,this.purpose=a,this.sequenceNumber=d,this.snapshotVersion=m,this.lastLimboFreeSnapshotVersion=g,this.resumeToken=c,this.expectedCount=C}withSequenceNumber(e){return new Df(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Df(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Df(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Df(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ez{constructor(e){this.yt=e}}function tz(n){const e=W5({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?g1(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nz{constructor(){this.Cn=new iz}addToCollectionParentIndex(e,t){return this.Cn.add(t),Dt.resolve()}getCollectionParents(e,t){return Dt.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return Dt.resolve()}deleteFieldIndex(e,t){return Dt.resolve()}deleteAllFieldIndexes(e){return Dt.resolve()}createTargetIndexes(e,t){return Dt.resolve()}getDocumentsMatchingTarget(e,t){return Dt.resolve(null)}getIndexType(e,t){return Dt.resolve(0)}getFieldIndexes(e,t){return Dt.resolve([])}getNextCollectionGroupToUpdate(e){return Dt.resolve(null)}getMinOffset(e,t){return Dt.resolve(Gf.min())}getMinOffsetFromCollectionGroup(e,t){return Dt.resolve(Gf.min())}updateCollectionGroup(e,t,a){return Dt.resolve()}updateIndexEntries(e,t){return Dt.resolve()}}class iz{constructor(){this.index={}}add(e){const t=e.lastSegment(),a=e.popLast(),d=this.index[t]||new ao(ta.comparator),m=!d.has(a);return this.index[t]=d.add(a),m}has(e){const t=e.lastSegment(),a=e.popLast(),d=this.index[t];return d&&d.has(a)}getEntries(e){return(this.index[e]||new ao(ta.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZT={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},qC=41943040;class cu{static withCacheSize(e){return new cu(e,cu.DEFAULT_COLLECTION_PERCENTILE,cu.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,a){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=a}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */cu.DEFAULT_COLLECTION_PERCENTILE=10,cu.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,cu.DEFAULT=new cu(qC,cu.DEFAULT_COLLECTION_PERCENTILE,cu.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),cu.DISABLED=new cu(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bg{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new bg(0)}static cr(){return new bg(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WT="LruGarbageCollector",rz=1048576;function KT([n,e],[t,a]){const d=Ni(n,t);return d===0?Ni(e,a):d}class az{constructor(e){this.Ir=e,this.buffer=new ao(KT),this.Er=0}dr(){return++this.Er}Ar(e){const t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{const a=this.buffer.last();KT(t,a)<0&&(this.buffer=this.buffer.delete(a).add(t))}}get maxValue(){return this.buffer.last()[0]}}class sz{constructor(e,t,a){this.garbageCollector=e,this.asyncQueue=t,this.localStore=a,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){gn(WT,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){Rg(t)?gn(WT,"Ignoring IndexedDB error during garbage collection: ",t):await Mg(t)}await this.Vr(3e5)}))}}class oz{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next((a=>Math.floor(t/100*a)))}nthSequenceNumber(e,t){if(t===0)return Dt.resolve(yb.ce);const a=new az(t);return this.mr.forEachTarget(e,(d=>a.Ar(d.sequenceNumber))).next((()=>this.mr.pr(e,(d=>a.Ar(d))))).next((()=>a.maxValue))}removeTargets(e,t,a){return this.mr.removeTargets(e,t,a)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(gn("LruGarbageCollector","Garbage collection skipped; disabled"),Dt.resolve(ZT)):this.getCacheSize(e).next((a=>a<this.params.cacheSizeCollectionThreshold?(gn("LruGarbageCollector",`Garbage collection skipped; Cache size ${a} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),ZT):this.yr(e,t)))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let a,d,m,g,c,C,R;const V=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((q=>(q>this.params.maximumSequenceNumbersToCollect?(gn("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${q}`),d=this.params.maximumSequenceNumbersToCollect):d=q,g=Date.now(),this.nthSequenceNumber(e,d)))).next((q=>(a=q,c=Date.now(),this.removeTargets(e,a,t)))).next((q=>(m=q,C=Date.now(),this.removeOrphanedDocuments(e,a)))).next((q=>(R=Date.now(),Qm()<=Oi.DEBUG&&gn("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${g-V}ms
	Determined least recently used ${d} in `+(c-g)+`ms
	Removed ${m} targets in `+(C-c)+`ms
	Removed ${q} documents in `+(R-C)+`ms
Total Duration: ${R-V}ms`),Dt.resolve({didRun:!0,sequenceNumbersCollected:d,targetsRemoved:m,documentsRemoved:q}))))}}function lz(n,e){return new oz(n,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uz{constructor(){this.changes=new om((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Rl.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const a=this.changes.get(t);return a!==void 0?Dt.resolve(a):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cz{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hz{constructor(e,t,a,d){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=a,this.indexManager=d}getDocument(e,t){let a=null;return this.documentOverlayCache.getOverlay(e,t).next((d=>(a=d,this.remoteDocumentCache.getEntry(e,t)))).next((d=>(a!==null&&ny(a.mutation,d,lh.empty(),da.now()),d)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((a=>this.getLocalViewOfDocuments(e,a,Bi()).next((()=>a))))}getLocalViewOfDocuments(e,t,a=Bi()){const d=Up();return this.populateOverlays(e,d,t).next((()=>this.computeViews(e,t,d,a).next((m=>{let g=q_();return m.forEach(((c,C)=>{g=g.insert(c,C.overlayedDocument)})),g}))))}getOverlayedDocuments(e,t){const a=Up();return this.populateOverlays(e,a,t).next((()=>this.computeViews(e,t,a,Bi())))}populateOverlays(e,t,a){const d=[];return a.forEach((m=>{t.has(m)||d.push(m)})),this.documentOverlayCache.getOverlays(e,d).next((m=>{m.forEach(((g,c)=>{t.set(g,c)}))}))}computeViews(e,t,a,d){let m=Zd();const g=ty(),c=(function(){return ty()})();return t.forEach(((C,R)=>{const V=a.get(R.key);d.has(R.key)&&(V===void 0||V.mutation instanceof lm)?m=m.insert(R.key,R):V!==void 0?(g.set(R.key,V.mutation.getFieldMask()),ny(V.mutation,R,V.mutation.getFieldMask(),da.now())):g.set(R.key,lh.empty())})),this.recalculateAndSaveOverlays(e,m).next((C=>(C.forEach(((R,V)=>g.set(R,V))),t.forEach(((R,V)=>c.set(R,new cz(V,g.get(R)??null)))),c)))}recalculateAndSaveOverlays(e,t){const a=ty();let d=new Va(((g,c)=>g-c)),m=Bi();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((g=>{for(const c of g)c.keys().forEach((C=>{const R=t.get(C);if(R===null)return;let V=a.get(C)||lh.empty();V=c.applyToLocalView(R,V),a.set(C,V);const q=(d.get(c.batchId)||Bi()).add(C);d=d.insert(c.batchId,q)}))})).next((()=>{const g=[],c=d.getReverseIterator();for(;c.hasNext();){const C=c.getNext(),R=C.key,V=C.value,q=EC();V.forEach((J=>{if(!m.has(J)){const Y=RC(t.get(J),a.get(J));Y!==null&&q.set(J,Y),m=m.add(J)}})),g.push(this.documentOverlayCache.saveOverlays(e,R,q))}return Dt.waitFor(g)})).next((()=>a))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((a=>this.recalculateAndSaveOverlays(e,a)))}getDocumentsMatchingQuery(e,t,a,d){return(function(g){return On.isDocumentKey(g.path)&&g.collectionGroup===null&&g.filters.length===0})(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):bC(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,a,d):this.getDocumentsMatchingCollectionQuery(e,t,a,d)}getNextDocuments(e,t,a,d){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,a,d).next((m=>{const g=d-m.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,a.largestBatchId,d-m.size):Dt.resolve(Up());let c=dy,C=m;return g.next((R=>Dt.forEach(R,((V,q)=>(c<q.largestBatchId&&(c=q.largestBatchId),m.get(V)?Dt.resolve():this.remoteDocumentCache.getEntry(e,V).next((J=>{C=C.insert(V,J)}))))).next((()=>this.populateOverlays(e,R,m))).next((()=>this.computeViews(e,C,R,Bi()))).next((V=>({batchId:c,changes:SC(V)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new On(t)).next((a=>{let d=q_();return a.isFoundDocument()&&(d=d.insert(a.key,a)),d}))}getDocumentsMatchingCollectionGroupQuery(e,t,a,d){const m=t.collectionGroup;let g=q_();return this.indexManager.getCollectionParents(e,m).next((c=>Dt.forEach(c,(C=>{const R=(function(q,J){return new By(J,null,q.explicitOrderBy.slice(),q.filters.slice(),q.limit,q.limitType,q.startAt,q.endAt)})(t,C.child(m));return this.getDocumentsMatchingCollectionQuery(e,R,a,d).next((V=>{V.forEach(((q,J)=>{g=g.insert(q,J)}))}))})).next((()=>g))))}getDocumentsMatchingCollectionQuery(e,t,a,d){let m;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,a.largestBatchId).next((g=>(m=g,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,a,m,d)))).next((g=>{m.forEach(((C,R)=>{const V=R.getKey();g.get(V)===null&&(g=g.insert(V,Rl.newInvalidDocument(V)))}));let c=q_();return g.forEach(((C,R)=>{const V=m.get(C);V!==void 0&&ny(V.mutation,R,lh.empty(),da.now()),wb(t,R)&&(c=c.insert(C,R))})),c}))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dz{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return Dt.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,(function(d){return{id:d.id,version:d.version,createTime:Zh(d.createTime)}})(t)),Dt.resolve()}getNamedQuery(e,t){return Dt.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,(function(d){return{name:d.name,query:tz(d.bundledQuery),readTime:Zh(d.readTime)}})(t)),Dt.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fz{constructor(){this.overlays=new Va(On.comparator),this.qr=new Map}getOverlay(e,t){return Dt.resolve(this.overlays.get(t))}getOverlays(e,t){const a=Up();return Dt.forEach(t,(d=>this.getOverlay(e,d).next((m=>{m!==null&&a.set(d,m)})))).next((()=>a))}saveOverlays(e,t,a){return a.forEach(((d,m)=>{this.St(e,t,m)})),Dt.resolve()}removeOverlaysForBatchId(e,t,a){const d=this.qr.get(a);return d!==void 0&&(d.forEach((m=>this.overlays=this.overlays.remove(m))),this.qr.delete(a)),Dt.resolve()}getOverlaysForCollection(e,t,a){const d=Up(),m=t.length+1,g=new On(t.child("")),c=this.overlays.getIteratorFrom(g);for(;c.hasNext();){const C=c.getNext().value,R=C.getKey();if(!t.isPrefixOf(R.path))break;R.path.length===m&&C.largestBatchId>a&&d.set(C.getKey(),C)}return Dt.resolve(d)}getOverlaysForCollectionGroup(e,t,a,d){let m=new Va(((R,V)=>R-V));const g=this.overlays.getIterator();for(;g.hasNext();){const R=g.getNext().value;if(R.getKey().getCollectionGroup()===t&&R.largestBatchId>a){let V=m.get(R.largestBatchId);V===null&&(V=Up(),m=m.insert(R.largestBatchId,V)),V.set(R.getKey(),R)}}const c=Up(),C=m.getIterator();for(;C.hasNext()&&(C.getNext().value.forEach(((R,V)=>c.set(R,V))),!(c.size()>=d)););return Dt.resolve(c)}St(e,t,a){const d=this.overlays.get(a.key);if(d!==null){const g=this.qr.get(d.largestBatchId).delete(a.key);this.qr.set(d.largestBatchId,g)}this.overlays=this.overlays.insert(a.key,new R5(t,a));let m=this.qr.get(t);m===void 0&&(m=Bi(),this.qr.set(t,m)),this.qr.set(t,m.add(a.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pz{constructor(){this.sessionToken=il.EMPTY_BYTE_STRING}getSessionToken(e){return Dt.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,Dt.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sw{constructor(){this.Qr=new ao(xo.$r),this.Ur=new ao(xo.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){const a=new xo(e,t);this.Qr=this.Qr.add(a),this.Ur=this.Ur.add(a)}Wr(e,t){e.forEach((a=>this.addReference(a,t)))}removeReference(e,t){this.Gr(new xo(e,t))}zr(e,t){e.forEach((a=>this.removeReference(a,t)))}jr(e){const t=new On(new ta([])),a=new xo(t,e),d=new xo(t,e+1),m=[];return this.Ur.forEachInRange([a,d],(g=>{this.Gr(g),m.push(g.key)})),m}Jr(){this.Qr.forEach((e=>this.Gr(e)))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const t=new On(new ta([])),a=new xo(t,e),d=new xo(t,e+1);let m=Bi();return this.Ur.forEachInRange([a,d],(g=>{m=m.add(g.key)})),m}containsKey(e){const t=new xo(e,0),a=this.Qr.firstAfterOrEqual(t);return a!==null&&e.isEqual(a.key)}}class xo{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return On.comparator(e.key,t.key)||Ni(e.Yr,t.Yr)}static Kr(e,t){return Ni(e.Yr,t.Yr)||On.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mz{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new ao(xo.$r)}checkEmpty(e){return Dt.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,a,d){const m=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const g=new M5(m,t,a,d);this.mutationQueue.push(g);for(const c of d)this.Zr=this.Zr.add(new xo(c.key,m)),this.indexManager.addToCollectionParentIndex(e,c.key.path.popLast());return Dt.resolve(g)}lookupMutationBatch(e,t){return Dt.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){const a=t+1,d=this.ei(a),m=d<0?0:d;return Dt.resolve(this.mutationQueue.length>m?this.mutationQueue[m]:null)}getHighestUnacknowledgedBatchId(){return Dt.resolve(this.mutationQueue.length===0?mw:this.tr-1)}getAllMutationBatches(e){return Dt.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const a=new xo(t,0),d=new xo(t,Number.POSITIVE_INFINITY),m=[];return this.Zr.forEachInRange([a,d],(g=>{const c=this.Xr(g.Yr);m.push(c)})),Dt.resolve(m)}getAllMutationBatchesAffectingDocumentKeys(e,t){let a=new ao(Ni);return t.forEach((d=>{const m=new xo(d,0),g=new xo(d,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([m,g],(c=>{a=a.add(c.Yr)}))})),Dt.resolve(this.ti(a))}getAllMutationBatchesAffectingQuery(e,t){const a=t.path,d=a.length+1;let m=a;On.isDocumentKey(m)||(m=m.child(""));const g=new xo(new On(m),0);let c=new ao(Ni);return this.Zr.forEachWhile((C=>{const R=C.key.path;return!!a.isPrefixOf(R)&&(R.length===d&&(c=c.add(C.Yr)),!0)}),g),Dt.resolve(this.ti(c))}ti(e){const t=[];return e.forEach((a=>{const d=this.Xr(a);d!==null&&t.push(d)})),t}removeMutationBatch(e,t){Cr(this.ni(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let a=this.Zr;return Dt.forEach(t.mutations,(d=>{const m=new xo(d.key,t.batchId);return a=a.delete(m),this.referenceDelegate.markPotentiallyOrphaned(e,d.key)})).next((()=>{this.Zr=a}))}ir(e){}containsKey(e,t){const a=new xo(t,0),d=this.Zr.firstAfterOrEqual(a);return Dt.resolve(t.isEqual(d&&d.key))}performConsistencyCheck(e){return this.mutationQueue.length,Dt.resolve()}ni(e,t){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gz{constructor(e){this.ri=e,this.docs=(function(){return new Va(On.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const a=t.key,d=this.docs.get(a),m=d?d.size:0,g=this.ri(t);return this.docs=this.docs.insert(a,{document:t.mutableCopy(),size:g}),this.size+=g-m,this.indexManager.addToCollectionParentIndex(e,a.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const a=this.docs.get(t);return Dt.resolve(a?a.document.mutableCopy():Rl.newInvalidDocument(t))}getEntries(e,t){let a=Zd();return t.forEach((d=>{const m=this.docs.get(d);a=a.insert(d,m?m.document.mutableCopy():Rl.newInvalidDocument(d))})),Dt.resolve(a)}getDocumentsMatchingQuery(e,t,a,d){let m=Zd();const g=t.path,c=new On(g.child("__id-9223372036854775808__")),C=this.docs.getIteratorFrom(c);for(;C.hasNext();){const{key:R,value:{document:V}}=C.getNext();if(!g.isPrefixOf(R.path))break;R.path.length>g.length+1||qD($D(V),a)<=0||(d.has(V.key)||wb(t,V))&&(m=m.insert(V.key,V.mutableCopy()))}return Dt.resolve(m)}getAllFromCollectionGroup(e,t,a,d){Zn(9500)}ii(e,t){return Dt.forEach(this.docs,(a=>t(a)))}newChangeBuffer(e){return new _z(this)}getSize(e){return Dt.resolve(this.size)}}class _z extends uz{constructor(e){super(),this.Nr=e}applyChanges(e){const t=[];return this.changes.forEach(((a,d)=>{d.isValidDocument()?t.push(this.Nr.addEntry(e,d)):this.Nr.removeEntry(a)})),Dt.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yz{constructor(e){this.persistence=e,this.si=new om((t=>yw(t)),vw),this.lastRemoteSnapshotVersion=ni.min(),this.highestTargetId=0,this.oi=0,this._i=new Sw,this.targetCount=0,this.ai=bg.ur()}forEachTarget(e,t){return this.si.forEach(((a,d)=>t(d))),Dt.resolve()}getLastRemoteSnapshotVersion(e){return Dt.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return Dt.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),Dt.resolve(this.highestTargetId)}setTargetsMetadata(e,t,a){return a&&(this.lastRemoteSnapshotVersion=a),t>this.oi&&(this.oi=t),Dt.resolve()}Pr(e){this.si.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ai=new bg(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,Dt.resolve()}updateTargetData(e,t){return this.Pr(t),Dt.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,Dt.resolve()}removeTargets(e,t,a){let d=0;const m=[];return this.si.forEach(((g,c)=>{c.sequenceNumber<=t&&a.get(c.targetId)===null&&(this.si.delete(g),m.push(this.removeMatchingKeysForTargetId(e,c.targetId)),d++)})),Dt.waitFor(m).next((()=>d))}getTargetCount(e){return Dt.resolve(this.targetCount)}getTargetData(e,t){const a=this.si.get(t)||null;return Dt.resolve(a)}addMatchingKeys(e,t,a){return this._i.Wr(t,a),Dt.resolve()}removeMatchingKeys(e,t,a){this._i.zr(t,a);const d=this.persistence.referenceDelegate,m=[];return d&&t.forEach((g=>{m.push(d.markPotentiallyOrphaned(e,g))})),Dt.waitFor(m)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),Dt.resolve()}getMatchingKeysForTargetId(e,t){const a=this._i.Hr(t);return Dt.resolve(a)}containsKey(e,t){return Dt.resolve(this._i.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GC{constructor(e,t){this.ui={},this.overlays={},this.ci=new yb(0),this.li=!1,this.li=!0,this.hi=new pz,this.referenceDelegate=e(this),this.Pi=new yz(this),this.indexManager=new nz,this.remoteDocumentCache=(function(d){return new gz(d)})((a=>this.referenceDelegate.Ti(a))),this.serializer=new ez(t),this.Ii=new dz(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new fz,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let a=this.ui[e.toKey()];return a||(a=new mz(t,this.referenceDelegate),this.ui[e.toKey()]=a),a}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,a){gn("MemoryPersistence","Starting transaction:",e);const d=new vz(this.ci.next());return this.referenceDelegate.Ei(),a(d).next((m=>this.referenceDelegate.di(d).next((()=>m)))).toPromise().then((m=>(d.raiseOnCommittedEvent(),m)))}Ai(e,t){return Dt.or(Object.values(this.ui).map((a=>()=>a.containsKey(e,t))))}}class vz extends HD{constructor(e){super(),this.currentSequenceNumber=e}}class Ew{constructor(e){this.persistence=e,this.Ri=new Sw,this.Vi=null}static mi(e){return new Ew(e)}get fi(){if(this.Vi)return this.Vi;throw Zn(60996)}addReference(e,t,a){return this.Ri.addReference(a,t),this.fi.delete(a.toString()),Dt.resolve()}removeReference(e,t,a){return this.Ri.removeReference(a,t),this.fi.add(a.toString()),Dt.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),Dt.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach((d=>this.fi.add(d.toString())));const a=this.persistence.getTargetCache();return a.getMatchingKeysForTargetId(e,t.targetId).next((d=>{d.forEach((m=>this.fi.add(m.toString())))})).next((()=>a.removeTargetData(e,t)))}Ei(){this.Vi=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Dt.forEach(this.fi,(a=>{const d=On.fromPath(a);return this.gi(e,d).next((m=>{m||t.removeEntry(d,ni.min())}))})).next((()=>(this.Vi=null,t.apply(e))))}updateLimboDocument(e,t){return this.gi(e,t).next((a=>{a?this.fi.delete(t.toString()):this.fi.add(t.toString())}))}Ti(e){return 0}gi(e,t){return Dt.or([()=>Dt.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class q0{constructor(e,t){this.persistence=e,this.pi=new om((a=>KD(a.path)),((a,d)=>a.isEqual(d))),this.garbageCollector=lz(this,t)}static mi(e,t){return new q0(e,t)}Ei(){}di(e){return Dt.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){const t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next((a=>t.next((d=>a+d))))}wr(e){let t=0;return this.pr(e,(a=>{t++})).next((()=>t))}pr(e,t){return Dt.forEach(this.pi,((a,d)=>this.br(e,a,d).next((m=>m?Dt.resolve():t(d)))))}removeTargets(e,t,a){return this.persistence.getTargetCache().removeTargets(e,t,a)}removeOrphanedDocuments(e,t){let a=0;const d=this.persistence.getRemoteDocumentCache(),m=d.newChangeBuffer();return d.ii(e,(g=>this.br(e,g,t).next((c=>{c||(a++,m.removeEntry(g,ni.min()))})))).next((()=>m.apply(e))).next((()=>a))}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),Dt.resolve()}removeTarget(e,t){const a=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,a)}addReference(e,t,a){return this.pi.set(a,e.currentSequenceNumber),Dt.resolve()}removeReference(e,t,a){return this.pi.set(a,e.currentSequenceNumber),Dt.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),Dt.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=o0(e.data.value)),t}br(e,t,a){return Dt.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const d=this.pi.get(t);return Dt.resolve(d!==void 0&&d>a)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Aw{constructor(e,t,a,d){this.targetId=e,this.fromCache=t,this.Es=a,this.ds=d}static As(e,t){let a=Bi(),d=Bi();for(const m of t.docChanges)switch(m.type){case 0:a=a.add(m.doc.key);break;case 1:d=d.add(m.doc.key)}return new Aw(e,t.fromCache,a,d)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bz{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xz{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(function(){return hL()?8:ZD(kl())>0?6:4})()}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,a,d){const m={result:null};return this.ys(e,t).next((g=>{m.result=g})).next((()=>{if(!m.result)return this.ws(e,t,d,a).next((g=>{m.result=g}))})).next((()=>{if(m.result)return;const g=new bz;return this.Ss(e,t,g).next((c=>{if(m.result=c,this.Vs)return this.bs(e,t,g,c.size)}))})).next((()=>m.result))}bs(e,t,a,d){return a.documentReadCount<this.fs?(Qm()<=Oi.DEBUG&&gn("QueryEngine","SDK will not create cache indexes for query:",Jm(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),Dt.resolve()):(Qm()<=Oi.DEBUG&&gn("QueryEngine","Query:",Jm(t),"scans",a.documentReadCount,"local documents and returns",d,"documents as results."),a.documentReadCount>this.gs*d?(Qm()<=Oi.DEBUG&&gn("QueryEngine","The SDK decides to create cache indexes for query:",Jm(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Hh(t))):Dt.resolve())}ys(e,t){if(NT(t))return Dt.resolve(null);let a=Hh(t);return this.indexManager.getIndexType(e,a).next((d=>d===0?null:(t.limit!==null&&d===1&&(t=g1(t,null,"F"),a=Hh(t)),this.indexManager.getDocumentsMatchingTarget(e,a).next((m=>{const g=Bi(...m);return this.ps.getDocuments(e,g).next((c=>this.indexManager.getMinOffset(e,a).next((C=>{const R=this.Ds(t,c);return this.Cs(t,R,g,C.readTime)?this.ys(e,g1(t,null,"F")):this.vs(e,R,t,C)}))))})))))}ws(e,t,a,d){return NT(t)||d.isEqual(ni.min())?Dt.resolve(null):this.ps.getDocuments(e,a).next((m=>{const g=this.Ds(t,m);return this.Cs(t,g,a,d)?Dt.resolve(null):(Qm()<=Oi.DEBUG&&gn("QueryEngine","Re-using previous result from %s to execute query: %s",d.toString(),Jm(t)),this.vs(e,g,t,jD(d,dy)).next((c=>c)))}))}Ds(e,t){let a=new ao(wC(e));return t.forEach(((d,m)=>{wb(e,m)&&(a=a.add(m))})),a}Cs(e,t,a,d){if(e.limit===null)return!1;if(a.size!==t.size)return!0;const m=e.limitType==="F"?t.last():t.first();return!!m&&(m.hasPendingWrites||m.version.compareTo(d)>0)}Ss(e,t,a){return Qm()<=Oi.DEBUG&&gn("QueryEngine","Using full collection scan to execute query:",Jm(t)),this.ps.getDocumentsMatchingQuery(e,t,Gf.min(),a)}vs(e,t,a,d){return this.ps.getDocumentsMatchingQuery(e,a,d).next((m=>(t.forEach((g=>{m=m.insert(g.key,g)})),m)))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cw="LocalStore",wz=3e8;class Tz{constructor(e,t,a,d){this.persistence=e,this.Fs=t,this.serializer=d,this.Ms=new Va(Ni),this.xs=new om((m=>yw(m)),vw),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(a)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new hz(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.Ms)))}}function Sz(n,e,t,a){return new Tz(n,e,t,a)}async function HC(n,e){const t=si(n);return await t.persistence.runTransaction("Handle user change","readonly",(a=>{let d;return t.mutationQueue.getAllMutationBatches(a).next((m=>(d=m,t.Bs(e),t.mutationQueue.getAllMutationBatches(a)))).next((m=>{const g=[],c=[];let C=Bi();for(const R of d){g.push(R.batchId);for(const V of R.mutations)C=C.add(V.key)}for(const R of m){c.push(R.batchId);for(const V of R.mutations)C=C.add(V.key)}return t.localDocuments.getDocuments(a,C).next((R=>({Ls:R,removedBatchIds:g,addedBatchIds:c})))}))}))}function Ez(n,e){const t=si(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",(a=>{const d=e.batch.keys(),m=t.Ns.newChangeBuffer({trackRemovals:!0});return(function(c,C,R,V){const q=R.batch,J=q.keys();let Y=Dt.resolve();return J.forEach((xe=>{Y=Y.next((()=>V.getEntry(C,xe))).next((be=>{const Oe=R.docVersions.get(xe);Cr(Oe!==null,48541),be.version.compareTo(Oe)<0&&(q.applyToRemoteDocument(be,R),be.isValidDocument()&&(be.setReadTime(R.commitVersion),V.addEntry(be)))}))})),Y.next((()=>c.mutationQueue.removeMutationBatch(C,q)))})(t,a,e,m).next((()=>m.apply(a))).next((()=>t.mutationQueue.performConsistencyCheck(a))).next((()=>t.documentOverlayCache.removeOverlaysForBatchId(a,d,e.batch.batchId))).next((()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(a,(function(c){let C=Bi();for(let R=0;R<c.mutationResults.length;++R)c.mutationResults[R].transformResults.length>0&&(C=C.add(c.batch.mutations[R].key));return C})(e)))).next((()=>t.localDocuments.getDocuments(a,d)))}))}function ZC(n){const e=si(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Pi.getLastRemoteSnapshotVersion(t)))}function Az(n,e){const t=si(n),a=e.snapshotVersion;let d=t.Ms;return t.persistence.runTransaction("Apply remote event","readwrite-primary",(m=>{const g=t.Ns.newChangeBuffer({trackRemovals:!0});d=t.Ms;const c=[];e.targetChanges.forEach(((V,q)=>{const J=d.get(q);if(!J)return;c.push(t.Pi.removeMatchingKeys(m,V.removedDocuments,q).next((()=>t.Pi.addMatchingKeys(m,V.addedDocuments,q))));let Y=J.withSequenceNumber(m.currentSequenceNumber);e.targetMismatches.get(q)!==null?Y=Y.withResumeToken(il.EMPTY_BYTE_STRING,ni.min()).withLastLimboFreeSnapshotVersion(ni.min()):V.resumeToken.approximateByteSize()>0&&(Y=Y.withResumeToken(V.resumeToken,a)),d=d.insert(q,Y),(function(be,Oe,et){return be.resumeToken.approximateByteSize()===0||Oe.snapshotVersion.toMicroseconds()-be.snapshotVersion.toMicroseconds()>=wz?!0:et.addedDocuments.size+et.modifiedDocuments.size+et.removedDocuments.size>0})(J,Y,V)&&c.push(t.Pi.updateTargetData(m,Y))}));let C=Zd(),R=Bi();if(e.documentUpdates.forEach((V=>{e.resolvedLimboDocuments.has(V)&&c.push(t.persistence.referenceDelegate.updateLimboDocument(m,V))})),c.push(Cz(m,g,e.documentUpdates).next((V=>{C=V.ks,R=V.qs}))),!a.isEqual(ni.min())){const V=t.Pi.getLastRemoteSnapshotVersion(m).next((q=>t.Pi.setTargetsMetadata(m,m.currentSequenceNumber,a)));c.push(V)}return Dt.waitFor(c).next((()=>g.apply(m))).next((()=>t.localDocuments.getLocalViewOfDocuments(m,C,R))).next((()=>C))})).then((m=>(t.Ms=d,m)))}function Cz(n,e,t){let a=Bi(),d=Bi();return t.forEach((m=>a=a.add(m))),e.getEntries(n,a).next((m=>{let g=Zd();return t.forEach(((c,C)=>{const R=m.get(c);C.isFoundDocument()!==R.isFoundDocument()&&(d=d.add(c)),C.isNoDocument()&&C.version.isEqual(ni.min())?(e.removeEntry(c,C.readTime),g=g.insert(c,C)):!R.isValidDocument()||C.version.compareTo(R.version)>0||C.version.compareTo(R.version)===0&&R.hasPendingWrites?(e.addEntry(C),g=g.insert(c,C)):gn(Cw,"Ignoring outdated watch update for ",c,". Current version:",R.version," Watch version:",C.version)})),{ks:g,qs:d}}))}function Iz(n,e){const t=si(n);return t.persistence.runTransaction("Get next mutation batch","readonly",(a=>(e===void 0&&(e=mw),t.mutationQueue.getNextMutationBatchAfterBatchId(a,e))))}function Pz(n,e){const t=si(n);return t.persistence.runTransaction("Allocate target","readwrite",(a=>{let d;return t.Pi.getTargetData(a,e).next((m=>m?(d=m,Dt.resolve(d)):t.Pi.allocateTargetId(a).next((g=>(d=new Df(e,g,"TargetPurposeListen",a.currentSequenceNumber),t.Pi.addTargetData(a,d).next((()=>d)))))))})).then((a=>{const d=t.Ms.get(a.targetId);return(d===null||a.snapshotVersion.compareTo(d.snapshotVersion)>0)&&(t.Ms=t.Ms.insert(a.targetId,a),t.xs.set(e,a.targetId)),a}))}async function x1(n,e,t){const a=si(n),d=a.Ms.get(e),m=t?"readwrite":"readwrite-primary";try{t||await a.persistence.runTransaction("Release target",m,(g=>a.persistence.referenceDelegate.removeTarget(g,d)))}catch(g){if(!Rg(g))throw g;gn(Cw,`Failed to update sequence numbers for target ${e}: ${g}`)}a.Ms=a.Ms.remove(e),a.xs.delete(d.target)}function XT(n,e,t){const a=si(n);let d=ni.min(),m=Bi();return a.persistence.runTransaction("Execute query","readwrite",(g=>(function(C,R,V){const q=si(C),J=q.xs.get(V);return J!==void 0?Dt.resolve(q.Ms.get(J)):q.Pi.getTargetData(R,V)})(a,g,Hh(e)).next((c=>{if(c)return d=c.lastLimboFreeSnapshotVersion,a.Pi.getMatchingKeysForTargetId(g,c.targetId).next((C=>{m=C}))})).next((()=>a.Fs.getDocumentsMatchingQuery(g,e,t?d:ni.min(),t?m:Bi()))).next((c=>(Mz(a,p5(e),c),{documents:c,Qs:m})))))}function Mz(n,e,t){let a=n.Os.get(e)||ni.min();t.forEach(((d,m)=>{m.readTime.compareTo(a)>0&&(a=m.readTime)})),n.Os.set(e,a)}class YT{constructor(){this.activeTargetIds=b5()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Rz{constructor(){this.Mo=new YT,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,a){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,a){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new YT,Promise.resolve()}handleUserChange(e,t,a){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kz{Oo(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QT="ConnectivityMonitor";class JT{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){gn(QT,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){gn(QT,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Hv=null;function w1(){return Hv===null?Hv=(function(){return 268435456+Math.round(2147483648*Math.random())})():Hv++,"0x"+Hv.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ix="RestConnection",Lz={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Dz{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",a=encodeURIComponent(this.databaseId.projectId),d=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${a}/databases/${d}`,this.Wo=this.databaseId.database===B0?`project_id=${a}`:`project_id=${a}&database_id=${d}`}Go(e,t,a,d,m){const g=w1(),c=this.zo(e,t.toUriEncodedString());gn(Ix,`Sending RPC '${e}' ${g}:`,c,a);const C={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(C,d,m);const{host:R}=new URL(c),V=Cg(R);return this.Jo(e,c,C,a,V).then((q=>(gn(Ix,`Received RPC '${e}' ${g}: `,q),q)),(q=>{throw gg(Ix,`RPC '${e}' ${g} failed with error: `,q,"url: ",c,"request:",a),q}))}Ho(e,t,a,d,m,g){return this.Go(e,t,a,d,m)}jo(e,t,a){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+Pg})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((d,m)=>e[m]=d)),a&&a.headers.forEach(((d,m)=>e[m]=d))}zo(e,t){const a=Lz[e];return`${this.Uo}/v1/${t}:${a}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zz{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pl="WebChannelConnection";class Oz extends Dz{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,a,d,m){const g=w1();return new Promise(((c,C)=>{const R=new WA;R.setWithCredentials(!0),R.listenOnce(KA.COMPLETE,(()=>{try{switch(R.getLastErrorCode()){case s0.NO_ERROR:const q=R.getResponseJson();gn(Pl,`XHR for RPC '${e}' ${g} received:`,JSON.stringify(q)),c(q);break;case s0.TIMEOUT:gn(Pl,`RPC '${e}' ${g} timed out`),C(new _n(Lt.DEADLINE_EXCEEDED,"Request time out"));break;case s0.HTTP_ERROR:const J=R.getStatus();if(gn(Pl,`RPC '${e}' ${g} failed with status:`,J,"response text:",R.getResponseText()),J>0){let Y=R.getResponseJson();Array.isArray(Y)&&(Y=Y[0]);const xe=Y==null?void 0:Y.error;if(xe&&xe.status&&xe.message){const be=(function(et){const Je=et.toLowerCase().replace(/_/g,"-");return Object.values(Lt).indexOf(Je)>=0?Je:Lt.UNKNOWN})(xe.status);C(new _n(be,xe.message))}else C(new _n(Lt.UNKNOWN,"Server responded with status "+R.getStatus()))}else C(new _n(Lt.UNAVAILABLE,"Connection failed."));break;default:Zn(9055,{l_:e,streamId:g,h_:R.getLastErrorCode(),P_:R.getLastError()})}}finally{gn(Pl,`RPC '${e}' ${g} completed.`)}}));const V=JSON.stringify(d);gn(Pl,`RPC '${e}' ${g} sending request:`,d),R.send(t,"POST",V,a,15)}))}T_(e,t,a){const d=w1(),m=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],g=QA(),c=YA(),C={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},R=this.longPollingOptions.timeoutSeconds;R!==void 0&&(C.longPollingTimeout=Math.round(1e3*R)),this.useFetchStreams&&(C.useFetchStreams=!0),this.jo(C.initMessageHeaders,t,a),C.encodeInitMessageHeaders=!0;const V=m.join("");gn(Pl,`Creating RPC '${e}' stream ${d}: ${V}`,C);const q=g.createWebChannel(V,C);this.I_(q);let J=!1,Y=!1;const xe=new zz({Yo:Oe=>{Y?gn(Pl,`Not sending because RPC '${e}' stream ${d} is closed:`,Oe):(J||(gn(Pl,`Opening RPC '${e}' stream ${d} transport.`),q.open(),J=!0),gn(Pl,`RPC '${e}' stream ${d} sending:`,Oe),q.send(Oe))},Zo:()=>q.close()}),be=(Oe,et,Je)=>{Oe.listen(et,(qe=>{try{Je(qe)}catch(Ze){setTimeout((()=>{throw Ze}),0)}}))};return be(q,$_.EventType.OPEN,(()=>{Y||(gn(Pl,`RPC '${e}' stream ${d} transport opened.`),xe.o_())})),be(q,$_.EventType.CLOSE,(()=>{Y||(Y=!0,gn(Pl,`RPC '${e}' stream ${d} transport closed`),xe.a_(),this.E_(q))})),be(q,$_.EventType.ERROR,(Oe=>{Y||(Y=!0,gg(Pl,`RPC '${e}' stream ${d} transport errored. Name:`,Oe.name,"Message:",Oe.message),xe.a_(new _n(Lt.UNAVAILABLE,"The operation could not be completed")))})),be(q,$_.EventType.MESSAGE,(Oe=>{var et;if(!Y){const Je=Oe.data[0];Cr(!!Je,16349);const qe=Je,Ze=(qe==null?void 0:qe.error)||((et=qe[0])==null?void 0:et.error);if(Ze){gn(Pl,`RPC '${e}' stream ${d} received error:`,Ze);const je=Ze.status;let Be=(function(_e){const Ae=Ds[_e];if(Ae!==void 0)return DC(Ae)})(je),de=Ze.message;Be===void 0&&(Be=Lt.INTERNAL,de="Unknown error status: "+je+" with message "+Ze.message),Y=!0,xe.a_(new _n(Be,de)),q.close()}else gn(Pl,`RPC '${e}' stream ${d} received:`,Je),xe.u_(Je)}})),be(c,XA.STAT_EVENT,(Oe=>{Oe.stat===u1.PROXY?gn(Pl,`RPC '${e}' stream ${d} detected buffering proxy`):Oe.stat===u1.NOPROXY&&gn(Pl,`RPC '${e}' stream ${d} detected no buffering proxy`)})),setTimeout((()=>{xe.__()}),0),xe}terminate(){this.c_.forEach((e=>e.close())),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter((t=>t===e))}}function Px(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ab(n){return new V5(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WC{constructor(e,t,a=1e3,d=1.5,m=6e4){this.Mi=e,this.timerId=t,this.d_=a,this.A_=d,this.R_=m,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),a=Math.max(0,Date.now()-this.f_),d=Math.max(0,t-a);d>0&&gn("ExponentialBackoff",`Backing off for ${d} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${a} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,d,(()=>(this.f_=Date.now(),e()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eS="PersistentStream";class KC{constructor(e,t,a,d,m,g,c,C){this.Mi=e,this.S_=a,this.b_=d,this.connection=m,this.authCredentialsProvider=g,this.appCheckCredentialsProvider=c,this.listener=C,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new WC(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===Lt.RESOURCE_EXHAUSTED?(Hd(t.toString()),Hd("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===Lt.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([a,d])=>{this.D_===t&&this.G_(a,d)}),(a=>{e((()=>{const d=new _n(Lt.UNKNOWN,"Fetching auth token failed: "+a.message);return this.z_(d)}))}))}G_(e,t){const a=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo((()=>{a((()=>this.listener.Xo()))})),this.stream.t_((()=>{a((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((d=>{a((()=>this.z_(d)))})),this.stream.onMessage((d=>{a((()=>++this.F_==1?this.J_(d):this.onNext(d)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(e){return gn(eS,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget((()=>this.D_===e?t():(gn(eS,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class Nz extends KC{constructor(e,t,a,d,m,g){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,a,d,g),this.serializer=m}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=$5(this.serializer,e),a=(function(m){if(!("targetChange"in m))return ni.min();const g=m.targetChange;return g.targetIds&&g.targetIds.length?ni.min():g.readTime?Zh(g.readTime):ni.min()})(e);return this.listener.H_(t,a)}Y_(e){const t={};t.database=b1(this.serializer),t.addTarget=(function(m,g){let c;const C=g.target;if(c=p1(C)?{documents:H5(m,C)}:{query:Z5(m,C).ft},c.targetId=g.targetId,g.resumeToken.approximateByteSize()>0){c.resumeToken=NC(m,g.resumeToken);const R=_1(m,g.expectedCount);R!==null&&(c.expectedCount=R)}else if(g.snapshotVersion.compareTo(ni.min())>0){c.readTime=$0(m,g.snapshotVersion.toTimestamp());const R=_1(m,g.expectedCount);R!==null&&(c.expectedCount=R)}return c})(this.serializer,e);const a=K5(this.serializer,e);a&&(t.labels=a),this.q_(t)}Z_(e){const t={};t.database=b1(this.serializer),t.removeTarget=e,this.q_(t)}}class Bz extends KC{constructor(e,t,a,d,m,g){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,a,d,g),this.serializer=m}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return Cr(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,Cr(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){Cr(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=G5(e.writeResults,e.commitTime),a=Zh(e.commitTime);return this.listener.na(a,t)}ra(){const e={};e.database=b1(this.serializer),this.q_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map((a=>q5(this.serializer,a)))};this.q_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fz{}class Vz extends Fz{constructor(e,t,a,d){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=a,this.serializer=d,this.ia=!1}sa(){if(this.ia)throw new _n(Lt.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,a,d){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([m,g])=>this.connection.Go(e,y1(t,a),d,m,g))).catch((m=>{throw m.name==="FirebaseError"?(m.code===Lt.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),m):new _n(Lt.UNKNOWN,m.toString())}))}Ho(e,t,a,d,m){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([g,c])=>this.connection.Ho(e,y1(t,a),d,g,c,m))).catch((g=>{throw g.name==="FirebaseError"?(g.code===Lt.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),g):new _n(Lt.UNKNOWN,g.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}class Uz{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(Hd(t),this.aa=!1):gn("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jp="RemoteStore";class jz{constructor(e,t,a,d,m){this.localStore=e,this.datastore=t,this.asyncQueue=a,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=m,this.Aa.Oo((g=>{a.enqueueAndForget((async()=>{um(this)&&(gn(Jp,"Restarting streams for network reachability change."),await(async function(C){const R=si(C);R.Ea.add(4),await Uy(R),R.Ra.set("Unknown"),R.Ea.delete(4),await Cb(R)})(this))}))})),this.Ra=new Uz(a,d)}}async function Cb(n){if(um(n))for(const e of n.da)await e(!0)}async function Uy(n){for(const e of n.da)await e(!1)}function XC(n,e){const t=si(n);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),Rw(t)?Mw(t):kg(t).O_()&&Pw(t,e))}function Iw(n,e){const t=si(n),a=kg(t);t.Ia.delete(e),a.O_()&&YC(t,e),t.Ia.size===0&&(a.O_()?a.L_():um(t)&&t.Ra.set("Unknown"))}function Pw(n,e){if(n.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(ni.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}kg(n).Y_(e)}function YC(n,e){n.Va.Ue(e),kg(n).Z_(e)}function Mw(n){n.Va=new O5({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),At:e=>n.Ia.get(e)||null,ht:()=>n.datastore.serializer.databaseId}),kg(n).start(),n.Ra.ua()}function Rw(n){return um(n)&&!kg(n).x_()&&n.Ia.size>0}function um(n){return si(n).Ea.size===0}function QC(n){n.Va=void 0}async function $z(n){n.Ra.set("Online")}async function qz(n){n.Ia.forEach(((e,t)=>{Pw(n,e)}))}async function Gz(n,e){QC(n),Rw(n)?(n.Ra.ha(e),Mw(n)):n.Ra.set("Unknown")}async function Hz(n,e,t){if(n.Ra.set("Online"),e instanceof OC&&e.state===2&&e.cause)try{await(async function(d,m){const g=m.cause;for(const c of m.targetIds)d.Ia.has(c)&&(await d.remoteSyncer.rejectListen(c,g),d.Ia.delete(c),d.Va.removeTarget(c))})(n,e)}catch(a){gn(Jp,"Failed to remove targets %s: %s ",e.targetIds.join(","),a),await G0(n,a)}else if(e instanceof c0?n.Va.Ze(e):e instanceof zC?n.Va.st(e):n.Va.tt(e),!t.isEqual(ni.min()))try{const a=await ZC(n.localStore);t.compareTo(a)>=0&&await(function(m,g){const c=m.Va.Tt(g);return c.targetChanges.forEach(((C,R)=>{if(C.resumeToken.approximateByteSize()>0){const V=m.Ia.get(R);V&&m.Ia.set(R,V.withResumeToken(C.resumeToken,g))}})),c.targetMismatches.forEach(((C,R)=>{const V=m.Ia.get(C);if(!V)return;m.Ia.set(C,V.withResumeToken(il.EMPTY_BYTE_STRING,V.snapshotVersion)),YC(m,C);const q=new Df(V.target,C,R,V.sequenceNumber);Pw(m,q)})),m.remoteSyncer.applyRemoteEvent(c)})(n,t)}catch(a){gn(Jp,"Failed to raise snapshot:",a),await G0(n,a)}}async function G0(n,e,t){if(!Rg(e))throw e;n.Ea.add(1),await Uy(n),n.Ra.set("Offline"),t||(t=()=>ZC(n.localStore)),n.asyncQueue.enqueueRetryable((async()=>{gn(Jp,"Retrying IndexedDB access"),await t(),n.Ea.delete(1),await Cb(n)}))}function JC(n,e){return e().catch((t=>G0(n,t,e)))}async function Ib(n){const e=si(n),t=Kf(e);let a=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:mw;for(;Zz(e);)try{const d=await Iz(e.localStore,a);if(d===null){e.Ta.length===0&&t.L_();break}a=d.batchId,Wz(e,d)}catch(d){await G0(e,d)}eI(e)&&tI(e)}function Zz(n){return um(n)&&n.Ta.length<10}function Wz(n,e){n.Ta.push(e);const t=Kf(n);t.O_()&&t.X_&&t.ea(e.mutations)}function eI(n){return um(n)&&!Kf(n).x_()&&n.Ta.length>0}function tI(n){Kf(n).start()}async function Kz(n){Kf(n).ra()}async function Xz(n){const e=Kf(n);for(const t of n.Ta)e.ea(t.mutations)}async function Yz(n,e,t){const a=n.Ta.shift(),d=xw.from(a,e,t);await JC(n,(()=>n.remoteSyncer.applySuccessfulWrite(d))),await Ib(n)}async function Qz(n,e){e&&Kf(n).X_&&await(async function(a,d){if((function(g){return L5(g)&&g!==Lt.ABORTED})(d.code)){const m=a.Ta.shift();Kf(a).B_(),await JC(a,(()=>a.remoteSyncer.rejectFailedWrite(m.batchId,d))),await Ib(a)}})(n,e),eI(n)&&tI(n)}async function tS(n,e){const t=si(n);t.asyncQueue.verifyOperationInProgress(),gn(Jp,"RemoteStore received new credentials");const a=um(t);t.Ea.add(3),await Uy(t),a&&t.Ra.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await Cb(t)}async function Jz(n,e){const t=si(n);e?(t.Ea.delete(2),await Cb(t)):e||(t.Ea.add(2),await Uy(t),t.Ra.set("Unknown"))}function kg(n){return n.ma||(n.ma=(function(t,a,d){const m=si(t);return m.sa(),new Nz(a,m.connection,m.authCredentials,m.appCheckCredentials,m.serializer,d)})(n.datastore,n.asyncQueue,{Xo:$z.bind(null,n),t_:qz.bind(null,n),r_:Gz.bind(null,n),H_:Hz.bind(null,n)}),n.da.push((async e=>{e?(n.ma.B_(),Rw(n)?Mw(n):n.Ra.set("Unknown")):(await n.ma.stop(),QC(n))}))),n.ma}function Kf(n){return n.fa||(n.fa=(function(t,a,d){const m=si(t);return m.sa(),new Bz(a,m.connection,m.authCredentials,m.appCheckCredentials,m.serializer,d)})(n.datastore,n.asyncQueue,{Xo:()=>Promise.resolve(),t_:Kz.bind(null,n),r_:Qz.bind(null,n),ta:Xz.bind(null,n),na:Yz.bind(null,n)}),n.da.push((async e=>{e?(n.fa.B_(),await Ib(n)):(await n.fa.stop(),n.Ta.length>0&&(gn(Jp,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))}))),n.fa}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kw{constructor(e,t,a,d,m){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=a,this.op=d,this.removalCallback=m,this.deferred=new Uf,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((g=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,a,d,m){const g=Date.now()+a,c=new kw(e,t,g,d,m);return c.start(a),c}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new _n(Lt.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Lw(n,e){if(Hd("AsyncQueue",`${e}: ${n}`),Rg(n))return new _n(Lt.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sg{static emptySet(e){return new sg(e.comparator)}constructor(e){this.comparator=e?(t,a)=>e(t,a)||On.comparator(t.key,a.key):(t,a)=>On.comparator(t.key,a.key),this.keyedMap=q_(),this.sortedSet=new Va(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,a)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof sg)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),a=e.sortedSet.getIterator();for(;t.hasNext();){const d=t.getNext().key,m=a.getNext().key;if(!d.isEqual(m))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const a=new sg;return a.comparator=this.comparator,a.keyedMap=e,a.sortedSet=t,a}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nS{constructor(){this.ga=new Va(On.comparator)}track(e){const t=e.doc.key,a=this.ga.get(t);a?e.type!==0&&a.type===3?this.ga=this.ga.insert(t,e):e.type===3&&a.type!==1?this.ga=this.ga.insert(t,{type:a.type,doc:e.doc}):e.type===2&&a.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&a.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&a.type===0?this.ga=this.ga.remove(t):e.type===1&&a.type===2?this.ga=this.ga.insert(t,{type:1,doc:a.doc}):e.type===0&&a.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):Zn(63341,{Rt:e,pa:a}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal(((t,a)=>{e.push(a)})),e}}class xg{constructor(e,t,a,d,m,g,c,C,R){this.query=e,this.docs=t,this.oldDocs=a,this.docChanges=d,this.mutatedKeys=m,this.fromCache=g,this.syncStateChanged=c,this.excludesMetadataChanges=C,this.hasCachedResults=R}static fromInitialDocuments(e,t,a,d,m){const g=[];return t.forEach((c=>{g.push({type:0,doc:c})})),new xg(e,t,sg.emptySet(t),g,a,d,!0,!1,m)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&xb(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,a=e.docChanges;if(t.length!==a.length)return!1;for(let d=0;d<t.length;d++)if(t[d].type!==a[d].type||!t[d].doc.isEqual(a[d].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class e3{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((e=>e.Da()))}}class t3{constructor(){this.queries=iS(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,a){const d=si(t),m=d.queries;d.queries=iS(),m.forEach(((g,c)=>{for(const C of c.Sa)C.onError(a)}))})(this,new _n(Lt.ABORTED,"Firestore shutting down"))}}function iS(){return new om((n=>xC(n)),xb)}async function n3(n,e){const t=si(n);let a=3;const d=e.query;let m=t.queries.get(d);m?!m.ba()&&e.Da()&&(a=2):(m=new e3,a=e.Da()?0:1);try{switch(a){case 0:m.wa=await t.onListen(d,!0);break;case 1:m.wa=await t.onListen(d,!1);break;case 2:await t.onFirstRemoteStoreListen(d)}}catch(g){const c=Lw(g,`Initialization of query '${Jm(e.query)}' failed`);return void e.onError(c)}t.queries.set(d,m),m.Sa.push(e),e.va(t.onlineState),m.wa&&e.Fa(m.wa)&&Dw(t)}async function i3(n,e){const t=si(n),a=e.query;let d=3;const m=t.queries.get(a);if(m){const g=m.Sa.indexOf(e);g>=0&&(m.Sa.splice(g,1),m.Sa.length===0?d=e.Da()?0:1:!m.ba()&&e.Da()&&(d=2))}switch(d){case 0:return t.queries.delete(a),t.onUnlisten(a,!0);case 1:return t.queries.delete(a),t.onUnlisten(a,!1);case 2:return t.onLastRemoteStoreUnlisten(a);default:return}}function r3(n,e){const t=si(n);let a=!1;for(const d of e){const m=d.query,g=t.queries.get(m);if(g){for(const c of g.Sa)c.Fa(d)&&(a=!0);g.wa=d}}a&&Dw(t)}function a3(n,e,t){const a=si(n),d=a.queries.get(e);if(d)for(const m of d.Sa)m.onError(t);a.queries.delete(e)}function Dw(n){n.Ca.forEach((e=>{e.next()}))}var T1,rS;(rS=T1||(T1={})).Ma="default",rS.Cache="cache";class s3{constructor(e,t,a){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=a||{}}Fa(e){if(!this.options.includeMetadataChanges){const a=[];for(const d of e.docChanges)d.type!==3&&a.push(d);e=new xg(e.query,e.docs,e.oldDocs,a,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;const a=t!=="Offline";return(!this.options.qa||!a)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=xg.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==T1.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nI{constructor(e){this.key=e}}class iI{constructor(e){this.key=e}}class o3{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=Bi(),this.mutatedKeys=Bi(),this.eu=wC(e),this.tu=new sg(this.eu)}get nu(){return this.Ya}ru(e,t){const a=t?t.iu:new nS,d=t?t.tu:this.tu;let m=t?t.mutatedKeys:this.mutatedKeys,g=d,c=!1;const C=this.query.limitType==="F"&&d.size===this.query.limit?d.last():null,R=this.query.limitType==="L"&&d.size===this.query.limit?d.first():null;if(e.inorderTraversal(((V,q)=>{const J=d.get(V),Y=wb(this.query,q)?q:null,xe=!!J&&this.mutatedKeys.has(J.key),be=!!Y&&(Y.hasLocalMutations||this.mutatedKeys.has(Y.key)&&Y.hasCommittedMutations);let Oe=!1;J&&Y?J.data.isEqual(Y.data)?xe!==be&&(a.track({type:3,doc:Y}),Oe=!0):this.su(J,Y)||(a.track({type:2,doc:Y}),Oe=!0,(C&&this.eu(Y,C)>0||R&&this.eu(Y,R)<0)&&(c=!0)):!J&&Y?(a.track({type:0,doc:Y}),Oe=!0):J&&!Y&&(a.track({type:1,doc:J}),Oe=!0,(C||R)&&(c=!0)),Oe&&(Y?(g=g.add(Y),m=be?m.add(V):m.delete(V)):(g=g.delete(V),m=m.delete(V)))})),this.query.limit!==null)for(;g.size>this.query.limit;){const V=this.query.limitType==="F"?g.last():g.first();g=g.delete(V.key),m=m.delete(V.key),a.track({type:1,doc:V})}return{tu:g,iu:a,Cs:c,mutatedKeys:m}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,a,d){const m=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const g=e.iu.ya();g.sort(((V,q)=>(function(Y,xe){const be=Oe=>{switch(Oe){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Zn(20277,{Rt:Oe})}};return be(Y)-be(xe)})(V.type,q.type)||this.eu(V.doc,q.doc))),this.ou(a),d=d??!1;const c=t&&!d?this._u():[],C=this.Xa.size===0&&this.current&&!d?1:0,R=C!==this.Za;return this.Za=C,g.length!==0||R?{snapshot:new xg(this.query,e.tu,m,g,e.mutatedKeys,C===0,R,!1,!!a&&a.resumeToken.approximateByteSize()>0),au:c}:{au:c}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new nS,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach((t=>this.Ya=this.Ya.add(t))),e.modifiedDocuments.forEach((t=>{})),e.removedDocuments.forEach((t=>this.Ya=this.Ya.delete(t))),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=Bi(),this.tu.forEach((a=>{this.uu(a.key)&&(this.Xa=this.Xa.add(a.key))}));const t=[];return e.forEach((a=>{this.Xa.has(a)||t.push(new iI(a))})),this.Xa.forEach((a=>{e.has(a)||t.push(new nI(a))})),t}cu(e){this.Ya=e.Qs,this.Xa=Bi();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return xg.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const zw="SyncEngine";class l3{constructor(e,t,a){this.query=e,this.targetId=t,this.view=a}}class u3{constructor(e){this.key=e,this.hu=!1}}class c3{constructor(e,t,a,d,m,g){this.localStore=e,this.remoteStore=t,this.eventManager=a,this.sharedClientState=d,this.currentUser=m,this.maxConcurrentLimboResolutions=g,this.Pu={},this.Tu=new om((c=>xC(c)),xb),this.Iu=new Map,this.Eu=new Set,this.du=new Va(On.comparator),this.Au=new Map,this.Ru=new Sw,this.Vu={},this.mu=new Map,this.fu=bg.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function h3(n,e,t=!0){const a=uI(n);let d;const m=a.Tu.get(e);return m?(a.sharedClientState.addLocalQueryTarget(m.targetId),d=m.view.lu()):d=await rI(a,e,t,!0),d}async function d3(n,e){const t=uI(n);await rI(t,e,!0,!1)}async function rI(n,e,t,a){const d=await Pz(n.localStore,Hh(e)),m=d.targetId,g=n.sharedClientState.addLocalQueryTarget(m,t);let c;return a&&(c=await f3(n,e,m,g==="current",d.resumeToken)),n.isPrimaryClient&&t&&XC(n.remoteStore,d),c}async function f3(n,e,t,a,d){n.pu=(q,J,Y)=>(async function(be,Oe,et,Je){let qe=Oe.view.ru(et);qe.Cs&&(qe=await XT(be.localStore,Oe.query,!1).then((({documents:de})=>Oe.view.ru(de,qe))));const Ze=Je&&Je.targetChanges.get(Oe.targetId),je=Je&&Je.targetMismatches.get(Oe.targetId)!=null,Be=Oe.view.applyChanges(qe,be.isPrimaryClient,Ze,je);return sS(be,Oe.targetId,Be.au),Be.snapshot})(n,q,J,Y);const m=await XT(n.localStore,e,!0),g=new o3(e,m.Qs),c=g.ru(m.documents),C=Vy.createSynthesizedTargetChangeForCurrentChange(t,a&&n.onlineState!=="Offline",d),R=g.applyChanges(c,n.isPrimaryClient,C);sS(n,t,R.au);const V=new l3(e,t,g);return n.Tu.set(e,V),n.Iu.has(t)?n.Iu.get(t).push(e):n.Iu.set(t,[e]),R.snapshot}async function p3(n,e,t){const a=si(n),d=a.Tu.get(e),m=a.Iu.get(d.targetId);if(m.length>1)return a.Iu.set(d.targetId,m.filter((g=>!xb(g,e)))),void a.Tu.delete(e);a.isPrimaryClient?(a.sharedClientState.removeLocalQueryTarget(d.targetId),a.sharedClientState.isActiveQueryTarget(d.targetId)||await x1(a.localStore,d.targetId,!1).then((()=>{a.sharedClientState.clearQueryState(d.targetId),t&&Iw(a.remoteStore,d.targetId),S1(a,d.targetId)})).catch(Mg)):(S1(a,d.targetId),await x1(a.localStore,d.targetId,!0))}async function m3(n,e){const t=si(n),a=t.Tu.get(e),d=t.Iu.get(a.targetId);t.isPrimaryClient&&d.length===1&&(t.sharedClientState.removeLocalQueryTarget(a.targetId),Iw(t.remoteStore,a.targetId))}async function g3(n,e,t){const a=T3(n);try{const d=await(function(g,c){const C=si(g),R=da.now(),V=c.reduce(((Y,xe)=>Y.add(xe.key)),Bi());let q,J;return C.persistence.runTransaction("Locally write mutations","readwrite",(Y=>{let xe=Zd(),be=Bi();return C.Ns.getEntries(Y,V).next((Oe=>{xe=Oe,xe.forEach(((et,Je)=>{Je.isValidDocument()||(be=be.add(et))}))})).next((()=>C.localDocuments.getOverlayedDocuments(Y,xe))).next((Oe=>{q=Oe;const et=[];for(const Je of c){const qe=I5(Je,q.get(Je.key).overlayedDocument);qe!=null&&et.push(new lm(Je.key,qe,dC(qe.value.mapValue),Ud.exists(!0)))}return C.mutationQueue.addMutationBatch(Y,R,et,c)})).next((Oe=>{J=Oe;const et=Oe.applyToLocalDocumentSet(q,be);return C.documentOverlayCache.saveOverlays(Y,Oe.batchId,et)}))})).then((()=>({batchId:J.batchId,changes:SC(q)})))})(a.localStore,e);a.sharedClientState.addPendingMutation(d.batchId),(function(g,c,C){let R=g.Vu[g.currentUser.toKey()];R||(R=new Va(Ni)),R=R.insert(c,C),g.Vu[g.currentUser.toKey()]=R})(a,d.batchId,t),await jy(a,d.changes),await Ib(a.remoteStore)}catch(d){const m=Lw(d,"Failed to persist write");t.reject(m)}}async function aI(n,e){const t=si(n);try{const a=await Az(t.localStore,e);e.targetChanges.forEach(((d,m)=>{const g=t.Au.get(m);g&&(Cr(d.addedDocuments.size+d.modifiedDocuments.size+d.removedDocuments.size<=1,22616),d.addedDocuments.size>0?g.hu=!0:d.modifiedDocuments.size>0?Cr(g.hu,14607):d.removedDocuments.size>0&&(Cr(g.hu,42227),g.hu=!1))})),await jy(t,a,e)}catch(a){await Mg(a)}}function aS(n,e,t){const a=si(n);if(a.isPrimaryClient&&t===0||!a.isPrimaryClient&&t===1){const d=[];a.Tu.forEach(((m,g)=>{const c=g.view.va(e);c.snapshot&&d.push(c.snapshot)})),(function(g,c){const C=si(g);C.onlineState=c;let R=!1;C.queries.forEach(((V,q)=>{for(const J of q.Sa)J.va(c)&&(R=!0)})),R&&Dw(C)})(a.eventManager,e),d.length&&a.Pu.H_(d),a.onlineState=e,a.isPrimaryClient&&a.sharedClientState.setOnlineState(e)}}async function _3(n,e,t){const a=si(n);a.sharedClientState.updateQueryState(e,"rejected",t);const d=a.Au.get(e),m=d&&d.key;if(m){let g=new Va(On.comparator);g=g.insert(m,Rl.newNoDocument(m,ni.min()));const c=Bi().add(m),C=new Eb(ni.min(),new Map,new Va(Ni),g,c);await aI(a,C),a.du=a.du.remove(m),a.Au.delete(e),Ow(a)}else await x1(a.localStore,e,!1).then((()=>S1(a,e,t))).catch(Mg)}async function y3(n,e){const t=si(n),a=e.batch.batchId;try{const d=await Ez(t.localStore,e);oI(t,a,null),sI(t,a),t.sharedClientState.updateMutationState(a,"acknowledged"),await jy(t,d)}catch(d){await Mg(d)}}async function v3(n,e,t){const a=si(n);try{const d=await(function(g,c){const C=si(g);return C.persistence.runTransaction("Reject batch","readwrite-primary",(R=>{let V;return C.mutationQueue.lookupMutationBatch(R,c).next((q=>(Cr(q!==null,37113),V=q.keys(),C.mutationQueue.removeMutationBatch(R,q)))).next((()=>C.mutationQueue.performConsistencyCheck(R))).next((()=>C.documentOverlayCache.removeOverlaysForBatchId(R,V,c))).next((()=>C.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(R,V))).next((()=>C.localDocuments.getDocuments(R,V)))}))})(a.localStore,e);oI(a,e,t),sI(a,e),a.sharedClientState.updateMutationState(e,"rejected",t),await jy(a,d)}catch(d){await Mg(d)}}function sI(n,e){(n.mu.get(e)||[]).forEach((t=>{t.resolve()})),n.mu.delete(e)}function oI(n,e,t){const a=si(n);let d=a.Vu[a.currentUser.toKey()];if(d){const m=d.get(e);m&&(t?m.reject(t):m.resolve(),d=d.remove(e)),a.Vu[a.currentUser.toKey()]=d}}function S1(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const a of n.Iu.get(e))n.Tu.delete(a),t&&n.Pu.yu(a,t);n.Iu.delete(e),n.isPrimaryClient&&n.Ru.jr(e).forEach((a=>{n.Ru.containsKey(a)||lI(n,a)}))}function lI(n,e){n.Eu.delete(e.path.canonicalString());const t=n.du.get(e);t!==null&&(Iw(n.remoteStore,t),n.du=n.du.remove(e),n.Au.delete(t),Ow(n))}function sS(n,e,t){for(const a of t)a instanceof nI?(n.Ru.addReference(a.key,e),b3(n,a)):a instanceof iI?(gn(zw,"Document no longer in limbo: "+a.key),n.Ru.removeReference(a.key,e),n.Ru.containsKey(a.key)||lI(n,a.key)):Zn(19791,{wu:a})}function b3(n,e){const t=e.key,a=t.path.canonicalString();n.du.get(t)||n.Eu.has(a)||(gn(zw,"New document in limbo: "+t),n.Eu.add(a),Ow(n))}function Ow(n){for(;n.Eu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){const e=n.Eu.values().next().value;n.Eu.delete(e);const t=new On(ta.fromString(e)),a=n.fu.next();n.Au.set(a,new u3(t)),n.du=n.du.insert(t,a),XC(n.remoteStore,new Df(Hh(vC(t.path)),a,"TargetPurposeLimboResolution",yb.ce))}}async function jy(n,e,t){const a=si(n),d=[],m=[],g=[];a.Tu.isEmpty()||(a.Tu.forEach(((c,C)=>{g.push(a.pu(C,e,t).then((R=>{var V;if((R||t)&&a.isPrimaryClient){const q=R?!R.fromCache:(V=t==null?void 0:t.targetChanges.get(C.targetId))==null?void 0:V.current;a.sharedClientState.updateQueryState(C.targetId,q?"current":"not-current")}if(R){d.push(R);const q=Aw.As(C.targetId,R);m.push(q)}})))})),await Promise.all(g),a.Pu.H_(d),await(async function(C,R){const V=si(C);try{await V.persistence.runTransaction("notifyLocalViewChanges","readwrite",(q=>Dt.forEach(R,(J=>Dt.forEach(J.Es,(Y=>V.persistence.referenceDelegate.addReference(q,J.targetId,Y))).next((()=>Dt.forEach(J.ds,(Y=>V.persistence.referenceDelegate.removeReference(q,J.targetId,Y)))))))))}catch(q){if(!Rg(q))throw q;gn(Cw,"Failed to update sequence numbers: "+q)}for(const q of R){const J=q.targetId;if(!q.fromCache){const Y=V.Ms.get(J),xe=Y.snapshotVersion,be=Y.withLastLimboFreeSnapshotVersion(xe);V.Ms=V.Ms.insert(J,be)}}})(a.localStore,m))}async function x3(n,e){const t=si(n);if(!t.currentUser.isEqual(e)){gn(zw,"User change. New user:",e.toKey());const a=await HC(t.localStore,e);t.currentUser=e,(function(m,g){m.mu.forEach((c=>{c.forEach((C=>{C.reject(new _n(Lt.CANCELLED,g))}))})),m.mu.clear()})(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,a.removedBatchIds,a.addedBatchIds),await jy(t,a.Ls)}}function w3(n,e){const t=si(n),a=t.Au.get(e);if(a&&a.hu)return Bi().add(a.key);{let d=Bi();const m=t.Iu.get(e);if(!m)return d;for(const g of m){const c=t.Tu.get(g);d=d.unionWith(c.view.nu)}return d}}function uI(n){const e=si(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=aI.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=w3.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=_3.bind(null,e),e.Pu.H_=r3.bind(null,e.eventManager),e.Pu.yu=a3.bind(null,e.eventManager),e}function T3(n){const e=si(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=y3.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=v3.bind(null,e),e}class H0{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Ab(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return Sz(this.persistence,new xz,e.initialUser,this.serializer)}Cu(e){return new GC(Ew.mi,this.serializer)}Du(e){return new Rz}async terminate(){var e,t;(e=this.gcScheduler)==null||e.stop(),(t=this.indexBackfillerScheduler)==null||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}H0.provider={build:()=>new H0};class S3 extends H0{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){Cr(this.persistence.referenceDelegate instanceof q0,46915);const a=this.persistence.referenceDelegate.garbageCollector;return new sz(a,e.asyncQueue,t)}Cu(e){const t=this.cacheSizeBytes!==void 0?cu.withCacheSize(this.cacheSizeBytes):cu.DEFAULT;return new GC((a=>q0.mi(a,t)),this.serializer)}}class E1{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=a=>aS(this.syncEngine,a,1),this.remoteStore.remoteSyncer.handleCredentialChange=x3.bind(null,this.syncEngine),await Jz(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new t3})()}createDatastore(e){const t=Ab(e.databaseInfo.databaseId),a=(function(m){return new Oz(m)})(e.databaseInfo);return(function(m,g,c,C){return new Vz(m,g,c,C)})(e.authCredentials,e.appCheckCredentials,a,t)}createRemoteStore(e){return(function(a,d,m,g,c){return new jz(a,d,m,g,c)})(this.localStore,this.datastore,e.asyncQueue,(t=>aS(this.syncEngine,t,0)),(function(){return JT.v()?new JT:new kz})())}createSyncEngine(e,t){return(function(d,m,g,c,C,R,V){const q=new c3(d,m,g,c,C,R);return V&&(q.gu=!0),q})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await(async function(d){const m=si(d);gn(Jp,"RemoteStore shutting down."),m.Ea.add(5),await Uy(m),m.Aa.shutdown(),m.Ra.set("Unknown")})(this.remoteStore),(e=this.datastore)==null||e.terminate(),(t=this.eventManager)==null||t.terminate()}}E1.provider={build:()=>new E1};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class E3{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):Hd("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout((()=>{this.muted||e(t)}),0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xf="FirestoreClient";class A3{constructor(e,t,a,d,m){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=a,this.databaseInfo=d,this.user=Ml.UNAUTHENTICATED,this.clientId=pw.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=m,this.authCredentials.start(a,(async g=>{gn(Xf,"Received user=",g.uid),await this.authCredentialListener(g),this.user=g})),this.appCheckCredentials.start(a,(g=>(gn(Xf,"Received new app check token=",g),this.appCheckCredentialListener(g,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Uf;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const a=Lw(t,"Failed to shutdown persistence");e.reject(a)}})),e.promise}}async function Mx(n,e){n.asyncQueue.verifyOperationInProgress(),gn(Xf,"Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let a=t.initialUser;n.setCredentialChangeListener((async d=>{a.isEqual(d)||(await HC(e.localStore,d),a=d)})),e.persistence.setDatabaseDeletedListener((()=>n.terminate())),n._offlineComponents=e}async function oS(n,e){n.asyncQueue.verifyOperationInProgress();const t=await C3(n);gn(Xf,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener((a=>tS(e.remoteStore,a))),n.setAppCheckTokenChangeListener(((a,d)=>tS(e.remoteStore,d))),n._onlineComponents=e}async function C3(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){gn(Xf,"Using user provided OfflineComponentProvider");try{await Mx(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!(function(d){return d.name==="FirebaseError"?d.code===Lt.FAILED_PRECONDITION||d.code===Lt.UNIMPLEMENTED:!(typeof DOMException<"u"&&d instanceof DOMException)||d.code===22||d.code===20||d.code===11})(t))throw t;gg("Error using user provided cache. Falling back to memory cache: "+t),await Mx(n,new H0)}}else gn(Xf,"Using default OfflineComponentProvider"),await Mx(n,new S3(void 0));return n._offlineComponents}async function cI(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(gn(Xf,"Using user provided OnlineComponentProvider"),await oS(n,n._uninitializedComponentsProvider._online)):(gn(Xf,"Using default OnlineComponentProvider"),await oS(n,new E1))),n._onlineComponents}function I3(n){return cI(n).then((e=>e.syncEngine))}async function P3(n){const e=await cI(n),t=e.eventManager;return t.onListen=h3.bind(null,e.syncEngine),t.onUnlisten=p3.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=d3.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=m3.bind(null,e.syncEngine),t}function M3(n,e,t={}){const a=new Uf;return n.asyncQueue.enqueueAndForget((async()=>(function(m,g,c,C,R){const V=new E3({next:J=>{V.Nu(),g.enqueueAndForget((()=>i3(m,q))),J.fromCache&&C.source==="server"?R.reject(new _n(Lt.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):R.resolve(J)},error:J=>R.reject(J)}),q=new s3(c,V,{includeMetadataChanges:!0,qa:!0});return n3(m,q)})(await P3(n),n.asyncQueue,e,t,a))),a.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hI(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lS=new Map;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dI="firestore.googleapis.com",uS=!0;class cS{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new _n(Lt.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=dI,this.ssl=uS}else this.host=e.host,this.ssl=e.ssl??uS;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=qC;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<rz)throw new _n(Lt.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}UD("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=hI(e.experimentalLongPollingOptions??{}),(function(a){if(a.timeoutSeconds!==void 0){if(isNaN(a.timeoutSeconds))throw new _n(Lt.INVALID_ARGUMENT,`invalid long polling timeout: ${a.timeoutSeconds} (must not be NaN)`);if(a.timeoutSeconds<5)throw new _n(Lt.INVALID_ARGUMENT,`invalid long polling timeout: ${a.timeoutSeconds} (minimum allowed value is 5)`);if(a.timeoutSeconds>30)throw new _n(Lt.INVALID_ARGUMENT,`invalid long polling timeout: ${a.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(a,d){return a.timeoutSeconds===d.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Pb{constructor(e,t,a,d){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=a,this._app=d,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new cS({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new _n(Lt.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new _n(Lt.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new cS(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(a){if(!a)return new RD;switch(a.type){case"firstParty":return new zD(a.sessionIndex||"0",a.iamToken||null,a.authTokenFactory||null);case"provider":return a.client;default:throw new _n(Lt.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(t){const a=lS.get(t);a&&(gn("ComponentProvider","Removing Datastore"),lS.delete(t),a.terminate())})(this),Promise.resolve()}}function R3(n,e,t,a={}){var R;n=O0(n,Pb);const d=Cg(e),m=n._getSettings(),g={...m,emulatorOptions:n._getEmulatorOptions()},c=`${e}:${t}`;d&&(NA(`https://${c}`),BA("Firestore",!0)),m.host!==dI&&m.host!==c&&gg("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const C={...m,host:c,ssl:d,emulatorOptions:a};if(!qf(C,g)&&(n._setSettings(C),a.mockUserToken)){let V,q;if(typeof a.mockUserToken=="string")V=a.mockUserToken,q=Ml.MOCK_USER;else{V=iL(a.mockUserToken,(R=n._app)==null?void 0:R.options.projectId);const J=a.mockUserToken.sub||a.mockUserToken.user_id;if(!J)throw new _n(Lt.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");q=new Ml(J)}n._authCredentials=new kD(new eC(V,q))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lg{constructor(e,t,a){this.converter=t,this._query=a,this.type="query",this.firestore=e}withConverter(e){return new Lg(this.firestore,e,this._query)}}class wo{constructor(e,t,a){this.converter=t,this._key=a,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new jf(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new wo(this.firestore,e,this._key)}toJSON(){return{type:wo._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,a){if(Ny(t,wo._jsonSchema))return new wo(e,a||null,new On(ta.fromString(t.referencePath)))}}wo._jsonSchemaVersion="firestore/documentReference/1.0",wo._jsonSchema={type:Os("string",wo._jsonSchemaVersion),referencePath:Os("string")};class jf extends Lg{constructor(e,t,a){super(e,t,vC(a)),this._path=a,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new wo(this.firestore,null,new On(e))}withConverter(e){return new jf(this.firestore,e,this._path)}}function fI(n,e,...t){if(n=Ll(n),tC("collection","path",e),n instanceof Pb){const a=ta.fromString(e,...t);return TT(a),new jf(n,null,a)}{if(!(n instanceof wo||n instanceof jf))throw new _n(Lt.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const a=n._path.child(ta.fromString(e,...t));return TT(a),new jf(n.firestore,null,a)}}function k3(n,e,...t){if(n=Ll(n),arguments.length===1&&(e=pw.newId()),tC("doc","path",e),n instanceof Pb){const a=ta.fromString(e,...t);return wT(a),new wo(n,null,new On(a))}{if(!(n instanceof wo||n instanceof jf))throw new _n(Lt.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const a=n._path.child(ta.fromString(e,...t));return wT(a),new wo(n.firestore,n instanceof jf?n.converter:null,new On(a))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hS="AsyncQueue";class dS{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new WC(this,"async_queue_retry"),this._c=()=>{const a=Px();a&&gn(hS,"Visibility state changed to "+a.visibilityState),this.M_.w_()},this.ac=e;const t=Px();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=Px();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise((()=>{}));const t=new Uf;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Xu.push(e),this.lc())))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!Rg(e))throw e;gn(hS,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(e){const t=this.ac.then((()=>(this.rc=!0,e().catch((a=>{throw this.nc=a,this.rc=!1,Hd("INTERNAL UNHANDLED ERROR: ",fS(a)),a})).then((a=>(this.rc=!1,a))))));return this.ac=t,t}enqueueAfterDelay(e,t,a){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const d=kw.createAndSchedule(this,e,t,a,(m=>this.hc(m)));return this.tc.push(d),d}uc(){this.nc&&Zn(47125,{Pc:fS(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then((()=>{this.tc.sort(((t,a)=>t.targetTimeMs-a.targetTimeMs));for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()}))}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function fS(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}class Nw extends Pb{constructor(e,t,a,d){super(e,t,a,d),this.type="firestore",this._queue=new dS,this._persistenceKey=(d==null?void 0:d.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new dS(e),this._firestoreClient=void 0,await e}}}function L3(n,e){const t=typeof n=="object"?n:gb(),a=typeof n=="string"?n:B0,d=Qd(t,"firestore").getImmediate({identifier:a});if(!d._initialized){const m=nL("firestore");m&&R3(d,...m)}return d}function pI(n){if(n._terminated)throw new _n(Lt.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||D3(n),n._firestoreClient}function D3(n){var a,d,m;const e=n._freezeSettings(),t=(function(c,C,R,V){return new QD(c,C,R,V.host,V.ssl,V.experimentalForceLongPolling,V.experimentalAutoDetectLongPolling,hI(V.experimentalLongPollingOptions),V.useFetchStreams,V.isUsingEmulator)})(n._databaseId,((a=n._app)==null?void 0:a.options.appId)||"",n._persistenceKey,e);n._componentsProvider||(d=e.localCache)!=null&&d._offlineComponentProvider&&((m=e.localCache)!=null&&m._onlineComponentProvider)&&(n._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),n._firestoreClient=new A3(n._authCredentials,n._appCheckCredentials,n._queue,t,n._componentsProvider&&(function(c){const C=c==null?void 0:c._online.build();return{_offline:c==null?void 0:c._offline.build(C),_online:C}})(n._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lc{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Lc(il.fromBase64String(e))}catch(t){throw new _n(Lt.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Lc(il.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:Lc._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(Ny(e,Lc._jsonSchema))return Lc.fromBase64String(e.bytes)}}Lc._jsonSchemaVersion="firestore/bytes/1.0",Lc._jsonSchema={type:Os("string",Lc._jsonSchemaVersion),bytes:Os("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bw{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new _n(Lt.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new nl(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fw{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wh{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new _n(Lt.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new _n(Lt.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return Ni(this._lat,e._lat)||Ni(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Wh._jsonSchemaVersion}}static fromJSON(e){if(Ny(e,Wh._jsonSchema))return new Wh(e.latitude,e.longitude)}}Wh._jsonSchemaVersion="firestore/geoPoint/1.0",Wh._jsonSchema={type:Os("string",Wh._jsonSchemaVersion),latitude:Os("number"),longitude:Os("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kh{constructor(e){this._values=(e||[]).map((t=>t))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(a,d){if(a.length!==d.length)return!1;for(let m=0;m<a.length;++m)if(a[m]!==d[m])return!1;return!0})(this._values,e._values)}toJSON(){return{type:Kh._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(Ny(e,Kh._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((t=>typeof t=="number")))return new Kh(e.vectorValues);throw new _n(Lt.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Kh._jsonSchemaVersion="firestore/vectorValue/1.0",Kh._jsonSchema={type:Os("string",Kh._jsonSchemaVersion),vectorValues:Os("object")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const z3=/^__.*__$/;class O3{constructor(e,t,a){this.data=e,this.fieldMask=t,this.fieldTransforms=a}toMutation(e,t){return this.fieldMask!==null?new lm(e,this.data,this.fieldMask,t,this.fieldTransforms):new Fy(e,this.data,t,this.fieldTransforms)}}function mI(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Zn(40011,{Ac:n})}}class Vw{constructor(e,t,a,d,m,g){this.settings=e,this.databaseId=t,this.serializer=a,this.ignoreUndefinedProperties=d,m===void 0&&this.Rc(),this.fieldTransforms=m||[],this.fieldMask=g||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new Vw({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){var d;const t=(d=this.path)==null?void 0:d.child(e),a=this.Vc({path:t,fc:!1});return a.gc(e),a}yc(e){var d;const t=(d=this.path)==null?void 0:d.child(e),a=this.Vc({path:t,fc:!1});return a.Rc(),a}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return Z0(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find((t=>e.isPrefixOf(t)))!==void 0||this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(mI(this.Ac)&&z3.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class N3{constructor(e,t,a){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=a||Ab(e)}Cc(e,t,a,d=!1){return new Vw({Ac:e,methodName:t,Dc:a,path:nl.emptyPath(),fc:!1,bc:d},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function gI(n){const e=n._freezeSettings(),t=Ab(n._databaseId);return new N3(n._databaseId,!!e.ignoreUndefinedProperties,t)}function B3(n,e,t,a,d,m={}){const g=n.Cc(m.merge||m.mergeFields?2:0,e,t,d);vI("Data must be an object, but it was:",g,a);const c=_I(a,g);let C,R;if(m.merge)C=new lh(g.fieldMask),R=g.fieldTransforms;else if(m.mergeFields){const V=[];for(const q of m.mergeFields){const J=V3(e,q,t);if(!g.contains(J))throw new _n(Lt.INVALID_ARGUMENT,`Field '${J}' is specified in your field mask but missing from your input data.`);j3(V,J)||V.push(J)}C=new lh(V),R=g.fieldTransforms.filter((q=>C.covers(q.field)))}else C=null,R=g.fieldTransforms;return new O3(new kc(c),C,R)}class Uw extends Fw{_toFieldTransform(e){return new S5(e.path,new gy)}isEqual(e){return e instanceof Uw}}function F3(n,e,t,a=!1){return jw(t,n.Cc(a?4:3,e))}function jw(n,e){if(yI(n=Ll(n)))return vI("Unsupported field value:",e,n),_I(n,e);if(n instanceof Fw)return(function(a,d){if(!mI(d.Ac))throw d.Sc(`${a._methodName}() can only be used with update() and set()`);if(!d.path)throw d.Sc(`${a._methodName}() is not currently supported inside arrays`);const m=a._toFieldTransform(d);m&&d.fieldTransforms.push(m)})(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return(function(a,d){const m=[];let g=0;for(const c of a){let C=jw(c,d.wc(g));C==null&&(C={nullValue:"NULL_VALUE"}),m.push(C),g++}return{arrayValue:{values:m}}})(n,e)}return(function(a,d){if((a=Ll(a))===null)return{nullValue:"NULL_VALUE"};if(typeof a=="number")return x5(d.serializer,a);if(typeof a=="boolean")return{booleanValue:a};if(typeof a=="string")return{stringValue:a};if(a instanceof Date){const m=da.fromDate(a);return{timestampValue:$0(d.serializer,m)}}if(a instanceof da){const m=new da(a.seconds,1e3*Math.floor(a.nanoseconds/1e3));return{timestampValue:$0(d.serializer,m)}}if(a instanceof Wh)return{geoPointValue:{latitude:a.latitude,longitude:a.longitude}};if(a instanceof Lc)return{bytesValue:NC(d.serializer,a._byteString)};if(a instanceof wo){const m=d.databaseId,g=a.firestore._databaseId;if(!g.isEqual(m))throw d.Sc(`Document reference is for database ${g.projectId}/${g.database} but should be for database ${m.projectId}/${m.database}`);return{referenceValue:Tw(a.firestore._databaseId||d.databaseId,a._key.path)}}if(a instanceof Kh)return(function(g,c){return{mapValue:{fields:{[cC]:{stringValue:hC},[F0]:{arrayValue:{values:g.toArray().map((R=>{if(typeof R!="number")throw c.Sc("VectorValues must only contain numeric values.");return bw(c.serializer,R)}))}}}}}})(a,d);throw d.Sc(`Unsupported field value: ${_b(a)}`)})(n,e)}function _I(n,e){const t={};return rC(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):sm(n,((a,d)=>{const m=jw(d,e.mc(a));m!=null&&(t[a]=m)})),{mapValue:{fields:t}}}function yI(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof da||n instanceof Wh||n instanceof Lc||n instanceof wo||n instanceof Fw||n instanceof Kh)}function vI(n,e,t){if(!yI(t)||!nC(t)){const a=_b(t);throw a==="an object"?e.Sc(n+" a custom object"):e.Sc(n+" "+a)}}function V3(n,e,t){if((e=Ll(e))instanceof Bw)return e._internalPath;if(typeof e=="string")return bI(n,e);throw Z0("Field path arguments must be of type string or ",n,!1,void 0,t)}const U3=new RegExp("[~\\*/\\[\\]]");function bI(n,e,t){if(e.search(U3)>=0)throw Z0(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Bw(...e.split("."))._internalPath}catch{throw Z0(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Z0(n,e,t,a,d){const m=a&&!a.isEmpty(),g=d!==void 0;let c=`Function ${e}() called with invalid data`;t&&(c+=" (via `toFirestore()`)"),c+=". ";let C="";return(m||g)&&(C+=" (found",m&&(C+=` in field ${a}`),g&&(C+=` in document ${d}`),C+=")"),new _n(Lt.INVALID_ARGUMENT,c+n+C)}function j3(n,e){return n.some((t=>t.isEqual(e)))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xI{constructor(e,t,a,d,m){this._firestore=e,this._userDataWriter=t,this._key=a,this._document=d,this._converter=m}get id(){return this._key.path.lastSegment()}get ref(){return new wo(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new $3(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(wI("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class $3 extends xI{data(){return super.data()}}function wI(n,e){return typeof e=="string"?bI(n,e):e instanceof Bw?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function q3(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new _n(Lt.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class $w{}class G3 extends $w{}function H3(n,e,...t){let a=[];e instanceof $w&&a.push(e),a=a.concat(t),(function(m){const g=m.filter((C=>C instanceof Gw)).length,c=m.filter((C=>C instanceof qw)).length;if(g>1||g>0&&c>0)throw new _n(Lt.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(a);for(const d of a)n=d._apply(n);return n}class qw extends G3{constructor(e,t,a){super(),this._field=e,this._op=t,this._value=a,this.type="where"}static _create(e,t,a){return new qw(e,t,a)}_apply(e){const t=this._parse(e);return TI(e._query,t),new Lg(e.firestore,e.converter,m1(e._query,t))}_parse(e){const t=gI(e.firestore);return(function(m,g,c,C,R,V,q){let J;if(R.isKeyField()){if(V==="array-contains"||V==="array-contains-any")throw new _n(Lt.INVALID_ARGUMENT,`Invalid Query. You can't perform '${V}' queries on documentId().`);if(V==="in"||V==="not-in"){mS(q,V);const xe=[];for(const be of q)xe.push(pS(C,m,be));J={arrayValue:{values:xe}}}else J=pS(C,m,q)}else V!=="in"&&V!=="not-in"&&V!=="array-contains-any"||mS(q,V),J=F3(c,g,q,V==="in"||V==="not-in");return zs.create(R,V,J)})(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}class Gw extends $w{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Gw(e,t)}_parse(e){const t=this._queryConstraints.map((a=>a._parse(e))).filter((a=>a.getFilters().length>0));return t.length===1?t[0]:ph.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:((function(d,m){let g=d;const c=m.getFlattenedFilters();for(const C of c)TI(g,C),g=m1(g,C)})(e._query,t),new Lg(e.firestore,e.converter,m1(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function pS(n,e,t){if(typeof(t=Ll(t))=="string"){if(t==="")throw new _n(Lt.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!bC(e)&&t.indexOf("/")!==-1)throw new _n(Lt.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const a=e.path.child(ta.fromString(t));if(!On.isDocumentKey(a))throw new _n(Lt.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${a}' is not because it has an odd number of segments (${a.length}).`);return RT(n,new On(a))}if(t instanceof wo)return RT(n,t._key);throw new _n(Lt.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${_b(t)}.`)}function mS(n,e){if(!Array.isArray(n)||n.length===0)throw new _n(Lt.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function TI(n,e){const t=(function(d,m){for(const g of d)for(const c of g.getFlattenedFilters())if(m.indexOf(c.op)>=0)return c.op;return null})(n.filters,(function(d){switch(d){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(e.op));if(t!==null)throw t===e.op?new _n(Lt.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new _n(Lt.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class Z3{convertValue(e,t="none"){switch(Wf(e)){case 0:return null;case 1:return e.booleanValue;case 2:return ds(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Zf(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw Zn(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const a={};return sm(e,((d,m)=>{a[d]=this.convertValue(m,t)})),a}convertVectorValue(e){var a,d,m;const t=(m=(d=(a=e.fields)==null?void 0:a[F0].arrayValue)==null?void 0:d.values)==null?void 0:m.map((g=>ds(g.doubleValue)));return new Kh(t)}convertGeoPoint(e){return new Wh(ds(e.latitude),ds(e.longitude))}convertArray(e,t){return(e.values||[]).map((a=>this.convertValue(a,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const a=bb(e);return a==null?null:this.convertValue(a,t);case"estimate":return this.convertTimestamp(fy(e));default:return null}}convertTimestamp(e){const t=Hf(e);return new da(t.seconds,t.nanos)}convertDocumentKey(e,t){const a=ta.fromString(e);Cr($C(a),9688,{name:e});const d=new py(a.get(1),a.get(3)),m=new On(a.popFirst(5));return d.isEqual(t)||Hd(`Document ${m} contains a document reference within a different database (${d.projectId}/${d.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),m}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function W3(n,e,t){let a;return a=n?n.toFirestore(e):e,a}class Zv{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class og extends xI{constructor(e,t,a,d,m,g){super(e,t,a,d,g),this._firestore=e,this._firestoreImpl=e,this.metadata=m}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new h0(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const a=this._document.data.field(wI("DocumentSnapshot.get",e));if(a!==null)return this._userDataWriter.convertValue(a,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new _n(Lt.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=og._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}og._jsonSchemaVersion="firestore/documentSnapshot/1.0",og._jsonSchema={type:Os("string",og._jsonSchemaVersion),bundleSource:Os("string","DocumentSnapshot"),bundleName:Os("string"),bundle:Os("string")};class h0 extends og{data(e={}){return super.data(e)}}class lg{constructor(e,t,a,d){this._firestore=e,this._userDataWriter=t,this._snapshot=d,this.metadata=new Zv(d.hasPendingWrites,d.fromCache),this.query=a}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach((a=>{e.call(t,new h0(this._firestore,this._userDataWriter,a.key,a,new Zv(this._snapshot.mutatedKeys.has(a.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new _n(Lt.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=(function(d,m){if(d._snapshot.oldDocs.isEmpty()){let g=0;return d._snapshot.docChanges.map((c=>{const C=new h0(d._firestore,d._userDataWriter,c.doc.key,c.doc,new Zv(d._snapshot.mutatedKeys.has(c.doc.key),d._snapshot.fromCache),d.query.converter);return c.doc,{type:"added",doc:C,oldIndex:-1,newIndex:g++}}))}{let g=d._snapshot.oldDocs;return d._snapshot.docChanges.filter((c=>m||c.type!==3)).map((c=>{const C=new h0(d._firestore,d._userDataWriter,c.doc.key,c.doc,new Zv(d._snapshot.mutatedKeys.has(c.doc.key),d._snapshot.fromCache),d.query.converter);let R=-1,V=-1;return c.type!==0&&(R=g.indexOf(c.doc.key),g=g.delete(c.doc.key)),c.type!==1&&(g=g.add(c.doc),V=g.indexOf(c.doc.key)),{type:K3(c.type),doc:C,oldIndex:R,newIndex:V}}))}})(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new _n(Lt.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=lg._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=pw.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],a=[],d=[];return this.docs.forEach((m=>{m._document!==null&&(t.push(m._document),a.push(this._userDataWriter.convertObjectMap(m._document.data.value.mapValue.fields,"previous")),d.push(m.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function K3(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Zn(61501,{type:n})}}lg._jsonSchemaVersion="firestore/querySnapshot/1.0",lg._jsonSchema={type:Os("string",lg._jsonSchemaVersion),bundleSource:Os("string","QuerySnapshot"),bundleName:Os("string"),bundle:Os("string")};class X3 extends Z3{constructor(e){super(),this.firestore=e}convertBytes(e){return new Lc(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new wo(this.firestore,null,t)}}function Y3(n){n=O0(n,Lg);const e=O0(n.firestore,Nw),t=pI(e),a=new X3(e);return q3(n._query),M3(t,n._query).then((d=>new lg(e,a,n,d)))}function Q3(n,e){const t=O0(n.firestore,Nw),a=k3(n),d=W3(n.converter,e);return J3(t,[B3(gI(n.firestore),"addDoc",a._key,d,n.converter!==null,{}).toMutation(a._key,Ud.exists(!1))]).then((()=>a))}function J3(n,e){return(function(a,d){const m=new Uf;return a.asyncQueue.enqueueAndForget((async()=>g3(await I3(a),d,m))),m.promise})(pI(n),e)}function gS(){return new Uw("serverTimestamp")}(function(e,t=!0){(function(d){Pg=d})(Ig),Bc(new Gu("firestore",((a,{instanceIdentifier:d,options:m})=>{const g=a.getProvider("app").getImmediate(),c=new Nw(new LD(a.getProvider("auth-internal")),new OD(g,a.getProvider("app-check-internal")),(function(R,V){if(!Object.prototype.hasOwnProperty.apply(R.options,["projectId"]))throw new _n(Lt.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new py(R.options.projectId,V)})(g,d),g);return m={useFetchStreams:t,...m},c._setSettings(m),c}),"PUBLIC").setMultipleInstances(!0)),$u(yT,vT,e),$u(yT,vT,"esm2020")})();var eO="firebase",tO="12.6.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */$u(eO,tO,"app");function SI(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const nO=SI,EI=new Yf("auth","Firebase",SI());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const W0=new Oy("@firebase/auth");function iO(n,...e){W0.logLevel<=Oi.WARN&&W0.warn(`Auth (${Ig}): ${n}`,...e)}function d0(n,...e){W0.logLevel<=Oi.ERROR&&W0.error(`Auth (${Ig}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wd(n,...e){throw Hw(n,...e)}function Xh(n,...e){return Hw(n,...e)}function AI(n,e,t){const a={...nO(),[e]:t};return new Yf("auth","Firebase",a).create(e,{appName:n.name})}function qp(n){return AI(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Hw(n,...e){if(typeof n!="string"){const t=e[0],a=[...e.slice(1)];return a[0]&&(a[0].appName=n.name),n._errorFactory.create(t,...a)}return EI.create(n,...e)}function Jn(n,e,...t){if(!n)throw Hw(e,...t)}function Bd(n){const e="INTERNAL ASSERTION FAILED: "+n;throw d0(e),new Error(e)}function Kd(n,e){n||Bd(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function A1(){var n;return typeof self<"u"&&((n=self.location)==null?void 0:n.href)||""}function rO(){return _S()==="http:"||_S()==="https:"}function _S(){var n;return typeof self<"u"&&((n=self.location)==null?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aO(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(rO()||FA()||"connection"in navigator)?navigator.onLine:!0}function sO(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $y{constructor(e,t){this.shortDelay=e,this.longDelay=t,Kd(t>e,"Short delay should be less than long delay!"),this.isMobile=sL()||uL()}get(){return aO()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zw(n,e){Kd(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CI{static initialize(e,t,a){this.fetchImpl=e,t&&(this.headersImpl=t),a&&(this.responseImpl=a)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Bd("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Bd("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Bd("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oO={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lO=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],uO=new $y(3e4,6e4);function Ww(n,e){return n.tenantId&&!e.tenantId?{...e,tenantId:n.tenantId}:e}async function Dg(n,e,t,a,d={}){return II(n,d,async()=>{let m={},g={};a&&(e==="GET"?g=a:m={body:JSON.stringify(a)});const c=zy({key:n.config.apiKey,...g}).slice(1),C=await n._getAdditionalHeaders();C["Content-Type"]="application/json",n.languageCode&&(C["X-Firebase-Locale"]=n.languageCode);const R={method:e,headers:C,...m};return lL()||(R.referrerPolicy="no-referrer"),n.emulatorConfig&&Cg(n.emulatorConfig.host)&&(R.credentials="include"),CI.fetch()(await PI(n,n.config.apiHost,t,c),R)})}async function II(n,e,t){n._canInitEmulator=!1;const a={...oO,...e};try{const d=new hO(n),m=await Promise.race([t(),d.promise]);d.clearNetworkTimeout();const g=await m.json();if("needConfirmation"in g)throw Wv(n,"account-exists-with-different-credential",g);if(m.ok&&!("errorMessage"in g))return g;{const c=m.ok?g.errorMessage:g.error.message,[C,R]=c.split(" : ");if(C==="FEDERATED_USER_ID_ALREADY_LINKED")throw Wv(n,"credential-already-in-use",g);if(C==="EMAIL_EXISTS")throw Wv(n,"email-already-in-use",g);if(C==="USER_DISABLED")throw Wv(n,"user-disabled",g);const V=a[C]||C.toLowerCase().replace(/[_\s]+/g,"-");if(R)throw AI(n,V,R);Wd(n,V)}}catch(d){if(d instanceof mh)throw d;Wd(n,"network-request-failed",{message:String(d)})}}async function cO(n,e,t,a,d={}){const m=await Dg(n,e,t,a,d);return"mfaPendingCredential"in m&&Wd(n,"multi-factor-auth-required",{_serverResponse:m}),m}async function PI(n,e,t,a){const d=`${e}${t}?${a}`,m=n,g=m.config.emulator?Zw(n.config,d):`${n.config.apiScheme}://${d}`;return lO.includes(t)&&(await m._persistenceManagerAvailable,m._getPersistenceType()==="COOKIE")?m._getPersistence()._getFinalTarget(g).toString():g}class hO{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,a)=>{this.timer=setTimeout(()=>a(Xh(this.auth,"network-request-failed")),uO.get())})}}function Wv(n,e,t){const a={appName:n.name};t.email&&(a.email=t.email),t.phoneNumber&&(a.phoneNumber=t.phoneNumber);const d=Xh(n,e,a);return d.customData._tokenResponse=t,d}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function dO(n,e){return Dg(n,"POST","/v1/accounts:delete",e)}async function K0(n,e){return Dg(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iy(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function fO(n,e=!1){const t=Ll(n),a=await t.getIdToken(e),d=Kw(a);Jn(d&&d.exp&&d.auth_time&&d.iat,t.auth,"internal-error");const m=typeof d.firebase=="object"?d.firebase:void 0,g=m==null?void 0:m.sign_in_provider;return{claims:d,token:a,authTime:iy(Rx(d.auth_time)),issuedAtTime:iy(Rx(d.iat)),expirationTime:iy(Rx(d.exp)),signInProvider:g||null,signInSecondFactor:(m==null?void 0:m.sign_in_second_factor)||null}}function Rx(n){return Number(n)*1e3}function Kw(n){const[e,t,a]=n.split(".");if(e===void 0||t===void 0||a===void 0)return d0("JWT malformed, contained fewer than 3 sections"),null;try{const d=kA(t);return d?JSON.parse(d):(d0("Failed to decode base64 JWT payload"),null)}catch(d){return d0("Caught error parsing JWT payload as JSON",d==null?void 0:d.toString()),null}}function yS(n){const e=Kw(n);return Jn(e,"internal-error"),Jn(typeof e.exp<"u","internal-error"),Jn(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function vy(n,e,t=!1){if(t)return e;try{return await e}catch(a){throw a instanceof mh&&pO(a)&&n.auth.currentUser===n&&await n.auth.signOut(),a}}function pO({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mO{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const t=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),t}else{this.errorBackoff=3e4;const a=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,a)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class C1{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=iy(this.lastLoginAt),this.creationTime=iy(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function X0(n){var q;const e=n.auth,t=await n.getIdToken(),a=await vy(n,K0(e,{idToken:t}));Jn(a==null?void 0:a.users.length,e,"internal-error");const d=a.users[0];n._notifyReloadListener(d);const m=(q=d.providerUserInfo)!=null&&q.length?MI(d.providerUserInfo):[],g=_O(n.providerData,m),c=n.isAnonymous,C=!(n.email&&d.passwordHash)&&!(g!=null&&g.length),R=c?C:!1,V={uid:d.localId,displayName:d.displayName||null,photoURL:d.photoUrl||null,email:d.email||null,emailVerified:d.emailVerified||!1,phoneNumber:d.phoneNumber||null,tenantId:d.tenantId||null,providerData:g,metadata:new C1(d.createdAt,d.lastLoginAt),isAnonymous:R};Object.assign(n,V)}async function gO(n){const e=Ll(n);await X0(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function _O(n,e){return[...n.filter(a=>!e.some(d=>d.providerId===a.providerId)),...e]}function MI(n){return n.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function yO(n,e){const t=await II(n,{},async()=>{const a=zy({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:d,apiKey:m}=n.config,g=await PI(n,d,"/v1/token",`key=${m}`),c=await n._getAdditionalHeaders();c["Content-Type"]="application/x-www-form-urlencoded";const C={method:"POST",headers:c,body:a};return n.emulatorConfig&&Cg(n.emulatorConfig.host)&&(C.credentials="include"),CI.fetch()(g,C)});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function vO(n,e){return Dg(n,"POST","/v2/accounts:revokeToken",Ww(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ug{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Jn(e.idToken,"internal-error"),Jn(typeof e.idToken<"u","internal-error"),Jn(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):yS(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){Jn(e.length!==0,"internal-error");const t=yS(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(Jn(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:a,refreshToken:d,expiresIn:m}=await yO(e,t);this.updateTokensAndExpiration(a,d,Number(m))}updateTokensAndExpiration(e,t,a){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+a*1e3}static fromJSON(e,t){const{refreshToken:a,accessToken:d,expirationTime:m}=t,g=new ug;return a&&(Jn(typeof a=="string","internal-error",{appName:e}),g.refreshToken=a),d&&(Jn(typeof d=="string","internal-error",{appName:e}),g.accessToken=d),m&&(Jn(typeof m=="number","internal-error",{appName:e}),g.expirationTime=m),g}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new ug,this.toJSON())}_performRefresh(){return Bd("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function If(n,e){Jn(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class uh{constructor({uid:e,auth:t,stsTokenManager:a,...d}){this.providerId="firebase",this.proactiveRefresh=new mO(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=a,this.accessToken=a.accessToken,this.displayName=d.displayName||null,this.email=d.email||null,this.emailVerified=d.emailVerified||!1,this.phoneNumber=d.phoneNumber||null,this.photoURL=d.photoURL||null,this.isAnonymous=d.isAnonymous||!1,this.tenantId=d.tenantId||null,this.providerData=d.providerData?[...d.providerData]:[],this.metadata=new C1(d.createdAt||void 0,d.lastLoginAt||void 0)}async getIdToken(e){const t=await vy(this,this.stsTokenManager.getToken(this.auth,e));return Jn(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return fO(this,e)}reload(){return gO(this)}_assign(e){this!==e&&(Jn(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>({...t})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new uh({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){Jn(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let a=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),a=!0),t&&await X0(this),await this.auth._persistUserIfCurrent(this),a&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(qh(this.auth.app))return Promise.reject(qp(this.auth));const e=await this.getIdToken();return await vy(this,dO(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){const a=t.displayName??void 0,d=t.email??void 0,m=t.phoneNumber??void 0,g=t.photoURL??void 0,c=t.tenantId??void 0,C=t._redirectEventId??void 0,R=t.createdAt??void 0,V=t.lastLoginAt??void 0,{uid:q,emailVerified:J,isAnonymous:Y,providerData:xe,stsTokenManager:be}=t;Jn(q&&be,e,"internal-error");const Oe=ug.fromJSON(this.name,be);Jn(typeof q=="string",e,"internal-error"),If(a,e.name),If(d,e.name),Jn(typeof J=="boolean",e,"internal-error"),Jn(typeof Y=="boolean",e,"internal-error"),If(m,e.name),If(g,e.name),If(c,e.name),If(C,e.name),If(R,e.name),If(V,e.name);const et=new uh({uid:q,auth:e,email:d,emailVerified:J,displayName:a,isAnonymous:Y,photoURL:g,phoneNumber:m,tenantId:c,stsTokenManager:Oe,createdAt:R,lastLoginAt:V});return xe&&Array.isArray(xe)&&(et.providerData=xe.map(Je=>({...Je}))),C&&(et._redirectEventId=C),et}static async _fromIdTokenResponse(e,t,a=!1){const d=new ug;d.updateFromServerResponse(t);const m=new uh({uid:t.localId,auth:e,stsTokenManager:d,isAnonymous:a});return await X0(m),m}static async _fromGetAccountInfoResponse(e,t,a){const d=t.users[0];Jn(d.localId!==void 0,"internal-error");const m=d.providerUserInfo!==void 0?MI(d.providerUserInfo):[],g=!(d.email&&d.passwordHash)&&!(m!=null&&m.length),c=new ug;c.updateFromIdToken(a);const C=new uh({uid:d.localId,auth:e,stsTokenManager:c,isAnonymous:g}),R={uid:d.localId,displayName:d.displayName||null,photoURL:d.photoUrl||null,email:d.email||null,emailVerified:d.emailVerified||!1,phoneNumber:d.phoneNumber||null,tenantId:d.tenantId||null,providerData:m,metadata:new C1(d.createdAt,d.lastLoginAt),isAnonymous:!(d.email&&d.passwordHash)&&!(m!=null&&m.length)};return Object.assign(C,R),C}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vS=new Map;function Fd(n){Kd(n instanceof Function,"Expected a class definition");let e=vS.get(n);return e?(Kd(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,vS.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RI{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}RI.type="NONE";const bS=RI;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function f0(n,e,t){return`firebase:${n}:${e}:${t}`}class cg{constructor(e,t,a){this.persistence=e,this.auth=t,this.userKey=a;const{config:d,name:m}=this.auth;this.fullUserKey=f0(this.userKey,d.apiKey,m),this.fullPersistenceKey=f0("persistence",d.apiKey,m),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const t=await K0(this.auth,{idToken:e}).catch(()=>{});return t?uh._fromGetAccountInfoResponse(this.auth,t,e):null}return uh._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,a="authUser"){if(!t.length)return new cg(Fd(bS),e,a);const d=(await Promise.all(t.map(async R=>{if(await R._isAvailable())return R}))).filter(R=>R);let m=d[0]||Fd(bS);const g=f0(a,e.config.apiKey,e.name);let c=null;for(const R of t)try{const V=await R._get(g);if(V){let q;if(typeof V=="string"){const J=await K0(e,{idToken:V}).catch(()=>{});if(!J)break;q=await uh._fromGetAccountInfoResponse(e,J,V)}else q=uh._fromJSON(e,V);R!==m&&(c=q),m=R;break}}catch{}const C=d.filter(R=>R._shouldAllowMigration);return!m._shouldAllowMigration||!C.length?new cg(m,e,a):(m=C[0],c&&await m._set(g,c.toJSON()),await Promise.all(t.map(async R=>{if(R!==m)try{await R._remove(g)}catch{}})),new cg(m,e,a))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xS(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(zI(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(kI(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(NI(e))return"Blackberry";if(BI(e))return"Webos";if(LI(e))return"Safari";if((e.includes("chrome/")||DI(e))&&!e.includes("edge/"))return"Chrome";if(OI(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,a=n.match(t);if((a==null?void 0:a.length)===2)return a[1]}return"Other"}function kI(n=kl()){return/firefox\//i.test(n)}function LI(n=kl()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function DI(n=kl()){return/crios\//i.test(n)}function zI(n=kl()){return/iemobile/i.test(n)}function OI(n=kl()){return/android/i.test(n)}function NI(n=kl()){return/blackberry/i.test(n)}function BI(n=kl()){return/webos/i.test(n)}function Xw(n=kl()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function bO(n=kl()){var e;return Xw(n)&&!!((e=window.navigator)!=null&&e.standalone)}function xO(){return cL()&&document.documentMode===10}function FI(n=kl()){return Xw(n)||OI(n)||BI(n)||NI(n)||/windows phone/i.test(n)||zI(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function VI(n,e=[]){let t;switch(n){case"Browser":t=xS(kl());break;case"Worker":t=`${xS(kl())}-${n}`;break;default:t=n}const a=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${Ig}/${a}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wO{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const a=m=>new Promise((g,c)=>{try{const C=e(m);g(C)}catch(C){c(C)}});a.onAbort=t,this.queue.push(a);const d=this.queue.length-1;return()=>{this.queue[d]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const a of this.queue)await a(e),a.onAbort&&t.push(a.onAbort)}catch(a){t.reverse();for(const d of t)try{d()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:a==null?void 0:a.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function TO(n,e={}){return Dg(n,"GET","/v2/passwordPolicy",Ww(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SO=6;class EO{constructor(e){var a;const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??SO,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),t.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),t.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),t.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),t.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=((a=e.allowedNonAlphanumericCharacters)==null?void 0:a.join(""))??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){const a=this.customStrengthOptions.minPasswordLength,d=this.customStrengthOptions.maxPasswordLength;a&&(t.meetsMinPasswordLength=e.length>=a),d&&(t.meetsMaxPasswordLength=e.length<=d)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let a;for(let d=0;d<e.length;d++)a=e.charAt(d),this.updatePasswordCharacterOptionsStatuses(t,a>="a"&&a<="z",a>="A"&&a<="Z",a>="0"&&a<="9",this.allowedNonAlphanumericCharacters.includes(a))}updatePasswordCharacterOptionsStatuses(e,t,a,d,m){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=a)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=d)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=m))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AO{constructor(e,t,a,d){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=a,this.config=d,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new wS(this),this.idTokenSubscription=new wS(this),this.beforeStateQueue=new wO(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=EI,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=d.sdkClientVersion,this._persistenceManagerAvailable=new Promise(m=>this._resolvePersistenceManagerAvailable=m)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Fd(t)),this._initializationPromise=this.queue(async()=>{var a,d,m;if(!this._deleted&&(this.persistenceManager=await cg.create(this,e),(a=this._resolvePersistenceManagerAvailable)==null||a.call(this),!this._deleted)){if((d=this._popupRedirectResolver)!=null&&d._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((m=this.currentUser)==null?void 0:m.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await K0(this,{idToken:e}),a=await uh._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(a)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var m;if(qh(this.app)){const g=this.app.settings.authIdToken;return g?new Promise(c=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(g).then(c,c))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let a=t,d=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const g=(m=this.redirectUser)==null?void 0:m._redirectEventId,c=a==null?void 0:a._redirectEventId,C=await this.tryRedirectSignIn(e);(!g||g===c)&&(C!=null&&C.user)&&(a=C.user,d=!0)}if(!a)return this.directlySetCurrentUser(null);if(!a._redirectEventId){if(d)try{await this.beforeStateQueue.runMiddleware(a)}catch(g){a=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(g))}return a?this.reloadAndSetCurrentUserOrClear(a):this.directlySetCurrentUser(null)}return Jn(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===a._redirectEventId?this.directlySetCurrentUser(a):this.reloadAndSetCurrentUserOrClear(a)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await X0(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=sO()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(qh(this.app))return Promise.reject(qp(this));const t=e?Ll(e):null;return t&&Jn(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&Jn(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return qh(this.app)?Promise.reject(qp(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return qh(this.app)?Promise.reject(qp(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Fd(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await TO(this),t=new EO(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Yf("auth","Firebase",e())}onAuthStateChanged(e,t,a){return this.registerStateListener(this.authStateSubscription,e,t,a)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,a){return this.registerStateListener(this.idTokenSubscription,e,t,a)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const a=this.onAuthStateChanged(()=>{a(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),a={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(a.tenantId=this.tenantId),await vO(this,a)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)==null?void 0:e.toJSON()}}async _setRedirectUser(e,t){const a=await this.getOrInitRedirectPersistenceManager(t);return e===null?a.removeCurrentUser():a.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Fd(e)||this._popupRedirectResolver;Jn(t,this,"argument-error"),this.redirectPersistenceManager=await cg.create(this,[Fd(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,a;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)==null?void 0:t._redirectEventId)===e?this._currentUser:((a=this.redirectUser)==null?void 0:a._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=((t=this.currentUser)==null?void 0:t.uid)??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,a,d){if(this._deleted)return()=>{};const m=typeof t=="function"?t:t.next.bind(t);let g=!1;const c=this._isInitialized?Promise.resolve():this._initializationPromise;if(Jn(c,this,"internal-error"),c.then(()=>{g||m(this.currentUser)}),typeof t=="function"){const C=e.addObserver(t,a,d);return()=>{g=!0,C()}}else{const C=e.addObserver(t);return()=>{g=!0,C()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Jn(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=VI(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var d;const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const t=await((d=this.heartbeatServiceProvider.getImmediate({optional:!0}))==null?void 0:d.getHeartbeatsHeader());t&&(e["X-Firebase-Client"]=t);const a=await this._getAppCheckToken();return a&&(e["X-Firebase-AppCheck"]=a),e}async _getAppCheckToken(){var t;if(qh(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await((t=this.appCheckServiceProvider.getImmediate({optional:!0}))==null?void 0:t.getToken());return e!=null&&e.error&&iO(`Error while retrieving App Check token: ${e.error}`),e==null?void 0:e.token}}function Yw(n){return Ll(n)}class wS{constructor(e){this.auth=e,this.observer=null,this.addObserver=_L(t=>this.observer=t)}get next(){return Jn(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Qw={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function CO(n){Qw=n}function IO(n){return Qw.loadJS(n)}function PO(){return Qw.gapiScript}function MO(n){return`__${n}${Math.floor(Math.random()*1e6)}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function RO(n,e){const t=Qd(n,"auth");if(t.isInitialized()){const d=t.getImmediate(),m=t.getOptions();if(qf(m,e??{}))return d;Wd(d,"already-initialized")}return t.initialize({options:e})}function kO(n,e){const t=(e==null?void 0:e.persistence)||[],a=(Array.isArray(t)?t:[t]).map(Fd);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(a,e==null?void 0:e.popupRedirectResolver)}function LO(n,e,t){const a=Yw(n);Jn(/^https?:\/\//.test(e),a,"invalid-emulator-scheme");const d=!1,m=UI(e),{host:g,port:c}=DO(e),C=c===null?"":`:${c}`,R={url:`${m}//${g}${C}/`},V=Object.freeze({host:g,port:c,protocol:m.replace(":",""),options:Object.freeze({disableWarnings:d})});if(!a._canInitEmulator){Jn(a.config.emulator&&a.emulatorConfig,a,"emulator-config-failed"),Jn(qf(R,a.config.emulator)&&qf(V,a.emulatorConfig),a,"emulator-config-failed");return}a.config.emulator=R,a.emulatorConfig=V,a.settings.appVerificationDisabledForTesting=!0,Cg(g)?(NA(`${m}//${g}${C}`),BA("Auth",!0)):zO()}function UI(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function DO(n){const e=UI(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const a=t[2].split("@").pop()||"",d=/^(\[[^\]]+\])(:|$)/.exec(a);if(d){const m=d[1];return{host:m,port:TS(a.substr(m.length+1))}}else{const[m,g]=a.split(":");return{host:m,port:TS(g)}}}function TS(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function zO(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jI{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Bd("not implemented")}_getIdTokenResponse(e){return Bd("not implemented")}_linkToIdToken(e,t){return Bd("not implemented")}_getReauthenticationResolver(e){return Bd("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function hg(n,e){return cO(n,"POST","/v1/accounts:signInWithIdp",Ww(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OO="http://localhost";class em extends jI{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new em(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Wd("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:a,signInMethod:d,...m}=t;if(!a||!d)return null;const g=new em(a,d);return g.idToken=m.idToken||void 0,g.accessToken=m.accessToken||void 0,g.secret=m.secret,g.nonce=m.nonce,g.pendingToken=m.pendingToken||null,g}_getIdTokenResponse(e){const t=this.buildRequest();return hg(e,t)}_linkToIdToken(e,t){const a=this.buildRequest();return a.idToken=t,hg(e,a)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,hg(e,t)}buildRequest(){const e={requestUri:OO,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=zy(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $I{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qy extends $I{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mf extends qy{constructor(){super("facebook.com")}static credential(e){return em._fromParams({providerId:Mf.PROVIDER_ID,signInMethod:Mf.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Mf.credentialFromTaggedObject(e)}static credentialFromError(e){return Mf.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Mf.credential(e.oauthAccessToken)}catch{return null}}}Mf.FACEBOOK_SIGN_IN_METHOD="facebook.com";Mf.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rf extends qy{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return em._fromParams({providerId:Rf.PROVIDER_ID,signInMethod:Rf.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Rf.credentialFromTaggedObject(e)}static credentialFromError(e){return Rf.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:a}=e;if(!t&&!a)return null;try{return Rf.credential(t,a)}catch{return null}}}Rf.GOOGLE_SIGN_IN_METHOD="google.com";Rf.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kf extends qy{constructor(){super("github.com")}static credential(e){return em._fromParams({providerId:kf.PROVIDER_ID,signInMethod:kf.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return kf.credentialFromTaggedObject(e)}static credentialFromError(e){return kf.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return kf.credential(e.oauthAccessToken)}catch{return null}}}kf.GITHUB_SIGN_IN_METHOD="github.com";kf.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lf extends qy{constructor(){super("twitter.com")}static credential(e,t){return em._fromParams({providerId:Lf.PROVIDER_ID,signInMethod:Lf.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Lf.credentialFromTaggedObject(e)}static credentialFromError(e){return Lf.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:a}=e;if(!t||!a)return null;try{return Lf.credential(t,a)}catch{return null}}}Lf.TWITTER_SIGN_IN_METHOD="twitter.com";Lf.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wg{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,a,d=!1){const m=await uh._fromIdTokenResponse(e,a,d),g=SS(a);return new wg({user:m,providerId:g,_tokenResponse:a,operationType:t})}static async _forOperation(e,t,a){await e._updateTokensIfNecessary(a,!0);const d=SS(a);return new wg({user:e,providerId:d,_tokenResponse:a,operationType:t})}}function SS(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Y0 extends mh{constructor(e,t,a,d){super(t.code,t.message),this.operationType=a,this.user=d,Object.setPrototypeOf(this,Y0.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:a}}static _fromErrorAndOperation(e,t,a,d){return new Y0(e,t,a,d)}}function qI(n,e,t,a){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(m=>{throw m.code==="auth/multi-factor-auth-required"?Y0._fromErrorAndOperation(n,m,e,a):m})}async function NO(n,e,t=!1){const a=await vy(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return wg._forOperation(n,"link",a)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function BO(n,e,t=!1){const{auth:a}=n;if(qh(a.app))return Promise.reject(qp(a));const d="reauthenticate";try{const m=await vy(n,qI(a,d,e,n),t);Jn(m.idToken,a,"internal-error");const g=Kw(m.idToken);Jn(g,a,"internal-error");const{sub:c}=g;return Jn(n.uid===c,a,"user-mismatch"),wg._forOperation(n,d,m)}catch(m){throw(m==null?void 0:m.code)==="auth/user-not-found"&&Wd(a,"user-mismatch"),m}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function FO(n,e,t=!1){if(qh(n.app))return Promise.reject(qp(n));const a="signIn",d=await qI(n,a,e),m=await wg._fromIdTokenResponse(n,a,d);return t||await n._updateCurrentUser(m.user),m}function VO(n,e,t,a){return Ll(n).onIdTokenChanged(e,t,a)}function UO(n,e,t){return Ll(n).beforeAuthStateChanged(e,t)}const Q0="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GI{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Q0,"1"),this.storage.removeItem(Q0),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jO=1e3,$O=10;class HI extends GI{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=FI(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const a=this.storage.getItem(t),d=this.localCache[t];a!==d&&e(t,d,a)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((g,c,C)=>{this.notifyListeners(g,C)});return}const a=e.key;t?this.detachListener():this.stopPolling();const d=()=>{const g=this.storage.getItem(a);!t&&this.localCache[a]===g||this.notifyListeners(a,g)},m=this.storage.getItem(a);xO()&&m!==e.newValue&&e.newValue!==e.oldValue?setTimeout(d,$O):d()}notifyListeners(e,t){this.localCache[e]=t;const a=this.listeners[e];if(a)for(const d of Array.from(a))d(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,a)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:a}),!0)})},jO)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}HI.type="LOCAL";const qO=HI;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZI extends GI{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}ZI.type="SESSION";const WI=ZI;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function GO(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mb{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(d=>d.isListeningto(e));if(t)return t;const a=new Mb(e);return this.receivers.push(a),a}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:a,eventType:d,data:m}=t.data,g=this.handlersMap[d];if(!(g!=null&&g.size))return;t.ports[0].postMessage({status:"ack",eventId:a,eventType:d});const c=Array.from(g).map(async R=>R(t.origin,m)),C=await GO(c);t.ports[0].postMessage({status:"done",eventId:a,eventType:d,response:C})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Mb.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jw(n="",e=10){let t="";for(let a=0;a<e;a++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HO{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,a=50){const d=typeof MessageChannel<"u"?new MessageChannel:null;if(!d)throw new Error("connection_unavailable");let m,g;return new Promise((c,C)=>{const R=Jw("",20);d.port1.start();const V=setTimeout(()=>{C(new Error("unsupported_event"))},a);g={messageChannel:d,onMessage(q){const J=q;if(J.data.eventId===R)switch(J.data.status){case"ack":clearTimeout(V),m=setTimeout(()=>{C(new Error("timeout"))},3e3);break;case"done":clearTimeout(m),c(J.data.response);break;default:clearTimeout(V),clearTimeout(m),C(new Error("invalid_response"));break}}},this.handlers.add(g),d.port1.addEventListener("message",g.onMessage),this.target.postMessage({eventType:e,eventId:R,data:t},[d.port2])}).finally(()=>{g&&this.removeMessageHandler(g)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yh(){return window}function ZO(n){Yh().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function KI(){return typeof Yh().WorkerGlobalScope<"u"&&typeof Yh().importScripts=="function"}async function WO(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function KO(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)==null?void 0:n.controller)||null}function XO(){return KI()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XI="firebaseLocalStorageDb",YO=1,J0="firebaseLocalStorage",YI="fbase_key";class Gy{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Rb(n,e){return n.transaction([J0],e?"readwrite":"readonly").objectStore(J0)}function QO(){const n=indexedDB.deleteDatabase(XI);return new Gy(n).toPromise()}function I1(){const n=indexedDB.open(XI,YO);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const a=n.result;try{a.createObjectStore(J0,{keyPath:YI})}catch(d){t(d)}}),n.addEventListener("success",async()=>{const a=n.result;a.objectStoreNames.contains(J0)?e(a):(a.close(),await QO(),e(await I1()))})})}async function ES(n,e,t){const a=Rb(n,!0).put({[YI]:e,value:t});return new Gy(a).toPromise()}async function JO(n,e){const t=Rb(n,!1).get(e),a=await new Gy(t).toPromise();return a===void 0?null:a.value}function AS(n,e){const t=Rb(n,!0).delete(e);return new Gy(t).toPromise()}const e4=800,t4=3;class QI{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await I1(),this.db)}async _withRetries(e){let t=0;for(;;)try{const a=await this._openDb();return await e(a)}catch(a){if(t++>t4)throw a;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return KI()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Mb._getInstance(XO()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var t,a;if(this.activeServiceWorker=await WO(),!this.activeServiceWorker)return;this.sender=new HO(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&(t=e[0])!=null&&t.fulfilled&&(a=e[0])!=null&&a.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||KO()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await I1();return await ES(e,Q0,"1"),await AS(e,Q0),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(a=>ES(a,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(a=>JO(a,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>AS(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(d=>{const m=Rb(d,!1).getAll();return new Gy(m).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],a=new Set;if(e.length!==0)for(const{fbase_key:d,value:m}of e)a.add(d),JSON.stringify(this.localCache[d])!==JSON.stringify(m)&&(this.notifyListeners(d,m),t.push(d));for(const d of Object.keys(this.localCache))this.localCache[d]&&!a.has(d)&&(this.notifyListeners(d,null),t.push(d));return t}notifyListeners(e,t){this.localCache[e]=t;const a=this.listeners[e];if(a)for(const d of Array.from(a))d(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),e4)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}QI.type="LOCAL";const n4=QI;new $y(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function i4(n,e){return e?Fd(e):(Jn(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class e2 extends jI{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return hg(e,this._buildIdpRequest())}_linkToIdToken(e,t){return hg(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return hg(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function r4(n){return FO(n.auth,new e2(n),n.bypassAuthState)}function a4(n){const{auth:e,user:t}=n;return Jn(t,e,"internal-error"),BO(t,new e2(n),n.bypassAuthState)}async function s4(n){const{auth:e,user:t}=n;return Jn(t,e,"internal-error"),NO(t,new e2(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JI{constructor(e,t,a,d,m=!1){this.auth=e,this.resolver=a,this.user=d,this.bypassAuthState=m,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(a){this.reject(a)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:a,postBody:d,tenantId:m,error:g,type:c}=e;if(g){this.reject(g);return}const C={auth:this.auth,requestUri:t,sessionId:a,tenantId:m||void 0,postBody:d||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(c)(C))}catch(R){this.reject(R)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return r4;case"linkViaPopup":case"linkViaRedirect":return s4;case"reauthViaPopup":case"reauthViaRedirect":return a4;default:Wd(this.auth,"internal-error")}}resolve(e){Kd(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Kd(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const o4=new $y(2e3,1e4);class rg extends JI{constructor(e,t,a,d,m){super(e,t,d,m),this.provider=a,this.authWindow=null,this.pollId=null,rg.currentPopupAction&&rg.currentPopupAction.cancel(),rg.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Jn(e,this.auth,"internal-error"),e}async onExecution(){Kd(this.filter.length===1,"Popup operations only handle one event");const e=Jw();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(Xh(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)==null?void 0:e.associatedEvent)||null}cancel(){this.reject(Xh(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,rg.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,a;if((a=(t=this.authWindow)==null?void 0:t.window)!=null&&a.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Xh(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,o4.get())};e()}}rg.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const l4="pendingRedirect",p0=new Map;class u4 extends JI{constructor(e,t,a=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,a),this.eventId=null}async execute(){let e=p0.get(this.auth._key());if(!e){try{const a=await c4(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(a)}catch(t){e=()=>Promise.reject(t)}p0.set(this.auth._key(),e)}return this.bypassAuthState||p0.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function c4(n,e){const t=f4(e),a=d4(n);if(!await a._isAvailable())return!1;const d=await a._get(t)==="true";return await a._remove(t),d}function h4(n,e){p0.set(n._key(),e)}function d4(n){return Fd(n._redirectPersistence)}function f4(n){return f0(l4,n.config.apiKey,n.name)}async function p4(n,e,t=!1){if(qh(n.app))return Promise.reject(qp(n));const a=Yw(n),d=i4(a,e),g=await new u4(a,d,t).execute();return g&&!t&&(delete g.user._redirectEventId,await a._persistUserIfCurrent(g.user),await a._setRedirectUser(null,e)),g}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const m4=600*1e3;class g4{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(a=>{this.isEventForConsumer(e,a)&&(t=!0,this.sendToConsumer(e,a),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!_4(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var a;if(e.error&&!eP(e)){const d=((a=e.error.code)==null?void 0:a.split("auth/")[1])||"internal-error";t.onError(Xh(this.auth,d))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const a=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&a}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=m4&&this.cachedEventUids.clear(),this.cachedEventUids.has(CS(e))}saveEventToCache(e){this.cachedEventUids.add(CS(e)),this.lastProcessedEventTime=Date.now()}}function CS(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function eP({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function _4(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return eP(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function y4(n,e={}){return Dg(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const v4=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,b4=/^https?/;async function x4(n){if(n.config.emulator)return;const{authorizedDomains:e}=await y4(n);for(const t of e)try{if(w4(t))return}catch{}Wd(n,"unauthorized-domain")}function w4(n){const e=A1(),{protocol:t,hostname:a}=new URL(e);if(n.startsWith("chrome-extension://")){const g=new URL(n);return g.hostname===""&&a===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&g.hostname===a}if(!b4.test(t))return!1;if(v4.test(n))return a===n;const d=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+d+"|"+d+")$","i").test(a)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const T4=new $y(3e4,6e4);function IS(){const n=Yh().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function S4(n){return new Promise((e,t)=>{var d,m,g;function a(){IS(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{IS(),t(Xh(n,"network-request-failed"))},timeout:T4.get()})}if((m=(d=Yh().gapi)==null?void 0:d.iframes)!=null&&m.Iframe)e(gapi.iframes.getContext());else if((g=Yh().gapi)!=null&&g.load)a();else{const c=MO("iframefcb");return Yh()[c]=()=>{gapi.load?a():t(Xh(n,"network-request-failed"))},IO(`${PO()}?onload=${c}`).catch(C=>t(C))}}).catch(e=>{throw m0=null,e})}let m0=null;function E4(n){return m0=m0||S4(n),m0}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const A4=new $y(5e3,15e3),C4="__/auth/iframe",I4="emulator/auth/iframe",P4={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},M4=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function R4(n){const e=n.config;Jn(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?Zw(e,I4):`https://${n.config.authDomain}/${C4}`,a={apiKey:e.apiKey,appName:n.name,v:Ig},d=M4.get(n.config.apiHost);d&&(a.eid=d);const m=n._getFrameworks();return m.length&&(a.fw=m.join(",")),`${t}?${zy(a).slice(1)}`}async function k4(n){const e=await E4(n),t=Yh().gapi;return Jn(t,n,"internal-error"),e.open({where:document.body,url:R4(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:P4,dontclear:!0},a=>new Promise(async(d,m)=>{await a.restyle({setHideOnLeave:!1});const g=Xh(n,"network-request-failed"),c=Yh().setTimeout(()=>{m(g)},A4.get());function C(){Yh().clearTimeout(c),d(a)}a.ping(C).then(C,()=>{m(g)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const L4={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},D4=500,z4=600,O4="_blank",N4="http://localhost";class PS{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function B4(n,e,t,a=D4,d=z4){const m=Math.max((window.screen.availHeight-d)/2,0).toString(),g=Math.max((window.screen.availWidth-a)/2,0).toString();let c="";const C={...L4,width:a.toString(),height:d.toString(),top:m,left:g},R=kl().toLowerCase();t&&(c=DI(R)?O4:t),kI(R)&&(e=e||N4,C.scrollbars="yes");const V=Object.entries(C).reduce((J,[Y,xe])=>`${J}${Y}=${xe},`,"");if(bO(R)&&c!=="_self")return F4(e||"",c),new PS(null);const q=window.open(e||"",c,V);Jn(q,n,"popup-blocked");try{q.focus()}catch{}return new PS(q)}function F4(n,e){const t=document.createElement("a");t.href=n,t.target=e;const a=document.createEvent("MouseEvent");a.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(a)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const V4="__/auth/handler",U4="emulator/auth/handler",j4=encodeURIComponent("fac");async function MS(n,e,t,a,d,m){Jn(n.config.authDomain,n,"auth-domain-config-required"),Jn(n.config.apiKey,n,"invalid-api-key");const g={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:a,v:Ig,eventId:d};if(e instanceof $I){e.setDefaultLanguage(n.languageCode),g.providerId=e.providerId||"",gL(e.getCustomParameters())||(g.customParameters=JSON.stringify(e.getCustomParameters()));for(const[V,q]of Object.entries({}))g[V]=q}if(e instanceof qy){const V=e.getScopes().filter(q=>q!=="");V.length>0&&(g.scopes=V.join(","))}n.tenantId&&(g.tid=n.tenantId);const c=g;for(const V of Object.keys(c))c[V]===void 0&&delete c[V];const C=await n._getAppCheckToken(),R=C?`#${j4}=${encodeURIComponent(C)}`:"";return`${$4(n)}?${zy(c).slice(1)}${R}`}function $4({config:n}){return n.emulator?Zw(n,U4):`https://${n.authDomain}/${V4}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kx="webStorageSupport";class q4{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=WI,this._completeRedirectFn=p4,this._overrideRedirectResult=h4}async _openPopup(e,t,a,d){var g;Kd((g=this.eventManagers[e._key()])==null?void 0:g.manager,"_initialize() not called before _openPopup()");const m=await MS(e,t,a,A1(),d);return B4(e,m,Jw())}async _openRedirect(e,t,a,d){await this._originValidation(e);const m=await MS(e,t,a,A1(),d);return ZO(m),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:d,promise:m}=this.eventManagers[t];return d?Promise.resolve(d):(Kd(m,"If manager is not set, promise should be"),m)}const a=this.initAndGetManager(e);return this.eventManagers[t]={promise:a},a.catch(()=>{delete this.eventManagers[t]}),a}async initAndGetManager(e){const t=await k4(e),a=new g4(e);return t.register("authEvent",d=>(Jn(d==null?void 0:d.authEvent,e,"invalid-auth-event"),{status:a.onEvent(d.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:a},this.iframes[e._key()]=t,a}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(kx,{type:kx},d=>{var g;const m=(g=d==null?void 0:d[0])==null?void 0:g[kx];m!==void 0&&t(!!m),Wd(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=x4(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return FI()||LI()||Xw()}}const G4=q4;var RS="@firebase/auth",kS="1.11.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class H4{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)==null?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(a=>{e((a==null?void 0:a.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){Jn(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Z4(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function W4(n){Bc(new Gu("auth",(e,{options:t})=>{const a=e.getProvider("app").getImmediate(),d=e.getProvider("heartbeat"),m=e.getProvider("app-check-internal"),{apiKey:g,authDomain:c}=a.options;Jn(g&&!g.includes(":"),"invalid-api-key",{appName:a.name});const C={apiKey:g,authDomain:c,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:VI(n)},R=new AO(a,d,m,C);return kO(R,t),R},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,a)=>{e.getProvider("auth-internal").initialize()})),Bc(new Gu("auth-internal",e=>{const t=Yw(e.getProvider("auth").getImmediate());return(a=>new H4(a))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),$u(RS,kS,Z4(n)),$u(RS,kS,"esm2020")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const K4=300,X4=OA("authIdTokenMaxAge")||K4;let LS=null;const Y4=n=>async e=>{const t=e&&await e.getIdTokenResult(),a=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(a&&a>X4)return;const d=t==null?void 0:t.token;LS!==d&&(LS=d,await fetch(n,{method:d?"POST":"DELETE",headers:d?{Authorization:`Bearer ${d}`}:{}}))};function Q4(n=gb()){const e=Qd(n,"auth");if(e.isInitialized())return e.getImmediate();const t=RO(n,{popupRedirectResolver:G4,persistence:[n4,qO,WI]}),a=OA("authTokenSyncURL");if(a&&typeof isSecureContext=="boolean"&&isSecureContext){const m=new URL(a,location.origin);if(location.origin===m.origin){const g=Y4(m.toString());UO(t,g,()=>g(t.currentUser)),VO(t,c=>g(c))}}const d=DA("auth");return d&&LO(t,`http://${d}`),t}function J4(){var n;return((n=document.getElementsByTagName("head"))==null?void 0:n[0])??document}CO({loadJS(n){return new Promise((e,t)=>{const a=document.createElement("script");a.setAttribute("src",n),a.onload=e,a.onerror=d=>{const m=Xh("internal-error");m.customData=d,t(m)},a.type="text/javascript",a.charset="UTF-8",J4().appendChild(a)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});W4("Browser");const tP="@firebase/installations",t2="0.6.19";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nP=1e4,iP=`w:${t2}`,rP="FIS_v2",eN="https://firebaseinstallations.googleapis.com/v1",tN=3600*1e3,nN="installations",iN="Installations";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rN={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},tm=new Yf(nN,iN,rN);function aP(n){return n instanceof mh&&n.code.includes("request-failed")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sP({projectId:n}){return`${eN}/projects/${n}/installations`}function oP(n){return{token:n.token,requestStatus:2,expiresIn:sN(n.expiresIn),creationTime:Date.now()}}async function lP(n,e){const a=(await e.json()).error;return tm.create("request-failed",{requestName:n,serverCode:a.code,serverMessage:a.message,serverStatus:a.status})}function uP({apiKey:n}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":n})}function aN(n,{refreshToken:e}){const t=uP(n);return t.append("Authorization",oN(e)),t}async function cP(n){const e=await n();return e.status>=500&&e.status<600?n():e}function sN(n){return Number(n.replace("s","000"))}function oN(n){return`${rP} ${n}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function lN({appConfig:n,heartbeatServiceProvider:e},{fid:t}){const a=sP(n),d=uP(n),m=e.getImmediate({optional:!0});if(m){const R=await m.getHeartbeatsHeader();R&&d.append("x-firebase-client",R)}const g={fid:t,authVersion:rP,appId:n.appId,sdkVersion:iP},c={method:"POST",headers:d,body:JSON.stringify(g)},C=await cP(()=>fetch(a,c));if(C.ok){const R=await C.json();return{fid:R.fid||t,registrationStatus:2,refreshToken:R.refreshToken,authToken:oP(R.authToken)}}else throw await lP("Create Installation",C)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hP(n){return new Promise(e=>{setTimeout(e,n)})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uN(n){return btoa(String.fromCharCode(...n)).replace(/\+/g,"-").replace(/\//g,"_")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cN=/^[cdef][\w-]{21}$/,P1="";function hN(){try{const n=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(n),n[0]=112+n[0]%16;const t=dN(n);return cN.test(t)?t:P1}catch{return P1}}function dN(n){return uN(n).substr(0,22)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kb(n){return`${n.appName}!${n.appId}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dP=new Map;function fP(n,e){const t=kb(n);pP(t,e),fN(t,e)}function pP(n,e){const t=dP.get(n);if(t)for(const a of t)a(e)}function fN(n,e){const t=pN();t&&t.postMessage({key:n,fid:e}),mN()}let jp=null;function pN(){return!jp&&"BroadcastChannel"in self&&(jp=new BroadcastChannel("[Firebase] FID Change"),jp.onmessage=n=>{pP(n.data.key,n.data.fid)}),jp}function mN(){dP.size===0&&jp&&(jp.close(),jp=null)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gN="firebase-installations-database",_N=1,nm="firebase-installations-store";let Lx=null;function n2(){return Lx||(Lx=$A(gN,_N,{upgrade:(n,e)=>{switch(e){case 0:n.createObjectStore(nm)}}})),Lx}async function eb(n,e){const t=kb(n),d=(await n2()).transaction(nm,"readwrite"),m=d.objectStore(nm),g=await m.get(t);return await m.put(e,t),await d.done,(!g||g.fid!==e.fid)&&fP(n,e.fid),e}async function mP(n){const e=kb(n),a=(await n2()).transaction(nm,"readwrite");await a.objectStore(nm).delete(e),await a.done}async function Lb(n,e){const t=kb(n),d=(await n2()).transaction(nm,"readwrite"),m=d.objectStore(nm),g=await m.get(t),c=e(g);return c===void 0?await m.delete(t):await m.put(c,t),await d.done,c&&(!g||g.fid!==c.fid)&&fP(n,c.fid),c}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function i2(n){let e;const t=await Lb(n.appConfig,a=>{const d=yN(a),m=vN(n,d);return e=m.registrationPromise,m.installationEntry});return t.fid===P1?{installationEntry:await e}:{installationEntry:t,registrationPromise:e}}function yN(n){const e=n||{fid:hN(),registrationStatus:0};return gP(e)}function vN(n,e){if(e.registrationStatus===0){if(!navigator.onLine){const d=Promise.reject(tm.create("app-offline"));return{installationEntry:e,registrationPromise:d}}const t={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},a=bN(n,t);return{installationEntry:t,registrationPromise:a}}else return e.registrationStatus===1?{installationEntry:e,registrationPromise:xN(n)}:{installationEntry:e}}async function bN(n,e){try{const t=await lN(n,e);return eb(n.appConfig,t)}catch(t){throw aP(t)&&t.customData.serverCode===409?await mP(n.appConfig):await eb(n.appConfig,{fid:e.fid,registrationStatus:0}),t}}async function xN(n){let e=await DS(n.appConfig);for(;e.registrationStatus===1;)await hP(100),e=await DS(n.appConfig);if(e.registrationStatus===0){const{installationEntry:t,registrationPromise:a}=await i2(n);return a||t}return e}function DS(n){return Lb(n,e=>{if(!e)throw tm.create("installation-not-found");return gP(e)})}function gP(n){return wN(n)?{fid:n.fid,registrationStatus:0}:n}function wN(n){return n.registrationStatus===1&&n.registrationTime+nP<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function TN({appConfig:n,heartbeatServiceProvider:e},t){const a=SN(n,t),d=aN(n,t),m=e.getImmediate({optional:!0});if(m){const R=await m.getHeartbeatsHeader();R&&d.append("x-firebase-client",R)}const g={installation:{sdkVersion:iP,appId:n.appId}},c={method:"POST",headers:d,body:JSON.stringify(g)},C=await cP(()=>fetch(a,c));if(C.ok){const R=await C.json();return oP(R)}else throw await lP("Generate Auth Token",C)}function SN(n,{fid:e}){return`${sP(n)}/${e}/authTokens:generate`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function r2(n,e=!1){let t;const a=await Lb(n.appConfig,m=>{if(!_P(m))throw tm.create("not-registered");const g=m.authToken;if(!e&&CN(g))return m;if(g.requestStatus===1)return t=EN(n,e),m;{if(!navigator.onLine)throw tm.create("app-offline");const c=PN(m);return t=AN(n,c),c}});return t?await t:a.authToken}async function EN(n,e){let t=await zS(n.appConfig);for(;t.authToken.requestStatus===1;)await hP(100),t=await zS(n.appConfig);const a=t.authToken;return a.requestStatus===0?r2(n,e):a}function zS(n){return Lb(n,e=>{if(!_P(e))throw tm.create("not-registered");const t=e.authToken;return MN(t)?{...e,authToken:{requestStatus:0}}:e})}async function AN(n,e){try{const t=await TN(n,e),a={...e,authToken:t};return await eb(n.appConfig,a),t}catch(t){if(aP(t)&&(t.customData.serverCode===401||t.customData.serverCode===404))await mP(n.appConfig);else{const a={...e,authToken:{requestStatus:0}};await eb(n.appConfig,a)}throw t}}function _P(n){return n!==void 0&&n.registrationStatus===2}function CN(n){return n.requestStatus===2&&!IN(n)}function IN(n){const e=Date.now();return e<n.creationTime||n.creationTime+n.expiresIn<e+tN}function PN(n){const e={requestStatus:1,requestTime:Date.now()};return{...n,authToken:e}}function MN(n){return n.requestStatus===1&&n.requestTime+nP<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function RN(n){const e=n,{installationEntry:t,registrationPromise:a}=await i2(e);return a?a.catch(console.error):r2(e).catch(console.error),t.fid}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function kN(n,e=!1){const t=n;return await LN(t),(await r2(t,e)).token}async function LN(n){const{registrationPromise:e}=await i2(n);e&&await e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function DN(n){if(!n||!n.options)throw Dx("App Configuration");if(!n.name)throw Dx("App Name");const e=["projectId","apiKey","appId"];for(const t of e)if(!n.options[t])throw Dx(t);return{appName:n.name,projectId:n.options.projectId,apiKey:n.options.apiKey,appId:n.options.appId}}function Dx(n){return tm.create("missing-app-config-values",{valueName:n})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yP="installations",zN="installations-internal",ON=n=>{const e=n.getProvider("app").getImmediate(),t=DN(e),a=Qd(e,"heartbeat");return{app:e,appConfig:t,heartbeatServiceProvider:a,_delete:()=>Promise.resolve()}},NN=n=>{const e=n.getProvider("app").getImmediate(),t=Qd(e,yP).getImmediate();return{getId:()=>RN(t),getToken:d=>kN(t,d)}};function BN(){Bc(new Gu(yP,ON,"PUBLIC")),Bc(new Gu(zN,NN,"PRIVATE"))}BN();$u(tP,t2);$u(tP,t2,"esm2020");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tb="analytics",FN="firebase_id",VN="origin",UN=60*1e3,jN="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",a2="https://www.googletagmanager.com/gtag/js";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hl=new Oy("@firebase/analytics");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $N={"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-initialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."},qu=new Yf("analytics","Analytics",$N);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qN(n){if(!n.startsWith(a2)){const e=qu.create("invalid-gtag-resource",{gtagURL:n});return Hl.warn(e.message),""}return n}function vP(n){return Promise.all(n.map(e=>e.catch(t=>t)))}function GN(n,e){let t;return window.trustedTypes&&(t=window.trustedTypes.createPolicy(n,e)),t}function HN(n,e){const t=GN("firebase-js-sdk-policy",{createScriptURL:qN}),a=document.createElement("script"),d=`${a2}?l=${n}&id=${e}`;a.src=t?t==null?void 0:t.createScriptURL(d):d,a.async=!0,document.head.appendChild(a)}function ZN(n){let e=[];return Array.isArray(window[n])?e=window[n]:window[n]=e,e}async function WN(n,e,t,a,d,m){const g=a[d];try{if(g)await e[g];else{const C=(await vP(t)).find(R=>R.measurementId===d);C&&await e[C.appId]}}catch(c){Hl.error(c)}n("config",d,m)}async function KN(n,e,t,a,d){try{let m=[];if(d&&d.send_to){let g=d.send_to;Array.isArray(g)||(g=[g]);const c=await vP(t);for(const C of g){const R=c.find(q=>q.measurementId===C),V=R&&e[R.appId];if(V)m.push(V);else{m=[];break}}}m.length===0&&(m=Object.values(e)),await Promise.all(m),n("event",a,d||{})}catch(m){Hl.error(m)}}function XN(n,e,t,a){async function d(m,...g){try{if(m==="event"){const[c,C]=g;await KN(n,e,t,c,C)}else if(m==="config"){const[c,C]=g;await WN(n,e,t,a,c,C)}else if(m==="consent"){const[c,C]=g;n("consent",c,C)}else if(m==="get"){const[c,C,R]=g;n("get",c,C,R)}else if(m==="set"){const[c]=g;n("set",c)}else n(m,...g)}catch(c){Hl.error(c)}}return d}function YN(n,e,t,a,d){let m=function(...g){window[a].push(arguments)};return window[d]&&typeof window[d]=="function"&&(m=window[d]),window[d]=XN(m,n,e,t),{gtagCore:m,wrappedGtag:window[d]}}function QN(n){const e=window.document.getElementsByTagName("script");for(const t of Object.values(e))if(t.src&&t.src.includes(a2)&&t.src.includes(n))return t;return null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JN=30,e6=1e3;class t6{constructor(e={},t=e6){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}}const bP=new t6;function n6(n){return new Headers({Accept:"application/json","x-goog-api-key":n})}async function i6(n){var g;const{appId:e,apiKey:t}=n,a={method:"GET",headers:n6(t)},d=jN.replace("{app-id}",e),m=await fetch(d,a);if(m.status!==200&&m.status!==304){let c="";try{const C=await m.json();(g=C.error)!=null&&g.message&&(c=C.error.message)}catch{}throw qu.create("config-fetch-failed",{httpStatus:m.status,responseMessage:c})}return m.json()}async function r6(n,e=bP,t){const{appId:a,apiKey:d,measurementId:m}=n.options;if(!a)throw qu.create("no-app-id");if(!d){if(m)return{measurementId:m,appId:a};throw qu.create("no-api-key")}const g=e.getThrottleMetadata(a)||{backoffCount:0,throttleEndTimeMillis:Date.now()},c=new o6;return setTimeout(async()=>{c.abort()},UN),xP({appId:a,apiKey:d,measurementId:m},g,c,e)}async function xP(n,{throttleEndTimeMillis:e,backoffCount:t},a,d=bP){var c;const{appId:m,measurementId:g}=n;try{await a6(a,e)}catch(C){if(g)return Hl.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${g} provided in the "measurementId" field in the local Firebase config. [${C==null?void 0:C.message}]`),{appId:m,measurementId:g};throw C}try{const C=await i6(n);return d.deleteThrottleMetadata(m),C}catch(C){const R=C;if(!s6(R)){if(d.deleteThrottleMetadata(m),g)return Hl.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${g} provided in the "measurementId" field in the local Firebase config. [${R==null?void 0:R.message}]`),{appId:m,measurementId:g};throw C}const V=Number((c=R==null?void 0:R.customData)==null?void 0:c.httpStatus)===503?i1(t,d.intervalMillis,JN):i1(t,d.intervalMillis),q={throttleEndTimeMillis:Date.now()+V,backoffCount:t+1};return d.setThrottleMetadata(m,q),Hl.debug(`Calling attemptFetch again in ${V} millis`),xP(n,q,a,d)}}function a6(n,e){return new Promise((t,a)=>{const d=Math.max(e-Date.now(),0),m=setTimeout(t,d);n.addEventListener(()=>{clearTimeout(m),a(qu.create("fetch-throttle",{throttleEndTimeMillis:e}))})})}function s6(n){if(!(n instanceof mh)||!n.customData)return!1;const e=Number(n.customData.httpStatus);return e===429||e===500||e===503||e===504}class o6{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}async function l6(n,e,t,a,d){if(d&&d.global){n("event",t,a);return}else{const m=await e,g={...a,send_to:m};n("event",t,g)}}async function u6(n,e,t,a){if(a&&a.global){const d={};for(const m of Object.keys(t))d[`user_properties.${m}`]=t[m];return n("set",d),Promise.resolve()}else{const d=await e;n("config",d,{update:!0,user_properties:t})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function c6(){if(mb())try{await VA()}catch(n){return Hl.warn(qu.create("indexeddb-unavailable",{errorInfo:n==null?void 0:n.toString()}).message),!1}else return Hl.warn(qu.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;return!0}async function h6(n,e,t,a,d,m,g){const c=r6(n);c.then(J=>{t[J.measurementId]=J.appId,n.options.measurementId&&J.measurementId!==n.options.measurementId&&Hl.warn(`The measurement ID in the local Firebase config (${n.options.measurementId}) does not match the measurement ID fetched from the server (${J.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(J=>Hl.error(J)),e.push(c);const C=c6().then(J=>{if(J)return a.getId()}),[R,V]=await Promise.all([c,C]);QN(m)||HN(m,R.measurementId),d("js",new Date);const q=(g==null?void 0:g.config)??{};return q[VN]="firebase",q.update=!0,V!=null&&(q[FN]=V),d("config",R.measurementId,q),R.measurementId}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class d6{constructor(e){this.app=e}_delete(){return delete dg[this.app.options.appId],Promise.resolve()}}let dg={},OS=[];const NS={};let zx="dataLayer",f6="gtag",BS,s2,FS=!1;function p6(){const n=[];if(FA()&&n.push("This is a browser extension environment."),dL()||n.push("Cookies are not available."),n.length>0){const e=n.map((a,d)=>`(${d+1}) ${a}`).join(" "),t=qu.create("invalid-analytics-context",{errorInfo:e});Hl.warn(t.message)}}function m6(n,e,t){p6();const a=n.options.appId;if(!a)throw qu.create("no-app-id");if(!n.options.apiKey)if(n.options.measurementId)Hl.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${n.options.measurementId} provided in the "measurementId" field in the local Firebase config.`);else throw qu.create("no-api-key");if(dg[a]!=null)throw qu.create("already-exists",{id:a});if(!FS){ZN(zx);const{wrappedGtag:m,gtagCore:g}=YN(dg,OS,NS,zx,f6);s2=m,BS=g,FS=!0}return dg[a]=h6(n,OS,NS,e,BS,zx,t),new d6(n)}function g6(n=gb()){n=Ll(n);const e=Qd(n,tb);return e.isInitialized()?e.getImmediate():_6(n)}function _6(n,e={}){const t=Qd(n,tb);if(t.isInitialized()){const d=t.getImmediate();if(qf(e,t.getOptions()))return d;throw qu.create("already-initialized")}return t.initialize({options:e})}function y6(n,e,t){n=Ll(n),u6(s2,dg[n.app.options.appId],e,t).catch(a=>Hl.error(a))}function v6(n,e,t,a){n=Ll(n),l6(s2,dg[n.app.options.appId],e,t,a).catch(d=>Hl.error(d))}const VS="@firebase/analytics",US="0.10.19";function b6(){Bc(new Gu(tb,(e,{options:t})=>{const a=e.getProvider("app").getImmediate(),d=e.getProvider("installations-internal").getImmediate();return m6(a,d,t)},"PUBLIC")),Bc(new Gu("analytics-internal",n,"PRIVATE")),$u(VS,US),$u(VS,US,"esm2020");function n(e){try{const t=e.getProvider(tb).getImmediate();return{logEvent:(a,d,m)=>v6(t,a,d,m),setUserProperties:(a,d)=>y6(t,a,d)}}catch(t){throw qu.create("interop-component-reg-failed",{reason:t})}}}b6();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const M1=new Map,wP={activated:!1,tokenObservers:[]},x6={initialized:!1,enabled:!1};function so(n){return M1.get(n)||{...wP}}function w6(n,e){return M1.set(n,e),M1.get(n)}function Db(){return x6}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TP="https://content-firebaseappcheck.googleapis.com/v1",T6="exchangeRecaptchaV3Token",S6="exchangeDebugToken",jS={RETRIAL_MIN_WAIT:30*1e3,RETRIAL_MAX_WAIT:960*1e3},E6=1440*60*1e3;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class A6{constructor(e,t,a,d,m){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=a,this.lowerBound=d,this.upperBound=m,this.pending=null,this.nextErrorWaitInterval=d,d>m)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}async process(e){this.stop();try{this.pending=new cy,this.pending.promise.catch(t=>{}),await C6(this.getNextRun(e)),this.pending.resolve(),await this.pending.promise,this.pending=new cy,this.pending.promise.catch(t=>{}),await this.operation(),this.pending.resolve(),await this.pending.promise,this.process(!0).catch(()=>{})}catch(t){this.retryPolicy(t)?this.process(!1).catch(()=>{}):this.stop()}}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{const t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}}function C6(n){return new Promise(e=>{setTimeout(e,n)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const I6={"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.","initial-throttle":"{$httpStatus} error. Attempts allowed again after {$time}",throttled:"Requests throttled due to previous {$httpStatus} error. Attempts allowed again after {$time}"},du=new Yf("appCheck","AppCheck",I6);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $S(n=!1){var e;return n?(e=self.grecaptcha)==null?void 0:e.enterprise:self.grecaptcha}function o2(n){if(!so(n).activated)throw du.create("use-before-activation",{appName:n.name})}function SP(n){const e=Math.round(n/1e3),t=Math.floor(e/(3600*24)),a=Math.floor((e-t*3600*24)/3600),d=Math.floor((e-t*3600*24-a*3600)/60),m=e-t*3600*24-a*3600-d*60;let g="";return t&&(g+=Kv(t)+"d:"),a&&(g+=Kv(a)+"h:"),g+=Kv(d)+"m:"+Kv(m)+"s",g}function Kv(n){return n===0?"00":n>=10?n.toString():"0"+n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function l2({url:n,body:e},t){const a={"Content-Type":"application/json"},d=t.getImmediate({optional:!0});if(d){const q=await d.getHeartbeatsHeader();q&&(a["X-Firebase-Client"]=q)}const m={method:"POST",body:JSON.stringify(e),headers:a};let g;try{g=await fetch(n,m)}catch(q){throw du.create("fetch-network-error",{originalErrorMessage:q==null?void 0:q.message})}if(g.status!==200)throw du.create("fetch-status-error",{httpStatus:g.status});let c;try{c=await g.json()}catch(q){throw du.create("fetch-parse-error",{originalErrorMessage:q==null?void 0:q.message})}const C=c.ttl.match(/^([\d.]+)(s)$/);if(!C||!C[2]||isNaN(Number(C[1])))throw du.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${c.ttl}`});const R=Number(C[1])*1e3,V=Date.now();return{token:c.token,expireTimeMillis:V+R,issuedAtTimeMillis:V}}function P6(n,e){const{projectId:t,appId:a,apiKey:d}=n.options;return{url:`${TP}/projects/${t}/apps/${a}:${T6}?key=${d}`,body:{recaptcha_v3_token:e}}}function EP(n,e){const{projectId:t,appId:a,apiKey:d}=n.options;return{url:`${TP}/projects/${t}/apps/${a}:${S6}?key=${d}`,body:{debug_token:e}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const M6="firebase-app-check-database",R6=1,by="firebase-app-check-store",AP="debug-token";let Xv=null;function CP(){return Xv||(Xv=new Promise((n,e)=>{try{const t=indexedDB.open(M6,R6);t.onsuccess=a=>{n(a.target.result)},t.onerror=a=>{var d;e(du.create("storage-open",{originalErrorMessage:(d=a.target.error)==null?void 0:d.message}))},t.onupgradeneeded=a=>{const d=a.target.result;switch(a.oldVersion){case 0:d.createObjectStore(by,{keyPath:"compositeKey"})}}}catch(t){e(du.create("storage-open",{originalErrorMessage:t==null?void 0:t.message}))}}),Xv)}function k6(n){return PP(MP(n))}function L6(n,e){return IP(MP(n),e)}function D6(n){return IP(AP,n)}function z6(){return PP(AP)}async function IP(n,e){const a=(await CP()).transaction(by,"readwrite"),m=a.objectStore(by).put({compositeKey:n,value:e});return new Promise((g,c)=>{m.onsuccess=C=>{g()},a.onerror=C=>{var R;c(du.create("storage-set",{originalErrorMessage:(R=C.target.error)==null?void 0:R.message}))}})}async function PP(n){const t=(await CP()).transaction(by,"readonly"),d=t.objectStore(by).get(n);return new Promise((m,g)=>{d.onsuccess=c=>{const C=c.target.result;m(C?C.value:void 0)},t.onerror=c=>{var C;g(du.create("storage-get",{originalErrorMessage:(C=c.target.error)==null?void 0:C.message}))}})}function MP(n){return`${n.options.appId}-${n.name}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zf=new Oy("@firebase/app-check");/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function O6(n){if(mb()){let e;try{e=await k6(n)}catch(t){zf.warn(`Failed to read token from IndexedDB. Error: ${t}`)}return e}}function Ox(n,e){return mb()?L6(n,e).catch(t=>{zf.warn(`Failed to write token to IndexedDB. Error: ${t}`)}):Promise.resolve()}async function N6(){let n;try{n=await z6()}catch{}if(n)return n;{const e=crypto.randomUUID();return D6(e).catch(t=>zf.warn(`Failed to persist debug token to IndexedDB. Error: ${t}`)),e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function u2(){return Db().enabled}async function c2(){const n=Db();if(n.enabled&&n.token)return n.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)}function B6(){const n=LA(),e=Db();if(e.initialized=!0,typeof n.FIREBASE_APPCHECK_DEBUG_TOKEN!="string"&&n.FIREBASE_APPCHECK_DEBUG_TOKEN!==!0)return;e.enabled=!0;const t=new cy;e.token=t,typeof n.FIREBASE_APPCHECK_DEBUG_TOKEN=="string"?t.resolve(n.FIREBASE_APPCHECK_DEBUG_TOKEN):t.resolve(N6())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const F6={error:"UNKNOWN_ERROR"};function V6(n){return hw.encodeString(JSON.stringify(n),!1)}async function R1(n,e=!1,t=!1){const a=n.app;o2(a);const d=so(a);let m=d.token,g;if(m&&!ag(m)&&(d.token=void 0,m=void 0),!m){const R=await d.cachedTokenPromise;R&&(ag(R)?m=R:await Ox(a,void 0))}if(!e&&m&&ag(m))return{token:m.token};let c=!1;if(u2())try{d.exchangeTokenPromise||(d.exchangeTokenPromise=l2(EP(a,await c2()),n.heartbeatServiceProvider).finally(()=>{d.exchangeTokenPromise=void 0}),c=!0);const R=await d.exchangeTokenPromise;return await Ox(a,R),d.token=R,{token:R.token}}catch(R){return R.code==="appCheck/throttled"||R.code==="appCheck/initial-throttle"?zf.warn(R.message):t&&zf.error(R),Nx(R)}try{d.exchangeTokenPromise||(d.exchangeTokenPromise=d.provider.getToken().finally(()=>{d.exchangeTokenPromise=void 0}),c=!0),m=await so(a).exchangeTokenPromise}catch(R){R.code==="appCheck/throttled"||R.code==="appCheck/initial-throttle"?zf.warn(R.message):t&&zf.error(R),g=R}let C;return m?g?ag(m)?C={token:m.token,internalError:g}:C=Nx(g):(C={token:m.token},d.token=m,await Ox(a,m)):C=Nx(g),c&&LP(a,C),C}async function U6(n){const e=n.app;o2(e);const{provider:t}=so(e);if(u2()){const a=await c2(),{token:d}=await l2(EP(e,a),n.heartbeatServiceProvider);return{token:d}}else{const{token:a}=await t.getToken();return{token:a}}}function RP(n,e,t,a){const{app:d}=n,m=so(d),g={next:t,error:a,type:e};if(m.tokenObservers=[...m.tokenObservers,g],m.token&&ag(m.token)){const c=m.token;Promise.resolve().then(()=>{t({token:c.token}),qS(n)}).catch(()=>{})}m.cachedTokenPromise.then(()=>qS(n))}function kP(n,e){const t=so(n),a=t.tokenObservers.filter(d=>d.next!==e);a.length===0&&t.tokenRefresher&&t.tokenRefresher.isRunning()&&t.tokenRefresher.stop(),t.tokenObservers=a}function qS(n){const{app:e}=n,t=so(e);let a=t.tokenRefresher;a||(a=j6(n),t.tokenRefresher=a),!a.isRunning()&&t.isTokenAutoRefreshEnabled&&a.start()}function j6(n){const{app:e}=n;return new A6(async()=>{const t=so(e);let a;if(t.token?a=await R1(n,!0):a=await R1(n),a.error)throw a.error;if(a.internalError)throw a.internalError},()=>!0,()=>{const t=so(e);if(t.token){let a=t.token.issuedAtTimeMillis+(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)*.5+3e5;const d=t.token.expireTimeMillis-300*1e3;return a=Math.min(a,d),Math.max(0,a-Date.now())}else return 0},jS.RETRIAL_MIN_WAIT,jS.RETRIAL_MAX_WAIT)}function LP(n,e){const t=so(n).tokenObservers;for(const a of t)try{a.type==="EXTERNAL"&&e.error!=null?a.error(e.error):a.next(e)}catch{}}function ag(n){return n.expireTimeMillis-Date.now()>0}function Nx(n){return{token:V6(F6),error:n}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $6{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){const{tokenObservers:e}=so(this.app);for(const t of e)kP(this.app,t.next);return Promise.resolve()}}function q6(n,e){return new $6(n,e)}function G6(n){return{getToken:e=>R1(n,e),getLimitedUseToken:()=>U6(n),addTokenListener:e=>RP(n,"INTERNAL",e),removeTokenListener:e=>kP(n.app,e)}}const H6="@firebase/app-check",Z6="0.11.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const W6="https://www.google.com/recaptcha/api.js";function K6(n,e){const t=new cy,a=so(n);a.reCAPTCHAState={initialized:t};const d=X6(n),m=$S(!1);return m?GS(n,e,m,d,t):J6(()=>{const g=$S(!1);if(!g)throw new Error("no recaptcha");GS(n,e,g,d,t)}),t.promise}function GS(n,e,t,a,d){t.ready(()=>{Q6(n,e,t,a),d.resolve(t)})}function X6(n){const e=`fire_app_check_${n.name}`,t=document.createElement("div");return t.id=e,t.style.display="none",document.body.appendChild(t),e}async function Y6(n){o2(n);const t=await so(n).reCAPTCHAState.initialized.promise;return new Promise((a,d)=>{const m=so(n).reCAPTCHAState;t.ready(()=>{a(t.execute(m.widgetId,{action:"fire_app_check"}))})})}function Q6(n,e,t,a){const d=t.render(a,{sitekey:e,size:"invisible",callback:()=>{so(n).reCAPTCHAState.succeeded=!0},"error-callback":()=>{so(n).reCAPTCHAState.succeeded=!1}}),m=so(n);m.reCAPTCHAState={...m.reCAPTCHAState,widgetId:d}}function J6(n){const e=document.createElement("script");e.src=W6,e.onload=n,document.head.appendChild(e)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h2{constructor(e){this._siteKey=e,this._throttleData=null}async getToken(){var a,d,m;tB(this._throttleData);const e=await Y6(this._app).catch(g=>{throw du.create("recaptcha-error")});if(!((a=so(this._app).reCAPTCHAState)!=null&&a.succeeded))throw du.create("recaptcha-error");let t;try{t=await l2(P6(this._app,e),this._heartbeatServiceProvider)}catch(g){throw(d=g.code)!=null&&d.includes("fetch-status-error")?(this._throttleData=eB(Number((m=g.customData)==null?void 0:m.httpStatus),this._throttleData),du.create("initial-throttle",{time:SP(this._throttleData.allowRequestsAfter-Date.now()),httpStatus:this._throttleData.httpStatus})):g}return this._throttleData=null,t}initialize(e){this._app=e,this._heartbeatServiceProvider=Qd(e,"heartbeat"),K6(e,this._siteKey).catch(()=>{})}isEqual(e){return e instanceof h2?this._siteKey===e._siteKey:!1}}function eB(n,e){if(n===404||n===403)return{backoffCount:1,allowRequestsAfter:Date.now()+E6,httpStatus:n};{const t=e?e.backoffCount:0,a=i1(t,1e3,2);return{backoffCount:t+1,allowRequestsAfter:Date.now()+a,httpStatus:n}}}function tB(n){if(n&&Date.now()-n.allowRequestsAfter<=0)throw du.create("throttled",{time:SP(n.allowRequestsAfter-Date.now()),httpStatus:n.httpStatus})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nB(n=gb(),e){n=Ll(n);const t=Qd(n,"app-check");if(Db().initialized||B6(),u2()&&c2().then(d=>console.log(`App Check debug token: ${d}. You will need to add it to your app's App Check settings in the Firebase console for it to work.`)),t.isInitialized()){const d=t.getImmediate(),m=t.getOptions();if(m.isTokenAutoRefreshEnabled===e.isTokenAutoRefreshEnabled&&m.provider.isEqual(e.provider))return d;throw du.create("already-initialized",{appName:n.name})}const a=t.initialize({options:e});return iB(n,e.provider,e.isTokenAutoRefreshEnabled),so(n).isTokenAutoRefreshEnabled&&RP(a,"INTERNAL",()=>{}),a}function iB(n,e,t=!1){const a=w6(n,{...wP});a.activated=!0,a.provider=e,a.cachedTokenPromise=O6(n).then(d=>(d&&ag(d)&&(a.token=d,LP(n,{token:d.token})),d)),a.isTokenAutoRefreshEnabled=t&&n.automaticDataCollectionEnabled,!n.automaticDataCollectionEnabled&&t&&zf.warn("`isTokenAutoRefreshEnabled` is true but `automaticDataCollectionEnabled` was set to false during `initializeApp()`. This blocks automatic token refresh."),a.provider.initialize(n)}const rB="app-check",HS="app-check-internal";function aB(){Bc(new Gu(rB,n=>{const e=n.getProvider("app").getImmediate(),t=n.getProvider("heartbeat");return q6(e,t)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((n,e,t)=>{n.getProvider(HS).initialize()})),Bc(new Gu(HS,n=>{const e=n.getProvider("app-check").getImmediate();return G6(e)},"PUBLIC").setInstantiationMode("EXPLICIT")),$u(H6,Z6)}aB();const sB={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_CLARITY_ID:"tyjad302qq",VITE_FIREBASE_API_KEY:"AIzaSyC5EgMfrRpFh8_ZFyQ_ieF-YYD9xPrOaVU",VITE_FIREBASE_APP_ID:"1:1016256516850:web:5b902e0616dfc3c926766b",VITE_FIREBASE_AUTH_DOMAIN:"redreport-29023.firebaseapp.com",VITE_FIREBASE_MEASUREMENT_ID:"G-S4C6LSBB9G",VITE_FIREBASE_MESSAGING_SENDER_ID:"1016256516850",VITE_FIREBASE_PROJECT_ID:"redreport-29023",VITE_FIREBASE_STORAGE_BUCKET:"redreport-29023.firebasestorage.app",VITE_MAP_KEY:"0UGrg19TXtYRROinsJ9a",VITE_RECAPTCHA_SITE_KEY:"6LeMDQssAAAAAC3prYanNGr6ItRklzJicu190qUc"},oB={apiKey:"AIzaSyC5EgMfrRpFh8_ZFyQ_ieF-YYD9xPrOaVU",authDomain:"redreport-29023.firebaseapp.com",projectId:"redreport-29023",storageBucket:"redreport-29023.firebasestorage.app",messagingSenderId:"1016256516850",appId:"1:1016256516850:web:5b902e0616dfc3c926766b",measurementId:"G-S4C6LSBB9G"},lB=["VITE_FIREBASE_API_KEY","VITE_FIREBASE_AUTH_DOMAIN","VITE_FIREBASE_PROJECT_ID","VITE_RECAPTCHA_SITE_KEY"];lB.forEach(n=>{if(!sB[n])throw new Error(`Missing required environment variable: ${n}`)});const zb=qA(oB),DP=L3(zb);Q4(zb);setTimeout(()=>{try{nB(zb,{provider:new h2("6LeMDQssAAAAAC3prYanNGr6ItRklzJicu190qUc"),isTokenAutoRefreshEnabled:!0}),console.log("AppCheck initialized successfully")}catch(n){console.warn("AppCheck initialization error:",n)}},100);typeof window<"u"&&g6(zb);const d2=[{"Notre-Dame":{"Residence Halls":[{name:"Alumni Hall",latitude:41.6984,longitude:-86.2339,id:"alumni-hall",type:"Residence Halls",location:"Notre Dame"},{name:"Badin Hall",latitude:41.7006,longitude:-86.2412,id:"badin-hall",type:"Residence Halls",location:"Notre Dame"},{name:"Breen-Phillips Hall",latitude:41.70278,longitude:-86.24,id:"breen-phillips-hall",type:"Residence Halls",location:"Notre Dame"},{name:"Carroll Hall",latitude:41.70194,longitude:-86.24778,id:"carroll-hall",type:"Residence Halls",location:"Notre Dame"},{name:"Cavanaugh Hall",latitude:41.702807,longitude:-86.237164,id:"cavanaugh-hall",type:"Residence Halls",location:"Notre Dame"},{name:"Dillon Hall",latitude:41.6984,longitude:-86.2339,id:"dillon-hall",type:"Residence Halls",location:"Notre Dame"},{name:"Duncan Hall",latitude:41.6984,longitude:-86.2339,id:"duncan-hall",type:"Residence Halls",location:"Notre Dame"},{name:"Dunne Hall",latitude:41.7045274,longitude:-86.2329434,id:"dunne-hall",type:"Residence Halls",location:"Notre Dame"},{name:"Farley Hall",latitude:41.7036468,longitude:-86.2361456,id:"farley-hall",type:"Residence Halls",location:"Notre Dame"},{name:"Fisher Hall",latitude:41.6984,longitude:-86.2339,id:"fisher-hall",type:"Residence Halls",location:"Notre Dame"},{name:"Keenan Hall",latitude:41.703917,longitude:-86.237477,id:"keenan-hall",type:"Residence Halls",location:"Notre Dame"},{name:"Sacred Heart Parish Center",latitude:41.7068221,longitude:-86.2450146,id:"sacred-heart-parish-center",type:"Residence Halls",location:"Notre Dame"},{name:"Baumer Hall",latitude:41.697,longitude:-86.2414,id:"baumer-hall",type:"Residence Halls",location:"Notre Dame"},{name:"Fischer Graduate Residences",latitude:41.7051,longitude:-86.229,id:"fischer-graduate-residences",type:"Residence Halls",location:"Notre Dame"},{name:"Harper Hall",latitude:41.69928,longitude:-86.238899,id:"harper-hall",type:"Residence Halls",location:"Notre Dame"},{name:"Flaherty Hall",latitude:41.7035,longitude:-86.2328,id:"flaherty-hall",type:"Residence Halls",location:"Notre Dame"},{name:"Howard Hall",latitude:41.700833,longitude:-86.241667,id:"howard-hall",type:"Residence Halls",location:"Notre Dame"}],"Academic Buildings":[{name:"Law School",latitude:41.698379,longitude:-86.23863,location:"Notre Dame",id:"law-school",buildingType:"Academic Buildings"},{name:"Hesburgh Library",latitude:41.7023892,longitude:-86.2341526,id:"hesburgh-library",type:"Academic Buildings",location:"Notre Dame"},{name:"Corbett Family Hall",latitude:41.699192,longitude:-86.234851,id:"corbett-family-hall",location:"Notre Dame",buildingType:"Academic Buildings"},{name:"Walsh Family Hall of Architecture",latitude:41.695,longitude:-86.235,id:"walsh-family-hall-of-architecture",type:"Academic Buildings",location:"Notre Dame"},{name:"Jordan Hall of Science",latitude:41.700685,longitude:-86.233075,id:"jordan-hall-of-science",type:"Academic Buildings",location:"Notre Dame"},{name:"DeBartolo Hall",latitude:41.6982522,longitude:-86.2362484,id:"debartolo-hall",type:"Academic Buildings",location:"Notre Dame"},{name:"Decio Faculty Hall",latitude:41.700545,longitude:-86.235967,id:"decio-family-hall",location:"Notre Dame",buildingType:"Academic Buildings"},{name:"Stayer Center for Executive Education",latitude:41.71048456,longitude:-86.2360535,id:"stayer-center-for-executive-education",type:"Academic Buildings",location:"Notre Dame"},{name:"O'Shaughnessy Hall",latitude:41.7003185,longitude:-86.2356855,id:"oshaughnessy-hall",type:"Academic Buildings",location:"Notre Dame"},{name:"Hayes-Healy Center",latitude:41.700344,longitude:-86.236814,id:"hayes-healy-center",location:"Notre Dame",buildingType:"Academic Buildings"},{name:"Mendoza College of Business",latitude:41.6970083,longitude:-86.23615,id:"mendoza-college-of-business",type:"Academic Buildings",location:"Notre Dame"},{name:"Raclin Murphy Museum of Art",latitude:41.693889,longitude:-86.235,id:"raclin-murphy-museum-of-art",type:"Academic Buildings",location:"Notre Dame"},{name:"Fitzpatrick College of Engineering",latitude:41.699234,longitude:-86.23695,id:"fitzpatrick-college-of-engineering",location:"Notre Dame",buildingType:"Academic Buildings"},{name:"Riley Hall of Art & Design",latitude:41.70083425,longitude:-86.23722792,id:"riley-hall-of-art-design",type:"Academic Buildings",location:"Notre Dame"},{name:"Spes Unica Hall",latitude:41.70632,longitude:-86.2570306,id:"spes-unica-hall",type:"Academic Buildings",location:"Notre Dame"},{name:"O'Neill Hall",latitude:41.69822114,longitude:-86.2319385,id:"oneill-hall",type:"Academic Buildings",location:"Notre Dame"},{name:"DPAC",latitude:41.694799,longitude:-86.236694,id:"DPAC",type:"Academic Buildings",location:"Notre Dame"},{name:"Nieuwland Science Hall",latitude:41.70153583,longitude:-86.2366288,id:"nieuwland-science-hall",type:"Academic Buildings",location:"Notre Dame"}],"Student Buildings":[{name:"LaFortune Student Center",latitude:41.7002,longitude:-86.2379,id:"lafortune-student-center",type:"Student Buildings",location:"Notre Dame"},{name:"LaFortune Food Court",latitude:41.7002,longitude:-86.2379,id:"lafortune-food-court",type:"Student Buildings",location:"Notre Dame"},{name:"Haggar Parlor",latitude:41.7002,longitude:-86.2379,id:"haggar-parlor",type:"Student Buildings",location:"Notre Dame"},{name:"Joyce Center",latitude:41.7002,longitude:-86.2379,id:"joyce-center",type:"Student Buildings",location:"Notre Dame"},{name:"Compton Family Ice Arena",latitude:41.7002,longitude:-86.2379,id:"compton-ice-arena",type:"Student Buildings",location:"Notre Dame"},{name:"Notre Dame Stadium",latitude:41.7002,longitude:-86.2379,id:"notre-dame-stadium",type:"Student Buildings",location:"Notre Dame"},{name:"Wellness Center",latitude:41.7002,longitude:-86.2379,id:"wellness-center",type:"Student Buildings",location:"Notre Dame"},{name:"Grotto of Our Lady of Lourdes",latitude:41.7002,longitude:-86.2379,id:"grotto",type:"Student Buildings",location:"Notre Dame"},{name:"Basilica",latitude:41.7026336,longitude:-86.2397856,id:"basilica-of-the-sacred-heart",type:"Student Buildings",location:"Notre Dame"}]},"Holy-Cross":{"Academic Buildings":[{name:"Holy Cross College",latitude:41.7000923,longitude:-86.2537078,location:"Holy Cross",buildingType:"Academic Buildings"}]},"Saint-Marys":{}}],ZS=["All",...Object.keys(d2[0])],WS=d2[0],KS=Object.values(d2[0]).flatMap(n=>Object.values(n)).flat();/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var k1=function(){return k1=Object.assign||function(n){for(var e,t=1,a=arguments.length;t<a;t++)for(var d in e=arguments[t])Object.prototype.hasOwnProperty.call(e,d)&&(n[d]=e[d]);return n},k1.apply(this,arguments)},L1,uB=function(n){var e;n?(function(t){if(t)for(;t.lastChild;)t.lastChild.remove()})(typeof n=="string"?document.getElementById(n):n):(e=document.querySelector(".grecaptcha-badge"))&&e.parentNode&&document.body.removeChild(e.parentNode)},cB=function(n,e){uB(e),window.___grecaptcha_cfg=void 0;var t=document.querySelector("#"+n);t&&t.remove(),(function(){var a=document.querySelector('script[src^="https://www.gstatic.com/recaptcha/releases"]');a&&a.remove()})()},hB=function(n){var e=n.render,t=n.onLoadCallbackName,a=n.language,d=n.onLoad,m=n.useRecaptchaNet,g=n.useEnterprise,c=n.scriptProps,C=c===void 0?{}:c,R=C.nonce,V=R===void 0?"":R,q=C.defer,J=q!==void 0&&q,Y=C.async,xe=Y!==void 0&&Y,be=C.id,Oe=be===void 0?"":be,et=C.appendTo,Je=Oe||"google-recaptcha-v3";if((function(je){return!!document.querySelector("#"+je)})(Je))d();else{var qe=(function(je){return"https://www."+(je.useRecaptchaNet?"recaptcha.net":"google.com")+"/recaptcha/"+(je.useEnterprise?"enterprise.js":"api.js")})({useEnterprise:g,useRecaptchaNet:m}),Ze=document.createElement("script");Ze.id=Je,Ze.src=qe+"?render="+e+(e==="explicit"?"&onload="+t:"")+(a?"&hl="+a:""),V&&(Ze.nonce=V),Ze.defer=!!J,Ze.async=!!xe,Ze.onload=d,(et==="body"?document.body:document.getElementsByTagName("head")[0]).appendChild(Ze)}},XS=function(n){console.warn(n)};(function(n){n.SCRIPT_NOT_AVAILABLE="Recaptcha script is not available"})(L1||(L1={}));var f2=wt.createContext({executeRecaptcha:function(){throw Error("GoogleReCaptcha Context has not yet been implemented, if you are using useGoogleReCaptcha hook, make sure the hook is called inside component wrapped by GoogleRecaptchaProvider")}});f2.Consumer;function dB(n){var e=n.reCaptchaKey,t=n.useEnterprise,a=t!==void 0&&t,d=n.useRecaptchaNet,m=d!==void 0&&d,g=n.scriptProps,c=n.language,C=n.container,R=n.children,V=wt.useState(null),q=V[0],J=V[1],Y=wt.useRef(e),xe=JSON.stringify(g),be=JSON.stringify(C==null?void 0:C.parameters);wt.useEffect((function(){if(e){var Je=(g==null?void 0:g.id)||"google-recaptcha-v3",qe=(g==null?void 0:g.onLoadCallbackName)||"onRecaptchaLoadCallback";return window[qe]=function(){var Ze=a?window.grecaptcha.enterprise:window.grecaptcha,je=k1({badge:"inline",size:"invisible",sitekey:e},(C==null?void 0:C.parameters)||{});Y.current=Ze.render(C==null?void 0:C.element,je)},hB({render:C!=null&&C.element?"explicit":e,onLoadCallbackName:qe,useEnterprise:a,useRecaptchaNet:m,scriptProps:g,language:c,onLoad:function(){if(window&&window.grecaptcha){var Ze=a?window.grecaptcha.enterprise:window.grecaptcha;Ze.ready((function(){J(Ze)}))}else XS("<GoogleRecaptchaProvider /> "+L1.SCRIPT_NOT_AVAILABLE)}}),function(){cB(Je,C==null?void 0:C.element)}}XS("<GoogleReCaptchaProvider /> recaptcha key not provided")}),[a,m,xe,be,c,e,C==null?void 0:C.element]);var Oe=wt.useCallback((function(Je){if(!q||!q.execute)throw new Error("<GoogleReCaptchaProvider /> Google Recaptcha has not been loaded");return q.execute(Y.current,{action:Je})}),[q,Y]),et=wt.useMemo((function(){return{executeRecaptcha:q?Oe:void 0,container:C==null?void 0:C.element}}),[Oe,q,C==null?void 0:C.element]);return dA.createElement(f2.Provider,{value:et},R)}var fB=function(){return wt.useContext(f2)};function zP(n,e){return n(e={exports:{}},e.exports),e.exports;/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */}var So=typeof Symbol=="function"&&Symbol.for,D1=So?Symbol.for("react.element"):60103,z1=So?Symbol.for("react.portal"):60106,g0=So?Symbol.for("react.fragment"):60107,_0=So?Symbol.for("react.strict_mode"):60108,y0=So?Symbol.for("react.profiler"):60114,v0=So?Symbol.for("react.provider"):60109,b0=So?Symbol.for("react.context"):60110,O1=So?Symbol.for("react.async_mode"):60111,nb=So?Symbol.for("react.concurrent_mode"):60111,x0=So?Symbol.for("react.forward_ref"):60112,w0=So?Symbol.for("react.suspense"):60113,pB=So?Symbol.for("react.suspense_list"):60120,T0=So?Symbol.for("react.memo"):60115,S0=So?Symbol.for("react.lazy"):60116,mB=So?Symbol.for("react.block"):60121,gB=So?Symbol.for("react.fundamental"):60117,_B=So?Symbol.for("react.responder"):60118,yB=So?Symbol.for("react.scope"):60119;function Ou(n){if(typeof n=="object"&&n!==null){var e=n.$$typeof;switch(e){case D1:switch(n=n.type){case O1:case nb:case g0:case y0:case _0:case w0:return n;default:switch(n=n&&n.$$typeof){case b0:case x0:case S0:case T0:case v0:return n;default:return e}}case z1:return e}}}function YS(n){return Ou(n)===nb}var vB={AsyncMode:O1,ConcurrentMode:nb,ContextConsumer:b0,ContextProvider:v0,Element:D1,ForwardRef:x0,Fragment:g0,Lazy:S0,Memo:T0,Portal:z1,Profiler:y0,StrictMode:_0,Suspense:w0,isAsyncMode:function(n){return YS(n)||Ou(n)===O1},isConcurrentMode:YS,isContextConsumer:function(n){return Ou(n)===b0},isContextProvider:function(n){return Ou(n)===v0},isElement:function(n){return typeof n=="object"&&n!==null&&n.$$typeof===D1},isForwardRef:function(n){return Ou(n)===x0},isFragment:function(n){return Ou(n)===g0},isLazy:function(n){return Ou(n)===S0},isMemo:function(n){return Ou(n)===T0},isPortal:function(n){return Ou(n)===z1},isProfiler:function(n){return Ou(n)===y0},isStrictMode:function(n){return Ou(n)===_0},isSuspense:function(n){return Ou(n)===w0},isValidElementType:function(n){return typeof n=="string"||typeof n=="function"||n===g0||n===nb||n===y0||n===_0||n===w0||n===pB||typeof n=="object"&&n!==null&&(n.$$typeof===S0||n.$$typeof===T0||n.$$typeof===v0||n.$$typeof===b0||n.$$typeof===x0||n.$$typeof===gB||n.$$typeof===_B||n.$$typeof===yB||n.$$typeof===mB)},typeOf:Ou},$r=zP((function(n,e){})),QS=($r.AsyncMode,$r.ConcurrentMode,$r.ContextConsumer,$r.ContextProvider,$r.Element,$r.ForwardRef,$r.Fragment,$r.Lazy,$r.Memo,$r.Portal,$r.Profiler,$r.StrictMode,$r.Suspense,$r.isAsyncMode,$r.isConcurrentMode,$r.isContextConsumer,$r.isContextProvider,$r.isElement,$r.isForwardRef,$r.isFragment,$r.isLazy,$r.isMemo,$r.isPortal,$r.isProfiler,$r.isStrictMode,$r.isSuspense,$r.isValidElementType,$r.typeOf,zP((function(n){n.exports=vB}))),bB={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},JS={};JS[QS.ForwardRef]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},JS[QS.Memo]=bB;const eE=()=>{const[n,e]=wt.useState(1),[t,a]=wt.useState({userID:"",campus:"",location:"",specificLocation:"",offenseTypes:[],time:"",additionalInfo:""}),[d,m]=wt.useState(!1),[g,c]=wt.useState(""),[C,R]=wt.useState([]),[V,q]=wt.useState(""),[J,Y]=wt.useState(""),[xe,be]=wt.useState([]),Oe=wt.useRef(null),{executeRecaptcha:et}=fB(),Je=4;var[qe,Ze]=wt.useState(Object.values(WS["Notre-Dame"]));const je=Tt=>{const{name:zt,value:Bt}=Tt.target;if(console.log("Input Change ",zt,Bt),zt==="campus")(Bt=="Notre-Dame"||Bt=="Saint-Marys"||Bt=="Holy-Cross")&&Ze(WS[Bt]),a(Le=>({...Le,campus:Bt,location:"",specificLocation:""})),be([]);else if(zt==="location"){const Le=qe[Bt];be(Le.map(vt=>vt.name)),a(vt=>({...vt,[zt]:Bt,specificLocation:""}))}else a(Le=>({...Le,[zt]:Bt}))},Be=Tt=>{const{value:zt}=Tt.target;a(Bt=>({...Bt,offenseTypes:[zt]}))},de=()=>{if(n===1){if(!t.location)return alert("Please select where you felt unsafe."),!1}else if(n===2){if(t.offenseTypes.length===0)return alert("Please select at least one type of offense."),!1}else if(n===3&&!t.time)return alert("Please select when this occurred."),!1;return!0},ce=Tt=>{if(Tt>0&&!de())return;const zt=n+Tt;zt>=1&&zt<=Je&&e(zt)},_e=async Tt=>{Tt.preventDefault(),de()&&(m(!0),setTimeout(async()=>{const zt=await $t();if(zt==="Error"){alert("There was an error submitting your report. Please try again later.");return}c(zt),e(5),m(!1)},2e3))},Ae=Tt=>Tt.replace(/-/g," ").replace(/\b\w/g,zt=>zt.toUpperCase()),Me=Tt=>Tt.replace(/-/g," ").replace(/\b\w/g,zt=>zt.toUpperCase()),Ge=Tt=>{const zt=Tt.replace(/[^a-zA-Z0-9]/g,"");if(!zt||!xe||xe.length===0)return[];const Bt=zt.toLowerCase();return xe.filter(vt=>vt.toLowerCase().replace(/[^a-z0-9]/g,"").includes(Bt.replace(/[^a-z0-9]/g,"")))},Re={"uncomfortable-situation":"Uncomfortable Situation","sexual-misconduct":"Sexual Misconduct","physical-aggression":"Physical Aggression","verbal-aggression":"Verbal Aggression",discrimination:"Discrimination"},Pn=()=>Ee.jsxs("div",{id:"report-summary",style:{background:"rgba(216, 47, 37, 0.05)",padding:"1.5rem",borderRadius:"10px",marginBottom:"2rem"},children:[Ee.jsxs("div",{style:{marginBottom:"1rem"},children:[Ee.jsx("strong",{children:"Campus:"})," ",Ae(t.campus),t.campus&&` (${t.campus})`]}),Ee.jsxs("div",{style:{marginBottom:"1rem"},children:[Ee.jsx("strong",{children:"Location:"})," ",Ae(t.location),t.specificLocation&&` (${t.specificLocation})`]}),Ee.jsxs("div",{style:{marginBottom:"1rem"},children:[Ee.jsx("strong",{children:"Incident Types:"})," ",t.offenseTypes.map(Tt=>Re[Tt]).join(", ")]}),Ee.jsxs("div",{style:{marginBottom:"1rem"},children:[Ee.jsx("strong",{children:"When:"})," ",Me(t.time)]}),t.additionalInfo.trim()&&Ee.jsxs("div",{children:[Ee.jsx("strong",{children:"Additional Information:"})," ",t.additionalInfo.substring(0,200),t.additionalInfo.length>200?"...":""]})]}),ei=Tt=>{je(Tt);const zt=Tt.target.value.trim();Y(zt);const Bt=Ge(zt);if(R(Bt),Bt.length>0){const Le=Bt[0].trim(),vt=zt.toLowerCase();Le.toLowerCase().startsWith(vt)&&vt.length>0?(console.log(zt+Le.substring(zt.length)),q(Le.substring(zt.length))):q("")}else q("")},mt=Tt=>{if((Tt.key==="Enter"||Tt.key==="Tab")&&V){Tt.preventDefault();const zt=t.specificLocation+V;console.log(zt),je({target:{name:"specificLocation",value:zt}}),q(""),R([])}};async function $t(){if(!et)return console.warn("reCAPTCHA execution not ready yet."),"Error";try{const Tt=await et("submit_report"),zt=await Q3(fI(DP,"reports"),{...t,recaptchaToken:Tt,action:"submit_report",Time:gS(),createdAt:gS()});return console.log("Document written with ID: ",zt.id),zt.id}catch(Tt){return console.error("Error submitting report:",Tt),"Error"}}return Ee.jsxs(Ee.Fragment,{children:[Ee.jsx(MA,{}),Ee.jsx("div",{children:Ee.jsxs("div",{className:"report-container",children:[Ee.jsxs("div",{className:"report-header",children:[Ee.jsxs("h1",{children:["Anonymous ",Ee.jsx("span",{className:"highlight",children:"Report"})]}),Ee.jsx("p",{children:"What you went through is not acceptable. Help us make campus safer by sharing as much information you feel comfortable sharing. After, We will show you the different paths you can take based on your current comfort level."})]}),Ee.jsxs("div",{className:"security-notice",children:[Ee.jsx("h3",{children:"Your Privacy is Protected"}),Ee.jsxs("p",{children:["No identifying information is collected or stored. All fields are optional, the more information you provide the better we can assist you. No names will be requested from any party, and we cannot provide legal action."," ",Ee.jsx("b",{children:"If you feel ready to pursue legal action, please contact campus security or local authorities."})]})]}),Ee.jsxs("div",{className:"report-form",children:[Ee.jsxs("div",{className:"form-progress",children:[Ee.jsxs("div",{className:`progress-step ${n===1?"active":""}`,children:[Ee.jsx("div",{className:"step-circle",children:"1"}),Ee.jsx("span",{children:"Location"})]}),Ee.jsxs("div",{className:`progress-step ${n===2?"active":""}`,children:[Ee.jsx("div",{className:"step-circle",children:"2"}),Ee.jsx("span",{children:"Incident"})]}),Ee.jsxs("div",{className:`progress-step ${n===3?"active":""}`,children:[Ee.jsx("div",{className:"step-circle",children:"3"}),Ee.jsx("span",{children:"Details"})]}),Ee.jsxs("div",{className:`progress-step ${n===4?"active":""}`,children:[Ee.jsx("div",{className:"step-circle",children:"4"}),Ee.jsx("span",{children:"Submit"})]})]}),Ee.jsxs("form",{onSubmit:_e,children:[Ee.jsxs("div",{className:`form-section ${n===1?"active":""}`,children:[Ee.jsxs("div",{className:"form-group",children:[Ee.jsx("label",{htmlFor:"campus",children:"Where did you feel unsafe? *"}),Ee.jsx("div",{className:"label-description",children:"Select the campus where the incident occurred"}),Ee.jsxs("select",{id:"campus",name:"campus",value:t.campus,onChange:je,required:!0,children:[Ee.jsx("option",{value:"",children:"Choose a campus"}),Ee.jsx("option",{value:"Notre-Dame",children:"Notre Dame"}),Ee.jsx("option",{value:"Saint-Marys",children:"Saint Mary's College"}),Ee.jsx("option",{value:"Holy-Cross",children:"Holy Cross College"})]})]}),Ee.jsxs("div",{className:"form-group",children:[Ee.jsx("label",{htmlFor:"location",children:"Where did you feel unsafe? *"}),Ee.jsx("div",{className:"label-description",children:"What type of building was it?"}),Ee.jsxs("select",{id:"location",name:"location",value:t.location,onChange:je,required:!0,children:[Ee.jsx("option",{value:"",children:"Choose a location"}),Object.keys(qe).map(Tt=>Ee.jsx("option",{value:Tt,children:Tt.replace(/-/g," ").replace(/\b\w/g,zt=>zt.toUpperCase())},Tt))]})]}),Ee.jsxs("div",{className:"form-group",children:[Ee.jsx("label",{htmlFor:"specificLocation",children:"Specific Location (Optional)"}),Ee.jsx("div",{className:"label-description",children:"How is the building called?"}),Ee.jsxs("div",{style:{position:"relative",display:"inline-block"},children:[Ee.jsx("input",{className:"form-select",ref:Oe,type:"text",id:"specificLocation",name:"specificLocation",value:t.specificLocation,onChange:ei,onKeyDown:mt,placeholder:"e.g., Main Library, 2nd floor",autoComplete:"off"}),Ee.jsx("span",{style:{position:"absolute",left:`${J.length*10+18}px `,top:"50%",transform:"translateY(-50%)",opacity:.5,pointerEvents:"none",userSelect:"none",color:"#666"},children:V})]})]})]}),Ee.jsx("div",{className:`form-section ${n===2?"active":""}`,children:Ee.jsxs("div",{className:"form-group",children:[Ee.jsx("label",{children:"What type of offense would you group it as? *"}),Ee.jsx("div",{className:"label-description",children:"Select all that apply to your experience"}),Ee.jsxs("div",{className:"radio-group",children:[Ee.jsxs("label",{className:"radio-item",children:[Ee.jsx("input",{type:"radio",name:"offense-type",value:"uncomfortable-situation",checked:t.offenseTypes.includes("uncomfortable-situation"),onChange:Be}),Ee.jsxs("div",{className:"radio-content",children:[Ee.jsx("strong",{children:"Uncomfortable Situation"}),Ee.jsx("small",{children:"Situations that made you feel uneasy or uncomfortable"})]})]}),Ee.jsxs("label",{className:"radio-item",children:[Ee.jsx("input",{type:"radio",name:"offense-type",value:"sexual-misconduct",checked:t.offenseTypes.includes("sexual-misconduct"),onChange:Be}),Ee.jsxs("div",{className:"radio-content",children:[Ee.jsx("strong",{children:"Sexual Misconduct"}),Ee.jsx("small",{children:"Physical contact without permission"})]})]}),Ee.jsxs("label",{className:"radio-item",children:[Ee.jsx("input",{type:"radio",name:"offense-type",value:"physical-aggression",checked:t.offenseTypes.includes("physical-aggression"),onChange:Be}),Ee.jsxs("div",{className:"radio-content",children:[Ee.jsx("strong",{children:"Physical Aggression"}),Ee.jsx("small",{children:"Physical violence or threat of violence"})]})]}),Ee.jsxs("label",{className:"radio-item",children:[Ee.jsx("input",{type:"radio",name:"offense-type",value:"verbal-aggression",checked:t.offenseTypes.includes("verbal-aggression"),onChange:Be}),Ee.jsxs("div",{className:"radio-content",children:[Ee.jsx("strong",{children:"Verbal Aggression"}),Ee.jsx("small",{children:"Threatening, hostile, or abusive language"})]})]}),Ee.jsxs("label",{className:"radio-item",children:[Ee.jsx("input",{type:"radio",name:"offense-type",value:"discrimination",checked:t.offenseTypes.includes("discrimination"),onChange:Be}),Ee.jsxs("div",{className:"radio-content",children:[Ee.jsx("strong",{children:"Discrimination"}),Ee.jsx("small",{children:"Treatment based on identity, race, gender, religion, etc."})]})]})]})]})}),Ee.jsxs("div",{className:`form-section ${n===3?"active":""}`,children:[Ee.jsxs("div",{className:"form-group",children:[Ee.jsx("label",{htmlFor:"time",children:"When did this occur? *"}),Ee.jsxs("select",{id:"time",name:"time",value:t.time,onChange:je,required:!0,children:[Ee.jsx("option",{value:"",children:"Select timeframe"}),Ee.jsx("option",{value:"within-24-hours",children:"Within the last 24 hours"}),Ee.jsx("option",{value:"within-week",children:"Within the last week"}),Ee.jsx("option",{value:"within-month",children:"Within the last month"}),Ee.jsx("option",{value:"longer-ago",children:"Longer ago"})]})]}),Ee.jsxs("div",{className:"form-group",children:[Ee.jsx("label",{htmlFor:"additionalInfo",children:"Additional Information (Optional)"}),Ee.jsx("div",{className:"label-description",children:"Anything else you'd like to share"}),Ee.jsx("textarea",{id:"additionalInfo",name:"additionalInfo",value:t.additionalInfo,onChange:je,placeholder:"Any additional context, concerns, or information you'd like to provide"})]})]}),Ee.jsx("div",{className:`form-section ${n===4?"active":""}`,children:Ee.jsxs("div",{id:"review-content",children:[Ee.jsx("h3",{style:{color:"#113052",marginBottom:"1rem"},children:"Review Your Report"}),Ee.jsx("p",{style:{marginBottom:"2rem",opacity:.8},children:"Please review the information below before submitting your anonymous report."}),Pn(),Ee.jsxs("div",{className:"security-notice",style:{marginBottom:0},children:[Ee.jsx("h3",{children:"Final Privacy Reminder"}),Ee.jsx("p",{children:"Once submitted, this report cannot be traced back to you. Your anonymity is guaranteed."})]})]})}),n===5&&Ee.jsxs("div",{className:"success-message",children:[Ee.jsx("div",{className:"success-icon",children:""}),Ee.jsx("h2",{children:"Report Submitted Successfully"}),Ee.jsx("p",{children:"Thank you for sharing your experience. Your voice contributes to making our campus community safer for everyone."}),Ee.jsxs("p",{children:[Ee.jsx("strong",{children:"Report ID:"})," ",g]}),Ee.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>window.close(),children:"Return to Home"})]}),n<5&&Ee.jsxs("div",{className:"form-navigation",children:[Ee.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>ce(-1),style:{display:n>1?"block":"none"},children:"Previous"}),n<4&&Ee.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>ce(1),children:"Next"}),n===4&&Ee.jsxs("button",{type:"submit",className:"btn btn-primary g-recaptcha",disabled:d,"data-sitekey":"6LeMDQssAAAAAC3prYanNGr6ItRklzJicu190qUc","data-callback":"onSubmit","data-action":"submit",children:[!d&&Ee.jsx("span",{children:"Submit Anonymous Report"}),d&&Ee.jsxs("span",{children:[Ee.jsx("span",{className:"loading"}),"Submitting..."]})]})]})]})]})]})})]})};var H_={exports:{}};/* @preserve
 * Leaflet 1.9.4, a JS library for interactive maps. https://leafletjs.com
 * (c) 2010-2023 Vladimir Agafonkin, (c) 2010-2011 CloudMade
 */var xB=H_.exports,tE;function wB(){return tE||(tE=1,(function(n,e){(function(t,a){a(e)})(xB,(function(t){var a="1.9.4";function d(f){var x,k,U,X;for(k=1,U=arguments.length;k<U;k++){X=arguments[k];for(x in X)f[x]=X[x]}return f}var m=Object.create||(function(){function f(){}return function(x){return f.prototype=x,new f}})();function g(f,x){var k=Array.prototype.slice;if(f.bind)return f.bind.apply(f,k.call(arguments,1));var U=k.call(arguments,2);return function(){return f.apply(x,U.length?U.concat(k.call(arguments)):arguments)}}var c=0;function C(f){return"_leaflet_id"in f||(f._leaflet_id=++c),f._leaflet_id}function R(f,x,k){var U,X,ue,Ne;return Ne=function(){U=!1,X&&(ue.apply(k,X),X=!1)},ue=function(){U?X=arguments:(f.apply(k,arguments),setTimeout(Ne,x),U=!0)},ue}function V(f,x,k){var U=x[1],X=x[0],ue=U-X;return f===U&&k?f:((f-X)%ue+ue)%ue+X}function q(){return!1}function J(f,x){if(x===!1)return f;var k=Math.pow(10,x===void 0?6:x);return Math.round(f*k)/k}function Y(f){return f.trim?f.trim():f.replace(/^\s+|\s+$/g,"")}function xe(f){return Y(f).split(/\s+/)}function be(f,x){Object.prototype.hasOwnProperty.call(f,"options")||(f.options=f.options?m(f.options):{});for(var k in x)f.options[k]=x[k];return f.options}function Oe(f,x,k){var U=[];for(var X in f)U.push(encodeURIComponent(k?X.toUpperCase():X)+"="+encodeURIComponent(f[X]));return(!x||x.indexOf("?")===-1?"?":"&")+U.join("&")}var et=/\{ *([\w_ -]+) *\}/g;function Je(f,x){return f.replace(et,function(k,U){var X=x[U];if(X===void 0)throw new Error("No value provided for variable "+k);return typeof X=="function"&&(X=X(x)),X})}var qe=Array.isArray||function(f){return Object.prototype.toString.call(f)==="[object Array]"};function Ze(f,x){for(var k=0;k<f.length;k++)if(f[k]===x)return k;return-1}var je="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function Be(f){return window["webkit"+f]||window["moz"+f]||window["ms"+f]}var de=0;function ce(f){var x=+new Date,k=Math.max(0,16-(x-de));return de=x+k,window.setTimeout(f,k)}var _e=window.requestAnimationFrame||Be("RequestAnimationFrame")||ce,Ae=window.cancelAnimationFrame||Be("CancelAnimationFrame")||Be("CancelRequestAnimationFrame")||function(f){window.clearTimeout(f)};function Me(f,x,k){if(k&&_e===ce)f.call(x);else return _e.call(window,g(f,x))}function Ge(f){f&&Ae.call(window,f)}var Re={__proto__:null,extend:d,create:m,bind:g,get lastId(){return c},stamp:C,throttle:R,wrapNum:V,falseFn:q,formatNum:J,trim:Y,splitWords:xe,setOptions:be,getParamString:Oe,template:Je,isArray:qe,indexOf:Ze,emptyImageUrl:je,requestFn:_e,cancelFn:Ae,requestAnimFrame:Me,cancelAnimFrame:Ge};function Pn(){}Pn.extend=function(f){var x=function(){be(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},k=x.__super__=this.prototype,U=m(k);U.constructor=x,x.prototype=U;for(var X in this)Object.prototype.hasOwnProperty.call(this,X)&&X!=="prototype"&&X!=="__super__"&&(x[X]=this[X]);return f.statics&&d(x,f.statics),f.includes&&(ei(f.includes),d.apply(null,[U].concat(f.includes))),d(U,f),delete U.statics,delete U.includes,U.options&&(U.options=k.options?m(k.options):{},d(U.options,f.options)),U._initHooks=[],U.callInitHooks=function(){if(!this._initHooksCalled){k.callInitHooks&&k.callInitHooks.call(this),this._initHooksCalled=!0;for(var ue=0,Ne=U._initHooks.length;ue<Ne;ue++)U._initHooks[ue].call(this)}},x},Pn.include=function(f){var x=this.prototype.options;return d(this.prototype,f),f.options&&(this.prototype.options=x,this.mergeOptions(f.options)),this},Pn.mergeOptions=function(f){return d(this.prototype.options,f),this},Pn.addInitHook=function(f){var x=Array.prototype.slice.call(arguments,1),k=typeof f=="function"?f:function(){this[f].apply(this,x)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(k),this};function ei(f){if(!(typeof L>"u"||!L||!L.Mixin)){f=qe(f)?f:[f];for(var x=0;x<f.length;x++)f[x]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",new Error().stack)}}var mt={on:function(f,x,k){if(typeof f=="object")for(var U in f)this._on(U,f[U],x);else{f=xe(f);for(var X=0,ue=f.length;X<ue;X++)this._on(f[X],x,k)}return this},off:function(f,x,k){if(!arguments.length)delete this._events;else if(typeof f=="object")for(var U in f)this._off(U,f[U],x);else{f=xe(f);for(var X=arguments.length===1,ue=0,Ne=f.length;ue<Ne;ue++)X?this._off(f[ue]):this._off(f[ue],x,k)}return this},_on:function(f,x,k,U){if(typeof x!="function"){console.warn("wrong listener type: "+typeof x);return}if(this._listens(f,x,k)===!1){k===this&&(k=void 0);var X={fn:x,ctx:k};U&&(X.once=!0),this._events=this._events||{},this._events[f]=this._events[f]||[],this._events[f].push(X)}},_off:function(f,x,k){var U,X,ue;if(this._events&&(U=this._events[f],!!U)){if(arguments.length===1){if(this._firingCount)for(X=0,ue=U.length;X<ue;X++)U[X].fn=q;delete this._events[f];return}if(typeof x!="function"){console.warn("wrong listener type: "+typeof x);return}var Ne=this._listens(f,x,k);if(Ne!==!1){var nt=U[Ne];this._firingCount&&(nt.fn=q,this._events[f]=U=U.slice()),U.splice(Ne,1)}}},fire:function(f,x,k){if(!this.listens(f,k))return this;var U=d({},x,{type:f,target:this,sourceTarget:x&&x.sourceTarget||this});if(this._events){var X=this._events[f];if(X){this._firingCount=this._firingCount+1||1;for(var ue=0,Ne=X.length;ue<Ne;ue++){var nt=X[ue],ut=nt.fn;nt.once&&this.off(f,ut,nt.ctx),ut.call(nt.ctx||this,U)}this._firingCount--}}return k&&this._propagateEvent(U),this},listens:function(f,x,k,U){typeof f!="string"&&console.warn('"string" type argument expected');var X=x;typeof x!="function"&&(U=!!x,X=void 0,k=void 0);var ue=this._events&&this._events[f];if(ue&&ue.length&&this._listens(f,X,k)!==!1)return!0;if(U){for(var Ne in this._eventParents)if(this._eventParents[Ne].listens(f,x,k,U))return!0}return!1},_listens:function(f,x,k){if(!this._events)return!1;var U=this._events[f]||[];if(!x)return!!U.length;k===this&&(k=void 0);for(var X=0,ue=U.length;X<ue;X++)if(U[X].fn===x&&U[X].ctx===k)return X;return!1},once:function(f,x,k){if(typeof f=="object")for(var U in f)this._on(U,f[U],x,!0);else{f=xe(f);for(var X=0,ue=f.length;X<ue;X++)this._on(f[X],x,k,!0)}return this},addEventParent:function(f){return this._eventParents=this._eventParents||{},this._eventParents[C(f)]=f,this},removeEventParent:function(f){return this._eventParents&&delete this._eventParents[C(f)],this},_propagateEvent:function(f){for(var x in this._eventParents)this._eventParents[x].fire(f.type,d({layer:f.target,propagatedFrom:f.target},f),!0)}};mt.addEventListener=mt.on,mt.removeEventListener=mt.clearAllEventListeners=mt.off,mt.addOneTimeEventListener=mt.once,mt.fireEvent=mt.fire,mt.hasEventListeners=mt.listens;var $t=Pn.extend(mt);function Tt(f,x,k){this.x=k?Math.round(f):f,this.y=k?Math.round(x):x}var zt=Math.trunc||function(f){return f>0?Math.floor(f):Math.ceil(f)};Tt.prototype={clone:function(){return new Tt(this.x,this.y)},add:function(f){return this.clone()._add(Bt(f))},_add:function(f){return this.x+=f.x,this.y+=f.y,this},subtract:function(f){return this.clone()._subtract(Bt(f))},_subtract:function(f){return this.x-=f.x,this.y-=f.y,this},divideBy:function(f){return this.clone()._divideBy(f)},_divideBy:function(f){return this.x/=f,this.y/=f,this},multiplyBy:function(f){return this.clone()._multiplyBy(f)},_multiplyBy:function(f){return this.x*=f,this.y*=f,this},scaleBy:function(f){return new Tt(this.x*f.x,this.y*f.y)},unscaleBy:function(f){return new Tt(this.x/f.x,this.y/f.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=zt(this.x),this.y=zt(this.y),this},distanceTo:function(f){f=Bt(f);var x=f.x-this.x,k=f.y-this.y;return Math.sqrt(x*x+k*k)},equals:function(f){return f=Bt(f),f.x===this.x&&f.y===this.y},contains:function(f){return f=Bt(f),Math.abs(f.x)<=Math.abs(this.x)&&Math.abs(f.y)<=Math.abs(this.y)},toString:function(){return"Point("+J(this.x)+", "+J(this.y)+")"}};function Bt(f,x,k){return f instanceof Tt?f:qe(f)?new Tt(f[0],f[1]):f==null?f:typeof f=="object"&&"x"in f&&"y"in f?new Tt(f.x,f.y):new Tt(f,x,k)}function Le(f,x){if(f)for(var k=x?[f,x]:f,U=0,X=k.length;U<X;U++)this.extend(k[U])}Le.prototype={extend:function(f){var x,k;if(!f)return this;if(f instanceof Tt||typeof f[0]=="number"||"x"in f)x=k=Bt(f);else if(f=vt(f),x=f.min,k=f.max,!x||!k)return this;return!this.min&&!this.max?(this.min=x.clone(),this.max=k.clone()):(this.min.x=Math.min(x.x,this.min.x),this.max.x=Math.max(k.x,this.max.x),this.min.y=Math.min(x.y,this.min.y),this.max.y=Math.max(k.y,this.max.y)),this},getCenter:function(f){return Bt((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,f)},getBottomLeft:function(){return Bt(this.min.x,this.max.y)},getTopRight:function(){return Bt(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(f){var x,k;return typeof f[0]=="number"||f instanceof Tt?f=Bt(f):f=vt(f),f instanceof Le?(x=f.min,k=f.max):x=k=f,x.x>=this.min.x&&k.x<=this.max.x&&x.y>=this.min.y&&k.y<=this.max.y},intersects:function(f){f=vt(f);var x=this.min,k=this.max,U=f.min,X=f.max,ue=X.x>=x.x&&U.x<=k.x,Ne=X.y>=x.y&&U.y<=k.y;return ue&&Ne},overlaps:function(f){f=vt(f);var x=this.min,k=this.max,U=f.min,X=f.max,ue=X.x>x.x&&U.x<k.x,Ne=X.y>x.y&&U.y<k.y;return ue&&Ne},isValid:function(){return!!(this.min&&this.max)},pad:function(f){var x=this.min,k=this.max,U=Math.abs(x.x-k.x)*f,X=Math.abs(x.y-k.y)*f;return vt(Bt(x.x-U,x.y-X),Bt(k.x+U,k.y+X))},equals:function(f){return f?(f=vt(f),this.min.equals(f.getTopLeft())&&this.max.equals(f.getBottomRight())):!1}};function vt(f,x){return!f||f instanceof Le?f:new Le(f,x)}function Ot(f,x){if(f)for(var k=x?[f,x]:f,U=0,X=k.length;U<X;U++)this.extend(k[U])}Ot.prototype={extend:function(f){var x=this._southWest,k=this._northEast,U,X;if(f instanceof Jt)U=f,X=f;else if(f instanceof Ot){if(U=f._southWest,X=f._northEast,!U||!X)return this}else return f?this.extend(Wt(f)||Ut(f)):this;return!x&&!k?(this._southWest=new Jt(U.lat,U.lng),this._northEast=new Jt(X.lat,X.lng)):(x.lat=Math.min(U.lat,x.lat),x.lng=Math.min(U.lng,x.lng),k.lat=Math.max(X.lat,k.lat),k.lng=Math.max(X.lng,k.lng)),this},pad:function(f){var x=this._southWest,k=this._northEast,U=Math.abs(x.lat-k.lat)*f,X=Math.abs(x.lng-k.lng)*f;return new Ot(new Jt(x.lat-U,x.lng-X),new Jt(k.lat+U,k.lng+X))},getCenter:function(){return new Jt((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new Jt(this.getNorth(),this.getWest())},getSouthEast:function(){return new Jt(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(f){typeof f[0]=="number"||f instanceof Jt||"lat"in f?f=Wt(f):f=Ut(f);var x=this._southWest,k=this._northEast,U,X;return f instanceof Ot?(U=f.getSouthWest(),X=f.getNorthEast()):U=X=f,U.lat>=x.lat&&X.lat<=k.lat&&U.lng>=x.lng&&X.lng<=k.lng},intersects:function(f){f=Ut(f);var x=this._southWest,k=this._northEast,U=f.getSouthWest(),X=f.getNorthEast(),ue=X.lat>=x.lat&&U.lat<=k.lat,Ne=X.lng>=x.lng&&U.lng<=k.lng;return ue&&Ne},overlaps:function(f){f=Ut(f);var x=this._southWest,k=this._northEast,U=f.getSouthWest(),X=f.getNorthEast(),ue=X.lat>x.lat&&U.lat<k.lat,Ne=X.lng>x.lng&&U.lng<k.lng;return ue&&Ne},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(f,x){return f?(f=Ut(f),this._southWest.equals(f.getSouthWest(),x)&&this._northEast.equals(f.getNorthEast(),x)):!1},isValid:function(){return!!(this._southWest&&this._northEast)}};function Ut(f,x){return f instanceof Ot?f:new Ot(f,x)}function Jt(f,x,k){if(isNaN(f)||isNaN(x))throw new Error("Invalid LatLng object: ("+f+", "+x+")");this.lat=+f,this.lng=+x,k!==void 0&&(this.alt=+k)}Jt.prototype={equals:function(f,x){if(!f)return!1;f=Wt(f);var k=Math.max(Math.abs(this.lat-f.lat),Math.abs(this.lng-f.lng));return k<=(x===void 0?1e-9:x)},toString:function(f){return"LatLng("+J(this.lat,f)+", "+J(this.lng,f)+")"},distanceTo:function(f){return oi.distance(this,Wt(f))},wrap:function(){return oi.wrapLatLng(this)},toBounds:function(f){var x=180*f/40075017,k=x/Math.cos(Math.PI/180*this.lat);return Ut([this.lat-x,this.lng-k],[this.lat+x,this.lng+k])},clone:function(){return new Jt(this.lat,this.lng,this.alt)}};function Wt(f,x,k){return f instanceof Jt?f:qe(f)&&typeof f[0]!="object"?f.length===3?new Jt(f[0],f[1],f[2]):f.length===2?new Jt(f[0],f[1]):null:f==null?f:typeof f=="object"&&"lat"in f?new Jt(f.lat,"lng"in f?f.lng:f.lon,f.alt):x===void 0?null:new Jt(f,x,k)}var Fn={latLngToPoint:function(f,x){var k=this.projection.project(f),U=this.scale(x);return this.transformation._transform(k,U)},pointToLatLng:function(f,x){var k=this.scale(x),U=this.transformation.untransform(f,k);return this.projection.unproject(U)},project:function(f){return this.projection.project(f)},unproject:function(f){return this.projection.unproject(f)},scale:function(f){return 256*Math.pow(2,f)},zoom:function(f){return Math.log(f/256)/Math.LN2},getProjectedBounds:function(f){if(this.infinite)return null;var x=this.projection.bounds,k=this.scale(f),U=this.transformation.transform(x.min,k),X=this.transformation.transform(x.max,k);return new Le(U,X)},infinite:!1,wrapLatLng:function(f){var x=this.wrapLng?V(f.lng,this.wrapLng,!0):f.lng,k=this.wrapLat?V(f.lat,this.wrapLat,!0):f.lat,U=f.alt;return new Jt(k,x,U)},wrapLatLngBounds:function(f){var x=f.getCenter(),k=this.wrapLatLng(x),U=x.lat-k.lat,X=x.lng-k.lng;if(U===0&&X===0)return f;var ue=f.getSouthWest(),Ne=f.getNorthEast(),nt=new Jt(ue.lat-U,ue.lng-X),ut=new Jt(Ne.lat-U,Ne.lng-X);return new Ot(nt,ut)}},oi=d({},Fn,{wrapLng:[-180,180],R:6371e3,distance:function(f,x){var k=Math.PI/180,U=f.lat*k,X=x.lat*k,ue=Math.sin((x.lat-f.lat)*k/2),Ne=Math.sin((x.lng-f.lng)*k/2),nt=ue*ue+Math.cos(U)*Math.cos(X)*Ne*Ne,ut=2*Math.atan2(Math.sqrt(nt),Math.sqrt(1-nt));return this.R*ut}}),fi=6378137,fs={R:fi,MAX_LATITUDE:85.0511287798,project:function(f){var x=Math.PI/180,k=this.MAX_LATITUDE,U=Math.max(Math.min(k,f.lat),-k),X=Math.sin(U*x);return new Tt(this.R*f.lng*x,this.R*Math.log((1+X)/(1-X))/2)},unproject:function(f){var x=180/Math.PI;return new Jt((2*Math.atan(Math.exp(f.y/this.R))-Math.PI/2)*x,f.x*x/this.R)},bounds:(function(){var f=fi*Math.PI;return new Le([-f,-f],[f,f])})()};function Bs(f,x,k,U){if(qe(f)){this._a=f[0],this._b=f[1],this._c=f[2],this._d=f[3];return}this._a=f,this._b=x,this._c=k,this._d=U}Bs.prototype={transform:function(f,x){return this._transform(f.clone(),x)},_transform:function(f,x){return x=x||1,f.x=x*(this._a*f.x+this._b),f.y=x*(this._c*f.y+this._d),f},untransform:function(f,x){return x=x||1,new Tt((f.x/x-this._b)/this._a,(f.y/x-this._d)/this._c)}};function Dr(f,x,k,U){return new Bs(f,x,k,U)}var Fi=d({},oi,{code:"EPSG:3857",projection:fs,transformation:(function(){var f=.5/(Math.PI*fs.R);return Dr(f,.5,-f,.5)})()}),Mi=d({},Fi,{code:"EPSG:900913"});function Ua(f){return document.createElementNS("http://www.w3.org/2000/svg",f)}function Sa(f,x){var k="",U,X,ue,Ne,nt,ut;for(U=0,ue=f.length;U<ue;U++){for(nt=f[U],X=0,Ne=nt.length;X<Ne;X++)ut=nt[X],k+=(X?"L":"M")+ut.x+" "+ut.y;k+=x?en.svg?"z":"x":""}return k||"M0 0"}var Fs=document.documentElement.style,Ea="ActiveXObject"in window,Vi=Ea&&!document.addEventListener,pr="msLaunchUri"in navigator&&!("documentMode"in document),Aa=Mt("webkit"),Eo=Mt("android"),oo=Mt("android 2")||Mt("android 3"),qr=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),ps=Eo&&Mt("Google")&&qr<537&&!("AudioNode"in window),ms=!!window.opera,Vs=!pr&&Mt("chrome"),gs=Mt("gecko")&&!Aa&&!ms&&!Ea,Xe=!Vs&&Mt("safari"),se=Mt("phantom"),le="OTransition"in Fs,fe=navigator.platform.indexOf("Win")===0,Se=Ea&&"transition"in Fs,De="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!oo,He="MozPerspective"in Fs,tt=!window.L_DISABLE_3D&&(Se||De||He)&&!le&&!se,We=typeof orientation<"u"||Mt("mobile"),_t=We&&Aa,Pt=We&&De,xt=!window.PointerEvent&&window.MSPointerEvent,tn=!!(window.PointerEvent||xt),$e="ontouchstart"in window||!!window.TouchEvent,vn=!window.L_NO_TOUCH&&($e||tn),Rn=We&&ms,nn=We&&gs,Nn=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,Ri=(function(){var f=!1;try{var x=Object.defineProperty({},"passive",{get:function(){f=!0}});window.addEventListener("testPassiveEventSupport",q,x),window.removeEventListener("testPassiveEventSupport",q,x)}catch{}return f})(),Gi=(function(){return!!document.createElement("canvas").getContext})(),tr=!!(document.createElementNS&&Ua("svg").createSVGRect),Ir=!!tr&&(function(){var f=document.createElement("div");return f.innerHTML="<svg/>",(f.firstChild&&f.firstChild.namespaceURI)==="http://www.w3.org/2000/svg"})(),Vn=!tr&&(function(){try{var f=document.createElement("div");f.innerHTML='<v:shape adj="1"/>';var x=f.firstChild;return x.style.behavior="url(#default#VML)",x&&typeof x.adj=="object"}catch{return!1}})(),Xn=navigator.platform.indexOf("Mac")===0,br=navigator.platform.indexOf("Linux")===0;function Mt(f){return navigator.userAgent.toLowerCase().indexOf(f)>=0}var en={ie:Ea,ielt9:Vi,edge:pr,webkit:Aa,android:Eo,android23:oo,androidStock:ps,opera:ms,chrome:Vs,gecko:gs,safari:Xe,phantom:se,opera12:le,win:fe,ie3d:Se,webkit3d:De,gecko3d:He,any3d:tt,mobile:We,mobileWebkit:_t,mobileWebkit3d:Pt,msPointer:xt,pointer:tn,touch:vn,touchNative:$e,mobileOpera:Rn,mobileGecko:nn,retina:Nn,passiveEvents:Ri,canvas:Gi,svg:tr,vml:Vn,inlineSvg:Ir,mac:Xn,linux:br},nr=en.msPointer?"MSPointerDown":"pointerdown",na=en.msPointer?"MSPointerMove":"pointermove",Ca=en.msPointer?"MSPointerUp":"pointerup",kt=en.msPointer?"MSPointerCancel":"pointercancel",yn={touchstart:nr,touchmove:na,touchend:Ca,touchcancel:kt},In={touchstart:Ei,touchmove:Hr,touchend:Hr,touchcancel:Hr},ir={},rl=!1;function Ao(f,x,k){return x==="touchstart"&&Gr(),In[x]?(k=In[x].bind(this,k),f.addEventListener(yn[x],k,!1),k):(console.warn("wrong event specified:",x),q)}function Bn(f,x,k){if(!yn[x]){console.warn("wrong event specified:",x);return}f.removeEventListener(yn[x],k,!1)}function Us(f){ir[f.pointerId]=f}function js(f){ir[f.pointerId]&&(ir[f.pointerId]=f)}function _s(f){delete ir[f.pointerId]}function Gr(){rl||(document.addEventListener(nr,Us,!0),document.addEventListener(na,js,!0),document.addEventListener(Ca,_s,!0),document.addEventListener(kt,_s,!0),rl=!0)}function Hr(f,x){if(x.pointerType!==(x.MSPOINTER_TYPE_MOUSE||"mouse")){x.touches=[];for(var k in ir)x.touches.push(ir[k]);x.changedTouches=[x],f(x)}}function Ei(f,x){x.MSPOINTER_TYPE_TOUCH&&x.pointerType===x.MSPOINTER_TYPE_TOUCH&&sn(x),Hr(f,x)}function Pr(f){var x={},k,U;for(U in f)k=f[U],x[U]=k&&k.bind?k.bind(f):k;return f=x,x.type="dblclick",x.detail=2,x.isTrusted=!1,x._simulated=!0,x}var fa=200;function wi(f,x){f.addEventListener("dblclick",x);var k=0,U;function X(ue){if(ue.detail!==1){U=ue.detail;return}if(!(ue.pointerType==="mouse"||ue.sourceCapabilities&&!ue.sourceCapabilities.firesTouchEvents)){var Ne=$n(ue);if(!(Ne.some(function(ut){return ut instanceof HTMLLabelElement&&ut.attributes.for})&&!Ne.some(function(ut){return ut instanceof HTMLInputElement||ut instanceof HTMLSelectElement}))){var nt=Date.now();nt-k<=fa?(U++,U===2&&x(Pr(ue))):U=1,k=nt}}}return f.addEventListener("click",X),{dblclick:x,simDblclick:X}}function Co(f,x){f.removeEventListener("dblclick",x.dblclick),f.removeEventListener("click",x.simDblclick)}var ja=Dl(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),Io=Dl(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),$s=Io==="webkitTransition"||Io==="OTransition"?Io+"End":"transitionend";function qs(f){return typeof f=="string"?document.getElementById(f):f}function al(f,x){var k=f.style[x]||f.currentStyle&&f.currentStyle[x];if((!k||k==="auto")&&document.defaultView){var U=document.defaultView.getComputedStyle(f,null);k=U?U[x]:null}return k==="auto"?null:k}function ii(f,x,k){var U=document.createElement(f);return U.className=x||"",k&&k.appendChild(U),U}function hi(f){var x=f.parentNode;x&&x.removeChild(f)}function Hi(f){for(;f.firstChild;)f.removeChild(f.firstChild)}function xr(f){var x=f.parentNode;x&&x.lastChild!==f&&x.appendChild(f)}function Gs(f){var x=f.parentNode;x&&x.firstChild!==f&&x.insertBefore(f,x.firstChild)}function fu(f,x){if(f.classList!==void 0)return f.classList.contains(x);var k=lo(f);return k.length>0&&new RegExp("(^|\\s)"+x+"(\\s|$)").test(k)}function on(f,x){if(f.classList!==void 0)for(var k=xe(x),U=0,X=k.length;U<X;U++)f.classList.add(k[U]);else if(!fu(f,x)){var ue=lo(f);Ia(f,(ue?ue+" ":"")+x)}}function Ui(f,x){f.classList!==void 0?f.classList.remove(x):Ia(f,Y((" "+lo(f)+" ").replace(" "+x+" "," ")))}function Ia(f,x){f.className.baseVal===void 0?f.className=x:f.className.baseVal=x}function lo(f){return f.correspondingElement&&(f=f.correspondingElement),f.className.baseVal===void 0?f.className:f.className.baseVal}function rr(f,x){"opacity"in f.style?f.style.opacity=x:"filter"in f.style&&Po(f,x)}function Po(f,x){var k=!1,U="DXImageTransform.Microsoft.Alpha";try{k=f.filters.item(U)}catch{if(x===1)return}x=Math.round(x*100),k?(k.Enabled=x!==100,k.Opacity=x):f.style.filter+=" progid:"+U+"(opacity="+x+")"}function Dl(f){for(var x=document.documentElement.style,k=0;k<f.length;k++)if(f[k]in x)return f[k];return!1}function Hs(f,x,k){var U=x||new Tt(0,0);f.style[ja]=(en.ie3d?"translate("+U.x+"px,"+U.y+"px)":"translate3d("+U.x+"px,"+U.y+"px,0)")+(k?" scale("+k+")":"")}function ar(f,x){f._leaflet_pos=x,en.any3d?Hs(f,x):(f.style.left=x.x+"px",f.style.top=x.y+"px")}function Ja(f){return f._leaflet_pos||new Tt(0,0)}var $a,Zi,Un;if("onselectstart"in document)$a=function(){hn(window,"selectstart",sn)},Zi=function(){xn(window,"selectstart",sn)};else{var es=Dl(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);$a=function(){if(es){var f=document.documentElement.style;Un=f[es],f[es]="none"}},Zi=function(){es&&(document.documentElement.style[es]=Un,Un=void 0)}}function ys(){hn(window,"dragstart",sn)}function qa(){xn(window,"dragstart",sn)}var Zs,kn;function vs(f){for(;f.tabIndex===-1;)f=f.parentNode;f.style&&(Pa(),Zs=f,kn=f.style.outlineStyle,f.style.outlineStyle="none",hn(window,"keydown",Pa))}function Pa(){Zs&&(Zs.style.outlineStyle=kn,Zs=void 0,kn=void 0,xn(window,"keydown",Pa))}function zl(f){do f=f.parentNode;while((!f.offsetWidth||!f.offsetHeight)&&f!==document.body);return f}function Wi(f){var x=f.getBoundingClientRect();return{x:x.width/f.offsetWidth||1,y:x.height/f.offsetHeight||1,boundingClientRect:x}}var mr={__proto__:null,TRANSFORM:ja,TRANSITION:Io,TRANSITION_END:$s,get:qs,getStyle:al,create:ii,remove:hi,empty:Hi,toFront:xr,toBack:Gs,hasClass:fu,addClass:on,removeClass:Ui,setClass:Ia,getClass:lo,setOpacity:rr,testProp:Dl,setTransform:Hs,setPosition:ar,getPosition:Ja,get disableTextSelection(){return $a},get enableTextSelection(){return Zi},disableImageDrag:ys,enableImageDrag:qa,preventOutline:vs,restoreOutline:Pa,getSizedParentNode:zl,getScale:Wi};function hn(f,x,k,U){if(x&&typeof x=="object")for(var X in x)cr(f,X,x[X],k);else{x=xe(x);for(var ue=0,Ne=x.length;ue<Ne;ue++)cr(f,x[ue],k,U)}return this}var pi="_leaflet_events";function xn(f,x,k,U){if(arguments.length===1)sl(f),delete f[pi];else if(x&&typeof x=="object")for(var X in x)wr(f,X,x[X],k);else if(x=xe(x),arguments.length===2)sl(f,function(nt){return Ze(x,nt)!==-1});else for(var ue=0,Ne=x.length;ue<Ne;ue++)wr(f,x[ue],k,U);return this}function sl(f,x){for(var k in f[pi]){var U=k.split(/\d/)[0];(!x||x(U))&&wr(f,U,null,null,k)}}var sr={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function cr(f,x,k,U){var X=x+C(k)+(U?"_"+C(U):"");if(f[pi]&&f[pi][X])return this;var ue=function(nt){return k.call(U||f,nt||window.event)},Ne=ue;!en.touchNative&&en.pointer&&x.indexOf("touch")===0?ue=Ao(f,x,ue):en.touch&&x==="dblclick"?ue=wi(f,ue):"addEventListener"in f?x==="touchstart"||x==="touchmove"||x==="wheel"||x==="mousewheel"?f.addEventListener(sr[x]||x,ue,en.passiveEvents?{passive:!1}:!1):x==="mouseenter"||x==="mouseleave"?(ue=function(nt){nt=nt||window.event,bs(f,nt)&&Ne(nt)},f.addEventListener(sr[x],ue,!1)):f.addEventListener(x,Ne,!1):f.attachEvent("on"+x,ue),f[pi]=f[pi]||{},f[pi][X]=ue}function wr(f,x,k,U,X){X=X||x+C(k)+(U?"_"+C(U):"");var ue=f[pi]&&f[pi][X];if(!ue)return this;!en.touchNative&&en.pointer&&x.indexOf("touch")===0?Bn(f,x,ue):en.touch&&x==="dblclick"?Co(f,ue):"removeEventListener"in f?f.removeEventListener(sr[x]||x,ue,!1):f.detachEvent("on"+x,ue),f[pi][X]=null}function bn(f){return f.stopPropagation?f.stopPropagation():f.originalEvent?f.originalEvent._stopped=!0:f.cancelBubble=!0,this}function pa(f){return cr(f,"wheel",bn),this}function fn(f){return hn(f,"mousedown touchstart dblclick contextmenu",bn),f._leaflet_disable_click=!0,this}function sn(f){return f.preventDefault?f.preventDefault():f.returnValue=!1,this}function ia(f){return sn(f),bn(f),this}function $n(f){if(f.composedPath)return f.composedPath();for(var x=[],k=f.target;k;)x.push(k),k=k.parentNode;return x}function zr(f,x){if(!x)return new Tt(f.clientX,f.clientY);var k=Wi(x),U=k.boundingClientRect;return new Tt((f.clientX-U.left)/k.x-x.clientLeft,(f.clientY-U.top)/k.y-x.clientTop)}var Qr=en.linux&&en.chrome?window.devicePixelRatio:en.mac?window.devicePixelRatio*3:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function or(f){return en.edge?f.wheelDeltaY/2:f.deltaY&&f.deltaMode===0?-f.deltaY/Qr:f.deltaY&&f.deltaMode===1?-f.deltaY*20:f.deltaY&&f.deltaMode===2?-f.deltaY*60:f.deltaX||f.deltaZ?0:f.wheelDelta?(f.wheelDeltaY||f.wheelDelta)/2:f.detail&&Math.abs(f.detail)<32765?-f.detail*20:f.detail?f.detail/-32765*60:0}function bs(f,x){var k=x.relatedTarget;if(!k)return!0;try{for(;k&&k!==f;)k=k.parentNode}catch{return!1}return k!==f}var uo={__proto__:null,on:hn,off:xn,stopPropagation:bn,disableScrollPropagation:pa,disableClickPropagation:fn,preventDefault:sn,stop:ia,getPropagationPath:$n,getMousePosition:zr,getWheelDelta:or,isExternalTarget:bs,addListener:hn,removeListener:xn},xs=$t.extend({run:function(f,x,k,U){this.stop(),this._el=f,this._inProgress=!0,this._duration=k||.25,this._easeOutPower=1/Math.max(U||.5,.2),this._startPos=Ja(f),this._offset=x.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=Me(this._animate,this),this._step()},_step:function(f){var x=+new Date-this._startTime,k=this._duration*1e3;x<k?this._runFrame(this._easeOut(x/k),f):(this._runFrame(1),this._complete())},_runFrame:function(f,x){var k=this._startPos.add(this._offset.multiplyBy(f));x&&k._round(),ar(this._el,k),this.fire("step")},_complete:function(){Ge(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(f){return 1-Math.pow(1-f,this._easeOutPower)}}),Wn=$t.extend({options:{crs:Fi,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(f,x){x=be(this,x),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(f),this._initLayout(),this._onResize=g(this._onResize,this),this._initEvents(),x.maxBounds&&this.setMaxBounds(x.maxBounds),x.zoom!==void 0&&(this._zoom=this._limitZoom(x.zoom)),x.center&&x.zoom!==void 0&&this.setView(Wt(x.center),x.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=Io&&en.any3d&&!en.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),hn(this._proxy,$s,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(f,x,k){if(x=x===void 0?this._zoom:this._limitZoom(x),f=this._limitCenter(Wt(f),x,this.options.maxBounds),k=k||{},this._stop(),this._loaded&&!k.reset&&k!==!0){k.animate!==void 0&&(k.zoom=d({animate:k.animate},k.zoom),k.pan=d({animate:k.animate,duration:k.duration},k.pan));var U=this._zoom!==x?this._tryAnimatedZoom&&this._tryAnimatedZoom(f,x,k.zoom):this._tryAnimatedPan(f,k.pan);if(U)return clearTimeout(this._sizeTimer),this}return this._resetView(f,x,k.pan&&k.pan.noMoveStart),this},setZoom:function(f,x){return this._loaded?this.setView(this.getCenter(),f,{zoom:x}):(this._zoom=f,this)},zoomIn:function(f,x){return f=f||(en.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+f,x)},zoomOut:function(f,x){return f=f||(en.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-f,x)},setZoomAround:function(f,x,k){var U=this.getZoomScale(x),X=this.getSize().divideBy(2),ue=f instanceof Tt?f:this.latLngToContainerPoint(f),Ne=ue.subtract(X).multiplyBy(1-1/U),nt=this.containerPointToLatLng(X.add(Ne));return this.setView(nt,x,{zoom:k})},_getBoundsCenterZoom:function(f,x){x=x||{},f=f.getBounds?f.getBounds():Ut(f);var k=Bt(x.paddingTopLeft||x.padding||[0,0]),U=Bt(x.paddingBottomRight||x.padding||[0,0]),X=this.getBoundsZoom(f,!1,k.add(U));if(X=typeof x.maxZoom=="number"?Math.min(x.maxZoom,X):X,X===1/0)return{center:f.getCenter(),zoom:X};var ue=U.subtract(k).divideBy(2),Ne=this.project(f.getSouthWest(),X),nt=this.project(f.getNorthEast(),X),ut=this.unproject(Ne.add(nt).divideBy(2).add(ue),X);return{center:ut,zoom:X}},fitBounds:function(f,x){if(f=Ut(f),!f.isValid())throw new Error("Bounds are not valid.");var k=this._getBoundsCenterZoom(f,x);return this.setView(k.center,k.zoom,x)},fitWorld:function(f){return this.fitBounds([[-90,-180],[90,180]],f)},panTo:function(f,x){return this.setView(f,this._zoom,{pan:x})},panBy:function(f,x){if(f=Bt(f).round(),x=x||{},!f.x&&!f.y)return this.fire("moveend");if(x.animate!==!0&&!this.getSize().contains(f))return this._resetView(this.unproject(this.project(this.getCenter()).add(f)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new xs,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),x.noMoveStart||this.fire("movestart"),x.animate!==!1){on(this._mapPane,"leaflet-pan-anim");var k=this._getMapPanePos().subtract(f).round();this._panAnim.run(this._mapPane,k,x.duration||.25,x.easeLinearity)}else this._rawPanBy(f),this.fire("move").fire("moveend");return this},flyTo:function(f,x,k){if(k=k||{},k.animate===!1||!en.any3d)return this.setView(f,x,k);this._stop();var U=this.project(this.getCenter()),X=this.project(f),ue=this.getSize(),Ne=this._zoom;f=Wt(f),x=x===void 0?Ne:x;var nt=Math.max(ue.x,ue.y),ut=nt*this.getZoomScale(Ne,x),It=X.distanceTo(U)||1,Xt=1.42,pn=Xt*Xt;function Yn(Nr){var as=Nr?-1:1,gl=Nr?ut:nt,Fo=ut*ut-nt*nt+as*pn*pn*It*It,Eu=2*gl*pn*It,lc=Fo/Eu,Vl=Math.sqrt(lc*lc+1)-lc,_l=Vl<1e-9?-18:Math.log(Vl);return _l}function _a(Nr){return(Math.exp(Nr)-Math.exp(-Nr))/2}function Zr(Nr){return(Math.exp(Nr)+Math.exp(-Nr))/2}function Za(Nr){return _a(Nr)/Zr(Nr)}var Si=Yn(0);function ki(Nr){return nt*(Zr(Si)/Zr(Si+Xt*Nr))}function ui(Nr){return nt*(Zr(Si)*Za(Si+Xt*Nr)-_a(Si))/pn}function Li(Nr){return 1-Math.pow(1-Nr,1.5)}var Wr=Date.now(),rs=(Yn(1)-Si)/Xt,Bo=k.duration?1e3*k.duration:1e3*rs*.8;function Su(){var Nr=(Date.now()-Wr)/Bo,as=Li(Nr)*rs;Nr<=1?(this._flyToFrame=Me(Su,this),this._move(this.unproject(U.add(X.subtract(U).multiplyBy(ui(as)/It)),Ne),this.getScaleZoom(nt/ki(as),Ne),{flyTo:!0})):this._move(f,x)._moveEnd(!0)}return this._moveStart(!0,k.noMoveStart),Su.call(this),this},flyToBounds:function(f,x){var k=this._getBoundsCenterZoom(f,x);return this.flyTo(k.center,k.zoom,x)},setMaxBounds:function(f){return f=Ut(f),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),f.isValid()?(this.options.maxBounds=f,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(f){var x=this.options.minZoom;return this.options.minZoom=f,this._loaded&&x!==f&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(f):this},setMaxZoom:function(f){var x=this.options.maxZoom;return this.options.maxZoom=f,this._loaded&&x!==f&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(f):this},panInsideBounds:function(f,x){this._enforcingBounds=!0;var k=this.getCenter(),U=this._limitCenter(k,this._zoom,Ut(f));return k.equals(U)||this.panTo(U,x),this._enforcingBounds=!1,this},panInside:function(f,x){x=x||{};var k=Bt(x.paddingTopLeft||x.padding||[0,0]),U=Bt(x.paddingBottomRight||x.padding||[0,0]),X=this.project(this.getCenter()),ue=this.project(f),Ne=this.getPixelBounds(),nt=vt([Ne.min.add(k),Ne.max.subtract(U)]),ut=nt.getSize();if(!nt.contains(ue)){this._enforcingBounds=!0;var It=ue.subtract(nt.getCenter()),Xt=nt.extend(ue).getSize().subtract(ut);X.x+=It.x<0?-Xt.x:Xt.x,X.y+=It.y<0?-Xt.y:Xt.y,this.panTo(this.unproject(X),x),this._enforcingBounds=!1}return this},invalidateSize:function(f){if(!this._loaded)return this;f=d({animate:!1,pan:!0},f===!0?{animate:!0}:f);var x=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var k=this.getSize(),U=x.divideBy(2).round(),X=k.divideBy(2).round(),ue=U.subtract(X);return!ue.x&&!ue.y?this:(f.animate&&f.pan?this.panBy(ue):(f.pan&&this._rawPanBy(ue),this.fire("move"),f.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(g(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:x,newSize:k}))},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(f){if(f=this._locateOptions=d({timeout:1e4,watch:!1},f),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var x=g(this._handleGeolocationResponse,this),k=g(this._handleGeolocationError,this);return f.watch?this._locationWatchId=navigator.geolocation.watchPosition(x,k,f):navigator.geolocation.getCurrentPosition(x,k,f),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(f){if(this._container._leaflet_id){var x=f.code,k=f.message||(x===1?"permission denied":x===2?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:x,message:"Geolocation error: "+k+"."})}},_handleGeolocationResponse:function(f){if(this._container._leaflet_id){var x=f.coords.latitude,k=f.coords.longitude,U=new Jt(x,k),X=U.toBounds(f.coords.accuracy*2),ue=this._locateOptions;if(ue.setView){var Ne=this.getBoundsZoom(X);this.setView(U,ue.maxZoom?Math.min(Ne,ue.maxZoom):Ne)}var nt={latlng:U,bounds:X,timestamp:f.timestamp};for(var ut in f.coords)typeof f.coords[ut]=="number"&&(nt[ut]=f.coords[ut]);this.fire("locationfound",nt)}},addHandler:function(f,x){if(!x)return this;var k=this[f]=new x(this);return this._handlers.push(k),this.options[f]&&k.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch{this._container._leaflet_id=void 0,this._containerId=void 0}this._locationWatchId!==void 0&&this.stopLocate(),this._stop(),hi(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(Ge(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload");var f;for(f in this._layers)this._layers[f].remove();for(f in this._panes)hi(this._panes[f]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(f,x){var k="leaflet-pane"+(f?" leaflet-"+f.replace("Pane","")+"-pane":""),U=ii("div",k,x||this._mapPane);return f&&(this._panes[f]=U),U},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var f=this.getPixelBounds(),x=this.unproject(f.getBottomLeft()),k=this.unproject(f.getTopRight());return new Ot(x,k)},getMinZoom:function(){return this.options.minZoom===void 0?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===void 0?this._layersMaxZoom===void 0?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(f,x,k){f=Ut(f),k=Bt(k||[0,0]);var U=this.getZoom()||0,X=this.getMinZoom(),ue=this.getMaxZoom(),Ne=f.getNorthWest(),nt=f.getSouthEast(),ut=this.getSize().subtract(k),It=vt(this.project(nt,U),this.project(Ne,U)).getSize(),Xt=en.any3d?this.options.zoomSnap:1,pn=ut.x/It.x,Yn=ut.y/It.y,_a=x?Math.max(pn,Yn):Math.min(pn,Yn);return U=this.getScaleZoom(_a,U),Xt&&(U=Math.round(U/(Xt/100))*(Xt/100),U=x?Math.ceil(U/Xt)*Xt:Math.floor(U/Xt)*Xt),Math.max(X,Math.min(ue,U))},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new Tt(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(f,x){var k=this._getTopLeftPoint(f,x);return new Le(k,k.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(f){return this.options.crs.getProjectedBounds(f===void 0?this.getZoom():f)},getPane:function(f){return typeof f=="string"?this._panes[f]:f},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(f,x){var k=this.options.crs;return x=x===void 0?this._zoom:x,k.scale(f)/k.scale(x)},getScaleZoom:function(f,x){var k=this.options.crs;x=x===void 0?this._zoom:x;var U=k.zoom(f*k.scale(x));return isNaN(U)?1/0:U},project:function(f,x){return x=x===void 0?this._zoom:x,this.options.crs.latLngToPoint(Wt(f),x)},unproject:function(f,x){return x=x===void 0?this._zoom:x,this.options.crs.pointToLatLng(Bt(f),x)},layerPointToLatLng:function(f){var x=Bt(f).add(this.getPixelOrigin());return this.unproject(x)},latLngToLayerPoint:function(f){var x=this.project(Wt(f))._round();return x._subtract(this.getPixelOrigin())},wrapLatLng:function(f){return this.options.crs.wrapLatLng(Wt(f))},wrapLatLngBounds:function(f){return this.options.crs.wrapLatLngBounds(Ut(f))},distance:function(f,x){return this.options.crs.distance(Wt(f),Wt(x))},containerPointToLayerPoint:function(f){return Bt(f).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(f){return Bt(f).add(this._getMapPanePos())},containerPointToLatLng:function(f){var x=this.containerPointToLayerPoint(Bt(f));return this.layerPointToLatLng(x)},latLngToContainerPoint:function(f){return this.layerPointToContainerPoint(this.latLngToLayerPoint(Wt(f)))},mouseEventToContainerPoint:function(f){return zr(f,this._container)},mouseEventToLayerPoint:function(f){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(f))},mouseEventToLatLng:function(f){return this.layerPointToLatLng(this.mouseEventToLayerPoint(f))},_initContainer:function(f){var x=this._container=qs(f);if(x){if(x._leaflet_id)throw new Error("Map container is already initialized.")}else throw new Error("Map container not found.");hn(x,"scroll",this._onScroll,this),this._containerId=C(x)},_initLayout:function(){var f=this._container;this._fadeAnimated=this.options.fadeAnimation&&en.any3d,on(f,"leaflet-container"+(en.touch?" leaflet-touch":"")+(en.retina?" leaflet-retina":"")+(en.ielt9?" leaflet-oldie":"")+(en.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var x=al(f,"position");x!=="absolute"&&x!=="relative"&&x!=="fixed"&&x!=="sticky"&&(f.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var f=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),ar(this._mapPane,new Tt(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(on(f.markerPane,"leaflet-zoom-hide"),on(f.shadowPane,"leaflet-zoom-hide"))},_resetView:function(f,x,k){ar(this._mapPane,new Tt(0,0));var U=!this._loaded;this._loaded=!0,x=this._limitZoom(x),this.fire("viewprereset");var X=this._zoom!==x;this._moveStart(X,k)._move(f,x)._moveEnd(X),this.fire("viewreset"),U&&this.fire("load")},_moveStart:function(f,x){return f&&this.fire("zoomstart"),x||this.fire("movestart"),this},_move:function(f,x,k,U){x===void 0&&(x=this._zoom);var X=this._zoom!==x;return this._zoom=x,this._lastCenter=f,this._pixelOrigin=this._getNewPixelOrigin(f),U?k&&k.pinch&&this.fire("zoom",k):((X||k&&k.pinch)&&this.fire("zoom",k),this.fire("move",k)),this},_moveEnd:function(f){return f&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return Ge(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(f){ar(this._mapPane,this._getMapPanePos().subtract(f))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(f){this._targets={},this._targets[C(this._container)]=this;var x=f?xn:hn;x(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&x(window,"resize",this._onResize,this),en.any3d&&this.options.transform3DLimit&&(f?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){Ge(this._resizeRequest),this._resizeRequest=Me(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var f=this._getMapPanePos();Math.max(Math.abs(f.x),Math.abs(f.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(f,x){for(var k=[],U,X=x==="mouseout"||x==="mouseover",ue=f.target||f.srcElement,Ne=!1;ue;){if(U=this._targets[C(ue)],U&&(x==="click"||x==="preclick")&&this._draggableMoved(U)){Ne=!0;break}if(U&&U.listens(x,!0)&&(X&&!bs(ue,f)||(k.push(U),X))||ue===this._container)break;ue=ue.parentNode}return!k.length&&!Ne&&!X&&this.listens(x,!0)&&(k=[this]),k},_isClickDisabled:function(f){for(;f&&f!==this._container;){if(f._leaflet_disable_click)return!0;f=f.parentNode}},_handleDOMEvent:function(f){var x=f.target||f.srcElement;if(!(!this._loaded||x._leaflet_disable_events||f.type==="click"&&this._isClickDisabled(x))){var k=f.type;k==="mousedown"&&vs(x),this._fireDOMEvent(f,k)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(f,x,k){if(f.type==="click"){var U=d({},f);U.type="preclick",this._fireDOMEvent(U,U.type,k)}var X=this._findEventTargets(f,x);if(k){for(var ue=[],Ne=0;Ne<k.length;Ne++)k[Ne].listens(x,!0)&&ue.push(k[Ne]);X=ue.concat(X)}if(X.length){x==="contextmenu"&&sn(f);var nt=X[0],ut={originalEvent:f};if(f.type!=="keypress"&&f.type!=="keydown"&&f.type!=="keyup"){var It=nt.getLatLng&&(!nt._radius||nt._radius<=10);ut.containerPoint=It?this.latLngToContainerPoint(nt.getLatLng()):this.mouseEventToContainerPoint(f),ut.layerPoint=this.containerPointToLayerPoint(ut.containerPoint),ut.latlng=It?nt.getLatLng():this.layerPointToLatLng(ut.layerPoint)}for(Ne=0;Ne<X.length;Ne++)if(X[Ne].fire(x,ut,!0),ut.originalEvent._stopped||X[Ne].options.bubblingMouseEvents===!1&&Ze(this._mouseEvents,x)!==-1)return}},_draggableMoved:function(f){return f=f.dragging&&f.dragging.enabled()?f:this,f.dragging&&f.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var f=0,x=this._handlers.length;f<x;f++)this._handlers[f].disable()},whenReady:function(f,x){return this._loaded?f.call(x||this,{target:this}):this.on("load",f,x),this},_getMapPanePos:function(){return Ja(this._mapPane)||new Tt(0,0)},_moved:function(){var f=this._getMapPanePos();return f&&!f.equals([0,0])},_getTopLeftPoint:function(f,x){var k=f&&x!==void 0?this._getNewPixelOrigin(f,x):this.getPixelOrigin();return k.subtract(this._getMapPanePos())},_getNewPixelOrigin:function(f,x){var k=this.getSize()._divideBy(2);return this.project(f,x)._subtract(k)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(f,x,k){var U=this._getNewPixelOrigin(k,x);return this.project(f,x)._subtract(U)},_latLngBoundsToNewLayerBounds:function(f,x,k){var U=this._getNewPixelOrigin(k,x);return vt([this.project(f.getSouthWest(),x)._subtract(U),this.project(f.getNorthWest(),x)._subtract(U),this.project(f.getSouthEast(),x)._subtract(U),this.project(f.getNorthEast(),x)._subtract(U)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(f){return this.latLngToLayerPoint(f).subtract(this._getCenterLayerPoint())},_limitCenter:function(f,x,k){if(!k)return f;var U=this.project(f,x),X=this.getSize().divideBy(2),ue=new Le(U.subtract(X),U.add(X)),Ne=this._getBoundsOffset(ue,k,x);return Math.abs(Ne.x)<=1&&Math.abs(Ne.y)<=1?f:this.unproject(U.add(Ne),x)},_limitOffset:function(f,x){if(!x)return f;var k=this.getPixelBounds(),U=new Le(k.min.add(f),k.max.add(f));return f.add(this._getBoundsOffset(U,x))},_getBoundsOffset:function(f,x,k){var U=vt(this.project(x.getNorthEast(),k),this.project(x.getSouthWest(),k)),X=U.min.subtract(f.min),ue=U.max.subtract(f.max),Ne=this._rebound(X.x,-ue.x),nt=this._rebound(X.y,-ue.y);return new Tt(Ne,nt)},_rebound:function(f,x){return f+x>0?Math.round(f-x)/2:Math.max(0,Math.ceil(f))-Math.max(0,Math.floor(x))},_limitZoom:function(f){var x=this.getMinZoom(),k=this.getMaxZoom(),U=en.any3d?this.options.zoomSnap:1;return U&&(f=Math.round(f/U)*U),Math.max(x,Math.min(k,f))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){Ui(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(f,x){var k=this._getCenterOffset(f)._trunc();return(x&&x.animate)!==!0&&!this.getSize().contains(k)?!1:(this.panBy(k,x),!0)},_createAnimProxy:function(){var f=this._proxy=ii("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(f),this.on("zoomanim",function(x){var k=ja,U=this._proxy.style[k];Hs(this._proxy,this.project(x.center,x.zoom),this.getZoomScale(x.zoom,1)),U===this._proxy.style[k]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){hi(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var f=this.getCenter(),x=this.getZoom();Hs(this._proxy,this.project(f,x),this.getZoomScale(x,1))},_catchTransitionEnd:function(f){this._animatingZoom&&f.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(f,x,k){if(this._animatingZoom)return!0;if(k=k||{},!this._zoomAnimated||k.animate===!1||this._nothingToAnimate()||Math.abs(x-this._zoom)>this.options.zoomAnimationThreshold)return!1;var U=this.getZoomScale(x),X=this._getCenterOffset(f)._divideBy(1-1/U);return k.animate!==!0&&!this.getSize().contains(X)?!1:(Me(function(){this._moveStart(!0,k.noMoveStart||!1)._animateZoom(f,x,!0)},this),!0)},_animateZoom:function(f,x,k,U){this._mapPane&&(k&&(this._animatingZoom=!0,this._animateToCenter=f,this._animateToZoom=x,on(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:f,zoom:x,noUpdate:U}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(g(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&Ui(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});function Mo(f,x){return new Wn(f,x)}var ra=Pn.extend({options:{position:"topright"},initialize:function(f){be(this,f)},getPosition:function(){return this.options.position},setPosition:function(f){var x=this._map;return x&&x.removeControl(this),this.options.position=f,x&&x.addControl(this),this},getContainer:function(){return this._container},addTo:function(f){this.remove(),this._map=f;var x=this._container=this.onAdd(f),k=this.getPosition(),U=f._controlCorners[k];return on(x,"leaflet-control"),k.indexOf("bottom")!==-1?U.insertBefore(x,U.firstChild):U.appendChild(x),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(hi(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(f){this._map&&f&&f.screenX>0&&f.screenY>0&&this._map.getContainer().focus()}}),Ma=function(f){return new ra(f)};Wn.include({addControl:function(f){return f.addTo(this),this},removeControl:function(f){return f.remove(),this},_initControlPos:function(){var f=this._controlCorners={},x="leaflet-",k=this._controlContainer=ii("div",x+"control-container",this._container);function U(X,ue){var Ne=x+X+" "+x+ue;f[X+ue]=ii("div",Ne,k)}U("top","left"),U("top","right"),U("bottom","left"),U("bottom","right")},_clearControlPos:function(){for(var f in this._controlCorners)hi(this._controlCorners[f]);hi(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var Ra=ra.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(f,x,k,U){return k<U?-1:U<k?1:0}},initialize:function(f,x,k){be(this,k),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1;for(var U in f)this._addLayer(f[U],U);for(U in x)this._addLayer(x[U],U,!0)},onAdd:function(f){this._initLayout(),this._update(),this._map=f,f.on("zoomend",this._checkDisabledLayers,this);for(var x=0;x<this._layers.length;x++)this._layers[x].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(f){return ra.prototype.addTo.call(this,f),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var f=0;f<this._layers.length;f++)this._layers[f].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(f,x){return this._addLayer(f,x),this._map?this._update():this},addOverlay:function(f,x){return this._addLayer(f,x,!0),this._map?this._update():this},removeLayer:function(f){f.off("add remove",this._onLayerChange,this);var x=this._getLayer(C(f));return x&&this._layers.splice(this._layers.indexOf(x),1),this._map?this._update():this},expand:function(){on(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var f=this._map.getSize().y-(this._container.offsetTop+50);return f<this._section.clientHeight?(on(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=f+"px"):Ui(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return Ui(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var f="leaflet-control-layers",x=this._container=ii("div",f),k=this.options.collapsed;x.setAttribute("aria-haspopup",!0),fn(x),pa(x);var U=this._section=ii("section",f+"-list");k&&(this._map.on("click",this.collapse,this),hn(x,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var X=this._layersLink=ii("a",f+"-toggle",x);X.href="#",X.title="Layers",X.setAttribute("role","button"),hn(X,{keydown:function(ue){ue.keyCode===13&&this._expandSafely()},click:function(ue){sn(ue),this._expandSafely()}},this),k||this.expand(),this._baseLayersList=ii("div",f+"-base",U),this._separator=ii("div",f+"-separator",U),this._overlaysList=ii("div",f+"-overlays",U),x.appendChild(U)},_getLayer:function(f){for(var x=0;x<this._layers.length;x++)if(this._layers[x]&&C(this._layers[x].layer)===f)return this._layers[x]},_addLayer:function(f,x,k){this._map&&f.on("add remove",this._onLayerChange,this),this._layers.push({layer:f,name:x,overlay:k}),this.options.sortLayers&&this._layers.sort(g(function(U,X){return this.options.sortFunction(U.layer,X.layer,U.name,X.name)},this)),this.options.autoZIndex&&f.setZIndex&&(this._lastZIndex++,f.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;Hi(this._baseLayersList),Hi(this._overlaysList),this._layerControlInputs=[];var f,x,k,U,X=0;for(k=0;k<this._layers.length;k++)U=this._layers[k],this._addItem(U),x=x||U.overlay,f=f||!U.overlay,X+=U.overlay?0:1;return this.options.hideSingleBase&&(f=f&&X>1,this._baseLayersList.style.display=f?"":"none"),this._separator.style.display=x&&f?"":"none",this},_onLayerChange:function(f){this._handlingClick||this._update();var x=this._getLayer(C(f.target)),k=x.overlay?f.type==="add"?"overlayadd":"overlayremove":f.type==="add"?"baselayerchange":null;k&&this._map.fire(k,x)},_createRadioElement:function(f,x){var k='<input type="radio" class="leaflet-control-layers-selector" name="'+f+'"'+(x?' checked="checked"':"")+"/>",U=document.createElement("div");return U.innerHTML=k,U.firstChild},_addItem:function(f){var x=document.createElement("label"),k=this._map.hasLayer(f.layer),U;f.overlay?(U=document.createElement("input"),U.type="checkbox",U.className="leaflet-control-layers-selector",U.defaultChecked=k):U=this._createRadioElement("leaflet-base-layers_"+C(this),k),this._layerControlInputs.push(U),U.layerId=C(f.layer),hn(U,"click",this._onInputClick,this);var X=document.createElement("span");X.innerHTML=" "+f.name;var ue=document.createElement("span");x.appendChild(ue),ue.appendChild(U),ue.appendChild(X);var Ne=f.overlay?this._overlaysList:this._baseLayersList;return Ne.appendChild(x),this._checkDisabledLayers(),x},_onInputClick:function(){if(!this._preventClick){var f=this._layerControlInputs,x,k,U=[],X=[];this._handlingClick=!0;for(var ue=f.length-1;ue>=0;ue--)x=f[ue],k=this._getLayer(x.layerId).layer,x.checked?U.push(k):x.checked||X.push(k);for(ue=0;ue<X.length;ue++)this._map.hasLayer(X[ue])&&this._map.removeLayer(X[ue]);for(ue=0;ue<U.length;ue++)this._map.hasLayer(U[ue])||this._map.addLayer(U[ue]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var f=this._layerControlInputs,x,k,U=this._map.getZoom(),X=f.length-1;X>=0;X--)x=f[X],k=this._getLayer(x.layerId).layer,x.disabled=k.options.minZoom!==void 0&&U<k.options.minZoom||k.options.maxZoom!==void 0&&U>k.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var f=this._section;this._preventClick=!0,hn(f,"click",sn),this.expand();var x=this;setTimeout(function(){xn(f,"click",sn),x._preventClick=!1})}}),Or=function(f,x,k){return new Ra(f,x,k)},ws=ra.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(f){var x="leaflet-control-zoom",k=ii("div",x+" leaflet-bar"),U=this.options;return this._zoomInButton=this._createButton(U.zoomInText,U.zoomInTitle,x+"-in",k,this._zoomIn),this._zoomOutButton=this._createButton(U.zoomOutText,U.zoomOutTitle,x+"-out",k,this._zoomOut),this._updateDisabled(),f.on("zoomend zoomlevelschange",this._updateDisabled,this),k},onRemove:function(f){f.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(f){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(f.shiftKey?3:1))},_zoomOut:function(f){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(f.shiftKey?3:1))},_createButton:function(f,x,k,U,X){var ue=ii("a",k,U);return ue.innerHTML=f,ue.href="#",ue.title=x,ue.setAttribute("role","button"),ue.setAttribute("aria-label",x),fn(ue),hn(ue,"click",ia),hn(ue,"click",X,this),hn(ue,"click",this._refocusOnMap,this),ue},_updateDisabled:function(){var f=this._map,x="leaflet-disabled";Ui(this._zoomInButton,x),Ui(this._zoomOutButton,x),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||f._zoom===f.getMinZoom())&&(on(this._zoomOutButton,x),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||f._zoom===f.getMaxZoom())&&(on(this._zoomInButton,x),this._zoomInButton.setAttribute("aria-disabled","true"))}});Wn.mergeOptions({zoomControl:!0}),Wn.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new ws,this.addControl(this.zoomControl))});var Zl=function(f){return new ws(f)},Ro=ra.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(f){var x="leaflet-control-scale",k=ii("div",x),U=this.options;return this._addScales(U,x+"-line",k),f.on(U.updateWhenIdle?"moveend":"move",this._update,this),f.whenReady(this._update,this),k},onRemove:function(f){f.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(f,x,k){f.metric&&(this._mScale=ii("div",x,k)),f.imperial&&(this._iScale=ii("div",x,k))},_update:function(){var f=this._map,x=f.getSize().y/2,k=f.distance(f.containerPointToLatLng([0,x]),f.containerPointToLatLng([this.options.maxWidth,x]));this._updateScales(k)},_updateScales:function(f){this.options.metric&&f&&this._updateMetric(f),this.options.imperial&&f&&this._updateImperial(f)},_updateMetric:function(f){var x=this._getRoundNum(f),k=x<1e3?x+" m":x/1e3+" km";this._updateScale(this._mScale,k,x/f)},_updateImperial:function(f){var x=f*3.2808399,k,U,X;x>5280?(k=x/5280,U=this._getRoundNum(k),this._updateScale(this._iScale,U+" mi",U/k)):(X=this._getRoundNum(x),this._updateScale(this._iScale,X+" ft",X/x))},_updateScale:function(f,x,k){f.style.width=Math.round(this.options.maxWidth*k)+"px",f.innerHTML=x},_getRoundNum:function(f){var x=Math.pow(10,(Math.floor(f)+"").length-1),k=f/x;return k=k>=10?10:k>=5?5:k>=3?3:k>=2?2:1,x*k}}),Ki=function(f){return new Ro(f)},Zu='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg>',ol=ra.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(en.inlineSvg?Zu+" ":"")+"Leaflet</a>"},initialize:function(f){be(this,f),this._attributions={}},onAdd:function(f){f.attributionControl=this,this._container=ii("div","leaflet-control-attribution"),fn(this._container);for(var x in f._layers)f._layers[x].getAttribution&&this.addAttribution(f._layers[x].getAttribution());return this._update(),f.on("layeradd",this._addAttribution,this),this._container},onRemove:function(f){f.off("layeradd",this._addAttribution,this)},_addAttribution:function(f){f.layer.getAttribution&&(this.addAttribution(f.layer.getAttribution()),f.layer.once("remove",function(){this.removeAttribution(f.layer.getAttribution())},this))},setPrefix:function(f){return this.options.prefix=f,this._update(),this},addAttribution:function(f){return f?(this._attributions[f]||(this._attributions[f]=0),this._attributions[f]++,this._update(),this):this},removeAttribution:function(f){return f?(this._attributions[f]&&(this._attributions[f]--,this._update()),this):this},_update:function(){if(this._map){var f=[];for(var x in this._attributions)this._attributions[x]&&f.push(x);var k=[];this.options.prefix&&k.push(this.options.prefix),f.length&&k.push(f.join(", ")),this._container.innerHTML=k.join(' <span aria-hidden="true">|</span> ')}}});Wn.mergeOptions({attributionControl:!0}),Wn.addInitHook(function(){this.options.attributionControl&&new ol().addTo(this)});var Wl=function(f){return new ol(f)};ra.Layers=Ra,ra.Zoom=ws,ra.Scale=Ro,ra.Attribution=ol,Ma.layers=Or,Ma.zoom=Zl,Ma.scale=Ki,Ma.attribution=Wl;var Ws=Pn.extend({initialize:function(f){this._map=f},enable:function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});Ws.addTo=function(f,x){return f.addHandler(x,this),this};var Ol={Events:mt},lr=en.touch?"touchstart mousedown":"mousedown",ts=$t.extend({options:{clickTolerance:3},initialize:function(f,x,k,U){be(this,U),this._element=f,this._dragStartTarget=x||f,this._preventOutline=k},enable:function(){this._enabled||(hn(this._dragStartTarget,lr,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(ts._dragging===this&&this.finishDrag(!0),xn(this._dragStartTarget,lr,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(f){if(this._enabled&&(this._moved=!1,!fu(this._element,"leaflet-zoom-anim"))){if(f.touches&&f.touches.length!==1){ts._dragging===this&&this.finishDrag();return}if(!(ts._dragging||f.shiftKey||f.which!==1&&f.button!==1&&!f.touches)&&(ts._dragging=this,this._preventOutline&&vs(this._element),ys(),$a(),!this._moving)){this.fire("down");var x=f.touches?f.touches[0]:f,k=zl(this._element);this._startPoint=new Tt(x.clientX,x.clientY),this._startPos=Ja(this._element),this._parentScale=Wi(k);var U=f.type==="mousedown";hn(document,U?"mousemove":"touchmove",this._onMove,this),hn(document,U?"mouseup":"touchend touchcancel",this._onUp,this)}}},_onMove:function(f){if(this._enabled){if(f.touches&&f.touches.length>1){this._moved=!0;return}var x=f.touches&&f.touches.length===1?f.touches[0]:f,k=new Tt(x.clientX,x.clientY)._subtract(this._startPoint);!k.x&&!k.y||Math.abs(k.x)+Math.abs(k.y)<this.options.clickTolerance||(k.x/=this._parentScale.x,k.y/=this._parentScale.y,sn(f),this._moved||(this.fire("dragstart"),this._moved=!0,on(document.body,"leaflet-dragging"),this._lastTarget=f.target||f.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),on(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(k),this._moving=!0,this._lastEvent=f,this._updatePosition())}},_updatePosition:function(){var f={originalEvent:this._lastEvent};this.fire("predrag",f),ar(this._element,this._newPos),this.fire("drag",f)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(f){Ui(document.body,"leaflet-dragging"),this._lastTarget&&(Ui(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),xn(document,"mousemove touchmove",this._onMove,this),xn(document,"mouseup touchend touchcancel",this._onUp,this),qa(),Zi();var x=this._moved&&this._moving;this._moving=!1,ts._dragging=!1,x&&this.fire("dragend",{noInertia:f,distance:this._newPos.distanceTo(this._startPos)})}});function Ts(f,x,k){var U,X=[1,4,2,8],ue,Ne,nt,ut,It,Xt,pn,Yn;for(ue=0,Xt=f.length;ue<Xt;ue++)f[ue]._code=ht(f[ue],x);for(nt=0;nt<4;nt++){for(pn=X[nt],U=[],ue=0,Xt=f.length,Ne=Xt-1;ue<Xt;Ne=ue++)ut=f[ue],It=f[Ne],ut._code&pn?It._code&pn||(Yn=at(It,ut,pn,x,k),Yn._code=ht(Yn,x),U.push(Yn)):(It._code&pn&&(Yn=at(It,ut,pn,x,k),Yn._code=ht(Yn,x),U.push(Yn)),U.push(ut));f=U}return f}function Nl(f,x){var k,U,X,ue,Ne,nt,ut,It,Xt;if(!f||f.length===0)throw new Error("latlngs not passed");Kn(f)||(console.warn("latlngs are not flat! Only the first ring will be used"),f=f[0]);var pn=Wt([0,0]),Yn=Ut(f),_a=Yn.getNorthWest().distanceTo(Yn.getSouthWest())*Yn.getNorthEast().distanceTo(Yn.getNorthWest());_a<1700&&(pn=ll(f));var Zr=f.length,Za=[];for(k=0;k<Zr;k++){var Si=Wt(f[k]);Za.push(x.project(Wt([Si.lat-pn.lat,Si.lng-pn.lng])))}for(nt=ut=It=0,k=0,U=Zr-1;k<Zr;U=k++)X=Za[k],ue=Za[U],Ne=X.y*ue.x-ue.y*X.x,ut+=(X.x+ue.x)*Ne,It+=(X.y+ue.y)*Ne,nt+=Ne*3;nt===0?Xt=Za[0]:Xt=[ut/nt,It/nt];var ki=x.unproject(Bt(Xt));return Wt([ki.lat+pn.lat,ki.lng+pn.lng])}function ll(f){for(var x=0,k=0,U=0,X=0;X<f.length;X++){var ue=Wt(f[X]);x+=ue.lat,k+=ue.lng,U++}return Wt([x/U,k/U])}var co={__proto__:null,clipPolygon:Ts,polygonCenter:Nl,centroid:ll};function Ai(f,x){if(!x||!f.length)return f.slice();var k=x*x;return f=H(f,k),f=Bl(f,k),f}function Wu(f,x,k){return Math.sqrt(Ln(f,x,k,!0))}function pu(f,x,k){return Ln(f,x,k)}function Bl(f,x){var k=f.length,U=typeof Uint8Array<"u"?Uint8Array:Array,X=new U(k);X[0]=X[k-1]=1,M(f,X,x,0,k-1);var ue,Ne=[];for(ue=0;ue<k;ue++)X[ue]&&Ne.push(f[ue]);return Ne}function M(f,x,k,U,X){var ue=0,Ne,nt,ut;for(nt=U+1;nt<=X-1;nt++)ut=Ln(f[nt],f[U],f[X],!0),ut>ue&&(Ne=nt,ue=ut);ue>k&&(x[Ne]=1,M(f,x,k,U,Ne),M(f,x,k,Ne,X))}function H(f,x){for(var k=[f[0]],U=1,X=0,ue=f.length;U<ue;U++)Kt(f[U],f[X])>x&&(k.push(f[U]),X=U);return X<ue-1&&k.push(f[ue-1]),k}var ne;function ye(f,x,k,U,X){var ue=U?ne:ht(f,k),Ne=ht(x,k),nt,ut,It;for(ne=Ne;;){if(!(ue|Ne))return[f,x];if(ue&Ne)return!1;nt=ue||Ne,ut=at(f,x,nt,k,X),It=ht(ut,k),nt===ue?(f=ut,ue=It):(x=ut,Ne=It)}}function at(f,x,k,U,X){var ue=x.x-f.x,Ne=x.y-f.y,nt=U.min,ut=U.max,It,Xt;return k&8?(It=f.x+ue*(ut.y-f.y)/Ne,Xt=ut.y):k&4?(It=f.x+ue*(nt.y-f.y)/Ne,Xt=nt.y):k&2?(It=ut.x,Xt=f.y+Ne*(ut.x-f.x)/ue):k&1&&(It=nt.x,Xt=f.y+Ne*(nt.x-f.x)/ue),new Tt(It,Xt,X)}function ht(f,x){var k=0;return f.x<x.min.x?k|=1:f.x>x.max.x&&(k|=2),f.y<x.min.y?k|=4:f.y>x.max.y&&(k|=8),k}function Kt(f,x){var k=x.x-f.x,U=x.y-f.y;return k*k+U*U}function Ln(f,x,k,U){var X=x.x,ue=x.y,Ne=k.x-X,nt=k.y-ue,ut=Ne*Ne+nt*nt,It;return ut>0&&(It=((f.x-X)*Ne+(f.y-ue)*nt)/ut,It>1?(X=k.x,ue=k.y):It>0&&(X+=Ne*It,ue+=nt*It)),Ne=f.x-X,nt=f.y-ue,U?Ne*Ne+nt*nt:new Tt(X,ue)}function Kn(f){return!qe(f[0])||typeof f[0][0]!="object"&&typeof f[0][0]<"u"}function Ti(f){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),Kn(f)}function Xi(f,x){var k,U,X,ue,Ne,nt,ut,It;if(!f||f.length===0)throw new Error("latlngs not passed");Kn(f)||(console.warn("latlngs are not flat! Only the first ring will be used"),f=f[0]);var Xt=Wt([0,0]),pn=Ut(f),Yn=pn.getNorthWest().distanceTo(pn.getSouthWest())*pn.getNorthEast().distanceTo(pn.getNorthWest());Yn<1700&&(Xt=ll(f));var _a=f.length,Zr=[];for(k=0;k<_a;k++){var Za=Wt(f[k]);Zr.push(x.project(Wt([Za.lat-Xt.lat,Za.lng-Xt.lng])))}for(k=0,U=0;k<_a-1;k++)U+=Zr[k].distanceTo(Zr[k+1])/2;if(U===0)It=Zr[0];else for(k=0,ue=0;k<_a-1;k++)if(Ne=Zr[k],nt=Zr[k+1],X=Ne.distanceTo(nt),ue+=X,ue>U){ut=(ue-U)/X,It=[nt.x-ut*(nt.x-Ne.x),nt.y-ut*(nt.y-Ne.y)];break}var Si=x.unproject(Bt(It));return Wt([Si.lat+Xt.lat,Si.lng+Xt.lng])}var Ga={__proto__:null,simplify:Ai,pointToSegmentDistance:Wu,closestPointOnSegment:pu,clipSegment:ye,_getEdgeIntersection:at,_getBitCode:ht,_sqClosestPointOnSegment:Ln,isFlat:Kn,_flat:Ti,polylineCenter:Xi},Ha={project:function(f){return new Tt(f.lng,f.lat)},unproject:function(f){return new Jt(f.y,f.x)},bounds:new Le([-180,-90],[180,90])},Ks={R:6378137,R_MINOR:6356752314245179e-9,bounds:new Le([-2003750834279e-5,-1549657073972e-5],[2003750834279e-5,1876465623138e-5]),project:function(f){var x=Math.PI/180,k=this.R,U=f.lat*x,X=this.R_MINOR/k,ue=Math.sqrt(1-X*X),Ne=ue*Math.sin(U),nt=Math.tan(Math.PI/4-U/2)/Math.pow((1-Ne)/(1+Ne),ue/2);return U=-k*Math.log(Math.max(nt,1e-10)),new Tt(f.lng*x*k,U)},unproject:function(f){for(var x=180/Math.PI,k=this.R,U=this.R_MINOR/k,X=Math.sqrt(1-U*U),ue=Math.exp(-f.y/k),Ne=Math.PI/2-2*Math.atan(ue),nt=0,ut=.1,It;nt<15&&Math.abs(ut)>1e-7;nt++)It=X*Math.sin(Ne),It=Math.pow((1-It)/(1+It),X/2),ut=Math.PI/2-2*Math.atan(ue*It)-Ne,Ne+=ut;return new Jt(Ne*x,f.x*x/k)}},Ss={__proto__:null,LonLat:Ha,Mercator:Ks,SphericalMercator:fs},mu=d({},oi,{code:"EPSG:3395",projection:Ks,transformation:(function(){var f=.5/(Math.PI*Ks.R);return Dr(f,.5,-f,.5)})()}),Xs=d({},oi,{code:"EPSG:4326",projection:Ha,transformation:Dr(1/180,1,-1/180,.5)}),gu=d({},Fn,{projection:Ha,transformation:Dr(1,0,-1,0),scale:function(f){return Math.pow(2,f)},zoom:function(f){return Math.log(f)/Math.LN2},distance:function(f,x){var k=x.lng-f.lng,U=x.lat-f.lat;return Math.sqrt(k*k+U*U)},infinite:!0});Fn.Earth=oi,Fn.EPSG3395=mu,Fn.EPSG3857=Fi,Fn.EPSG900913=Mi,Fn.EPSG4326=Xs,Fn.Simple=gu;var Ys=$t.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(f){return f.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(f){return f&&f.removeLayer(this),this},getPane:function(f){return this._map.getPane(f?this.options[f]||f:this.options.pane)},addInteractiveTarget:function(f){return this._map._targets[C(f)]=this,this},removeInteractiveTarget:function(f){return delete this._map._targets[C(f)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(f){var x=f.target;if(x.hasLayer(this)){if(this._map=x,this._zoomAnimated=x._zoomAnimated,this.getEvents){var k=this.getEvents();x.on(k,this),this.once("remove",function(){x.off(k,this)},this)}this.onAdd(x),this.fire("add"),x.fire("layeradd",{layer:this})}}});Wn.include({addLayer:function(f){if(!f._layerAdd)throw new Error("The provided object is not a Layer.");var x=C(f);return this._layers[x]?this:(this._layers[x]=f,f._mapToAdd=this,f.beforeAdd&&f.beforeAdd(this),this.whenReady(f._layerAdd,f),this)},removeLayer:function(f){var x=C(f);return this._layers[x]?(this._loaded&&f.onRemove(this),delete this._layers[x],this._loaded&&(this.fire("layerremove",{layer:f}),f.fire("remove")),f._map=f._mapToAdd=null,this):this},hasLayer:function(f){return C(f)in this._layers},eachLayer:function(f,x){for(var k in this._layers)f.call(x,this._layers[k]);return this},_addLayers:function(f){f=f?qe(f)?f:[f]:[];for(var x=0,k=f.length;x<k;x++)this.addLayer(f[x])},_addZoomLimit:function(f){(!isNaN(f.options.maxZoom)||!isNaN(f.options.minZoom))&&(this._zoomBoundLayers[C(f)]=f,this._updateZoomLevels())},_removeZoomLimit:function(f){var x=C(f);this._zoomBoundLayers[x]&&(delete this._zoomBoundLayers[x],this._updateZoomLevels())},_updateZoomLevels:function(){var f=1/0,x=-1/0,k=this._getZoomSpan();for(var U in this._zoomBoundLayers){var X=this._zoomBoundLayers[U].options;f=X.minZoom===void 0?f:Math.min(f,X.minZoom),x=X.maxZoom===void 0?x:Math.max(x,X.maxZoom)}this._layersMaxZoom=x===-1/0?void 0:x,this._layersMinZoom=f===1/0?void 0:f,k!==this._getZoomSpan()&&this.fire("zoomlevelschange"),this.options.maxZoom===void 0&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),this.options.minZoom===void 0&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var Ku=Ys.extend({initialize:function(f,x){be(this,x),this._layers={};var k,U;if(f)for(k=0,U=f.length;k<U;k++)this.addLayer(f[k])},addLayer:function(f){var x=this.getLayerId(f);return this._layers[x]=f,this._map&&this._map.addLayer(f),this},removeLayer:function(f){var x=f in this._layers?f:this.getLayerId(f);return this._map&&this._layers[x]&&this._map.removeLayer(this._layers[x]),delete this._layers[x],this},hasLayer:function(f){var x=typeof f=="number"?f:this.getLayerId(f);return x in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(f){var x=Array.prototype.slice.call(arguments,1),k,U;for(k in this._layers)U=this._layers[k],U[f]&&U[f].apply(U,x);return this},onAdd:function(f){this.eachLayer(f.addLayer,f)},onRemove:function(f){this.eachLayer(f.removeLayer,f)},eachLayer:function(f,x){for(var k in this._layers)f.call(x,this._layers[k]);return this},getLayer:function(f){return this._layers[f]},getLayers:function(){var f=[];return this.eachLayer(f.push,f),f},setZIndex:function(f){return this.invoke("setZIndex",f)},getLayerId:function(f){return C(f)}}),Jd=function(f,x){return new Ku(f,x)},ho=Ku.extend({addLayer:function(f){return this.hasLayer(f)?this:(f.addEventParent(this),Ku.prototype.addLayer.call(this,f),this.fire("layeradd",{layer:f}))},removeLayer:function(f){return this.hasLayer(f)?(f in this._layers&&(f=this._layers[f]),f.removeEventParent(this),Ku.prototype.removeLayer.call(this,f),this.fire("layerremove",{layer:f})):this},setStyle:function(f){return this.invoke("setStyle",f)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var f=new Ot;for(var x in this._layers){var k=this._layers[x];f.extend(k.getBounds?k.getBounds():k.getLatLng())}return f}}),rd=function(f,x){return new ho(f,x)},Qs=Pn.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(f){be(this,f)},createIcon:function(f){return this._createIcon("icon",f)},createShadow:function(f){return this._createIcon("shadow",f)},_createIcon:function(f,x){var k=this._getIconUrl(f);if(!k){if(f==="icon")throw new Error("iconUrl not set in Icon options (see the docs).");return null}var U=this._createImg(k,x&&x.tagName==="IMG"?x:null);return this._setIconStyles(U,f),(this.options.crossOrigin||this.options.crossOrigin==="")&&(U.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),U},_setIconStyles:function(f,x){var k=this.options,U=k[x+"Size"];typeof U=="number"&&(U=[U,U]);var X=Bt(U),ue=Bt(x==="shadow"&&k.shadowAnchor||k.iconAnchor||X&&X.divideBy(2,!0));f.className="leaflet-marker-"+x+" "+(k.className||""),ue&&(f.style.marginLeft=-ue.x+"px",f.style.marginTop=-ue.y+"px"),X&&(f.style.width=X.x+"px",f.style.height=X.y+"px")},_createImg:function(f,x){return x=x||document.createElement("img"),x.src=f,x},_getIconUrl:function(f){return en.retina&&this.options[f+"RetinaUrl"]||this.options[f+"Url"]}});function Xu(f){return new Qs(f)}var Yu=Qs.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(f){return typeof Yu.imagePath!="string"&&(Yu.imagePath=this._detectIconPath()),(this.options.imagePath||Yu.imagePath)+Qs.prototype._getIconUrl.call(this,f)},_stripUrl:function(f){var x=function(k,U,X){var ue=U.exec(k);return ue&&ue[X]};return f=x(f,/^url\((['"])?(.+)\1\)$/,2),f&&x(f,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var f=ii("div","leaflet-default-icon-path",document.body),x=al(f,"background-image")||al(f,"backgroundImage");if(document.body.removeChild(f),x=this._stripUrl(x),x)return x;var k=document.querySelector('link[href$="leaflet.css"]');return k?k.href.substring(0,k.href.length-11-1):""}}),ko=Ws.extend({initialize:function(f){this._marker=f},addHooks:function(){var f=this._marker._icon;this._draggable||(this._draggable=new ts(f,f,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),on(f,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&Ui(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(f){var x=this._marker,k=x._map,U=this._marker.options.autoPanSpeed,X=this._marker.options.autoPanPadding,ue=Ja(x._icon),Ne=k.getPixelBounds(),nt=k.getPixelOrigin(),ut=vt(Ne.min._subtract(nt).add(X),Ne.max._subtract(nt).subtract(X));if(!ut.contains(ue)){var It=Bt((Math.max(ut.max.x,ue.x)-ut.max.x)/(Ne.max.x-ut.max.x)-(Math.min(ut.min.x,ue.x)-ut.min.x)/(Ne.min.x-ut.min.x),(Math.max(ut.max.y,ue.y)-ut.max.y)/(Ne.max.y-ut.max.y)-(Math.min(ut.min.y,ue.y)-ut.min.y)/(Ne.min.y-ut.min.y)).multiplyBy(U);k.panBy(It,{animate:!1}),this._draggable._newPos._add(It),this._draggable._startPos._add(It),ar(x._icon,this._draggable._newPos),this._onDrag(f),this._panRequest=Me(this._adjustPan.bind(this,f))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(f){this._marker.options.autoPan&&(Ge(this._panRequest),this._panRequest=Me(this._adjustPan.bind(this,f)))},_onDrag:function(f){var x=this._marker,k=x._shadow,U=Ja(x._icon),X=x._map.layerPointToLatLng(U);k&&ar(k,U),x._latlng=X,f.latlng=X,f.oldLatLng=this._oldLatLng,x.fire("move",f).fire("drag",f)},_onDragEnd:function(f){Ge(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",f)}}),_u=Ys.extend({options:{icon:new Yu,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(f,x){be(this,x),this._latlng=Wt(f)},onAdd:function(f){this._zoomAnimated=this._zoomAnimated&&f.options.markerZoomAnimation,this._zoomAnimated&&f.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(f){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&f.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(f){var x=this._latlng;return this._latlng=Wt(f),this.update(),this.fire("move",{oldLatLng:x,latlng:this._latlng})},setZIndexOffset:function(f){return this.options.zIndexOffset=f,this.update()},getIcon:function(){return this.options.icon},setIcon:function(f){return this.options.icon=f,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var f=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(f)}return this},_initIcon:function(){var f=this.options,x="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),k=f.icon.createIcon(this._icon),U=!1;k!==this._icon&&(this._icon&&this._removeIcon(),U=!0,f.title&&(k.title=f.title),k.tagName==="IMG"&&(k.alt=f.alt||"")),on(k,x),f.keyboard&&(k.tabIndex="0",k.setAttribute("role","button")),this._icon=k,f.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&hn(k,"focus",this._panOnFocus,this);var X=f.icon.createShadow(this._shadow),ue=!1;X!==this._shadow&&(this._removeShadow(),ue=!0),X&&(on(X,x),X.alt=""),this._shadow=X,f.opacity<1&&this._updateOpacity(),U&&this.getPane().appendChild(this._icon),this._initInteraction(),X&&ue&&this.getPane(f.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&xn(this._icon,"focus",this._panOnFocus,this),hi(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&hi(this._shadow),this._shadow=null},_setPos:function(f){this._icon&&ar(this._icon,f),this._shadow&&ar(this._shadow,f),this._zIndex=f.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(f){this._icon&&(this._icon.style.zIndex=this._zIndex+f)},_animateZoom:function(f){var x=this._map._latLngToNewLayerPoint(this._latlng,f.zoom,f.center).round();this._setPos(x)},_initInteraction:function(){if(this.options.interactive&&(on(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),ko)){var f=this.options.draggable;this.dragging&&(f=this.dragging.enabled(),this.dragging.disable()),this.dragging=new ko(this),f&&this.dragging.enable()}},setOpacity:function(f){return this.options.opacity=f,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var f=this.options.opacity;this._icon&&rr(this._icon,f),this._shadow&&rr(this._shadow,f)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var f=this._map;if(f){var x=this.options.icon.options,k=x.iconSize?Bt(x.iconSize):Bt(0,0),U=x.iconAnchor?Bt(x.iconAnchor):Bt(0,0);f.panInside(this._latlng,{paddingTopLeft:U,paddingBottomRight:k.subtract(U)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});function yh(f,x){return new _u(f,x)}var Es=Ys.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(f){this._renderer=f.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(f){return be(this,f),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&f&&Object.prototype.hasOwnProperty.call(f,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),Qu=Es.extend({options:{fill:!0,radius:10},initialize:function(f,x){be(this,x),this._latlng=Wt(f),this._radius=this.options.radius},setLatLng:function(f){var x=this._latlng;return this._latlng=Wt(f),this.redraw(),this.fire("move",{oldLatLng:x,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(f){return this.options.radius=this._radius=f,this.redraw()},getRadius:function(){return this._radius},setStyle:function(f){var x=f&&f.radius||this._radius;return Es.prototype.setStyle.call(this,f),this.setRadius(x),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var f=this._radius,x=this._radiusY||f,k=this._clickTolerance(),U=[f+k,x+k];this._pxBounds=new Le(this._point.subtract(U),this._point.add(U))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(f){return f.distanceTo(this._point)<=this._radius+this._clickTolerance()}});function Ju(f,x){return new Qu(f,x)}var Fc=Qu.extend({initialize:function(f,x,k){if(typeof x=="number"&&(x=d({},k,{radius:x})),be(this,x),this._latlng=Wt(f),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(f){return this._mRadius=f,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var f=[this._radius,this._radiusY||this._radius];return new Ot(this._map.layerPointToLatLng(this._point.subtract(f)),this._map.layerPointToLatLng(this._point.add(f)))},setStyle:Es.prototype.setStyle,_project:function(){var f=this._latlng.lng,x=this._latlng.lat,k=this._map,U=k.options.crs;if(U.distance===oi.distance){var X=Math.PI/180,ue=this._mRadius/oi.R/X,Ne=k.project([x+ue,f]),nt=k.project([x-ue,f]),ut=Ne.add(nt).divideBy(2),It=k.unproject(ut).lat,Xt=Math.acos((Math.cos(ue*X)-Math.sin(x*X)*Math.sin(It*X))/(Math.cos(x*X)*Math.cos(It*X)))/X;(isNaN(Xt)||Xt===0)&&(Xt=ue/Math.cos(Math.PI/180*x)),this._point=ut.subtract(k.getPixelOrigin()),this._radius=isNaN(Xt)?0:ut.x-k.project([It,f-Xt]).x,this._radiusY=ut.y-Ne.y}else{var pn=U.unproject(U.project(this._latlng).subtract([this._mRadius,0]));this._point=k.latLngToLayerPoint(this._latlng),this._radius=this._point.x-k.latLngToLayerPoint(pn).x}this._updateBounds()}});function ef(f,x,k){return new Fc(f,x,k)}var ul=Es.extend({options:{smoothFactor:1,noClip:!1},initialize:function(f,x){be(this,x),this._setLatLngs(f)},getLatLngs:function(){return this._latlngs},setLatLngs:function(f){return this._setLatLngs(f),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(f){for(var x=1/0,k=null,U=Ln,X,ue,Ne=0,nt=this._parts.length;Ne<nt;Ne++)for(var ut=this._parts[Ne],It=1,Xt=ut.length;It<Xt;It++){X=ut[It-1],ue=ut[It];var pn=U(f,X,ue,!0);pn<x&&(x=pn,k=U(f,X,ue))}return k&&(k.distance=Math.sqrt(x)),k},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return Xi(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(f,x){return x=x||this._defaultShape(),f=Wt(f),x.push(f),this._bounds.extend(f),this.redraw()},_setLatLngs:function(f){this._bounds=new Ot,this._latlngs=this._convertLatLngs(f)},_defaultShape:function(){return Kn(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(f){for(var x=[],k=Kn(f),U=0,X=f.length;U<X;U++)k?(x[U]=Wt(f[U]),this._bounds.extend(x[U])):x[U]=this._convertLatLngs(f[U]);return x},_project:function(){var f=new Le;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,f),this._bounds.isValid()&&f.isValid()&&(this._rawPxBounds=f,this._updateBounds())},_updateBounds:function(){var f=this._clickTolerance(),x=new Tt(f,f);this._rawPxBounds&&(this._pxBounds=new Le([this._rawPxBounds.min.subtract(x),this._rawPxBounds.max.add(x)]))},_projectLatlngs:function(f,x,k){var U=f[0]instanceof Jt,X=f.length,ue,Ne;if(U){for(Ne=[],ue=0;ue<X;ue++)Ne[ue]=this._map.latLngToLayerPoint(f[ue]),k.extend(Ne[ue]);x.push(Ne)}else for(ue=0;ue<X;ue++)this._projectLatlngs(f[ue],x,k)},_clipPoints:function(){var f=this._renderer._bounds;if(this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(f))){if(this.options.noClip){this._parts=this._rings;return}var x=this._parts,k,U,X,ue,Ne,nt,ut;for(k=0,X=0,ue=this._rings.length;k<ue;k++)for(ut=this._rings[k],U=0,Ne=ut.length;U<Ne-1;U++)nt=ye(ut[U],ut[U+1],f,U,!0),nt&&(x[X]=x[X]||[],x[X].push(nt[0]),(nt[1]!==ut[U+1]||U===Ne-2)&&(x[X].push(nt[1]),X++))}},_simplifyPoints:function(){for(var f=this._parts,x=this.options.smoothFactor,k=0,U=f.length;k<U;k++)f[k]=Ai(f[k],x)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(f,x){var k,U,X,ue,Ne,nt,ut=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(f))return!1;for(k=0,ue=this._parts.length;k<ue;k++)for(nt=this._parts[k],U=0,Ne=nt.length,X=Ne-1;U<Ne;X=U++)if(!(!x&&U===0)&&Wu(f,nt[X],nt[U])<=ut)return!0;return!1}});function tf(f,x){return new ul(f,x)}ul._flat=Ti;var Kl=ul.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return Nl(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(f){var x=ul.prototype._convertLatLngs.call(this,f),k=x.length;return k>=2&&x[0]instanceof Jt&&x[0].equals(x[k-1])&&x.pop(),x},_setLatLngs:function(f){ul.prototype._setLatLngs.call(this,f),Kn(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return Kn(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var f=this._renderer._bounds,x=this.options.weight,k=new Tt(x,x);if(f=new Le(f.min.subtract(k),f.max.add(k)),this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(f))){if(this.options.noClip){this._parts=this._rings;return}for(var U=0,X=this._rings.length,ue;U<X;U++)ue=Ts(this._rings[U],f,!0),ue.length&&this._parts.push(ue)}},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(f){var x=!1,k,U,X,ue,Ne,nt,ut,It;if(!this._pxBounds||!this._pxBounds.contains(f))return!1;for(ue=0,ut=this._parts.length;ue<ut;ue++)for(k=this._parts[ue],Ne=0,It=k.length,nt=It-1;Ne<It;nt=Ne++)U=k[Ne],X=k[nt],U.y>f.y!=X.y>f.y&&f.x<(X.x-U.x)*(f.y-U.y)/(X.y-U.y)+U.x&&(x=!x);return x||ul.prototype._containsPoint.call(this,f,!0)}});function ad(f,x){return new Kl(f,x)}var cl=ho.extend({initialize:function(f,x){be(this,x),this._layers={},f&&this.addData(f)},addData:function(f){var x=qe(f)?f:f.features,k,U,X;if(x){for(k=0,U=x.length;k<U;k++)X=x[k],(X.geometries||X.geometry||X.features||X.coordinates)&&this.addData(X);return this}var ue=this.options;if(ue.filter&&!ue.filter(f))return this;var Ne=aa(f,ue);return Ne?(Ne.feature=dl(f),Ne.defaultOptions=Ne.options,this.resetStyle(Ne),ue.onEachFeature&&ue.onEachFeature(f,Ne),this.addLayer(Ne)):this},resetStyle:function(f){return f===void 0?this.eachLayer(this.resetStyle,this):(f.options=d({},f.defaultOptions),this._setLayerStyle(f,this.options.style),this)},setStyle:function(f){return this.eachLayer(function(x){this._setLayerStyle(x,f)},this)},_setLayerStyle:function(f,x){f.setStyle&&(typeof x=="function"&&(x=x(f.feature)),f.setStyle(x))}});function aa(f,x){var k=f.type==="Feature"?f.geometry:f,U=k?k.coordinates:null,X=[],ue=x&&x.pointToLayer,Ne=x&&x.coordsToLatLng||li,nt,ut,It,Xt;if(!U&&!k)return null;switch(k.type){case"Point":return nt=Ne(U),As(ue,f,nt,x);case"MultiPoint":for(It=0,Xt=U.length;It<Xt;It++)nt=Ne(U[It]),X.push(As(ue,f,nt,x));return new ho(X);case"LineString":case"MultiLineString":return ut=yu(U,k.type==="LineString"?0:1,Ne),new ul(ut,x);case"Polygon":case"MultiPolygon":return ut=yu(U,k.type==="Polygon"?1:2,Ne),new Kl(ut,x);case"GeometryCollection":for(It=0,Xt=k.geometries.length;It<Xt;It++){var pn=aa({geometry:k.geometries[It],type:"Feature",properties:f.properties},x);pn&&X.push(pn)}return new ho(X);case"FeatureCollection":for(It=0,Xt=k.features.length;It<Xt;It++){var Yn=aa(k.features[It],x);Yn&&X.push(Yn)}return new ho(X);default:throw new Error("Invalid GeoJSON object.")}}function As(f,x,k,U){return f?f(x,k):new _u(k,U&&U.markersInheritOptions&&U)}function li(f){return new Jt(f[1],f[0],f[2])}function yu(f,x,k){for(var U=[],X=0,ue=f.length,Ne;X<ue;X++)Ne=x?yu(f[X],x-1,k):(k||li)(f[X]),U.push(Ne);return U}function ec(f,x){return f=Wt(f),f.alt!==void 0?[J(f.lng,x),J(f.lat,x),J(f.alt,x)]:[J(f.lng,x),J(f.lat,x)]}function tc(f,x,k,U){for(var X=[],ue=0,Ne=f.length;ue<Ne;ue++)X.push(x?tc(f[ue],Kn(f[ue])?0:x-1,k,U):ec(f[ue],U));return!x&&k&&X.length>0&&X.push(X[0].slice()),X}function hl(f,x){return f.feature?d({},f.feature,{geometry:x}):dl(x)}function dl(f){return f.type==="Feature"||f.type==="FeatureCollection"?f:{type:"Feature",properties:{},geometry:f}}var fl={toGeoJSON:function(f){return hl(this,{type:"Point",coordinates:ec(this.getLatLng(),f)})}};_u.include(fl),Fc.include(fl),Qu.include(fl),ul.include({toGeoJSON:function(f){var x=!Kn(this._latlngs),k=tc(this._latlngs,x?1:0,!1,f);return hl(this,{type:(x?"Multi":"")+"LineString",coordinates:k})}}),Kl.include({toGeoJSON:function(f){var x=!Kn(this._latlngs),k=x&&!Kn(this._latlngs[0]),U=tc(this._latlngs,k?2:x?1:0,!0,f);return x||(U=[U]),hl(this,{type:(k?"Multi":"")+"Polygon",coordinates:U})}}),Ku.include({toMultiPoint:function(f){var x=[];return this.eachLayer(function(k){x.push(k.toGeoJSON(f).geometry.coordinates)}),hl(this,{type:"MultiPoint",coordinates:x})},toGeoJSON:function(f){var x=this.feature&&this.feature.geometry&&this.feature.geometry.type;if(x==="MultiPoint")return this.toMultiPoint(f);var k=x==="GeometryCollection",U=[];return this.eachLayer(function(X){if(X.toGeoJSON){var ue=X.toGeoJSON(f);if(k)U.push(ue.geometry);else{var Ne=dl(ue);Ne.type==="FeatureCollection"?U.push.apply(U,Ne.features):U.push(Ne)}}}),k?hl(this,{geometries:U,type:"GeometryCollection"}):{type:"FeatureCollection",features:U}}});function vh(f,x){return new cl(f,x)}var Vc=vh,nc=Ys.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(f,x,k){this._url=f,this._bounds=Ut(x),be(this,k)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(on(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){hi(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(f){return this.options.opacity=f,this._image&&this._updateOpacity(),this},setStyle:function(f){return f.opacity&&this.setOpacity(f.opacity),this},bringToFront:function(){return this._map&&xr(this._image),this},bringToBack:function(){return this._map&&Gs(this._image),this},setUrl:function(f){return this._url=f,this._image&&(this._image.src=f),this},setBounds:function(f){return this._bounds=Ut(f),this._map&&this._reset(),this},getEvents:function(){var f={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(f.zoomanim=this._animateZoom),f},setZIndex:function(f){return this.options.zIndex=f,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var f=this._url.tagName==="IMG",x=this._image=f?this._url:ii("img");if(on(x,"leaflet-image-layer"),this._zoomAnimated&&on(x,"leaflet-zoom-animated"),this.options.className&&on(x,this.options.className),x.onselectstart=q,x.onmousemove=q,x.onload=g(this.fire,this,"load"),x.onerror=g(this._overlayOnError,this,"error"),(this.options.crossOrigin||this.options.crossOrigin==="")&&(x.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),f){this._url=x.src;return}x.src=this._url,x.alt=this.options.alt},_animateZoom:function(f){var x=this._map.getZoomScale(f.zoom),k=this._map._latLngBoundsToNewLayerBounds(this._bounds,f.zoom,f.center).min;Hs(this._image,k,x)},_reset:function(){var f=this._image,x=new Le(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),k=x.getSize();ar(f,x.min),f.style.width=k.x+"px",f.style.height=k.y+"px"},_updateOpacity:function(){rr(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var f=this.options.errorOverlayUrl;f&&this._url!==f&&(this._url=f,this._image.src=f)},getCenter:function(){return this._bounds.getCenter()}}),nf=function(f,x,k){return new nc(f,x,k)},Fl=nc.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var f=this._url.tagName==="VIDEO",x=this._image=f?this._url:ii("video");if(on(x,"leaflet-image-layer"),this._zoomAnimated&&on(x,"leaflet-zoom-animated"),this.options.className&&on(x,this.options.className),x.onselectstart=q,x.onmousemove=q,x.onloadeddata=g(this.fire,this,"load"),f){for(var k=x.getElementsByTagName("source"),U=[],X=0;X<k.length;X++)U.push(k[X].src);this._url=k.length>0?U:[x.src];return}qe(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(x.style,"objectFit")&&(x.style.objectFit="fill"),x.autoplay=!!this.options.autoplay,x.loop=!!this.options.loop,x.muted=!!this.options.muted,x.playsInline=!!this.options.playsInline;for(var ue=0;ue<this._url.length;ue++){var Ne=ii("source");Ne.src=this._url[ue],x.appendChild(Ne)}}});function ic(f,x,k){return new Fl(f,x,k)}var Uc=nc.extend({_initImage:function(){var f=this._image=this._url;on(f,"leaflet-image-layer"),this._zoomAnimated&&on(f,"leaflet-zoom-animated"),this.options.className&&on(f,this.options.className),f.onselectstart=q,f.onmousemove=q}});function jc(f,x,k){return new Uc(f,x,k)}var sa=Ys.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(f,x){f&&(f instanceof Jt||qe(f))?(this._latlng=Wt(f),be(this,x)):(be(this,f),this._source=x),this.options.content&&(this._content=this.options.content)},openOn:function(f){return f=arguments.length?f:this._source._map,f.hasLayer(this)||f.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(f){return this._map?this.close():(arguments.length?this._source=f:f=this._source,this._prepareOpen(),this.openOn(f._map)),this},onAdd:function(f){this._zoomAnimated=f._zoomAnimated,this._container||this._initLayout(),f._fadeAnimated&&rr(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),f._fadeAnimated&&rr(this._container,1),this.bringToFront(),this.options.interactive&&(on(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(f){f._fadeAnimated?(rr(this._container,0),this._removeTimeout=setTimeout(g(hi,void 0,this._container),200)):hi(this._container),this.options.interactive&&(Ui(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(f){return this._latlng=Wt(f),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(f){return this._content=f,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var f={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(f.zoomanim=this._animateZoom),f},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&xr(this._container),this},bringToBack:function(){return this._map&&Gs(this._container),this},_prepareOpen:function(f){var x=this._source;if(!x._map)return!1;if(x instanceof ho){x=null;var k=this._source._layers;for(var U in k)if(k[U]._map){x=k[U];break}if(!x)return!1;this._source=x}if(!f)if(x.getCenter)f=x.getCenter();else if(x.getLatLng)f=x.getLatLng();else if(x.getBounds)f=x.getBounds().getCenter();else throw new Error("Unable to get source layer LatLng.");return this.setLatLng(f),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var f=this._contentNode,x=typeof this._content=="function"?this._content(this._source||this):this._content;if(typeof x=="string")f.innerHTML=x;else{for(;f.hasChildNodes();)f.removeChild(f.firstChild);f.appendChild(x)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var f=this._map.latLngToLayerPoint(this._latlng),x=Bt(this.options.offset),k=this._getAnchor();this._zoomAnimated?ar(this._container,f.add(k)):x=x.add(f).add(k);var U=this._containerBottom=-x.y,X=this._containerLeft=-Math.round(this._containerWidth/2)+x.x;this._container.style.bottom=U+"px",this._container.style.left=X+"px"}},_getAnchor:function(){return[0,0]}});Wn.include({_initOverlay:function(f,x,k,U){var X=x;return X instanceof f||(X=new f(U).setContent(x)),k&&X.setLatLng(k),X}}),Ys.include({_initOverlay:function(f,x,k,U){var X=k;return X instanceof f?(be(X,U),X._source=this):(X=x&&!U?x:new f(U,this),X.setContent(k)),X}});var Xl=sa.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(f){return f=arguments.length?f:this._source._map,!f.hasLayer(this)&&f._popup&&f._popup.options.autoClose&&f.removeLayer(f._popup),f._popup=this,sa.prototype.openOn.call(this,f)},onAdd:function(f){sa.prototype.onAdd.call(this,f),f.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof Es||this._source.on("preclick",bn))},onRemove:function(f){sa.prototype.onRemove.call(this,f),f.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof Es||this._source.off("preclick",bn))},getEvents:function(){var f=sa.prototype.getEvents.call(this);return(this.options.closeOnClick!==void 0?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(f.preclick=this.close),this.options.keepInView&&(f.moveend=this._adjustPan),f},_initLayout:function(){var f="leaflet-popup",x=this._container=ii("div",f+" "+(this.options.className||"")+" leaflet-zoom-animated"),k=this._wrapper=ii("div",f+"-content-wrapper",x);if(this._contentNode=ii("div",f+"-content",k),fn(x),pa(this._contentNode),hn(x,"contextmenu",bn),this._tipContainer=ii("div",f+"-tip-container",x),this._tip=ii("div",f+"-tip",this._tipContainer),this.options.closeButton){var U=this._closeButton=ii("a",f+"-close-button",x);U.setAttribute("role","button"),U.setAttribute("aria-label","Close popup"),U.href="#close",U.innerHTML='<span aria-hidden="true">&#215;</span>',hn(U,"click",function(X){sn(X),this.close()},this)}},_updateLayout:function(){var f=this._contentNode,x=f.style;x.width="",x.whiteSpace="nowrap";var k=f.offsetWidth;k=Math.min(k,this.options.maxWidth),k=Math.max(k,this.options.minWidth),x.width=k+1+"px",x.whiteSpace="",x.height="";var U=f.offsetHeight,X=this.options.maxHeight,ue="leaflet-popup-scrolled";X&&U>X?(x.height=X+"px",on(f,ue)):Ui(f,ue),this._containerWidth=this._container.offsetWidth},_animateZoom:function(f){var x=this._map._latLngToNewLayerPoint(this._latlng,f.zoom,f.center),k=this._getAnchor();ar(this._container,x.add(k))},_adjustPan:function(){if(this.options.autoPan){if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning){this._autopanning=!1;return}var f=this._map,x=parseInt(al(this._container,"marginBottom"),10)||0,k=this._container.offsetHeight+x,U=this._containerWidth,X=new Tt(this._containerLeft,-k-this._containerBottom);X._add(Ja(this._container));var ue=f.layerPointToContainerPoint(X),Ne=Bt(this.options.autoPanPadding),nt=Bt(this.options.autoPanPaddingTopLeft||Ne),ut=Bt(this.options.autoPanPaddingBottomRight||Ne),It=f.getSize(),Xt=0,pn=0;ue.x+U+ut.x>It.x&&(Xt=ue.x+U-It.x+ut.x),ue.x-Xt-nt.x<0&&(Xt=ue.x-nt.x),ue.y+k+ut.y>It.y&&(pn=ue.y+k-It.y+ut.y),ue.y-pn-nt.y<0&&(pn=ue.y-nt.y),(Xt||pn)&&(this.options.keepInView&&(this._autopanning=!0),f.fire("autopanstart").panBy([Xt,pn]))}},_getAnchor:function(){return Bt(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),bh=function(f,x){return new Xl(f,x)};Wn.mergeOptions({closePopupOnClick:!0}),Wn.include({openPopup:function(f,x,k){return this._initOverlay(Xl,f,x,k).openOn(this),this},closePopup:function(f){return f=arguments.length?f:this._popup,f&&f.close(),this}}),Ys.include({bindPopup:function(f,x){return this._popup=this._initOverlay(Xl,this._popup,f,x),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(f){return this._popup&&(this instanceof ho||(this._popup._source=this),this._popup._prepareOpen(f||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return this._popup?this._popup.isOpen():!1},setPopupContent:function(f){return this._popup&&this._popup.setContent(f),this},getPopup:function(){return this._popup},_openPopup:function(f){if(!(!this._popup||!this._map)){ia(f);var x=f.layer||f.target;if(this._popup._source===x&&!(x instanceof Es)){this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(f.latlng);return}this._popup._source=x,this.openPopup(f.latlng)}},_movePopup:function(f){this._popup.setLatLng(f.latlng)},_onKeyPress:function(f){f.originalEvent.keyCode===13&&this._openPopup(f)}});var Lo=sa.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(f){sa.prototype.onAdd.call(this,f),this.setOpacity(this.options.opacity),f.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(f){sa.prototype.onRemove.call(this,f),f.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var f=sa.prototype.getEvents.call(this);return this.options.permanent||(f.preclick=this.close),f},_initLayout:function(){var f="leaflet-tooltip",x=f+" "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=ii("div",x),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+C(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(f){var x,k,U=this._map,X=this._container,ue=U.latLngToContainerPoint(U.getCenter()),Ne=U.layerPointToContainerPoint(f),nt=this.options.direction,ut=X.offsetWidth,It=X.offsetHeight,Xt=Bt(this.options.offset),pn=this._getAnchor();nt==="top"?(x=ut/2,k=It):nt==="bottom"?(x=ut/2,k=0):nt==="center"?(x=ut/2,k=It/2):nt==="right"?(x=0,k=It/2):nt==="left"?(x=ut,k=It/2):Ne.x<ue.x?(nt="right",x=0,k=It/2):(nt="left",x=ut+(Xt.x+pn.x)*2,k=It/2),f=f.subtract(Bt(x,k,!0)).add(Xt).add(pn),Ui(X,"leaflet-tooltip-right"),Ui(X,"leaflet-tooltip-left"),Ui(X,"leaflet-tooltip-top"),Ui(X,"leaflet-tooltip-bottom"),on(X,"leaflet-tooltip-"+nt),ar(X,f)},_updatePosition:function(){var f=this._map.latLngToLayerPoint(this._latlng);this._setPosition(f)},setOpacity:function(f){this.options.opacity=f,this._container&&rr(this._container,f)},_animateZoom:function(f){var x=this._map._latLngToNewLayerPoint(this._latlng,f.zoom,f.center);this._setPosition(x)},_getAnchor:function(){return Bt(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),$c=function(f,x){return new Lo(f,x)};Wn.include({openTooltip:function(f,x,k){return this._initOverlay(Lo,f,x,k).openOn(this),this},closeTooltip:function(f){return f.close(),this}}),Ys.include({bindTooltip:function(f,x){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(Lo,this._tooltip,f,x),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(f){if(!(!f&&this._tooltipHandlersAdded)){var x=f?"off":"on",k={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?k.add=this._openTooltip:(k.mouseover=this._openTooltip,k.mouseout=this.closeTooltip,k.click=this._openTooltip,this._map?this._addFocusListeners():k.add=this._addFocusListeners),this._tooltip.options.sticky&&(k.mousemove=this._moveTooltip),this[x](k),this._tooltipHandlersAdded=!f}},openTooltip:function(f){return this._tooltip&&(this instanceof ho||(this._tooltip._source=this),this._tooltip._prepareOpen(f)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(f){return this._tooltip&&this._tooltip.setContent(f),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(f){var x=typeof f.getElement=="function"&&f.getElement();x&&(hn(x,"focus",function(){this._tooltip._source=f,this.openTooltip()},this),hn(x,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(f){var x=typeof f.getElement=="function"&&f.getElement();x&&x.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(f){if(!(!this._tooltip||!this._map)){if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var x=this;this._map.once("moveend",function(){x._openOnceFlag=!1,x._openTooltip(f)});return}this._tooltip._source=f.layer||f.target,this.openTooltip(this._tooltip.options.sticky?f.latlng:void 0)}},_moveTooltip:function(f){var x=f.latlng,k,U;this._tooltip.options.sticky&&f.originalEvent&&(k=this._map.mouseEventToContainerPoint(f.originalEvent),U=this._map.containerPointToLayerPoint(k),x=this._map.layerPointToLatLng(U)),this._tooltip.setLatLng(x)}});var vu=Qs.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(f){var x=f&&f.tagName==="DIV"?f:document.createElement("div"),k=this.options;if(k.html instanceof Element?(Hi(x),x.appendChild(k.html)):x.innerHTML=k.html!==!1?k.html:"",k.bgPos){var U=Bt(k.bgPos);x.style.backgroundPosition=-U.x+"px "+-U.y+"px"}return this._setIconStyles(x,"icon"),x},createShadow:function(){return null}});function fo(f){return new vu(f)}Qs.Default=Yu;var bu=Ys.extend({options:{tileSize:256,opacity:1,updateWhenIdle:en.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(f){be(this,f)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(f){f._addZoomLimit(this)},onRemove:function(f){this._removeAllTiles(),hi(this._container),f._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(xr(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(Gs(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(f){return this.options.opacity=f,this._updateOpacity(),this},setZIndex:function(f){return this.options.zIndex=f,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var f=this._clampZoom(this._map.getZoom());f!==this._tileZoom&&(this._tileZoom=f,this._updateLevels()),this._update()}return this},getEvents:function(){var f={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=R(this._onMoveEnd,this.options.updateInterval,this)),f.move=this._onMove),this._zoomAnimated&&(f.zoomanim=this._animateZoom),f},createTile:function(){return document.createElement("div")},getTileSize:function(){var f=this.options.tileSize;return f instanceof Tt?f:new Tt(f,f)},_updateZIndex:function(){this._container&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(f){for(var x=this.getPane().children,k=-f(-1/0,1/0),U=0,X=x.length,ue;U<X;U++)ue=x[U].style.zIndex,x[U]!==this._container&&ue&&(k=f(k,+ue));isFinite(k)&&(this.options.zIndex=k+f(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!en.ielt9){rr(this._container,this.options.opacity);var f=+new Date,x=!1,k=!1;for(var U in this._tiles){var X=this._tiles[U];if(!(!X.current||!X.loaded)){var ue=Math.min(1,(f-X.loaded)/200);rr(X.el,ue),ue<1?x=!0:(X.active?k=!0:this._onOpaqueTile(X),X.active=!0)}}k&&!this._noPrune&&this._pruneTiles(),x&&(Ge(this._fadeFrame),this._fadeFrame=Me(this._updateOpacity,this))}},_onOpaqueTile:q,_initContainer:function(){this._container||(this._container=ii("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var f=this._tileZoom,x=this.options.maxZoom;if(f!==void 0){for(var k in this._levels)k=Number(k),this._levels[k].el.children.length||k===f?(this._levels[k].el.style.zIndex=x-Math.abs(f-k),this._onUpdateLevel(k)):(hi(this._levels[k].el),this._removeTilesAtZoom(k),this._onRemoveLevel(k),delete this._levels[k]);var U=this._levels[f],X=this._map;return U||(U=this._levels[f]={},U.el=ii("div","leaflet-tile-container leaflet-zoom-animated",this._container),U.el.style.zIndex=x,U.origin=X.project(X.unproject(X.getPixelOrigin()),f).round(),U.zoom=f,this._setZoomTransform(U,X.getCenter(),X.getZoom()),q(U.el.offsetWidth),this._onCreateLevel(U)),this._level=U,U}},_onUpdateLevel:q,_onRemoveLevel:q,_onCreateLevel:q,_pruneTiles:function(){if(this._map){var f,x,k=this._map.getZoom();if(k>this.options.maxZoom||k<this.options.minZoom){this._removeAllTiles();return}for(f in this._tiles)x=this._tiles[f],x.retain=x.current;for(f in this._tiles)if(x=this._tiles[f],x.current&&!x.active){var U=x.coords;this._retainParent(U.x,U.y,U.z,U.z-5)||this._retainChildren(U.x,U.y,U.z,U.z+2)}for(f in this._tiles)this._tiles[f].retain||this._removeTile(f)}},_removeTilesAtZoom:function(f){for(var x in this._tiles)this._tiles[x].coords.z===f&&this._removeTile(x)},_removeAllTiles:function(){for(var f in this._tiles)this._removeTile(f)},_invalidateAll:function(){for(var f in this._levels)hi(this._levels[f].el),this._onRemoveLevel(Number(f)),delete this._levels[f];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(f,x,k,U){var X=Math.floor(f/2),ue=Math.floor(x/2),Ne=k-1,nt=new Tt(+X,+ue);nt.z=+Ne;var ut=this._tileCoordsToKey(nt),It=this._tiles[ut];return It&&It.active?(It.retain=!0,!0):(It&&It.loaded&&(It.retain=!0),Ne>U?this._retainParent(X,ue,Ne,U):!1)},_retainChildren:function(f,x,k,U){for(var X=2*f;X<2*f+2;X++)for(var ue=2*x;ue<2*x+2;ue++){var Ne=new Tt(X,ue);Ne.z=k+1;var nt=this._tileCoordsToKey(Ne),ut=this._tiles[nt];if(ut&&ut.active){ut.retain=!0;continue}else ut&&ut.loaded&&(ut.retain=!0);k+1<U&&this._retainChildren(X,ue,k+1,U)}},_resetView:function(f){var x=f&&(f.pinch||f.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),x,x)},_animateZoom:function(f){this._setView(f.center,f.zoom,!0,f.noUpdate)},_clampZoom:function(f){var x=this.options;return x.minNativeZoom!==void 0&&f<x.minNativeZoom?x.minNativeZoom:x.maxNativeZoom!==void 0&&x.maxNativeZoom<f?x.maxNativeZoom:f},_setView:function(f,x,k,U){var X=Math.round(x);this.options.maxZoom!==void 0&&X>this.options.maxZoom||this.options.minZoom!==void 0&&X<this.options.minZoom?X=void 0:X=this._clampZoom(X);var ue=this.options.updateWhenZooming&&X!==this._tileZoom;(!U||ue)&&(this._tileZoom=X,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),X!==void 0&&this._update(f),k||this._pruneTiles(),this._noPrune=!!k),this._setZoomTransforms(f,x)},_setZoomTransforms:function(f,x){for(var k in this._levels)this._setZoomTransform(this._levels[k],f,x)},_setZoomTransform:function(f,x,k){var U=this._map.getZoomScale(k,f.zoom),X=f.origin.multiplyBy(U).subtract(this._map._getNewPixelOrigin(x,k)).round();en.any3d?Hs(f.el,X,U):ar(f.el,X)},_resetGrid:function(){var f=this._map,x=f.options.crs,k=this._tileSize=this.getTileSize(),U=this._tileZoom,X=this._map.getPixelWorldBounds(this._tileZoom);X&&(this._globalTileRange=this._pxBoundsToTileRange(X)),this._wrapX=x.wrapLng&&!this.options.noWrap&&[Math.floor(f.project([0,x.wrapLng[0]],U).x/k.x),Math.ceil(f.project([0,x.wrapLng[1]],U).x/k.y)],this._wrapY=x.wrapLat&&!this.options.noWrap&&[Math.floor(f.project([x.wrapLat[0],0],U).y/k.x),Math.ceil(f.project([x.wrapLat[1],0],U).y/k.y)]},_onMoveEnd:function(){!this._map||this._map._animatingZoom||this._update()},_getTiledPixelBounds:function(f){var x=this._map,k=x._animatingZoom?Math.max(x._animateToZoom,x.getZoom()):x.getZoom(),U=x.getZoomScale(k,this._tileZoom),X=x.project(f,this._tileZoom).floor(),ue=x.getSize().divideBy(U*2);return new Le(X.subtract(ue),X.add(ue))},_update:function(f){var x=this._map;if(x){var k=this._clampZoom(x.getZoom());if(f===void 0&&(f=x.getCenter()),this._tileZoom!==void 0){var U=this._getTiledPixelBounds(f),X=this._pxBoundsToTileRange(U),ue=X.getCenter(),Ne=[],nt=this.options.keepBuffer,ut=new Le(X.getBottomLeft().subtract([nt,-nt]),X.getTopRight().add([nt,-nt]));if(!(isFinite(X.min.x)&&isFinite(X.min.y)&&isFinite(X.max.x)&&isFinite(X.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var It in this._tiles){var Xt=this._tiles[It].coords;(Xt.z!==this._tileZoom||!ut.contains(new Tt(Xt.x,Xt.y)))&&(this._tiles[It].current=!1)}if(Math.abs(k-this._tileZoom)>1){this._setView(f,k);return}for(var pn=X.min.y;pn<=X.max.y;pn++)for(var Yn=X.min.x;Yn<=X.max.x;Yn++){var _a=new Tt(Yn,pn);if(_a.z=this._tileZoom,!!this._isValidTile(_a)){var Zr=this._tiles[this._tileCoordsToKey(_a)];Zr?Zr.current=!0:Ne.push(_a)}}if(Ne.sort(function(Si,ki){return Si.distanceTo(ue)-ki.distanceTo(ue)}),Ne.length!==0){this._loading||(this._loading=!0,this.fire("loading"));var Za=document.createDocumentFragment();for(Yn=0;Yn<Ne.length;Yn++)this._addTile(Ne[Yn],Za);this._level.el.appendChild(Za)}}}},_isValidTile:function(f){var x=this._map.options.crs;if(!x.infinite){var k=this._globalTileRange;if(!x.wrapLng&&(f.x<k.min.x||f.x>k.max.x)||!x.wrapLat&&(f.y<k.min.y||f.y>k.max.y))return!1}if(!this.options.bounds)return!0;var U=this._tileCoordsToBounds(f);return Ut(this.options.bounds).overlaps(U)},_keyToBounds:function(f){return this._tileCoordsToBounds(this._keyToTileCoords(f))},_tileCoordsToNwSe:function(f){var x=this._map,k=this.getTileSize(),U=f.scaleBy(k),X=U.add(k),ue=x.unproject(U,f.z),Ne=x.unproject(X,f.z);return[ue,Ne]},_tileCoordsToBounds:function(f){var x=this._tileCoordsToNwSe(f),k=new Ot(x[0],x[1]);return this.options.noWrap||(k=this._map.wrapLatLngBounds(k)),k},_tileCoordsToKey:function(f){return f.x+":"+f.y+":"+f.z},_keyToTileCoords:function(f){var x=f.split(":"),k=new Tt(+x[0],+x[1]);return k.z=+x[2],k},_removeTile:function(f){var x=this._tiles[f];x&&(hi(x.el),delete this._tiles[f],this.fire("tileunload",{tile:x.el,coords:this._keyToTileCoords(f)}))},_initTile:function(f){on(f,"leaflet-tile");var x=this.getTileSize();f.style.width=x.x+"px",f.style.height=x.y+"px",f.onselectstart=q,f.onmousemove=q,en.ielt9&&this.options.opacity<1&&rr(f,this.options.opacity)},_addTile:function(f,x){var k=this._getTilePos(f),U=this._tileCoordsToKey(f),X=this.createTile(this._wrapCoords(f),g(this._tileReady,this,f));this._initTile(X),this.createTile.length<2&&Me(g(this._tileReady,this,f,null,X)),ar(X,k),this._tiles[U]={el:X,coords:f,current:!0},x.appendChild(X),this.fire("tileloadstart",{tile:X,coords:f})},_tileReady:function(f,x,k){x&&this.fire("tileerror",{error:x,tile:k,coords:f});var U=this._tileCoordsToKey(f);k=this._tiles[U],k&&(k.loaded=+new Date,this._map._fadeAnimated?(rr(k.el,0),Ge(this._fadeFrame),this._fadeFrame=Me(this._updateOpacity,this)):(k.active=!0,this._pruneTiles()),x||(on(k.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:k.el,coords:f})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),en.ielt9||!this._map._fadeAnimated?Me(this._pruneTiles,this):setTimeout(g(this._pruneTiles,this),250)))},_getTilePos:function(f){return f.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(f){var x=new Tt(this._wrapX?V(f.x,this._wrapX):f.x,this._wrapY?V(f.y,this._wrapY):f.y);return x.z=f.z,x},_pxBoundsToTileRange:function(f){var x=this.getTileSize();return new Le(f.min.unscaleBy(x).floor(),f.max.unscaleBy(x).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var f in this._tiles)if(!this._tiles[f].loaded)return!1;return!0}});function sd(f){return new bu(f)}var pl=bu.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(f,x){this._url=f,x=be(this,x),x.detectRetina&&en.retina&&x.maxZoom>0?(x.tileSize=Math.floor(x.tileSize/2),x.zoomReverse?(x.zoomOffset--,x.minZoom=Math.min(x.maxZoom,x.minZoom+1)):(x.zoomOffset++,x.maxZoom=Math.max(x.minZoom,x.maxZoom-1)),x.minZoom=Math.max(0,x.minZoom)):x.zoomReverse?x.minZoom=Math.min(x.maxZoom,x.minZoom):x.maxZoom=Math.max(x.minZoom,x.maxZoom),typeof x.subdomains=="string"&&(x.subdomains=x.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(f,x){return this._url===f&&x===void 0&&(x=!0),this._url=f,x||this.redraw(),this},createTile:function(f,x){var k=document.createElement("img");return hn(k,"load",g(this._tileOnLoad,this,x,k)),hn(k,"error",g(this._tileOnError,this,x,k)),(this.options.crossOrigin||this.options.crossOrigin==="")&&(k.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),typeof this.options.referrerPolicy=="string"&&(k.referrerPolicy=this.options.referrerPolicy),k.alt="",k.src=this.getTileUrl(f),k},getTileUrl:function(f){var x={r:en.retina?"@2x":"",s:this._getSubdomain(f),x:f.x,y:f.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var k=this._globalTileRange.max.y-f.y;this.options.tms&&(x.y=k),x["-y"]=k}return Je(this._url,d(x,this.options))},_tileOnLoad:function(f,x){en.ielt9?setTimeout(g(f,this,null,x),0):f(null,x)},_tileOnError:function(f,x,k){var U=this.options.errorTileUrl;U&&x.getAttribute("src")!==U&&(x.src=U),f(k,x)},_onTileRemove:function(f){f.tile.onload=null},_getZoomForUrl:function(){var f=this._tileZoom,x=this.options.maxZoom,k=this.options.zoomReverse,U=this.options.zoomOffset;return k&&(f=x-f),f+U},_getSubdomain:function(f){var x=Math.abs(f.x+f.y)%this.options.subdomains.length;return this.options.subdomains[x]},_abortLoading:function(){var f,x;for(f in this._tiles)if(this._tiles[f].coords.z!==this._tileZoom&&(x=this._tiles[f].el,x.onload=q,x.onerror=q,!x.complete)){x.src=je;var k=this._tiles[f].coords;hi(x),delete this._tiles[f],this.fire("tileabort",{tile:x,coords:k})}},_removeTile:function(f){var x=this._tiles[f];if(x)return x.el.setAttribute("src",je),bu.prototype._removeTile.call(this,f)},_tileReady:function(f,x,k){if(!(!this._map||k&&k.getAttribute("src")===je))return bu.prototype._tileReady.call(this,f,x,k)}});function ma(f,x){return new pl(f,x)}var Yl=pl.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(f,x){this._url=f;var k=d({},this.defaultWmsParams);for(var U in x)U in this.options||(k[U]=x[U]);x=be(this,x);var X=x.detectRetina&&en.retina?2:1,ue=this.getTileSize();k.width=ue.x*X,k.height=ue.y*X,this.wmsParams=k},onAdd:function(f){this._crs=this.options.crs||f.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var x=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[x]=this._crs.code,pl.prototype.onAdd.call(this,f)},getTileUrl:function(f){var x=this._tileCoordsToNwSe(f),k=this._crs,U=vt(k.project(x[0]),k.project(x[1])),X=U.min,ue=U.max,Ne=(this._wmsVersion>=1.3&&this._crs===Xs?[X.y,X.x,ue.y,ue.x]:[X.x,X.y,ue.x,ue.y]).join(","),nt=pl.prototype.getTileUrl.call(this,f);return nt+Oe(this.wmsParams,nt,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+Ne},setParams:function(f,x){return d(this.wmsParams,f),x||this.redraw(),this}});function ns(f,x){return new Yl(f,x)}pl.WMS=Yl,ma.wms=ns;var ga=Ys.extend({options:{padding:.1},initialize:function(f){be(this,f),C(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),on(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var f={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(f.zoomanim=this._onAnimZoom),f},_onAnimZoom:function(f){this._updateTransform(f.center,f.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(f,x){var k=this._map.getZoomScale(x,this._zoom),U=this._map.getSize().multiplyBy(.5+this.options.padding),X=this._map.project(this._center,x),ue=U.multiplyBy(-k).add(X).subtract(this._map._getNewPixelOrigin(f,x));en.any3d?Hs(this._container,ue,k):ar(this._container,ue)},_reset:function(){this._update(),this._updateTransform(this._center,this._zoom);for(var f in this._layers)this._layers[f]._reset()},_onZoomEnd:function(){for(var f in this._layers)this._layers[f]._project()},_updatePaths:function(){for(var f in this._layers)this._layers[f]._update()},_update:function(){var f=this.options.padding,x=this._map.getSize(),k=this._map.containerPointToLayerPoint(x.multiplyBy(-f)).round();this._bounds=new Le(k,k.add(x.multiplyBy(1+f*2)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),xu=ga.extend({options:{tolerance:0},getEvents:function(){var f=ga.prototype.getEvents.call(this);return f.viewprereset=this._onViewPreReset,f},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){ga.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var f=this._container=document.createElement("canvas");hn(f,"mousemove",this._onMouseMove,this),hn(f,"click dblclick mousedown mouseup contextmenu",this._onClick,this),hn(f,"mouseout",this._handleMouseOut,this),f._leaflet_disable_events=!0,this._ctx=f.getContext("2d")},_destroyContainer:function(){Ge(this._redrawRequest),delete this._ctx,hi(this._container),xn(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){var f;this._redrawBounds=null;for(var x in this._layers)f=this._layers[x],f._update();this._redraw()}},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){ga.prototype._update.call(this);var f=this._bounds,x=this._container,k=f.getSize(),U=en.retina?2:1;ar(x,f.min),x.width=U*k.x,x.height=U*k.y,x.style.width=k.x+"px",x.style.height=k.y+"px",en.retina&&this._ctx.scale(2,2),this._ctx.translate(-f.min.x,-f.min.y),this.fire("update")}},_reset:function(){ga.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(f){this._updateDashArray(f),this._layers[C(f)]=f;var x=f._order={layer:f,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=x),this._drawLast=x,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(f){this._requestRedraw(f)},_removePath:function(f){var x=f._order,k=x.next,U=x.prev;k?k.prev=U:this._drawLast=U,U?U.next=k:this._drawFirst=k,delete f._order,delete this._layers[C(f)],this._requestRedraw(f)},_updatePath:function(f){this._extendRedrawBounds(f),f._project(),f._update(),this._requestRedraw(f)},_updateStyle:function(f){this._updateDashArray(f),this._requestRedraw(f)},_updateDashArray:function(f){if(typeof f.options.dashArray=="string"){var x=f.options.dashArray.split(/[, ]+/),k=[],U,X;for(X=0;X<x.length;X++){if(U=Number(x[X]),isNaN(U))return;k.push(U)}f.options._dashArray=k}else f.options._dashArray=f.options.dashArray},_requestRedraw:function(f){this._map&&(this._extendRedrawBounds(f),this._redrawRequest=this._redrawRequest||Me(this._redraw,this))},_extendRedrawBounds:function(f){if(f._pxBounds){var x=(f.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new Le,this._redrawBounds.extend(f._pxBounds.min.subtract([x,x])),this._redrawBounds.extend(f._pxBounds.max.add([x,x]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var f=this._redrawBounds;if(f){var x=f.getSize();this._ctx.clearRect(f.min.x,f.min.y,x.x,x.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var f,x=this._redrawBounds;if(this._ctx.save(),x){var k=x.getSize();this._ctx.beginPath(),this._ctx.rect(x.min.x,x.min.y,k.x,k.y),this._ctx.clip()}this._drawing=!0;for(var U=this._drawFirst;U;U=U.next)f=U.layer,(!x||f._pxBounds&&f._pxBounds.intersects(x))&&f._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(f,x){if(this._drawing){var k,U,X,ue,Ne=f._parts,nt=Ne.length,ut=this._ctx;if(nt){for(ut.beginPath(),k=0;k<nt;k++){for(U=0,X=Ne[k].length;U<X;U++)ue=Ne[k][U],ut[U?"lineTo":"moveTo"](ue.x,ue.y);x&&ut.closePath()}this._fillStroke(ut,f)}}},_updateCircle:function(f){if(!(!this._drawing||f._empty())){var x=f._point,k=this._ctx,U=Math.max(Math.round(f._radius),1),X=(Math.max(Math.round(f._radiusY),1)||U)/U;X!==1&&(k.save(),k.scale(1,X)),k.beginPath(),k.arc(x.x,x.y/X,U,0,Math.PI*2,!1),X!==1&&k.restore(),this._fillStroke(k,f)}},_fillStroke:function(f,x){var k=x.options;k.fill&&(f.globalAlpha=k.fillOpacity,f.fillStyle=k.fillColor||k.color,f.fill(k.fillRule||"evenodd")),k.stroke&&k.weight!==0&&(f.setLineDash&&f.setLineDash(x.options&&x.options._dashArray||[]),f.globalAlpha=k.opacity,f.lineWidth=k.weight,f.strokeStyle=k.color,f.lineCap=k.lineCap,f.lineJoin=k.lineJoin,f.stroke())},_onClick:function(f){for(var x=this._map.mouseEventToLayerPoint(f),k,U,X=this._drawFirst;X;X=X.next)k=X.layer,k.options.interactive&&k._containsPoint(x)&&(!(f.type==="click"||f.type==="preclick")||!this._map._draggableMoved(k))&&(U=k);this._fireEvent(U?[U]:!1,f)},_onMouseMove:function(f){if(!(!this._map||this._map.dragging.moving()||this._map._animatingZoom)){var x=this._map.mouseEventToLayerPoint(f);this._handleMouseHover(f,x)}},_handleMouseOut:function(f){var x=this._hoveredLayer;x&&(Ui(this._container,"leaflet-interactive"),this._fireEvent([x],f,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(f,x){if(!this._mouseHoverThrottled){for(var k,U,X=this._drawFirst;X;X=X.next)k=X.layer,k.options.interactive&&k._containsPoint(x)&&(U=k);U!==this._hoveredLayer&&(this._handleMouseOut(f),U&&(on(this._container,"leaflet-interactive"),this._fireEvent([U],f,"mouseover"),this._hoveredLayer=U)),this._fireEvent(this._hoveredLayer?[this._hoveredLayer]:!1,f),this._mouseHoverThrottled=!0,setTimeout(g(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(f,x,k){this._map._fireDOMEvent(x,k||x.type,f)},_bringToFront:function(f){var x=f._order;if(x){var k=x.next,U=x.prev;if(k)k.prev=U;else return;U?U.next=k:k&&(this._drawFirst=k),x.prev=this._drawLast,this._drawLast.next=x,x.next=null,this._drawLast=x,this._requestRedraw(f)}},_bringToBack:function(f){var x=f._order;if(x){var k=x.next,U=x.prev;if(U)U.next=k;else return;k?k.prev=U:U&&(this._drawLast=U),x.prev=null,x.next=this._drawFirst,this._drawFirst.prev=x,this._drawFirst=x,this._requestRedraw(f)}}});function rc(f){return en.canvas?new xu(f):null}var Js=(function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(f){return document.createElement("<lvml:"+f+' class="lvml">')}}catch{}return function(f){return document.createElement("<"+f+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}})(),ml={_initContainer:function(){this._container=ii("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(ga.prototype._update.call(this),this.fire("update"))},_initPath:function(f){var x=f._container=Js("shape");on(x,"leaflet-vml-shape "+(this.options.className||"")),x.coordsize="1 1",f._path=Js("path"),x.appendChild(f._path),this._updateStyle(f),this._layers[C(f)]=f},_addPath:function(f){var x=f._container;this._container.appendChild(x),f.options.interactive&&f.addInteractiveTarget(x)},_removePath:function(f){var x=f._container;hi(x),f.removeInteractiveTarget(x),delete this._layers[C(f)]},_updateStyle:function(f){var x=f._stroke,k=f._fill,U=f.options,X=f._container;X.stroked=!!U.stroke,X.filled=!!U.fill,U.stroke?(x||(x=f._stroke=Js("stroke")),X.appendChild(x),x.weight=U.weight+"px",x.color=U.color,x.opacity=U.opacity,U.dashArray?x.dashStyle=qe(U.dashArray)?U.dashArray.join(" "):U.dashArray.replace(/( *, *)/g," "):x.dashStyle="",x.endcap=U.lineCap.replace("butt","flat"),x.joinstyle=U.lineJoin):x&&(X.removeChild(x),f._stroke=null),U.fill?(k||(k=f._fill=Js("fill")),X.appendChild(k),k.color=U.fillColor||U.color,k.opacity=U.fillOpacity):k&&(X.removeChild(k),f._fill=null)},_updateCircle:function(f){var x=f._point.round(),k=Math.round(f._radius),U=Math.round(f._radiusY||k);this._setPath(f,f._empty()?"M0 0":"AL "+x.x+","+x.y+" "+k+","+U+" 0,"+65535*360)},_setPath:function(f,x){f._path.v=x},_bringToFront:function(f){xr(f._container)},_bringToBack:function(f){Gs(f._container)}},Do=en.vml?Js:Ua,Ql=ga.extend({_initContainer:function(){this._container=Do("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=Do("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){hi(this._container),xn(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){ga.prototype._update.call(this);var f=this._bounds,x=f.getSize(),k=this._container;(!this._svgSize||!this._svgSize.equals(x))&&(this._svgSize=x,k.setAttribute("width",x.x),k.setAttribute("height",x.y)),ar(k,f.min),k.setAttribute("viewBox",[f.min.x,f.min.y,x.x,x.y].join(" ")),this.fire("update")}},_initPath:function(f){var x=f._path=Do("path");f.options.className&&on(x,f.options.className),f.options.interactive&&on(x,"leaflet-interactive"),this._updateStyle(f),this._layers[C(f)]=f},_addPath:function(f){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(f._path),f.addInteractiveTarget(f._path)},_removePath:function(f){hi(f._path),f.removeInteractiveTarget(f._path),delete this._layers[C(f)]},_updatePath:function(f){f._project(),f._update()},_updateStyle:function(f){var x=f._path,k=f.options;x&&(k.stroke?(x.setAttribute("stroke",k.color),x.setAttribute("stroke-opacity",k.opacity),x.setAttribute("stroke-width",k.weight),x.setAttribute("stroke-linecap",k.lineCap),x.setAttribute("stroke-linejoin",k.lineJoin),k.dashArray?x.setAttribute("stroke-dasharray",k.dashArray):x.removeAttribute("stroke-dasharray"),k.dashOffset?x.setAttribute("stroke-dashoffset",k.dashOffset):x.removeAttribute("stroke-dashoffset")):x.setAttribute("stroke","none"),k.fill?(x.setAttribute("fill",k.fillColor||k.color),x.setAttribute("fill-opacity",k.fillOpacity),x.setAttribute("fill-rule",k.fillRule||"evenodd")):x.setAttribute("fill","none"))},_updatePoly:function(f,x){this._setPath(f,Sa(f._parts,x))},_updateCircle:function(f){var x=f._point,k=Math.max(Math.round(f._radius),1),U=Math.max(Math.round(f._radiusY),1)||k,X="a"+k+","+U+" 0 1,0 ",ue=f._empty()?"M0 0":"M"+(x.x-k)+","+x.y+X+k*2+",0 "+X+-k*2+",0 ";this._setPath(f,ue)},_setPath:function(f,x){f._path.setAttribute("d",x)},_bringToFront:function(f){xr(f._path)},_bringToBack:function(f){Gs(f._path)}});en.vml&&Ql.include(ml);function qn(f){return en.svg||en.vml?new Ql(f):null}Wn.include({getRenderer:function(f){var x=f.options.renderer||this._getPaneRenderer(f.options.pane)||this.options.renderer||this._renderer;return x||(x=this._renderer=this._createRenderer()),this.hasLayer(x)||this.addLayer(x),x},_getPaneRenderer:function(f){if(f==="overlayPane"||f===void 0)return!1;var x=this._paneRenderers[f];return x===void 0&&(x=this._createRenderer({pane:f}),this._paneRenderers[f]=x),x},_createRenderer:function(f){return this.options.preferCanvas&&rc(f)||qn(f)}});var zo=Kl.extend({initialize:function(f,x){Kl.prototype.initialize.call(this,this._boundsToLatLngs(f),x)},setBounds:function(f){return this.setLatLngs(this._boundsToLatLngs(f))},_boundsToLatLngs:function(f){return f=Ut(f),[f.getSouthWest(),f.getNorthWest(),f.getNorthEast(),f.getSouthEast()]}});function Jf(f,x){return new zo(f,x)}Ql.create=Do,Ql.pointsToPath=Sa,cl.geometryToLayer=aa,cl.coordsToLatLng=li,cl.coordsToLatLngs=yu,cl.latLngToCoords=ec,cl.latLngsToCoords=tc,cl.getFeature=hl,cl.asFeature=dl,Wn.mergeOptions({boxZoom:!0});var is=Ws.extend({initialize:function(f){this._map=f,this._container=f._container,this._pane=f._panes.overlayPane,this._resetStateTimeout=0,f.on("unload",this._destroy,this)},addHooks:function(){hn(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){xn(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){hi(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){this._resetStateTimeout!==0&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(f){if(!f.shiftKey||f.which!==1&&f.button!==1)return!1;this._clearDeferredResetState(),this._resetState(),$a(),ys(),this._startPoint=this._map.mouseEventToContainerPoint(f),hn(document,{contextmenu:ia,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(f){this._moved||(this._moved=!0,this._box=ii("div","leaflet-zoom-box",this._container),on(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(f);var x=new Le(this._point,this._startPoint),k=x.getSize();ar(this._box,x.min),this._box.style.width=k.x+"px",this._box.style.height=k.y+"px"},_finish:function(){this._moved&&(hi(this._box),Ui(this._container,"leaflet-crosshair")),Zi(),qa(),xn(document,{contextmenu:ia,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(f){if(!(f.which!==1&&f.button!==1)&&(this._finish(),!!this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(g(this._resetState,this),0);var x=new Ot(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(x).fire("boxzoomend",{boxZoomBounds:x})}},_onKeyDown:function(f){f.keyCode===27&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});Wn.addInitHook("addHandler","boxZoom",is),Wn.mergeOptions({doubleClickZoom:!0});var Oo=Ws.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(f){var x=this._map,k=x.getZoom(),U=x.options.zoomDelta,X=f.originalEvent.shiftKey?k-U:k+U;x.options.doubleClickZoom==="center"?x.setZoom(X):x.setZoomAround(f.containerPoint,X)}});Wn.addInitHook("addHandler","doubleClickZoom",Oo),Wn.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var No=Ws.extend({addHooks:function(){if(!this._draggable){var f=this._map;this._draggable=new ts(f._mapPane,f._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),f.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),f.on("zoomend",this._onZoomEnd,this),f.whenReady(this._onZoomEnd,this))}on(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){Ui(this._map._container,"leaflet-grab"),Ui(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var f=this._map;if(f._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var x=Ut(this._map.options.maxBounds);this._offsetLimit=vt(this._map.latLngToContainerPoint(x.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(x.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;f.fire("movestart").fire("dragstart"),f.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(f){if(this._map.options.inertia){var x=this._lastTime=+new Date,k=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(k),this._times.push(x),this._prunePositions(x)}this._map.fire("move",f).fire("drag",f)},_prunePositions:function(f){for(;this._positions.length>1&&f-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var f=this._map.getSize().divideBy(2),x=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=x.subtract(f).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(f,x){return f-(f-x)*this._viscosity},_onPreDragLimit:function(){if(!(!this._viscosity||!this._offsetLimit)){var f=this._draggable._newPos.subtract(this._draggable._startPos),x=this._offsetLimit;f.x<x.min.x&&(f.x=this._viscousLimit(f.x,x.min.x)),f.y<x.min.y&&(f.y=this._viscousLimit(f.y,x.min.y)),f.x>x.max.x&&(f.x=this._viscousLimit(f.x,x.max.x)),f.y>x.max.y&&(f.y=this._viscousLimit(f.y,x.max.y)),this._draggable._newPos=this._draggable._startPos.add(f)}},_onPreDragWrap:function(){var f=this._worldWidth,x=Math.round(f/2),k=this._initialWorldOffset,U=this._draggable._newPos.x,X=(U-x+k)%f+x-k,ue=(U+x+k)%f-x-k,Ne=Math.abs(X+k)<Math.abs(ue+k)?X:ue;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=Ne},_onDragEnd:function(f){var x=this._map,k=x.options,U=!k.inertia||f.noInertia||this._times.length<2;if(x.fire("dragend",f),U)x.fire("moveend");else{this._prunePositions(+new Date);var X=this._lastPos.subtract(this._positions[0]),ue=(this._lastTime-this._times[0])/1e3,Ne=k.easeLinearity,nt=X.multiplyBy(Ne/ue),ut=nt.distanceTo([0,0]),It=Math.min(k.inertiaMaxSpeed,ut),Xt=nt.multiplyBy(It/ut),pn=It/(k.inertiaDeceleration*Ne),Yn=Xt.multiplyBy(-pn/2).round();!Yn.x&&!Yn.y?x.fire("moveend"):(Yn=x._limitOffset(Yn,x.options.maxBounds),Me(function(){x.panBy(Yn,{duration:pn,easeLinearity:Ne,noMoveStart:!0,animate:!0})}))}}});Wn.addInitHook("addHandler","dragging",No),Wn.mergeOptions({keyboard:!0,keyboardPanDelta:80});var od=Ws.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(f){this._map=f,this._setPanDelta(f.options.keyboardPanDelta),this._setZoomDelta(f.options.zoomDelta)},addHooks:function(){var f=this._map._container;f.tabIndex<=0&&(f.tabIndex="0"),hn(f,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),xn(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var f=document.body,x=document.documentElement,k=f.scrollTop||x.scrollTop,U=f.scrollLeft||x.scrollLeft;this._map._container.focus(),window.scrollTo(U,k)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(f){var x=this._panKeys={},k=this.keyCodes,U,X;for(U=0,X=k.left.length;U<X;U++)x[k.left[U]]=[-1*f,0];for(U=0,X=k.right.length;U<X;U++)x[k.right[U]]=[f,0];for(U=0,X=k.down.length;U<X;U++)x[k.down[U]]=[0,f];for(U=0,X=k.up.length;U<X;U++)x[k.up[U]]=[0,-1*f]},_setZoomDelta:function(f){var x=this._zoomKeys={},k=this.keyCodes,U,X;for(U=0,X=k.zoomIn.length;U<X;U++)x[k.zoomIn[U]]=f;for(U=0,X=k.zoomOut.length;U<X;U++)x[k.zoomOut[U]]=-f},_addHooks:function(){hn(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){xn(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(f){if(!(f.altKey||f.ctrlKey||f.metaKey)){var x=f.keyCode,k=this._map,U;if(x in this._panKeys){if(!k._panAnim||!k._panAnim._inProgress)if(U=this._panKeys[x],f.shiftKey&&(U=Bt(U).multiplyBy(3)),k.options.maxBounds&&(U=k._limitOffset(Bt(U),k.options.maxBounds)),k.options.worldCopyJump){var X=k.wrapLatLng(k.unproject(k.project(k.getCenter()).add(U)));k.panTo(X)}else k.panBy(U)}else if(x in this._zoomKeys)k.setZoom(k.getZoom()+(f.shiftKey?3:1)*this._zoomKeys[x]);else if(x===27&&k._popup&&k._popup.options.closeOnEscapeKey)k.closePopup();else return;ia(f)}}});Wn.addInitHook("addHandler","keyboard",od),Wn.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var ac=Ws.extend({addHooks:function(){hn(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){xn(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(f){var x=or(f),k=this._map.options.wheelDebounceTime;this._delta+=x,this._lastMousePos=this._map.mouseEventToContainerPoint(f),this._startTime||(this._startTime=+new Date);var U=Math.max(k-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(g(this._performZoom,this),U),ia(f)},_performZoom:function(){var f=this._map,x=f.getZoom(),k=this._map.options.zoomSnap||0;f._stop();var U=this._delta/(this._map.options.wheelPxPerZoomLevel*4),X=4*Math.log(2/(1+Math.exp(-Math.abs(U))))/Math.LN2,ue=k?Math.ceil(X/k)*k:X,Ne=f._limitZoom(x+(this._delta>0?ue:-ue))-x;this._delta=0,this._startTime=null,Ne&&(f.options.scrollWheelZoom==="center"?f.setZoom(x+Ne):f.setZoomAround(this._lastMousePos,x+Ne))}});Wn.addInitHook("addHandler","scrollWheelZoom",ac);var wu=600;Wn.mergeOptions({tapHold:en.touchNative&&en.safari&&en.mobile,tapTolerance:15});var sc=Ws.extend({addHooks:function(){hn(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){xn(this._map._container,"touchstart",this._onDown,this)},_onDown:function(f){if(clearTimeout(this._holdTimeout),f.touches.length===1){var x=f.touches[0];this._startPos=this._newPos=new Tt(x.clientX,x.clientY),this._holdTimeout=setTimeout(g(function(){this._cancel(),this._isTapValid()&&(hn(document,"touchend",sn),hn(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",x))},this),wu),hn(document,"touchend touchcancel contextmenu",this._cancel,this),hn(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function f(){xn(document,"touchend",sn),xn(document,"touchend touchcancel",f)},_cancel:function(){clearTimeout(this._holdTimeout),xn(document,"touchend touchcancel contextmenu",this._cancel,this),xn(document,"touchmove",this._onMove,this)},_onMove:function(f){var x=f.touches[0];this._newPos=new Tt(x.clientX,x.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(f,x){var k=new MouseEvent(f,{bubbles:!0,cancelable:!0,view:window,screenX:x.screenX,screenY:x.screenY,clientX:x.clientX,clientY:x.clientY});k._simulated=!0,x.target.dispatchEvent(k)}});Wn.addInitHook("addHandler","tapHold",sc),Wn.mergeOptions({touchZoom:en.touch,bounceAtZoomLimits:!0});var oc=Ws.extend({addHooks:function(){on(this._map._container,"leaflet-touch-zoom"),hn(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){Ui(this._map._container,"leaflet-touch-zoom"),xn(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(f){var x=this._map;if(!(!f.touches||f.touches.length!==2||x._animatingZoom||this._zooming)){var k=x.mouseEventToContainerPoint(f.touches[0]),U=x.mouseEventToContainerPoint(f.touches[1]);this._centerPoint=x.getSize()._divideBy(2),this._startLatLng=x.containerPointToLatLng(this._centerPoint),x.options.touchZoom!=="center"&&(this._pinchStartLatLng=x.containerPointToLatLng(k.add(U)._divideBy(2))),this._startDist=k.distanceTo(U),this._startZoom=x.getZoom(),this._moved=!1,this._zooming=!0,x._stop(),hn(document,"touchmove",this._onTouchMove,this),hn(document,"touchend touchcancel",this._onTouchEnd,this),sn(f)}},_onTouchMove:function(f){if(!(!f.touches||f.touches.length!==2||!this._zooming)){var x=this._map,k=x.mouseEventToContainerPoint(f.touches[0]),U=x.mouseEventToContainerPoint(f.touches[1]),X=k.distanceTo(U)/this._startDist;if(this._zoom=x.getScaleZoom(X,this._startZoom),!x.options.bounceAtZoomLimits&&(this._zoom<x.getMinZoom()&&X<1||this._zoom>x.getMaxZoom()&&X>1)&&(this._zoom=x._limitZoom(this._zoom)),x.options.touchZoom==="center"){if(this._center=this._startLatLng,X===1)return}else{var ue=k._add(U)._divideBy(2)._subtract(this._centerPoint);if(X===1&&ue.x===0&&ue.y===0)return;this._center=x.unproject(x.project(this._pinchStartLatLng,this._zoom).subtract(ue),this._zoom)}this._moved||(x._moveStart(!0,!1),this._moved=!0),Ge(this._animRequest);var Ne=g(x._move,x,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=Me(Ne,this,!0),sn(f)}},_onTouchEnd:function(){if(!this._moved||!this._zooming){this._zooming=!1;return}this._zooming=!1,Ge(this._animRequest),xn(document,"touchmove",this._onTouchMove,this),xn(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))}});Wn.addInitHook("addHandler","touchZoom",oc),Wn.BoxZoom=is,Wn.DoubleClickZoom=Oo,Wn.Drag=No,Wn.Keyboard=od,Wn.ScrollWheelZoom=ac,Wn.TapHold=sc,Wn.TouchZoom=oc,t.Bounds=Le,t.Browser=en,t.CRS=Fn,t.Canvas=xu,t.Circle=Fc,t.CircleMarker=Qu,t.Class=Pn,t.Control=ra,t.DivIcon=vu,t.DivOverlay=sa,t.DomEvent=uo,t.DomUtil=mr,t.Draggable=ts,t.Evented=$t,t.FeatureGroup=ho,t.GeoJSON=cl,t.GridLayer=bu,t.Handler=Ws,t.Icon=Qs,t.ImageOverlay=nc,t.LatLng=Jt,t.LatLngBounds=Ot,t.Layer=Ys,t.LayerGroup=Ku,t.LineUtil=Ga,t.Map=Wn,t.Marker=_u,t.Mixin=Ol,t.Path=Es,t.Point=Tt,t.PolyUtil=co,t.Polygon=Kl,t.Polyline=ul,t.Popup=Xl,t.PosAnimation=xs,t.Projection=Ss,t.Rectangle=zo,t.Renderer=ga,t.SVG=Ql,t.SVGOverlay=Uc,t.TileLayer=pl,t.Tooltip=Lo,t.Transformation=Bs,t.Util=Re,t.VideoOverlay=Fl,t.bind=g,t.bounds=vt,t.canvas=rc,t.circle=ef,t.circleMarker=Ju,t.control=Ma,t.divIcon=fo,t.extend=d,t.featureGroup=rd,t.geoJSON=vh,t.geoJson=Vc,t.gridLayer=sd,t.icon=Xu,t.imageOverlay=nf,t.latLng=Wt,t.latLngBounds=Ut,t.layerGroup=Jd,t.map=Mo,t.marker=yh,t.point=Bt,t.polygon=ad,t.polyline=tf,t.popup=bh,t.rectangle=Jf,t.setOptions=be,t.stamp=C,t.svg=qn,t.svgOverlay=jc,t.tileLayer=ma,t.tooltip=$c,t.transformation=Dr,t.version=a,t.videoOverlay=ic;var Tu=window.L;t.noConflict=function(){return window.L=Tu,this},window.L=t}))})(H_,H_.exports)),H_.exports}var TB=wB();const Lr=Ry(TB);var E0={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v5.6.2/LICENSE.txt
 */var SB=E0.exports,nE;function EB(){return nE||(nE=1,(function(n,e){(function(t,a){n.exports=a()})(SB,(function(){var t={},a={};function d(g,c,C){if(a[g]=C,g==="index"){var R="var sharedModule = {}; ("+a.shared+")(sharedModule); ("+a.worker+")(sharedModule);",V={};return a.shared(V),a.index(t,V),typeof window<"u"&&t.setWorkerUrl(window.URL.createObjectURL(new Blob([R],{type:"text/javascript"}))),t}}d("shared",["exports"],(function(g){function c(l,r,o,p){return new(o||(o=Promise))((function(v,E){function A(F){try{z(p.next(F))}catch($){E($)}}function P(F){try{z(p.throw(F))}catch($){E($)}}function z(F){var $;F.done?v(F.value):($=F.value,$ instanceof o?$:new o((function(W){W($)}))).then(A,P)}z((p=p.apply(l,r||[])).next())}))}function C(l,r){this.x=l,this.y=r}function R(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}var V,q;typeof SuppressedError=="function"&&SuppressedError,C.prototype={clone(){return new C(this.x,this.y)},add(l){return this.clone()._add(l)},sub(l){return this.clone()._sub(l)},multByPoint(l){return this.clone()._multByPoint(l)},divByPoint(l){return this.clone()._divByPoint(l)},mult(l){return this.clone()._mult(l)},div(l){return this.clone()._div(l)},rotate(l){return this.clone()._rotate(l)},rotateAround(l,r){return this.clone()._rotateAround(l,r)},matMult(l){return this.clone()._matMult(l)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(l){return this.x===l.x&&this.y===l.y},dist(l){return Math.sqrt(this.distSqr(l))},distSqr(l){const r=l.x-this.x,o=l.y-this.y;return r*r+o*o},angle(){return Math.atan2(this.y,this.x)},angleTo(l){return Math.atan2(this.y-l.y,this.x-l.x)},angleWith(l){return this.angleWithSep(l.x,l.y)},angleWithSep(l,r){return Math.atan2(this.x*r-this.y*l,this.x*l+this.y*r)},_matMult(l){const r=l[2]*this.x+l[3]*this.y;return this.x=l[0]*this.x+l[1]*this.y,this.y=r,this},_add(l){return this.x+=l.x,this.y+=l.y,this},_sub(l){return this.x-=l.x,this.y-=l.y,this},_mult(l){return this.x*=l,this.y*=l,this},_div(l){return this.x/=l,this.y/=l,this},_multByPoint(l){return this.x*=l.x,this.y*=l.y,this},_divByPoint(l){return this.x/=l.x,this.y/=l.y,this},_unit(){return this._div(this.mag()),this},_perp(){const l=this.y;return this.y=this.x,this.x=-l,this},_rotate(l){const r=Math.cos(l),o=Math.sin(l),p=o*this.x+r*this.y;return this.x=r*this.x-o*this.y,this.y=p,this},_rotateAround(l,r){const o=Math.cos(l),p=Math.sin(l),v=r.y+p*(this.x-r.x)+o*(this.y-r.y);return this.x=r.x+o*(this.x-r.x)-p*(this.y-r.y),this.y=v,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:C},C.convert=function(l){if(l instanceof C)return l;if(Array.isArray(l))return new C(+l[0],+l[1]);if(l.x!==void 0&&l.y!==void 0)return new C(+l.x,+l.y);throw new Error("Expected [x, y] or {x, y} point format")};var J=(function(){if(q)return V;function l(r,o,p,v){this.cx=3*r,this.bx=3*(p-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*o,this.by=3*(v-o)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=o,this.p2x=p,this.p2y=v}return q=1,V=l,l.prototype={sampleCurveX:function(r){return((this.ax*r+this.bx)*r+this.cx)*r},sampleCurveY:function(r){return((this.ay*r+this.by)*r+this.cy)*r},sampleCurveDerivativeX:function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},solveCurveX:function(r,o){if(o===void 0&&(o=1e-6),r<0)return 0;if(r>1)return 1;for(var p=r,v=0;v<8;v++){var E=this.sampleCurveX(p)-r;if(Math.abs(E)<o)return p;var A=this.sampleCurveDerivativeX(p);if(Math.abs(A)<1e-6)break;p-=E/A}var P=0,z=1;for(p=r,v=0;v<20&&(E=this.sampleCurveX(p),!(Math.abs(E-r)<o));v++)r>E?P=p:z=p,p=.5*(z-P)+P;return p},solve:function(r,o){return this.sampleCurveY(this.solveCurveX(r,o))}},V})(),Y=R(J);let xe,be;function Oe(){return xe==null&&(xe=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),xe}function et(){if(be==null&&(be=!1,Oe())){const r=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(r){for(let p=0;p<25;p++){const v=4*p;r.fillStyle=`rgb(${v},${v+1},${v+2})`,r.fillRect(p%5,Math.floor(p/5),1,1)}const o=r.getImageData(0,0,5,5).data;for(let p=0;p<100;p++)if(p%4!=3&&o[p]!==p){be=!0;break}}}return be||!1}var Je=1e-6,qe=typeof Float32Array<"u"?Float32Array:Array;function Ze(){var l=new qe(9);return qe!=Float32Array&&(l[1]=0,l[2]=0,l[3]=0,l[5]=0,l[6]=0,l[7]=0),l[0]=1,l[4]=1,l[8]=1,l}function je(l){return l[0]=1,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=1,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=1,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l}function Be(){var l=new qe(3);return qe!=Float32Array&&(l[0]=0,l[1]=0,l[2]=0),l}function de(l){return Math.hypot(l[0],l[1],l[2])}function ce(l,r,o){var p=new qe(3);return p[0]=l,p[1]=r,p[2]=o,p}function _e(l,r,o){return l[0]=r[0]+o[0],l[1]=r[1]+o[1],l[2]=r[2]+o[2],l}function Ae(l,r,o){return l[0]=r[0]*o,l[1]=r[1]*o,l[2]=r[2]*o,l}function Me(l,r,o){var p=r[0],v=r[1],E=r[2],A=o[0],P=o[1],z=o[2];return l[0]=v*z-E*P,l[1]=E*A-p*z,l[2]=p*P-v*A,l}Math.hypot||(Math.hypot=function(){for(var l=0,r=arguments.length;r--;)l+=arguments[r]*arguments[r];return Math.sqrt(l)});var Ge,Re=de;function Pn(l,r,o){var p=r[0],v=r[1],E=r[2],A=r[3];return l[0]=o[0]*p+o[4]*v+o[8]*E+o[12]*A,l[1]=o[1]*p+o[5]*v+o[9]*E+o[13]*A,l[2]=o[2]*p+o[6]*v+o[10]*E+o[14]*A,l[3]=o[3]*p+o[7]*v+o[11]*E+o[15]*A,l}function ei(){var l=new qe(4);return qe!=Float32Array&&(l[0]=0,l[1]=0,l[2]=0),l[3]=1,l}function mt(l,r,o,p){var v=.5*Math.PI/180;r*=v,o*=v,p*=v;var E=Math.sin(r),A=Math.cos(r),P=Math.sin(o),z=Math.cos(o),F=Math.sin(p),$=Math.cos(p);return l[0]=E*z*$-A*P*F,l[1]=A*P*$+E*z*F,l[2]=A*z*F-E*P*$,l[3]=A*z*$+E*P*F,l}function $t(){var l=new qe(2);return qe!=Float32Array&&(l[0]=0,l[1]=0),l}function Tt(l,r){var o=new qe(2);return o[0]=l,o[1]=r,o}Be(),Ge=new qe(4),qe!=Float32Array&&(Ge[0]=0,Ge[1]=0,Ge[2]=0,Ge[3]=0),Be(),ce(1,0,0),ce(0,1,0),ei(),ei(),Ze(),$t();const zt=8192;function Bt(l,r,o){return r*(zt/(l.tileSize*Math.pow(2,o-l.tileID.overscaledZ)))}function Le(l,r){return(l%r+r)%r}function vt(l,r,o){return l*(1-o)+r*o}function Ot(l){if(l<=0)return 0;if(l>=1)return 1;const r=l*l,o=r*l;return 4*(l<.5?o:3*(l-r)+o-.75)}function Ut(l,r,o,p){const v=new Y(l,r,o,p);return E=>v.solve(E)}const Jt=Ut(.25,.1,.25,1);function Wt(l,r,o){return Math.min(o,Math.max(r,l))}function Fn(l,r,o){const p=o-r,v=((l-r)%p+p)%p+r;return v===r?o:v}function oi(l,...r){for(const o of r)for(const p in o)l[p]=o[p];return l}let fi=1;function fs(l,r,o){const p={};for(const v in l)p[v]=r.call(this,l[v],v,l);return p}function Bs(l,r,o){const p={};for(const v in l)r.call(this,l[v],v,l)&&(p[v]=l[v]);return p}function Dr(l){return Array.isArray(l)?l.map(Dr):typeof l=="object"&&l?fs(l,Dr):l}const Fi={};function Mi(l){Fi[l]||(typeof console<"u"&&console.warn(l),Fi[l]=!0)}function Ua(l,r,o){return(o.y-l.y)*(r.x-l.x)>(r.y-l.y)*(o.x-l.x)}function Sa(l){return typeof WorkerGlobalScope<"u"&&l!==void 0&&l instanceof WorkerGlobalScope}let Fs=null;function Ea(l){return typeof ImageBitmap<"u"&&l instanceof ImageBitmap}const Vi="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function pr(l,r,o,p,v){return c(this,void 0,void 0,(function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const E=new VideoFrame(l,{timestamp:0});try{const A=E==null?void 0:E.format;if(!A||!A.startsWith("BGR")&&!A.startsWith("RGB"))throw new Error(`Unrecognized format ${A}`);const P=A.startsWith("BGR"),z=new Uint8ClampedArray(p*v*4);if(yield E.copyTo(z,(function(F,$,W,te,ie){const re=4*Math.max(-$,0),oe=(Math.max(0,W)-W)*te*4+re,pe=4*te,Te=Math.max(0,$),Ke=Math.max(0,W);return{rect:{x:Te,y:Ke,width:Math.min(F.width,$+te)-Te,height:Math.min(F.height,W+ie)-Ke},layout:[{offset:oe,stride:pe}]}})(l,r,o,p,v)),P)for(let F=0;F<z.length;F+=4){const $=z[F];z[F]=z[F+2],z[F+2]=$}return z}finally{E.close()}}))}let Aa,Eo;function oo(l,r,o,p){return l.addEventListener(r,o,p),{unsubscribe:()=>{l.removeEventListener(r,o,p)}}}function qr(l){return l*Math.PI/180}function ps(l){return l/Math.PI*180}const ms={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},Vs={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},gs="AbortError";function Xe(){return new Error(gs)}const se={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function le(l){return se.REGISTERED_PROTOCOLS[l.substring(0,l.indexOf("://"))]}const fe="global-dispatcher";class Se extends Error{constructor(r,o,p,v){super(`AJAXError: ${o} (${r}): ${p}`),this.status=r,this.statusText=o,this.url=p,this.body=v}}const De=()=>Sa(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,He=function(l,r){if(/:\/\//.test(l.url)&&!/^https?:|^file:/.test(l.url)){const p=le(l.url);if(p)return p(l,r);if(Sa(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:l,targetMapId:fe},r)}if(!(/^file:/.test(o=l.url)||/^file:/.test(De())&&!/^\w+:/.test(o))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return(function(p,v){return c(this,void 0,void 0,(function*(){const E=new Request(p.url,{method:p.method||"GET",body:p.body,credentials:p.credentials,headers:p.headers,cache:p.cache,referrer:De(),signal:v.signal});let A,P;p.type!=="json"||E.headers.has("Accept")||E.headers.set("Accept","application/json");try{A=yield fetch(E)}catch(F){throw new Se(0,F.message,p.url,new Blob)}if(!A.ok){const F=yield A.blob();throw new Se(A.status,A.statusText,p.url,F)}P=p.type==="arrayBuffer"||p.type==="image"?A.arrayBuffer():p.type==="json"?A.json():A.text();const z=yield P;if(v.signal.aborted)throw Xe();return{data:z,cacheControl:A.headers.get("Cache-Control"),expires:A.headers.get("Expires")}}))})(l,r);if(Sa(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:l,mustQueue:!0,targetMapId:fe},r)}var o;return(function(p,v){return new Promise(((E,A)=>{var P;const z=new XMLHttpRequest;z.open(p.method||"GET",p.url,!0),p.type!=="arrayBuffer"&&p.type!=="image"||(z.responseType="arraybuffer");for(const F in p.headers)z.setRequestHeader(F,p.headers[F]);p.type==="json"&&(z.responseType="text",!((P=p.headers)===null||P===void 0)&&P.Accept||z.setRequestHeader("Accept","application/json")),z.withCredentials=p.credentials==="include",z.onerror=()=>{A(new Error(z.statusText))},z.onload=()=>{if(!v.signal.aborted)if((z.status>=200&&z.status<300||z.status===0)&&z.response!==null){let F=z.response;if(p.type==="json")try{F=JSON.parse(z.response)}catch($){return void A($)}E({data:F,cacheControl:z.getResponseHeader("Cache-Control"),expires:z.getResponseHeader("Expires")})}else{const F=new Blob([z.response],{type:z.getResponseHeader("Content-Type")});A(new Se(z.status,z.statusText,p.url,F))}},v.signal.addEventListener("abort",(()=>{z.abort(),A(Xe())})),z.send(p.body)}))})(l,r)};function tt(l){if(!l||l.indexOf("://")<=0||l.indexOf("data:image/")===0||l.indexOf("blob:")===0)return!0;const r=new URL(l),o=window.location;return r.protocol===o.protocol&&r.host===o.host}function We(l,r,o){o[l]&&o[l].indexOf(r)!==-1||(o[l]=o[l]||[],o[l].push(r))}function _t(l,r,o){if(o&&o[l]){const p=o[l].indexOf(r);p!==-1&&o[l].splice(p,1)}}class Pt{constructor(r,o={}){oi(this,o),this.type=r}}class xt extends Pt{constructor(r,o={}){super("error",oi({error:r},o))}}class tn{on(r,o){return this._listeners=this._listeners||{},We(r,o,this._listeners),{unsubscribe:()=>{this.off(r,o)}}}off(r,o){return _t(r,o,this._listeners),_t(r,o,this._oneTimeListeners),this}once(r,o){return o?(this._oneTimeListeners=this._oneTimeListeners||{},We(r,o,this._oneTimeListeners),this):new Promise((p=>this.once(r,p)))}fire(r,o){typeof r=="string"&&(r=new Pt(r,o||{}));const p=r.type;if(this.listens(p)){r.target=this;const v=this._listeners&&this._listeners[p]?this._listeners[p].slice():[];for(const P of v)P.call(this,r);const E=this._oneTimeListeners&&this._oneTimeListeners[p]?this._oneTimeListeners[p].slice():[];for(const P of E)_t(p,P,this._oneTimeListeners),P.call(this,r);const A=this._eventedParent;A&&(oi(r,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),A.fire(r))}else r instanceof xt&&console.error(r.error);return this}listens(r){return this._listeners&&this._listeners[r]&&this._listeners[r].length>0||this._oneTimeListeners&&this._oneTimeListeners[r]&&this._oneTimeListeners[r].length>0||this._eventedParent&&this._eventedParent.listens(r)}setEventedParent(r,o){return this._eventedParent=r,this._eventedParentData=o,this}}var $e={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const vn=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Rn(l,r){const o={};for(const p in l)p!=="ref"&&(o[p]=l[p]);return vn.forEach((p=>{p in r&&(o[p]=r[p])})),o}function nn(l,r){if(Array.isArray(l)){if(!Array.isArray(r)||l.length!==r.length)return!1;for(let o=0;o<l.length;o++)if(!nn(l[o],r[o]))return!1;return!0}if(typeof l=="object"&&l!==null&&r!==null){if(typeof r!="object"||Object.keys(l).length!==Object.keys(r).length)return!1;for(const o in l)if(!nn(l[o],r[o]))return!1;return!0}return l===r}function Nn(l,r){l.push(r)}function Ri(l,r,o){Nn(o,{command:"addSource",args:[l,r[l]]})}function Gi(l,r,o){Nn(r,{command:"removeSource",args:[l]}),o[l]=!0}function tr(l,r,o,p){Gi(l,o,p),Ri(l,r,o)}function Ir(l,r,o){let p;for(p in l[o])if(Object.prototype.hasOwnProperty.call(l[o],p)&&p!=="data"&&!nn(l[o][p],r[o][p]))return!1;for(p in r[o])if(Object.prototype.hasOwnProperty.call(r[o],p)&&p!=="data"&&!nn(l[o][p],r[o][p]))return!1;return!0}function Vn(l,r,o,p,v,E){l=l||{},r=r||{};for(const A in l)Object.prototype.hasOwnProperty.call(l,A)&&(nn(l[A],r[A])||o.push({command:E,args:[p,A,r[A],v]}));for(const A in r)Object.prototype.hasOwnProperty.call(r,A)&&!Object.prototype.hasOwnProperty.call(l,A)&&(nn(l[A],r[A])||o.push({command:E,args:[p,A,r[A],v]}))}function Xn(l){return l.id}function br(l,r){return l[r.id]=r,l}class Mt{constructor(r,o,p,v){this.message=(r?`${r}: `:"")+p,v&&(this.identifier=v),o!=null&&o.__line__&&(this.line=o.__line__)}}function en(l,...r){for(const o of r)for(const p in o)l[p]=o[p];return l}class nr extends Error{constructor(r,o){super(o),this.message=o,this.key=r}}class na{constructor(r,o=[]){this.parent=r,this.bindings={};for(const[p,v]of o)this.bindings[p]=v}concat(r){return new na(this,r)}get(r){if(this.bindings[r])return this.bindings[r];if(this.parent)return this.parent.get(r);throw new Error(`${r} not found in scope.`)}has(r){return!!this.bindings[r]||!!this.parent&&this.parent.has(r)}}const Ca={kind:"null"},kt={kind:"number"},yn={kind:"string"},In={kind:"boolean"},ir={kind:"color"},rl={kind:"projectionDefinition"},Ao={kind:"object"},Bn={kind:"value"},Us={kind:"collator"},js={kind:"formatted"},_s={kind:"padding"},Gr={kind:"colorArray"},Hr={kind:"numberArray"},Ei={kind:"resolvedImage"},Pr={kind:"variableAnchorOffsetCollection"};function fa(l,r){return{kind:"array",itemType:l,N:r}}function wi(l){if(l.kind==="array"){const r=wi(l.itemType);return typeof l.N=="number"?`array<${r}, ${l.N}>`:l.itemType.kind==="value"?"array":`array<${r}>`}return l.kind}const Co=[Ca,kt,yn,In,ir,rl,js,Ao,fa(Bn),_s,Hr,Gr,Ei,Pr];function ja(l,r){if(r.kind==="error")return null;if(l.kind==="array"){if(r.kind==="array"&&(r.N===0&&r.itemType.kind==="value"||!ja(l.itemType,r.itemType))&&(typeof l.N!="number"||l.N===r.N))return null}else{if(l.kind===r.kind)return null;if(l.kind==="value"){for(const o of Co)if(!ja(o,r))return null}}return`Expected ${wi(l)} but found ${wi(r)} instead.`}function Io(l,r){return r.some((o=>o.kind===l.kind))}function $s(l,r){return r.some((o=>o==="null"?l===null:o==="array"?Array.isArray(l):o==="object"?l&&!Array.isArray(l)&&typeof l=="object":o===typeof l))}function qs(l,r){return l.kind==="array"&&r.kind==="array"?l.itemType.kind===r.itemType.kind&&typeof l.N=="number":l.kind===r.kind}const al=.96422,ii=.82521,hi=4/29,Hi=6/29,xr=3*Hi*Hi,Gs=Hi*Hi*Hi,fu=Math.PI/180,on=180/Math.PI;function Ui(l){return(l%=360)<0&&(l+=360),l}function Ia([l,r,o,p]){let v,E;const A=rr((.2225045*(l=lo(l))+.7168786*(r=lo(r))+.0606169*(o=lo(o)))/1);l===r&&r===o?v=E=A:(v=rr((.4360747*l+.3850649*r+.1430804*o)/al),E=rr((.0139322*l+.0971045*r+.7141733*o)/ii));const P=116*A-16;return[P<0?0:P,500*(v-A),200*(A-E),p]}function lo(l){return l<=.04045?l/12.92:Math.pow((l+.055)/1.055,2.4)}function rr(l){return l>Gs?Math.pow(l,1/3):l/xr+hi}function Po([l,r,o,p]){let v=(l+16)/116,E=isNaN(r)?v:v+r/500,A=isNaN(o)?v:v-o/200;return v=1*Hs(v),E=al*Hs(E),A=ii*Hs(A),[Dl(3.1338561*E-1.6168667*v-.4906146*A),Dl(-.9787684*E+1.9161415*v+.033454*A),Dl(.0719453*E-.2289914*v+1.4052427*A),p]}function Dl(l){return(l=l<=.00304?12.92*l:1.055*Math.pow(l,1/2.4)-.055)<0?0:l>1?1:l}function Hs(l){return l>Hi?l*l*l:xr*(l-hi)}const ar=Object.hasOwn||function(l,r){return Object.prototype.hasOwnProperty.call(l,r)};function Ja(l,r){return ar(l,r)?l[r]:void 0}function $a(l){return parseInt(l.padEnd(2,l),16)/255}function Zi(l,r){return Un(r?l/100:l,0,1)}function Un(l,r,o){return Math.min(Math.max(r,l),o)}function es(l){return!l.some(Number.isNaN)}const ys={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function qa(l,r,o){return l+o*(r-l)}function Zs(l,r,o){return l.map(((p,v)=>qa(p,r[v],o)))}class kn{constructor(r,o,p,v=1,E=!0){this.r=r,this.g=o,this.b=p,this.a=v,E||(this.r*=v,this.g*=v,this.b*=v,v||this.overwriteGetter("rgb",[r,o,p,v]))}static parse(r){if(r instanceof kn)return r;if(typeof r!="string")return;const o=(function(p){if((p=p.toLowerCase().trim())==="transparent")return[0,0,0,0];const v=Ja(ys,p);if(v){const[A,P,z]=v;return[A/255,P/255,z/255,1]}if(p.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(p)){const A=p.length<6?1:2;let P=1;return[$a(p.slice(P,P+=A)),$a(p.slice(P,P+=A)),$a(p.slice(P,P+=A)),$a(p.slice(P,P+A)||"ff")]}if(p.startsWith("rgb")){const A=p.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(A){const[P,z,F,$,W,te,ie,re,oe,pe,Te,Ke]=A,ke=[$||" ",ie||" ",pe].join("");if(ke==="  "||ke==="  /"||ke===",,"||ke===",,,"){const Fe=[F,te,oe].join(""),ot=Fe==="%%%"?100:Fe===""?255:0;if(ot){const gt=[Un(+z/ot,0,1),Un(+W/ot,0,1),Un(+re/ot,0,1),Te?Zi(+Te,Ke):1];if(es(gt))return gt}}return}}const E=p.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(E){const[A,P,z,F,$,W,te,ie,re]=E,oe=[z||" ",$||" ",te].join("");if(oe==="  "||oe==="  /"||oe===",,"||oe===",,,"){const pe=[+P,Un(+F,0,100),Un(+W,0,100),ie?Zi(+ie,re):1];if(es(pe))return(function([Te,Ke,ke,Fe]){function ot(gt){const Ct=(gt+Te/30)%12,Gt=Ke*Math.min(ke,1-ke);return ke-Gt*Math.max(-1,Math.min(Ct-3,9-Ct,1))}return Te=Ui(Te),Ke/=100,ke/=100,[ot(0),ot(8),ot(4),Fe]})(pe)}}})(r);return o?new kn(...o,!1):void 0}get rgb(){const{r,g:o,b:p,a:v}=this,E=v||1/0;return this.overwriteGetter("rgb",[r/E,o/E,p/E,v])}get hcl(){return this.overwriteGetter("hcl",(function(r){const[o,p,v,E]=Ia(r),A=Math.sqrt(p*p+v*v);return[Math.round(1e4*A)?Ui(Math.atan2(v,p)*on):NaN,A,o,E]})(this.rgb))}get lab(){return this.overwriteGetter("lab",Ia(this.rgb))}overwriteGetter(r,o){return Object.defineProperty(this,r,{value:o}),o}toString(){const[r,o,p,v]=this.rgb;return`rgba(${[r,o,p].map((E=>Math.round(255*E))).join(",")},${v})`}static interpolate(r,o,p,v="rgb"){switch(v){case"rgb":{const[E,A,P,z]=Zs(r.rgb,o.rgb,p);return new kn(E,A,P,z,!1)}case"hcl":{const[E,A,P,z]=r.hcl,[F,$,W,te]=o.hcl;let ie,re;if(isNaN(E)||isNaN(F))isNaN(E)?isNaN(F)?ie=NaN:(ie=F,P!==1&&P!==0||(re=$)):(ie=E,W!==1&&W!==0||(re=A));else{let ke=F-E;F>E&&ke>180?ke-=360:F<E&&E-F>180&&(ke+=360),ie=E+p*ke}const[oe,pe,Te,Ke]=(function([ke,Fe,ot,gt]){return ke=isNaN(ke)?0:ke*fu,Po([ot,Math.cos(ke)*Fe,Math.sin(ke)*Fe,gt])})([ie,re??qa(A,$,p),qa(P,W,p),qa(z,te,p)]);return new kn(oe,pe,Te,Ke,!1)}case"lab":{const[E,A,P,z]=Po(Zs(r.lab,o.lab,p));return new kn(E,A,P,z,!1)}}}}kn.black=new kn(0,0,0,1),kn.white=new kn(1,1,1,1),kn.transparent=new kn(0,0,0,0),kn.red=new kn(1,0,0,1);class vs{constructor(r,o,p){this.sensitivity=r?o?"variant":"case":o?"accent":"base",this.locale=p,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(r,o){return this.collator.compare(r,o)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const Pa=["bottom","center","top"];class zl{constructor(r,o,p,v,E,A){this.text=r,this.image=o,this.scale=p,this.fontStack=v,this.textColor=E,this.verticalAlign=A}}class Wi{constructor(r){this.sections=r}static fromString(r){return new Wi([new zl(r,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((r=>r.text.length!==0||r.image&&r.image.name.length!==0))}static factory(r){return r instanceof Wi?r:Wi.fromString(r)}toString(){return this.sections.length===0?"":this.sections.map((r=>r.text)).join("")}}class mr{constructor(r){this.values=r.slice()}static parse(r){if(r instanceof mr)return r;if(typeof r=="number")return new mr([r,r,r,r]);if(Array.isArray(r)&&!(r.length<1||r.length>4)){for(const o of r)if(typeof o!="number")return;switch(r.length){case 1:r=[r[0],r[0],r[0],r[0]];break;case 2:r=[r[0],r[1],r[0],r[1]];break;case 3:r=[r[0],r[1],r[2],r[1]]}return new mr(r)}}toString(){return JSON.stringify(this.values)}static interpolate(r,o,p){return new mr(Zs(r.values,o.values,p))}}class hn{constructor(r){this.values=r.slice()}static parse(r){if(r instanceof hn)return r;if(typeof r=="number")return new hn([r]);if(Array.isArray(r)){for(const o of r)if(typeof o!="number")return;return new hn(r)}}toString(){return JSON.stringify(this.values)}static interpolate(r,o,p){return new hn(Zs(r.values,o.values,p))}}class pi{constructor(r){this.values=r.slice()}static parse(r){if(r instanceof pi)return r;if(typeof r=="string"){const p=kn.parse(r);return p?new pi([p]):void 0}if(!Array.isArray(r))return;const o=[];for(const p of r){if(typeof p!="string")return;const v=kn.parse(p);if(!v)return;o.push(v)}return new pi(o)}toString(){return JSON.stringify(this.values)}static interpolate(r,o,p,v="rgb"){const E=[];if(r.values.length!=o.values.length)throw new Error(`colorArray: Arrays have mismatched length (${r.values.length} vs. ${o.values.length}), cannot interpolate.`);for(let A=0;A<r.values.length;A++)E.push(kn.interpolate(r.values[A],o.values[A],p,v));return new pi(E)}}class xn extends Error{constructor(r){super(r),this.name="RuntimeError"}toJSON(){return this.message}}const sl=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class sr{constructor(r){this.values=r.slice()}static parse(r){if(r instanceof sr)return r;if(Array.isArray(r)&&!(r.length<1)&&r.length%2==0){for(let o=0;o<r.length;o+=2){const p=r[o],v=r[o+1];if(typeof p!="string"||!sl.has(p)||!Array.isArray(v)||v.length!==2||typeof v[0]!="number"||typeof v[1]!="number")return}return new sr(r)}}toString(){return JSON.stringify(this.values)}static interpolate(r,o,p){const v=r.values,E=o.values;if(v.length!==E.length)throw new xn(`Cannot interpolate values of different length. from: ${r.toString()}, to: ${o.toString()}`);const A=[];for(let P=0;P<v.length;P+=2){if(v[P]!==E[P])throw new xn(`Cannot interpolate values containing mismatched anchors. from[${P}]: ${v[P]}, to[${P}]: ${E[P]}`);A.push(v[P]);const[z,F]=v[P+1],[$,W]=E[P+1];A.push([qa(z,$,p),qa(F,W,p)])}return new sr(A)}}class cr{constructor(r){this.name=r.name,this.available=r.available}toString(){return this.name}static fromString(r){return r?new cr({name:r,available:!1}):null}}class wr{constructor(r,o,p){this.from=r,this.to=o,this.transition=p}static interpolate(r,o,p){return new wr(r,o,p)}static parse(r){return r instanceof wr?r:Array.isArray(r)&&r.length===3&&typeof r[0]=="string"&&typeof r[1]=="string"&&typeof r[2]=="number"?new wr(r[0],r[1],r[2]):typeof r=="object"&&typeof r.from=="string"&&typeof r.to=="string"&&typeof r.transition=="number"?new wr(r.from,r.to,r.transition):typeof r=="string"?new wr(r,r,1):void 0}}function bn(l,r,o,p){return typeof l=="number"&&l>=0&&l<=255&&typeof r=="number"&&r>=0&&r<=255&&typeof o=="number"&&o>=0&&o<=255?p===void 0||typeof p=="number"&&p>=0&&p<=1?null:`Invalid rgba value [${[l,r,o,p].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof p=="number"?[l,r,o,p]:[l,r,o]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function pa(l){if(l===null||typeof l=="string"||typeof l=="boolean"||typeof l=="number"||l instanceof wr||l instanceof kn||l instanceof vs||l instanceof Wi||l instanceof mr||l instanceof hn||l instanceof pi||l instanceof sr||l instanceof cr)return!0;if(Array.isArray(l)){for(const r of l)if(!pa(r))return!1;return!0}if(typeof l=="object"){for(const r in l)if(!pa(l[r]))return!1;return!0}return!1}function fn(l){if(l===null)return Ca;if(typeof l=="string")return yn;if(typeof l=="boolean")return In;if(typeof l=="number")return kt;if(l instanceof kn)return ir;if(l instanceof wr)return rl;if(l instanceof vs)return Us;if(l instanceof Wi)return js;if(l instanceof mr)return _s;if(l instanceof hn)return Hr;if(l instanceof pi)return Gr;if(l instanceof sr)return Pr;if(l instanceof cr)return Ei;if(Array.isArray(l)){const r=l.length;let o;for(const p of l){const v=fn(p);if(o){if(o===v)continue;o=Bn;break}o=v}return fa(o||Bn,r)}return Ao}function sn(l){const r=typeof l;return l===null?"":r==="string"||r==="number"||r==="boolean"?String(l):l instanceof kn||l instanceof wr||l instanceof Wi||l instanceof mr||l instanceof hn||l instanceof pi||l instanceof sr||l instanceof cr?l.toString():JSON.stringify(l)}class ia{constructor(r,o){this.type=r,this.value=o}static parse(r,o){if(r.length!==2)return o.error(`'literal' expression requires exactly one argument, but found ${r.length-1} instead.`);if(!pa(r[1]))return o.error("invalid value");const p=r[1];let v=fn(p);const E=o.expectedType;return v.kind!=="array"||v.N!==0||!E||E.kind!=="array"||typeof E.N=="number"&&E.N!==0||(v=E),new ia(v,p)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const $n={string:yn,number:kt,boolean:In,object:Ao};class zr{constructor(r,o){this.type=r,this.args=o}static parse(r,o){if(r.length<2)return o.error("Expected at least one argument.");let p,v=1;const E=r[0];if(E==="array"){let P,z;if(r.length>2){const F=r[1];if(typeof F!="string"||!(F in $n)||F==="object")return o.error('The item type argument of "array" must be one of string, number, boolean',1);P=$n[F],v++}else P=Bn;if(r.length>3){if(r[2]!==null&&(typeof r[2]!="number"||r[2]<0||r[2]!==Math.floor(r[2])))return o.error('The length argument to "array" must be a positive integer literal',2);z=r[2],v++}p=fa(P,z)}else{if(!$n[E])throw new Error(`Types doesn't contain name = ${E}`);p=$n[E]}const A=[];for(;v<r.length;v++){const P=o.parse(r[v],v,Bn);if(!P)return null;A.push(P)}return new zr(p,A)}evaluate(r){for(let o=0;o<this.args.length;o++){const p=this.args[o].evaluate(r);if(!ja(this.type,fn(p)))return p;if(o===this.args.length-1)throw new xn(`Expected value to be of type ${wi(this.type)}, but found ${wi(fn(p))} instead.`)}throw new Error}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every((r=>r.outputDefined()))}}const Qr={"to-boolean":In,"to-color":ir,"to-number":kt,"to-string":yn};class or{constructor(r,o){this.type=r,this.args=o}static parse(r,o){if(r.length<2)return o.error("Expected at least one argument.");const p=r[0];if(!Qr[p])throw new Error(`Can't parse ${p} as it is not part of the known types`);if((p==="to-boolean"||p==="to-string")&&r.length!==2)return o.error("Expected one argument.");const v=Qr[p],E=[];for(let A=1;A<r.length;A++){const P=o.parse(r[A],A,Bn);if(!P)return null;E.push(P)}return new or(v,E)}evaluate(r){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(r);case"color":{let o,p;for(const v of this.args){if(o=v.evaluate(r),p=null,o instanceof kn)return o;if(typeof o=="string"){const E=r.parseColor(o);if(E)return E}else if(Array.isArray(o)&&(p=o.length<3||o.length>4?`Invalid rgba value ${JSON.stringify(o)}: expected an array containing either three or four numeric values.`:bn(o[0],o[1],o[2],o[3]),!p))return new kn(o[0]/255,o[1]/255,o[2]/255,o[3])}throw new xn(p||`Could not parse color from value '${typeof o=="string"?o:JSON.stringify(o)}'`)}case"padding":{let o;for(const p of this.args){o=p.evaluate(r);const v=mr.parse(o);if(v)return v}throw new xn(`Could not parse padding from value '${typeof o=="string"?o:JSON.stringify(o)}'`)}case"numberArray":{let o;for(const p of this.args){o=p.evaluate(r);const v=hn.parse(o);if(v)return v}throw new xn(`Could not parse numberArray from value '${typeof o=="string"?o:JSON.stringify(o)}'`)}case"colorArray":{let o;for(const p of this.args){o=p.evaluate(r);const v=pi.parse(o);if(v)return v}throw new xn(`Could not parse colorArray from value '${typeof o=="string"?o:JSON.stringify(o)}'`)}case"variableAnchorOffsetCollection":{let o;for(const p of this.args){o=p.evaluate(r);const v=sr.parse(o);if(v)return v}throw new xn(`Could not parse variableAnchorOffsetCollection from value '${typeof o=="string"?o:JSON.stringify(o)}'`)}case"number":{let o=null;for(const p of this.args){if(o=p.evaluate(r),o===null)return 0;const v=Number(o);if(!isNaN(v))return v}throw new xn(`Could not convert ${JSON.stringify(o)} to number.`)}case"formatted":return Wi.fromString(sn(this.args[0].evaluate(r)));case"resolvedImage":return cr.fromString(sn(this.args[0].evaluate(r)));case"projectionDefinition":return this.args[0].evaluate(r);default:return sn(this.args[0].evaluate(r))}}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every((r=>r.outputDefined()))}}const bs=["Unknown","Point","LineString","Polygon"];class uo{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?bs[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(r){let o=this._parseColorCache.get(r);return o||(o=kn.parse(r),this._parseColorCache.set(r,o)),o}}class xs{constructor(r,o,p=[],v,E=new na,A=[]){this.registry=r,this.path=p,this.key=p.map((P=>`[${P}]`)).join(""),this.scope=E,this.errors=A,this.expectedType=v,this._isConstant=o}parse(r,o,p,v,E={}){return o?this.concat(o,p,v)._parse(r,E):this._parse(r,E)}_parse(r,o){function p(v,E,A){return A==="assert"?new zr(E,[v]):A==="coerce"?new or(E,[v]):v}if(r!==null&&typeof r!="string"&&typeof r!="boolean"&&typeof r!="number"||(r=["literal",r]),Array.isArray(r)){if(r.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const v=r[0];if(typeof v!="string")return this.error(`Expression name must be a string, but found ${typeof v} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const E=this.registry[v];if(E){let A=E.parse(r,this);if(!A)return null;if(this.expectedType){const P=this.expectedType,z=A.type;if(P.kind!=="string"&&P.kind!=="number"&&P.kind!=="boolean"&&P.kind!=="object"&&P.kind!=="array"||z.kind!=="value"){if(P.kind==="projectionDefinition"&&["string","array"].includes(z.kind)||["color","formatted","resolvedImage"].includes(P.kind)&&["value","string"].includes(z.kind)||["padding","numberArray"].includes(P.kind)&&["value","number","array"].includes(z.kind)||P.kind==="colorArray"&&["value","string","array"].includes(z.kind)||P.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(z.kind))A=p(A,P,o.typeAnnotation||"coerce");else if(this.checkSubtype(P,z))return null}else A=p(A,P,o.typeAnnotation||"assert")}if(!(A instanceof ia)&&A.type.kind!=="resolvedImage"&&this._isConstant(A)){const P=new uo;try{A=new ia(A.type,A.evaluate(P))}catch(z){return this.error(z.message),null}}return A}return this.error(`Unknown expression "${v}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(r===void 0?"'undefined' value invalid. Use null instead.":typeof r=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof r} instead.`)}concat(r,o,p){const v=typeof r=="number"?this.path.concat(r):this.path,E=p?this.scope.concat(p):this.scope;return new xs(this.registry,this._isConstant,v,o||null,E,this.errors)}error(r,...o){const p=`${this.key}${o.map((v=>`[${v}]`)).join("")}`;this.errors.push(new nr(p,r))}checkSubtype(r,o){const p=ja(r,o);return p&&this.error(p),p}}class Wn{constructor(r,o){this.type=o.type,this.bindings=[].concat(r),this.result=o}evaluate(r){return this.result.evaluate(r)}eachChild(r){for(const o of this.bindings)r(o[1]);r(this.result)}static parse(r,o){if(r.length<4)return o.error(`Expected at least 3 arguments, but found ${r.length-1} instead.`);const p=[];for(let E=1;E<r.length-1;E+=2){const A=r[E];if(typeof A!="string")return o.error(`Expected string, but found ${typeof A} instead.`,E);if(/[^a-zA-Z0-9_]/.test(A))return o.error("Variable names must contain only alphanumeric characters or '_'.",E);const P=o.parse(r[E+1],E+1);if(!P)return null;p.push([A,P])}const v=o.parse(r[r.length-1],r.length-1,o.expectedType,p);return v?new Wn(p,v):null}outputDefined(){return this.result.outputDefined()}}class Mo{constructor(r,o){this.type=o.type,this.name=r,this.boundExpression=o}static parse(r,o){if(r.length!==2||typeof r[1]!="string")return o.error("'var' expression requires exactly one string literal argument.");const p=r[1];return o.scope.has(p)?new Mo(p,o.scope.get(p)):o.error(`Unknown variable "${p}". Make sure "${p}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(r){return this.boundExpression.evaluate(r)}eachChild(){}outputDefined(){return!1}}class ra{constructor(r,o,p){this.type=r,this.index=o,this.input=p}static parse(r,o){if(r.length!==3)return o.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const p=o.parse(r[1],1,kt),v=o.parse(r[2],2,fa(o.expectedType||Bn));return p&&v?new ra(v.type.itemType,p,v):null}evaluate(r){const o=this.index.evaluate(r),p=this.input.evaluate(r);if(o<0)throw new xn(`Array index out of bounds: ${o} < 0.`);if(o>=p.length)throw new xn(`Array index out of bounds: ${o} > ${p.length-1}.`);if(o!==Math.floor(o))throw new xn(`Array index must be an integer, but found ${o} instead.`);return p[o]}eachChild(r){r(this.index),r(this.input)}outputDefined(){return!1}}class Ma{constructor(r,o){this.type=In,this.needle=r,this.haystack=o}static parse(r,o){if(r.length!==3)return o.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const p=o.parse(r[1],1,Bn),v=o.parse(r[2],2,Bn);return p&&v?Io(p.type,[In,yn,kt,Ca,Bn])?new Ma(p,v):o.error(`Expected first argument to be of type boolean, string, number or null, but found ${wi(p.type)} instead`):null}evaluate(r){const o=this.needle.evaluate(r),p=this.haystack.evaluate(r);if(!p)return!1;if(!$s(o,["boolean","string","number","null"]))throw new xn(`Expected first argument to be of type boolean, string, number or null, but found ${wi(fn(o))} instead.`);if(!$s(p,["string","array"]))throw new xn(`Expected second argument to be of type array or string, but found ${wi(fn(p))} instead.`);return p.indexOf(o)>=0}eachChild(r){r(this.needle),r(this.haystack)}outputDefined(){return!0}}class Ra{constructor(r,o,p){this.type=kt,this.needle=r,this.haystack=o,this.fromIndex=p}static parse(r,o){if(r.length<=2||r.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const p=o.parse(r[1],1,Bn),v=o.parse(r[2],2,Bn);if(!p||!v)return null;if(!Io(p.type,[In,yn,kt,Ca,Bn]))return o.error(`Expected first argument to be of type boolean, string, number or null, but found ${wi(p.type)} instead`);if(r.length===4){const E=o.parse(r[3],3,kt);return E?new Ra(p,v,E):null}return new Ra(p,v)}evaluate(r){const o=this.needle.evaluate(r),p=this.haystack.evaluate(r);if(!$s(o,["boolean","string","number","null"]))throw new xn(`Expected first argument to be of type boolean, string, number or null, but found ${wi(fn(o))} instead.`);let v;if(this.fromIndex&&(v=this.fromIndex.evaluate(r)),$s(p,["string"])){const E=p.indexOf(o,v);return E===-1?-1:[...p.slice(0,E)].length}if($s(p,["array"]))return p.indexOf(o,v);throw new xn(`Expected second argument to be of type array or string, but found ${wi(fn(p))} instead.`)}eachChild(r){r(this.needle),r(this.haystack),this.fromIndex&&r(this.fromIndex)}outputDefined(){return!1}}class Or{constructor(r,o,p,v,E,A){this.inputType=r,this.type=o,this.input=p,this.cases=v,this.outputs=E,this.otherwise=A}static parse(r,o){if(r.length<5)return o.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if(r.length%2!=1)return o.error("Expected an even number of arguments.");let p,v;o.expectedType&&o.expectedType.kind!=="value"&&(v=o.expectedType);const E={},A=[];for(let F=2;F<r.length-1;F+=2){let $=r[F];const W=r[F+1];Array.isArray($)||($=[$]);const te=o.concat(F);if($.length===0)return te.error("Expected at least one branch label.");for(const re of $){if(typeof re!="number"&&typeof re!="string")return te.error("Branch labels must be numbers or strings.");if(typeof re=="number"&&Math.abs(re)>Number.MAX_SAFE_INTEGER)return te.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof re=="number"&&Math.floor(re)!==re)return te.error("Numeric branch labels must be integer values.");if(p){if(te.checkSubtype(p,fn(re)))return null}else p=fn(re);if(E[String(re)]!==void 0)return te.error("Branch labels must be unique.");E[String(re)]=A.length}const ie=o.parse(W,F,v);if(!ie)return null;v=v||ie.type,A.push(ie)}const P=o.parse(r[1],1,Bn);if(!P)return null;const z=o.parse(r[r.length-1],r.length-1,v);return z?P.type.kind!=="value"&&o.concat(1).checkSubtype(p,P.type)?null:new Or(p,v,P,E,A,z):null}evaluate(r){const o=this.input.evaluate(r);return(fn(o)===this.inputType&&this.outputs[this.cases[o]]||this.otherwise).evaluate(r)}eachChild(r){r(this.input),this.outputs.forEach(r),r(this.otherwise)}outputDefined(){return this.outputs.every((r=>r.outputDefined()))&&this.otherwise.outputDefined()}}class ws{constructor(r,o,p){this.type=r,this.branches=o,this.otherwise=p}static parse(r,o){if(r.length<4)return o.error(`Expected at least 3 arguments, but found only ${r.length-1}.`);if(r.length%2!=0)return o.error("Expected an odd number of arguments.");let p;o.expectedType&&o.expectedType.kind!=="value"&&(p=o.expectedType);const v=[];for(let A=1;A<r.length-1;A+=2){const P=o.parse(r[A],A,In);if(!P)return null;const z=o.parse(r[A+1],A+1,p);if(!z)return null;v.push([P,z]),p=p||z.type}const E=o.parse(r[r.length-1],r.length-1,p);if(!E)return null;if(!p)throw new Error("Can't infer output type");return new ws(p,v,E)}evaluate(r){for(const[o,p]of this.branches)if(o.evaluate(r))return p.evaluate(r);return this.otherwise.evaluate(r)}eachChild(r){for(const[o,p]of this.branches)r(o),r(p);r(this.otherwise)}outputDefined(){return this.branches.every((([r,o])=>o.outputDefined()))&&this.otherwise.outputDefined()}}class Zl{constructor(r,o,p,v){this.type=r,this.input=o,this.beginIndex=p,this.endIndex=v}static parse(r,o){if(r.length<=2||r.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const p=o.parse(r[1],1,Bn),v=o.parse(r[2],2,kt);if(!p||!v)return null;if(!Io(p.type,[fa(Bn),yn,Bn]))return o.error(`Expected first argument to be of type array or string, but found ${wi(p.type)} instead`);if(r.length===4){const E=o.parse(r[3],3,kt);return E?new Zl(p.type,p,v,E):null}return new Zl(p.type,p,v)}evaluate(r){const o=this.input.evaluate(r),p=this.beginIndex.evaluate(r);let v;if(this.endIndex&&(v=this.endIndex.evaluate(r)),$s(o,["string"]))return[...o].slice(p,v).join("");if($s(o,["array"]))return o.slice(p,v);throw new xn(`Expected first argument to be of type array or string, but found ${wi(fn(o))} instead.`)}eachChild(r){r(this.input),r(this.beginIndex),this.endIndex&&r(this.endIndex)}outputDefined(){return!1}}function Ro(l,r){const o=l.length-1;let p,v,E=0,A=o,P=0;for(;E<=A;)if(P=Math.floor((E+A)/2),p=l[P],v=l[P+1],p<=r){if(P===o||r<v)return P;E=P+1}else{if(!(p>r))throw new xn("Input is not a number.");A=P-1}return 0}class Ki{constructor(r,o,p){this.type=r,this.input=o,this.labels=[],this.outputs=[];for(const[v,E]of p)this.labels.push(v),this.outputs.push(E)}static parse(r,o){if(r.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return o.error("Expected an even number of arguments.");const p=o.parse(r[1],1,kt);if(!p)return null;const v=[];let E=null;o.expectedType&&o.expectedType.kind!=="value"&&(E=o.expectedType);for(let A=1;A<r.length;A+=2){const P=A===1?-1/0:r[A],z=r[A+1],F=A,$=A+1;if(typeof P!="number")return o.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',F);if(v.length&&v[v.length-1][0]>=P)return o.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',F);const W=o.parse(z,$,E);if(!W)return null;E=E||W.type,v.push([P,W])}return new Ki(E,p,v)}evaluate(r){const o=this.labels,p=this.outputs;if(o.length===1)return p[0].evaluate(r);const v=this.input.evaluate(r);if(v<=o[0])return p[0].evaluate(r);const E=o.length;return v>=o[E-1]?p[E-1].evaluate(r):p[Ro(o,v)].evaluate(r)}eachChild(r){r(this.input);for(const o of this.outputs)r(o)}outputDefined(){return this.outputs.every((r=>r.outputDefined()))}}function Zu(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}var ol,Wl,Ws=(function(){if(Wl)return ol;function l(r,o,p,v){this.cx=3*r,this.bx=3*(p-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*o,this.by=3*(v-o)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=o,this.p2x=p,this.p2y=v}return Wl=1,ol=l,l.prototype={sampleCurveX:function(r){return((this.ax*r+this.bx)*r+this.cx)*r},sampleCurveY:function(r){return((this.ay*r+this.by)*r+this.cy)*r},sampleCurveDerivativeX:function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},solveCurveX:function(r,o){if(o===void 0&&(o=1e-6),r<0)return 0;if(r>1)return 1;for(var p=r,v=0;v<8;v++){var E=this.sampleCurveX(p)-r;if(Math.abs(E)<o)return p;var A=this.sampleCurveDerivativeX(p);if(Math.abs(A)<1e-6)break;p-=E/A}var P=0,z=1;for(p=r,v=0;v<20&&(E=this.sampleCurveX(p),!(Math.abs(E-r)<o));v++)r>E?P=p:z=p,p=.5*(z-P)+P;return p},solve:function(r,o){return this.sampleCurveY(this.solveCurveX(r,o))}},ol})(),Ol=Zu(Ws);class lr{constructor(r,o,p,v,E){this.type=r,this.operator=o,this.interpolation=p,this.input=v,this.labels=[],this.outputs=[];for(const[A,P]of E)this.labels.push(A),this.outputs.push(P)}static interpolationFactor(r,o,p,v){let E=0;if(r.name==="exponential")E=ts(o,r.base,p,v);else if(r.name==="linear")E=ts(o,1,p,v);else if(r.name==="cubic-bezier"){const A=r.controlPoints;E=new Ol(A[0],A[1],A[2],A[3]).solve(ts(o,1,p,v))}return E}static parse(r,o){let[p,v,E,...A]=r;if(!Array.isArray(v)||v.length===0)return o.error("Expected an interpolation type expression.",1);if(v[0]==="linear")v={name:"linear"};else if(v[0]==="exponential"){const F=v[1];if(typeof F!="number")return o.error("Exponential interpolation requires a numeric base.",1,1);v={name:"exponential",base:F}}else{if(v[0]!=="cubic-bezier")return o.error(`Unknown interpolation type ${String(v[0])}`,1,0);{const F=v.slice(1);if(F.length!==4||F.some(($=>typeof $!="number"||$<0||$>1)))return o.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);v={name:"cubic-bezier",controlPoints:F}}}if(r.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return o.error("Expected an even number of arguments.");if(E=o.parse(E,2,kt),!E)return null;const P=[];let z=null;p!=="interpolate-hcl"&&p!=="interpolate-lab"||o.expectedType==Gr?o.expectedType&&o.expectedType.kind!=="value"&&(z=o.expectedType):z=ir;for(let F=0;F<A.length;F+=2){const $=A[F],W=A[F+1],te=F+3,ie=F+4;if(typeof $!="number")return o.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',te);if(P.length&&P[P.length-1][0]>=$)return o.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',te);const re=o.parse(W,ie,z);if(!re)return null;z=z||re.type,P.push([$,re])}return qs(z,kt)||qs(z,rl)||qs(z,ir)||qs(z,_s)||qs(z,Hr)||qs(z,Gr)||qs(z,Pr)||qs(z,fa(kt))?new lr(z,p,v,E,P):o.error(`Type ${wi(z)} is not interpolatable.`)}evaluate(r){const o=this.labels,p=this.outputs;if(o.length===1)return p[0].evaluate(r);const v=this.input.evaluate(r);if(v<=o[0])return p[0].evaluate(r);const E=o.length;if(v>=o[E-1])return p[E-1].evaluate(r);const A=Ro(o,v),P=lr.interpolationFactor(this.interpolation,v,o[A],o[A+1]),z=p[A].evaluate(r),F=p[A+1].evaluate(r);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return qa(z,F,P);case"color":return kn.interpolate(z,F,P);case"padding":return mr.interpolate(z,F,P);case"colorArray":return pi.interpolate(z,F,P);case"numberArray":return hn.interpolate(z,F,P);case"variableAnchorOffsetCollection":return sr.interpolate(z,F,P);case"array":return Zs(z,F,P);case"projectionDefinition":return wr.interpolate(z,F,P)}case"interpolate-hcl":switch(this.type.kind){case"color":return kn.interpolate(z,F,P,"hcl");case"colorArray":return pi.interpolate(z,F,P,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return kn.interpolate(z,F,P,"lab");case"colorArray":return pi.interpolate(z,F,P,"lab")}}}eachChild(r){r(this.input);for(const o of this.outputs)r(o)}outputDefined(){return this.outputs.every((r=>r.outputDefined()))}}function ts(l,r,o,p){const v=p-o,E=l-o;return v===0?0:r===1?E/v:(Math.pow(r,E)-1)/(Math.pow(r,v)-1)}const Ts={color:kn.interpolate,number:qa,padding:mr.interpolate,numberArray:hn.interpolate,colorArray:pi.interpolate,variableAnchorOffsetCollection:sr.interpolate,array:Zs};class Nl{constructor(r,o){this.type=r,this.args=o}static parse(r,o){if(r.length<2)return o.error("Expected at least one argument.");let p=null;const v=o.expectedType;v&&v.kind!=="value"&&(p=v);const E=[];for(const P of r.slice(1)){const z=o.parse(P,1+E.length,p,void 0,{typeAnnotation:"omit"});if(!z)return null;p=p||z.type,E.push(z)}if(!p)throw new Error("No output type");const A=v&&E.some((P=>ja(v,P.type)));return new Nl(A?Bn:p,E)}evaluate(r){let o,p=null,v=0;for(const E of this.args)if(v++,p=E.evaluate(r),p&&p instanceof cr&&!p.available&&(o||(o=p.name),p=null,v===this.args.length&&(p=o)),p!==null)break;return p}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every((r=>r.outputDefined()))}}function ll(l,r){return l==="=="||l==="!="?r.kind==="boolean"||r.kind==="string"||r.kind==="number"||r.kind==="null"||r.kind==="value":r.kind==="string"||r.kind==="number"||r.kind==="value"}function co(l,r,o,p){return p.compare(r,o)===0}function Ai(l,r,o){const p=l!=="=="&&l!=="!=";return class OP{constructor(E,A,P){this.type=In,this.lhs=E,this.rhs=A,this.collator=P,this.hasUntypedArgument=E.type.kind==="value"||A.type.kind==="value"}static parse(E,A){if(E.length!==3&&E.length!==4)return A.error("Expected two or three arguments.");const P=E[0];let z=A.parse(E[1],1,Bn);if(!z)return null;if(!ll(P,z.type))return A.concat(1).error(`"${P}" comparisons are not supported for type '${wi(z.type)}'.`);let F=A.parse(E[2],2,Bn);if(!F)return null;if(!ll(P,F.type))return A.concat(2).error(`"${P}" comparisons are not supported for type '${wi(F.type)}'.`);if(z.type.kind!==F.type.kind&&z.type.kind!=="value"&&F.type.kind!=="value")return A.error(`Cannot compare types '${wi(z.type)}' and '${wi(F.type)}'.`);p&&(z.type.kind==="value"&&F.type.kind!=="value"?z=new zr(F.type,[z]):z.type.kind!=="value"&&F.type.kind==="value"&&(F=new zr(z.type,[F])));let $=null;if(E.length===4){if(z.type.kind!=="string"&&F.type.kind!=="string"&&z.type.kind!=="value"&&F.type.kind!=="value")return A.error("Cannot use collator to compare non-string types.");if($=A.parse(E[3],3,Us),!$)return null}return new OP(z,F,$)}evaluate(E){const A=this.lhs.evaluate(E),P=this.rhs.evaluate(E);if(p&&this.hasUntypedArgument){const z=fn(A),F=fn(P);if(z.kind!==F.kind||z.kind!=="string"&&z.kind!=="number")throw new xn(`Expected arguments for "${l}" to be (string, string) or (number, number), but found (${z.kind}, ${F.kind}) instead.`)}if(this.collator&&!p&&this.hasUntypedArgument){const z=fn(A),F=fn(P);if(z.kind!=="string"||F.kind!=="string")return r(E,A,P)}return this.collator?o(E,A,P,this.collator.evaluate(E)):r(E,A,P)}eachChild(E){E(this.lhs),E(this.rhs),this.collator&&E(this.collator)}outputDefined(){return!0}}}const Wu=Ai("==",(function(l,r,o){return r===o}),co),pu=Ai("!=",(function(l,r,o){return r!==o}),(function(l,r,o,p){return!co(0,r,o,p)})),Bl=Ai("<",(function(l,r,o){return r<o}),(function(l,r,o,p){return p.compare(r,o)<0})),M=Ai(">",(function(l,r,o){return r>o}),(function(l,r,o,p){return p.compare(r,o)>0})),H=Ai("<=",(function(l,r,o){return r<=o}),(function(l,r,o,p){return p.compare(r,o)<=0})),ne=Ai(">=",(function(l,r,o){return r>=o}),(function(l,r,o,p){return p.compare(r,o)>=0}));class ye{constructor(r,o,p){this.type=Us,this.locale=p,this.caseSensitive=r,this.diacriticSensitive=o}static parse(r,o){if(r.length!==2)return o.error("Expected one argument.");const p=r[1];if(typeof p!="object"||Array.isArray(p))return o.error("Collator options argument must be an object.");const v=o.parse(p["case-sensitive"]!==void 0&&p["case-sensitive"],1,In);if(!v)return null;const E=o.parse(p["diacritic-sensitive"]!==void 0&&p["diacritic-sensitive"],1,In);if(!E)return null;let A=null;return p.locale&&(A=o.parse(p.locale,1,yn),!A)?null:new ye(v,E,A)}evaluate(r){return new vs(this.caseSensitive.evaluate(r),this.diacriticSensitive.evaluate(r),this.locale?this.locale.evaluate(r):null)}eachChild(r){r(this.caseSensitive),r(this.diacriticSensitive),this.locale&&r(this.locale)}outputDefined(){return!1}}class at{constructor(r,o,p,v,E){this.type=yn,this.number=r,this.locale=o,this.currency=p,this.minFractionDigits=v,this.maxFractionDigits=E}static parse(r,o){if(r.length!==3)return o.error("Expected two arguments.");const p=o.parse(r[1],1,kt);if(!p)return null;const v=r[2];if(typeof v!="object"||Array.isArray(v))return o.error("NumberFormat options argument must be an object.");let E=null;if(v.locale&&(E=o.parse(v.locale,1,yn),!E))return null;let A=null;if(v.currency&&(A=o.parse(v.currency,1,yn),!A))return null;let P=null;if(v["min-fraction-digits"]&&(P=o.parse(v["min-fraction-digits"],1,kt),!P))return null;let z=null;return v["max-fraction-digits"]&&(z=o.parse(v["max-fraction-digits"],1,kt),!z)?null:new at(p,E,A,P,z)}evaluate(r){return new Intl.NumberFormat(this.locale?this.locale.evaluate(r):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(r):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(r):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(r):void 0}).format(this.number.evaluate(r))}eachChild(r){r(this.number),this.locale&&r(this.locale),this.currency&&r(this.currency),this.minFractionDigits&&r(this.minFractionDigits),this.maxFractionDigits&&r(this.maxFractionDigits)}outputDefined(){return!1}}class ht{constructor(r){this.type=js,this.sections=r}static parse(r,o){if(r.length<2)return o.error("Expected at least one argument.");const p=r[1];if(!Array.isArray(p)&&typeof p=="object")return o.error("First argument must be an image or text section.");const v=[];let E=!1;for(let A=1;A<=r.length-1;++A){const P=r[A];if(E&&typeof P=="object"&&!Array.isArray(P)){E=!1;let z=null;if(P["font-scale"]&&(z=o.parse(P["font-scale"],1,kt),!z))return null;let F=null;if(P["text-font"]&&(F=o.parse(P["text-font"],1,fa(yn)),!F))return null;let $=null;if(P["text-color"]&&($=o.parse(P["text-color"],1,ir),!$))return null;let W=null;if(P["vertical-align"]){if(typeof P["vertical-align"]=="string"&&!Pa.includes(P["vertical-align"]))return o.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${P["vertical-align"]}' instead.`);if(W=o.parse(P["vertical-align"],1,yn),!W)return null}const te=v[v.length-1];te.scale=z,te.font=F,te.textColor=$,te.verticalAlign=W}else{const z=o.parse(r[A],1,Bn);if(!z)return null;const F=z.type.kind;if(F!=="string"&&F!=="value"&&F!=="null"&&F!=="resolvedImage")return o.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");E=!0,v.push({content:z,scale:null,font:null,textColor:null,verticalAlign:null})}}return new ht(v)}evaluate(r){return new Wi(this.sections.map((o=>{const p=o.content.evaluate(r);return fn(p)===Ei?new zl("",p,null,null,null,o.verticalAlign?o.verticalAlign.evaluate(r):null):new zl(sn(p),null,o.scale?o.scale.evaluate(r):null,o.font?o.font.evaluate(r).join(","):null,o.textColor?o.textColor.evaluate(r):null,o.verticalAlign?o.verticalAlign.evaluate(r):null)})))}eachChild(r){for(const o of this.sections)r(o.content),o.scale&&r(o.scale),o.font&&r(o.font),o.textColor&&r(o.textColor),o.verticalAlign&&r(o.verticalAlign)}outputDefined(){return!1}}class Kt{constructor(r){this.type=Ei,this.input=r}static parse(r,o){if(r.length!==2)return o.error("Expected two arguments.");const p=o.parse(r[1],1,yn);return p?new Kt(p):o.error("No image name provided.")}evaluate(r){const o=this.input.evaluate(r),p=cr.fromString(o);return p&&r.availableImages&&(p.available=r.availableImages.indexOf(o)>-1),p}eachChild(r){r(this.input)}outputDefined(){return!1}}class Ln{constructor(r){this.type=kt,this.input=r}static parse(r,o){if(r.length!==2)return o.error(`Expected 1 argument, but found ${r.length-1} instead.`);const p=o.parse(r[1],1);return p?p.type.kind!=="array"&&p.type.kind!=="string"&&p.type.kind!=="value"?o.error(`Expected argument of type string or array, but found ${wi(p.type)} instead.`):new Ln(p):null}evaluate(r){const o=this.input.evaluate(r);if(typeof o=="string")return[...o].length;if(Array.isArray(o))return o.length;throw new xn(`Expected value to be of type string or array, but found ${wi(fn(o))} instead.`)}eachChild(r){r(this.input)}outputDefined(){return!1}}const Kn=8192;function Ti(l,r){const o=(180+l[0])/360,p=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+l[1]*Math.PI/360)))/360,v=Math.pow(2,r.z);return[Math.round(o*v*Kn),Math.round(p*v*Kn)]}function Xi(l,r){const o=Math.pow(2,r.z);return[(v=(l[0]/Kn+r.x)/o,360*v-180),(p=(l[1]/Kn+r.y)/o,360/Math.PI*Math.atan(Math.exp((180-360*p)*Math.PI/180))-90)];var p,v}function Ga(l,r){l[0]=Math.min(l[0],r[0]),l[1]=Math.min(l[1],r[1]),l[2]=Math.max(l[2],r[0]),l[3]=Math.max(l[3],r[1])}function Ha(l,r){return!(l[0]<=r[0]||l[2]>=r[2]||l[1]<=r[1]||l[3]>=r[3])}function Ks(l,r,o){const p=l[0]-r[0],v=l[1]-r[1],E=l[0]-o[0],A=l[1]-o[1];return p*A-E*v==0&&p*E<=0&&v*A<=0}function Ss(l,r,o,p){return(v=[p[0]-o[0],p[1]-o[1]])[0]*(E=[r[0]-l[0],r[1]-l[1]])[1]-v[1]*E[0]!=0&&!(!Jd(l,r,o,p)||!Jd(o,p,l,r));var v,E}function mu(l,r,o){for(const p of o)for(let v=0;v<p.length-1;++v)if(Ss(l,r,p[v],p[v+1]))return!0;return!1}function Xs(l,r,o=!1){let p=!1;for(const P of r)for(let z=0;z<P.length-1;z++){if(Ks(l,P[z],P[z+1]))return o;(E=P[z])[1]>(v=l)[1]!=(A=P[z+1])[1]>v[1]&&v[0]<(A[0]-E[0])*(v[1]-E[1])/(A[1]-E[1])+E[0]&&(p=!p)}var v,E,A;return p}function gu(l,r){for(const o of r)if(Xs(l,o))return!0;return!1}function Ys(l,r){for(const o of l)if(!Xs(o,r))return!1;for(let o=0;o<l.length-1;++o)if(mu(l[o],l[o+1],r))return!1;return!0}function Ku(l,r){for(const o of r)if(Ys(l,o))return!0;return!1}function Jd(l,r,o,p){const v=p[0]-o[0],E=p[1]-o[1],A=(l[0]-o[0])*E-v*(l[1]-o[1]),P=(r[0]-o[0])*E-v*(r[1]-o[1]);return A>0&&P<0||A<0&&P>0}function ho(l,r,o){const p=[];for(let v=0;v<l.length;v++){const E=[];for(let A=0;A<l[v].length;A++){const P=Ti(l[v][A],o);Ga(r,P),E.push(P)}p.push(E)}return p}function rd(l,r,o){const p=[];for(let v=0;v<l.length;v++){const E=ho(l[v],r,o);p.push(E)}return p}function Qs(l,r,o,p){if(l[0]<o[0]||l[0]>o[2]){const v=.5*p;let E=l[0]-o[0]>v?-p:o[0]-l[0]>v?p:0;E===0&&(E=l[0]-o[2]>v?-p:o[2]-l[0]>v?p:0),l[0]+=E}Ga(r,l)}function Xu(l,r,o,p){const v=Math.pow(2,p.z)*Kn,E=[p.x*Kn,p.y*Kn],A=[];for(const P of l)for(const z of P){const F=[z.x+E[0],z.y+E[1]];Qs(F,r,o,v),A.push(F)}return A}function Yu(l,r,o,p){const v=Math.pow(2,p.z)*Kn,E=[p.x*Kn,p.y*Kn],A=[];for(const z of l){const F=[];for(const $ of z){const W=[$.x+E[0],$.y+E[1]];Ga(r,W),F.push(W)}A.push(F)}if(r[2]-r[0]<=v/2){(P=r)[0]=P[1]=1/0,P[2]=P[3]=-1/0;for(const z of A)for(const F of z)Qs(F,r,o,v)}var P;return A}class ko{constructor(r,o){this.type=In,this.geojson=r,this.geometries=o}static parse(r,o){if(r.length!==2)return o.error(`'within' expression requires exactly one argument, but found ${r.length-1} instead.`);if(pa(r[1])){const p=r[1];if(p.type==="FeatureCollection"){const v=[];for(const E of p.features){const{type:A,coordinates:P}=E.geometry;A==="Polygon"&&v.push(P),A==="MultiPolygon"&&v.push(...P)}if(v.length)return new ko(p,{type:"MultiPolygon",coordinates:v})}else if(p.type==="Feature"){const v=p.geometry.type;if(v==="Polygon"||v==="MultiPolygon")return new ko(p,p.geometry)}else if(p.type==="Polygon"||p.type==="MultiPolygon")return new ko(p,p)}return o.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(r){if(r.geometry()!=null&&r.canonicalID()!=null){if(r.geometryType()==="Point")return(function(o,p){const v=[1/0,1/0,-1/0,-1/0],E=[1/0,1/0,-1/0,-1/0],A=o.canonicalID();if(p.type==="Polygon"){const P=ho(p.coordinates,E,A),z=Xu(o.geometry(),v,E,A);if(!Ha(v,E))return!1;for(const F of z)if(!Xs(F,P))return!1}if(p.type==="MultiPolygon"){const P=rd(p.coordinates,E,A),z=Xu(o.geometry(),v,E,A);if(!Ha(v,E))return!1;for(const F of z)if(!gu(F,P))return!1}return!0})(r,this.geometries);if(r.geometryType()==="LineString")return(function(o,p){const v=[1/0,1/0,-1/0,-1/0],E=[1/0,1/0,-1/0,-1/0],A=o.canonicalID();if(p.type==="Polygon"){const P=ho(p.coordinates,E,A),z=Yu(o.geometry(),v,E,A);if(!Ha(v,E))return!1;for(const F of z)if(!Ys(F,P))return!1}if(p.type==="MultiPolygon"){const P=rd(p.coordinates,E,A),z=Yu(o.geometry(),v,E,A);if(!Ha(v,E))return!1;for(const F of z)if(!Ku(F,P))return!1}return!0})(r,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let _u=class{constructor(l=[],r=(o,p)=>o<p?-1:o>p?1:0){if(this.data=l,this.length=this.data.length,this.compare=r,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(l){this.data.push(l),this._up(this.length++)}pop(){if(this.length===0)return;const l=this.data[0],r=this.data.pop();return--this.length>0&&(this.data[0]=r,this._down(0)),l}peek(){return this.data[0]}_up(l){const{data:r,compare:o}=this,p=r[l];for(;l>0;){const v=l-1>>1,E=r[v];if(o(p,E)>=0)break;r[l]=E,l=v}r[l]=p}_down(l){const{data:r,compare:o}=this,p=this.length>>1,v=r[l];for(;l<p;){let E=1+(l<<1);const A=E+1;if(A<this.length&&o(r[A],r[E])<0&&(E=A),o(r[E],v)>=0)break;r[l]=r[E],l=E}r[l]=v}};function yh(l,r,o=0,p=l.length-1,v=Qu){for(;p>o;){if(p-o>600){const z=p-o+1,F=r-o+1,$=Math.log(z),W=.5*Math.exp(2*$/3),te=.5*Math.sqrt($*W*(z-W)/z)*(F-z/2<0?-1:1);yh(l,r,Math.max(o,Math.floor(r-F*W/z+te)),Math.min(p,Math.floor(r+(z-F)*W/z+te)),v)}const E=l[r];let A=o,P=p;for(Es(l,o,r),v(l[p],E)>0&&Es(l,o,p);A<P;){for(Es(l,A,P),A++,P--;v(l[A],E)<0;)A++;for(;v(l[P],E)>0;)P--}v(l[o],E)===0?Es(l,o,P):(P++,Es(l,P,p)),P<=r&&(o=P+1),r<=P&&(p=P-1)}}function Es(l,r,o){const p=l[r];l[r]=l[o],l[o]=p}function Qu(l,r){return l<r?-1:l>r?1:0}function Ju(l,r){if(l.length<=1)return[l];const o=[];let p,v;for(const E of l){const A=ef(E);A!==0&&(E.area=Math.abs(A),v===void 0&&(v=A<0),v===A<0?(p&&o.push(p),p=[E]):p.push(E))}if(p&&o.push(p),r>1)for(let E=0;E<o.length;E++)o[E].length<=r||(yh(o[E],r,1,o[E].length-1,Fc),o[E]=o[E].slice(0,r));return o}function Fc(l,r){return r.area-l.area}function ef(l){let r=0;for(let o,p,v=0,E=l.length,A=E-1;v<E;A=v++)o=l[v],p=l[A],r+=(p.x-o.x)*(o.y+p.y);return r}const ul=1/298.257223563,tf=ul*(2-ul),Kl=Math.PI/180;class ad{constructor(r){const o=6378.137*Kl*1e3,p=Math.cos(r*Kl),v=1/(1-tf*(1-p*p)),E=Math.sqrt(v);this.kx=o*E*p,this.ky=o*E*v*(1-tf)}distance(r,o){const p=this.wrap(r[0]-o[0])*this.kx,v=(r[1]-o[1])*this.ky;return Math.sqrt(p*p+v*v)}pointOnLine(r,o){let p,v,E,A,P=1/0;for(let z=0;z<r.length-1;z++){let F=r[z][0],$=r[z][1],W=this.wrap(r[z+1][0]-F)*this.kx,te=(r[z+1][1]-$)*this.ky,ie=0;W===0&&te===0||(ie=(this.wrap(o[0]-F)*this.kx*W+(o[1]-$)*this.ky*te)/(W*W+te*te),ie>1?(F=r[z+1][0],$=r[z+1][1]):ie>0&&(F+=W/this.kx*ie,$+=te/this.ky*ie)),W=this.wrap(o[0]-F)*this.kx,te=(o[1]-$)*this.ky;const re=W*W+te*te;re<P&&(P=re,p=F,v=$,E=z,A=ie)}return{point:[p,v],index:E,t:Math.max(0,Math.min(1,A))}}wrap(r){for(;r<-180;)r+=360;for(;r>180;)r-=360;return r}}function cl(l,r){return r[0]-l[0]}function aa(l){return l[1]-l[0]+1}function As(l,r){return l[1]>=l[0]&&l[1]<r}function li(l,r){if(l[0]>l[1])return[null,null];const o=aa(l);if(r){if(o===2)return[l,null];const v=Math.floor(o/2);return[[l[0],l[0]+v],[l[0]+v,l[1]]]}if(o===1)return[l,null];const p=Math.floor(o/2)-1;return[[l[0],l[0]+p],[l[0]+p+1,l[1]]]}function yu(l,r){if(!As(r,l.length))return[1/0,1/0,-1/0,-1/0];const o=[1/0,1/0,-1/0,-1/0];for(let p=r[0];p<=r[1];++p)Ga(o,l[p]);return o}function ec(l){const r=[1/0,1/0,-1/0,-1/0];for(const o of l)for(const p of o)Ga(r,p);return r}function tc(l){return l[0]!==-1/0&&l[1]!==-1/0&&l[2]!==1/0&&l[3]!==1/0}function hl(l,r,o){if(!tc(l)||!tc(r))return NaN;let p=0,v=0;return l[2]<r[0]&&(p=r[0]-l[2]),l[0]>r[2]&&(p=l[0]-r[2]),l[1]>r[3]&&(v=l[1]-r[3]),l[3]<r[1]&&(v=r[1]-l[3]),o.distance([0,0],[p,v])}function dl(l,r,o){const p=o.pointOnLine(r,l);return o.distance(l,p.point)}function fl(l,r,o,p,v){const E=Math.min(dl(l,[o,p],v),dl(r,[o,p],v)),A=Math.min(dl(o,[l,r],v),dl(p,[l,r],v));return Math.min(E,A)}function vh(l,r,o,p,v){if(!As(r,l.length)||!As(p,o.length))return 1/0;let E=1/0;for(let A=r[0];A<r[1];++A){const P=l[A],z=l[A+1];for(let F=p[0];F<p[1];++F){const $=o[F],W=o[F+1];if(Ss(P,z,$,W))return 0;E=Math.min(E,fl(P,z,$,W,v))}}return E}function Vc(l,r,o,p,v){if(!As(r,l.length)||!As(p,o.length))return NaN;let E=1/0;for(let A=r[0];A<=r[1];++A)for(let P=p[0];P<=p[1];++P)if(E=Math.min(E,v.distance(l[A],o[P])),E===0)return E;return E}function nc(l,r,o){if(Xs(l,r,!0))return 0;let p=1/0;for(const v of r){const E=v[0],A=v[v.length-1];if(E!==A&&(p=Math.min(p,dl(l,[A,E],o)),p===0))return p;const P=o.pointOnLine(v,l);if(p=Math.min(p,o.distance(l,P.point)),p===0)return p}return p}function nf(l,r,o,p){if(!As(r,l.length))return NaN;for(let E=r[0];E<=r[1];++E)if(Xs(l[E],o,!0))return 0;let v=1/0;for(let E=r[0];E<r[1];++E){const A=l[E],P=l[E+1];for(const z of o)for(let F=0,$=z.length,W=$-1;F<$;W=F++){const te=z[W],ie=z[F];if(Ss(A,P,te,ie))return 0;v=Math.min(v,fl(A,P,te,ie,p))}}return v}function Fl(l,r){for(const o of l)for(const p of o)if(Xs(p,r,!0))return!0;return!1}function ic(l,r,o,p=1/0){const v=ec(l),E=ec(r);if(p!==1/0&&hl(v,E,o)>=p)return p;if(Ha(v,E)){if(Fl(l,r))return 0}else if(Fl(r,l))return 0;let A=1/0;for(const P of l)for(let z=0,F=P.length,$=F-1;z<F;$=z++){const W=P[$],te=P[z];for(const ie of r)for(let re=0,oe=ie.length,pe=oe-1;re<oe;pe=re++){const Te=ie[pe],Ke=ie[re];if(Ss(W,te,Te,Ke))return 0;A=Math.min(A,fl(W,te,Te,Ke,o))}}return A}function Uc(l,r,o,p,v,E){if(!E)return;const A=hl(yu(p,E),v,o);A<r&&l.push([A,E,[0,0]])}function jc(l,r,o,p,v,E,A){if(!E||!A)return;const P=hl(yu(p,E),yu(v,A),o);P<r&&l.push([P,E,A])}function sa(l,r,o,p,v=1/0){let E=Math.min(p.distance(l[0],o[0][0]),v);if(E===0)return E;const A=new _u([[0,[0,l.length-1],[0,0]]],cl),P=ec(o);for(;A.length>0;){const z=A.pop();if(z[0]>=E)continue;const F=z[1],$=r?50:100;if(aa(F)<=$){if(!As(F,l.length))return NaN;if(r){const W=nf(l,F,o,p);if(isNaN(W)||W===0)return W;E=Math.min(E,W)}else for(let W=F[0];W<=F[1];++W){const te=nc(l[W],o,p);if(E=Math.min(E,te),E===0)return 0}}else{const W=li(F,r);Uc(A,E,p,l,P,W[0]),Uc(A,E,p,l,P,W[1])}}return E}function Xl(l,r,o,p,v,E=1/0){let A=Math.min(E,v.distance(l[0],o[0]));if(A===0)return A;const P=new _u([[0,[0,l.length-1],[0,o.length-1]]],cl);for(;P.length>0;){const z=P.pop();if(z[0]>=A)continue;const F=z[1],$=z[2],W=r?50:100,te=p?50:100;if(aa(F)<=W&&aa($)<=te){if(!As(F,l.length)&&As($,o.length))return NaN;let ie;if(r&&p)ie=vh(l,F,o,$,v),A=Math.min(A,ie);else if(r&&!p){const re=l.slice(F[0],F[1]+1);for(let oe=$[0];oe<=$[1];++oe)if(ie=dl(o[oe],re,v),A=Math.min(A,ie),A===0)return A}else if(!r&&p){const re=o.slice($[0],$[1]+1);for(let oe=F[0];oe<=F[1];++oe)if(ie=dl(l[oe],re,v),A=Math.min(A,ie),A===0)return A}else ie=Vc(l,F,o,$,v),A=Math.min(A,ie)}else{const ie=li(F,r),re=li($,p);jc(P,A,v,l,o,ie[0],re[0]),jc(P,A,v,l,o,ie[0],re[1]),jc(P,A,v,l,o,ie[1],re[0]),jc(P,A,v,l,o,ie[1],re[1])}}return A}function bh(l){return l.type==="MultiPolygon"?l.coordinates.map((r=>({type:"Polygon",coordinates:r}))):l.type==="MultiLineString"?l.coordinates.map((r=>({type:"LineString",coordinates:r}))):l.type==="MultiPoint"?l.coordinates.map((r=>({type:"Point",coordinates:r}))):[l]}class Lo{constructor(r,o){this.type=kt,this.geojson=r,this.geometries=o}static parse(r,o){if(r.length!==2)return o.error(`'distance' expression requires exactly one argument, but found ${r.length-1} instead.`);if(pa(r[1])){const p=r[1];if(p.type==="FeatureCollection")return new Lo(p,p.features.map((v=>bh(v.geometry))).flat());if(p.type==="Feature")return new Lo(p,bh(p.geometry));if("type"in p&&"coordinates"in p)return new Lo(p,bh(p))}return o.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(r){if(r.geometry()!=null&&r.canonicalID()!=null){if(r.geometryType()==="Point")return(function(o,p){const v=o.geometry(),E=v.flat().map((z=>Xi([z.x,z.y],o.canonical)));if(v.length===0)return NaN;const A=new ad(E[0][1]);let P=1/0;for(const z of p){switch(z.type){case"Point":P=Math.min(P,Xl(E,!1,[z.coordinates],!1,A,P));break;case"LineString":P=Math.min(P,Xl(E,!1,z.coordinates,!0,A,P));break;case"Polygon":P=Math.min(P,sa(E,!1,z.coordinates,A,P))}if(P===0)return P}return P})(r,this.geometries);if(r.geometryType()==="LineString")return(function(o,p){const v=o.geometry(),E=v.flat().map((z=>Xi([z.x,z.y],o.canonical)));if(v.length===0)return NaN;const A=new ad(E[0][1]);let P=1/0;for(const z of p){switch(z.type){case"Point":P=Math.min(P,Xl(E,!0,[z.coordinates],!1,A,P));break;case"LineString":P=Math.min(P,Xl(E,!0,z.coordinates,!0,A,P));break;case"Polygon":P=Math.min(P,sa(E,!0,z.coordinates,A,P))}if(P===0)return P}return P})(r,this.geometries);if(r.geometryType()==="Polygon")return(function(o,p){const v=o.geometry();if(v.length===0||v[0].length===0)return NaN;const E=Ju(v,0).map((z=>z.map((F=>F.map(($=>Xi([$.x,$.y],o.canonical))))))),A=new ad(E[0][0][0][1]);let P=1/0;for(const z of p)for(const F of E){switch(z.type){case"Point":P=Math.min(P,sa([z.coordinates],!1,F,A,P));break;case"LineString":P=Math.min(P,sa(z.coordinates,!0,F,A,P));break;case"Polygon":P=Math.min(P,ic(F,z.coordinates,A,P))}if(P===0)return P}return P})(r,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class $c{constructor(r){this.type=Bn,this.key=r}static parse(r,o){if(r.length!==2)return o.error(`Expected 1 argument, but found ${r.length-1} instead.`);const p=r[1];return p==null?o.error("Global state property must be defined."):typeof p!="string"?o.error(`Global state property must be string, but found ${typeof r[1]} instead.`):new $c(p)}evaluate(r){var o;const p=(o=r.globals)===null||o===void 0?void 0:o.globalState;return p&&Object.keys(p).length!==0?Ja(p,this.key):null}eachChild(){}outputDefined(){return!1}}const vu={"==":Wu,"!=":pu,">":M,"<":Bl,">=":ne,"<=":H,array:zr,at:ra,boolean:zr,case:ws,coalesce:Nl,collator:ye,format:ht,image:Kt,in:Ma,"index-of":Ra,interpolate:lr,"interpolate-hcl":lr,"interpolate-lab":lr,length:Ln,let:Wn,literal:ia,match:Or,number:zr,"number-format":at,object:zr,slice:Zl,step:Ki,string:zr,"to-boolean":or,"to-color":or,"to-number":or,"to-string":or,var:Mo,within:ko,distance:Lo,"global-state":$c};class fo{constructor(r,o,p,v){this.name=r,this.type=o,this._evaluate=p,this.args=v}evaluate(r){return this._evaluate(r,this.args)}eachChild(r){this.args.forEach(r)}outputDefined(){return!1}static parse(r,o){const p=r[0],v=fo.definitions[p];if(!v)return o.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0);const E=Array.isArray(v)?v[0]:v.type,A=Array.isArray(v)?[[v[1],v[2]]]:v.overloads,P=A.filter((([F])=>!Array.isArray(F)||F.length===r.length-1));let z=null;for(const[F,$]of P){z=new xs(o.registry,Yl,o.path,null,o.scope);const W=[];let te=!1;for(let ie=1;ie<r.length;ie++){const re=r[ie],oe=Array.isArray(F)?F[ie-1]:F.type,pe=z.parse(re,1+W.length,oe);if(!pe){te=!0;break}W.push(pe)}if(!te)if(Array.isArray(F)&&F.length!==W.length)z.error(`Expected ${F.length} arguments, but found ${W.length} instead.`);else{for(let ie=0;ie<W.length;ie++){const re=Array.isArray(F)?F[ie]:F.type,oe=W[ie];z.concat(ie+1).checkSubtype(re,oe.type)}if(z.errors.length===0)return new fo(p,E,$,W)}}if(P.length===1)o.errors.push(...z.errors);else{const F=(P.length?P:A).map((([W])=>{return te=W,Array.isArray(te)?`(${te.map(wi).join(", ")})`:`(${wi(te.type)}...)`;var te})).join(" | "),$=[];for(let W=1;W<r.length;W++){const te=o.parse(r[W],1+$.length);if(!te)return null;$.push(wi(te.type))}o.error(`Expected arguments of type ${F}, but found (${$.join(", ")}) instead.`)}return null}static register(r,o){fo.definitions=o;for(const p in o)r[p]=fo}}function bu(l,[r,o,p,v]){r=r.evaluate(l),o=o.evaluate(l),p=p.evaluate(l);const E=v?v.evaluate(l):1,A=bn(r,o,p,E);if(A)throw new xn(A);return new kn(r/255,o/255,p/255,E,!1)}function sd(l,r){return l in r}function pl(l,r){const o=r[l];return o===void 0?null:o}function ma(l){return{type:l}}function Yl(l){if(l instanceof Mo)return Yl(l.boundExpression);if(l instanceof fo&&l.name==="error"||l instanceof ye||l instanceof ko||l instanceof Lo||l instanceof $c)return!1;const r=l instanceof or||l instanceof zr;let o=!0;return l.eachChild((p=>{o=r?o&&Yl(p):o&&p instanceof ia})),!!o&&ns(l)&&xu(l,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function ns(l){if(l instanceof fo&&(l.name==="get"&&l.args.length===1||l.name==="feature-state"||l.name==="has"&&l.args.length===1||l.name==="properties"||l.name==="geometry-type"||l.name==="id"||/^filter-/.test(l.name))||l instanceof ko||l instanceof Lo)return!1;let r=!0;return l.eachChild((o=>{r&&!ns(o)&&(r=!1)})),r}function ga(l){if(l instanceof fo&&l.name==="feature-state")return!1;let r=!0;return l.eachChild((o=>{r&&!ga(o)&&(r=!1)})),r}function xu(l,r){if(l instanceof fo&&r.indexOf(l.name)>=0)return!1;let o=!0;return l.eachChild((p=>{o&&!xu(p,r)&&(o=!1)})),o}function rc(l){return{result:"success",value:l}}function Js(l){return{result:"error",value:l}}function ml(l){return l["property-type"]==="data-driven"||l["property-type"]==="cross-faded-data-driven"}function Do(l){return!!l.expression&&l.expression.parameters.indexOf("zoom")>-1}function Ql(l){return!!l.expression&&l.expression.interpolated}function qn(l){return l instanceof Number?"number":l instanceof String?"string":l instanceof Boolean?"boolean":Array.isArray(l)?"array":l===null?"null":typeof l}function zo(l){return typeof l=="object"&&l!==null&&!Array.isArray(l)&&fn(l)===Ao}function Jf(l){return l}function is(l,r){const o=l.stops&&typeof l.stops[0][0]=="object",p=o||!(o||l.property!==void 0),v=l.type||(Ql(r)?"exponential":"interval"),E=(function($){switch($.type){case"color":return kn.parse;case"padding":return mr.parse;case"numberArray":return hn.parse;case"colorArray":return pi.parse;default:return null}})(r);if(E&&((l=en({},l)).stops&&(l.stops=l.stops.map(($=>[$[0],E($[1])]))),l.default=E(l.default?l.default:r.default)),l.colorSpace&&(A=l.colorSpace)!=="rgb"&&A!=="hcl"&&A!=="lab")throw new Error(`Unknown color space: "${l.colorSpace}"`);var A;const P=(function($){switch($){case"exponential":return ac;case"interval":return od;case"categorical":return No;case"identity":return wu;default:throw new Error(`Unknown function type "${$}"`)}})(v);let z,F;if(v==="categorical"){z=Object.create(null);for(const $ of l.stops)z[$[0]]=$[1];F=typeof l.stops[0][0]}if(o){const $={},W=[];for(let re=0;re<l.stops.length;re++){const oe=l.stops[re],pe=oe[0].zoom;$[pe]===void 0&&($[pe]={zoom:pe,type:l.type,property:l.property,default:l.default,stops:[]},W.push(pe)),$[pe].stops.push([oe[0].value,oe[1]])}const te=[];for(const re of W)te.push([$[re].zoom,is($[re],r)]);const ie={name:"linear"};return{kind:"composite",interpolationType:ie,interpolationFactor:lr.interpolationFactor.bind(void 0,ie),zoomStops:te.map((re=>re[0])),evaluate:({zoom:re},oe)=>ac({stops:te,base:l.base},r,re).evaluate(re,oe)}}if(p){const $=v==="exponential"?{name:"exponential",base:l.base!==void 0?l.base:1}:null;return{kind:"camera",interpolationType:$,interpolationFactor:lr.interpolationFactor.bind(void 0,$),zoomStops:l.stops.map((W=>W[0])),evaluate:({zoom:W})=>P(l,r,W,z,F)}}return{kind:"source",evaluate($,W){const te=W&&W.properties?W.properties[l.property]:void 0;return te===void 0?Oo(l.default,r.default):P(l,r,te,z,F)}}}function Oo(l,r,o){return l!==void 0?l:r!==void 0?r:o!==void 0?o:void 0}function No(l,r,o,p,v){return Oo(typeof o===v?p[o]:void 0,l.default,r.default)}function od(l,r,o){if(qn(o)!=="number")return Oo(l.default,r.default);const p=l.stops.length;if(p===1||o<=l.stops[0][0])return l.stops[0][1];if(o>=l.stops[p-1][0])return l.stops[p-1][1];const v=Ro(l.stops.map((E=>E[0])),o);return l.stops[v][1]}function ac(l,r,o){const p=l.base!==void 0?l.base:1;if(qn(o)!=="number")return Oo(l.default,r.default);const v=l.stops.length;if(v===1||o<=l.stops[0][0])return l.stops[0][1];if(o>=l.stops[v-1][0])return l.stops[v-1][1];const E=Ro(l.stops.map(($=>$[0])),o),A=(function($,W,te,ie){const re=ie-te,oe=$-te;return re===0?0:W===1?oe/re:(Math.pow(W,oe)-1)/(Math.pow(W,re)-1)})(o,p,l.stops[E][0],l.stops[E+1][0]),P=l.stops[E][1],z=l.stops[E+1][1],F=Ts[r.type]||Jf;return typeof P.evaluate=="function"?{evaluate(...$){const W=P.evaluate.apply(void 0,$),te=z.evaluate.apply(void 0,$);if(W!==void 0&&te!==void 0)return F(W,te,A,l.colorSpace)}}:F(P,z,A,l.colorSpace)}function wu(l,r,o){switch(r.type){case"color":o=kn.parse(o);break;case"formatted":o=Wi.fromString(o.toString());break;case"resolvedImage":o=cr.fromString(o.toString());break;case"padding":o=mr.parse(o);break;case"colorArray":o=pi.parse(o);break;case"numberArray":o=hn.parse(o);break;default:qn(o)===r.type||r.type==="enum"&&r.values[o]||(o=void 0)}return Oo(o,l.default,r.default)}fo.register(vu,{error:[{kind:"error"},[yn],(l,[r])=>{throw new xn(r.evaluate(l))}],typeof:[yn,[Bn],(l,[r])=>wi(fn(r.evaluate(l)))],"to-rgba":[fa(kt,4),[ir],(l,[r])=>{const[o,p,v,E]=r.evaluate(l).rgb;return[255*o,255*p,255*v,E]}],rgb:[ir,[kt,kt,kt],bu],rgba:[ir,[kt,kt,kt,kt],bu],has:{type:In,overloads:[[[yn],(l,[r])=>sd(r.evaluate(l),l.properties())],[[yn,Ao],(l,[r,o])=>sd(r.evaluate(l),o.evaluate(l))]]},get:{type:Bn,overloads:[[[yn],(l,[r])=>pl(r.evaluate(l),l.properties())],[[yn,Ao],(l,[r,o])=>pl(r.evaluate(l),o.evaluate(l))]]},"feature-state":[Bn,[yn],(l,[r])=>pl(r.evaluate(l),l.featureState||{})],properties:[Ao,[],l=>l.properties()],"geometry-type":[yn,[],l=>l.geometryType()],id:[Bn,[],l=>l.id()],zoom:[kt,[],l=>l.globals.zoom],"heatmap-density":[kt,[],l=>l.globals.heatmapDensity||0],elevation:[kt,[],l=>l.globals.elevation||0],"line-progress":[kt,[],l=>l.globals.lineProgress||0],accumulated:[Bn,[],l=>l.globals.accumulated===void 0?null:l.globals.accumulated],"+":[kt,ma(kt),(l,r)=>{let o=0;for(const p of r)o+=p.evaluate(l);return o}],"*":[kt,ma(kt),(l,r)=>{let o=1;for(const p of r)o*=p.evaluate(l);return o}],"-":{type:kt,overloads:[[[kt,kt],(l,[r,o])=>r.evaluate(l)-o.evaluate(l)],[[kt],(l,[r])=>-r.evaluate(l)]]},"/":[kt,[kt,kt],(l,[r,o])=>r.evaluate(l)/o.evaluate(l)],"%":[kt,[kt,kt],(l,[r,o])=>r.evaluate(l)%o.evaluate(l)],ln2:[kt,[],()=>Math.LN2],pi:[kt,[],()=>Math.PI],e:[kt,[],()=>Math.E],"^":[kt,[kt,kt],(l,[r,o])=>Math.pow(r.evaluate(l),o.evaluate(l))],sqrt:[kt,[kt],(l,[r])=>Math.sqrt(r.evaluate(l))],log10:[kt,[kt],(l,[r])=>Math.log(r.evaluate(l))/Math.LN10],ln:[kt,[kt],(l,[r])=>Math.log(r.evaluate(l))],log2:[kt,[kt],(l,[r])=>Math.log(r.evaluate(l))/Math.LN2],sin:[kt,[kt],(l,[r])=>Math.sin(r.evaluate(l))],cos:[kt,[kt],(l,[r])=>Math.cos(r.evaluate(l))],tan:[kt,[kt],(l,[r])=>Math.tan(r.evaluate(l))],asin:[kt,[kt],(l,[r])=>Math.asin(r.evaluate(l))],acos:[kt,[kt],(l,[r])=>Math.acos(r.evaluate(l))],atan:[kt,[kt],(l,[r])=>Math.atan(r.evaluate(l))],min:[kt,ma(kt),(l,r)=>Math.min(...r.map((o=>o.evaluate(l))))],max:[kt,ma(kt),(l,r)=>Math.max(...r.map((o=>o.evaluate(l))))],abs:[kt,[kt],(l,[r])=>Math.abs(r.evaluate(l))],round:[kt,[kt],(l,[r])=>{const o=r.evaluate(l);return o<0?-Math.round(-o):Math.round(o)}],floor:[kt,[kt],(l,[r])=>Math.floor(r.evaluate(l))],ceil:[kt,[kt],(l,[r])=>Math.ceil(r.evaluate(l))],"filter-==":[In,[yn,Bn],(l,[r,o])=>l.properties()[r.value]===o.value],"filter-id-==":[In,[Bn],(l,[r])=>l.id()===r.value],"filter-type-==":[In,[yn],(l,[r])=>l.geometryType()===r.value],"filter-<":[In,[yn,Bn],(l,[r,o])=>{const p=l.properties()[r.value],v=o.value;return typeof p==typeof v&&p<v}],"filter-id-<":[In,[Bn],(l,[r])=>{const o=l.id(),p=r.value;return typeof o==typeof p&&o<p}],"filter->":[In,[yn,Bn],(l,[r,o])=>{const p=l.properties()[r.value],v=o.value;return typeof p==typeof v&&p>v}],"filter-id->":[In,[Bn],(l,[r])=>{const o=l.id(),p=r.value;return typeof o==typeof p&&o>p}],"filter-<=":[In,[yn,Bn],(l,[r,o])=>{const p=l.properties()[r.value],v=o.value;return typeof p==typeof v&&p<=v}],"filter-id-<=":[In,[Bn],(l,[r])=>{const o=l.id(),p=r.value;return typeof o==typeof p&&o<=p}],"filter->=":[In,[yn,Bn],(l,[r,o])=>{const p=l.properties()[r.value],v=o.value;return typeof p==typeof v&&p>=v}],"filter-id->=":[In,[Bn],(l,[r])=>{const o=l.id(),p=r.value;return typeof o==typeof p&&o>=p}],"filter-has":[In,[Bn],(l,[r])=>r.value in l.properties()],"filter-has-id":[In,[],l=>l.id()!==null&&l.id()!==void 0],"filter-type-in":[In,[fa(yn)],(l,[r])=>r.value.indexOf(l.geometryType())>=0],"filter-id-in":[In,[fa(Bn)],(l,[r])=>r.value.indexOf(l.id())>=0],"filter-in-small":[In,[yn,fa(Bn)],(l,[r,o])=>o.value.indexOf(l.properties()[r.value])>=0],"filter-in-large":[In,[yn,fa(Bn)],(l,[r,o])=>(function(p,v,E,A){for(;E<=A;){const P=E+A>>1;if(v[P]===p)return!0;v[P]>p?A=P-1:E=P+1}return!1})(l.properties()[r.value],o.value,0,o.value.length-1)],all:{type:In,overloads:[[[In,In],(l,[r,o])=>r.evaluate(l)&&o.evaluate(l)],[ma(In),(l,r)=>{for(const o of r)if(!o.evaluate(l))return!1;return!0}]]},any:{type:In,overloads:[[[In,In],(l,[r,o])=>r.evaluate(l)||o.evaluate(l)],[ma(In),(l,r)=>{for(const o of r)if(o.evaluate(l))return!0;return!1}]]},"!":[In,[In],(l,[r])=>!r.evaluate(l)],"is-supported-script":[In,[yn],(l,[r])=>{const o=l.globals&&l.globals.isSupportedScript;return!o||o(r.evaluate(l))}],upcase:[yn,[yn],(l,[r])=>r.evaluate(l).toUpperCase()],downcase:[yn,[yn],(l,[r])=>r.evaluate(l).toLowerCase()],concat:[yn,ma(Bn),(l,r)=>r.map((o=>sn(o.evaluate(l)))).join("")],"resolved-locale":[yn,[Us],(l,[r])=>r.evaluate(l).resolvedLocale()]});class sc{constructor(r,o){this.expression=r,this._warningHistory={},this._evaluator=new uo,this._defaultValue=o?(function(p){if(p.type==="color"&&zo(p.default))return new kn(0,0,0,0);switch(p.type){case"color":return kn.parse(p.default)||null;case"padding":return mr.parse(p.default)||null;case"numberArray":return hn.parse(p.default)||null;case"colorArray":return pi.parse(p.default)||null;case"variableAnchorOffsetCollection":return sr.parse(p.default)||null;case"projectionDefinition":return wr.parse(p.default)||null;default:return p.default===void 0?null:p.default}})(o):null,this._enumValues=o&&o.type==="enum"?o.values:null}evaluateWithoutErrorHandling(r,o,p,v,E,A){return this._evaluator.globals=r,this._evaluator.feature=o,this._evaluator.featureState=p,this._evaluator.canonical=v,this._evaluator.availableImages=E||null,this._evaluator.formattedSection=A,this.expression.evaluate(this._evaluator)}evaluate(r,o,p,v,E,A){this._evaluator.globals=r,this._evaluator.feature=o||null,this._evaluator.featureState=p||null,this._evaluator.canonical=v,this._evaluator.availableImages=E||null,this._evaluator.formattedSection=A||null;try{const P=this.expression.evaluate(this._evaluator);if(P==null||typeof P=="number"&&P!=P)return this._defaultValue;if(this._enumValues&&!(P in this._enumValues))throw new xn(`Expected value to be one of ${Object.keys(this._enumValues).map((z=>JSON.stringify(z))).join(", ")}, but found ${JSON.stringify(P)} instead.`);return P}catch(P){return this._warningHistory[P.message]||(this._warningHistory[P.message]=!0,typeof console<"u"&&console.warn(P.message)),this._defaultValue}}}function oc(l){return Array.isArray(l)&&l.length>0&&typeof l[0]=="string"&&l[0]in vu}function Tu(l,r){const o=new xs(vu,Yl,[],r?(function(v){const E={color:ir,string:yn,number:kt,enum:yn,boolean:In,formatted:js,padding:_s,numberArray:Hr,colorArray:Gr,projectionDefinition:rl,resolvedImage:Ei,variableAnchorOffsetCollection:Pr};return v.type==="array"?fa(E[v.value]||Bn,v.length):E[v.type]})(r):void 0),p=o.parse(l,void 0,void 0,void 0,r&&r.type==="string"?{typeAnnotation:"coerce"}:void 0);return p?rc(new sc(p,r)):Js(o.errors)}class f{constructor(r,o){this.kind=r,this._styleExpression=o,this.isStateDependent=r!=="constant"&&!ga(o.expression),this.globalStateRefs=ue(o.expression)}evaluateWithoutErrorHandling(r,o,p,v,E,A){return this._styleExpression.evaluateWithoutErrorHandling(r,o,p,v,E,A)}evaluate(r,o,p,v,E,A){return this._styleExpression.evaluate(r,o,p,v,E,A)}}class x{constructor(r,o,p,v){this.kind=r,this.zoomStops=p,this._styleExpression=o,this.isStateDependent=r!=="camera"&&!ga(o.expression),this.globalStateRefs=ue(o.expression),this.interpolationType=v}evaluateWithoutErrorHandling(r,o,p,v,E,A){return this._styleExpression.evaluateWithoutErrorHandling(r,o,p,v,E,A)}evaluate(r,o,p,v,E,A){return this._styleExpression.evaluate(r,o,p,v,E,A)}interpolationFactor(r,o,p){return this.interpolationType?lr.interpolationFactor(this.interpolationType,r,o,p):0}}function k(l,r){const o=Tu(l,r);if(o.result==="error")return o;const p=o.value.expression,v=ns(p);if(!v&&!ml(r))return Js([new nr("","data expressions not supported")]);const E=xu(p,["zoom"]);if(!E&&!Do(r))return Js([new nr("","zoom expressions not supported")]);const A=X(p);return A||E?A instanceof nr?Js([A]):A instanceof lr&&!Ql(r)?Js([new nr("",'"interpolate" expressions cannot be used with this property')]):rc(A?new x(v?"camera":"composite",o.value,A.labels,A instanceof lr?A.interpolation:void 0):new f(v?"constant":"source",o.value)):Js([new nr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class U{constructor(r,o){this._parameters=r,this._specification=o,en(this,is(this._parameters,this._specification))}static deserialize(r){return new U(r._parameters,r._specification)}static serialize(r){return{_parameters:r._parameters,_specification:r._specification}}}function X(l){let r=null;if(l instanceof Wn)r=X(l.result);else if(l instanceof Nl){for(const o of l.args)if(r=X(o),r)break}else(l instanceof Ki||l instanceof lr)&&l.input instanceof fo&&l.input.name==="zoom"&&(r=l);return r instanceof nr||l.eachChild((o=>{const p=X(o);p instanceof nr?r=p:!r&&p?r=new nr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):r&&p&&r!==p&&(r=new nr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),r}function ue(l,r=new Set){return l instanceof $c&&r.add(l.key),l.eachChild((o=>{ue(o,r)})),r}function Ne(l){if(l===!0||l===!1)return!0;if(!Array.isArray(l)||l.length===0)return!1;switch(l[0]){case"has":return l.length>=2&&l[1]!=="$id"&&l[1]!=="$type";case"in":return l.length>=3&&(typeof l[1]!="string"||Array.isArray(l[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return l.length!==3||Array.isArray(l[1])||Array.isArray(l[2]);case"any":case"all":for(const r of l.slice(1))if(!Ne(r)&&typeof r!="boolean")return!1;return!0;default:return!0}}const nt={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function ut(l){if(l==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};Ne(l)||(l=pn(l));const r=Tu(l,nt);if(r.result==="error")throw new Error(r.value.map((o=>`${o.key}: ${o.message}`)).join(", "));return{filter:(o,p,v)=>r.value.evaluate(o,p,{},v),needGeometry:Xt(l),getGlobalStateRefs:()=>ue(r.value.expression)}}function It(l,r){return l<r?-1:l>r?1:0}function Xt(l){if(!Array.isArray(l))return!1;if(l[0]==="within"||l[0]==="distance")return!0;for(let r=1;r<l.length;r++)if(Xt(l[r]))return!0;return!1}function pn(l){if(!l)return!0;const r=l[0];return l.length<=1?r!=="any":r==="=="?Yn(l[1],l[2],"=="):r==="!="?Za(Yn(l[1],l[2],"==")):r==="<"||r===">"||r==="<="||r===">="?Yn(l[1],l[2],r):r==="any"?(o=l.slice(1),["any"].concat(o.map(pn))):r==="all"?["all"].concat(l.slice(1).map(pn)):r==="none"?["all"].concat(l.slice(1).map(pn).map(Za)):r==="in"?_a(l[1],l.slice(2)):r==="!in"?Za(_a(l[1],l.slice(2))):r==="has"?Zr(l[1]):r!=="!has"||Za(Zr(l[1]));var o}function Yn(l,r,o){switch(l){case"$type":return[`filter-type-${o}`,r];case"$id":return[`filter-id-${o}`,r];default:return[`filter-${o}`,l,r]}}function _a(l,r){if(r.length===0)return!1;switch(l){case"$type":return["filter-type-in",["literal",r]];case"$id":return["filter-id-in",["literal",r]];default:return r.length>200&&!r.some((o=>typeof o!=typeof r[0]))?["filter-in-large",l,["literal",r.sort(It)]]:["filter-in-small",l,["literal",r]]}}function Zr(l){switch(l){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",l]}}function Za(l){return["!",l]}function Si(l){const r=typeof l;if(r==="number"||r==="boolean"||r==="string"||l==null)return JSON.stringify(l);if(Array.isArray(l)){let v="[";for(const E of l)v+=`${Si(E)},`;return`${v}]`}const o=Object.keys(l).sort();let p="{";for(let v=0;v<o.length;v++)p+=`${JSON.stringify(o[v])}:${Si(l[o[v]])},`;return`${p}}`}function ki(l){let r="";for(const o of vn)r+=`/${Si(l[o])}`;return r}function ui(l){const r=l.value;return r?[new Mt(l.key,r,"constants have been deprecated as of v8")]:[]}function Li(l){return l instanceof Number||l instanceof String||l instanceof Boolean?l.valueOf():l}function Wr(l){if(Array.isArray(l))return l.map(Wr);if(l instanceof Object&&!(l instanceof Number||l instanceof String||l instanceof Boolean)){const r={};for(const o in l)r[o]=Wr(l[o]);return r}return Li(l)}function rs(l){const r=l.key,o=l.value,p=l.valueSpec||{},v=l.objectElementValidators||{},E=l.style,A=l.styleSpec,P=l.validateSpec;let z=[];const F=qn(o);if(F!=="object")return[new Mt(r,o,`object expected, ${F} found`)];for(const $ in o){const W=$.split(".")[0],te=Ja(p,W)||p["*"];let ie;if(Ja(v,W))ie=v[W];else if(Ja(p,W))ie=P;else if(v["*"])ie=v["*"];else{if(!p["*"]){z.push(new Mt(r,o[$],`unknown property "${$}"`));continue}ie=P}z=z.concat(ie({key:(r&&`${r}.`)+$,value:o[$],valueSpec:te,style:E,styleSpec:A,object:o,objectKey:$,validateSpec:P},o))}for(const $ in p)v[$]||p[$].required&&p[$].default===void 0&&o[$]===void 0&&z.push(new Mt(r,o,`missing required property "${$}"`));return z}function Bo(l){const r=l.value,o=l.valueSpec,p=l.style,v=l.styleSpec,E=l.key,A=l.arrayElementValidator||l.validateSpec;if(qn(r)!=="array")return[new Mt(E,r,`array expected, ${qn(r)} found`)];if(o.length&&r.length!==o.length)return[new Mt(E,r,`array length ${o.length} expected, length ${r.length} found`)];if(o["min-length"]&&r.length<o["min-length"])return[new Mt(E,r,`array length at least ${o["min-length"]} expected, length ${r.length} found`)];let P={type:o.value,values:o.values};v.$version<7&&(P.function=o.function),qn(o.value)==="object"&&(P=o.value);let z=[];for(let F=0;F<r.length;F++)z=z.concat(A({array:r,arrayIndex:F,value:r[F],valueSpec:P,validateSpec:l.validateSpec,style:p,styleSpec:v,key:`${E}[${F}]`}));return z}function Su(l){const r=l.key,o=l.value,p=l.valueSpec;let v=qn(o);return v==="number"&&o!=o&&(v="NaN"),v!=="number"?[new Mt(r,o,`number expected, ${v} found`)]:"minimum"in p&&o<p.minimum?[new Mt(r,o,`${o} is less than the minimum value ${p.minimum}`)]:"maximum"in p&&o>p.maximum?[new Mt(r,o,`${o} is greater than the maximum value ${p.maximum}`)]:[]}function Nr(l){const r=l.valueSpec,o=Li(l.value.type);let p,v,E,A={};const P=o!=="categorical"&&l.value.property===void 0,z=!P,F=qn(l.value.stops)==="array"&&qn(l.value.stops[0])==="array"&&qn(l.value.stops[0][0])==="object",$=rs({key:l.key,value:l.value,valueSpec:l.styleSpec.function,validateSpec:l.validateSpec,style:l.style,styleSpec:l.styleSpec,objectElementValidators:{stops:function(ie){if(o==="identity")return[new Mt(ie.key,ie.value,'identity function may not have a "stops" property')];let re=[];const oe=ie.value;return re=re.concat(Bo({key:ie.key,value:oe,valueSpec:ie.valueSpec,validateSpec:ie.validateSpec,style:ie.style,styleSpec:ie.styleSpec,arrayElementValidator:W})),qn(oe)==="array"&&oe.length===0&&re.push(new Mt(ie.key,oe,"array must have at least one stop")),re},default:function(ie){return ie.validateSpec({key:ie.key,value:ie.value,valueSpec:r,validateSpec:ie.validateSpec,style:ie.style,styleSpec:ie.styleSpec})}}});return o==="identity"&&P&&$.push(new Mt(l.key,l.value,'missing required property "property"')),o==="identity"||l.value.stops||$.push(new Mt(l.key,l.value,'missing required property "stops"')),o==="exponential"&&l.valueSpec.expression&&!Ql(l.valueSpec)&&$.push(new Mt(l.key,l.value,"exponential functions not supported")),l.styleSpec.$version>=8&&(z&&!ml(l.valueSpec)?$.push(new Mt(l.key,l.value,"property functions not supported")):P&&!Do(l.valueSpec)&&$.push(new Mt(l.key,l.value,"zoom functions not supported"))),o!=="categorical"&&!F||l.value.property!==void 0||$.push(new Mt(l.key,l.value,'"property" property is required')),$;function W(ie){let re=[];const oe=ie.value,pe=ie.key;if(qn(oe)!=="array")return[new Mt(pe,oe,`array expected, ${qn(oe)} found`)];if(oe.length!==2)return[new Mt(pe,oe,`array length 2 expected, length ${oe.length} found`)];if(F){if(qn(oe[0])!=="object")return[new Mt(pe,oe,`object expected, ${qn(oe[0])} found`)];if(oe[0].zoom===void 0)return[new Mt(pe,oe,"object stop key must have zoom")];if(oe[0].value===void 0)return[new Mt(pe,oe,"object stop key must have value")];if(E&&E>Li(oe[0].zoom))return[new Mt(pe,oe[0].zoom,"stop zoom values must appear in ascending order")];Li(oe[0].zoom)!==E&&(E=Li(oe[0].zoom),v=void 0,A={}),re=re.concat(rs({key:`${pe}[0]`,value:oe[0],valueSpec:{zoom:{}},validateSpec:ie.validateSpec,style:ie.style,styleSpec:ie.styleSpec,objectElementValidators:{zoom:Su,value:te}}))}else re=re.concat(te({key:`${pe}[0]`,value:oe[0],validateSpec:ie.validateSpec,style:ie.style,styleSpec:ie.styleSpec},oe));return oc(Wr(oe[1]))?re.concat([new Mt(`${pe}[1]`,oe[1],"expressions are not allowed in function stops.")]):re.concat(ie.validateSpec({key:`${pe}[1]`,value:oe[1],valueSpec:r,validateSpec:ie.validateSpec,style:ie.style,styleSpec:ie.styleSpec}))}function te(ie,re){const oe=qn(ie.value),pe=Li(ie.value),Te=ie.value!==null?ie.value:re;if(p){if(oe!==p)return[new Mt(ie.key,Te,`${oe} stop domain type must match previous stop domain type ${p}`)]}else p=oe;if(oe!=="number"&&oe!=="string"&&oe!=="boolean")return[new Mt(ie.key,Te,"stop domain value must be a number, string, or boolean")];if(oe!=="number"&&o!=="categorical"){let Ke=`number expected, ${oe} found`;return ml(r)&&o===void 0&&(Ke+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Mt(ie.key,Te,Ke)]}return o!=="categorical"||oe!=="number"||isFinite(pe)&&Math.floor(pe)===pe?o!=="categorical"&&oe==="number"&&v!==void 0&&pe<v?[new Mt(ie.key,Te,"stop domain values must appear in ascending order")]:(v=pe,o==="categorical"&&pe in A?[new Mt(ie.key,Te,"stop domain values must be unique")]:(A[pe]=!0,[])):[new Mt(ie.key,Te,`integer expected, found ${pe}`)]}}function as(l){const r=(l.expressionContext==="property"?k:Tu)(Wr(l.value),l.valueSpec);if(r.result==="error")return r.value.map((p=>new Mt(`${l.key}${p.key}`,l.value,p.message)));const o=r.value.expression||r.value._styleExpression.expression;if(l.expressionContext==="property"&&l.propertyKey==="text-font"&&!o.outputDefined())return[new Mt(l.key,l.value,`Invalid data expression for "${l.propertyKey}". Output values must be contained as literals within the expression.`)];if(l.expressionContext==="property"&&l.propertyType==="layout"&&!ga(o))return[new Mt(l.key,l.value,'"feature-state" data expressions are not supported with layout properties.')];if(l.expressionContext==="filter"&&!ga(o))return[new Mt(l.key,l.value,'"feature-state" data expressions are not supported with filters.')];if(l.expressionContext&&l.expressionContext.indexOf("cluster")===0){if(!xu(o,["zoom","feature-state"]))return[new Mt(l.key,l.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(l.expressionContext==="cluster-initial"&&!ns(o))return[new Mt(l.key,l.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function gl(l){const r=l.key,o=l.value,p=qn(o);return p!=="string"?[new Mt(r,o,`color expected, ${p} found`)]:kn.parse(String(o))?[]:[new Mt(r,o,`color expected, "${o}" found`)]}function Fo(l){const r=l.key,o=l.value,p=l.valueSpec,v=[];return Array.isArray(p.values)?p.values.indexOf(Li(o))===-1&&v.push(new Mt(r,o,`expected one of [${p.values.join(", ")}], ${JSON.stringify(o)} found`)):Object.keys(p.values).indexOf(Li(o))===-1&&v.push(new Mt(r,o,`expected one of [${Object.keys(p.values).join(", ")}], ${JSON.stringify(o)} found`)),v}function Eu(l){return Ne(Wr(l.value))?as(en({},l,{expressionContext:"filter",valueSpec:{value:"boolean"}})):lc(l)}function lc(l){const r=l.value,o=l.key;if(qn(r)!=="array")return[new Mt(o,r,`array expected, ${qn(r)} found`)];const p=l.styleSpec;let v,E=[];if(r.length<1)return[new Mt(o,r,"filter array must have at least 1 element")];switch(E=E.concat(Fo({key:`${o}[0]`,value:r[0],valueSpec:p.filter_operator,style:l.style,styleSpec:l.styleSpec})),Li(r[0])){case"<":case"<=":case">":case">=":r.length>=2&&Li(r[1])==="$type"&&E.push(new Mt(o,r,`"$type" cannot be use with operator "${r[0]}"`));case"==":case"!=":r.length!==3&&E.push(new Mt(o,r,`filter array for operator "${r[0]}" must have 3 elements`));case"in":case"!in":r.length>=2&&(v=qn(r[1]),v!=="string"&&E.push(new Mt(`${o}[1]`,r[1],`string expected, ${v} found`)));for(let A=2;A<r.length;A++)v=qn(r[A]),Li(r[1])==="$type"?E=E.concat(Fo({key:`${o}[${A}]`,value:r[A],valueSpec:p.geometry_type,style:l.style,styleSpec:l.styleSpec})):v!=="string"&&v!=="number"&&v!=="boolean"&&E.push(new Mt(`${o}[${A}]`,r[A],`string, number, or boolean expected, ${v} found`));break;case"any":case"all":case"none":for(let A=1;A<r.length;A++)E=E.concat(lc({key:`${o}[${A}]`,value:r[A],style:l.style,styleSpec:l.styleSpec}));break;case"has":case"!has":v=qn(r[1]),r.length!==2?E.push(new Mt(o,r,`filter array for "${r[0]}" operator must have 2 elements`)):v!=="string"&&E.push(new Mt(`${o}[1]`,r[1],`string expected, ${v} found`))}return E}function Vl(l,r){const o=l.key,p=l.validateSpec,v=l.style,E=l.styleSpec,A=l.value,P=l.objectKey,z=E[`${r}_${l.layerType}`];if(!z)return[];const F=P.match(/^(.*)-transition$/);if(r==="paint"&&F&&z[F[1]]&&z[F[1]].transition)return p({key:o,value:A,valueSpec:E.transition,style:v,styleSpec:E});const $=l.valueSpec||z[P];if(!$)return[new Mt(o,A,`unknown property "${P}"`)];let W;if(qn(A)==="string"&&ml($)&&!$.tokens&&(W=/^{([^}]+)}$/.exec(A)))return[new Mt(o,A,`"${P}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(W[1])} }\`.`)];const te=[];return l.layerType==="symbol"&&(P==="text-field"&&v&&!v.glyphs&&te.push(new Mt(o,A,'use of "text-field" requires a style "glyphs" property')),P==="text-font"&&zo(Wr(A))&&Li(A.type)==="identity"&&te.push(new Mt(o,A,'"text-font" does not support identity functions'))),te.concat(p({key:l.key,value:A,valueSpec:$,style:v,styleSpec:E,expressionContext:"property",propertyType:r,propertyKey:P}))}function _l(l){return Vl(l,"paint")}function Au(l){return Vl(l,"layout")}function Jl(l){let r=[];const o=l.value,p=l.key,v=l.style,E=l.styleSpec;if(qn(o)!=="object")return[new Mt(p,o,`object expected, ${qn(o)} found`)];o.type||o.ref||r.push(new Mt(p,o,'either "type" or "ref" is required'));let A=Li(o.type);const P=Li(o.ref);if(o.id){const z=Li(o.id);for(let F=0;F<l.arrayIndex;F++){const $=v.layers[F];Li($.id)===z&&r.push(new Mt(p,o.id,`duplicate layer id "${o.id}", previously used at line ${$.id.__line__}`))}}if("ref"in o){let z;["type","source","source-layer","filter","layout"].forEach((F=>{F in o&&r.push(new Mt(p,o[F],`"${F}" is prohibited for ref layers`))})),v.layers.forEach((F=>{Li(F.id)===P&&(z=F)})),z?z.ref?r.push(new Mt(p,o.ref,"ref cannot reference another ref layer")):A=Li(z.type):r.push(new Mt(p,o.ref,`ref layer "${P}" not found`))}else if(A!=="background")if(o.source){const z=v.sources&&v.sources[o.source],F=z&&Li(z.type);z?F==="vector"&&A==="raster"?r.push(new Mt(p,o.source,`layer "${o.id}" requires a raster source`)):F!=="raster-dem"&&A==="hillshade"||F!=="raster-dem"&&A==="color-relief"?r.push(new Mt(p,o.source,`layer "${o.id}" requires a raster-dem source`)):F==="raster"&&A!=="raster"?r.push(new Mt(p,o.source,`layer "${o.id}" requires a vector source`)):F!=="vector"||o["source-layer"]?F==="raster-dem"&&A!=="hillshade"&&A!=="color-relief"?r.push(new Mt(p,o.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):A!=="line"||!o.paint||!o.paint["line-gradient"]||F==="geojson"&&z.lineMetrics||r.push(new Mt(p,o,`layer "${o.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):r.push(new Mt(p,o,`layer "${o.id}" must specify a "source-layer"`)):r.push(new Mt(p,o.source,`source "${o.source}" not found`))}else r.push(new Mt(p,o,'missing required property "source"'));return r=r.concat(rs({key:p,value:o,valueSpec:E.layer,style:l.style,styleSpec:l.styleSpec,validateSpec:l.validateSpec,objectElementValidators:{"*":()=>[],type:()=>l.validateSpec({key:`${p}.type`,value:o.type,valueSpec:E.layer.type,style:l.style,styleSpec:l.styleSpec,validateSpec:l.validateSpec,object:o,objectKey:"type"}),filter:Eu,layout:z=>rs({layer:o,key:z.key,value:z.value,style:z.style,styleSpec:z.styleSpec,validateSpec:z.validateSpec,objectElementValidators:{"*":F=>Au(en({layerType:A},F))}}),paint:z=>rs({layer:o,key:z.key,value:z.value,style:z.style,styleSpec:z.styleSpec,validateSpec:z.validateSpec,objectElementValidators:{"*":F=>_l(en({layerType:A},F))}})}})),r}function Vo(l){const r=l.value,o=l.key,p=qn(r);return p!=="string"?[new Mt(o,r,`string expected, ${p} found`)]:[]}const uc={promoteId:function({key:l,value:r}){if(qn(r)==="string")return Vo({key:l,value:r});{const o=[];for(const p in r)o.push(...Vo({key:`${l}.${p}`,value:r[p]}));return o}}};function ka(l){const r=l.value,o=l.key,p=l.styleSpec,v=l.style,E=l.validateSpec;if(!r.type)return[new Mt(o,r,'"type" is required')];const A=Li(r.type);let P;switch(A){case"vector":case"raster":return P=rs({key:o,value:r,valueSpec:p[`source_${A.replace("-","_")}`],style:l.style,styleSpec:p,objectElementValidators:uc,validateSpec:E}),P;case"raster-dem":return P=(function(z){var F;const $=(F=z.sourceName)!==null&&F!==void 0?F:"",W=z.value,te=z.styleSpec,ie=te.source_raster_dem,re=z.style;let oe=[];const pe=qn(W);if(W===void 0)return oe;if(pe!=="object")return oe.push(new Mt("source_raster_dem",W,`object expected, ${pe} found`)),oe;const Te=Li(W.encoding)==="custom",Ke=["redFactor","greenFactor","blueFactor","baseShift"],ke=z.value.encoding?`"${z.value.encoding}"`:"Default";for(const Fe in W)!Te&&Ke.includes(Fe)?oe.push(new Mt(Fe,W[Fe],`In "${$}": "${Fe}" is only valid when "encoding" is set to "custom". ${ke} encoding found`)):ie[Fe]?oe=oe.concat(z.validateSpec({key:Fe,value:W[Fe],valueSpec:ie[Fe],validateSpec:z.validateSpec,style:re,styleSpec:te})):oe.push(new Mt(Fe,W[Fe],`unknown property "${Fe}"`));return oe})({sourceName:o,value:r,style:l.style,styleSpec:p,validateSpec:E}),P;case"geojson":if(P=rs({key:o,value:r,valueSpec:p.source_geojson,style:v,styleSpec:p,validateSpec:E,objectElementValidators:uc}),r.cluster)for(const z in r.clusterProperties){const[F,$]=r.clusterProperties[z],W=typeof F=="string"?[F,["accumulated"],["get",z]]:F;P.push(...as({key:`${o}.${z}.map`,value:$,expressionContext:"cluster-map"})),P.push(...as({key:`${o}.${z}.reduce`,value:W,expressionContext:"cluster-reduce"}))}return P;case"video":return rs({key:o,value:r,valueSpec:p.source_video,style:v,validateSpec:E,styleSpec:p});case"image":return rs({key:o,value:r,valueSpec:p.source_image,style:v,validateSpec:E,styleSpec:p});case"canvas":return[new Mt(o,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Fo({key:`${o}.type`,value:r.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function Cu(l){const r=l.value,o=l.styleSpec,p=o.light,v=l.style;let E=[];const A=qn(r);if(r===void 0)return E;if(A!=="object")return E=E.concat([new Mt("light",r,`object expected, ${A} found`)]),E;for(const P in r){const z=P.match(/^(.*)-transition$/);E=E.concat(z&&p[z[1]]&&p[z[1]].transition?l.validateSpec({key:P,value:r[P],valueSpec:o.transition,validateSpec:l.validateSpec,style:v,styleSpec:o}):p[P]?l.validateSpec({key:P,value:r[P],valueSpec:p[P],validateSpec:l.validateSpec,style:v,styleSpec:o}):[new Mt(P,r[P],`unknown property "${P}"`)])}return E}function Iu(l){const r=l.value,o=l.styleSpec,p=o.sky,v=l.style,E=qn(r);if(r===void 0)return[];if(E!=="object")return[new Mt("sky",r,`object expected, ${E} found`)];let A=[];for(const P in r)A=A.concat(p[P]?l.validateSpec({key:P,value:r[P],valueSpec:p[P],style:v,styleSpec:o}):[new Mt(P,r[P],`unknown property "${P}"`)]);return A}function Wa(l){const r=l.value,o=l.styleSpec,p=o.terrain,v=l.style;let E=[];const A=qn(r);if(r===void 0)return E;if(A!=="object")return E=E.concat([new Mt("terrain",r,`object expected, ${A} found`)]),E;for(const P in r)E=E.concat(p[P]?l.validateSpec({key:P,value:r[P],valueSpec:p[P],validateSpec:l.validateSpec,style:v,styleSpec:o}):[new Mt(P,r[P],`unknown property "${P}"`)]);return E}function ld(l){let r=[];const o=l.value,p=l.key;if(Array.isArray(o)){const v=[],E=[];for(const A in o)o[A].id&&v.includes(o[A].id)&&r.push(new Mt(p,o,`all the sprites' ids must be unique, but ${o[A].id} is duplicated`)),v.push(o[A].id),o[A].url&&E.includes(o[A].url)&&r.push(new Mt(p,o,`all the sprites' URLs must be unique, but ${o[A].url} is duplicated`)),E.push(o[A].url),r=r.concat(rs({key:`${p}[${A}]`,value:o[A],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:l.validateSpec}));return r}return Vo({key:p,value:o})}function qc(l){return r=l.value,r&&r.constructor===Object?[]:[new Mt(l.key,l.value,`object expected, ${qn(l.value)} found`)];var r}const ep={"*":()=>[],array:Bo,boolean:function(l){const r=l.value,o=l.key,p=qn(r);return p!=="boolean"?[new Mt(o,r,`boolean expected, ${p} found`)]:[]},number:Su,color:gl,constants:ui,enum:Fo,filter:Eu,function:Nr,layer:Jl,object:rs,source:ka,light:Cu,sky:Iu,terrain:Wa,projection:function(l){const r=l.value,o=l.styleSpec,p=o.projection,v=l.style,E=qn(r);if(r===void 0)return[];if(E!=="object")return[new Mt("projection",r,`object expected, ${E} found`)];let A=[];for(const P in r)A=A.concat(p[P]?l.validateSpec({key:P,value:r[P],valueSpec:p[P],style:v,styleSpec:o}):[new Mt(P,r[P],`unknown property "${P}"`)]);return A},projectionDefinition:function(l){const r=l.key;let o=l.value;o=o instanceof String?o.valueOf():o;const p=qn(o);return p!=="array"||(function(v){return Array.isArray(v)&&v.length===3&&typeof v[0]=="string"&&typeof v[1]=="string"&&typeof v[2]=="number"})(o)||(function(v){return!!["interpolate","step","literal"].includes(v[0])})(o)?["array","string"].includes(p)?[]:[new Mt(r,o,`projection expected, invalid type "${p}" found`)]:[new Mt(r,o,`projection expected, invalid array ${JSON.stringify(o)} found`)]},string:Vo,formatted:function(l){return Vo(l).length===0?[]:as(l)},resolvedImage:function(l){return Vo(l).length===0?[]:as(l)},padding:function(l){const r=l.key,o=l.value;if(qn(o)==="array"){if(o.length<1||o.length>4)return[new Mt(r,o,`padding requires 1 to 4 values; ${o.length} values found`)];const p={type:"number"};let v=[];for(let E=0;E<o.length;E++)v=v.concat(l.validateSpec({key:`${r}[${E}]`,value:o[E],validateSpec:l.validateSpec,valueSpec:p}));return v}return Su({key:r,value:o,valueSpec:{}})},numberArray:function(l){const r=l.key,o=l.value;if(qn(o)==="array"){const p={type:"number"};if(o.length<1)return[new Mt(r,o,"array length at least 1 expected, length 0 found")];let v=[];for(let E=0;E<o.length;E++)v=v.concat(l.validateSpec({key:`${r}[${E}]`,value:o[E],validateSpec:l.validateSpec,valueSpec:p}));return v}return Su({key:r,value:o,valueSpec:{}})},colorArray:function(l){const r=l.key,o=l.value;if(qn(o)==="array"){if(o.length<1)return[new Mt(r,o,"array length at least 1 expected, length 0 found")];let p=[];for(let v=0;v<o.length;v++)p=p.concat(gl({key:`${r}[${v}]`,value:o[v]}));return p}return gl({key:r,value:o})},variableAnchorOffsetCollection:function(l){const r=l.key,o=l.value,p=qn(o),v=l.styleSpec;if(p!=="array"||o.length<1||o.length%2!=0)return[new Mt(r,o,"variableAnchorOffsetCollection requires a non-empty array of even length")];let E=[];for(let A=0;A<o.length;A+=2)E=E.concat(Fo({key:`${r}[${A}]`,value:o[A],valueSpec:v.layout_symbol["text-anchor"]})),E=E.concat(Bo({key:`${r}[${A+1}]`,value:o[A+1],valueSpec:{length:2,value:"number"},validateSpec:l.validateSpec,style:l.style,styleSpec:v}));return E},sprite:ld,state:qc};function xh(l){const r=l.value,o=l.valueSpec,p=l.styleSpec;return l.validateSpec=xh,o.expression&&zo(Li(r))?Nr(l):o.expression&&oc(Wr(r))?as(l):o.type&&ep[o.type]?ep[o.type](l):rs(en({},l,{valueSpec:o.type?p[o.type]:o}))}function cm(l){const r=l.value,o=l.key,p=Vo(l);return p.length||(r.indexOf("{fontstack}")===-1&&p.push(new Mt(o,r,'"glyphs" url must include a "{fontstack}" token')),r.indexOf("{range}")===-1&&p.push(new Mt(o,r,'"glyphs" url must include a "{range}" token'))),p}function Ci(l,r=$e){let o=[];return o=o.concat(xh({key:"",value:l,valueSpec:r.$root,styleSpec:r,style:l,validateSpec:xh,objectElementValidators:{glyphs:cm,"*":()=>[]}})),l.constants&&(o=o.concat(ui({key:"constants",value:l.constants}))),eu(o)}function Uo(l){return function(r){return l({...r,validateSpec:xh})}}function eu(l){return[].concat(l).sort(((r,o)=>r.line-o.line))}function eo(l){return function(...r){return eu(l.apply(this,r))}}Ci.source=eo(Uo(ka)),Ci.sprite=eo(Uo(ld)),Ci.glyphs=eo(Uo(cm)),Ci.light=eo(Uo(Cu)),Ci.sky=eo(Uo(Iu)),Ci.terrain=eo(Uo(Wa)),Ci.state=eo(Uo(qc)),Ci.layer=eo(Uo(Jl)),Ci.filter=eo(Uo(Eu)),Ci.paintProperty=eo(Uo(_l)),Ci.layoutProperty=eo(Uo(Au));const cc=Ci,wh=cc.light,tu=cc.sky,Bg=cc.paintProperty,hm=cc.layoutProperty;function ud(l,r){let o=!1;if(r&&r.length)for(const p of r)l.fire(new xt(new Error(p.message))),o=!0;return o}class Th{constructor(r,o,p){const v=this.cells=[];if(r instanceof ArrayBuffer){this.arrayBuffer=r;const A=new Int32Array(this.arrayBuffer);r=A[0],this.d=(o=A[1])+2*(p=A[2]);for(let z=0;z<this.d*this.d;z++){const F=A[3+z],$=A[3+z+1];v.push(F===$?null:A.subarray(F,$))}const P=A[3+v.length+1];this.keys=A.subarray(A[3+v.length],P),this.bboxes=A.subarray(P),this.insert=this._insertReadonly}else{this.d=o+2*p;for(let A=0;A<this.d*this.d;A++)v.push([]);this.keys=[],this.bboxes=[]}this.n=o,this.extent=r,this.padding=p,this.scale=o/r,this.uid=0;const E=p/o*r;this.min=-E,this.max=r+E}insert(r,o,p,v,E){this._forEachCell(o,p,v,E,this._insertCell,this.uid++,void 0,void 0),this.keys.push(r),this.bboxes.push(o),this.bboxes.push(p),this.bboxes.push(v),this.bboxes.push(E)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(r,o,p,v,E,A){this.cells[E].push(A)}query(r,o,p,v,E){const A=this.min,P=this.max;if(r<=A&&o<=A&&P<=p&&P<=v&&!E)return Array.prototype.slice.call(this.keys);{const z=[];return this._forEachCell(r,o,p,v,this._queryCell,z,{},E),z}}_queryCell(r,o,p,v,E,A,P,z){const F=this.cells[E];if(F!==null){const $=this.keys,W=this.bboxes;for(let te=0;te<F.length;te++){const ie=F[te];if(P[ie]===void 0){const re=4*ie;(z?z(W[re+0],W[re+1],W[re+2],W[re+3]):r<=W[re+2]&&o<=W[re+3]&&p>=W[re+0]&&v>=W[re+1])?(P[ie]=!0,A.push($[ie])):P[ie]=!1}}}}_forEachCell(r,o,p,v,E,A,P,z){const F=this._convertToCellCoord(r),$=this._convertToCellCoord(o),W=this._convertToCellCoord(p),te=this._convertToCellCoord(v);for(let ie=F;ie<=W;ie++)for(let re=$;re<=te;re++){const oe=this.d*re+ie;if((!z||z(this._convertFromCellCoord(ie),this._convertFromCellCoord(re),this._convertFromCellCoord(ie+1),this._convertFromCellCoord(re+1)))&&E.call(this,r,o,p,v,oe,A,P,z))return}}_convertFromCellCoord(r){return(r-this.padding)/this.scale}_convertToCellCoord(r){return Math.max(0,Math.min(this.d-1,Math.floor(r*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const r=this.cells,o=3+this.cells.length+1+1;let p=0;for(let A=0;A<this.cells.length;A++)p+=this.cells[A].length;const v=new Int32Array(o+p+this.keys.length+this.bboxes.length);v[0]=this.extent,v[1]=this.n,v[2]=this.padding;let E=o;for(let A=0;A<r.length;A++){const P=r[A];v[3+A]=E,v.set(P,E),E+=P.length}return v[3+r.length]=E,v.set(this.keys,E),E+=this.keys.length,v[3+r.length+1]=E,v.set(this.bboxes,E),E+=this.bboxes.length,v.buffer}static serialize(r,o){const p=r.toArrayBuffer();return o&&o.push(p),{buffer:p}}static deserialize(r){return new Th(r.buffer)}}const ss={};function Yt(l,r,o={}){if(ss[l])throw new Error(`${l} is already registered.`);Object.defineProperty(r,"_classRegistryKey",{value:l,writeable:!1}),ss[l]={klass:r,omit:o.omit||[],shallow:o.shallow||[]}}Yt("Object",Object),Yt("Set",Set),Yt("TransferableGridIndex",Th),Yt("Color",kn),Yt("Error",Error),Yt("AJAXError",Se),Yt("ResolvedImage",cr),Yt("StylePropertyFunction",U),Yt("StyleExpression",sc,{omit:["_evaluator"]}),Yt("ZoomDependentExpression",x),Yt("ZoomConstantExpression",f),Yt("CompoundExpression",fo,{omit:["_evaluate"]});for(const l in vu)vu[l]._classRegistryKey||Yt(`Expression_${l}`,vu[l]);function Sh(l){return l&&typeof ArrayBuffer<"u"&&(l instanceof ArrayBuffer||l.constructor&&l.constructor.name==="ArrayBuffer")}function cd(l){return l.$name||l.constructor._classRegistryKey}function hc(l){return!(function(r){if(r===null||typeof r!="object")return!1;const o=cd(r);return!(!o||o==="Object")})(l)&&(l==null||typeof l=="boolean"||typeof l=="number"||typeof l=="string"||l instanceof Boolean||l instanceof Number||l instanceof String||l instanceof Date||l instanceof RegExp||l instanceof Blob||l instanceof Error||Sh(l)||Ea(l)||ArrayBuffer.isView(l)||l instanceof ImageData)}function dc(l,r){if(hc(l))return(Sh(l)||Ea(l))&&r&&r.push(l),ArrayBuffer.isView(l)&&r&&r.push(l.buffer),l instanceof ImageData&&r&&r.push(l.data.buffer),l;if(Array.isArray(l)){const E=[];for(const A of l)E.push(dc(A,r));return E}if(typeof l!="object")throw new Error("can't serialize object of type "+typeof l);const o=cd(l);if(!o)throw new Error(`can't serialize object of unregistered class ${l.constructor.name}`);if(!ss[o])throw new Error(`${o} is not registered.`);const{klass:p}=ss[o],v=p.serialize?p.serialize(l,r):{};if(p.serialize){if(r&&v===r[r.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const E in l){if(!l.hasOwnProperty(E)||ss[o].omit.indexOf(E)>=0)continue;const A=l[E];v[E]=ss[o].shallow.indexOf(E)>=0?A:dc(A,r)}l instanceof Error&&(v.message=l.message)}if(v.$name)throw new Error("$name property is reserved for worker serialization logic.");return o!=="Object"&&(v.$name=o),v}function nu(l){if(hc(l))return l;if(Array.isArray(l))return l.map(nu);if(typeof l!="object")throw new Error("can't deserialize object of type "+typeof l);const r=cd(l)||"Object";if(!ss[r])throw new Error(`can't deserialize unregistered class ${r}`);const{klass:o}=ss[r];if(!o)throw new Error(`can't deserialize unregistered class ${r}`);if(o.deserialize)return o.deserialize(l);const p=Object.create(o.prototype);for(const v of Object.keys(l)){if(v==="$name")continue;const E=l[v];p[v]=ss[r].shallow.indexOf(v)>=0?E:nu(E)}return p}class Gc{constructor(){this.first=!0}update(r,o){const p=Math.floor(r);return this.first?(this.first=!1,this.lastIntegerZoom=p,this.lastIntegerZoomTime=0,this.lastZoom=r,this.lastFloorZoom=p,!0):(this.lastFloorZoom>p?(this.lastIntegerZoom=p+1,this.lastIntegerZoomTime=o):this.lastFloorZoom<p&&(this.lastIntegerZoom=p,this.lastIntegerZoomTime=o),r!==this.lastZoom&&(this.lastZoom=r,this.lastFloorZoom=p,!0))}}const ri={"Latin-1 Supplement":l=>l>=128&&l<=255,"Hangul Jamo":l=>l>=4352&&l<=4607,Khmer:l=>l>=6016&&l<=6143,"General Punctuation":l=>l>=8192&&l<=8303,"Letterlike Symbols":l=>l>=8448&&l<=8527,"Number Forms":l=>l>=8528&&l<=8591,"Miscellaneous Technical":l=>l>=8960&&l<=9215,"Control Pictures":l=>l>=9216&&l<=9279,"Optical Character Recognition":l=>l>=9280&&l<=9311,"Enclosed Alphanumerics":l=>l>=9312&&l<=9471,"Geometric Shapes":l=>l>=9632&&l<=9727,"Miscellaneous Symbols":l=>l>=9728&&l<=9983,"Miscellaneous Symbols and Arrows":l=>l>=11008&&l<=11263,"Ideographic Description Characters":l=>l>=12272&&l<=12287,"CJK Symbols and Punctuation":l=>l>=12288&&l<=12351,Hiragana:l=>l>=12352&&l<=12447,Katakana:l=>l>=12448&&l<=12543,Kanbun:l=>l>=12688&&l<=12703,"CJK Strokes":l=>l>=12736&&l<=12783,"Enclosed CJK Letters and Months":l=>l>=12800&&l<=13055,"CJK Compatibility":l=>l>=13056&&l<=13311,"Yijing Hexagram Symbols":l=>l>=19904&&l<=19967,"CJK Unified Ideographs":l=>l>=19968&&l<=40959,"Hangul Syllables":l=>l>=44032&&l<=55215,"Private Use Area":l=>l>=57344&&l<=63743,"Vertical Forms":l=>l>=65040&&l<=65055,"CJK Compatibility Forms":l=>l>=65072&&l<=65103,"Small Form Variants":l=>l>=65104&&l<=65135,"Halfwidth and Fullwidth Forms":l=>l>=65280&&l<=65519};function hd(l){for(const r of l)if(Zc(r.charCodeAt(0)))return!0;return!1}function Hc(l){for(const r of l)if(!tp(r.charCodeAt(0)))return!1;return!0}function iu(l){const r=l.map((o=>{try{return new RegExp(`\\p{sc=${o}}`,"u").source}catch{return null}})).filter((o=>o));return new RegExp(r.join("|"),"u")}const dm=iu(["Arab","Dupl","Mong","Ougr","Syrc"]);function tp(l){return!dm.test(String.fromCodePoint(l))}const fc=iu(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function Zc(l){return!(l!==746&&l!==747&&(l<4352||!(ri["CJK Compatibility Forms"](l)&&!(l>=65097&&l<=65103)||ri["CJK Compatibility"](l)||ri["CJK Strokes"](l)||!(!ri["CJK Symbols and Punctuation"](l)||l>=12296&&l<=12305||l>=12308&&l<=12319||l===12336)||ri["Enclosed CJK Letters and Months"](l)||ri["Ideographic Description Characters"](l)||ri.Kanbun(l)||ri.Katakana(l)&&l!==12540||!(!ri["Halfwidth and Fullwidth Forms"](l)||l===65288||l===65289||l===65293||l>=65306&&l<=65310||l===65339||l===65341||l===65343||l>=65371&&l<=65503||l===65507||l>=65512&&l<=65519)||!(!ri["Small Form Variants"](l)||l>=65112&&l<=65118||l>=65123&&l<=65126)||ri["Vertical Forms"](l)||ri["Yijing Hexagram Symbols"](l)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(l))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(l))||fc.test(String.fromCodePoint(l)))))}function dd(l){return!(Zc(l)||(function(r){return!!(ri["Latin-1 Supplement"](r)&&(r===167||r===169||r===174||r===177||r===188||r===189||r===190||r===215||r===247)||ri["General Punctuation"](r)&&(r===8214||r===8224||r===8225||r===8240||r===8241||r===8251||r===8252||r===8258||r===8263||r===8264||r===8265||r===8273)||ri["Letterlike Symbols"](r)||ri["Number Forms"](r)||ri["Miscellaneous Technical"](r)&&(r>=8960&&r<=8967||r>=8972&&r<=8991||r>=8996&&r<=9e3||r===9003||r>=9085&&r<=9114||r>=9150&&r<=9165||r===9167||r>=9169&&r<=9179||r>=9186&&r<=9215)||ri["Control Pictures"](r)&&r!==9251||ri["Optical Character Recognition"](r)||ri["Enclosed Alphanumerics"](r)||ri["Geometric Shapes"](r)||ri["Miscellaneous Symbols"](r)&&!(r>=9754&&r<=9759)||ri["Miscellaneous Symbols and Arrows"](r)&&(r>=11026&&r<=11055||r>=11088&&r<=11097||r>=11192&&r<=11243)||ri["CJK Symbols and Punctuation"](r)||ri.Katakana(r)||ri["Private Use Area"](r)||ri["CJK Compatibility Forms"](r)||ri["Small Form Variants"](r)||ri["Halfwidth and Fullwidth Forms"](r)||r===8734||r===8756||r===8757||r>=9984&&r<=10087||r>=10102&&r<=10131||r===65532||r===65533)})(l))}const Eh=iu(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Ah(l){return Eh.test(String.fromCodePoint(l))}function np(l,r){return!(!r&&Ah(l)||l>=2304&&l<=3583||l>=3840&&l<=4255||ri.Khmer(l))}function pc(l){for(const r of l)if(Ah(r.charCodeAt(0)))return!0;return!1}const yl=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(l){this.pluginStatus=l.pluginStatus,this.pluginURL=l.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(l){if(yl.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=l.applyArabicShaping,this.processBidirectionalText=l.processBidirectionalText,this.processStyledBidirectionalText=l.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(l,r){return c(this,void 0,void 0,(function*(){if(this.isParsed())return this.getState();if(l.pluginStatus!=="loading")return this.setState(l),l;const o=l.pluginURL,p=new Promise((E=>{this.loadScriptResolve=E}));r(o);const v=new Promise((E=>setTimeout((()=>E()),this.TIMEOUT)));if(yield Promise.race([p,v]),this.isParsed()){const E={pluginStatus:"loaded",pluginURL:o};return this.setState(E),E}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${o}`)}))}};class Di{constructor(r,o){this.zoom=r,o?(this.now=o.now||0,this.fadeDuration=o.fadeDuration||0,this.zoomHistory=o.zoomHistory||new Gc,this.transition=o.transition||{},this.globalState=o.globalState||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Gc,this.transition={},this.globalState={})}isSupportedScript(r){return(function(o,p){for(const v of o)if(!np(v.charCodeAt(0),p))return!1;return!0})(r,yl.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const r=this.zoom,o=r-Math.floor(r),p=this.crossFadingFactor();return r>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:o+(1-o)*p}:{fromScale:.5,toScale:1,t:1-(1-p)*o}}}class mc{constructor(r,o){this.property=r,this.value=o,this.expression=(function(p,v){if(zo(p))return new U(p,v);if(oc(p)){const E=k(p,v);if(E.result==="error")throw new Error(E.value.map((A=>`${A.key}: ${A.message}`)).join(", "));return E.value}{let E=p;return v.type==="color"&&typeof p=="string"?E=kn.parse(p):v.type!=="padding"||typeof p!="number"&&!Array.isArray(p)?v.type!=="numberArray"||typeof p!="number"&&!Array.isArray(p)?v.type!=="colorArray"||typeof p!="string"&&!Array.isArray(p)?v.type==="variableAnchorOffsetCollection"&&Array.isArray(p)?E=sr.parse(p):v.type==="projectionDefinition"&&typeof p=="string"&&(E=wr.parse(p)):E=pi.parse(p):E=hn.parse(p):E=mr.parse(p),{globalStateRefs:new Set,kind:"constant",evaluate:()=>E}}})(o===void 0?r.specification.default:o,r.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(r,o,p){return this.property.possiblyEvaluate(this,r,o,p)}}class fd{constructor(r){this.property=r,this.value=new mc(r,void 0)}transitioned(r,o){return new ru(this.property,this.value,o,oi({},r.transition,this.transition),r.now)}untransitioned(){return new ru(this.property,this.value,null,{},0)}}class Pu{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitionablePropertyValues)}getValue(r){return Dr(this._values[r].value.value)}setValue(r,o){Object.prototype.hasOwnProperty.call(this._values,r)||(this._values[r]=new fd(this._values[r].property)),this._values[r].value=new mc(this._values[r].property,o===null?void 0:Dr(o))}getTransition(r){return Dr(this._values[r].transition)}setTransition(r,o){Object.prototype.hasOwnProperty.call(this._values,r)||(this._values[r]=new fd(this._values[r].property)),this._values[r].transition=Dr(o)||void 0}serialize(){const r={};for(const o of Object.keys(this._values)){const p=this.getValue(o);p!==void 0&&(r[o]=p);const v=this.getTransition(o);v!==void 0&&(r[`${o}-transition`]=v)}return r}transitioned(r,o){const p=new Wc(this._properties);for(const v of Object.keys(this._values))p._values[v]=this._values[v].transitioned(r,o._values[v]);return p}untransitioned(){const r=new Wc(this._properties);for(const o of Object.keys(this._values))r._values[o]=this._values[o].untransitioned();return r}}class ru{constructor(r,o,p,v,E){this.property=r,this.value=o,this.begin=E+v.delay||0,this.end=this.begin+v.duration||0,r.specification.transition&&(v.delay||v.duration)&&(this.prior=p)}possiblyEvaluate(r,o,p){const v=r.now||0,E=this.value.possiblyEvaluate(r,o,p),A=this.prior;if(A){if(v>this.end)return this.prior=null,E;if(this.value.isDataDriven())return this.prior=null,E;if(v<this.begin)return A.possiblyEvaluate(r,o,p);{const P=(v-this.begin)/(this.end-this.begin);return this.property.interpolate(A.possiblyEvaluate(r,o,p),E,Ot(P))}}return E}}class Wc{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitioningPropertyValues)}possiblyEvaluate(r,o,p){const v=new gc(this._properties);for(const E of Object.keys(this._values))v._values[E]=this._values[E].possiblyEvaluate(r,o,p);return v}hasTransition(){for(const r of Object.keys(this._values))if(this._values[r].prior)return!0;return!1}}class rf{constructor(r){this._properties=r,this._values=Object.create(r.defaultPropertyValues)}hasValue(r){return this._values[r].value!==void 0}getValue(r){return Dr(this._values[r].value)}setValue(r,o){this._values[r]=new mc(this._values[r].property,o===null?void 0:Dr(o))}serialize(){const r={};for(const o of Object.keys(this._values)){const p=this.getValue(o);p!==void 0&&(r[o]=p)}return r}possiblyEvaluate(r,o,p){const v=new gc(this._properties);for(const E of Object.keys(this._values))v._values[E]=this._values[E].possiblyEvaluate(r,o,p);return v}}class vl{constructor(r,o,p){this.property=r,this.value=o,this.parameters=p}isConstant(){return this.value.kind==="constant"}constantOr(r){return this.value.kind==="constant"?this.value.value:r}evaluate(r,o,p,v){return this.property.evaluate(this.value,this.parameters,r,o,p,v)}}class gc{constructor(r){this._properties=r,this._values=Object.create(r.defaultPossiblyEvaluatedValues)}get(r){return this._values[r]}}class an{constructor(r){this.specification=r}possiblyEvaluate(r,o){if(r.isDataDriven())throw new Error("Value should not be data driven");return r.expression.evaluate(o)}interpolate(r,o,p){const v=Ts[this.specification.type];return v?v(r,o,p):r}}class Tn{constructor(r,o){this.specification=r,this.overrides=o}possiblyEvaluate(r,o,p,v){return new vl(this,r.expression.kind==="constant"||r.expression.kind==="camera"?{kind:"constant",value:r.expression.evaluate(o,null,{},p,v)}:r.expression,o)}interpolate(r,o,p){if(r.value.kind!=="constant"||o.value.kind!=="constant")return r;if(r.value.value===void 0||o.value.value===void 0)return new vl(this,{kind:"constant",value:void 0},r.parameters);const v=Ts[this.specification.type];if(v){const E=v(r.value.value,o.value.value,p);return new vl(this,{kind:"constant",value:E},r.parameters)}return r}evaluate(r,o,p,v,E,A){return r.kind==="constant"?r.value:r.evaluate(o,p,v,E,A)}}class pd extends Tn{possiblyEvaluate(r,o,p,v){if(r.value===void 0)return new vl(this,{kind:"constant",value:void 0},o);if(r.expression.kind==="constant"){const E=r.expression.evaluate(o,null,{},p,v),A=r.property.specification.type==="resolvedImage"&&typeof E!="string"?E.name:E,P=this._calculate(A,A,A,o);return new vl(this,{kind:"constant",value:P},o)}if(r.expression.kind==="camera"){const E=this._calculate(r.expression.evaluate({zoom:o.zoom-1}),r.expression.evaluate({zoom:o.zoom}),r.expression.evaluate({zoom:o.zoom+1}),o);return new vl(this,{kind:"constant",value:E},o)}return new vl(this,r.expression,o)}evaluate(r,o,p,v,E,A){if(r.kind==="source"){const P=r.evaluate(o,p,v,E,A);return this._calculate(P,P,P,o)}return r.kind==="composite"?this._calculate(r.evaluate({zoom:Math.floor(o.zoom)-1},p,v),r.evaluate({zoom:Math.floor(o.zoom)},p,v),r.evaluate({zoom:Math.floor(o.zoom)+1},p,v),o):r.value}_calculate(r,o,p,v){return v.zoom>v.zoomHistory.lastIntegerZoom?{from:r,to:o}:{from:p,to:o}}interpolate(r){return r}}class jo{constructor(r){this.specification=r}possiblyEvaluate(r,o,p,v){if(r.value!==void 0){if(r.expression.kind==="constant"){const E=r.expression.evaluate(o,null,{},p,v);return this._calculate(E,E,E,o)}return this._calculate(r.expression.evaluate(new Di(Math.floor(o.zoom-1),o)),r.expression.evaluate(new Di(Math.floor(o.zoom),o)),r.expression.evaluate(new Di(Math.floor(o.zoom+1),o)),o)}}_calculate(r,o,p,v){return v.zoom>v.zoomHistory.lastIntegerZoom?{from:r,to:o}:{from:p,to:o}}interpolate(r){return r}}class Kc{constructor(r){this.specification=r}possiblyEvaluate(r,o,p,v){return!!r.expression.evaluate(o,null,{},p,v)}interpolate(){return!1}}class Cs{constructor(r){this.properties=r,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const o in r){const p=r[o];p.specification.overridable&&this.overridableProperties.push(o);const v=this.defaultPropertyValues[o]=new mc(p,void 0),E=this.defaultTransitionablePropertyValues[o]=new fd(p);this.defaultTransitioningPropertyValues[o]=E.untransitioned(),this.defaultPossiblyEvaluatedValues[o]=v.possiblyEvaluate({})}}}Yt("DataDrivenProperty",Tn),Yt("DataConstantProperty",an),Yt("CrossFadedDataDrivenProperty",pd),Yt("CrossFadedProperty",jo),Yt("ColorRampProperty",Kc);const af="-transition";class po extends tn{constructor(r,o){if(super(),this.id=r.id,this.type=r.type,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},r.type!=="custom"&&(this.metadata=r.metadata,this.minzoom=r.minzoom,this.maxzoom=r.maxzoom,r.type!=="background"&&(this.source=r.source,this.sourceLayer=r["source-layer"],this.filter=r.filter,this._featureFilter=ut(r.filter)),o.layout&&(this._unevaluatedLayout=new rf(o.layout)),o.paint)){this._transitionablePaint=new Pu(o.paint);for(const p in r.paint)this.setPaintProperty(p,r.paint[p],{validate:!1});for(const p in r.layout)this.setLayoutProperty(p,r.layout[p],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new gc(o.paint)}}setFilter(r){this.filter=r,this._featureFilter=ut(r)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(r){return r==="visibility"?this.visibility:this._unevaluatedLayout.getValue(r)}getLayoutAffectingGlobalStateRefs(){const r=new Set;if(this._unevaluatedLayout)for(const o in this._unevaluatedLayout._values){const p=this._unevaluatedLayout._values[o];for(const v of p.getGlobalStateRefs())r.add(v)}for(const o of this._featureFilter.getGlobalStateRefs())r.add(o);return r}setLayoutProperty(r,o,p={}){o!=null&&this._validate(hm,`layers.${this.id}.layout.${r}`,r,o,p)||(r!=="visibility"?this._unevaluatedLayout.setValue(r,o):this.visibility=o)}getPaintProperty(r){return r.endsWith(af)?this._transitionablePaint.getTransition(r.slice(0,-11)):this._transitionablePaint.getValue(r)}setPaintProperty(r,o,p={}){if(o!=null&&this._validate(Bg,`layers.${this.id}.paint.${r}`,r,o,p))return!1;if(r.endsWith(af))return this._transitionablePaint.setTransition(r.slice(0,-11),o||void 0),!1;{const v=this._transitionablePaint._values[r],E=v.property.specification["property-type"]==="cross-faded-data-driven",A=v.value.isDataDriven(),P=v.value;this._transitionablePaint.setValue(r,o),this._handleSpecialPaintPropertyUpdate(r);const z=this._transitionablePaint._values[r].value;return z.isDataDriven()||A||E||this._handleOverridablePaintPropertyUpdate(r,P,z)}}_handleSpecialPaintPropertyUpdate(r){}_handleOverridablePaintPropertyUpdate(r,o,p){return!1}isHidden(r){return!!(this.minzoom&&r<this.minzoom)||!!(this.maxzoom&&r>=this.maxzoom)||this.visibility==="none"}updateTransitions(r){this._transitioningPaint=this._transitionablePaint.transitioned(r,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(r,o){r.getCrossfadeParameters&&(this._crossfadeParameters=r.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(r,void 0,o)),this.paint=this._transitioningPaint.possiblyEvaluate(r,void 0,o)}serialize(){const r={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(r.layout=r.layout||{},r.layout.visibility=this.visibility),Bs(r,((o,p)=>!(o===void 0||p==="layout"&&!Object.keys(o).length||p==="paint"&&!Object.keys(o).length)))}_validate(r,o,p,v,E={}){return(!E||E.validate!==!1)&&ud(this,r.call(cc,{key:o,layerType:this.type,objectKey:p,value:v,styleSpec:$e,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const r in this.paint._values){const o=this.paint.get(r);if(o instanceof vl&&ml(o.property.specification)&&(o.value.kind==="source"||o.value.kind==="composite")&&o.value.isStateDependent)return!0}return!1}}const $o={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Is{constructor(r,o){this._structArray=r,this._pos1=o*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class gi{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(r,o){return r._trim(),o&&(r.isTransferred=!0,o.push(r.arrayBuffer)),{length:r.length,arrayBuffer:r.arrayBuffer}}static deserialize(r){const o=Object.create(this.prototype);return o.arrayBuffer=r.arrayBuffer,o.length=r.length,o.capacity=r.arrayBuffer.byteLength/o.bytesPerElement,o._refreshViews(),o}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(r){this.reserve(r),this.length=r}reserve(r){if(r>this.capacity){this.capacity=Math.max(r,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const o=this.uint8;this._refreshViews(),o&&this.uint8.set(o)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Br(l,r=1){let o=0,p=0;return{members:l.map((v=>{const E=$o[v.type].BYTES_PER_ELEMENT,A=o=md(o,Math.max(r,E)),P=v.components||1;return p=Math.max(p,E),o+=E*P,{name:v.name,type:v.type,components:P,offset:A}})),size:md(o,Math.max(p,r)),alignment:r}}function md(l,r){return Math.ceil(l/r)*r}class qo extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,o){const p=this.length;return this.resize(p+1),this.emplace(p,r,o)}emplace(r,o,p){const v=2*r;return this.int16[v+0]=o,this.int16[v+1]=p,r}}qo.prototype.bytesPerElement=4,Yt("StructArrayLayout2i4",qo);class Ka extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,o,p){const v=this.length;return this.resize(v+1),this.emplace(v,r,o,p)}emplace(r,o,p,v){const E=3*r;return this.int16[E+0]=o,this.int16[E+1]=p,this.int16[E+2]=v,r}}Ka.prototype.bytesPerElement=6,Yt("StructArrayLayout3i6",Ka);class Kr extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,o,p,v){const E=this.length;return this.resize(E+1),this.emplace(E,r,o,p,v)}emplace(r,o,p,v,E){const A=4*r;return this.int16[A+0]=o,this.int16[A+1]=p,this.int16[A+2]=v,this.int16[A+3]=E,r}}Kr.prototype.bytesPerElement=8,Yt("StructArrayLayout4i8",Kr);class Mu extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,o,p,v,E,A){const P=this.length;return this.resize(P+1),this.emplace(P,r,o,p,v,E,A)}emplace(r,o,p,v,E,A,P){const z=6*r;return this.int16[z+0]=o,this.int16[z+1]=p,this.int16[z+2]=v,this.int16[z+3]=E,this.int16[z+4]=A,this.int16[z+5]=P,r}}Mu.prototype.bytesPerElement=12,Yt("StructArrayLayout2i4i12",Mu);class to extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,o,p,v,E,A){const P=this.length;return this.resize(P+1),this.emplace(P,r,o,p,v,E,A)}emplace(r,o,p,v,E,A,P){const z=4*r,F=8*r;return this.int16[z+0]=o,this.int16[z+1]=p,this.uint8[F+4]=v,this.uint8[F+5]=E,this.uint8[F+6]=A,this.uint8[F+7]=P,r}}to.prototype.bytesPerElement=8,Yt("StructArrayLayout2i4ub8",to);class Gn extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,o){const p=this.length;return this.resize(p+1),this.emplace(p,r,o)}emplace(r,o,p){const v=2*r;return this.float32[v+0]=o,this.float32[v+1]=p,r}}Gn.prototype.bytesPerElement=8,Yt("StructArrayLayout2f8",Gn);class ji extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,o,p,v,E,A,P,z,F,$){const W=this.length;return this.resize(W+1),this.emplace(W,r,o,p,v,E,A,P,z,F,$)}emplace(r,o,p,v,E,A,P,z,F,$,W){const te=10*r;return this.uint16[te+0]=o,this.uint16[te+1]=p,this.uint16[te+2]=v,this.uint16[te+3]=E,this.uint16[te+4]=A,this.uint16[te+5]=P,this.uint16[te+6]=z,this.uint16[te+7]=F,this.uint16[te+8]=$,this.uint16[te+9]=W,r}}ji.prototype.bytesPerElement=20,Yt("StructArrayLayout10ui20",ji);class Tr extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,o,p,v,E,A,P,z,F,$,W,te){const ie=this.length;return this.resize(ie+1),this.emplace(ie,r,o,p,v,E,A,P,z,F,$,W,te)}emplace(r,o,p,v,E,A,P,z,F,$,W,te,ie){const re=12*r;return this.int16[re+0]=o,this.int16[re+1]=p,this.int16[re+2]=v,this.int16[re+3]=E,this.uint16[re+4]=A,this.uint16[re+5]=P,this.uint16[re+6]=z,this.uint16[re+7]=F,this.int16[re+8]=$,this.int16[re+9]=W,this.int16[re+10]=te,this.int16[re+11]=ie,r}}Tr.prototype.bytesPerElement=24,Yt("StructArrayLayout4i4ui4i24",Tr);class Ch extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,o,p){const v=this.length;return this.resize(v+1),this.emplace(v,r,o,p)}emplace(r,o,p,v){const E=3*r;return this.float32[E+0]=o,this.float32[E+1]=p,this.float32[E+2]=v,r}}Ch.prototype.bytesPerElement=12,Yt("StructArrayLayout3f12",Ch);class _c extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r){const o=this.length;return this.resize(o+1),this.emplace(o,r)}emplace(r,o){return this.uint32[1*r+0]=o,r}}_c.prototype.bytesPerElement=4,Yt("StructArrayLayout1ul4",_c);class au extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,o,p,v,E,A,P,z,F){const $=this.length;return this.resize($+1),this.emplace($,r,o,p,v,E,A,P,z,F)}emplace(r,o,p,v,E,A,P,z,F,$){const W=10*r,te=5*r;return this.int16[W+0]=o,this.int16[W+1]=p,this.int16[W+2]=v,this.int16[W+3]=E,this.int16[W+4]=A,this.int16[W+5]=P,this.uint32[te+3]=z,this.uint16[W+8]=F,this.uint16[W+9]=$,r}}au.prototype.bytesPerElement=20,Yt("StructArrayLayout6i1ul2ui20",au);class Ih extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,o,p,v,E,A){const P=this.length;return this.resize(P+1),this.emplace(P,r,o,p,v,E,A)}emplace(r,o,p,v,E,A,P){const z=6*r;return this.int16[z+0]=o,this.int16[z+1]=p,this.int16[z+2]=v,this.int16[z+3]=E,this.int16[z+4]=A,this.int16[z+5]=P,r}}Ih.prototype.bytesPerElement=12,Yt("StructArrayLayout2i2i2i12",Ih);class T extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,o,p,v,E){const A=this.length;return this.resize(A+1),this.emplace(A,r,o,p,v,E)}emplace(r,o,p,v,E,A){const P=4*r,z=8*r;return this.float32[P+0]=o,this.float32[P+1]=p,this.float32[P+2]=v,this.int16[z+6]=E,this.int16[z+7]=A,r}}T.prototype.bytesPerElement=16,Yt("StructArrayLayout2f1f2i16",T);class i extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,o,p,v,E,A){const P=this.length;return this.resize(P+1),this.emplace(P,r,o,p,v,E,A)}emplace(r,o,p,v,E,A,P){const z=16*r,F=4*r,$=8*r;return this.uint8[z+0]=o,this.uint8[z+1]=p,this.float32[F+1]=v,this.float32[F+2]=E,this.int16[$+6]=A,this.int16[$+7]=P,r}}i.prototype.bytesPerElement=16,Yt("StructArrayLayout2ub2f2i16",i);class u extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,o,p){const v=this.length;return this.resize(v+1),this.emplace(v,r,o,p)}emplace(r,o,p,v){const E=3*r;return this.uint16[E+0]=o,this.uint16[E+1]=p,this.uint16[E+2]=v,r}}u.prototype.bytesPerElement=6,Yt("StructArrayLayout3ui6",u);class _ extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,o,p,v,E,A,P,z,F,$,W,te,ie,re,oe,pe,Te){const Ke=this.length;return this.resize(Ke+1),this.emplace(Ke,r,o,p,v,E,A,P,z,F,$,W,te,ie,re,oe,pe,Te)}emplace(r,o,p,v,E,A,P,z,F,$,W,te,ie,re,oe,pe,Te,Ke){const ke=24*r,Fe=12*r,ot=48*r;return this.int16[ke+0]=o,this.int16[ke+1]=p,this.uint16[ke+2]=v,this.uint16[ke+3]=E,this.uint32[Fe+2]=A,this.uint32[Fe+3]=P,this.uint32[Fe+4]=z,this.uint16[ke+10]=F,this.uint16[ke+11]=$,this.uint16[ke+12]=W,this.float32[Fe+7]=te,this.float32[Fe+8]=ie,this.uint8[ot+36]=re,this.uint8[ot+37]=oe,this.uint8[ot+38]=pe,this.uint32[Fe+10]=Te,this.int16[ke+22]=Ke,r}}_.prototype.bytesPerElement=48,Yt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",_);class b extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,o,p,v,E,A,P,z,F,$,W,te,ie,re,oe,pe,Te,Ke,ke,Fe,ot,gt,Ct,Gt,Ft,Ht,dn,qt){const jt=this.length;return this.resize(jt+1),this.emplace(jt,r,o,p,v,E,A,P,z,F,$,W,te,ie,re,oe,pe,Te,Ke,ke,Fe,ot,gt,Ct,Gt,Ft,Ht,dn,qt)}emplace(r,o,p,v,E,A,P,z,F,$,W,te,ie,re,oe,pe,Te,Ke,ke,Fe,ot,gt,Ct,Gt,Ft,Ht,dn,qt,jt){const St=32*r,Sn=16*r;return this.int16[St+0]=o,this.int16[St+1]=p,this.int16[St+2]=v,this.int16[St+3]=E,this.int16[St+4]=A,this.int16[St+5]=P,this.int16[St+6]=z,this.int16[St+7]=F,this.uint16[St+8]=$,this.uint16[St+9]=W,this.uint16[St+10]=te,this.uint16[St+11]=ie,this.uint16[St+12]=re,this.uint16[St+13]=oe,this.uint16[St+14]=pe,this.uint16[St+15]=Te,this.uint16[St+16]=Ke,this.uint16[St+17]=ke,this.uint16[St+18]=Fe,this.uint16[St+19]=ot,this.uint16[St+20]=gt,this.uint16[St+21]=Ct,this.uint16[St+22]=Gt,this.uint32[Sn+12]=Ft,this.float32[Sn+13]=Ht,this.float32[Sn+14]=dn,this.uint16[St+30]=qt,this.uint16[St+31]=jt,r}}b.prototype.bytesPerElement=64,Yt("StructArrayLayout8i15ui1ul2f2ui64",b);class S extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r){const o=this.length;return this.resize(o+1),this.emplace(o,r)}emplace(r,o){return this.float32[1*r+0]=o,r}}S.prototype.bytesPerElement=4,Yt("StructArrayLayout1f4",S);class I extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,o,p){const v=this.length;return this.resize(v+1),this.emplace(v,r,o,p)}emplace(r,o,p,v){const E=3*r;return this.uint16[6*r+0]=o,this.float32[E+1]=p,this.float32[E+2]=v,r}}I.prototype.bytesPerElement=12,Yt("StructArrayLayout1ui2f12",I);class O extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,o,p){const v=this.length;return this.resize(v+1),this.emplace(v,r,o,p)}emplace(r,o,p,v){const E=4*r;return this.uint32[2*r+0]=o,this.uint16[E+2]=p,this.uint16[E+3]=v,r}}O.prototype.bytesPerElement=8,Yt("StructArrayLayout1ul2ui8",O);class N extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,o){const p=this.length;return this.resize(p+1),this.emplace(p,r,o)}emplace(r,o,p){const v=2*r;return this.uint16[v+0]=o,this.uint16[v+1]=p,r}}N.prototype.bytesPerElement=4,Yt("StructArrayLayout2ui4",N);class j extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r){const o=this.length;return this.resize(o+1),this.emplace(o,r)}emplace(r,o){return this.uint16[1*r+0]=o,r}}j.prototype.bytesPerElement=2,Yt("StructArrayLayout1ui2",j);class G extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,o,p,v){const E=this.length;return this.resize(E+1),this.emplace(E,r,o,p,v)}emplace(r,o,p,v,E){const A=4*r;return this.float32[A+0]=o,this.float32[A+1]=p,this.float32[A+2]=v,this.float32[A+3]=E,r}}G.prototype.bytesPerElement=16,Yt("StructArrayLayout4f16",G);class K extends Is{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new C(this.anchorPointX,this.anchorPointY)}}K.prototype.size=20;class Z extends au{get(r){return new K(this,r)}}Yt("CollisionBoxArray",Z);class ee extends Is{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(r){this._structArray.uint8[this._pos1+37]=r}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(r){this._structArray.uint8[this._pos1+38]=r}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(r){this._structArray.uint32[this._pos4+10]=r}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}ee.prototype.size=48;class ae extends _{get(r){return new ee(this,r)}}Yt("PlacedSymbolArray",ae);class ge extends Is{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(r){this._structArray.uint32[this._pos4+12]=r}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}ge.prototype.size=64;class me extends b{get(r){return new ge(this,r)}}Yt("SymbolInstanceArray",me);class ve extends S{getoffsetX(r){return this.float32[1*r+0]}}Yt("GlyphOffsetArray",ve);class we extends Ka{getx(r){return this.int16[3*r+0]}gety(r){return this.int16[3*r+1]}gettileUnitDistanceFromAnchor(r){return this.int16[3*r+2]}}Yt("SymbolLineVertexArray",we);class Pe extends Is{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}Pe.prototype.size=12;class Ce extends I{get(r){return new Pe(this,r)}}Yt("TextAnchorOffsetArray",Ce);class ze extends Is{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}ze.prototype.size=8;class Ve extends O{get(r){return new ze(this,r)}}Yt("FeatureIndexArray",Ve);class Ie extends qo{}class Ye extends qo{}class ct extends qo{}class rt extends Mu{}class st extends to{}class lt extends Gn{}class Nt extends ji{}class Vt extends Tr{}class At extends Ch{}class ln extends _c{}class Hn extends Ih{}class bi extends i{}class Yi extends u{}class $i extends N{}const Mr=Br([{name:"a_pos",components:2,type:"Int16"}],4),{members:Fr}=Mr;class jn{constructor(r=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=r}prepareSegment(r,o,p,v){const E=this.segments[this.segments.length-1];return r>jn.MAX_VERTEX_ARRAY_LENGTH&&Mi(`Max vertices per segment is ${jn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${r}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${jn.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!E||E.vertexLength+r>jn.MAX_VERTEX_ARRAY_LENGTH||E.sortKey!==v?this.createNewSegment(o,p,v):E}createNewSegment(r,o,p){const v={vertexOffset:r.length,primitiveOffset:o.length,vertexLength:0,primitiveLength:0,vaos:{}};return p!==void 0&&(v.sortKey=p),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(v),v}getOrCreateLatestSegment(r,o,p){return this.prepareSegment(0,r,o,p)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const r of this.segments)for(const o in r.vaos)r.vaos[o].destroy()}static simpleSegment(r,o,p,v){return new jn([{vertexOffset:r,primitiveOffset:o,vertexLength:p,primitiveLength:v,vaos:{},sortKey:0}])}}function ur(l,r){return 256*(l=Wt(Math.floor(l),0,255))+Wt(Math.floor(r),0,255)}jn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Yt("SegmentVector",jn);const oa=Br([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Vr,La,Xa,mo={exports:{}},Ru={exports:{}},su={exports:{}},Ph=(function(){if(Xa)return mo.exports;Xa=1;var l=(Vr||(Vr=1,Ru.exports=function(o,p){var v,E,A,P,z,F,$,W;for(E=o.length-(v=3&o.length),A=p,z=3432918353,F=461845907,W=0;W<E;)$=255&o.charCodeAt(W)|(255&o.charCodeAt(++W))<<8|(255&o.charCodeAt(++W))<<16|(255&o.charCodeAt(++W))<<24,++W,A=27492+(65535&(P=5*(65535&(A=(A^=$=(65535&($=($=(65535&$)*z+((($>>>16)*z&65535)<<16)&4294967295)<<15|$>>>17))*F+((($>>>16)*F&65535)<<16)&4294967295)<<13|A>>>19))+((5*(A>>>16)&65535)<<16)&4294967295))+((58964+(P>>>16)&65535)<<16);switch($=0,v){case 3:$^=(255&o.charCodeAt(W+2))<<16;case 2:$^=(255&o.charCodeAt(W+1))<<8;case 1:A^=$=(65535&($=($=(65535&($^=255&o.charCodeAt(W)))*z+((($>>>16)*z&65535)<<16)&4294967295)<<15|$>>>17))*F+((($>>>16)*F&65535)<<16)&4294967295}return A^=o.length,A=2246822507*(65535&(A^=A>>>16))+((2246822507*(A>>>16)&65535)<<16)&4294967295,A=3266489909*(65535&(A^=A>>>13))+((3266489909*(A>>>16)&65535)<<16)&4294967295,(A^=A>>>16)>>>0}),Ru.exports),r=(La||(La=1,su.exports=function(o,p){for(var v,E=o.length,A=p^E,P=0;E>=4;)v=1540483477*(65535&(v=255&o.charCodeAt(P)|(255&o.charCodeAt(++P))<<8|(255&o.charCodeAt(++P))<<16|(255&o.charCodeAt(++P))<<24))+((1540483477*(v>>>16)&65535)<<16),A=1540483477*(65535&A)+((1540483477*(A>>>16)&65535)<<16)^(v=1540483477*(65535&(v^=v>>>24))+((1540483477*(v>>>16)&65535)<<16)),E-=4,++P;switch(E){case 3:A^=(255&o.charCodeAt(P+2))<<16;case 2:A^=(255&o.charCodeAt(P+1))<<8;case 1:A=1540483477*(65535&(A^=255&o.charCodeAt(P)))+((1540483477*(A>>>16)&65535)<<16)}return A=1540483477*(65535&(A^=A>>>13))+((1540483477*(A>>>16)&65535)<<16),(A^=A>>>15)>>>0}),su.exports);return mo.exports=l,mo.exports.murmur3=l,mo.exports.murmur2=r,mo.exports})(),Xc=R(Ph);class yc{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(r,o,p,v){this.ids.push(vc(r)),this.positions.push(o,p,v)}getPositions(r){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const o=vc(r);let p=0,v=this.ids.length-1;for(;p<v;){const A=p+v>>1;this.ids[A]>=o?v=A:p=A+1}const E=[];for(;this.ids[p]===o;)E.push({index:this.positions[3*p],start:this.positions[3*p+1],end:this.positions[3*p+2]}),p++;return E}static serialize(r,o){const p=new Float64Array(r.ids),v=new Uint32Array(r.positions);return no(p,v,0,p.length-1),o&&o.push(p.buffer,v.buffer),{ids:p,positions:v}}static deserialize(r){const o=new yc;return o.ids=r.ids,o.positions=r.positions,o.indexed=!0,o}}function vc(l){const r=+l;return!isNaN(r)&&r<=Number.MAX_SAFE_INTEGER?r:Xc(String(l))}function no(l,r,o,p){for(;o<p;){const v=l[o+p>>1];let E=o-1,A=p+1;for(;;){do E++;while(l[E]<v);do A--;while(l[A]>v);if(E>=A)break;bl(l,E,A),bl(r,3*E,3*A),bl(r,3*E+1,3*A+1),bl(r,3*E+2,3*A+2)}A-o<p-A?(no(l,r,o,A),o=A+1):(no(l,r,A+1,p),p=A)}}function bl(l,r,o){const p=l[r];l[r]=l[o],l[o]=p}Yt("FeaturePositionMap",yc);class os{constructor(r,o){this.gl=r.gl,this.location=o}}class ku extends os{constructor(r,o){super(r,o),this.current=0}set(r){this.current!==r&&(this.current=r,this.gl.uniform1f(this.location,r))}}class la extends os{constructor(r,o){super(r,o),this.current=[0,0,0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]&&r[3]===this.current[3]||(this.current=r,this.gl.uniform4f(this.location,r[0],r[1],r[2],r[3]))}}class ua extends os{constructor(r,o){super(r,o),this.current=kn.transparent}set(r){r.r===this.current.r&&r.g===this.current.g&&r.b===this.current.b&&r.a===this.current.a||(this.current=r,this.gl.uniform4f(this.location,r.r,r.g,r.b,r.a))}}const Go=new Float32Array(16);function ca(l){return[ur(255*l.r,255*l.g),ur(255*l.b,255*l.a)]}class gd{constructor(r,o,p){this.value=r,this.uniformNames=o.map((v=>`u_${v}`)),this.type=p}setUniform(r,o,p){r.set(p.constantOr(this.value))}getBinding(r,o,p){return this.type==="color"?new ua(r,o):new ku(r,o)}}class bc{constructor(r,o){this.uniformNames=o.map((p=>`u_${p}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(r,o){this.pixelRatioFrom=o.pixelRatio,this.pixelRatioTo=r.pixelRatio,this.patternFrom=o.tlbr,this.patternTo=r.tlbr}setUniform(r,o,p,v){const E=v==="u_pattern_to"?this.patternTo:v==="u_pattern_from"?this.patternFrom:v==="u_pixel_ratio_to"?this.pixelRatioTo:v==="u_pixel_ratio_from"?this.pixelRatioFrom:null;E&&r.set(E)}getBinding(r,o,p){return p.substr(0,9)==="u_pattern"?new la(r,o):new ku(r,o)}}class ou{constructor(r,o,p,v){this.expression=r,this.type=p,this.maxValue=0,this.paintVertexAttributes=o.map((E=>({name:`a_${E}`,type:"Float32",components:p==="color"?2:1,offset:0}))),this.paintVertexArray=new v}populatePaintArray(r,o,p,v,E){const A=this.paintVertexArray.length,P=this.expression.evaluate(new Di(0),o,{},v,[],E);this.paintVertexArray.resize(r),this._setPaintValue(A,r,P)}updatePaintArray(r,o,p,v){const E=this.expression.evaluate({zoom:0},p,v);this._setPaintValue(r,o,E)}_setPaintValue(r,o,p){if(this.type==="color"){const v=ca(p);for(let E=r;E<o;E++)this.paintVertexArray.emplace(E,v[0],v[1])}else{for(let v=r;v<o;v++)this.paintVertexArray.emplace(v,p);this.maxValue=Math.max(this.maxValue,Math.abs(p))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class xl{constructor(r,o,p,v,E,A){this.expression=r,this.uniformNames=o.map((P=>`u_${P}_t`)),this.type=p,this.useIntegerZoom=v,this.zoom=E,this.maxValue=0,this.paintVertexAttributes=o.map((P=>({name:`a_${P}`,type:"Float32",components:p==="color"?4:2,offset:0}))),this.paintVertexArray=new A}populatePaintArray(r,o,p,v,E){const A=this.expression.evaluate(new Di(this.zoom),o,{},v,[],E),P=this.expression.evaluate(new Di(this.zoom+1),o,{},v,[],E),z=this.paintVertexArray.length;this.paintVertexArray.resize(r),this._setPaintValue(z,r,A,P)}updatePaintArray(r,o,p,v){const E=this.expression.evaluate({zoom:this.zoom},p,v),A=this.expression.evaluate({zoom:this.zoom+1},p,v);this._setPaintValue(r,o,E,A)}_setPaintValue(r,o,p,v){if(this.type==="color"){const E=ca(p),A=ca(v);for(let P=r;P<o;P++)this.paintVertexArray.emplace(P,E[0],E[1],A[0],A[1])}else{for(let E=r;E<o;E++)this.paintVertexArray.emplace(E,p,v);this.maxValue=Math.max(this.maxValue,Math.abs(p),Math.abs(v))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(r,o){const p=this.useIntegerZoom?Math.floor(o.zoom):o.zoom,v=Wt(this.expression.interpolationFactor(p,this.zoom,this.zoom+1),0,1);r.set(v)}getBinding(r,o,p){return new ku(r,o)}}class lu{constructor(r,o,p,v,E,A){this.expression=r,this.type=o,this.useIntegerZoom=p,this.zoom=v,this.layerId=A,this.zoomInPaintVertexArray=new E,this.zoomOutPaintVertexArray=new E}populatePaintArray(r,o,p){const v=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(r),this.zoomOutPaintVertexArray.resize(r),this._setPaintValues(v,r,o.patterns&&o.patterns[this.layerId],p)}updatePaintArray(r,o,p,v,E){this._setPaintValues(r,o,p.patterns&&p.patterns[this.layerId],E)}_setPaintValues(r,o,p,v){if(!v||!p)return;const{min:E,mid:A,max:P}=p,z=v[E],F=v[A],$=v[P];if(z&&F&&$)for(let W=r;W<o;W++)this.zoomInPaintVertexArray.emplace(W,F.tl[0],F.tl[1],F.br[0],F.br[1],z.tl[0],z.tl[1],z.br[0],z.br[1],F.pixelRatio,z.pixelRatio),this.zoomOutPaintVertexArray.emplace(W,F.tl[0],F.tl[1],F.br[0],F.br[1],$.tl[0],$.tl[1],$.br[0],$.br[1],F.pixelRatio,$.pixelRatio)}upload(r){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=r.createVertexBuffer(this.zoomInPaintVertexArray,oa.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=r.createVertexBuffer(this.zoomOutPaintVertexArray,oa.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class ip{constructor(r,o,p){this.binders={},this._buffers=[];const v=[];for(const E in r.paint._values){if(!p(E))continue;const A=r.paint.get(E);if(!(A instanceof vl&&ml(A.property.specification)))continue;const P=fm(E,r.type),z=A.value,F=A.property.specification.type,$=A.property.useIntegerZoom,W=A.property.specification["property-type"],te=W==="cross-faded"||W==="cross-faded-data-driven";if(z.kind==="constant")this.binders[E]=te?new bc(z.value,P):new gd(z.value,P,F),v.push(`/u_${E}`);else if(z.kind==="source"||te){const ie=rp(E,F,"source");this.binders[E]=te?new lu(z,F,$,o,ie,r.id):new ou(z,P,F,ie),v.push(`/a_${E}`)}else{const ie=rp(E,F,"composite");this.binders[E]=new xl(z,P,F,$,o,ie),v.push(`/z_${E}`)}}this.cacheKey=v.sort().join("")}getMaxValue(r){const o=this.binders[r];return o instanceof ou||o instanceof xl?o.maxValue:0}populatePaintArrays(r,o,p,v,E){for(const A in this.binders){const P=this.binders[A];(P instanceof ou||P instanceof xl||P instanceof lu)&&P.populatePaintArray(r,o,p,v,E)}}setConstantPatternPositions(r,o){for(const p in this.binders){const v=this.binders[p];v instanceof bc&&v.setConstantPatternPositions(r,o)}}updatePaintArrays(r,o,p,v,E){let A=!1;for(const P in r){const z=o.getPositions(P);for(const F of z){const $=p.feature(F.index);for(const W in this.binders){const te=this.binders[W];if((te instanceof ou||te instanceof xl||te instanceof lu)&&te.expression.isStateDependent===!0){const ie=v.paint.get(W);te.expression=ie.value,te.updatePaintArray(F.start,F.end,$,r[P],E),A=!0}}}}return A}defines(){const r=[];for(const o in this.binders){const p=this.binders[o];(p instanceof gd||p instanceof bc)&&r.push(...p.uniformNames.map((v=>`#define HAS_UNIFORM_${v}`)))}return r}getBinderAttributes(){const r=[];for(const o in this.binders){const p=this.binders[o];if(p instanceof ou||p instanceof xl)for(let v=0;v<p.paintVertexAttributes.length;v++)r.push(p.paintVertexAttributes[v].name);else if(p instanceof lu)for(let v=0;v<oa.members.length;v++)r.push(oa.members[v].name)}return r}getBinderUniforms(){const r=[];for(const o in this.binders){const p=this.binders[o];if(p instanceof gd||p instanceof bc||p instanceof xl)for(const v of p.uniformNames)r.push(v)}return r}getPaintVertexBuffers(){return this._buffers}getUniforms(r,o){const p=[];for(const v in this.binders){const E=this.binders[v];if(E instanceof gd||E instanceof bc||E instanceof xl){for(const A of E.uniformNames)if(o[A]){const P=E.getBinding(r,o[A],A);p.push({name:A,property:v,binding:P})}}}return p}setUniforms(r,o,p,v){for(const{name:E,property:A,binding:P}of o)this.binders[A].setUniform(P,v,p.get(A),E)}updatePaintBuffers(r){this._buffers=[];for(const o in this.binders){const p=this.binders[o];if(r&&p instanceof lu){const v=r.fromScale===2?p.zoomInPaintVertexBuffer:p.zoomOutPaintVertexBuffer;v&&this._buffers.push(v)}else(p instanceof ou||p instanceof xl)&&p.paintVertexBuffer&&this._buffers.push(p.paintVertexBuffer)}}upload(r){for(const o in this.binders){const p=this.binders[o];(p instanceof ou||p instanceof xl||p instanceof lu)&&p.upload(r)}this.updatePaintBuffers()}destroy(){for(const r in this.binders){const o=this.binders[r];(o instanceof ou||o instanceof xl||o instanceof lu)&&o.destroy()}}}class go{constructor(r,o,p=()=>!0){this.programConfigurations={};for(const v of r)this.programConfigurations[v.id]=new ip(v,o,p);this.needsUpload=!1,this._featureMap=new yc,this._bufferOffset=0}populatePaintArrays(r,o,p,v,E,A){for(const P in this.programConfigurations)this.programConfigurations[P].populatePaintArrays(r,o,v,E,A);o.id!==void 0&&this._featureMap.add(o.id,p,this._bufferOffset,r),this._bufferOffset=r,this.needsUpload=!0}updatePaintArrays(r,o,p,v){for(const E of p)this.needsUpload=this.programConfigurations[E.id].updatePaintArrays(r,this._featureMap,o,E,v)||this.needsUpload}get(r){return this.programConfigurations[r]}upload(r){if(this.needsUpload){for(const o in this.programConfigurations)this.programConfigurations[o].upload(r);this.needsUpload=!1}}destroy(){for(const r in this.programConfigurations)this.programConfigurations[r].destroy()}}function fm(l,r){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[l]||[l.replace(`${r}-`,"").replace(/-/g,"_")]}function rp(l,r,o){const p={color:{source:Gn,composite:G},number:{source:S,composite:Gn}},v=(function(E){return{"line-pattern":{source:Nt,composite:Nt},"fill-pattern":{source:Nt,composite:Nt},"fill-extrusion-pattern":{source:Nt,composite:Nt}}[E]})(l);return v&&v[o]||p[r][o]}Yt("ConstantBinder",gd),Yt("CrossFadedConstantBinder",bc),Yt("SourceExpressionBinder",ou),Yt("CrossFadedCompositeBinder",lu),Yt("CompositeExpressionBinder",xl),Yt("ProgramConfiguration",ip,{omit:["_buffers"]}),Yt("ProgramConfigurationSet",go);const _d=Math.pow(2,14)-1,xc=-_d-1;function uu(l){const r=zt/l.extent,o=l.loadGeometry();for(let p=0;p<o.length;p++){const v=o[p];for(let E=0;E<v.length;E++){const A=v[E],P=Math.round(A.x*r),z=Math.round(A.y*r);A.x=Wt(P,xc,_d),A.y=Wt(z,xc,_d),(P<A.x||P>A.x+1||z<A.y||z>A.y+1)&&Mi("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return o}function wl(l,r){return{type:l.type,id:l.id,properties:l.properties,geometry:r?uu(l):[]}}const Fg=-32768;function Qy(l,r,o,p,v){l.emplaceBack(Fg+8*r+p,Fg+8*o+v)}class yd{constructor(r){this.zoom=r.zoom,this.globalState=r.globalState,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map((o=>o.id)),this.index=r.index,this.hasPattern=!1,this.layoutVertexArray=new Ye,this.indexArray=new Yi,this.segments=new jn,this.programConfigurations=new go(r.layers,r.zoom),this.stateDependentLayerIds=this.layers.filter((o=>o.isStateDependent())).map((o=>o.id))}populate(r,o,p){const v=this.layers[0],E=[];let A=null,P=!1,z=v.type==="heatmap";if(v.type==="circle"){const $=v;A=$.layout.get("circle-sort-key"),P=!A.isConstant(),z=z||$.paint.get("circle-pitch-alignment")==="map"}const F=z?o.subdivisionGranularity.circle:1;for(const{feature:$,id:W,index:te,sourceLayerIndex:ie}of r){const re=this.layers[0]._featureFilter.needGeometry,oe=wl($,re);if(!this.layers[0]._featureFilter.filter(new Di(this.zoom,{globalState:this.globalState}),oe,p))continue;const pe=P?A.evaluate(oe,{},p):void 0,Te={id:W,properties:$.properties,type:$.type,sourceLayerIndex:ie,index:te,geometry:re?oe.geometry:uu($),patterns:{},sortKey:pe};E.push(Te)}P&&E.sort((($,W)=>$.sortKey-W.sortKey));for(const $ of E){const{geometry:W,index:te,sourceLayerIndex:ie}=$,re=r[te].feature;this.addFeature($,W,te,p,F),o.featureIndex.insert(re,W,te,ie,this.index)}}update(r,o,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,o,this.stateDependentLayers,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,Fr),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(r,o,p,v,E=1){let A;switch(E){case 1:A=[0,7];break;case 3:A=[0,2,5,7];break;case 5:A=[0,1,3,4,6,7];break;case 7:A=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${E}; valid values are 1, 3, 5, 7.`)}const P=A.length;for(const z of o)for(const F of z){const $=F.x,W=F.y;if($<0||$>=zt||W<0||W>=zt)continue;const te=this.segments.prepareSegment(P*P,this.layoutVertexArray,this.indexArray,r.sortKey),ie=te.vertexLength;for(let re=0;re<P;re++)for(let oe=0;oe<P;oe++)Qy(this.layoutVertexArray,$,W,A[oe],A[re]);for(let re=0;re<P-1;re++)for(let oe=0;oe<P-1;oe++){const pe=ie+re*P+oe,Te=ie+(re+1)*P+oe;this.indexArray.emplaceBack(pe,Te+1,pe+1),this.indexArray.emplaceBack(pe,Te,Te+1)}te.vertexLength+=P*P,te.primitiveLength+=(P-1)*(P-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,p,{},v)}}function Vg(l,r){for(let o=0;o<l.length;o++)if(vd(r,l[o]))return!0;for(let o=0;o<r.length;o++)if(vd(l,r[o]))return!0;return!!ap(l,r)}function Ug(l,r,o){return!!vd(l,r)||!!pm(r,l,o)}function jg(l,r){if(l.length===1)return qg(r,l[0]);for(let o=0;o<r.length;o++){const p=r[o];for(let v=0;v<p.length;v++)if(vd(l,p[v]))return!0}for(let o=0;o<l.length;o++)if(qg(r,l[o]))return!0;for(let o=0;o<r.length;o++)if(ap(l,r[o]))return!0;return!1}function $g(l,r,o){if(l.length>1){if(ap(l,r))return!0;for(let p=0;p<r.length;p++)if(pm(r[p],l,o))return!0}for(let p=0;p<l.length;p++)if(pm(l[p],r,o))return!0;return!1}function ap(l,r){if(l.length===0||r.length===0)return!1;for(let o=0;o<l.length-1;o++){const p=l[o],v=l[o+1];for(let E=0;E<r.length-1;E++)if(Jy(p,v,r[E],r[E+1]))return!0}return!1}function Jy(l,r,o,p){return Ua(l,o,p)!==Ua(r,o,p)&&Ua(l,r,o)!==Ua(l,r,p)}function pm(l,r,o){const p=o*o;if(r.length===1)return l.distSqr(r[0])<p;for(let v=1;v<r.length;v++)if(Mh(l,r[v-1],r[v])<p)return!0;return!1}function Mh(l,r,o){const p=r.distSqr(o);if(p===0)return l.distSqr(r);const v=((l.x-r.x)*(o.x-r.x)+(l.y-r.y)*(o.y-r.y))/p;return l.distSqr(v<0?r:v>1?o:o.sub(r)._mult(v)._add(r))}function qg(l,r){let o,p,v,E=!1;for(let A=0;A<l.length;A++){o=l[A];for(let P=0,z=o.length-1;P<o.length;z=P++)p=o[P],v=o[z],p.y>r.y!=v.y>r.y&&r.x<(v.x-p.x)*(r.y-p.y)/(v.y-p.y)+p.x&&(E=!E)}return E}function vd(l,r){let o=!1;for(let p=0,v=l.length-1;p<l.length;v=p++){const E=l[p],A=l[v];E.y>r.y!=A.y>r.y&&r.x<(A.x-E.x)*(r.y-E.y)/(A.y-E.y)+E.x&&(o=!o)}return o}function ev(l,r,o){const p=o[0],v=o[2];if(l.x<p.x&&r.x<p.x||l.x>v.x&&r.x>v.x||l.y<p.y&&r.y<p.y||l.y>v.y&&r.y>v.y)return!1;const E=Ua(l,r,o[0]);return E!==Ua(l,r,o[1])||E!==Ua(l,r,o[2])||E!==Ua(l,r,o[3])}function Rh(l,r,o){const p=r.paint.get(l).value;return p.kind==="constant"?p.value:o.programConfigurations.get(r.id).getMaxValue(l)}function sp(l){return Math.sqrt(l[0]*l[0]+l[1]*l[1])}function sf(l,r,o,p,v){if(!r[0]&&!r[1])return l;const E=C.convert(r)._mult(v);o==="viewport"&&E._rotate(-p);const A=[];for(let P=0;P<l.length;P++)A.push(l[P].sub(E));return A}let Gg,Hg;Yt("CircleBucket",yd,{omit:["layers"]});var ex={get paint(){return Hg=Hg||new Cs({"circle-radius":new Tn($e.paint_circle["circle-radius"]),"circle-color":new Tn($e.paint_circle["circle-color"]),"circle-blur":new Tn($e.paint_circle["circle-blur"]),"circle-opacity":new Tn($e.paint_circle["circle-opacity"]),"circle-translate":new an($e.paint_circle["circle-translate"]),"circle-translate-anchor":new an($e.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new an($e.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new an($e.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Tn($e.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Tn($e.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Tn($e.paint_circle["circle-stroke-opacity"])})},get layout(){return Gg=Gg||new Cs({"circle-sort-key":new Tn($e.layout_circle["circle-sort-key"])})}};class Zg extends po{constructor(r){super(r,ex)}createBucket(r){return new yd(r)}queryRadius(r){const o=r;return Rh("circle-radius",this,o)+Rh("circle-stroke-width",this,o)+sp(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:r,feature:o,featureState:p,geometry:v,transform:E,pixelsToTileUnits:A,unwrappedTileID:P,getElevation:z}){const F=sf(r,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-E.bearingInRadians,A),$=this.paint.get("circle-radius").evaluate(o,p)+this.paint.get("circle-stroke-width").evaluate(o,p),W=this.paint.get("circle-pitch-alignment")==="map",te=W?F:(function(re,oe,pe,Te){return re.map((Ke=>Da(Ke,oe,pe,Te)))})(F,E,P,z),ie=W?$*A:$;for(const re of v)for(const oe of re){const pe=W?oe:Da(oe,E,P,z);let Te=ie;const Ke=E.projectTileCoordinates(oe.x,oe.y,P,z).signedDistanceFromCamera;if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Te*=Ke/E.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Te*=E.cameraToCenterDistance/Ke),Ug(te,pe,Te))return!0}return!1}}function Da(l,r,o,p){const v=r.projectTileCoordinates(l.x,l.y,o,p).point;return new C((.5*v.x+.5)*r.width,(.5*-v.y+.5)*r.height)}class Ps extends yd{}let Wg;Yt("HeatmapBucket",Ps,{omit:["layers"]});var tv={get paint(){return Wg=Wg||new Cs({"heatmap-radius":new Tn($e.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Tn($e.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new an($e.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Kc($e.paint_heatmap["heatmap-color"]),"heatmap-opacity":new an($e.paint_heatmap["heatmap-opacity"])})}};function mm(l,{width:r,height:o},p,v){if(v){if(v instanceof Uint8ClampedArray)v=new Uint8Array(v.buffer);else if(v.length!==r*o*p)throw new RangeError(`mismatched image size. expected: ${v.length} but got: ${r*o*p}`)}else v=new Uint8Array(r*o*p);return l.width=r,l.height=o,l.data=v,l}function Kg(l,{width:r,height:o},p){if(r===l.width&&o===l.height)return;const v=mm({},{width:r,height:o},p);bd(l,v,{x:0,y:0},{x:0,y:0},{width:Math.min(l.width,r),height:Math.min(l.height,o)},p),l.width=r,l.height=o,l.data=v.data}function bd(l,r,o,p,v,E){if(v.width===0||v.height===0)return r;if(v.width>l.width||v.height>l.height||o.x>l.width-v.width||o.y>l.height-v.height)throw new RangeError("out of range source coordinates for image copy");if(v.width>r.width||v.height>r.height||p.x>r.width-v.width||p.y>r.height-v.height)throw new RangeError("out of range destination coordinates for image copy");const A=l.data,P=r.data;if(A===P)throw new Error("srcData equals dstData, so image is already copied");for(let z=0;z<v.height;z++){const F=((o.y+z)*l.width+o.x)*E,$=((p.y+z)*r.width+p.x)*E;for(let W=0;W<v.width*E;W++)P[$+W]=A[F+W]}return r}class of{constructor(r,o){mm(this,r,1,o)}resize(r){Kg(this,r,1)}clone(){return new of({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,o,p,v,E){bd(r,o,p,v,E,1)}}class Ms{constructor(r,o){mm(this,r,4,o)}resize(r){Kg(this,r,4)}replace(r,o){o?this.data.set(r):this.data=r instanceof Uint8ClampedArray?new Uint8Array(r.buffer):r}clone(){return new Ms({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,o,p,v,E){bd(r,o,p,v,E,4)}setPixel(r,o,p){const v=4*(r*this.width+o);this.data[v+0]=Math.round(255*p.r/p.a),this.data[v+1]=Math.round(255*p.g/p.a),this.data[v+2]=Math.round(255*p.b/p.a),this.data[v+3]=Math.round(255*p.a)}}function Xg(l){const r={},o=l.resolution||256,p=l.clips?l.clips.length:1,v=l.image||new Ms({width:o,height:p});if(Math.log(o)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${o}`);const E=(A,P,z)=>{r[l.evaluationKey]=z;const F=l.expression.evaluate(r);v.setPixel(A/4/o,P/4,F)};if(l.clips)for(let A=0,P=0;A<p;++A,P+=4*o)for(let z=0,F=0;z<o;z++,F+=4){const $=z/(o-1),{start:W,end:te}=l.clips[A];E(P,F,W*(1-$)+te*$)}else for(let A=0,P=0;A<o;A++,P+=4)E(0,P,A/(o-1));return v}Yt("AlphaImage",of),Yt("RGBAImage",Ms);const Yg="big-fb";class gm extends po{createBucket(r){return new Ps(r)}constructor(r){super(r,tv),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(r){r==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Xg({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(Yg)&&this.heatmapFbos.delete(Yg)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let _m;var nv={get paint(){return _m=_m||new Cs({"hillshade-illumination-direction":new an($e.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new an($e.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new an($e.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new an($e.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new an($e.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new an($e.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new an($e.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new an($e.paint_hillshade["hillshade-method"])})}};class iv extends po{constructor(r){super(r,nv),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let r=this.paint.get("hillshade-illumination-direction").values,o=this.paint.get("hillshade-illumination-altitude").values,p=this.paint.get("hillshade-highlight-color").values,v=this.paint.get("hillshade-shadow-color").values;const E=Math.max(r.length,o.length,p.length,v.length);r=r.concat(Array(E-r.length).fill(r.at(-1))),o=o.concat(Array(E-o.length).fill(o.at(-1))),p=p.concat(Array(E-p.length).fill(p.at(-1))),v=v.concat(Array(E-v.length).fill(v.at(-1)));const A=o.map(qr);return{directionRadians:r.map(qr),altitudeRadians:A,shadowColor:v,highlightColor:p}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}let Qg;var Jg={get paint(){return Qg=Qg||new Cs({"color-relief-opacity":new an($e["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new Kc($e["paint_color-relief"]["color-relief-color"])})}};class op{constructor(r,o,p,v){this.context=r,this.format=p,this.texture=r.gl.createTexture(),this.update(o,v)}update(r,o,p){const{width:v,height:E}=r,A=!(this.size&&this.size[0]===v&&this.size[1]===E||p),{context:P}=this,{gl:z}=P;if(this.useMipmap=!!(o&&o.useMipmap),z.bindTexture(z.TEXTURE_2D,this.texture),P.pixelStoreUnpackFlipY.set(!1),P.pixelStoreUnpack.set(1),P.pixelStoreUnpackPremultiplyAlpha.set(this.format===z.RGBA&&(!o||o.premultiply!==!1)),A)this.size=[v,E],r instanceof HTMLImageElement||r instanceof HTMLCanvasElement||r instanceof HTMLVideoElement||r instanceof ImageData||Ea(r)?z.texImage2D(z.TEXTURE_2D,0,this.format,this.format,z.UNSIGNED_BYTE,r):z.texImage2D(z.TEXTURE_2D,0,this.format,v,E,0,this.format,z.UNSIGNED_BYTE,r.data);else{const{x:F,y:$}=p||{x:0,y:0};r instanceof HTMLImageElement||r instanceof HTMLCanvasElement||r instanceof HTMLVideoElement||r instanceof ImageData||Ea(r)?z.texSubImage2D(z.TEXTURE_2D,0,F,$,z.RGBA,z.UNSIGNED_BYTE,r):z.texSubImage2D(z.TEXTURE_2D,0,F,$,v,E,z.RGBA,z.UNSIGNED_BYTE,r.data)}this.useMipmap&&this.isSizePowerOfTwo()&&z.generateMipmap(z.TEXTURE_2D),P.pixelStoreUnpackFlipY.setDefault(),P.pixelStoreUnpack.setDefault(),P.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(r,o,p){const{context:v}=this,{gl:E}=v;E.bindTexture(E.TEXTURE_2D,this.texture),p!==E.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(p=E.LINEAR),r!==this.filter&&(E.texParameteri(E.TEXTURE_2D,E.TEXTURE_MAG_FILTER,r),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_MIN_FILTER,p||r),this.filter=r),o!==this.wrap&&(E.texParameteri(E.TEXTURE_2D,E.TEXTURE_WRAP_S,o),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_WRAP_T,o),this.wrap=o)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:r}=this.context;r.deleteTexture(this.texture),this.texture=null}}class ym{constructor(r,o,p,v=1,E=1,A=1,P=0){if(this.uid=r,o.height!==o.width)throw new RangeError("DEM tiles must be square");if(p&&!["mapbox","terrarium","custom"].includes(p))return void Mi(`"${p}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=o.height;const z=this.dim=o.height-2;switch(this.data=new Uint32Array(o.data.buffer),p){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=v,this.greenFactor=E,this.blueFactor=A,this.baseShift=P;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let F=0;F<z;F++)this.data[this._idx(-1,F)]=this.data[this._idx(0,F)],this.data[this._idx(z,F)]=this.data[this._idx(z-1,F)],this.data[this._idx(F,-1)]=this.data[this._idx(F,0)],this.data[this._idx(F,z)]=this.data[this._idx(F,z-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(z,-1)]=this.data[this._idx(z-1,0)],this.data[this._idx(-1,z)]=this.data[this._idx(0,z-1)],this.data[this._idx(z,z)]=this.data[this._idx(z-1,z-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let F=0;F<z;F++)for(let $=0;$<z;$++){const W=this.get(F,$);W>this.max&&(this.max=W),W<this.min&&(this.min=W)}}get(r,o){const p=new Uint8Array(this.data.buffer),v=4*this._idx(r,o);return this.unpack(p[v],p[v+1],p[v+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(r,o){if(r<-1||r>=this.dim+1||o<-1||o>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(o+1)*this.stride+(r+1)}unpack(r,o,p){return r*this.redFactor+o*this.greenFactor+p*this.blueFactor-this.baseShift}pack(r){return e_(r,this.getUnpackVector())}getPixels(){return new Ms({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(r,o,p){if(this.dim!==r.dim)throw new Error("dem dimension mismatch");let v=o*this.dim,E=o*this.dim+this.dim,A=p*this.dim,P=p*this.dim+this.dim;switch(o){case-1:v=E-1;break;case 1:E=v+1}switch(p){case-1:A=P-1;break;case 1:P=A+1}const z=-o*this.dim,F=-p*this.dim;for(let $=A;$<P;$++)for(let W=v;W<E;W++)this.data[this._idx(W,$)]=r.data[this._idx(W+z,$+F)]}}function e_(l,r){const o=r[0],p=r[1],v=r[2],E=r[3],A=Math.min(o,p,v),P=Math.round((l+E)/A);return{r:Math.floor(P*A/o)%256,g:Math.floor(P*A/p)%256,b:Math.floor(P*A/v)%256}}Yt("DEMData",ym);class t_ extends po{constructor(r){super(r,Jg)}_createColorRamp(r){const o={elevationStops:[],colorStops:[]},p=this._transitionablePaint._values["color-relief-color"].value.expression;if(p instanceof f&&p._styleExpression.expression instanceof lr){this.colorRampExpression=p;const A=p._styleExpression.expression;o.elevationStops=A.labels,o.colorStops=[];for(const P of o.elevationStops)o.colorStops.push(A.evaluate({globals:{elevation:P}}))}if(o.elevationStops.length<1&&(o.elevationStops=[0],o.colorStops=[kn.transparent]),o.elevationStops.length<2&&(o.elevationStops.push(o.elevationStops[0]+1),o.colorStops.push(o.colorStops[0])),o.elevationStops.length<=r)return o;const v={elevationStops:[],colorStops:[]},E=(o.elevationStops.length-1)/(r-1);for(let A=0;A<o.elevationStops.length-.5;A+=E)v.elevationStops.push(o.elevationStops[Math.round(A)]),v.colorStops.push(o.colorStops[Math.round(A)]);return Mi(`Too many colors in specification of ${this.id} color-relief layer, may not render properly.`),v}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(r,o,p){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const v=this._createColorRamp(o),E=new Ms({width:v.colorStops.length,height:1}),A=new Ms({width:v.colorStops.length,height:1});for(let P=0;P<v.elevationStops.length;P++){const z=e_(v.elevationStops[P],p);A.setPixel(0,P,new kn(z.r/255,z.g/255,z.b/255,1)),E.setPixel(0,P,v.colorStops[P])}return this.colorRampTextures={elevationTexture:new op(r,A,r.gl.RGBA),colorTexture:new op(r,E,r.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return this.visibility!=="none"&&!!this.colorRampTextures}}const vm=Br([{name:"a_pos",components:2,type:"Int16"}],4),{members:n_}=vm;function bm(l,r,o){const p=o.patternDependencies;let v=!1;for(const E of r){const A=E.paint.get(`${l}-pattern`);A.isConstant()||(v=!0);const P=A.constantOr(null);P&&(v=!0,p[P.to]=!0,p[P.from]=!0)}return v}function lp(l,r,o,p,v){const E=v.patternDependencies;for(const A of r){const P=A.paint.get(`${l}-pattern`).value;if(P.kind!=="constant"){let z=P.evaluate({zoom:p-1},o,{},v.availableImages),F=P.evaluate({zoom:p},o,{},v.availableImages),$=P.evaluate({zoom:p+1},o,{},v.availableImages);z=z&&z.name?z.name:z,F=F&&F.name?F.name:F,$=$&&$.name?$.name:$,E[z]=!0,E[F]=!0,E[$]=!0,o.patterns[A.id]={min:z,mid:F,max:$}}}return o}function i_(l,r,o,p,v){let E;if(v===(function(A,P,z,F){let $=0;for(let W=P,te=z-F;W<z;W+=F)$+=(A[te]-A[W])*(A[W+1]+A[te+1]),te=W;return $})(l,r,o,p)>0)for(let A=r;A<o;A+=p)E=s_(A/p|0,l[A],l[A+1],E);else for(let A=o-p;A>=r;A-=p)E=s_(A/p|0,l[A],l[A+1],E);return E&&wd(E,E.next)&&(Td(E),E=E.next),E}function Ho(l,r){if(!l)return l;r||(r=l);let o,p=l;do if(o=!1,p.steiner||!wd(p,p.next)&&hr(p.prev,p,p.next)!==0)p=p.next;else{if(Td(p),p=r=p.prev,p===p.next)break;o=!0}while(o||p!==r);return r}function xd(l,r,o,p,v,E,A){if(!l)return;!A&&E&&(function(z,F,$,W){let te=z;do te.z===0&&(te.z=Rr(te.x,te.y,F,$,W)),te.prevZ=te.prev,te.nextZ=te.next,te=te.next;while(te!==z);te.prevZ.nextZ=null,te.prevZ=null,(function(ie){let re,oe=1;do{let pe,Te=ie;ie=null;let Ke=null;for(re=0;Te;){re++;let ke=Te,Fe=0;for(let gt=0;gt<oe&&(Fe++,ke=ke.nextZ,ke);gt++);let ot=oe;for(;Fe>0||ot>0&&ke;)Fe!==0&&(ot===0||!ke||Te.z<=ke.z)?(pe=Te,Te=Te.nextZ,Fe--):(pe=ke,ke=ke.nextZ,ot--),Ke?Ke.nextZ=pe:ie=pe,pe.prevZ=Ke,Ke=pe;Te=ke}Ke.nextZ=null,oe*=2}while(re>1)})(te)})(l,p,v,E);let P=l;for(;l.prev!==l.next;){const z=l.prev,F=l.next;if(E?rv(l,p,v,E):tx(l))r.push(z.i,l.i,F.i),Td(l),l=F.next,P=F.next;else if((l=F)===P){A?A===1?xd(l=Yc(Ho(l),r),r,o,p,v,E,2):A===2&&r_(l,r,o,p,v,E):xd(Ho(l),r,o,p,v,E,1);break}}}function tx(l){const r=l.prev,o=l,p=l.next;if(hr(r,o,p)>=0)return!1;const v=r.x,E=o.x,A=p.x,P=r.y,z=o.y,F=p.y,$=Math.min(v,E,A),W=Math.min(P,z,F),te=Math.max(v,E,A),ie=Math.max(P,z,F);let re=p.next;for(;re!==r;){if(re.x>=$&&re.x<=te&&re.y>=W&&re.y<=ie&&lf(v,P,E,z,A,F,re.x,re.y)&&hr(re.prev,re,re.next)>=0)return!1;re=re.next}return!0}function rv(l,r,o,p){const v=l.prev,E=l,A=l.next;if(hr(v,E,A)>=0)return!1;const P=v.x,z=E.x,F=A.x,$=v.y,W=E.y,te=A.y,ie=Math.min(P,z,F),re=Math.min($,W,te),oe=Math.max(P,z,F),pe=Math.max($,W,te),Te=Rr(ie,re,r,o,p),Ke=Rr(oe,pe,r,o,p);let ke=l.prevZ,Fe=l.nextZ;for(;ke&&ke.z>=Te&&Fe&&Fe.z<=Ke;){if(ke.x>=ie&&ke.x<=oe&&ke.y>=re&&ke.y<=pe&&ke!==v&&ke!==A&&lf(P,$,z,W,F,te,ke.x,ke.y)&&hr(ke.prev,ke,ke.next)>=0||(ke=ke.prevZ,Fe.x>=ie&&Fe.x<=oe&&Fe.y>=re&&Fe.y<=pe&&Fe!==v&&Fe!==A&&lf(P,$,z,W,F,te,Fe.x,Fe.y)&&hr(Fe.prev,Fe,Fe.next)>=0))return!1;Fe=Fe.nextZ}for(;ke&&ke.z>=Te;){if(ke.x>=ie&&ke.x<=oe&&ke.y>=re&&ke.y<=pe&&ke!==v&&ke!==A&&lf(P,$,z,W,F,te,ke.x,ke.y)&&hr(ke.prev,ke,ke.next)>=0)return!1;ke=ke.prevZ}for(;Fe&&Fe.z<=Ke;){if(Fe.x>=ie&&Fe.x<=oe&&Fe.y>=re&&Fe.y<=pe&&Fe!==v&&Fe!==A&&lf(P,$,z,W,F,te,Fe.x,Fe.y)&&hr(Fe.prev,Fe,Fe.next)>=0)return!1;Fe=Fe.nextZ}return!0}function Yc(l,r){let o=l;do{const p=o.prev,v=o.next.next;!wd(p,v)&&a_(p,o,o.next,v)&&uf(p,v)&&uf(v,p)&&(r.push(p.i,o.i,v.i),Td(o),Td(o.next),o=l=v),o=o.next}while(o!==l);return Ho(o)}function r_(l,r,o,p,v,E){let A=l;do{let P=A.next.next;for(;P!==A.prev;){if(A.i!==P.i&&cp(A,P)){let z=wm(A,P);return A=Ho(A,A.next),z=Ho(z,z.next),xd(A,r,o,p,v,E,0),void xd(z,r,o,p,v,E,0)}P=P.next}A=A.next}while(A!==l)}function av(l,r){let o=l.x-r.x;return o===0&&(o=l.y-r.y,o===0)&&(o=(l.next.y-l.y)/(l.next.x-l.x)-(r.next.y-r.y)/(r.next.x-r.x)),o}function xm(l,r){const o=(function(v,E){let A=E;const P=v.x,z=v.y;let F,$=-1/0;if(wd(v,A))return A;do{if(wd(v,A.next))return A.next;if(z<=A.y&&z>=A.next.y&&A.next.y!==A.y){const oe=A.x+(z-A.y)*(A.next.x-A.x)/(A.next.y-A.y);if(oe<=P&&oe>$&&($=oe,F=A.x<A.next.x?A:A.next,oe===P))return F}A=A.next}while(A!==E);if(!F)return null;const W=F,te=F.x,ie=F.y;let re=1/0;A=F;do{if(P>=A.x&&A.x>=te&&P!==A.x&&sv(z<ie?P:$,z,te,ie,z<ie?$:P,z,A.x,A.y)){const oe=Math.abs(z-A.y)/(P-A.x);uf(A,v)&&(oe<re||oe===re&&(A.x>F.x||A.x===F.x&&up(F,A)))&&(F=A,re=oe)}A=A.next}while(A!==W);return F})(l,r);if(!o)return r;const p=wm(o,l);return Ho(p,p.next),Ho(o,o.next)}function up(l,r){return hr(l.prev,l,r.prev)<0&&hr(r.next,l,l.next)<0}function Rr(l,r,o,p,v){return(l=1431655765&((l=858993459&((l=252645135&((l=16711935&((l=(l-o)*v|0)|l<<8))|l<<4))|l<<2))|l<<1))|(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-p)*v|0)|r<<8))|r<<4))|r<<2))|r<<1))<<1}function nx(l){let r=l,o=l;do(r.x<o.x||r.x===o.x&&r.y<o.y)&&(o=r),r=r.next;while(r!==l);return o}function sv(l,r,o,p,v,E,A,P){return(v-A)*(r-P)>=(l-A)*(E-P)&&(l-A)*(p-P)>=(o-A)*(r-P)&&(o-A)*(E-P)>=(v-A)*(p-P)}function lf(l,r,o,p,v,E,A,P){return!(l===A&&r===P)&&sv(l,r,o,p,v,E,A,P)}function cp(l,r){return l.next.i!==r.i&&l.prev.i!==r.i&&!(function(o,p){let v=o;do{if(v.i!==o.i&&v.next.i!==o.i&&v.i!==p.i&&v.next.i!==p.i&&a_(v,v.next,o,p))return!0;v=v.next}while(v!==o);return!1})(l,r)&&(uf(l,r)&&uf(r,l)&&(function(o,p){let v=o,E=!1;const A=(o.x+p.x)/2,P=(o.y+p.y)/2;do v.y>P!=v.next.y>P&&v.next.y!==v.y&&A<(v.next.x-v.x)*(P-v.y)/(v.next.y-v.y)+v.x&&(E=!E),v=v.next;while(v!==o);return E})(l,r)&&(hr(l.prev,l,r.prev)||hr(l,r.prev,r))||wd(l,r)&&hr(l.prev,l,l.next)>0&&hr(r.prev,r,r.next)>0)}function hr(l,r,o){return(r.y-l.y)*(o.x-r.x)-(r.x-l.x)*(o.y-r.y)}function wd(l,r){return l.x===r.x&&l.y===r.y}function a_(l,r,o,p){const v=Ul(hr(l,r,o)),E=Ul(hr(l,r,p)),A=Ul(hr(o,p,l)),P=Ul(hr(o,p,r));return v!==E&&A!==P||!(v!==0||!kh(l,o,r))||!(E!==0||!kh(l,p,r))||!(A!==0||!kh(o,l,p))||!(P!==0||!kh(o,r,p))}function kh(l,r,o){return r.x<=Math.max(l.x,o.x)&&r.x>=Math.min(l.x,o.x)&&r.y<=Math.max(l.y,o.y)&&r.y>=Math.min(l.y,o.y)}function Ul(l){return l>0?1:l<0?-1:0}function uf(l,r){return hr(l.prev,l,l.next)<0?hr(l,r,l.next)>=0&&hr(l,l.prev,r)>=0:hr(l,r,l.prev)<0||hr(l,l.next,r)<0}function wm(l,r){const o=hp(l.i,l.x,l.y),p=hp(r.i,r.x,r.y),v=l.next,E=r.prev;return l.next=r,r.prev=l,o.next=v,v.prev=o,p.next=o,o.prev=p,E.next=p,p.prev=E,p}function s_(l,r,o,p){const v=hp(l,r,o);return p?(v.next=p.next,v.prev=p,p.next.prev=v,p.next=v):(v.prev=v,v.next=v),v}function Td(l){l.next.prev=l.prev,l.prev.next=l.next,l.prevZ&&(l.prevZ.nextZ=l.nextZ),l.nextZ&&(l.nextZ.prevZ=l.prevZ)}function hp(l,r,o){return{i:l,x:r,y:o,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class Qc{constructor(r,o){if(o>r)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=r,this._minGranularity=o}getGranularityForZoomLevel(r){return Math.max(Math.floor(this._baseZoomGranularity/(1<<r)),this._minGranularity,1)}}class dp{constructor(r){this.fill=r.fill,this.line=r.line,this.tile=r.tile,this.stencil=r.stencil,this.circle=r.circle}}dp.noSubdivision=new dp({fill:new Qc(0,0),line:new Qc(0,0),tile:new Qc(0,0),stencil:new Qc(0,0),circle:1}),Yt("SubdivisionGranularityExpression",Qc),Yt("SubdivisionGranularitySetting",dp);const Tl=-32768,Jr=32767;class o_{constructor(r,o){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=r,this._granularityCellSize=zt/r,this._canonical=o}_getKey(r,o){return(r+=32768)<<16|o+32768}_vertexToIndex(r,o){if(r<-32768||o<-32768||r>32767||o>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const p=0|Math.round(r),v=0|Math.round(o),E=this._getKey(p,v);if(this._vertexDictionary.has(E))return this._vertexDictionary.get(E);const A=this._vertexBuffer.length/2;return this._vertexDictionary.set(E,A),this._vertexBuffer.push(p,v),A}_subdivideTrianglesScanline(r){if(this._granularity<2)return(function(v,E){const A=[];for(let P=0;P<E.length;P+=3){const z=E[P],F=E[P+1],$=E[P+2],W=v[2*z],te=v[2*z+1];(v[2*F]-W)*(v[2*$+1]-te)-(v[2*F+1]-te)*(v[2*$]-W)>0?(A.push(z),A.push($),A.push(F)):(A.push(z),A.push(F),A.push($))}return A})(this._vertexBuffer,r);const o=[],p=r.length;for(let v=0;v<p;v+=3){const E=[r[v+0],r[v+1],r[v+2]],A=[this._vertexBuffer[2*r[v+0]+0],this._vertexBuffer[2*r[v+0]+1],this._vertexBuffer[2*r[v+1]+0],this._vertexBuffer[2*r[v+1]+1],this._vertexBuffer[2*r[v+2]+0],this._vertexBuffer[2*r[v+2]+1]];let P=1/0,z=1/0,F=-1/0,$=-1/0;for(let oe=0;oe<3;oe++){const pe=A[2*oe],Te=A[2*oe+1];P=Math.min(P,pe),F=Math.max(F,pe),z=Math.min(z,Te),$=Math.max($,Te)}if(P===F||z===$)continue;const W=Math.floor(P/this._granularityCellSize),te=Math.ceil(F/this._granularityCellSize),ie=Math.floor(z/this._granularityCellSize),re=Math.ceil($/this._granularityCellSize);if(W!==te||ie!==re)for(let oe=ie;oe<re;oe++){const pe=this._scanlineGenerateVertexRingForCellRow(oe,A,E);ix(this._vertexBuffer,pe,o)}else o.push(...E)}return o}_scanlineGenerateVertexRingForCellRow(r,o,p){const v=r*this._granularityCellSize,E=v+this._granularityCellSize,A=[];for(let P=0;P<3;P++){const z=o[2*P],F=o[2*P+1],$=o[2*(P+1)%6],W=o[(2*(P+1)+1)%6],te=o[2*(P+2)%6],ie=o[(2*(P+2)+1)%6],re=$-z,oe=W-F,pe=re===0,Te=oe===0,Ke=(v-F)/oe,ke=(E-F)/oe,Fe=Math.min(Ke,ke),ot=Math.max(Ke,ke);if(!Te&&(Fe>=1||ot<=0)||Te&&(F<v||F>E)){W>=v&&W<=E&&A.push(p[(P+1)%3]);continue}!Te&&Fe>0&&A.push(this._vertexToIndex(z+re*Fe,F+oe*Fe));const gt=z+re*Math.max(Fe,0),Ct=z+re*Math.min(ot,1);pe||this._generateIntraEdgeVertices(A,z,F,$,W,gt,Ct),!Te&&ot<1&&A.push(this._vertexToIndex(z+re*ot,F+oe*ot)),(Te||W>=v&&W<=E)&&A.push(p[(P+1)%3]),!Te&&(W<=v||W>=E)&&this._generateInterEdgeVertices(A,z,F,$,W,te,ie,Ct,v,E)}return A}_generateIntraEdgeVertices(r,o,p,v,E,A,P){const z=v-o,F=E-p,$=F===0,W=$?Math.min(o,v):Math.min(A,P),te=$?Math.max(o,v):Math.max(A,P),ie=Math.floor(W/this._granularityCellSize)+1,re=Math.ceil(te/this._granularityCellSize)-1;if($?o<v:A<P)for(let oe=ie;oe<=re;oe++){const pe=oe*this._granularityCellSize;r.push(this._vertexToIndex(pe,p+F*(pe-o)/z))}else for(let oe=re;oe>=ie;oe--){const pe=oe*this._granularityCellSize;r.push(this._vertexToIndex(pe,p+F*(pe-o)/z))}}_generateInterEdgeVertices(r,o,p,v,E,A,P,z,F,$){const W=E-p,te=A-v,ie=P-E,re=(F-E)/ie,oe=($-E)/ie,pe=Math.min(re,oe),Te=Math.max(re,oe),Ke=v+te*pe;let ke=Math.floor(Math.min(Ke,z)/this._granularityCellSize)+1,Fe=Math.ceil(Math.max(Ke,z)/this._granularityCellSize)-1,ot=z<Ke;const gt=ie===0;if(gt&&(P===F||P===$))return;if(gt||pe>=1||Te<=0){const Gt=p-P,Ft=A+(o-A)*Math.min((F-P)/Gt,($-P)/Gt);ke=Math.floor(Math.min(Ft,z)/this._granularityCellSize)+1,Fe=Math.ceil(Math.max(Ft,z)/this._granularityCellSize)-1,ot=z<Ft}const Ct=W>0?$:F;if(ot)for(let Gt=ke;Gt<=Fe;Gt++)r.push(this._vertexToIndex(Gt*this._granularityCellSize,Ct));else for(let Gt=Fe;Gt>=ke;Gt--)r.push(this._vertexToIndex(Gt*this._granularityCellSize,Ct))}_generateOutline(r){const o=[];for(const p of r){const v=ea(p,this._granularity,!0),E=this._pointArrayToIndices(v),A=[];for(let P=1;P<E.length;P++)A.push(E[P-1]),A.push(E[P]);o.push(A)}return o}_handlePoles(r){let o=!1,p=!1;this._canonical&&(this._canonical.y===0&&(o=!0),this._canonical.y===(1<<this._canonical.z)-1&&(p=!0)),(o||p)&&this._fillPoles(r,o,p)}_ensureNoPoleVertices(){const r=this._vertexBuffer;for(let o=0;o<r.length;o+=2){const p=r[o+1];p===Tl&&(r[o+1]=-32767),p===Jr&&(r[o+1]=32766)}}_generatePoleQuad(r,o,p,v,E,A){v>E!=(A===Tl)?(r.push(o),r.push(p),r.push(this._vertexToIndex(v,A)),r.push(p),r.push(this._vertexToIndex(E,A)),r.push(this._vertexToIndex(v,A))):(r.push(p),r.push(o),r.push(this._vertexToIndex(v,A)),r.push(this._vertexToIndex(E,A)),r.push(p),r.push(this._vertexToIndex(v,A)))}_fillPoles(r,o,p){const v=this._vertexBuffer,E=zt,A=r.length;for(let P=2;P<A;P+=3){const z=r[P-2],F=r[P-1],$=r[P],W=v[2*z],te=v[2*z+1],ie=v[2*F],re=v[2*F+1],oe=v[2*$],pe=v[2*$+1];o&&(te===0&&re===0&&this._generatePoleQuad(r,z,F,W,ie,Tl),re===0&&pe===0&&this._generatePoleQuad(r,F,$,ie,oe,Tl),pe===0&&te===0&&this._generatePoleQuad(r,$,z,oe,W,Tl)),p&&(te===E&&re===E&&this._generatePoleQuad(r,z,F,W,ie,Jr),re===E&&pe===E&&this._generatePoleQuad(r,F,$,ie,oe,Jr),pe===E&&te===E&&this._generatePoleQuad(r,$,z,oe,W,Jr))}}_initializeVertices(r){for(let o=0;o<r.length;o+=2)this._vertexToIndex(r[o],r[o+1])}subdividePolygonInternal(r,o){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:p,holeIndices:v}=(function(P){const z=[],F=[];for(const $ of P)if($.length!==0){$!==P[0]&&z.push(F.length/2);for(let W=0;W<$.length;W++)F.push($[W].x),F.push($[W].y)}return{flattened:F,holeIndices:z}})(r);let E;this._initializeVertices(p);try{const P=(function(F,$,W=2){const te=$&&$.length,ie=te?$[0]*W:F.length;let re=i_(F,0,ie,W,!0);const oe=[];if(!re||re.next===re.prev)return oe;let pe,Te,Ke;if(te&&(re=(function(ke,Fe,ot,gt){const Ct=[];for(let Gt=0,Ft=Fe.length;Gt<Ft;Gt++){const Ht=i_(ke,Fe[Gt]*gt,Gt<Ft-1?Fe[Gt+1]*gt:ke.length,gt,!1);Ht===Ht.next&&(Ht.steiner=!0),Ct.push(nx(Ht))}Ct.sort(av);for(let Gt=0;Gt<Ct.length;Gt++)ot=xm(Ct[Gt],ot);return ot})(F,$,re,W)),F.length>80*W){pe=F[0],Te=F[1];let ke=pe,Fe=Te;for(let ot=W;ot<ie;ot+=W){const gt=F[ot],Ct=F[ot+1];gt<pe&&(pe=gt),Ct<Te&&(Te=Ct),gt>ke&&(ke=gt),Ct>Fe&&(Fe=Ct)}Ke=Math.max(ke-pe,Fe-Te),Ke=Ke!==0?32767/Ke:0}return xd(re,oe,W,pe,Te,Ke,0),oe})(p,v),z=this._convertIndices(p,P);E=this._subdivideTrianglesScanline(z)}catch(P){console.error(P)}let A=[];return o&&(A=this._generateOutline(r)),this._ensureNoPoleVertices(),this._handlePoles(E),{verticesFlattened:this._vertexBuffer,indicesTriangles:E,indicesLineList:A}}_convertIndices(r,o){const p=[];for(let v=0;v<o.length;v++)p.push(this._vertexToIndex(r[2*o[v]],r[2*o[v]+1]));return p}_pointArrayToIndices(r){const o=[];for(let p=0;p<r.length;p++){const v=r[p];o.push(this._vertexToIndex(v.x,v.y))}return o}}function l_(l,r,o,p=!0){return new o_(o,r).subdividePolygonInternal(l,p)}function ea(l,r,o=!1){if(!l||l.length<1)return[];if(l.length<2)return[];const p=l[0],v=l[l.length-1],E=o&&(p.x!==v.x||p.y!==v.y);if(r<2)return E?[...l,l[0]]:[...l];const A=Math.floor(zt/r),P=[];P.push(new C(l[0].x,l[0].y));const z=l.length,F=E?z:z-1;for(let $=0;$<F;$++){const W=l[$],te=$<z-1?l[$+1]:l[0],ie=W.x,re=W.y,oe=te.x,pe=te.y,Te=ie!==oe,Ke=re!==pe;if(!Te&&!Ke)continue;const ke=oe-ie,Fe=pe-re,ot=Math.abs(ke),gt=Math.abs(Fe);let Ct=ie,Gt=re;for(;;){const Ht=ke>0?(Math.floor(Ct/A)+1)*A:(Math.ceil(Ct/A)-1)*A,dn=Fe>0?(Math.floor(Gt/A)+1)*A:(Math.ceil(Gt/A)-1)*A,qt=Math.abs(Ct-Ht),jt=Math.abs(Gt-dn),St=Math.abs(Ct-oe),Sn=Math.abs(Gt-pe),Mn=Te?qt/ot:Number.POSITIVE_INFINITY,mn=Ke?jt/gt:Number.POSITIVE_INFINITY;if((St<=qt||!Te)&&(Sn<=jt||!Ke))break;if(Mn<mn&&Te||!Ke){Ct=Ht,Gt+=Fe*Mn;const un=new C(Ct,Math.round(Gt));P[P.length-1].x===un.x&&P[P.length-1].y===un.y||P.push(un)}else{Ct+=ke*mn,Gt=dn;const un=new C(Math.round(Ct),Gt);P[P.length-1].x===un.x&&P[P.length-1].y===un.y||P.push(un)}}const Ft=new C(oe,pe);P[P.length-1].x===Ft.x&&P[P.length-1].y===Ft.y||P.push(Ft)}return P}function ix(l,r,o){if(r.length===0)throw new Error("Subdivision vertex ring is empty.");let p=0,v=l[2*r[0]];for(let z=1;z<r.length;z++){const F=l[2*r[z]];F<v&&(v=F,p=z)}const E=r.length;let A=p,P=(A+1)%E;for(;;){const z=A-1>=0?A-1:E-1,F=(P+1)%E,$=l[2*r[z]],W=l[2*r[F]],te=l[2*r[A]],ie=l[2*r[A]+1],re=l[2*r[P]+1];let oe=!1;if($<W)oe=!0;else if($>W)oe=!1;else{const pe=re-ie,Te=-(l[2*r[P]]-te),Ke=ie<re?1:-1;(($-te)*pe+(l[2*r[z]+1]-ie)*Te)*Ke>((W-te)*pe+(l[2*r[F]+1]-ie)*Te)*Ke&&(oe=!0)}if(oe){const pe=r[z],Te=r[A],Ke=r[P];pe!==Te&&pe!==Ke&&Te!==Ke&&o.push(Ke,Te,pe),A--,A<0&&(A=E-1)}else{const pe=r[F],Te=r[A],Ke=r[P];pe!==Te&&pe!==Ke&&Te!==Ke&&o.push(Ke,Te,pe),P++,P>=E&&(P=0)}if(z===F)break}}function u_(l,r,o,p,v,E,A,P,z){const F=v.length/2,$=A&&P&&z;if(F<jn.MAX_VERTEX_ARRAY_LENGTH){const W=r.prepareSegment(F,o,p),te=W.vertexLength;for(let oe=0;oe<E.length;oe+=3)p.emplaceBack(te+E[oe],te+E[oe+1],te+E[oe+2]);let ie,re;W.vertexLength+=F,W.primitiveLength+=E.length/3,$&&(re=A.prepareSegment(F,o,P),ie=re.vertexLength,re.vertexLength+=F);for(let oe=0;oe<v.length;oe+=2)l(v[oe],v[oe+1]);if($)for(let oe=0;oe<z.length;oe++){const pe=z[oe];for(let Te=1;Te<pe.length;Te+=2)P.emplaceBack(ie+pe[Te-1],ie+pe[Te]);re.primitiveLength+=pe.length/2}}else(function(W,te,ie,re,oe,pe){const Te=[];for(let gt=0;gt<re.length/2;gt++)Te.push(-1);const Ke={count:0};let ke=0,Fe=W.getOrCreateLatestSegment(te,ie),ot=Fe.vertexLength;for(let gt=2;gt<oe.length;gt+=3){const Ct=oe[gt-2],Gt=oe[gt-1],Ft=oe[gt];let Ht=Te[Ct]<ke,dn=Te[Gt]<ke,qt=Te[Ft]<ke;Fe.vertexLength+((Ht?1:0)+(dn?1:0)+(qt?1:0))>jn.MAX_VERTEX_ARRAY_LENGTH&&(Fe=W.createNewSegment(te,ie),ke=Ke.count,Ht=!0,dn=!0,qt=!0,ot=0);const jt=cf(Te,re,pe,Ke,Ct,Ht,Fe),St=cf(Te,re,pe,Ke,Gt,dn,Fe),Sn=cf(Te,re,pe,Ke,Ft,qt,Fe);ie.emplaceBack(ot+jt-ke,ot+St-ke,ot+Sn-ke),Fe.primitiveLength++}})(r,o,p,v,E,l),$&&(function(W,te,ie,re,oe,pe){const Te=[];for(let gt=0;gt<re.length/2;gt++)Te.push(-1);const Ke={count:0};let ke=0,Fe=W.getOrCreateLatestSegment(te,ie),ot=Fe.vertexLength;for(let gt=0;gt<oe.length;gt++){const Ct=oe[gt];for(let Gt=1;Gt<oe[gt].length;Gt+=2){const Ft=Ct[Gt-1],Ht=Ct[Gt];let dn=Te[Ft]<ke,qt=Te[Ht]<ke;Fe.vertexLength+((dn?1:0)+(qt?1:0))>jn.MAX_VERTEX_ARRAY_LENGTH&&(Fe=W.createNewSegment(te,ie),ke=Ke.count,dn=!0,qt=!0,ot=0);const jt=cf(Te,re,pe,Ke,Ft,dn,Fe),St=cf(Te,re,pe,Ke,Ht,qt,Fe);ie.emplaceBack(ot+jt-ke,ot+St-ke),Fe.primitiveLength++}}})(A,o,P,v,z,l),r.forceNewSegmentOnNextPrepare(),A==null||A.forceNewSegmentOnNextPrepare()}function cf(l,r,o,p,v,E,A){if(E){const P=p.count;return o(r[2*v],r[2*v+1]),l[v]=p.count,p.count++,A.vertexLength++,P}return l[v]}class Ur{constructor(r){this.zoom=r.zoom,this.globalState=r.globalState,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map((o=>o.id)),this.index=r.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ct,this.indexArray=new Yi,this.indexArray2=new $i,this.programConfigurations=new go(r.layers,r.zoom),this.segments=new jn,this.segments2=new jn,this.stateDependentLayerIds=this.layers.filter((o=>o.isStateDependent())).map((o=>o.id))}populate(r,o,p){this.hasPattern=bm("fill",this.layers,o);const v=this.layers[0].layout.get("fill-sort-key"),E=!v.isConstant(),A=[];for(const{feature:P,id:z,index:F,sourceLayerIndex:$}of r){const W=this.layers[0]._featureFilter.needGeometry,te=wl(P,W);if(!this.layers[0]._featureFilter.filter(new Di(this.zoom,{globalState:this.globalState}),te,p))continue;const ie=E?v.evaluate(te,{},p,o.availableImages):void 0,re={id:z,properties:P.properties,type:P.type,sourceLayerIndex:$,index:F,geometry:W?te.geometry:uu(P),patterns:{},sortKey:ie};A.push(re)}E&&A.sort(((P,z)=>P.sortKey-z.sortKey));for(const P of A){const{geometry:z,index:F,sourceLayerIndex:$}=P;if(this.hasPattern){const W=lp("fill",this.layers,P,this.zoom,o);this.patternFeatures.push(W)}else this.addFeature(P,z,F,p,{},o.subdivisionGranularity);o.featureIndex.insert(r[F].feature,z,F,$,this.index)}}update(r,o,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,o,this.stateDependentLayers,p)}addFeatures(r,o,p){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,o,p,r.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,n_),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.indexBuffer2=r.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(r,o,p,v,E,A){for(const P of Ju(o,500)){const z=l_(P,v,A.fill.getGranularityForZoomLevel(v.z)),F=this.layoutVertexArray;u_((($,W)=>{F.emplaceBack($,W)}),this.segments,this.layoutVertexArray,this.indexArray,z.verticesFlattened,z.indicesTriangles,this.segments2,this.indexArray2,z.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,p,E,v)}}let Zo,wc;Yt("FillBucket",Ur,{omit:["layers","patternFeatures"]});var ov={get paint(){return wc=wc||new Cs({"fill-antialias":new an($e.paint_fill["fill-antialias"]),"fill-opacity":new Tn($e.paint_fill["fill-opacity"]),"fill-color":new Tn($e.paint_fill["fill-color"]),"fill-outline-color":new Tn($e.paint_fill["fill-outline-color"]),"fill-translate":new an($e.paint_fill["fill-translate"]),"fill-translate-anchor":new an($e.paint_fill["fill-translate-anchor"]),"fill-pattern":new pd($e.paint_fill["fill-pattern"])})},get layout(){return Zo=Zo||new Cs({"fill-sort-key":new Tn($e.layout_fill["fill-sort-key"])})}};class lv extends po{constructor(r){super(r,ov)}recalculate(r,o){super.recalculate(r,o);const p=this.paint._values["fill-outline-color"];p.value.kind==="constant"&&p.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(r){return new Ur(r)}queryRadius(){return sp(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:r,geometry:o,transform:p,pixelsToTileUnits:v}){return jg(sf(r,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-p.bearingInRadians,v),o)}isTileClipped(){return!0}}const uv=Br([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),rx=Br([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Tm}=uv;class ls{constructor(r,o,p,v,E){this.properties={},this.extent=p,this.type=0,this.id=void 0,this._pbf=r,this._geometry=-1,this._keys=v,this._values=E,r.readFields(Lu,this,o)}loadGeometry(){const r=this._pbf;r.pos=this._geometry;const o=r.readVarint()+r.pos,p=[];let v,E=1,A=0,P=0,z=0;for(;r.pos<o;){if(A<=0){const F=r.readVarint();E=7&F,A=F>>3}if(A--,E===1||E===2)P+=r.readSVarint(),z+=r.readSVarint(),E===1&&(v&&p.push(v),v=[]),v&&v.push(new C(P,z));else{if(E!==7)throw new Error(`unknown command ${E}`);v&&v.push(v[0].clone())}}return v&&p.push(v),p}bbox(){const r=this._pbf;r.pos=this._geometry;const o=r.readVarint()+r.pos;let p=1,v=0,E=0,A=0,P=1/0,z=-1/0,F=1/0,$=-1/0;for(;r.pos<o;){if(v<=0){const W=r.readVarint();p=7&W,v=W>>3}if(v--,p===1||p===2)E+=r.readSVarint(),A+=r.readSVarint(),E<P&&(P=E),E>z&&(z=E),A<F&&(F=A),A>$&&($=A);else if(p!==7)throw new Error(`unknown command ${p}`)}return[P,F,z,$]}toGeoJSON(r,o,p){const v=this.extent*Math.pow(2,p),E=this.extent*r,A=this.extent*o,P=this.loadGeometry();function z(te){return[360*(te.x+E)/v-180,360/Math.PI*Math.atan(Math.exp((1-2*(te.y+A)/v)*Math.PI))-90]}function F(te){return te.map(z)}let $;if(this.type===1){const te=[];for(const re of P)te.push(re[0]);const ie=F(te);$=te.length===1?{type:"Point",coordinates:ie[0]}:{type:"MultiPoint",coordinates:ie}}else if(this.type===2){const te=P.map(F);$=te.length===1?{type:"LineString",coordinates:te[0]}:{type:"MultiLineString",coordinates:te}}else{if(this.type!==3)throw new Error("unknown feature type");{const te=(function(re){const oe=re.length;if(oe<=1)return[re];const pe=[];let Te,Ke;for(let ke=0;ke<oe;ke++){const Fe=cv(re[ke]);Fe!==0&&(Ke===void 0&&(Ke=Fe<0),Ke===Fe<0?(Te&&pe.push(Te),Te=[re[ke]]):Te&&Te.push(re[ke]))}return Te&&pe.push(Te),pe})(P),ie=[];for(const re of te)ie.push(re.map(F));$=ie.length===1?{type:"Polygon",coordinates:ie[0]}:{type:"MultiPolygon",coordinates:ie}}}const W={type:"Feature",geometry:$,properties:this.properties};return this.id!=null&&(W.id=this.id),W}}function Lu(l,r,o){l===1?r.id=o.readVarint():l===2?(function(p,v){const E=p.readVarint()+p.pos;for(;p.pos<E;){const A=v._keys[p.readVarint()],P=v._values[p.readVarint()];v.properties[A]=P}})(o,r):l===3?r.type=o.readVarint():l===4&&(r._geometry=o.pos)}function cv(l){let r=0;for(let o,p,v=0,E=l.length,A=E-1;v<E;A=v++)o=l[v],p=l[A],r+=(p.x-o.x)*(o.y+p.y);return r}ls.types=["Unknown","Point","LineString","Polygon"];class Wo{constructor(r,o){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=r,this._keys=[],this._values=[],this._features=[],r.readFields(hv,this,o),this.length=this._features.length}feature(r){if(r<0||r>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[r];const o=this._pbf.readVarint()+this._pbf.pos;return new ls(this._pbf,o,this.extent,this._keys,this._values)}}function hv(l,r,o){l===15?r.version=o.readVarint():l===1?r.name=o.readString():l===5?r.extent=o.readVarint():l===2?r._features.push(o.pos):l===3?r._keys.push(o.readString()):l===4&&r._values.push((function(p){let v=null;const E=p.readVarint()+p.pos;for(;p.pos<E;){const A=p.readVarint()>>3;v=A===1?p.readString():A===2?p.readFloat():A===3?p.readDouble():A===4?p.readVarint64():A===5?p.readVarint():A===6?p.readSVarint():A===7?p.readBoolean():null}if(v==null)throw new Error("unknown feature value");return v})(o))}class Tc{constructor(r,o){this.layers=r.readFields(Sd,{},o)}}function Sd(l,r,o){if(l===3){const p=new Wo(o,o.readVarint()+o.pos);p.length&&(r[p.name]=p)}}const Du=Math.pow(2,13);function Ed(l,r,o,p,v,E,A,P){l.emplaceBack(r,o,2*Math.floor(p*Du)+A,v*Du*2,E*Du*2,Math.round(P))}class fp{constructor(r){this.zoom=r.zoom,this.globalState=r.globalState,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map((o=>o.id)),this.index=r.index,this.hasPattern=!1,this.layoutVertexArray=new rt,this.centroidVertexArray=new Ie,this.indexArray=new Yi,this.programConfigurations=new go(r.layers,r.zoom),this.segments=new jn,this.stateDependentLayerIds=this.layers.filter((o=>o.isStateDependent())).map((o=>o.id))}populate(r,o,p){this.features=[],this.hasPattern=bm("fill-extrusion",this.layers,o);for(const{feature:v,id:E,index:A,sourceLayerIndex:P}of r){const z=this.layers[0]._featureFilter.needGeometry,F=wl(v,z);if(!this.layers[0]._featureFilter.filter(new Di(this.zoom,{globalState:this.globalState}),F,p))continue;const $={id:E,sourceLayerIndex:P,index:A,geometry:z?F.geometry:uu(v),properties:v.properties,type:v.type,patterns:{}};this.hasPattern?this.features.push(lp("fill-extrusion",this.layers,$,this.zoom,o)):this.addFeature($,$.geometry,A,p,{},o.subdivisionGranularity),o.featureIndex.insert(v,$.geometry,A,P,this.index,!0)}}addFeatures(r,o,p){for(const v of this.features){const{geometry:E}=v;this.addFeature(v,E,v.index,o,p,r.subdivisionGranularity)}}update(r,o,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,o,this.stateDependentLayers,p)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,Tm),this.centroidVertexBuffer=r.createVertexBuffer(this.centroidVertexArray,rx.members,!0),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(r,o,p,v,E,A){for(const P of Ju(o,500)){const z={x:0,y:0,sampleCount:0},F=this.layoutVertexArray.length;this.processPolygon(z,v,r,P,A);const $=this.layoutVertexArray.length-F,W=Math.floor(z.x/z.sampleCount),te=Math.floor(z.y/z.sampleCount);for(let ie=0;ie<$;ie++)this.centroidVertexArray.emplaceBack(W,te)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,p,E,v)}processPolygon(r,o,p,v,E){if(v.length<1||Ad(v[0]))return;for(const W of v)W.length!==0&&zu(r,W);const A={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},P=E.fill.getGranularityForZoomLevel(o.z),z=ls.types[p.type]==="Polygon";for(const W of v){if(W.length===0||Ad(W))continue;const te=ea(W,P,z);this._generateSideFaces(te,A)}if(!z)return;const F=l_(v,o,P,!1),$=this.layoutVertexArray;u_(((W,te)=>{Ed($,W,te,0,0,1,1,0)}),this.segments,this.layoutVertexArray,this.indexArray,F.verticesFlattened,F.indicesTriangles)}_generateSideFaces(r,o){let p=0;for(let v=1;v<r.length;v++){const E=r[v],A=r[v-1];if(dv(E,A))continue;o.segment.vertexLength+4>jn.MAX_VERTEX_ARRAY_LENGTH&&(o.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const P=E.sub(A)._perp()._unit(),z=A.dist(E);p+z>32768&&(p=0),Ed(this.layoutVertexArray,E.x,E.y,P.x,P.y,0,0,p),Ed(this.layoutVertexArray,E.x,E.y,P.x,P.y,0,1,p),p+=z,Ed(this.layoutVertexArray,A.x,A.y,P.x,P.y,0,0,p),Ed(this.layoutVertexArray,A.x,A.y,P.x,P.y,0,1,p);const F=o.segment.vertexLength;this.indexArray.emplaceBack(F,F+2,F+1),this.indexArray.emplaceBack(F+1,F+2,F+3),o.segment.vertexLength+=4,o.segment.primitiveLength+=2}}}function zu(l,r){for(let o=0;o<r.length;o++){const p=r[o];o===r.length-1&&r[0].x===p.x&&r[0].y===p.y||(l.x+=p.x,l.y+=p.y,l.sampleCount++)}}function dv(l,r){return l.x===r.x&&(l.x<0||l.x>zt)||l.y===r.y&&(l.y<0||l.y>zt)}function Ad(l){return l.every((r=>r.x<0))||l.every((r=>r.x>zt))||l.every((r=>r.y<0))||l.every((r=>r.y>zt))}let hf;Yt("FillExtrusionBucket",fp,{omit:["layers","features"]});var pp={get paint(){return hf=hf||new Cs({"fill-extrusion-opacity":new an($e["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Tn($e["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new an($e["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new an($e["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new pd($e["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Tn($e["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Tn($e["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new an($e["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class df extends po{constructor(r){super(r,pp)}createBucket(r){return new fp(r)}queryRadius(){return sp(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:r,feature:o,featureState:p,geometry:v,transform:E,pixelsToTileUnits:A,pixelPosMatrix:P}){const z=sf(r,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-E.bearingInRadians,A),F=this.paint.get("fill-extrusion-height").evaluate(o,p),$=this.paint.get("fill-extrusion-base").evaluate(o,p),W=(function(ie,re){const oe=[];for(const pe of ie){const Te=[pe.x,pe.y,0,1];Pn(Te,Te,re),oe.push(new C(Te[0]/Te[3],Te[1]/Te[3]))}return oe})(z,P),te=(function(ie,re,oe,pe){const Te=[],Ke=[],ke=pe[8]*re,Fe=pe[9]*re,ot=pe[10]*re,gt=pe[11]*re,Ct=pe[8]*oe,Gt=pe[9]*oe,Ft=pe[10]*oe,Ht=pe[11]*oe;for(const dn of ie){const qt=[],jt=[];for(const St of dn){const Sn=St.x,Mn=St.y,mn=pe[0]*Sn+pe[4]*Mn+pe[12],un=pe[1]*Sn+pe[5]*Mn+pe[13],Qn=pe[2]*Sn+pe[6]*Mn+pe[14],Yr=pe[3]*Sn+pe[7]*Mn+pe[15],va=Qn+ot,cs=Yr+gt,Al=mn+Ct,vo=un+Gt,za=Qn+Ft,kr=Yr+Ht,Oa=new C((mn+ke)/cs,(un+Fe)/cs);Oa.z=va/cs,qt.push(Oa);const ba=new C(Al/kr,vo/kr);ba.z=za/kr,jt.push(ba)}Te.push(qt),Ke.push(jt)}return[Te,Ke]})(v,$,F,P);return(function(ie,re,oe){let pe=1/0;jg(oe,re)&&(pe=c_(oe,re[0]));for(let Te=0;Te<re.length;Te++){const Ke=re[Te],ke=ie[Te];for(let Fe=0;Fe<Ke.length-1;Fe++){const ot=Ke[Fe],gt=[ot,Ke[Fe+1],ke[Fe+1],ke[Fe],ot];Vg(oe,gt)&&(pe=Math.min(pe,c_(oe,gt)))}}return pe!==1/0&&pe})(te[0],te[1],W)}}function ff(l,r){return l.x*r.x+l.y*r.y}function c_(l,r){if(l.length===1){let o=0;const p=r[o++];let v;for(;!v||p.equals(v);)if(v=r[o++],!v)return 1/0;for(;o<r.length;o++){const E=r[o],A=l[0],P=v.sub(p),z=E.sub(p),F=A.sub(p),$=ff(P,P),W=ff(P,z),te=ff(z,z),ie=ff(F,P),re=ff(F,z),oe=$*te-W*W,pe=(te*ie-W*re)/oe,Te=($*re-W*ie)/oe,Ke=p.z*(1-pe-Te)+v.z*pe+E.z*Te;if(isFinite(Ke))return Ke}return 1/0}{let o=1/0;for(const p of r)o=Math.min(o,p.z);return o}}const mp=Br([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:fv}=mp,Sm=Br([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:pv}=Sm,ax=Math.cos(Math.PI/180*37.5),mv=Math.pow(2,14)/.5;class qi{constructor(r){this.zoom=r.zoom,this.globalState=r.globalState,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map((o=>o.id)),this.index=r.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((o=>{this.gradients[o.id]={}})),this.layoutVertexArray=new st,this.layoutVertexArray2=new lt,this.indexArray=new Yi,this.programConfigurations=new go(r.layers,r.zoom),this.segments=new jn,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((o=>o.isStateDependent())).map((o=>o.id))}populate(r,o,p){this.hasPattern=bm("line",this.layers,o);const v=this.layers[0].layout.get("line-sort-key"),E=!v.isConstant(),A=[];for(const{feature:P,id:z,index:F,sourceLayerIndex:$}of r){const W=this.layers[0]._featureFilter.needGeometry,te=wl(P,W);if(!this.layers[0]._featureFilter.filter(new Di(this.zoom,{globalState:this.globalState}),te,p))continue;const ie=E?v.evaluate(te,{},p):void 0,re={id:z,properties:P.properties,type:P.type,sourceLayerIndex:$,index:F,geometry:W?te.geometry:uu(P),patterns:{},sortKey:ie};A.push(re)}E&&A.sort(((P,z)=>P.sortKey-z.sortKey));for(const P of A){const{geometry:z,index:F,sourceLayerIndex:$}=P;if(this.hasPattern){const W=lp("line",this.layers,P,this.zoom,o);this.patternFeatures.push(W)}else this.addFeature(P,z,F,p,{},o.subdivisionGranularity);o.featureIndex.insert(r[F].feature,z,F,$,this.index)}}update(r,o,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,o,this.stateDependentLayers,p)}addFeatures(r,o,p){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,o,p,r.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=r.createVertexBuffer(this.layoutVertexArray2,pv)),this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,fv),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(r){if(r.properties&&Object.prototype.hasOwnProperty.call(r.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(r.properties,"mapbox_clip_end"))return{start:+r.properties.mapbox_clip_start,end:+r.properties.mapbox_clip_end}}addFeature(r,o,p,v,E,A){const P=this.layers[0].layout,z=P.get("line-join").evaluate(r,{}),F=P.get("line-cap"),$=P.get("line-miter-limit"),W=P.get("line-round-limit");this.lineClips=this.lineFeatureClips(r);for(const te of o)this.addLine(te,r,z,F,$,W,v,A);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,p,E,v)}addLine(r,o,p,v,E,A,P,z){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,r=ea(r,P?z.line.getGranularityForZoomLevel(P.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ke=0;ke<r.length-1;ke++)this.totalDistance+=r[ke].dist(r[ke+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const F=ls.types[o.type]==="Polygon";let $=r.length;for(;$>=2&&r[$-1].equals(r[$-2]);)$--;let W=0;for(;W<$-1&&r[W].equals(r[W+1]);)W++;if($<(F?3:2))return;p==="bevel"&&(E=1.05);const te=this.overscaling<=16?122880/(512*this.overscaling):0,ie=this.segments.prepareSegment(10*$,this.layoutVertexArray,this.indexArray);let re,oe,pe,Te,Ke;this.e1=this.e2=-1,F&&(re=r[$-2],Ke=r[W].sub(re)._unit()._perp());for(let ke=W;ke<$;ke++){if(pe=ke===$-1?F?r[W+1]:void 0:r[ke+1],pe&&r[ke].equals(pe))continue;Ke&&(Te=Ke),re&&(oe=re),re=r[ke],Ke=pe?pe.sub(re)._unit()._perp():Te,Te=Te||Ke;let Fe=Te.add(Ke);Fe.x===0&&Fe.y===0||Fe._unit();const ot=Te.x*Ke.x+Te.y*Ke.y,gt=Fe.x*Ke.x+Fe.y*Ke.y,Ct=gt!==0?1/gt:1/0,Gt=2*Math.sqrt(2-2*gt),Ft=gt<ax&&oe&&pe,Ht=Te.x*Ke.y-Te.y*Ke.x>0;if(Ft&&ke>W){const jt=re.dist(oe);if(jt>2*te){const St=re.sub(re.sub(oe)._mult(te/jt)._round());this.updateDistance(oe,St),this.addCurrentVertex(St,Te,0,0,ie),oe=St}}const dn=oe&&pe;let qt=dn?p:F?"butt":v;if(dn&&qt==="round"&&(Ct<A?qt="miter":Ct<=2&&(qt="fakeround")),qt==="miter"&&Ct>E&&(qt="bevel"),qt==="bevel"&&(Ct>2&&(qt="flipbevel"),Ct<E&&(qt="miter")),oe&&this.updateDistance(oe,re),qt==="miter")Fe._mult(Ct),this.addCurrentVertex(re,Fe,0,0,ie);else if(qt==="flipbevel"){if(Ct>100)Fe=Ke.mult(-1);else{const jt=Ct*Te.add(Ke).mag()/Te.sub(Ke).mag();Fe._perp()._mult(jt*(Ht?-1:1))}this.addCurrentVertex(re,Fe,0,0,ie),this.addCurrentVertex(re,Fe.mult(-1),0,0,ie)}else if(qt==="bevel"||qt==="fakeround"){const jt=-Math.sqrt(Ct*Ct-1),St=Ht?jt:0,Sn=Ht?0:jt;if(oe&&this.addCurrentVertex(re,Te,St,Sn,ie),qt==="fakeround"){const Mn=Math.round(180*Gt/Math.PI/20);for(let mn=1;mn<Mn;mn++){let un=mn/Mn;if(un!==.5){const Yr=un-.5;un+=un*Yr*(un-1)*((1.0904+ot*(ot*(3.55645-1.43519*ot)-3.2452))*Yr*Yr+(.848013+ot*(.215638*ot-1.06021)))}const Qn=Ke.sub(Te)._mult(un)._add(Te)._unit()._mult(Ht?-1:1);this.addHalfVertex(re,Qn.x,Qn.y,!1,Ht,0,ie)}}pe&&this.addCurrentVertex(re,Ke,-St,-Sn,ie)}else if(qt==="butt")this.addCurrentVertex(re,Fe,0,0,ie);else if(qt==="square"){const jt=oe?1:-1;this.addCurrentVertex(re,Fe,jt,jt,ie)}else qt==="round"&&(oe&&(this.addCurrentVertex(re,Te,0,0,ie),this.addCurrentVertex(re,Te,1,1,ie,!0)),pe&&(this.addCurrentVertex(re,Ke,-1,-1,ie,!0),this.addCurrentVertex(re,Ke,0,0,ie)));if(Ft&&ke<$-1){const jt=re.dist(pe);if(jt>2*te){const St=re.add(pe.sub(re)._mult(te/jt)._round());this.updateDistance(re,St),this.addCurrentVertex(St,Ke,0,0,ie),re=St}}}}addCurrentVertex(r,o,p,v,E,A=!1){const P=o.y*v-o.x,z=-o.y-o.x*v;this.addHalfVertex(r,o.x+o.y*p,o.y-o.x*p,A,!1,p,E),this.addHalfVertex(r,P,z,A,!0,-v,E),this.distance>mv/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(r,o,p,v,E,A))}addHalfVertex({x:r,y:o},p,v,E,A,P,z){const F=.5*(this.lineClips?this.scaledDistance*(mv-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((r<<1)+(E?1:0),(o<<1)+(A?1:0),Math.round(63*p)+128,Math.round(63*v)+128,1+(P===0?0:P<0?-1:1)|(63&F)<<2,F>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const $=z.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,$,this.e2),z.primitiveLength++),A?this.e2=$:this.e1=$}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(r,o){this.distance+=r.dist(o),this.updateScaledDistance()}}let Sr,_i;Yt("LineBucket",qi,{omit:["layers","patternFeatures"]});var xi={get paint(){return _i=_i||new Cs({"line-opacity":new Tn($e.paint_line["line-opacity"]),"line-color":new Tn($e.paint_line["line-color"]),"line-translate":new an($e.paint_line["line-translate"]),"line-translate-anchor":new an($e.paint_line["line-translate-anchor"]),"line-width":new Tn($e.paint_line["line-width"]),"line-gap-width":new Tn($e.paint_line["line-gap-width"]),"line-offset":new Tn($e.paint_line["line-offset"]),"line-blur":new Tn($e.paint_line["line-blur"]),"line-dasharray":new jo($e.paint_line["line-dasharray"]),"line-pattern":new pd($e.paint_line["line-pattern"]),"line-gradient":new Kc($e.paint_line["line-gradient"])})},get layout(){return Sr=Sr||new Cs({"line-cap":new an($e.layout_line["line-cap"]),"line-join":new Tn($e.layout_line["line-join"]),"line-miter-limit":new an($e.layout_line["line-miter-limit"]),"line-round-limit":new an($e.layout_line["line-round-limit"]),"line-sort-key":new Tn($e.layout_line["line-sort-key"])})}};class gr extends Tn{possiblyEvaluate(r,o){return o=new Di(Math.floor(o.zoom),{now:o.now,fadeDuration:o.fadeDuration,zoomHistory:o.zoomHistory,transition:o.transition}),super.possiblyEvaluate(r,o)}evaluate(r,o,p,v){return o=oi({},o,{zoom:Math.floor(o.zoom)}),super.evaluate(r,o,p,v)}}let _o;class Lh extends po{constructor(r){super(r,xi),this.gradientVersion=0,_o||(_o=new gr(xi.paint.properties["line-width"].specification),_o.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(r){if(r==="line-gradient"){const o=this.gradientExpression();this.stepInterpolant=!!(function(p){return p._styleExpression!==void 0})(o)&&o._styleExpression.expression instanceof Ki,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(r,o){super.recalculate(r,o),this.paint._values["line-floorwidth"]=_o.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,r)}createBucket(r){return new qi(r)}queryRadius(r){const o=r,p=Cd(Rh("line-width",this,o),Rh("line-gap-width",this,o)),v=Rh("line-offset",this,o);return p/2+Math.abs(v)+sp(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:r,feature:o,featureState:p,geometry:v,transform:E,pixelsToTileUnits:A}){const P=sf(r,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-E.bearingInRadians,A),z=A/2*Cd(this.paint.get("line-width").evaluate(o,p),this.paint.get("line-gap-width").evaluate(o,p)),F=this.paint.get("line-offset").evaluate(o,p);return F&&(v=(function($,W){const te=[];for(let ie=0;ie<$.length;ie++){const re=$[ie],oe=[];for(let pe=0;pe<re.length;pe++){const Te=re[pe-1],Ke=re[pe],ke=re[pe+1],Fe=pe===0?new C(0,0):Ke.sub(Te)._unit()._perp(),ot=pe===re.length-1?new C(0,0):ke.sub(Ke)._unit()._perp(),gt=Fe._add(ot)._unit(),Ct=gt.x*ot.x+gt.y*ot.y;Ct!==0&&gt._mult(1/Ct),oe.push(gt._mult(W)._add(Ke))}te.push(oe)}return te})(v,F*A)),(function($,W,te){for(let ie=0;ie<W.length;ie++){const re=W[ie];if($.length>=3){for(let oe=0;oe<re.length;oe++)if(vd($,re[oe]))return!0}if($g($,re,te))return!0}return!1})(P,v,z)}isTileClipped(){return!0}}function Cd(l,r){return r>0?r+2*l:l}const h_=Br([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Jc=Br([{name:"a_projected_pos",components:3,type:"Float32"}],4);Br([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const ya=Br([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);Br([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const eh=Br([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Id=Br([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function d_(l,r,o){return l.sections.forEach((p=>{p.text=(function(v,E,A){const P=E.layout.get("text-transform").evaluate(A,{});return P==="uppercase"?v=v.toLocaleUpperCase():P==="lowercase"&&(v=v.toLocaleLowerCase()),yl.applyArabicShaping&&(v=yl.applyArabicShaping(v)),v})(p.text,r,o)})),l}Br([{name:"triangle",components:3,type:"Uint16"}]),Br([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Br([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Br([{type:"Float32",name:"offsetX"}]),Br([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Br([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const io={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var Xr=24;const Pd=4294967296,Ko=1/Pd,Em=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");class pf{constructor(r=new Uint8Array(16)){this.buf=ArrayBuffer.isView(r)?r:new Uint8Array(r),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(r,o,p=this.length){for(;this.pos<p;){const v=this.readVarint(),E=v>>3,A=this.pos;this.type=7&v,r(E,o,this),this.pos===A&&this.skip(v)}return o}readMessage(r,o){return this.readFields(r,o,this.readVarint()+this.pos)}readFixed32(){const r=this.dataView.getUint32(this.pos,!0);return this.pos+=4,r}readSFixed32(){const r=this.dataView.getInt32(this.pos,!0);return this.pos+=4,r}readFixed64(){const r=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*Pd;return this.pos+=8,r}readSFixed64(){const r=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*Pd;return this.pos+=8,r}readFloat(){const r=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,r}readDouble(){const r=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,r}readVarint(r){const o=this.buf;let p,v;return v=o[this.pos++],p=127&v,v<128?p:(v=o[this.pos++],p|=(127&v)<<7,v<128?p:(v=o[this.pos++],p|=(127&v)<<14,v<128?p:(v=o[this.pos++],p|=(127&v)<<21,v<128?p:(v=o[this.pos],p|=(15&v)<<28,(function(E,A,P){const z=P.buf;let F,$;if($=z[P.pos++],F=(112&$)>>4,$<128||($=z[P.pos++],F|=(127&$)<<3,$<128)||($=z[P.pos++],F|=(127&$)<<10,$<128)||($=z[P.pos++],F|=(127&$)<<17,$<128)||($=z[P.pos++],F|=(127&$)<<24,$<128)||($=z[P.pos++],F|=(1&$)<<31,$<128))return Md(E,F,A);throw new Error("Expected varint not more than 10 bytes")})(p,r,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const r=this.readVarint();return r%2==1?(r+1)/-2:r/2}readBoolean(){return!!this.readVarint()}readString(){const r=this.readVarint()+this.pos,o=this.pos;return this.pos=r,r-o>=12&&Em?Em.decode(this.buf.subarray(o,r)):(function(p,v,E){let A="",P=v;for(;P<E;){const z=p[P];let F,$,W,te=null,ie=z>239?4:z>223?3:z>191?2:1;if(P+ie>E)break;ie===1?z<128&&(te=z):ie===2?(F=p[P+1],(192&F)==128&&(te=(31&z)<<6|63&F,te<=127&&(te=null))):ie===3?(F=p[P+1],$=p[P+2],(192&F)==128&&(192&$)==128&&(te=(15&z)<<12|(63&F)<<6|63&$,(te<=2047||te>=55296&&te<=57343)&&(te=null))):ie===4&&(F=p[P+1],$=p[P+2],W=p[P+3],(192&F)==128&&(192&$)==128&&(192&W)==128&&(te=(15&z)<<18|(63&F)<<12|(63&$)<<6|63&W,(te<=65535||te>=1114112)&&(te=null))),te===null?(te=65533,ie=1):te>65535&&(te-=65536,A+=String.fromCharCode(te>>>10&1023|55296),te=56320|1023&te),A+=String.fromCharCode(te),P+=ie}return A})(this.buf,o,r)}readBytes(){const r=this.readVarint()+this.pos,o=this.buf.subarray(this.pos,r);return this.pos=r,o}readPackedVarint(r=[],o){const p=this.readPackedEnd();for(;this.pos<p;)r.push(this.readVarint(o));return r}readPackedSVarint(r=[]){const o=this.readPackedEnd();for(;this.pos<o;)r.push(this.readSVarint());return r}readPackedBoolean(r=[]){const o=this.readPackedEnd();for(;this.pos<o;)r.push(this.readBoolean());return r}readPackedFloat(r=[]){const o=this.readPackedEnd();for(;this.pos<o;)r.push(this.readFloat());return r}readPackedDouble(r=[]){const o=this.readPackedEnd();for(;this.pos<o;)r.push(this.readDouble());return r}readPackedFixed32(r=[]){const o=this.readPackedEnd();for(;this.pos<o;)r.push(this.readFixed32());return r}readPackedSFixed32(r=[]){const o=this.readPackedEnd();for(;this.pos<o;)r.push(this.readSFixed32());return r}readPackedFixed64(r=[]){const o=this.readPackedEnd();for(;this.pos<o;)r.push(this.readFixed64());return r}readPackedSFixed64(r=[]){const o=this.readPackedEnd();for(;this.pos<o;)r.push(this.readSFixed64());return r}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(r){const o=7&r;if(o===0)for(;this.buf[this.pos++]>127;);else if(o===2)this.pos=this.readVarint()+this.pos;else if(o===5)this.pos+=4;else{if(o!==1)throw new Error(`Unimplemented type: ${o}`);this.pos+=8}}writeTag(r,o){this.writeVarint(r<<3|o)}realloc(r){let o=this.length||16;for(;o<this.pos+r;)o*=2;if(o!==this.length){const p=new Uint8Array(o);p.set(this.buf),this.buf=p,this.dataView=new DataView(p.buffer),this.length=o}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(r){this.realloc(4),this.dataView.setInt32(this.pos,r,!0),this.pos+=4}writeSFixed32(r){this.realloc(4),this.dataView.setInt32(this.pos,r,!0),this.pos+=4}writeFixed64(r){this.realloc(8),this.dataView.setInt32(this.pos,-1&r,!0),this.dataView.setInt32(this.pos+4,Math.floor(r*Ko),!0),this.pos+=8}writeSFixed64(r){this.realloc(8),this.dataView.setInt32(this.pos,-1&r,!0),this.dataView.setInt32(this.pos+4,Math.floor(r*Ko),!0),this.pos+=8}writeVarint(r){(r=+r||0)>268435455||r<0?(function(o,p){let v,E;if(o>=0?(v=o%4294967296|0,E=o/4294967296|0):(v=~(-o%4294967296),E=~(-o/4294967296),4294967295^v?v=v+1|0:(v=0,E=E+1|0)),o>=18446744073709552e3||o<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");p.realloc(10),(function(A,P,z){z.buf[z.pos++]=127&A|128,A>>>=7,z.buf[z.pos++]=127&A|128,A>>>=7,z.buf[z.pos++]=127&A|128,A>>>=7,z.buf[z.pos++]=127&A|128,z.buf[z.pos]=127&(A>>>=7)})(v,0,p),(function(A,P){const z=(7&A)<<4;P.buf[P.pos++]|=z|((A>>>=3)?128:0),A&&(P.buf[P.pos++]=127&A|((A>>>=7)?128:0),A&&(P.buf[P.pos++]=127&A|((A>>>=7)?128:0),A&&(P.buf[P.pos++]=127&A|((A>>>=7)?128:0),A&&(P.buf[P.pos++]=127&A|((A>>>=7)?128:0),A&&(P.buf[P.pos++]=127&A)))))})(E,p)})(r,this):(this.realloc(4),this.buf[this.pos++]=127&r|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=r>>>7&127))))}writeSVarint(r){this.writeVarint(r<0?2*-r-1:2*r)}writeBoolean(r){this.writeVarint(+r)}writeString(r){r=String(r),this.realloc(4*r.length),this.pos++;const o=this.pos;this.pos=(function(v,E,A){for(let P,z,F=0;F<E.length;F++){if(P=E.charCodeAt(F),P>55295&&P<57344){if(!z){P>56319||F+1===E.length?(v[A++]=239,v[A++]=191,v[A++]=189):z=P;continue}if(P<56320){v[A++]=239,v[A++]=191,v[A++]=189,z=P;continue}P=z-55296<<10|P-56320|65536,z=null}else z&&(v[A++]=239,v[A++]=191,v[A++]=189,z=null);P<128?v[A++]=P:(P<2048?v[A++]=P>>6|192:(P<65536?v[A++]=P>>12|224:(v[A++]=P>>18|240,v[A++]=P>>12&63|128),v[A++]=P>>6&63|128),v[A++]=63&P|128)}return A})(this.buf,r,this.pos);const p=this.pos-o;p>=128&&gp(o,p,this),this.pos=o-1,this.writeVarint(p),this.pos+=p}writeFloat(r){this.realloc(4),this.dataView.setFloat32(this.pos,r,!0),this.pos+=4}writeDouble(r){this.realloc(8),this.dataView.setFloat64(this.pos,r,!0),this.pos+=8}writeBytes(r){const o=r.length;this.writeVarint(o),this.realloc(o);for(let p=0;p<o;p++)this.buf[this.pos++]=r[p]}writeRawMessage(r,o){this.pos++;const p=this.pos;r(o,this);const v=this.pos-p;v>=128&&gp(p,v,this),this.pos=p-1,this.writeVarint(v),this.pos+=v}writeMessage(r,o,p){this.writeTag(r,2),this.writeRawMessage(o,p)}writePackedVarint(r,o){o.length&&this.writeMessage(r,Am,o)}writePackedSVarint(r,o){o.length&&this.writeMessage(r,Dh,o)}writePackedBoolean(r,o){o.length&&this.writeMessage(r,mf,o)}writePackedFloat(r,o){o.length&&this.writeMessage(r,us,o)}writePackedDouble(r,o){o.length&&this.writeMessage(r,zh,o)}writePackedFixed32(r,o){o.length&&this.writeMessage(r,th,o)}writePackedSFixed32(r,o){o.length&&this.writeMessage(r,f_,o)}writePackedFixed64(r,o){o.length&&this.writeMessage(r,p_,o)}writePackedSFixed64(r,o){o.length&&this.writeMessage(r,gv,o)}writeBytesField(r,o){this.writeTag(r,2),this.writeBytes(o)}writeFixed32Field(r,o){this.writeTag(r,5),this.writeFixed32(o)}writeSFixed32Field(r,o){this.writeTag(r,5),this.writeSFixed32(o)}writeFixed64Field(r,o){this.writeTag(r,1),this.writeFixed64(o)}writeSFixed64Field(r,o){this.writeTag(r,1),this.writeSFixed64(o)}writeVarintField(r,o){this.writeTag(r,0),this.writeVarint(o)}writeSVarintField(r,o){this.writeTag(r,0),this.writeSVarint(o)}writeStringField(r,o){this.writeTag(r,2),this.writeString(o)}writeFloatField(r,o){this.writeTag(r,5),this.writeFloat(o)}writeDoubleField(r,o){this.writeTag(r,1),this.writeDouble(o)}writeBooleanField(r,o){this.writeVarintField(r,+o)}}function Md(l,r,o){return o?4294967296*r+(l>>>0):4294967296*(r>>>0)+(l>>>0)}function gp(l,r,o){const p=r<=16383?1:r<=2097151?2:r<=268435455?3:Math.floor(Math.log(r)/(7*Math.LN2));o.realloc(p);for(let v=o.pos-1;v>=l;v--)o.buf[v+p]=o.buf[v]}function Am(l,r){for(let o=0;o<l.length;o++)r.writeVarint(l[o])}function Dh(l,r){for(let o=0;o<l.length;o++)r.writeSVarint(l[o])}function us(l,r){for(let o=0;o<l.length;o++)r.writeFloat(l[o])}function zh(l,r){for(let o=0;o<l.length;o++)r.writeDouble(l[o])}function mf(l,r){for(let o=0;o<l.length;o++)r.writeBoolean(l[o])}function th(l,r){for(let o=0;o<l.length;o++)r.writeFixed32(l[o])}function f_(l,r){for(let o=0;o<l.length;o++)r.writeSFixed32(l[o])}function p_(l,r){for(let o=0;o<l.length;o++)r.writeFixed64(l[o])}function gv(l,r){for(let o=0;o<l.length;o++)r.writeSFixed64(l[o])}function _p(l,r,o){l===1&&o.readMessage(m_,r)}function m_(l,r,o){if(l===3){const{id:p,bitmap:v,width:E,height:A,left:P,top:z,advance:F}=o.readMessage(jl,{});r.push({id:p,bitmap:new of({width:E+6,height:A+6},v),metrics:{width:E,height:A,left:P,top:z,advance:F}})}}function jl(l,r,o){l===1?r.id=o.readVarint():l===2?r.bitmap=o.readBytes():l===3?r.width=o.readVarint():l===4?r.height=o.readVarint():l===5?r.left=o.readSVarint():l===6?r.top=o.readSVarint():l===7&&(r.advance=o.readVarint())}function g_(l){let r=0,o=0;for(const A of l)r+=A.w*A.h,o=Math.max(o,A.w);l.sort(((A,P)=>P.h-A.h));const p=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(r/.95)),o),h:1/0}];let v=0,E=0;for(const A of l)for(let P=p.length-1;P>=0;P--){const z=p[P];if(!(A.w>z.w||A.h>z.h)){if(A.x=z.x,A.y=z.y,E=Math.max(E,A.y+A.h),v=Math.max(v,A.x+A.w),A.w===z.w&&A.h===z.h){const F=p.pop();F&&P<p.length&&(p[P]=F)}else A.h===z.h?(z.x+=A.w,z.w-=A.w):A.w===z.w?(z.y+=A.h,z.h-=A.h):(p.push({x:z.x+A.w,y:z.y,w:z.w-A.w,h:A.h}),z.y+=A.h,z.h-=A.h);break}}return{w:v,h:E,fill:r/(v*E)||0}}class yo{constructor(r,{pixelRatio:o,version:p,stretchX:v,stretchY:E,content:A,textFitWidth:P,textFitHeight:z}){this.paddedRect=r,this.pixelRatio=o,this.stretchX=v,this.stretchY=E,this.content=A,this.version=p,this.textFitWidth=P,this.textFitHeight=z}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class __{constructor(r,o){const p={},v={};this.haveRenderCallbacks=[];const E=[];this.addImages(r,p,E),this.addImages(o,v,E);const{w:A,h:P}=g_(E),z=new Ms({width:A||1,height:P||1});for(const F in r){const $=r[F],W=p[F].paddedRect;Ms.copy($.data,z,{x:0,y:0},{x:W.x+1,y:W.y+1},$.data)}for(const F in o){const $=o[F],W=v[F].paddedRect,te=W.x+1,ie=W.y+1,re=$.data.width,oe=$.data.height;Ms.copy($.data,z,{x:0,y:0},{x:te,y:ie},$.data),Ms.copy($.data,z,{x:0,y:oe-1},{x:te,y:ie-1},{width:re,height:1}),Ms.copy($.data,z,{x:0,y:0},{x:te,y:ie+oe},{width:re,height:1}),Ms.copy($.data,z,{x:re-1,y:0},{x:te-1,y:ie},{width:1,height:oe}),Ms.copy($.data,z,{x:0,y:0},{x:te+re,y:ie},{width:1,height:oe})}this.image=z,this.iconPositions=p,this.patternPositions=v}addImages(r,o,p){for(const v in r){const E=r[v],A={x:0,y:0,w:E.data.width+2,h:E.data.height+2};p.push(A),o[v]=new yo(A,E),E.hasRenderCallback&&this.haveRenderCallbacks.push(v)}}patchUpdatedImages(r,o){r.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const p in r.updatedImages)this.patchUpdatedImage(this.iconPositions[p],r.getImage(p),o),this.patchUpdatedImage(this.patternPositions[p],r.getImage(p),o)}patchUpdatedImage(r,o,p){if(!r||!o||r.version===o.version)return;r.version=o.version;const[v,E]=r.tl;p.update(o.data,void 0,{x:v,y:E})}}var nh;Yt("ImagePosition",yo),Yt("ImageAtlas",__),g.ao=void 0,(nh=g.ao||(g.ao={}))[nh.none=0]="none",nh[nh.horizontal=1]="horizontal",nh[nh.vertical=2]="vertical",nh[nh.horizontalOnly=3]="horizontalOnly";class yp{constructor(){this.scale=1,this.fontStack="",this.imageName=null,this.verticalAlign="bottom"}static forText(r,o,p){const v=new yp;return v.scale=r||1,v.fontStack=o,v.verticalAlign=p||"bottom",v}static forImage(r,o){const p=new yp;return p.imageName=r,p.verticalAlign=o||"bottom",p}}class $l{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(r,o){const p=new $l;for(let v=0;v<r.sections.length;v++){const E=r.sections[v];E.image?p.addImageSection(E):p.addTextSection(E,o)}return p}length(){return this.text.length}getSection(r){return this.sections[this.sectionIndex[r]]}getSectionIndex(r){return this.sectionIndex[r]}getCharCode(r){return this.text.charCodeAt(r)}verticalizePunctuation(){this.text=(function(r){let o="";for(let p=0;p<r.length;p++){const v=r.charCodeAt(p+1)||null,E=r.charCodeAt(p-1)||null;o+=v&&dd(v)&&!io[r[p+1]]||E&&dd(E)&&!io[r[p-1]]||!io[r[p]]?r[p]:io[r[p]]}return o})(this.text)}trim(){let r=0;for(let p=0;p<this.text.length&&gf[this.text.charCodeAt(p)];p++)r++;let o=this.text.length;for(let p=this.text.length-1;p>=0&&p>=r&&gf[this.text.charCodeAt(p)];p--)o--;this.text=this.text.substring(r,o),this.sectionIndex=this.sectionIndex.slice(r,o)}substring(r,o){const p=new $l;return p.text=this.text.substring(r,o),p.sectionIndex=this.sectionIndex.slice(r,o),p.sections=this.sections,p}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((r,o)=>Math.max(r,this.sections[o].scale)),0)}getMaxImageSize(r){let o=0,p=0;for(let v=0;v<this.length();v++){const E=this.getSection(v);if(E.imageName){const A=r[E.imageName];if(!A)continue;const P=A.displaySize;o=Math.max(o,P[0]),p=Math.max(p,P[1])}}return{maxImageWidth:o,maxImageHeight:p}}addTextSection(r,o){this.text+=r.text,this.sections.push(yp.forText(r.scale,r.fontStack||o,r.verticalAlign));const p=this.sections.length-1;for(let v=0;v<r.text.length;++v)this.sectionIndex.push(p)}addImageSection(r){const o=r.image?r.image.name:"";if(o.length===0)return void Mi("Can't add FormattedSection with an empty image.");const p=this.getNextImageSectionCharCode();p?(this.text+=String.fromCharCode(p),this.sections.push(yp.forImage(o,r.verticalAlign)),this.sectionIndex.push(this.sections.length-1)):Mi("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Rd(l,r,o,p,v,E,A,P,z,F,$,W,te,ie,re){const oe=$l.fromFeature(l,v);let pe;W===g.ao.vertical&&oe.verticalizePunctuation();const{processBidirectionalText:Te,processStyledBidirectionalText:Ke}=yl;if(Te&&oe.sections.length===1){pe=[];const ot=Te(oe.toString(),b_(oe,F,E,r,p,ie));for(const gt of ot){const Ct=new $l;Ct.text=gt,Ct.sections=oe.sections;for(let Gt=0;Gt<gt.length;Gt++)Ct.sectionIndex.push(0);pe.push(Ct)}}else if(Ke){pe=[];const ot=Ke(oe.text,oe.sectionIndex,b_(oe,F,E,r,p,ie));for(const gt of ot){const Ct=new $l;Ct.text=gt[0],Ct.sectionIndex=gt[1],Ct.sections=oe.sections,pe.push(Ct)}}else pe=(function(ot,gt){const Ct=[],Gt=ot.text;let Ft=0;for(const Ht of gt)Ct.push(ot.substring(Ft,Ht)),Ft=Ht;return Ft<Gt.length&&Ct.push(ot.substring(Ft,Gt.length)),Ct})(oe,b_(oe,F,E,r,p,ie));const ke=[],Fe={positionedLines:ke,text:oe.toString(),top:$[1],bottom:$[1],left:$[0],right:$[0],writingMode:W,iconsInText:!1,verticalizable:!1};return(function(ot,gt,Ct,Gt,Ft,Ht,dn,qt,jt,St,Sn,Mn){let mn=0,un=0,Qn=0,Yr=0;const va=qt==="right"?1:qt==="left"?0:.5,cs=Xr/Mn;let Al=0;for(const kr of Ft){kr.trim();const Oa=kr.getMaxScale(),ba={positionedGlyphs:[],lineOffset:0};ot.positionedLines[Al]=ba;const hs=ba.positionedGlyphs;let bo=0;if(!kr.length()){un+=Ht,++Al;continue}const Yo=sx(Gt,kr,cs);for(let ks=0;ks<kr.length();ks++){const ha=kr.getSection(ks),Na=kr.getSectionIndex(ks),wa=kr.getCharCode(ks),yr=vv(jt,Sn,wa);let Ii;if(ha.imageName){if(ot.iconsInText=!0,ha.scale=ha.scale*cs,Ii=Im(ha,yr,Oa,Yo,Gt),!Ii)continue;bo=Math.max(bo,Ii.imageOffset)}else if(Ii=yf(ha,wa,yr,Yo,gt,Ct),!Ii)continue;const{rect:Ls,metrics:Ic,baselineOffset:Qo}=Ii;hs.push({glyph:wa,imageName:ha.imageName,x:mn,y:un+Qo+-17,vertical:yr,scale:ha.scale,fontStack:ha.fontStack,sectionIndex:Na,metrics:Ic,rect:Ls}),yr?(ot.verticalizable=!0,mn+=(ha.imageName?Ic.advance:Xr)*ha.scale+St):mn+=Ic.advance*ha.scale+St}hs.length!==0&&(Qn=Math.max(mn-St,Qn),bv(hs,0,hs.length-1,va)),mn=0,ba.lineOffset=Math.max(bo,(Oa-1)*Xr);const xa=Ht*Oa+bo;un+=xa,Yr=Math.max(xa,Yr),++Al}const{horizontalAlign:vo,verticalAlign:za}=x_(dn);(function(kr,Oa,ba,hs,bo,Yo,xa,ks,ha){const Na=(Oa-ba)*bo;let wa=0;wa=Yo!==xa?-ks*hs- -17:-hs*ha*xa+.5*xa;for(const yr of kr)for(const Ii of yr.positionedGlyphs)Ii.x+=Na,Ii.y+=wa})(ot.positionedLines,va,vo,za,Qn,Yr,Ht,un,Ft.length),ot.top+=-za*un,ot.bottom=ot.top+un,ot.left+=-vo*Qn,ot.right=ot.left+Qn})(Fe,r,o,p,pe,A,P,z,W,F,te,re),!(function(ot){for(const gt of ot)if(gt.positionedGlyphs.length!==0)return!1;return!0})(ke)&&Fe}const gf={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},_f={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},_v={40:!0};function y_(l,r,o,p,v,E){if(r.imageName){const A=p[r.imageName];return A?A.displaySize[0]*r.scale*Xr/E+v:0}{const A=o[r.fontStack],P=A&&A[l];return P?P.metrics.advance*r.scale+v:0}}function v_(l,r,o,p){const v=Math.pow(l-r,2);return p?l<r?v/2:2*v:v+Math.abs(o)*o}function yv(l,r,o){let p=0;return l===10&&(p-=1e4),o&&(p+=150),l!==40&&l!==65288||(p+=50),r!==41&&r!==65289||(p+=50),p}function vp(l,r,o,p,v,E){let A=null,P=v_(r,o,v,E);for(const z of p){const F=v_(r-z.x,o,v,E)+z.badness;F<=P&&(A=z,P=F)}return{index:l,x:r,priorBreak:A,badness:P}}function Cm(l){return l?Cm(l.priorBreak).concat(l.index):[]}function b_(l,r,o,p,v,E){if(!l)return[];const A=[],P=(function(W,te,ie,re,oe,pe){let Te=0;for(let Ke=0;Ke<W.length();Ke++){const ke=W.getSection(Ke);Te+=y_(W.getCharCode(Ke),ke,re,oe,te,pe)}return Te/Math.max(1,Math.ceil(Te/ie))})(l,r,o,p,v,E),z=l.text.indexOf("")>=0;let F=0;for(let W=0;W<l.length();W++){const te=l.getSection(W),ie=l.getCharCode(W);if(gf[ie]||(F+=y_(ie,te,p,v,r,E)),W<l.length()-1){const re=!(($=ie)<11904)&&(!!ri["CJK Compatibility Forms"]($)||!!ri["CJK Compatibility"]($)||!!ri["CJK Strokes"]($)||!!ri["CJK Symbols and Punctuation"]($)||!!ri["Enclosed CJK Letters and Months"]($)||!!ri["Halfwidth and Fullwidth Forms"]($)||!!ri["Ideographic Description Characters"]($)||!!ri["Vertical Forms"]($)||fc.test(String.fromCodePoint($)));(_f[ie]||re||te.imageName||W!==l.length()-2&&_v[l.getCharCode(W+1)])&&A.push(vp(W+1,F,P,A,yv(ie,l.getCharCode(W+1),re&&z),!1))}}var $;return Cm(vp(l.length(),F,P,A,0,!0))}function x_(l){let r=.5,o=.5;switch(l){case"right":case"top-right":case"bottom-right":r=1;break;case"left":case"top-left":case"bottom-left":r=0}switch(l){case"bottom":case"bottom-right":case"bottom-left":o=1;break;case"top":case"top-right":case"top-left":o=0}return{horizontalAlign:r,verticalAlign:o}}function sx(l,r,o){const p=r.getMaxScale()*Xr,{maxImageWidth:v,maxImageHeight:E}=r.getMaxImageSize(l),A=Math.max(p,E*o);return{verticalLineContentWidth:Math.max(p,v*o),horizontalLineContentHeight:A}}function w_(l){switch(l){case"top":return 0;case"center":return .5;default:return 1}}function vv(l,r,o){return!(l===g.ao.horizontal||!r&&!Zc(o)||r&&(gf[o]||(p=o,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(p)))));var p}function yf(l,r,o,p,v,E){const A=E[l.fontStack],P=(function(F,$,W,te){if(F&&F.rect)return F;const ie=$[W.fontStack],re=ie&&ie[te];return re?{rect:null,metrics:re.metrics}:null})(A&&A[r],v,l,r);if(P===null)return null;let z;if(o)z=p.verticalLineContentWidth-l.scale*Xr;else{const F=w_(l.verticalAlign);z=(p.horizontalLineContentHeight-l.scale*Xr)*F}return{rect:P.rect,metrics:P.metrics,baselineOffset:z}}function Im(l,r,o,p,v){const E=v[l.imageName];if(!E)return null;const A=E.paddedRect,P=E.displaySize,z={width:P[0],height:P[1],left:1,top:-3,advance:r?P[1]:P[0]};let F;if(r)F=p.verticalLineContentWidth-P[1]*l.scale;else{const $=w_(l.verticalAlign);F=(p.horizontalLineContentHeight-P[1]*l.scale)*$}return{rect:A,metrics:z,baselineOffset:F,imageOffset:(r?P[0]:P[1])*l.scale-Xr*o}}function bv(l,r,o,p){if(p===0)return;const v=l[o],E=(l[o].x+v.metrics.advance*v.scale)*p;for(let A=r;A<=o;A++)l[A].x-=E}function xv(l,r,o){const{horizontalAlign:p,verticalAlign:v}=x_(o),E=r[0]-l.displaySize[0]*p,A=r[1]-l.displaySize[1]*v;return{image:l,top:A,bottom:A+l.displaySize[1],left:E,right:E+l.displaySize[0]}}function T_(l){var r,o;let p=l.left,v=l.top,E=l.right-p,A=l.bottom-v;const P=(r=l.image.textFitWidth)!==null&&r!==void 0?r:"stretchOrShrink",z=(o=l.image.textFitHeight)!==null&&o!==void 0?o:"stretchOrShrink",F=(l.image.content[2]-l.image.content[0])/(l.image.content[3]-l.image.content[1]);if(z==="proportional"){if(P==="stretchOnly"&&E/A<F||P==="proportional"){const $=Math.ceil(A*F);p*=$/E,E=$}}else if(P==="proportional"&&z==="stretchOnly"&&F!==0&&E/A>F){const $=Math.ceil(E/F);v*=$/A,A=$}return{x1:p,y1:v,x2:p+E,y2:v+A}}function S_(l,r,o,p,v,E){const A=l.image;let P;if(A.content){const pe=A.content,Te=A.pixelRatio||1;P=[pe[0]/Te,pe[1]/Te,A.displaySize[0]-pe[2]/Te,A.displaySize[1]-pe[3]/Te]}const z=r.left*E,F=r.right*E;let $,W,te,ie;o==="width"||o==="both"?(ie=v[0]+z-p[3],W=v[0]+F+p[1]):(ie=v[0]+(z+F-A.displaySize[0])/2,W=ie+A.displaySize[0]);const re=r.top*E,oe=r.bottom*E;return o==="height"||o==="both"?($=v[1]+re-p[0],te=v[1]+oe+p[2]):($=v[1]+(re+oe-A.displaySize[1])/2,te=$+A.displaySize[1]),{image:A,top:$,right:W,bottom:te,left:ie,collisionPadding:P}}const Sc=128,ih=32640;function bp(l,r){const{expression:o}=r;if(o.kind==="constant")return{kind:"constant",layoutSize:o.evaluate(new Di(l+1))};if(o.kind==="source")return{kind:"source"};{const{zoomStops:p,interpolationType:v}=o;let E=0;for(;E<p.length&&p[E]<=l;)E++;E=Math.max(0,E-1);let A=E;for(;A<p.length&&p[A]<l+1;)A++;A=Math.min(p.length-1,A);const P=p[E],z=p[A];return o.kind==="composite"?{kind:"composite",minZoom:P,maxZoom:z,interpolationType:v}:{kind:"camera",minZoom:P,maxZoom:z,minSize:o.evaluate(new Di(P)),maxSize:o.evaluate(new Di(z)),interpolationType:v}}}function Pm(l,r,o){let p="never";const v=l.get(r);return v?p=v:l.get(o)&&(p="always"),p}const wv=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Qi(l,r,o,p,v,E,A,P,z,F,$,W,te){const ie=P?Math.min(ih,Math.round(P[0])):0,re=P?Math.min(ih,Math.round(P[1])):0;l.emplaceBack(r,o,Math.round(32*p),Math.round(32*v),E,A,(ie<<1)+(z?1:0),re,16*F,16*$,256*W,256*te)}function xp(l,r,o){l.emplaceBack(r.x,r.y,o),l.emplaceBack(r.x,r.y,o),l.emplaceBack(r.x,r.y,o),l.emplaceBack(r.x,r.y,o)}function ox(l){for(const r of l.sections)if(pc(r.text))return!0;return!1}class Mm{constructor(r){this.layoutVertexArray=new Vt,this.indexArray=new Yi,this.programConfigurations=r,this.segments=new jn,this.dynamicLayoutVertexArray=new At,this.opacityVertexArray=new ln,this.hasVisibleVertices=!1,this.placedSymbolArray=new ae}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(r,o,p,v){this.isEmpty()||(p&&(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,h_.members),this.indexBuffer=r.createIndexBuffer(this.indexArray,o),this.dynamicLayoutVertexBuffer=r.createVertexBuffer(this.dynamicLayoutVertexArray,Jc.members,!0),this.opacityVertexBuffer=r.createVertexBuffer(this.opacityVertexArray,wv,!0),this.opacityVertexBuffer.itemSize=1),(p||v)&&this.programConfigurations.upload(r))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Yt("SymbolBuffers",Mm);class E_{constructor(r,o,p){this.layoutVertexArray=new r,this.layoutAttributes=o,this.indexArray=new p,this.segments=new jn,this.collisionVertexArray=new bi}upload(r){this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=r.createVertexBuffer(this.collisionVertexArray,ya.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Yt("CollisionBuffers",E_);class vf{constructor(r){this.collisionBoxArray=r.collisionBoxArray,this.zoom=r.zoom,this.globalState=r.globalState,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map((A=>A.id)),this.index=r.index,this.pixelRatio=r.pixelRatio,this.sourceLayerIndex=r.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const o=this.layers[0]._unevaluatedLayout._values;this.textSizeData=bp(this.zoom,o["text-size"]),this.iconSizeData=bp(this.zoom,o["icon-size"]);const p=this.layers[0].layout,v=p.get("symbol-sort-key"),E=p.get("symbol-z-order");this.canOverlap=Pm(p,"text-overlap","text-allow-overlap")!=="never"||Pm(p,"icon-overlap","icon-allow-overlap")!=="never"||p.get("text-ignore-placement")||p.get("icon-ignore-placement"),this.sortFeaturesByKey=E!=="viewport-y"&&!v.isConstant(),this.sortFeaturesByY=(E==="viewport-y"||E==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,p.get("symbol-placement")==="point"&&(this.writingModes=p.get("text-writing-mode").map((A=>g.ao[A]))),this.stateDependentLayerIds=this.layers.filter((A=>A.isStateDependent())).map((A=>A.id)),this.sourceID=r.sourceID}createArrays(){this.text=new Mm(new go(this.layers,this.zoom,(r=>/^text/.test(r)))),this.icon=new Mm(new go(this.layers,this.zoom,(r=>/^icon/.test(r)))),this.glyphOffsetArray=new ve,this.lineVertexArray=new we,this.symbolInstances=new me,this.textAnchorOffsets=new Ce}calculateGlyphDependencies(r,o,p,v,E){for(let A=0;A<r.length;A++)if(o[r.charCodeAt(A)]=!0,(p||v)&&E){const P=io[r.charAt(A)];P&&(o[P.charCodeAt(0)]=!0)}}populate(r,o,p){const v=this.layers[0],E=v.layout,A=E.get("text-font"),P=E.get("text-field"),z=E.get("icon-image"),F=(P.value.kind!=="constant"||P.value.value instanceof Wi&&!P.value.value.isEmpty()||P.value.value.toString().length>0)&&(A.value.kind!=="constant"||A.value.value.length>0),$=z.value.kind!=="constant"||!!z.value.value||Object.keys(z.parameters).length>0,W=E.get("symbol-sort-key");if(this.features=[],!F&&!$)return;const te=o.iconDependencies,ie=o.glyphDependencies,re=o.availableImages,oe=new Di(this.zoom,{globalState:this.globalState});for(const{feature:pe,id:Te,index:Ke,sourceLayerIndex:ke}of r){const Fe=v._featureFilter.needGeometry,ot=wl(pe,Fe);if(!v._featureFilter.filter(oe,ot,p))continue;let gt,Ct;if(Fe||(ot.geometry=uu(pe)),F){const Ft=v.getValueAndResolveTokens("text-field",ot,p,re),Ht=Wi.factory(Ft),dn=this.hasRTLText=this.hasRTLText||ox(Ht);(!dn||yl.getRTLTextPluginStatus()==="unavailable"||dn&&yl.isParsed())&&(gt=d_(Ht,v,ot))}if($){const Ft=v.getValueAndResolveTokens("icon-image",ot,p,re);Ct=Ft instanceof cr?Ft:cr.fromString(Ft)}if(!gt&&!Ct)continue;const Gt=this.sortFeaturesByKey?W.evaluate(ot,{},p):void 0;if(this.features.push({id:Te,text:gt,icon:Ct,index:Ke,sourceLayerIndex:ke,geometry:ot.geometry,properties:pe.properties,type:ls.types[pe.type],sortKey:Gt}),Ct&&(te[Ct.name]=!0),gt){const Ft=A.evaluate(ot,{},p).join(","),Ht=E.get("text-rotation-alignment")!=="viewport"&&E.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(g.ao.vertical)>=0;for(const dn of gt.sections)if(dn.image)te[dn.image.name]=!0;else{const qt=hd(gt.toString()),jt=dn.fontStack||Ft,St=ie[jt]=ie[jt]||{};this.calculateGlyphDependencies(dn.text,St,Ht,this.allowVerticalPlacement,qt)}}}E.get("symbol-placement")==="line"&&(this.features=(function(pe){const Te={},Ke={},ke=[];let Fe=0;function ot(Ft){ke.push(pe[Ft]),Fe++}function gt(Ft,Ht,dn){const qt=Ke[Ft];return delete Ke[Ft],Ke[Ht]=qt,ke[qt].geometry[0].pop(),ke[qt].geometry[0]=ke[qt].geometry[0].concat(dn[0]),qt}function Ct(Ft,Ht,dn){const qt=Te[Ht];return delete Te[Ht],Te[Ft]=qt,ke[qt].geometry[0].shift(),ke[qt].geometry[0]=dn[0].concat(ke[qt].geometry[0]),qt}function Gt(Ft,Ht,dn){const qt=dn?Ht[0][Ht[0].length-1]:Ht[0][0];return`${Ft}:${qt.x}:${qt.y}`}for(let Ft=0;Ft<pe.length;Ft++){const Ht=pe[Ft],dn=Ht.geometry,qt=Ht.text?Ht.text.toString():null;if(!qt){ot(Ft);continue}const jt=Gt(qt,dn),St=Gt(qt,dn,!0);if(jt in Ke&&St in Te&&Ke[jt]!==Te[St]){const Sn=Ct(jt,St,dn),Mn=gt(jt,St,ke[Sn].geometry);delete Te[jt],delete Ke[St],Ke[Gt(qt,ke[Mn].geometry,!0)]=Mn,ke[Sn].geometry=null}else jt in Ke?gt(jt,St,dn):St in Te?Ct(jt,St,dn):(ot(Ft),Te[jt]=Fe-1,Ke[St]=Fe-1)}return ke.filter((Ft=>Ft.geometry))})(this.features)),this.sortFeaturesByKey&&this.features.sort(((pe,Te)=>pe.sortKey-Te.sortKey))}update(r,o,p){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(r,o,this.layers,p),this.icon.programConfigurations.updatePaintArrays(r,o,this.layers,p))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(r){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(r),this.iconCollisionBox.upload(r)),this.text.upload(r,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(r,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(r,o){const p=this.lineVertexArray.length;if(r.segment!==void 0){let v=r.dist(o[r.segment+1]),E=r.dist(o[r.segment]);const A={};for(let P=r.segment+1;P<o.length;P++)A[P]={x:o[P].x,y:o[P].y,tileUnitDistanceFromAnchor:v},P<o.length-1&&(v+=o[P+1].dist(o[P]));for(let P=r.segment||0;P>=0;P--)A[P]={x:o[P].x,y:o[P].y,tileUnitDistanceFromAnchor:E},P>0&&(E+=o[P-1].dist(o[P]));for(let P=0;P<o.length;P++){const z=A[P];this.lineVertexArray.emplaceBack(z.x,z.y,z.tileUnitDistanceFromAnchor)}}return{lineStartIndex:p,lineLength:this.lineVertexArray.length-p}}addSymbols(r,o,p,v,E,A,P,z,F,$,W,te){const ie=r.indexArray,re=r.layoutVertexArray,oe=r.segments.prepareSegment(4*o.length,re,ie,this.canOverlap?A.sortKey:void 0),pe=this.glyphOffsetArray.length,Te=oe.vertexLength,Ke=this.allowVerticalPlacement&&P===g.ao.vertical?Math.PI/2:0,ke=A.text&&A.text.sections;for(let Fe=0;Fe<o.length;Fe++){const{tl:ot,tr:gt,bl:Ct,br:Gt,tex:Ft,pixelOffsetTL:Ht,pixelOffsetBR:dn,minFontScaleX:qt,minFontScaleY:jt,glyphOffset:St,isSDF:Sn,sectionIndex:Mn}=o[Fe],mn=oe.vertexLength,un=St[1];Qi(re,z.x,z.y,ot.x,un+ot.y,Ft.x,Ft.y,p,Sn,Ht.x,Ht.y,qt,jt),Qi(re,z.x,z.y,gt.x,un+gt.y,Ft.x+Ft.w,Ft.y,p,Sn,dn.x,Ht.y,qt,jt),Qi(re,z.x,z.y,Ct.x,un+Ct.y,Ft.x,Ft.y+Ft.h,p,Sn,Ht.x,dn.y,qt,jt),Qi(re,z.x,z.y,Gt.x,un+Gt.y,Ft.x+Ft.w,Ft.y+Ft.h,p,Sn,dn.x,dn.y,qt,jt),xp(r.dynamicLayoutVertexArray,z,Ke),ie.emplaceBack(mn,mn+2,mn+1),ie.emplaceBack(mn+1,mn+2,mn+3),oe.vertexLength+=4,oe.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(St[0]),Fe!==o.length-1&&Mn===o[Fe+1].sectionIndex||r.programConfigurations.populatePaintArrays(re.length,A,A.index,{},te,ke&&ke[Mn])}r.placedSymbolArray.emplaceBack(z.x,z.y,pe,this.glyphOffsetArray.length-pe,Te,F,$,z.segment,p?p[0]:0,p?p[1]:0,v[0],v[1],P,0,!1,0,W)}_addCollisionDebugVertex(r,o,p,v,E,A){return o.emplaceBack(0,0),r.emplaceBack(p.x,p.y,v,E,Math.round(A.x),Math.round(A.y))}addCollisionDebugVertices(r,o,p,v,E,A,P){const z=E.segments.prepareSegment(4,E.layoutVertexArray,E.indexArray),F=z.vertexLength,$=E.layoutVertexArray,W=E.collisionVertexArray,te=P.anchorX,ie=P.anchorY;this._addCollisionDebugVertex($,W,A,te,ie,new C(r,o)),this._addCollisionDebugVertex($,W,A,te,ie,new C(p,o)),this._addCollisionDebugVertex($,W,A,te,ie,new C(p,v)),this._addCollisionDebugVertex($,W,A,te,ie,new C(r,v)),z.vertexLength+=4;const re=E.indexArray;re.emplaceBack(F,F+1),re.emplaceBack(F+1,F+2),re.emplaceBack(F+2,F+3),re.emplaceBack(F+3,F),z.primitiveLength+=4}addDebugCollisionBoxes(r,o,p,v){for(let E=r;E<o;E++){const A=this.collisionBoxArray.get(E);this.addCollisionDebugVertices(A.x1,A.y1,A.x2,A.y2,v?this.textCollisionBox:this.iconCollisionBox,A.anchorPoint,p)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new E_(Hn,eh.members,$i),this.iconCollisionBox=new E_(Hn,eh.members,$i);for(let r=0;r<this.symbolInstances.length;r++){const o=this.symbolInstances.get(r);this.addDebugCollisionBoxes(o.textBoxStartIndex,o.textBoxEndIndex,o,!0),this.addDebugCollisionBoxes(o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o,!0),this.addDebugCollisionBoxes(o.iconBoxStartIndex,o.iconBoxEndIndex,o,!1),this.addDebugCollisionBoxes(o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex,o,!1)}}_deserializeCollisionBoxesForSymbol(r,o,p,v,E,A,P,z,F){const $={};for(let W=o;W<p;W++){const te=r.get(W);$.textBox={x1:te.x1,y1:te.y1,x2:te.x2,y2:te.y2,anchorPointX:te.anchorPointX,anchorPointY:te.anchorPointY},$.textFeatureIndex=te.featureIndex;break}for(let W=v;W<E;W++){const te=r.get(W);$.verticalTextBox={x1:te.x1,y1:te.y1,x2:te.x2,y2:te.y2,anchorPointX:te.anchorPointX,anchorPointY:te.anchorPointY},$.verticalTextFeatureIndex=te.featureIndex;break}for(let W=A;W<P;W++){const te=r.get(W);$.iconBox={x1:te.x1,y1:te.y1,x2:te.x2,y2:te.y2,anchorPointX:te.anchorPointX,anchorPointY:te.anchorPointY},$.iconFeatureIndex=te.featureIndex;break}for(let W=z;W<F;W++){const te=r.get(W);$.verticalIconBox={x1:te.x1,y1:te.y1,x2:te.x2,y2:te.y2,anchorPointX:te.anchorPointX,anchorPointY:te.anchorPointY},$.verticalIconFeatureIndex=te.featureIndex;break}return $}deserializeCollisionBoxes(r){this.collisionArrays=[];for(let o=0;o<this.symbolInstances.length;o++){const p=this.symbolInstances.get(o);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(r,p.textBoxStartIndex,p.textBoxEndIndex,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p.iconBoxStartIndex,p.iconBoxEndIndex,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(r,o){const p=r.placedSymbolArray.get(o),v=p.vertexStartIndex+4*p.numGlyphs;for(let E=p.vertexStartIndex;E<v;E+=4)r.indexArray.emplaceBack(E,E+2,E+1),r.indexArray.emplaceBack(E+1,E+2,E+3)}getSortedSymbolIndexes(r){if(this.sortedAngle===r&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const o=Math.sin(r),p=Math.cos(r),v=[],E=[],A=[];for(let P=0;P<this.symbolInstances.length;++P){A.push(P);const z=this.symbolInstances.get(P);v.push(0|Math.round(o*z.anchorX+p*z.anchorY)),E.push(z.featureIndex)}return A.sort(((P,z)=>v[P]-v[z]||E[z]-E[P])),A}addToSortKeyRanges(r,o){const p=this.sortKeyRanges[this.sortKeyRanges.length-1];p&&p.sortKey===o?p.symbolInstanceEnd=r+1:this.sortKeyRanges.push({sortKey:o,symbolInstanceStart:r,symbolInstanceEnd:r+1})}sortFeatures(r){if(this.sortFeaturesByY&&this.sortedAngle!==r&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(r),this.sortedAngle=r,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const o of this.symbolInstanceIndexes){const p=this.symbolInstances.get(o);this.featureSortOrder.push(p.featureIndex),[p.rightJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.leftJustifiedTextSymbolIndex].forEach(((v,E,A)=>{v>=0&&A.indexOf(v)===E&&this.addIndicesForPlacedSymbol(this.text,v)})),p.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,p.verticalPlacedTextSymbolIndex),p.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,p.placedIconSymbolIndex),p.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,p.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Tv,wp;Yt("SymbolBucket",vf,{omit:["layers","collisionBoxArray","features","compareText"]}),vf.MAX_GLYPHS=65535,vf.addDynamicAttributes=xp;var Oh={get paint(){return wp=wp||new Cs({"icon-opacity":new Tn($e.paint_symbol["icon-opacity"]),"icon-color":new Tn($e.paint_symbol["icon-color"]),"icon-halo-color":new Tn($e.paint_symbol["icon-halo-color"]),"icon-halo-width":new Tn($e.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Tn($e.paint_symbol["icon-halo-blur"]),"icon-translate":new an($e.paint_symbol["icon-translate"]),"icon-translate-anchor":new an($e.paint_symbol["icon-translate-anchor"]),"text-opacity":new Tn($e.paint_symbol["text-opacity"]),"text-color":new Tn($e.paint_symbol["text-color"],{runtimeType:ir,getOverride:l=>l.textColor,hasOverride:l=>!!l.textColor}),"text-halo-color":new Tn($e.paint_symbol["text-halo-color"]),"text-halo-width":new Tn($e.paint_symbol["text-halo-width"]),"text-halo-blur":new Tn($e.paint_symbol["text-halo-blur"]),"text-translate":new an($e.paint_symbol["text-translate"]),"text-translate-anchor":new an($e.paint_symbol["text-translate-anchor"])})},get layout(){return Tv=Tv||new Cs({"symbol-placement":new an($e.layout_symbol["symbol-placement"]),"symbol-spacing":new an($e.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new an($e.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Tn($e.layout_symbol["symbol-sort-key"]),"symbol-z-order":new an($e.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new an($e.layout_symbol["icon-allow-overlap"]),"icon-overlap":new an($e.layout_symbol["icon-overlap"]),"icon-ignore-placement":new an($e.layout_symbol["icon-ignore-placement"]),"icon-optional":new an($e.layout_symbol["icon-optional"]),"icon-rotation-alignment":new an($e.layout_symbol["icon-rotation-alignment"]),"icon-size":new Tn($e.layout_symbol["icon-size"]),"icon-text-fit":new an($e.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new an($e.layout_symbol["icon-text-fit-padding"]),"icon-image":new Tn($e.layout_symbol["icon-image"]),"icon-rotate":new Tn($e.layout_symbol["icon-rotate"]),"icon-padding":new Tn($e.layout_symbol["icon-padding"]),"icon-keep-upright":new an($e.layout_symbol["icon-keep-upright"]),"icon-offset":new Tn($e.layout_symbol["icon-offset"]),"icon-anchor":new Tn($e.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new an($e.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new an($e.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new an($e.layout_symbol["text-rotation-alignment"]),"text-field":new Tn($e.layout_symbol["text-field"]),"text-font":new Tn($e.layout_symbol["text-font"]),"text-size":new Tn($e.layout_symbol["text-size"]),"text-max-width":new Tn($e.layout_symbol["text-max-width"]),"text-line-height":new an($e.layout_symbol["text-line-height"]),"text-letter-spacing":new Tn($e.layout_symbol["text-letter-spacing"]),"text-justify":new Tn($e.layout_symbol["text-justify"]),"text-radial-offset":new Tn($e.layout_symbol["text-radial-offset"]),"text-variable-anchor":new an($e.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Tn($e.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Tn($e.layout_symbol["text-anchor"]),"text-max-angle":new an($e.layout_symbol["text-max-angle"]),"text-writing-mode":new an($e.layout_symbol["text-writing-mode"]),"text-rotate":new Tn($e.layout_symbol["text-rotate"]),"text-padding":new an($e.layout_symbol["text-padding"]),"text-keep-upright":new an($e.layout_symbol["text-keep-upright"]),"text-transform":new Tn($e.layout_symbol["text-transform"]),"text-offset":new Tn($e.layout_symbol["text-offset"]),"text-allow-overlap":new an($e.layout_symbol["text-allow-overlap"]),"text-overlap":new an($e.layout_symbol["text-overlap"]),"text-ignore-placement":new an($e.layout_symbol["text-ignore-placement"]),"text-optional":new an($e.layout_symbol["text-optional"])})}};class Rm{constructor(r){if(r.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=r.property.overrides?r.property.overrides.runtimeType:Ca,this.defaultValue=r}evaluate(r){if(r.formattedSection){const o=this.defaultValue.property.overrides;if(o&&o.hasOverride(r.formattedSection))return o.getOverride(r.formattedSection)}return r.feature&&r.featureState?this.defaultValue.evaluate(r.feature,r.featureState):this.defaultValue.property.specification.default}eachChild(r){this.defaultValue.isConstant()||r(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Yt("FormatSectionOverride",Rm,{omit:["defaultValue"]});class kd extends po{constructor(r){super(r,Oh)}recalculate(r,o){if(super.recalculate(r,o),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const p=this.layout.get("text-writing-mode");if(p){const v=[];for(const E of p)v.indexOf(E)<0&&v.push(E);this.layout._values["text-writing-mode"]=v}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(r,o,p,v){const E=this.layout.get(r).evaluate(o,{},p,v),A=this._unevaluatedLayout._values[r];return A.isDataDriven()||oc(A.value)||!E?E:(function(P,z){return z.replace(/{([^{}]+)}/g,((F,$)=>P&&$ in P?String(P[$]):""))})(o.properties,E)}createBucket(r){return new vf(r)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const r of Oh.paint.overridableProperties){if(!kd.hasPaintOverride(this.layout,r))continue;const o=this.paint.get(r),p=new Rm(o),v=new sc(p,o.property.specification);let E=null;E=o.value.kind==="constant"||o.value.kind==="source"?new f("source",v):new x("composite",v,o.value.zoomStops),this.paint._values[r]=new vl(o.property,E,o.parameters)}}_handleOverridablePaintPropertyUpdate(r,o,p){return!(!this.layout||o.isDataDriven()||p.isDataDriven())&&kd.hasPaintOverride(this.layout,r)}static hasPaintOverride(r,o){const p=r.get("text-field"),v=Oh.paint.properties[o];let E=!1;const A=P=>{for(const z of P)if(v.overrides&&v.overrides.hasOverride(z))return void(E=!0)};if(p.value.kind==="constant"&&p.value.value instanceof Wi)A(p.value.value.sections);else if(p.value.kind==="source"){const P=F=>{E||(F instanceof ia&&fn(F.value)===js?A(F.value.sections):F instanceof ht?A(F.sections):F.eachChild(P))},z=p.value;z._styleExpression&&P(z._styleExpression.expression)}return E}}let km;var Nh={get paint(){return km=km||new Cs({"background-color":new an($e.paint_background["background-color"]),"background-pattern":new jo($e.paint_background["background-pattern"]),"background-opacity":new an($e.paint_background["background-opacity"])})}};class Ec extends po{constructor(r){super(r,Nh)}}let bf;var lx={get paint(){return bf=bf||new Cs({"raster-opacity":new an($e.paint_raster["raster-opacity"]),"raster-hue-rotate":new an($e.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new an($e.paint_raster["raster-brightness-min"]),"raster-brightness-max":new an($e.paint_raster["raster-brightness-max"]),"raster-saturation":new an($e.paint_raster["raster-saturation"]),"raster-contrast":new an($e.paint_raster["raster-contrast"]),"raster-resampling":new an($e.paint_raster["raster-resampling"]),"raster-fade-duration":new an($e.paint_raster["raster-fade-duration"])})}};class Sv extends po{constructor(r){super(r,lx)}}class Ev extends po{constructor(r){super(r,{}),this.onAdd=o=>{this.implementation.onAdd&&this.implementation.onAdd(o,o.painter.context.gl)},this.onRemove=o=>{this.implementation.onRemove&&this.implementation.onRemove(o,o.painter.context.gl)},this.implementation=r}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Av{constructor(r){this._methodToThrottle=r,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._methodToThrottle()}),0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const Cv={once:!0},A_=63710088e-1;class Ac{constructor(r,o){if(isNaN(r)||isNaN(o))throw new Error(`Invalid LngLat object: (${r}, ${o})`);if(this.lng=+r,this.lat=+o,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Ac(Fn(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(r){const o=Math.PI/180,p=this.lat*o,v=r.lat*o,E=Math.sin(p)*Math.sin(v)+Math.cos(p)*Math.cos(v)*Math.cos((r.lng-this.lng)*o);return A_*Math.acos(Math.min(E,1))}static convert(r){if(r instanceof Ac)return r;if(Array.isArray(r)&&(r.length===2||r.length===3))return new Ac(Number(r[0]),Number(r[1]));if(!Array.isArray(r)&&typeof r=="object"&&r!==null)return new Ac(Number("lng"in r?r.lng:r.lon),Number(r.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const C_=2*Math.PI*A_;function I_(l){return C_*Math.cos(l*Math.PI/180)}function Iv(l){return(180+l)/360}function Lm(l){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+l*Math.PI/360)))/360}function Dm(l,r){return l/I_(r)}function P_(l){return 360/Math.PI*Math.atan(Math.exp((180-360*l)*Math.PI/180))-90}function Pv(l,r){return l*I_(P_(r))}class rh{constructor(r,o,p=0){this.x=+r,this.y=+o,this.z=+p}static fromLngLat(r,o=0){const p=Ac.convert(r);return new rh(Iv(p.lng),Lm(p.lat),Dm(o,p.lat))}toLngLat(){return new Ac(360*this.x-180,P_(this.y))}toAltitude(){return Pv(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/C_*(r=P_(this.y),1/Math.cos(r*Math.PI/180));var r}}function Mv(l,r,o){var p=2*Math.PI*6378137/256/Math.pow(2,o);return[l*p-2*Math.PI*6378137/2,r*p-2*Math.PI*6378137/2]}class zm{constructor(r,o,p){if(!(function(v,E,A){return!(v<0||v>25||A<0||A>=Math.pow(2,v)||E<0||E>=Math.pow(2,v))})(r,o,p))throw new Error(`x=${o}, y=${p}, z=${r} outside of bounds. 0<=x<${Math.pow(2,r)}, 0<=y<${Math.pow(2,r)} 0<=z<=25 `);this.z=r,this.x=o,this.y=p,this.key=ah(0,r,r,o,p)}equals(r){return this.z===r.z&&this.x===r.x&&this.y===r.y}url(r,o,p){const v=(A=this.y,P=this.z,z=Mv(256*(E=this.x),256*(A=Math.pow(2,P)-A-1),P),F=Mv(256*(E+1),256*(A+1),P),z[0]+","+z[1]+","+F[0]+","+F[1]);var E,A,P,z,F;const $=(function(W,te,ie){let re,oe="";for(let pe=W;pe>0;pe--)re=1<<pe-1,oe+=(te&re?1:0)+(ie&re?2:0);return oe})(this.z,this.x,this.y);return r[(this.x+this.y)%r.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(p==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,o>1?"@2x":"").replace(/{quadkey}/g,$).replace(/{bbox-epsg-3857}/g,v)}isChildOf(r){const o=this.z-r.z;return o>0&&r.x===this.x>>o&&r.y===this.y>>o}getTilePoint(r){const o=Math.pow(2,this.z);return new C((r.x*o-this.x)*zt,(r.y*o-this.y)*zt)}toString(){return`${this.z}/${this.x}/${this.y}`}}class yi{constructor(r,o){this.wrap=r,this.canonical=o,this.key=ah(r,o.z,o.z,o.x,o.y)}}class Xo{constructor(r,o,p,v,E){if(this.terrainRttPosMatrix32f=null,r<p)throw new Error(`overscaledZ should be >= z; overscaledZ = ${r}; z = ${p}`);this.overscaledZ=r,this.wrap=o,this.canonical=new zm(p,+v,+E),this.key=ah(o,r,p,v,E)}clone(){return new Xo(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(r){return this.overscaledZ===r.overscaledZ&&this.wrap===r.wrap&&this.canonical.equals(r.canonical)}scaledTo(r){if(r>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${r}; overscaledZ = ${this.overscaledZ}`);const o=this.canonical.z-r;return r>this.canonical.z?new Xo(r,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Xo(r,this.wrap,r,this.canonical.x>>o,this.canonical.y>>o)}calculateScaledKey(r,o){if(r>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${r}; overscaledZ = ${this.overscaledZ}`);const p=this.canonical.z-r;return r>this.canonical.z?ah(this.wrap*+o,r,this.canonical.z,this.canonical.x,this.canonical.y):ah(this.wrap*+o,r,r,this.canonical.x>>p,this.canonical.y>>p)}isChildOf(r){if(r.wrap!==this.wrap)return!1;const o=this.canonical.z-r.canonical.z;return r.overscaledZ===0||r.overscaledZ<this.overscaledZ&&r.canonical.x===this.canonical.x>>o&&r.canonical.y===this.canonical.y>>o}children(r){if(this.overscaledZ>=r)return[new Xo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const o=this.canonical.z+1,p=2*this.canonical.x,v=2*this.canonical.y;return[new Xo(o,this.wrap,o,p,v),new Xo(o,this.wrap,o,p+1,v),new Xo(o,this.wrap,o,p,v+1),new Xo(o,this.wrap,o,p+1,v+1)]}isLessThan(r){return this.wrap<r.wrap||!(this.wrap>r.wrap)&&(this.overscaledZ<r.overscaledZ||!(this.overscaledZ>r.overscaledZ)&&(this.canonical.x<r.canonical.x||!(this.canonical.x>r.canonical.x)&&this.canonical.y<r.canonical.y))}wrapped(){return new Xo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(r){return new Xo(this.overscaledZ,r,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new yi(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(r){return this.canonical.getTilePoint(new rh(r.x-this.wrap,r.y))}}function ah(l,r,o,p,v){(l*=2)<0&&(l=-1*l-1);const E=1<<o;return(E*E*l+E*v+p).toString(36)+o.toString(36)+r.toString(36)}function Ld(l,r){return r?l.properties[r]:l.id}Yt("CanonicalTileID",zm),Yt("OverscaledTileID",Xo,{omit:["terrainRttPosMatrix32f"]});class Bh{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(r){return this.minX=Math.min(this.minX,r.x),this.minY=Math.min(this.minY,r.y),this.maxX=Math.max(this.maxX,r.x),this.maxY=Math.max(this.maxY,r.y),this}expandBy(r){return this.minX-=r,this.minY-=r,this.maxX+=r,this.maxY+=r,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(r){return this.expandBy(-r)}map(r){const o=new Bh;return o.extend(r(new C(this.minX,this.minY))),o.extend(r(new C(this.maxX,this.minY))),o.extend(r(new C(this.minX,this.maxY))),o.extend(r(new C(this.maxX,this.maxY))),o}static fromPoints(r){const o=new Bh;for(const p of r)o.extend(p);return o}contains(r){return r.x>=this.minX&&r.x<=this.maxX&&r.y>=this.minY&&r.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(r){return!this.empty()&&!r.empty()&&r.minX>=this.minX&&r.maxX<=this.maxX&&r.minY>=this.minY&&r.maxY<=this.maxY}intersects(r){return!this.empty()&&!r.empty()&&r.minX<=this.maxX&&r.maxX>=this.minX&&r.minY<=this.maxY&&r.maxY>=this.minY}}class Om{constructor(r){this._stringToNumber={},this._numberToString=[];for(let o=0;o<r.length;o++){const p=r[o];this._stringToNumber[p]=o,this._numberToString[o]=p}}encode(r){return this._stringToNumber[r]}decode(r){if(r>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${r} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[r]}}class xf{constructor(r,o,p,v,E){this.type="Feature",this._vectorTileFeature=r,r._z=o,r._x=p,r._y=v,this.properties=r.properties,this.id=E}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(r){this._geometry=r}toJSON(){const r={geometry:this.geometry};for(const o in this)o!=="_geometry"&&o!=="_vectorTileFeature"&&(r[o]=this[o]);return r}}class Tp{constructor(r,o){this.tileID=r,this.x=r.canonical.x,this.y=r.canonical.y,this.z=r.canonical.z,this.grid=new Th(zt,16,0),this.grid3D=new Th(zt,16,0),this.featureIndexArray=new Ve,this.promoteId=o}insert(r,o,p,v,E,A){const P=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(p,v,E);const z=A?this.grid3D:this.grid;for(let F=0;F<o.length;F++){const $=o[F],W=[1/0,1/0,-1/0,-1/0];for(let te=0;te<$.length;te++){const ie=$[te];W[0]=Math.min(W[0],ie.x),W[1]=Math.min(W[1],ie.y),W[2]=Math.max(W[2],ie.x),W[3]=Math.max(W[3],ie.y)}W[0]<zt&&W[1]<zt&&W[2]>=0&&W[3]>=0&&z.insert(P,W[0],W[1],W[2],W[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Tc(new pf(this.rawTileData)).layers,this.sourceLayerCoder=new Om(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(r,o,p,v){this.loadVTLayers();const E=r.params,A=zt/r.tileSize/r.scale,P=ut(E.filter),z=r.queryGeometry,F=r.queryPadding*A,$=Bh.fromPoints(z),W=this.grid.query($.minX-F,$.minY-F,$.maxX+F,$.maxY+F),te=Bh.fromPoints(r.cameraQueryGeometry).expandBy(F),ie=this.grid3D.query(te.minX,te.minY,te.maxX,te.maxY,((pe,Te,Ke,ke)=>(function(Fe,ot,gt,Ct,Gt){for(const Ht of Fe)if(ot<=Ht.x&&gt<=Ht.y&&Ct>=Ht.x&&Gt>=Ht.y)return!0;const Ft=[new C(ot,gt),new C(ot,Gt),new C(Ct,Gt),new C(Ct,gt)];if(Fe.length>2){for(const Ht of Ft)if(vd(Fe,Ht))return!0}for(let Ht=0;Ht<Fe.length-1;Ht++)if(ev(Fe[Ht],Fe[Ht+1],Ft))return!0;return!1})(r.cameraQueryGeometry,pe-F,Te-F,Ke+F,ke+F)));for(const pe of ie)W.push(pe);W.sort(kv);const re={};let oe;for(let pe=0;pe<W.length;pe++){const Te=W[pe];if(Te===oe)continue;oe=Te;const Ke=this.featureIndexArray.get(Te);let ke=null;this.loadMatchingFeature(re,Ke.bucketIndex,Ke.sourceLayerIndex,Ke.featureIndex,P,E.layers,E.availableImages,o,p,v,((Fe,ot,gt)=>(ke||(ke=uu(Fe)),ot.queryIntersectsFeature({queryGeometry:z,feature:Fe,featureState:gt,geometry:ke,zoom:this.z,transform:r.transform,pixelsToTileUnits:A,pixelPosMatrix:r.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:r.getElevation}))))}return re}loadMatchingFeature(r,o,p,v,E,A,P,z,F,$,W){const te=this.bucketLayerIDs[o];if(A&&!te.some((pe=>A.has(pe))))return;const ie=this.sourceLayerCoder.decode(p),re=this.vtLayers[ie].feature(v);if(E.needGeometry){const pe=wl(re,!0);if(!E.filter(new Di(this.tileID.overscaledZ),pe,this.tileID.canonical))return}else if(!E.filter(new Di(this.tileID.overscaledZ),re))return;const oe=this.getId(re,ie);for(let pe=0;pe<te.length;pe++){const Te=te[pe];if(A&&!A.has(Te))continue;const Ke=z[Te];if(!Ke)continue;let ke={};oe&&$&&(ke=$.getState(Ke.sourceLayer||"_geojsonTileLayer",oe));const Fe=oi({},F[Te]);Fe.paint=Rv(Fe.paint,Ke.paint,re,ke,P),Fe.layout=Rv(Fe.layout,Ke.layout,re,ke,P);const ot=!W||W(re,Ke,ke);if(!ot)continue;const gt=new xf(re,this.z,this.x,this.y,oe);gt.layer=Fe;let Ct=r[Te];Ct===void 0&&(Ct=r[Te]=[]),Ct.push({featureIndex:v,feature:gt,intersectionZ:ot})}}lookupSymbolFeatures(r,o,p,v,E,A,P,z){const F={};this.loadVTLayers();const $=ut(E);for(const W of r)this.loadMatchingFeature(F,p,v,W,$,A,P,z,o);return F}hasLayer(r){for(const o of this.bucketLayerIDs)for(const p of o)if(r===p)return!0;return!1}getId(r,o){var p;let v=r.id;return this.promoteId&&(v=r.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[o]],typeof v=="boolean"&&(v=Number(v)),v===void 0&&(!((p=r.properties)===null||p===void 0)&&p.cluster)&&this.promoteId&&(v=Number(r.properties.cluster_id))),v}}function Rv(l,r,o,p,v){return fs(l,((E,A)=>{const P=r instanceof gc?r.get(A):null;return P&&P.evaluate?P.evaluate(o,p,v):P}))}function kv(l,r){return r-l}function Lv(l,r,o,p,v){const E=[];for(let A=0;A<l.length;A++){const P=l[A];let z;for(let F=0;F<P.length-1;F++){let $=P[F],W=P[F+1];$.x<r&&W.x<r||($.x<r?$=new C(r,$.y+(r-$.x)/(W.x-$.x)*(W.y-$.y))._round():W.x<r&&(W=new C(r,$.y+(r-$.x)/(W.x-$.x)*(W.y-$.y))._round()),$.y<o&&W.y<o||($.y<o?$=new C($.x+(o-$.y)/(W.y-$.y)*(W.x-$.x),o)._round():W.y<o&&(W=new C($.x+(o-$.y)/(W.y-$.y)*(W.x-$.x),o)._round()),$.x>=p&&W.x>=p||($.x>=p?$=new C(p,$.y+(p-$.x)/(W.x-$.x)*(W.y-$.y))._round():W.x>=p&&(W=new C(p,$.y+(p-$.x)/(W.x-$.x)*(W.y-$.y))._round()),$.y>=v&&W.y>=v||($.y>=v?$=new C($.x+(v-$.y)/(W.y-$.y)*(W.x-$.x),v)._round():W.y>=v&&(W=new C($.x+(v-$.y)/(W.y-$.y)*(W.x-$.x),v)._round()),z&&$.equals(z[z.length-1])||(z=[$],E.push(z)),z.push(W)))))}}return E}Yt("FeatureIndex",Tp,{omit:["rawTileData","sourceLayerCoder"]});class Fh extends C{constructor(r,o,p,v){super(r,o),this.angle=p,v!==void 0&&(this.segment=v)}clone(){return new Fh(this.x,this.y,this.angle,this.segment)}}function M_(l,r,o,p,v){if(r.segment===void 0||o===0)return!0;let E=r,A=r.segment+1,P=0;for(;P>-o/2;){if(A--,A<0)return!1;P-=l[A].dist(E),E=l[A]}P+=l[A].dist(l[A+1]),A++;const z=[];let F=0;for(;P<o/2;){const $=l[A],W=l[A+1];if(!W)return!1;let te=l[A-1].angleTo($)-$.angleTo(W);for(te=Math.abs((te+3*Math.PI)%(2*Math.PI)-Math.PI),z.push({distance:P,angleDelta:te}),F+=te;P-z[0].distance>p;)F-=z.shift().angleDelta;if(F>v)return!1;A++,P+=$.dist(W)}return!0}function R_(l){let r=0;for(let o=0;o<l.length-1;o++)r+=l[o].dist(l[o+1]);return r}function _r(l,r,o){return l?.6*r*o:0}function Nm(l,r){return Math.max(l?l.right-l.left:0,r?r.right-r.left:0)}function ro(l,r,o,p,v,E){const A=_r(o,v,E),P=Nm(o,p)*E;let z=0;const F=R_(l)/2;for(let $=0;$<l.length-1;$++){const W=l[$],te=l[$+1],ie=W.dist(te);if(z+ie>F){const re=(F-z)/ie,oe=Ts.number(W.x,te.x,re),pe=Ts.number(W.y,te.y,re),Te=new Fh(oe,pe,te.angleTo(W),$);return Te._round(),!A||M_(l,Te,P,A,r)?Te:void 0}z+=ie}}function ux(l,r,o,p,v,E,A,P,z){const F=_r(p,E,A),$=Nm(p,v),W=$*A,te=l[0].x===0||l[0].x===z||l[0].y===0||l[0].y===z;return r-W<r/4&&(r=W+r/4),k_(l,te?r/2*P%r:($/2+2*E)*A*P%r,r,F,o,W,te,!1,z)}function k_(l,r,o,p,v,E,A,P,z){const F=E/2,$=R_(l);let W=0,te=r-o,ie=[];for(let re=0;re<l.length-1;re++){const oe=l[re],pe=l[re+1],Te=oe.dist(pe),Ke=pe.angleTo(oe);for(;te+o<W+Te;){te+=o;const ke=(te-W)/Te,Fe=Ts.number(oe.x,pe.x,ke),ot=Ts.number(oe.y,pe.y,ke);if(Fe>=0&&Fe<z&&ot>=0&&ot<z&&te-F>=0&&te+F<=$){const gt=new Fh(Fe,ot,Ke,re);gt._round(),p&&!M_(l,gt,E,p,v)||ie.push(gt)}}W+=Te}return P||ie.length||A||(ie=k_(l,W/2,o,p,v,E,A,!0,z)),ie}function Dv(l,r,o,p){const v=[],E=l.image,A=E.pixelRatio,P=E.paddedRect.w-2,z=E.paddedRect.h-2;let F={x1:l.left,y1:l.top,x2:l.right,y2:l.bottom};const $=E.stretchX||[[0,P]],W=E.stretchY||[[0,z]],te=(St,Sn)=>St+Sn[1]-Sn[0],ie=$.reduce(te,0),re=W.reduce(te,0),oe=P-ie,pe=z-re;let Te=0,Ke=ie,ke=0,Fe=re,ot=0,gt=oe,Ct=0,Gt=pe;if(E.content&&p){const St=E.content,Sn=St[2]-St[0],Mn=St[3]-St[1];(E.textFitWidth||E.textFitHeight)&&(F=T_(l)),Te=wf($,0,St[0]),ke=wf(W,0,St[1]),Ke=wf($,St[0],St[2]),Fe=wf(W,St[1],St[3]),ot=St[0]-Te,Ct=St[1]-ke,gt=Sn-Ke,Gt=Mn-Fe}const Ft=F.x1,Ht=F.y1,dn=F.x2-Ft,qt=F.y2-Ht,jt=(St,Sn,Mn,mn)=>{const un=Dd(St.stretch-Te,Ke,dn,Ft),Qn=Sp(St.fixed-ot,gt,St.stretch,ie),Yr=Dd(Sn.stretch-ke,Fe,qt,Ht),va=Sp(Sn.fixed-Ct,Gt,Sn.stretch,re),cs=Dd(Mn.stretch-Te,Ke,dn,Ft),Al=Sp(Mn.fixed-ot,gt,Mn.stretch,ie),vo=Dd(mn.stretch-ke,Fe,qt,Ht),za=Sp(mn.fixed-Ct,Gt,mn.stretch,re),kr=new C(un,Yr),Oa=new C(cs,Yr),ba=new C(cs,vo),hs=new C(un,vo),bo=new C(Qn/A,va/A),Yo=new C(Al/A,za/A),xa=r*Math.PI/180;if(xa){const Na=Math.sin(xa),wa=Math.cos(xa),yr=[wa,-Na,Na,wa];kr._matMult(yr),Oa._matMult(yr),hs._matMult(yr),ba._matMult(yr)}const ks=St.stretch+St.fixed,ha=Sn.stretch+Sn.fixed;return{tl:kr,tr:Oa,bl:hs,br:ba,tex:{x:E.paddedRect.x+1+ks,y:E.paddedRect.y+1+ha,w:Mn.stretch+Mn.fixed-ks,h:mn.stretch+mn.fixed-ha},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:bo,pixelOffsetBR:Yo,minFontScaleX:gt/A/dn,minFontScaleY:Gt/A/qt,isSDF:o}};if(p&&(E.stretchX||E.stretchY)){const St=Bm($,oe,ie),Sn=Bm(W,pe,re);for(let Mn=0;Mn<St.length-1;Mn++){const mn=St[Mn],un=St[Mn+1];for(let Qn=0;Qn<Sn.length-1;Qn++)v.push(jt(mn,Sn[Qn],un,Sn[Qn+1]))}}else v.push(jt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:P+1},{fixed:0,stretch:z+1}));return v}function wf(l,r,o){let p=0;for(const v of l)p+=Math.max(r,Math.min(o,v[1]))-Math.max(r,Math.min(o,v[0]));return p}function Bm(l,r,o){const p=[{fixed:-1,stretch:0}];for(const[v,E]of l){const A=p[p.length-1];p.push({fixed:v-A.stretch,stretch:A.stretch}),p.push({fixed:v-A.stretch,stretch:A.stretch+(E-v)})}return p.push({fixed:r+1,stretch:o}),p}function Dd(l,r,o,p){return l/r*o+p}function Sp(l,r,o,p){return l-r*o/p}Yt("Anchor",Fh);class Ep{constructor(r,o,p,v,E,A,P,z,F,$){var W;if(this.boxStartIndex=r.length,F){let te=A.top,ie=A.bottom;const re=A.collisionPadding;re&&(te-=re[1],ie+=re[3]);let oe=ie-te;oe>0&&(oe=Math.max(10,oe),this.circleDiameter=oe)}else{const te=!((W=A.image)===null||W===void 0)&&W.content&&(A.image.textFitWidth||A.image.textFitHeight)?T_(A):{x1:A.left,y1:A.top,x2:A.right,y2:A.bottom};te.y1=te.y1*P-z[0],te.y2=te.y2*P+z[2],te.x1=te.x1*P-z[3],te.x2=te.x2*P+z[1];const ie=A.collisionPadding;if(ie&&(te.x1-=ie[0]*P,te.y1-=ie[1]*P,te.x2+=ie[2]*P,te.y2+=ie[3]*P),$){const re=new C(te.x1,te.y1),oe=new C(te.x2,te.y1),pe=new C(te.x1,te.y2),Te=new C(te.x2,te.y2),Ke=$*Math.PI/180;re._rotate(Ke),oe._rotate(Ke),pe._rotate(Ke),Te._rotate(Ke),te.x1=Math.min(re.x,oe.x,pe.x,Te.x),te.x2=Math.max(re.x,oe.x,pe.x,Te.x),te.y1=Math.min(re.y,oe.y,pe.y,Te.y),te.y2=Math.max(re.y,oe.y,pe.y,Te.y)}r.emplaceBack(o.x,o.y,te.x1,te.y1,te.x2,te.y2,p,v,E)}this.boxEndIndex=r.length}}class L_{constructor(r=[],o=(p,v)=>p<v?-1:p>v?1:0){if(this.data=r,this.length=this.data.length,this.compare=o,this.length>0)for(let p=(this.length>>1)-1;p>=0;p--)this._down(p)}push(r){this.data.push(r),this._up(this.length++)}pop(){if(this.length===0)return;const r=this.data[0],o=this.data.pop();return--this.length>0&&(this.data[0]=o,this._down(0)),r}peek(){return this.data[0]}_up(r){const{data:o,compare:p}=this,v=o[r];for(;r>0;){const E=r-1>>1,A=o[E];if(p(v,A)>=0)break;o[r]=A,r=E}o[r]=v}_down(r){const{data:o,compare:p}=this,v=this.length>>1,E=o[r];for(;r<v;){let A=1+(r<<1);const P=A+1;if(P<this.length&&p(o[P],o[A])<0&&(A=P),p(o[A],E)>=0)break;o[r]=o[A],r=A}o[r]=E}}function D_(l,r=1,o=!1){const p=Bh.fromPoints(l[0]),v=Math.min(p.width(),p.height());let E=v/2;const A=new L_([],cx),{minX:P,minY:z,maxX:F,maxY:$}=p;if(v===0)return new C(P,z);for(let ie=P;ie<F;ie+=v)for(let re=z;re<$;re+=v)A.push(new zd(ie+E,re+E,E,l));let W=(function(ie){let re=0,oe=0,pe=0;const Te=ie[0];for(let Ke=0,ke=Te.length,Fe=ke-1;Ke<ke;Fe=Ke++){const ot=Te[Ke],gt=Te[Fe],Ct=ot.x*gt.y-gt.x*ot.y;oe+=(ot.x+gt.x)*Ct,pe+=(ot.y+gt.y)*Ct,re+=3*Ct}return new zd(oe/re,pe/re,0,ie)})(l),te=A.length;for(;A.length;){const ie=A.pop();(ie.d>W.d||!W.d)&&(W=ie,o&&console.log("found best %d after %d probes",Math.round(1e4*ie.d)/1e4,te)),ie.max-W.d<=r||(E=ie.h/2,A.push(new zd(ie.p.x-E,ie.p.y-E,E,l)),A.push(new zd(ie.p.x+E,ie.p.y-E,E,l)),A.push(new zd(ie.p.x-E,ie.p.y+E,E,l)),A.push(new zd(ie.p.x+E,ie.p.y+E,E,l)),te+=4)}return o&&(console.log(`num probes: ${te}`),console.log(`best distance: ${W.d}`)),W.p}function cx(l,r){return r.max-l.max}function zd(l,r,o,p){this.p=new C(l,r),this.h=o,this.d=(function(v,E){let A=!1,P=1/0;for(let z=0;z<E.length;z++){const F=E[z];for(let $=0,W=F.length,te=W-1;$<W;te=$++){const ie=F[$],re=F[te];ie.y>v.y!=re.y>v.y&&v.x<(re.x-ie.x)*(v.y-ie.y)/(re.y-ie.y)+ie.x&&(A=!A),P=Math.min(P,Mh(v,ie,re))}}return(A?1:-1)*Math.sqrt(P)})(this.p,p),this.max=this.d+this.h*Math.SQRT2}var Rs;g.aE=void 0,(Rs=g.aE||(g.aE={}))[Rs.center=1]="center",Rs[Rs.left=2]="left",Rs[Rs.right=3]="right",Rs[Rs.top=4]="top",Rs[Rs.bottom=5]="bottom",Rs[Rs["top-left"]=6]="top-left",Rs[Rs["top-right"]=7]="top-right",Rs[Rs["bottom-left"]=8]="bottom-left",Rs[Rs["bottom-right"]=9]="bottom-right";const Fm=Number.POSITIVE_INFINITY;function zv(l,r){return r[1]!==Fm?(function(o,p,v){let E=0,A=0;switch(p=Math.abs(p),v=Math.abs(v),o){case"top-right":case"top-left":case"top":A=v-7;break;case"bottom-right":case"bottom-left":case"bottom":A=7-v}switch(o){case"top-right":case"bottom-right":case"right":E=-p;break;case"top-left":case"bottom-left":case"left":E=p}return[E,A]})(l,r[0],r[1]):(function(o,p){let v=0,E=0;p<0&&(p=0);const A=p/Math.SQRT2;switch(o){case"top-right":case"top-left":E=A-7;break;case"bottom-right":case"bottom-left":E=7-A;break;case"bottom":E=7-p;break;case"top":E=p-7}switch(o){case"top-right":case"bottom-right":v=-A;break;case"top-left":case"bottom-left":v=A;break;case"left":v=p;break;case"right":v=-p}return[v,E]})(l,r[0])}function Ov(l,r,o){var p;const v=l.layout,E=(p=v.get("text-variable-anchor-offset"))===null||p===void 0?void 0:p.evaluate(r,{},o);if(E){const P=E.values,z=[];for(let F=0;F<P.length;F+=2){const $=z[F]=P[F],W=P[F+1].map((te=>te*Xr));$.startsWith("top")?W[1]-=7:$.startsWith("bottom")&&(W[1]+=7),z[F+1]=W}return new sr(z)}const A=v.get("text-variable-anchor");if(A){let P;P=l._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[v.get("text-radial-offset").evaluate(r,{},o)*Xr,Fm]:v.get("text-offset").evaluate(r,{},o).map((F=>F*Xr));const z=[];for(const F of A)z.push(F,zv(F,P));return new sr(z)}return null}function Cc(l){switch(l){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Nv(l,r,o,p,v,E,A,P,z,F,$,W){let te=E.textMaxSize.evaluate(r,{});te===void 0&&(te=A);const ie=l.layers[0].layout,re=ie.get("icon-offset").evaluate(r,{},$),oe=Vm(o.horizontal),pe=A/24,Te=l.tilePixelRatio*pe,Ke=l.tilePixelRatio*te/24,ke=l.tilePixelRatio*P,Fe=l.tilePixelRatio*ie.get("symbol-spacing"),ot=ie.get("text-padding")*l.tilePixelRatio,gt=(function(Mn,mn,un,Qn=1){const Yr=Mn.get("icon-padding").evaluate(mn,{},un),va=Yr&&Yr.values;return[va[0]*Qn,va[1]*Qn,va[2]*Qn,va[3]*Qn]})(ie,r,$,l.tilePixelRatio),Ct=ie.get("text-max-angle")/180*Math.PI,Gt=ie.get("text-rotation-alignment")!=="viewport"&&ie.get("symbol-placement")!=="point",Ft=ie.get("icon-rotation-alignment")==="map"&&ie.get("symbol-placement")!=="point",Ht=ie.get("symbol-placement"),dn=Fe/2,qt=ie.get("icon-text-fit");let jt;p&&qt!=="none"&&(l.allowVerticalPlacement&&o.vertical&&(jt=S_(p,o.vertical,qt,ie.get("icon-text-fit-padding"),re,pe)),oe&&(p=S_(p,oe,qt,ie.get("icon-text-fit-padding"),re,pe)));const St=$?W.line.getGranularityForZoomLevel($.z):1,Sn=(Mn,mn)=>{mn.x<0||mn.x>=zt||mn.y<0||mn.y>=zt||(function(un,Qn,Yr,va,cs,Al,vo,za,kr,Oa,ba,hs,bo,Yo,xa,ks,ha,Na,wa,yr,Ii,Ls,Ic,Qo,Vh){const Sf=un.addToLineVertexArray(Qn,Yr);let Uh,Pc,Ef,Nd,Pp=0,O_=0,Fv=0,Mp=0,Af=-1,Zm=-1;const Cl={};let N_=Xc("");if(un.allowVerticalPlacement&&va.vertical){const bt=za.layout.get("text-rotate").evaluate(Ii,{},Qo)+90;Ef=new Ep(kr,Qn,Oa,ba,hs,va.vertical,bo,Yo,xa,bt),vo&&(Nd=new Ep(kr,Qn,Oa,ba,hs,vo,ha,Na,xa,bt))}if(cs){const bt=za.layout.get("icon-rotate").evaluate(Ii,{}),Et=za.layout.get("icon-text-fit")!=="none",ft=Dv(cs,bt,Ic,Et),yt=vo?Dv(vo,bt,Ic,Et):void 0;Pc=new Ep(kr,Qn,Oa,ba,hs,cs,ha,Na,!1,bt),Pp=4*ft.length;const cn=un.iconSizeData;let En=null;cn.kind==="source"?(En=[Sc*za.layout.get("icon-size").evaluate(Ii,{})],En[0]>ih&&Mi(`${un.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):cn.kind==="composite"&&(En=[Sc*Ls.compositeIconSizes[0].evaluate(Ii,{},Qo),Sc*Ls.compositeIconSizes[1].evaluate(Ii,{},Qo)],(En[0]>ih||En[1]>ih)&&Mi(`${un.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),un.addSymbols(un.icon,ft,En,yr,wa,Ii,g.ao.none,Qn,Sf.lineStartIndex,Sf.lineLength,-1,Qo),Af=un.icon.placedSymbolArray.length-1,yt&&(O_=4*yt.length,un.addSymbols(un.icon,yt,En,yr,wa,Ii,g.ao.vertical,Qn,Sf.lineStartIndex,Sf.lineLength,-1,Qo),Zm=un.icon.placedSymbolArray.length-1)}const Wm=Object.keys(va.horizontal);for(const bt of Wm){const Et=va.horizontal[bt];if(!Uh){N_=Xc(Et.text);const yt=za.layout.get("text-rotate").evaluate(Ii,{},Qo);Uh=new Ep(kr,Qn,Oa,ba,hs,Et,bo,Yo,xa,yt)}const ft=Et.positionedLines.length===1;if(Fv+=z_(un,Qn,Et,Al,za,xa,Ii,ks,Sf,va.vertical?g.ao.horizontal:g.ao.horizontalOnly,ft?Wm:[bt],Cl,Af,Ls,Qo),ft)break}va.vertical&&(Mp+=z_(un,Qn,va.vertical,Al,za,xa,Ii,ks,Sf,g.ao.vertical,["vertical"],Cl,Zm,Ls,Qo));const Km=Uh?Uh.boxStartIndex:un.collisionBoxArray.length,Vv=Uh?Uh.boxEndIndex:un.collisionBoxArray.length,dx=Ef?Ef.boxStartIndex:un.collisionBoxArray.length,Xm=Ef?Ef.boxEndIndex:un.collisionBoxArray.length,s=Pc?Pc.boxStartIndex:un.collisionBoxArray.length,h=Pc?Pc.boxEndIndex:un.collisionBoxArray.length,y=Nd?Nd.boxStartIndex:un.collisionBoxArray.length,w=Nd?Nd.boxEndIndex:un.collisionBoxArray.length;let D=-1;const B=(bt,Et)=>bt&&bt.circleDiameter?Math.max(bt.circleDiameter,Et):Et;D=B(Uh,D),D=B(Ef,D),D=B(Pc,D),D=B(Nd,D);const Q=D>-1?1:0;Q&&(D*=Vh/Xr),un.glyphOffsetArray.length>=vf.MAX_GLYPHS&&Mi("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Ii.sortKey!==void 0&&un.addToSortKeyRanges(un.symbolInstances.length,Ii.sortKey);const he=Ov(za,Ii,Qo),[Ue,dt]=(function(bt,Et){const ft=bt.length,yt=Et==null?void 0:Et.values;if((yt==null?void 0:yt.length)>0)for(let cn=0;cn<yt.length;cn+=2){const En=yt[cn+1];bt.emplaceBack(g.aE[yt[cn]],En[0],En[1])}return[ft,bt.length]})(un.textAnchorOffsets,he);un.symbolInstances.emplaceBack(Qn.x,Qn.y,Cl.right>=0?Cl.right:-1,Cl.center>=0?Cl.center:-1,Cl.left>=0?Cl.left:-1,Cl.vertical||-1,Af,Zm,N_,Km,Vv,dx,Xm,s,h,y,w,Oa,Fv,Mp,Pp,O_,Q,0,bo,D,Ue,dt)})(l,mn,Mn,o,p,v,jt,l.layers[0],l.collisionBoxArray,r.index,r.sourceLayerIndex,l.index,Te,[ot,ot,ot,ot],Gt,z,ke,gt,Ft,re,r,E,F,$,A)};if(Ht==="line")for(const Mn of Lv(r.geometry,0,0,zt,zt)){const mn=ea(Mn,St),un=ux(mn,Fe,Ct,o.vertical||oe,p,24,Ke,l.overscaling,zt);for(const Qn of un)oe&&hx(l,oe.text,dn,Qn)||Sn(mn,Qn)}else if(Ht==="line-center"){for(const Mn of r.geometry)if(Mn.length>1){const mn=ea(Mn,St),un=ro(mn,Ct,o.vertical||oe,p,24,Ke);un&&Sn(mn,un)}}else if(r.type==="Polygon")for(const Mn of Ju(r.geometry,0)){const mn=D_(Mn,16);Sn(ea(Mn[0],St,!0),new Fh(mn.x,mn.y,0))}else if(r.type==="LineString")for(const Mn of r.geometry){const mn=ea(Mn,St);Sn(mn,new Fh(mn[0].x,mn[0].y,0))}else if(r.type==="Point")for(const Mn of r.geometry)for(const mn of Mn)Sn([mn],new Fh(mn.x,mn.y,0))}function z_(l,r,o,p,v,E,A,P,z,F,$,W,te,ie,re){const oe=(function(Ke,ke,Fe,ot,gt,Ct,Gt,Ft){const Ht=ot.layout.get("text-rotate").evaluate(Ct,{})*Math.PI/180,dn=[];for(const qt of ke.positionedLines)for(const jt of qt.positionedGlyphs){if(!jt.rect)continue;const St=jt.rect||{};let Sn=4,Mn=!0,mn=1,un=0;const Qn=(gt||Ft)&&jt.vertical,Yr=jt.metrics.advance*jt.scale/2;if(Ft&&ke.verticalizable&&(un=qt.lineOffset/2-(jt.imageName?-(Xr-jt.metrics.width*jt.scale)/2:(jt.scale-1)*Xr)),jt.imageName){const Na=Gt[jt.imageName];Mn=Na.sdf,mn=Na.pixelRatio,Sn=1/mn}const va=gt?[jt.x+Yr,jt.y]:[0,0];let cs=gt?[0,0]:[jt.x+Yr+Fe[0],jt.y+Fe[1]-un],Al=[0,0];Qn&&(Al=cs,cs=[0,0]);const vo=jt.metrics.isDoubleResolution?2:1,za=(jt.metrics.left-Sn)*jt.scale-Yr+cs[0],kr=(-jt.metrics.top-Sn)*jt.scale+cs[1],Oa=za+St.w/vo*jt.scale/mn,ba=kr+St.h/vo*jt.scale/mn,hs=new C(za,kr),bo=new C(Oa,kr),Yo=new C(za,ba),xa=new C(Oa,ba);if(Qn){const Na=new C(-Yr,Yr- -17),wa=-Math.PI/2,yr=12-Yr,Ii=new C(22-yr,-(jt.imageName?yr:0)),Ls=new C(...Al);hs._rotateAround(wa,Na)._add(Ii)._add(Ls),bo._rotateAround(wa,Na)._add(Ii)._add(Ls),Yo._rotateAround(wa,Na)._add(Ii)._add(Ls),xa._rotateAround(wa,Na)._add(Ii)._add(Ls)}if(Ht){const Na=Math.sin(Ht),wa=Math.cos(Ht),yr=[wa,-Na,Na,wa];hs._matMult(yr),bo._matMult(yr),Yo._matMult(yr),xa._matMult(yr)}const ks=new C(0,0),ha=new C(0,0);dn.push({tl:hs,tr:bo,bl:Yo,br:xa,tex:St,writingMode:ke.writingMode,glyphOffset:va,sectionIndex:jt.sectionIndex,isSDF:Mn,pixelOffsetTL:ks,pixelOffsetBR:ha,minFontScaleX:0,minFontScaleY:0})}return dn})(0,o,P,v,E,A,p,l.allowVerticalPlacement),pe=l.textSizeData;let Te=null;pe.kind==="source"?(Te=[Sc*v.layout.get("text-size").evaluate(A,{})],Te[0]>ih&&Mi(`${l.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):pe.kind==="composite"&&(Te=[Sc*ie.compositeTextSizes[0].evaluate(A,{},re),Sc*ie.compositeTextSizes[1].evaluate(A,{},re)],(Te[0]>ih||Te[1]>ih)&&Mi(`${l.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),l.addSymbols(l.text,oe,Te,P,E,A,F,r,z.lineStartIndex,z.lineLength,te,re);for(const Ke of $)W[Ke]=l.text.placedSymbolArray.length-1;return 4*oe.length}function Vm(l){for(const r in l)return l[r];return null}function hx(l,r,o,p){const v=l.compareText;if(r in v){const E=v[r];for(let A=E.length-1;A>=0;A--)if(p.dist(E[A])<o)return!0}else v[r]=[];return v[r].push(p),!1}const Bv=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Um{static from(r){if(!(r instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[o,p]=new Uint8Array(r,0,2);if(o!==219)throw new Error("Data does not appear to be in a KDBush format.");const v=p>>4;if(v!==1)throw new Error(`Got v${v} data when expected v1.`);const E=Bv[15&p];if(!E)throw new Error("Unrecognized array type.");const[A]=new Uint16Array(r,2,1),[P]=new Uint32Array(r,4,1);return new Um(P,A,E,r)}constructor(r,o=64,p=Float64Array,v){if(isNaN(r)||r<0)throw new Error(`Unpexpected numItems value: ${r}.`);this.numItems=+r,this.nodeSize=Math.min(Math.max(+o,2),65535),this.ArrayType=p,this.IndexArrayType=r<65536?Uint16Array:Uint32Array;const E=Bv.indexOf(this.ArrayType),A=2*r*this.ArrayType.BYTES_PER_ELEMENT,P=r*this.IndexArrayType.BYTES_PER_ELEMENT,z=(8-P%8)%8;if(E<0)throw new Error(`Unexpected typed array class: ${p}.`);v&&v instanceof ArrayBuffer?(this.data=v,this.ids=new this.IndexArrayType(this.data,8,r),this.coords=new this.ArrayType(this.data,8+P+z,2*r),this._pos=2*r,this._finished=!0):(this.data=new ArrayBuffer(8+A+P+z),this.ids=new this.IndexArrayType(this.data,8,r),this.coords=new this.ArrayType(this.data,8+P+z,2*r),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+E]),new Uint16Array(this.data,2,1)[0]=o,new Uint32Array(this.data,4,1)[0]=r)}add(r,o){const p=this._pos>>1;return this.ids[p]=p,this.coords[this._pos++]=r,this.coords[this._pos++]=o,p}finish(){const r=this._pos>>1;if(r!==this.numItems)throw new Error(`Added ${r} items when expected ${this.numItems}.`);return Ap(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(r,o,p,v){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:E,coords:A,nodeSize:P}=this,z=[0,E.length-1,0],F=[];for(;z.length;){const $=z.pop()||0,W=z.pop()||0,te=z.pop()||0;if(W-te<=P){for(let pe=te;pe<=W;pe++){const Te=A[2*pe],Ke=A[2*pe+1];Te>=r&&Te<=p&&Ke>=o&&Ke<=v&&F.push(E[pe])}continue}const ie=te+W>>1,re=A[2*ie],oe=A[2*ie+1];re>=r&&re<=p&&oe>=o&&oe<=v&&F.push(E[ie]),($===0?r<=re:o<=oe)&&(z.push(te),z.push(ie-1),z.push(1-$)),($===0?p>=re:v>=oe)&&(z.push(ie+1),z.push(W),z.push(1-$))}return F}within(r,o,p){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:v,coords:E,nodeSize:A}=this,P=[0,v.length-1,0],z=[],F=p*p;for(;P.length;){const $=P.pop()||0,W=P.pop()||0,te=P.pop()||0;if(W-te<=A){for(let pe=te;pe<=W;pe++)$m(E[2*pe],E[2*pe+1],r,o)<=F&&z.push(v[pe]);continue}const ie=te+W>>1,re=E[2*ie],oe=E[2*ie+1];$m(re,oe,r,o)<=F&&z.push(v[ie]),($===0?r-p<=re:o-p<=oe)&&(P.push(te),P.push(ie-1),P.push(1-$)),($===0?r+p>=re:o+p>=oe)&&(P.push(ie+1),P.push(W),P.push(1-$))}return z}}function Ap(l,r,o,p,v,E){if(v-p<=o)return;const A=p+v>>1;jm(l,r,A,p,v,E),Ap(l,r,o,p,A-1,1-E),Ap(l,r,o,A+1,v,1-E)}function jm(l,r,o,p,v,E){for(;v>p;){if(v-p>600){const F=v-p+1,$=o-p+1,W=Math.log(F),te=.5*Math.exp(2*W/3),ie=.5*Math.sqrt(W*te*(F-te)/F)*($-F/2<0?-1:1);jm(l,r,o,Math.max(p,Math.floor(o-$*te/F+ie)),Math.min(v,Math.floor(o+(F-$)*te/F+ie)),E)}const A=r[2*o+E];let P=p,z=v;for(Cp(l,r,p,o),r[2*v+E]>A&&Cp(l,r,p,v);P<z;){for(Cp(l,r,P,z),P++,z--;r[2*P+E]<A;)P++;for(;r[2*z+E]>A;)z--}r[2*p+E]===A?Cp(l,r,p,z):(z++,Cp(l,r,z,v)),z<=o&&(p=z+1),o<=z&&(v=z-1)}}function Cp(l,r,o,p){Sl(l,o,p),Sl(r,2*o,2*p),Sl(r,2*o+1,2*p+1)}function Sl(l,r,o){const p=l[r];l[r]=l[o],l[o]=p}function $m(l,r,o,p){const v=l-o,E=r-p;return v*v+E*E}var qm;g.cx=void 0,(qm=g.cx||(g.cx={})).create="create",qm.load="load",qm.fullLoad="fullLoad";let Ip=null,Tf=[];const Od=1e3/60,El="loadTime",Gm="fullLoadTime",Hm={mark(l){performance.mark(l)},frame(l){const r=l;Ip!=null&&Tf.push(r-Ip),Ip=r},clearMetrics(){Ip=null,Tf=[],performance.clearMeasures(El),performance.clearMeasures(Gm);for(const l in g.cx)performance.clearMarks(g.cx[l])},getPerformanceMetrics(){performance.measure(El,g.cx.create,g.cx.load),performance.measure(Gm,g.cx.create,g.cx.fullLoad);const l=performance.getEntriesByName(El)[0].duration,r=performance.getEntriesByName(Gm)[0].duration,o=Tf.length,p=1/(Tf.reduce(((E,A)=>E+A),0)/o/1e3),v=Tf.filter((E=>E>Od)).reduce(((E,A)=>E+(A-Od)/Od),0);return{loadTime:l,fullLoadTime:r,fps:p,percentDroppedFrames:v/(o+v)*100,totalFrames:o}}};g.$=zt,g.A=qe,g.B=function([l,r,o]){return r+=90,r*=Math.PI/180,o*=Math.PI/180,{x:l*Math.cos(r)*Math.sin(o),y:l*Math.sin(r)*Math.sin(o),z:l*Math.cos(o)}},g.C=Ts,g.D=an,g.E=tn,g.F=Di,g.G=tu,g.H=function(l){if(Fs==null){const r=l.navigator?l.navigator.userAgent:null;Fs=!!l.safari||!(!r||!(/\b(iPad|iPhone|iPod)\b/.test(r)||r.match("Safari")&&!r.match("Chrome")))}return Fs},g.I=yo,g.J=class{constructor(l,r){this.target=l,this.mapId=r,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new Av((()=>this.process())),this.subscription=oo(this.target,"message",(o=>this.receive(o)),!1),this.globalScope=Sa(self)?l:window}registerMessageHandler(l,r){this.messageHandlers[l]=r}sendAsync(l,r){return new Promise(((o,p)=>{const v=Math.round(1e18*Math.random()).toString(36).substring(0,10),E=r?oo(r.signal,"abort",(()=>{E==null||E.unsubscribe(),delete this.resolveRejects[v];const z={id:v,type:"<cancel>",origin:location.origin,targetMapId:l.targetMapId,sourceMapId:this.mapId};this.target.postMessage(z)}),Cv):null;this.resolveRejects[v]={resolve:z=>{E==null||E.unsubscribe(),o(z)},reject:z=>{E==null||E.unsubscribe(),p(z)}};const A=[],P=Object.assign(Object.assign({},l),{id:v,sourceMapId:this.mapId,origin:location.origin,data:dc(l.data,A)});this.target.postMessage(P,{transfer:A})}))}receive(l){const r=l.data,o=r.id;if(!(r.origin!=="file://"&&location.origin!=="file://"&&r.origin!=="resource://android"&&location.origin!=="resource://android"&&r.origin!==location.origin||r.targetMapId&&this.mapId!==r.targetMapId)){if(r.type==="<cancel>"){delete this.tasks[o];const p=this.abortControllers[o];return delete this.abortControllers[o],void(p&&p.abort())}if(Sa(self)||r.mustQueue)return this.tasks[o]=r,this.taskQueue.push(o),void this.invoker.trigger();this.processTask(o,r)}}process(){if(this.taskQueue.length===0)return;const l=this.taskQueue.shift(),r=this.tasks[l];delete this.tasks[l],this.taskQueue.length>0&&this.invoker.trigger(),r&&this.processTask(l,r)}processTask(l,r){return c(this,void 0,void 0,(function*(){if(r.type==="<response>"){const v=this.resolveRejects[l];return delete this.resolveRejects[l],v?void(r.error?v.reject(nu(r.error)):v.resolve(nu(r.data))):void 0}if(!this.messageHandlers[r.type])return void this.completeTask(l,new Error(`Could not find a registered handler for ${r.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const o=nu(r.data),p=new AbortController;this.abortControllers[l]=p;try{const v=yield this.messageHandlers[r.type](r.sourceMapId,o,p);this.completeTask(l,null,v)}catch(v){this.completeTask(l,v)}}))}completeTask(l,r,o){const p=[];delete this.abortControllers[l];const v={id:l,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:r?dc(r):null,data:dc(o,p)};this.target.postMessage(v,{transfer:p})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},g.K=fe,g.L=function(){var l=new qe(16);return qe!=Float32Array&&(l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[11]=0,l[12]=0,l[13]=0,l[14]=0),l[0]=1,l[5]=1,l[10]=1,l[15]=1,l},g.M=function(l,r,o){var p,v,E,A,P,z,F,$,W,te,ie,re,oe=o[0],pe=o[1],Te=o[2];return r===l?(l[12]=r[0]*oe+r[4]*pe+r[8]*Te+r[12],l[13]=r[1]*oe+r[5]*pe+r[9]*Te+r[13],l[14]=r[2]*oe+r[6]*pe+r[10]*Te+r[14],l[15]=r[3]*oe+r[7]*pe+r[11]*Te+r[15]):(v=r[1],E=r[2],A=r[3],P=r[4],z=r[5],F=r[6],$=r[7],W=r[8],te=r[9],ie=r[10],re=r[11],l[0]=p=r[0],l[1]=v,l[2]=E,l[3]=A,l[4]=P,l[5]=z,l[6]=F,l[7]=$,l[8]=W,l[9]=te,l[10]=ie,l[11]=re,l[12]=p*oe+P*pe+W*Te+r[12],l[13]=v*oe+z*pe+te*Te+r[13],l[14]=E*oe+F*pe+ie*Te+r[14],l[15]=A*oe+$*pe+re*Te+r[15]),l},g.N=function(l,r,o){var p=o[0],v=o[1],E=o[2];return l[0]=r[0]*p,l[1]=r[1]*p,l[2]=r[2]*p,l[3]=r[3]*p,l[4]=r[4]*v,l[5]=r[5]*v,l[6]=r[6]*v,l[7]=r[7]*v,l[8]=r[8]*E,l[9]=r[9]*E,l[10]=r[10]*E,l[11]=r[11]*E,l[12]=r[12],l[13]=r[13],l[14]=r[14],l[15]=r[15],l},g.O=function(l,r,o){var p=r[0],v=r[1],E=r[2],A=r[3],P=r[4],z=r[5],F=r[6],$=r[7],W=r[8],te=r[9],ie=r[10],re=r[11],oe=r[12],pe=r[13],Te=r[14],Ke=r[15],ke=o[0],Fe=o[1],ot=o[2],gt=o[3];return l[0]=ke*p+Fe*P+ot*W+gt*oe,l[1]=ke*v+Fe*z+ot*te+gt*pe,l[2]=ke*E+Fe*F+ot*ie+gt*Te,l[3]=ke*A+Fe*$+ot*re+gt*Ke,l[4]=(ke=o[4])*p+(Fe=o[5])*P+(ot=o[6])*W+(gt=o[7])*oe,l[5]=ke*v+Fe*z+ot*te+gt*pe,l[6]=ke*E+Fe*F+ot*ie+gt*Te,l[7]=ke*A+Fe*$+ot*re+gt*Ke,l[8]=(ke=o[8])*p+(Fe=o[9])*P+(ot=o[10])*W+(gt=o[11])*oe,l[9]=ke*v+Fe*z+ot*te+gt*pe,l[10]=ke*E+Fe*F+ot*ie+gt*Te,l[11]=ke*A+Fe*$+ot*re+gt*Ke,l[12]=(ke=o[12])*p+(Fe=o[13])*P+(ot=o[14])*W+(gt=o[15])*oe,l[13]=ke*v+Fe*z+ot*te+gt*pe,l[14]=ke*E+Fe*F+ot*ie+gt*Te,l[15]=ke*A+Fe*$+ot*re+gt*Ke,l},g.P=C,g.Q=function(l,r){const o={};for(let p=0;p<r.length;p++){const v=r[p];v in l&&(o[v]=l[v])}return o},g.R=Ms,g.S=Ac,g.T=op,g.U=Lm,g.V=Iv,g.W=Oe,g.X=et,g.Y=pr,g.Z=Xo,g._=c,g.a=se,g.a$=Re,g.a0=function(l,r){var o,p,v,E;if(!l)return r??{};if(!r)return l;const A=Object.assign({},l);if(r.removeAll&&(A.removeAll=!0),r.remove){const P=new Set(A.remove?A.remove.concat(r.remove):r.remove);A.remove=Array.from(P.values())}if(r.add){const P=A.add?A.add.concat(r.add):r.add,z=new Map(P.map((F=>[F.id,F])));A.add=Array.from(z.values())}if(r.update){const P=new Map((o=A.update)===null||o===void 0?void 0:o.map((z=>[z.id,z])));for(const z of r.update){const F=(p=P.get(z.id))!==null&&p!==void 0?p:{id:z.id};z.newGeometry&&(F.newGeometry=z.newGeometry),z.addOrUpdateProperties&&(F.addOrUpdateProperties=((v=F.addOrUpdateProperties)!==null&&v!==void 0?v:[]).concat(z.addOrUpdateProperties)),z.removeProperties&&(F.removeProperties=((E=F.removeProperties)!==null&&E!==void 0?E:[]).concat(z.removeProperties)),z.removeAllProperties&&(F.removeAllProperties=!0),P.set(z.id,F)}A.update=Array.from(P.values())}return A},g.a1=rh,g.a2=Bh,g.a3=25,g.a4=zm,g.a5=l=>{const r=window.document.createElement("video");return r.muted=!0,new Promise((o=>{r.onloadstart=()=>{o(r)};for(const p of l){const v=window.document.createElement("source");tt(p)||(r.crossOrigin="Anonymous"),v.src=p,r.appendChild(v)}}))},g.a6=Mt,g.a7=function(){return fi++},g.a8=Z,g.a9=vf,g.aA=function(l){let r=1/0,o=1/0,p=-1/0,v=-1/0;for(const E of l)r=Math.min(r,E.x),o=Math.min(o,E.y),p=Math.max(p,E.x),v=Math.max(v,E.y);return[r,o,p,v]},g.aB=Xr,g.aC=Bt,g.aD=function(l,r,o,p,v=!1){if(!o[0]&&!o[1])return[0,0];const E=v?p==="map"?-l.bearingInRadians:0:p==="viewport"?l.bearingInRadians:0;if(E){const A=Math.sin(E),P=Math.cos(E);o=[o[0]*P-o[1]*A,o[0]*A+o[1]*P]}return[v?o[0]:Bt(r,o[0],l.zoom),v?o[1]:Bt(r,o[1],l.zoom)]},g.aF=Pm,g.aG=Cc,g.aH=x_,g.aI=Um,g.aJ=Br,g.aK=dp,g.aL=Ie,g.aM=jn,g.aN=Yi,g.aO=Fn,g.aP=ps,g.aQ=Pv,g.aR=Ae,g.aS=_e,g.aT=function(l){var r=new qe(3);return r[0]=l[0],r[1]=l[1],r[2]=l[2],r},g.aU=function(l,r,o){return l[0]=r[0]-o[0],l[1]=r[1]-o[1],l[2]=r[2]-o[2],l},g.aV=function(l,r){var o=r[0],p=r[1],v=r[2],E=o*o+p*p+v*v;return E>0&&(E=1/Math.sqrt(E)),l[0]=r[0]*E,l[1]=r[1]*E,l[2]=r[2]*E,l},g.aW=Me,g.aX=function(l,r){return l[0]*r[0]+l[1]*r[1]+l[2]*r[2]},g.aY=function(l,r,o){return l[0]=r[0]*o[0],l[1]=r[1]*o[1],l[2]=r[2]*o[2],l[3]=r[3]*o[3],l},g.aZ=de,g.a_=function(l,r,o){const p=r[0]*o[0]+r[1]*o[1]+r[2]*o[2];return p===0?null:(-(l[0]*o[0]+l[1]*o[1]+l[2]*o[2])-o[3])/p},g.aa=ut,g.ab=wl,g.ac=xf,g.ad=function(l){const r={};if(l.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((o,p,v,E)=>{const A=v||E;return r[p]=!A||A.toLowerCase(),""})),r["max-age"]){const o=parseInt(r["max-age"],10);isNaN(o)?delete r["max-age"]:r["max-age"]=o}return r},g.ae=qr,g.af=function(l){return Math.pow(2,l)},g.ag=je,g.ah=Wt,g.ai=85.051129,g.aj=Dm,g.ak=function(l){return Math.log(l)/Math.LN2},g.al=function(l){var r=l[0],o=l[1];return r*r+o*o},g.am=function(l,r){const o=[];for(const p in l)p in r||o.push(p);return o},g.an=function(l,r){let o=0,p=0;if(l.kind==="constant")p=l.layoutSize;else if(l.kind!=="source"){const{interpolationType:v,minZoom:E,maxZoom:A}=l,P=v?Wt(lr.interpolationFactor(v,r,E,A),0,1):0;l.kind==="camera"?p=Ts.number(l.minSize,l.maxSize,P):o=P}return{uSizeT:o,uSize:p}},g.ap=function(l,{uSize:r,uSizeT:o},{lowerSize:p,upperSize:v}){return l.kind==="source"?p/Sc:l.kind==="composite"?Ts.number(p/Sc,v/Sc,o):r},g.aq=function(l,r){var o=r[0],p=r[1],v=r[2],E=r[3],A=r[4],P=r[5],z=r[6],F=r[7],$=r[8],W=r[9],te=r[10],ie=r[11],re=r[12],oe=r[13],pe=r[14],Te=r[15],Ke=o*P-p*A,ke=o*z-v*A,Fe=o*F-E*A,ot=p*z-v*P,gt=p*F-E*P,Ct=v*F-E*z,Gt=$*oe-W*re,Ft=$*pe-te*re,Ht=$*Te-ie*re,dn=W*pe-te*oe,qt=W*Te-ie*oe,jt=te*Te-ie*pe,St=Ke*jt-ke*qt+Fe*dn+ot*Ht-gt*Ft+Ct*Gt;return St?(l[0]=(P*jt-z*qt+F*dn)*(St=1/St),l[1]=(v*qt-p*jt-E*dn)*St,l[2]=(oe*Ct-pe*gt+Te*ot)*St,l[3]=(te*gt-W*Ct-ie*ot)*St,l[4]=(z*Ht-A*jt-F*Ft)*St,l[5]=(o*jt-v*Ht+E*Ft)*St,l[6]=(pe*Fe-re*Ct-Te*ke)*St,l[7]=($*Ct-te*Fe+ie*ke)*St,l[8]=(A*qt-P*Ht+F*Gt)*St,l[9]=(p*Ht-o*qt-E*Gt)*St,l[10]=(re*gt-oe*Fe+Te*Ke)*St,l[11]=(W*Fe-$*gt-ie*Ke)*St,l[12]=(P*Ft-A*dn-z*Gt)*St,l[13]=(o*dn-p*Ft+v*Gt)*St,l[14]=(oe*ke-re*ot-pe*Ke)*St,l[15]=($*ot-W*ke+te*Ke)*St,l):null},g.ar=$t,g.as=function(l){return Math.hypot(l[0],l[1])},g.at=function(l){return l[0]=0,l[1]=0,l},g.au=function(l,r,o){return l[0]=r[0]*o,l[1]=r[1]*o,l},g.av=xp,g.aw=Pn,g.ax=function(l,r,o,p){const v=r.y-l.y,E=r.x-l.x,A=p.y-o.y,P=p.x-o.x,z=A*E-P*v;if(z===0)return null;const F=(P*(l.y-o.y)-A*(l.x-o.x))/z;return new C(l.x+F*E,l.y+F*v)},g.ay=Lv,g.az=Vg,g.b=Ea,g.b$=class extends T{},g.b0=function(l,r,o){return l[0]=r[0]*o,l[1]=r[1]*o,l[2]=r[2]*o,l[3]=r[3]*o,l},g.b1=function(l,r){return l[0]*r[0]+l[1]*r[1]+l[2]*r[2]+l[3]},g.b2=yi,g.b3=ah,g.b4=function(l,r,o,p,v){var E,A=1/Math.tan(r/2);return l[0]=A/o,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=A,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[11]=-1,l[12]=0,l[13]=0,l[15]=0,v!=null&&v!==1/0?(l[10]=(v+p)*(E=1/(p-v)),l[14]=2*v*p*E):(l[10]=-1,l[14]=-2*p),l},g.b5=function(l){var r=new qe(16);return r[0]=l[0],r[1]=l[1],r[2]=l[2],r[3]=l[3],r[4]=l[4],r[5]=l[5],r[6]=l[6],r[7]=l[7],r[8]=l[8],r[9]=l[9],r[10]=l[10],r[11]=l[11],r[12]=l[12],r[13]=l[13],r[14]=l[14],r[15]=l[15],r},g.b6=function(l,r,o){var p=Math.sin(o),v=Math.cos(o),E=r[0],A=r[1],P=r[2],z=r[3],F=r[4],$=r[5],W=r[6],te=r[7];return r!==l&&(l[8]=r[8],l[9]=r[9],l[10]=r[10],l[11]=r[11],l[12]=r[12],l[13]=r[13],l[14]=r[14],l[15]=r[15]),l[0]=E*v+F*p,l[1]=A*v+$*p,l[2]=P*v+W*p,l[3]=z*v+te*p,l[4]=F*v-E*p,l[5]=$*v-A*p,l[6]=W*v-P*p,l[7]=te*v-z*p,l},g.b7=function(l,r,o){var p=Math.sin(o),v=Math.cos(o),E=r[4],A=r[5],P=r[6],z=r[7],F=r[8],$=r[9],W=r[10],te=r[11];return r!==l&&(l[0]=r[0],l[1]=r[1],l[2]=r[2],l[3]=r[3],l[12]=r[12],l[13]=r[13],l[14]=r[14],l[15]=r[15]),l[4]=E*v+F*p,l[5]=A*v+$*p,l[6]=P*v+W*p,l[7]=z*v+te*p,l[8]=F*v-E*p,l[9]=$*v-A*p,l[10]=W*v-P*p,l[11]=te*v-z*p,l},g.b8=function(){const l=new Float32Array(16);return je(l),l},g.b9=function(){const l=new Float64Array(16);return je(l),l},g.bA=function(l,r){const o=Le(l,360),p=Le(r,360),v=p-o,E=p>o?v-360:v+360;return Math.abs(v)<Math.abs(E)?v:E},g.bB=function(l){return l[0]=0,l[1]=0,l[2]=0,l},g.bC=function(l,r,o,p){const v=Math.sqrt(l*l+r*r),E=Math.sqrt(o*o+p*p);l/=v,r/=v,o/=E,p/=E;const A=Math.acos(l*o+r*p);return-r*o+l*p>0?A:-A},g.bD=function(l,r){const o=Le(l,2*Math.PI),p=Le(r,2*Math.PI);return Math.min(Math.abs(o-p),Math.abs(o-p+2*Math.PI),Math.abs(o-p-2*Math.PI))},g.bE=function(){const l={},r=$e.$version;for(const o in $e.$root){const p=$e.$root[o];if(p.required){let v=null;v=o==="version"?r:p.type==="array"?[]:{},v!=null&&(l[o]=v)}}return l},g.bF=Gc,g.bG=De,g.bH=function l(r,o){if(Array.isArray(r)){if(!Array.isArray(o)||r.length!==o.length)return!1;for(let p=0;p<r.length;p++)if(!l(r[p],o[p]))return!1;return!0}if(typeof r=="object"&&r!==null&&o!==null){if(typeof o!="object"||Object.keys(r).length!==Object.keys(o).length)return!1;for(const p in r)if(!l(r[p],o[p]))return!1;return!0}return r===o},g.bI=function(l){l=l.slice();const r=Object.create(null);for(let o=0;o<l.length;o++)r[l[o].id]=l[o];for(let o=0;o<l.length;o++)"ref"in l[o]&&(l[o]=Rn(l[o],r[l[o].ref]));return l},g.bJ=function(l){if(l.type==="custom")return new Ev(l);switch(l.type){case"background":return new Ec(l);case"circle":return new Zg(l);case"color-relief":return new t_(l);case"fill":return new lv(l);case"fill-extrusion":return new df(l);case"heatmap":return new gm(l);case"hillshade":return new iv(l);case"line":return new Lh(l);case"raster":return new Sv(l);case"symbol":return new kd(l)}},g.bK=Dr,g.bL=function(l,r){if(!l)return[{command:"setStyle",args:[r]}];let o=[];try{if(!nn(l.version,r.version))return[{command:"setStyle",args:[r]}];nn(l.center,r.center)||o.push({command:"setCenter",args:[r.center]}),nn(l.state,r.state)||o.push({command:"setGlobalState",args:[r.state]}),nn(l.centerAltitude,r.centerAltitude)||o.push({command:"setCenterAltitude",args:[r.centerAltitude]}),nn(l.zoom,r.zoom)||o.push({command:"setZoom",args:[r.zoom]}),nn(l.bearing,r.bearing)||o.push({command:"setBearing",args:[r.bearing]}),nn(l.pitch,r.pitch)||o.push({command:"setPitch",args:[r.pitch]}),nn(l.roll,r.roll)||o.push({command:"setRoll",args:[r.roll]}),nn(l.sprite,r.sprite)||o.push({command:"setSprite",args:[r.sprite]}),nn(l.glyphs,r.glyphs)||o.push({command:"setGlyphs",args:[r.glyphs]}),nn(l.transition,r.transition)||o.push({command:"setTransition",args:[r.transition]}),nn(l.light,r.light)||o.push({command:"setLight",args:[r.light]}),nn(l.terrain,r.terrain)||o.push({command:"setTerrain",args:[r.terrain]}),nn(l.sky,r.sky)||o.push({command:"setSky",args:[r.sky]}),nn(l.projection,r.projection)||o.push({command:"setProjection",args:[r.projection]});const p={},v=[];(function(A,P,z,F){let $;for($ in P=P||{},A=A||{})Object.prototype.hasOwnProperty.call(A,$)&&(Object.prototype.hasOwnProperty.call(P,$)||Gi($,z,F));for($ in P)Object.prototype.hasOwnProperty.call(P,$)&&(Object.prototype.hasOwnProperty.call(A,$)?nn(A[$],P[$])||(A[$].type==="geojson"&&P[$].type==="geojson"&&Ir(A,P,$)?Nn(z,{command:"setGeoJSONSourceData",args:[$,P[$].data]}):tr($,P,z,F)):Ri($,P,z))})(l.sources,r.sources,v,p);const E=[];l.layers&&l.layers.forEach((A=>{"source"in A&&p[A.source]?o.push({command:"removeLayer",args:[A.id]}):E.push(A)})),o=o.concat(v),(function(A,P,z){P=P||[];const F=(A=A||[]).map(Xn),$=P.map(Xn),W=A.reduce(br,{}),te=P.reduce(br,{}),ie=F.slice(),re=Object.create(null);let oe,pe,Te,Ke,ke;for(let Fe=0,ot=0;Fe<F.length;Fe++)oe=F[Fe],Object.prototype.hasOwnProperty.call(te,oe)?ot++:(Nn(z,{command:"removeLayer",args:[oe]}),ie.splice(ie.indexOf(oe,ot),1));for(let Fe=0,ot=0;Fe<$.length;Fe++)oe=$[$.length-1-Fe],ie[ie.length-1-Fe]!==oe&&(Object.prototype.hasOwnProperty.call(W,oe)?(Nn(z,{command:"removeLayer",args:[oe]}),ie.splice(ie.lastIndexOf(oe,ie.length-ot),1)):ot++,Ke=ie[ie.length-Fe],Nn(z,{command:"addLayer",args:[te[oe],Ke]}),ie.splice(ie.length-Fe,0,oe),re[oe]=!0);for(let Fe=0;Fe<$.length;Fe++)if(oe=$[Fe],pe=W[oe],Te=te[oe],!re[oe]&&!nn(pe,Te))if(nn(pe.source,Te.source)&&nn(pe["source-layer"],Te["source-layer"])&&nn(pe.type,Te.type)){for(ke in Vn(pe.layout,Te.layout,z,oe,null,"setLayoutProperty"),Vn(pe.paint,Te.paint,z,oe,null,"setPaintProperty"),nn(pe.filter,Te.filter)||Nn(z,{command:"setFilter",args:[oe,Te.filter]}),nn(pe.minzoom,Te.minzoom)&&nn(pe.maxzoom,Te.maxzoom)||Nn(z,{command:"setLayerZoomRange",args:[oe,Te.minzoom,Te.maxzoom]}),pe)Object.prototype.hasOwnProperty.call(pe,ke)&&ke!=="layout"&&ke!=="paint"&&ke!=="filter"&&ke!=="metadata"&&ke!=="minzoom"&&ke!=="maxzoom"&&(ke.indexOf("paint.")===0?Vn(pe[ke],Te[ke],z,oe,ke.slice(6),"setPaintProperty"):nn(pe[ke],Te[ke])||Nn(z,{command:"setLayerProperty",args:[oe,ke,Te[ke]]}));for(ke in Te)Object.prototype.hasOwnProperty.call(Te,ke)&&!Object.prototype.hasOwnProperty.call(pe,ke)&&ke!=="layout"&&ke!=="paint"&&ke!=="filter"&&ke!=="metadata"&&ke!=="minzoom"&&ke!=="maxzoom"&&(ke.indexOf("paint.")===0?Vn(pe[ke],Te[ke],z,oe,ke.slice(6),"setPaintProperty"):nn(pe[ke],Te[ke])||Nn(z,{command:"setLayerProperty",args:[oe,ke,Te[ke]]}))}else Nn(z,{command:"removeLayer",args:[oe]}),Ke=ie[ie.lastIndexOf(oe)+1],Nn(z,{command:"addLayer",args:[Te,Ke]})})(E,r.layers,o)}catch(p){console.warn("Unable to compute style diff:",p),o=[{command:"setStyle",args:[r]}]}return o},g.bM=function(l){const r=[],o=l.id;return o===void 0&&r.push({message:`layers.${o}: missing required property "id"`}),l.render===void 0&&r.push({message:`layers.${o}: missing required method "render"`}),l.renderingMode&&l.renderingMode!=="2d"&&l.renderingMode!=="3d"&&r.push({message:`layers.${o}: property "renderingMode" must be either "2d" or "3d"`}),r},g.bN=fs,g.bO=Bs,g.bP=class extends os{constructor(l,r){super(l,r),this.current=0}set(l){this.current!==l&&(this.current=l,this.gl.uniform1i(this.location,l))}},g.bQ=ua,g.bR=class extends os{constructor(l,r){super(l,r),this.current=Go}set(l){if(l[12]!==this.current[12]||l[0]!==this.current[0])return this.current=l,void this.gl.uniformMatrix4fv(this.location,!1,l);for(let r=1;r<16;r++)if(l[r]!==this.current[r]){this.current=l,this.gl.uniformMatrix4fv(this.location,!1,l);break}}},g.bS=la,g.bT=class extends os{constructor(l,r){super(l,r),this.current=[0,0,0]}set(l){l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]||(this.current=l,this.gl.uniform3f(this.location,l[0],l[1],l[2]))}},g.bU=class extends os{constructor(l,r){super(l,r),this.current=[0,0]}set(l){l[0]===this.current[0]&&l[1]===this.current[1]||(this.current=l,this.gl.uniform2f(this.location,l[0],l[1]))}},g.bV=Ze,g.bW=function(l,r){var o=Math.sin(r),p=Math.cos(r);return l[0]=p,l[1]=o,l[2]=0,l[3]=-o,l[4]=p,l[5]=0,l[6]=0,l[7]=0,l[8]=1,l},g.bX=function(l,r,o){var p=r[0],v=r[1],E=r[2];return l[0]=p*o[0]+v*o[3]+E*o[6],l[1]=p*o[1]+v*o[4]+E*o[7],l[2]=p*o[2]+v*o[5]+E*o[8],l},g.bY=function(l,r,o,p,v,E,A){var P=1/(r-o),z=1/(p-v),F=1/(E-A);return l[0]=-2*P,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=-2*z,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=2*F,l[11]=0,l[12]=(r+o)*P,l[13]=(v+p)*z,l[14]=(A+E)*F,l[15]=1,l},g.bZ=class extends os{constructor(l,r){super(l,r),this.current=new Array}set(l){if(l!=this.current){this.current=l;const r=new Float32Array(4*l.length);for(let o=0;o<l.length;o++)r[4*o]=l[o].r,r[4*o+1]=l[o].g,r[4*o+2]=l[o].b,r[4*o+3]=l[o].a;this.gl.uniform4fv(this.location,r)}}},g.b_=class extends os{constructor(l,r){super(l,r),this.current=new Array}set(l){if(l!=this.current){this.current=l;const r=new Float32Array(l);this.gl.uniform1fv(this.location,r)}}},g.ba=function(){return new Float64Array(16)},g.bb=function(l,r,o){const p=new Float64Array(4);return mt(p,l,r-90,o),p},g.bc=function(l,r,o,p){var v,E,A,P,z,F=r[0],$=r[1],W=r[2],te=r[3],ie=o[0],re=o[1],oe=o[2],pe=o[3];return(E=F*ie+$*re+W*oe+te*pe)<0&&(E=-E,ie=-ie,re=-re,oe=-oe,pe=-pe),1-E>Je?(v=Math.acos(E),A=Math.sin(v),P=Math.sin((1-p)*v)/A,z=Math.sin(p*v)/A):(P=1-p,z=p),l[0]=P*F+z*ie,l[1]=P*$+z*re,l[2]=P*W+z*oe,l[3]=P*te+z*pe,l},g.bd=function(l){const r=new Float64Array(9);var o,p,v,E,A,P,z,F,$,W,te,ie,re,oe,pe,Te,Ke,ke;W=(v=(p=l)[0])*(z=v+v),te=(E=p[1])*z,re=(A=p[2])*z,oe=A*(F=E+E),Te=(P=p[3])*z,Ke=P*F,ke=P*($=A+A),(o=r)[0]=1-(ie=E*F)-(pe=A*$),o[3]=te-ke,o[6]=re+Ke,o[1]=te+ke,o[4]=1-W-pe,o[7]=oe-Te,o[2]=re-Ke,o[5]=oe+Te,o[8]=1-W-ie;const Fe=ps(-Math.asin(Wt(r[2],-1,1)));let ot,gt;return Math.hypot(r[5],r[8])<.001?(ot=0,gt=-ps(Math.atan2(r[3],r[4]))):(ot=ps(r[5]===0&&r[8]===0?0:Math.atan2(r[5],r[8])),gt=ps(r[1]===0&&r[0]===0?0:Math.atan2(r[1],r[0]))),{roll:ot,pitch:Fe+90,bearing:gt}},g.be=function(l,r){return l.roll==r.roll&&l.pitch==r.pitch&&l.bearing==r.bearing},g.bf=kn,g.bg=ku,g.bh=Tl,g.bi=Jr,g.bj=Qc,g.bk=vt,g.bl=Ot,g.bm=wr,g.bn=function(l,r,o,p,v){return vt(p,v,Wt((l-r)/(o-r),0,1))},g.bo=Le,g.bp=function(){return new Float64Array(3)},g.bq=function(l,r,o,p){return l[0]=r[0]+o[0]*p,l[1]=r[1]+o[1]*p,l[2]=r[2]+o[2]*p,l},g.br=mt,g.bs=function(l,r,o){var p=o[0],v=o[1],E=o[2],A=r[0],P=r[1],z=r[2],F=v*z-E*P,$=E*A-p*z,W=p*P-v*A,te=v*W-E*$,ie=E*F-p*W,re=p*$-v*F,oe=2*o[3];return $*=oe,W*=oe,ie*=2,re*=2,l[0]=A+(F*=oe)+(te*=2),l[1]=P+$+ie,l[2]=z+W+re,l},g.bt=function(l,r,o){const p=(v=[l[0],l[1],l[2],r[0],r[1],r[2],o[0],o[1],o[2]])[0]*(($=v[8])*(A=v[4])-(P=v[5])*(F=v[7]))+v[1]*(-$*(E=v[3])+P*(z=v[6]))+v[2]*(F*E-A*z);var v,E,A,P,z,F,$;if(p===0)return null;const W=Me([],[r[0],r[1],r[2]],[o[0],o[1],o[2]]),te=Me([],[o[0],o[1],o[2]],[l[0],l[1],l[2]]),ie=Me([],[l[0],l[1],l[2]],[r[0],r[1],r[2]]),re=Ae([],W,-l[3]);return _e(re,re,Ae([],te,-r[3])),_e(re,re,Ae([],ie,-o[3])),Ae(re,re,1/p),re},g.bu=A_,g.bv=function(){return new Float64Array(4)},g.bw=function(l,r,o,p){var v=[],E=[];return v[0]=r[0]-o[0],v[1]=r[1]-o[1],v[2]=r[2]-o[2],E[0]=v[0]*Math.cos(p)-v[1]*Math.sin(p),E[1]=v[0]*Math.sin(p)+v[1]*Math.cos(p),E[2]=v[2],l[0]=E[0]+o[0],l[1]=E[1]+o[1],l[2]=E[2]+o[2],l},g.bx=function(l,r,o,p){var v=[],E=[];return v[0]=r[0]-o[0],v[1]=r[1]-o[1],v[2]=r[2]-o[2],E[0]=v[0],E[1]=v[1]*Math.cos(p)-v[2]*Math.sin(p),E[2]=v[1]*Math.sin(p)+v[2]*Math.cos(p),l[0]=E[0]+o[0],l[1]=E[1]+o[1],l[2]=E[2]+o[2],l},g.by=function(l,r,o,p){var v=[],E=[];return v[0]=r[0]-o[0],v[1]=r[1]-o[1],v[2]=r[2]-o[2],E[0]=v[2]*Math.sin(p)+v[0]*Math.cos(p),E[1]=v[1],E[2]=v[2]*Math.cos(p)-v[0]*Math.sin(p),l[0]=E[0]+o[0],l[1]=E[1]+o[1],l[2]=E[2]+o[2],l},g.bz=function(l,r,o){var p=Math.sin(o),v=Math.cos(o),E=r[0],A=r[1],P=r[2],z=r[3],F=r[8],$=r[9],W=r[10],te=r[11];return r!==l&&(l[4]=r[4],l[5]=r[5],l[6]=r[6],l[7]=r[7],l[12]=r[12],l[13]=r[13],l[14]=r[14],l[15]=r[15]),l[0]=E*v-F*p,l[1]=A*v-$*p,l[2]=P*v-W*p,l[3]=z*v-te*p,l[8]=E*p+F*v,l[9]=A*p+$*v,l[10]=P*p+W*v,l[11]=z*p+te*v,l},g.c=Xe,g.c0=Id,g.c1=class extends u{},g.c2=Yg,g.c3=function(l){return l<=1?1:Math.pow(2,Math.ceil(Math.log(l)/Math.LN2))},g.c4=Xg,g.c5=function(l,r,o){var p=r[0],v=r[1],E=r[2],A=o[3]*p+o[7]*v+o[11]*E+o[15];return l[0]=(o[0]*p+o[4]*v+o[8]*E+o[12])/(A=A||1),l[1]=(o[1]*p+o[5]*v+o[9]*E+o[13])/A,l[2]=(o[2]*p+o[6]*v+o[10]*E+o[14])/A,l},g.c6=class extends Kr{},g.c7=class extends j{},g.c8=function(l,r){return l[0]===r[0]&&l[1]===r[1]&&l[2]===r[2]&&l[3]===r[3]&&l[4]===r[4]&&l[5]===r[5]&&l[6]===r[6]&&l[7]===r[7]&&l[8]===r[8]&&l[9]===r[9]&&l[10]===r[10]&&l[11]===r[11]&&l[12]===r[12]&&l[13]===r[13]&&l[14]===r[14]&&l[15]===r[15]},g.c9=function(l,r){var o=l[0],p=l[1],v=l[2],E=l[3],A=l[4],P=l[5],z=l[6],F=l[7],$=l[8],W=l[9],te=l[10],ie=l[11],re=l[12],oe=l[13],pe=l[14],Te=l[15],Ke=r[0],ke=r[1],Fe=r[2],ot=r[3],gt=r[4],Ct=r[5],Gt=r[6],Ft=r[7],Ht=r[8],dn=r[9],qt=r[10],jt=r[11],St=r[12],Sn=r[13],Mn=r[14],mn=r[15];return Math.abs(o-Ke)<=Je*Math.max(1,Math.abs(o),Math.abs(Ke))&&Math.abs(p-ke)<=Je*Math.max(1,Math.abs(p),Math.abs(ke))&&Math.abs(v-Fe)<=Je*Math.max(1,Math.abs(v),Math.abs(Fe))&&Math.abs(E-ot)<=Je*Math.max(1,Math.abs(E),Math.abs(ot))&&Math.abs(A-gt)<=Je*Math.max(1,Math.abs(A),Math.abs(gt))&&Math.abs(P-Ct)<=Je*Math.max(1,Math.abs(P),Math.abs(Ct))&&Math.abs(z-Gt)<=Je*Math.max(1,Math.abs(z),Math.abs(Gt))&&Math.abs(F-Ft)<=Je*Math.max(1,Math.abs(F),Math.abs(Ft))&&Math.abs($-Ht)<=Je*Math.max(1,Math.abs($),Math.abs(Ht))&&Math.abs(W-dn)<=Je*Math.max(1,Math.abs(W),Math.abs(dn))&&Math.abs(te-qt)<=Je*Math.max(1,Math.abs(te),Math.abs(qt))&&Math.abs(ie-jt)<=Je*Math.max(1,Math.abs(ie),Math.abs(jt))&&Math.abs(re-St)<=Je*Math.max(1,Math.abs(re),Math.abs(St))&&Math.abs(oe-Sn)<=Je*Math.max(1,Math.abs(oe),Math.abs(Sn))&&Math.abs(pe-Mn)<=Je*Math.max(1,Math.abs(pe),Math.abs(Mn))&&Math.abs(Te-mn)<=Je*Math.max(1,Math.abs(Te),Math.abs(mn))},g.cA=function(l,r){se.REGISTERED_PROTOCOLS[l]=r},g.cB=function(l){delete se.REGISTERED_PROTOCOLS[l]},g.cC=function(l,r){const o={};for(let v=0;v<l.length;v++){const E=r&&r[l[v].id]||ki(l[v]);r&&(r[l[v].id]=E);let A=o[E];A||(A=o[E]=[]),A.push(l[v])}const p=[];for(const v in o)p.push(o[v]);return p},g.cD=Yt,g.cE=Om,g.cF=Tp,g.cG=__,g.cH=function(l){l.bucket.createArrays(),l.bucket.tilePixelRatio=zt/(512*l.bucket.overscaling),l.bucket.compareText={},l.bucket.iconsNeedLinear=!1;const r=l.bucket.layers[0],o=r.layout,p=r._unevaluatedLayout._values,v={layoutIconSize:p["icon-size"].possiblyEvaluate(new Di(l.bucket.zoom+1),l.canonical),layoutTextSize:p["text-size"].possiblyEvaluate(new Di(l.bucket.zoom+1),l.canonical),textMaxSize:p["text-size"].possiblyEvaluate(new Di(18))};if(l.bucket.textSizeData.kind==="composite"){const{minZoom:F,maxZoom:$}=l.bucket.textSizeData;v.compositeTextSizes=[p["text-size"].possiblyEvaluate(new Di(F),l.canonical),p["text-size"].possiblyEvaluate(new Di($),l.canonical)]}if(l.bucket.iconSizeData.kind==="composite"){const{minZoom:F,maxZoom:$}=l.bucket.iconSizeData;v.compositeIconSizes=[p["icon-size"].possiblyEvaluate(new Di(F),l.canonical),p["icon-size"].possiblyEvaluate(new Di($),l.canonical)]}const E=o.get("text-line-height")*Xr,A=o.get("text-rotation-alignment")!=="viewport"&&o.get("symbol-placement")!=="point",P=o.get("text-keep-upright"),z=o.get("text-size");for(const F of l.bucket.features){const $=o.get("text-font").evaluate(F,{},l.canonical).join(","),W=z.evaluate(F,{},l.canonical),te=v.layoutTextSize.evaluate(F,{},l.canonical),ie=v.layoutIconSize.evaluate(F,{},l.canonical),re={horizontal:{},vertical:void 0},oe=F.text;let pe,Te=[0,0];if(oe){const Fe=oe.toString(),ot=o.get("text-letter-spacing").evaluate(F,{},l.canonical)*Xr,gt=Hc(Fe)?ot:0,Ct=o.get("text-anchor").evaluate(F,{},l.canonical),Gt=Ov(r,F,l.canonical);if(!Gt){const qt=o.get("text-radial-offset").evaluate(F,{},l.canonical);Te=qt?zv(Ct,[qt*Xr,Fm]):o.get("text-offset").evaluate(F,{},l.canonical).map((jt=>jt*Xr))}let Ft=A?"center":o.get("text-justify").evaluate(F,{},l.canonical);const Ht=o.get("symbol-placement")==="point"?o.get("text-max-width").evaluate(F,{},l.canonical)*Xr:1/0,dn=()=>{l.bucket.allowVerticalPlacement&&hd(Fe)&&(re.vertical=Rd(oe,l.glyphMap,l.glyphPositions,l.imagePositions,$,Ht,E,Ct,"left",gt,Te,g.ao.vertical,!0,te,W))};if(!A&&Gt){const qt=new Set;if(Ft==="auto")for(let St=0;St<Gt.values.length;St+=2)qt.add(Cc(Gt.values[St]));else qt.add(Ft);let jt=!1;for(const St of qt)if(!re.horizontal[St])if(jt)re.horizontal[St]=re.horizontal[0];else{const Sn=Rd(oe,l.glyphMap,l.glyphPositions,l.imagePositions,$,Ht,E,"center",St,gt,Te,g.ao.horizontal,!1,te,W);Sn&&(re.horizontal[St]=Sn,jt=Sn.positionedLines.length===1)}dn()}else{Ft==="auto"&&(Ft=Cc(Ct));const qt=Rd(oe,l.glyphMap,l.glyphPositions,l.imagePositions,$,Ht,E,Ct,Ft,gt,Te,g.ao.horizontal,!1,te,W);qt&&(re.horizontal[Ft]=qt),dn(),hd(Fe)&&A&&P&&(re.vertical=Rd(oe,l.glyphMap,l.glyphPositions,l.imagePositions,$,Ht,E,Ct,Ft,gt,Te,g.ao.vertical,!1,te,W))}}let Ke=!1;if(F.icon&&F.icon.name){const Fe=l.imageMap[F.icon.name];Fe&&(pe=xv(l.imagePositions[F.icon.name],o.get("icon-offset").evaluate(F,{},l.canonical),o.get("icon-anchor").evaluate(F,{},l.canonical)),Ke=!!Fe.sdf,l.bucket.sdfIcons===void 0?l.bucket.sdfIcons=Ke:l.bucket.sdfIcons!==Ke&&Mi("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Fe.pixelRatio!==l.bucket.pixelRatio||o.get("icon-rotate").constantOr(1)!==0)&&(l.bucket.iconsNeedLinear=!0))}const ke=Vm(re.horizontal)||re.vertical;l.bucket.iconsInText=!!ke&&ke.iconsInText,(ke||pe)&&Nv(l.bucket,F,re,pe,l.imageMap,v,te,ie,Te,Ke,l.canonical,l.subdivisionGranularity)}l.showCollisionBoxes&&l.bucket.generateCollisionDebugBuffers()},g.cI=qi,g.cJ=Ur,g.cK=fp,g.cL=Tc,g.cM=pf,g.cN=class{constructor(l){this._marks={start:[l.url,"start"].join("#"),end:[l.url,"end"].join("#"),measure:l.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let l=performance.getEntriesByName(this._marks.measure);return l.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),l=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),l}},g.cO=function(l,r,o,p,v){return c(this,void 0,void 0,(function*(){if(et())try{return yield pr(l,r,o,p,v)}catch{}return(function(E,A,P,z,F){const $=E.width,W=E.height;Aa&&Eo||(Aa=new OffscreenCanvas($,W),Eo=Aa.getContext("2d",{willReadFrequently:!0})),Aa.width=$,Aa.height=W,Eo.drawImage(E,0,0,$,W);const te=Eo.getImageData(A,P,z,F);return Eo.clearRect(0,0,$,W),te.data})(l,r,o,p,v)}))},g.cP=ym,g.cQ=R,g.cR=Wo,g.cS=ls,g.cT=Tu,g.cU=function(l,r){const o=new Map;if(l!=null)if(l.type==="Feature")o.set(Ld(l,r),l);else for(const p of l.features)o.set(Ld(p,r),p);return o},g.cV=function(l,r){if(l==null)return!0;if(l.type==="Feature")return Ld(l,r)!=null;if(l.type==="FeatureCollection"){const o=new Set;for(const p of l.features){const v=Ld(p,r);if(v==null||o.has(v))return!1;o.add(v)}return!0}return!1},g.cW=function(l,r,o){var p,v,E,A;if(r.removeAll&&l.clear(),r.remove)for(const P of r.remove)l.delete(P);if(r.add)for(const P of r.add){const z=Ld(P,o);z!=null&&l.set(z,P)}if(r.update)for(const P of r.update){let z=l.get(P.id);if(z==null)continue;const F=!P.removeAllProperties&&(((p=P.removeProperties)===null||p===void 0?void 0:p.length)>0||((v=P.addOrUpdateProperties)===null||v===void 0?void 0:v.length)>0);if((P.newGeometry||P.removeAllProperties||F)&&(z=Object.assign({},z),l.set(P.id,z),F&&(z.properties=Object.assign({},z.properties))),P.newGeometry&&(z.geometry=P.newGeometry),P.removeAllProperties)z.properties={};else if(((E=P.removeProperties)===null||E===void 0?void 0:E.length)>0)for(const $ of P.removeProperties)Object.prototype.hasOwnProperty.call(z.properties,$)&&delete z.properties[$];if(((A=P.addOrUpdateProperties)===null||A===void 0?void 0:A.length)>0)for(const{key:$,value:W}of P.addOrUpdateProperties)z.properties[$]=W}},g.cX=yl,g.ca=function(l,r){return l[0]=r[0],l[1]=r[1],l[2]=r[2],l[3]=r[3],l[4]=r[4],l[5]=r[5],l[6]=r[6],l[7]=r[7],l[8]=r[8],l[9]=r[9],l[10]=r[10],l[11]=r[11],l[12]=r[12],l[13]=r[13],l[14]=r[14],l[15]=r[15],l},g.cb=l=>l.type==="symbol",g.cc=l=>l.type==="circle",g.cd=l=>l.type==="heatmap",g.ce=l=>l.type==="line",g.cf=l=>l.type==="fill",g.cg=l=>l.type==="fill-extrusion",g.ch=l=>l.type==="hillshade",g.ci=l=>l.type==="color-relief",g.cj=l=>l.type==="raster",g.ck=l=>l.type==="background",g.cl=l=>l.type==="custom",g.cm=Ut,g.cn=function(l,r,o){const p=Tt(r.x-o.x,r.y-o.y),v=Tt(l.x-o.x,l.y-o.y);var E,A;return ps(Math.atan2(p[0]*v[1]-p[1]*v[0],(E=p)[0]*(A=v)[0]+E[1]*A[1]))},g.co=Jt,g.cp=function(l,r){return Vs[r]&&(l instanceof MouseEvent||l instanceof WheelEvent)},g.cq=function(l,r){return ms[r]&&"touches"in l},g.cr=function(l){return ms[l]||Vs[l]},g.cs=function(l,r,o){var p=r[0],v=r[1];return l[0]=o[0]*p+o[4]*v+o[12],l[1]=o[1]*p+o[5]*v+o[13],l},g.ct=function(l,r){const{x:o,y:p}=rh.fromLngLat(r);return!(l<0||l>25||p<0||p>=1||o<0||o>=1)},g.cu=function(l,r){return l[0]=r[0],l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=r[1],l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=r[2],l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l},g.cv=class extends Ka{},g.cw=Hm,g.cy=function(l){return l.message===gs},g.cz=Se,g.d=tt,g.e=oi,g.f=l=>c(void 0,void 0,void 0,(function*(){if(l.byteLength===0)return createImageBitmap(new ImageData(1,1));const r=new Blob([new Uint8Array(l)],{type:"image/png"});try{return createImageBitmap(r)}catch(o){throw new Error(`Could not load image because of ${o.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}})),g.g=le,g.h=l=>new Promise(((r,o)=>{const p=new Image;p.onload=()=>{r(p),URL.revokeObjectURL(p.src),p.onload=null,window.requestAnimationFrame((()=>{p.src=Vi}))},p.onerror=()=>o(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const v=new Blob([new Uint8Array(l)],{type:"image/png"});p.src=l.byteLength?URL.createObjectURL(v):Vi})),g.i=Sa,g.j=(l,r)=>He(oi(l,{type:"json"}),r),g.k=xt,g.l=Pt,g.m=He,g.n=(l,r)=>He(oi(l,{type:"arrayBuffer"}),r),g.o=function(l){return new pf(l).readFields(_p,[])},g.p=g_,g.q=of,g.r=Cs,g.s=oo,g.t=Pu,g.u=ri,g.v=$e,g.w=Mi,g.x=wh,g.y=ud,g.z=cc})),d("worker",["./shared"],(function(g){class c{constructor(se){this.keyCache={},se&&this.replace(se)}replace(se){this._layerConfigs={},this._layers={},this.update(se,[])}update(se,le){for(const Se of se){this._layerConfigs[Se.id]=Se;const De=this._layers[Se.id]=g.bJ(Se);De._featureFilter=g.aa(De.filter),this.keyCache[Se.id]&&delete this.keyCache[Se.id]}for(const Se of le)delete this.keyCache[Se],delete this._layerConfigs[Se],delete this._layers[Se];this.familiesBySource={};const fe=g.cC(Object.values(this._layerConfigs),this.keyCache);for(const Se of fe){const De=Se.map((xt=>this._layers[xt.id])),He=De[0];if(He.visibility==="none")continue;const tt=He.source||"";let We=this.familiesBySource[tt];We||(We=this.familiesBySource[tt]={});const _t=He.sourceLayer||"_geojsonTileLayer";let Pt=We[_t];Pt||(Pt=We[_t]=[]),Pt.push(De)}}}class C{constructor(se){const le={},fe=[];for(const tt in se){const We=se[tt],_t=le[tt]={};for(const Pt in We){const xt=We[+Pt];if(!xt||xt.bitmap.width===0||xt.bitmap.height===0)continue;const tn={x:0,y:0,w:xt.bitmap.width+2,h:xt.bitmap.height+2};fe.push(tn),_t[Pt]={rect:tn,metrics:xt.metrics}}}const{w:Se,h:De}=g.p(fe),He=new g.q({width:Se||1,height:De||1});for(const tt in se){const We=se[tt];for(const _t in We){const Pt=We[+_t];if(!Pt||Pt.bitmap.width===0||Pt.bitmap.height===0)continue;const xt=le[tt][_t].rect;g.q.copy(Pt.bitmap,He,{x:0,y:0},{x:xt.x+1,y:xt.y+1},Pt.bitmap)}}this.image=He,this.positions=le}}g.cD("GlyphAtlas",C);class R{constructor(se){this.tileID=new g.Z(se.tileID.overscaledZ,se.tileID.wrap,se.tileID.canonical.z,se.tileID.canonical.x,se.tileID.canonical.y),this.uid=se.uid,this.zoom=se.zoom,this.pixelRatio=se.pixelRatio,this.tileSize=se.tileSize,this.source=se.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=se.showCollisionBoxes,this.collectResourceTiming=!!se.collectResourceTiming,this.returnDependencies=!!se.returnDependencies,this.promoteId=se.promoteId,this.inFlightDependencies=[],this.globalState=se.globalState}parse(se,le,fe,Se,De){return g._(this,void 0,void 0,(function*(){this.status="parsing",this.data=se,this.collisionBoxArray=new g.a8;const He=new g.cE(Object.keys(se.layers).sort()),tt=new g.cF(this.tileID,this.promoteId);tt.bucketLayerIDs=[];const We={},_t={featureIndex:tt,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:fe,subdivisionGranularity:De},Pt=le.familiesBySource[this.source];for(const Vn in Pt){const Xn=se.layers[Vn];if(!Xn)continue;Xn.version===1&&g.w(`Vector tile source "${this.source}" layer "${Vn}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const br=He.encode(Vn),Mt=[];for(let en=0;en<Xn.length;en++){const nr=Xn.feature(en),na=tt.getId(nr,Vn);Mt.push({feature:nr,id:na,index:en,sourceLayerIndex:br})}for(const en of Pt[Vn]){const nr=en[0];nr.source!==this.source&&g.w(`layer.source = ${nr.source} does not equal this.source = ${this.source}`),nr.minzoom&&this.zoom<Math.floor(nr.minzoom)||nr.maxzoom&&this.zoom>=nr.maxzoom||nr.visibility!=="none"&&(V(en,this.zoom,fe),(We[nr.id]=nr.createBucket({index:tt.bucketLayerIDs.length,layers:en,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:br,sourceID:this.source,globalState:this.globalState})).populate(Mt,_t,this.tileID.canonical),tt.bucketLayerIDs.push(en.map((na=>na.id))))}}const xt=g.bN(_t.glyphDependencies,(Vn=>Object.keys(Vn).map(Number)));this.inFlightDependencies.forEach((Vn=>Vn==null?void 0:Vn.abort())),this.inFlightDependencies=[];let tn=Promise.resolve({});if(Object.keys(xt).length){const Vn=new AbortController;this.inFlightDependencies.push(Vn),tn=Se.sendAsync({type:"GG",data:{stacks:xt,source:this.source,tileID:this.tileID,type:"glyphs"}},Vn)}const $e=Object.keys(_t.iconDependencies);let vn=Promise.resolve({});if($e.length){const Vn=new AbortController;this.inFlightDependencies.push(Vn),vn=Se.sendAsync({type:"GI",data:{icons:$e,source:this.source,tileID:this.tileID,type:"icons"}},Vn)}const Rn=Object.keys(_t.patternDependencies);let nn=Promise.resolve({});if(Rn.length){const Vn=new AbortController;this.inFlightDependencies.push(Vn),nn=Se.sendAsync({type:"GI",data:{icons:Rn,source:this.source,tileID:this.tileID,type:"patterns"}},Vn)}const[Nn,Ri,Gi]=yield Promise.all([tn,vn,nn]),tr=new C(Nn),Ir=new g.cG(Ri,Gi);for(const Vn in We){const Xn=We[Vn];Xn instanceof g.a9?(V(Xn.layers,this.zoom,fe),g.cH({bucket:Xn,glyphMap:Nn,glyphPositions:tr.positions,imageMap:Ri,imagePositions:Ir.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:_t.subdivisionGranularity})):Xn.hasPattern&&(Xn instanceof g.cI||Xn instanceof g.cJ||Xn instanceof g.cK)&&(V(Xn.layers,this.zoom,fe),Xn.addFeatures(_t,this.tileID.canonical,Ir.patternPositions))}return this.status="done",{buckets:Object.values(We).filter((Vn=>!Vn.isEmpty())),featureIndex:tt,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:tr.image,imageAtlas:Ir,glyphMap:this.returnDependencies?Nn:null,iconMap:this.returnDependencies?Ri:null,glyphPositions:this.returnDependencies?tr.positions:null}}))}}function V(Xe,se,le){const fe=new g.F(se);for(const Se of Xe)Se.recalculate(fe,le)}class q{constructor(se,le,fe){this.actor=se,this.layerIndex=le,this.availableImages=fe,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(se,le){return g._(this,void 0,void 0,(function*(){const fe=yield g.n(se.request,le);try{return{vectorTile:new g.cL(new g.cM(fe.data)),rawData:fe.data,cacheControl:fe.cacheControl,expires:fe.expires}}catch(Se){const De=new Uint8Array(fe.data);let He=`Unable to parse the tile at ${se.request.url}, `;throw He+=De[0]===31&&De[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${Se.message}`,new Error(He)}}))}loadTile(se){return g._(this,void 0,void 0,(function*(){const le=se.uid,fe=!!(se&&se.request&&se.request.collectResourceTiming)&&new g.cN(se.request),Se=new R(se);this.loading[le]=Se;const De=new AbortController;Se.abort=De;try{const He=yield this.loadVectorTile(se,De);if(delete this.loading[le],!He)return null;const tt=He.rawData,We={};He.expires&&(We.expires=He.expires),He.cacheControl&&(We.cacheControl=He.cacheControl);const _t={};if(fe){const xt=fe.finish();xt&&(_t.resourceTiming=JSON.parse(JSON.stringify(xt)))}Se.vectorTile=He.vectorTile;const Pt=Se.parse(He.vectorTile,this.layerIndex,this.availableImages,this.actor,se.subdivisionGranularity);this.loaded[le]=Se,this.fetching[le]={rawTileData:tt,cacheControl:We,resourceTiming:_t};try{const xt=yield Pt;return g.e({rawTileData:tt.slice(0)},xt,We,_t)}finally{delete this.fetching[le]}}catch(He){throw delete this.loading[le],Se.status="done",this.loaded[le]=Se,He}}))}reloadTile(se){return g._(this,void 0,void 0,(function*(){const le=se.uid;if(!this.loaded||!this.loaded[le])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const fe=this.loaded[le];if(fe.showCollisionBoxes=se.showCollisionBoxes,fe.globalState=se.globalState,fe.status==="parsing"){const Se=yield fe.parse(fe.vectorTile,this.layerIndex,this.availableImages,this.actor,se.subdivisionGranularity);let De;if(this.fetching[le]){const{rawTileData:He,cacheControl:tt,resourceTiming:We}=this.fetching[le];delete this.fetching[le],De=g.e({rawTileData:He.slice(0)},Se,tt,We)}else De=Se;return De}if(fe.status==="done"&&fe.vectorTile)return fe.parse(fe.vectorTile,this.layerIndex,this.availableImages,this.actor,se.subdivisionGranularity)}))}abortTile(se){return g._(this,void 0,void 0,(function*(){const le=this.loading,fe=se.uid;le&&le[fe]&&le[fe].abort&&(le[fe].abort.abort(),delete le[fe])}))}removeTile(se){return g._(this,void 0,void 0,(function*(){this.loaded&&this.loaded[se.uid]&&delete this.loaded[se.uid]}))}}class J{constructor(){this.loaded={}}loadTile(se){return g._(this,void 0,void 0,(function*(){const{uid:le,encoding:fe,rawImageData:Se,redFactor:De,greenFactor:He,blueFactor:tt,baseShift:We}=se,_t=Se.width+2,Pt=Se.height+2,xt=g.b(Se)?new g.R({width:_t,height:Pt},yield g.cO(Se,-1,-1,_t,Pt)):Se,tn=new g.cP(le,xt,fe,De,He,tt,We);return this.loaded=this.loaded||{},this.loaded[le]=tn,tn}))}removeTile(se){const le=this.loaded,fe=se.uid;le&&le[fe]&&delete le[fe]}}var Y,xe,be=(function(){if(xe)return Y;function Xe(le,fe){if(le.length!==0){se(le[0],fe);for(var Se=1;Se<le.length;Se++)se(le[Se],!fe)}}function se(le,fe){for(var Se=0,De=0,He=0,tt=le.length,We=tt-1;He<tt;We=He++){var _t=(le[He][0]-le[We][0])*(le[We][1]+le[He][1]),Pt=Se+_t;De+=Math.abs(Se)>=Math.abs(_t)?Se-Pt+_t:_t-Pt+Se,Se=Pt}Se+De>=0!=!!fe&&le.reverse()}return xe=1,Y=function le(fe,Se){var De,He=fe&&fe.type;if(He==="FeatureCollection")for(De=0;De<fe.features.length;De++)le(fe.features[De],Se);else if(He==="GeometryCollection")for(De=0;De<fe.geometries.length;De++)le(fe.geometries[De],Se);else if(He==="Feature")le(fe.geometry,Se);else if(He==="Polygon")Xe(fe.coordinates,Se);else if(He==="MultiPolygon")for(De=0;De<fe.coordinates.length;De++)Xe(fe.coordinates[De],Se);return fe}})(),Oe=g.cQ(be);class et extends g.cS{constructor(se,le){super(new g.cM,0,le,[],[]),this.feature=se,this.type=se.type,this.properties=se.tags?se.tags:{},"id"in se&&(typeof se.id=="string"?this.id=parseInt(se.id,10):typeof se.id!="number"||isNaN(se.id)||(this.id=se.id))}loadGeometry(){const se=[],le=this.feature.type===1?[this.feature.geometry]:this.feature.geometry;for(const fe of le){const Se=[];for(const De of fe)Se.push(new g.P(De[0],De[1]));se.push(Se)}return se}}class Je extends g.cR{constructor(se,le){super(new g.cM),this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.version=le?le.version:1,this.extent=le?le.extent:4096,this.length=se.length,this.features=se}feature(se){return new et(this.features[se],this.extent)}}function qe(Xe,se){se.writeVarintField(15,Xe.version||1),se.writeStringField(1,Xe.name||""),se.writeVarintField(5,Xe.extent||4096);const le={keys:[],values:[],keycache:{},valuecache:{}};for(let De=0;De<Xe.length;De++)le.feature=Xe.feature(De),se.writeMessage(2,Ze,le);const fe=le.keys;for(const De of fe)se.writeStringField(3,De);const Se=le.values;for(const De of Se)se.writeMessage(4,_e,De)}function Ze(Xe,se){if(!Xe.feature)return;const le=Xe.feature;le.id!==void 0&&se.writeVarintField(1,le.id),se.writeMessage(2,je,Xe),se.writeVarintField(3,le.type),se.writeMessage(4,ce,le)}function je(Xe,se){var le;for(const fe in(le=Xe.feature)==null?void 0:le.properties){let Se=Xe.feature.properties[fe],De=Xe.keycache[fe];if(Se===null)continue;De===void 0&&(Xe.keys.push(fe),De=Xe.keys.length-1,Xe.keycache[fe]=De),se.writeVarint(De),typeof Se!="string"&&typeof Se!="boolean"&&typeof Se!="number"&&(Se=JSON.stringify(Se));const He=typeof Se+":"+Se;let tt=Xe.valuecache[He];tt===void 0&&(Xe.values.push(Se),tt=Xe.values.length-1,Xe.valuecache[He]=tt),se.writeVarint(tt)}}function Be(Xe,se){return(se<<3)+(7&Xe)}function de(Xe){return Xe<<1^Xe>>31}function ce(Xe,se){const le=Xe.loadGeometry(),fe=Xe.type;let Se=0,De=0;for(const He of le){let tt=1;fe===1&&(tt=He.length),se.writeVarint(Be(1,tt));const We=fe===3?He.length-1:He.length;for(let _t=0;_t<We;_t++){_t===1&&fe!==1&&se.writeVarint(Be(2,We-1));const Pt=He[_t].x-Se,xt=He[_t].y-De;se.writeVarint(de(Pt)),se.writeVarint(de(xt)),Se+=Pt,De+=xt}Xe.type===3&&se.writeVarint(Be(7,1))}}function _e(Xe,se){const le=typeof Xe;le==="string"?se.writeStringField(1,Xe):le==="boolean"?se.writeBooleanField(7,Xe):le==="number"&&(Xe%1!=0?se.writeDoubleField(3,Xe):Xe<0?se.writeSVarintField(6,Xe):se.writeVarintField(5,Xe))}const Ae={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Xe=>Xe},Me=Math.fround||(Ge=new Float32Array(1),Xe=>(Ge[0]=+Xe,Ge[0]));var Ge;class Re{constructor(se){this.options=Object.assign(Object.create(Ae),se),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(se){const{log:le,minZoom:fe,maxZoom:Se}=this.options;le&&console.time("total time");const De=`prepare ${se.length} points`;le&&console.time(De),this.points=se;const He=[];for(let We=0;We<se.length;We++){const _t=se[We];if(!_t.geometry)continue;const[Pt,xt]=_t.geometry.coordinates,tn=Me(mt(Pt)),$e=Me($t(xt));He.push(tn,$e,1/0,We,-1,1),this.options.reduce&&He.push(0)}let tt=this.trees[Se+1]=this._createTree(He);le&&console.timeEnd(De);for(let We=Se;We>=fe;We--){const _t=+Date.now();tt=this.trees[We]=this._createTree(this._cluster(tt,We)),le&&console.log("z%d: %d clusters in %dms",We,tt.numItems,+Date.now()-_t)}return le&&console.timeEnd("total time"),this}getClusters(se,le){let fe=((se[0]+180)%360+360)%360-180;const Se=Math.max(-90,Math.min(90,se[1]));let De=se[2]===180?180:((se[2]+180)%360+360)%360-180;const He=Math.max(-90,Math.min(90,se[3]));if(se[2]-se[0]>=360)fe=-180,De=180;else if(fe>De){const xt=this.getClusters([fe,Se,180,He],le),tn=this.getClusters([-180,Se,De,He],le);return xt.concat(tn)}const tt=this.trees[this._limitZoom(le)],We=tt.range(mt(fe),$t(He),mt(De),$t(Se)),_t=tt.data,Pt=[];for(const xt of We){const tn=this.stride*xt;Pt.push(_t[tn+5]>1?Pn(_t,tn,this.clusterProps):this.points[_t[tn+3]])}return Pt}getChildren(se){const le=this._getOriginId(se),fe=this._getOriginZoom(se),Se="No cluster with the specified id.",De=this.trees[fe];if(!De)throw new Error(Se);const He=De.data;if(le*this.stride>=He.length)throw new Error(Se);const tt=this.options.radius/(this.options.extent*Math.pow(2,fe-1)),We=De.within(He[le*this.stride],He[le*this.stride+1],tt),_t=[];for(const Pt of We){const xt=Pt*this.stride;He[xt+4]===se&&_t.push(He[xt+5]>1?Pn(He,xt,this.clusterProps):this.points[He[xt+3]])}if(_t.length===0)throw new Error(Se);return _t}getLeaves(se,le,fe){const Se=[];return this._appendLeaves(Se,se,le=le||10,fe=fe||0,0),Se}getTile(se,le,fe){const Se=this.trees[this._limitZoom(se)],De=Math.pow(2,se),{extent:He,radius:tt}=this.options,We=tt/He,_t=(fe-We)/De,Pt=(fe+1+We)/De,xt={features:[]};return this._addTileFeatures(Se.range((le-We)/De,_t,(le+1+We)/De,Pt),Se.data,le,fe,De,xt),le===0&&this._addTileFeatures(Se.range(1-We/De,_t,1,Pt),Se.data,De,fe,De,xt),le===De-1&&this._addTileFeatures(Se.range(0,_t,We/De,Pt),Se.data,-1,fe,De,xt),xt.features.length?xt:null}getClusterExpansionZoom(se){let le=this._getOriginZoom(se)-1;for(;le<=this.options.maxZoom;){const fe=this.getChildren(se);if(le++,fe.length!==1)break;se=fe[0].properties.cluster_id}return le}_appendLeaves(se,le,fe,Se,De){const He=this.getChildren(le);for(const tt of He){const We=tt.properties;if(We&&We.cluster?De+We.point_count<=Se?De+=We.point_count:De=this._appendLeaves(se,We.cluster_id,fe,Se,De):De<Se?De++:se.push(tt),se.length===fe)break}return De}_createTree(se){const le=new g.aI(se.length/this.stride|0,this.options.nodeSize,Float32Array);for(let fe=0;fe<se.length;fe+=this.stride)le.add(se[fe],se[fe+1]);return le.finish(),le.data=se,le}_addTileFeatures(se,le,fe,Se,De,He){for(const tt of se){const We=tt*this.stride,_t=le[We+5]>1;let Pt,xt,tn;if(_t)Pt=ei(le,We,this.clusterProps),xt=le[We],tn=le[We+1];else{const Rn=this.points[le[We+3]];Pt=Rn.properties;const[nn,Nn]=Rn.geometry.coordinates;xt=mt(nn),tn=$t(Nn)}const $e={type:1,geometry:[[Math.round(this.options.extent*(xt*De-fe)),Math.round(this.options.extent*(tn*De-Se))]],tags:Pt};let vn;vn=_t||this.options.generateId?le[We+3]:this.points[le[We+3]].id,vn!==void 0&&($e.id=vn),He.features.push($e)}}_limitZoom(se){return Math.max(this.options.minZoom,Math.min(Math.floor(+se),this.options.maxZoom+1))}_cluster(se,le){const{radius:fe,extent:Se,reduce:De,minPoints:He}=this.options,tt=fe/(Se*Math.pow(2,le)),We=se.data,_t=[],Pt=this.stride;for(let xt=0;xt<We.length;xt+=Pt){if(We[xt+2]<=le)continue;We[xt+2]=le;const tn=We[xt],$e=We[xt+1],vn=se.within(We[xt],We[xt+1],tt),Rn=We[xt+5];let nn=Rn;for(const Nn of vn){const Ri=Nn*Pt;We[Ri+2]>le&&(nn+=We[Ri+5])}if(nn>Rn&&nn>=He){let Nn,Ri=tn*Rn,Gi=$e*Rn,tr=-1;const Ir=(xt/Pt<<5)+(le+1)+this.points.length;for(const Vn of vn){const Xn=Vn*Pt;if(We[Xn+2]<=le)continue;We[Xn+2]=le;const br=We[Xn+5];Ri+=We[Xn]*br,Gi+=We[Xn+1]*br,We[Xn+4]=Ir,De&&(Nn||(Nn=this._map(We,xt,!0),tr=this.clusterProps.length,this.clusterProps.push(Nn)),De(Nn,this._map(We,Xn)))}We[xt+4]=Ir,_t.push(Ri/nn,Gi/nn,1/0,Ir,-1,nn),De&&_t.push(tr)}else{for(let Nn=0;Nn<Pt;Nn++)_t.push(We[xt+Nn]);if(nn>1)for(const Nn of vn){const Ri=Nn*Pt;if(!(We[Ri+2]<=le)){We[Ri+2]=le;for(let Gi=0;Gi<Pt;Gi++)_t.push(We[Ri+Gi])}}}}return _t}_getOriginId(se){return se-this.points.length>>5}_getOriginZoom(se){return(se-this.points.length)%32}_map(se,le,fe){if(se[le+5]>1){const He=this.clusterProps[se[le+6]];return fe?Object.assign({},He):He}const Se=this.points[se[le+3]].properties,De=this.options.map(Se);return fe&&De===Se?Object.assign({},De):De}}function Pn(Xe,se,le){return{type:"Feature",id:Xe[se+3],properties:ei(Xe,se,le),geometry:{type:"Point",coordinates:[(fe=Xe[se],360*(fe-.5)),Tt(Xe[se+1])]}};var fe}function ei(Xe,se,le){const fe=Xe[se+5],Se=fe>=1e4?`${Math.round(fe/1e3)}k`:fe>=1e3?Math.round(fe/100)/10+"k":fe,De=Xe[se+6],He=De===-1?{}:Object.assign({},le[De]);return Object.assign(He,{cluster:!0,cluster_id:Xe[se+3],point_count:fe,point_count_abbreviated:Se})}function mt(Xe){return Xe/360+.5}function $t(Xe){const se=Math.sin(Xe*Math.PI/180),le=.5-.25*Math.log((1+se)/(1-se))/Math.PI;return le<0?0:le>1?1:le}function Tt(Xe){const se=(180-360*Xe)*Math.PI/180;return 360*Math.atan(Math.exp(se))/Math.PI-90}function zt(Xe,se,le,fe){let Se=fe;const De=se+(le-se>>1);let He,tt=le-se;const We=Xe[se],_t=Xe[se+1],Pt=Xe[le],xt=Xe[le+1];for(let tn=se+3;tn<le;tn+=3){const $e=Bt(Xe[tn],Xe[tn+1],We,_t,Pt,xt);if($e>Se)He=tn,Se=$e;else if($e===Se){const vn=Math.abs(tn-De);vn<tt&&(He=tn,tt=vn)}}Se>fe&&(He-se>3&&zt(Xe,se,He,fe),Xe[He+2]=Se,le-He>3&&zt(Xe,He,le,fe))}function Bt(Xe,se,le,fe,Se,De){let He=Se-le,tt=De-fe;if(He!==0||tt!==0){const We=((Xe-le)*He+(se-fe)*tt)/(He*He+tt*tt);We>1?(le=Se,fe=De):We>0&&(le+=He*We,fe+=tt*We)}return He=Xe-le,tt=se-fe,He*He+tt*tt}function Le(Xe,se,le,fe){const Se={id:Xe??null,type:se,geometry:le,tags:fe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(se==="Point"||se==="MultiPoint"||se==="LineString")vt(Se,le);else if(se==="Polygon")vt(Se,le[0]);else if(se==="MultiLineString")for(const De of le)vt(Se,De);else if(se==="MultiPolygon")for(const De of le)vt(Se,De[0]);return Se}function vt(Xe,se){for(let le=0;le<se.length;le+=3)Xe.minX=Math.min(Xe.minX,se[le]),Xe.minY=Math.min(Xe.minY,se[le+1]),Xe.maxX=Math.max(Xe.maxX,se[le]),Xe.maxY=Math.max(Xe.maxY,se[le+1])}function Ot(Xe,se,le,fe){if(!se.geometry)return;const Se=se.geometry.coordinates;if(Se&&Se.length===0)return;const De=se.geometry.type,He=Math.pow(le.tolerance/((1<<le.maxZoom)*le.extent),2);let tt=[],We=se.id;if(le.promoteId?We=se.properties[le.promoteId]:le.generateId&&(We=fe||0),De==="Point")Ut(Se,tt);else if(De==="MultiPoint")for(const _t of Se)Ut(_t,tt);else if(De==="LineString")Jt(Se,tt,He,!1);else if(De==="MultiLineString"){if(le.lineMetrics){for(const _t of Se)tt=[],Jt(_t,tt,He,!1),Xe.push(Le(We,"LineString",tt,se.properties));return}Wt(Se,tt,He,!1)}else if(De==="Polygon")Wt(Se,tt,He,!0);else{if(De!=="MultiPolygon"){if(De==="GeometryCollection"){for(const _t of se.geometry.geometries)Ot(Xe,{id:We,geometry:_t,properties:se.properties},le,fe);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const _t of Se){const Pt=[];Wt(_t,Pt,He,!0),tt.push(Pt)}}Xe.push(Le(We,De,tt,se.properties))}function Ut(Xe,se){se.push(Fn(Xe[0]),oi(Xe[1]),0)}function Jt(Xe,se,le,fe){let Se,De,He=0;for(let We=0;We<Xe.length;We++){const _t=Fn(Xe[We][0]),Pt=oi(Xe[We][1]);se.push(_t,Pt,0),We>0&&(He+=fe?(Se*Pt-_t*De)/2:Math.sqrt(Math.pow(_t-Se,2)+Math.pow(Pt-De,2))),Se=_t,De=Pt}const tt=se.length-3;se[2]=1,zt(se,0,tt,le),se[tt+2]=1,se.size=Math.abs(He),se.start=0,se.end=se.size}function Wt(Xe,se,le,fe){for(let Se=0;Se<Xe.length;Se++){const De=[];Jt(Xe[Se],De,le,fe),se.push(De)}}function Fn(Xe){return Xe/360+.5}function oi(Xe){const se=Math.sin(Xe*Math.PI/180),le=.5-.25*Math.log((1+se)/(1-se))/Math.PI;return le<0?0:le>1?1:le}function fi(Xe,se,le,fe,Se,De,He,tt){if(fe/=se,De>=(le/=se)&&He<fe)return Xe;if(He<le||De>=fe)return null;const We=[];for(const _t of Xe){const Pt=_t.geometry;let xt=_t.type;const tn=Se===0?_t.minX:_t.minY,$e=Se===0?_t.maxX:_t.maxY;if(tn>=le&&$e<fe){We.push(_t);continue}if($e<le||tn>=fe)continue;let vn=[];if(xt==="Point"||xt==="MultiPoint")fs(Pt,vn,le,fe,Se);else if(xt==="LineString")Bs(Pt,vn,le,fe,Se,!1,tt.lineMetrics);else if(xt==="MultiLineString")Fi(Pt,vn,le,fe,Se,!1);else if(xt==="Polygon")Fi(Pt,vn,le,fe,Se,!0);else if(xt==="MultiPolygon")for(const Rn of Pt){const nn=[];Fi(Rn,nn,le,fe,Se,!0),nn.length&&vn.push(nn)}if(vn.length){if(tt.lineMetrics&&xt==="LineString"){for(const Rn of vn)We.push(Le(_t.id,xt,Rn,_t.tags));continue}xt!=="LineString"&&xt!=="MultiLineString"||(vn.length===1?(xt="LineString",vn=vn[0]):xt="MultiLineString"),xt!=="Point"&&xt!=="MultiPoint"||(xt=vn.length===3?"Point":"MultiPoint"),We.push(Le(_t.id,xt,vn,_t.tags))}}return We.length?We:null}function fs(Xe,se,le,fe,Se){for(let De=0;De<Xe.length;De+=3){const He=Xe[De+Se];He>=le&&He<=fe&&Mi(se,Xe[De],Xe[De+1],Xe[De+2])}}function Bs(Xe,se,le,fe,Se,De,He){let tt=Dr(Xe);const We=Se===0?Ua:Sa;let _t,Pt,xt=Xe.start;for(let nn=0;nn<Xe.length-3;nn+=3){const Nn=Xe[nn],Ri=Xe[nn+1],Gi=Xe[nn+2],tr=Xe[nn+3],Ir=Xe[nn+4],Vn=Se===0?Nn:Ri,Xn=Se===0?tr:Ir;let br=!1;He&&(_t=Math.sqrt(Math.pow(Nn-tr,2)+Math.pow(Ri-Ir,2))),Vn<le?Xn>le&&(Pt=We(tt,Nn,Ri,tr,Ir,le),He&&(tt.start=xt+_t*Pt)):Vn>fe?Xn<fe&&(Pt=We(tt,Nn,Ri,tr,Ir,fe),He&&(tt.start=xt+_t*Pt)):Mi(tt,Nn,Ri,Gi),Xn<le&&Vn>=le&&(Pt=We(tt,Nn,Ri,tr,Ir,le),br=!0),Xn>fe&&Vn<=fe&&(Pt=We(tt,Nn,Ri,tr,Ir,fe),br=!0),!De&&br&&(He&&(tt.end=xt+_t*Pt),se.push(tt),tt=Dr(Xe)),He&&(xt+=_t)}let tn=Xe.length-3;const $e=Xe[tn],vn=Xe[tn+1],Rn=Se===0?$e:vn;Rn>=le&&Rn<=fe&&Mi(tt,$e,vn,Xe[tn+2]),tn=tt.length-3,De&&tn>=3&&(tt[tn]!==tt[0]||tt[tn+1]!==tt[1])&&Mi(tt,tt[0],tt[1],tt[2]),tt.length&&se.push(tt)}function Dr(Xe){const se=[];return se.size=Xe.size,se.start=Xe.start,se.end=Xe.end,se}function Fi(Xe,se,le,fe,Se,De){for(const He of Xe)Bs(He,se,le,fe,Se,De,!1)}function Mi(Xe,se,le,fe){Xe.push(se,le,fe)}function Ua(Xe,se,le,fe,Se,De){const He=(De-se)/(fe-se);return Mi(Xe,De,le+(Se-le)*He,1),He}function Sa(Xe,se,le,fe,Se,De){const He=(De-le)/(Se-le);return Mi(Xe,se+(fe-se)*He,De,1),He}function Fs(Xe,se){const le=[];for(let fe=0;fe<Xe.length;fe++){const Se=Xe[fe],De=Se.type;let He;if(De==="Point"||De==="MultiPoint"||De==="LineString")He=Ea(Se.geometry,se);else if(De==="MultiLineString"||De==="Polygon"){He=[];for(const tt of Se.geometry)He.push(Ea(tt,se))}else if(De==="MultiPolygon"){He=[];for(const tt of Se.geometry){const We=[];for(const _t of tt)We.push(Ea(_t,se));He.push(We)}}le.push(Le(Se.id,De,He,Se.tags))}return le}function Ea(Xe,se){const le=[];le.size=Xe.size,Xe.start!==void 0&&(le.start=Xe.start,le.end=Xe.end);for(let fe=0;fe<Xe.length;fe+=3)le.push(Xe[fe]+se,Xe[fe+1],Xe[fe+2]);return le}function Vi(Xe,se){if(Xe.transformed)return Xe;const le=1<<Xe.z,fe=Xe.x,Se=Xe.y;for(const De of Xe.features){const He=De.geometry,tt=De.type;if(De.geometry=[],tt===1)for(let We=0;We<He.length;We+=2)De.geometry.push(pr(He[We],He[We+1],se,le,fe,Se));else for(let We=0;We<He.length;We++){const _t=[];for(let Pt=0;Pt<He[We].length;Pt+=2)_t.push(pr(He[We][Pt],He[We][Pt+1],se,le,fe,Se));De.geometry.push(_t)}}return Xe.transformed=!0,Xe}function pr(Xe,se,le,fe,Se,De){return[Math.round(le*(Xe*fe-Se)),Math.round(le*(se*fe-De))]}function Aa(Xe,se,le,fe,Se){const De=se===Se.maxZoom?0:Se.tolerance/((1<<se)*Se.extent),He={features:[],numPoints:0,numSimplified:0,numFeatures:Xe.length,source:null,x:le,y:fe,z:se,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const tt of Xe)Eo(He,tt,De,Se);return He}function Eo(Xe,se,le,fe){const Se=se.geometry,De=se.type,He=[];if(Xe.minX=Math.min(Xe.minX,se.minX),Xe.minY=Math.min(Xe.minY,se.minY),Xe.maxX=Math.max(Xe.maxX,se.maxX),Xe.maxY=Math.max(Xe.maxY,se.maxY),De==="Point"||De==="MultiPoint")for(let tt=0;tt<Se.length;tt+=3)He.push(Se[tt],Se[tt+1]),Xe.numPoints++,Xe.numSimplified++;else if(De==="LineString")oo(He,Se,Xe,le,!1,!1);else if(De==="MultiLineString"||De==="Polygon")for(let tt=0;tt<Se.length;tt++)oo(He,Se[tt],Xe,le,De==="Polygon",tt===0);else if(De==="MultiPolygon")for(let tt=0;tt<Se.length;tt++){const We=Se[tt];for(let _t=0;_t<We.length;_t++)oo(He,We[_t],Xe,le,!0,_t===0)}if(He.length){let tt=se.tags||null;if(De==="LineString"&&fe.lineMetrics){tt={};for(const _t in se.tags)tt[_t]=se.tags[_t];tt.mapbox_clip_start=Se.start/Se.size,tt.mapbox_clip_end=Se.end/Se.size}const We={geometry:He,type:De==="Polygon"||De==="MultiPolygon"?3:De==="LineString"||De==="MultiLineString"?2:1,tags:tt};se.id!==null&&(We.id=se.id),Xe.features.push(We)}}function oo(Xe,se,le,fe,Se,De){const He=fe*fe;if(fe>0&&se.size<(Se?He:fe))return void(le.numPoints+=se.length/3);const tt=[];for(let We=0;We<se.length;We+=3)(fe===0||se[We+2]>He)&&(le.numSimplified++,tt.push(se[We],se[We+1])),le.numPoints++;Se&&(function(We,_t){let Pt=0;for(let xt=0,tn=We.length,$e=tn-2;xt<tn;$e=xt,xt+=2)Pt+=(We[xt]-We[$e])*(We[xt+1]+We[$e+1]);if(Pt>0===_t)for(let xt=0,tn=We.length;xt<tn/2;xt+=2){const $e=We[xt],vn=We[xt+1];We[xt]=We[tn-2-xt],We[xt+1]=We[tn-1-xt],We[tn-2-xt]=$e,We[tn-1-xt]=vn}})(tt,De),Xe.push(tt)}const qr={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class ps{constructor(se,le){const fe=(le=this.options=(function(De,He){for(const tt in He)De[tt]=He[tt];return De})(Object.create(qr),le)).debug;if(fe&&console.time("preprocess data"),le.maxZoom<0||le.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(le.promoteId&&le.generateId)throw new Error("promoteId and generateId cannot be used together.");let Se=(function(De,He){const tt=[];if(De.type==="FeatureCollection")for(let We=0;We<De.features.length;We++)Ot(tt,De.features[We],He,We);else Ot(tt,De.type==="Feature"?De:{geometry:De},He);return tt})(se,le);this.tiles={},this.tileCoords=[],fe&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",le.indexMaxZoom,le.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Se=(function(De,He){const tt=He.buffer/He.extent;let We=De;const _t=fi(De,1,-1-tt,tt,0,-1,2,He),Pt=fi(De,1,1-tt,2+tt,0,-1,2,He);return(_t||Pt)&&(We=fi(De,1,-tt,1+tt,0,-1,2,He)||[],_t&&(We=Fs(_t,1).concat(We)),Pt&&(We=We.concat(Fs(Pt,-1)))),We})(Se,le),Se.length&&this.splitTile(Se,0,0,0),fe&&(Se.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(se,le,fe,Se,De,He,tt){const We=[se,le,fe,Se],_t=this.options,Pt=_t.debug;for(;We.length;){Se=We.pop(),fe=We.pop(),le=We.pop(),se=We.pop();const xt=1<<le,tn=ms(le,fe,Se);let $e=this.tiles[tn];if(!$e&&(Pt>1&&console.time("creation"),$e=this.tiles[tn]=Aa(se,le,fe,Se,_t),this.tileCoords.push({z:le,x:fe,y:Se}),Pt)){Pt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",le,fe,Se,$e.numFeatures,$e.numPoints,$e.numSimplified),console.timeEnd("creation"));const br=`z${le}`;this.stats[br]=(this.stats[br]||0)+1,this.total++}if($e.source=se,De==null){if(le===_t.indexMaxZoom||$e.numPoints<=_t.indexMaxPoints)continue}else{if(le===_t.maxZoom||le===De)continue;if(De!=null){const br=De-le;if(fe!==He>>br||Se!==tt>>br)continue}}if($e.source=null,se.length===0)continue;Pt>1&&console.time("clipping");const vn=.5*_t.buffer/_t.extent,Rn=.5-vn,nn=.5+vn,Nn=1+vn;let Ri=null,Gi=null,tr=null,Ir=null,Vn=fi(se,xt,fe-vn,fe+nn,0,$e.minX,$e.maxX,_t),Xn=fi(se,xt,fe+Rn,fe+Nn,0,$e.minX,$e.maxX,_t);se=null,Vn&&(Ri=fi(Vn,xt,Se-vn,Se+nn,1,$e.minY,$e.maxY,_t),Gi=fi(Vn,xt,Se+Rn,Se+Nn,1,$e.minY,$e.maxY,_t),Vn=null),Xn&&(tr=fi(Xn,xt,Se-vn,Se+nn,1,$e.minY,$e.maxY,_t),Ir=fi(Xn,xt,Se+Rn,Se+Nn,1,$e.minY,$e.maxY,_t),Xn=null),Pt>1&&console.timeEnd("clipping"),We.push(Ri||[],le+1,2*fe,2*Se),We.push(Gi||[],le+1,2*fe,2*Se+1),We.push(tr||[],le+1,2*fe+1,2*Se),We.push(Ir||[],le+1,2*fe+1,2*Se+1)}}getTile(se,le,fe){se=+se,le=+le,fe=+fe;const Se=this.options,{extent:De,debug:He}=Se;if(se<0||se>24)return null;const tt=1<<se,We=ms(se,le=le+tt&tt-1,fe);if(this.tiles[We])return Vi(this.tiles[We],De);He>1&&console.log("drilling down to z%d-%d-%d",se,le,fe);let _t,Pt=se,xt=le,tn=fe;for(;!_t&&Pt>0;)Pt--,xt>>=1,tn>>=1,_t=this.tiles[ms(Pt,xt,tn)];return _t&&_t.source?(He>1&&(console.log("found parent tile z%d-%d-%d",Pt,xt,tn),console.time("drilling down")),this.splitTile(_t.source,Pt,xt,tn,se,le,fe),He>1&&console.timeEnd("drilling down"),this.tiles[We]?Vi(this.tiles[We],De):null):null}}function ms(Xe,se,le){return 32*((1<<Xe)*le+se)+Xe}class Vs extends q{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(se,le){return g._(this,void 0,void 0,(function*(){const fe=se.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const Se=this._geoJSONIndex.getTile(fe.z,fe.x,fe.y);if(!Se)return null;const De=new Je(Se.features,{version:2,extent:g.$});let He=(function(tt){const We=new g.cM;return(function(_t,Pt){for(const xt in _t.layers)Pt.writeMessage(3,qe,_t.layers[xt])})(tt,We),We.finish()})(De);return He.byteOffset===0&&He.byteLength===He.buffer.byteLength||(He=new Uint8Array(He)),{vectorTile:De,rawData:He.buffer}}))}loadData(se){return g._(this,void 0,void 0,(function*(){var le;(le=this._pendingRequest)===null||le===void 0||le.abort();const fe=!!(se&&se.request&&se.request.collectResourceTiming)&&new g.cN(se.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(se,this._pendingRequest);const Se=yield this._pendingData;this._geoJSONIndex=se.cluster?new Re((function({superclusterOptions:He,clusterProperties:tt}){if(!tt||!He)return He;const We={},_t={},Pt={accumulated:null,zoom:0},xt={properties:null},tn=Object.keys(tt);for(const $e of tn){const[vn,Rn]=tt[$e],nn=g.cT(Rn),Nn=g.cT(typeof vn=="string"?[vn,["accumulated"],["get",$e]]:vn);We[$e]=nn.value,_t[$e]=Nn.value}return He.map=$e=>{xt.properties=$e;const vn={};for(const Rn of tn)vn[Rn]=We[Rn].evaluate(Pt,xt);return vn},He.reduce=($e,vn)=>{xt.properties=vn;for(const Rn of tn)Pt.accumulated=$e[Rn],$e[Rn]=_t[Rn].evaluate(Pt,xt)},He})(se)).load(Se.features):(function(He,tt){return new ps(He,tt)})(Se,se.geojsonVtOptions),this.loaded={};const De={data:Se};if(fe){const He=fe.finish();He&&(De.resourceTiming={},De.resourceTiming[se.source]=JSON.parse(JSON.stringify(He)))}return De}catch(Se){if(delete this._pendingRequest,g.cy(Se))return{abandoned:!0};throw Se}}))}getData(){return g._(this,void 0,void 0,(function*(){return this._pendingData}))}reloadTile(se){const le=this.loaded;return le&&le[se.uid]?super.reloadTile(se):this.loadTile(se)}loadAndProcessGeoJSON(se,le){return g._(this,void 0,void 0,(function*(){let fe=yield this.loadGeoJSON(se,le);if(delete this._pendingRequest,typeof fe!="object")throw new Error(`Input data given to '${se.source}' is not a valid GeoJSON object.`);if(Oe(fe,!0),se.filter){const Se=g.cT(se.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Se.result==="error")throw new Error(Se.value.map((He=>`${He.key}: ${He.message}`)).join(", "));fe={type:"FeatureCollection",features:fe.features.filter((He=>Se.value.evaluate({zoom:0},He)))}}return fe}))}loadGeoJSON(se,le){return g._(this,void 0,void 0,(function*(){const{promoteId:fe}=se;if(se.request){const Se=yield g.j(se.request,le);return this._dataUpdateable=g.cV(Se.data,fe)?g.cU(Se.data,fe):void 0,Se.data}if(typeof se.data=="string")try{const Se=JSON.parse(se.data);return this._dataUpdateable=g.cV(Se,fe)?g.cU(Se,fe):void 0,Se}catch{throw new Error(`Input data given to '${se.source}' is not a valid GeoJSON object.`)}if(!se.dataDiff)throw new Error(`Input data given to '${se.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${se.source}`);return g.cW(this._dataUpdateable,se.dataDiff,fe),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}}))}removeSource(se){return g._(this,void 0,void 0,(function*(){this._pendingRequest&&this._pendingRequest.abort()}))}getClusterExpansionZoom(se){return this._geoJSONIndex.getClusterExpansionZoom(se.clusterId)}getClusterChildren(se){return this._geoJSONIndex.getChildren(se.clusterId)}getClusterLeaves(se){return this._geoJSONIndex.getLeaves(se.clusterId,se.limit,se.offset)}}class gs{constructor(se){this.self=se,this.actor=new g.J(se),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(le,fe)=>{if(this.externalWorkerSourceTypes[le])throw new Error(`Worker source with name "${le}" already registered.`);this.externalWorkerSourceTypes[le]=fe},this.self.addProtocol=g.cA,this.self.removeProtocol=g.cB,this.self.registerRTLTextPlugin=le=>{g.cX.setMethods(le)},this.actor.registerMessageHandler("LDT",((le,fe)=>this._getDEMWorkerSource(le,fe.source).loadTile(fe))),this.actor.registerMessageHandler("RDT",((le,fe)=>g._(this,void 0,void 0,(function*(){this._getDEMWorkerSource(le,fe.source).removeTile(fe)})))),this.actor.registerMessageHandler("GCEZ",((le,fe)=>g._(this,void 0,void 0,(function*(){return this._getWorkerSource(le,fe.type,fe.source).getClusterExpansionZoom(fe)})))),this.actor.registerMessageHandler("GCC",((le,fe)=>g._(this,void 0,void 0,(function*(){return this._getWorkerSource(le,fe.type,fe.source).getClusterChildren(fe)})))),this.actor.registerMessageHandler("GCL",((le,fe)=>g._(this,void 0,void 0,(function*(){return this._getWorkerSource(le,fe.type,fe.source).getClusterLeaves(fe)})))),this.actor.registerMessageHandler("LD",((le,fe)=>this._getWorkerSource(le,fe.type,fe.source).loadData(fe))),this.actor.registerMessageHandler("GD",((le,fe)=>this._getWorkerSource(le,fe.type,fe.source).getData())),this.actor.registerMessageHandler("LT",((le,fe)=>this._getWorkerSource(le,fe.type,fe.source).loadTile(fe))),this.actor.registerMessageHandler("RT",((le,fe)=>this._getWorkerSource(le,fe.type,fe.source).reloadTile(fe))),this.actor.registerMessageHandler("AT",((le,fe)=>this._getWorkerSource(le,fe.type,fe.source).abortTile(fe))),this.actor.registerMessageHandler("RMT",((le,fe)=>this._getWorkerSource(le,fe.type,fe.source).removeTile(fe))),this.actor.registerMessageHandler("RS",((le,fe)=>g._(this,void 0,void 0,(function*(){if(!this.workerSources[le]||!this.workerSources[le][fe.type]||!this.workerSources[le][fe.type][fe.source])return;const Se=this.workerSources[le][fe.type][fe.source];delete this.workerSources[le][fe.type][fe.source],Se.removeSource!==void 0&&Se.removeSource(fe)})))),this.actor.registerMessageHandler("RM",(le=>g._(this,void 0,void 0,(function*(){delete this.layerIndexes[le],delete this.availableImages[le],delete this.workerSources[le],delete this.demWorkerSources[le]})))),this.actor.registerMessageHandler("SR",((le,fe)=>g._(this,void 0,void 0,(function*(){this.referrer=fe})))),this.actor.registerMessageHandler("SRPS",((le,fe)=>this._syncRTLPluginState(le,fe))),this.actor.registerMessageHandler("IS",((le,fe)=>g._(this,void 0,void 0,(function*(){this.self.importScripts(fe)})))),this.actor.registerMessageHandler("SI",((le,fe)=>this._setImages(le,fe))),this.actor.registerMessageHandler("UL",((le,fe)=>g._(this,void 0,void 0,(function*(){this._getLayerIndex(le).update(fe.layers,fe.removedIds)})))),this.actor.registerMessageHandler("SL",((le,fe)=>g._(this,void 0,void 0,(function*(){this._getLayerIndex(le).replace(fe)}))))}_setImages(se,le){return g._(this,void 0,void 0,(function*(){this.availableImages[se]=le;for(const fe in this.workerSources[se]){const Se=this.workerSources[se][fe];for(const De in Se)Se[De].availableImages=le}}))}_syncRTLPluginState(se,le){return g._(this,void 0,void 0,(function*(){return yield g.cX.syncState(le,this.self.importScripts)}))}_getAvailableImages(se){let le=this.availableImages[se];return le||(le=[]),le}_getLayerIndex(se){let le=this.layerIndexes[se];return le||(le=this.layerIndexes[se]=new c),le}_getWorkerSource(se,le,fe){if(this.workerSources[se]||(this.workerSources[se]={}),this.workerSources[se][le]||(this.workerSources[se][le]={}),!this.workerSources[se][le][fe]){const Se={sendAsync:(De,He)=>(De.targetMapId=se,this.actor.sendAsync(De,He))};switch(le){case"vector":this.workerSources[se][le][fe]=new q(Se,this._getLayerIndex(se),this._getAvailableImages(se));break;case"geojson":this.workerSources[se][le][fe]=new Vs(Se,this._getLayerIndex(se),this._getAvailableImages(se));break;default:this.workerSources[se][le][fe]=new this.externalWorkerSourceTypes[le](Se,this._getLayerIndex(se),this._getAvailableImages(se))}}return this.workerSources[se][le][fe]}_getDEMWorkerSource(se,le){return this.demWorkerSources[se]||(this.demWorkerSources[se]={}),this.demWorkerSources[se][le]||(this.demWorkerSources[se][le]=new J),this.demWorkerSources[se][le]}}return g.i(self)&&(self.worker=new gs(self)),gs})),d("index",["exports","./shared"],(function(g,c){var C="5.6.2";function R(){var T=new c.A(4);return c.A!=Float32Array&&(T[1]=0,T[2]=0),T[0]=1,T[3]=1,T}let V,q;const J={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(T,i,u){const _=requestAnimationFrame((S=>{b(),i(S)})),{unsubscribe:b}=c.s(T.signal,"abort",(()=>{b(),cancelAnimationFrame(_),u(c.c())}),!1)},frameAsync(T){return new Promise(((i,u)=>{this.frame(T,i,u)}))},getImageData(T,i=0){return this.getImageCanvasContext(T).getImageData(-i,-i,T.width+2*i,T.height+2*i)},getImageCanvasContext(T){const i=window.document.createElement("canvas"),u=i.getContext("2d",{willReadFrequently:!0});if(!u)throw new Error("failed to create canvas 2d context");return i.width=T.width,i.height=T.height,u.drawImage(T,0,0,T.width,T.height),u},resolveURL:T=>(V||(V=document.createElement("a")),V.href=T,V.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(q==null&&(q=matchMedia("(prefers-reduced-motion: reduce)")),q.matches)}};class Y{static testProp(i){if(!Y.docStyle)return i[0];for(let u=0;u<i.length;u++)if(i[u]in Y.docStyle)return i[u];return i[0]}static create(i,u,_){const b=window.document.createElement(i);return u!==void 0&&(b.className=u),_&&_.appendChild(b),b}static createNS(i,u){return window.document.createElementNS(i,u)}static disableDrag(){Y.docStyle&&Y.selectProp&&(Y.userSelect=Y.docStyle[Y.selectProp],Y.docStyle[Y.selectProp]="none")}static enableDrag(){Y.docStyle&&Y.selectProp&&(Y.docStyle[Y.selectProp]=Y.userSelect)}static setTransform(i,u){i.style[Y.transformProp]=u}static addEventListener(i,u,_,b={}){i.addEventListener(u,_,"passive"in b?b:b.capture)}static removeEventListener(i,u,_,b={}){i.removeEventListener(u,_,"passive"in b?b:b.capture)}static suppressClickInternal(i){i.preventDefault(),i.stopPropagation(),window.removeEventListener("click",Y.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",Y.suppressClickInternal,!0),window.setTimeout((()=>{window.removeEventListener("click",Y.suppressClickInternal,!0)}),0)}static getScale(i){const u=i.getBoundingClientRect();return{x:u.width/i.offsetWidth||1,y:u.height/i.offsetHeight||1,boundingClientRect:u}}static getPoint(i,u,_){const b=u.boundingClientRect;return new c.P((_.clientX-b.left)/u.x-i.clientLeft,(_.clientY-b.top)/u.y-i.clientTop)}static mousePos(i,u){const _=Y.getScale(i);return Y.getPoint(i,_,u)}static touchPos(i,u){const _=[],b=Y.getScale(i);for(let S=0;S<u.length;S++)_.push(Y.getPoint(i,b,u[S]));return _}static mouseButton(i){return i.button}static remove(i){i.parentNode&&i.parentNode.removeChild(i)}static sanitize(i){const u=new DOMParser().parseFromString(i,"text/html").body||document.createElement("body"),_=u.querySelectorAll("script");for(const b of _)b.remove();return Y.clean(u),u.innerHTML}static isPossiblyDangerous(i,u){const _=u.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(i)||!_.includes("javascript:")&&!_.includes("data:"))||!!i.startsWith("on")||void 0}static clean(i){const u=i.children;for(const _ of u)Y.removeAttributes(_),Y.clean(_)}static removeAttributes(i){for(const{name:u,value:_}of i.attributes)Y.isPossiblyDangerous(u,_)&&i.removeAttribute(u)}}Y.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,Y.selectProp=Y.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),Y.transformProp=Y.testProp(["transform","WebkitTransform"]);const xe={supported:!1,testSupport:function(T){!et&&Oe&&(Je?qe(T):be=T)}};let be,Oe,et=!1,Je=!1;function qe(T){const i=T.createTexture();T.bindTexture(T.TEXTURE_2D,i);try{if(T.texImage2D(T.TEXTURE_2D,0,T.RGBA,T.RGBA,T.UNSIGNED_BYTE,Oe),T.isContextLost())return;xe.supported=!0}catch{}T.deleteTexture(i),et=!0}var Ze;typeof document<"u"&&(Oe=document.createElement("img"),Oe.onload=()=>{be&&qe(be),be=null,Je=!0},Oe.onerror=()=>{et=!0,be=null},Oe.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),(function(T){let i,u,_,b;T.resetRequestQueue=()=>{i=[],u=0,_=0,b={}},T.addThrottleControl=N=>{const j=_++;return b[j]=N,j},T.removeThrottleControl=N=>{delete b[N],I()},T.getImage=(N,j,G=!0)=>new Promise(((K,Z)=>{xe.supported&&(N.headers||(N.headers={}),N.headers.accept="image/webp,*/*"),c.e(N,{type:"image"}),i.push({abortController:j,requestParameters:N,supportImageRefresh:G,state:"queued",onError:ee=>{Z(ee)},onSuccess:ee=>{K(ee)}}),I()}));const S=N=>c._(this,void 0,void 0,(function*(){N.state="running";const{requestParameters:j,supportImageRefresh:G,onError:K,onSuccess:Z,abortController:ee}=N,ae=G===!1&&!c.i(self)&&!c.g(j.url)&&(!j.headers||Object.keys(j.headers).reduce(((ve,we)=>ve&&we==="accept"),!0));u++;const ge=ae?O(j,ee):c.m(j,ee);try{const ve=yield ge;delete N.abortController,N.state="completed",ve.data instanceof HTMLImageElement||c.b(ve.data)?Z(ve):ve.data&&Z({data:yield(me=ve.data,typeof createImageBitmap=="function"?c.f(me):c.h(me)),cacheControl:ve.cacheControl,expires:ve.expires})}catch(ve){delete N.abortController,K(ve)}finally{u--,I()}var me})),I=()=>{const N=(()=>{for(const j of Object.keys(b))if(b[j]())return!0;return!1})()?c.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:c.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let j=u;j<N&&i.length>0;j++){const G=i.shift();G.abortController.signal.aborted?j--:S(G)}},O=(N,j)=>new Promise(((G,K)=>{const Z=new Image,ee=N.url,ae=N.credentials;ae&&ae==="include"?Z.crossOrigin="use-credentials":(ae&&ae==="same-origin"||!c.d(ee))&&(Z.crossOrigin="anonymous"),j.signal.addEventListener("abort",(()=>{Z.src="",K(c.c())})),Z.fetchPriority="high",Z.onload=()=>{Z.onerror=Z.onload=null,G({data:Z})},Z.onerror=()=>{Z.onerror=Z.onload=null,j.signal.aborted||K(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},Z.src=ee}))})(Ze||(Ze={})),Ze.resetRequestQueue();class je{constructor(i){this._transformRequestFn=i??null}transformRequest(i,u){return this._transformRequestFn&&this._transformRequestFn(i,u)||{url:i}}setTransformRequest(i){this._transformRequestFn=i}}function Be(T){const i=[];if(typeof T=="string")i.push({id:"default",url:T});else if(T&&T.length>0){const u=[];for(const{id:_,url:b}of T){const S=`${_}${b}`;u.indexOf(S)===-1&&(u.push(S),i.push({id:_,url:b}))}}return i}function de(T,i,u){try{const _=new URL(T);return _.pathname+=`${i}${u}`,_.toString()}catch{throw new Error(`Invalid sprite URL "${T}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function ce(T){const{userImage:i}=T;return!!(i&&i.render&&i.render())&&(T.data.replace(new Uint8Array(i.data.buffer)),!0)}class _e extends c.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new c.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(i){if(this.loaded!==i&&(this.loaded=i,i)){for(const{ids:u,promiseResolve:_}of this.requestors)_(this._getImagesForIds(u));this.requestors=[]}}getImage(i){const u=this.images[i];if(u&&!u.data&&u.spriteData){const _=u.spriteData;u.data=new c.R({width:_.width,height:_.height},_.context.getImageData(_.x,_.y,_.width,_.height).data),u.spriteData=null}return u}addImage(i,u){if(this.images[i])throw new Error(`Image id ${i} already exist, use updateImage instead`);this._validate(i,u)&&(this.images[i]=u)}_validate(i,u){let _=!0;const b=u.data||u.spriteData;return this._validateStretch(u.stretchX,b&&b.width)||(this.fire(new c.k(new Error(`Image "${i}" has invalid "stretchX" value`))),_=!1),this._validateStretch(u.stretchY,b&&b.height)||(this.fire(new c.k(new Error(`Image "${i}" has invalid "stretchY" value`))),_=!1),this._validateContent(u.content,u)||(this.fire(new c.k(new Error(`Image "${i}" has invalid "content" value`))),_=!1),_}_validateStretch(i,u){if(!i)return!0;let _=0;for(const b of i){if(b[0]<_||b[1]<b[0]||u<b[1])return!1;_=b[1]}return!0}_validateContent(i,u){if(!i)return!0;if(i.length!==4)return!1;const _=u.spriteData,b=_&&_.width||u.data.width,S=_&&_.height||u.data.height;return!(i[0]<0||b<i[0]||i[1]<0||S<i[1]||i[2]<0||b<i[2]||i[3]<0||S<i[3]||i[2]<i[0]||i[3]<i[1])}updateImage(i,u,_=!0){const b=this.getImage(i);if(_&&(b.data.width!==u.data.width||b.data.height!==u.data.height))throw new Error(`size mismatch between old image (${b.data.width}x${b.data.height}) and new image (${u.data.width}x${u.data.height}).`);u.version=b.version+1,this.images[i]=u,this.updatedImages[i]=!0}removeImage(i){const u=this.images[i];delete this.images[i],delete this.patterns[i],u.userImage&&u.userImage.onRemove&&u.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(i){return new Promise(((u,_)=>{let b=!0;if(!this.isLoaded())for(const S of i)this.images[S]||(b=!1);this.isLoaded()||b?u(this._getImagesForIds(i)):this.requestors.push({ids:i,promiseResolve:u})}))}_getImagesForIds(i){const u={};for(const _ of i){let b=this.getImage(_);b||(this.fire(new c.l("styleimagemissing",{id:_})),b=this.getImage(_)),b?u[_]={data:b.data.clone(),pixelRatio:b.pixelRatio,sdf:b.sdf,version:b.version,stretchX:b.stretchX,stretchY:b.stretchY,content:b.content,textFitWidth:b.textFitWidth,textFitHeight:b.textFitHeight,hasRenderCallback:!!(b.userImage&&b.userImage.render)}:c.w(`Image "${_}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return u}getPixelSize(){const{width:i,height:u}=this.atlasImage;return{width:i,height:u}}getPattern(i){const u=this.patterns[i],_=this.getImage(i);if(!_)return null;if(u&&u.position.version===_.version)return u.position;if(u)u.position.version=_.version;else{const b={w:_.data.width+2,h:_.data.height+2,x:0,y:0},S=new c.I(b,_);this.patterns[i]={bin:b,position:S}}return this._updatePatternAtlas(),this.patterns[i].position}bind(i){const u=i.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new c.T(i,this.atlasImage,u.RGBA),this.atlasTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE)}_updatePatternAtlas(){const i=[];for(const S in this.patterns)i.push(this.patterns[S].bin);const{w:u,h:_}=c.p(i),b=this.atlasImage;b.resize({width:u||1,height:_||1});for(const S in this.patterns){const{bin:I}=this.patterns[S],O=I.x+1,N=I.y+1,j=this.getImage(S).data,G=j.width,K=j.height;c.R.copy(j,b,{x:0,y:0},{x:O,y:N},{width:G,height:K}),c.R.copy(j,b,{x:0,y:K-1},{x:O,y:N-1},{width:G,height:1}),c.R.copy(j,b,{x:0,y:0},{x:O,y:N+K},{width:G,height:1}),c.R.copy(j,b,{x:G-1,y:0},{x:O-1,y:N},{width:1,height:K}),c.R.copy(j,b,{x:0,y:0},{x:O+G,y:N},{width:1,height:K})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(i){for(const u of i){if(this.callbackDispatchedThisFrame[u])continue;this.callbackDispatchedThisFrame[u]=!0;const _=this.getImage(u);_||c.w(`Image with ID: "${u}" was not found`),ce(_)&&this.updateImage(u,_)}}}const Ae=1e20;function Me(T,i,u,_,b,S,I,O,N){for(let j=i;j<i+_;j++)Ge(T,u*S+j,S,b,I,O,N);for(let j=u;j<u+b;j++)Ge(T,j*S+i,1,_,I,O,N)}function Ge(T,i,u,_,b,S,I){S[0]=0,I[0]=-Ae,I[1]=Ae,b[0]=T[i];for(let O=1,N=0,j=0;O<_;O++){b[O]=T[i+O*u];const G=O*O;do{const K=S[N];j=(b[O]-b[K]+G-K*K)/(O-K)/2}while(j<=I[N]&&--N>-1);N++,S[N]=O,I[N]=j,I[N+1]=Ae}for(let O=0,N=0;O<_;O++){for(;I[N+1]<O;)N++;const j=S[N],G=O-j;T[i+O*u]=b[j]+G*G}}class Re{constructor(i,u){this.requestManager=i,this.localIdeographFontFamily=u,this.entries={}}setURL(i){this.url=i}getGlyphs(i){return c._(this,void 0,void 0,(function*(){const u=[];for(const S in i)for(const I of i[S])u.push(this._getAndCacheGlyphsPromise(S,I));const _=yield Promise.all(u),b={};for(const{stack:S,id:I,glyph:O}of _)b[S]||(b[S]={}),b[S][I]=O&&{id:O.id,bitmap:O.bitmap.clone(),metrics:O.metrics};return b}))}_getAndCacheGlyphsPromise(i,u){return c._(this,void 0,void 0,(function*(){let _=this.entries[i];_||(_=this.entries[i]={glyphs:{},requests:{},ranges:{}});let b=_.glyphs[u];if(b!==void 0)return{stack:i,id:u,glyph:b};if(b=this._tinySDF(_,i,u),b)return _.glyphs[u]=b,{stack:i,id:u,glyph:b};const S=Math.floor(u/256);if(256*S>65535)throw new Error("glyphs > 65535 not supported");if(_.ranges[S])return{stack:i,id:u,glyph:b};if(!this.url)throw new Error("glyphsUrl is not set");if(!_.requests[S]){const O=Re.loadGlyphRange(i,S,this.url,this.requestManager);_.requests[S]=O}const I=yield _.requests[S];for(const O in I)this._doesCharSupportLocalGlyph(+O)||(_.glyphs[+O]=I[+O]);return _.ranges[S]=!0,{stack:i,id:u,glyph:I[u]||null}}))}_doesCharSupportLocalGlyph(i){return!!this.localIdeographFontFamily&&(new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(i))||c.u["CJK Unified Ideographs"](i)||c.u["Hangul Syllables"](i)||c.u.Hiragana(i)||c.u.Katakana(i)||c.u["CJK Symbols and Punctuation"](i)||c.u["Halfwidth and Fullwidth Forms"](i))}_tinySDF(i,u,_){const b=this.localIdeographFontFamily;if(!b||!this._doesCharSupportLocalGlyph(_))return;let S=i.tinySDF;if(!S){let O="400";/bold/i.test(u)?O="900":/medium/i.test(u)?O="500":/light/i.test(u)&&(O="200"),S=i.tinySDF=new Re.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:b,fontWeight:O})}const I=S.draw(String.fromCharCode(_));return{id:_,bitmap:new c.q({width:I.width||60,height:I.height||60},I.data),metrics:{width:I.glyphWidth/2||24,height:I.glyphHeight/2||24,left:I.glyphLeft/2+.5||0,top:I.glyphTop/2-27.5||-8,advance:I.glyphAdvance/2||24,isDoubleResolution:!0}}}}Re.loadGlyphRange=function(T,i,u,_){return c._(this,void 0,void 0,(function*(){const b=256*i,S=b+255,I=_.transformRequest(u.replace("{fontstack}",T).replace("{range}",`${b}-${S}`),"Glyphs"),O=yield c.n(I,new AbortController);if(!O||!O.data)throw new Error(`Could not load glyph range. range: ${i}, ${b}-${S}`);const N={};for(const j of c.o(O.data))N[j.id]=j;return N}))},Re.TinySDF=class{constructor({fontSize:T=24,buffer:i=3,radius:u=8,cutoff:_=.25,fontFamily:b="sans-serif",fontWeight:S="normal",fontStyle:I="normal",lang:O=null}={}){this.buffer=i,this.cutoff=_,this.radius=u,this.lang=O;const N=this.size=T+4*i,j=this._createCanvas(N),G=this.ctx=j.getContext("2d",{willReadFrequently:!0});G.font=`${I} ${S} ${T}px ${b}`,G.textBaseline="alphabetic",G.textAlign="left",G.fillStyle="black",this.gridOuter=new Float64Array(N*N),this.gridInner=new Float64Array(N*N),this.f=new Float64Array(N),this.z=new Float64Array(N+1),this.v=new Uint16Array(N)}_createCanvas(T){const i=document.createElement("canvas");return i.width=i.height=T,i}draw(T){const{width:i,actualBoundingBoxAscent:u,actualBoundingBoxDescent:_,actualBoundingBoxLeft:b,actualBoundingBoxRight:S}=this.ctx.measureText(T),I=Math.ceil(u),O=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(S-b))),N=Math.min(this.size-this.buffer,I+Math.ceil(_)),j=O+2*this.buffer,G=N+2*this.buffer,K=Math.max(j*G,0),Z=new Uint8ClampedArray(K),ee={data:Z,width:j,height:G,glyphWidth:O,glyphHeight:N,glyphTop:I,glyphLeft:0,glyphAdvance:i};if(O===0||N===0)return ee;const{ctx:ae,buffer:ge,gridInner:me,gridOuter:ve}=this;this.lang&&(ae.lang=this.lang),ae.clearRect(ge,ge,O,N),ae.fillText(T,ge,ge+I);const we=ae.getImageData(ge,ge,O,N);ve.fill(Ae,0,K),me.fill(0,0,K);for(let Pe=0;Pe<N;Pe++)for(let Ce=0;Ce<O;Ce++){const ze=we.data[4*(Pe*O+Ce)+3]/255;if(ze===0)continue;const Ve=(Pe+ge)*j+Ce+ge;if(ze===1)ve[Ve]=0,me[Ve]=Ae;else{const Ie=.5-ze;ve[Ve]=Ie>0?Ie*Ie:0,me[Ve]=Ie<0?Ie*Ie:0}}Me(ve,0,0,j,G,j,this.f,this.v,this.z),Me(me,ge,ge,O,N,j,this.f,this.v,this.z);for(let Pe=0;Pe<K;Pe++){const Ce=Math.sqrt(ve[Pe])-Math.sqrt(me[Pe]);Z[Pe]=Math.round(255-255*(Ce/this.radius+this.cutoff))}return ee}};class Pn{constructor(){this.specification=c.v.light.position}possiblyEvaluate(i,u){return c.B(i.expression.evaluate(u))}interpolate(i,u,_){return{x:c.C.number(i.x,u.x,_),y:c.C.number(i.y,u.y,_),z:c.C.number(i.z,u.z,_)}}}let ei;class mt extends c.E{constructor(i){super(),ei=ei||new c.r({anchor:new c.D(c.v.light.anchor),position:new Pn,color:new c.D(c.v.light.color),intensity:new c.D(c.v.light.intensity)}),this._transitionable=new c.t(ei),this.setLight(i),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(i,u={}){if(!this._validate(c.x,i,u))for(const _ in i){const b=i[_];_.endsWith("-transition")?this._transitionable.setTransition(_.slice(0,-11),b):this._transitionable.setValue(_,b)}}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,u,_){return(!_||_.validate!==!1)&&c.y(this,i.call(c.z,{value:u,style:{glyphs:!0,sprite:!0},styleSpec:c.v}))}}const $t=new c.r({"sky-color":new c.D(c.v.sky["sky-color"]),"horizon-color":new c.D(c.v.sky["horizon-color"]),"fog-color":new c.D(c.v.sky["fog-color"]),"fog-ground-blend":new c.D(c.v.sky["fog-ground-blend"]),"horizon-fog-blend":new c.D(c.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new c.D(c.v.sky["sky-horizon-blend"]),"atmosphere-blend":new c.D(c.v.sky["atmosphere-blend"])});class Tt extends c.E{constructor(i){super(),this._transitionable=new c.t($t),this.setSky(i),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new c.F(0))}setSky(i,u={}){if(!this._validate(c.G,i,u)){i||(i={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const _ in i){const b=i[_];_.endsWith("-transition")?this._transitionable.setTransition(_.slice(0,-11),b):this._transitionable.setValue(_,b)}}}getSky(){return this._transitionable.serialize()}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,u,_={}){return(_==null?void 0:_.validate)!==!1&&c.y(this,i.call(c.z,c.e({value:u,style:{glyphs:!0,sprite:!0},styleSpec:c.v})))}calculateFogBlendOpacity(i){return i<60?0:i<70?(i-60)/10:1}}class zt{constructor(i,u){this.width=i,this.height=u,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(i,u){const _=i.join(",")+String(u);return this.dashEntry[_]||(this.dashEntry[_]=this.addDash(i,u)),this.dashEntry[_]}getDashRanges(i,u,_){const b=[];let S=i.length%2==1?-i[i.length-1]*_:0,I=i[0]*_,O=!0;b.push({left:S,right:I,isDash:O,zeroLength:i[0]===0});let N=i[0];for(let j=1;j<i.length;j++){O=!O;const G=i[j];S=N*_,N+=G,I=N*_,b.push({left:S,right:I,isDash:O,zeroLength:G===0})}return b}addRoundDash(i,u,_){const b=u/2;for(let S=-_;S<=_;S++){const I=this.width*(this.nextRow+_+S);let O=0,N=i[O];for(let j=0;j<this.width;j++){j/N.right>1&&(N=i[++O]);const G=Math.abs(j-N.left),K=Math.abs(j-N.right),Z=Math.min(G,K);let ee;const ae=S/_*(b+1);if(N.isDash){const ge=b-Math.abs(ae);ee=Math.sqrt(Z*Z+ge*ge)}else ee=b-Math.sqrt(Z*Z+ae*ae);this.data[I+j]=Math.max(0,Math.min(255,ee+128))}}}addRegularDash(i){for(let O=i.length-1;O>=0;--O){const N=i[O],j=i[O+1];N.zeroLength?i.splice(O,1):j&&j.isDash===N.isDash&&(j.left=N.left,i.splice(O,1))}const u=i[0],_=i[i.length-1];u.isDash===_.isDash&&(u.left=_.left-this.width,_.right=u.right+this.width);const b=this.width*this.nextRow;let S=0,I=i[S];for(let O=0;O<this.width;O++){O/I.right>1&&(I=i[++S]);const N=Math.abs(O-I.left),j=Math.abs(O-I.right),G=Math.min(N,j);this.data[b+O]=Math.max(0,Math.min(255,(I.isDash?G:-G)+128))}}addDash(i,u){const _=u?7:0,b=2*_+1;if(this.nextRow+b>this.height)return c.w("LineAtlas out of space"),null;let S=0;for(let O=0;O<i.length;O++)S+=i[O];if(S!==0){const O=this.width/S,N=this.getDashRanges(i,this.width,O);u?this.addRoundDash(N,O,_):this.addRegularDash(N)}const I={y:(this.nextRow+_+.5)/this.height,height:2*_/this.height,width:S};return this.nextRow+=b,this.dirty=!0,I}bind(i){const u=i.gl;this.texture?(u.bindTexture(u.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,u.texSubImage2D(u.TEXTURE_2D,0,0,0,this.width,this.height,u.ALPHA,u.UNSIGNED_BYTE,this.data))):(this.texture=u.createTexture(),u.bindTexture(u.TEXTURE_2D,this.texture),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.REPEAT),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.REPEAT),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.LINEAR),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,u.LINEAR),u.texImage2D(u.TEXTURE_2D,0,u.ALPHA,this.width,this.height,0,u.ALPHA,u.UNSIGNED_BYTE,this.data))}}const Bt="maplibre_preloaded_worker_pool";class Le{constructor(){this.active={}}acquire(i){if(!this.workers)for(this.workers=[];this.workers.length<Le.workerCount;)this.workers.push(new Worker(c.a.WORKER_URL));return this.active[i]=!0,this.workers.slice()}release(i){delete this.active[i],this.numActive()===0&&(this.workers.forEach((u=>{u.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[Bt]}numActive(){return Object.keys(this.active).length}}const vt=Math.floor(J.hardwareConcurrency/2);let Ot,Ut;function Jt(){return Ot||(Ot=new Le),Ot}Le.workerCount=c.H(globalThis)?Math.max(Math.min(vt,3),1):1;class Wt{constructor(i,u){this.workerPool=i,this.actors=[],this.currentActor=0,this.id=u;const _=this.workerPool.acquire(u);for(let b=0;b<_.length;b++){const S=new c.J(_[b],u);S.name=`Worker ${b}`,this.actors.push(S)}if(!this.actors.length)throw new Error("No actors found")}broadcast(i,u){const _=[];for(const b of this.actors)_.push(b.sendAsync({type:i,data:u}));return Promise.all(_)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(i=!0){this.actors.forEach((u=>{u.remove()})),this.actors=[],i&&this.workerPool.release(this.id)}registerMessageHandler(i,u){for(const _ of this.actors)_.registerMessageHandler(i,u)}}function Fn(){return Ut||(Ut=new Wt(Jt(),c.K),Ut.registerMessageHandler("GR",((T,i,u)=>c.m(i,u)))),Ut}function oi(T,i){const u=c.L();return c.M(u,u,[1,1,0]),c.N(u,u,[.5*T.width,.5*T.height,1]),T.calculatePosMatrix?c.O(u,u,T.calculatePosMatrix(i.toUnwrapped())):u}function fi(T,i,u,_,b,S,I){var O;const N=(function(Z,ee,ae){if(Z)for(const ge of Z){const me=ee[ge];if(me&&me.source===ae&&me.type==="fill-extrusion")return!0}else for(const ge in ee){const me=ee[ge];if(me.source===ae&&me.type==="fill-extrusion")return!0}return!1})((O=b==null?void 0:b.layers)!==null&&O!==void 0?O:null,i,T.id),j=S.maxPitchScaleFactor(),G=T.tilesIn(_,j,N);G.sort(fs);const K=[];for(const Z of G)K.push({wrappedTileID:Z.tileID.wrapped().key,queryResults:Z.tile.queryRenderedFeatures(i,u,T._state,Z.queryGeometry,Z.cameraQueryGeometry,Z.scale,b,S,j,oi(T.transform,Z.tileID),I?(ee,ae)=>I(Z.tileID,ee,ae):void 0)});return(function(Z,ee){for(const ae in Z)for(const ge of Z[ae])Bs(ge,ee);return Z})((function(Z){const ee={},ae={};for(const ge of Z){const me=ge.queryResults,ve=ge.wrappedTileID,we=ae[ve]=ae[ve]||{};for(const Pe in me){const Ce=me[Pe],ze=we[Pe]=we[Pe]||{},Ve=ee[Pe]=ee[Pe]||[];for(const Ie of Ce)ze[Ie.featureIndex]||(ze[Ie.featureIndex]=!0,Ve.push(Ie))}}return ee})(K),T)}function fs(T,i){const u=T.tileID,_=i.tileID;return u.overscaledZ-_.overscaledZ||u.canonical.y-_.canonical.y||u.wrap-_.wrap||u.canonical.x-_.canonical.x}function Bs(T,i){const u=T.feature,_=i.getFeatureState(u.layer["source-layer"],u.id);u.source=u.layer.source,u.layer["source-layer"]&&(u.sourceLayer=u.layer["source-layer"]),u.state=_}function Dr(T,i,u){return c._(this,void 0,void 0,(function*(){let _=T;if(T.url?_=(yield c.j(i.transformRequest(T.url,"Source"),u)).data:yield J.frameAsync(u),!_)return null;const b=c.Q(c.e(_,T),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in _&&_.vector_layers&&(b.vectorLayerIds=_.vector_layers.map((S=>S.id))),b}))}class Fi{constructor(i,u){i&&(u?this.setSouthWest(i).setNorthEast(u):Array.isArray(i)&&(i.length===4?this.setSouthWest([i[0],i[1]]).setNorthEast([i[2],i[3]]):this.setSouthWest(i[0]).setNorthEast(i[1])))}setNorthEast(i){return this._ne=i instanceof c.S?new c.S(i.lng,i.lat):c.S.convert(i),this}setSouthWest(i){return this._sw=i instanceof c.S?new c.S(i.lng,i.lat):c.S.convert(i),this}extend(i){const u=this._sw,_=this._ne;let b,S;if(i instanceof c.S)b=i,S=i;else{if(!(i instanceof Fi))return Array.isArray(i)?i.length===4||i.every(Array.isArray)?this.extend(Fi.convert(i)):this.extend(c.S.convert(i)):i&&("lng"in i||"lon"in i)&&"lat"in i?this.extend(c.S.convert(i)):this;if(b=i._sw,S=i._ne,!b||!S)return this}return u||_?(u.lng=Math.min(b.lng,u.lng),u.lat=Math.min(b.lat,u.lat),_.lng=Math.max(S.lng,_.lng),_.lat=Math.max(S.lat,_.lat)):(this._sw=new c.S(b.lng,b.lat),this._ne=new c.S(S.lng,S.lat)),this}getCenter(){return new c.S((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new c.S(this.getWest(),this.getNorth())}getSouthEast(){return new c.S(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(i){const{lng:u,lat:_}=c.S.convert(i);let b=this._sw.lng<=u&&u<=this._ne.lng;return this._sw.lng>this._ne.lng&&(b=this._sw.lng>=u&&u>=this._ne.lng),this._sw.lat<=_&&_<=this._ne.lat&&b}static convert(i){return i instanceof Fi?i:i&&new Fi(i)}static fromLngLat(i,u=0){const _=360*u/40075017,b=_/Math.cos(Math.PI/180*i.lat);return new Fi(new c.S(i.lng-b,i.lat-_),new c.S(i.lng+b,i.lat+_))}adjustAntiMeridian(){const i=new c.S(this._sw.lng,this._sw.lat),u=new c.S(this._ne.lng,this._ne.lat);return new Fi(i,i.lng>u.lng?new c.S(u.lng+360,u.lat):u)}}class Mi{constructor(i,u,_){this.bounds=Fi.convert(this.validateBounds(i)),this.minzoom=u||0,this.maxzoom=_||24}validateBounds(i){return Array.isArray(i)&&i.length===4?[Math.max(-180,i[0]),Math.max(-90,i[1]),Math.min(180,i[2]),Math.min(90,i[3])]:[-180,-90,180,90]}contains(i){const u=Math.pow(2,i.z),_=Math.floor(c.V(this.bounds.getWest())*u),b=Math.floor(c.U(this.bounds.getNorth())*u),S=Math.ceil(c.V(this.bounds.getEast())*u),I=Math.ceil(c.U(this.bounds.getSouth())*u);return i.x>=_&&i.x<S&&i.y>=b&&i.y<I}}class Ua extends c.E{constructor(i,u,_,b){if(super(),this.id=i,this.dispatcher=_,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,c.e(this,c.Q(u,["url","scheme","tileSize","promoteId"])),this._options=c.e({type:"vector"},u),this._collectResourceTiming=u.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(b)}load(){return c._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new c.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const i=yield Dr(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),i&&(c.e(this,i),i.bounds&&(this.tileBounds=new Mi(i.bounds,this.minzoom,this.maxzoom)),this.fire(new c.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.l("data",{dataType:"source",sourceDataType:"content"})))}catch(i){this._tileJSONRequest=null,this.fire(new c.k(i))}}))}loaded(){return this._loaded}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}onAdd(i){this.map=i,this.load()}setSourceProperty(i){this._tileJSONRequest&&this._tileJSONRequest.abort(),i(),this.load()}setTiles(i){return this.setSourceProperty((()=>{this._options.tiles=i})),this}setUrl(i){return this.setSourceProperty((()=>{this.url=i,this._options.url=i})),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return c.e({},this._options)}loadTile(i){return c._(this,void 0,void 0,(function*(){const u=i.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),_={request:this.map._requestManager.transformRequest(u,"Tile"),uid:i.uid,tileID:i.tileID,zoom:i.tileID.overscaledZ,tileSize:this.tileSize*i.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,globalState:this.map.getGlobalState()};_.request.collectResourceTiming=this._collectResourceTiming;let b="RT";if(i.actor&&i.state!=="expired"){if(i.state==="loading")return new Promise(((S,I)=>{i.reloadPromise={resolve:S,reject:I}}))}else i.actor=this.dispatcher.getActor(),b="LT";i.abortController=new AbortController;try{const S=yield i.actor.sendAsync({type:b,data:_},i.abortController);if(delete i.abortController,i.aborted)return;this._afterTileLoadWorkerResponse(i,S)}catch(S){if(delete i.abortController,i.aborted)return;if(S&&S.status!==404)throw S;this._afterTileLoadWorkerResponse(i,null)}}))}_afterTileLoadWorkerResponse(i,u){if(u&&u.resourceTiming&&(i.resourceTiming=u.resourceTiming),u&&this.map._refreshExpiredTiles&&i.setExpiryData(u),i.loadVectorData(u,this.map.painter),i.reloadPromise){const _=i.reloadPromise;i.reloadPromise=null,this.loadTile(i).then(_.resolve).catch(_.reject)}}abortTile(i){return c._(this,void 0,void 0,(function*(){i.abortController&&(i.abortController.abort(),delete i.abortController),i.actor&&(yield i.actor.sendAsync({type:"AT",data:{uid:i.uid,type:this.type,source:this.id}}))}))}unloadTile(i){return c._(this,void 0,void 0,(function*(){i.unloadVectorData(),i.actor&&(yield i.actor.sendAsync({type:"RMT",data:{uid:i.uid,type:this.type,source:this.id}}))}))}hasTransition(){return!1}}class Sa extends c.E{constructor(i,u,_,b){super(),this.id=i,this.dispatcher=_,this.setEventedParent(b),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=c.e({type:"raster"},u),c.e(this,c.Q(u,["url","scheme","tileSize"]))}load(){return c._(this,arguments,void 0,(function*(i=!1){this._loaded=!1,this.fire(new c.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const u=yield Dr(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,u&&(c.e(this,u),u.bounds&&(this.tileBounds=new Mi(u.bounds,this.minzoom,this.maxzoom)),this.fire(new c.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:i})))}catch(u){this._tileJSONRequest=null,this.fire(new c.k(u))}}))}loaded(){return this._loaded}onAdd(i){this.map=i,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(i){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),i(),this.load(!0)}setTiles(i){return this.setSourceProperty((()=>{this._options.tiles=i})),this}setUrl(i){return this.setSourceProperty((()=>{this.url=i,this._options.url=i})),this}serialize(){return c.e({},this._options)}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}loadTile(i){return c._(this,void 0,void 0,(function*(){const u=i.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);i.abortController=new AbortController;try{const _=yield Ze.getImage(this.map._requestManager.transformRequest(u,"Tile"),i.abortController,this.map._refreshExpiredTiles);if(delete i.abortController,i.aborted)return void(i.state="unloaded");if(_&&_.data){this.map._refreshExpiredTiles&&(_.cacheControl||_.expires)&&i.setExpiryData({cacheControl:_.cacheControl,expires:_.expires});const b=this.map.painter.context,S=b.gl,I=_.data;i.texture=this.map.painter.getTileTexture(I.width),i.texture?i.texture.update(I,{useMipmap:!0}):(i.texture=new c.T(b,I,S.RGBA,{useMipmap:!0}),i.texture.bind(S.LINEAR,S.CLAMP_TO_EDGE,S.LINEAR_MIPMAP_NEAREST)),i.state="loaded"}}catch(_){if(delete i.abortController,i.aborted)i.state="unloaded";else if(_)throw i.state="errored",_}}))}abortTile(i){return c._(this,void 0,void 0,(function*(){i.abortController&&(i.abortController.abort(),delete i.abortController)}))}unloadTile(i){return c._(this,void 0,void 0,(function*(){i.texture&&this.map.painter.saveTileTexture(i.texture)}))}hasTransition(){return!1}}class Fs extends Sa{constructor(i,u,_,b){super(i,u,_,b),this.type="raster-dem",this.maxzoom=22,this._options=c.e({type:"raster-dem"},u),this.encoding=u.encoding||"mapbox",this.redFactor=u.redFactor,this.greenFactor=u.greenFactor,this.blueFactor=u.blueFactor,this.baseShift=u.baseShift}loadTile(i){return c._(this,void 0,void 0,(function*(){const u=i.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),_=this.map._requestManager.transformRequest(u,"Tile");i.neighboringTiles=this._getNeighboringTiles(i.tileID),i.abortController=new AbortController;try{const b=yield Ze.getImage(_,i.abortController,this.map._refreshExpiredTiles);if(delete i.abortController,i.aborted)return void(i.state="unloaded");if(b&&b.data){const S=b.data;this.map._refreshExpiredTiles&&(b.cacheControl||b.expires)&&i.setExpiryData({cacheControl:b.cacheControl,expires:b.expires});const I=c.b(S)&&c.W()?S:yield this.readImageNow(S),O={type:this.type,uid:i.uid,source:this.id,rawImageData:I,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!i.actor||i.state==="expired"){i.actor=this.dispatcher.getActor();const N=yield i.actor.sendAsync({type:"LDT",data:O});i.dem=N,i.needsHillshadePrepare=!0,i.needsTerrainPrepare=!0,i.state="loaded"}}}catch(b){if(delete i.abortController,i.aborted)i.state="unloaded";else if(b)throw i.state="errored",b}}))}readImageNow(i){return c._(this,void 0,void 0,(function*(){if(typeof VideoFrame<"u"&&c.X()){const u=i.width+2,_=i.height+2;try{return new c.R({width:u,height:_},yield c.Y(i,-1,-1,u,_))}catch{}}return J.getImageData(i,1)}))}_getNeighboringTiles(i){const u=i.canonical,_=Math.pow(2,u.z),b=(u.x-1+_)%_,S=u.x===0?i.wrap-1:i.wrap,I=(u.x+1+_)%_,O=u.x+1===_?i.wrap+1:i.wrap,N={};return N[new c.Z(i.overscaledZ,S,u.z,b,u.y).key]={backfilled:!1},N[new c.Z(i.overscaledZ,O,u.z,I,u.y).key]={backfilled:!1},u.y>0&&(N[new c.Z(i.overscaledZ,S,u.z,b,u.y-1).key]={backfilled:!1},N[new c.Z(i.overscaledZ,i.wrap,u.z,u.x,u.y-1).key]={backfilled:!1},N[new c.Z(i.overscaledZ,O,u.z,I,u.y-1).key]={backfilled:!1}),u.y+1<_&&(N[new c.Z(i.overscaledZ,S,u.z,b,u.y+1).key]={backfilled:!1},N[new c.Z(i.overscaledZ,i.wrap,u.z,u.x,u.y+1).key]={backfilled:!1},N[new c.Z(i.overscaledZ,O,u.z,I,u.y+1).key]={backfilled:!1}),N}unloadTile(i){return c._(this,void 0,void 0,(function*(){i.demTexture&&this.map.painter.saveTileTexture(i.demTexture),i.fbo&&(i.fbo.destroy(),delete i.fbo),i.dem&&delete i.dem,delete i.neighboringTiles,i.state="unloaded",i.actor&&(yield i.actor.sendAsync({type:"RDT",data:{type:this.type,uid:i.uid,source:this.id}}))}))}}class Ea extends c.E{constructor(i,u,_,b){super(),this.id=i,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._isUpdatingWorker=!1,this._pendingWorkerUpdate={data:u.data},this.actor=_.getActor(),this.setEventedParent(b),this._data=u.data,this._options=c.e({},u),this._collectResourceTiming=u.collectResourceTiming,u.maxzoom!==void 0&&(this.maxzoom=u.maxzoom),u.type&&(this.type=u.type),u.attribution&&(this.attribution=u.attribution),this.promoteId=u.promoteId,u.clusterMaxZoom!==void 0&&this.maxzoom<=u.clusterMaxZoom&&c.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${u.clusterMaxZoom}".`),this.workerOptions=c.e({source:this.id,cluster:u.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(u.buffer!==void 0?u.buffer:128),tolerance:this._pixelsToTileUnits(u.tolerance!==void 0?u.tolerance:.375),extent:c.$,maxZoom:this.maxzoom,lineMetrics:u.lineMetrics||!1,generateId:u.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(u.clusterMaxZoom),minPoints:Math.max(2,u.clusterMinPoints||2),extent:c.$,radius:this._pixelsToTileUnits(u.clusterRadius||50),log:!1,generateId:u.generateId||!1},clusterProperties:u.clusterProperties,filter:u.filter},u.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_pixelsToTileUnits(i){return i*(c.$/this.tileSize)}_getClusterMaxZoom(i){const u=i?Math.round(i):this.maxzoom-1;return Number.isInteger(i)||i===void 0||c.w(`Integer expected for option 'clusterMaxZoom': provided value "${i}" rounded to "${u}"`),u}load(){return c._(this,void 0,void 0,(function*(){yield this._updateWorkerData()}))}onAdd(i){this.map=i,this.load()}setData(i){return this._data=i,this._pendingWorkerUpdate={data:i},this._updateWorkerData(),this}updateData(i){return this._pendingWorkerUpdate.diff=c.a0(this._pendingWorkerUpdate.diff,i),this._updateWorkerData(),this}getData(){return c._(this,void 0,void 0,(function*(){const i=c.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:i})}))}getCoordinatesFromGeometry(i){return i.type==="GeometryCollection"?i.geometries.map((u=>u.coordinates)).flat(1/0):i.coordinates.flat(1/0)}getBounds(){return c._(this,void 0,void 0,(function*(){const i=new Fi,u=yield this.getData();let _;switch(u.type){case"FeatureCollection":_=u.features.map((b=>this.getCoordinatesFromGeometry(b.geometry))).flat(1/0);break;case"Feature":_=this.getCoordinatesFromGeometry(u.geometry);break;default:_=this.getCoordinatesFromGeometry(u)}if(_.length==0)return i;for(let b=0;b<_.length-1;b+=2)i.extend([_[b],_[b+1]]);return i}))}setClusterOptions(i){return this.workerOptions.cluster=i.cluster,i&&(i.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(i.clusterRadius)),i.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(i.clusterMaxZoom))),this._updateWorkerData(),this}getClusterExpansionZoom(i){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:i,source:this.id}})}getClusterChildren(i){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:i,source:this.id}})}getClusterLeaves(i,u,_){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:i,limit:u,offset:_}})}_updateWorkerData(){return c._(this,void 0,void 0,(function*(){if(this._isUpdatingWorker)return;const{data:i,diff:u}=this._pendingWorkerUpdate;if(!i&&!u)return void c.w(`No data or diff provided to GeoJSONSource ${this.id}.`);const _=c.e({type:this.type},this.workerOptions);i?(typeof i=="string"?(_.request=this.map._requestManager.transformRequest(J.resolveURL(i),"Source"),_.request.collectResourceTiming=this._collectResourceTiming):_.data=JSON.stringify(i),this._pendingWorkerUpdate.data=void 0):u&&(_.dataDiff=u,this._pendingWorkerUpdate.diff=void 0),this._isUpdatingWorker=!0,this.fire(new c.l("dataloading",{dataType:"source"}));try{const b=yield this.actor.sendAsync({type:"LD",data:_});if(this._isUpdatingWorker=!1,this._removed||b.abandoned)return void this.fire(new c.l("dataabort",{dataType:"source"}));this._data=b.data;let S=null;b.resourceTiming&&b.resourceTiming[this.id]&&(S=b.resourceTiming[this.id].slice(0));const I={dataType:"source"};this._collectResourceTiming&&S&&S.length>0&&c.e(I,{resourceTiming:S}),this.fire(new c.l("data",Object.assign(Object.assign({},I),{sourceDataType:"metadata"}))),this.fire(new c.l("data",Object.assign(Object.assign({},I),{sourceDataType:"content"})))}catch(b){if(this._isUpdatingWorker=!1,this._removed)return void this.fire(new c.l("dataabort",{dataType:"source"}));this.fire(new c.k(b))}finally{(this._pendingWorkerUpdate.data||this._pendingWorkerUpdate.diff)&&this._updateWorkerData()}}))}loaded(){return!this._isUpdatingWorker&&this._pendingWorkerUpdate.data===void 0&&this._pendingWorkerUpdate.diff===void 0}loadTile(i){return c._(this,void 0,void 0,(function*(){const u=i.actor?"RT":"LT";i.actor=this.actor;const _={type:this.type,uid:i.uid,tileID:i.tileID,zoom:i.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,globalState:this.map.getGlobalState()};i.abortController=new AbortController;const b=yield this.actor.sendAsync({type:u,data:_},i.abortController);delete i.abortController,i.unloadVectorData(),i.aborted||i.loadVectorData(b,this.map.painter,u==="RT")}))}abortTile(i){return c._(this,void 0,void 0,(function*(){i.abortController&&(i.abortController.abort(),delete i.abortController),i.aborted=!0}))}unloadTile(i){return c._(this,void 0,void 0,(function*(){i.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:i.uid,type:this.type,source:this.id}})}))}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return c.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}class Vi extends c.E{constructor(i,u,_,b){super(),this.flippedWindingOrder=!1,this.id=i,this.dispatcher=_,this.coordinates=u.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(b),this.options=u}load(i){return c._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new c.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const u=yield Ze.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,u&&u.data&&(this.image=u.data,i&&(this.coordinates=i),this._finishLoading())}catch(u){this._request=null,this._loaded=!0,this.fire(new c.k(u))}}))}loaded(){return this._loaded}updateImage(i){return i.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=i.url,this.load(i.coordinates).finally((()=>{this.texture=null})),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new c.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(i){this.map=i,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(i){this.coordinates=i;const u=i.map(c.a1.fromLngLat);var _;return this.tileID=(function(b){const S=c.a2.fromPoints(b),I=S.width(),O=S.height(),N=Math.max(I,O),j=Math.max(0,Math.floor(-Math.log(N)/Math.LN2)),G=Math.pow(2,j);return new c.a4(j,Math.floor((S.minX+S.maxX)/2*G),Math.floor((S.minY+S.maxY)/2*G))})(u),this.terrainTileRanges=this._getOverlappingTileRanges(u),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=u.map((b=>this.tileID.getTilePoint(b)._round())),this.flippedWindingOrder=((_=this.tileCoords)[1].x-_[0].x)*(_[2].y-_[0].y)-(_[1].y-_[0].y)*(_[2].x-_[0].x)<0,this.fire(new c.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const i=this.map.painter.context,u=i.gl;this.texture||(this.texture=new c.T(i,this.image,u.RGBA),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE));let _=!1;for(const b in this.tiles){const S=this.tiles[b];S.state!=="loaded"&&(S.state="loaded",S.texture=this.texture,_=!0)}_&&this.fire(new c.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(i){return c._(this,void 0,void 0,(function*(){this.tileID&&this.tileID.equals(i.tileID.canonical)?(this.tiles[String(i.tileID.wrap)]=i,i.buckets={}):i.state="errored"}))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(i){const{minX:u,minY:_,maxX:b,maxY:S}=c.a2.fromPoints(i),I={};for(let O=0;O<=c.a3;O++){const N=Math.pow(2,O),j=Math.floor(u*N),G=Math.floor(_*N),K=Math.floor(b*N),Z=Math.floor(S*N);I[O]={minTileX:j,minTileY:G,maxTileX:K,maxTileY:Z}}return I}}class pr extends Vi{constructor(i,u,_,b){super(i,u,_,b),this.roundZoom=!0,this.type="video",this.options=u}load(){return c._(this,void 0,void 0,(function*(){this._loaded=!1;const i=this.options;this.urls=[];for(const u of i.urls)this.urls.push(this.map._requestManager.transformRequest(u,"Source").url);try{const u=yield c.a5(this.urls);if(this._loaded=!0,!u)return;this.video=u,this.video.loop=!0,this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading()}catch(u){this.fire(new c.k(u))}}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(i){if(this.video){const u=this.video.seekable;i<u.start(0)||i>u.end(0)?this.fire(new c.k(new c.a6(`sources.${this.id}`,null,`Playback for this video can be set only between the ${u.start(0)} and ${u.end(0)}-second mark.`))):this.video.currentTime=i}}getVideo(){return this.video}onAdd(i){this.map||(this.map=i,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const i=this.map.painter.context,u=i.gl;this.texture?this.video.paused||(this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE),u.texSubImage2D(u.TEXTURE_2D,0,0,0,u.RGBA,u.UNSIGNED_BYTE,this.video)):(this.texture=new c.T(i,this.video,u.RGBA),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE));let _=!1;for(const b in this.tiles){const S=this.tiles[b];S.state!=="loaded"&&(S.state="loaded",S.texture=this.texture,_=!0)}_&&this.fire(new c.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Aa extends Vi{constructor(i,u,_,b){super(i,u,_,b),u.coordinates?Array.isArray(u.coordinates)&&u.coordinates.length===4&&!u.coordinates.some((S=>!Array.isArray(S)||S.length!==2||S.some((I=>typeof I!="number"))))||this.fire(new c.k(new c.a6(`sources.${i}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new c.k(new c.a6(`sources.${i}`,null,'missing required property "coordinates"'))),u.animate&&typeof u.animate!="boolean"&&this.fire(new c.k(new c.a6(`sources.${i}`,null,'optional "animate" property must be a boolean value'))),u.canvas?typeof u.canvas=="string"||u.canvas instanceof HTMLCanvasElement||this.fire(new c.k(new c.a6(`sources.${i}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new c.k(new c.a6(`sources.${i}`,null,'missing required property "canvas"'))),this.options=u,this.animate=u.animate===void 0||u.animate}load(){return c._(this,void 0,void 0,(function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new c.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}))}getCanvas(){return this.canvas}onAdd(i){this.map=i,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let i=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,i=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,i=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const u=this.map.painter.context,_=u.gl;this.texture?(i||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new c.T(u,this.canvas,_.RGBA,{premultiply:!0});let b=!1;for(const S in this.tiles){const I=this.tiles[S];I.state!=="loaded"&&(I.state="loaded",I.texture=this.texture,b=!0)}b&&this.fire(new c.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const i of[this.canvas.width,this.canvas.height])if(isNaN(i)||i<=0)return!0;return!1}}const Eo={},oo=T=>{switch(T){case"geojson":return Ea;case"image":return Vi;case"raster":return Sa;case"raster-dem":return Fs;case"vector":return Ua;case"video":return pr;case"canvas":return Aa}return Eo[T]},qr="RTLPluginLoaded";class ps extends c.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Fn()}_syncState(i){return this.status=i,this.dispatcher.broadcast("SRPS",{pluginStatus:i,pluginURL:this.url}).catch((u=>{throw this.status="error",u}))}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(i){return c._(this,arguments,void 0,(function*(u,_=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=J.resolveURL(u),!this.url)throw new Error(`requested url ${u} is invalid`);if(this.status==="unavailable"){if(!_)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()}))}_requestImport(){return c._(this,void 0,void 0,(function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new c.l(qr))}))}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let ms=null;function Vs(){return ms||(ms=new ps),ms}class gs{constructor(i,u){this.timeAdded=0,this.fadeEndTime=0,this.tileID=i,this.uid=c.a7(),this.uses=0,this.tileSize=u,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(i){const u=i+this.timeAdded;u<this.fadeEndTime||(this.fadeEndTime=u)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(i){this.demTexture&&i.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(i,u,_){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",i){i.featureIndex&&(this.latestFeatureIndex=i.featureIndex,i.rawTileData?(this.latestRawTileData=i.rawTileData,this.latestFeatureIndex.rawTileData=i.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=i.collisionBoxArray,this.buckets=(function(b,S){const I={};if(!S)return I;for(const O of b){const N=O.layerIds.map((j=>S.getLayer(j))).filter(Boolean);if(N.length!==0){O.layers=N,O.stateDependentLayerIds&&(O.stateDependentLayers=O.stateDependentLayerIds.map((j=>N.filter((G=>G.id===j))[0])));for(const j of N)I[j.id]=O}}return I})(i.buckets,u==null?void 0:u.style),this.hasSymbolBuckets=!1;for(const b in this.buckets){const S=this.buckets[b];if(S instanceof c.a9){if(this.hasSymbolBuckets=!0,!_)break;S.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const b in this.buckets){const S=this.buckets[b];if(S instanceof c.a9&&S.hasRTLText){this.hasRTLText=!0,Vs().lazyLoad();break}}this.queryPadding=0;for(const b in this.buckets){const S=this.buckets[b];this.queryPadding=Math.max(this.queryPadding,u.style.getLayer(b).queryRadius(S))}i.imageAtlas&&(this.imageAtlas=i.imageAtlas),i.glyphAtlasImage&&(this.glyphAtlasImage=i.glyphAtlasImage)}else this.collisionBoxArray=new c.a8}unloadVectorData(){for(const i in this.buckets)this.buckets[i].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(i){return this.buckets[i.id]}upload(i){for(const _ in this.buckets){const b=this.buckets[_];b.uploadPending()&&b.upload(i)}const u=i.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new c.T(i,this.imageAtlas.image,u.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new c.T(i,this.glyphAtlasImage,u.ALPHA),this.glyphAtlasImage=null)}prepare(i){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(i,this.imageAtlasTexture)}queryRenderedFeatures(i,u,_,b,S,I,O,N,j,G,K){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:b,cameraQueryGeometry:S,scale:I,tileSize:this.tileSize,pixelPosMatrix:G,transform:N,params:O,queryPadding:this.queryPadding*j,getElevation:K},i,u,_):{}}querySourceFeatures(i,u){const _=this.latestFeatureIndex;if(!_||!_.rawTileData)return;const b=_.loadVTLayers(),S=u&&u.sourceLayer?u.sourceLayer:"",I=b._geojsonTileLayer||b[S];if(!I)return;const O=c.aa(u&&u.filter),{z:N,x:j,y:G}=this.tileID.canonical,K={z:N,x:j,y:G};for(let Z=0;Z<I.length;Z++){const ee=I.feature(Z);if(O.needGeometry){const me=c.ab(ee,!0);if(!O.filter(new c.F(this.tileID.overscaledZ),me,this.tileID.canonical))continue}else if(!O.filter(new c.F(this.tileID.overscaledZ),ee))continue;const ae=_.getId(ee,S),ge=new c.ac(ee,N,j,G,ae);ge.tile=K,i.push(ge)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(i){const u=this.expirationTime;if(i.cacheControl){const _=c.ad(i.cacheControl);_["max-age"]&&(this.expirationTime=Date.now()+1e3*_["max-age"])}else i.expires&&(this.expirationTime=new Date(i.expires).getTime());if(this.expirationTime){const _=Date.now();let b=!1;if(this.expirationTime>_)b=!1;else if(u)if(this.expirationTime<u)b=!0;else{const S=this.expirationTime-u;S?this.expirationTime=_+Math.max(S,3e4):b=!0}else b=!0;b?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(i,u){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(i).length===0)return;const _=this.latestFeatureIndex.loadVTLayers();for(const b in this.buckets){if(!u.style.hasLayer(b))continue;const S=this.buckets[b],I=S.layers[0].sourceLayer||"_geojsonTileLayer",O=_[I],N=i[I];if(!O||!N||Object.keys(N).length===0)continue;S.update(N,O,this.imageAtlas&&this.imageAtlas.patternPositions||{});const j=u&&u.style&&u.style.getLayer(b);j&&(this.queryPadding=Math.max(this.queryPadding,j.queryRadius(S)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<J.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(i){this.symbolFadeHoldUntil=J.now()+i}setDependencies(i,u){const _={};for(const b of u)_[b]=!0;this.dependencies[i]=_}hasDependency(i,u){for(const _ of i){const b=this.dependencies[_];if(b){for(const S of u)if(b[S])return!0}}return!1}}class Xe{constructor(i,u){this.max=i,this.onRemove=u,this.reset()}reset(){for(const i in this.data)for(const u of this.data[i])u.timeout&&clearTimeout(u.timeout),this.onRemove(u.value);return this.data={},this.order=[],this}add(i,u,_){const b=i.wrapped().key;this.data[b]===void 0&&(this.data[b]=[]);const S={value:u,timeout:void 0};if(_!==void 0&&(S.timeout=setTimeout((()=>{this.remove(i,S)}),_)),this.data[b].push(S),this.order.push(b),this.order.length>this.max){const I=this._getAndRemoveByKey(this.order[0]);I&&this.onRemove(I)}return this}has(i){return i.wrapped().key in this.data}getAndRemove(i){return this.has(i)?this._getAndRemoveByKey(i.wrapped().key):null}_getAndRemoveByKey(i){const u=this.data[i].shift();return u.timeout&&clearTimeout(u.timeout),this.data[i].length===0&&delete this.data[i],this.order.splice(this.order.indexOf(i),1),u.value}getByKey(i){const u=this.data[i];return u?u[0].value:null}get(i){return this.has(i)?this.data[i.wrapped().key][0].value:null}remove(i,u){if(!this.has(i))return this;const _=i.wrapped().key,b=u===void 0?0:this.data[_].indexOf(u),S=this.data[_][b];return this.data[_].splice(b,1),S.timeout&&clearTimeout(S.timeout),this.data[_].length===0&&delete this.data[_],this.onRemove(S.value),this.order.splice(this.order.indexOf(_),1),this}setMaxSize(i){for(this.max=i;this.order.length>this.max;){const u=this._getAndRemoveByKey(this.order[0]);u&&this.onRemove(u)}return this}filter(i){const u=[];for(const _ in this.data)for(const b of this.data[_])i(b.value)||u.push(b);for(const _ of u)this.remove(_.value.tileID,_)}}class se{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(i,u,_){const b=String(u);if(this.stateChanges[i]=this.stateChanges[i]||{},this.stateChanges[i][b]=this.stateChanges[i][b]||{},c.e(this.stateChanges[i][b],_),this.deletedStates[i]===null){this.deletedStates[i]={};for(const S in this.state[i])S!==b&&(this.deletedStates[i][S]=null)}else if(this.deletedStates[i]&&this.deletedStates[i][b]===null){this.deletedStates[i][b]={};for(const S in this.state[i][b])_[S]||(this.deletedStates[i][b][S]=null)}else for(const S in _)this.deletedStates[i]&&this.deletedStates[i][b]&&this.deletedStates[i][b][S]===null&&delete this.deletedStates[i][b][S]}removeFeatureState(i,u,_){if(this.deletedStates[i]===null)return;const b=String(u);if(this.deletedStates[i]=this.deletedStates[i]||{},_&&u!==void 0)this.deletedStates[i][b]!==null&&(this.deletedStates[i][b]=this.deletedStates[i][b]||{},this.deletedStates[i][b][_]=null);else if(u!==void 0)if(this.stateChanges[i]&&this.stateChanges[i][b])for(_ in this.deletedStates[i][b]={},this.stateChanges[i][b])this.deletedStates[i][b][_]=null;else this.deletedStates[i][b]=null;else this.deletedStates[i]=null}getState(i,u){const _=String(u),b=c.e({},(this.state[i]||{})[_],(this.stateChanges[i]||{})[_]);if(this.deletedStates[i]===null)return{};if(this.deletedStates[i]){const S=this.deletedStates[i][u];if(S===null)return{};for(const I in S)delete b[I]}return b}initializeTileState(i,u){i.setFeatureState(this.state,u)}coalesceChanges(i,u){const _={};for(const b in this.stateChanges){this.state[b]=this.state[b]||{};const S={};for(const I in this.stateChanges[b])this.state[b][I]||(this.state[b][I]={}),c.e(this.state[b][I],this.stateChanges[b][I]),S[I]=this.state[b][I];_[b]=S}for(const b in this.deletedStates){this.state[b]=this.state[b]||{};const S={};if(this.deletedStates[b]===null)for(const I in this.state[b])S[I]={},this.state[b][I]={};else for(const I in this.deletedStates[b]){if(this.deletedStates[b][I]===null)this.state[b][I]={};else for(const O of Object.keys(this.deletedStates[b][I]))delete this.state[b][I][O];S[I]=this.state[b][I]}_[b]=_[b]||{},c.e(_[b],S)}if(this.stateChanges={},this.deletedStates={},Object.keys(_).length!==0)for(const b in i)i[b].setFeatureState(_,u)}}const le=89.25;function fe(T,i){const u=c.ah(i.lat,-c.ai,c.ai);return new c.P(c.V(i.lng)*T,c.U(u)*T)}function Se(T,i){return new c.a1(i.x/T,i.y/T).toLngLat()}function De(T){return T.cameraToCenterDistance*Math.min(.85*Math.tan(c.ae(90-T.pitch)),Math.tan(c.ae(le-T.pitch)))}function He(T,i){const u=T.canonical,_=i/c.af(u.z),b=u.x+Math.pow(2,u.z)*T.wrap,S=c.ag(new Float64Array(16));return c.M(S,S,[b*_,u.y*_,0]),c.N(S,S,[_/c.$,_/c.$,1]),S}function tt(T,i,u,_,b){const S=c.a1.fromLngLat(T,i),I=b*c.aj(1,T.lat),O=I*Math.cos(c.ae(u)),N=Math.sqrt(I*I-O*O),j=N*Math.sin(c.ae(-_)),G=N*Math.cos(c.ae(-_));return new c.a1(S.x+j,S.y+G,S.z+O)}function We(T,i,u){const _=i.intersectsFrustum(T);if(!u||_===0)return _;const b=i.intersectsPlane(u);return b===0?0:_===2&&b===2?2:1}function _t(T,i,u){let _=0;const b=(u-i)/10;for(let S=0;S<10;S++)_+=b*Math.pow(Math.cos(i+(S+.5)/10*(u-i)),T);return _}function Pt(T,i){return function(u,_,b,S,I){const O=2*((T-1)/c.ak(Math.cos(c.ae(le-I))/Math.cos(c.ae(le)))-1),N=Math.acos(b/S),j=2*_t(O-1,0,c.ae(I/2)),G=Math.min(c.ae(le),N+c.ae(I/2)),K=_t(O-1,Math.min(G,N-c.ae(I/2)),G),Z=Math.atan(_/b),ee=Math.hypot(_,b);let ae=u;return ae+=c.ak(S/ee/Math.max(.5,Math.cos(c.ae(I/2)))),ae+=O*c.ak(Math.cos(Z))/2,ae-=c.ak(Math.max(1,K/j/i))/2,ae}}const xt=Pt(9.314,3);function tn(T,i){const u=(i.roundZoom?Math.round:Math.floor)(T.zoom+c.ak(T.tileSize/i.tileSize));return Math.max(0,u)}function $e(T,i){const u=T.getCameraFrustum(),_=T.getClippingPlane(),b=T.screenPointToMercatorCoordinate(T.getCameraPoint()),S=c.a1.fromLngLat(T.center,T.elevation);b.z=S.z+Math.cos(T.pitchInRadians)*T.cameraToCenterDistance/T.worldSize;const I=T.getCoveringTilesDetailsProvider(),O=I.allowVariableZoom(T,i),N=tn(T,i),j=i.minzoom||0,G=i.maxzoom!==void 0?i.maxzoom:T.maxZoom,K=Math.min(Math.max(0,N),G),Z=Math.pow(2,K),ee=[Z*b.x,Z*b.y,0],ae=[Z*S.x,Z*S.y,0],ge=Math.hypot(S.x-b.x,S.y-b.y),me=Math.abs(S.z-b.z),ve=Math.hypot(ge,me),we=ze=>({zoom:0,x:0,y:0,wrap:ze,fullyVisible:!1}),Pe=[],Ce=[];if(T.renderWorldCopies&&I.allowWorldCopies())for(let ze=1;ze<=3;ze++)Pe.push(we(-ze)),Pe.push(we(ze));for(Pe.push(we(0));Pe.length>0;){const ze=Pe.pop(),Ve=ze.x,Ie=ze.y;let Ye=ze.fullyVisible;const ct={x:Ve,y:Ie,z:ze.zoom},rt=I.getTileBoundingVolume(ct,ze.wrap,T.elevation,i);if(!Ye){const Vt=We(u,rt,_);if(Vt===0)continue;Ye=Vt===2}const st=I.distanceToTile2d(b.x,b.y,ct,rt);let lt=N;O&&(lt=(i.calculateTileZoom||xt)(T.zoom+c.ak(T.tileSize/i.tileSize),st,me,ve,T.fov)),lt=(i.roundZoom?Math.round:Math.floor)(lt),lt=Math.max(0,lt);const Nt=Math.min(lt,G);if(ze.wrap=I.getWrap(S,ct,ze.wrap),ze.zoom>=Nt){if(ze.zoom<j)continue;const Vt=K-ze.zoom,At=ee[0]-.5-(Ve<<Vt),ln=ee[1]-.5-(Ie<<Vt),Hn=i.reparseOverscaled?Math.max(ze.zoom,lt):ze.zoom;Ce.push({tileID:new c.Z(ze.zoom===G?Hn:ze.zoom,ze.wrap,ze.zoom,Ve,Ie),distanceSq:c.al([ae[0]-.5-Ve,ae[1]-.5-Ie]),tileDistanceToCamera:Math.sqrt(At*At+ln*ln)})}else for(let Vt=0;Vt<4;Vt++)Pe.push({zoom:ze.zoom+1,x:(Ve<<1)+Vt%2,y:(Ie<<1)+(Vt>>1),wrap:ze.wrap,fullyVisible:Ye})}return Ce.sort(((ze,Ve)=>ze.distanceSq-Ve.distanceSq)).map((ze=>ze.tileID))}const vn=c.a2.fromPoints([new c.P(0,0),new c.P(c.$,c.$)]);class Rn extends c.E{constructor(i,u,_){super(),this.id=i,this.dispatcher=_,this.on("data",(b=>this._dataHandler(b))),this.on("dataloading",(()=>{this._sourceErrored=!1})),this.on("error",(()=>{this._sourceErrored=this._source.loaded()})),this._source=((b,S,I,O)=>{const N=new(oo(S.type))(b,S,I,O);if(N.id!==b)throw new Error(`Expected Source id to be ${b} instead of ${N.id}`);return N})(i,u,_,this),this._tiles={},this._cache=new Xe(0,(b=>this._unloadTile(b))),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new se,this._didEmitContent=!1,this._updated=!1}onAdd(i){this.map=i,this._maxTileCacheSize=i?i._maxTileCacheSize:null,this._maxTileCacheZoomLevels=i?i._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(i)}onRemove(i){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(i)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const i in this._tiles){const u=this._tiles[i];if(u.state!=="loaded"&&u.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const i=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,i&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(i,u,_){return c._(this,void 0,void 0,(function*(){try{yield this._source.loadTile(i),this._tileLoaded(i,u,_)}catch(b){i.state="errored",b.status!==404?this._source.fire(new c.k(b,{tile:i})):this.update(this.transform,this.terrain)}}))}_unloadTile(i){this._source.unloadTile&&this._source.unloadTile(i)}_abortTile(i){this._source.abortTile&&this._source.abortTile(i),this._source.fire(new c.l("dataabort",{tile:i,coord:i.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(i){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const u in this._tiles){const _=this._tiles[u];_.upload(i),_.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map((i=>i.tileID)).sort(nn).map((i=>i.key))}getRenderableIds(i){const u=[];for(const _ in this._tiles)this._isIdRenderable(_,i)&&u.push(this._tiles[_]);return i?u.sort(((_,b)=>{const S=_.tileID,I=b.tileID,O=new c.P(S.canonical.x,S.canonical.y)._rotate(-this.transform.bearingInRadians),N=new c.P(I.canonical.x,I.canonical.y)._rotate(-this.transform.bearingInRadians);return S.overscaledZ-I.overscaledZ||N.y-O.y||N.x-O.x})).map((_=>_.tileID.key)):u.map((_=>_.tileID)).sort(nn).map((_=>_.key))}hasRenderableParent(i){const u=this.findLoadedParent(i,0);return!!u&&this._isIdRenderable(u.tileID.key)}_isIdRenderable(i,u){return this._tiles[i]&&this._tiles[i].hasData()&&!this._coveredTiles[i]&&(u||!this._tiles[i].holdingForFade())}reload(i){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const u in this._tiles)i?this._reloadTile(u,"expired"):this._tiles[u].state!=="errored"&&this._reloadTile(u,"reloading")}}_reloadTile(i,u){return c._(this,void 0,void 0,(function*(){const _=this._tiles[i];_&&(_.state!=="loading"&&(_.state=u),yield this._loadTile(_,i,u))}))}_tileLoaded(i,u,_){i.timeAdded=J.now(),_==="expired"&&(i.refreshedUponExpiration=!0),this._setTileReloadTimer(u,i),this.getSource().type==="raster-dem"&&i.dem&&this._backfillDEM(i),this._state.initializeTileState(i,this.map?this.map.painter:null),i.aborted||this._source.fire(new c.l("data",{dataType:"source",tile:i,coord:i.tileID}))}_backfillDEM(i){const u=this.getRenderableIds();for(let b=0;b<u.length;b++){const S=u[b];if(i.neighboringTiles&&i.neighboringTiles[S]){const I=this.getTileByID(S);_(i,I),_(I,i)}}function _(b,S){b.needsHillshadePrepare=!0,b.needsTerrainPrepare=!0;let I=S.tileID.canonical.x-b.tileID.canonical.x;const O=S.tileID.canonical.y-b.tileID.canonical.y,N=Math.pow(2,b.tileID.canonical.z),j=S.tileID.key;I===0&&O===0||Math.abs(O)>1||(Math.abs(I)>1&&(Math.abs(I+N)===1?I+=N:Math.abs(I-N)===1&&(I-=N)),S.dem&&b.dem&&(b.dem.backfillBorder(S.dem,I,O),b.neighboringTiles&&b.neighboringTiles[j]&&(b.neighboringTiles[j].backfilled=!0)))}}getTile(i){return this.getTileByID(i.key)}getTileByID(i){return this._tiles[i]}_retainLoadedChildren(i,u,_,b){for(const S in this._tiles){let I=this._tiles[S];if(b[S]||!I.hasData()||I.tileID.overscaledZ<=u||I.tileID.overscaledZ>_)continue;let O=I.tileID;for(;I&&I.tileID.overscaledZ>u+1;){const j=I.tileID.scaledTo(I.tileID.overscaledZ-1);I=this._tiles[j.key],I&&I.hasData()&&(O=j)}let N=O;for(;N.overscaledZ>u;)if(N=N.scaledTo(N.overscaledZ-1),i[N.key]||i[N.canonical.key]){b[O.key]=O;break}}}findLoadedParent(i,u){if(i.key in this._loadedParentTiles){const _=this._loadedParentTiles[i.key];return _&&_.tileID.overscaledZ>=u?_:null}for(let _=i.overscaledZ-1;_>=u;_--){const b=i.scaledTo(_),S=this._getLoadedTile(b);if(S)return S}}findLoadedSibling(i){return this._getLoadedTile(i)}_getLoadedTile(i){const u=this._tiles[i.key];return u&&u.hasData()?u:this._cache.getByKey(i.wrapped().key)}updateCacheSize(i){const u=Math.ceil(i.width/this._source.tileSize)+1,_=Math.ceil(i.height/this._source.tileSize)+1,b=Math.floor(u*_*(this._maxTileCacheZoomLevels===null?c.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),S=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,b):b;this._cache.setMaxSize(S)}handleWrapJump(i){const u=Math.round((i-(this._prevLng===void 0?i:this._prevLng))/360);if(this._prevLng=i,u){const _={};for(const b in this._tiles){const S=this._tiles[b];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+u),_[S.tileID.key]=S}this._tiles=_;for(const b in this._timers)clearTimeout(this._timers[b]),delete this._timers[b];for(const b in this._tiles)this._setTileReloadTimer(b,this._tiles[b])}}_updateCoveredAndRetainedTiles(i,u,_,b,S,I){const O={},N={},j=Object.keys(i),G=J.now();for(const K of j){const Z=i[K],ee=this._tiles[K];if(!ee||ee.fadeEndTime!==0&&ee.fadeEndTime<=G)continue;const ae=this.findLoadedParent(Z,u),ge=this.findLoadedSibling(Z),me=ae||ge||null;me&&(this._addTile(me.tileID),O[me.tileID.key]=me.tileID),N[K]=Z}this._retainLoadedChildren(N,b,_,i);for(const K in O)i[K]||(this._coveredTiles[K]=!0,i[K]=O[K]);if(I){const K={},Z={};for(const ee of S)this._tiles[ee.key].hasData()?K[ee.key]=ee:Z[ee.key]=ee;for(const ee in Z){const ae=Z[ee].children(this._source.maxzoom);this._tiles[ae[0].key]&&this._tiles[ae[1].key]&&this._tiles[ae[2].key]&&this._tiles[ae[3].key]&&(K[ae[0].key]=i[ae[0].key]=ae[0],K[ae[1].key]=i[ae[1].key]=ae[1],K[ae[2].key]=i[ae[2].key]=ae[2],K[ae[3].key]=i[ae[3].key]=ae[3],delete Z[ee])}for(const ee in Z){const ae=Z[ee],ge=this.findLoadedParent(ae,this._source.minzoom),me=this.findLoadedSibling(ae),ve=ge||me||null;if(ve){K[ve.tileID.key]=i[ve.tileID.key]=ve.tileID;for(const we in K)K[we].isChildOf(ve.tileID)&&delete K[we]}}for(const ee in this._tiles)K[ee]||(this._coveredTiles[ee]=!0)}}update(i,u){if(!this._sourceLoaded||this._paused)return;let _;this.transform=i,this.terrain=u,this.updateCacheSize(i),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?_=i.getVisibleUnwrappedCoordinates(this._source.tileID).map((G=>new c.Z(G.canonical.z,G.wrap,G.canonical.z,G.canonical.x,G.canonical.y))):(_=$e(i,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:u,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(_=_.filter((G=>this._source.hasTile(G))))):_=[];const b=tn(i,this._source),S=Math.max(b-Rn.maxOverzooming,this._source.minzoom),I=Math.max(b+Rn.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const G={};for(const K of _)if(K.canonical.z>this._source.minzoom){const Z=K.scaledTo(K.canonical.z-1);G[Z.key]=Z;const ee=K.scaledTo(Math.max(this._source.minzoom,Math.min(K.canonical.z,5)));G[ee.key]=ee}_=_.concat(Object.values(G))}const O=_.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,O&&this.fire(new c.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const N=this._updateRetainedTiles(_,b);Nn(this._source.type)&&this._updateCoveredAndRetainedTiles(N,S,I,b,_,u);for(const G in N)this._tiles[G].clearFadeHold();const j=c.am(this._tiles,N);for(const G of j){const K=this._tiles[G];K.hasSymbolBuckets&&!K.holdingForFade()?K.setHoldDuration(this.map._fadeDuration):K.hasSymbolBuckets&&!K.symbolFadeFinished()||this._removeTile(G)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const i in this._tiles)this._tiles[i].holdingForFade()&&this._removeTile(i)}_updateRetainedTiles(i,u){var _;const b={},S={},I=Math.max(u-Rn.maxOverzooming,this._source.minzoom),O=Math.max(u+Rn.maxUnderzooming,this._source.minzoom),N={};for(const j of i){const G=this._addTile(j);b[j.key]=j,G.hasData()||u<this._source.maxzoom&&(N[j.key]=j)}this._retainLoadedChildren(N,u,O,b);for(const j of i){let G=this._tiles[j.key];if(G.hasData())continue;if(u+1>this._source.maxzoom){const Z=j.children(this._source.maxzoom)[0],ee=this.getTile(Z);if(ee&&ee.hasData()){b[Z.key]=Z;continue}}else{const Z=j.children(this._source.maxzoom);if(b[Z[0].key]&&b[Z[1].key]&&b[Z[2].key]&&b[Z[3].key])continue}let K=G.wasRequested();for(let Z=j.overscaledZ-1;Z>=I;--Z){const ee=j.scaledTo(Z);if(S[ee.key])break;if(S[ee.key]=!0,G=this.getTile(ee),!G&&K&&(G=this._addTile(ee)),G){const ae=G.hasData();if((ae||!(!((_=this.map)===null||_===void 0)&&_.cancelPendingTileRequestsWhileZooming)||K)&&(b[ee.key]=ee),K=G.wasRequested(),ae)break}}}return b}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const i in this._tiles){const u=[];let _,b=this._tiles[i].tileID;for(;b.overscaledZ>0;){if(b.key in this._loadedParentTiles){_=this._loadedParentTiles[b.key];break}u.push(b.key);const S=b.scaledTo(b.overscaledZ-1);if(_=this._getLoadedTile(S),_)break;b=S}for(const S of u)this._loadedParentTiles[S]=_}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const i in this._tiles){const u=this._tiles[i].tileID,_=this._getLoadedTile(u);this._loadedSiblingTiles[u.key]=_}}_addTile(i){let u=this._tiles[i.key];if(u)return u;u=this._cache.getAndRemove(i),u&&(this._setTileReloadTimer(i.key,u),u.tileID=i,this._state.initializeTileState(u,this.map?this.map.painter:null),this._cacheTimers[i.key]&&(clearTimeout(this._cacheTimers[i.key]),delete this._cacheTimers[i.key],this._setTileReloadTimer(i.key,u)));const _=u;return u||(u=new gs(i,this._source.tileSize*i.overscaleFactor()),this._loadTile(u,i.key,u.state)),u.uses++,this._tiles[i.key]=u,_||this._source.fire(new c.l("dataloading",{tile:u,coord:u.tileID,dataType:"source"})),u}_setTileReloadTimer(i,u){i in this._timers&&(clearTimeout(this._timers[i]),delete this._timers[i]);const _=u.getExpiryTimeout();_&&(this._timers[i]=setTimeout((()=>{this._reloadTile(i,"expired"),delete this._timers[i]}),_))}refreshTiles(i){for(const u in this._tiles)(this._isIdRenderable(u)||this._tiles[u].state=="errored")&&i.some((_=>_.equals(this._tiles[u].tileID.canonical)))&&this._reloadTile(u,"expired")}_removeTile(i){const u=this._tiles[i];u&&(u.uses--,delete this._tiles[i],this._timers[i]&&(clearTimeout(this._timers[i]),delete this._timers[i]),u.uses>0||(u.hasData()&&u.state!=="reloading"?this._cache.add(u.tileID,u,u.getExpiryTimeout()):(u.aborted=!0,this._abortTile(u),this._unloadTile(u))))}_dataHandler(i){const u=i.sourceDataType;i.dataType==="source"&&u==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&i.dataType==="source"&&u==="content"&&(this.reload(i.sourceDataChanged),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const i in this._tiles)this._removeTile(i);this._cache.reset()}tilesIn(i,u,_){const b=[],S=this.transform;if(!S)return b;const I=S.getCoveringTilesDetailsProvider().allowWorldCopies(),O=_?S.getCameraQueryGeometry(i):i,N=ee=>S.screenPointToMercatorCoordinate(ee,this.terrain),j=this.transformBbox(i,N,!I),G=this.transformBbox(O,N,!I),K=this.getIds(),Z=c.a2.fromPoints(G);for(let ee=0;ee<K.length;ee++){const ae=this._tiles[K[ee]];if(ae.holdingForFade())continue;const ge=I?[ae.tileID]:[ae.tileID.unwrapTo(-1),ae.tileID.unwrapTo(0)],me=Math.pow(2,S.zoom-ae.tileID.overscaledZ),ve=u*ae.queryPadding*c.$/ae.tileSize/me;for(const we of ge){const Pe=Z.map((Ce=>we.getTilePoint(new c.a1(Ce.x,Ce.y))));if(Pe.expandBy(ve),Pe.intersects(vn)){const Ce=j.map((Ve=>we.getTilePoint(Ve))),ze=G.map((Ve=>we.getTilePoint(Ve)));b.push({tile:ae,tileID:I?we:we.unwrapTo(0),queryGeometry:Ce,cameraQueryGeometry:ze,scale:me})}}}return b}transformBbox(i,u,_){let b=i.map(u);if(_){const S=c.a2.fromPoints(i);S.shrinkBy(.001*Math.min(S.width(),S.height()));const I=S.map(u);c.a2.fromPoints(b).covers(I)||(b=b.map((O=>O.x>.5?new c.a1(O.x-1,O.y,O.z):O)))}return b}getVisibleCoordinates(i){const u=this.getRenderableIds(i).map((_=>this._tiles[_].tileID));return this.transform&&this.transform.populateCache(u),u}hasTransition(){if(this._source.hasTransition())return!0;if(Nn(this._source.type)){const i=J.now();for(const u in this._tiles)if(this._tiles[u].fadeEndTime>=i)return!0}return!1}setFeatureState(i,u,_){this._state.updateState(i=i||"_geojsonTileLayer",u,_)}removeFeatureState(i,u,_){this._state.removeFeatureState(i=i||"_geojsonTileLayer",u,_)}getFeatureState(i,u){return this._state.getState(i=i||"_geojsonTileLayer",u)}setDependencies(i,u,_){const b=this._tiles[i];b&&b.setDependencies(u,_)}reloadTilesForDependencies(i,u){for(const _ in this._tiles)this._tiles[_].hasDependency(i,u)&&this._reloadTile(_,"reloading");this._cache.filter((_=>!_.hasDependency(i,u)))}}function nn(T,i){const u=Math.abs(2*T.wrap)-+(T.wrap<0),_=Math.abs(2*i.wrap)-+(i.wrap<0);return T.overscaledZ-i.overscaledZ||_-u||i.canonical.y-T.canonical.y||i.canonical.x-T.canonical.x}function Nn(T){return T==="raster"||T==="image"||T==="video"}Rn.maxOverzooming=10,Rn.maxUnderzooming=3;class Ri{constructor(i,u){this.reset(i,u)}reset(i,u){this.points=i||[],this._distances=[0];for(let _=1;_<this.points.length;_++)this._distances[_]=this._distances[_-1]+this.points[_].dist(this.points[_-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(u||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(i){if(this.points.length===1)return this.points[0];i=c.ah(i,0,1);let u=1,_=this._distances[u];const b=i*this.paddedLength+this.padding;for(;_<b&&u<this._distances.length;)_=this._distances[++u];const S=u-1,I=this._distances[S],O=_-I,N=O>0?(b-I)/O:0;return this.points[S].mult(1-N).add(this.points[u].mult(N))}}function Gi(T,i){let u=!0;return T==="always"||T!=="never"&&i!=="never"||(u=!1),u}class tr{constructor(i,u,_){const b=this.boxCells=[],S=this.circleCells=[];this.xCellCount=Math.ceil(i/_),this.yCellCount=Math.ceil(u/_);for(let I=0;I<this.xCellCount*this.yCellCount;I++)b.push([]),S.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=i,this.height=u,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/u,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(i,u,_,b,S){this._forEachCell(u,_,b,S,this._insertBoxCell,this.boxUid++),this.boxKeys.push(i),this.bboxes.push(u),this.bboxes.push(_),this.bboxes.push(b),this.bboxes.push(S)}insertCircle(i,u,_,b){this._forEachCell(u-b,_-b,u+b,_+b,this._insertCircleCell,this.circleUid++),this.circleKeys.push(i),this.circles.push(u),this.circles.push(_),this.circles.push(b)}_insertBoxCell(i,u,_,b,S,I){this.boxCells[S].push(I)}_insertCircleCell(i,u,_,b,S,I){this.circleCells[S].push(I)}_query(i,u,_,b,S,I,O){if(_<0||i>this.width||b<0||u>this.height)return[];const N=[];if(i<=0&&u<=0&&this.width<=_&&this.height<=b){if(S)return[{key:null,x1:i,y1:u,x2:_,y2:b}];for(let j=0;j<this.boxKeys.length;j++)N.push({key:this.boxKeys[j],x1:this.bboxes[4*j],y1:this.bboxes[4*j+1],x2:this.bboxes[4*j+2],y2:this.bboxes[4*j+3]});for(let j=0;j<this.circleKeys.length;j++){const G=this.circles[3*j],K=this.circles[3*j+1],Z=this.circles[3*j+2];N.push({key:this.circleKeys[j],x1:G-Z,y1:K-Z,x2:G+Z,y2:K+Z})}}else this._forEachCell(i,u,_,b,this._queryCell,N,{hitTest:S,overlapMode:I,seenUids:{box:{},circle:{}}},O);return N}query(i,u,_,b){return this._query(i,u,_,b,!1,null)}hitTest(i,u,_,b,S,I){return this._query(i,u,_,b,!0,S,I).length>0}hitTestCircle(i,u,_,b,S){const I=i-_,O=i+_,N=u-_,j=u+_;if(O<0||I>this.width||j<0||N>this.height)return!1;const G=[];return this._forEachCell(I,N,O,j,this._queryCellCircle,G,{hitTest:!0,overlapMode:b,circle:{x:i,y:u,radius:_},seenUids:{box:{},circle:{}}},S),G.length>0}_queryCell(i,u,_,b,S,I,O,N){const{seenUids:j,hitTest:G,overlapMode:K}=O,Z=this.boxCells[S];if(Z!==null){const ae=this.bboxes;for(const ge of Z)if(!j.box[ge]){j.box[ge]=!0;const me=4*ge,ve=this.boxKeys[ge];if(i<=ae[me+2]&&u<=ae[me+3]&&_>=ae[me+0]&&b>=ae[me+1]&&(!N||N(ve))&&(!G||!Gi(K,ve.overlapMode))&&(I.push({key:ve,x1:ae[me],y1:ae[me+1],x2:ae[me+2],y2:ae[me+3]}),G))return!0}}const ee=this.circleCells[S];if(ee!==null){const ae=this.circles;for(const ge of ee)if(!j.circle[ge]){j.circle[ge]=!0;const me=3*ge,ve=this.circleKeys[ge];if(this._circleAndRectCollide(ae[me],ae[me+1],ae[me+2],i,u,_,b)&&(!N||N(ve))&&(!G||!Gi(K,ve.overlapMode))){const we=ae[me],Pe=ae[me+1],Ce=ae[me+2];if(I.push({key:ve,x1:we-Ce,y1:Pe-Ce,x2:we+Ce,y2:Pe+Ce}),G)return!0}}}return!1}_queryCellCircle(i,u,_,b,S,I,O,N){const{circle:j,seenUids:G,overlapMode:K}=O,Z=this.boxCells[S];if(Z!==null){const ae=this.bboxes;for(const ge of Z)if(!G.box[ge]){G.box[ge]=!0;const me=4*ge,ve=this.boxKeys[ge];if(this._circleAndRectCollide(j.x,j.y,j.radius,ae[me+0],ae[me+1],ae[me+2],ae[me+3])&&(!N||N(ve))&&!Gi(K,ve.overlapMode))return I.push(!0),!0}}const ee=this.circleCells[S];if(ee!==null){const ae=this.circles;for(const ge of ee)if(!G.circle[ge]){G.circle[ge]=!0;const me=3*ge,ve=this.circleKeys[ge];if(this._circlesCollide(ae[me],ae[me+1],ae[me+2],j.x,j.y,j.radius)&&(!N||N(ve))&&!Gi(K,ve.overlapMode))return I.push(!0),!0}}}_forEachCell(i,u,_,b,S,I,O,N){const j=this._convertToXCellCoord(i),G=this._convertToYCellCoord(u),K=this._convertToXCellCoord(_),Z=this._convertToYCellCoord(b);for(let ee=j;ee<=K;ee++)for(let ae=G;ae<=Z;ae++)if(S.call(this,i,u,_,b,this.xCellCount*ae+ee,I,O,N))return}_convertToXCellCoord(i){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(i*this.xScale)))}_convertToYCellCoord(i){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(i*this.yScale)))}_circlesCollide(i,u,_,b,S,I){const O=b-i,N=S-u,j=_+I;return j*j>O*O+N*N}_circleAndRectCollide(i,u,_,b,S,I,O){const N=(I-b)/2,j=Math.abs(i-(b+N));if(j>N+_)return!1;const G=(O-S)/2,K=Math.abs(u-(S+G));if(K>G+_)return!1;if(j<=N||K<=G)return!0;const Z=j-N,ee=K-G;return Z*Z+ee*ee<=_*_}}function Ir(T,i,u){const _=c.L();if(!T){const{vecSouth:K,vecEast:Z}=Xn(i),ee=R();ee[0]=Z[0],ee[1]=Z[1],ee[2]=K[0],ee[3]=K[1],b=ee,(G=(I=(S=ee)[0])*(j=S[3])-(N=S[2])*(O=S[1]))&&(b[0]=j*(G=1/G),b[1]=-O*G,b[2]=-N*G,b[3]=I*G),_[0]=ee[0],_[1]=ee[1],_[4]=ee[2],_[5]=ee[3]}var b,S,I,O,N,j,G;return c.N(_,_,[1/u,1/u,1]),_}function Vn(T,i,u,_){if(T){const b=c.L();if(!i){const{vecSouth:S,vecEast:I}=Xn(u);b[0]=I[0],b[1]=I[1],b[4]=S[0],b[5]=S[1]}return c.N(b,b,[_,_,1]),b}return u.pixelsToClipSpaceMatrix}function Xn(T){const i=Math.cos(T.rollInRadians),u=Math.sin(T.rollInRadians),_=Math.cos(T.pitchInRadians),b=Math.cos(T.bearingInRadians),S=Math.sin(T.bearingInRadians),I=c.ar();I[0]=-b*_*u-S*i,I[1]=-S*_*u+b*i;const O=c.as(I);O<1e-9?c.at(I):c.au(I,I,1/O);const N=c.ar();N[0]=b*_*i-S*u,N[1]=S*_*i+b*u;const j=c.as(N);return j<1e-9?c.at(N):c.au(N,N,1/j),{vecEast:N,vecSouth:I}}function br(T,i,u,_){let b;_?(b=[T,i,_(T,i),1],c.aw(b,b,u)):(b=[T,i,0,1],Hr(b,b,u));const S=b[3];return{point:new c.P(b[0]/S,b[1]/S),signedDistanceFromCamera:S,isOccluded:!1}}function Mt(T,i){return .5+T/i*.5}function en(T,i){return T.x>=-i[0]&&T.x<=i[0]&&T.y>=-i[1]&&T.y<=i[1]}function nr(T,i,u,_,b,S,I,O,N,j,G,K,Z){const ee=u?T.textSizeData:T.iconSizeData,ae=c.an(ee,i.transform.zoom),ge=[256/i.width*2+1,256/i.height*2+1],me=u?T.text.dynamicLayoutVertexArray:T.icon.dynamicLayoutVertexArray;me.clear();const ve=T.lineVertexArray,we=u?T.text.placedSymbolArray:T.icon.placedSymbolArray,Pe=i.transform.width/i.transform.height;let Ce=!1;for(let ze=0;ze<we.length;ze++){const Ve=we.get(ze);if(Ve.hidden||Ve.writingMode===c.ao.vertical&&!Ce){Gr(Ve.numGlyphs,me);continue}Ce=!1;const Ie=new c.P(Ve.anchorX,Ve.anchorY),Ye={getElevation:Z,pitchedLabelPlaneMatrix:_,lineVertexArray:ve,pitchWithMap:S,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:i.transform,tileAnchorPoint:Ie,unwrappedTileID:N,width:j,height:G,translation:K},ct=Ao(Ve.anchorX,Ve.anchorY,Ye);if(!en(ct.point,ge)){Gr(Ve.numGlyphs,me);continue}const rt=Mt(i.transform.cameraToCenterDistance,ct.signedDistanceFromCamera),st=c.ap(ee,ae,Ve),lt=S?st*i.transform.getPitchedTextCorrection(Ve.anchorX,Ve.anchorY,N)/rt:st*rt,Nt=kt({projectionContext:Ye,pitchedLabelPlaneMatrixInverse:b,symbol:Ve,fontSize:lt,flip:!1,keepUpright:I,glyphOffsetArray:T.glyphOffsetArray,dynamicLayoutVertexArray:me,aspectRatio:Pe,rotateToLine:O});Ce=Nt.useVertical,(Nt.notEnoughRoom||Ce||Nt.needsFlipping&&kt({projectionContext:Ye,pitchedLabelPlaneMatrixInverse:b,symbol:Ve,fontSize:lt,flip:!0,keepUpright:I,glyphOffsetArray:T.glyphOffsetArray,dynamicLayoutVertexArray:me,aspectRatio:Pe,rotateToLine:O}).notEnoughRoom)&&Gr(Ve.numGlyphs,me)}u?T.text.dynamicLayoutVertexBuffer.updateData(me):T.icon.dynamicLayoutVertexBuffer.updateData(me)}function na(T,i,u,_,b,S,I,O){const N=S.glyphStartIndex+S.numGlyphs,j=S.lineStartIndex,G=S.lineStartIndex+S.lineLength,K=i.getoffsetX(S.glyphStartIndex),Z=i.getoffsetX(N-1),ee=js(T*K,u,_,b,S.segment,j,G,O,I);if(!ee)return null;const ae=js(T*Z,u,_,b,S.segment,j,G,O,I);return ae?O.projectionCache.anyProjectionOccluded?null:{first:ee,last:ae}:null}function Ca(T,i,u,_){return T===c.ao.horizontal&&Math.abs(u.y-i.y)>Math.abs(u.x-i.x)*_?{useVertical:!0}:(T===c.ao.vertical?i.y<u.y:i.x>u.x)?{needsFlipping:!0}:null}function kt(T){const{projectionContext:i,pitchedLabelPlaneMatrixInverse:u,symbol:_,fontSize:b,flip:S,keepUpright:I,glyphOffsetArray:O,dynamicLayoutVertexArray:N,aspectRatio:j,rotateToLine:G}=T,K=b/24,Z=_.lineOffsetX*K,ee=_.lineOffsetY*K;let ae;if(_.numGlyphs>1){const ge=_.glyphStartIndex+_.numGlyphs,me=_.lineStartIndex,ve=_.lineStartIndex+_.lineLength,we=na(K,O,Z,ee,S,_,G,i);if(!we)return{notEnoughRoom:!0};const Pe=rl(we.first.point.x,we.first.point.y,i,u),Ce=rl(we.last.point.x,we.last.point.y,i,u);if(I&&!S){const ze=Ca(_.writingMode,Pe,Ce,j);if(ze)return ze}ae=[we.first];for(let ze=_.glyphStartIndex+1;ze<ge-1;ze++){const Ve=js(K*O.getoffsetX(ze),Z,ee,S,_.segment,me,ve,i,G);if(!Ve)return{notEnoughRoom:!0};ae.push(Ve)}ae.push(we.last)}else{if(I&&!S){const me=ir(i.tileAnchorPoint.x,i.tileAnchorPoint.y,i).point,ve=_.lineStartIndex+_.segment+1,we=new c.P(i.lineVertexArray.getx(ve),i.lineVertexArray.gety(ve)),Pe=ir(we.x,we.y,i),Ce=Pe.signedDistanceFromCamera>0?Pe.point:yn(i.tileAnchorPoint,we,me,1,i),ze=rl(me.x,me.y,i,u),Ve=rl(Ce.x,Ce.y,i,u),Ie=Ca(_.writingMode,ze,Ve,j);if(Ie)return Ie}const ge=js(K*O.getoffsetX(_.glyphStartIndex),Z,ee,S,_.segment,_.lineStartIndex,_.lineStartIndex+_.lineLength,i,G);if(!ge||i.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};ae=[ge]}for(const ge of ae)c.av(N,ge.point,ge.angle);return{}}function yn(T,i,u,_,b){const S=T.add(T.sub(i)._unit()),I=ir(S.x,S.y,b).point,O=u.sub(I);return u.add(O._mult(_/O.mag()))}function In(T,i,u){const _=i.projectionCache;if(_.projections[T])return _.projections[T];const b=new c.P(i.lineVertexArray.getx(T),i.lineVertexArray.gety(T)),S=ir(b.x,b.y,i);if(S.signedDistanceFromCamera>0)return _.projections[T]=S.point,_.anyProjectionOccluded=_.anyProjectionOccluded||S.isOccluded,S.point;const I=T-u.direction;return yn(u.distanceFromAnchor===0?i.tileAnchorPoint:new c.P(i.lineVertexArray.getx(I),i.lineVertexArray.gety(I)),b,u.previousVertex,u.absOffsetX-u.distanceFromAnchor+1,i)}function ir(T,i,u){const _=T+u.translation[0],b=i+u.translation[1];let S;return u.pitchWithMap?(S=br(_,b,u.pitchedLabelPlaneMatrix,u.getElevation),S.isOccluded=!1):(S=u.transform.projectTileCoordinates(_,b,u.unwrappedTileID,u.getElevation),S.point.x=(.5*S.point.x+.5)*u.width,S.point.y=(.5*-S.point.y+.5)*u.height),S}function rl(T,i,u,_){if(u.pitchWithMap){const b=[T,i,0,1];return c.aw(b,b,_),u.transform.projectTileCoordinates(b[0]/b[3],b[1]/b[3],u.unwrappedTileID,u.getElevation).point}return{x:T/u.width*2-1,y:1-i/u.height*2}}function Ao(T,i,u){return u.transform.projectTileCoordinates(T,i,u.unwrappedTileID,u.getElevation)}function Bn(T,i,u){return T._unit()._perp()._mult(i*u)}function Us(T,i,u,_,b,S,I,O,N){if(O.projectionCache.offsets[T])return O.projectionCache.offsets[T];const j=u.add(i);if(T+N.direction<_||T+N.direction>=b)return O.projectionCache.offsets[T]=j,j;const G=In(T+N.direction,O,N),K=Bn(G.sub(u),I,N.direction),Z=u.add(K),ee=G.add(K);return O.projectionCache.offsets[T]=c.ax(S,j,Z,ee)||j,O.projectionCache.offsets[T]}function js(T,i,u,_,b,S,I,O,N){const j=_?T-i:T+i;let G=j>0?1:-1,K=0;_&&(G*=-1,K=Math.PI),G<0&&(K+=Math.PI);let Z,ee=G>0?S+b:S+b+1;O.projectionCache.cachedAnchorPoint?Z=O.projectionCache.cachedAnchorPoint:(Z=ir(O.tileAnchorPoint.x,O.tileAnchorPoint.y,O).point,O.projectionCache.cachedAnchorPoint=Z);let ae,ge,me=Z,ve=Z,we=0,Pe=0;const Ce=Math.abs(j),ze=[];let Ve;for(;we+Pe<=Ce;){if(ee+=G,ee<S||ee>=I)return null;we+=Pe,ve=me,ge=ae;const ct={absOffsetX:Ce,direction:G,distanceFromAnchor:we,previousVertex:ve};if(me=In(ee,O,ct),u===0)ze.push(ve),Ve=me.sub(ve);else{let rt;const st=me.sub(ve);rt=st.mag()===0?Bn(In(ee+G,O,ct).sub(me),u,G):Bn(st,u,G),ge||(ge=ve.add(rt)),ae=Us(ee,rt,me,S,I,ge,u,O,ct),ze.push(ge),Ve=ae.sub(ge)}Pe=Ve.mag()}const Ie=Ve._mult((Ce-we)/Pe)._add(ge||ve),Ye=K+Math.atan2(me.y-ve.y,me.x-ve.x);return ze.push(Ie),{point:Ie,angle:N?Ye:0,path:ze}}const _s=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Gr(T,i){for(let u=0;u<T;u++){const _=i.length;i.resize(_+4),i.float32.set(_s,3*_)}}function Hr(T,i,u){const _=i[0],b=i[1];return T[0]=u[0]*_+u[4]*b+u[12],T[1]=u[1]*_+u[5]*b+u[13],T[3]=u[3]*_+u[7]*b+u[15],T}const Ei=100;class Pr{constructor(i,u=new tr(i.width+200,i.height+200,25),_=new tr(i.width+200,i.height+200,25)){this.transform=i,this.grid=u,this.ignoredGrid=_,this.pitchFactor=Math.cos(i.pitch*Math.PI/180)*i.cameraToCenterDistance,this.screenRightBoundary=i.width+Ei,this.screenBottomBoundary=i.height+Ei,this.gridRightBoundary=i.width+200,this.gridBottomBoundary=i.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(i,u,_,b,S,I,O,N,j,G,K,Z){const ee=this.projectAndGetPerspectiveRatio(i.anchorPointX+N[0],i.anchorPointY+N[1],S,G,Z),ae=_*ee.perspectiveRatio;let ge;if(I||O)ge=this._projectCollisionBox(i,ae,b,S,I,O,N,ee,G,K,Z);else{const Ve=ee.x+(K?K.x*ae:0),Ie=ee.y+(K?K.y*ae:0);ge={allPointsOccluded:!1,box:[Ve+i.x1*ae,Ie+i.y1*ae,Ve+i.x2*ae,Ie+i.y2*ae]}}const[me,ve,we,Pe]=ge.box,Ce=I?ge.allPointsOccluded:ee.isOccluded;let ze=Ce;return ze||(ze=ee.perspectiveRatio<this.perspectiveRatioCutoff),ze||(ze=!this.isInsideGrid(me,ve,we,Pe)),ze||u!=="always"&&this.grid.hitTest(me,ve,we,Pe,u,j)?{box:[me,ve,we,Pe],placeable:!1,offscreen:!1,occluded:Ce}:{box:[me,ve,we,Pe],placeable:!0,offscreen:this.isOffscreen(me,ve,we,Pe),occluded:Ce}}placeCollisionCircles(i,u,_,b,S,I,O,N,j,G,K,Z,ee,ae){const ge=[],me=new c.P(u.anchorX,u.anchorY),ve=this.getPerspectiveRatio(me.x,me.y,I,ae),we=(j?S*this.transform.getPitchedTextCorrection(u.anchorX,u.anchorY,I)/ve:S*ve)/c.aB,Pe={getElevation:ae,pitchedLabelPlaneMatrix:O,lineVertexArray:_,pitchWithMap:j,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:me,unwrappedTileID:I,width:this.transform.width,height:this.transform.height,translation:ee},Ce=na(we,b,u.lineOffsetX*we,u.lineOffsetY*we,!1,u,!1,Pe);let ze=!1,Ve=!1,Ie=!0;if(Ce){const Ye=.5*K*ve+Z,ct=new c.P(-100,-100),rt=new c.P(this.screenRightBoundary,this.screenBottomBoundary),st=new Ri,lt=Ce.first,Nt=Ce.last;let Vt=[];for(let Hn=lt.path.length-1;Hn>=1;Hn--)Vt.push(lt.path[Hn]);for(let Hn=1;Hn<Nt.path.length;Hn++)Vt.push(Nt.path[Hn]);const At=2.5*Ye;if(j){const Hn=this.projectPathToScreenSpace(Vt,Pe);Vt=Hn.some((bi=>bi.signedDistanceFromCamera<=0))?[]:Hn.map((bi=>bi.point))}let ln=[];if(Vt.length>0){const Hn=Vt[0].clone(),bi=Vt[0].clone();for(let Yi=1;Yi<Vt.length;Yi++)Hn.x=Math.min(Hn.x,Vt[Yi].x),Hn.y=Math.min(Hn.y,Vt[Yi].y),bi.x=Math.max(bi.x,Vt[Yi].x),bi.y=Math.max(bi.y,Vt[Yi].y);ln=Hn.x>=ct.x&&bi.x<=rt.x&&Hn.y>=ct.y&&bi.y<=rt.y?[Vt]:bi.x<ct.x||Hn.x>rt.x||bi.y<ct.y||Hn.y>rt.y?[]:c.ay([Vt],ct.x,ct.y,rt.x,rt.y)}for(const Hn of ln){st.reset(Hn,.25*Ye);let bi=0;bi=st.length<=.5*Ye?1:Math.ceil(st.paddedLength/At)+1;for(let Yi=0;Yi<bi;Yi++){const $i=Yi/Math.max(bi-1,1),Mr=st.lerp($i),Fr=Mr.x+Ei,jn=Mr.y+Ei;ge.push(Fr,jn,Ye,0);const ur=Fr-Ye,oa=jn-Ye,Vr=Fr+Ye,La=jn+Ye;if(Ie=Ie&&this.isOffscreen(ur,oa,Vr,La),Ve=Ve||this.isInsideGrid(ur,oa,Vr,La),i!=="always"&&this.grid.hitTestCircle(Fr,jn,Ye,i,G)&&(ze=!0,!N))return{circles:[],offscreen:!1,collisionDetected:ze}}}}return{circles:!N&&ze||!Ve||ve<this.perspectiveRatioCutoff?[]:ge,offscreen:Ie,collisionDetected:ze}}projectPathToScreenSpace(i,u){const _=(function(b,S){const I=c.L();return c.aq(I,S.pitchedLabelPlaneMatrix),b.map((O=>{const N=br(O.x,O.y,I,S.getElevation),j=S.transform.projectTileCoordinates(N.point.x,N.point.y,S.unwrappedTileID,S.getElevation);return j.point.x=(.5*j.point.x+.5)*S.width,j.point.y=(.5*-j.point.y+.5)*S.height,j}))})(i,u);return(function(b){let S=0,I=0,O=0,N=0;for(let j=0;j<b.length;j++)b[j].isOccluded?(O=j+1,N=0):(N++,N>I&&(I=N,S=O));return b.slice(S,S+I)})(_)}queryRenderedSymbols(i){if(i.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const u=[],_=new c.a2;for(const K of i){const Z=new c.P(K.x+Ei,K.y+Ei);_.extend(Z),u.push(Z)}const{minX:b,minY:S,maxX:I,maxY:O}=_,N=this.grid.query(b,S,I,O).concat(this.ignoredGrid.query(b,S,I,O)),j={},G={};for(const K of N){const Z=K.key;if(j[Z.bucketInstanceId]===void 0&&(j[Z.bucketInstanceId]={}),j[Z.bucketInstanceId][Z.featureIndex])continue;const ee=[new c.P(K.x1,K.y1),new c.P(K.x2,K.y1),new c.P(K.x2,K.y2),new c.P(K.x1,K.y2)];c.az(u,ee)&&(j[Z.bucketInstanceId][Z.featureIndex]=!0,G[Z.bucketInstanceId]===void 0&&(G[Z.bucketInstanceId]=[]),G[Z.bucketInstanceId].push(Z.featureIndex))}return G}insertCollisionBox(i,u,_,b,S,I){(_?this.ignoredGrid:this.grid).insert({bucketInstanceId:b,featureIndex:S,collisionGroupID:I,overlapMode:u},i[0],i[1],i[2],i[3])}insertCollisionCircles(i,u,_,b,S,I){const O=_?this.ignoredGrid:this.grid,N={bucketInstanceId:b,featureIndex:S,collisionGroupID:I,overlapMode:u};for(let j=0;j<i.length;j+=4)O.insertCircle(N,i[j],i[j+1],i[j+2])}projectAndGetPerspectiveRatio(i,u,_,b,S){if(S){let I;b?(I=[i,u,b(i,u),1],c.aw(I,I,S)):(I=[i,u,0,1],Hr(I,I,S));const O=I[3];return{x:(I[0]/O+1)/2*this.transform.width+Ei,y:(-I[1]/O+1)/2*this.transform.height+Ei,perspectiveRatio:.5+this.transform.cameraToCenterDistance/O*.5,isOccluded:!1,signedDistanceFromCamera:O}}{const I=this.transform.projectTileCoordinates(i,u,_,b);return{x:(I.point.x+1)/2*this.transform.width+Ei,y:(1-I.point.y)/2*this.transform.height+Ei,perspectiveRatio:.5+this.transform.cameraToCenterDistance/I.signedDistanceFromCamera*.5,isOccluded:I.isOccluded,signedDistanceFromCamera:I.signedDistanceFromCamera}}}getPerspectiveRatio(i,u,_,b){const S=this.transform.projectTileCoordinates(i,u,_,b);return .5+this.transform.cameraToCenterDistance/S.signedDistanceFromCamera*.5}isOffscreen(i,u,_,b){return _<Ei||i>=this.screenRightBoundary||b<Ei||u>this.screenBottomBoundary}isInsideGrid(i,u,_,b){return _>=0&&i<this.gridRightBoundary&&b>=0&&u<this.gridBottomBoundary}getViewportMatrix(){const i=c.ag([]);return c.M(i,i,[-100,-100,0]),i}_projectCollisionBox(i,u,_,b,S,I,O,N,j,G,K){let Z=1,ee=0,ae=0,ge=1;const me=i.anchorPointX+O[0],ve=i.anchorPointY+O[1];if(I&&!S){const Vt=this.projectAndGetPerspectiveRatio(me+1,ve,b,j,K),At=Vt.x-N.x,ln=Math.atan((Vt.y-N.y)/At)+(At<0?Math.PI:0),Hn=Math.sin(ln),bi=Math.cos(ln);Z=bi,ee=Hn,ae=-Hn,ge=bi}else if(!I&&S){const Vt=Xn(this.transform);Z=Vt.vecEast[0],ee=Vt.vecEast[1],ae=Vt.vecSouth[0],ge=Vt.vecSouth[1]}let we=N.x,Pe=N.y,Ce=u;S&&(we=me,Pe=ve,Ce=Math.pow(2,-(this.transform.zoom-_.overscaledZ)),Ce*=this.transform.getPitchedTextCorrection(me,ve,b),G||(Ce*=c.ah(.5+N.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),G&&(we+=Z*G.x*Ce+ae*G.y*Ce,Pe+=ee*G.x*Ce+ge*G.y*Ce);const ze=i.x1*Ce,Ve=i.x2*Ce,Ie=(ze+Ve)/2,Ye=i.y1*Ce,ct=i.y2*Ce,rt=(Ye+ct)/2,st=[{offsetX:ze,offsetY:Ye},{offsetX:Ie,offsetY:Ye},{offsetX:Ve,offsetY:Ye},{offsetX:Ve,offsetY:rt},{offsetX:Ve,offsetY:ct},{offsetX:Ie,offsetY:ct},{offsetX:ze,offsetY:ct},{offsetX:ze,offsetY:rt}];let lt=[];for(const{offsetX:Vt,offsetY:At}of st)lt.push(new c.P(we+Z*Vt+ae*At,Pe+ee*Vt+ge*At));let Nt=!1;if(S){const Vt=lt.map((At=>this.projectAndGetPerspectiveRatio(At.x,At.y,b,j,K)));Nt=Vt.some((At=>!At.isOccluded)),lt=Vt.map((At=>new c.P(At.x,At.y)))}else Nt=!0;return{box:c.aA(lt),allPointsOccluded:!Nt}}}class fa{constructor(i,u,_,b){this.opacity=i?Math.max(0,Math.min(1,i.opacity+(i.placed?u:-u))):b&&_?1:0,this.placed=_}isHidden(){return this.opacity===0&&!this.placed}}class wi{constructor(i,u,_,b,S){this.text=new fa(i?i.text:null,u,_,S),this.icon=new fa(i?i.icon:null,u,b,S)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Co{constructor(i,u,_){this.text=i,this.icon=u,this.skipFade=_}}class ja{constructor(i,u,_,b,S){this.bucketInstanceId=i,this.featureIndex=u,this.sourceLayerIndex=_,this.bucketIndex=b,this.tileID=S}}class Io{constructor(i){this.crossSourceCollisions=i,this.maxGroupID=0,this.collisionGroups={}}get(i){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[i]){const u=++this.maxGroupID;this.collisionGroups[i]={ID:u,predicate:_=>_.collisionGroupID===u}}return this.collisionGroups[i]}}function $s(T,i,u,_,b){const{horizontalAlign:S,verticalAlign:I}=c.aH(T);return new c.P(-(S-.5)*i+_[0]*b,-(I-.5)*u+_[1]*b)}class qs{constructor(i,u,_,b,S){this.transform=i.clone(),this.terrain=u,this.collisionIndex=new Pr(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=_,this.retainedQueryData={},this.collisionGroups=new Io(b),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=S,S&&(S.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(i){const u=this.terrain;return u?(_,b)=>u.getElevation(i,_,b):null}getBucketParts(i,u,_,b){const S=_.getBucket(u),I=_.latestFeatureIndex;if(!S||!I||u.id!==S.layerIds[0])return;const O=_.collisionBoxArray,N=S.layers[0].layout,j=S.layers[0].paint,G=Math.pow(2,this.transform.zoom-_.tileID.overscaledZ),K=_.tileSize/c.$,Z=_.tileID.toUnwrapped(),ee=N.get("text-rotation-alignment")==="map",ae=c.aC(_,1,this.transform.zoom),ge=c.aD(this.collisionIndex.transform,_,j.get("text-translate"),j.get("text-translate-anchor")),me=c.aD(this.collisionIndex.transform,_,j.get("icon-translate"),j.get("icon-translate-anchor")),ve=Ir(ee,this.transform,ae);this.retainedQueryData[S.bucketInstanceId]=new ja(S.bucketInstanceId,I,S.sourceLayerIndex,S.index,_.tileID);const we={bucket:S,layout:N,translationText:ge,translationIcon:me,unwrappedTileID:Z,pitchedLabelPlaneMatrix:ve,scale:G,textPixelRatio:K,holdingForFade:_.holdingForFade(),collisionBoxArray:O,partiallyEvaluatedTextSize:c.an(S.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(S.sourceID)};if(b)for(const Pe of S.sortKeyRanges){const{sortKey:Ce,symbolInstanceStart:ze,symbolInstanceEnd:Ve}=Pe;i.push({sortKey:Ce,symbolInstanceStart:ze,symbolInstanceEnd:Ve,parameters:we})}else i.push({symbolInstanceStart:0,symbolInstanceEnd:S.symbolInstances.length,parameters:we})}attemptAnchorPlacement(i,u,_,b,S,I,O,N,j,G,K,Z,ee,ae,ge,me,ve,we,Pe,Ce){const ze=c.aE[i.textAnchor],Ve=[i.textOffset0,i.textOffset1],Ie=$s(ze,_,b,Ve,S),Ye=this.collisionIndex.placeCollisionBox(u,Z,N,j,G,O,I,me,K.predicate,Pe,Ie,Ce);if((!we||this.collisionIndex.placeCollisionBox(we,Z,N,j,G,O,I,ve,K.predicate,Pe,Ie,Ce).placeable)&&Ye.placeable){let ct;if(this.prevPlacement&&this.prevPlacement.variableOffsets[ee.crossTileID]&&this.prevPlacement.placements[ee.crossTileID]&&this.prevPlacement.placements[ee.crossTileID].text&&(ct=this.prevPlacement.variableOffsets[ee.crossTileID].anchor),ee.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[ee.crossTileID]={textOffset:Ve,width:_,height:b,anchor:ze,textBoxScale:S,prevAnchor:ct},this.markUsedJustification(ae,ze,ee,ge),ae.allowVerticalPlacement&&(this.markUsedOrientation(ae,ge,ee),this.placedOrientations[ee.crossTileID]=ge),{shift:Ie,placedGlyphBoxes:Ye}}}placeLayerBucketPart(i,u,_){const{bucket:b,layout:S,translationText:I,translationIcon:O,unwrappedTileID:N,pitchedLabelPlaneMatrix:j,textPixelRatio:G,holdingForFade:K,collisionBoxArray:Z,partiallyEvaluatedTextSize:ee,collisionGroup:ae}=i.parameters,ge=S.get("text-optional"),me=S.get("icon-optional"),ve=c.aF(S,"text-overlap","text-allow-overlap"),we=ve==="always",Pe=c.aF(S,"icon-overlap","icon-allow-overlap"),Ce=Pe==="always",ze=S.get("text-rotation-alignment")==="map",Ve=S.get("text-pitch-alignment")==="map",Ie=S.get("icon-text-fit")!=="none",Ye=S.get("symbol-z-order")==="viewport-y",ct=we&&(Ce||!b.hasIconData()||me),rt=Ce&&(we||!b.hasTextData()||ge);!b.collisionArrays&&Z&&b.deserializeCollisionBoxes(Z);const st=this.retainedQueryData[b.bucketInstanceId].tileID,lt=this._getTerrainElevationFunc(st),Nt=this.transform.getFastPathSimpleProjectionMatrix(st),Vt=(At,ln,Hn)=>{var bi,Yi;if(u[At.crossTileID])return;if(K)return void(this.placements[At.crossTileID]=new Co(!1,!1,!1));let $i=!1,Mr=!1,Fr=!0,jn=null,ur={box:null,placeable:!1,offscreen:null,occluded:!1},oa={placeable:!1},Vr=null,La=null,Xa=null,mo=0,Ru=0,su=0;ln.textFeatureIndex?mo=ln.textFeatureIndex:At.useRuntimeCollisionCircles&&(mo=At.featureIndex),ln.verticalTextFeatureIndex&&(Ru=ln.verticalTextFeatureIndex);const Ph=ln.textBox;if(Ph){const no=la=>{let ua=c.ao.horizontal;if(b.allowVerticalPlacement&&!la&&this.prevPlacement){const Go=this.prevPlacement.placedOrientations[At.crossTileID];Go&&(this.placedOrientations[At.crossTileID]=Go,ua=Go,this.markUsedOrientation(b,ua,At))}return ua},bl=(la,ua)=>{if(b.allowVerticalPlacement&&At.numVerticalGlyphVertices>0&&ln.verticalTextBox){for(const Go of b.writingModes)if(Go===c.ao.vertical?(ur=ua(),oa=ur):ur=la(),ur&&ur.placeable)break}else ur=la()},os=At.textAnchorOffsetStartIndex,ku=At.textAnchorOffsetEndIndex;if(ku===os){const la=(ua,Go)=>{const ca=this.collisionIndex.placeCollisionBox(ua,ve,G,st,N,Ve,ze,I,ae.predicate,lt,void 0,Nt);return ca&&ca.placeable&&(this.markUsedOrientation(b,Go,At),this.placedOrientations[At.crossTileID]=Go),ca};bl((()=>la(Ph,c.ao.horizontal)),(()=>{const ua=ln.verticalTextBox;return b.allowVerticalPlacement&&At.numVerticalGlyphVertices>0&&ua?la(ua,c.ao.vertical):{box:null,offscreen:null}})),no(ur&&ur.placeable)}else{let la=c.aE[(Yi=(bi=this.prevPlacement)===null||bi===void 0?void 0:bi.variableOffsets[At.crossTileID])===null||Yi===void 0?void 0:Yi.anchor];const ua=(ca,gd,bc)=>{const ou=ca.x2-ca.x1,xl=ca.y2-ca.y1,lu=At.textBoxScale,ip=Ie&&Pe==="never"?gd:null;let go=null,fm=ve==="never"?1:2,rp="never";la&&fm++;for(let _d=0;_d<fm;_d++){for(let xc=os;xc<ku;xc++){const uu=b.textAnchorOffsets.get(xc);if(la&&uu.textAnchor!==la)continue;const wl=this.attemptAnchorPlacement(uu,ca,ou,xl,lu,ze,Ve,G,st,N,ae,rp,At,b,bc,I,O,ip,lt);if(wl&&(go=wl.placedGlyphBoxes,go&&go.placeable))return $i=!0,jn=wl.shift,go}la?la=null:rp=ve}return _&&!go&&(go={box:this.collisionIndex.placeCollisionBox(Ph,"always",G,st,N,Ve,ze,I,ae.predicate,lt,void 0,Nt).box,offscreen:!1,placeable:!1,occluded:!1}),go};bl((()=>ua(Ph,ln.iconBox,c.ao.horizontal)),(()=>{const ca=ln.verticalTextBox;return b.allowVerticalPlacement&&(!ur||!ur.placeable)&&At.numVerticalGlyphVertices>0&&ca?ua(ca,ln.verticalIconBox,c.ao.vertical):{box:null,occluded:!0,offscreen:null}})),ur&&($i=ur.placeable,Fr=ur.offscreen);const Go=no(ur&&ur.placeable);if(!$i&&this.prevPlacement){const ca=this.prevPlacement.variableOffsets[At.crossTileID];ca&&(this.variableOffsets[At.crossTileID]=ca,this.markUsedJustification(b,ca.anchor,At,Go))}}}if(Vr=ur,$i=Vr&&Vr.placeable,Fr=Vr&&Vr.offscreen,At.useRuntimeCollisionCircles){const no=b.text.placedSymbolArray.get(At.centerJustifiedTextSymbolIndex),bl=c.ap(b.textSizeData,ee,no),os=S.get("text-padding");La=this.collisionIndex.placeCollisionCircles(ve,no,b.lineVertexArray,b.glyphOffsetArray,bl,N,j,_,Ve,ae.predicate,At.collisionCircleDiameter,os,I,lt),La.circles.length&&La.collisionDetected&&!_&&c.w("Collisions detected, but collision boxes are not shown"),$i=we||La.circles.length>0&&!La.collisionDetected,Fr=Fr&&La.offscreen}if(ln.iconFeatureIndex&&(su=ln.iconFeatureIndex),ln.iconBox){const no=bl=>this.collisionIndex.placeCollisionBox(bl,Pe,G,st,N,Ve,ze,O,ae.predicate,lt,Ie&&jn?jn:void 0,Nt);oa&&oa.placeable&&ln.verticalIconBox?(Xa=no(ln.verticalIconBox),Mr=Xa.placeable):(Xa=no(ln.iconBox),Mr=Xa.placeable),Fr=Fr&&Xa.offscreen}const Xc=ge||At.numHorizontalGlyphVertices===0&&At.numVerticalGlyphVertices===0,yc=me||At.numIconVertices===0;Xc||yc?yc?Xc||(Mr=Mr&&$i):$i=Mr&&$i:Mr=$i=Mr&&$i;const vc=Mr&&Xa.placeable;if($i&&Vr.placeable&&this.collisionIndex.insertCollisionBox(Vr.box,ve,S.get("text-ignore-placement"),b.bucketInstanceId,oa&&oa.placeable&&Ru?Ru:mo,ae.ID),vc&&this.collisionIndex.insertCollisionBox(Xa.box,Pe,S.get("icon-ignore-placement"),b.bucketInstanceId,su,ae.ID),La&&$i&&this.collisionIndex.insertCollisionCircles(La.circles,ve,S.get("text-ignore-placement"),b.bucketInstanceId,mo,ae.ID),_&&this.storeCollisionData(b.bucketInstanceId,Hn,ln,Vr,Xa,La),At.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(b.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[At.crossTileID]=new Co(($i||ct)&&!(Vr!=null&&Vr.occluded),(Mr||rt)&&!(Xa!=null&&Xa.occluded),Fr||b.justReloaded),u[At.crossTileID]=!0};if(Ye){if(i.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const At=b.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let ln=At.length-1;ln>=0;--ln){const Hn=At[ln];Vt(b.symbolInstances.get(Hn),b.collisionArrays[Hn],Hn)}}else for(let At=i.symbolInstanceStart;At<i.symbolInstanceEnd;At++)Vt(b.symbolInstances.get(At),b.collisionArrays[At],At);b.justReloaded=!1}storeCollisionData(i,u,_,b,S,I){if(_.textBox||_.iconBox){let O,N;this.collisionBoxArrays.has(i)?O=this.collisionBoxArrays.get(i):(O=new Map,this.collisionBoxArrays.set(i,O)),O.has(u)?N=O.get(u):(N={text:null,icon:null},O.set(u,N)),_.textBox&&(N.text=b.box),_.iconBox&&(N.icon=S.box)}if(I){let O=this.collisionCircleArrays[i];O===void 0&&(O=this.collisionCircleArrays[i]=[]);for(let N=0;N<I.circles.length;N+=4)O.push(I.circles[N+0]-Ei),O.push(I.circles[N+1]-Ei),O.push(I.circles[N+2]),O.push(I.collisionDetected?1:0)}}markUsedJustification(i,u,_,b){let S;S=b===c.ao.vertical?_.verticalPlacedTextSymbolIndex:{left:_.leftJustifiedTextSymbolIndex,center:_.centerJustifiedTextSymbolIndex,right:_.rightJustifiedTextSymbolIndex}[c.aG(u)];const I=[_.leftJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.rightJustifiedTextSymbolIndex,_.verticalPlacedTextSymbolIndex];for(const O of I)O>=0&&(i.text.placedSymbolArray.get(O).crossTileID=S>=0&&O!==S?0:_.crossTileID)}markUsedOrientation(i,u,_){const b=u===c.ao.horizontal||u===c.ao.horizontalOnly?u:0,S=u===c.ao.vertical?u:0,I=[_.leftJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.rightJustifiedTextSymbolIndex];for(const O of I)i.text.placedSymbolArray.get(O).placedOrientation=b;_.verticalPlacedTextSymbolIndex&&(i.text.placedSymbolArray.get(_.verticalPlacedTextSymbolIndex).placedOrientation=S)}commit(i){this.commitTime=i,this.zoomAtLastRecencyCheck=this.transform.zoom;const u=this.prevPlacement;let _=!1;this.prevZoomAdjustment=u?u.zoomAdjustment(this.transform.zoom):0;const b=u?u.symbolFadeChange(i):1,S=u?u.opacities:{},I=u?u.variableOffsets:{},O=u?u.placedOrientations:{};for(const N in this.placements){const j=this.placements[N],G=S[N];G?(this.opacities[N]=new wi(G,b,j.text,j.icon),_=_||j.text!==G.text.placed||j.icon!==G.icon.placed):(this.opacities[N]=new wi(null,b,j.text,j.icon,j.skipFade),_=_||j.text||j.icon)}for(const N in S){const j=S[N];if(!this.opacities[N]){const G=new wi(j,b,!1,!1);G.isHidden()||(this.opacities[N]=G,_=_||j.text.placed||j.icon.placed)}}for(const N in I)this.variableOffsets[N]||!this.opacities[N]||this.opacities[N].isHidden()||(this.variableOffsets[N]=I[N]);for(const N in O)this.placedOrientations[N]||!this.opacities[N]||this.opacities[N].isHidden()||(this.placedOrientations[N]=O[N]);if(u&&u.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");_?this.lastPlacementChangeTime=i:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=u?u.lastPlacementChangeTime:i)}updateLayerOpacities(i,u){const _={};for(const b of u){const S=b.getBucket(i);S&&b.latestFeatureIndex&&i.id===S.layerIds[0]&&this.updateBucketOpacities(S,b.tileID,_,b.collisionBoxArray)}}updateBucketOpacities(i,u,_,b){i.hasTextData()&&(i.text.opacityVertexArray.clear(),i.text.hasVisibleVertices=!1),i.hasIconData()&&(i.icon.opacityVertexArray.clear(),i.icon.hasVisibleVertices=!1),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexArray.clear(),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexArray.clear();const S=i.layers[0],I=S.layout,O=new wi(null,0,!1,!1,!0),N=I.get("text-allow-overlap"),j=I.get("icon-allow-overlap"),G=S._unevaluatedLayout.hasValue("text-variable-anchor")||S._unevaluatedLayout.hasValue("text-variable-anchor-offset"),K=I.get("text-rotation-alignment")==="map",Z=I.get("text-pitch-alignment")==="map",ee=I.get("icon-text-fit")!=="none",ae=new wi(null,0,N&&(j||!i.hasIconData()||I.get("icon-optional")),j&&(N||!i.hasTextData()||I.get("text-optional")),!0);!i.collisionArrays&&b&&(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData())&&i.deserializeCollisionBoxes(b);const ge=(ve,we,Pe)=>{for(let Ce=0;Ce<we/4;Ce++)ve.opacityVertexArray.emplaceBack(Pe);ve.hasVisibleVertices=ve.hasVisibleVertices||Pe!==Ia},me=this.collisionBoxArrays.get(i.bucketInstanceId);for(let ve=0;ve<i.symbolInstances.length;ve++){const we=i.symbolInstances.get(ve),{numHorizontalGlyphVertices:Pe,numVerticalGlyphVertices:Ce,crossTileID:ze}=we;let Ve=this.opacities[ze];_[ze]?Ve=O:Ve||(Ve=ae,this.opacities[ze]=Ve),_[ze]=!0;const Ie=we.numIconVertices>0,Ye=this.placedOrientations[we.crossTileID],ct=Ye===c.ao.vertical,rt=Ye===c.ao.horizontal||Ye===c.ao.horizontalOnly;if(Pe>0||Ce>0){const lt=Ui(Ve.text);ge(i.text,Pe,ct?Ia:lt),ge(i.text,Ce,rt?Ia:lt);const Nt=Ve.text.isHidden();[we.rightJustifiedTextSymbolIndex,we.centerJustifiedTextSymbolIndex,we.leftJustifiedTextSymbolIndex].forEach((ln=>{ln>=0&&(i.text.placedSymbolArray.get(ln).hidden=Nt||ct?1:0)})),we.verticalPlacedTextSymbolIndex>=0&&(i.text.placedSymbolArray.get(we.verticalPlacedTextSymbolIndex).hidden=Nt||rt?1:0);const Vt=this.variableOffsets[we.crossTileID];Vt&&this.markUsedJustification(i,Vt.anchor,we,Ye);const At=this.placedOrientations[we.crossTileID];At&&(this.markUsedJustification(i,"left",we,At),this.markUsedOrientation(i,At,we))}if(Ie){const lt=Ui(Ve.icon),Nt=!(ee&&we.verticalPlacedIconSymbolIndex&&ct);we.placedIconSymbolIndex>=0&&(ge(i.icon,we.numIconVertices,Nt?lt:Ia),i.icon.placedSymbolArray.get(we.placedIconSymbolIndex).hidden=Ve.icon.isHidden()),we.verticalPlacedIconSymbolIndex>=0&&(ge(i.icon,we.numVerticalIconVertices,Nt?Ia:lt),i.icon.placedSymbolArray.get(we.verticalPlacedIconSymbolIndex).hidden=Ve.icon.isHidden())}const st=me&&me.has(ve)?me.get(ve):{text:null,icon:null};if(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData()){const lt=i.collisionArrays[ve];if(lt){let Nt=new c.P(0,0);if(lt.textBox||lt.verticalTextBox){let Vt=!0;if(G){const At=this.variableOffsets[ze];At?(Nt=$s(At.anchor,At.width,At.height,At.textOffset,At.textBoxScale),K&&Nt._rotate(Z?-this.transform.bearingInRadians:this.transform.bearingInRadians)):Vt=!1}if(lt.textBox||lt.verticalTextBox){let At;lt.textBox&&(At=ct),lt.verticalTextBox&&(At=rt),al(i.textCollisionBox.collisionVertexArray,Ve.text.placed,!Vt||At,st.text,Nt.x,Nt.y)}}if(lt.iconBox||lt.verticalIconBox){const Vt=!!(!rt&&lt.verticalIconBox);let At;lt.iconBox&&(At=Vt),lt.verticalIconBox&&(At=!Vt),al(i.iconCollisionBox.collisionVertexArray,Ve.icon.placed,At,st.icon,ee?Nt.x:0,ee?Nt.y:0)}}}}if(i.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[i.bucketInstanceId]&&(this.retainedQueryData[i.bucketInstanceId].featureSortOrder=i.featureSortOrder),i.hasTextData()&&i.text.opacityVertexBuffer&&i.text.opacityVertexBuffer.updateData(i.text.opacityVertexArray),i.hasIconData()&&i.icon.opacityVertexBuffer&&i.icon.opacityVertexBuffer.updateData(i.icon.opacityVertexArray),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexBuffer&&i.iconCollisionBox.collisionVertexBuffer.updateData(i.iconCollisionBox.collisionVertexArray),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexBuffer&&i.textCollisionBox.collisionVertexBuffer.updateData(i.textCollisionBox.collisionVertexArray),i.text.opacityVertexArray.length!==i.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${i.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${i.text.layoutVertexArray.length}) / 4`);if(i.icon.opacityVertexArray.length!==i.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${i.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${i.icon.layoutVertexArray.length}) / 4`);i.bucketInstanceId in this.collisionCircleArrays&&(i.collisionCircleArray=this.collisionCircleArrays[i.bucketInstanceId],delete this.collisionCircleArrays[i.bucketInstanceId])}symbolFadeChange(i){return this.fadeDuration===0?1:(i-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(i){return Math.max(0,(this.transform.zoom-i)/1.5)}hasTransitions(i){return this.stale||i-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(i,u){const _=this.zoomAtLastRecencyCheck===u?1-this.zoomAdjustment(u):1;return this.zoomAtLastRecencyCheck=u,this.commitTime+this.fadeDuration*_>i}setStale(){this.stale=!0}}function al(T,i,u,_,b,S){_&&_.length!==0||(_=[0,0,0,0]);const I=_[0]-Ei,O=_[1]-Ei,N=_[2]-Ei,j=_[3]-Ei;T.emplaceBack(i?1:0,u?1:0,b||0,S||0,I,O),T.emplaceBack(i?1:0,u?1:0,b||0,S||0,N,O),T.emplaceBack(i?1:0,u?1:0,b||0,S||0,N,j),T.emplaceBack(i?1:0,u?1:0,b||0,S||0,I,j)}const ii=Math.pow(2,25),hi=Math.pow(2,24),Hi=Math.pow(2,17),xr=Math.pow(2,16),Gs=Math.pow(2,9),fu=Math.pow(2,8),on=Math.pow(2,1);function Ui(T){if(T.opacity===0&&!T.placed)return 0;if(T.opacity===1&&T.placed)return 4294967295;const i=T.placed?1:0,u=Math.floor(127*T.opacity);return u*ii+i*hi+u*Hi+i*xr+u*Gs+i*fu+u*on+i}const Ia=0;class lo{constructor(i){this._sortAcrossTiles=i.layout.get("symbol-z-order")!=="viewport-y"&&!i.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(i,u,_,b,S){const I=this._bucketParts;for(;this._currentTileIndex<i.length;)if(u.getBucketParts(I,b,i[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,S())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,I.sort(((O,N)=>O.sortKey-N.sortKey)));this._currentPartIndex<I.length;)if(u.placeLayerBucketPart(I[this._currentPartIndex],this._seenCrossTileIDs,_),this._currentPartIndex++,S())return!0;return!1}}class rr{constructor(i,u,_,b,S,I,O,N){this.placement=new qs(i,u,I,O,N),this._currentPlacementIndex=_.length-1,this._forceFullPlacement=b,this._showCollisionBoxes=S,this._done=!1}isDone(){return this._done}continuePlacement(i,u,_){const b=J.now(),S=()=>!this._forceFullPlacement&&J.now()-b>2;for(;this._currentPlacementIndex>=0;){const I=u[i[this._currentPlacementIndex]],O=this.placement.collisionIndex.transform.zoom;if(I.type==="symbol"&&(!I.minzoom||I.minzoom<=O)&&(!I.maxzoom||I.maxzoom>O)){if(this._inProgressLayer||(this._inProgressLayer=new lo(I)),this._inProgressLayer.continuePlacement(_[I.source],this.placement,this._showCollisionBoxes,I,S))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(i){return this.placement.commit(i),this.placement}}const Po=512/c.$/2;class Dl{constructor(i,u,_){this.tileID=i,this.bucketInstanceId=_,this._symbolsByKey={};const b=new Map;for(let S=0;S<u.length;S++){const I=u.get(S),O=I.key,N=b.get(O);N?N.push(I):b.set(O,[I])}for(const[S,I]of b){const O={positions:I.map((N=>({x:Math.floor(N.anchorX*Po),y:Math.floor(N.anchorY*Po)}))),crossTileIDs:I.map((N=>N.crossTileID))};if(O.positions.length>128){const N=new c.aI(O.positions.length,16,Uint16Array);for(const{x:j,y:G}of O.positions)N.add(j,G);N.finish(),delete O.positions,O.index=N}this._symbolsByKey[S]=O}}getScaledCoordinates(i,u){const{x:_,y:b,z:S}=this.tileID.canonical,{x:I,y:O,z:N}=u.canonical,j=Po/Math.pow(2,N-S),G=(O*c.$+i.anchorY)*j,K=b*c.$*Po;return{x:Math.floor((I*c.$+i.anchorX)*j-_*c.$*Po),y:Math.floor(G-K)}}findMatches(i,u,_){const b=this.tileID.canonical.z<u.canonical.z?1:Math.pow(2,this.tileID.canonical.z-u.canonical.z);for(let S=0;S<i.length;S++){const I=i.get(S);if(I.crossTileID)continue;const O=this._symbolsByKey[I.key];if(!O)continue;const N=this.getScaledCoordinates(I,u);if(O.index){const j=O.index.range(N.x-b,N.y-b,N.x+b,N.y+b).sort();for(const G of j){const K=O.crossTileIDs[G];if(!_[K]){_[K]=!0,I.crossTileID=K;break}}}else if(O.positions)for(let j=0;j<O.positions.length;j++){const G=O.positions[j],K=O.crossTileIDs[j];if(Math.abs(G.x-N.x)<=b&&Math.abs(G.y-N.y)<=b&&!_[K]){_[K]=!0,I.crossTileID=K;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map((({crossTileIDs:i})=>i))}}class Hs{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class ar{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(i){const u=Math.round((i-this.lng)/360);if(u!==0)for(const _ in this.indexes){const b=this.indexes[_],S={};for(const I in b){const O=b[I];O.tileID=O.tileID.unwrapTo(O.tileID.wrap+u),S[O.tileID.key]=O}this.indexes[_]=S}this.lng=i}addBucket(i,u,_){if(this.indexes[i.overscaledZ]&&this.indexes[i.overscaledZ][i.key]){if(this.indexes[i.overscaledZ][i.key].bucketInstanceId===u.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(i.overscaledZ,this.indexes[i.overscaledZ][i.key])}for(let S=0;S<u.symbolInstances.length;S++)u.symbolInstances.get(S).crossTileID=0;this.usedCrossTileIDs[i.overscaledZ]||(this.usedCrossTileIDs[i.overscaledZ]={});const b=this.usedCrossTileIDs[i.overscaledZ];for(const S in this.indexes){const I=this.indexes[S];if(Number(S)>i.overscaledZ)for(const O in I){const N=I[O];N.tileID.isChildOf(i)&&N.findMatches(u.symbolInstances,i,b)}else{const O=I[i.scaledTo(Number(S)).key];O&&O.findMatches(u.symbolInstances,i,b)}}for(let S=0;S<u.symbolInstances.length;S++){const I=u.symbolInstances.get(S);I.crossTileID||(I.crossTileID=_.generate(),b[I.crossTileID]=!0)}return this.indexes[i.overscaledZ]===void 0&&(this.indexes[i.overscaledZ]={}),this.indexes[i.overscaledZ][i.key]=new Dl(i,u.symbolInstances,u.bucketInstanceId),!0}removeBucketCrossTileIDs(i,u){for(const _ of u.getCrossTileIDsLists())for(const b of _)delete this.usedCrossTileIDs[i][b]}removeStaleBuckets(i){let u=!1;for(const _ in this.indexes){const b=this.indexes[_];for(const S in b)i[b[S].bucketInstanceId]||(this.removeBucketCrossTileIDs(_,b[S]),delete b[S],u=!0)}return u}}class Ja{constructor(){this.layerIndexes={},this.crossTileIDs=new Hs,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(i,u,_){let b=this.layerIndexes[i.id];b===void 0&&(b=this.layerIndexes[i.id]=new ar);let S=!1;const I={};b.handleWrapJump(_);for(const O of u){const N=O.getBucket(i);N&&i.id===N.layerIds[0]&&(N.bucketInstanceId||(N.bucketInstanceId=++this.maxBucketInstanceId),b.addBucket(O.tileID,N,this.crossTileIDs)&&(S=!0),I[N.bucketInstanceId]=!0)}return b.removeStaleBuckets(I)&&(S=!0),S}pruneUnusedLayers(i){const u={};i.forEach((_=>{u[_]=!0}));for(const _ in this.layerIndexes)u[_]||delete this.layerIndexes[_]}}var $a="void main() {fragColor=vec4(1.0);}";const Zi={prelude:Un(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:Un("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:Un("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:Un(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:Un(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Un(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Un($a,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:Un(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:Un(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Un("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Un("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:Un(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:Un("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:Un($a,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:Un(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:Un(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:Un(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:Un(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Un(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Un(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Un(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Un(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:Un(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Un(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Un(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Un(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Un(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:Un(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Un(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Un(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Un("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:Un("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:Un("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:Un("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:Un(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:Un("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function Un(T,i){const u=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,_=i.match(/in ([\w]+) ([\w]+)/g),b=T.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),S=i.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),I=S?S.concat(b):b,O={};return{fragmentSource:T=T.replace(u,((N,j,G,K,Z)=>(O[Z]=!0,j==="define"?`
#ifndef HAS_UNIFORM_u_${Z}
in ${G} ${K} ${Z};
#else
uniform ${G} ${K} u_${Z};
#endif
`:`
#ifdef HAS_UNIFORM_u_${Z}
    ${G} ${K} ${Z} = u_${Z};
#endif
`))),vertexSource:i=i.replace(u,((N,j,G,K,Z)=>{const ee=K==="float"?"vec2":"vec4",ae=Z.match(/color/)?"color":ee;return O[Z]?j==="define"?`
#ifndef HAS_UNIFORM_u_${Z}
uniform lowp float u_${Z}_t;
in ${G} ${ee} a_${Z};
out ${G} ${K} ${Z};
#else
uniform ${G} ${K} u_${Z};
#endif
`:ae==="vec4"?`
#ifndef HAS_UNIFORM_u_${Z}
    ${Z} = a_${Z};
#else
    ${G} ${K} ${Z} = u_${Z};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Z}
    ${Z} = unpack_mix_${ae}(a_${Z}, u_${Z}_t);
#else
    ${G} ${K} ${Z} = u_${Z};
#endif
`:j==="define"?`
#ifndef HAS_UNIFORM_u_${Z}
uniform lowp float u_${Z}_t;
in ${G} ${ee} a_${Z};
#else
uniform ${G} ${K} u_${Z};
#endif
`:ae==="vec4"?`
#ifndef HAS_UNIFORM_u_${Z}
    ${G} ${K} ${Z} = a_${Z};
#else
    ${G} ${K} ${Z} = u_${Z};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Z}
    ${G} ${K} ${Z} = unpack_mix_${ae}(a_${Z}, u_${Z}_t);
#else
    ${G} ${K} ${Z} = u_${Z};
#endif
`})),staticAttributes:_,staticUniforms:I}}class es{constructor(i,u,_){this.vertexBuffer=i,this.indexBuffer=u,this.segments=_}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var ys=c.aJ([{name:"a_pos",type:"Int16",components:2}]);const qa="#define PROJECTION_MERCATOR",Zs="mercator";class kn{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return Zs}get shaderDefine(){return qa}get shaderPreludeCode(){return Zi.projectionMercator}get vertexShaderPreludeCode(){return Zi.projectionMercator.vertexSource}get subdivisionGranularity(){return c.aK.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(i){}getMeshFromTileID(i,u,_,b,S){if(this._cachedMesh)return this._cachedMesh;const I=new c.aL;I.emplaceBack(0,0),I.emplaceBack(c.$,0),I.emplaceBack(0,c.$),I.emplaceBack(c.$,c.$);const O=i.createVertexBuffer(I,ys.members),N=c.aM.simpleSegment(0,0,4,2),j=new c.aN;j.emplaceBack(1,0,2),j.emplaceBack(1,2,3);const G=i.createIndexBuffer(j);return this._cachedMesh=new es(O,G,N),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(i){}}class vs{constructor(i=0,u=0,_=0,b=0){if(isNaN(i)||i<0||isNaN(u)||u<0||isNaN(_)||_<0||isNaN(b)||b<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=i,this.bottom=u,this.left=_,this.right=b}interpolate(i,u,_){return u.top!=null&&i.top!=null&&(this.top=c.C.number(i.top,u.top,_)),u.bottom!=null&&i.bottom!=null&&(this.bottom=c.C.number(i.bottom,u.bottom,_)),u.left!=null&&i.left!=null&&(this.left=c.C.number(i.left,u.left,_)),u.right!=null&&i.right!=null&&(this.right=c.C.number(i.right,u.right,_)),this}getCenter(i,u){const _=c.ah((this.left+i-this.right)/2,0,i),b=c.ah((this.top+u-this.bottom)/2,0,u);return new c.P(_,b)}equals(i){return this.top===i.top&&this.bottom===i.bottom&&this.left===i.left&&this.right===i.right}clone(){return new vs(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Pa(T,i){if(!T.renderWorldCopies||T.lngRange)return;const u=i.lng-T.center.lng;i.lng+=u>180?-360:u<-180?360:0}function zl(T){return Math.max(0,Math.floor(T))}class Wi{constructor(i,u,_,b,S,I){this._callbacks=i,this._tileSize=512,this._renderWorldCopies=I===void 0||!!I,this._minZoom=u||0,this._maxZoom=_||22,this._minPitch=b??0,this._maxPitch=S??60,this.setMaxBounds(),this._width=0,this._height=0,this._center=new c.S(0,0),this._elevation=0,this._zoom=0,this._tileZoom=zl(this._zoom),this._scale=c.af(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new vs,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(i,u,_){this._latRange=i.latRange,this._lngRange=i.lngRange,this._width=i.width,this._height=i.height,this._center=i.center,this._elevation=i.elevation,this._minElevationForCurrentTile=i.minElevationForCurrentTile,this._zoom=i.zoom,this._tileZoom=zl(this._zoom),this._scale=c.af(this._zoom),this._bearingInRadians=i.bearingInRadians,this._fovInRadians=i.fovInRadians,this._pitchInRadians=i.pitchInRadians,this._rollInRadians=i.rollInRadians,this._unmodified=i.unmodified,this._edgeInsets=new vs(i.padding.top,i.padding.bottom,i.padding.left,i.padding.right),this._minZoom=i.minZoom,this._maxZoom=i.maxZoom,this._minPitch=i.minPitch,this._maxPitch=i.maxPitch,this._renderWorldCopies=i.renderWorldCopies,this._cameraToCenterDistance=i.cameraToCenterDistance,this._nearZ=i.nearZ,this._farZ=i.farZ,this._autoCalculateNearFarZ=!_&&i.autoCalculateNearFarZ,u&&this._constrain(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(i){this._minElevationForCurrentTile=i}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(i){this._minZoom!==i&&(this._minZoom=i,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(i){this._maxZoom!==i&&(this._maxZoom=i,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(i){this._minPitch!==i&&(this._minPitch=i,this.setPitch(Math.max(this.pitch,i)))}get maxPitch(){return this._maxPitch}setMaxPitch(i){this._maxPitch!==i&&(this._maxPitch=i,this.setPitch(Math.min(this.pitch,i)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(i){i===void 0?i=!0:i===null&&(i=!1),this._renderWorldCopies=i}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new c.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(i){const u=c.aO(i,-180,180)*Math.PI/180;var _,b,S,I,O,N,j,G,K;this._bearingInRadians!==u&&(this._unmodified=!1,this._bearingInRadians=u,this._calcMatrices(),this._rotationMatrix=R(),_=this._rotationMatrix,S=-this._bearingInRadians,I=(b=this._rotationMatrix)[0],O=b[1],N=b[2],j=b[3],G=Math.sin(S),K=Math.cos(S),_[0]=I*K+N*G,_[1]=O*K+j*G,_[2]=I*-G+N*K,_[3]=O*-G+j*K)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(i){const u=c.ah(i,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==u&&(this._unmodified=!1,this._pitchInRadians=u,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(i){const u=i/180*Math.PI;this._rollInRadians!==u&&(this._unmodified=!1,this._rollInRadians=u,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return c.aP(this._fovInRadians)}setFov(i){i=c.ah(i,.1,150),this.fov!==i&&(this._unmodified=!1,this._fovInRadians=c.ae(i),this._calcMatrices())}get zoom(){return this._zoom}setZoom(i){const u=this.getConstrained(this._center,i).zoom;this._zoom!==u&&(this._unmodified=!1,this._zoom=u,this._tileZoom=Math.max(0,Math.floor(u)),this._scale=c.af(u),this._constrain(),this._calcMatrices())}get center(){return this._center}setCenter(i){i.lat===this._center.lat&&i.lng===this._center.lng||(this._unmodified=!1,this._center=i,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(i){i!==this._elevation&&(this._elevation=i,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(i){this._edgeInsets.equals(i)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,i,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(i,u){this._autoCalculateNearFarZ=!1,this._nearZ=i,this._farZ=u,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(i){return this._edgeInsets.equals(i)}interpolatePadding(i,u,_){this._unmodified=!1,this._edgeInsets.interpolate(i,u,_),this._constrain(),this._calcMatrices()}resize(i,u,_=!0){this._width=i,this._height=u,_&&this._constrain(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new Fi([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(i){i?(this._lngRange=[i.getWest(),i.getEast()],this._latRange=[i.getSouth(),i.getNorth()],this._constrain()):(this._lngRange=null,this._latRange=[-c.ai,c.ai])}getConstrained(i,u){return this._callbacks.getConstrained(i,u)}getCameraQueryGeometry(i,u){if(u.length===1)return[u[0],i];{const{minX:_,minY:b,maxX:S,maxY:I}=c.a2.fromPoints(u).extend(i);return[new c.P(_,b),new c.P(S,b),new c.P(S,I),new c.P(_,I),new c.P(_,b)]}}_constrain(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const i=this._unmodified,{center:u,zoom:_}=this.getConstrained(this.center,this.zoom);this.setCenter(u),this.setZoom(_),this._unmodified=i,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let i=c.ag(new Float64Array(16));c.N(i,i,[this._width/2,-this._height/2,1]),c.M(i,i,[1,-1,0]),this._clipSpaceToPixelsMatrix=i,i=c.ag(new Float64Array(16)),c.N(i,i,[1,-1,1]),c.M(i,i,[-1,-1,0]),c.N(i,i,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=i,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(i,u,_,b){const S=_!==void 0?_:this.bearing,I=b=b!==void 0?b:this.pitch,O=c.a1.fromLngLat(i,u),N=-Math.cos(c.ae(I)),j=Math.sin(c.ae(I)),G=j*Math.sin(c.ae(S)),K=-j*Math.cos(c.ae(S));let Z=this.elevation;const ee=u-Z;let ae;N*ee>=0||Math.abs(N)<.1?(ae=1e4,Z=u+ae*N):ae=-ee/N;let ge,me,ve=c.aQ(1,O.y),we=0;do{if(we+=1,we>10)break;me=ae/ve,ge=new c.a1(O.x+G*me,O.y+K*me),ve=1/ge.meterInMercatorCoordinateUnits()}while(Math.abs(ae-me*ve)>1e-12);return{center:ge.toLngLat(),elevation:Z,zoom:c.ak(this.height/2/Math.tan(this.fovInRadians/2)/me/this.tileSize)}}recalculateZoomAndCenter(i){if(this.elevation-i==0)return;const u=c.aj(1,this.center.lat)*this.worldSize,_=this.cameraToCenterDistance/u,b=c.a1.fromLngLat(this.center,this.elevation),S=tt(this.center,this.elevation,this.pitch,this.bearing,_);this._elevation=i;const I=this.calculateCenterFromCameraLngLatAlt(S.toLngLat(),c.aQ(S.z,b.y),this.bearing,this.pitch);this._elevation=I.elevation,this._center=I.center,this.setZoom(I.zoom)}getCameraPoint(){const i=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new c.P(i*Math.sin(this.rollInRadians),i*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const i=c.aj(1,this.center.lat)*this.worldSize;return tt(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/i).toLngLat()}getMercatorTileCoordinates(i){if(!i)return[0,0,1,1];const u=i.canonical.z>=0?1<<i.canonical.z:Math.pow(2,i.canonical.z);return[i.canonical.x/u,i.canonical.y/u,1/u/c.$,1/u/c.$]}}class mr{constructor(i,u){this.min=i,this.max=u,this.center=c.aR([],c.aS([],this.min,this.max),.5)}quadrant(i){const u=[i%2==0,i<2],_=c.aT(this.min),b=c.aT(this.max);for(let S=0;S<u.length;S++)_[S]=u[S]?this.min[S]:this.center[S],b[S]=u[S]?this.center[S]:this.max[S];return b[2]=this.max[2],new mr(_,b)}distanceX(i){return Math.max(Math.min(this.max[0],i[0]),this.min[0])-i[0]}distanceY(i){return Math.max(Math.min(this.max[1],i[1]),this.min[1])-i[1]}intersectsFrustum(i){let u=!0;for(let _=0;_<i.planes.length;_++){const b=this.intersectsPlane(i.planes[_]);if(b===0)return 0;b===1&&(u=!1)}return u?2:i.aabb.min[0]>this.max[0]||i.aabb.min[1]>this.max[1]||i.aabb.min[2]>this.max[2]||i.aabb.max[0]<this.min[0]||i.aabb.max[1]<this.min[1]||i.aabb.max[2]<this.min[2]?0:1}intersectsPlane(i){let u=i[3],_=i[3];for(let b=0;b<3;b++)i[b]>0?(u+=i[b]*this.min[b],_+=i[b]*this.max[b]):(_+=i[b]*this.min[b],u+=i[b]*this.max[b]);return u>=0?2:_<0?0:1}}class hn{distanceToTile2d(i,u,_,b){const S=b.distanceX([i,u]),I=b.distanceY([i,u]);return Math.hypot(S,I)}getWrap(i,u,_){return _}getTileBoundingVolume(i,u,_,b){var S,I;let O=0,N=0;if(b!=null&&b.terrain){const G=new c.Z(i.z,u,i.z,i.x,i.y),K=b.terrain.getMinMaxElevation(G);O=(S=K.minElevation)!==null&&S!==void 0?S:Math.min(0,_),N=(I=K.maxElevation)!==null&&I!==void 0?I:Math.max(0,_)}const j=1<<i.z;return new mr([u+i.x/j,i.y/j,O],[u+(i.x+1)/j,(i.y+1)/j,N])}allowVariableZoom(i,u){const _=i.fov*(Math.abs(Math.cos(i.rollInRadians))*i.height+Math.abs(Math.sin(i.rollInRadians))*i.width)/i.height,b=c.ah(78.5-_/2,0,60);return!!u.terrain||i.pitch>b}allowWorldCopies(){return!0}prepareNextFrame(){}}class pi{constructor(i,u,_){this.points=i,this.planes=u,this.aabb=_}static fromInvProjectionMatrix(i,u=1,_=0,b,S){const I=S?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],O=Math.pow(2,_),N=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((Z=>(function(ee,ae,ge,me){const ve=c.aw([],ee,ae),we=1/ve[3]/ge*me;return c.aY(ve,ve,[we,we,1/ve[3],we])})(Z,i,u,O)));b&&(function(Z,ee,ae,ge){const me=ge?4:0,ve=ge?0:4;let we=0;const Pe=[],Ce=[];for(let Ie=0;Ie<4;Ie++){const Ye=c.aU([],Z[Ie+ve],Z[Ie+me]),ct=c.aZ(Ye);c.aR(Ye,Ye,1/ct),Pe.push(ct),Ce.push(Ye)}for(let Ie=0;Ie<4;Ie++){const Ye=c.a_(Z[Ie+me],Ce[Ie],ae);we=Ye!==null&&Ye>=0?Math.max(we,Ye):Math.max(we,Pe[Ie])}const ze=(function(Ie,Ye){const ct=c.aU([],Ie[Ye[0]],Ie[Ye[1]]),rt=c.aU([],Ie[Ye[2]],Ie[Ye[1]]),st=[0,0,0,0];return c.aV(st,c.aW([],ct,rt)),st[3]=-c.aX(st,Ie[Ye[0]]),st})(Z,ee),Ve=(function(Ie,Ye){const ct=c.a$(Ie),rt=c.b0([],Ie,1/ct),st=c.aU([],Ye,c.aR([],rt,c.aX(Ye,rt))),lt=c.a$(st);if(lt>0){const Nt=Math.sqrt(1-rt[3]*rt[3]),Vt=c.aR([],rt,-rt[3]),At=c.aS([],Vt,c.aR([],st,Nt/lt));return c.b1(Ye,At)}return null})(ae,ze);if(Ve!==null){const Ie=Ve/c.aX(Ce[0],ze);we=Math.min(we,Ie)}for(let Ie=0;Ie<4;Ie++){const Ye=Math.min(we,Pe[Ie]);Z[Ie+ve]=[Z[Ie+me][0]+Ce[Ie][0]*Ye,Z[Ie+me][1]+Ce[Ie][1]*Ye,Z[Ie+me][2]+Ce[Ie][2]*Ye,1]}})(N,I[0],b,S);const j=I.map((Z=>{const ee=c.aU([],N[Z[0]],N[Z[1]]),ae=c.aU([],N[Z[2]],N[Z[1]]),ge=c.aV([],c.aW([],ee,ae)),me=-c.aX(ge,N[Z[1]]);return ge.concat(me)})),G=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],K=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const Z of N)for(let ee=0;ee<3;ee++)G[ee]=Math.min(G[ee],Z[ee]),K[ee]=Math.max(K[ee],Z[ee]);return new pi(N,j,new mr(G,K))}}class xn{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(i){this._helper.setMinZoom(i)}setMaxZoom(i){this._helper.setMaxZoom(i)}setMinPitch(i){this._helper.setMinPitch(i)}setMaxPitch(i){this._helper.setMaxPitch(i)}setRenderWorldCopies(i){this._helper.setRenderWorldCopies(i)}setBearing(i){this._helper.setBearing(i)}setPitch(i){this._helper.setPitch(i)}setRoll(i){this._helper.setRoll(i)}setFov(i){this._helper.setFov(i)}setZoom(i){this._helper.setZoom(i)}setCenter(i){this._helper.setCenter(i)}setElevation(i){this._helper.setElevation(i)}setMinElevationForCurrentTile(i){this._helper.setMinElevationForCurrentTile(i)}setPadding(i){this._helper.setPadding(i)}interpolatePadding(i,u,_){return this._helper.interpolatePadding(i,u,_)}isPaddingEqual(i){return this._helper.isPaddingEqual(i)}resize(i,u,_=!0){this._helper.resize(i,u,_)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(i){this._helper.setMaxBounds(i)}overrideNearFarZ(i,u){this._helper.overrideNearFarZ(i,u)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(i){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),i)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(i,u){}constructor(i,u,_,b,S){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this._helper=new Wi({calcMatrices:()=>{this._calcMatrices()},getConstrained:(I,O)=>this.getConstrained(I,O)},i,u,_,b,S),this._coveringTilesDetailsProvider=new hn}clone(){const i=new xn;return i.apply(this),i}apply(i,u,_){this._helper.apply(i,u,_)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(i){const u=[new c.b2(0,i)];if(this._helper._renderWorldCopies){const _=this.screenPointToMercatorCoordinate(new c.P(0,0)),b=this.screenPointToMercatorCoordinate(new c.P(this._helper._width,0)),S=this.screenPointToMercatorCoordinate(new c.P(this._helper._width,this._helper._height)),I=this.screenPointToMercatorCoordinate(new c.P(0,this._helper._height)),O=Math.floor(Math.min(_.x,b.x,S.x,I.x)),N=Math.floor(Math.max(_.x,b.x,S.x,I.x)),j=1;for(let G=O-j;G<=N+j;G++)G!==0&&u.push(new c.b2(G,i))}return u}getCameraFrustum(){return pi.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(i){const u=this.screenPointToLocation(this.centerPoint,i),_=i?i.getElevationForLngLatZoom(u,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(_)}setLocationAtPoint(i,u){const _=c.aj(this.elevation,this.center.lat),b=this.screenPointToMercatorCoordinateAtZ(u,_),S=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,_),I=c.a1.fromLngLat(i),O=new c.a1(I.x-(b.x-S.x),I.y-(b.y-S.y));this.setCenter(O==null?void 0:O.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(i,u){return u?this.coordinatePoint(c.a1.fromLngLat(i),u.getElevationForLngLatZoom(i,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(c.a1.fromLngLat(i))}screenPointToLocation(i,u){var _;return(_=this.screenPointToMercatorCoordinate(i,u))===null||_===void 0?void 0:_.toLngLat()}screenPointToMercatorCoordinate(i,u){if(u){const _=u.pointCoordinate(i);if(_!=null)return _}return this.screenPointToMercatorCoordinateAtZ(i)}screenPointToMercatorCoordinateAtZ(i,u){const _=u||0,b=[i.x,i.y,0,1],S=[i.x,i.y,1,1];c.aw(b,b,this._pixelMatrixInverse),c.aw(S,S,this._pixelMatrixInverse);const I=b[3],O=S[3],N=b[1]/I,j=S[1]/O,G=b[2]/I,K=S[2]/O,Z=G===K?0:(_-G)/(K-G);return new c.a1(c.C.number(b[0]/I,S[0]/O,Z)/this.worldSize,c.C.number(N,j,Z)/this.worldSize,_)}coordinatePoint(i,u=0,_=this._pixelMatrix){const b=[i.x*this.worldSize,i.y*this.worldSize,u,1];return c.aw(b,b,_),new c.P(b[0]/b[3],b[1]/b[3])}getBounds(){const i=Math.max(0,this._helper._height/2-De(this));return new Fi().extend(this.screenPointToLocation(new c.P(0,i))).extend(this.screenPointToLocation(new c.P(this._helper._width,i))).extend(this.screenPointToLocation(new c.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new c.P(0,this._helper._height)))}isPointOnMapSurface(i,u){return u?u.pointCoordinate(i)!=null:i.y>this.height/2-De(this)}calculatePosMatrix(i,u=!1,_){var b;const S=(b=i.key)!==null&&b!==void 0?b:c.b3(i.wrap,i.canonical.z,i.canonical.z,i.canonical.x,i.canonical.y),I=u?this._alignedPosMatrixCache:this._posMatrixCache;if(I.has(S)){const j=I.get(S);return _?j.f32:j.f64}const O=He(i,this.worldSize);c.O(O,u?this._alignedProjMatrix:this._viewProjMatrix,O);const N={f64:O,f32:new Float32Array(O)};return I.set(S,N),_?N.f32:N.f64}calculateFogMatrix(i){const u=i.key,_=this._fogMatrixCacheF32;if(_.has(u))return _.get(u);const b=He(i,this.worldSize);return c.O(b,this._fogMatrix,b),_.set(u,new Float32Array(b)),_.get(u)}getConstrained(i,u){u=c.ah(+u,this.minZoom,this.maxZoom);const _={center:new c.S(i.lng,i.lat),zoom:u};let b=this._helper._lngRange;if(!this._helper._renderWorldCopies&&b===null){const Pe=179.9999999999;b=[-Pe,Pe]}const S=this.tileSize*c.af(_.zoom);let I=0,O=S,N=0,j=S,G=0,K=0;const{x:Z,y:ee}=this.size;if(this._helper._latRange){const Pe=this._helper._latRange;I=c.U(Pe[1])*S,O=c.U(Pe[0])*S,O-I<ee&&(G=ee/(O-I))}b&&(N=c.aO(c.V(b[0])*S,0,S),j=c.aO(c.V(b[1])*S,0,S),j<N&&(j+=S),j-N<Z&&(K=Z/(j-N)));const{x:ae,y:ge}=fe(S,i);let me,ve;const we=Math.max(K||0,G||0);if(we){const Pe=new c.P(K?(j+N)/2:ae,G?(O+I)/2:ge);return _.center=Se(S,Pe).wrap(),_.zoom+=c.ak(we),_}if(this._helper._latRange){const Pe=ee/2;ge-Pe<I&&(ve=I+Pe),ge+Pe>O&&(ve=O-Pe)}if(b){const Pe=(N+j)/2;let Ce=ae;this._helper._renderWorldCopies&&(Ce=c.aO(ae,Pe-S/2,Pe+S/2));const ze=Z/2;Ce-ze<N&&(me=N+ze),Ce+ze>j&&(me=j-ze)}if(me!==void 0||ve!==void 0){const Pe=new c.P(me??ae,ve??ge);_.center=Se(S,Pe).wrap()}return _}calculateCenterFromCameraLngLatAlt(i,u,_,b){return this._helper.calculateCenterFromCameraLngLatAlt(i,u,_,b)}_calculateNearFarZIfNeeded(i,u,_){if(!this._helper.autoCalculateNearFarZ)return;const b=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),S=i-b*this._helper._pixelPerMeter/Math.cos(u),I=b<0?S:i,O=Math.PI/2+this.pitchInRadians,N=c.ae(this.fov)*(Math.abs(Math.cos(c.ae(this.roll)))*this.height+Math.abs(Math.sin(c.ae(this.roll)))*this.width)/this.height*(.5+_.y/this.height),j=Math.sin(N)*I/Math.sin(c.ah(Math.PI-O-N,.01,Math.PI-.01)),G=De(this),K=Math.atan(G/this._helper.cameraToCenterDistance),Z=c.ae(.75),ee=K>Z?2*K*(.5+_.y/(2*G)):Z,ae=Math.sin(ee)*I/Math.sin(c.ah(Math.PI-O-ee,.01,Math.PI-.01)),ge=Math.min(j,ae);this._helper._farZ=1.01*(Math.cos(Math.PI/2-u)*ge+I),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const i=this.centerOffset,u=fe(this.worldSize,this.center),_=u.x,b=u.y;this._helper._pixelPerMeter=c.aj(1,this.center.lat)*this.worldSize;const S=c.ae(Math.min(this.pitch,le)),I=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(S));let O;this._calculateNearFarZIfNeeded(I,S,i),O=new Float64Array(16),c.b4(O,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),c.aq(this._invProjMatrix,O),O[8]=2*-i.x/this._helper._width,O[9]=2*i.y/this._helper._height,this._projectionMatrix=c.b5(O),c.N(O,O,[1,-1,1]),c.M(O,O,[0,0,-this._helper.cameraToCenterDistance]),c.b6(O,O,-this.rollInRadians),c.b7(O,O,this.pitchInRadians),c.b6(O,O,-this.bearingInRadians),c.M(O,O,[-_,-b,0]),this._mercatorMatrix=c.N([],O,[this.worldSize,this.worldSize,this.worldSize]),c.N(O,O,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=c.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,O),c.M(O,O,[0,0,-this.elevation]),this._viewProjMatrix=O,this._invViewProjMatrix=c.aq([],O);const N=[0,0,-1,1];c.aw(N,N,this._invViewProjMatrix),this._cameraPosition=[N[0]/N[3],N[1]/N[3],N[2]/N[3]],this._fogMatrix=new Float64Array(16),c.b4(this._fogMatrix,this.fovInRadians,this.width/this.height,I,this._helper._farZ),this._fogMatrix[8]=2*-i.x/this.width,this._fogMatrix[9]=2*i.y/this.height,c.N(this._fogMatrix,this._fogMatrix,[1,-1,1]),c.M(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),c.b6(this._fogMatrix,this._fogMatrix,-this.rollInRadians),c.b7(this._fogMatrix,this._fogMatrix,this.pitchInRadians),c.b6(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),c.M(this._fogMatrix,this._fogMatrix,[-_,-b,0]),c.N(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),c.M(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=c.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,O);const j=this._helper._width%2/2,G=this._helper._height%2/2,K=Math.cos(this.bearingInRadians),Z=Math.sin(-this.bearingInRadians),ee=_-Math.round(_)+K*j+Z*G,ae=b-Math.round(b)+K*G+Z*j,ge=new Float64Array(O);if(c.M(ge,ge,[ee>.5?ee-1:ee,ae>.5?ae-1:ae,0]),this._alignedProjMatrix=ge,O=c.aq(new Float64Array(16),this._pixelMatrix),!O)throw new Error("failed to invert matrix");this._pixelMatrixInverse=O,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const i=this.screenPointToMercatorCoordinate(new c.P(0,0)),u=[i.x*this.worldSize,i.y*this.worldSize,0,1];return c.aw(u,u,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const i=c.aj(1,this.center.lat)*this.worldSize;return tt(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/i).toLngLat()}lngLatToCameraDepth(i,u){const _=c.a1.fromLngLat(i),b=[_.x*this.worldSize,_.y*this.worldSize,u,1];return c.aw(b,b,this._viewProjMatrix),b[2]/b[3]}getProjectionData(i){const{overscaledTileID:u,aligned:_,applyTerrainMatrix:b}=i,S=this._helper.getMercatorTileCoordinates(u),I=u?this.calculatePosMatrix(u,_,!0):null;let O;return O=u&&u.terrainRttPosMatrix32f&&b?u.terrainRttPosMatrix32f:I||c.b8(),{mainMatrix:O,tileMercatorCoords:S,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:O}}isLocationOccluded(i){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(i,u,_){return 1}transformLightDirection(i){return c.aT(i)}getRayDirectionFromPixel(i){throw new Error("Not implemented.")}projectTileCoordinates(i,u,_,b){const S=this.calculatePosMatrix(_);let I;b?(I=[i,u,b(i,u),1],c.aw(I,I,S)):(I=[i,u,0,1],Hr(I,I,S));const O=I[3];return{point:new c.P(I[0]/O,I[1]/O),signedDistanceFromCamera:O,isOccluded:!1}}populateCache(i){for(const u of i)this.calculatePosMatrix(u)}getMatrixForModel(i,u){const _=c.a1.fromLngLat(i,u),b=_.meterInMercatorCoordinateUnits(),S=c.b9();return c.M(S,S,[_.x,_.y,_.z]),c.b6(S,S,Math.PI),c.b7(S,S,Math.PI/2),c.N(S,S,[-b,b,b]),S}getProjectionDataForCustomLayer(i=!0){const u=new c.Z(0,0,0,0,0),_=this.getProjectionData({overscaledTileID:u,applyGlobeMatrix:i}),b=He(u,this.worldSize);c.O(b,this._viewProjMatrix,b),_.tileMercatorCoords=[0,0,1,1];const S=[c.$,c.$,this.worldSize/this._helper.pixelsPerMeter],I=c.ba();return c.N(I,b,S),_.fallbackMatrix=I,_.mainMatrix=I,_}getFastPathSimpleProjectionMatrix(i){return this.calculatePosMatrix(i)}}function sl(){c.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function sr(T){if(T.useSlerp)if(T.k<1){const i=c.bb(T.startEulerAngles.roll,T.startEulerAngles.pitch,T.startEulerAngles.bearing),u=c.bb(T.endEulerAngles.roll,T.endEulerAngles.pitch,T.endEulerAngles.bearing),_=new Float64Array(4);c.bc(_,i,u,T.k);const b=c.bd(_);T.tr.setRoll(b.roll),T.tr.setPitch(b.pitch),T.tr.setBearing(b.bearing)}else T.tr.setRoll(T.endEulerAngles.roll),T.tr.setPitch(T.endEulerAngles.pitch),T.tr.setBearing(T.endEulerAngles.bearing);else T.tr.setRoll(c.C.number(T.startEulerAngles.roll,T.endEulerAngles.roll,T.k)),T.tr.setPitch(c.C.number(T.startEulerAngles.pitch,T.endEulerAngles.pitch,T.k)),T.tr.setBearing(c.C.number(T.startEulerAngles.bearing,T.endEulerAngles.bearing,T.k))}function cr(T,i,u,_,b){const S=b.padding,I=fe(b.worldSize,u.getNorthWest()),O=fe(b.worldSize,u.getNorthEast()),N=fe(b.worldSize,u.getSouthEast()),j=fe(b.worldSize,u.getSouthWest()),G=c.ae(-_),K=I.rotate(G),Z=O.rotate(G),ee=N.rotate(G),ae=j.rotate(G),ge=new c.P(Math.max(K.x,Z.x,ae.x,ee.x),Math.max(K.y,Z.y,ae.y,ee.y)),me=new c.P(Math.min(K.x,Z.x,ae.x,ee.x),Math.min(K.y,Z.y,ae.y,ee.y)),ve=ge.sub(me),we=(b.width-(S.left+S.right+i.left+i.right))/ve.x,Pe=(b.height-(S.top+S.bottom+i.top+i.bottom))/ve.y;if(Pe<0||we<0)return void sl();const Ce=Math.min(c.ak(b.scale*Math.min(we,Pe)),T.maxZoom),ze=c.P.convert(T.offset),Ve=new c.P((i.left-i.right)/2,(i.top-i.bottom)/2).rotate(c.ae(_)),Ie=ze.add(Ve).mult(b.scale/c.af(Ce));return{center:Se(b.worldSize,I.add(N).div(2).sub(Ie)),zoom:Ce,bearing:_}}class wr{get useGlobeControls(){return!1}handlePanInertia(i,u){return{easingOffset:i,easingCenter:u.center}}handleMapControlsRollPitchBearingZoom(i,u){i.bearingDelta&&u.setBearing(u.bearing+i.bearingDelta),i.pitchDelta&&u.setPitch(u.pitch+i.pitchDelta),i.rollDelta&&u.setRoll(u.roll+i.rollDelta),i.zoomDelta&&u.setZoom(u.zoom+i.zoomDelta)}handleMapControlsPan(i,u,_){i.around.distSqr(u.centerPoint)<.01||u.setLocationAtPoint(_,i.around)}cameraForBoxAndBearing(i,u,_,b,S){return cr(i,u,_,b,S)}handleJumpToCenterZoom(i,u){i.zoom!==(u.zoom!==void 0?+u.zoom:i.zoom)&&i.setZoom(+u.zoom),u.center!==void 0&&i.setCenter(c.S.convert(u.center))}handleEaseTo(i,u){const _=i.zoom,b=i.padding,S={roll:i.roll,pitch:i.pitch,bearing:i.bearing},I={roll:u.roll===void 0?i.roll:u.roll,pitch:u.pitch===void 0?i.pitch:u.pitch,bearing:u.bearing===void 0?i.bearing:u.bearing},O=u.zoom!==void 0,N=!i.isPaddingEqual(u.padding);let j=!1;const G=O?+u.zoom:i.zoom;let K=i.centerPoint.add(u.offsetAsPoint);const Z=i.screenPointToLocation(K),{center:ee,zoom:ae}=i.getConstrained(c.S.convert(u.center||Z),G??_);Pa(i,ee);const ge=fe(i.worldSize,Z),me=fe(i.worldSize,ee).sub(ge),ve=c.af(ae-_);return j=ae!==_,{easeFunc:we=>{if(j&&i.setZoom(c.C.number(_,ae,we)),c.be(S,I)||sr({startEulerAngles:S,endEulerAngles:I,tr:i,k:we,useSlerp:S.roll!=I.roll}),N&&(i.interpolatePadding(b,u.padding,we),K=i.centerPoint.add(u.offsetAsPoint)),u.around)i.setLocationAtPoint(u.around,u.aroundPoint);else{const Pe=c.af(i.zoom-_),Ce=ae>_?Math.min(2,ve):Math.max(.5,ve),ze=Math.pow(Ce,1-we),Ve=Se(i.worldSize,ge.add(me.mult(we*ze)).mult(Pe));i.setLocationAtPoint(i.renderWorldCopies?Ve.wrap():Ve,K)}},isZooming:j,elevationCenter:ee}}handleFlyTo(i,u){const _=u.zoom!==void 0,b=i.zoom,S=i.getConstrained(c.S.convert(u.center||u.locationAtOffset),_?+u.zoom:b),I=S.center,O=S.zoom;Pa(i,I);const N=fe(i.worldSize,u.locationAtOffset),j=fe(i.worldSize,I).sub(N),G=j.mag(),K=c.af(O-b);let Z;if(u.minZoom!==void 0){const ee=Math.min(+u.minZoom,b,O),ae=i.getConstrained(I,ee).zoom;Z=c.af(ae-b)}return{easeFunc:(ee,ae,ge,me)=>{i.setZoom(ee===1?O:b+c.ak(ae));const ve=ee===1?I:Se(i.worldSize,N.add(j.mult(ge)).mult(ae));i.setLocationAtPoint(i.renderWorldCopies?ve.wrap():ve,me)},scaleOfZoom:K,targetCenter:I,scaleOfMinZoom:Z,pixelPathLength:G}}}class bn{constructor(i,u,_){this.blendFunction=i,this.blendColor=u,this.mask=_}}bn.Replace=[1,0],bn.disabled=new bn(bn.Replace,c.bf.transparent,[!1,!1,!1,!1]),bn.unblended=new bn(bn.Replace,c.bf.transparent,[!0,!0,!0,!0]),bn.alphaBlended=new bn([1,771],c.bf.transparent,[!0,!0,!0,!0]);const pa=2305;class fn{constructor(i,u,_){this.enable=i,this.mode=u,this.frontFace=_}}fn.disabled=new fn(!1,1029,pa),fn.backCCW=new fn(!0,1029,pa),fn.frontCCW=new fn(!0,1028,pa);class sn{constructor(i,u,_){this.func=i,this.mask=u,this.range=_}}sn.ReadOnly=!1,sn.ReadWrite=!0,sn.disabled=new sn(519,sn.ReadOnly,[0,1]);const ia=7680;class $n{constructor(i,u,_,b,S,I){this.test=i,this.ref=u,this.mask=_,this.fail=b,this.depthFail=S,this.pass=I}}$n.disabled=new $n({func:519,mask:0},0,0,ia,ia,ia);const zr=new WeakMap;function Qr(T){var i;if(zr.has(T))return zr.get(T);{const u=(i=T.getParameter(T.VERSION))===null||i===void 0?void 0:i.startsWith("WebGL 2.0");return zr.set(T,u),u}}class or{get awaitingQuery(){return!!this._readbackQueue}constructor(i){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=i;const u=i.context,_=u.gl;this._texFormat=_.RGBA,this._texType=_.UNSIGNED_BYTE;const b=new c.aL;b.emplaceBack(-1,-1),b.emplaceBack(2,-1),b.emplaceBack(-1,2);const S=new c.aN;S.emplaceBack(0,1,2),this._fullscreenTriangle=new es(u.createVertexBuffer(b,ys.members),u.createIndexBuffer(S),c.aM.simpleSegment(0,0,b.length,S.length)),this._resultBuffer=new Uint8Array(4),u.activeTexture.set(_.TEXTURE1);const I=_.createTexture();_.bindTexture(_.TEXTURE_2D,I),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,_.CLAMP_TO_EDGE),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,_.CLAMP_TO_EDGE),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,_.NEAREST),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,_.NEAREST),_.texImage2D(_.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=u.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(I),Qr(_)&&(this._pbo=_.createBuffer(),_.bindBuffer(_.PIXEL_PACK_BUFFER,this._pbo),_.bufferData(_.PIXEL_PACK_BUFFER,4,_.STREAM_READ),_.bindBuffer(_.PIXEL_PACK_BUFFER,null))}destroy(){const i=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),i.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(i,u){const _=this._updateCount;return this._readbackQueue?_>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():_>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(i,u),this._updateCount++,this._measuredError}_bindFramebuffer(){const i=this._cachedRenderContext.context,u=i.gl;i.activeTexture.set(u.TEXTURE1),u.bindTexture(u.TEXTURE_2D,this._fbo.colorAttachment.get()),i.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(i,u){const _=this._cachedRenderContext.context,b=_.gl;if(this._bindFramebuffer(),_.viewport.set([0,0,this._texWidth,this._texHeight]),_.clear({color:c.bf.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(_,b.TRIANGLES,sn.disabled,$n.disabled,bn.unblended,fn.disabled,((S,I)=>({u_input:S,u_output_expected:I}))(i,u),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&Qr(b)){b.bindBuffer(b.PIXEL_PACK_BUFFER,this._pbo),b.readBuffer(b.COLOR_ATTACHMENT0),b.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),b.bindBuffer(b.PIXEL_PACK_BUFFER,null);const S=b.fenceSync(b.SYNC_GPU_COMMANDS_COMPLETE,0);b.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:S}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const i=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&Qr(i)){const u=i.clientWaitSync(this._readbackQueue.sync,0,0);if(u===i.WAIT_FAILED)return c.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(u===i.TIMEOUT_EXPIRED)return;i.bindBuffer(i.PIXEL_PACK_BUFFER,this._pbo),i.getBufferSubData(i.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),i.bindBuffer(i.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),i.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=or._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(i){let u=0;return u+=i[0]/256,u+=i[1]/65536,u+=i[2]/16777216,i[3]<127&&(u=-u),u/128}}const bs=c.$/128;function uo(T,i){const u=T.granularity!==void 0?Math.max(T.granularity,1):1,_=u+(T.generateBorders?2:0),b=u+(T.extendToNorthPole||T.generateBorders?1:0)+(T.extendToSouthPole||T.generateBorders?1:0),S=_+1,I=b+1,O=T.generateBorders?-1:0,N=T.generateBorders||T.extendToNorthPole?-1:0,j=u+(T.generateBorders?1:0),G=u+(T.generateBorders||T.extendToSouthPole?1:0),K=S*I,Z=_*b*6,ee=S*I>65536;if(ee&&i==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const ae=ee||i==="32bit",ge=new Int16Array(2*K);let me=0;for(let Pe=N;Pe<=G;Pe++)for(let Ce=O;Ce<=j;Ce++){let ze=Ce/u*c.$;Ce===-1&&(ze=-bs),Ce===u+1&&(ze=c.$+bs);let Ve=Pe/u*c.$;Pe===-1&&(Ve=T.extendToNorthPole?c.bh:-bs),Pe===u+1&&(Ve=T.extendToSouthPole?c.bi:c.$+bs),ge[me++]=ze,ge[me++]=Ve}const ve=ae?new Uint32Array(Z):new Uint16Array(Z);let we=0;for(let Pe=0;Pe<b;Pe++)for(let Ce=0;Ce<_;Ce++){const ze=Ce+1+Pe*S,Ve=Ce+(Pe+1)*S,Ie=Ce+1+(Pe+1)*S;ve[we++]=Ce+Pe*S,ve[we++]=Ve,ve[we++]=ze,ve[we++]=ze,ve[we++]=Ve,ve[we++]=Ie}return{vertices:ge.buffer.slice(0),indices:ve.buffer.slice(0),uses32bitIndices:ae}}const xs=new c.aK({fill:new c.bj(128,2),line:new c.bj(512,0),tile:new c.bj(128,32),stencil:new c.bj(128,1),circle:3});class Wn{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return Zi.projectionGlobe}get vertexShaderPreludeCode(){return Zi.projectionMercator.vertexSource}get subdivisionGranularity(){return xs}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(i){this._errorMeasurement||(this._errorMeasurement=new or(i));const u=c.U(this._errorQueryLatitudeDegrees),_=2*Math.atan(Math.exp(Math.PI-u*Math.PI*2))-.5*Math.PI,b=this._errorMeasurement.updateErrorLoop(u,_),S=J.now();b!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=b,this._errorMeasurementLastChangeTime=S);const I=Math.min(Math.max((S-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=c.bk(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,c.bl(I))}_getMeshKey(i){return`${i.granularity.toString(36)}_${i.generateBorders?"b":""}${i.extendToNorthPole?"n":""}${i.extendToSouthPole?"s":""}`}getMeshFromTileID(i,u,_,b,S){const I=(S==="stencil"?xs.stencil:xs.tile).getGranularityForZoomLevel(u.z);return this._getMesh(i,{granularity:I,generateBorders:_,extendToNorthPole:u.y===0&&b,extendToSouthPole:u.y===(1<<u.z)-1&&b})}_getMesh(i,u){const _=this._getMeshKey(u);if(_ in this._tileMeshCache)return this._tileMeshCache[_];const b=(function(S,I){const O=uo(I,"16bit"),N=c.aL.deserialize({arrayBuffer:O.vertices,length:O.vertices.byteLength/2/2}),j=c.aN.deserialize({arrayBuffer:O.indices,length:O.indices.byteLength/2/3});return new es(S.createVertexBuffer(N,ys.members),S.createIndexBuffer(j),c.aM.simpleSegment(0,0,N.length,j.length))})(i,u);return this._tileMeshCache[_]=b,b}recalculate(i){}hasTransition(){const i=J.now();let u=!1;return u=u||(i-this._errorMeasurementLastChangeTime)/1e3<.7,u=u||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,u}setErrorQueryLatitudeDegrees(i){this._errorQueryLatitudeDegrees=i}}const Mo=new c.r({type:new c.D(c.v.projection.type)});class ra extends c.E{constructor(i){super(),this._transitionable=new c.t(Mo),this.setProjection(i),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new c.F(0)),this._mercatorProjection=new kn,this._verticalPerspectiveProjection=new Wn}get transitionState(){const i=this.properties.get("type");if(typeof i=="string"&&i==="mercator")return 0;if(typeof i=="string"&&i==="vertical-perspective")return 1;if(i instanceof c.bm){if(i.from==="vertical-perspective"&&i.to==="mercator")return 1-i.transition;if(i.from==="mercator"&&i.to==="vertical-perspective")return i.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(i){this._mercatorProjection.updateGPUdependent(i),this._verticalPerspectiveProjection.updateGPUdependent(i)}getMeshFromTileID(i,u,_,b,S){return this.currentProjection.getMeshFromTileID(i,u,_,b,S)}setProjection(i){this._transitionable.setValue("type",(i==null?void 0:i.type)||"mercator")}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}setErrorQueryLatitudeDegrees(i){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(i),this._mercatorProjection.setErrorQueryLatitudeDegrees(i)}}function Ma(T){const i=ws(T.worldSize,T.center.lat);return 2*Math.PI*i}function Ra(T,i,u,_,b){const S=1/(1<<b),I=i/c.$*S+_*S,O=c.bo((T/c.$*S+u*S)*Math.PI*2+Math.PI,2*Math.PI),N=2*Math.atan(Math.exp(Math.PI-I*Math.PI*2))-.5*Math.PI,j=Math.cos(N),G=new Float64Array(3);return G[0]=Math.sin(O)*j,G[1]=Math.sin(N),G[2]=Math.cos(O)*j,G}function Or(T){return(function(i,u){const _=Math.cos(u),b=new Float64Array(3);return b[0]=Math.sin(i)*_,b[1]=Math.sin(u),b[2]=Math.cos(i)*_,b})(T.lng*Math.PI/180,T.lat*Math.PI/180)}function ws(T,i){return T/(2*Math.PI)/Math.cos(i*Math.PI/180)}function Zl(T){const i=Math.asin(T[1])/Math.PI*180,u=Math.sqrt(T[0]*T[0]+T[2]*T[2]);if(u>1e-6){const _=T[0]/u,b=Math.acos(T[2]/u),S=(_>0?b:-b)/Math.PI*180;return new c.S(c.aO(S,-180,180),i)}return new c.S(0,i)}function Ro(T){return Math.cos(T*Math.PI/180)}function Ki(T,i){const u=Ro(T),_=Ro(i);return c.ak(_/u)}function Zu(T,i){const u=T.rotate(i.bearingInRadians),_=i.zoom+Ki(i.center.lat,0),b=c.bk(1/Ro(i.center.lat),1/Ro(Math.min(Math.abs(i.center.lat),60)),c.bn(_,7,3,0,1)),S=360/Ma({worldSize:i.worldSize,center:{lat:i.center.lat}});return new c.S(i.center.lng-u.x*S*b,c.ah(i.center.lat+u.y*S,-c.ai,c.ai))}function ol(T){const i=.5*T,u=Math.sin(i),_=Math.cos(i);return Math.log(u+_)-Math.log(_-u)}function Wl(T,i,u,_){const b=T.lat+u*_;if(Math.abs(u)>1){const S=(Math.sign(T.lat+u)!==Math.sign(T.lat)?-Math.abs(T.lat):Math.abs(T.lat))*Math.PI/180,I=Math.abs(T.lat+u)*Math.PI/180,O=ol(S+_*(I-S)),N=ol(S),j=ol(I);return new c.S(T.lng+i*((O-N)/(j-N)),b)}return new c.S(T.lng+i*_,b)}class Ws{constructor(i){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=i}swapBuffers(){if(!this._hadAnyChanges)return;const i=this._cachePrevious;this._cachePrevious=this._cache,this._cache=i,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(i,u,_,b){const S=`${i.z}_${i.x}_${i.y}_${b!=null&&b.terrain?"t":""}`,I=this._cache.get(S);if(I)return I;const O=this._cachePrevious.get(S);if(O)return this._cache.set(S,O),O;const N=this._boundingVolumeFactory(i,u,_,b);return this._cache.set(S,N),this._hadAnyChanges=!0,N}}class Ol{constructor(i,u,_,b){this.min=_,this.max=b,this.points=i,this.planes=u}static fromAabb(i,u){const _=[];for(let b=0;b<8;b++)_.push([1&~b?i[0]:u[0],(b>>1&1)==1?u[1]:i[1],(b>>2&1)==1?u[2]:i[2]]);return new Ol(_,[[-1,0,0,u[0]],[1,0,0,-i[0]],[0,-1,0,u[1]],[0,1,0,-i[1]],[0,0,-1,u[2]],[0,0,1,-i[2]]],i,u)}static fromCenterSizeAngles(i,u,_){const b=c.br([],_[0],_[1],_[2]),S=c.bs([],[u[0],0,0],b),I=c.bs([],[0,u[1],0],b),O=c.bs([],[0,0,u[2]],b),N=[...i],j=[...i];for(let K=0;K<8;K++)for(let Z=0;Z<3;Z++){const ee=i[Z]+S[Z]*(1&~K?-1:1)+I[Z]*((K>>1&1)==1?1:-1)+O[Z]*((K>>2&1)==1?1:-1);N[Z]=Math.min(N[Z],ee),j[Z]=Math.max(j[Z],ee)}const G=[];for(let K=0;K<8;K++){const Z=[...i];c.aS(Z,Z,c.aR([],S,1&~K?-1:1)),c.aS(Z,Z,c.aR([],I,(K>>1&1)==1?1:-1)),c.aS(Z,Z,c.aR([],O,(K>>2&1)==1?1:-1)),G.push(Z)}return new Ol(G,[[...S,-c.aX(S,G[0])],[...I,-c.aX(I,G[0])],[...O,-c.aX(O,G[0])],[-S[0],-S[1],-S[2],-c.aX(S,G[7])],[-I[0],-I[1],-I[2],-c.aX(I,G[7])],[-O[0],-O[1],-O[2],-c.aX(O,G[7])]],N,j)}intersectsFrustum(i){let u=!0;const _=this.points.length,b=this.planes.length,S=i.planes.length,I=i.points.length;for(let O=0;O<S;O++){const N=i.planes[O];let j=0;for(let G=0;G<_;G++){const K=this.points[G];N[0]*K[0]+N[1]*K[1]+N[2]*K[2]+N[3]>=0&&j++}if(j===0)return 0;j<_&&(u=!1)}if(u)return 2;for(let O=0;O<b;O++){const N=this.planes[O];let j=0;for(let G=0;G<I;G++){const K=i.points[G];N[0]*K[0]+N[1]*K[1]+N[2]*K[2]+N[3]>=0&&j++}if(j===0)return 0}return 1}intersectsPlane(i){const u=this.points.length;let _=0;for(let b=0;b<u;b++){const S=this.points[b];i[0]*S[0]+i[1]*S[1]+i[2]*S[2]+i[3]>=0&&_++}return _===u?2:_===0?0:1}}function lr(T,i,u){const _=T-i;return _<0?-_:Math.max(0,_-u)}function ts(T,i,u,_,b){const S=T-u;let I;return I=S<0?Math.min(-S,1+S-b):S>1?Math.min(Math.max(S-b,0),1-S):0,Math.max(I,lr(i,_,b))}class Ts{constructor(){this._boundingVolumeCache=new Ws(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(i,u,_,b){const S=1<<_.z,I=1/S,O=_.x/S,N=_.y/S;let j=2;return j=Math.min(j,ts(i,u,O,N,I)),j=Math.min(j,ts(i,u,O+.5,-N-I,I)),j=Math.min(j,ts(i,u,O+.5,2-N-I,I)),j}getWrap(i,u,_){const b=1<<u.z,S=1/b,I=u.x/b,O=lr(i.x,I,S),N=lr(i.x,I-1,S),j=lr(i.x,I+1,S),G=Math.min(O,N,j);return G===j?1:G===N?-1:0}allowVariableZoom(i,u){return tn(i,u)>4}allowWorldCopies(){return!1}getTileBoundingVolume(i,u,_,b){return this._boundingVolumeCache.getTileBoundingVolume(i,u,_,b)}_computeTileBoundingVolume(i,u,_,b){var S,I;let O=0,N=0;if(b!=null&&b.terrain){const j=new c.Z(i.z,u,i.z,i.x,i.y),G=b.terrain.getMinMaxElevation(j);O=(S=G.minElevation)!==null&&S!==void 0?S:Math.min(0,_),N=(I=G.maxElevation)!==null&&I!==void 0?I:Math.max(0,_)}if(O/=c.bu,N/=c.bu,O+=1,N+=1,i.z<=0)return Ol.fromAabb([-N,-N,-N],[N,N,N]);if(i.z===1)return Ol.fromAabb([i.x===0?-N:0,i.y===0?0:-N,-N],[i.x===0?0:N,i.y===0?N:0,N]);{const j=[Ra(0,0,i.x,i.y,i.z),Ra(c.$,0,i.x,i.y,i.z),Ra(c.$,c.$,i.x,i.y,i.z),Ra(0,c.$,i.x,i.y,i.z)],G=[];for(const st of j)G.push(c.aR([],st,N));if(N!==O)for(const st of j)G.push(c.aR([],st,O));i.y===0&&G.push([0,1,0]),i.y===(1<<i.z)-1&&G.push([0,-1,0]);const K=[1,1,1],Z=[-1,-1,-1];for(const st of G)for(let lt=0;lt<3;lt++)K[lt]=Math.min(K[lt],st[lt]),Z[lt]=Math.max(Z[lt],st[lt]);const ee=Ra(c.$/2,c.$/2,i.x,i.y,i.z),ae=c.aW([],[0,1,0],ee);c.aV(ae,ae);const ge=c.aW([],ee,ae);c.aV(ge,ge);const me=c.aW([],j[2],j[1]);c.aV(me,me);const ve=c.aW([],j[0],j[3]);c.aV(ve,ve),G.push(c.aR([],ee,N)),i.y>=(1<<i.z)/2&&G.push(c.aR([],Ra(c.$/2,0,i.x,i.y,i.z),N)),i.y<(1<<i.z)/2&&G.push(c.aR([],Ra(c.$/2,c.$,i.x,i.y,i.z),N));const we=Nl(ee,G),Pe=Nl(ge,G),Ce=[-ee[0],-ee[1],-ee[2],we.max],ze=[ee[0],ee[1],ee[2],-we.min],Ve=[-ge[0],-ge[1],-ge[2],Pe.max],Ie=[ge[0],ge[1],ge[2],-Pe.min],Ye=[...me,0],ct=[...ve,0],rt=[];return i.y===0?rt.push(c.bt(ct,Ye,Ce),c.bt(ct,Ye,ze)):rt.push(c.bt(Ve,Ye,Ce),c.bt(Ve,Ye,ze),c.bt(Ve,ct,Ce),c.bt(Ve,ct,ze)),i.y===(1<<i.z)-1?rt.push(c.bt(ct,Ye,Ce),c.bt(ct,Ye,ze)):rt.push(c.bt(Ie,Ye,Ce),c.bt(Ie,Ye,ze),c.bt(Ie,ct,Ce),c.bt(Ie,ct,ze)),new Ol(rt,[Ce,ze,Ve,Ie,Ye,ct],K,Z)}}}function Nl(T,i){let u=1/0,_=-1/0;for(const b of i){const S=c.aX(T,b);u=Math.min(u,S),_=Math.max(_,S)}return{min:u,max:_}}class ll{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(i){this._helper.setMinZoom(i)}setMaxZoom(i){this._helper.setMaxZoom(i)}setMinPitch(i){this._helper.setMinPitch(i)}setMaxPitch(i){this._helper.setMaxPitch(i)}setRenderWorldCopies(i){this._helper.setRenderWorldCopies(i)}setBearing(i){this._helper.setBearing(i)}setPitch(i){this._helper.setPitch(i)}setRoll(i){this._helper.setRoll(i)}setFov(i){this._helper.setFov(i)}setZoom(i){this._helper.setZoom(i)}setCenter(i){this._helper.setCenter(i)}setElevation(i){this._helper.setElevation(i)}setMinElevationForCurrentTile(i){this._helper.setMinElevationForCurrentTile(i)}setPadding(i){this._helper.setPadding(i)}interpolatePadding(i,u,_){return this._helper.interpolatePadding(i,u,_)}isPaddingEqual(i){return this._helper.isPaddingEqual(i)}resize(i,u){this._helper.resize(i,u)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(i){this._helper.setMaxBounds(i)}overrideNearFarZ(i,u){this._helper.overrideNearFarZ(i,u)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(i){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),i)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(i){}constructor(){this._cachedClippingPlane=c.bv(),this._projectionMatrix=c.b9(),this._globeViewProjMatrix32f=c.b8(),this._globeViewProjMatrixNoCorrection=c.b9(),this._globeViewProjMatrixNoCorrectionInverted=c.b9(),this._globeProjMatrixInverted=c.b9(),this._cameraPosition=c.bp(),this._globeLatitudeErrorCorrectionRadians=0,this._helper=new Wi({calcMatrices:()=>{this._calcMatrices()},getConstrained:(i,u)=>this.getConstrained(i,u)}),this._coveringTilesDetailsProvider=new Ts}clone(){const i=new ll;return i.apply(this),i}apply(i,u){this._globeLatitudeErrorCorrectionRadians=u||0,this._helper.apply(i)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const i=c.bp();return i[0]=this._cameraPosition[0],i[1]=this._cameraPosition[1],i[2]=this._cameraPosition[2],i}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(i){const{overscaledTileID:u,applyGlobeMatrix:_}=i,b=this._helper.getMercatorTileCoordinates(u);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:b,clippingPlane:this._cachedClippingPlane,projectionTransition:_?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(i){const u=this.pitchInRadians,_=this.cameraToCenterDistance/i,b=Math.sin(u)*_,S=Math.cos(u)*_+1,I=1/Math.sqrt(b*b+S*S)*1;let O=-b,N=S;const j=Math.sqrt(O*O+N*N);O/=j,N/=j;const G=[0,O,N];c.bw(G,G,[0,0,0],-this.bearingInRadians),c.bx(G,G,[0,0,0],-1*this.center.lat*Math.PI/180),c.by(G,G,[0,0,0],this.center.lng*Math.PI/180);const K=1/c.aZ(G);return c.aR(G,G,K),[...G,-I*K]}isLocationOccluded(i){return!this.isSurfacePointVisible(Or(i))}transformLightDirection(i){const u=this._helper._center.lng*Math.PI/180,_=this._helper._center.lat*Math.PI/180,b=Math.cos(_),S=[Math.sin(u)*b,Math.sin(_),Math.cos(u)*b],I=[S[2],0,-S[0]],O=[0,0,0];c.aW(O,I,S),c.aV(I,I),c.aV(O,O);const N=[0,0,0];return c.aV(N,[I[0]*i[0]+O[0]*i[1]+S[0]*i[2],I[1]*i[0]+O[1]*i[1]+S[1]*i[2],I[2]*i[0]+O[2]*i[1]+S[2]*i[2]]),N}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(i,u,_){const b=(function(O,N,j){const G=1/(1<<j.z);return new c.a1(O/c.$*G+j.x*G,N/c.$*G+j.y*G)})(i,u,_.canonical),S=(I=b.y,[c.bo(b.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-I*Math.PI*2))-.5*Math.PI]);var I;return this.getCircleRadiusCorrection()/Math.cos(S[1])}projectTileCoordinates(i,u,_,b){const S=_.canonical,I=Ra(i,u,S.x,S.y,S.z),O=1+(b?b(i,u):0)/c.bu,N=[I[0]*O,I[1]*O,I[2]*O,1];c.aw(N,N,this._globeViewProjMatrixNoCorrection);const j=this._cachedClippingPlane,G=j[0]*I[0]+j[1]*I[1]+j[2]*I[2]+j[3]<0;return{point:new c.P(N[0]/N[3],N[1]/N[3]),signedDistanceFromCamera:N[3],isOccluded:G}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const i=ws(this.worldSize,this.center.lat),u=c.ba(),_=c.ba();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*i),c.b4(u,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const b=this.centerOffset;u[8]=2*-b.x/this._helper._width,u[9]=2*b.y/this._helper._height,this._projectionMatrix=c.b5(u),this._globeProjMatrixInverted=c.ba(),c.aq(this._globeProjMatrixInverted,u),c.M(u,u,[0,0,-this.cameraToCenterDistance]),c.b6(u,u,this.rollInRadians),c.b7(u,u,-this.pitchInRadians),c.b6(u,u,this.bearingInRadians),c.M(u,u,[0,0,-i]);const S=c.bp();S[0]=i,S[1]=i,S[2]=i,c.b7(_,u,this.center.lat*Math.PI/180),c.bz(_,_,-this.center.lng*Math.PI/180),c.N(_,_,S),this._globeViewProjMatrixNoCorrection=_,c.b7(u,u,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),c.bz(u,u,-this.center.lng*Math.PI/180),c.N(u,u,S),this._globeViewProjMatrix32f=new Float32Array(u),this._globeViewProjMatrixNoCorrectionInverted=c.ba(),c.aq(this._globeViewProjMatrixNoCorrectionInverted,_);const I=c.bp();this._cameraPosition=c.bp(),this._cameraPosition[2]=this.cameraToCenterDistance/i,c.bw(this._cameraPosition,this._cameraPosition,I,-this.rollInRadians),c.bx(this._cameraPosition,this._cameraPosition,I,this.pitchInRadians),c.bw(this._cameraPosition,this._cameraPosition,I,-this.bearingInRadians),c.aS(this._cameraPosition,this._cameraPosition,[0,0,1]),c.bx(this._cameraPosition,this._cameraPosition,I,-this.center.lat*Math.PI/180),c.by(this._cameraPosition,this._cameraPosition,I,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(i);const O=c.b5(this._globeViewProjMatrixNoCorrectionInverted);c.N(O,O,[1,1,-1]),this._cachedFrustum=pi.fromInvProjectionMatrix(O,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(i){c.w("calculateFogMatrix is not supported on globe projection.");const u=c.ba();return c.ag(u),u}getVisibleUnwrappedCoordinates(i){return[new c.b2(0,i)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(i){i&&c.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(i,u){if(!this._globeViewProjMatrixNoCorrection)return 1;const _=Or(i);c.aR(_,_,1+u/c.bu);const b=c.bv();return c.aw(b,[_[0],_[1],_[2],1],this._globeViewProjMatrixNoCorrection),b[2]/b[3]}populateCache(i){}getBounds(){const i=.5*this.width,u=.5*this.height,_=[new c.P(0,0),new c.P(i,0),new c.P(this.width,0),new c.P(this.width,u),new c.P(this.width,this.height),new c.P(i,this.height),new c.P(0,this.height),new c.P(0,u)],b=[];for(const K of _)b.push(this.unprojectScreenPoint(K));let S=0,I=0,O=0,N=0;const j=this.center;for(const K of b){const Z=c.bA(j.lng,K.lng),ee=c.bA(j.lat,K.lat);Z<I&&(I=Z),Z>S&&(S=Z),ee<N&&(N=ee),ee>O&&(O=ee)}const G=[j.lng+I,j.lat+N,j.lng+S,j.lat+O];return this.isSurfacePointOnScreen([0,1,0])&&(G[3]=90,G[0]=-180,G[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(G[1]=-90,G[0]=-180,G[2]=180),new Fi(G)}getConstrained(i,u){const _=c.ah(i.lat,-c.ai,c.ai),b=c.ah(+u,this.minZoom+Ki(0,_),this.maxZoom);return{center:new c.S(i.lng,_),zoom:b}}calculateCenterFromCameraLngLatAlt(i,u,_,b){return this._helper.calculateCenterFromCameraLngLatAlt(i,u,_,b)}setLocationAtPoint(i,u){const _=Or(this.unprojectScreenPoint(u)),b=Or(i),S=c.bp();c.bB(S);const I=c.bp();c.by(I,_,S,-this.center.lng*Math.PI/180),c.bx(I,I,S,this.center.lat*Math.PI/180);const O=b[0]*b[0]+b[2]*b[2],N=I[0]*I[0];if(O<N)return;const j=Math.sqrt(O-N),G=-j,K=c.bC(b[0],b[2],I[0],j),Z=c.bC(b[0],b[2],I[0],G),ee=c.bp();c.by(ee,b,S,-K);const ae=c.bC(ee[1],ee[2],I[1],I[2]),ge=c.bp();c.by(ge,b,S,-Z);const me=c.bC(ge[1],ge[2],I[1],I[2]),ve=.5*Math.PI,we=ae>=-ve&&ae<=ve,Pe=me>=-ve&&me<=ve;let Ce,ze;if(we&&Pe){const ct=this.center.lng*Math.PI/180,rt=this.center.lat*Math.PI/180;c.bD(K,ct)+c.bD(ae,rt)<c.bD(Z,ct)+c.bD(me,rt)?(Ce=K,ze=ae):(Ce=Z,ze=me)}else if(we)Ce=K,ze=ae;else{if(!Pe)return;Ce=Z,ze=me}const Ve=Ce/Math.PI*180,Ie=ze/Math.PI*180,Ye=this.center.lat;this.setCenter(new c.S(Ve,c.ah(Ie,-90,90))),this.setZoom(this.zoom+Ki(Ye,this.center.lat))}locationToScreenPoint(i,u){const _=Or(i);if(u){const b=u.getElevationForLngLatZoom(i,this._helper._tileZoom);c.aR(_,_,1+b/c.bu)}return this._projectSurfacePointToScreen(_)}_projectSurfacePointToScreen(i){const u=c.bv();return c.aw(u,[...i,1],this._globeViewProjMatrixNoCorrection),u[0]/=u[3],u[1]/=u[3],new c.P((.5*u[0]+.5)*this.width,(.5*-u[1]+.5)*this.height)}screenPointToMercatorCoordinate(i,u){if(u){const _=u.pointCoordinate(i);if(_)return _}return c.a1.fromLngLat(this.unprojectScreenPoint(i))}screenPointToLocation(i,u){var _;return(_=this.screenPointToMercatorCoordinate(i,u))===null||_===void 0?void 0:_.toLngLat()}isPointOnMapSurface(i,u){const _=this._cameraPosition,b=this.getRayDirectionFromPixel(i);return!!this.rayPlanetIntersection(_,b)}getRayDirectionFromPixel(i){const u=c.bv();u[0]=i.x/this.width*2-1,u[1]=-1*(i.y/this.height*2-1),u[2]=1,u[3]=1,c.aw(u,u,this._globeViewProjMatrixNoCorrectionInverted),u[0]/=u[3],u[1]/=u[3],u[2]/=u[3];const _=c.bp();_[0]=u[0]-this._cameraPosition[0],_[1]=u[1]-this._cameraPosition[1],_[2]=u[2]-this._cameraPosition[2];const b=c.bp();return c.aV(b,_),b}isSurfacePointVisible(i){const u=this._cachedClippingPlane;return u[0]*i[0]+u[1]*i[1]+u[2]*i[2]+u[3]>=0}isSurfacePointOnScreen(i){if(!this.isSurfacePointVisible(i))return!1;const u=c.bv();return c.aw(u,[...i,1],this._globeViewProjMatrixNoCorrection),u[0]/=u[3],u[1]/=u[3],u[2]/=u[3],u[0]>-1&&u[0]<1&&u[1]>-1&&u[1]<1&&u[2]>-1&&u[2]<1}rayPlanetIntersection(i,u){const _=c.aX(i,u),b=c.bp(),S=c.bp();c.aR(S,u,_),c.aU(b,i,S);const I=1-c.aX(b,b);if(I<0)return null;const O=c.aX(i,i)-1,N=-_+(_<0?1:-1)*Math.sqrt(I),j=O/N,G=N;return{tMin:Math.min(j,G),tMax:Math.max(j,G)}}unprojectScreenPoint(i){const u=this._cameraPosition,_=this.getRayDirectionFromPixel(i),b=this.rayPlanetIntersection(u,_);if(b){const G=c.bp();c.aS(G,u,[_[0]*b.tMin,_[1]*b.tMin,_[2]*b.tMin]);const K=c.bp();return c.aV(K,G),Zl(K)}const S=this._cachedClippingPlane,I=S[0]*_[0]+S[1]*_[1]+S[2]*_[2],O=-c.b1(S,u)/I,N=c.bp();if(O>0)c.aS(N,u,[_[0]*O,_[1]*O,_[2]*O]);else{const G=c.bp();c.aS(G,u,[2*_[0],2*_[1],2*_[2]]);const K=c.b1(this._cachedClippingPlane,G);c.aU(N,G,[this._cachedClippingPlane[0]*K,this._cachedClippingPlane[1]*K,this._cachedClippingPlane[2]*K])}const j=(function(G){const K=c.bp();return K[0]=G[0]*-G[3],K[1]=G[1]*-G[3],K[2]=G[2]*-G[3],{center:K,radius:Math.sqrt(1-G[3]*G[3])}})(S);return Zl((function(G,K,Z){const ee=c.bp();c.aU(ee,Z,G);const ae=c.bp();return c.bq(ae,G,ee,K/c.a$(ee)),ae})(j.center,j.radius,N))}getMatrixForModel(i,u){const _=c.S.convert(i),b=1/c.bu,S=c.b9();return c.bz(S,S,_.lng/180*Math.PI),c.b7(S,S,-_.lat/180*Math.PI),c.M(S,S,[0,0,1+u/c.bu]),c.b7(S,S,.5*Math.PI),c.N(S,S,[b,b,b]),S}getProjectionDataForCustomLayer(i=!0){const u=this.getProjectionData({overscaledTileID:new c.Z(0,0,0,0,0),applyGlobeMatrix:i});return u.tileMercatorCoords=[0,0,1,1],u}getFastPathSimpleProjectionMatrix(i){}}class co{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(i){this._helper.setMinZoom(i)}setMaxZoom(i){this._helper.setMaxZoom(i)}setMinPitch(i){this._helper.setMinPitch(i)}setMaxPitch(i){this._helper.setMaxPitch(i)}setRenderWorldCopies(i){this._helper.setRenderWorldCopies(i)}setBearing(i){this._helper.setBearing(i)}setPitch(i){this._helper.setPitch(i)}setRoll(i){this._helper.setRoll(i)}setFov(i){this._helper.setFov(i)}setZoom(i){this._helper.setZoom(i)}setCenter(i){this._helper.setCenter(i)}setElevation(i){this._helper.setElevation(i)}setMinElevationForCurrentTile(i){this._helper.setMinElevationForCurrentTile(i)}setPadding(i){this._helper.setPadding(i)}interpolatePadding(i,u,_){return this._helper.interpolatePadding(i,u,_)}isPaddingEqual(i){return this._helper.isPaddingEqual(i)}resize(i,u,_=!0){this._helper.resize(i,u,_)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(i){this._helper.setMaxBounds(i)}overrideNearFarZ(i,u){this._helper.overrideNearFarZ(i,u)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(i){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),i)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(i,u){this._globeness=i,this._globeLatitudeErrorCorrectionRadians=u,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this._helper=new Wi({calcMatrices:()=>{this._calcMatrices()},getConstrained:(i,u)=>this.getConstrained(i,u)}),this._globeness=1,this._mercatorTransform=new xn,this._verticalPerspectiveTransform=new ll}clone(){const i=new co;return i._globeness=this._globeness,i._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,i.apply(this),i}apply(i){this._helper.apply(i),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(i){const u=this._mercatorTransform.getProjectionData(i),_=this._verticalPerspectiveTransform.getProjectionData(i);return{mainMatrix:this.isGlobeRendering?_.mainMatrix:u.mainMatrix,clippingPlane:_.clippingPlane,tileMercatorCoords:_.tileMercatorCoords,projectionTransition:i.applyGlobeMatrix?this._globeness:0,fallbackMatrix:u.fallbackMatrix}}isLocationOccluded(i){return this.currentTransform.isLocationOccluded(i)}transformLightDirection(i){return this.currentTransform.transformLightDirection(i)}getPixelScale(){return c.bk(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return c.bk(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(i,u,_){const b=this._mercatorTransform.getPitchedTextCorrection(i,u,_),S=this._verticalPerspectiveTransform.getPitchedTextCorrection(i,u,_);return c.bk(b,S,this._globeness)}projectTileCoordinates(i,u,_,b){return this.currentTransform.projectTileCoordinates(i,u,_,b)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(i){return this.currentTransform.calculateFogMatrix(i)}getVisibleUnwrappedCoordinates(i){return this.currentTransform.getVisibleUnwrappedCoordinates(i)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(i){this._mercatorTransform.recalculateZoomAndCenter(i),this._verticalPerspectiveTransform.recalculateZoomAndCenter(i)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(i,u){return this.currentTransform.lngLatToCameraDepth(i,u)}populateCache(i){this._mercatorTransform.populateCache(i),this._verticalPerspectiveTransform.populateCache(i)}getBounds(){return this.currentTransform.getBounds()}getConstrained(i,u){return this.currentTransform.getConstrained(i,u)}calculateCenterFromCameraLngLatAlt(i,u,_,b){return this._helper.calculateCenterFromCameraLngLatAlt(i,u,_,b)}setLocationAtPoint(i,u){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(i,u),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(i,u),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(i,u){return this.currentTransform.locationToScreenPoint(i,u)}screenPointToMercatorCoordinate(i,u){return this.currentTransform.screenPointToMercatorCoordinate(i,u)}screenPointToLocation(i,u){return this.currentTransform.screenPointToLocation(i,u)}isPointOnMapSurface(i,u){return this.currentTransform.isPointOnMapSurface(i,u)}getRayDirectionFromPixel(i){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(i)}getMatrixForModel(i,u){return this.currentTransform.getMatrixForModel(i,u)}getProjectionDataForCustomLayer(i=!0){const u=this._mercatorTransform.getProjectionDataForCustomLayer(i);if(!this.isGlobeRendering)return u;const _=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(i);return _.fallbackMatrix=u.mainMatrix,_}getFastPathSimpleProjectionMatrix(i){return this.currentTransform.getFastPathSimpleProjectionMatrix(i)}}class Ai{get useGlobeControls(){return!0}handlePanInertia(i,u){const _=Zu(i,u);return Math.abs(_.lng-u.center.lng)>180&&(_.lng=u.center.lng+179.5*Math.sign(_.lng-u.center.lng)),{easingCenter:_,easingOffset:new c.P(0,0)}}handleMapControlsRollPitchBearingZoom(i,u){const _=i.around,b=u.screenPointToLocation(_);i.bearingDelta&&u.setBearing(u.bearing+i.bearingDelta),i.pitchDelta&&u.setPitch(u.pitch+i.pitchDelta),i.rollDelta&&u.setRoll(u.roll+i.rollDelta);const S=u.zoom;i.zoomDelta&&u.setZoom(u.zoom+i.zoomDelta);const I=u.zoom-S;if(I===0)return;const O=c.bA(u.center.lng,b.lng),N=O/(Math.abs(O/180)+1),j=c.bA(u.center.lat,b.lat),G=u.getRayDirectionFromPixel(_),K=u.cameraPosition,Z=-1*c.aX(K,G),ee=c.bp();c.aS(ee,K,[G[0]*Z,G[1]*Z,G[2]*Z]);const ae=c.aZ(ee)-1,ge=Math.exp(.5*-Math.max(ae-.3,0)),me=ws(u.worldSize,u.center.lat)/Math.min(u.width,u.height),ve=c.bn(me,.9,.5,1,.25),we=(1-c.af(-I))*Math.min(ge,ve),Pe=u.center.lat,Ce=u.zoom,ze=new c.S(u.center.lng+N*we,c.ah(u.center.lat+j*we,-c.ai,c.ai));u.setLocationAtPoint(b,_);const Ve=u.center,Ie=c.bn(Math.abs(O),45,85,0,1),Ye=c.bn(me,.75,.35,0,1),ct=Math.pow(Math.max(Ie,Ye),.25),rt=c.bA(Ve.lng,ze.lng),st=c.bA(Ve.lat,ze.lat);u.setCenter(new c.S(Ve.lng+rt*ct,Ve.lat+st*ct).wrap()),u.setZoom(Ce+Ki(Pe,u.center.lat))}handleMapControlsPan(i,u,_){if(!i.panDelta)return;const b=u.center.lat,S=u.zoom;u.setCenter(Zu(i.panDelta,u).wrap()),u.setZoom(S+Ki(b,u.center.lat))}cameraForBoxAndBearing(i,u,_,b,S){const I=cr(i,u,_,b,S),O=u.left/S.width*2-1,N=(S.width-u.right)/S.width*2-1,j=u.top/S.height*-2+1,G=(S.height-u.bottom)/S.height*-2+1,K=c.bA(_.getWest(),_.getEast())<0,Z=K?_.getEast():_.getWest(),ee=K?_.getWest():_.getEast(),ae=Math.max(_.getNorth(),_.getSouth()),ge=Math.min(_.getNorth(),_.getSouth()),me=Z+.5*c.bA(Z,ee),ve=ae+.5*c.bA(ae,ge),we=S.clone();we.setCenter(I.center),we.setBearing(I.bearing),we.setPitch(0),we.setRoll(0),we.setZoom(I.zoom);const Pe=we.modelViewProjectionMatrix,Ce=[Or(_.getNorthWest()),Or(_.getNorthEast()),Or(_.getSouthWest()),Or(_.getSouthEast()),Or(new c.S(ee,ve)),Or(new c.S(Z,ve)),Or(new c.S(me,ae)),Or(new c.S(me,ge))],ze=Or(I.center);let Ve=Number.POSITIVE_INFINITY;for(const Ie of Ce)O<0&&(Ve=Ai.getLesserNonNegativeNonNull(Ve,Ai.solveVectorScale(Ie,ze,Pe,"x",O))),N>0&&(Ve=Ai.getLesserNonNegativeNonNull(Ve,Ai.solveVectorScale(Ie,ze,Pe,"x",N))),j>0&&(Ve=Ai.getLesserNonNegativeNonNull(Ve,Ai.solveVectorScale(Ie,ze,Pe,"y",j))),G<0&&(Ve=Ai.getLesserNonNegativeNonNull(Ve,Ai.solveVectorScale(Ie,ze,Pe,"y",G)));if(Number.isFinite(Ve)&&Ve!==0)return I.zoom=we.zoom+c.ak(Ve),I;sl()}handleJumpToCenterZoom(i,u){const _=i.center.lat,b=i.getConstrained(u.center?c.S.convert(u.center):i.center,i.zoom).center;i.setCenter(b.wrap());const S=u.zoom!==void 0?+u.zoom:i.zoom+Ki(_,b.lat);i.zoom!==S&&i.setZoom(S)}handleEaseTo(i,u){const _=i.zoom,b=i.center,S=i.padding,I={roll:i.roll,pitch:i.pitch,bearing:i.bearing},O={roll:u.roll===void 0?i.roll:u.roll,pitch:u.pitch===void 0?i.pitch:u.pitch,bearing:u.bearing===void 0?i.bearing:u.bearing},N=u.zoom!==void 0,j=!i.isPaddingEqual(u.padding);let G=!1;const K=u.center?c.S.convert(u.center):b,Z=i.getConstrained(K,_).center;Pa(i,Z);const ee=i.clone();ee.setCenter(Z),ee.setZoom(N?+u.zoom:_+Ki(b.lat,K.lat)),ee.setBearing(u.bearing);const ae=new c.P(c.ah(i.centerPoint.x+u.offsetAsPoint.x,0,i.width),c.ah(i.centerPoint.y+u.offsetAsPoint.y,0,i.height));ee.setLocationAtPoint(Z,ae);const ge=(u.offset&&u.offsetAsPoint.mag())>0?ee.center:Z,me=N?+u.zoom:_+Ki(b.lat,ge.lat),ve=_+Ki(b.lat,0),we=me+Ki(ge.lat,0),Pe=c.bA(b.lng,ge.lng),Ce=c.bA(b.lat,ge.lat),ze=c.af(we-ve);return G=me!==_,{easeFunc:Ve=>{if(c.be(I,O)||sr({startEulerAngles:I,endEulerAngles:O,tr:i,k:Ve,useSlerp:I.roll!=O.roll}),j&&i.interpolatePadding(S,u.padding,Ve),u.around)c.w("Easing around a point is not supported under globe projection."),i.setLocationAtPoint(u.around,u.aroundPoint);else{const Ie=we>ve?Math.min(2,ze):Math.max(.5,ze),Ye=Math.pow(Ie,1-Ve),ct=Wl(b,Pe,Ce,Ve*Ye);i.setCenter(ct.wrap())}if(G){const Ie=c.C.number(ve,we,Ve)+Ki(0,i.center.lat);i.setZoom(Ie)}},isZooming:G,elevationCenter:ge}}handleFlyTo(i,u){const _=u.zoom!==void 0,b=i.center,S=i.zoom,I=i.padding,O=!i.isPaddingEqual(u.padding),N=i.getConstrained(c.S.convert(u.center||u.locationAtOffset),S).center,j=_?+u.zoom:i.zoom+Ki(i.center.lat,N.lat),G=i.clone();G.setCenter(N),G.setZoom(j),G.setBearing(u.bearing);const K=new c.P(c.ah(i.centerPoint.x+u.offsetAsPoint.x,0,i.width),c.ah(i.centerPoint.y+u.offsetAsPoint.y,0,i.height));G.setLocationAtPoint(N,K);const Z=G.center;Pa(i,Z);const ee=(function(Ce,ze,Ve){const Ie=Or(ze),Ye=Or(Ve),ct=c.aX(Ie,Ye),rt=Math.acos(ct),st=Ma(Ce);return rt/(2*Math.PI)*st})(i,b,Z),ae=S+Ki(b.lat,0),ge=j+Ki(Z.lat,0),me=c.af(ge-ae);let ve;if(typeof u.minZoom=="number"){const Ce=+u.minZoom+Ki(Z.lat,0),ze=Math.min(Ce,ae,ge)+Ki(0,Z.lat),Ve=i.getConstrained(Z,ze).zoom+Ki(Z.lat,0);ve=c.af(Ve-ae)}const we=c.bA(b.lng,Z.lng),Pe=c.bA(b.lat,Z.lat);return{easeFunc:(Ce,ze,Ve,Ie)=>{const Ye=Wl(b,we,Pe,Ve);O&&i.interpolatePadding(I,u.padding,Ce);const ct=Ce===1?Z:Ye;i.setCenter(ct.wrap());const rt=ae+c.ak(ze);i.setZoom(Ce===1?j:rt+Ki(0,ct.lat))},scaleOfZoom:me,targetCenter:Z,scaleOfMinZoom:ve,pixelPathLength:ee}}static solveVectorScale(i,u,_,b,S){const I=b==="x"?[_[0],_[4],_[8],_[12]]:[_[1],_[5],_[9],_[13]],O=[_[3],_[7],_[11],_[15]],N=i[0]*I[0]+i[1]*I[1]+i[2]*I[2],j=i[0]*O[0]+i[1]*O[1]+i[2]*O[2],G=u[0]*I[0]+u[1]*I[1]+u[2]*I[2],K=u[0]*O[0]+u[1]*O[1]+u[2]*O[2];return G+S*j===N+S*K||O[3]*(N-G)+I[3]*(K-j)+N*K==G*j?null:(G+I[3]-S*K-S*O[3])/(G-N-S*K+S*j)}static getLesserNonNegativeNonNull(i,u){return u!==null&&u>=0&&u<i?u:i}}class Wu{constructor(i){this._globe=i,this._mercatorCameraHelper=new wr,this._verticalPerspectiveCameraHelper=new Ai}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(i,u){return this.currentHelper.handlePanInertia(i,u)}handleMapControlsRollPitchBearingZoom(i,u){return this.currentHelper.handleMapControlsRollPitchBearingZoom(i,u)}handleMapControlsPan(i,u,_){this.currentHelper.handleMapControlsPan(i,u,_)}cameraForBoxAndBearing(i,u,_,b,S){return this.currentHelper.cameraForBoxAndBearing(i,u,_,b,S)}handleJumpToCenterZoom(i,u){this.currentHelper.handleJumpToCenterZoom(i,u)}handleEaseTo(i,u){return this.currentHelper.handleEaseTo(i,u)}handleFlyTo(i,u){return this.currentHelper.handleFlyTo(i,u)}}const pu=(T,i)=>c.y(T,i&&i.filter((u=>u.identifier!=="source.canvas"))),Bl=c.bE();class M extends c.E{constructor(i,u={}){super(),this._rtlPluginLoaded=()=>{for(const _ in this.sourceCaches){const b=this.sourceCaches[_].getSource().type;b!=="vector"&&b!=="geojson"||this.sourceCaches[_].reload()}},this.map=i,this.dispatcher=new Wt(Jt(),i._getMapId()),this.dispatcher.registerMessageHandler("GG",((_,b)=>this.getGlyphs(_,b))),this.dispatcher.registerMessageHandler("GI",((_,b)=>this.getImages(_,b))),this.imageManager=new _e,this.imageManager.setEventedParent(this),this.glyphManager=new Re(i._requestManager,u.localIdeographFontFamily),this.lineAtlas=new zt(256,512),this.crossTileSymbolIndex=new Ja,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new c.bF,this._loaded=!1,this._availableImages=[],this._globalState={},this._resetUpdates(),this.dispatcher.broadcast("SR",c.bG()),Vs().on(qr,this._rtlPluginLoaded),this.on("data",(_=>{if(_.dataType!=="source"||_.sourceDataType!=="metadata")return;const b=this.sourceCaches[_.sourceId];if(!b)return;const S=b.getSource();if(S&&S.vectorLayerIds)for(const I in this._layers){const O=this._layers[I];O.source===S.id&&this._validateLayer(O)}}))}setGlobalStateProperty(i,u){var _,b,S;this._checkLoaded();const I=u===null?(S=(b=(_=this.stylesheet.state)===null||_===void 0?void 0:_[i])===null||b===void 0?void 0:b.default)!==null&&S!==void 0?S:null:u;if(c.bH(I,this._globalState[i]))return this;this._globalState[i]=I;const O=this._findGlobalStateAffectedSources([i]);for(const N in this.sourceCaches)O.has(N)&&(this._reloadSource(N),this._changed=!0)}getGlobalState(){return this._globalState}setGlobalState(i){this._checkLoaded();const u=[];for(const b in i)!c.bH(this._globalState[b],i[b].default)&&(u.push(b),this._globalState[b]=i[b].default);const _=this._findGlobalStateAffectedSources(u);for(const b in this.sourceCaches)_.has(b)&&(this._reloadSource(b),this._changed=!0)}_findGlobalStateAffectedSources(i){if(i.length===0)return new Set;const u=new Set;for(const _ in this._layers){const b=this._layers[_],S=b.getLayoutAffectingGlobalStateRefs();for(const I of i)S.has(I)&&u.add(b.source)}return u}loadURL(i,u={},_){this.fire(new c.l("dataloading",{dataType:"style"})),u.validate=typeof u.validate!="boolean"||u.validate;const b=this.map._requestManager.transformRequest(i,"Style");this._loadStyleRequest=new AbortController;const S=this._loadStyleRequest;c.j(b,this._loadStyleRequest).then((I=>{this._loadStyleRequest=null,this._load(I.data,u,_)})).catch((I=>{this._loadStyleRequest=null,I&&!S.signal.aborted&&this.fire(new c.k(I))}))}loadJSON(i,u={},_){this.fire(new c.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,J.frameAsync(this._frameRequest).then((()=>{this._frameRequest=null,u.validate=u.validate!==!1,this._load(i,u,_)})).catch((()=>{}))}loadEmpty(){this.fire(new c.l("dataloading",{dataType:"style"})),this._load(Bl,{validate:!1})}_load(i,u,_){var b,S,I;const O=u.transformStyle?u.transformStyle(_,i):i;if(!u.validate||!pu(this,c.z(O))){this._loaded=!0,this.stylesheet=O;for(const N in O.sources)this.addSource(N,O.sources[N],{validate:!1});O.sprite?this._loadSprite(O.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(O.glyphs),this._createLayers(),this.light=new mt(this.stylesheet.light),this._setProjectionInternal(((b=this.stylesheet.projection)===null||b===void 0?void 0:b.type)||"mercator"),this.sky=new Tt(this.stylesheet.sky),this.map.setTerrain((S=this.stylesheet.terrain)!==null&&S!==void 0?S:null),this.setGlobalState((I=this.stylesheet.state)!==null&&I!==void 0?I:null),this.fire(new c.l("data",{dataType:"style"})),this.fire(new c.l("style.load"))}}_createLayers(){const i=c.bI(this.stylesheet.layers);this.dispatcher.broadcast("SL",i),this._order=i.map((u=>u.id)),this._layers={},this._serializedLayers=null;for(const u of i){const _=c.bJ(u);_.setEventedParent(this,{layer:{id:u.id}}),this._layers[u.id]=_}}_loadSprite(i,u=!1,_=void 0){let b;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,(function(S,I,O,N){return c._(this,void 0,void 0,(function*(){const j=Be(S),G=O>1?"@2x":"",K={},Z={};for(const{id:ee,url:ae}of j){const ge=I.transformRequest(de(ae,G,".json"),"SpriteJSON");K[ee]=c.j(ge,N);const me=I.transformRequest(de(ae,G,".png"),"SpriteImage");Z[ee]=Ze.getImage(me,N)}return yield Promise.all([...Object.values(K),...Object.values(Z)]),(function(ee,ae){return c._(this,void 0,void 0,(function*(){const ge={};for(const me in ee){ge[me]={};const ve=J.getImageCanvasContext((yield ae[me]).data),we=(yield ee[me]).data;for(const Pe in we){const{width:Ce,height:ze,x:Ve,y:Ie,sdf:Ye,pixelRatio:ct,stretchX:rt,stretchY:st,content:lt,textFitWidth:Nt,textFitHeight:Vt}=we[Pe];ge[me][Pe]={data:null,pixelRatio:ct,sdf:Ye,stretchX:rt,stretchY:st,content:lt,textFitWidth:Nt,textFitHeight:Vt,spriteData:{width:Ce,height:ze,x:Ve,y:Ie,context:ve}}}}return ge}))})(K,Z)}))})(i,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then((S=>{if(this._spriteRequest=null,S)for(const I in S){this._spritesImagesIds[I]=[];const O=this._spritesImagesIds[I]?this._spritesImagesIds[I].filter((N=>!(N in S))):[];for(const N of O)this.imageManager.removeImage(N),this._changedImages[N]=!0;for(const N in S[I]){const j=I==="default"?N:`${I}:${N}`;this._spritesImagesIds[I].push(j),j in this.imageManager.images?this.imageManager.updateImage(j,S[I][N],!1):this.imageManager.addImage(j,S[I][N]),u&&(this._changedImages[j]=!0)}}})).catch((S=>{this._spriteRequest=null,b=S,this.fire(new c.k(b))})).finally((()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),u&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.l("data",{dataType:"style"})),_&&_(b)}))}_unloadSprite(){for(const i of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(i),this._changedImages[i]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.l("data",{dataType:"style"}))}_validateLayer(i){const u=this.sourceCaches[i.source];if(!u)return;const _=i.sourceLayer;if(!_)return;const b=u.getSource();(b.type==="geojson"||b.vectorLayerIds&&b.vectorLayerIds.indexOf(_)===-1)&&this.fire(new c.k(new Error(`Source layer "${_}" does not exist on source "${b.id}" as specified by style layer "${i.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const i in this.sourceCaches)if(!this.sourceCaches[i].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(i,u=!1){const _=this._serializedAllLayers();if(!i||i.length===0)return Object.values(u?c.bK(_):_);const b=[];for(const S of i)if(_[S]){const I=u?c.bK(_[S]):_[S];b.push(I)}return b}_serializedAllLayers(){let i=this._serializedLayers;if(i)return i;i=this._serializedLayers={};const u=Object.keys(this._layers);for(const _ of u){const b=this._layers[_];b.type!=="custom"&&(i[_]=b.serialize())}return i}hasTransitions(){var i,u,_;if(!((i=this.light)===null||i===void 0)&&i.hasTransition()||!((u=this.sky)===null||u===void 0)&&u.hasTransition()||!((_=this.projection)===null||_===void 0)&&_.hasTransition())return!0;for(const b in this.sourceCaches)if(this.sourceCaches[b].hasTransition())return!0;for(const b in this._layers)if(this._layers[b].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(i){if(!this._loaded)return;const u=this._changed;if(u){const b=Object.keys(this._updatedLayers),S=Object.keys(this._removedLayers);(b.length||S.length)&&this._updateWorkerLayers(b,S);for(const I in this._updatedSources){const O=this._updatedSources[I];if(O==="reload")this._reloadSource(I);else{if(O!=="clear")throw new Error(`Invalid action ${O}`);this._clearSource(I)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const I in this._updatedPaintProps)this._layers[I].updateTransitions(i);this.light.updateTransitions(i),this.sky.updateTransitions(i),this._resetUpdates()}const _={};for(const b in this.sourceCaches){const S=this.sourceCaches[b];_[b]=S.used,S.used=!1}for(const b of this._order){const S=this._layers[b];S.recalculate(i,this._availableImages),!S.isHidden(i.zoom)&&S.source&&(this.sourceCaches[S.source].used=!0)}for(const b in _){const S=this.sourceCaches[b];!!_[b]!=!!S.used&&S.fire(new c.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:b}))}this.light.recalculate(i),this.sky.recalculate(i),this.projection.recalculate(i),this.z=i.zoom,u&&this.fire(new c.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const i=Object.keys(this._changedImages);if(i.length){for(const u in this.sourceCaches)this.sourceCaches[u].reloadTilesForDependencies(["icons","patterns"],i);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const i in this.sourceCaches)this.sourceCaches[i].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(i,u){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(i,!1),removedIds:u})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(i,u={}){var _;this._checkLoaded();const b=this.serialize();if(i=u.transformStyle?u.transformStyle(b,i):i,((_=u.validate)===null||_===void 0||_)&&pu(this,c.z(i)))return!1;(i=c.bK(i)).layers=c.bI(i.layers);const S=c.bL(b,i),I=this._getOperationsToPerform(S);if(I.unimplemented.length>0)throw new Error(`Unimplemented: ${I.unimplemented.join(", ")}.`);if(I.operations.length===0)return!1;for(const O of I.operations)O();return this.stylesheet=i,this._serializedLayers=null,!0}_getOperationsToPerform(i){const u=[],_=[];for(const b of i)switch(b.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":u.push((()=>this.addLayer.apply(this,b.args)));break;case"removeLayer":u.push((()=>this.removeLayer.apply(this,b.args)));break;case"setPaintProperty":u.push((()=>this.setPaintProperty.apply(this,b.args)));break;case"setLayoutProperty":u.push((()=>this.setLayoutProperty.apply(this,b.args)));break;case"setFilter":u.push((()=>this.setFilter.apply(this,b.args)));break;case"addSource":u.push((()=>this.addSource.apply(this,b.args)));break;case"removeSource":u.push((()=>this.removeSource.apply(this,b.args)));break;case"setLayerZoomRange":u.push((()=>this.setLayerZoomRange.apply(this,b.args)));break;case"setLight":u.push((()=>this.setLight.apply(this,b.args)));break;case"setGeoJSONSourceData":u.push((()=>this.setGeoJSONSourceData.apply(this,b.args)));break;case"setGlyphs":u.push((()=>this.setGlyphs.apply(this,b.args)));break;case"setSprite":u.push((()=>this.setSprite.apply(this,b.args)));break;case"setTerrain":u.push((()=>this.map.setTerrain.apply(this,b.args)));break;case"setSky":u.push((()=>this.setSky.apply(this,b.args)));break;case"setProjection":this.setProjection.apply(this,b.args);break;case"setGlobalState":u.push((()=>this.setGlobalState.apply(this,b.args)));break;case"setTransition":u.push((()=>{}));break;default:_.push(b.command)}return{operations:u,unimplemented:_}}addImage(i,u){if(this.getImage(i))return this.fire(new c.k(new Error(`An image named "${i}" already exists.`)));this.imageManager.addImage(i,u),this._afterImageUpdated(i)}updateImage(i,u){this.imageManager.updateImage(i,u)}getImage(i){return this.imageManager.getImage(i)}removeImage(i){if(!this.getImage(i))return this.fire(new c.k(new Error(`An image named "${i}" does not exist.`)));this.imageManager.removeImage(i),this._afterImageUpdated(i)}_afterImageUpdated(i){this._availableImages=this.imageManager.listImages(),this._changedImages[i]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(i,u,_={}){if(this._checkLoaded(),this.sourceCaches[i]!==void 0)throw new Error(`Source "${i}" already exists.`);if(!u.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(u).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(u.type)>=0&&this._validate(c.z.source,`sources.${i}`,u,null,_))return;this.map&&this.map._collectResourceTiming&&(u.collectResourceTiming=!0);const b=this.sourceCaches[i]=new Rn(i,u,this.dispatcher);b.style=this,b.setEventedParent(this,(()=>({isSourceLoaded:b.loaded(),source:b.serialize(),sourceId:i}))),b.onAdd(this.map),this._changed=!0}removeSource(i){if(this._checkLoaded(),this.sourceCaches[i]===void 0)throw new Error("There is no source with this ID");for(const _ in this._layers)if(this._layers[_].source===i)return this.fire(new c.k(new Error(`Source "${i}" cannot be removed while layer "${_}" is using it.`)));const u=this.sourceCaches[i];delete this.sourceCaches[i],delete this._updatedSources[i],u.fire(new c.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:i})),u.setEventedParent(null),u.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(i,u){if(this._checkLoaded(),this.sourceCaches[i]===void 0)throw new Error(`There is no source with this ID=${i}`);const _=this.sourceCaches[i].getSource();if(_.type!=="geojson")throw new Error(`geojsonSource.type is ${_.type}, which is !== 'geojson`);_.setData(u),this._changed=!0}getSource(i){return this.sourceCaches[i]&&this.sourceCaches[i].getSource()}addLayer(i,u,_={}){this._checkLoaded();const b=i.id;if(this.getLayer(b))return void this.fire(new c.k(new Error(`Layer "${b}" already exists on this map.`)));let S;if(i.type==="custom"){if(pu(this,c.bM(i)))return;S=c.bJ(i)}else{if("source"in i&&typeof i.source=="object"&&(this.addSource(b,i.source),i=c.bK(i),i=c.e(i,{source:b})),this._validate(c.z.layer,`layers.${b}`,i,{arrayIndex:-1},_))return;S=c.bJ(i),this._validateLayer(S),S.setEventedParent(this,{layer:{id:b}})}const I=u?this._order.indexOf(u):this._order.length;if(u&&I===-1)this.fire(new c.k(new Error(`Cannot add layer "${b}" before non-existing layer "${u}".`)));else{if(this._order.splice(I,0,b),this._layerOrderChanged=!0,this._layers[b]=S,this._removedLayers[b]&&S.source&&S.type!=="custom"){const O=this._removedLayers[b];delete this._removedLayers[b],O.type!==S.type?this._updatedSources[S.source]="clear":(this._updatedSources[S.source]="reload",this.sourceCaches[S.source].pause())}this._updateLayer(S),S.onAdd&&S.onAdd(this.map)}}moveLayer(i,u){if(this._checkLoaded(),this._changed=!0,!this._layers[i])return void this.fire(new c.k(new Error(`The layer '${i}' does not exist in the map's style and cannot be moved.`)));if(i===u)return;const _=this._order.indexOf(i);this._order.splice(_,1);const b=u?this._order.indexOf(u):this._order.length;u&&b===-1?this.fire(new c.k(new Error(`Cannot move layer "${i}" before non-existing layer "${u}".`))):(this._order.splice(b,0,i),this._layerOrderChanged=!0)}removeLayer(i){this._checkLoaded();const u=this._layers[i];if(!u)return void this.fire(new c.k(new Error(`Cannot remove non-existing layer "${i}".`)));u.setEventedParent(null);const _=this._order.indexOf(i);this._order.splice(_,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[i]=u,delete this._layers[i],this._serializedLayers&&delete this._serializedLayers[i],delete this._updatedLayers[i],delete this._updatedPaintProps[i],u.onRemove&&u.onRemove(this.map)}getLayer(i){return this._layers[i]}getLayersOrder(){return[...this._order]}hasLayer(i){return i in this._layers}setLayerZoomRange(i,u,_){this._checkLoaded();const b=this.getLayer(i);b?b.minzoom===u&&b.maxzoom===_||(u!=null&&(b.minzoom=u),_!=null&&(b.maxzoom=_),this._updateLayer(b)):this.fire(new c.k(new Error(`Cannot set the zoom range of non-existing layer "${i}".`)))}setFilter(i,u,_={}){this._checkLoaded();const b=this.getLayer(i);if(b){if(!c.bH(b.filter,u))return u==null?(b.setFilter(void 0),void this._updateLayer(b)):void(this._validate(c.z.filter,`layers.${b.id}.filter`,u,null,_)||(b.setFilter(c.bK(u)),this._updateLayer(b)))}else this.fire(new c.k(new Error(`Cannot filter non-existing layer "${i}".`)))}getFilter(i){return c.bK(this.getLayer(i).filter)}setLayoutProperty(i,u,_,b={}){this._checkLoaded();const S=this.getLayer(i);S?c.bH(S.getLayoutProperty(u),_)||(S.setLayoutProperty(u,_,b),this._updateLayer(S)):this.fire(new c.k(new Error(`Cannot style non-existing layer "${i}".`)))}getLayoutProperty(i,u){const _=this.getLayer(i);if(_)return _.getLayoutProperty(u);this.fire(new c.k(new Error(`Cannot get style of non-existing layer "${i}".`)))}setPaintProperty(i,u,_,b={}){this._checkLoaded();const S=this.getLayer(i);S?c.bH(S.getPaintProperty(u),_)||(S.setPaintProperty(u,_,b)&&this._updateLayer(S),this._changed=!0,this._updatedPaintProps[i]=!0,this._serializedLayers=null):this.fire(new c.k(new Error(`Cannot style non-existing layer "${i}".`)))}getPaintProperty(i,u){return this.getLayer(i).getPaintProperty(u)}setFeatureState(i,u){this._checkLoaded();const _=i.source,b=i.sourceLayer,S=this.sourceCaches[_];if(S===void 0)return void this.fire(new c.k(new Error(`The source '${_}' does not exist in the map's style.`)));const I=S.getSource().type;I==="geojson"&&b?this.fire(new c.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):I!=="vector"||b?(i.id===void 0&&this.fire(new c.k(new Error("The feature id parameter must be provided."))),S.setFeatureState(b,i.id,u)):this.fire(new c.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(i,u){this._checkLoaded();const _=i.source,b=this.sourceCaches[_];if(b===void 0)return void this.fire(new c.k(new Error(`The source '${_}' does not exist in the map's style.`)));const S=b.getSource().type,I=S==="vector"?i.sourceLayer:void 0;S!=="vector"||I?u&&typeof i.id!="string"&&typeof i.id!="number"?this.fire(new c.k(new Error("A feature id is required to remove its specific state property."))):b.removeFeatureState(I,i.id,u):this.fire(new c.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(i){this._checkLoaded();const u=i.source,_=i.sourceLayer,b=this.sourceCaches[u];if(b!==void 0)return b.getSource().type!=="vector"||_?(i.id===void 0&&this.fire(new c.k(new Error("The feature id parameter must be provided."))),b.getFeatureState(_,i.id)):void this.fire(new c.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new c.k(new Error(`The source '${u}' does not exist in the map's style.`)))}getTransition(){return c.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const i=c.bN(this.sourceCaches,(S=>S.serialize())),u=this._serializeByIds(this._order,!0),_=this.map.getTerrain()||void 0,b=this.stylesheet;return c.bO({version:b.version,name:b.name,metadata:b.metadata,light:b.light,sky:b.sky,center:b.center,zoom:b.zoom,bearing:b.bearing,pitch:b.pitch,sprite:b.sprite,glyphs:b.glyphs,transition:b.transition,projection:b.projection,sources:i,layers:u,terrain:_},(S=>S!==void 0))}_updateLayer(i){this._updatedLayers[i.id]=!0,i.source&&!this._updatedSources[i.source]&&this.sourceCaches[i.source].getSource().type!=="raster"&&(this._updatedSources[i.source]="reload",this.sourceCaches[i.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(i){const u=I=>this._layers[I].type==="fill-extrusion",_={},b=[];for(let I=this._order.length-1;I>=0;I--){const O=this._order[I];if(u(O)){_[O]=I;for(const N of i){const j=N[O];if(j)for(const G of j)b.push(G)}}}b.sort(((I,O)=>O.intersectionZ-I.intersectionZ));const S=[];for(let I=this._order.length-1;I>=0;I--){const O=this._order[I];if(u(O))for(let N=b.length-1;N>=0;N--){const j=b[N].feature;if(_[j.layer.id]<I)break;S.push(j),b.pop()}else for(const N of i){const j=N[O];if(j)for(const G of j)S.push(G.feature)}}return S}queryRenderedFeatures(i,u,_){u&&u.filter&&this._validate(c.z.filter,"queryRenderedFeatures.filter",u.filter,null,u);const b={};if(u&&u.layers){if(!(Array.isArray(u.layers)||u.layers instanceof Set))return this.fire(new c.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const j of u.layers){const G=this._layers[j];if(!G)return this.fire(new c.k(new Error(`The layer '${j}' does not exist in the map's style and cannot be queried for features.`))),[];b[G.source]=!0}}const S=[];u.availableImages=this._availableImages;const I=this._serializedAllLayers(),O=u.layers instanceof Set?u.layers:Array.isArray(u.layers)?new Set(u.layers):null,N=Object.assign(Object.assign({},u),{layers:O});for(const j in this.sourceCaches)u.layers&&!b[j]||S.push(fi(this.sourceCaches[j],this._layers,I,i,N,_,this.map.terrain?(G,K,Z)=>this.map.terrain.getElevation(G,K,Z):void 0));return this.placement&&S.push((function(j,G,K,Z,ee,ae,ge){const me={},ve=ae.queryRenderedSymbols(Z),we=[];for(const Pe of Object.keys(ve).map(Number))we.push(ge[Pe]);we.sort(fs);for(const Pe of we){const Ce=Pe.featureIndex.lookupSymbolFeatures(ve[Pe.bucketInstanceId],G,Pe.bucketIndex,Pe.sourceLayerIndex,ee.filter,ee.layers,ee.availableImages,j);for(const ze in Ce){const Ve=me[ze]=me[ze]||[],Ie=Ce[ze];Ie.sort(((Ye,ct)=>{const rt=Pe.featureSortOrder;if(rt){const st=rt.indexOf(Ye.featureIndex);return rt.indexOf(ct.featureIndex)-st}return ct.featureIndex-Ye.featureIndex}));for(const Ye of Ie)Ve.push(Ye)}}return(function(Pe,Ce,ze){for(const Ve in Pe)for(const Ie of Pe[Ve])Bs(Ie,ze[Ce[Ve].source]);return Pe})(me,j,K)})(this._layers,I,this.sourceCaches,i,N,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(S)}querySourceFeatures(i,u){u&&u.filter&&this._validate(c.z.filter,"querySourceFeatures.filter",u.filter,null,u);const _=this.sourceCaches[i];return _?(function(b,S){const I=b.getRenderableIds().map((j=>b.getTileByID(j))),O=[],N={};for(let j=0;j<I.length;j++){const G=I[j],K=G.tileID.canonical.key;N[K]||(N[K]=!0,G.querySourceFeatures(O,S))}return O})(_,u):[]}getLight(){return this.light.getLight()}setLight(i,u={}){this._checkLoaded();const _=this.light.getLight();let b=!1;for(const I in i)if(!c.bH(i[I],_[I])){b=!0;break}if(!b)return;const S={now:J.now(),transition:c.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(i,u),this.light.updateTransitions(S)}getProjection(){var i;return(i=this.stylesheet)===null||i===void 0?void 0:i.projection}setProjection(i){if(this._checkLoaded(),this.projection){if(this.projection.name===i.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=i,this._setProjectionInternal(i.type)}getSky(){var i;return(i=this.stylesheet)===null||i===void 0?void 0:i.sky}setSky(i,u={}){this._checkLoaded();const _=this.getSky();let b=!1;if(!i&&!_)return;if(i&&!_)b=!0;else if(!i&&_)b=!0;else for(const I in i)if(!c.bH(i[I],_[I])){b=!0;break}if(!b)return;const S={now:J.now(),transition:c.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=i,this.sky.setSky(i,u),this.sky.updateTransitions(S)}_setProjectionInternal(i){const u=(function(_){if(Array.isArray(_)){const b=new ra({type:_});return{projection:b,transform:new co,cameraHelper:new Wu(b)}}switch(_){case"mercator":return{projection:new kn,transform:new xn,cameraHelper:new wr};case"globe":{const b=new ra({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:b,transform:new co,cameraHelper:new Wu(b)}}case"vertical-perspective":return{projection:new Wn,transform:new ll,cameraHelper:new Ai};default:return c.w(`Unknown projection name: ${_}. Falling back to mercator projection.`),{projection:new kn,transform:new xn,cameraHelper:new wr}}})(i);this.projection=u.projection,this.map.migrateProjection(u.transform,u.cameraHelper);for(const _ in this.sourceCaches)this.sourceCaches[_].reload()}_validate(i,u,_,b,S={}){return(!S||S.validate!==!1)&&pu(this,i.call(c.z,c.e({key:u,style:this.serialize(),value:_,styleSpec:c.v},b)))}_remove(i=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Vs().off(qr,this._rtlPluginLoaded);for(const u in this._layers)this._layers[u].setEventedParent(null);for(const u in this.sourceCaches){const _=this.sourceCaches[u];_.setEventedParent(null),_.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),i&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(i)}_clearSource(i){this.sourceCaches[i].clearTiles()}_reloadSource(i){this.sourceCaches[i].resume(),this.sourceCaches[i].reload()}_updateSources(i){for(const u in this.sourceCaches)this.sourceCaches[u].update(i,this.map.terrain)}_generateCollisionBoxes(){for(const i in this.sourceCaches)this._reloadSource(i)}_updatePlacement(i,u,_,b,S=!1){let I=!1,O=!1;const N={};for(const j of this._order){const G=this._layers[j];if(G.type!=="symbol")continue;if(!N[G.source]){const Z=this.sourceCaches[G.source];N[G.source]=Z.getRenderableIds(!0).map((ee=>Z.getTileByID(ee))).sort(((ee,ae)=>ae.tileID.overscaledZ-ee.tileID.overscaledZ||(ee.tileID.isLessThan(ae.tileID)?-1:1)))}const K=this.crossTileSymbolIndex.addLayer(G,N[G.source],i.center.lng);I=I||K}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((S=S||this._layerOrderChanged||_===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(J.now(),i.zoom))&&(this.pauseablePlacement=new rr(i,this.map.terrain,this._order,S,u,_,b,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,N),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(J.now()),O=!0),I&&this.pauseablePlacement.placement.setStale()),O||I)for(const j of this._order){const G=this._layers[j];G.type==="symbol"&&this.placement.updateLayerOpacities(G,N[G.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(J.now())}_releaseSymbolFadeTiles(){for(const i in this.sourceCaches)this.sourceCaches[i].releaseSymbolFadeTiles()}getImages(i,u){return c._(this,void 0,void 0,(function*(){const _=yield this.imageManager.getImages(u.icons);this._updateTilesForChangedImages();const b=this.sourceCaches[u.source];return b&&b.setDependencies(u.tileID.key,u.type,u.icons),_}))}getGlyphs(i,u){return c._(this,void 0,void 0,(function*(){const _=yield this.glyphManager.getGlyphs(u.stacks),b=this.sourceCaches[u.source];return b&&b.setDependencies(u.tileID.key,u.type,[""]),_}))}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(i,u={}){this._checkLoaded(),i&&this._validate(c.z.glyphs,"glyphs",i,null,u)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=i,this.glyphManager.entries={},this.glyphManager.setURL(i))}addSprite(i,u,_={},b){this._checkLoaded();const S=[{id:i,url:u}],I=[...Be(this.stylesheet.sprite),...S];this._validate(c.z.sprite,"sprite",I,null,_)||(this.stylesheet.sprite=I,this._loadSprite(S,!0,b))}removeSprite(i){this._checkLoaded();const u=Be(this.stylesheet.sprite);if(u.find((_=>_.id===i))){if(this._spritesImagesIds[i])for(const _ of this._spritesImagesIds[i])this.imageManager.removeImage(_),this._changedImages[_]=!0;u.splice(u.findIndex((_=>_.id===i)),1),this.stylesheet.sprite=u.length>0?u:void 0,delete this._spritesImagesIds[i],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.l("data",{dataType:"style"}))}else this.fire(new c.k(new Error(`Sprite "${i}" doesn't exists on this map.`)))}getSprite(){return Be(this.stylesheet.sprite)}setSprite(i,u={},_){this._checkLoaded(),i&&this._validate(c.z.sprite,"sprite",i,null,u)||(this.stylesheet.sprite=i,i?this._loadSprite(i,!0,_):(this._unloadSprite(),_&&_(null)))}}var H=c.aJ([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class ne{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(i,u,_,b,S,I,O,N,j){this.context=i;let G=this.boundPaintVertexBuffers.length!==b.length;for(let K=0;!G&&K<b.length;K++)this.boundPaintVertexBuffers[K]!==b[K]&&(G=!0);!this.vao||this.boundProgram!==u||this.boundLayoutVertexBuffer!==_||G||this.boundIndexBuffer!==S||this.boundVertexOffset!==I||this.boundDynamicVertexBuffer!==O||this.boundDynamicVertexBuffer2!==N||this.boundDynamicVertexBuffer3!==j?this.freshBind(u,_,b,S,I,O,N,j):(i.bindVertexArray.set(this.vao),O&&O.bind(),S&&S.dynamicDraw&&S.bind(),N&&N.bind(),j&&j.bind())}freshBind(i,u,_,b,S,I,O,N){const j=i.numAttributes,G=this.context,K=G.gl;this.vao&&this.destroy(),this.vao=G.createVertexArray(),G.bindVertexArray.set(this.vao),this.boundProgram=i,this.boundLayoutVertexBuffer=u,this.boundPaintVertexBuffers=_,this.boundIndexBuffer=b,this.boundVertexOffset=S,this.boundDynamicVertexBuffer=I,this.boundDynamicVertexBuffer2=O,this.boundDynamicVertexBuffer3=N,u.enableAttributes(K,i);for(const Z of _)Z.enableAttributes(K,i);I&&I.enableAttributes(K,i),O&&O.enableAttributes(K,i),N&&N.enableAttributes(K,i),u.bind(),u.setVertexAttribPointers(K,i,S);for(const Z of _)Z.bind(),Z.setVertexAttribPointers(K,i,S);I&&(I.bind(),I.setVertexAttribPointers(K,i,S)),b&&b.bind(),O&&(O.bind(),O.setVertexAttribPointers(K,i,S)),N&&(N.bind(),N.setVertexAttribPointers(K,i,S)),G.currentNumAttributes=j}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const ye=(T,i,u,_,b)=>({u_texture:0,u_ele_delta:T,u_fog_matrix:i,u_fog_color:u?u.properties.get("fog-color"):c.bf.white,u_fog_ground_blend:u?u.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:b?0:u?u.calculateFogBlendOpacity(_):0,u_horizon_color:u?u.properties.get("horizon-color"):c.bf.white,u_horizon_fog_blend:u?u.properties.get("horizon-fog-blend"):1,u_is_globe_mode:b?1:0}),at={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function ht(T){const i=[];for(let u=0;u<T.length;u++){if(T[u]===null)continue;const _=T[u].split(" ");i.push(_.pop())}return i}class Kt{constructor(i,u,_,b,S,I,O,N,j=[]){const G=i.gl;this.program=G.createProgram();const K=ht(u.staticAttributes),Z=_?_.getBinderAttributes():[],ee=K.concat(Z),ae=Zi.prelude.staticUniforms?ht(Zi.prelude.staticUniforms):[],ge=O.staticUniforms?ht(O.staticUniforms):[],me=u.staticUniforms?ht(u.staticUniforms):[],ve=_?_.getBinderUniforms():[],we=ae.concat(ge).concat(me).concat(ve),Pe=[];for(const rt of we)Pe.indexOf(rt)<0&&Pe.push(rt);const Ce=_?_.defines():[];Qr(G)&&Ce.unshift("#version 300 es"),S&&Ce.push("#define OVERDRAW_INSPECTOR;"),I&&Ce.push("#define TERRAIN3D;"),N&&Ce.push(N),j&&Ce.push(...j);let ze=Ce.concat(Zi.prelude.fragmentSource,O.fragmentSource,u.fragmentSource).join(`
`),Ve=Ce.concat(Zi.prelude.vertexSource,O.vertexSource,u.vertexSource).join(`
`);Qr(G)||(ze=(function(rt){return rt.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")})(ze),Ve=(function(rt){return rt.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")})(Ve));const Ie=G.createShader(G.FRAGMENT_SHADER);if(G.isContextLost())return void(this.failedToCreate=!0);if(G.shaderSource(Ie,ze),G.compileShader(Ie),!G.getShaderParameter(Ie,G.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${G.getShaderInfoLog(Ie)}`);G.attachShader(this.program,Ie);const Ye=G.createShader(G.VERTEX_SHADER);if(G.isContextLost())return void(this.failedToCreate=!0);if(G.shaderSource(Ye,Ve),G.compileShader(Ye),!G.getShaderParameter(Ye,G.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${G.getShaderInfoLog(Ye)}`);G.attachShader(this.program,Ye),this.attributes={};const ct={};this.numAttributes=ee.length;for(let rt=0;rt<this.numAttributes;rt++)ee[rt]&&(G.bindAttribLocation(this.program,rt,ee[rt]),this.attributes[ee[rt]]=rt);if(G.linkProgram(this.program),!G.getProgramParameter(this.program,G.LINK_STATUS))throw new Error(`Program failed to link: ${G.getProgramInfoLog(this.program)}`);G.deleteShader(Ye),G.deleteShader(Ie);for(let rt=0;rt<Pe.length;rt++){const st=Pe[rt];if(st&&!ct[st]){const lt=G.getUniformLocation(this.program,st);lt&&(ct[st]=lt)}}this.fixedUniforms=b(i,ct),this.terrainUniforms=((rt,st)=>({u_depth:new c.bP(rt,st.u_depth),u_terrain:new c.bP(rt,st.u_terrain),u_terrain_dim:new c.bg(rt,st.u_terrain_dim),u_terrain_matrix:new c.bR(rt,st.u_terrain_matrix),u_terrain_unpack:new c.bS(rt,st.u_terrain_unpack),u_terrain_exaggeration:new c.bg(rt,st.u_terrain_exaggeration)}))(i,ct),this.projectionUniforms=((rt,st)=>({u_projection_matrix:new c.bR(rt,st.u_projection_matrix),u_projection_tile_mercator_coords:new c.bS(rt,st.u_projection_tile_mercator_coords),u_projection_clipping_plane:new c.bS(rt,st.u_projection_clipping_plane),u_projection_transition:new c.bg(rt,st.u_projection_transition),u_projection_fallback_matrix:new c.bR(rt,st.u_projection_fallback_matrix)}))(i,ct),this.binderUniforms=_?_.getUniforms(i,ct):[]}draw(i,u,_,b,S,I,O,N,j,G,K,Z,ee,ae,ge,me,ve,we,Pe){const Ce=i.gl;if(this.failedToCreate)return;if(i.program.set(this.program),i.setDepthMode(_),i.setStencilMode(b),i.setColorMode(S),i.setCullFace(I),N){i.activeTexture.set(Ce.TEXTURE2),Ce.bindTexture(Ce.TEXTURE_2D,N.depthTexture),i.activeTexture.set(Ce.TEXTURE3),Ce.bindTexture(Ce.TEXTURE_2D,N.texture);for(const Ve in this.terrainUniforms)this.terrainUniforms[Ve].set(N[Ve])}if(j)for(const Ve in j)this.projectionUniforms[at[Ve]].set(j[Ve]);if(O)for(const Ve in this.fixedUniforms)this.fixedUniforms[Ve].set(O[Ve]);me&&me.setUniforms(i,this.binderUniforms,ae,{zoom:ge});let ze=0;switch(u){case Ce.LINES:ze=2;break;case Ce.TRIANGLES:ze=3;break;case Ce.LINE_STRIP:ze=1}for(const Ve of ee.get()){const Ie=Ve.vaos||(Ve.vaos={});(Ie[G]||(Ie[G]=new ne)).bind(i,this,K,me?me.getPaintVertexBuffers():[],Z,Ve.vertexOffset,ve,we,Pe),Ce.drawElements(u,Ve.primitiveLength*ze,Ce.UNSIGNED_SHORT,Ve.primitiveOffset*ze*2)}}}function Ln(T,i,u){const _=1/c.aC(u,1,i.transform.tileZoom),b=Math.pow(2,u.tileID.overscaledZ),S=u.tileSize*Math.pow(2,i.transform.tileZoom)/b,I=S*(u.tileID.canonical.x+u.tileID.wrap*b),O=S*u.tileID.canonical.y;return{u_image:0,u_texsize:u.imageAtlasTexture.size,u_scale:[_,T.fromScale,T.toScale],u_fade:T.t,u_pixel_coord_upper:[I>>16,O>>16],u_pixel_coord_lower:[65535&I,65535&O]}}const Kn=(T,i,u,_)=>{const b=T.style.light,S=b.properties.get("position"),I=[S.x,S.y,S.z],O=c.bV();b.properties.get("anchor")==="viewport"&&c.bW(O,T.transform.bearingInRadians),c.bX(I,I,O);const N=T.transform.transformLightDirection(I),j=b.properties.get("color");return{u_lightpos:I,u_lightpos_globe:N,u_lightintensity:b.properties.get("intensity"),u_lightcolor:[j.r,j.g,j.b],u_vertical_gradient:+i,u_opacity:u,u_fill_translate:_}},Ti=(T,i,u,_,b,S,I)=>c.e(Kn(T,i,u,_),Ln(S,T,I),{u_height_factor:-Math.pow(2,b.overscaledZ)/I.tileSize/8}),Xi=(T,i,u,_)=>c.e(Ln(i,T,u),{u_fill_translate:_}),Ga=(T,i)=>({u_world:T,u_fill_translate:i}),Ha=(T,i,u,_,b)=>c.e(Xi(T,i,u,b),{u_world:_}),Ks=(T,i,u,_,b)=>{const S=T.transform;let I,O,N=0;if(u.paint.get("circle-pitch-alignment")==="map"){const j=c.aC(i,1,S.zoom);I=!0,O=[j,j],N=j/(c.$*Math.pow(2,i.tileID.overscaledZ))*2*Math.PI*b}else I=!1,O=S.pixelsToGLUnits;return{u_camera_to_center_distance:S.cameraToCenterDistance,u_scale_with_map:+(u.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+I,u_device_pixel_ratio:T.pixelRatio,u_extrude_scale:O,u_globe_extrude_scale:N,u_translate:_}},Ss=T=>({u_pixel_extrude_scale:[1/T.width,1/T.height]}),mu=T=>({u_viewport_size:[T.width,T.height]}),Xs=(T,i=1)=>({u_color:T,u_overlay:0,u_overlay_scale:i}),gu=(T,i,u,_)=>{const b=c.aC(T,1,i)/(c.$*Math.pow(2,T.tileID.overscaledZ))*2*Math.PI*_;return{u_extrude_scale:c.aC(T,1,i),u_intensity:u,u_globe_extrude_scale:b}},Ys=(T,i,u,_)=>{const b=c.L();c.bY(b,0,T.width,T.height,0,0,1);const S=T.context.gl;return{u_matrix:b,u_world:[S.drawingBufferWidth,S.drawingBufferHeight],u_image:u,u_color_ramp:_,u_opacity:i.paint.get("heatmap-opacity")}},Ku=(T,i,u)=>{const _=u.paint.get("hillshade-accent-color");let b;switch(u.paint.get("hillshade-method")){case"basic":b=4;break;case"combined":b=1;break;case"igor":b=2;break;case"multidirectional":b=3;break;default:b=0}const S=u.getIlluminationProperties();for(let I=0;I<S.directionRadians.length;I++)u.paint.get("hillshade-illumination-anchor")==="viewport"&&(S.directionRadians[I]+=T.transform.bearingInRadians);return{u_image:0,u_latrange:ho(0,i.tileID),u_exaggeration:u.paint.get("hillshade-exaggeration"),u_altitudes:S.altitudeRadians,u_azimuths:S.directionRadians,u_accent:_,u_method:b,u_highlights:S.highlightColor,u_shadows:S.shadowColor}},Jd=(T,i)=>{const u=i.stride,_=c.L();return c.bY(_,0,c.$,-c.$,0,0,1),c.M(_,_,[0,-c.$,0]),{u_matrix:_,u_image:1,u_dimension:[u,u],u_zoom:T.overscaledZ,u_unpack:i.getUnpackVector()}};function ho(T,i){const u=Math.pow(2,i.canonical.z),_=i.canonical.y;return[new c.a1(0,_/u).toLngLat().lat,new c.a1(0,(_+1)/u).toLngLat().lat]}const rd=(T,i,u=0)=>({u_image:0,u_unpack:i.getUnpackVector(),u_dimension:[i.stride,i.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:u,u_opacity:T.paint.get("color-relief-opacity")}),Qs=(T,i,u,_)=>{const b=T.transform;return{u_translation:yh(T,i,u),u_ratio:_/c.aC(i,1,b.zoom),u_device_pixel_ratio:T.pixelRatio,u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]]}},Xu=(T,i,u,_,b)=>c.e(Qs(T,i,u,_),{u_image:0,u_image_height:b}),Yu=(T,i,u,_,b)=>{const S=T.transform,I=_u(i,S);return{u_translation:yh(T,i,u),u_texsize:i.imageAtlasTexture.size,u_ratio:_/c.aC(i,1,S.zoom),u_device_pixel_ratio:T.pixelRatio,u_image:0,u_scale:[I,b.fromScale,b.toScale],u_fade:b.t,u_units_to_pixels:[1/S.pixelsToGLUnits[0],1/S.pixelsToGLUnits[1]]}},ko=(T,i,u,_,b,S)=>{const I=T.lineAtlas,O=_u(i,T.transform),N=u.layout.get("line-cap")==="round",j=I.getDash(b.from,N),G=I.getDash(b.to,N),K=j.width*S.fromScale,Z=G.width*S.toScale;return c.e(Qs(T,i,u,_),{u_patternscale_a:[O/K,-j.height/2],u_patternscale_b:[O/Z,-G.height/2],u_sdfgamma:I.width/(256*Math.min(K,Z)*T.pixelRatio)/2,u_image:0,u_tex_y_a:j.y,u_tex_y_b:G.y,u_mix:S.t})};function _u(T,i){return 1/c.aC(T,1,i.tileZoom)}function yh(T,i,u){return c.aD(T.transform,i,u.paint.get("line-translate"),u.paint.get("line-translate-anchor"))}const Es=(T,i,u,_,b)=>{return{u_tl_parent:T,u_scale_parent:i,u_buffer_scale:1,u_fade_t:u.mix,u_opacity:u.opacity*_.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:_.paint.get("raster-brightness-min"),u_brightness_high:_.paint.get("raster-brightness-max"),u_saturation_factor:(I=_.paint.get("raster-saturation"),I>0?1-1/(1.001-I):-I),u_contrast_factor:(S=_.paint.get("raster-contrast"),S>0?1/(1-S):1+S),u_spin_weights:Qu(_.paint.get("raster-hue-rotate")),u_coords_top:[b[0].x,b[0].y,b[1].x,b[1].y],u_coords_bottom:[b[3].x,b[3].y,b[2].x,b[2].y]};var S,I};function Qu(T){T*=Math.PI/180;const i=Math.sin(T),u=Math.cos(T);return[(2*u+1)/3,(-Math.sqrt(3)*i-u+1)/3,(Math.sqrt(3)*i-u+1)/3]}const Ju=(T,i,u,_,b,S,I,O,N,j,G,K,Z)=>{const ee=I.transform;return{u_is_size_zoom_constant:+(T==="constant"||T==="source"),u_is_size_feature_constant:+(T==="constant"||T==="camera"),u_size_t:i?i.uSizeT:0,u_size:i?i.uSize:0,u_camera_to_center_distance:ee.cameraToCenterDistance,u_pitch:ee.pitch/360*2*Math.PI,u_rotate_symbol:+u,u_aspect_ratio:ee.width/ee.height,u_fade_change:I.options.fadeDuration?I.symbolFadeChange:1,u_label_plane_matrix:O,u_coord_matrix:N,u_is_text:+G,u_pitch_with_map:+_,u_is_along_line:b,u_is_variable_anchor:S,u_texsize:K,u_texture:0,u_translation:j,u_pitched_scale:Z}},Fc=(T,i,u,_,b,S,I,O,N,j,G,K,Z,ee)=>{const ae=I.transform;return c.e(Ju(T,i,u,_,b,S,I,O,N,j,G,K,ee),{u_gamma_scale:_?Math.cos(ae.pitch*Math.PI/180)*ae.cameraToCenterDistance:1,u_device_pixel_ratio:I.pixelRatio,u_is_halo:1})},ef=(T,i,u,_,b,S,I,O,N,j,G,K,Z)=>c.e(Fc(T,i,u,_,b,S,I,O,N,j,!0,G,0,Z),{u_texsize_icon:K,u_texture_icon:1}),ul=(T,i)=>({u_opacity:T,u_color:i}),tf=(T,i,u,_,b)=>c.e((function(S,I,O,N){const j=O.imageManager.getPattern(S.from.toString()),G=O.imageManager.getPattern(S.to.toString()),{width:K,height:Z}=O.imageManager.getPixelSize(),ee=Math.pow(2,N.tileID.overscaledZ),ae=N.tileSize*Math.pow(2,O.transform.tileZoom)/ee,ge=ae*(N.tileID.canonical.x+N.tileID.wrap*ee),me=ae*N.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:j.tl,u_pattern_br_a:j.br,u_pattern_tl_b:G.tl,u_pattern_br_b:G.br,u_texsize:[K,Z],u_mix:I.t,u_pattern_size_a:j.displaySize,u_pattern_size_b:G.displaySize,u_scale_a:I.fromScale,u_scale_b:I.toScale,u_tile_units_to_pixels:1/c.aC(N,1,O.transform.tileZoom),u_pixel_coord_upper:[ge>>16,me>>16],u_pixel_coord_lower:[65535&ge,65535&me]}})(u,b,i,_),{u_opacity:T}),Kl=(T,i)=>{},ad={fillExtrusion:(T,i)=>({u_lightpos:new c.bT(T,i.u_lightpos),u_lightpos_globe:new c.bT(T,i.u_lightpos_globe),u_lightintensity:new c.bg(T,i.u_lightintensity),u_lightcolor:new c.bT(T,i.u_lightcolor),u_vertical_gradient:new c.bg(T,i.u_vertical_gradient),u_opacity:new c.bg(T,i.u_opacity),u_fill_translate:new c.bU(T,i.u_fill_translate)}),fillExtrusionPattern:(T,i)=>({u_lightpos:new c.bT(T,i.u_lightpos),u_lightpos_globe:new c.bT(T,i.u_lightpos_globe),u_lightintensity:new c.bg(T,i.u_lightintensity),u_lightcolor:new c.bT(T,i.u_lightcolor),u_vertical_gradient:new c.bg(T,i.u_vertical_gradient),u_height_factor:new c.bg(T,i.u_height_factor),u_opacity:new c.bg(T,i.u_opacity),u_fill_translate:new c.bU(T,i.u_fill_translate),u_image:new c.bP(T,i.u_image),u_texsize:new c.bU(T,i.u_texsize),u_pixel_coord_upper:new c.bU(T,i.u_pixel_coord_upper),u_pixel_coord_lower:new c.bU(T,i.u_pixel_coord_lower),u_scale:new c.bT(T,i.u_scale),u_fade:new c.bg(T,i.u_fade)}),fill:(T,i)=>({u_fill_translate:new c.bU(T,i.u_fill_translate)}),fillPattern:(T,i)=>({u_image:new c.bP(T,i.u_image),u_texsize:new c.bU(T,i.u_texsize),u_pixel_coord_upper:new c.bU(T,i.u_pixel_coord_upper),u_pixel_coord_lower:new c.bU(T,i.u_pixel_coord_lower),u_scale:new c.bT(T,i.u_scale),u_fade:new c.bg(T,i.u_fade),u_fill_translate:new c.bU(T,i.u_fill_translate)}),fillOutline:(T,i)=>({u_world:new c.bU(T,i.u_world),u_fill_translate:new c.bU(T,i.u_fill_translate)}),fillOutlinePattern:(T,i)=>({u_world:new c.bU(T,i.u_world),u_image:new c.bP(T,i.u_image),u_texsize:new c.bU(T,i.u_texsize),u_pixel_coord_upper:new c.bU(T,i.u_pixel_coord_upper),u_pixel_coord_lower:new c.bU(T,i.u_pixel_coord_lower),u_scale:new c.bT(T,i.u_scale),u_fade:new c.bg(T,i.u_fade),u_fill_translate:new c.bU(T,i.u_fill_translate)}),circle:(T,i)=>({u_camera_to_center_distance:new c.bg(T,i.u_camera_to_center_distance),u_scale_with_map:new c.bP(T,i.u_scale_with_map),u_pitch_with_map:new c.bP(T,i.u_pitch_with_map),u_extrude_scale:new c.bU(T,i.u_extrude_scale),u_device_pixel_ratio:new c.bg(T,i.u_device_pixel_ratio),u_globe_extrude_scale:new c.bg(T,i.u_globe_extrude_scale),u_translate:new c.bU(T,i.u_translate)}),collisionBox:(T,i)=>({u_pixel_extrude_scale:new c.bU(T,i.u_pixel_extrude_scale)}),collisionCircle:(T,i)=>({u_viewport_size:new c.bU(T,i.u_viewport_size)}),debug:(T,i)=>({u_color:new c.bQ(T,i.u_color),u_overlay:new c.bP(T,i.u_overlay),u_overlay_scale:new c.bg(T,i.u_overlay_scale)}),depth:Kl,clippingMask:Kl,heatmap:(T,i)=>({u_extrude_scale:new c.bg(T,i.u_extrude_scale),u_intensity:new c.bg(T,i.u_intensity),u_globe_extrude_scale:new c.bg(T,i.u_globe_extrude_scale)}),heatmapTexture:(T,i)=>({u_matrix:new c.bR(T,i.u_matrix),u_world:new c.bU(T,i.u_world),u_image:new c.bP(T,i.u_image),u_color_ramp:new c.bP(T,i.u_color_ramp),u_opacity:new c.bg(T,i.u_opacity)}),hillshade:(T,i)=>({u_image:new c.bP(T,i.u_image),u_latrange:new c.bU(T,i.u_latrange),u_exaggeration:new c.bg(T,i.u_exaggeration),u_altitudes:new c.b_(T,i.u_altitudes),u_azimuths:new c.b_(T,i.u_azimuths),u_accent:new c.bQ(T,i.u_accent),u_method:new c.bP(T,i.u_method),u_shadows:new c.bZ(T,i.u_shadows),u_highlights:new c.bZ(T,i.u_highlights)}),hillshadePrepare:(T,i)=>({u_matrix:new c.bR(T,i.u_matrix),u_image:new c.bP(T,i.u_image),u_dimension:new c.bU(T,i.u_dimension),u_zoom:new c.bg(T,i.u_zoom),u_unpack:new c.bS(T,i.u_unpack)}),colorRelief:(T,i)=>({u_image:new c.bP(T,i.u_image),u_unpack:new c.bS(T,i.u_unpack),u_dimension:new c.bU(T,i.u_dimension),u_elevation_stops:new c.bP(T,i.u_elevation_stops),u_color_stops:new c.bP(T,i.u_color_stops),u_color_ramp_size:new c.bP(T,i.u_color_ramp_size),u_opacity:new c.bg(T,i.u_opacity)}),line:(T,i)=>({u_translation:new c.bU(T,i.u_translation),u_ratio:new c.bg(T,i.u_ratio),u_device_pixel_ratio:new c.bg(T,i.u_device_pixel_ratio),u_units_to_pixels:new c.bU(T,i.u_units_to_pixels)}),lineGradient:(T,i)=>({u_translation:new c.bU(T,i.u_translation),u_ratio:new c.bg(T,i.u_ratio),u_device_pixel_ratio:new c.bg(T,i.u_device_pixel_ratio),u_units_to_pixels:new c.bU(T,i.u_units_to_pixels),u_image:new c.bP(T,i.u_image),u_image_height:new c.bg(T,i.u_image_height)}),linePattern:(T,i)=>({u_translation:new c.bU(T,i.u_translation),u_texsize:new c.bU(T,i.u_texsize),u_ratio:new c.bg(T,i.u_ratio),u_device_pixel_ratio:new c.bg(T,i.u_device_pixel_ratio),u_image:new c.bP(T,i.u_image),u_units_to_pixels:new c.bU(T,i.u_units_to_pixels),u_scale:new c.bT(T,i.u_scale),u_fade:new c.bg(T,i.u_fade)}),lineSDF:(T,i)=>({u_translation:new c.bU(T,i.u_translation),u_ratio:new c.bg(T,i.u_ratio),u_device_pixel_ratio:new c.bg(T,i.u_device_pixel_ratio),u_units_to_pixels:new c.bU(T,i.u_units_to_pixels),u_patternscale_a:new c.bU(T,i.u_patternscale_a),u_patternscale_b:new c.bU(T,i.u_patternscale_b),u_sdfgamma:new c.bg(T,i.u_sdfgamma),u_image:new c.bP(T,i.u_image),u_tex_y_a:new c.bg(T,i.u_tex_y_a),u_tex_y_b:new c.bg(T,i.u_tex_y_b),u_mix:new c.bg(T,i.u_mix)}),raster:(T,i)=>({u_tl_parent:new c.bU(T,i.u_tl_parent),u_scale_parent:new c.bg(T,i.u_scale_parent),u_buffer_scale:new c.bg(T,i.u_buffer_scale),u_fade_t:new c.bg(T,i.u_fade_t),u_opacity:new c.bg(T,i.u_opacity),u_image0:new c.bP(T,i.u_image0),u_image1:new c.bP(T,i.u_image1),u_brightness_low:new c.bg(T,i.u_brightness_low),u_brightness_high:new c.bg(T,i.u_brightness_high),u_saturation_factor:new c.bg(T,i.u_saturation_factor),u_contrast_factor:new c.bg(T,i.u_contrast_factor),u_spin_weights:new c.bT(T,i.u_spin_weights),u_coords_top:new c.bS(T,i.u_coords_top),u_coords_bottom:new c.bS(T,i.u_coords_bottom)}),symbolIcon:(T,i)=>({u_is_size_zoom_constant:new c.bP(T,i.u_is_size_zoom_constant),u_is_size_feature_constant:new c.bP(T,i.u_is_size_feature_constant),u_size_t:new c.bg(T,i.u_size_t),u_size:new c.bg(T,i.u_size),u_camera_to_center_distance:new c.bg(T,i.u_camera_to_center_distance),u_pitch:new c.bg(T,i.u_pitch),u_rotate_symbol:new c.bP(T,i.u_rotate_symbol),u_aspect_ratio:new c.bg(T,i.u_aspect_ratio),u_fade_change:new c.bg(T,i.u_fade_change),u_label_plane_matrix:new c.bR(T,i.u_label_plane_matrix),u_coord_matrix:new c.bR(T,i.u_coord_matrix),u_is_text:new c.bP(T,i.u_is_text),u_pitch_with_map:new c.bP(T,i.u_pitch_with_map),u_is_along_line:new c.bP(T,i.u_is_along_line),u_is_variable_anchor:new c.bP(T,i.u_is_variable_anchor),u_texsize:new c.bU(T,i.u_texsize),u_texture:new c.bP(T,i.u_texture),u_translation:new c.bU(T,i.u_translation),u_pitched_scale:new c.bg(T,i.u_pitched_scale)}),symbolSDF:(T,i)=>({u_is_size_zoom_constant:new c.bP(T,i.u_is_size_zoom_constant),u_is_size_feature_constant:new c.bP(T,i.u_is_size_feature_constant),u_size_t:new c.bg(T,i.u_size_t),u_size:new c.bg(T,i.u_size),u_camera_to_center_distance:new c.bg(T,i.u_camera_to_center_distance),u_pitch:new c.bg(T,i.u_pitch),u_rotate_symbol:new c.bP(T,i.u_rotate_symbol),u_aspect_ratio:new c.bg(T,i.u_aspect_ratio),u_fade_change:new c.bg(T,i.u_fade_change),u_label_plane_matrix:new c.bR(T,i.u_label_plane_matrix),u_coord_matrix:new c.bR(T,i.u_coord_matrix),u_is_text:new c.bP(T,i.u_is_text),u_pitch_with_map:new c.bP(T,i.u_pitch_with_map),u_is_along_line:new c.bP(T,i.u_is_along_line),u_is_variable_anchor:new c.bP(T,i.u_is_variable_anchor),u_texsize:new c.bU(T,i.u_texsize),u_texture:new c.bP(T,i.u_texture),u_gamma_scale:new c.bg(T,i.u_gamma_scale),u_device_pixel_ratio:new c.bg(T,i.u_device_pixel_ratio),u_is_halo:new c.bP(T,i.u_is_halo),u_translation:new c.bU(T,i.u_translation),u_pitched_scale:new c.bg(T,i.u_pitched_scale)}),symbolTextAndIcon:(T,i)=>({u_is_size_zoom_constant:new c.bP(T,i.u_is_size_zoom_constant),u_is_size_feature_constant:new c.bP(T,i.u_is_size_feature_constant),u_size_t:new c.bg(T,i.u_size_t),u_size:new c.bg(T,i.u_size),u_camera_to_center_distance:new c.bg(T,i.u_camera_to_center_distance),u_pitch:new c.bg(T,i.u_pitch),u_rotate_symbol:new c.bP(T,i.u_rotate_symbol),u_aspect_ratio:new c.bg(T,i.u_aspect_ratio),u_fade_change:new c.bg(T,i.u_fade_change),u_label_plane_matrix:new c.bR(T,i.u_label_plane_matrix),u_coord_matrix:new c.bR(T,i.u_coord_matrix),u_is_text:new c.bP(T,i.u_is_text),u_pitch_with_map:new c.bP(T,i.u_pitch_with_map),u_is_along_line:new c.bP(T,i.u_is_along_line),u_is_variable_anchor:new c.bP(T,i.u_is_variable_anchor),u_texsize:new c.bU(T,i.u_texsize),u_texsize_icon:new c.bU(T,i.u_texsize_icon),u_texture:new c.bP(T,i.u_texture),u_texture_icon:new c.bP(T,i.u_texture_icon),u_gamma_scale:new c.bg(T,i.u_gamma_scale),u_device_pixel_ratio:new c.bg(T,i.u_device_pixel_ratio),u_is_halo:new c.bP(T,i.u_is_halo),u_translation:new c.bU(T,i.u_translation),u_pitched_scale:new c.bg(T,i.u_pitched_scale)}),background:(T,i)=>({u_opacity:new c.bg(T,i.u_opacity),u_color:new c.bQ(T,i.u_color)}),backgroundPattern:(T,i)=>({u_opacity:new c.bg(T,i.u_opacity),u_image:new c.bP(T,i.u_image),u_pattern_tl_a:new c.bU(T,i.u_pattern_tl_a),u_pattern_br_a:new c.bU(T,i.u_pattern_br_a),u_pattern_tl_b:new c.bU(T,i.u_pattern_tl_b),u_pattern_br_b:new c.bU(T,i.u_pattern_br_b),u_texsize:new c.bU(T,i.u_texsize),u_mix:new c.bg(T,i.u_mix),u_pattern_size_a:new c.bU(T,i.u_pattern_size_a),u_pattern_size_b:new c.bU(T,i.u_pattern_size_b),u_scale_a:new c.bg(T,i.u_scale_a),u_scale_b:new c.bg(T,i.u_scale_b),u_pixel_coord_upper:new c.bU(T,i.u_pixel_coord_upper),u_pixel_coord_lower:new c.bU(T,i.u_pixel_coord_lower),u_tile_units_to_pixels:new c.bg(T,i.u_tile_units_to_pixels)}),terrain:(T,i)=>({u_texture:new c.bP(T,i.u_texture),u_ele_delta:new c.bg(T,i.u_ele_delta),u_fog_matrix:new c.bR(T,i.u_fog_matrix),u_fog_color:new c.bQ(T,i.u_fog_color),u_fog_ground_blend:new c.bg(T,i.u_fog_ground_blend),u_fog_ground_blend_opacity:new c.bg(T,i.u_fog_ground_blend_opacity),u_horizon_color:new c.bQ(T,i.u_horizon_color),u_horizon_fog_blend:new c.bg(T,i.u_horizon_fog_blend),u_is_globe_mode:new c.bg(T,i.u_is_globe_mode)}),terrainDepth:(T,i)=>({u_ele_delta:new c.bg(T,i.u_ele_delta)}),terrainCoords:(T,i)=>({u_texture:new c.bP(T,i.u_texture),u_terrain_coords_id:new c.bg(T,i.u_terrain_coords_id),u_ele_delta:new c.bg(T,i.u_ele_delta)}),projectionErrorMeasurement:(T,i)=>({u_input:new c.bg(T,i.u_input),u_output_expected:new c.bg(T,i.u_output_expected)}),atmosphere:(T,i)=>({u_sun_pos:new c.bT(T,i.u_sun_pos),u_atmosphere_blend:new c.bg(T,i.u_atmosphere_blend),u_globe_position:new c.bT(T,i.u_globe_position),u_globe_radius:new c.bg(T,i.u_globe_radius),u_inv_proj_matrix:new c.bR(T,i.u_inv_proj_matrix)}),sky:(T,i)=>({u_sky_color:new c.bQ(T,i.u_sky_color),u_horizon_color:new c.bQ(T,i.u_horizon_color),u_horizon:new c.bU(T,i.u_horizon),u_horizon_normal:new c.bU(T,i.u_horizon_normal),u_sky_horizon_blend:new c.bg(T,i.u_sky_horizon_blend),u_sky_blend:new c.bg(T,i.u_sky_blend)})};class cl{constructor(i,u,_){this.context=i;const b=i.gl;this.buffer=b.createBuffer(),this.dynamicDraw=!!_,this.context.unbindVAO(),i.bindElementBuffer.set(this.buffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||delete u.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(i){const u=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),u.bufferSubData(u.ELEMENT_ARRAY_BUFFER,0,i.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const aa={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class As{constructor(i,u,_,b){this.length=u.length,this.attributes=_,this.itemSize=u.bytesPerElement,this.dynamicDraw=b,this.context=i;const S=i.gl;this.buffer=S.createBuffer(),i.bindVertexBuffer.set(this.buffer),S.bufferData(S.ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?S.DYNAMIC_DRAW:S.STATIC_DRAW),this.dynamicDraw||delete u.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(i){if(i.length!==this.length)throw new Error(`Length of new data is ${i.length}, which doesn't match current length of ${this.length}`);const u=this.context.gl;this.bind(),u.bufferSubData(u.ARRAY_BUFFER,0,i.arrayBuffer)}enableAttributes(i,u){for(let _=0;_<this.attributes.length;_++){const b=u.attributes[this.attributes[_].name];b!==void 0&&i.enableVertexAttribArray(b)}}setVertexAttribPointers(i,u,_){for(let b=0;b<this.attributes.length;b++){const S=this.attributes[b],I=u.attributes[S.name];I!==void 0&&i.vertexAttribPointer(I,S.components,i[aa[S.type]],!1,this.itemSize,S.offset+this.itemSize*(_||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class li{constructor(i){this.gl=i.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(i){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class yu extends li{getDefault(){return c.bf.transparent}set(i){const u=this.current;(i.r!==u.r||i.g!==u.g||i.b!==u.b||i.a!==u.a||this.dirty)&&(this.gl.clearColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class ec extends li{getDefault(){return 1}set(i){(i!==this.current||this.dirty)&&(this.gl.clearDepth(i),this.current=i,this.dirty=!1)}}class tc extends li{getDefault(){return 0}set(i){(i!==this.current||this.dirty)&&(this.gl.clearStencil(i),this.current=i,this.dirty=!1)}}class hl extends li{getDefault(){return[!0,!0,!0,!0]}set(i){const u=this.current;(i[0]!==u[0]||i[1]!==u[1]||i[2]!==u[2]||i[3]!==u[3]||this.dirty)&&(this.gl.colorMask(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class dl extends li{getDefault(){return!0}set(i){(i!==this.current||this.dirty)&&(this.gl.depthMask(i),this.current=i,this.dirty=!1)}}class fl extends li{getDefault(){return 255}set(i){(i!==this.current||this.dirty)&&(this.gl.stencilMask(i),this.current=i,this.dirty=!1)}}class vh extends li{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(i){const u=this.current;(i.func!==u.func||i.ref!==u.ref||i.mask!==u.mask||this.dirty)&&(this.gl.stencilFunc(i.func,i.ref,i.mask),this.current=i,this.dirty=!1)}}class Vc extends li{getDefault(){const i=this.gl;return[i.KEEP,i.KEEP,i.KEEP]}set(i){const u=this.current;(i[0]!==u[0]||i[1]!==u[1]||i[2]!==u[2]||this.dirty)&&(this.gl.stencilOp(i[0],i[1],i[2]),this.current=i,this.dirty=!1)}}class nc extends li{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const u=this.gl;i?u.enable(u.STENCIL_TEST):u.disable(u.STENCIL_TEST),this.current=i,this.dirty=!1}}class nf extends li{getDefault(){return[0,1]}set(i){const u=this.current;(i[0]!==u[0]||i[1]!==u[1]||this.dirty)&&(this.gl.depthRange(i[0],i[1]),this.current=i,this.dirty=!1)}}class Fl extends li{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const u=this.gl;i?u.enable(u.DEPTH_TEST):u.disable(u.DEPTH_TEST),this.current=i,this.dirty=!1}}class ic extends li{getDefault(){return this.gl.LESS}set(i){(i!==this.current||this.dirty)&&(this.gl.depthFunc(i),this.current=i,this.dirty=!1)}}class Uc extends li{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const u=this.gl;i?u.enable(u.BLEND):u.disable(u.BLEND),this.current=i,this.dirty=!1}}class jc extends li{getDefault(){const i=this.gl;return[i.ONE,i.ZERO]}set(i){const u=this.current;(i[0]!==u[0]||i[1]!==u[1]||this.dirty)&&(this.gl.blendFunc(i[0],i[1]),this.current=i,this.dirty=!1)}}class sa extends li{getDefault(){return c.bf.transparent}set(i){const u=this.current;(i.r!==u.r||i.g!==u.g||i.b!==u.b||i.a!==u.a||this.dirty)&&(this.gl.blendColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class Xl extends li{getDefault(){return this.gl.FUNC_ADD}set(i){(i!==this.current||this.dirty)&&(this.gl.blendEquation(i),this.current=i,this.dirty=!1)}}class bh extends li{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const u=this.gl;i?u.enable(u.CULL_FACE):u.disable(u.CULL_FACE),this.current=i,this.dirty=!1}}class Lo extends li{getDefault(){return this.gl.BACK}set(i){(i!==this.current||this.dirty)&&(this.gl.cullFace(i),this.current=i,this.dirty=!1)}}class $c extends li{getDefault(){return this.gl.CCW}set(i){(i!==this.current||this.dirty)&&(this.gl.frontFace(i),this.current=i,this.dirty=!1)}}class vu extends li{getDefault(){return null}set(i){(i!==this.current||this.dirty)&&(this.gl.useProgram(i),this.current=i,this.dirty=!1)}}class fo extends li{getDefault(){return this.gl.TEXTURE0}set(i){(i!==this.current||this.dirty)&&(this.gl.activeTexture(i),this.current=i,this.dirty=!1)}}class bu extends li{getDefault(){const i=this.gl;return[0,0,i.drawingBufferWidth,i.drawingBufferHeight]}set(i){const u=this.current;(i[0]!==u[0]||i[1]!==u[1]||i[2]!==u[2]||i[3]!==u[3]||this.dirty)&&(this.gl.viewport(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class sd extends li{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const u=this.gl;u.bindFramebuffer(u.FRAMEBUFFER,i),this.current=i,this.dirty=!1}}class pl extends li{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const u=this.gl;u.bindRenderbuffer(u.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class ma extends li{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const u=this.gl;u.bindTexture(u.TEXTURE_2D,i),this.current=i,this.dirty=!1}}class Yl extends li{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const u=this.gl;u.bindBuffer(u.ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class ns extends li{getDefault(){return null}set(i){const u=this.gl;u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class ga extends li{getDefault(){return null}set(i){var u;if(i===this.current&&!this.dirty)return;const _=this.gl;Qr(_)?_.bindVertexArray(i):(u=_.getExtension("OES_vertex_array_object"))===null||u===void 0||u.bindVertexArrayOES(i),this.current=i,this.dirty=!1}}class xu extends li{getDefault(){return 4}set(i){if(i===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_ALIGNMENT,i),this.current=i,this.dirty=!1}}class rc extends li{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i),this.current=i,this.dirty=!1}}class Js extends li{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,i),this.current=i,this.dirty=!1}}class ml extends li{constructor(i,u){super(i),this.context=i,this.parent=u}getDefault(){return null}}class Do extends ml{setDirty(){this.dirty=!0}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,i,0),this.current=i,this.dirty=!1}}class Ql extends ml{set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferRenderbuffer(u.FRAMEBUFFER,u.DEPTH_ATTACHMENT,u.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class qn extends ml{set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferRenderbuffer(u.FRAMEBUFFER,u.DEPTH_STENCIL_ATTACHMENT,u.RENDERBUFFER,i),this.current=i,this.dirty=!1}}const zo="Framebuffer is not complete";class Jf{constructor(i,u,_,b,S){this.context=i,this.width=u,this.height=_;const I=i.gl,O=this.framebuffer=I.createFramebuffer();if(this.colorAttachment=new Do(i,O),b)this.depthAttachment=S?new qn(i,O):new Ql(i,O);else if(S)throw new Error("Stencil cannot be set without depth");if(I.checkFramebufferStatus(I.FRAMEBUFFER)!==I.FRAMEBUFFER_COMPLETE)throw new Error(zo)}destroy(){const i=this.context.gl,u=this.colorAttachment.get();if(u&&i.deleteTexture(u),this.depthAttachment){const _=this.depthAttachment.get();_&&i.deleteRenderbuffer(_)}i.deleteFramebuffer(this.framebuffer)}}class is{constructor(i){var u,_;if(this.gl=i,this.clearColor=new yu(this),this.clearDepth=new ec(this),this.clearStencil=new tc(this),this.colorMask=new hl(this),this.depthMask=new dl(this),this.stencilMask=new fl(this),this.stencilFunc=new vh(this),this.stencilOp=new Vc(this),this.stencilTest=new nc(this),this.depthRange=new nf(this),this.depthTest=new Fl(this),this.depthFunc=new ic(this),this.blend=new Uc(this),this.blendFunc=new jc(this),this.blendColor=new sa(this),this.blendEquation=new Xl(this),this.cullFace=new bh(this),this.cullFaceSide=new Lo(this),this.frontFace=new $c(this),this.program=new vu(this),this.activeTexture=new fo(this),this.viewport=new bu(this),this.bindFramebuffer=new sd(this),this.bindRenderbuffer=new pl(this),this.bindTexture=new ma(this),this.bindVertexBuffer=new Yl(this),this.bindElementBuffer=new ns(this),this.bindVertexArray=new ga(this),this.pixelStoreUnpack=new xu(this),this.pixelStoreUnpackPremultiplyAlpha=new rc(this),this.pixelStoreUnpackFlipY=new Js(this),this.extTextureFilterAnisotropic=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=i.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),Qr(i)){this.HALF_FLOAT=i.HALF_FLOAT;const b=i.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(u=i.RGBA16F)!==null&&u!==void 0?u:b==null?void 0:b.RGBA16F_EXT,this.RGB16F=(_=i.RGB16F)!==null&&_!==void 0?_:b==null?void 0:b.RGB16F_EXT,i.getExtension("EXT_color_buffer_float")}else{i.getExtension("EXT_color_buffer_half_float"),i.getExtension("OES_texture_half_float_linear");const b=i.getExtension("OES_texture_half_float");this.HALF_FLOAT=b==null?void 0:b.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(i,u){return new cl(this,i,u)}createVertexBuffer(i,u,_){return new As(this,i,u,_)}createRenderbuffer(i,u,_){const b=this.gl,S=b.createRenderbuffer();return this.bindRenderbuffer.set(S),b.renderbufferStorage(b.RENDERBUFFER,i,u,_),this.bindRenderbuffer.set(null),S}createFramebuffer(i,u,_,b){return new Jf(this,i,u,_,b)}clear({color:i,depth:u,stencil:_}){const b=this.gl;let S=0;i&&(S|=b.COLOR_BUFFER_BIT,this.clearColor.set(i),this.colorMask.set([!0,!0,!0,!0])),u!==void 0&&(S|=b.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(u),this.depthMask.set(!0)),_!==void 0&&(S|=b.STENCIL_BUFFER_BIT,this.clearStencil.set(_),this.stencilMask.set(255)),b.clear(S)}setCullFace(i){i.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(i.mode),this.frontFace.set(i.frontFace))}setDepthMode(i){i.func!==this.gl.ALWAYS||i.mask?(this.depthTest.set(!0),this.depthFunc.set(i.func),this.depthMask.set(i.mask),this.depthRange.set(i.range)):this.depthTest.set(!1)}setStencilMode(i){i.test.func!==this.gl.ALWAYS||i.mask?(this.stencilTest.set(!0),this.stencilMask.set(i.mask),this.stencilOp.set([i.fail,i.depthFail,i.pass]),this.stencilFunc.set({func:i.test.func,ref:i.ref,mask:i.test.mask})):this.stencilTest.set(!1)}setColorMode(i){c.bH(i.blendFunction,bn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(i.blendFunction),this.blendColor.set(i.blendColor)),this.colorMask.set(i.mask)}createVertexArray(){var i;return Qr(this.gl)?this.gl.createVertexArray():(i=this.gl.getExtension("OES_vertex_array_object"))===null||i===void 0?void 0:i.createVertexArrayOES()}deleteVertexArray(i){var u;return Qr(this.gl)?this.gl.deleteVertexArray(i):(u=this.gl.getExtension("OES_vertex_array_object"))===null||u===void 0?void 0:u.deleteVertexArrayOES(i)}unbindVAO(){this.bindVertexArray.set(null)}}let Oo;function No(T,i,u,_,b){const S=T.context,I=T.transform,O=S.gl,N=T.useProgram("collisionBox"),j=[];let G=0,K=0;for(let ve=0;ve<_.length;ve++){const we=_[ve],Pe=i.getTile(we).getBucket(u);if(!Pe)continue;const Ce=b?Pe.textCollisionBox:Pe.iconCollisionBox,ze=Pe.collisionCircleArray;ze.length>0&&(j.push({circleArray:ze,circleOffset:K,coord:we}),G+=ze.length/4,K=G),Ce&&N.draw(S,O.LINES,sn.disabled,$n.disabled,T.colorModeForRenderPass(),fn.disabled,Ss(T.transform),T.style.map.terrain&&T.style.map.terrain.getTerrainData(we),I.getProjectionData({overscaledTileID:we,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),u.id,Ce.layoutVertexBuffer,Ce.indexBuffer,Ce.segments,null,T.transform.zoom,null,null,Ce.collisionVertexBuffer)}if(!b||!j.length)return;const Z=T.useProgram("collisionCircle"),ee=new c.b$;ee.resize(4*G),ee._trim();let ae=0;for(const ve of j)for(let we=0;we<ve.circleArray.length/4;we++){const Pe=4*we,Ce=ve.circleArray[Pe+0],ze=ve.circleArray[Pe+1],Ve=ve.circleArray[Pe+2],Ie=ve.circleArray[Pe+3];ee.emplace(ae++,Ce,ze,Ve,Ie,0),ee.emplace(ae++,Ce,ze,Ve,Ie,1),ee.emplace(ae++,Ce,ze,Ve,Ie,2),ee.emplace(ae++,Ce,ze,Ve,Ie,3)}(!Oo||Oo.length<2*G)&&(Oo=(function(ve){const we=2*ve,Pe=new c.c1;Pe.resize(we),Pe._trim();for(let Ce=0;Ce<we;Ce++){const ze=6*Ce;Pe.uint16[ze+0]=4*Ce+0,Pe.uint16[ze+1]=4*Ce+1,Pe.uint16[ze+2]=4*Ce+2,Pe.uint16[ze+3]=4*Ce+2,Pe.uint16[ze+4]=4*Ce+3,Pe.uint16[ze+5]=4*Ce+0}return Pe})(G));const ge=S.createIndexBuffer(Oo,!0),me=S.createVertexBuffer(ee,c.c0.members,!0);for(const ve of j){const we=mu(T.transform);Z.draw(S,O.TRIANGLES,sn.disabled,$n.disabled,T.colorModeForRenderPass(),fn.disabled,we,T.style.map.terrain&&T.style.map.terrain.getTerrainData(ve.coord),null,u.id,me,ge,c.aM.simpleSegment(0,2*ve.circleOffset,ve.circleArray.length,ve.circleArray.length/2),null,T.transform.zoom,null,null,null)}me.destroy(),ge.destroy()}const od=c.ag(new Float32Array(16));function ac(T,i,u,_,b,S){const{horizontalAlign:I,verticalAlign:O}=c.aH(T);return new c.P((-(I-.5)*i/b+_[0])*S,(-(O-.5)*u/b+_[1])*S)}function wu(T,i,u,_,b,S){const I=i.tileAnchorPoint.add(new c.P(i.translation[0],i.translation[1]));if(i.pitchWithMap){let O=_.mult(S);u||(O=O.rotate(-b));const N=I.add(O);return br(N.x,N.y,i.pitchedLabelPlaneMatrix,i.getElevation).point}if(u){const O=ir(i.tileAnchorPoint.x+1,i.tileAnchorPoint.y,i).point.sub(T),N=Math.atan(O.y/O.x)+(O.x<0?Math.PI:0);return T.add(_.rotate(N))}return T.add(_)}function sc(T,i,u,_,b,S,I,O,N,j,G,K){const Z=T.text.placedSymbolArray,ee=T.text.dynamicLayoutVertexArray,ae=T.icon.dynamicLayoutVertexArray,ge={};ee.clear();for(let me=0;me<Z.length;me++){const ve=Z.get(me),we=ve.hidden||!ve.crossTileID||T.allowVerticalPlacement&&!ve.placedOrientation?null:_[ve.crossTileID];if(we){const Pe=new c.P(ve.anchorX,ve.anchorY),Ce={getElevation:K,width:b.width,height:b.height,pitchedLabelPlaneMatrix:S,pitchWithMap:u,transform:b,tileAnchorPoint:Pe,translation:j,unwrappedTileID:G},ze=u?Ao(Pe.x,Pe.y,Ce):ir(Pe.x,Pe.y,Ce),Ve=Mt(b.cameraToCenterDistance,ze.signedDistanceFromCamera);let Ie=c.ap(T.textSizeData,O,ve)*Ve/c.aB;u&&(Ie*=T.tilePixelRatio/I);const{width:Ye,height:ct,anchor:rt,textOffset:st,textBoxScale:lt}=we,Nt=ac(rt,Ye,ct,st,lt,Ie),Vt=b.getPitchedTextCorrection(Pe.x+j[0],Pe.y+j[1],G),At=wu(ze.point,Ce,i,Nt,-b.bearingInRadians,Vt),ln=T.allowVerticalPlacement&&ve.placedOrientation===c.ao.vertical?Math.PI/2:0;for(let Hn=0;Hn<ve.numGlyphs;Hn++)c.av(ee,At,ln);N&&ve.associatedIconIndex>=0&&(ge[ve.associatedIconIndex]={shiftedAnchor:At,angle:ln})}else Gr(ve.numGlyphs,ee)}if(N){ae.clear();const me=T.icon.placedSymbolArray;for(let ve=0;ve<me.length;ve++){const we=me.get(ve);if(we.hidden)Gr(we.numGlyphs,ae);else{const Pe=ge[ve];if(Pe)for(let Ce=0;Ce<we.numGlyphs;Ce++)c.av(ae,Pe.shiftedAnchor,Pe.angle);else Gr(we.numGlyphs,ae)}}T.icon.dynamicLayoutVertexBuffer.updateData(ae)}T.text.dynamicLayoutVertexBuffer.updateData(ee)}function oc(T,i,u){return u.iconsInText&&i?"symbolTextAndIcon":T?"symbolSDF":"symbolIcon"}function Tu(T,i,u,_,b,S,I,O,N,j,G,K,Z){const ee=T.context,ae=ee.gl,ge=T.transform,me=O==="map",ve=N==="map",we=O!=="viewport"&&u.layout.get("symbol-placement")!=="point",Pe=me&&!ve&&!we,Ce=!u.layout.get("symbol-sort-key").isConstant();let ze=!1;const Ve=T.getDepthModeForSublayer(0,sn.ReadOnly),Ie=u._unevaluatedLayout.hasValue("text-variable-anchor")||u._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Ye=[],ct=ge.getCircleRadiusCorrection();for(const rt of _){const st=i.getTile(rt),lt=st.getBucket(u);if(!lt)continue;const Nt=b?lt.text:lt.icon;if(!Nt||!Nt.segments.get().length||!Nt.hasVisibleVertices)continue;const Vt=Nt.programConfigurations.get(u.id),At=b||lt.sdfIcons,ln=b?lt.textSizeData:lt.iconSizeData,Hn=ve||ge.pitch!==0,bi=T.useProgram(oc(At,b,lt),Vt),Yi=c.an(ln,ge.zoom),$i=T.style.map.terrain&&T.style.map.terrain.getTerrainData(rt);let Mr,Fr,jn,ur,oa=[0,0],Vr=null;if(b)Fr=st.glyphAtlasTexture,jn=ae.LINEAR,Mr=st.glyphAtlasTexture.size,lt.iconsInText&&(oa=st.imageAtlasTexture.size,Vr=st.imageAtlasTexture,ur=Hn||T.options.rotating||T.options.zooming||ln.kind==="composite"||ln.kind==="camera"?ae.LINEAR:ae.NEAREST);else{const la=u.layout.get("icon-size").constantOr(0)!==1||lt.iconsNeedLinear;Fr=st.imageAtlasTexture,jn=At||T.options.rotating||T.options.zooming||la||Hn?ae.LINEAR:ae.NEAREST,Mr=st.imageAtlasTexture.size}const La=c.aC(st,1,T.transform.zoom),Xa=Ir(me,T.transform,La),mo=c.L();c.aq(mo,Xa);const Ru=Vn(ve,me,T.transform,La),su=c.aD(ge,st,S,I),Ph=ge.getProjectionData({overscaledTileID:rt,applyGlobeMatrix:!Z,applyTerrainMatrix:!0}),Xc=Ie&&lt.hasTextData(),yc=u.layout.get("icon-text-fit")!=="none"&&Xc&&lt.hasIconData();if(we){const la=T.style.map.terrain?(Go,ca)=>T.style.map.terrain.getElevation(rt,Go,ca):null,ua=u.layout.get("text-rotation-alignment")==="map";nr(lt,T,b,Xa,mo,ve,j,ua,rt.toUnwrapped(),ge.width,ge.height,su,la)}const vc=b&&Ie||yc,no=we||vc?od:ve?Xa:T.transform.clipSpaceToPixelsMatrix,bl=At&&u.paint.get(b?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let os;os=At?lt.iconsInText?ef(ln.kind,Yi,Pe,ve,we,vc,T,no,Ru,su,Mr,oa,ct):Fc(ln.kind,Yi,Pe,ve,we,vc,T,no,Ru,su,b,Mr,0,ct):Ju(ln.kind,Yi,Pe,ve,we,vc,T,no,Ru,su,b,Mr,ct);const ku={program:bi,buffers:Nt,uniformValues:os,projectionData:Ph,atlasTexture:Fr,atlasTextureIcon:Vr,atlasInterpolation:jn,atlasInterpolationIcon:ur,isSDF:At,hasHalo:bl};if(Ce&&lt.canOverlap){ze=!0;const la=Nt.segments.get();for(const ua of la)Ye.push({segments:new c.aM([ua]),sortKey:ua.sortKey,state:ku,terrainData:$i})}else Ye.push({segments:Nt.segments,sortKey:0,state:ku,terrainData:$i})}ze&&Ye.sort(((rt,st)=>rt.sortKey-st.sortKey));for(const rt of Ye){const st=rt.state;if(ee.activeTexture.set(ae.TEXTURE0),st.atlasTexture.bind(st.atlasInterpolation,ae.CLAMP_TO_EDGE),st.atlasTextureIcon&&(ee.activeTexture.set(ae.TEXTURE1),st.atlasTextureIcon&&st.atlasTextureIcon.bind(st.atlasInterpolationIcon,ae.CLAMP_TO_EDGE)),st.isSDF){const lt=st.uniformValues;st.hasHalo&&(lt.u_is_halo=1,f(st.buffers,rt.segments,u,T,st.program,Ve,G,K,lt,st.projectionData,rt.terrainData)),lt.u_is_halo=0}f(st.buffers,rt.segments,u,T,st.program,Ve,G,K,st.uniformValues,st.projectionData,rt.terrainData)}}function f(T,i,u,_,b,S,I,O,N,j,G){const K=_.context;b.draw(K,K.gl.TRIANGLES,S,I,O,fn.backCCW,N,G,j,u.id,T.layoutVertexBuffer,T.indexBuffer,i,u.paint,_.transform.zoom,T.programConfigurations.get(u.id),T.dynamicLayoutVertexBuffer,T.opacityVertexBuffer)}function x(T,i,u,_,b){const S=T.context,I=S.gl,O=$n.disabled,N=new bn([I.ONE,I.ONE],c.bf.transparent,[!0,!0,!0,!0]),j=i.getBucket(u);if(!j)return;const G=_.key;let K=u.heatmapFbos.get(G);K||(K=U(S,i.tileSize,i.tileSize),u.heatmapFbos.set(G,K)),S.bindFramebuffer.set(K.framebuffer),S.viewport.set([0,0,i.tileSize,i.tileSize]),S.clear({color:c.bf.transparent});const Z=j.programConfigurations.get(u.id),ee=T.useProgram("heatmap",Z,!b),ae=T.transform.getProjectionData({overscaledTileID:i.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),ge=T.style.map.terrain.getTerrainData(_);ee.draw(S,I.TRIANGLES,sn.disabled,O,N,fn.disabled,gu(i,T.transform.zoom,u.paint.get("heatmap-intensity"),1),ge,ae,u.id,j.layoutVertexBuffer,j.indexBuffer,j.segments,u.paint,T.transform.zoom,Z)}function k(T,i,u,_,b){const S=T.context,I=S.gl,O=T.transform;S.setColorMode(T.colorModeForRenderPass());const N=X(S,i),j=u.key,G=i.heatmapFbos.get(j);if(!G)return;S.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,G.colorAttachment.get()),S.activeTexture.set(I.TEXTURE1),N.bind(I.LINEAR,I.CLAMP_TO_EDGE);const K=O.getProjectionData({overscaledTileID:u,applyTerrainMatrix:b,applyGlobeMatrix:!_});T.useProgram("heatmapTexture").draw(S,I.TRIANGLES,sn.disabled,$n.disabled,T.colorModeForRenderPass(),fn.disabled,Ys(T,i,0,1),null,K,i.id,T.rasterBoundsBuffer,T.quadTriangleIndexBuffer,T.rasterBoundsSegments,i.paint,O.zoom),G.destroy(),i.heatmapFbos.delete(j)}function U(T,i,u){var _,b;const S=T.gl,I=S.createTexture();S.bindTexture(S.TEXTURE_2D,I),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_WRAP_S,S.CLAMP_TO_EDGE),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_WRAP_T,S.CLAMP_TO_EDGE),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_MIN_FILTER,S.LINEAR),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_MAG_FILTER,S.LINEAR);const O=(_=T.HALF_FLOAT)!==null&&_!==void 0?_:S.UNSIGNED_BYTE,N=(b=T.RGBA16F)!==null&&b!==void 0?b:S.RGBA;S.texImage2D(S.TEXTURE_2D,0,N,i,u,0,S.RGBA,O,null);const j=T.createFramebuffer(i,u,!1,!1);return j.colorAttachment.set(I),j}function X(T,i){return i.colorRampTexture||(i.colorRampTexture=new c.T(T,i.colorRamp,T.gl.RGBA)),i.colorRampTexture}function ue(T,i,u,_,b){if(!u||!_||!_.imageAtlas)return;const S=_.imageAtlas.patternPositions;let I=S[u.to.toString()],O=S[u.from.toString()];if(!I&&O&&(I=O),!O&&I&&(O=I),!I||!O){const N=b.getPaintProperty(i);I=S[N],O=S[N]}I&&O&&T.setConstantPatternPositions(I,O)}function Ne(T,i,u,_,b,S,I,O){const N=T.context.gl,j="fill-pattern",G=u.paint.get(j),K=G&&G.constantOr(1),Z=u.getCrossfadeParameters();let ee,ae,ge,me,ve;const we=T.transform,Pe=u.paint.get("fill-translate"),Ce=u.paint.get("fill-translate-anchor");I?(ae=K&&!u.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",ee=N.LINES):(ae=K?"fillPattern":"fill",ee=N.TRIANGLES);const ze=G.constantOr(null);for(const Ve of _){const Ie=i.getTile(Ve);if(K&&!Ie.patternsLoaded())continue;const Ye=Ie.getBucket(u);if(!Ye)continue;const ct=Ye.programConfigurations.get(u.id),rt=T.useProgram(ae,ct),st=T.style.map.terrain&&T.style.map.terrain.getTerrainData(Ve);K&&(T.context.activeTexture.set(N.TEXTURE0),Ie.imageAtlasTexture.bind(N.LINEAR,N.CLAMP_TO_EDGE),ct.updatePaintBuffers(Z)),ue(ct,j,ze,Ie,u);const lt=we.getProjectionData({overscaledTileID:Ve,applyGlobeMatrix:!O,applyTerrainMatrix:!0}),Nt=c.aD(we,Ie,Pe,Ce);if(I){me=Ye.indexBuffer2,ve=Ye.segments2;const At=[N.drawingBufferWidth,N.drawingBufferHeight];ge=ae==="fillOutlinePattern"&&K?Ha(T,Z,Ie,At,Nt):Ga(At,Nt)}else me=Ye.indexBuffer,ve=Ye.segments,ge=K?Xi(T,Z,Ie,Nt):{u_fill_translate:Nt};const Vt=T.stencilModeForClipping(Ve);rt.draw(T.context,ee,b,Vt,S,fn.backCCW,ge,st,lt,u.id,Ye.layoutVertexBuffer,me,ve,u.paint,T.transform.zoom,ct)}}function nt(T,i,u,_,b,S,I,O){const N=T.context,j=N.gl,G="fill-extrusion-pattern",K=u.paint.get(G),Z=K.constantOr(1),ee=u.getCrossfadeParameters(),ae=u.paint.get("fill-extrusion-opacity"),ge=K.constantOr(null),me=T.transform;for(const ve of _){const we=i.getTile(ve),Pe=we.getBucket(u);if(!Pe)continue;const Ce=T.style.map.terrain&&T.style.map.terrain.getTerrainData(ve),ze=Pe.programConfigurations.get(u.id),Ve=T.useProgram(Z?"fillExtrusionPattern":"fillExtrusion",ze);Z&&(T.context.activeTexture.set(j.TEXTURE0),we.imageAtlasTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE),ze.updatePaintBuffers(ee));const Ie=me.getProjectionData({overscaledTileID:ve,applyGlobeMatrix:!O,applyTerrainMatrix:!0});ue(ze,G,ge,we,u);const Ye=c.aD(me,we,u.paint.get("fill-extrusion-translate"),u.paint.get("fill-extrusion-translate-anchor")),ct=u.paint.get("fill-extrusion-vertical-gradient"),rt=Z?Ti(T,ct,ae,Ye,ve,ee,we):Kn(T,ct,ae,Ye);Ve.draw(N,N.gl.TRIANGLES,b,S,I,fn.backCCW,rt,Ce,Ie,u.id,Pe.layoutVertexBuffer,Pe.indexBuffer,Pe.segments,u.paint,T.transform.zoom,ze,T.style.map.terrain&&Pe.centroidVertexBuffer)}}function ut(T,i,u,_,b,S,I,O,N){var j;const G=T.style.projection,K=T.context,Z=T.transform,ee=K.gl,ae=[`#define NUM_ILLUMINATION_SOURCES ${u.paint.get("hillshade-highlight-color").values.length}`],ge=T.useProgram("hillshade",null,!1,ae),me=!T.options.moving;for(const ve of _){const we=i.getTile(ve),Pe=we.fbo;if(!Pe)continue;const Ce=G.getMeshFromTileID(K,ve.canonical,O,!0,"raster"),ze=(j=T.style.map.terrain)===null||j===void 0?void 0:j.getTerrainData(ve);K.activeTexture.set(ee.TEXTURE0),ee.bindTexture(ee.TEXTURE_2D,Pe.colorAttachment.get());const Ve=Z.getProjectionData({overscaledTileID:ve,aligned:me,applyGlobeMatrix:!N,applyTerrainMatrix:!0});ge.draw(K,ee.TRIANGLES,S,b[ve.overscaledZ],I,fn.backCCW,Ku(T,we,u),ze,Ve,u.id,Ce.vertexBuffer,Ce.indexBuffer,Ce.segments)}}function It(T,i,u,_,b,S,I,O,N){var j;const G=T.style.projection,K=T.context,Z=T.transform,ee=K.gl,ae=T.useProgram("colorRelief"),ge=!T.options.moving;let me=!0,ve=0;for(const we of _){const Pe=i.getTile(we),Ce=Pe.dem;if(me){const rt=ee.getParameter(ee.MAX_TEXTURE_SIZE),{elevationTexture:st,colorTexture:lt}=u.getColorRampTextures(K,rt,Ce.getUnpackVector());K.activeTexture.set(ee.TEXTURE1),st.bind(ee.NEAREST,ee.CLAMP_TO_EDGE),K.activeTexture.set(ee.TEXTURE4),lt.bind(ee.LINEAR,ee.CLAMP_TO_EDGE),me=!1,ve=st.size[0]}if(!Ce||!Ce.data)continue;const ze=Ce.stride,Ve=Ce.getPixels();if(K.activeTexture.set(ee.TEXTURE0),K.pixelStoreUnpackPremultiplyAlpha.set(!1),Pe.demTexture=Pe.demTexture||T.getTileTexture(ze),Pe.demTexture){const rt=Pe.demTexture;rt.update(Ve,{premultiply:!1}),rt.bind(ee.LINEAR,ee.CLAMP_TO_EDGE)}else Pe.demTexture=new c.T(K,Ve,ee.RGBA,{premultiply:!1}),Pe.demTexture.bind(ee.LINEAR,ee.CLAMP_TO_EDGE);const Ie=G.getMeshFromTileID(K,we.canonical,O,!0,"raster"),Ye=(j=T.style.map.terrain)===null||j===void 0?void 0:j.getTerrainData(we),ct=Z.getProjectionData({overscaledTileID:we,aligned:ge,applyGlobeMatrix:!N,applyTerrainMatrix:!0});ae.draw(K,ee.TRIANGLES,S,b[we.overscaledZ],I,fn.backCCW,rd(u,Pe.dem,ve),Ye,ct,u.id,Ie.vertexBuffer,Ie.indexBuffer,Ie.segments)}}const Xt=[new c.P(0,0),new c.P(c.$,0),new c.P(c.$,c.$),new c.P(0,c.$)];function pn(T,i,u,_,b,S,I,O,N=!1,j=!1){const G=_[_.length-1].overscaledZ,K=T.context,Z=K.gl,ee=T.useProgram("raster"),ae=T.transform,ge=T.style.projection,me=T.colorModeForRenderPass(),ve=!T.options.moving;for(const we of _){const Pe=T.getDepthModeForSublayer(we.overscaledZ-G,u.paint.get("raster-opacity")===1?sn.ReadWrite:sn.ReadOnly,Z.LESS),Ce=i.getTile(we);Ce.registerFadeDuration(u.paint.get("raster-fade-duration"));const ze=i.findLoadedParent(we,0),Ve=i.findLoadedSibling(we),Ie=Yn(Ce,ze||Ve||null,i,u,T.transform,T.style.map.terrain);let Ye,ct;const rt=u.paint.get("raster-resampling")==="nearest"?Z.NEAREST:Z.LINEAR;K.activeTexture.set(Z.TEXTURE0),Ce.texture.bind(rt,Z.CLAMP_TO_EDGE,Z.LINEAR_MIPMAP_NEAREST),K.activeTexture.set(Z.TEXTURE1),ze?(ze.texture.bind(rt,Z.CLAMP_TO_EDGE,Z.LINEAR_MIPMAP_NEAREST),Ye=Math.pow(2,ze.tileID.overscaledZ-Ce.tileID.overscaledZ),ct=[Ce.tileID.canonical.x*Ye%1,Ce.tileID.canonical.y*Ye%1]):Ce.texture.bind(rt,Z.CLAMP_TO_EDGE,Z.LINEAR_MIPMAP_NEAREST),Ce.texture.useMipmap&&K.extTextureFilterAnisotropic&&T.transform.pitch>20&&Z.texParameterf(Z.TEXTURE_2D,K.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,K.extTextureFilterAnisotropicMax);const st=T.style.map.terrain&&T.style.map.terrain.getTerrainData(we),lt=ae.getProjectionData({overscaledTileID:we,aligned:ve,applyGlobeMatrix:!j,applyTerrainMatrix:!0}),Nt=Es(ct||[0,0],Ye||1,Ie,u,O),Vt=ge.getMeshFromTileID(K,we.canonical,S,I,"raster");ee.draw(K,Z.TRIANGLES,Pe,b?b[we.overscaledZ]:$n.disabled,me,N?fn.frontCCW:fn.backCCW,Nt,st,lt,u.id,Vt.vertexBuffer,Vt.indexBuffer,Vt.segments)}}function Yn(T,i,u,_,b,S){const I=_.paint.get("raster-fade-duration");if(!S&&I>0){const O=J.now(),N=(O-T.timeAdded)/I,j=i?(O-i.timeAdded)/I:-1,G=u.getSource(),K=tn(b,{tileSize:G.tileSize,roundZoom:G.roundZoom}),Z=!i||Math.abs(i.tileID.overscaledZ-K)>Math.abs(T.tileID.overscaledZ-K),ee=Z&&T.refreshedUponExpiration?1:c.ah(Z?N:1-j,0,1);return T.refreshedUponExpiration&&N>=1&&(T.refreshedUponExpiration=!1),i?{opacity:1,mix:1-ee}:{opacity:ee,mix:0}}return{opacity:1,mix:0}}const _a=new c.bf(1,0,0,1),Zr=new c.bf(0,1,0,1),Za=new c.bf(0,0,1,1),Si=new c.bf(1,0,1,1),ki=new c.bf(0,1,1,1);function ui(T,i,u,_){Wr(T,0,i+u/2,T.transform.width,u,_)}function Li(T,i,u,_){Wr(T,i-u/2,0,u,T.transform.height,_)}function Wr(T,i,u,_,b,S){const I=T.context,O=I.gl;O.enable(O.SCISSOR_TEST),O.scissor(i*T.pixelRatio,u*T.pixelRatio,_*T.pixelRatio,b*T.pixelRatio),I.clear({color:S}),O.disable(O.SCISSOR_TEST)}function rs(T,i,u){const _=T.context,b=_.gl,S=T.useProgram("debug"),I=sn.disabled,O=$n.disabled,N=T.colorModeForRenderPass(),j="$debug",G=T.style.map.terrain&&T.style.map.terrain.getTerrainData(u);_.activeTexture.set(b.TEXTURE0);const K=i.getTileByID(u.key).latestRawTileData,Z=Math.floor((K&&K.byteLength||0)/1024),ee=i.getTile(u).tileSize,ae=512/Math.min(ee,512)*(u.overscaledZ/T.transform.zoom)*.5;let ge=u.canonical.toString();u.overscaledZ!==u.canonical.z&&(ge+=` => ${u.overscaledZ}`),(function(ve,we){ve.initDebugOverlayCanvas();const Pe=ve.debugOverlayCanvas,Ce=ve.context.gl,ze=ve.debugOverlayCanvas.getContext("2d");ze.clearRect(0,0,Pe.width,Pe.height),ze.shadowColor="white",ze.shadowBlur=2,ze.lineWidth=1.5,ze.strokeStyle="white",ze.textBaseline="top",ze.font="bold 36px Open Sans, sans-serif",ze.fillText(we,5,5),ze.strokeText(we,5,5),ve.debugOverlayTexture.update(Pe),ve.debugOverlayTexture.bind(Ce.LINEAR,Ce.CLAMP_TO_EDGE)})(T,`${ge} ${Z}kB`);const me=T.transform.getProjectionData({overscaledTileID:u,applyGlobeMatrix:!0,applyTerrainMatrix:!0});S.draw(_,b.TRIANGLES,I,O,bn.alphaBlended,fn.disabled,Xs(c.bf.transparent,ae),null,me,j,T.debugBuffer,T.quadTriangleIndexBuffer,T.debugSegments),S.draw(_,b.LINE_STRIP,I,O,N,fn.disabled,Xs(c.bf.red),G,me,j,T.debugBuffer,T.tileBorderIndexBuffer,T.debugSegments)}function Bo(T,i,u,_){const{isRenderingGlobe:b}=_,S=T.context,I=S.gl,O=T.transform,N=T.colorModeForRenderPass(),j=T.getDepthModeFor3D(),G=T.useProgram("terrain");S.bindFramebuffer.set(null),S.viewport.set([0,0,T.width,T.height]);for(const K of u){const Z=i.getTerrainMesh(K.tileID),ee=T.renderToTexture.getTexture(K),ae=i.getTerrainData(K.tileID);S.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,ee.texture);const ge=i.getMeshFrameDelta(O.zoom),me=O.calculateFogMatrix(K.tileID.toUnwrapped()),ve=ye(ge,me,T.style.sky,O.pitch,b),we=O.getProjectionData({overscaledTileID:K.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});G.draw(S,I.TRIANGLES,j,$n.disabled,N,fn.backCCW,ve,ae,we,"terrain",Z.vertexBuffer,Z.indexBuffer,Z.segments)}}function Su(T,i){if(!i.mesh){const u=new c.aL;u.emplaceBack(-1,-1),u.emplaceBack(1,-1),u.emplaceBack(1,1),u.emplaceBack(-1,1);const _=new c.aN;_.emplaceBack(0,1,2),_.emplaceBack(0,2,3),i.mesh=new es(T.createVertexBuffer(u,ys.members),T.createIndexBuffer(_),c.aM.simpleSegment(0,0,u.length,_.length))}return i.mesh}class Nr{constructor(i,u){this.context=new is(i),this.transform=u,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:c.ag(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Rn.maxUnderzooming+Rn.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Ja}resize(i,u,_){if(this.width=Math.floor(i*_),this.height=Math.floor(u*_),this.pixelRatio=_,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const b of this.style._order)this.style._layers[b].resize()}setup(){const i=this.context,u=new c.aL;u.emplaceBack(0,0),u.emplaceBack(c.$,0),u.emplaceBack(0,c.$),u.emplaceBack(c.$,c.$),this.tileExtentBuffer=i.createVertexBuffer(u,ys.members),this.tileExtentSegments=c.aM.simpleSegment(0,0,4,2);const _=new c.aL;_.emplaceBack(0,0),_.emplaceBack(c.$,0),_.emplaceBack(0,c.$),_.emplaceBack(c.$,c.$),this.debugBuffer=i.createVertexBuffer(_,ys.members),this.debugSegments=c.aM.simpleSegment(0,0,4,5);const b=new c.c6;b.emplaceBack(0,0,0,0),b.emplaceBack(c.$,0,c.$,0),b.emplaceBack(0,c.$,0,c.$),b.emplaceBack(c.$,c.$,c.$,c.$),this.rasterBoundsBuffer=i.createVertexBuffer(b,H.members),this.rasterBoundsSegments=c.aM.simpleSegment(0,0,4,2);const S=new c.aL;S.emplaceBack(0,0),S.emplaceBack(c.$,0),S.emplaceBack(0,c.$),S.emplaceBack(c.$,c.$),this.rasterBoundsBufferPosOnly=i.createVertexBuffer(S,ys.members),this.rasterBoundsSegmentsPosOnly=c.aM.simpleSegment(0,0,4,5);const I=new c.aL;I.emplaceBack(0,0),I.emplaceBack(1,0),I.emplaceBack(0,1),I.emplaceBack(1,1),this.viewportBuffer=i.createVertexBuffer(I,ys.members),this.viewportSegments=c.aM.simpleSegment(0,0,4,2);const O=new c.c7;O.emplaceBack(0),O.emplaceBack(1),O.emplaceBack(3),O.emplaceBack(2),O.emplaceBack(0),this.tileBorderIndexBuffer=i.createIndexBuffer(O);const N=new c.aN;N.emplaceBack(1,0,2),N.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=i.createIndexBuffer(N);const j=this.context.gl;this.stencilClearMode=new $n({func:j.ALWAYS,mask:0},0,255,j.ZERO,j.ZERO,j.ZERO),this.tileExtentMesh=new es(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const i=this.context,u=i.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const _=c.L();c.bY(_,0,this.width,this.height,0,0,1),c.N(_,_,[u.drawingBufferWidth,u.drawingBufferHeight,0]);const b={mainMatrix:_,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:_};this.useProgram("clippingMask",null,!0).draw(i,u.TRIANGLES,sn.disabled,this.stencilClearMode,bn.disabled,fn.disabled,null,null,b,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(i,u,_){if(this.currentStencilSource===i.source||!i.isTileClipped()||!u||!u.length)return;this.currentStencilSource=i.source,this.nextStencilID+u.length>256&&this.clearStencil();const b=this.context;b.setColorMode(bn.disabled),b.setDepthMode(sn.disabled);const S={};for(const I of u)S[I.key]=this.nextStencilID++;this._renderTileMasks(S,u,_,!0),this._renderTileMasks(S,u,_,!1),this._tileClippingMaskIDs=S}_renderTileMasks(i,u,_,b){const S=this.context,I=S.gl,O=this.style.projection,N=this.transform,j=this.useProgram("clippingMask");for(const G of u){const K=i[G.key],Z=this.style.map.terrain&&this.style.map.terrain.getTerrainData(G),ee=O.getMeshFromTileID(this.context,G.canonical,b,!0,"stencil"),ae=N.getProjectionData({overscaledTileID:G,applyGlobeMatrix:!_,applyTerrainMatrix:!0});j.draw(S,I.TRIANGLES,sn.disabled,new $n({func:I.ALWAYS,mask:0},K,255,I.KEEP,I.KEEP,I.REPLACE),bn.disabled,_?fn.disabled:fn.backCCW,null,Z,ae,"$clipping",ee.vertexBuffer,ee.indexBuffer,ee.segments)}}_renderTilesDepthBuffer(){const i=this.context,u=i.gl,_=this.style.projection,b=this.transform,S=this.useProgram("depth"),I=this.getDepthModeFor3D(),O=$e(b,{tileSize:b.tileSize});for(const N of O){const j=this.style.map.terrain&&this.style.map.terrain.getTerrainData(N),G=_.getMeshFromTileID(this.context,N.canonical,!0,!0,"raster"),K=b.getProjectionData({overscaledTileID:N,applyGlobeMatrix:!0,applyTerrainMatrix:!0});S.draw(i,u.TRIANGLES,I,$n.disabled,bn.disabled,fn.backCCW,null,j,K,"$clipping",G.vertexBuffer,G.indexBuffer,G.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const i=this.nextStencilID++,u=this.context.gl;return new $n({func:u.NOTEQUAL,mask:255},i,255,u.KEEP,u.KEEP,u.REPLACE)}stencilModeForClipping(i){const u=this.context.gl;return new $n({func:u.EQUAL,mask:255},this._tileClippingMaskIDs[i.key],0,u.KEEP,u.KEEP,u.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(i){const u=this.context.gl,_=i.sort(((I,O)=>O.overscaledZ-I.overscaledZ)),b=_[_.length-1].overscaledZ,S=_[0].overscaledZ-b+1;if(S>1){this.currentStencilSource=void 0,this.nextStencilID+S>256&&this.clearStencil();const I={};for(let O=0;O<S;O++)I[O+b]=new $n({func:u.GEQUAL,mask:255},O+this.nextStencilID,255,u.KEEP,u.KEEP,u.REPLACE);return this.nextStencilID+=S,[I,_]}return[{[b]:$n.disabled},_]}stencilConfigForOverlapTwoPass(i){const u=this.context.gl,_=i.sort(((I,O)=>O.overscaledZ-I.overscaledZ)),b=_[_.length-1].overscaledZ,S=_[0].overscaledZ-b+1;if(this.clearStencil(),S>1){const I={},O={};for(let N=0;N<S;N++)I[N+b]=new $n({func:u.GREATER,mask:255},S+1+N,255,u.KEEP,u.KEEP,u.REPLACE),O[N+b]=new $n({func:u.GREATER,mask:255},1+N,255,u.KEEP,u.KEEP,u.REPLACE);return this.nextStencilID=2*S+1,[I,O,_]}return this.nextStencilID=3,[{[b]:new $n({func:u.GREATER,mask:255},2,255,u.KEEP,u.KEEP,u.REPLACE)},{[b]:new $n({func:u.GREATER,mask:255},1,255,u.KEEP,u.KEEP,u.REPLACE)},_]}colorModeForRenderPass(){const i=this.context.gl;return this._showOverdrawInspector?new bn([i.CONSTANT_COLOR,i.ONE],new c.bf(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?bn.unblended:bn.alphaBlended}getDepthModeForSublayer(i,u,_){if(!this.opaquePassEnabledForLayer())return sn.disabled;const b=1-((1+this.currentLayer)*this.numSublayers+i)*this.depthEpsilon;return new sn(_||this.context.gl.LEQUAL,u,[b,b])}getDepthModeFor3D(){return new sn(this.context.gl.LEQUAL,sn.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(i,u){var _,b;this.style=i,this.options=u,this.lineAtlas=i.lineAtlas,this.imageManager=i.imageManager,this.glyphManager=i.glyphManager,this.symbolFadeChange=i.placement.symbolFadeChange(J.now()),this.imageManager.beginFrame();const S=this.style._order,I=this.style.sourceCaches,O={},N={},j={},G={isRenderingToTexture:!1,isRenderingGlobe:((_=i.projection)===null||_===void 0?void 0:_.transitionState)>0};for(const Z in I){const ee=I[Z];ee.used&&ee.prepare(this.context),O[Z]=ee.getVisibleCoordinates(!1),N[Z]=O[Z].slice().reverse(),j[Z]=ee.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let Z=0;Z<S.length;Z++)if(this.style._layers[S[Z]].is3D()){this.opaquePassCutoff=Z;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const Z of S){const ee=this.style._layers[Z];if(!ee.hasOffscreenPass()||ee.isHidden(this.transform.zoom))continue;const ae=N[ee.source];(ee.type==="custom"||ae.length)&&this.renderLayer(this,I[ee.source],ee,ae,G)}if((b=this.style.projection)===null||b===void 0||b.updateGPUdependent({context:this.context,useProgram:Z=>this.useProgram(Z)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:u.showOverdrawInspector?c.bf.black:c.bf.transparent,depth:1}),this.clearStencil(),this.style.sky&&(function(Z,ee){const ae=Z.context,ge=ae.gl,me=((Ve,Ie,Ye)=>{const ct=Math.cos(Ie.rollInRadians),rt=Math.sin(Ie.rollInRadians),st=De(Ie),lt=Ie.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:Ve.properties.get("sky-color"),u_horizon_color:Ve.properties.get("horizon-color"),u_horizon:[(Ie.width/2-st*rt)*Ye,(Ie.height/2+st*ct)*Ye],u_horizon_normal:[-rt,ct],u_sky_horizon_blend:Ve.properties.get("sky-horizon-blend")*Ie.height/2*Ye,u_sky_blend:lt}})(ee,Z.style.map.transform,Z.pixelRatio),ve=new sn(ge.LEQUAL,sn.ReadWrite,[0,1]),we=$n.disabled,Pe=Z.colorModeForRenderPass(),Ce=Z.useProgram("sky"),ze=Su(ae,ee);Ce.draw(ae,ge.TRIANGLES,ve,we,Pe,fn.disabled,me,null,void 0,"sky",ze.vertexBuffer,ze.indexBuffer,ze.segments)})(this,this.style.sky),this._showOverdrawInspector=u.showOverdrawInspector,this.depthRangeFor3D=[0,1-(i._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=S.length-1;this.currentLayer>=0;this.currentLayer--){const Z=this.style._layers[S[this.currentLayer]],ee=I[Z.source],ae=O[Z.source];this._renderTileClippingMasks(Z,ae,!1),this.renderLayer(this,ee,Z,ae,G)}this.renderPass="translucent";let K=!1;for(this.currentLayer=0;this.currentLayer<S.length;this.currentLayer++){const Z=this.style._layers[S[this.currentLayer]],ee=I[Z.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(Z,G))continue;this.opaquePassEnabledForLayer()||K||(K=!0,G.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const ae=(Z.type==="symbol"?j:N)[Z.source];this._renderTileClippingMasks(Z,O[Z.source],!!this.renderToTexture),this.renderLayer(this,ee,Z,ae,G)}if(G.isRenderingGlobe&&(function(Z,ee,ae){const ge=Z.context,me=ge.gl,ve=Z.useProgram("atmosphere"),we=new sn(me.LEQUAL,sn.ReadOnly,[0,1]),Pe=Z.transform,Ce=(function(lt,Nt){const Vt=lt.properties.get("position"),At=[-Vt.x,-Vt.y,-Vt.z],ln=c.ag(new Float64Array(16));return lt.properties.get("anchor")==="map"&&(c.b6(ln,ln,Nt.rollInRadians),c.b7(ln,ln,-Nt.pitchInRadians),c.b6(ln,ln,Nt.bearingInRadians),c.b7(ln,ln,Nt.center.lat*Math.PI/180),c.bz(ln,ln,-Nt.center.lng*Math.PI/180)),c.c5(At,At,ln),At})(ae,Z.transform),ze=Pe.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),Ve=ee.properties.get("atmosphere-blend")*ze.projectionTransition;if(Ve===0)return;const Ie=ws(Pe.worldSize,Pe.center.lat),Ye=Pe.inverseProjectionMatrix,ct=new Float64Array(4);ct[3]=1,c.aw(ct,ct,Pe.modelViewProjectionMatrix),ct[0]/=ct[3],ct[1]/=ct[3],ct[2]/=ct[3],ct[3]=1,c.aw(ct,ct,Ye),ct[0]/=ct[3],ct[1]/=ct[3],ct[2]/=ct[3],ct[3]=1;const rt=((lt,Nt,Vt,At,ln)=>({u_sun_pos:lt,u_atmosphere_blend:Nt,u_globe_position:Vt,u_globe_radius:At,u_inv_proj_matrix:ln}))(Ce,Ve,[ct[0],ct[1],ct[2]],Ie,Ye),st=Su(ge,ee);ve.draw(ge,me.TRIANGLES,we,$n.disabled,bn.alphaBlended,fn.disabled,rt,null,null,"atmosphere",st.vertexBuffer,st.indexBuffer,st.segments)})(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const Z=(function(ee,ae){let ge=null;const me=Object.values(ee._layers).flatMap((Ce=>Ce.source&&!Ce.isHidden(ae)?[ee.sourceCaches[Ce.source]]:[])),ve=me.filter((Ce=>Ce.getSource().type==="vector")),we=me.filter((Ce=>Ce.getSource().type!=="vector")),Pe=Ce=>{(!ge||ge.getSource().maxzoom<Ce.getSource().maxzoom)&&(ge=Ce)};return ve.forEach((Ce=>Pe(Ce))),ge||we.forEach((Ce=>Pe(Ce))),ge})(this.style,this.transform.zoom);Z&&(function(ee,ae,ge){for(let me=0;me<ge.length;me++)rs(ee,ae,ge[me])})(this,Z,Z.getVisibleCoordinates())}this.options.showPadding&&(function(Z){const ee=Z.transform.padding;ui(Z,Z.transform.height-(ee.top||0),3,_a),ui(Z,ee.bottom||0,3,Zr),Li(Z,ee.left||0,3,Za),Li(Z,Z.transform.width-(ee.right||0),3,Si);const ae=Z.transform.centerPoint;(function(ge,me,ve,we){Wr(ge,me-1,ve-10,2,20,we),Wr(ge,me-10,ve-1,20,2,we)})(Z,ae.x,Z.transform.height-ae.y,ki)})(this),this.context.setDefault()}maybeDrawDepthAndCoords(i){if(!this.style||!this.style.map||!this.style.map.terrain)return;const u=this.terrainFacilitator.matrix,_=this.transform.modelViewProjectionMatrix;let b=this.terrainFacilitator.dirty;b||(b=i?!c.c8(u,_):!c.c9(u,_)),b||(b=this.style.map.terrain.sourceCache.anyTilesAfterTime(this.terrainFacilitator.renderTime)),b&&(c.ca(u,_),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,(function(S,I){const O=S.context,N=O.gl,j=S.transform,G=bn.unblended,K=new sn(N.LEQUAL,sn.ReadWrite,[0,1]),Z=I.sourceCache.getRenderableTiles(),ee=S.useProgram("terrainDepth");O.bindFramebuffer.set(I.getFramebuffer("depth").framebuffer),O.viewport.set([0,0,S.width/devicePixelRatio,S.height/devicePixelRatio]),O.clear({color:c.bf.transparent,depth:1});for(const ae of Z){const ge=I.getTerrainMesh(ae.tileID),me=I.getTerrainData(ae.tileID),ve=j.getProjectionData({overscaledTileID:ae.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),we={u_ele_delta:I.getMeshFrameDelta(j.zoom)};ee.draw(O,N.TRIANGLES,K,$n.disabled,G,fn.backCCW,we,me,ve,"terrain",ge.vertexBuffer,ge.indexBuffer,ge.segments)}O.bindFramebuffer.set(null),O.viewport.set([0,0,S.width,S.height])})(this,this.style.map.terrain),(function(S,I){const O=S.context,N=O.gl,j=S.transform,G=bn.unblended,K=new sn(N.LEQUAL,sn.ReadWrite,[0,1]),Z=I.getCoordsTexture(),ee=I.sourceCache.getRenderableTiles(),ae=S.useProgram("terrainCoords");O.bindFramebuffer.set(I.getFramebuffer("coords").framebuffer),O.viewport.set([0,0,S.width/devicePixelRatio,S.height/devicePixelRatio]),O.clear({color:c.bf.transparent,depth:1}),I.coordsIndex=[];for(const ge of ee){const me=I.getTerrainMesh(ge.tileID),ve=I.getTerrainData(ge.tileID);O.activeTexture.set(N.TEXTURE0),N.bindTexture(N.TEXTURE_2D,Z.texture);const we={u_terrain_coords_id:(255-I.coordsIndex.length)/255,u_texture:0,u_ele_delta:I.getMeshFrameDelta(j.zoom)},Pe=j.getProjectionData({overscaledTileID:ge.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});ae.draw(O,N.TRIANGLES,K,$n.disabled,G,fn.backCCW,we,ve,Pe,"terrain",me.vertexBuffer,me.indexBuffer,me.segments),I.coordsIndex.push(ge.tileID.key)}O.bindFramebuffer.set(null),O.viewport.set([0,0,S.width,S.height])})(this,this.style.map.terrain))}renderLayer(i,u,_,b,S){_.isHidden(this.transform.zoom)||(_.type==="background"||_.type==="custom"||(b||[]).length)&&(this.id=_.id,c.cb(_)?(function(I,O,N,j,G,K){if(I.renderPass!=="translucent")return;const{isRenderingToTexture:Z}=K,ee=$n.disabled,ae=I.colorModeForRenderPass();(N._unevaluatedLayout.hasValue("text-variable-anchor")||N._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&(function(ge,me,ve,we,Pe,Ce,ze,Ve,Ie){const Ye=me.transform,ct=me.style.map.terrain,rt=Pe==="map",st=Ce==="map";for(const lt of ge){const Nt=we.getTile(lt),Vt=Nt.getBucket(ve);if(!Vt||!Vt.text||!Vt.text.segments.get().length)continue;const At=c.an(Vt.textSizeData,Ye.zoom),ln=c.aC(Nt,1,me.transform.zoom),Hn=Ir(rt,me.transform,ln),bi=ve.layout.get("icon-text-fit")!=="none"&&Vt.hasIconData();if(At){const Yi=Math.pow(2,Ye.zoom-Nt.tileID.overscaledZ),$i=ct?(Mr,Fr)=>ct.getElevation(lt,Mr,Fr):null;sc(Vt,rt,st,Ie,Ye,Hn,Yi,At,bi,c.aD(Ye,Nt,ze,Ve),lt.toUnwrapped(),$i)}}})(j,I,N,O,N.layout.get("text-rotation-alignment"),N.layout.get("text-pitch-alignment"),N.paint.get("text-translate"),N.paint.get("text-translate-anchor"),G),N.paint.get("icon-opacity").constantOr(1)!==0&&Tu(I,O,N,j,!1,N.paint.get("icon-translate"),N.paint.get("icon-translate-anchor"),N.layout.get("icon-rotation-alignment"),N.layout.get("icon-pitch-alignment"),N.layout.get("icon-keep-upright"),ee,ae,Z),N.paint.get("text-opacity").constantOr(1)!==0&&Tu(I,O,N,j,!0,N.paint.get("text-translate"),N.paint.get("text-translate-anchor"),N.layout.get("text-rotation-alignment"),N.layout.get("text-pitch-alignment"),N.layout.get("text-keep-upright"),ee,ae,Z),O.map.showCollisionBoxes&&(No(I,O,N,j,!0),No(I,O,N,j,!1))})(i,u,_,b,this.style.placement.variableOffsets,S):c.cc(_)?(function(I,O,N,j,G){if(I.renderPass!=="translucent")return;const{isRenderingToTexture:K}=G,Z=N.paint.get("circle-opacity"),ee=N.paint.get("circle-stroke-width"),ae=N.paint.get("circle-stroke-opacity"),ge=!N.layout.get("circle-sort-key").isConstant();if(Z.constantOr(1)===0&&(ee.constantOr(1)===0||ae.constantOr(1)===0))return;const me=I.context,ve=me.gl,we=I.transform,Pe=I.getDepthModeForSublayer(0,sn.ReadOnly),Ce=$n.disabled,ze=I.colorModeForRenderPass(),Ve=[],Ie=we.getCircleRadiusCorrection();for(let Ye=0;Ye<j.length;Ye++){const ct=j[Ye],rt=O.getTile(ct),st=rt.getBucket(N);if(!st)continue;const lt=N.paint.get("circle-translate"),Nt=N.paint.get("circle-translate-anchor"),Vt=c.aD(we,rt,lt,Nt),At=st.programConfigurations.get(N.id),ln=I.useProgram("circle",At),Hn=st.layoutVertexBuffer,bi=st.indexBuffer,Yi=I.style.map.terrain&&I.style.map.terrain.getTerrainData(ct),$i={programConfiguration:At,program:ln,layoutVertexBuffer:Hn,indexBuffer:bi,uniformValues:Ks(I,rt,N,Vt,Ie),terrainData:Yi,projectionData:we.getProjectionData({overscaledTileID:ct,applyGlobeMatrix:!K,applyTerrainMatrix:!0})};if(ge){const Mr=st.segments.get();for(const Fr of Mr)Ve.push({segments:new c.aM([Fr]),sortKey:Fr.sortKey,state:$i})}else Ve.push({segments:st.segments,sortKey:0,state:$i})}ge&&Ve.sort(((Ye,ct)=>Ye.sortKey-ct.sortKey));for(const Ye of Ve){const{programConfiguration:ct,program:rt,layoutVertexBuffer:st,indexBuffer:lt,uniformValues:Nt,terrainData:Vt,projectionData:At}=Ye.state;rt.draw(me,ve.TRIANGLES,Pe,Ce,ze,fn.backCCW,Nt,Vt,At,N.id,st,lt,Ye.segments,N.paint,I.transform.zoom,ct)}})(i,u,_,b,S):c.cd(_)?(function(I,O,N,j,G){if(N.paint.get("heatmap-opacity")===0)return;const K=I.context,{isRenderingToTexture:Z,isRenderingGlobe:ee}=G;if(I.style.map.terrain){for(const ae of j){const ge=O.getTile(ae);O.hasRenderableParent(ae)||(I.renderPass==="offscreen"?x(I,ge,N,ae,ee):I.renderPass==="translucent"&&k(I,N,ae,Z,ee))}K.viewport.set([0,0,I.width,I.height])}else I.renderPass==="offscreen"?(function(ae,ge,me,ve){const we=ae.context,Pe=we.gl,Ce=ae.transform,ze=$n.disabled,Ve=new bn([Pe.ONE,Pe.ONE],c.bf.transparent,[!0,!0,!0,!0]);(function(Ie,Ye,ct){const rt=Ie.gl;Ie.activeTexture.set(rt.TEXTURE1),Ie.viewport.set([0,0,Ye.width/4,Ye.height/4]);let st=ct.heatmapFbos.get(c.c2);st?(rt.bindTexture(rt.TEXTURE_2D,st.colorAttachment.get()),Ie.bindFramebuffer.set(st.framebuffer)):(st=U(Ie,Ye.width/4,Ye.height/4),ct.heatmapFbos.set(c.c2,st))})(we,ae,me),we.clear({color:c.bf.transparent});for(let Ie=0;Ie<ve.length;Ie++){const Ye=ve[Ie];if(ge.hasRenderableParent(Ye))continue;const ct=ge.getTile(Ye),rt=ct.getBucket(me);if(!rt)continue;const st=rt.programConfigurations.get(me.id),lt=ae.useProgram("heatmap",st),Nt=Ce.getProjectionData({overscaledTileID:Ye,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),Vt=Ce.getCircleRadiusCorrection();lt.draw(we,Pe.TRIANGLES,sn.disabled,ze,Ve,fn.backCCW,gu(ct,Ce.zoom,me.paint.get("heatmap-intensity"),Vt),null,Nt,me.id,rt.layoutVertexBuffer,rt.indexBuffer,rt.segments,me.paint,Ce.zoom,st)}we.viewport.set([0,0,ae.width,ae.height])})(I,O,N,j):I.renderPass==="translucent"&&(function(ae,ge){const me=ae.context,ve=me.gl;me.setColorMode(ae.colorModeForRenderPass());const we=ge.heatmapFbos.get(c.c2);we&&(me.activeTexture.set(ve.TEXTURE0),ve.bindTexture(ve.TEXTURE_2D,we.colorAttachment.get()),me.activeTexture.set(ve.TEXTURE1),X(me,ge).bind(ve.LINEAR,ve.CLAMP_TO_EDGE),ae.useProgram("heatmapTexture").draw(me,ve.TRIANGLES,sn.disabled,$n.disabled,ae.colorModeForRenderPass(),fn.disabled,Ys(ae,ge,0,1),null,null,ge.id,ae.viewportBuffer,ae.quadTriangleIndexBuffer,ae.viewportSegments,ge.paint,ae.transform.zoom))})(I,N)})(i,u,_,b,S):c.ce(_)?(function(I,O,N,j,G){if(I.renderPass!=="translucent")return;const{isRenderingToTexture:K}=G,Z=N.paint.get("line-opacity"),ee=N.paint.get("line-width");if(Z.constantOr(1)===0||ee.constantOr(1)===0)return;const ae=I.getDepthModeForSublayer(0,sn.ReadOnly),ge=I.colorModeForRenderPass(),me=N.paint.get("line-dasharray"),ve=N.paint.get("line-pattern"),we=ve.constantOr(1),Pe=N.paint.get("line-gradient"),Ce=N.getCrossfadeParameters(),ze=we?"linePattern":me?"lineSDF":Pe?"lineGradient":"line",Ve=I.context,Ie=Ve.gl,Ye=I.transform;let ct=!0;for(const rt of j){const st=O.getTile(rt);if(we&&!st.patternsLoaded())continue;const lt=st.getBucket(N);if(!lt)continue;const Nt=lt.programConfigurations.get(N.id),Vt=I.context.program.get(),At=I.useProgram(ze,Nt),ln=ct||At.program!==Vt,Hn=I.style.map.terrain&&I.style.map.terrain.getTerrainData(rt),bi=ve.constantOr(null);if(bi&&st.imageAtlas){const jn=st.imageAtlas,ur=jn.patternPositions[bi.to.toString()],oa=jn.patternPositions[bi.from.toString()];ur&&oa&&Nt.setConstantPatternPositions(ur,oa)}const Yi=Ye.getProjectionData({overscaledTileID:rt,applyGlobeMatrix:!K,applyTerrainMatrix:!0}),$i=Ye.getPixelScale(),Mr=we?Yu(I,st,N,$i,Ce):me?ko(I,st,N,$i,me,Ce):Pe?Xu(I,st,N,$i,lt.lineClipsArray.length):Qs(I,st,N,$i);if(we)Ve.activeTexture.set(Ie.TEXTURE0),st.imageAtlasTexture.bind(Ie.LINEAR,Ie.CLAMP_TO_EDGE),Nt.updatePaintBuffers(Ce);else if(me&&(ln||I.lineAtlas.dirty))Ve.activeTexture.set(Ie.TEXTURE0),I.lineAtlas.bind(Ve);else if(Pe){const jn=lt.gradients[N.id];let ur=jn.texture;if(N.gradientVersion!==jn.version){let oa=256;if(N.stepInterpolant){const Vr=O.getSource().maxzoom,La=rt.canonical.z===Vr?Math.ceil(1<<I.transform.maxZoom-rt.canonical.z):1;oa=c.ah(c.c3(lt.maxLineLength/c.$*1024*La),256,Ve.maxTextureSize)}jn.gradient=c.c4({expression:N.gradientExpression(),evaluationKey:"lineProgress",resolution:oa,image:jn.gradient||void 0,clips:lt.lineClipsArray}),jn.texture?jn.texture.update(jn.gradient):jn.texture=new c.T(Ve,jn.gradient,Ie.RGBA),jn.version=N.gradientVersion,ur=jn.texture}Ve.activeTexture.set(Ie.TEXTURE0),ur.bind(N.stepInterpolant?Ie.NEAREST:Ie.LINEAR,Ie.CLAMP_TO_EDGE)}const Fr=I.stencilModeForClipping(rt);At.draw(Ve,Ie.TRIANGLES,ae,Fr,ge,fn.disabled,Mr,Hn,Yi,N.id,lt.layoutVertexBuffer,lt.indexBuffer,lt.segments,N.paint,I.transform.zoom,Nt,lt.layoutVertexBuffer2),ct=!1}})(i,u,_,b,S):c.cf(_)?(function(I,O,N,j,G){const K=N.paint.get("fill-color"),Z=N.paint.get("fill-opacity");if(Z.constantOr(1)===0)return;const{isRenderingToTexture:ee}=G,ae=I.colorModeForRenderPass(),ge=N.paint.get("fill-pattern"),me=I.opaquePassEnabledForLayer()&&!ge.constantOr(1)&&K.constantOr(c.bf.transparent).a===1&&Z.constantOr(0)===1?"opaque":"translucent";if(I.renderPass===me){const ve=I.getDepthModeForSublayer(1,I.renderPass==="opaque"?sn.ReadWrite:sn.ReadOnly);Ne(I,O,N,j,ve,ae,!1,ee)}if(I.renderPass==="translucent"&&N.paint.get("fill-antialias")){const ve=I.getDepthModeForSublayer(N.getPaintProperty("fill-outline-color")?2:0,sn.ReadOnly);Ne(I,O,N,j,ve,ae,!0,ee)}})(i,u,_,b,S):c.cg(_)?(function(I,O,N,j,G){const K=N.paint.get("fill-extrusion-opacity");if(K===0)return;const{isRenderingToTexture:Z}=G;if(I.renderPass==="translucent"){const ee=new sn(I.context.gl.LEQUAL,sn.ReadWrite,I.depthRangeFor3D);if(K!==1||N.paint.get("fill-extrusion-pattern").constantOr(1))nt(I,O,N,j,ee,$n.disabled,bn.disabled,Z),nt(I,O,N,j,ee,I.stencilModeFor3D(),I.colorModeForRenderPass(),Z);else{const ae=I.colorModeForRenderPass();nt(I,O,N,j,ee,$n.disabled,ae,Z)}}})(i,u,_,b,S):c.ch(_)?(function(I,O,N,j,G){if(I.renderPass!=="offscreen"&&I.renderPass!=="translucent")return;const{isRenderingToTexture:K}=G,Z=I.context,ee=I.style.projection.useSubdivision,ae=I.getDepthModeForSublayer(0,sn.ReadOnly),ge=I.colorModeForRenderPass();if(I.renderPass==="offscreen")(function(me,ve,we,Pe,Ce,ze,Ve){const Ie=me.context,Ye=Ie.gl;for(const ct of we){const rt=ve.getTile(ct),st=rt.dem;if(!st||!st.data||!rt.needsHillshadePrepare)continue;const lt=st.dim,Nt=st.stride,Vt=st.getPixels();if(Ie.activeTexture.set(Ye.TEXTURE1),Ie.pixelStoreUnpackPremultiplyAlpha.set(!1),rt.demTexture=rt.demTexture||me.getTileTexture(Nt),rt.demTexture){const ln=rt.demTexture;ln.update(Vt,{premultiply:!1}),ln.bind(Ye.NEAREST,Ye.CLAMP_TO_EDGE)}else rt.demTexture=new c.T(Ie,Vt,Ye.RGBA,{premultiply:!1}),rt.demTexture.bind(Ye.NEAREST,Ye.CLAMP_TO_EDGE);Ie.activeTexture.set(Ye.TEXTURE0);let At=rt.fbo;if(!At){const ln=new c.T(Ie,{width:lt,height:lt,data:null},Ye.RGBA);ln.bind(Ye.LINEAR,Ye.CLAMP_TO_EDGE),At=rt.fbo=Ie.createFramebuffer(lt,lt,!0,!1),At.colorAttachment.set(ln.texture)}Ie.bindFramebuffer.set(At.framebuffer),Ie.viewport.set([0,0,lt,lt]),me.useProgram("hillshadePrepare").draw(Ie,Ye.TRIANGLES,Ce,ze,Ve,fn.disabled,Jd(rt.tileID,st),null,null,Pe.id,me.rasterBoundsBuffer,me.quadTriangleIndexBuffer,me.rasterBoundsSegments),rt.needsHillshadePrepare=!1}})(I,O,j,N,ae,$n.disabled,ge),Z.viewport.set([0,0,I.width,I.height]);else if(I.renderPass==="translucent")if(ee){const[me,ve,we]=I.stencilConfigForOverlapTwoPass(j);ut(I,O,N,we,me,ae,ge,!1,K),ut(I,O,N,we,ve,ae,ge,!0,K)}else{const[me,ve]=I.getStencilConfigForOverlapAndUpdateStencilID(j);ut(I,O,N,ve,me,ae,ge,!1,K)}})(i,u,_,b,S):c.ci(_)?(function(I,O,N,j,G){if(I.renderPass!=="translucent"||!j.length)return;const{isRenderingToTexture:K}=G,Z=I.style.projection.useSubdivision,ee=I.getDepthModeForSublayer(0,sn.ReadOnly),ae=I.colorModeForRenderPass();if(Z){const[ge,me,ve]=I.stencilConfigForOverlapTwoPass(j);It(I,O,N,ve,ge,ee,ae,!1,K),It(I,O,N,ve,me,ee,ae,!0,K)}else{const[ge,me]=I.getStencilConfigForOverlapAndUpdateStencilID(j);It(I,O,N,me,ge,ee,ae,!1,K)}})(i,u,_,b,S):c.cj(_)?(function(I,O,N,j,G){if(I.renderPass!=="translucent"||N.paint.get("raster-opacity")===0||!j.length)return;const{isRenderingToTexture:K}=G,Z=O.getSource(),ee=I.style.projection.useSubdivision;if(Z instanceof Vi)pn(I,O,N,j,null,!1,!1,Z.tileCoords,Z.flippedWindingOrder,K);else if(ee){const[ae,ge,me]=I.stencilConfigForOverlapTwoPass(j);pn(I,O,N,me,ae,!1,!0,Xt,!1,K),pn(I,O,N,me,ge,!0,!0,Xt,!1,K)}else{const[ae,ge]=I.getStencilConfigForOverlapAndUpdateStencilID(j);pn(I,O,N,ge,ae,!1,!0,Xt,!1,K)}})(i,u,_,b,S):c.ck(_)?(function(I,O,N,j,G){const K=N.paint.get("background-color"),Z=N.paint.get("background-opacity");if(Z===0)return;const{isRenderingToTexture:ee}=G,ae=I.context,ge=ae.gl,me=I.style.projection,ve=I.transform,we=ve.tileSize,Pe=N.paint.get("background-pattern");if(I.isPatternMissing(Pe))return;const Ce=!Pe&&K.a===1&&Z===1&&I.opaquePassEnabledForLayer()?"opaque":"translucent";if(I.renderPass!==Ce)return;const ze=$n.disabled,Ve=I.getDepthModeForSublayer(0,Ce==="opaque"?sn.ReadWrite:sn.ReadOnly),Ie=I.colorModeForRenderPass(),Ye=I.useProgram(Pe?"backgroundPattern":"background"),ct=j||$e(ve,{tileSize:we,terrain:I.style.map.terrain});Pe&&(ae.activeTexture.set(ge.TEXTURE0),I.imageManager.bind(I.context));const rt=N.getCrossfadeParameters();for(const st of ct){const lt=ve.getProjectionData({overscaledTileID:st,applyGlobeMatrix:!ee,applyTerrainMatrix:!0}),Nt=Pe?tf(Z,I,Pe,{tileID:st,tileSize:we},rt):ul(Z,K),Vt=I.style.map.terrain&&I.style.map.terrain.getTerrainData(st),At=me.getMeshFromTileID(ae,st.canonical,!1,!0,"raster");Ye.draw(ae,ge.TRIANGLES,Ve,ze,Ie,fn.backCCW,Nt,Vt,lt,N.id,At.vertexBuffer,At.indexBuffer,At.segments)}})(i,0,_,b,S):c.cl(_)&&(function(I,O,N,j){const{isRenderingGlobe:G}=j,K=I.context,Z=N.implementation,ee=I.style.projection,ae=I.transform,ge=ae.getProjectionDataForCustomLayer(G),me={farZ:ae.farZ,nearZ:ae.nearZ,fov:ae.fov*Math.PI/180,modelViewProjectionMatrix:ae.modelViewProjectionMatrix,projectionMatrix:ae.projectionMatrix,shaderData:{variantName:ee.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${ee.shaderPreludeCode.vertexSource}`,define:ee.shaderDefine},defaultProjectionData:ge},ve=Z.renderingMode?Z.renderingMode:"2d";if(I.renderPass==="offscreen"){const we=Z.prerender;we&&(I.setCustomLayerDefaults(),K.setColorMode(I.colorModeForRenderPass()),we.call(Z,K.gl,me),K.setDirty(),I.setBaseState())}else if(I.renderPass==="translucent"){I.setCustomLayerDefaults(),K.setColorMode(I.colorModeForRenderPass()),K.setStencilMode($n.disabled);const we=ve==="3d"?I.getDepthModeFor3D():I.getDepthModeForSublayer(0,sn.ReadOnly);K.setDepthMode(we),Z.render(K.gl,me),K.setDirty(),I.setBaseState(),K.bindFramebuffer.set(null)}})(i,0,_,S))}saveTileTexture(i){const u=this._tileTextures[i.size[0]];u?u.push(i):this._tileTextures[i.size[0]]=[i]}getTileTexture(i){const u=this._tileTextures[i];return u&&u.length>0?u.pop():null}isPatternMissing(i){if(!i)return!1;if(!i.from||!i.to)return!0;const u=this.imageManager.getPattern(i.from.toString()),_=this.imageManager.getPattern(i.to.toString());return!u||!_}useProgram(i,u,_=!1,b=[]){this.cache=this.cache||{};const S=!!this.style.map.terrain,I=this.style.projection,O=_?Zi.projectionMercator:I.shaderPreludeCode,N=_?qa:I.shaderDefine,j=i+(u?u.cacheKey:"")+`/${_?Zs:I.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(S?"/terrain":"")+(b?`/${b.join("/")}`:"");return this.cache[j]||(this.cache[j]=new Kt(this.context,Zi[i],u,ad[i],this._showOverdrawInspector,S,O,N,b)),this.cache[j]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const i=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(i.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new c.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:i,drawingBufferHeight:u}=this.context.gl;return this.width!==i||this.height!==u}}function as(T,i){let u,_=!1,b=null,S=null;const I=()=>{b=null,_&&(T.apply(S,u),b=setTimeout(I,i),_=!1)};return(...O)=>(_=!0,S=this,u=O,b||I(),b)}class gl{constructor(i){this._getCurrentHash=()=>{const u=window.location.hash.replace("#","");if(this._hashName){let _;return u.split("&").map((b=>b.split("="))).forEach((b=>{b[0]===this._hashName&&(_=b)})),(_&&_[1]||"").split("/")}return u.split("/")},this._onHashChange=()=>{const u=this._getCurrentHash();if(!this._isValidHash(u))return!1;const _=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(u[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+u[2],+u[1]],zoom:+u[0],bearing:_,pitch:+(u[4]||0)}),!0},this._updateHashUnthrottled=()=>{const u=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,u)},this._removeHash=()=>{const u=this._getCurrentHash();if(u.length===0)return;const _=u.join("/");let b=_;b.split("&").length>0&&(b=b.split("&")[0]),this._hashName&&(b=`${this._hashName}=${_}`);let S=window.location.hash.replace(b,"");S.startsWith("#&")?S=S.slice(0,1)+S.slice(2):S==="#"&&(S="");let I=window.location.href.replace(/(#.+)?$/,S);I=I.replace("&&","&"),window.history.replaceState(window.history.state,null,I)},this._updateHash=as(this._updateHashUnthrottled,300),this._hashName=i&&encodeURIComponent(i)}addTo(i){return this._map=i,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(i){const u=this._map.getCenter(),_=Math.round(100*this._map.getZoom())/100,b=Math.ceil((_*Math.LN2+Math.log(512/360/.5))/Math.LN10),S=Math.pow(10,b),I=Math.round(u.lng*S)/S,O=Math.round(u.lat*S)/S,N=this._map.getBearing(),j=this._map.getPitch();let G="";if(G+=i?`/${I}/${O}/${_}`:`${_}/${O}/${I}`,(N||j)&&(G+="/"+Math.round(10*N)/10),j&&(G+=`/${Math.round(j)}`),this._hashName){const K=this._hashName;let Z=!1;const ee=window.location.hash.slice(1).split("&").map((ae=>{const ge=ae.split("=")[0];return ge===K?(Z=!0,`${ge}=${G}`):ae})).filter((ae=>ae));return Z||ee.push(`${K}=${G}`),`#${ee.join("&")}`}return`#${G}`}_isValidHash(i){if(i.length<3||i.some(isNaN))return!1;try{new c.S(+i[2],+i[1])}catch{return!1}const u=+i[0],_=+(i[3]||0),b=+(i[4]||0);return u>=this._map.getMinZoom()&&u<=this._map.getMaxZoom()&&_>=-180&&_<=180&&b>=this._map.getMinPitch()&&b<=this._map.getMaxPitch()}}const Fo={linearity:.3,easing:c.cm(0,0,.3,1)},Eu=c.e({deceleration:2500,maxSpeed:1400},Fo),lc=c.e({deceleration:20,maxSpeed:1400},Fo),Vl=c.e({deceleration:1e3,maxSpeed:360},Fo),_l=c.e({deceleration:1e3,maxSpeed:90},Fo),Au=c.e({deceleration:1e3,maxSpeed:360},Fo);class Jl{constructor(i){this._map=i,this.clear()}clear(){this._inertiaBuffer=[]}record(i){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:J.now(),settings:i})}_drainInertiaBuffer(){const i=this._inertiaBuffer,u=J.now();for(;i.length>0&&u-i[0].time>160;)i.shift()}_onMoveEnd(i){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const u={zoom:0,bearing:0,pitch:0,roll:0,pan:new c.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:S}of this._inertiaBuffer)u.zoom+=S.zoomDelta||0,u.bearing+=S.bearingDelta||0,u.pitch+=S.pitchDelta||0,u.roll+=S.rollDelta||0,S.panDelta&&u.pan._add(S.panDelta),S.around&&(u.around=S.around),S.pinchAround&&(u.pinchAround=S.pinchAround);const _=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,b={};if(u.pan.mag()){const S=uc(u.pan.mag(),_,c.e({},Eu,i||{})),I=u.pan.mult(S.amount/u.pan.mag()),O=this._map.cameraHelper.handlePanInertia(I,this._map.transform);b.center=O.easingCenter,b.offset=O.easingOffset,Vo(b,S)}if(u.zoom){const S=uc(u.zoom,_,lc);b.zoom=this._map.transform.zoom+S.amount,Vo(b,S)}if(u.bearing){const S=uc(u.bearing,_,Vl);b.bearing=this._map.transform.bearing+c.ah(S.amount,-179,179),Vo(b,S)}if(u.pitch){const S=uc(u.pitch,_,_l);b.pitch=this._map.transform.pitch+S.amount,Vo(b,S)}if(u.roll){const S=uc(u.roll,_,Au);b.roll=this._map.transform.roll+c.ah(S.amount,-179,179),Vo(b,S)}if(b.zoom||b.bearing){const S=u.pinchAround===void 0?u.around:u.pinchAround;b.around=S?this._map.unproject(S):this._map.getCenter()}return this.clear(),c.e(b,{noMoveStart:!0})}}function Vo(T,i){(!T.duration||T.duration<i.duration)&&(T.duration=i.duration,T.easing=i.easing)}function uc(T,i,u){const{maxSpeed:_,linearity:b,deceleration:S}=u,I=c.ah(T*b/(i/1e3),-_,_),O=Math.abs(I)/(S*b);return{easing:u.easing,duration:1e3*O,amount:I*(O/2)}}class ka extends c.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,u,_,b={}){_=_ instanceof MouseEvent?_:new MouseEvent(i,_);const S=Y.mousePos(u.getCanvas(),_),I=u.unproject(S);super(i,c.e({point:S,lngLat:I,originalEvent:_},b)),this._defaultPrevented=!1,this.target=u}}class Cu extends c.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,u,_){const b=i==="touchend"?_.changedTouches:_.touches,S=Y.touchPos(u.getCanvasContainer(),b),I=S.map((N=>u.unproject(N))),O=S.reduce(((N,j,G,K)=>N.add(j.div(K.length))),new c.P(0,0));super(i,{points:S,point:O,lngLats:I,lngLat:u.unproject(O),originalEvent:_}),this._defaultPrevented=!1}}class Iu extends c.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,u,_){super(i,{originalEvent:_}),this._defaultPrevented=!1}}class Wa{constructor(i,u){this._map=i,this._clickTolerance=u.clickTolerance}reset(){delete this._mousedownPos}wheel(i){return this._firePreventable(new Iu(i.type,this._map,i))}mousedown(i,u){return this._mousedownPos=u,this._firePreventable(new ka(i.type,this._map,i))}mouseup(i){this._map.fire(new ka(i.type,this._map,i))}click(i,u){this._mousedownPos&&this._mousedownPos.dist(u)>=this._clickTolerance||this._map.fire(new ka(i.type,this._map,i))}dblclick(i){return this._firePreventable(new ka(i.type,this._map,i))}mouseover(i){this._map.fire(new ka(i.type,this._map,i))}mouseout(i){this._map.fire(new ka(i.type,this._map,i))}touchstart(i){return this._firePreventable(new Cu(i.type,this._map,i))}touchmove(i){this._map.fire(new Cu(i.type,this._map,i))}touchend(i){this._map.fire(new Cu(i.type,this._map,i))}touchcancel(i){this._map.fire(new Cu(i.type,this._map,i))}_firePreventable(i){if(this._map.fire(i),i.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ld{constructor(i){this._map=i}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(i){this._map.fire(new ka(i.type,this._map,i))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ka("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(i){this._delayContextMenu?this._contextMenuEvent=i:this._ignoreContextMenu||this._map.fire(new ka(i.type,this._map,i)),this._map.listens("contextmenu")&&i.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class qc{constructor(i){this._map=i}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(i){return this.transform.screenPointToLocation(c.P.convert(i),this._map.terrain)}}class ep{constructor(i,u){this._map=i,this._tr=new qc(i),this._el=i.getCanvasContainer(),this._container=i.getContainer(),this._clickTolerance=u.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(i,u){this.isEnabled()&&i.shiftKey&&i.button===0&&(Y.disableDrag(),this._startPos=this._lastPos=u,this._active=!0)}mousemoveWindow(i,u){if(!this._active)return;const _=u;if(this._lastPos.equals(_)||!this._box&&_.dist(this._startPos)<this._clickTolerance)return;const b=this._startPos;this._lastPos=_,this._box||(this._box=Y.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",i));const S=Math.min(b.x,_.x),I=Math.max(b.x,_.x),O=Math.min(b.y,_.y),N=Math.max(b.y,_.y);Y.setTransform(this._box,`translate(${S}px,${O}px)`),this._box.style.width=I-S+"px",this._box.style.height=N-O+"px"}mouseupWindow(i,u){if(!this._active||i.button!==0)return;const _=this._startPos,b=u;if(this.reset(),Y.suppressClick(),_.x!==b.x||_.y!==b.y)return this._map.fire(new c.l("boxzoomend",{originalEvent:i})),{cameraAnimation:S=>S.fitScreenCoordinates(_,b,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",i)}keydown(i){this._active&&i.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",i))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(Y.remove(this._box),this._box=null),Y.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(i,u){return this._map.fire(new c.l(i,{originalEvent:u}))}}function xh(T,i){if(T.length!==i.length)throw new Error(`The number of touches and points are not equal - touches ${T.length}, points ${i.length}`);const u={};for(let _=0;_<T.length;_++)u[T[_].identifier]=i[_];return u}class cm{constructor(i){this.reset(),this.numTouches=i.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(i,u,_){(this.centroid||_.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=i.timeStamp),_.length===this.numTouches&&(this.centroid=(function(b){const S=new c.P(0,0);for(const I of b)S._add(I);return S.div(b.length)})(u),this.touches=xh(_,u)))}touchmove(i,u,_){if(this.aborted||!this.centroid)return;const b=xh(_,u);for(const S in this.touches){const I=b[S];(!I||I.dist(this.touches[S])>30)&&(this.aborted=!0)}}touchend(i,u,_){if((!this.centroid||i.timeStamp-this.startTime>500)&&(this.aborted=!0),_.length===0){const b=!this.aborted&&this.centroid;if(this.reset(),b)return b}}}class Ci{constructor(i){this.singleTap=new cm(i),this.numTaps=i.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(i,u,_){this.singleTap.touchstart(i,u,_)}touchmove(i,u,_){this.singleTap.touchmove(i,u,_)}touchend(i,u,_){const b=this.singleTap.touchend(i,u,_);if(b){const S=i.timeStamp-this.lastTime<500,I=!this.lastTap||this.lastTap.dist(b)<30;if(S&&I||this.reset(),this.count++,this.lastTime=i.timeStamp,this.lastTap=b,this.count===this.numTaps)return this.reset(),b}}}class Uo{constructor(i){this._tr=new qc(i),this._zoomIn=new Ci({numTouches:1,numTaps:2}),this._zoomOut=new Ci({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(i,u,_){this._zoomIn.touchstart(i,u,_),this._zoomOut.touchstart(i,u,_)}touchmove(i,u,_){this._zoomIn.touchmove(i,u,_),this._zoomOut.touchmove(i,u,_)}touchend(i,u,_){const b=this._zoomIn.touchend(i,u,_),S=this._zoomOut.touchend(i,u,_),I=this._tr;return b?(this._active=!0,i.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:O=>O.easeTo({duration:300,zoom:I.zoom+1,around:I.unproject(b)},{originalEvent:i})}):S?(this._active=!0,i.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:O=>O.easeTo({duration:300,zoom:I.zoom-1,around:I.unproject(S)},{originalEvent:i})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class eu{constructor(i){this._enabled=!!i.enable,this._moveStateManager=i.moveStateManager,this._clickTolerance=i.clickTolerance||1,this._moveFunction=i.move,this._activateOnStart=!!i.activateOnStart,i.assignEvents(this),this.reset()}reset(i){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(i)}_move(...i){const u=this._moveFunction(...i);if(u.bearingDelta||u.pitchDelta||u.rollDelta||u.around||u.panDelta)return this._active=!0,u}dragStart(i,u){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(i)&&(this._moveStateManager.startMove(i),this._lastPoint=Array.isArray(u)?u[0]:u,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(i,u){if(!this.isEnabled())return;const _=this._lastPoint;if(!_)return;if(i.preventDefault(),!this._moveStateManager.isValidMoveEvent(i))return void this.reset(i);const b=Array.isArray(u)?u[0]:u;return!this._moved&&b.dist(_)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=b,this._move(_,b))}dragEnd(i){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(i)&&(this._moved&&Y.suppressClick(),this.reset(i))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const eo=0,cc=2,wh={[eo]:1,[cc]:2};class tu{constructor(i){this._correctEvent=i.checkCorrectEvent}startMove(i){const u=Y.mouseButton(i);this._eventButton=u}endMove(i){delete this._eventButton}isValidStartEvent(i){return this._correctEvent(i)}isValidMoveEvent(i){return!(function(u,_){const b=wh[_];return u.buttons===void 0||(u.buttons&b)!==b})(i,this._eventButton)}isValidEndEvent(i){return Y.mouseButton(i)===this._eventButton}}class Bg{constructor(){this._firstTouch=void 0}_isOneFingerTouch(i){return i.targetTouches.length===1}_isSameTouchEvent(i){return i.targetTouches[0].identifier===this._firstTouch}startMove(i){this._firstTouch=i.targetTouches[0].identifier}endMove(i){delete this._firstTouch}isValidStartEvent(i){return this._isOneFingerTouch(i)}isValidMoveEvent(i){return this._isOneFingerTouch(i)&&this._isSameTouchEvent(i)}isValidEndEvent(i){return this._isOneFingerTouch(i)&&this._isSameTouchEvent(i)}}class hm{constructor(i=new tu({checkCorrectEvent:()=>!0}),u=new Bg){this.mouseMoveStateManager=i,this.oneFingerTouchMoveStateManager=u}_executeRelevantHandler(i,u,_){return i instanceof MouseEvent?u(i):typeof TouchEvent<"u"&&i instanceof TouchEvent?_(i):void 0}startMove(i){this._executeRelevantHandler(i,(u=>this.mouseMoveStateManager.startMove(u)),(u=>this.oneFingerTouchMoveStateManager.startMove(u)))}endMove(i){this._executeRelevantHandler(i,(u=>this.mouseMoveStateManager.endMove(u)),(u=>this.oneFingerTouchMoveStateManager.endMove(u)))}isValidStartEvent(i){return this._executeRelevantHandler(i,(u=>this.mouseMoveStateManager.isValidStartEvent(u)),(u=>this.oneFingerTouchMoveStateManager.isValidStartEvent(u)))}isValidMoveEvent(i){return this._executeRelevantHandler(i,(u=>this.mouseMoveStateManager.isValidMoveEvent(u)),(u=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(u)))}isValidEndEvent(i){return this._executeRelevantHandler(i,(u=>this.mouseMoveStateManager.isValidEndEvent(u)),(u=>this.oneFingerTouchMoveStateManager.isValidEndEvent(u)))}}const ud=T=>{T.mousedown=T.dragStart,T.mousemoveWindow=T.dragMove,T.mouseup=T.dragEnd,T.contextmenu=i=>{i.preventDefault()}};class Th{constructor(i,u){this._clickTolerance=i.clickTolerance||1,this._map=u,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new c.P(0,0)}_shouldBePrevented(i){return i<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(i,u,_){return this._calculateTransform(i,u,_)}touchmove(i,u,_){if(this._active){if(!this._shouldBePrevented(_.length))return i.preventDefault(),this._calculateTransform(i,u,_);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",i)}}touchend(i,u,_){this._calculateTransform(i,u,_),this._active&&this._shouldBePrevented(_.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(i,u,_){_.length>0&&(this._active=!0);const b=xh(_,u),S=new c.P(0,0),I=new c.P(0,0);let O=0;for(const j in b){const G=b[j],K=this._touches[j];K&&(S._add(G),I._add(G.sub(K)),O++,b[j]=G)}if(this._touches=b,this._shouldBePrevented(O)||!I.mag())return;const N=I.div(O);return this._sum._add(N),this._sum.mag()<this._clickTolerance?void 0:{around:S.div(O),panDelta:N}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ss{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(i,u,_){this._firstTwoTouches||_.length<2||(this._firstTwoTouches=[_[0].identifier,_[1].identifier],this._start([u[0],u[1]]))}touchmove(i,u,_){if(!this._firstTwoTouches)return;i.preventDefault();const[b,S]=this._firstTwoTouches,I=Yt(_,u,b),O=Yt(_,u,S);if(!I||!O)return;const N=this._aroundCenter?null:I.add(O).div(2);return this._move([I,O],N,i)}touchend(i,u,_){if(!this._firstTwoTouches)return;const[b,S]=this._firstTwoTouches,I=Yt(_,u,b),O=Yt(_,u,S);I&&O||(this._active&&Y.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(i){this._enabled=!0,this._aroundCenter=!!i&&i.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Yt(T,i,u){for(let _=0;_<T.length;_++)if(T[_].identifier===u)return i[_]}function Sh(T,i){return Math.log(T/i)/Math.LN2}class cd extends ss{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(i){this._startDistance=this._distance=i[0].dist(i[1])}_move(i,u){const _=this._distance;if(this._distance=i[0].dist(i[1]),this._active||!(Math.abs(Sh(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Sh(this._distance,_),pinchAround:u}}}function hc(T,i){return 180*T.angleWith(i)/Math.PI}class dc extends ss{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(i){this._startVector=this._vector=i[0].sub(i[1]),this._minDiameter=i[0].dist(i[1])}_move(i,u,_){const b=this._vector;if(this._vector=i[0].sub(i[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:hc(this._vector,b),pinchAround:u}}_isBelowThreshold(i){this._minDiameter=Math.min(this._minDiameter,i.mag());const u=25/(Math.PI*this._minDiameter)*360,_=hc(i,this._startVector);return Math.abs(_)<u}}function nu(T){return Math.abs(T.y)>Math.abs(T.x)}class Gc extends ss{constructor(i){super(),this._currentTouchCount=0,this._map=i}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(i,u,_){super.touchstart(i,u,_),this._currentTouchCount=_.length}_start(i){this._lastPoints=i,nu(i[0].sub(i[1]))&&(this._valid=!1)}_move(i,u,_){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const b=i[0].sub(this._lastPoints[0]),S=i[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(b,S,_.timeStamp),this._valid?(this._lastPoints=i,this._active=!0,{pitchDelta:(b.y+S.y)/2*-.5}):void 0}gestureBeginsVertically(i,u,_){if(this._valid!==void 0)return this._valid;const b=i.mag()>=2,S=u.mag()>=2;if(!b&&!S)return;if(!b||!S)return this._firstMove===void 0&&(this._firstMove=_),_-this._firstMove<100&&void 0;const I=i.y>0==u.y>0;return nu(i)&&nu(u)&&I}}const ri={panStep:100,bearingStep:15,pitchStep:10};class hd{constructor(i){this._tr=new qc(i);const u=ri;this._panStep=u.panStep,this._bearingStep=u.bearingStep,this._pitchStep=u.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(i){if(i.altKey||i.ctrlKey||i.metaKey)return;let u=0,_=0,b=0,S=0,I=0;switch(i.keyCode){case 61:case 107:case 171:case 187:u=1;break;case 189:case 109:case 173:u=-1;break;case 37:i.shiftKey?_=-1:(i.preventDefault(),S=-1);break;case 39:i.shiftKey?_=1:(i.preventDefault(),S=1);break;case 38:i.shiftKey?b=1:(i.preventDefault(),I=-1);break;case 40:i.shiftKey?b=-1:(i.preventDefault(),I=1);break;default:return}return this._rotationDisabled&&(_=0,b=0),{cameraAnimation:O=>{const N=this._tr;O.easeTo({duration:300,easeId:"keyboardHandler",easing:Hc,zoom:u?Math.round(N.zoom)+u*(i.shiftKey?2:1):N.zoom,bearing:N.bearing+_*this._bearingStep,pitch:N.pitch+b*this._pitchStep,offset:[-S*this._panStep,-I*this._panStep],center:N.center},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Hc(T){return T*(2-T)}const iu=4.000244140625,dm=1/450;class tp{constructor(i,u){this._onTimeout=_=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(_)},this._map=i,this._tr=new qc(i),this._triggerRenderFrame=u,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=dm}setZoomRate(i){this._defaultZoomRate=i}setWheelZoomRate(i){this._wheelZoomRate=i}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(i){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!i&&i.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(i){return!!this._map.cooperativeGestures.isEnabled()&&!(i.ctrlKey||this._map.cooperativeGestures.isBypassed(i))}wheel(i){if(!this.isEnabled())return;if(this._shouldBePrevented(i))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",i);let u=i.deltaMode===WheelEvent.DOM_DELTA_LINE?40*i.deltaY:i.deltaY;const _=J.now(),b=_-(this._lastWheelEventTime||0);this._lastWheelEventTime=_,u!==0&&u%iu==0?this._type="wheel":u!==0&&Math.abs(u)<4?this._type="trackpad":b>400?(this._type=null,this._lastValue=u,this._timeout=setTimeout(this._onTimeout,40,i)):this._type||(this._type=Math.abs(b*u)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,u+=this._lastValue)),i.shiftKey&&u&&(u/=4),this._type&&(this._lastWheelEvent=i,this._delta-=u,this._active||this._start(i)),i.preventDefault()}_start(i){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const u=Y.mousePos(this._map.getCanvas(),i),_=this._tr;this._aroundPoint=this._aroundCenter?_.transform.locationToScreenPoint(c.S.convert(_.center)):u,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const i=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const O=i.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=O),typeof this._targetZoom=="number"&&(this._targetZoom+=O)}if(this._delta!==0){const O=this._type==="wheel"&&Math.abs(this._delta)>iu?this._wheelZoomRate:this._defaultZoomRate;let N=2/(1+Math.exp(-Math.abs(this._delta*O)));this._delta<0&&N!==0&&(N=1/N);const j=typeof this._targetZoom!="number"?i.scale:c.af(this._targetZoom);this._targetZoom=i.getConstrained(i.getCameraLngLat(),c.ak(j*N)).zoom,this._type==="wheel"&&(this._startZoom=i.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const u=typeof this._targetZoom!="number"?i.zoom:this._targetZoom,_=this._startZoom,b=this._easing;let S,I=!1;if(this._type==="wheel"&&_&&b){const O=J.now()-this._lastWheelEventTime,N=Math.min((O+5)/200,1),j=b(N);S=c.C.number(_,u,j),N<1?this._frameId||(this._frameId=!0):I=!0}else S=u,I=!0;return this._active=!0,I&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout}),200)),this._lastExpectedZoom=S,{noInertia:!0,needsRenderFrame:!I,zoomDelta:S-i.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(i){let u=c.co;if(this._prevEase){const _=this._prevEase,b=(J.now()-_.start)/_.duration,S=_.easing(b+.01)-_.easing(b),I=.27/Math.sqrt(S*S+1e-4)*.01,O=Math.sqrt(.0729-I*I);u=c.cm(I,O,.25,1)}return this._prevEase={start:J.now(),duration:i,easing:u},u}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class fc{constructor(i,u){this._clickZoom=i,this._tapZoom=u}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Zc{constructor(i){this._tr=new qc(i),this.reset()}reset(){this._active=!1}dblclick(i,u){return i.preventDefault(),{cameraAnimation:_=>{_.easeTo({duration:300,zoom:this._tr.zoom+(i.shiftKey?-1:1),around:this._tr.unproject(u)},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class dd{constructor(){this._tap=new Ci({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(i,u,_){if(!this._swipePoint)if(this._tapTime){const b=u[0],S=i.timeStamp-this._tapTime<500,I=this._tapPoint.dist(b)<30;S&&I?_.length>0&&(this._swipePoint=b,this._swipeTouch=_[0].identifier):this.reset()}else this._tap.touchstart(i,u,_)}touchmove(i,u,_){if(this._tapTime){if(this._swipePoint){if(_[0].identifier!==this._swipeTouch)return;const b=u[0],S=b.y-this._swipePoint.y;return this._swipePoint=b,i.preventDefault(),this._active=!0,{zoomDelta:S/128}}}else this._tap.touchmove(i,u,_)}touchend(i,u,_){if(this._tapTime)this._swipePoint&&_.length===0&&this.reset();else{const b=this._tap.touchend(i,u,_);b&&(this._tapTime=i.timeStamp,this._tapPoint=b)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Eh{constructor(i,u,_){this._el=i,this._mousePan=u,this._touchPan=_}enable(i){this._inertiaOptions=i||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Ah{constructor(i,u,_,b){this._pitchWithRotate=i.pitchWithRotate,this._rollEnabled=i.rollEnabled,this._mouseRotate=u,this._mousePitch=_,this._mouseRoll=b}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class np{constructor(i,u,_,b){this._el=i,this._touchZoom=u,this._touchRotate=_,this._tapDragZoom=b,this._rotationDisabled=!1,this._enabled=!0}enable(i){this._touchZoom.enable(i),this._rotationDisabled||this._touchRotate.enable(i),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class pc{constructor(i,u){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=i,this._options=u,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const i=this._map.getCanvasContainer();i.classList.add("maplibregl-cooperative-gestures"),this._container=Y.create("div","maplibregl-cooperative-gesture-screen",i);let u=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(u=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const _=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),b=document.createElement("div");b.className="maplibregl-desktop-message",b.textContent=u,this._container.appendChild(b);const S=document.createElement("div");S.className="maplibregl-mobile-message",S.textContent=_,this._container.appendChild(S),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(Y.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(i){return i[this._bypassKey]}notifyGestureBlocked(i,u){this._enabled&&(this._map.fire(new c.l("cooperativegestureprevented",{gestureType:i,originalEvent:u})),this._container.classList.add("maplibregl-show"),setTimeout((()=>{this._container.classList.remove("maplibregl-show")}),100))}}const yl=T=>T.zoom||T.drag||T.roll||T.pitch||T.rotate;class Di extends c.l{}function mc(T){return T.panDelta&&T.panDelta.mag()||T.zoomDelta||T.bearingDelta||T.pitchDelta||T.rollDelta}class fd{constructor(i,u){this.handleWindowEvent=b=>{this.handleEvent(b,`${b.type}Window`)},this.handleEvent=(b,S)=>{if(b.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const I=b.type==="renderFrame"?void 0:b,O={needsRenderFrame:!1},N={},j={};for(const{handlerName:Z,handler:ee,allowed:ae}of this._handlers){if(!ee.isEnabled())continue;let ge;if(this._blockedByActive(j,ae,Z))ee.reset();else if(ee[S||b.type]){if(c.cp(b,S||b.type)){const me=Y.mousePos(this._map.getCanvas(),b);ge=ee[S||b.type](b,me)}else if(c.cq(b,S||b.type)){const me=this._getMapTouches(b.touches),ve=Y.touchPos(this._map.getCanvas(),me);ge=ee[S||b.type](b,ve,me)}else c.cr(S||b.type)||(ge=ee[S||b.type](b));this.mergeHandlerResult(O,N,ge,Z,I),ge&&ge.needsRenderFrame&&this._triggerRenderFrame()}(ge||ee.isActive())&&(j[Z]=ee)}const G={};for(const Z in this._previousActiveHandlers)j[Z]||(G[Z]=I);this._previousActiveHandlers=j,(Object.keys(G).length||mc(O))&&(this._changes.push([O,N,G]),this._triggerRenderFrame()),(Object.keys(j).length||mc(O))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:K}=O;K&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],K(this._map))},this._map=i,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Jl(i),this._bearingSnap=u.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(u);const _=this._el;this._listeners=[[_,"touchstart",{passive:!0}],[_,"touchmove",{passive:!1}],[_,"touchend",void 0],[_,"touchcancel",void 0],[_,"mousedown",void 0],[_,"mousemove",void 0],[_,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[_,"mouseover",void 0],[_,"mouseout",void 0],[_,"dblclick",void 0],[_,"click",void 0],[_,"keydown",{capture:!1}],[_,"keyup",void 0],[_,"wheel",{passive:!1}],[_,"contextmenu",void 0],[window,"blur",void 0]];for(const[b,S,I]of this._listeners)Y.addEventListener(b,S,b===document?this.handleWindowEvent:this.handleEvent,I)}destroy(){for(const[i,u,_]of this._listeners)Y.removeEventListener(i,u,i===document?this.handleWindowEvent:this.handleEvent,_)}_addDefaultHandlers(i){const u=this._map,_=u.getCanvasContainer();this._add("mapEvent",new Wa(u,i));const b=u.boxZoom=new ep(u,i);this._add("boxZoom",b),i.interactive&&i.boxZoom&&b.enable();const S=u.cooperativeGestures=new pc(u,i.cooperativeGestures);this._add("cooperativeGestures",S),i.cooperativeGestures&&S.enable();const I=new Uo(u),O=new Zc(u);u.doubleClickZoom=new fc(O,I),this._add("tapZoom",I),this._add("clickZoom",O),i.interactive&&i.doubleClickZoom&&u.doubleClickZoom.enable();const N=new dd;this._add("tapDragZoom",N);const j=u.touchPitch=new Gc(u);this._add("touchPitch",j),i.interactive&&i.touchPitch&&u.touchPitch.enable(i.touchPitch);const G=()=>u.project(u.getCenter()),K=(function({enable:Ce,clickTolerance:ze,aroundCenter:Ve=!0,minPixelCenterThreshold:Ie=100,rotateDegreesPerPixelMoved:Ye=.8},ct){const rt=new tu({checkCorrectEvent:st=>Y.mouseButton(st)===0&&st.ctrlKey||Y.mouseButton(st)===2&&!st.ctrlKey});return new eu({clickTolerance:ze,move:(st,lt)=>{const Nt=ct();if(Ve&&Math.abs(Nt.y-st.y)>Ie)return{bearingDelta:c.cn(new c.P(st.x,lt.y),lt,Nt)};let Vt=(lt.x-st.x)*Ye;return Ve&&lt.y<Nt.y&&(Vt=-Vt),{bearingDelta:Vt}},moveStateManager:rt,enable:Ce,assignEvents:ud})})(i,G),Z=(function({enable:Ce,clickTolerance:ze,pitchDegreesPerPixelMoved:Ve=-.5}){const Ie=new tu({checkCorrectEvent:Ye=>Y.mouseButton(Ye)===0&&Ye.ctrlKey||Y.mouseButton(Ye)===2});return new eu({clickTolerance:ze,move:(Ye,ct)=>({pitchDelta:(ct.y-Ye.y)*Ve}),moveStateManager:Ie,enable:Ce,assignEvents:ud})})(i),ee=(function({enable:Ce,clickTolerance:ze,rollDegreesPerPixelMoved:Ve=.3},Ie){const Ye=new tu({checkCorrectEvent:ct=>Y.mouseButton(ct)===2&&ct.ctrlKey});return new eu({clickTolerance:ze,move:(ct,rt)=>{const st=Ie();let lt=(rt.x-ct.x)*Ve;return rt.y<st.y&&(lt=-lt),{rollDelta:lt}},moveStateManager:Ye,enable:Ce,assignEvents:ud})})(i,G);u.dragRotate=new Ah(i,K,Z,ee),this._add("mouseRotate",K,["mousePitch"]),this._add("mousePitch",Z,["mouseRotate","mouseRoll"]),this._add("mouseRoll",ee,["mousePitch"]),i.interactive&&i.dragRotate&&u.dragRotate.enable();const ae=(function({enable:Ce,clickTolerance:ze}){const Ve=new tu({checkCorrectEvent:Ie=>Y.mouseButton(Ie)===0&&!Ie.ctrlKey});return new eu({clickTolerance:ze,move:(Ie,Ye)=>({around:Ye,panDelta:Ye.sub(Ie)}),activateOnStart:!0,moveStateManager:Ve,enable:Ce,assignEvents:ud})})(i),ge=new Th(i,u);u.dragPan=new Eh(_,ae,ge),this._add("mousePan",ae),this._add("touchPan",ge,["touchZoom","touchRotate"]),i.interactive&&i.dragPan&&u.dragPan.enable(i.dragPan);const me=new dc,ve=new cd;u.touchZoomRotate=new np(_,ve,me,N),this._add("touchRotate",me,["touchPan","touchZoom"]),this._add("touchZoom",ve,["touchPan","touchRotate"]),i.interactive&&i.touchZoomRotate&&u.touchZoomRotate.enable(i.touchZoomRotate);const we=u.scrollZoom=new tp(u,(()=>this._triggerRenderFrame()));this._add("scrollZoom",we,["mousePan"]),i.interactive&&i.scrollZoom&&u.scrollZoom.enable(i.scrollZoom);const Pe=u.keyboard=new hd(u);this._add("keyboard",Pe),i.interactive&&i.keyboard&&u.keyboard.enable(),this._add("blockableMapEvent",new ld(u))}_add(i,u,_){this._handlers.push({handlerName:i,handler:u,allowed:_}),this._handlersById[i]=u}stop(i){if(!this._updatingCamera){for(const{handler:u}of this._handlers)u.reset();this._inertia.clear(),this._fireEvents({},{},i),this._changes=[]}}isActive(){for(const{handler:i}of this._handlers)if(i.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!yl(this._eventsInProgress)||this.isZooming()}_blockedByActive(i,u,_){for(const b in i)if(b!==_&&(!u||u.indexOf(b)<0))return!0;return!1}_getMapTouches(i){const u=[];for(const _ of i)this._el.contains(_.target)&&u.push(_);return u}mergeHandlerResult(i,u,_,b,S){if(!_)return;c.e(i,_);const I={handlerName:b,originalEvent:_.originalEvent||S};_.zoomDelta!==void 0&&(u.zoom=I),_.panDelta!==void 0&&(u.drag=I),_.rollDelta!==void 0&&(u.roll=I),_.pitchDelta!==void 0&&(u.pitch=I),_.bearingDelta!==void 0&&(u.rotate=I)}_applyChanges(){const i={},u={},_={};for(const[b,S,I]of this._changes)b.panDelta&&(i.panDelta=(i.panDelta||new c.P(0,0))._add(b.panDelta)),b.zoomDelta&&(i.zoomDelta=(i.zoomDelta||0)+b.zoomDelta),b.bearingDelta&&(i.bearingDelta=(i.bearingDelta||0)+b.bearingDelta),b.pitchDelta&&(i.pitchDelta=(i.pitchDelta||0)+b.pitchDelta),b.rollDelta&&(i.rollDelta=(i.rollDelta||0)+b.rollDelta),b.around!==void 0&&(i.around=b.around),b.pinchAround!==void 0&&(i.pinchAround=b.pinchAround),b.noInertia&&(i.noInertia=b.noInertia),c.e(u,S),c.e(_,I);this._updateMapTransform(i,u,_),this._changes=[]}_updateMapTransform(i,u,_){const b=this._map,S=b._getTransformForUpdate(),I=b.terrain;if(!(mc(i)||I&&this._terrainMovement))return this._fireEvents(u,_,!0);b._stop(!0);let{panDelta:O,zoomDelta:N,bearingDelta:j,pitchDelta:G,rollDelta:K,around:Z,pinchAround:ee}=i;ee!==void 0&&(Z=ee),Z=Z||b.transform.centerPoint,I&&!S.isPointOnMapSurface(Z)&&(Z=S.centerPoint);const ae={panDelta:O,zoomDelta:N,rollDelta:K,pitchDelta:G,bearingDelta:j,around:Z};this._map.cameraHelper.useGlobeControls&&!S.isPointOnMapSurface(Z)&&(Z=S.centerPoint);const ge=Z.distSqr(S.centerPoint)<.01?S.center:S.screenPointToLocation(O?Z.sub(O):Z);I?(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(ae,S),this._terrainMovement||!u.drag&&!u.zoom?u.drag&&this._terrainMovement?S.setCenter(S.screenPointToLocation(S.centerPoint.sub(O))):this._map.cameraHelper.handleMapControlsPan(ae,S,ge):(this._terrainMovement=!0,this._map._elevationFreeze=!0,this._map.cameraHelper.handleMapControlsPan(ae,S,ge))):(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(ae,S),this._map.cameraHelper.handleMapControlsPan(ae,S,ge)),b._applyUpdatedTransform(S),this._map._update(),i.noInertia||this._inertia.record(i),this._fireEvents(u,_,!0)}_fireEvents(i,u,_){const b=yl(this._eventsInProgress),S=yl(i),I={};for(const K in i){const{originalEvent:Z}=i[K];this._eventsInProgress[K]||(I[`${K}start`]=Z),this._eventsInProgress[K]=i[K]}!b&&S&&this._fireEvent("movestart",S.originalEvent);for(const K in I)this._fireEvent(K,I[K]);S&&this._fireEvent("move",S.originalEvent);for(const K in i){const{originalEvent:Z}=i[K];this._fireEvent(K,Z)}const O={};let N;for(const K in this._eventsInProgress){const{handlerName:Z,originalEvent:ee}=this._eventsInProgress[K];this._handlersById[Z].isActive()||(delete this._eventsInProgress[K],N=u[Z]||ee,O[`${K}end`]=N)}for(const K in O)this._fireEvent(K,O[K]);const j=yl(this._eventsInProgress),G=(b||S)&&!j;if(G&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const K=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&K.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(K)}if(_&&G){this._updatingCamera=!0;const K=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Z=ee=>ee!==0&&-this._bearingSnap<ee&&ee<this._bearingSnap;!K||!K.essential&&J.prefersReducedMotion?(this._map.fire(new c.l("moveend",{originalEvent:N})),Z(this._map.getBearing())&&this._map.resetNorth()):(Z(K.bearing||this._map.getBearing())&&(K.bearing=0),K.freezeElevation=!0,this._map.easeTo(K,{originalEvent:N})),this._updatingCamera=!1}}_fireEvent(i,u){this._map.fire(new c.l(i,u?{originalEvent:u}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((i=>{delete this._frameId,this.handleEvent(new Di("renderFrame",{timeStamp:i})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Pu extends c.E{constructor(i,u,_){super(),this._renderFrameCallback=()=>{const b=Math.min((J.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(b)),b<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=i,this._bearingSnap=_.bearingSnap,this.cameraHelper=u,this.on("moveend",(()=>{delete this._requestedCameraState}))}migrateProjection(i,u){i.apply(this.transform),this.transform=i,this.cameraHelper=u}getCenter(){return new c.S(this.transform.center.lng,this.transform.center.lat)}setCenter(i,u){return this.jumpTo({center:i},u)}getCenterElevation(){return this.transform.elevation}setCenterElevation(i,u){return this.jumpTo({elevation:i},u),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(i){this._centerClampedToGround=i}panBy(i,u,_){return i=c.P.convert(i).mult(-1),this.panTo(this.transform.center,c.e({offset:i},u),_)}panTo(i,u,_){return this.easeTo(c.e({center:i},u),_)}getZoom(){return this.transform.zoom}setZoom(i,u){return this.jumpTo({zoom:i},u),this}zoomTo(i,u,_){return this.easeTo(c.e({zoom:i},u),_)}zoomIn(i,u){return this.zoomTo(this.getZoom()+1,i,u),this}zoomOut(i,u){return this.zoomTo(this.getZoom()-1,i,u),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(i,u){return i!=this.transform.fov&&(this.transform.setFov(i),this.fire(new c.l("movestart",u)).fire(new c.l("move",u)).fire(new c.l("moveend",u))),this}getBearing(){return this.transform.bearing}setBearing(i,u){return this.jumpTo({bearing:i},u),this}getPadding(){return this.transform.padding}setPadding(i,u){return this.jumpTo({padding:i},u),this}rotateTo(i,u,_){return this.easeTo(c.e({bearing:i},u),_)}resetNorth(i,u){return this.rotateTo(0,c.e({duration:1e3},i),u),this}resetNorthPitch(i,u){return this.easeTo(c.e({bearing:0,pitch:0,roll:0,duration:1e3},i),u),this}snapToNorth(i,u){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(i,u):this}getPitch(){return this.transform.pitch}setPitch(i,u){return this.jumpTo({pitch:i},u),this}getRoll(){return this.transform.roll}setRoll(i,u){return this.jumpTo({roll:i},u),this}cameraForBounds(i,u){i=Fi.convert(i).adjustAntiMeridian();const _=u&&u.bearing||0;return this._cameraForBoxAndBearing(i.getNorthWest(),i.getSouthEast(),_,u)}_cameraForBoxAndBearing(i,u,_,b){const S={top:0,bottom:0,right:0,left:0};if(typeof(b=c.e({padding:S,offset:[0,0],maxZoom:this.transform.maxZoom},b)).padding=="number"){const j=b.padding;b.padding={top:j,bottom:j,right:j,left:j}}const I=c.e(S,b.padding);b.padding=I;const O=this.transform,N=new Fi(i,u);return this.cameraHelper.cameraForBoxAndBearing(b,I,N,_,O)}fitBounds(i,u,_){return this._fitInternal(this.cameraForBounds(i,u),u,_)}fitScreenCoordinates(i,u,_,b,S){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(c.P.convert(i)),this.transform.screenPointToLocation(c.P.convert(u)),_,b),b,S)}_fitInternal(i,u,_){return i?(delete(u=c.e(i,u)).padding,u.linear?this.easeTo(u,_):this.flyTo(u,_)):this}jumpTo(i,u){this.stop();const _=this._getTransformForUpdate();let b=!1,S=!1,I=!1;const O=_.zoom;this.cameraHelper.handleJumpToCenterZoom(_,i);const N=_.zoom!==O;return"elevation"in i&&_.elevation!==+i.elevation&&_.setElevation(+i.elevation),"bearing"in i&&_.bearing!==+i.bearing&&(b=!0,_.setBearing(+i.bearing)),"pitch"in i&&_.pitch!==+i.pitch&&(S=!0,_.setPitch(+i.pitch)),"roll"in i&&_.roll!==+i.roll&&(I=!0,_.setRoll(+i.roll)),i.padding==null||_.isPaddingEqual(i.padding)||_.setPadding(i.padding),this._applyUpdatedTransform(_),this.fire(new c.l("movestart",u)).fire(new c.l("move",u)),N&&this.fire(new c.l("zoomstart",u)).fire(new c.l("zoom",u)).fire(new c.l("zoomend",u)),b&&this.fire(new c.l("rotatestart",u)).fire(new c.l("rotate",u)).fire(new c.l("rotateend",u)),S&&this.fire(new c.l("pitchstart",u)).fire(new c.l("pitch",u)).fire(new c.l("pitchend",u)),I&&this.fire(new c.l("rollstart",u)).fire(new c.l("roll",u)).fire(new c.l("rollend",u)),this.fire(new c.l("moveend",u))}calculateCameraOptionsFromTo(i,u,_,b=0){const S=c.a1.fromLngLat(i,u),I=c.a1.fromLngLat(_,b),O=I.x-S.x,N=I.y-S.y,j=I.z-S.z,G=Math.hypot(O,N,j);if(G===0)throw new Error("Can't calculate camera options with same From and To");const K=Math.hypot(O,N),Z=c.ak(this.transform.cameraToCenterDistance/G/this.transform.tileSize),ee=180*Math.atan2(O,-N)/Math.PI;let ae=180*Math.acos(K/G)/Math.PI;return ae=j<0?90-ae:90+ae,{center:I.toLngLat(),elevation:b,zoom:Z,pitch:ae,bearing:ee}}calculateCameraOptionsFromCameraLngLatAltRotation(i,u,_,b,S){const I=this.transform.calculateCenterFromCameraLngLatAlt(i,u,_,b);return{center:I.center,elevation:I.elevation,zoom:I.zoom,bearing:_,pitch:b,roll:S}}easeTo(i,u){this._stop(!1,i.easeId),((i=c.e({offset:[0,0],duration:500,easing:c.co},i)).animate===!1||!i.essential&&J.prefersReducedMotion)&&(i.duration=0);const _=this._getTransformForUpdate(),b=this.getBearing(),S=_.pitch,I=_.roll,O="bearing"in i?this._normalizeBearing(i.bearing,b):b,N="pitch"in i?+i.pitch:S,j="roll"in i?this._normalizeBearing(i.roll,I):I,G="padding"in i?i.padding:_.padding,K=c.P.convert(i.offset);let Z,ee;i.around&&(Z=c.S.convert(i.around),ee=_.locationToScreenPoint(Z));const ae={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},ge=this.cameraHelper.handleEaseTo(_,{bearing:O,pitch:N,roll:j,padding:G,around:Z,aroundPoint:ee,offsetAsPoint:K,offset:i.offset,zoom:i.zoom,center:i.center});return this._rotating=this._rotating||b!==O,this._pitching=this._pitching||N!==S,this._rolling=this._rolling||j!==I,this._padding=!_.isPaddingEqual(G),this._zooming=this._zooming||ge.isZooming,this._easeId=i.easeId,this._prepareEase(u,i.noMoveStart,ae),this.terrain&&this._prepareElevation(ge.elevationCenter),this._ease((me=>{ge.easeFunc(me),this.terrain&&!i.freezeElevation&&this._updateElevation(me),this._applyUpdatedTransform(_),this._fireMoveEvents(u)}),(me=>{this.terrain&&i.freezeElevation&&this._finalizeElevation(),this._afterEase(u,me)}),i),this}_prepareEase(i,u,_={}){this._moving=!0,u||_.moving||this.fire(new c.l("movestart",i)),this._zooming&&!_.zooming&&this.fire(new c.l("zoomstart",i)),this._rotating&&!_.rotating&&this.fire(new c.l("rotatestart",i)),this._pitching&&!_.pitching&&this.fire(new c.l("pitchstart",i)),this._rolling&&!_.rolling&&this.fire(new c.l("rollstart",i))}_prepareElevation(i){this._elevationCenter=i,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(i,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(i){this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const u=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(i<1&&u!==this._elevationTarget){const _=this._elevationTarget-this._elevationStart;this._elevationStart+=i*(_-(u-(_*i+this._elevationStart))/(1-i)),this._elevationTarget=u}this.transform.setElevation(c.C.number(this._elevationStart,this._elevationTarget,i))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(i){if(!this.terrain&&i.elevation>=0&&i.pitch<=90)return{};const u=i.getCameraLngLat(),_=i.getCameraAltitude(),b=this.terrain?this.terrain.getElevationForLngLatZoom(u,i.zoom):0;if(_<b){const S=this.calculateCameraOptionsFromTo(u,b,i.center,i.elevation);return{pitch:S.pitch,zoom:S.zoom}}return{}}_applyUpdatedTransform(i){const u=[];if(u.push((b=>this._elevateCameraIfInsideTerrain(b))),this.transformCameraUpdate&&u.push((b=>this.transformCameraUpdate(b))),!u.length)return;const _=i.clone();for(const b of u){const S=_.clone(),{center:I,zoom:O,roll:N,pitch:j,bearing:G,elevation:K}=b(S);I&&S.setCenter(I),K!==void 0&&S.setElevation(K),O!==void 0&&S.setZoom(O),N!==void 0&&S.setRoll(N),j!==void 0&&S.setPitch(j),G!==void 0&&S.setBearing(G),_.apply(S)}this.transform.apply(_)}_fireMoveEvents(i){this.fire(new c.l("move",i)),this._zooming&&this.fire(new c.l("zoom",i)),this._rotating&&this.fire(new c.l("rotate",i)),this._pitching&&this.fire(new c.l("pitch",i)),this._rolling&&this.fire(new c.l("roll",i))}_afterEase(i,u){if(this._easeId&&u&&this._easeId===u)return;delete this._easeId;const _=this._zooming,b=this._rotating,S=this._pitching,I=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,_&&this.fire(new c.l("zoomend",i)),b&&this.fire(new c.l("rotateend",i)),S&&this.fire(new c.l("pitchend",i)),I&&this.fire(new c.l("rollend",i)),this.fire(new c.l("moveend",i))}flyTo(i,u){if(!i.essential&&J.prefersReducedMotion){const lt=c.Q(i,["center","zoom","bearing","pitch","roll","elevation"]);return this.jumpTo(lt,u)}this.stop(),i=c.e({offset:[0,0],speed:1.2,curve:1.42,easing:c.co},i);const _=this._getTransformForUpdate(),b=_.bearing,S=_.pitch,I=_.roll,O=_.padding,N="bearing"in i?this._normalizeBearing(i.bearing,b):b,j="pitch"in i?+i.pitch:S,G="roll"in i?this._normalizeBearing(i.roll,I):I,K="padding"in i?i.padding:_.padding,Z=c.P.convert(i.offset);let ee=_.centerPoint.add(Z);const ae=_.screenPointToLocation(ee),ge=this.cameraHelper.handleFlyTo(_,{bearing:N,pitch:j,roll:G,padding:K,locationAtOffset:ae,offsetAsPoint:Z,center:i.center,minZoom:i.minZoom,zoom:i.zoom});let me=i.curve;const ve=Math.max(_.width,_.height),we=ve/ge.scaleOfZoom,Pe=ge.pixelPathLength;typeof ge.scaleOfMinZoom=="number"&&(me=Math.sqrt(ve/ge.scaleOfMinZoom/Pe*2));const Ce=me*me;function ze(lt){const Nt=(we*we-ve*ve+(lt?-1:1)*Ce*Ce*Pe*Pe)/(2*(lt?we:ve)*Ce*Pe);return Math.log(Math.sqrt(Nt*Nt+1)-Nt)}function Ve(lt){return(Math.exp(lt)-Math.exp(-lt))/2}function Ie(lt){return(Math.exp(lt)+Math.exp(-lt))/2}const Ye=ze(!1);let ct=function(lt){return Ie(Ye)/Ie(Ye+me*lt)},rt=function(lt){return ve*((Ie(Ye)*(Ve(Nt=Ye+me*lt)/Ie(Nt))-Ve(Ye))/Ce)/Pe;var Nt},st=(ze(!0)-Ye)/me;if(Math.abs(Pe)<2e-6||!isFinite(st)){if(Math.abs(ve-we)<1e-6)return this.easeTo(i,u);const lt=we<ve?-1:1;st=Math.abs(Math.log(we/ve))/me,rt=()=>0,ct=Nt=>Math.exp(lt*me*Nt)}return i.duration="duration"in i?+i.duration:1e3*st/("screenSpeed"in i?+i.screenSpeed/me:+i.speed),i.maxDuration&&i.duration>i.maxDuration&&(i.duration=0),this._zooming=!0,this._rotating=b!==N,this._pitching=j!==S,this._rolling=G!==I,this._padding=!_.isPaddingEqual(K),this._prepareEase(u,!1),this.terrain&&this._prepareElevation(ge.targetCenter),this._ease((lt=>{const Nt=lt*st,Vt=1/ct(Nt),At=rt(Nt);this._rotating&&_.setBearing(c.C.number(b,N,lt)),this._pitching&&_.setPitch(c.C.number(S,j,lt)),this._rolling&&_.setRoll(c.C.number(I,G,lt)),this._padding&&(_.interpolatePadding(O,K,lt),ee=_.centerPoint.add(Z)),ge.easeFunc(lt,Vt,At,ee),this.terrain&&!i.freezeElevation&&this._updateElevation(lt),this._applyUpdatedTransform(_),this._fireMoveEvents(u)}),(()=>{this.terrain&&i.freezeElevation&&this._finalizeElevation(),this._afterEase(u)}),i),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(i,u){var _;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const b=this._onEaseEnd;delete this._onEaseEnd,b.call(this,u)}return i||(_=this.handlers)===null||_===void 0||_.stop(!1),this}_ease(i,u,_){_.animate===!1||_.duration===0?(i(1),u()):(this._easeStart=J.now(),this._easeOptions=_,this._onEaseFrame=i,this._onEaseEnd=u,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(i,u){i=c.aO(i,-180,180);const _=Math.abs(i-u);return Math.abs(i-360-u)<_&&(i-=360),Math.abs(i+360-u)<_&&(i+=360),i}queryTerrainElevation(i){return this.terrain?this.terrain.getElevationForLngLatZoom(c.S.convert(i),this.transform.tileZoom):null}}const ru={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Wc{constructor(i=ru){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=u=>{!u||u.sourceDataType!=="metadata"&&u.sourceDataType!=="visibility"&&u.dataType!=="style"&&u.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=i}getDefaultPosition(){return"bottom-right"}onAdd(i){return this._map=i,this._compact=this.options.compact,this._container=Y.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=Y.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Y.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){Y.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(i,u){const _=this._map._getUIString(`AttributionControl.${u}`);i.title=_,i.setAttribute("aria-label",_)}_updateAttributions(){if(!this._map.style)return;let i=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?i=i.concat(this.options.customAttribution.map((b=>typeof b!="string"?"":b))):typeof this.options.customAttribution=="string"&&i.push(this.options.customAttribution)),this._map.style.stylesheet){const b=this._map.style.stylesheet;this.styleOwner=b.owner,this.styleId=b.id}const u=this._map.style.sourceCaches;for(const b in u){const S=u[b];if(S.used||S.usedForTerrain){const I=S.getSource();I.attribution&&i.indexOf(I.attribution)<0&&i.push(I.attribution)}}i=i.filter((b=>String(b).trim())),i.sort(((b,S)=>b.length-S.length)),i=i.filter(((b,S)=>{for(let I=S+1;I<i.length;I++)if(i[I].indexOf(b)>=0)return!1;return!0}));const _=i.join(" | ");_!==this._attribHTML&&(this._attribHTML=_,i.length?(this._innerContainer.innerHTML=Y.sanitize(_),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class rf{constructor(i={}){this._updateCompact=()=>{const u=this._container.children;if(u.length){const _=u[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&_.classList.add("maplibregl-compact"):_.classList.remove("maplibregl-compact")}},this.options=i}getDefaultPosition(){return"bottom-left"}onAdd(i){this._map=i,this._compact=this.options&&this.options.compact,this._container=Y.create("div","maplibregl-ctrl");const u=Y.create("a","maplibregl-ctrl-logo");return u.target="_blank",u.rel="noopener nofollow",u.href="https://maplibre.org/",u.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),u.setAttribute("rel","noopener nofollow"),this._container.appendChild(u),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){Y.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class vl{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(i){const u=++this._id;return this._queue.push({callback:i,id:u,cancelled:!1}),u}remove(i){const u=this._currentlyRunning,_=u?this._queue.concat(u):this._queue;for(const b of _)if(b.id===i)return void(b.cancelled=!0)}run(i=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const u=this._currentlyRunning=this._queue;this._queue=[];for(const _ of u)if(!_.cancelled&&(_.callback(i),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var gc=c.aJ([{name:"a_pos3d",type:"Int16",components:3}]);class an extends c.E{constructor(i){super(),this._lastTilesetChange=J.now(),this.sourceCache=i,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=i._source.tileSize*2**this.deltaZoom,i.usedForTerrain=!0,i.tileSize=this.tileSize}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(i,u){this.sourceCache.update(i,u),this._renderableTilesKeys=[];const _={};for(const b of $e(i,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:u,calculateTileZoom:this.sourceCache._source.calculateTileZoom}))_[b.key]=!0,this._renderableTilesKeys.push(b.key),this._tiles[b.key]||(b.terrainRttPosMatrix32f=new Float64Array(16),c.bY(b.terrainRttPosMatrix32f,0,c.$,c.$,0,0,1),this._tiles[b.key]=new gs(b,this.tileSize),this._lastTilesetChange=J.now());for(const b in this._tiles)_[b]||delete this._tiles[b]}freeRtt(i){for(const u in this._tiles){const _=this._tiles[u];(!i||_.tileID.equals(i)||_.tileID.isChildOf(i)||i.isChildOf(_.tileID))&&(_.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map((i=>this.getTileByID(i)))}getTileByID(i){return this._tiles[i]}getTerrainCoords(i,u){return u?this._getTerrainCoordsForTileRanges(i,u):this._getTerrainCoordsForRegularTile(i)}_getTerrainCoordsForRegularTile(i){const u={};for(const _ of this._renderableTilesKeys){const b=this._tiles[_].tileID,S=i.clone(),I=c.ba();if(b.canonical.equals(i.canonical))c.bY(I,0,c.$,c.$,0,0,1);else if(b.canonical.isChildOf(i.canonical)){const O=b.canonical.z-i.canonical.z,N=b.canonical.x-(b.canonical.x>>O<<O),j=b.canonical.y-(b.canonical.y>>O<<O),G=c.$>>O;c.bY(I,0,G,G,0,0,1),c.M(I,I,[-N*G,-j*G,0])}else{if(!i.canonical.isChildOf(b.canonical))continue;{const O=i.canonical.z-b.canonical.z,N=i.canonical.x-(i.canonical.x>>O<<O),j=i.canonical.y-(i.canonical.y>>O<<O),G=c.$>>O;c.bY(I,0,c.$,c.$,0,0,1),c.M(I,I,[N*G,j*G,0]),c.N(I,I,[1/2**O,1/2**O,0])}}S.terrainRttPosMatrix32f=new Float32Array(I),u[_]=S}return u}_getTerrainCoordsForTileRanges(i,u){const _={};for(const b of this._renderableTilesKeys){const S=this._tiles[b].tileID;if(!this._isWithinTileRanges(S,u))continue;const I=i.clone(),O=c.ba();if(S.canonical.z===i.canonical.z){const N=i.canonical.x-S.canonical.x,j=i.canonical.y-S.canonical.y;c.bY(O,0,c.$,c.$,0,0,1),c.M(O,O,[N*c.$,j*c.$,0])}else if(S.canonical.z>i.canonical.z){const N=S.canonical.z-i.canonical.z,j=S.canonical.x-(S.canonical.x>>N<<N),G=S.canonical.y-(S.canonical.y>>N<<N),K=i.canonical.x-(S.canonical.x>>N),Z=i.canonical.y-(S.canonical.y>>N),ee=c.$>>N;c.bY(O,0,ee,ee,0,0,1),c.M(O,O,[-j*ee+K*c.$,-G*ee+Z*c.$,0])}else{const N=i.canonical.z-S.canonical.z,j=i.canonical.x-(i.canonical.x>>N<<N),G=i.canonical.y-(i.canonical.y>>N<<N),K=(i.canonical.x>>N)-S.canonical.x,Z=(i.canonical.y>>N)-S.canonical.y,ee=c.$<<N;c.bY(O,0,ee,ee,0,0,1),c.M(O,O,[j*c.$+K*ee,G*c.$+Z*ee,0])}I.terrainRttPosMatrix32f=new Float32Array(O),_[b]=I}return _}getSourceTile(i,u){const _=this.sourceCache._source;let b=i.overscaledZ-this.deltaZoom;if(b>_.maxzoom&&(b=_.maxzoom),b<_.minzoom)return null;this._sourceTileCache[i.key]||(this._sourceTileCache[i.key]=i.scaledTo(b).key);let S=this.sourceCache.getTileByID(this._sourceTileCache[i.key]);if((!S||!S.dem)&&u)for(;b>=_.minzoom&&(!S||!S.dem);)S=this.sourceCache.getTileByID(i.scaledTo(b--).key);return S}anyTilesAfterTime(i=Date.now()){return this._lastTilesetChange>=i}_isWithinTileRanges(i,u){return u[i.canonical.z]&&i.canonical.x>=u[i.canonical.z].minTileX&&i.canonical.x<=u[i.canonical.z].maxTileX&&i.canonical.y>=u[i.canonical.z].minTileY&&i.canonical.y<=u[i.canonical.z].maxTileY}}class Tn{constructor(i,u,_){this._meshCache={},this.painter=i,this.sourceCache=new an(u),this.options=_,this.exaggeration=typeof _.exaggeration=="number"?_.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(i,u,_,b=c.$){var S;if(!(u>=0&&u<b&&_>=0&&_<b))return 0;const I=this.getTerrainData(i),O=(S=I.tile)===null||S===void 0?void 0:S.dem;if(!O)return 0;const N=c.cs([],[u/b*c.$,_/b*c.$],I.u_terrain_matrix),j=[N[0]*O.dim,N[1]*O.dim],G=Math.floor(j[0]),K=Math.floor(j[1]),Z=j[0]-G,ee=j[1]-K;return O.get(G,K)*(1-Z)*(1-ee)+O.get(G+1,K)*Z*(1-ee)+O.get(G,K+1)*(1-Z)*ee+O.get(G+1,K+1)*Z*ee}getElevationForLngLatZoom(i,u){if(!c.ct(u,i.wrap()))return 0;const{tileID:_,mercatorX:b,mercatorY:S}=this._getOverscaledTileIDFromLngLatZoom(i,u);return this.getElevation(_,b%c.$,S%c.$,c.$)}getElevation(i,u,_,b=c.$){return this.getDEMElevation(i,u,_,b)*this.exaggeration}getTerrainData(i){if(!this._emptyDemTexture){const b=this.painter.context,S=new c.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new c.T(b,S,b.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new c.T(b,new c.R({width:1,height:1}),b.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(b.gl.NEAREST,b.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=c.ag([])}const u=this.sourceCache.getSourceTile(i,!0);if(u&&u.dem&&(!u.demTexture||u.needsTerrainPrepare)){const b=this.painter.context;u.demTexture=this.painter.getTileTexture(u.dem.stride),u.demTexture?u.demTexture.update(u.dem.getPixels(),{premultiply:!1}):u.demTexture=new c.T(b,u.dem.getPixels(),b.gl.RGBA,{premultiply:!1}),u.demTexture.bind(b.gl.NEAREST,b.gl.CLAMP_TO_EDGE),u.needsTerrainPrepare=!1}const _=u&&u+u.tileID.key+i.key;if(_&&!this._demMatrixCache[_]){const b=this.sourceCache.sourceCache._source.maxzoom;let S=i.canonical.z-u.tileID.canonical.z;i.overscaledZ>i.canonical.z&&(i.canonical.z>=b?S=i.canonical.z-b:c.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const I=i.canonical.x-(i.canonical.x>>S<<S),O=i.canonical.y-(i.canonical.y>>S<<S),N=c.cu(new Float64Array(16),[1/(c.$<<S),1/(c.$<<S),0]);c.M(N,N,[I*c.$,O*c.$,0]),this._demMatrixCache[i.key]={matrix:N,coord:i}}return{u_depth:2,u_terrain:3,u_terrain_dim:u&&u.dem&&u.dem.dim||1,u_terrain_matrix:_?this._demMatrixCache[i.key].matrix:this._emptyDemMatrix,u_terrain_unpack:u&&u.dem&&u.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(u&&u.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:u}}getFramebuffer(i){const u=this.painter,_=u.width/devicePixelRatio,b=u.height/devicePixelRatio;return!this._fbo||this._fbo.width===_&&this._fbo.height===b||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new c.T(u.context,{width:_,height:b,data:null},u.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(u.context.gl.NEAREST,u.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new c.T(u.context,{width:_,height:b,data:null},u.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(u.context.gl.NEAREST,u.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=u.context.createFramebuffer(_,b,!0,!1),this._fbo.depthAttachment.set(u.context.createRenderbuffer(u.context.gl.DEPTH_COMPONENT16,_,b))),this._fbo.colorAttachment.set(i==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const i=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const u=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let S=0,I=0;S<this._coordsTextureSize;S++)for(let O=0;O<this._coordsTextureSize;O++,I+=4)u[I+0]=255&O,u[I+1]=255&S,u[I+2]=O>>8<<4|S>>8,u[I+3]=0;const _=new c.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(u.buffer)),b=new c.T(i,_,i.gl.RGBA,{premultiply:!1});return b.bind(i.gl.NEAREST,i.gl.CLAMP_TO_EDGE),this._coordsTexture=b,b}pointCoordinate(i){this.painter.maybeDrawDepthAndCoords(!0);const u=new Uint8Array(4),_=this.painter.context,b=_.gl,S=Math.round(i.x*this.painter.pixelRatio/devicePixelRatio),I=Math.round(i.y*this.painter.pixelRatio/devicePixelRatio),O=Math.round(this.painter.height/devicePixelRatio);_.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),b.readPixels(S,O-I-1,1,1,b.RGBA,b.UNSIGNED_BYTE,u),_.bindFramebuffer.set(null);const N=u[0]+(u[2]>>4<<8),j=u[1]+((15&u[2])<<8),G=this.coordsIndex[255-u[3]],K=G&&this.sourceCache.getTileByID(G);if(!K)return null;const Z=this._coordsTextureSize,ee=(1<<K.tileID.canonical.z)*Z;return new c.a1((K.tileID.canonical.x*Z+N)/ee+K.tileID.wrap,(K.tileID.canonical.y*Z+j)/ee,this.getElevation(K.tileID,N,j,Z))}depthAtPoint(i){const u=new Uint8Array(4),_=this.painter.context,b=_.gl;return _.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),b.readPixels(i.x,this.painter.height/devicePixelRatio-i.y-1,1,1,b.RGBA,b.UNSIGNED_BYTE,u),_.bindFramebuffer.set(null),(u[0]/16777216+u[1]/65536+u[2]/256+u[3])/256}getTerrainMesh(i){var u;const _=((u=this.painter.style.projection)===null||u===void 0?void 0:u.transitionState)>0,b=_&&i.canonical.y===0,S=_&&i.canonical.y===(1<<i.canonical.z)-1,I=`m_${b?"n":""}_${S?"s":""}`;if(this._meshCache[I])return this._meshCache[I];const O=this.painter.context,N=new c.cv,j=new c.aN,G=this.meshSize,K=c.$/G,Z=G*G;for(let Ie=0;Ie<=G;Ie++)for(let Ye=0;Ye<=G;Ye++)N.emplaceBack(Ye*K,Ie*K,0);for(let Ie=0;Ie<Z;Ie+=G+1)for(let Ye=0;Ye<G;Ye++)j.emplaceBack(Ye+Ie,G+Ye+Ie+1,G+Ye+Ie+2),j.emplaceBack(Ye+Ie,G+Ye+Ie+2,Ye+Ie+1);const ee=N.length,ae=ee+(G+1),ge=(G+1)*G,me=b?c.bh:0,ve=b?0:1,we=S?c.bi:c.$,Pe=S?0:1;for(let Ie=0;Ie<=G;Ie++)N.emplaceBack(Ie*K,me,ve);for(let Ie=0;Ie<=G;Ie++)N.emplaceBack(Ie*K,we,Pe);for(let Ie=0;Ie<G;Ie++)j.emplaceBack(ge+Ie,ae+Ie,ae+Ie+1),j.emplaceBack(ge+Ie,ae+Ie+1,ge+Ie+1),j.emplaceBack(0+Ie,ee+Ie+1,ee+Ie),j.emplaceBack(0+Ie,0+Ie+1,ee+Ie+1);const Ce=N.length,ze=Ce+2*(G+1);for(const Ie of[0,1])for(let Ye=0;Ye<=G;Ye++)for(const ct of[0,1])N.emplaceBack(Ie*c.$,Ye*K,ct);for(let Ie=0;Ie<2*G;Ie+=2)j.emplaceBack(Ce+Ie,Ce+Ie+1,Ce+Ie+3),j.emplaceBack(Ce+Ie,Ce+Ie+3,Ce+Ie+2),j.emplaceBack(ze+Ie,ze+Ie+3,ze+Ie+1),j.emplaceBack(ze+Ie,ze+Ie+2,ze+Ie+3);const Ve=new es(O.createVertexBuffer(N,gc.members),O.createIndexBuffer(j),c.aM.simpleSegment(0,0,N.length,j.length));return this._meshCache[I]=Ve,Ve}getMeshFrameDelta(i){return 2*Math.PI*c.bu/Math.pow(2,Math.max(i,0))/5}getMinTileElevationForLngLatZoom(i,u){var _;const{tileID:b}=this._getOverscaledTileIDFromLngLatZoom(i,u);return(_=this.getMinMaxElevation(b).minElevation)!==null&&_!==void 0?_:0}getMinMaxElevation(i){const u=this.getTerrainData(i).tile,_={minElevation:null,maxElevation:null};return u&&u.dem&&(_.minElevation=u.dem.min*this.exaggeration,_.maxElevation=u.dem.max*this.exaggeration),_}_getOverscaledTileIDFromLngLatZoom(i,u){const _=c.a1.fromLngLat(i.wrap()),b=(1<<u)*c.$,S=_.x*b,I=_.y*b,O=Math.floor(S/c.$),N=Math.floor(I/c.$);return{tileID:new c.Z(u,0,u,O,N),mercatorX:S,mercatorY:I}}}class pd{constructor(i,u,_){this._context=i,this._size=u,this._tileSize=_,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const i of this._objects)i.texture.destroy(),i.fbo.destroy()}_createObject(i){const u=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),_=new c.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return _.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),u.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),u.colorAttachment.set(_.texture),{id:i,fbo:u,texture:_,stamp:-1,inUse:!1}}getObjectForId(i){return this._objects[i]}useObject(i){i.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter((u=>i.id!==u)),this._recentlyUsed.push(i.id)}stampObject(i){i.stamp=++this._stamp}getOrCreateFreeObject(){for(const u of this._recentlyUsed)if(!this._objects[u].inUse)return this._objects[u];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const i=this._createObject(this._objects.length);return this._objects.push(i),i}freeObject(i){i.inUse=!1}freeAllObjects(){for(const i of this._objects)this.freeObject(i)}isFull(){return!(this._objects.length<this._size)&&this._objects.some((i=>!i.inUse))===!1}}const jo={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class Kc{constructor(i,u){this.painter=i,this.terrain=u,this.pool=new pd(i.context,30,u.sourceCache.tileSize*u.qualityFactor)}destruct(){this.pool.destruct()}getTexture(i){return this.pool.getObjectForId(i.rtt[this._stacks.length-1].id).texture}prepareForRender(i,u){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=i._order.filter((_=>!i._layers[_].isHidden(u))),this._coordsAscending={};for(const _ in i.sourceCaches){this._coordsAscending[_]={};const b=i.sourceCaches[_].getVisibleCoordinates(),S=i.sourceCaches[_].getSource(),I=S instanceof Vi?S.terrainTileRanges:null;for(const O of b){const N=this.terrain.sourceCache.getTerrainCoords(O,I);for(const j in N)this._coordsAscending[_][j]||(this._coordsAscending[_][j]=[]),this._coordsAscending[_][j].push(N[j])}}this._coordsAscendingStr={};for(const _ of i._order){const b=i._layers[_],S=b.source;if(jo[b.type]&&!this._coordsAscendingStr[S]){this._coordsAscendingStr[S]={};for(const I in this._coordsAscending[S])this._coordsAscendingStr[S][I]=this._coordsAscending[S][I].map((O=>O.key)).sort().join()}}for(const _ of this._renderableTiles)for(const b in this._coordsAscendingStr){const S=this._coordsAscendingStr[b][_.tileID.key];S&&S!==_.rttCoords[b]&&(_.rtt=[])}}renderLayer(i,u){if(i.isHidden(this.painter.transform.zoom))return!1;const _=Object.assign(Object.assign({},u),{isRenderingToTexture:!0}),b=i.type,S=this.painter,I=this._renderableLayerIds[this._renderableLayerIds.length-1]===i.id;if(jo[b]&&(this._prevType&&jo[this._prevType]||this._stacks.push([]),this._prevType=b,this._stacks[this._stacks.length-1].push(i.id),!I))return!0;if(jo[this._prevType]||jo[b]&&I){this._prevType=b;const O=this._stacks.length-1,N=this._stacks[O]||[];for(const j of this._renderableTiles){if(this.pool.isFull()&&(Bo(this.painter,this.terrain,this._rttTiles,_),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(j),j.rtt[O]){const K=this.pool.getObjectForId(j.rtt[O].id);if(K.stamp===j.rtt[O].stamp){this.pool.useObject(K);continue}}const G=this.pool.getOrCreateFreeObject();this.pool.useObject(G),this.pool.stampObject(G),j.rtt[O]={id:G.id,stamp:G.stamp},S.context.bindFramebuffer.set(G.fbo.framebuffer),S.context.clear({color:c.bf.transparent,stencil:0}),S.currentStencilSource=void 0;for(let K=0;K<N.length;K++){const Z=S.style._layers[N[K]],ee=Z.source?this._coordsAscending[Z.source][j.tileID.key]:[j.tileID];S.context.viewport.set([0,0,G.fbo.width,G.fbo.height]),S._renderTileClippingMasks(Z,ee,!0),S.renderLayer(S,S.style.sourceCaches[Z.source],Z,ee,_),Z.source&&(j.rttCoords[Z.source]=this._coordsAscendingStr[Z.source][j.tileID.key])}}return Bo(this.painter,this.terrain,this._rttTiles,_),this._rttTiles=[],this.pool.freeAllObjects(),jo[b]}return!1}}const Cs={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},af=C,po={hash:!1,interactive:!0,bearingSnap:7,attributionControl:ru,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:c.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0},$o={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class Is{constructor(i,u,_=!1){this.mousedown=S=>{this.startMove(S,Y.mousePos(this.element,S)),Y.addEventListener(window,"mousemove",this.mousemove),Y.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=S=>{this.move(S,Y.mousePos(this.element,S))},this.mouseup=S=>{this._rotatePitchHandler.dragEnd(S),this.offTemp()},this.touchstart=S=>{S.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Y.touchPos(this.element,S.targetTouches)[0],this.startMove(S,this._startPos),Y.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),Y.addEventListener(window,"touchend",this.touchend))},this.touchmove=S=>{S.targetTouches.length!==1?this.reset():(this._lastPos=Y.touchPos(this.element,S.targetTouches)[0],this.move(S,this._lastPos))},this.touchend=S=>{S.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHandler.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=u;const b=new hm;this._rotatePitchHandler=new eu({clickTolerance:3,move:(S,I)=>{const O=u.getBoundingClientRect(),N=new c.P((O.bottom-O.top)/2,(O.right-O.left)/2);return{bearingDelta:c.cn(new c.P(S.x,I.y),I,N),pitchDelta:_?-.5*(I.y-S.y):void 0}},moveStateManager:b,enable:!0,assignEvents:()=>{}}),this.map=i,Y.addEventListener(u,"mousedown",this.mousedown),Y.addEventListener(u,"touchstart",this.touchstart,{passive:!1}),Y.addEventListener(u,"touchcancel",this.reset)}startMove(i,u){this._rotatePitchHandler.dragStart(i,u),Y.disableDrag()}move(i,u){const _=this.map,{bearingDelta:b,pitchDelta:S}=this._rotatePitchHandler.dragMove(i,u)||{};b&&_.setBearing(_.getBearing()+b),S&&_.setPitch(_.getPitch()+S)}off(){const i=this.element;Y.removeEventListener(i,"mousedown",this.mousedown),Y.removeEventListener(i,"touchstart",this.touchstart,{passive:!1}),Y.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),Y.removeEventListener(window,"touchend",this.touchend),Y.removeEventListener(i,"touchcancel",this.reset),this.offTemp()}offTemp(){Y.enableDrag(),Y.removeEventListener(window,"mousemove",this.mousemove),Y.removeEventListener(window,"mouseup",this.mouseup),Y.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),Y.removeEventListener(window,"touchend",this.touchend)}}let gi;function Br(T,i,u,_=!1){if(_||!u.getCoveringTilesDetailsProvider().allowWorldCopies())return T==null?void 0:T.wrap();const b=new c.S(T.lng,T.lat);if(T=new c.S(T.lng,T.lat),i){const S=new c.S(T.lng-360,T.lat),I=new c.S(T.lng+360,T.lat),O=u.locationToScreenPoint(T).distSqr(i);u.locationToScreenPoint(S).distSqr(i)<O?T=S:u.locationToScreenPoint(I).distSqr(i)<O&&(T=I)}for(;Math.abs(T.lng-u.center.lng)>180;){const S=u.locationToScreenPoint(T);if(S.x>=0&&S.y>=0&&S.x<=u.width&&S.y<=u.height)break;T.lng>u.center.lng?T.lng-=360:T.lng+=360}return T.lng!==b.lng&&u.isPointOnMapSurface(u.locationToScreenPoint(T))?T:b}const md={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function qo(T,i,u){const _=T.classList;for(const b in md)_.remove(`maplibregl-${u}-anchor-${b}`);_.add(`maplibregl-${u}-anchor-${i}`)}class Ka extends c.E{constructor(i){if(super(),this._onKeyPress=u=>{const _=u.code,b=u.charCode||u.keyCode;_!=="Space"&&_!=="Enter"&&b!==32&&b!==13||this.togglePopup()},this._onMapClick=u=>{const _=u.originalEvent.target,b=this._element;this._popup&&(_===b||b.contains(_))&&this.togglePopup()},this._update=u=>{if(!this._map)return;const _=this._map.loaded()&&!this._map.isMoving();((u==null?void 0:u.type)==="terrain"||(u==null?void 0:u.type)==="render"&&!_)&&this._map.once("render",this._update),this._lngLat=Br(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let b="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?b=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(b=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let S="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?S="rotateX(0deg)":this._pitchAlignment==="map"&&(S=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||u&&u.type!=="moveend"||(this._pos=this._pos.round()),Y.setTransform(this._element,`${md[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${S} ${b}`),J.frameAsync(new AbortController).then((()=>{this._updateOpacity(u&&u.type==="moveend")})).catch((()=>{}))},this._onMove=u=>{if(!this._isDragging){const _=this._clickTolerance||this._map._clickTolerance;this._isDragging=u.point.dist(this._pointerdownPos)>=_}this._isDragging&&(this._pos=u.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new c.l("dragstart"))),this.fire(new c.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new c.l("dragend")),this._state="inactive"},this._addDragHandler=u=>{this._element.contains(u.originalEvent.target)&&(u.preventDefault(),this._positionDelta=u.point.sub(this._pos).add(this._offset),this._pointerdownPos=u.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=i&&i.anchor||"center",this._color=i&&i.color||"#3FB1CE",this._scale=i&&i.scale||1,this._draggable=i&&i.draggable||!1,this._clickTolerance=i&&i.clickTolerance||0,this._subpixelPositioning=i&&i.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=i&&i.rotation||0,this._rotationAlignment=i&&i.rotationAlignment||"auto",this._pitchAlignment=i&&i.pitchAlignment&&i.pitchAlignment!=="auto"?i.pitchAlignment:this._rotationAlignment,this.setOpacity(i==null?void 0:i.opacity,i==null?void 0:i.opacityWhenCovered),i&&i.element)this._element=i.element,this._offset=c.P.convert(i&&i.offset||[0,0]);else{this._defaultMarker=!0,this._element=Y.create("div");const u=Y.createNS("http://www.w3.org/2000/svg","svg"),_=41,b=27;u.setAttributeNS(null,"display","block"),u.setAttributeNS(null,"height",`${_}px`),u.setAttributeNS(null,"width",`${b}px`),u.setAttributeNS(null,"viewBox",`0 0 ${b} ${_}`);const S=Y.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"stroke","none"),S.setAttributeNS(null,"stroke-width","1"),S.setAttributeNS(null,"fill","none"),S.setAttributeNS(null,"fill-rule","evenodd");const I=Y.createNS("http://www.w3.org/2000/svg","g");I.setAttributeNS(null,"fill-rule","nonzero");const O=Y.createNS("http://www.w3.org/2000/svg","g");O.setAttributeNS(null,"transform","translate(3.0, 29.0)"),O.setAttributeNS(null,"fill","#000000");const N=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const ve of N){const we=Y.createNS("http://www.w3.org/2000/svg","ellipse");we.setAttributeNS(null,"opacity","0.04"),we.setAttributeNS(null,"cx","10.5"),we.setAttributeNS(null,"cy","5.80029008"),we.setAttributeNS(null,"rx",ve.rx),we.setAttributeNS(null,"ry",ve.ry),O.appendChild(we)}const j=Y.createNS("http://www.w3.org/2000/svg","g");j.setAttributeNS(null,"fill",this._color);const G=Y.createNS("http://www.w3.org/2000/svg","path");G.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),j.appendChild(G);const K=Y.createNS("http://www.w3.org/2000/svg","g");K.setAttributeNS(null,"opacity","0.25"),K.setAttributeNS(null,"fill","#000000");const Z=Y.createNS("http://www.w3.org/2000/svg","path");Z.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),K.appendChild(Z);const ee=Y.createNS("http://www.w3.org/2000/svg","g");ee.setAttributeNS(null,"transform","translate(6.0, 7.0)"),ee.setAttributeNS(null,"fill","#FFFFFF");const ae=Y.createNS("http://www.w3.org/2000/svg","g");ae.setAttributeNS(null,"transform","translate(8.0, 8.0)");const ge=Y.createNS("http://www.w3.org/2000/svg","circle");ge.setAttributeNS(null,"fill","#000000"),ge.setAttributeNS(null,"opacity","0.25"),ge.setAttributeNS(null,"cx","5.5"),ge.setAttributeNS(null,"cy","5.5"),ge.setAttributeNS(null,"r","5.4999962");const me=Y.createNS("http://www.w3.org/2000/svg","circle");me.setAttributeNS(null,"fill","#FFFFFF"),me.setAttributeNS(null,"cx","5.5"),me.setAttributeNS(null,"cy","5.5"),me.setAttributeNS(null,"r","5.4999962"),ae.appendChild(ge),ae.appendChild(me),I.appendChild(O),I.appendChild(j),I.appendChild(K),I.appendChild(ee),I.appendChild(ae),u.appendChild(I),u.setAttributeNS(null,"height",_*this._scale+"px"),u.setAttributeNS(null,"width",b*this._scale+"px"),this._element.appendChild(u),this._offset=c.P.convert(i&&i.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",(u=>{u.preventDefault()})),this._element.addEventListener("mousedown",(u=>{u.preventDefault()})),qo(this._element,this._anchor,"marker"),i&&i.className)for(const u of i.className.split(" "))this._element.classList.add(u);this._popup=null}addTo(i){return this.remove(),this._map=i,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",i._getUIString("Marker.Title")),i.getCanvasContainer().appendChild(this._element),i.on("move",this._update),i.on("moveend",this._update),i.on("terrain",this._update),i.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),Y.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(i){return this._lngLat=c.S.convert(i),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(i){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),i){if(!("offset"in i.options)){const b=Math.abs(13.5)/Math.SQRT2;i.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[b,-1*(38.1-13.5+b)],"bottom-right":[-b,-1*(38.1-13.5+b)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=i,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(i){return this._subpixelPositioning=i,this}getPopup(){return this._popup}togglePopup(){const i=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:i?(i.isOpen()?i.remove():(i.setLngLat(this._lngLat),i.addTo(this._map)),this):this}_updateOpacity(i=!1){var u,_;const b=(u=this._map)===null||u===void 0?void 0:u.terrain,S=this._map.transform.isLocationOccluded(this._lngLat);if(!b||S){const ee=S?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==ee&&(this._element.style.opacity=ee))}if(i)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout((()=>{this._opacityTimeout=null}),100)}const I=this._map,O=I.terrain.depthAtPoint(this._pos),N=I.terrain.getElevationForLngLatZoom(this._lngLat,I.transform.tileZoom);if(I.transform.lngLatToCameraDepth(this._lngLat,N)-O<.006)return void(this._element.style.opacity=this._opacity);const j=-this._offset.y/I.transform.pixelsPerMeter,G=Math.sin(I.getPitch()*Math.PI/180)*j,K=I.terrain.depthAtPoint(new c.P(this._pos.x,this._pos.y-this._offset.y)),Z=I.transform.lngLatToCameraDepth(this._lngLat,N+G)-K>.006;!((_=this._popup)===null||_===void 0)&&_.isOpen()&&Z&&this._popup.remove(),this._element.style.opacity=Z?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(i){return this._offset=c.P.convert(i),this._update(),this}addClassName(i){this._element.classList.add(i)}removeClassName(i){this._element.classList.remove(i)}toggleClassName(i){return this._element.classList.toggle(i)}setDraggable(i){return this._draggable=!!i,this._map&&(i?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(i){return this._rotation=i||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(i){return this._rotationAlignment=i||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(i){return this._pitchAlignment=i&&i!=="auto"?i:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(i,u){return(this._opacity===void 0||i===void 0&&u===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),i!==void 0&&(this._opacity=i),u!==void 0&&(this._opacityWhenCovered=u),this._map&&this._updateOpacity(!0),this}}const Kr={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Mu=0,to=!1;const Gn={maxWidth:100,unit:"metric"};function ji(T,i,u){const _=u&&u.maxWidth||100,b=T._container.clientHeight/2,S=T._container.clientWidth/2,I=T.unproject([S-_/2,b]),O=T.unproject([S+_/2,b]),N=Math.round(T.project(O).x-T.project(I).x),j=Math.min(_,N,T._container.clientWidth),G=I.distanceTo(O);if(u&&u.unit==="imperial"){const K=3.2808*G;K>5280?Tr(i,j,K/5280,T._getUIString("ScaleControl.Miles")):Tr(i,j,K,T._getUIString("ScaleControl.Feet"))}else u&&u.unit==="nautical"?Tr(i,j,G/1852,T._getUIString("ScaleControl.NauticalMiles")):G>=1e3?Tr(i,j,G/1e3,T._getUIString("ScaleControl.Kilometers")):Tr(i,j,G,T._getUIString("ScaleControl.Meters"))}function Tr(T,i,u,_){const b=(function(S){const I=Math.pow(10,`${Math.floor(S)}`.length-1);let O=S/I;return O=O>=10?10:O>=5?5:O>=3?3:O>=2?2:O>=1?1:(function(N){const j=Math.pow(10,Math.ceil(-Math.log(N)/Math.LN10));return Math.round(N*j)/j})(O),I*O})(u);T.style.width=i*(b/u)+"px",T.innerHTML=`${b}&nbsp;${_}`}const Ch={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},_c=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function au(T){if(T){if(typeof T=="number"){const i=Math.round(Math.abs(T)/Math.SQRT2);return{center:new c.P(0,0),top:new c.P(0,T),"top-left":new c.P(i,i),"top-right":new c.P(-i,i),bottom:new c.P(0,-T),"bottom-left":new c.P(i,-i),"bottom-right":new c.P(-i,-i),left:new c.P(T,0),right:new c.P(-T,0)}}if(T instanceof c.P||Array.isArray(T)){const i=c.P.convert(T);return{center:i,top:i,"top-left":i,"top-right":i,bottom:i,"bottom-left":i,"bottom-right":i,left:i,right:i}}return{center:c.P.convert(T.center||[0,0]),top:c.P.convert(T.top||[0,0]),"top-left":c.P.convert(T["top-left"]||[0,0]),"top-right":c.P.convert(T["top-right"]||[0,0]),bottom:c.P.convert(T.bottom||[0,0]),"bottom-left":c.P.convert(T["bottom-left"]||[0,0]),"bottom-right":c.P.convert(T["bottom-right"]||[0,0]),left:c.P.convert(T.left||[0,0]),right:c.P.convert(T.right||[0,0])}}return au(new c.P(0,0))}const Ih=C;g.AJAXError=c.cz,g.Event=c.l,g.Evented=c.E,g.LngLat=c.S,g.MercatorCoordinate=c.a1,g.Point=c.P,g.addProtocol=c.cA,g.config=c.a,g.removeProtocol=c.cB,g.AttributionControl=Wc,g.BoxZoomHandler=ep,g.CanvasSource=Aa,g.CooperativeGesturesHandler=pc,g.DoubleClickZoomHandler=fc,g.DragPanHandler=Eh,g.DragRotateHandler=Ah,g.EdgeInsets=vs,g.FullscreenControl=class extends c.E{constructor(T={}){super(),this._onFullscreenChange=()=>{var i;let u=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((i=u==null?void 0:u.shadowRoot)===null||i===void 0)&&i.fullscreenElement;)u=u.shadowRoot.fullscreenElement;u===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,T&&T.container&&(T.container instanceof HTMLElement?this._container=T.container:c.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(T){return this._map=T,this._container||(this._container=this._map.getContainer()),this._controlContainer=Y.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){Y.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const T=this._fullscreenButton=Y.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);Y.create("span","maplibregl-ctrl-icon",T).setAttribute("aria-hidden","true"),T.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const T=this._getTitle();this._fullscreenButton.setAttribute("aria-label",T),this._fullscreenButton.title=T}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new c.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new c.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},g.GeoJSONSource=Ea,g.GeolocateControl=class extends c.E{constructor(T){super(),this._onSuccess=i=>{if(this._map){if(this._isOutOfMapMaxBounds(i))return this._setErrorState(),this.fire(new c.l("outofmaxbounds",i)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=i,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(i),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(i),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new c.l("geolocate",i)),this._finish()}},this._updateCamera=i=>{const u=new c.S(i.coords.longitude,i.coords.latitude),_=i.coords.accuracy,b=this._map.getBearing(),S=c.e({bearing:b},this.options.fitBoundsOptions),I=Fi.fromLngLat(u,_);this._map.fitBounds(I,S,{geolocateSource:!0})},this._updateMarker=i=>{if(i){const u=new c.S(i.coords.longitude,i.coords.latitude);this._accuracyCircleMarker.setLngLat(u).addTo(this._map),this._userLocationDotMarker.setLngLat(u).addTo(this._map),this._accuracy=i.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=i=>{if(this._map){if(i.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const u=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=u,this._geolocateButton.setAttribute("aria-label",u),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(i.code===3&&to)return;this.options.trackUserLocation&&this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new c.l("error",i)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",(i=>i.preventDefault())),this._geolocateButton=Y.create("button","maplibregl-ctrl-geolocate",this._container),Y.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=i=>{if(this._map){if(i===!1){c.w("Geolocation support is not available so the GeolocateControl will be disabled.");const u=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=u,this._geolocateButton.setAttribute("aria-label",u)}else{const u=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=u,this._geolocateButton.setAttribute("aria-label",u)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Y.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Ka({element:this._dotElement}),this._circleElement=Y.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ka({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",(()=>this.trigger())),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(u=>{const _=(u==null?void 0:u[0])instanceof ResizeObserverEntry;u.geolocateSource||this._watchState!=="ACTIVE_LOCK"||_||this._map.isZooming()||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new c.l("trackuserlocationend")),this.fire(new c.l("userlocationlostfocus")))}))}},this.options=c.e({},Kr,T)}onAdd(T){return this._map=T,this._container=Y.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),(function(){return c._(this,arguments,void 0,(function*(i=!1){if(gi!==void 0&&!i)return gi;if(window.navigator.permissions===void 0)return gi=!!window.navigator.geolocation,gi;try{gi=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{gi=!!window.navigator.geolocation}return gi}))})().then((i=>this._finishSetupUI(i))),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),Y.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Mu=0,to=!1}_isOutOfMapMaxBounds(T){const i=this._map.getMaxBounds(),u=T.coords;return i&&(u.longitude<i.getWest()||u.longitude>i.getEast()||u.latitude<i.getSouth()||u.latitude>i.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const T=this._map.getBounds(),i=T.getSouthEast(),u=T.getNorthEast(),_=i.distanceTo(u),b=Math.ceil(this._accuracy/(_/this._map._container.clientHeight)*2);this._circleElement.style.width=`${b}px`,this._circleElement.style.height=`${b}px`}trigger(){if(!this._setup)return c.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new c.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Mu--,to=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new c.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new c.l("trackuserlocationstart")),this.fire(new c.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let T;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Mu++,Mu>1?(T={maximumAge:6e5,timeout:0},to=!0):(T=this.options.positionOptions,to=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,T)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},g.GlobeControl=class{constructor(){this._toggleProjection=()=>{var T;const i=(T=this._map.getProjection())===null||T===void 0?void 0:T.type;this._map.setProjection(i!=="mercator"&&i?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var T;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((T=this._map.getProjection())===null||T===void 0?void 0:T.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(T){return this._map=T,this._container=Y.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=Y.create("button","maplibregl-ctrl-globe",this._container),Y.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){Y.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},g.Hash=gl,g.ImageSource=Vi,g.KeyboardHandler=hd,g.LngLatBounds=Fi,g.LogoControl=rf,g.Map=class extends Pu{constructor(T){var i,u;c.cw.mark(c.cx.create);const _=Object.assign(Object.assign(Object.assign({},po),T),{canvasContextAttributes:Object.assign(Object.assign({},po.canvasContextAttributes),T.canvasContextAttributes)});if(_.minZoom!=null&&_.maxZoom!=null&&_.minZoom>_.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(_.minPitch!=null&&_.maxPitch!=null&&_.minPitch>_.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(_.minPitch!=null&&_.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(_.maxPitch!=null&&_.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const b=new xn,S=new wr;if(_.minZoom!==void 0&&b.setMinZoom(_.minZoom),_.maxZoom!==void 0&&b.setMaxZoom(_.maxZoom),_.minPitch!==void 0&&b.setMinPitch(_.minPitch),_.maxPitch!==void 0&&b.setMaxPitch(_.maxPitch),_.renderWorldCopies!==void 0&&b.setRenderWorldCopies(_.renderWorldCopies),super(b,S,{bearingSnap:_.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new vl,this._controls=[],this._mapId=c.a7(),this._contextLost=O=>{O.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new c.l("webglcontextlost",{originalEvent:O}))},this._contextRestored=O=>{this._setupPainter(),this.resize(),this._update(),this.fire(new c.l("webglcontextrestored",{originalEvent:O}))},this._onMapScroll=O=>{if(O.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=_.interactive,this._maxTileCacheSize=_.maxTileCacheSize,this._maxTileCacheZoomLevels=_.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},_.canvasContextAttributes),this._trackResize=_.trackResize===!0,this._bearingSnap=_.bearingSnap,this._centerClampedToGround=_.centerClampedToGround,this._refreshExpiredTiles=_.refreshExpiredTiles===!0,this._fadeDuration=_.fadeDuration,this._crossSourceCollisions=_.crossSourceCollisions===!0,this._collectResourceTiming=_.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},Cs),_.locale),this._clickTolerance=_.clickTolerance,this._overridePixelRatio=_.pixelRatio,this._maxCanvasSize=_.maxCanvasSize,this.transformCameraUpdate=_.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=_.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=Ze.addThrottleControl((()=>this.isMoving())),this._requestManager=new je(_.transformRequest),typeof _.container=="string"){if(this._container=document.getElementById(_.container),!this._container)throw new Error(`Container '${_.container}' not found.`)}else{if(!(_.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=_.container}if(_.maxBounds&&this.setMaxBounds(_.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this.on("terrain",(()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)})),this.once("idle",(()=>{this._idleTriggered=!0})),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let O=!1;const N=as((j=>{this._trackResize&&!this._removed&&(this.resize(j),this.redraw())}),50);this._resizeObserver=new ResizeObserver((j=>{O?N(j):O=!0})),this._resizeObserver.observe(this._container)}this.handlers=new fd(this,_),this._hash=_.hash&&new gl(typeof _.hash=="string"&&_.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:_.center,elevation:_.elevation,zoom:_.zoom,bearing:_.bearing,pitch:_.pitch,roll:_.roll}),_.bounds&&(this.resize(),this.fitBounds(_.bounds,c.e({},_.fitBoundsOptions,{duration:0}))));const I=typeof _.style=="string"||((u=(i=_.style)===null||i===void 0?void 0:i.projection)===null||u===void 0?void 0:u.type)!=="globe";this.resize(null,I),this._localIdeographFontFamily=_.localIdeographFontFamily,this._validateStyle=_.validateStyle,_.style&&this.setStyle(_.style,{localIdeographFontFamily:_.localIdeographFontFamily}),_.attributionControl&&this.addControl(new Wc(typeof _.attributionControl=="boolean"?void 0:_.attributionControl)),_.maplibreLogo&&this.addControl(new rf,_.logoPosition),this.on("style.load",(()=>{if(I||this._resizeTransform(),this.transform.unmodified){const O=c.Q(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(O)}})),this.on("data",(O=>{this._update(O.dataType==="style"),this.fire(new c.l(`${O.dataType}data`,O))})),this.on("dataloading",(O=>{this.fire(new c.l(`${O.dataType}dataloading`,O))})),this.on("dataabort",(O=>{this.fire(new c.l("sourcedataabort",O))}))}_getMapId(){return this._mapId}setGlobalStateProperty(T,i){return this.style.setGlobalStateProperty(T,i),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(T,i){if(i===void 0&&(i=T.getDefaultPosition?T.getDefaultPosition():"top-right"),!T||!T.onAdd)return this.fire(new c.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const u=T.onAdd(this);this._controls.push(T);const _=this._controlPositions[i];return i.indexOf("bottom")!==-1?_.insertBefore(u,_.firstChild):_.appendChild(u),this}removeControl(T){if(!T||!T.onRemove)return this.fire(new c.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const i=this._controls.indexOf(T);return i>-1&&this._controls.splice(i,1),T.onRemove(this),this}hasControl(T){return this._controls.indexOf(T)>-1}calculateCameraOptionsFromTo(T,i,u,_){return _==null&&this.terrain&&(_=this.terrain.getElevationForLngLatZoom(u,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(T,i,u,_)}resize(T,i=!0){const[u,_]=this._containerDimensions(),b=this._getClampedPixelRatio(u,_);if(this._resizeCanvas(u,_,b),this.painter.resize(u,_,b),this.painter.overLimit()){const I=this.painter.context.gl;this._maxCanvasSize=[I.drawingBufferWidth,I.drawingBufferHeight];const O=this._getClampedPixelRatio(u,_);this._resizeCanvas(u,_,O),this.painter.resize(u,_,O)}this._resizeTransform(i);const S=!this._moving;return S&&(this.stop(),this.fire(new c.l("movestart",T)).fire(new c.l("move",T))),this.fire(new c.l("resize",T)),S&&this.fire(new c.l("moveend",T)),this}_resizeTransform(T=!0){var i;const[u,_]=this._containerDimensions();this.transform.resize(u,_,T),(i=this._requestedCameraState)===null||i===void 0||i.resize(u,_,T)}_getClampedPixelRatio(T,i){const{0:u,1:_}=this._maxCanvasSize,b=this.getPixelRatio(),S=T*b,I=i*b;return Math.min(S>u?u/S:1,I>_?_/I:1)*b}getPixelRatio(){var T;return(T=this._overridePixelRatio)!==null&&T!==void 0?T:devicePixelRatio}setPixelRatio(T){this._overridePixelRatio=T,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(T){return this.transform.setMaxBounds(Fi.convert(T)),this._update()}setMinZoom(T){if((T=T??-2)>=-2&&T<=this.transform.maxZoom)return this.transform.setMinZoom(T),this._update(),this.getZoom()<T&&this.setZoom(T),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(T){if((T=T??22)>=this.transform.minZoom)return this.transform.setMaxZoom(T),this._update(),this.getZoom()>T&&this.setZoom(T),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(T){if((T=T??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(T>=0&&T<=this.transform.maxPitch)return this.transform.setMinPitch(T),this._update(),this.getPitch()<T&&this.setPitch(T),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(T){if((T=T??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(T>=this.transform.minPitch)return this.transform.setMaxPitch(T),this._update(),this.getPitch()>T&&this.setPitch(T),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(T){return this.transform.setRenderWorldCopies(T),this._update()}project(T){return this.transform.locationToScreenPoint(c.S.convert(T),this.style&&this.terrain)}unproject(T){return this.transform.screenPointToLocation(c.P.convert(T),this.terrain)}isMoving(){var T;return this._moving||((T=this.handlers)===null||T===void 0?void 0:T.isMoving())}isZooming(){var T;return this._zooming||((T=this.handlers)===null||T===void 0?void 0:T.isZooming())}isRotating(){var T;return this._rotating||((T=this.handlers)===null||T===void 0?void 0:T.isRotating())}_createDelegatedListener(T,i,u){if(T==="mouseenter"||T==="mouseover"){let _=!1;return{layers:i,listener:u,delegates:{mousemove:S=>{const I=i.filter((N=>this.getLayer(N))),O=I.length!==0?this.queryRenderedFeatures(S.point,{layers:I}):[];O.length?_||(_=!0,u.call(this,new ka(T,this,S.originalEvent,{features:O}))):_=!1},mouseout:()=>{_=!1}}}}if(T==="mouseleave"||T==="mouseout"){let _=!1;return{layers:i,listener:u,delegates:{mousemove:I=>{const O=i.filter((N=>this.getLayer(N)));(O.length!==0?this.queryRenderedFeatures(I.point,{layers:O}):[]).length?_=!0:_&&(_=!1,u.call(this,new ka(T,this,I.originalEvent)))},mouseout:I=>{_&&(_=!1,u.call(this,new ka(T,this,I.originalEvent)))}}}}{const _=b=>{const S=i.filter((O=>this.getLayer(O))),I=S.length!==0?this.queryRenderedFeatures(b.point,{layers:S}):[];I.length&&(b.features=I,u.call(this,b),delete b.features)};return{layers:i,listener:u,delegates:{[T]:_}}}}_saveDelegatedListener(T,i){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[T]=this._delegatedListeners[T]||[],this._delegatedListeners[T].push(i)}_removeDelegatedListener(T,i,u){if(!this._delegatedListeners||!this._delegatedListeners[T])return;const _=this._delegatedListeners[T];for(let b=0;b<_.length;b++){const S=_[b];if(S.listener===u&&S.layers.length===i.length&&S.layers.every((I=>i.includes(I)))){for(const I in S.delegates)this.off(I,S.delegates[I]);return void _.splice(b,1)}}}on(T,i,u){if(u===void 0)return super.on(T,i);const _=typeof i=="string"?[i]:i,b=this._createDelegatedListener(T,_,u);this._saveDelegatedListener(T,b);for(const S in b.delegates)this.on(S,b.delegates[S]);return{unsubscribe:()=>{this._removeDelegatedListener(T,_,u)}}}once(T,i,u){if(u===void 0)return super.once(T,i);const _=typeof i=="string"?[i]:i,b=this._createDelegatedListener(T,_,u);for(const S in b.delegates){const I=b.delegates[S];b.delegates[S]=(...O)=>{this._removeDelegatedListener(T,_,u),I(...O)}}this._saveDelegatedListener(T,b);for(const S in b.delegates)this.once(S,b.delegates[S]);return this}off(T,i,u){return u===void 0?super.off(T,i):(this._removeDelegatedListener(T,typeof i=="string"?[i]:i,u),this)}queryRenderedFeatures(T,i){if(!this.style)return[];let u;const _=T instanceof c.P||Array.isArray(T),b=_?T:[[0,0],[this.transform.width,this.transform.height]];if(i=i||(_?{}:T)||{},b instanceof c.P||typeof b[0]=="number")u=[c.P.convert(b)];else{const S=c.P.convert(b[0]),I=c.P.convert(b[1]);u=[S,new c.P(I.x,S.y),I,new c.P(S.x,I.y),S]}return this.style.queryRenderedFeatures(u,i,this.transform)}querySourceFeatures(T,i){return this.style.querySourceFeatures(T,i)}setStyle(T,i){return(i=c.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},i)).diff!==!1&&i.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&T?(this._diffStyle(T,i),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._updateStyle(T,i))}setTransformRequest(T){return this._requestManager.setTransformRequest(T),this}_getUIString(T){const i=this._locale[T];if(i==null)throw new Error(`Missing UI string '${T}'`);return i}_updateStyle(T,i){var u,_;if(i.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",(()=>this._updateStyle(T,i)));const b=this.style&&i.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!T)),T?(this.style=new M(this,i||{}),this.style.setEventedParent(this,{style:this.style}),typeof T=="string"?this.style.loadURL(T,i,b):this.style.loadJSON(T,i,b),this):((_=(u=this.style)===null||u===void 0?void 0:u.projection)===null||_===void 0||_.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new M(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(T,i){if(typeof T=="string"){const u=this._requestManager.transformRequest(T,"Style");c.j(u,new AbortController).then((_=>{this._updateDiff(_.data,i)})).catch((_=>{_&&this.fire(new c.k(_))}))}else typeof T=="object"&&this._updateDiff(T,i)}_updateDiff(T,i){try{this.style.setState(T,i)&&this._update(!0)}catch(u){c.w(`Unable to perform style diff: ${u.message||u.error||u}.  Rebuilding the style from scratch.`),this._updateStyle(T,i)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():c.w("There is no style added to the map.")}addSource(T,i){return this._lazyInitEmptyStyle(),this.style.addSource(T,i),this._update(!0)}isSourceLoaded(T){const i=this.style&&this.style.sourceCaches[T];if(i!==void 0)return i.loaded();this.fire(new c.k(new Error(`There is no source with ID '${T}'`)))}setTerrain(T){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),T){const i=this.style.sourceCaches[T.source];if(!i)throw new Error(`cannot load terrain, because there exists no source with ID: ${T.source}`);this.terrain===null&&i.reload();for(const u in this.style._layers){const _=this.style._layers[u];_.type==="hillshade"&&_.source===T.source&&c.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),_.type==="color-relief"&&_.source===T.source&&c.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Tn(this.painter,i,T),this.painter.renderToTexture=new Kc(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=u=>{var _;u.dataType==="style"?this.terrain.sourceCache.freeRtt():u.dataType==="source"&&u.tile&&(u.sourceId!==T.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((_=u.source)===null||_===void 0?void 0:_.type)==="image"?this.terrain.sourceCache.freeRtt():this.terrain.sourceCache.freeRtt(u.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new c.l("terrain",{terrain:T})),this}getTerrain(){var T,i;return(i=(T=this.terrain)===null||T===void 0?void 0:T.options)!==null&&i!==void 0?i:null}areTilesLoaded(){const T=this.style&&this.style.sourceCaches;for(const i in T){const u=T[i]._tiles;for(const _ in u){const b=u[_];if(b.state!=="loaded"&&b.state!=="errored")return!1}}return!0}removeSource(T){return this.style.removeSource(T),this._update(!0)}getSource(T){return this.style.getSource(T)}setSourceTileLodParams(T,i,u){if(u){const _=this.getSource(u);if(!_)throw new Error(`There is no source with ID "${u}", cannot set LOD parameters`);_.calculateTileZoom=Pt(Math.max(1,T),Math.max(1,i))}else for(const _ in this.style.sourceCaches)this.style.sourceCaches[_].getSource().calculateTileZoom=Pt(Math.max(1,T),Math.max(1,i));return this._update(!0),this}refreshTiles(T,i){const u=this.style.sourceCaches[T];if(!u)throw new Error(`There is no source cache with ID "${T}", cannot refresh tile`);i===void 0?u.reload(!0):u.refreshTiles(i.map((_=>new c.a4(_.z,_.x,_.y))))}addImage(T,i,u={}){const{pixelRatio:_=1,sdf:b=!1,stretchX:S,stretchY:I,content:O,textFitWidth:N,textFitHeight:j}=u;if(this._lazyInitEmptyStyle(),!(i instanceof HTMLImageElement||c.b(i))){if(i.width===void 0||i.height===void 0)return this.fire(new c.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:G,height:K,data:Z}=i,ee=i;return this.style.addImage(T,{data:new c.R({width:G,height:K},new Uint8Array(Z)),pixelRatio:_,stretchX:S,stretchY:I,content:O,textFitWidth:N,textFitHeight:j,sdf:b,version:0,userImage:ee}),ee.onAdd&&ee.onAdd(this,T),this}}{const{width:G,height:K,data:Z}=J.getImageData(i);this.style.addImage(T,{data:new c.R({width:G,height:K},Z),pixelRatio:_,stretchX:S,stretchY:I,content:O,textFitWidth:N,textFitHeight:j,sdf:b,version:0})}}updateImage(T,i){const u=this.style.getImage(T);if(!u)return this.fire(new c.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const _=i instanceof HTMLImageElement||c.b(i)?J.getImageData(i):i,{width:b,height:S,data:I}=_;if(b===void 0||S===void 0)return this.fire(new c.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(b!==u.data.width||S!==u.data.height)return this.fire(new c.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const O=!(i instanceof HTMLImageElement||c.b(i));return u.data.replace(I,O),this.style.updateImage(T,u),this}getImage(T){return this.style.getImage(T)}hasImage(T){return T?!!this.style.getImage(T):(this.fire(new c.k(new Error("Missing required image id"))),!1)}removeImage(T){this.style.removeImage(T)}loadImage(T){return Ze.getImage(this._requestManager.transformRequest(T,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(T,i){return this._lazyInitEmptyStyle(),this.style.addLayer(T,i),this._update(!0)}moveLayer(T,i){return this.style.moveLayer(T,i),this._update(!0)}removeLayer(T){return this.style.removeLayer(T),this._update(!0)}getLayer(T){return this.style.getLayer(T)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(T,i,u){return this.style.setLayerZoomRange(T,i,u),this._update(!0)}setFilter(T,i,u={}){return this.style.setFilter(T,i,u),this._update(!0)}getFilter(T){return this.style.getFilter(T)}setPaintProperty(T,i,u,_={}){return this.style.setPaintProperty(T,i,u,_),this._update(!0)}getPaintProperty(T,i){return this.style.getPaintProperty(T,i)}setLayoutProperty(T,i,u,_={}){return this.style.setLayoutProperty(T,i,u,_),this._update(!0)}getLayoutProperty(T,i){return this.style.getLayoutProperty(T,i)}setGlyphs(T,i={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(T,i),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(T,i,u={}){return this._lazyInitEmptyStyle(),this.style.addSprite(T,i,u,(_=>{_||this._update(!0)})),this}removeSprite(T){return this._lazyInitEmptyStyle(),this.style.removeSprite(T),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(T,i={}){return this._lazyInitEmptyStyle(),this.style.setSprite(T,i,(u=>{u||this._update(!0)})),this}setLight(T,i={}){return this._lazyInitEmptyStyle(),this.style.setLight(T,i),this._update(!0)}getLight(){return this.style.getLight()}setSky(T,i={}){return this._lazyInitEmptyStyle(),this.style.setSky(T,i),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(T,i){return this.style.setFeatureState(T,i),this._update()}removeFeatureState(T,i){return this.style.removeFeatureState(T,i),this._update()}getFeatureState(T){return this.style.getFeatureState(T)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let T=0,i=0;return this._container&&(T=this._container.clientWidth||400,i=this._container.clientHeight||300),[T,i]}_setupContainer(){const T=this._container;T.classList.add("maplibregl-map");const i=this._canvasContainer=Y.create("div","maplibregl-canvas-container",T);this._interactive&&i.classList.add("maplibregl-interactive"),this._canvas=Y.create("canvas","maplibregl-canvas",i),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const u=this._containerDimensions(),_=this._getClampedPixelRatio(u[0],u[1]);this._resizeCanvas(u[0],u[1],_);const b=this._controlContainer=Y.create("div","maplibregl-control-container",T),S=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((I=>{S[I]=Y.create("div",`maplibregl-ctrl-${I} `,b)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(T,i,u){this._canvas.width=Math.floor(u*T),this._canvas.height=Math.floor(u*i),this._canvas.style.width=`${T}px`,this._canvas.style.height=`${i}px`}_setupPainter(){const T=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let i=null;this._canvas.addEventListener("webglcontextcreationerror",(_=>{i={requestedAttributes:T},_&&(i.statusMessage=_.statusMessage,i.type=_.type)}),{once:!0});let u=null;if(u=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,T):this._canvas.getContext("webgl2",T)||this._canvas.getContext("webgl",T),!u){const _="Failed to initialize WebGL";throw i?(i.message=_,new Error(JSON.stringify(i))):new Error(_)}this.painter=new Nr(u,this.transform),xe.testSupport(u)}migrateProjection(T,i){super.migrateProjection(T,i),this.painter.transform=T,this.fire(new c.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(T){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||T,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(T){return this._update(),this._renderTaskQueue.add(T)}_cancelRenderFrame(T){this._renderTaskQueue.remove(T)}_render(T){var i,u,_,b,S;const I=this._idleTriggered?this._fadeDuration:0,O=((i=this.style.projection)===null||i===void 0?void 0:i.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(T),this._removed)return;let N=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const K=this.transform.zoom,Z=J.now();this.style.zoomHistory.update(K,Z);const ee=new c.F(K,{now:Z,fadeDuration:I,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition(),globalState:this.style.getGlobalState()}),ae=ee.crossFadingFactor();ae===1&&ae===this._crossFadingFactor||(N=!0,this._crossFadingFactor=ae),this.style.update(ee)}const j=((u=this.style.projection)===null||u===void 0?void 0:u.transitionState)>0!==O;(_=this.style.projection)===null||_===void 0||_.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((b=this.style.projection)===null||b===void 0?void 0:b.transitionState,(S=this.style.projection)===null||S===void 0?void 0:S.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||j)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,I,this._crossSourceCollisions,j),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:I,showPadding:this.showPadding}),this.fire(new c.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,c.cw.mark(c.cx.load),this.fire(new c.l("load"))),this.style&&(this.style.hasTransitions()||N)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const G=this._sourcesDirty||this._styleDirty||this._placementDirty;return G||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new c.l("idle")),!this._loaded||this._fullyLoaded||G||(this._fullyLoaded=!0,c.cw.mark(c.cx.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var T;this._hash&&this._hash.remove();for(const u of this._controls)u.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),Ze.removeThrottleControl(this._imageQueueHandle),(T=this._resizeObserver)===null||T===void 0||T.disconnect();const i=this.painter.context.gl.getExtension("WEBGL_lose_context");i!=null&&i.loseContext&&i.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),Y.remove(this._canvasContainer),Y.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),c.cw.clearMetrics(),this._removed=!0,this.fire(new c.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,J.frame(this._frameRequest,(T=>{c.cw.frame(T),this._frameRequest=null;try{this._render(T)}catch(i){if(!c.cy(i)&&!(function(u){return u.message===zo})(i))throw i}}),(()=>{})))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(T){this._showTileBoundaries!==T&&(this._showTileBoundaries=T,this._update())}get showPadding(){return!!this._showPadding}set showPadding(T){this._showPadding!==T&&(this._showPadding=T,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(T){this._showCollisionBoxes!==T&&(this._showCollisionBoxes=T,T?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(T){this._showOverdrawInspector!==T&&(this._showOverdrawInspector=T,this._update())}get repaint(){return!!this._repaint}set repaint(T){this._repaint!==T&&(this._repaint=T,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(T){this._vertices=T,this._update()}get version(){return af}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(T){return this._lazyInitEmptyStyle(),this.style.setProjection(T),this._update(!0)}},g.MapMouseEvent=ka,g.MapTouchEvent=Cu,g.MapWheelEvent=Iu,g.Marker=Ka,g.NavigationControl=class{constructor(T){this._updateZoomButtons=()=>{const i=this._map.getZoom(),u=i===this._map.getMaxZoom(),_=i===this._map.getMinZoom();this._zoomInButton.disabled=u,this._zoomOutButton.disabled=_,this._zoomInButton.setAttribute("aria-disabled",u.toString()),this._zoomOutButton.setAttribute("aria-disabled",_.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(i,u)=>{const _=this._map._getUIString(`NavigationControl.${u}`);i.title=_,i.setAttribute("aria-label",_)},this.options=c.e({},$o,T),this._container=Y.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",(i=>i.preventDefault())),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",(i=>this._map.zoomIn({},{originalEvent:i}))),Y.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",(i=>this._map.zoomOut({},{originalEvent:i}))),Y.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",(i=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:i}):this._map.resetNorth({},{originalEvent:i})})),this._compassIcon=Y.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(T){return this._map=T,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Is(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){Y.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(T,i){const u=Y.create("button",T,this._container);return u.type="button",u.addEventListener("click",i),u}},g.Popup=class extends c.E{constructor(T){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&Y.remove(this._content),this._container&&(Y.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new c.l("close"))),this),this._onMouseUp=i=>{this._update(i.point)},this._onMouseMove=i=>{this._update(i.point)},this._onDrag=i=>{this._update(i.point)},this._update=i=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=Y.create("div","maplibregl-popup",this._map.getContainer()),this._tip=Y.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const I of this.options.className.split(" "))this._container.classList.add(I);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=Br(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!i)return;const u=this._flatPos=this._pos=this._trackPointer&&i?i:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&i?i:this._map.transform.locationToScreenPoint(this._lngLat));let _=this.options.anchor;const b=au(this.options.offset);if(!_){const I=this._container.offsetWidth,O=this._container.offsetHeight;let N;N=u.y+b.bottom.y<O?["top"]:u.y>this._map.transform.height-O?["bottom"]:[],u.x<I/2?N.push("left"):u.x>this._map.transform.width-I/2&&N.push("right"),_=N.length===0?"bottom":N.join("-")}let S=u.add(b[_]);this.options.subpixelPositioning||(S=S.round()),Y.setTransform(this._container,`${md[_]} translate(${S.x}px,${S.y}px)`),qo(this._container,_,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=c.e(Object.create(Ch),T)}addTo(T){return this._map&&this.remove(),this._map=T,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new c.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(T){return this._lngLat=c.S.convert(T),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(T){return this.setDOMContent(document.createTextNode(T))}setHTML(T){const i=document.createDocumentFragment(),u=document.createElement("body");let _;for(u.innerHTML=T;_=u.firstChild,_;)i.appendChild(_);return this.setDOMContent(i)}getMaxWidth(){var T;return(T=this._container)===null||T===void 0?void 0:T.style.maxWidth}setMaxWidth(T){return this.options.maxWidth=T,this._update(),this}setDOMContent(T){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=Y.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(T),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(T){return this._container&&this._container.classList.add(T),this}removeClassName(T){return this._container&&this._container.classList.remove(T),this}setOffset(T){return this.options.offset=T,this._update(),this}toggleClassName(T){if(this._container)return this._container.classList.toggle(T)}setSubpixelPositioning(T){this.options.subpixelPositioning=T}_createCloseButton(){this.options.closeButton&&(this._closeButton=Y.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const T=this._container.querySelector(_c);T&&T.focus()}},g.RasterDEMTileSource=Fs,g.RasterTileSource=Sa,g.ScaleControl=class{constructor(T){this._onMove=()=>{ji(this._map,this._container,this.options)},this.setUnit=i=>{this.options.unit=i,ji(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Gn),T)}getDefaultPosition(){return"bottom-left"}onAdd(T){return this._map=T,this._container=Y.create("div","maplibregl-ctrl maplibregl-ctrl-scale",T.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){Y.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},g.ScrollZoomHandler=tp,g.Style=M,g.TerrainControl=class{constructor(T){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=T}onAdd(T){return this._map=T,this._container=Y.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=Y.create("button","maplibregl-ctrl-terrain",this._container),Y.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){Y.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},g.TwoFingersTouchPitchHandler=Gc,g.TwoFingersTouchRotateHandler=dc,g.TwoFingersTouchZoomHandler=cd,g.TwoFingersTouchZoomRotateHandler=np,g.VectorTileSource=Ua,g.VideoSource=pr,g.addSourceType=(T,i)=>c._(void 0,void 0,void 0,(function*(){if(oo(T))throw new Error(`A source type called "${T}" already exists.`);((u,_)=>{Eo[u]=_})(T,i)})),g.clearPrewarmedResources=function(){const T=Ot;T&&(T.isPreloaded()&&T.numActive()===1?(T.release(Bt),Ot=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},g.createTileMesh=uo,g.getMaxParallelImageRequests=function(){return c.a.MAX_PARALLEL_IMAGE_REQUESTS},g.getRTLTextPluginStatus=function(){return Vs().getRTLTextPluginStatus()},g.getVersion=function(){return Ih},g.getWorkerCount=function(){return Le.workerCount},g.getWorkerUrl=function(){return c.a.WORKER_URL},g.importScriptInWorkers=function(T){return Fn().broadcast("IS",T)},g.prewarm=function(){Jt().acquire(Bt)},g.setMaxParallelImageRequests=function(T){c.a.MAX_PARALLEL_IMAGE_REQUESTS=T},g.setRTLTextPlugin=function(T,i){return Vs().setRTLTextPlugin(T,i)},g.setWorkerCount=function(T){Le.workerCount=T},g.setWorkerUrl=function(T){c.a.WORKER_URL=T}}));var m=t;return m}))})(E0)),E0.exports}var AB=EB();const wn=Ry(AB);function CB(){return typeof self<"u"?fetch.bind(self):typeof global<"u"&&global.fetch?global.fetch:null}class IB{constructor(){this._apiKey="",this._fetch=CB(),this.tileCacheSize=200}set apiKey(e){this._apiKey=e}get apiKey(){return this._apiKey}set fetch(e){this._fetch=e}get fetch(){return this._fetch}}const fg=new IB,PB={AUTO:{code:null,flag:"auto",name:"Auto",latin:!1,isMode:!0,geocoding:!0},LATIN:{code:"latin",flag:"name:latin",name:"Latin",latin:!0,isMode:!1,geocoding:!1},NON_LATIN:{code:"nonlatin",flag:"name:nonlatin",name:"Non Latin",latin:!1,isMode:!1,geocoding:!1},LOCAL:{code:null,flag:"name",name:"Local",latin:!0,isMode:!1,geocoding:!1}},MB={ALBANIAN:{code:"sq",flag:"name:sq",name:"Albanian",latin:!0,isMode:!1,geocoding:!0},AMHARIC:{code:"am",flag:"name:am",name:"Amharic",latin:!1,isMode:!1,geocoding:!0},ARABIC:{code:"ar",flag:"name:ar",name:"Arabic",latin:!1,isMode:!1,geocoding:!0},ARMENIAN:{code:"hy",flag:"name:hy",name:"Armenian",latin:!1,isMode:!1,geocoding:!0},AZERBAIJANI:{code:"az",flag:"name:az",name:"Azerbaijani",latin:!0,isMode:!1,geocoding:!0},BASQUE:{code:"eu",flag:"name:eu",name:"Basque",latin:!0,isMode:!1,geocoding:!0},BELARUSIAN:{code:"be",flag:"name:be",name:"Belarusian",latin:!1,isMode:!1,geocoding:!0},BENGALI:{code:"bn",flag:"name:bn",name:"Bengali",latin:!0,isMode:!1,geocoding:!0},BOSNIAN:{code:"bs",flag:"name:bs",name:"Bosnian",latin:!0,isMode:!1,geocoding:!0},BRETON:{code:"br",flag:"name:br",name:"Breton",latin:!0,isMode:!1,geocoding:!0},BULGARIAN:{code:"bg",flag:"bg",name:"Bulgarian",latin:!1,isMode:!1,geocoding:!0},CATALAN:{code:"ca",flag:"name:ca",name:"Catalan",latin:!0,isMode:!1,geocoding:!0},CHINESE:{code:"zh",flag:"name:zh",name:"Chinese",latin:!1,isMode:!1,geocoding:!0},TRADITIONAL_CHINESE:{code:"zh-Hant",flag:"name:zh-Hant",name:"Chinese (traditional)",latin:!1,isMode:!1,geocoding:!1},SIMPLIFIED_CHINESE:{code:"zh-Hans",flag:"name:zh-Hans",name:"Chinese (simplified)",latin:!1,isMode:!1,geocoding:!1},CORSICAN:{code:"co",flag:"name:co",name:"Corsican",latin:!0,isMode:!1,geocoding:!0},CROATIAN:{code:"hr",flag:"name:hr",name:"Croatian",latin:!0,isMode:!1,geocoding:!0},CZECH:{code:"cs",flag:"name:cs",name:"Czech",latin:!0,isMode:!1,geocoding:!0},DANISH:{code:"da",flag:"name:da",name:"Danish",latin:!0,isMode:!1,geocoding:!0},DUTCH:{code:"nl",flag:"name:nl",name:"Dutch",latin:!0,isMode:!1,geocoding:!0},GERMAN:{code:"de",flag:"name:de",name:"German",latin:!0,isMode:!1,geocoding:!0},GREEK:{code:"el",flag:"name:el",name:"Greek",latin:!1,isMode:!1,geocoding:!0},ENGLISH:{code:"en",flag:"name:en",name:"English",latin:!0,isMode:!1,geocoding:!0},ESPERANTO:{code:"eo",flag:"name:eo",name:"Esperanto",latin:!0,isMode:!1,geocoding:!0},ESTONIAN:{code:"et",flag:"name:et",name:"Estonian",latin:!0,isMode:!1,geocoding:!0},FINNISH:{code:"fi",flag:"name:fi",name:"Finnish",latin:!0,isMode:!1,geocoding:!0},FRENCH:{code:"fr",flag:"name:fr",name:"French",latin:!0,isMode:!1,geocoding:!0},FRISIAN:{code:"fy",flag:"name:fy",name:"Frisian (West)",latin:!0,isMode:!1,geocoding:!0},GEORGIAN:{code:"ka",flag:"name:ka",name:"Georgian",latin:!1,isMode:!1,geocoding:!0},HEBREW:{code:"he",flag:"name:he",name:"Hebrew",latin:!1,isMode:!1,geocoding:!0},HINDI:{code:"hi",flag:"name:hi",name:"Hindi",latin:!1,isMode:!1,geocoding:!0},HUNGARIAN:{code:"hu",flag:"name:hu",name:"Hungarian",latin:!0,isMode:!1,geocoding:!0},ICELANDIC:{code:"is",flag:"name:is",name:"Icelandic",latin:!0,isMode:!1,geocoding:!0},INDONESIAN:{code:"id",flag:"name:id",name:"Indonesian",latin:!0,isMode:!1,geocoding:!0},IRISH:{code:"ga",flag:"name:ga",name:"Irish",latin:!0,isMode:!1,geocoding:!0},ITALIAN:{code:"it",flag:"name:it",name:"Italian",latin:!0,isMode:!1,geocoding:!0},JAPANESE:{code:"ja",flag:"name:ja",name:"Japanese",latin:!1,isMode:!1,geocoding:!0},JAPANESE_HIRAGANA:{code:"ja-Hira",flag:"name:ja-Hira",name:"Japanese Hiragana form",latin:!1,isMode:!1,geocoding:!1},JAPANESE_2018:{code:"ja-Latn",flag:"name:ja-Latn",name:"Japanese (Latin 2018)",latin:!0,isMode:!1,geocoding:!1},JAPANESE_KANA:{code:"ja_kana",flag:"name:ja_kana",name:"Japanese (Kana)",latin:!1,isMode:!1,geocoding:!1},JAPANESE_LATIN:{code:"ja_rm",flag:"name:ja_rm",name:"Japanese (Latin script)",latin:!0,isMode:!1,geocoding:!1},KANNADA:{code:"kn",flag:"name:kn",name:"Kannada",latin:!0,isMode:!1,geocoding:!0},KAZAKH:{code:"kk",flag:"name:kk",name:"Kazakh",latin:!1,isMode:!1,geocoding:!0},KOREAN:{code:"ko",flag:"name:ko",name:"Korean",latin:!1,isMode:!1,geocoding:!0},KOREAN_LATIN:{code:"ko-Latn",flag:"name:ko-Latn",name:"Korean (Latin script)",latin:!0,isMode:!1,geocoding:!1},KURDISH:{code:"ku",flag:"name:ku",name:"Kurdish",latin:!0,isMode:!1,geocoding:!0},CLASSICAL_LATIN:{code:"la",flag:"name:la",name:"Latin",latin:!0,isMode:!1,geocoding:!0},LATVIAN:{code:"lv",flag:"name:lv",name:"Latvian",latin:!0,isMode:!1,geocoding:!0},LITHUANIAN:{code:"lt",flag:"name:lt",name:"Lithuanian",latin:!0,isMode:!1,geocoding:!0},LUXEMBOURGISH:{code:"lb",flag:"name:lb",name:"Luxembourgish",latin:!0,isMode:!1,geocoding:!0},MACEDONIAN:{code:"mk",flag:"name:mk",name:"Macedonian",latin:!1,isMode:!1,geocoding:!0},MALAYALAM:{code:"ml",flag:"name:ml",name:"Malayalam",latin:!1,isMode:!1,geocoding:!0},MALTESE:{code:"mt",flag:"name:mt",name:"Maltese",latin:!0,isMode:!1,geocoding:!0},NORWEGIAN:{code:"no",flag:"name:no",name:"Norwegian",latin:!0,isMode:!1,geocoding:!0},OCCITAN:{code:"oc",flag:"name:oc",name:"Occitan",latin:!0,isMode:!1,geocoding:!0},PERSIAN:{code:"fa",flag:"name:fa",name:"Persian",latin:!1,isMode:!1,geocoding:!0},POLISH:{code:"pl",flag:"name:pl",name:"Polish",latin:!0,isMode:!1,geocoding:!0},PORTUGUESE:{code:"pt",flag:"name:pt",name:"Portuguese",latin:!0,isMode:!1,geocoding:!0},PUNJABI:{code:"pa",flag:"name:pa",name:"Punjabi",latin:!1,isMode:!1,geocoding:!0},WESTERN_PUNJABI:{code:"pnb",flag:"name:pnb",name:"Western Punjabi",latin:!1,isMode:!1,geocoding:!1},ROMANIAN:{code:"ro",flag:"name:ro",name:"Romanian",latin:!0,isMode:!1,geocoding:!0},ROMANSH:{code:"rm",flag:"name:rm",name:"Romansh",latin:!0,isMode:!1,geocoding:!0},RUSSIAN:{code:"ru",flag:"name:ru",name:"Russian",latin:!1,isMode:!1,geocoding:!0},SERBIAN_CYRILLIC:{code:"sr",flag:"name:sr",name:"Serbian (Cyrillic script)",latin:!1,isMode:!1,geocoding:!0},SERBIAN_LATIN:{code:"sr-Latn",flag:"name:sr-Latn",name:"Serbian (Latin script)",latin:!0,isMode:!1,geocoding:!1},SCOTTISH_GAELIC:{code:"gd",flag:"name:gd",name:"Scottish Gaelic",latin:!0,isMode:!1,geocoding:!0},SLOVAK:{code:"sk",flag:"name:sk",name:"Slovak",latin:!0,isMode:!1,geocoding:!0},SLOVENE:{code:"sl",flag:"name:sl",name:"Slovene",latin:!0,isMode:!1,geocoding:!0},SPANISH:{code:"es",flag:"name:es",name:"Spanish",latin:!0,isMode:!1,geocoding:!0},SWEDISH:{code:"sv",flag:"name:sv",name:"Swedish",latin:!0,isMode:!1,geocoding:!0},TAMIL:{code:"ta",flag:"name:ta",name:"Tamil",latin:!1,isMode:!1,geocoding:!0},TELUGU:{code:"te",flag:"name:te",name:"Telugu",latin:!1,isMode:!1,geocoding:!0},THAI:{code:"th",flag:"name:th",name:"Thai",latin:!1,isMode:!1,geocoding:!0},TURKISH:{code:"tr",flag:"name:tr",name:"Turkish",latin:!0,isMode:!1,geocoding:!0},UKRAINIAN:{code:"uk",flag:"name:uk",name:"Ukrainian",latin:!1,isMode:!1,geocoding:!0},VIETNAMESE:{code:"vi",flag:"name:vi",name:"Vietnamese (Latin script)",latin:!0,isMode:!1,geocoding:!0},WELSH:{code:"cy",flag:"name:cy",name:"Welsh",latin:!0,isMode:!1,geocoding:!0}},Hy={...PB,...MB};function RB(n,e=Hy){return n in e?n[n]:null}function N1(n,e=Hy){for(const t of Object.values(e))if(t.code===n)return t;return null}function B1(n,e=Hy){for(const t of Object.values(e))if(t.flag===n)return t;return null}function kB(n){return n!==null&&typeof n=="object"&&"code"in n&&"flag"in n&&"name"in n&&"latin"in n&&"isMode"in n&&"geocoding"in n&&(typeof n.code=="string"||n.code===null)&&typeof n.flag=="string"&&typeof n.name=="string"&&typeof n.latin=="boolean"&&typeof n.isMode=="boolean"&&typeof n.geocoding=="boolean"}function iE(n,e=Hy){return kB(n)?B1(n.flag,e):typeof n!="string"?null:RB(n,e)||N1(n,e)||B1(n,e)||null}async function LB(n,e={}){if(fg.fetch===null)throw new Error("The fetch function was not found. If on NodeJS < 18 please specify the fetch function with config.fetch");if(new URL(n).searchParams.get("key").trim()==="")throw new Error("The MapTiler Cloud API key is missing. Set it in `config.apiKey` or get one for free at https://maptiler.com");return fg.fetch(n,e)}const NP={maptilerApiURL:"https://api.maptiler.com/",mapStyle:"streets-v2"};Object.freeze(NP);class DB extends Error{constructor(e,t=""){super(`Call to enpoint ${e.url} failed with the status code ${e.status}. ${t}`),this.res=e}}const rE={403:"Key is missing, invalid or restricted"};async function zB(n={}){const e=new URL("geolocation/ip.json",NP.maptilerApiURL);e.searchParams.set("key",n.apiKey??fg.apiKey),"elevation"in n&&e.searchParams.set("elevation",n.elevation?"true":"false");const t=e.toString(),a=await LB(t);if(!a.ok)throw new DB(a,a.status in rE?rE[a.status]:"");return await a.json()}const aE={info:zB};function BP(n){const e=/^maptiler:\/\/(.*)/;let t;const a=n.trim();let d;return a.startsWith("http://")||a.startsWith("https://")?d=a:(t=e.exec(a))!==null?d=`https://api.maptiler.com/maps/${t[1]}/style.json`:d=`https://api.maptiler.com/maps/${a}/style.json`,d}class FP{constructor(e,t,a,d,m,g,c=!1){this.name=e,this.variantType=t,this.id=a,this.referenceStyle=d,this.description=m,this.imageURL=g,this.deprecated=c}getName(){return this.name}getFullName(){return`${this.referenceStyle.getName()} ${this.name}`}getType(){return this.variantType}getId(){return this.id}getDescription(){return this.description}getReferenceStyle(){return this.referenceStyle}hasVariant(e){return this.referenceStyle.hasVariant(e)}getVariant(e){const t=this.referenceStyle.getVariant(e);return this.warnIfDeprecated(t),t}getVariants(){return this.referenceStyle.getVariants().filter(e=>e!==this).map(e=>(this.warnIfDeprecated(e),e))}getImageURL(){return this.imageURL}getExpandedStyleURL(){return BP(this.getId())}warnIfDeprecated(e=this){if(!e.deprecated)return e;const t=e.getFullName();return console.warn(`Style "${t}" is deprecated and will be removed in a future version.`),e}}class VP{constructor(e,t){this.name=e,this.id=t,this.variants={},this.orderedVariants=[]}getName(){return this.name}getId(){return this.id}addVariant(e){this.variants[e.getType()]=e,this.orderedVariants.push(e)}hasVariant(e){return e in this.variants}getVariant(e){return e in this.variants?this.variants[e]:this.orderedVariants[0]}getVariants(){return Object.values(this.variants)}getDefaultVariant(){return this.orderedVariants[0].warnIfDeprecated()}}const ry=[{referenceStyleID:"STREETS",name:"Streets",description:"",variants:[{id:"streets-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"streets-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"streets-v2-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""},{id:"streets-v2-night",name:"Night",variantType:"NIGHT",description:"",imageURL:""},{id:"streets-v2-pastel",name:"Pastel",variantType:"PASTEL",description:"",imageURL:""}]},{referenceStyleID:"OUTDOOR",name:"Outdoor",description:"",variants:[{id:"outdoor-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"outdoor-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""}]},{referenceStyleID:"WINTER",name:"Winter",description:"",variants:[{id:"winter-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"winter-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""}]},{referenceStyleID:"SATELLITE",name:"Satellite",description:"",variants:[{id:"satellite",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"HYBRID",name:"Hybrid",description:"",variants:[{id:"hybrid",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"BASIC",name:"Basic",description:"",variants:[{id:"basic-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"basic-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"basic-v2-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""}]},{referenceStyleID:"BRIGHT",name:"Bright",description:"",variants:[{id:"bright-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"bright-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"bright-v2-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""},{id:"bright-v2-pastel",name:"Pastel",variantType:"PASTEL",description:"",imageURL:""}]},{referenceStyleID:"OPENSTREETMAP",name:"OpenStreetMap",description:"",variants:[{id:"openstreetmap",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"TOPO",name:"Topo",description:"",variants:[{id:"topo-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"topo-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"topo-v2-shiny",name:"Shiny",deprecated:!0,variantType:"SHINY",description:"",imageURL:""},{id:"topo-v2-pastel",name:"Pastel",variantType:"PASTEL",description:"",imageURL:""},{id:"topo-v2-topographique",name:"Topographique",variantType:"TOPOGRAPHIQUE",description:"",imageURL:""}]},{referenceStyleID:"VOYAGER",name:"Voyager",description:"",variants:[{id:"voyager-v2",name:"Default",deprecated:!0,variantType:"DEFAULT",description:"",imageURL:""},{id:"voyager-v2-darkmatter",name:"Darkmatter",deprecated:!0,variantType:"DARK",description:"",imageURL:""},{id:"voyager-v2-positron",name:"Positron",deprecated:!0,variantType:"LIGHT",description:"",imageURL:""},{id:"voyager-v2-vintage",name:"Vintage",deprecated:!0,variantType:"VINTAGE",description:"",imageURL:""}]},{referenceStyleID:"TONER",name:"Toner",description:"",variants:[{id:"toner-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"toner-v2-background",name:"Background",variantType:"BACKGROUND",deprecated:!0,description:"",imageURL:""},{id:"toner-v2-lite",name:"Lite",variantType:"LITE",description:"",imageURL:""},{id:"toner-v2-lines",name:"Lines",variantType:"LINES",deprecated:!0,description:"",imageURL:""}]},{referenceStyleID:"DATAVIZ",name:"Dataviz",description:"",variants:[{id:"dataviz",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"dataviz-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"dataviz-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""}]},{referenceStyleID:"BACKDROP",name:"Backdrop",description:"",variants:[{id:"backdrop",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"backdrop-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"backdrop-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""}]},{referenceStyleID:"OCEAN",name:"Ocean",description:"",variants:[{id:"ocean",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"AQUARELLE",name:"Aquarelle",description:"Watercolor map for creative use",variants:[{id:"aquarelle",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"aquarelle-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"aquarelle-vivid",name:"Vivid",variantType:"VIVID",description:"",imageURL:""}]},{referenceStyleID:"LANDSCAPE",name:"Landscape",description:"Terrain map for data overlays and visualisations",variants:[{id:"landscape",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"landscape-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"landscape-vivid",name:"Vivid",variantType:"VIVID",description:"",imageURL:""}]}];function OB(n){return new Proxy(n,{get(e,t,a){return e.hasVariant(t)?e.getVariant(t):t.toString().toUpperCase()===t?n.getDefaultVariant():Reflect.get(e,t,a)}})}function NB(){const n={};for(let e=0;e<ry.length;e+=1){const t=ry[e],a=OB(new VP(t.name,t.referenceStyleID));for(let d=0;d<t.variants.length;d+=1){const m=t.variants[d],g=new FP(m.name,m.variantType,m.id,a,m.description,m.imageURL,m.deprecated);a.addVariant(g)}n[t.referenceStyleID]=a}return n}const ay=NB();var Yv={exports:{}},sE;function BB(){if(sE)return Yv.exports;sE=1;var n=typeof Reflect=="object"?Reflect:null,e=n&&typeof n.apply=="function"?n.apply:function(je,Be,de){return Function.prototype.apply.call(je,Be,de)},t;n&&typeof n.ownKeys=="function"?t=n.ownKeys:Object.getOwnPropertySymbols?t=function(je){return Object.getOwnPropertyNames(je).concat(Object.getOwnPropertySymbols(je))}:t=function(je){return Object.getOwnPropertyNames(je)};function a(Ze){console&&console.warn&&console.warn(Ze)}var d=Number.isNaN||function(je){return je!==je};function m(){m.init.call(this)}Yv.exports=m,Yv.exports.once=et,m.EventEmitter=m,m.prototype._events=void 0,m.prototype._eventsCount=0,m.prototype._maxListeners=void 0;var g=10;function c(Ze){if(typeof Ze!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof Ze)}Object.defineProperty(m,"defaultMaxListeners",{enumerable:!0,get:function(){return g},set:function(Ze){if(typeof Ze!="number"||Ze<0||d(Ze))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+Ze+".");g=Ze}}),m.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},m.prototype.setMaxListeners=function(je){if(typeof je!="number"||je<0||d(je))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+je+".");return this._maxListeners=je,this};function C(Ze){return Ze._maxListeners===void 0?m.defaultMaxListeners:Ze._maxListeners}m.prototype.getMaxListeners=function(){return C(this)},m.prototype.emit=function(je){for(var Be=[],de=1;de<arguments.length;de++)Be.push(arguments[de]);var ce=je==="error",_e=this._events;if(_e!==void 0)ce=ce&&_e.error===void 0;else if(!ce)return!1;if(ce){var Ae;if(Be.length>0&&(Ae=Be[0]),Ae instanceof Error)throw Ae;var Me=new Error("Unhandled error."+(Ae?" ("+Ae.message+")":""));throw Me.context=Ae,Me}var Ge=_e[je];if(Ge===void 0)return!1;if(typeof Ge=="function")e(Ge,this,Be);else for(var Re=Ge.length,Pn=xe(Ge,Re),de=0;de<Re;++de)e(Pn[de],this,Be);return!0};function R(Ze,je,Be,de){var ce,_e,Ae;if(c(Be),_e=Ze._events,_e===void 0?(_e=Ze._events=Object.create(null),Ze._eventsCount=0):(_e.newListener!==void 0&&(Ze.emit("newListener",je,Be.listener?Be.listener:Be),_e=Ze._events),Ae=_e[je]),Ae===void 0)Ae=_e[je]=Be,++Ze._eventsCount;else if(typeof Ae=="function"?Ae=_e[je]=de?[Be,Ae]:[Ae,Be]:de?Ae.unshift(Be):Ae.push(Be),ce=C(Ze),ce>0&&Ae.length>ce&&!Ae.warned){Ae.warned=!0;var Me=new Error("Possible EventEmitter memory leak detected. "+Ae.length+" "+String(je)+" listeners added. Use emitter.setMaxListeners() to increase limit");Me.name="MaxListenersExceededWarning",Me.emitter=Ze,Me.type=je,Me.count=Ae.length,a(Me)}return Ze}m.prototype.addListener=function(je,Be){return R(this,je,Be,!1)},m.prototype.on=m.prototype.addListener,m.prototype.prependListener=function(je,Be){return R(this,je,Be,!0)};function V(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function q(Ze,je,Be){var de={fired:!1,wrapFn:void 0,target:Ze,type:je,listener:Be},ce=V.bind(de);return ce.listener=Be,de.wrapFn=ce,ce}m.prototype.once=function(je,Be){return c(Be),this.on(je,q(this,je,Be)),this},m.prototype.prependOnceListener=function(je,Be){return c(Be),this.prependListener(je,q(this,je,Be)),this},m.prototype.removeListener=function(je,Be){var de,ce,_e,Ae,Me;if(c(Be),ce=this._events,ce===void 0)return this;if(de=ce[je],de===void 0)return this;if(de===Be||de.listener===Be)--this._eventsCount===0?this._events=Object.create(null):(delete ce[je],ce.removeListener&&this.emit("removeListener",je,de.listener||Be));else if(typeof de!="function"){for(_e=-1,Ae=de.length-1;Ae>=0;Ae--)if(de[Ae]===Be||de[Ae].listener===Be){Me=de[Ae].listener,_e=Ae;break}if(_e<0)return this;_e===0?de.shift():be(de,_e),de.length===1&&(ce[je]=de[0]),ce.removeListener!==void 0&&this.emit("removeListener",je,Me||Be)}return this},m.prototype.off=m.prototype.removeListener,m.prototype.removeAllListeners=function(je){var Be,de,ce;if(de=this._events,de===void 0)return this;if(de.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):de[je]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete de[je]),this;if(arguments.length===0){var _e=Object.keys(de),Ae;for(ce=0;ce<_e.length;++ce)Ae=_e[ce],Ae!=="removeListener"&&this.removeAllListeners(Ae);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(Be=de[je],typeof Be=="function")this.removeListener(je,Be);else if(Be!==void 0)for(ce=Be.length-1;ce>=0;ce--)this.removeListener(je,Be[ce]);return this};function J(Ze,je,Be){var de=Ze._events;if(de===void 0)return[];var ce=de[je];return ce===void 0?[]:typeof ce=="function"?Be?[ce.listener||ce]:[ce]:Be?Oe(ce):xe(ce,ce.length)}m.prototype.listeners=function(je){return J(this,je,!0)},m.prototype.rawListeners=function(je){return J(this,je,!1)},m.listenerCount=function(Ze,je){return typeof Ze.listenerCount=="function"?Ze.listenerCount(je):Y.call(Ze,je)},m.prototype.listenerCount=Y;function Y(Ze){var je=this._events;if(je!==void 0){var Be=je[Ze];if(typeof Be=="function")return 1;if(Be!==void 0)return Be.length}return 0}m.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]};function xe(Ze,je){for(var Be=new Array(je),de=0;de<je;++de)Be[de]=Ze[de];return Be}function be(Ze,je){for(;je+1<Ze.length;je++)Ze[je]=Ze[je+1];Ze.pop()}function Oe(Ze){for(var je=new Array(Ze.length),Be=0;Be<je.length;++Be)je[Be]=Ze[Be].listener||Ze[Be];return je}function et(Ze,je){return new Promise(function(Be,de){function ce(Ae){Ze.removeListener(je,_e),de(Ae)}function _e(){typeof Ze.removeListener=="function"&&Ze.removeListener("error",ce),Be([].slice.call(arguments))}qe(Ze,je,_e,{once:!0}),je!=="error"&&Je(Ze,ce,{once:!0})})}function Je(Ze,je,Be){typeof Ze.on=="function"&&qe(Ze,"error",je,Be)}function qe(Ze,je,Be,de){if(typeof Ze.on=="function")de.once?Ze.once(je,Be):Ze.on(je,Be);else if(typeof Ze.addEventListener=="function")Ze.addEventListener(je,function ce(_e){de.once&&Ze.removeEventListener(je,ce),Be(_e)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof Ze)}return Yv.exports}var FB=BB();const VB=Ry(FB),Jo=[];for(let n=0;n<256;++n)Jo.push((n+256).toString(16).slice(1));function UB(n,e=0){return(Jo[n[e+0]]+Jo[n[e+1]]+Jo[n[e+2]]+Jo[n[e+3]]+"-"+Jo[n[e+4]]+Jo[n[e+5]]+"-"+Jo[n[e+6]]+Jo[n[e+7]]+"-"+Jo[n[e+8]]+Jo[n[e+9]]+"-"+Jo[n[e+10]]+Jo[n[e+11]]+Jo[n[e+12]]+Jo[n[e+13]]+Jo[n[e+14]]+Jo[n[e+15]]).toLowerCase()}let Bx;const jB=new Uint8Array(16);function $B(){if(!Bx){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Bx=crypto.getRandomValues.bind(crypto)}return Bx(jB)}const qB=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),oE={randomUUID:qB};function GB(n,e,t){var d;if(oE.randomUUID&&!n)return oE.randomUUID();n=n||{};const a=n.random??((d=n.rng)==null?void 0:d.call(n))??$B();if(a.length<16)throw new Error("Random bytes length must be >= 16");return a[6]=a[6]&15|64,a[8]=a[8]&63|128,UB(a)}const UP="3.7.8",HB=UP,zg=typeof Buffer=="function",lE=typeof TextDecoder=="function"?new TextDecoder:void 0,uE=typeof TextEncoder=="function"?new TextEncoder:void 0,ZB="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",Z_=Array.prototype.slice.call(ZB),Qv=(n=>{let e={};return n.forEach((t,a)=>e[t]=a),e})(Z_),WB=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,el=String.fromCharCode.bind(String),cE=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):n=>new Uint8Array(Array.prototype.slice.call(n,0)),jP=n=>n.replace(/=/g,"").replace(/[+\/]/g,e=>e=="+"?"-":"_"),$P=n=>n.replace(/[^A-Za-z0-9\+\/]/g,""),qP=n=>{let e,t,a,d,m="";const g=n.length%3;for(let c=0;c<n.length;){if((t=n.charCodeAt(c++))>255||(a=n.charCodeAt(c++))>255||(d=n.charCodeAt(c++))>255)throw new TypeError("invalid character found");e=t<<16|a<<8|d,m+=Z_[e>>18&63]+Z_[e>>12&63]+Z_[e>>6&63]+Z_[e&63]}return g?m.slice(0,g-3)+"===".substring(g):m},p2=typeof btoa=="function"?n=>btoa(n):zg?n=>Buffer.from(n,"binary").toString("base64"):qP,F1=zg?n=>Buffer.from(n).toString("base64"):n=>{let t=[];for(let a=0,d=n.length;a<d;a+=4096)t.push(el.apply(null,n.subarray(a,a+4096)));return p2(t.join(""))},A0=(n,e=!1)=>e?jP(F1(n)):F1(n),KB=n=>{if(n.length<2){var e=n.charCodeAt(0);return e<128?n:e<2048?el(192|e>>>6)+el(128|e&63):el(224|e>>>12&15)+el(128|e>>>6&63)+el(128|e&63)}else{var e=65536+(n.charCodeAt(0)-55296)*1024+(n.charCodeAt(1)-56320);return el(240|e>>>18&7)+el(128|e>>>12&63)+el(128|e>>>6&63)+el(128|e&63)}},XB=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,GP=n=>n.replace(XB,KB),hE=zg?n=>Buffer.from(n,"utf8").toString("base64"):uE?n=>F1(uE.encode(n)):n=>p2(GP(n)),pg=(n,e=!1)=>e?jP(hE(n)):hE(n),dE=n=>pg(n,!0),YB=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,QB=n=>{switch(n.length){case 4:var e=(7&n.charCodeAt(0))<<18|(63&n.charCodeAt(1))<<12|(63&n.charCodeAt(2))<<6|63&n.charCodeAt(3),t=e-65536;return el((t>>>10)+55296)+el((t&1023)+56320);case 3:return el((15&n.charCodeAt(0))<<12|(63&n.charCodeAt(1))<<6|63&n.charCodeAt(2));default:return el((31&n.charCodeAt(0))<<6|63&n.charCodeAt(1))}},HP=n=>n.replace(YB,QB),ZP=n=>{if(n=n.replace(/\s+/g,""),!WB.test(n))throw new TypeError("malformed base64.");n+="==".slice(2-(n.length&3));let e,t,a,d=[];for(let m=0;m<n.length;)e=Qv[n.charAt(m++)]<<18|Qv[n.charAt(m++)]<<12|(t=Qv[n.charAt(m++)])<<6|(a=Qv[n.charAt(m++)]),t===64?d.push(el(e>>16&255)):a===64?d.push(el(e>>16&255,e>>8&255)):d.push(el(e>>16&255,e>>8&255,e&255));return d.join("")},m2=typeof atob=="function"?n=>atob($P(n)):zg?n=>Buffer.from(n,"base64").toString("binary"):ZP,WP=zg?n=>cE(Buffer.from(n,"base64")):n=>cE(m2(n).split("").map(e=>e.charCodeAt(0))),KP=n=>WP(XP(n)),JB=zg?n=>Buffer.from(n,"base64").toString("utf8"):lE?n=>lE.decode(WP(n)):n=>HP(m2(n)),XP=n=>$P(n.replace(/[-_]/g,e=>e=="-"?"+":"/")),V1=n=>JB(XP(n)),eF=n=>{if(typeof n!="string")return!1;const e=n.replace(/\s+/g,"").replace(/={0,2}$/,"");return!/[^\s0-9a-zA-Z\+/]/.test(e)||!/[^\s0-9a-zA-Z\-_]/.test(e)},YP=n=>({value:n,enumerable:!1,writable:!0,configurable:!0}),QP=function(){const n=(e,t)=>Object.defineProperty(String.prototype,e,YP(t));n("fromBase64",function(){return V1(this)}),n("toBase64",function(e){return pg(this,e)}),n("toBase64URI",function(){return pg(this,!0)}),n("toBase64URL",function(){return pg(this,!0)}),n("toUint8Array",function(){return KP(this)})},JP=function(){const n=(e,t)=>Object.defineProperty(Uint8Array.prototype,e,YP(t));n("toBase64",function(e){return A0(this,e)}),n("toBase64URI",function(){return A0(this,!0)}),n("toBase64URL",function(){return A0(this,!0)})},tF=()=>{QP(),JP()},nF={version:UP,VERSION:HB,atob:m2,atobPolyfill:ZP,btoa:p2,btoaPolyfill:qP,fromBase64:V1,toBase64:pg,encode:pg,encodeURI:dE,encodeURL:dE,utob:GP,btou:HP,decode:V1,isValid:eF,fromUint8Array:A0,toUint8Array:KP,extendString:QP,extendUint8Array:JP,extendBuiltins:tF};var iF=Object.defineProperty,eM=n=>{throw TypeError(n)},rF=(n,e,t)=>e in n?iF(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,rn=(n,e,t)=>rF(n,typeof e!="symbol"?e+"":e,t),g2=(n,e,t)=>e.has(n)||eM("Cannot "+t),An=(n,e,t)=>(g2(n,e,"read from private field"),t?t.call(n):e.get(n)),hu=(n,e,t)=>e.has(n)?eM("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(n):e.set(n,t),Vu=(n,e,t,a)=>(g2(n,e,"write to private field"),e.set(n,t),t),Bu=(n,e,t)=>(g2(n,e,"access private method"),t);const er={VISITOR:{code:null,flag:"visitor",name:"Visitor",latin:!0,isMode:!0,geocoding:!1},VISITOR_ENGLISH:{code:null,flag:"visitor_en",name:"Visitor English",latin:!0,isMode:!0,geocoding:!1},STYLE:{code:null,flag:"style",name:"Style",latin:!1,isMode:!0,geocoding:!1},STYLE_LOCK:{code:null,flag:"style_lock",name:"Style Lock",latin:!1,isMode:!0,geocoding:!1},...Hy};function fE(){if(typeof navigator>"u"){const n=Intl.DateTimeFormat().resolvedOptions().locale.split("-")[0];return N1(n)||er.ENGLISH}return Array.from(new Set(navigator.languages.map(n=>n.split("-")[0]))).map(n=>N1(n)).filter(n=>n)[0]??er.LOCAL}const Gl={maptilerLogoURL:"https://api.maptiler.com/resources/logo.svg",maptilerURL:"https://www.maptiler.com/",maptilerApiHost:"api.maptiler.com",telemetryURL:"https://api.maptiler.com/metrics",rtlPluginURL:"https://cdn.maptiler.com/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.min.js",primaryLanguage:er.STYLE,secondaryLanguage:er.LOCAL,terrainSourceURL:"https://api.maptiler.com/tiles/terrain-rgb-v2/tiles.json",terrainSourceId:"maptiler-terrain"};Object.freeze(Gl);const _2=GB();class aF extends VB{constructor(){super(...arguments),rn(this,"primaryLanguage",Gl.primaryLanguage),rn(this,"secondaryLanguage"),rn(this,"session",!0),rn(this,"caching",!0),rn(this,"telemetry",!0),rn(this,"_unit","metric"),rn(this,"_apiKey","")}set unit(e){this._unit=e,this.emit("unit",e)}get unit(){return this._unit}set apiKey(e){this._apiKey=e,fg.apiKey=e,this.emit("apiKey",e)}get apiKey(){return this._apiKey}set fetch(e){fg.fetch=e}get fetch(){return fg.fetch}}const Ya=new aF,U1="localcache_source",j1="localcache",sF="maptiler_sdk",oF=1e3,lF=100,$1=typeof caches<"u",{addProtocol:pE}=wn;function uF(n,e){if($1&&Ya.caching&&Ya.session&&n.host===Gl.maptilerApiHost){if(e==="Source"&&n.href.includes("tiles.json"))return n.href.replace("https://",`${U1}://`);if(e==="Tile"||e==="Glyphs")return n.href.replace("https://",`${j1}://`)}return n.href}let Fx;async function tM(){return Fx||(Fx=await caches.open(sF)),Fx}let mE=0;async function cF(){const n=await tM(),e=await n.keys(),t=e.slice(0,Math.max(e.length-oF,0));for(const a of t)n.delete(a)}function hF(){pE(U1,async(n,e)=>{if(!n.url)throw new Error("");n.url=n.url.replace(`${U1}://`,"https://");const t=n;t.signal=e.signal;const a=await fetch(n.url,t),d=await a.json();return d.tiles&&d.tiles.length>0&&(d.tiles[0]+=`&last-modified=${a.headers.get("Last-Modified")}`),{data:d,cacheControl:a.headers.get("Cache-Control"),expires:a.headers.get("Expires")}}),pE(j1,async(n,e)=>{if(!n.url)throw new Error("");n.url=n.url.replace(`${j1}://`,"https://");const t=new URL(n.url),a=new URL(t);a.searchParams.delete("mtsid"),a.searchParams.delete("key");const d=a.toString(),m=new URL(t);m.searchParams.delete("last-modified");const g=m.toString(),c=async J=>({data:await J.arrayBuffer(),cacheControl:J.headers.get("Cache-Control"),expires:J.headers.get("Expires")}),C=await tM(),R=await C.match(d);if(R)return c(R);const V=n;V.signal=e.signal;const q=await fetch(g,V);return q.status>=200&&q.status<300&&(C.put(d,q.clone()).catch(()=>{}),++mE>lF&&(cF(),mE=0)),c(q)})}function dF(){if(typeof window>"u")return;const n=wn.getRTLTextPluginStatus();if(n==="unavailable"||n==="requested")try{wn.setRTLTextPlugin(Gl.rtlPluginURL,!0)}catch{}}function fF(n,e){for(const t of n)typeof e[t]=="function"&&(e[t]=e[t].bind(e))}function gE(n,e){let t=null;try{t=new URL(n)}catch{return{url:n}}return t.host===Gl.maptilerApiHost&&(t.searchParams.has("key")||t.searchParams.append("key",Ya.apiKey),Ya.session&&t.searchParams.append("mtsid",_2)),{url:uF(t,e)}}function _E(n){return(e,t)=>{if(n!=null){const a=n(e,t),d=gE((a==null?void 0:a.url)??"",t);return{...a,...d}}return gE(e,t)}}function nM(){return Math.random().toString(36).substring(2)}function Ob(n){return/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/gi.test(n)}function pF(n){try{return JSON.parse(n)}catch{}return null}function mF(){return document.createElement("canvas").getContext("webgl2")?null:typeof WebGL2RenderingContext<"u"?"Graphic rendering with WebGL2 has been disabled or is not supported by your graphic card. The map cannot be displayed.":"Your browser does not support graphic rendering with WebGL2. The map cannot be displayed."}function gF(n){const e=mF();if(!e)return;let t=null;if(typeof n=="string"?t=document.getElementById(n):n instanceof HTMLElement&&(t=n),!t)throw new Error("The Map container must be provided.");const a=document.createElement("div");throw a.innerHTML=e,a.classList.add("webgl-warning-div"),t.appendChild(a),new Error(e)}function yE(n,e){return!(!Array.isArray(n)||n.length!==2||n[0]!=="get"||typeof n[1]!="string"||e&&!n[1].startsWith("name:")||!e&&n[1]!=="name")}function _F(n,e,t){const a=structuredClone(n),d=m=>{if(typeof m!="string")for(let g=0;g<m.length;g+=1)yE(m[g],t)?m[g]=structuredClone(e):d(m[g])};return yE(a,t)?e:(d(a),a)}function yF(n,e){const t=e?/\{name:\S+\}/:/\{name\}/;return{contains:t.test(n),exactMatch:new RegExp(`^${t.source}$`).test(n)}}function vF(n,e,t){const a=t?/\{name:\S+\}/:/\{name\}/,d=n.split(a);return["concat",...d.flatMap((m,g)=>g===d.length-1?[m]:[m,e])]}function bF(n){var e;const t=/\{name(?::(?<language>\S+))?\}/g,a=[];for(;;){const d=t.exec(n);if(!d)break;const m=((e=d.groups)==null?void 0:e.language)??null;a.push(m)}return a}function xF(n){return!Array.isArray(n)||n.length!==2||n[0]!=="get"||typeof n[1]!="string"?null:n[1].trim()==="name"?{isLanguage:!0,localization:null}:n[1].trim().startsWith("name:")?{isLanguage:!0,localization:n[1].trim().split(":").pop()}:null}function wF(n){const e=[],t=structuredClone(n),a=d=>{if(typeof d!="string")for(let m=0;m<d.length;m+=1){const g=xF(d[m]);g?e.push(g.localization):a(d[m])}};return a([t]),e}function TF(n,e){const t=[];for(const m of n){if(m.type!=="symbol")continue;const g=m,{id:c,layout:C}=g;if(!C||!("text-field"in C))continue;const R=e.getLayoutProperty(c,"text-field");if(R)if(typeof R=="string"){const V=bF(R);t.push(V)}else{const V=wF(R);t.push(V)}}const a=t.flat(),d={unlocalized:0,localized:{}};for(const m of a)m===null?d.unlocalized+=1:(m in d.localized||(d.localized[m]=0),d.localized[m]+=1);return d}(class extends wn.Marker{addTo(n){return super.addTo(n)}});class o8 extends wn.Popup{addTo(e){return super.addTo(e)}}class l8 extends wn.Style{constructor(e,t={}){super(e,t)}}class u8 extends wn.CanvasSource{onAdd(e){super.onAdd(e)}}class c8 extends wn.GeoJSONSource{onAdd(e){super.onAdd(e)}}class h8 extends wn.ImageSource{onAdd(e){super.onAdd(e)}}class d8 extends wn.RasterTileSource{onAdd(e){super.onAdd(e)}}class f8 extends wn.RasterDEMTileSource{onAdd(e){super.onAdd(e)}}class p8 extends wn.VectorTileSource{onAdd(e){super.onAdd(e)}}class m8 extends wn.VideoSource{onAdd(e){super.onAdd(e)}}class SF extends wn.NavigationControl{onAdd(e){return super.onAdd(e)}}class EF extends wn.GeolocateControl{onAdd(e){return super.onAdd(e)}}class g8 extends wn.AttributionControl{onAdd(e){return super.onAdd(e)}}class AF extends wn.LogoControl{onAdd(e){return super.onAdd(e)}}class CF extends wn.ScaleControl{onAdd(e){return super.onAdd(e)}}class IF extends wn.FullscreenControl{onAdd(e){return super.onAdd(e)}}class _8 extends wn.TerrainControl{onAdd(e){return super.onAdd(e)}}class y8 extends wn.BoxZoomHandler{constructor(e,t){super(e,t)}}class v8 extends wn.ScrollZoomHandler{constructor(e,t){super(e,t)}}class b8 extends wn.CooperativeGesturesHandler{constructor(e,t){super(e,t)}}class x8 extends wn.KeyboardHandler{constructor(e){super(e)}}class w8 extends wn.TwoFingersTouchPitchHandler{constructor(e){super(e)}}class T8 extends wn.MapWheelEvent{constructor(e,t,a){super(e,t,a)}}class S8 extends wn.MapTouchEvent{constructor(e,t,a){super(e,t,a)}}class E8 extends wn.MapMouseEvent{constructor(e,t,a,d={}){super(e,t,a,d)}}class vE extends AF{constructor(e={}){super(e),rn(this,"logoURL",""),rn(this,"linkURL",""),this.logoURL=e.logoURL??Gl.maptilerLogoURL,this.linkURL=e.linkURL??Gl.maptilerURL}onAdd(e){this._map=e,this._compact=this.options.compact??!1,this._container=window.document.createElement("div"),this._container.className="maplibregl-ctrl";const t=window.document.createElement("a");return t.style.backgroundRepeat="no-repeat",t.style.cursor="pointer",t.style.display="block",t.style.height="23px",t.style.margin="0 0 -4px -4px",t.style.overflow="hidden",t.style.width="88px",t.style.backgroundImage=`url(${this.logoURL})`,t.style.backgroundSize="100px 30px",t.style.width="100px",t.style.height="30px",t.target="_blank",t.rel="noopener",t.href=this.linkURL,t.setAttribute("aria-label","MapTiler logo"),t.setAttribute("rel","noopener"),this._container.appendChild(t),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}}var PF=8,MF={version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},RF={"*":{type:"source"}},kF=["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],LF={type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},DF={type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},zF={type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},OF={type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},NF={type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},BF={type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},FF={id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},VF=["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],UF={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},jF={"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},$F={"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},qF={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},GF={"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},HF={"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},ZF={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},WF={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},KF={type:"array",value:"*"},XF={type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},YF={type:"enum",values:{Point:{},LineString:{},Polygon:{}}},QF={type:"array",minimum:0,maximum:24,value:["number","color"],length:2},JF={type:"array",value:"*",minimum:1},eV={anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},tV={"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},nV={source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},iV={type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},rV=["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],aV={"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},sV={"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},oV={"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},lV={"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},uV={"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},cV={"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},hV={"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},dV={"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},fV={duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},pV={"*":{type:"string"}},mV={$version:PF,$root:MF,sources:RF,source:kF,source_vector:LF,source_raster:DF,source_raster_dem:zF,source_geojson:OF,source_video:NF,source_image:BF,layer:FF,layout:VF,layout_background:UF,layout_fill:jF,layout_circle:$F,layout_heatmap:qF,"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:GF,layout_symbol:HF,layout_raster:ZF,layout_hillshade:WF,"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:KF,filter_operator:XF,geometry_type:YF,function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:QF,expression:JF,light:eV,sky:tV,terrain:nV,projection:iV,paint:rV,paint_fill:aV,"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:sV,paint_circle:oV,paint_heatmap:lV,paint_symbol:uV,paint_raster:cV,paint_hillshade:hV,"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:dV,transition:fV,"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:pV};class Zt{constructor(e,t,a,d){this.message=(e?`${e}: `:"")+a,d&&(this.identifier=d),t!=null&&t.__line__&&(this.line=t.__line__)}}function ib(n,...e){for(const t of e)for(const a in t)n[a]=t[a];return n}class Gh extends Error{constructor(e,t){super(t),this.message=t,this.key=e}}class y2{constructor(e,t=[]){this.parent=e,this.bindings={};for(const[a,d]of t)this.bindings[a]=d}concat(e){return new y2(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return this.bindings[e]?!0:this.parent?this.parent.has(e):!1}}const Nb={kind:"null"},Qt={kind:"number"},vi={kind:"string"},di={kind:"boolean"},Qh={kind:"color"},Bb={kind:"projectionDefinition"},Gp={kind:"object"},ci={kind:"value"},gV={kind:"error"},Fb={kind:"collator"},Vb={kind:"formatted"},Ub={kind:"padding"},xy={kind:"colorArray"},jb={kind:"numberArray"},Zy={kind:"resolvedImage"},$b={kind:"variableAnchorOffsetCollection"};function Uu(n,e){return{kind:"array",itemType:n,N:e}}function Ta(n){if(n.kind==="array"){const e=Ta(n.itemType);return typeof n.N=="number"?`array<${e}, ${n.N}>`:n.itemType.kind==="value"?"array":`array<${e}>`}else return n.kind}const _V=[Nb,Qt,vi,di,Qh,Bb,Vb,Gp,Uu(ci),Ub,jb,xy,Zy,$b];function wy(n,e){if(e.kind==="error")return null;if(n.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!wy(n.itemType,e.itemType))&&(typeof n.N!="number"||n.N===e.N))return null}else{if(n.kind===e.kind)return null;if(n.kind==="value"){for(const t of _V)if(!wy(t,e))return null}}return`Expected ${Ta(n)} but found ${Ta(e)} instead.`}function v2(n,e){return e.some(t=>t.kind===n.kind)}function Hp(n,e){return e.some(t=>t==="null"?n===null:t==="array"?Array.isArray(n):t==="object"?n&&!Array.isArray(n)&&typeof n=="object":t===typeof n)}function Pf(n,e){return n.kind==="array"&&e.kind==="array"?n.itemType.kind===e.itemType.kind&&typeof n.N=="number":n.kind===e.kind}const iM=.96422,rM=1,aM=.82521,sM=4/29,mg=6/29,oM=3*mg*mg,yV=mg*mg*mg,vV=Math.PI/180,bV=180/Math.PI;function lM(n){return n=n%360,n<0&&(n+=360),n}function uM([n,e,t,a]){n=Vx(n),e=Vx(e),t=Vx(t);let d,m;const g=Ux((.2225045*n+.7168786*e+.0606169*t)/rM);n===e&&e===t?d=m=g:(d=Ux((.4360747*n+.3850649*e+.1430804*t)/iM),m=Ux((.0139322*n+.0971045*e+.7141733*t)/aM));const c=116*g-16;return[c<0?0:c,500*(d-g),200*(g-m),a]}function Vx(n){return n<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function Ux(n){return n>yV?Math.pow(n,1/3):n/oM+sM}function cM([n,e,t,a]){let d=(n+16)/116,m=isNaN(e)?d:d+e/500,g=isNaN(t)?d:d-t/200;return d=rM*$x(d),m=iM*$x(m),g=aM*$x(g),[jx(3.1338561*m-1.6168667*d-.4906146*g),jx(-.9787684*m+1.9161415*d+.033454*g),jx(.0719453*m-.2289914*d+1.4052427*g),a]}function jx(n){return n=n<=.00304?12.92*n:1.055*Math.pow(n,1/2.4)-.055,n<0?0:n>1?1:n}function $x(n){return n>mg?n*n*n:oM*(n-sM)}function xV(n){const[e,t,a,d]=uM(n),m=Math.sqrt(t*t+a*a);return[Math.round(m*1e4)?lM(Math.atan2(a,t)*bV):NaN,m,e,d]}function wV([n,e,t,a]){return n=isNaN(n)?0:n*vV,cM([t,Math.cos(n)*e,Math.sin(n)*e,a])}function TV([n,e,t,a]){n=lM(n),e/=100,t/=100;function d(m){const g=(m+n/30)%12,c=e*Math.min(t,1-t);return t-c*Math.max(-1,Math.min(g-3,9-g,1))}return[d(0),d(8),d(4),a]}const SV=Object.hasOwn||function(n,e){return Object.prototype.hasOwnProperty.call(n,e)};function sy(n,e){return SV(n,e)?n[e]:void 0}function EV(n){if(n=n.toLowerCase().trim(),n==="transparent")return[0,0,0,0];const e=sy(AV,n);if(e){const[d,m,g]=e;return[d/255,m/255,g/255,1]}if(n.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(n)){const d=n.length<6?1:2;let m=1;return[Jv(n.slice(m,m+=d)),Jv(n.slice(m,m+=d)),Jv(n.slice(m,m+=d)),Jv(n.slice(m,m+d)||"ff")]}if(n.startsWith("rgb")){const d=/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/,m=n.match(d);if(m){const[g,c,C,R,V,q,J,Y,xe,be,Oe,et]=m,Je=[R||" ",J||" ",be].join("");if(Je==="  "||Je==="  /"||Je===",,"||Je===",,,"){const qe=[C,q,xe].join(""),Ze=qe==="%%%"?100:qe===""?255:0;if(Ze){const je=[ng(+c/Ze,0,1),ng(+V/Ze,0,1),ng(+Y/Ze,0,1),Oe?bE(+Oe,et):1];if(xE(je))return je}}return}}const t=/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/,a=n.match(t);if(a){const[d,m,g,c,C,R,V,q,J]=a,Y=[g||" ",C||" ",V].join("");if(Y==="  "||Y==="  /"||Y===",,"||Y===",,,"){const xe=[+m,ng(+c,0,100),ng(+R,0,100),q?bE(+q,J):1];if(xE(xe))return TV(xe)}}}function Jv(n){return parseInt(n.padEnd(2,n),16)/255}function bE(n,e){return ng(e?n/100:n,0,1)}function ng(n,e,t){return Math.min(Math.max(e,n),t)}function xE(n){return!n.some(Number.isNaN)}const AV={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function Zp(n,e,t){return n+t*(e-n)}function Ty(n,e,t){return n.map((a,d)=>Zp(a,e[d],t))}class Ar{constructor(e,t,a,d=1,m=!0){this.r=e,this.g=t,this.b=a,this.a=d,m||(this.r*=d,this.g*=d,this.b*=d,d||this.overwriteGetter("rgb",[e,t,a,d]))}static parse(e){if(e instanceof Ar)return e;if(typeof e!="string")return;const t=EV(e);if(t)return new Ar(...t,!1)}get rgb(){const{r:e,g:t,b:a,a:d}=this,m=d||1/0;return this.overwriteGetter("rgb",[e/m,t/m,a/m,d])}get hcl(){return this.overwriteGetter("hcl",xV(this.rgb))}get lab(){return this.overwriteGetter("lab",uM(this.rgb))}overwriteGetter(e,t){return Object.defineProperty(this,e,{value:t}),t}toString(){const[e,t,a,d]=this.rgb;return`rgba(${[e,t,a].map(m=>Math.round(m*255)).join(",")},${d})`}static interpolate(e,t,a,d="rgb"){switch(d){case"rgb":{const[m,g,c,C]=Ty(e.rgb,t.rgb,a);return new Ar(m,g,c,C,!1)}case"hcl":{const[m,g,c,C]=e.hcl,[R,V,q,J]=t.hcl;let Y,xe;if(!isNaN(m)&&!isNaN(R)){let qe=R-m;R>m&&qe>180?qe-=360:R<m&&m-R>180&&(qe+=360),Y=m+a*qe}else isNaN(m)?isNaN(R)?Y=NaN:(Y=R,(c===1||c===0)&&(xe=V)):(Y=m,(q===1||q===0)&&(xe=g));const[be,Oe,et,Je]=wV([Y,xe??Zp(g,V,a),Zp(c,q,a),Zp(C,J,a)]);return new Ar(be,Oe,et,Je,!1)}case"lab":{const[m,g,c,C]=cM(Ty(e.lab,t.lab,a));return new Ar(m,g,c,C,!1)}}}}Ar.black=new Ar(0,0,0,1);Ar.white=new Ar(1,1,1,1);Ar.transparent=new Ar(0,0,0,0);Ar.red=new Ar(1,0,0,1);class b2{constructor(e,t,a){e?this.sensitivity=t?"variant":"case":this.sensitivity=t?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,t){return this.collator.compare(e,t)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const CV=["bottom","center","top"];class q1{constructor(e,t,a,d,m,g){this.text=e,this.image=t,this.scale=a,this.fontStack=d,this.textColor=m,this.verticalAlign=g}}class jd{constructor(e){this.sections=e}static fromString(e){return new jd([new q1(e,null,null,null,null,null)])}isEmpty(){return this.sections.length===0?!0:!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof jd?e:jd.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}}class ch{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof ch)return e;if(typeof e=="number")return new ch([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const t of e)if(typeof t!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]];break}return new ch(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,t,a){return new ch(Ty(e.values,t.values,a))}}class hh{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof hh)return e;if(typeof e=="number")return new hh([e]);if(Array.isArray(e)){for(const t of e)if(typeof t!="number")return;return new hh(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,t,a){return new hh(Ty(e.values,t.values,a))}}class ju{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof ju)return e;if(typeof e=="string"){const a=Ar.parse(e);return a?new ju([a]):void 0}if(!Array.isArray(e))return;const t=[];for(const a of e){if(typeof a!="string")return;const d=Ar.parse(a);if(!d)return;t.push(d)}return new ju(t)}toString(){return JSON.stringify(this.values)}static interpolate(e,t,a,d="rgb"){const m=[];if(e.values.length!=t.values.length)throw new Error(`colorArray: Arrays have mismatched length (${e.values.length} vs. ${t.values.length}), cannot interpolate.`);for(let g=0;g<e.values.length;g++)m.push(Ar.interpolate(e.values[g],t.values[g],a,d));return new ju(m)}}class Ba extends Error{constructor(e){super(e),this.name="RuntimeError"}toJSON(){return this.message}}const IV=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Jh{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Jh)return e;if(!(!Array.isArray(e)||e.length<1||e.length%2!==0)){for(let t=0;t<e.length;t+=2){const a=e[t],d=e[t+1];if(typeof a!="string"||!IV.has(a)||!Array.isArray(d)||d.length!==2||typeof d[0]!="number"||typeof d[1]!="number")return}return new Jh(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,t,a){const d=e.values,m=t.values;if(d.length!==m.length)throw new Ba(`Cannot interpolate values of different length. from: ${e.toString()}, to: ${t.toString()}`);const g=[];for(let c=0;c<d.length;c+=2){if(d[c]!==m[c])throw new Ba(`Cannot interpolate values containing mismatched anchors. from[${c}]: ${d[c]}, to[${c}]: ${m[c]}`);g.push(d[c]);const[C,R]=d[c+1],[V,q]=m[c+1];g.push([Zp(C,V,a),Zp(R,q,a)])}return new Jh(g)}}class Qf{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Qf({name:e,available:!1}):null}}class sh{constructor(e,t,a){this.from=e,this.to=t,this.transition=a}static interpolate(e,t,a){return new sh(e,t,a)}static parse(e){if(e instanceof sh)return e;if(Array.isArray(e)&&e.length===3&&typeof e[0]=="string"&&typeof e[1]=="string"&&typeof e[2]=="number")return new sh(e[0],e[1],e[2]);if(typeof e=="object"&&typeof e.from=="string"&&typeof e.to=="string"&&typeof e.transition=="number")return new sh(e.from,e.to,e.transition);if(typeof e=="string")return new sh(e,e,1)}}function hM(n,e,t,a){return typeof n=="number"&&n>=0&&n<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof t=="number"&&t>=0&&t<=255?typeof a>"u"||typeof a=="number"&&a>=0&&a<=1?null:`Invalid rgba value [${[n,e,t,a].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof a=="number"?[n,e,t,a]:[n,e,t]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Sy(n){if(n===null||typeof n=="string"||typeof n=="boolean"||typeof n=="number"||n instanceof sh||n instanceof Ar||n instanceof b2||n instanceof jd||n instanceof ch||n instanceof hh||n instanceof ju||n instanceof Jh||n instanceof Qf)return!0;if(Array.isArray(n)){for(const e of n)if(!Sy(e))return!1;return!0}else if(typeof n=="object"){for(const e in n)if(!Sy(n[e]))return!1;return!0}else return!1}function Ns(n){if(n===null)return Nb;if(typeof n=="string")return vi;if(typeof n=="boolean")return di;if(typeof n=="number")return Qt;if(n instanceof Ar)return Qh;if(n instanceof sh)return Bb;if(n instanceof b2)return Fb;if(n instanceof jd)return Vb;if(n instanceof ch)return Ub;if(n instanceof hh)return jb;if(n instanceof ju)return xy;if(n instanceof Jh)return $b;if(n instanceof Qf)return Zy;if(Array.isArray(n)){const e=n.length;let t;for(const a of n){const d=Ns(a);if(!t)t=d;else{if(t===d)continue;t=ci;break}}return Uu(t||ci,e)}else return Gp}function oy(n){const e=typeof n;return n===null?"":e==="string"||e==="number"||e==="boolean"?String(n):n instanceof Ar||n instanceof sh||n instanceof jd||n instanceof ch||n instanceof hh||n instanceof ju||n instanceof Jh||n instanceof Qf?n.toString():JSON.stringify(n)}class Tg{constructor(e,t){this.type=e,this.value=t}static parse(e,t){if(e.length!==2)return t.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Sy(e[1]))return t.error("invalid value");const a=e[1];let d=Ns(a);const m=t.expectedType;return d.kind==="array"&&d.N===0&&m&&m.kind==="array"&&(typeof m.N!="number"||m.N===0)&&(d=m),new Tg(d,a)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const e0={string:vi,number:Qt,boolean:di,object:Gp};class oh{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");let a=1,d;const m=e[0];if(m==="array"){let c;if(e.length>2){const R=e[1];if(typeof R!="string"||!(R in e0)||R==="object")return t.error('The item type argument of "array" must be one of string, number, boolean',1);c=e0[R],a++}else c=ci;let C;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return t.error('The length argument to "array" must be a positive integer literal',2);C=e[2],a++}d=Uu(c,C)}else{if(!e0[m])throw new Error(`Types doesn't contain name = ${m}`);d=e0[m]}const g=[];for(;a<e.length;a++){const c=t.parse(e[a],a,ci);if(!c)return null;g.push(c)}return new oh(d,g)}evaluate(e){for(let t=0;t<this.args.length;t++){const a=this.args[t].evaluate(e);if(wy(this.type,Ns(a))){if(t===this.args.length-1)throw new Ba(`Expected value to be of type ${Ta(this.type)}, but found ${Ta(Ns(a))} instead.`)}else return a}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const wE={"to-boolean":di,"to-color":Qh,"to-number":Qt,"to-string":vi};class Of{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const a=e[0];if(!wE[a])throw new Error(`Can't parse ${a} as it is not part of the known types`);if((a==="to-boolean"||a==="to-string")&&e.length!==2)return t.error("Expected one argument.");const d=wE[a],m=[];for(let g=1;g<e.length;g++){const c=t.parse(e[g],g,ci);if(!c)return null;m.push(c)}return new Of(d,m)}evaluate(e){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(e);case"color":{let t,a;for(const d of this.args){if(t=d.evaluate(e),a=null,t instanceof Ar)return t;if(typeof t=="string"){const m=e.parseColor(t);if(m)return m}else if(Array.isArray(t)&&(t.length<3||t.length>4?a=`Invalid rgba value ${JSON.stringify(t)}: expected an array containing either three or four numeric values.`:a=hM(t[0],t[1],t[2],t[3]),!a))return new Ar(t[0]/255,t[1]/255,t[2]/255,t[3])}throw new Ba(a||`Could not parse color from value '${typeof t=="string"?t:JSON.stringify(t)}'`)}case"padding":{let t;for(const a of this.args){t=a.evaluate(e);const d=ch.parse(t);if(d)return d}throw new Ba(`Could not parse padding from value '${typeof t=="string"?t:JSON.stringify(t)}'`)}case"numberArray":{let t;for(const a of this.args){t=a.evaluate(e);const d=hh.parse(t);if(d)return d}throw new Ba(`Could not parse numberArray from value '${typeof t=="string"?t:JSON.stringify(t)}'`)}case"colorArray":{let t;for(const a of this.args){t=a.evaluate(e);const d=ju.parse(t);if(d)return d}throw new Ba(`Could not parse colorArray from value '${typeof t=="string"?t:JSON.stringify(t)}'`)}case"variableAnchorOffsetCollection":{let t;for(const a of this.args){t=a.evaluate(e);const d=Jh.parse(t);if(d)return d}throw new Ba(`Could not parse variableAnchorOffsetCollection from value '${typeof t=="string"?t:JSON.stringify(t)}'`)}case"number":{let t=null;for(const a of this.args){if(t=a.evaluate(e),t===null)return 0;const d=Number(t);if(!isNaN(d))return d}throw new Ba(`Could not convert ${JSON.stringify(t)} to number.`)}case"formatted":return jd.fromString(oy(this.args[0].evaluate(e)));case"resolvedImage":return Qf.fromString(oy(this.args[0].evaluate(e)));case"projectionDefinition":return this.args[0].evaluate(e);default:return oy(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const PV=["Unknown","Point","LineString","Polygon"];class dM{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?PV[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let t=this._parseColorCache.get(e);return t||(t=Ar.parse(e),this._parseColorCache.set(e,t)),t}}class qb{constructor(e,t,a=[],d,m=new y2,g=[]){this.registry=e,this.path=a,this.key=a.map(c=>`[${c}]`).join(""),this.scope=m,this.errors=g,this.expectedType=d,this._isConstant=t}parse(e,t,a,d,m={}){return t?this.concat(t,a,d)._parse(e,m):this._parse(e,m)}_parse(e,t){(e===null||typeof e=="string"||typeof e=="boolean"||typeof e=="number")&&(e=["literal",e]);function a(d,m,g){return g==="assert"?new oh(m,[d]):g==="coerce"?new Of(m,[d]):d}if(Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const d=e[0];if(typeof d!="string")return this.error(`Expression name must be a string, but found ${typeof d} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const m=this.registry[d];if(m){let g=m.parse(e,this);if(!g)return null;if(this.expectedType){const c=this.expectedType,C=g.type;if((c.kind==="string"||c.kind==="number"||c.kind==="boolean"||c.kind==="object"||c.kind==="array")&&C.kind==="value")g=a(g,c,t.typeAnnotation||"assert");else if(c.kind==="projectionDefinition"&&["string","array"].includes(C.kind)||["color","formatted","resolvedImage"].includes(c.kind)&&["value","string"].includes(C.kind)||["padding","numberArray"].includes(c.kind)&&["value","number","array"].includes(C.kind)||c.kind==="colorArray"&&["value","string","array"].includes(C.kind)||c.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(C.kind))g=a(g,c,t.typeAnnotation||"coerce");else if(this.checkSubtype(c,C))return null}if(!(g instanceof Tg)&&g.type.kind!=="resolvedImage"&&this._isConstant(g)){const c=new dM;try{g=new Tg(g.type,g.evaluate(c))}catch(C){return this.error(C.message),null}}return g}return this.error(`Unknown expression "${d}". If you wanted a literal array, use ["literal", [...]].`,0)}else return typeof e>"u"?this.error("'undefined' value invalid. Use null instead."):typeof e=="object"?this.error('Bare objects invalid. Use ["literal", {...}] instead.'):this.error(`Expected an array, but found ${typeof e} instead.`)}concat(e,t,a){const d=typeof e=="number"?this.path.concat(e):this.path,m=a?this.scope.concat(a):this.scope;return new qb(this.registry,this._isConstant,d,t||null,m,this.errors)}error(e,...t){const a=`${this.key}${t.map(d=>`[${d}]`).join("")}`;this.errors.push(new Gh(a,e))}checkSubtype(e,t){const a=wy(e,t);return a&&this.error(a),a}}class Gb{constructor(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const t of this.bindings)e(t[1]);e(this.result)}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const a=[];for(let m=1;m<e.length-1;m+=2){const g=e[m];if(typeof g!="string")return t.error(`Expected string, but found ${typeof g} instead.`,m);if(/[^a-zA-Z0-9_]/.test(g))return t.error("Variable names must contain only alphanumeric characters or '_'.",m);const c=t.parse(e[m+1],m+1);if(!c)return null;a.push([g,c])}const d=t.parse(e[e.length-1],e.length-1,t.expectedType,a);return d?new Gb(a,d):null}outputDefined(){return this.result.outputDefined()}}class Hb{constructor(e,t){this.type=t.type,this.name=e,this.boundExpression=t}static parse(e,t){if(e.length!==2||typeof e[1]!="string")return t.error("'var' expression requires exactly one string literal argument.");const a=e[1];return t.scope.has(a)?new Hb(a,t.scope.get(a)):t.error(`Unknown variable "${a}". Make sure "${a}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class x2{constructor(e,t,a){this.type=e,this.index=t,this.input=a}static parse(e,t){if(e.length!==3)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=t.parse(e[1],1,Qt),d=t.parse(e[2],2,Uu(t.expectedType||ci));if(!a||!d)return null;const m=d.type;return new x2(m.itemType,a,d)}evaluate(e){const t=this.index.evaluate(e),a=this.input.evaluate(e);if(t<0)throw new Ba(`Array index out of bounds: ${t} < 0.`);if(t>=a.length)throw new Ba(`Array index out of bounds: ${t} > ${a.length-1}.`);if(t!==Math.floor(t))throw new Ba(`Array index must be an integer, but found ${t} instead.`);return a[t]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class w2{constructor(e,t){this.type=di,this.needle=e,this.haystack=t}static parse(e,t){if(e.length!==3)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=t.parse(e[1],1,ci),d=t.parse(e[2],2,ci);return!a||!d?null:v2(a.type,[di,vi,Qt,Nb,ci])?new w2(a,d):t.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ta(a.type)} instead`)}evaluate(e){const t=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(!a)return!1;if(!Hp(t,["boolean","string","number","null"]))throw new Ba(`Expected first argument to be of type boolean, string, number or null, but found ${Ta(Ns(t))} instead.`);if(!Hp(a,["string","array"]))throw new Ba(`Expected second argument to be of type array or string, but found ${Ta(Ns(a))} instead.`);return a.indexOf(t)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class rb{constructor(e,t,a){this.type=Qt,this.needle=e,this.haystack=t,this.fromIndex=a}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=t.parse(e[1],1,ci),d=t.parse(e[2],2,ci);if(!a||!d)return null;if(!v2(a.type,[di,vi,Qt,Nb,ci]))return t.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ta(a.type)} instead`);if(e.length===4){const m=t.parse(e[3],3,Qt);return m?new rb(a,d,m):null}else return new rb(a,d)}evaluate(e){const t=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(!Hp(t,["boolean","string","number","null"]))throw new Ba(`Expected first argument to be of type boolean, string, number or null, but found ${Ta(Ns(t))} instead.`);let d;if(this.fromIndex&&(d=this.fromIndex.evaluate(e)),Hp(a,["string"])){const m=a.indexOf(t,d);return m===-1?-1:[...a.slice(0,m)].length}else{if(Hp(a,["array"]))return a.indexOf(t,d);throw new Ba(`Expected second argument to be of type array or string, but found ${Ta(Ns(a))} instead.`)}}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class T2{constructor(e,t,a,d,m,g){this.inputType=e,this.type=t,this.input=a,this.cases=d,this.outputs=m,this.otherwise=g}static parse(e,t){if(e.length<5)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!==1)return t.error("Expected an even number of arguments.");let a,d;t.expectedType&&t.expectedType.kind!=="value"&&(d=t.expectedType);const m={},g=[];for(let R=2;R<e.length-1;R+=2){let V=e[R];const q=e[R+1];Array.isArray(V)||(V=[V]);const J=t.concat(R);if(V.length===0)return J.error("Expected at least one branch label.");for(const xe of V){if(typeof xe!="number"&&typeof xe!="string")return J.error("Branch labels must be numbers or strings.");if(typeof xe=="number"&&Math.abs(xe)>Number.MAX_SAFE_INTEGER)return J.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof xe=="number"&&Math.floor(xe)!==xe)return J.error("Numeric branch labels must be integer values.");if(!a)a=Ns(xe);else if(J.checkSubtype(a,Ns(xe)))return null;if(typeof m[String(xe)]<"u")return J.error("Branch labels must be unique.");m[String(xe)]=g.length}const Y=t.parse(q,R,d);if(!Y)return null;d=d||Y.type,g.push(Y)}const c=t.parse(e[1],1,ci);if(!c)return null;const C=t.parse(e[e.length-1],e.length-1,d);return!C||c.type.kind!=="value"&&t.concat(1).checkSubtype(a,c.type)?null:new T2(a,d,c,m,g,C)}evaluate(e){const t=this.input.evaluate(e);return(Ns(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}}class S2{constructor(e,t,a){this.type=e,this.branches=t,this.otherwise=a}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!==0)return t.error("Expected an odd number of arguments.");let a;t.expectedType&&t.expectedType.kind!=="value"&&(a=t.expectedType);const d=[];for(let g=1;g<e.length-1;g+=2){const c=t.parse(e[g],g,di);if(!c)return null;const C=t.parse(e[g+1],g+1,a);if(!C)return null;d.push([c,C]),a=a||C.type}const m=t.parse(e[e.length-1],e.length-1,a);if(!m)return null;if(!a)throw new Error("Can't infer output type");return new S2(a,d,m)}evaluate(e){for(const[t,a]of this.branches)if(t.evaluate(e))return a.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[t,a]of this.branches)e(t),e(a);e(this.otherwise)}outputDefined(){return this.branches.every(([e,t])=>t.outputDefined())&&this.otherwise.outputDefined()}}class ab{constructor(e,t,a,d){this.type=e,this.input=t,this.beginIndex=a,this.endIndex=d}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=t.parse(e[1],1,ci),d=t.parse(e[2],2,Qt);if(!a||!d)return null;if(!v2(a.type,[Uu(ci),vi,ci]))return t.error(`Expected first argument to be of type array or string, but found ${Ta(a.type)} instead`);if(e.length===4){const m=t.parse(e[3],3,Qt);return m?new ab(a.type,a,d,m):null}else return new ab(a.type,a,d)}evaluate(e){const t=this.input.evaluate(e),a=this.beginIndex.evaluate(e);let d;if(this.endIndex&&(d=this.endIndex.evaluate(e)),Hp(t,["string"]))return[...t].slice(a,d).join("");if(Hp(t,["array"]))return t.slice(a,d);throw new Ba(`Expected first argument to be of type array or string, but found ${Ta(Ns(t))} instead.`)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function fM(n,e){const t=n.length-1;let a=0,d=t,m=0,g,c;for(;a<=d;)if(m=Math.floor((a+d)/2),g=n[m],c=n[m+1],g<=e){if(m===t||e<c)return m;a=m+1}else if(g>e)d=m-1;else throw new Ba("Input is not a number.");return 0}class Zb{constructor(e,t,a){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(const[d,m]of a)this.labels.push(d),this.outputs.push(m)}static parse(e,t){if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!==0)return t.error("Expected an even number of arguments.");const a=t.parse(e[1],1,Qt);if(!a)return null;const d=[];let m=null;t.expectedType&&t.expectedType.kind!=="value"&&(m=t.expectedType);for(let g=1;g<e.length;g+=2){const c=g===1?-1/0:e[g],C=e[g+1],R=g,V=g+1;if(typeof c!="number")return t.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',R);if(d.length&&d[d.length-1][0]>=c)return t.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',R);const q=t.parse(C,V,m);if(!q)return null;m=m||q.type,d.push([c,q])}return new Zb(m,a,d)}evaluate(e){const t=this.labels,a=this.outputs;if(t.length===1)return a[0].evaluate(e);const d=this.input.evaluate(e);if(d<=t[0])return a[0].evaluate(e);const m=t.length;if(d>=t[m-1])return a[m-1].evaluate(e);const g=fM(t,d);return a[g].evaluate(e)}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function MV(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var qx,TE;function RV(){if(TE)return qx;TE=1,qx=n;function n(e,t,a,d){this.cx=3*e,this.bx=3*(a-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(d-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=t,this.p2x=a,this.p2y=d}return n.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,t){if(t===void 0&&(t=1e-6),e<0)return 0;if(e>1)return 1;for(var a=e,d=0;d<8;d++){var m=this.sampleCurveX(a)-e;if(Math.abs(m)<t)return a;var g=this.sampleCurveDerivativeX(a);if(Math.abs(g)<1e-6)break;a=a-m/g}var c=0,C=1;for(a=e,d=0;d<20&&(m=this.sampleCurveX(a),!(Math.abs(m-e)<t));d++)e>m?c=a:C=a,a=(C-c)*.5+c;return a},solve:function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))}},qx}var kV=RV(),LV=MV(kV);class ed{constructor(e,t,a,d,m){this.type=e,this.operator=t,this.interpolation=a,this.input=d,this.labels=[],this.outputs=[];for(const[g,c]of m)this.labels.push(g),this.outputs.push(c)}static interpolationFactor(e,t,a,d){let m=0;if(e.name==="exponential")m=Gx(t,e.base,a,d);else if(e.name==="linear")m=Gx(t,1,a,d);else if(e.name==="cubic-bezier"){const g=e.controlPoints;m=new LV(g[0],g[1],g[2],g[3]).solve(Gx(t,1,a,d))}return m}static parse(e,t){let[a,d,m,...g]=e;if(!Array.isArray(d)||d.length===0)return t.error("Expected an interpolation type expression.",1);if(d[0]==="linear")d={name:"linear"};else if(d[0]==="exponential"){const R=d[1];if(typeof R!="number")return t.error("Exponential interpolation requires a numeric base.",1,1);d={name:"exponential",base:R}}else if(d[0]==="cubic-bezier"){const R=d.slice(1);if(R.length!==4||R.some(V=>typeof V!="number"||V<0||V>1))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);d={name:"cubic-bezier",controlPoints:R}}else return t.error(`Unknown interpolation type ${String(d[0])}`,1,0);if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!==0)return t.error("Expected an even number of arguments.");if(m=t.parse(m,2,Qt),!m)return null;const c=[];let C=null;(a==="interpolate-hcl"||a==="interpolate-lab")&&t.expectedType!=xy?C=Qh:t.expectedType&&t.expectedType.kind!=="value"&&(C=t.expectedType);for(let R=0;R<g.length;R+=2){const V=g[R],q=g[R+1],J=R+3,Y=R+4;if(typeof V!="number")return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',J);if(c.length&&c[c.length-1][0]>=V)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',J);const xe=t.parse(q,Y,C);if(!xe)return null;C=C||xe.type,c.push([V,xe])}return!Pf(C,Qt)&&!Pf(C,Bb)&&!Pf(C,Qh)&&!Pf(C,Ub)&&!Pf(C,jb)&&!Pf(C,xy)&&!Pf(C,$b)&&!Pf(C,Uu(Qt))?t.error(`Type ${Ta(C)} is not interpolatable.`):new ed(C,a,d,m,c)}evaluate(e){const t=this.labels,a=this.outputs;if(t.length===1)return a[0].evaluate(e);const d=this.input.evaluate(e);if(d<=t[0])return a[0].evaluate(e);const m=t.length;if(d>=t[m-1])return a[m-1].evaluate(e);const g=fM(t,d),c=t[g],C=t[g+1],R=ed.interpolationFactor(this.interpolation,d,c,C),V=a[g].evaluate(e),q=a[g+1].evaluate(e);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return Zp(V,q,R);case"color":return Ar.interpolate(V,q,R);case"padding":return ch.interpolate(V,q,R);case"colorArray":return ju.interpolate(V,q,R);case"numberArray":return hh.interpolate(V,q,R);case"variableAnchorOffsetCollection":return Jh.interpolate(V,q,R);case"array":return Ty(V,q,R);case"projectionDefinition":return sh.interpolate(V,q,R)}case"interpolate-hcl":switch(this.type.kind){case"color":return Ar.interpolate(V,q,R,"hcl");case"colorArray":return ju.interpolate(V,q,R,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return Ar.interpolate(V,q,R,"lab");case"colorArray":return ju.interpolate(V,q,R,"lab")}}}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function Gx(n,e,t,a){const d=a-t,m=n-t;return d===0?0:e===1?m/d:(Math.pow(e,m)-1)/(Math.pow(e,d)-1)}class Ey{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");let a=null;const d=t.expectedType;d&&d.kind!=="value"&&(a=d);const m=[];for(const g of e.slice(1)){const c=t.parse(g,1+m.length,a,void 0,{typeAnnotation:"omit"});if(!c)return null;a=a||c.type,m.push(c)}if(!a)throw new Error("No output type");return d&&m.some(g=>wy(d,g.type))?new Ey(ci,m):new Ey(a,m)}evaluate(e){let t=null,a=0,d;for(const m of this.args)if(a++,t=m.evaluate(e),t&&t instanceof Qf&&!t.available&&(d||(d=t.name),t=null,a===this.args.length&&(t=d)),t!==null)break;return t}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}function SE(n,e){return n==="=="||n==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function DV(n,e,t){return e===t}function zV(n,e,t){return e!==t}function OV(n,e,t){return e<t}function NV(n,e,t){return e>t}function BV(n,e,t){return e<=t}function FV(n,e,t){return e>=t}function pM(n,e,t,a){return a.compare(e,t)===0}function VV(n,e,t,a){return!pM(n,e,t,a)}function UV(n,e,t,a){return a.compare(e,t)<0}function jV(n,e,t,a){return a.compare(e,t)>0}function $V(n,e,t,a){return a.compare(e,t)<=0}function qV(n,e,t,a){return a.compare(e,t)>=0}function Og(n,e,t){const a=n!=="=="&&n!=="!=";return class mM{constructor(m,g,c){this.type=di,this.lhs=m,this.rhs=g,this.collator=c,this.hasUntypedArgument=m.type.kind==="value"||g.type.kind==="value"}static parse(m,g){if(m.length!==3&&m.length!==4)return g.error("Expected two or three arguments.");const c=m[0];let C=g.parse(m[1],1,ci);if(!C)return null;if(!SE(c,C.type))return g.concat(1).error(`"${c}" comparisons are not supported for type '${Ta(C.type)}'.`);let R=g.parse(m[2],2,ci);if(!R)return null;if(!SE(c,R.type))return g.concat(2).error(`"${c}" comparisons are not supported for type '${Ta(R.type)}'.`);if(C.type.kind!==R.type.kind&&C.type.kind!=="value"&&R.type.kind!=="value")return g.error(`Cannot compare types '${Ta(C.type)}' and '${Ta(R.type)}'.`);a&&(C.type.kind==="value"&&R.type.kind!=="value"?C=new oh(R.type,[C]):C.type.kind!=="value"&&R.type.kind==="value"&&(R=new oh(C.type,[R])));let V=null;if(m.length===4){if(C.type.kind!=="string"&&R.type.kind!=="string"&&C.type.kind!=="value"&&R.type.kind!=="value")return g.error("Cannot use collator to compare non-string types.");if(V=g.parse(m[3],3,Fb),!V)return null}return new mM(C,R,V)}evaluate(m){const g=this.lhs.evaluate(m),c=this.rhs.evaluate(m);if(a&&this.hasUntypedArgument){const C=Ns(g),R=Ns(c);if(C.kind!==R.kind||!(C.kind==="string"||C.kind==="number"))throw new Ba(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${C.kind}, ${R.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){const C=Ns(g),R=Ns(c);if(C.kind!=="string"||R.kind!=="string")return e(m,g,c)}return this.collator?t(m,g,c,this.collator.evaluate(m)):e(m,g,c)}eachChild(m){m(this.lhs),m(this.rhs),this.collator&&m(this.collator)}outputDefined(){return!0}}}const GV=Og("==",DV,pM),HV=Og("!=",zV,VV),ZV=Og("<",OV,UV),WV=Og(">",NV,jV),KV=Og("<=",BV,$V),XV=Og(">=",FV,qV);class Wb{constructor(e,t,a){this.type=Fb,this.locale=a,this.caseSensitive=e,this.diacriticSensitive=t}static parse(e,t){if(e.length!==2)return t.error("Expected one argument.");const a=e[1];if(typeof a!="object"||Array.isArray(a))return t.error("Collator options argument must be an object.");const d=t.parse(a["case-sensitive"]===void 0?!1:a["case-sensitive"],1,di);if(!d)return null;const m=t.parse(a["diacritic-sensitive"]===void 0?!1:a["diacritic-sensitive"],1,di);if(!m)return null;let g=null;return a.locale&&(g=t.parse(a.locale,1,vi),!g)?null:new Wb(d,m,g)}evaluate(e){return new b2(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}class E2{constructor(e,t,a,d,m){this.type=vi,this.number=e,this.locale=t,this.currency=a,this.minFractionDigits=d,this.maxFractionDigits=m}static parse(e,t){if(e.length!==3)return t.error("Expected two arguments.");const a=t.parse(e[1],1,Qt);if(!a)return null;const d=e[2];if(typeof d!="object"||Array.isArray(d))return t.error("NumberFormat options argument must be an object.");let m=null;if(d.locale&&(m=t.parse(d.locale,1,vi),!m))return null;let g=null;if(d.currency&&(g=t.parse(d.currency,1,vi),!g))return null;let c=null;if(d["min-fraction-digits"]&&(c=t.parse(d["min-fraction-digits"],1,Qt),!c))return null;let C=null;return d["max-fraction-digits"]&&(C=t.parse(d["max-fraction-digits"],1,Qt),!C)?null:new E2(a,m,g,c,C)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class A2{constructor(e){this.type=Vb,this.sections=e}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const a=e[1];if(!Array.isArray(a)&&typeof a=="object")return t.error("First argument must be an image or text section.");const d=[];let m=!1;for(let g=1;g<=e.length-1;++g){const c=e[g];if(m&&typeof c=="object"&&!Array.isArray(c)){m=!1;let C=null;if(c["font-scale"]&&(C=t.parse(c["font-scale"],1,Qt),!C))return null;let R=null;if(c["text-font"]&&(R=t.parse(c["text-font"],1,Uu(vi)),!R))return null;let V=null;if(c["text-color"]&&(V=t.parse(c["text-color"],1,Qh),!V))return null;let q=null;if(c["vertical-align"]){if(typeof c["vertical-align"]=="string"&&!CV.includes(c["vertical-align"]))return t.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${c["vertical-align"]}' instead.`);if(q=t.parse(c["vertical-align"],1,vi),!q)return null}const J=d[d.length-1];J.scale=C,J.font=R,J.textColor=V,J.verticalAlign=q}else{const C=t.parse(e[g],1,ci);if(!C)return null;const R=C.type.kind;if(R!=="string"&&R!=="value"&&R!=="null"&&R!=="resolvedImage")return t.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");m=!0,d.push({content:C,scale:null,font:null,textColor:null,verticalAlign:null})}}return new A2(d)}evaluate(e){const t=a=>{const d=a.content.evaluate(e);return Ns(d)===Zy?new q1("",d,null,null,null,a.verticalAlign?a.verticalAlign.evaluate(e):null):new q1(oy(d),null,a.scale?a.scale.evaluate(e):null,a.font?a.font.evaluate(e).join(","):null,a.textColor?a.textColor.evaluate(e):null,a.verticalAlign?a.verticalAlign.evaluate(e):null)};return new jd(this.sections.map(t))}eachChild(e){for(const t of this.sections)e(t.content),t.scale&&e(t.scale),t.font&&e(t.font),t.textColor&&e(t.textColor),t.verticalAlign&&e(t.verticalAlign)}outputDefined(){return!1}}class C2{constructor(e){this.type=Zy,this.input=e}static parse(e,t){if(e.length!==2)return t.error("Expected two arguments.");const a=t.parse(e[1],1,vi);return a?new C2(a):t.error("No image name provided.")}evaluate(e){const t=this.input.evaluate(e),a=Qf.fromString(t);return a&&e.availableImages&&(a.available=e.availableImages.indexOf(t)>-1),a}eachChild(e){e(this.input)}outputDefined(){return!1}}class I2{constructor(e){this.type=Qt,this.input=e}static parse(e,t){if(e.length!==2)return t.error(`Expected 1 argument, but found ${e.length-1} instead.`);const a=t.parse(e[1],1);return a?a.type.kind!=="array"&&a.type.kind!=="string"&&a.type.kind!=="value"?t.error(`Expected argument of type string or array, but found ${Ta(a.type)} instead.`):new I2(a):null}evaluate(e){const t=this.input.evaluate(e);if(typeof t=="string")return[...t].length;if(Array.isArray(t))return t.length;throw new Ba(`Expected value to be of type string or array, but found ${Ta(Ns(t))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const td=8192;function YV(n,e){const t=QV(n[0]),a=eU(n[1]),d=Math.pow(2,e.z);return[Math.round(t*d*td),Math.round(a*d*td)]}function P2(n,e){const t=Math.pow(2,e.z),a=(n[0]/td+e.x)/t,d=(n[1]/td+e.y)/t;return[JV(a),tU(d)]}function QV(n){return(180+n)/360}function JV(n){return n*360-180}function eU(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function tU(n){return 360/Math.PI*Math.atan(Math.exp((180-n*360)*Math.PI/180))-90}function Wy(n,e){n[0]=Math.min(n[0],e[0]),n[1]=Math.min(n[1],e[1]),n[2]=Math.max(n[2],e[0]),n[3]=Math.max(n[3],e[1])}function Ay(n,e){return!(n[0]<=e[0]||n[2]>=e[2]||n[1]<=e[1]||n[3]>=e[3])}function nU(n,e,t){return e[1]>n[1]!=t[1]>n[1]&&n[0]<(t[0]-e[0])*(n[1]-e[1])/(t[1]-e[1])+e[0]}function iU(n,e,t){const a=n[0]-e[0],d=n[1]-e[1],m=n[0]-t[0],g=n[1]-t[1];return a*g-m*d===0&&a*m<=0&&d*g<=0}function Kb(n,e,t,a){const d=[e[0]-n[0],e[1]-n[1]],m=[a[0]-t[0],a[1]-t[1]];return oU(m,d)===0?!1:!!(EE(n,e,t,a)&&EE(t,a,n,e))}function rU(n,e,t){for(const a of t)for(let d=0;d<a.length-1;++d)if(Kb(n,e,a[d],a[d+1]))return!0;return!1}function Ng(n,e,t=!1){let a=!1;for(const d of e)for(let m=0;m<d.length-1;m++){if(iU(n,d[m],d[m+1]))return t;nU(n,d[m],d[m+1])&&(a=!a)}return a}function aU(n,e){for(const t of e)if(Ng(n,t))return!0;return!1}function gM(n,e){for(const t of n)if(!Ng(t,e))return!1;for(let t=0;t<n.length-1;++t)if(rU(n[t],n[t+1],e))return!1;return!0}function sU(n,e){for(const t of e)if(gM(n,t))return!0;return!1}function oU(n,e){return n[0]*e[1]-n[1]*e[0]}function EE(n,e,t,a){const d=n[0]-t[0],m=n[1]-t[1],g=e[0]-t[0],c=e[1]-t[1],C=a[0]-t[0],R=a[1]-t[1],V=d*R-C*m,q=g*R-C*c;return V>0&&q<0||V<0&&q>0}function M2(n,e,t){const a=[];for(let d=0;d<n.length;d++){const m=[];for(let g=0;g<n[d].length;g++){const c=YV(n[d][g],t);Wy(e,c),m.push(c)}a.push(m)}return a}function _M(n,e,t){const a=[];for(let d=0;d<n.length;d++){const m=M2(n[d],e,t);a.push(m)}return a}function yM(n,e,t,a){if(n[0]<t[0]||n[0]>t[2]){const d=a*.5;let m=n[0]-t[0]>d?-a:t[0]-n[0]>d?a:0;m===0&&(m=n[0]-t[2]>d?-a:t[2]-n[0]>d?a:0),n[0]+=m}Wy(e,n)}function lU(n){n[0]=n[1]=1/0,n[2]=n[3]=-1/0}function AE(n,e,t,a){const d=Math.pow(2,a.z)*td,m=[a.x*td,a.y*td],g=[];for(const c of n)for(const C of c){const R=[C.x+m[0],C.y+m[1]];yM(R,e,t,d),g.push(R)}return g}function CE(n,e,t,a){const d=Math.pow(2,a.z)*td,m=[a.x*td,a.y*td],g=[];for(const c of n){const C=[];for(const R of c){const V=[R.x+m[0],R.y+m[1]];Wy(e,V),C.push(V)}g.push(C)}if(e[2]-e[0]<=d/2){lU(e);for(const c of g)for(const C of c)yM(C,e,t,d)}return g}function uU(n,e){const t=[1/0,1/0,-1/0,-1/0],a=[1/0,1/0,-1/0,-1/0],d=n.canonicalID();if(e.type==="Polygon"){const m=M2(e.coordinates,a,d),g=AE(n.geometry(),t,a,d);if(!Ay(t,a))return!1;for(const c of g)if(!Ng(c,m))return!1}if(e.type==="MultiPolygon"){const m=_M(e.coordinates,a,d),g=AE(n.geometry(),t,a,d);if(!Ay(t,a))return!1;for(const c of g)if(!aU(c,m))return!1}return!0}function cU(n,e){const t=[1/0,1/0,-1/0,-1/0],a=[1/0,1/0,-1/0,-1/0],d=n.canonicalID();if(e.type==="Polygon"){const m=M2(e.coordinates,a,d),g=CE(n.geometry(),t,a,d);if(!Ay(t,a))return!1;for(const c of g)if(!gM(c,m))return!1}if(e.type==="MultiPolygon"){const m=_M(e.coordinates,a,d),g=CE(n.geometry(),t,a,d);if(!Ay(t,a))return!1;for(const c of g)if(!sU(c,m))return!1}return!0}class Wp{constructor(e,t){this.type=di,this.geojson=e,this.geometries=t}static parse(e,t){if(e.length!==2)return t.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Sy(e[1])){const a=e[1];if(a.type==="FeatureCollection"){const d=[];for(const m of a.features){const{type:g,coordinates:c}=m.geometry;g==="Polygon"&&d.push(c),g==="MultiPolygon"&&d.push(...c)}if(d.length){const m={type:"MultiPolygon",coordinates:d};return new Wp(a,m)}}else if(a.type==="Feature"){const d=a.geometry.type;if(d==="Polygon"||d==="MultiPolygon")return new Wp(a,a.geometry)}else if(a.type==="Polygon"||a.type==="MultiPolygon")return new Wp(a,a)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return uU(e,this.geometries);if(e.geometryType()==="LineString")return cU(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class vM{constructor(e=[],t=(a,d)=>a<d?-1:a>d?1:0){if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let a=(this.length>>1)-1;a>=0;a--)this._down(a)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:t,compare:a}=this,d=t[e];for(;e>0;){const m=e-1>>1,g=t[m];if(a(d,g)>=0)break;t[e]=g,e=m}t[e]=d}_down(e){const{data:t,compare:a}=this,d=this.length>>1,m=t[e];for(;e<d;){let g=(e<<1)+1;const c=g+1;if(c<this.length&&a(t[c],t[g])<0&&(g=c),a(t[g],m)>=0)break;t[e]=t[g],e=g}t[e]=m}}function hU(n,e){if(n.length<=1)return[n];const t=[];let a,d;for(const m of n){const g=dU(m);g!==0&&(m.area=Math.abs(g),d===void 0&&(d=g<0),d===g<0?(a&&t.push(a),a=[m]):a.push(m))}return a&&t.push(a),t}function dU(n){let e=0;for(let t=0,a=n.length,d=a-1,m,g;t<a;d=t++)m=n[t],g=n[d],e+=(g.x-m.x)*(m.y+g.y);return e}const fU=6378.137,IE=1/298.257223563,PE=IE*(2-IE),ME=Math.PI/180;class R2{constructor(e){const t=ME*fU*1e3,a=Math.cos(e*ME),d=1/(1-PE*(1-a*a)),m=Math.sqrt(d);this.kx=t*m*a,this.ky=t*m*d*(1-PE)}distance(e,t){const a=this.wrap(e[0]-t[0])*this.kx,d=(e[1]-t[1])*this.ky;return Math.sqrt(a*a+d*d)}pointOnLine(e,t){let a=1/0,d,m,g,c;for(let C=0;C<e.length-1;C++){let R=e[C][0],V=e[C][1],q=this.wrap(e[C+1][0]-R)*this.kx,J=(e[C+1][1]-V)*this.ky,Y=0;(q!==0||J!==0)&&(Y=(this.wrap(t[0]-R)*this.kx*q+(t[1]-V)*this.ky*J)/(q*q+J*J),Y>1?(R=e[C+1][0],V=e[C+1][1]):Y>0&&(R+=q/this.kx*Y,V+=J/this.ky*Y)),q=this.wrap(t[0]-R)*this.kx,J=(t[1]-V)*this.ky;const xe=q*q+J*J;xe<a&&(a=xe,d=R,m=V,g=C,c=Y)}return{point:[d,m],index:g,t:Math.max(0,Math.min(1,c))}}wrap(e){for(;e<-180;)e+=360;for(;e>180;)e-=360;return e}}const G1=100,H1=50;function bM(n,e){return e[0]-n[0]}function sb(n){return n[1]-n[0]+1}function Xd(n,e){return n[1]>=n[0]&&n[1]<e}function Z1(n,e){if(n[0]>n[1])return[null,null];const t=sb(n);if(e){if(t===2)return[n,null];const d=Math.floor(t/2);return[[n[0],n[0]+d],[n[0]+d,n[1]]]}if(t===1)return[n,null];const a=Math.floor(t/2)-1;return[[n[0],n[0]+a],[n[0]+a+1,n[1]]]}function W1(n,e){if(!Xd(e,n.length))return[1/0,1/0,-1/0,-1/0];const t=[1/0,1/0,-1/0,-1/0];for(let a=e[0];a<=e[1];++a)Wy(t,n[a]);return t}function K1(n){const e=[1/0,1/0,-1/0,-1/0];for(const t of n)for(const a of t)Wy(e,a);return e}function RE(n){return n[0]!==-1/0&&n[1]!==-1/0&&n[2]!==1/0&&n[3]!==1/0}function k2(n,e,t){if(!RE(n)||!RE(e))return NaN;let a=0,d=0;return n[2]<e[0]&&(a=e[0]-n[2]),n[0]>e[2]&&(a=n[0]-e[2]),n[1]>e[3]&&(d=n[1]-e[3]),n[3]<e[1]&&(d=e[1]-n[3]),t.distance([0,0],[a,d])}function $p(n,e,t){const a=t.pointOnLine(e,n);return t.distance(n,a.point)}function L2(n,e,t,a,d){const m=Math.min($p(n,[t,a],d),$p(e,[t,a],d)),g=Math.min($p(t,[n,e],d),$p(a,[n,e],d));return Math.min(m,g)}function pU(n,e,t,a,d){if(!(Xd(e,n.length)&&Xd(a,t.length)))return 1/0;let m=1/0;for(let g=e[0];g<e[1];++g){const c=n[g],C=n[g+1];for(let R=a[0];R<a[1];++R){const V=t[R],q=t[R+1];if(Kb(c,C,V,q))return 0;m=Math.min(m,L2(c,C,V,q,d))}}return m}function mU(n,e,t,a,d){if(!(Xd(e,n.length)&&Xd(a,t.length)))return NaN;let m=1/0;for(let g=e[0];g<=e[1];++g)for(let c=a[0];c<=a[1];++c)if(m=Math.min(m,d.distance(n[g],t[c])),m===0)return m;return m}function gU(n,e,t){if(Ng(n,e,!0))return 0;let a=1/0;for(const d of e){const m=d[0],g=d[d.length-1];if(m!==g&&(a=Math.min(a,$p(n,[g,m],t)),a===0))return a;const c=t.pointOnLine(d,n);if(a=Math.min(a,t.distance(n,c.point)),a===0)return a}return a}function _U(n,e,t,a){if(!Xd(e,n.length))return NaN;for(let m=e[0];m<=e[1];++m)if(Ng(n[m],t,!0))return 0;let d=1/0;for(let m=e[0];m<e[1];++m){const g=n[m],c=n[m+1];for(const C of t)for(let R=0,V=C.length,q=V-1;R<V;q=R++){const J=C[q],Y=C[R];if(Kb(g,c,J,Y))return 0;d=Math.min(d,L2(g,c,J,Y,a))}}return d}function kE(n,e){for(const t of n)for(const a of t)if(Ng(a,e,!0))return!0;return!1}function yU(n,e,t,a=1/0){const d=K1(n),m=K1(e);if(a!==1/0&&k2(d,m,t)>=a)return a;if(Ay(d,m)){if(kE(n,e))return 0}else if(kE(e,n))return 0;let g=1/0;for(const c of n)for(let C=0,R=c.length,V=R-1;C<R;V=C++){const q=c[V],J=c[C];for(const Y of e)for(let xe=0,be=Y.length,Oe=be-1;xe<be;Oe=xe++){const et=Y[Oe],Je=Y[xe];if(Kb(q,J,et,Je))return 0;g=Math.min(g,L2(q,J,et,Je,t))}}return g}function LE(n,e,t,a,d,m){if(!m)return;const g=k2(W1(a,m),d,t);g<e&&n.push([g,m,[0,0]])}function t0(n,e,t,a,d,m,g){if(!m||!g)return;const c=k2(W1(a,m),W1(d,g),t);c<e&&n.push([c,m,g])}function ob(n,e,t,a,d=1/0){let m=Math.min(a.distance(n[0],t[0][0]),d);if(m===0)return m;const g=new vM([[0,[0,n.length-1],[0,0]]],bM),c=K1(t);for(;g.length>0;){const C=g.pop();if(C[0]>=m)continue;const R=C[1],V=e?H1:G1;if(sb(R)<=V){if(!Xd(R,n.length))return NaN;if(e){const q=_U(n,R,t,a);if(isNaN(q)||q===0)return q;m=Math.min(m,q)}else for(let q=R[0];q<=R[1];++q){const J=gU(n[q],t,a);if(m=Math.min(m,J),m===0)return 0}}else{const q=Z1(R,e);LE(g,m,a,n,c,q[0]),LE(g,m,a,n,c,q[1])}}return m}function lb(n,e,t,a,d,m=1/0){let g=Math.min(m,d.distance(n[0],t[0]));if(g===0)return g;const c=new vM([[0,[0,n.length-1],[0,t.length-1]]],bM);for(;c.length>0;){const C=c.pop();if(C[0]>=g)continue;const R=C[1],V=C[2],q=e?H1:G1,J=a?H1:G1;if(sb(R)<=q&&sb(V)<=J){if(!Xd(R,n.length)&&Xd(V,t.length))return NaN;let Y;if(e&&a)Y=pU(n,R,t,V,d),g=Math.min(g,Y);else if(e&&!a){const xe=n.slice(R[0],R[1]+1);for(let be=V[0];be<=V[1];++be)if(Y=$p(t[be],xe,d),g=Math.min(g,Y),g===0)return g}else if(!e&&a){const xe=t.slice(V[0],V[1]+1);for(let be=R[0];be<=R[1];++be)if(Y=$p(n[be],xe,d),g=Math.min(g,Y),g===0)return g}else Y=mU(n,R,t,V,d),g=Math.min(g,Y)}else{const Y=Z1(R,e),xe=Z1(V,a);t0(c,g,d,n,t,Y[0],xe[0]),t0(c,g,d,n,t,Y[0],xe[1]),t0(c,g,d,n,t,Y[1],xe[0]),t0(c,g,d,n,t,Y[1],xe[1])}}return g}function vU(n,e){const t=n.geometry(),a=t.flat().map(g=>P2([g.x,g.y],n.canonical));if(t.length===0)return NaN;const d=new R2(a[0][1]);let m=1/0;for(const g of e){switch(g.type){case"Point":m=Math.min(m,lb(a,!1,[g.coordinates],!1,d,m));break;case"LineString":m=Math.min(m,lb(a,!1,g.coordinates,!0,d,m));break;case"Polygon":m=Math.min(m,ob(a,!1,g.coordinates,d,m));break}if(m===0)return m}return m}function bU(n,e){const t=n.geometry(),a=t.flat().map(g=>P2([g.x,g.y],n.canonical));if(t.length===0)return NaN;const d=new R2(a[0][1]);let m=1/0;for(const g of e){switch(g.type){case"Point":m=Math.min(m,lb(a,!0,[g.coordinates],!1,d,m));break;case"LineString":m=Math.min(m,lb(a,!0,g.coordinates,!0,d,m));break;case"Polygon":m=Math.min(m,ob(a,!0,g.coordinates,d,m));break}if(m===0)return m}return m}function xU(n,e){const t=n.geometry();if(t.length===0||t[0].length===0)return NaN;const a=hU(t).map(g=>g.map(c=>c.map(C=>P2([C.x,C.y],n.canonical)))),d=new R2(a[0][0][0][1]);let m=1/0;for(const g of e)for(const c of a){switch(g.type){case"Point":m=Math.min(m,ob([g.coordinates],!1,c,d,m));break;case"LineString":m=Math.min(m,ob(g.coordinates,!0,c,d,m));break;case"Polygon":m=Math.min(m,yU(c,g.coordinates,d,m));break}if(m===0)return m}return m}function Hx(n){return n.type==="MultiPolygon"?n.coordinates.map(e=>({type:"Polygon",coordinates:e})):n.type==="MultiLineString"?n.coordinates.map(e=>({type:"LineString",coordinates:e})):n.type==="MultiPoint"?n.coordinates.map(e=>({type:"Point",coordinates:e})):[n]}class Kp{constructor(e,t){this.type=Qt,this.geojson=e,this.geometries=t}static parse(e,t){if(e.length!==2)return t.error(`'distance' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Sy(e[1])){const a=e[1];if(a.type==="FeatureCollection")return new Kp(a,a.features.map(d=>Hx(d.geometry)).flat());if(a.type==="Feature")return new Kp(a,Hx(a.geometry));if("type"in a&&"coordinates"in a)return new Kp(a,Hx(a))}return t.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return vU(e,this.geometries);if(e.geometryType()==="LineString")return bU(e,this.geometries);if(e.geometryType()==="Polygon")return xU(e,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class Ky{constructor(e){this.type=ci,this.key=e}static parse(e,t){if(e.length!==2)return t.error(`Expected 1 argument, but found ${e.length-1} instead.`);const a=e[1];return a==null?t.error("Global state property must be defined."):typeof a!="string"?t.error(`Global state property must be string, but found ${typeof e[1]} instead.`):new Ky(a)}evaluate(e){var t;const a=(t=e.globals)===null||t===void 0?void 0:t.globalState;return!a||Object.keys(a).length===0?null:sy(a,this.key)}eachChild(){}outputDefined(){return!1}}const D2={"==":GV,"!=":HV,">":WV,"<":ZV,">=":XV,"<=":KV,array:oh,at:x2,boolean:oh,case:S2,coalesce:Ey,collator:Wb,format:A2,image:C2,in:w2,"index-of":rb,interpolate:ed,"interpolate-hcl":ed,"interpolate-lab":ed,length:I2,let:Gb,literal:Tg,match:T2,number:oh,"number-format":E2,object:oh,slice:ab,step:Zb,string:oh,"to-boolean":Of,"to-color":Of,"to-number":Of,"to-string":Of,var:Hb,within:Wp,distance:Kp,"global-state":Ky};class dh{constructor(e,t,a,d){this.name=e,this.type=t,this._evaluate=a,this.args=d}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,t){const a=e[0],d=dh.definitions[a];if(!d)return t.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0);const m=Array.isArray(d)?d[0]:d.type,g=Array.isArray(d)?[[d[1],d[2]]]:d.overloads,c=g.filter(([R])=>!Array.isArray(R)||R.length===e.length-1);let C=null;for(const[R,V]of c){C=new qb(t.registry,ub,t.path,null,t.scope);const q=[];let J=!1;for(let Y=1;Y<e.length;Y++){const xe=e[Y],be=Array.isArray(R)?R[Y-1]:R.type,Oe=C.parse(xe,1+q.length,be);if(!Oe){J=!0;break}q.push(Oe)}if(!J){if(Array.isArray(R)&&R.length!==q.length){C.error(`Expected ${R.length} arguments, but found ${q.length} instead.`);continue}for(let Y=0;Y<q.length;Y++){const xe=Array.isArray(R)?R[Y]:R.type,be=q[Y];C.concat(Y+1).checkSubtype(xe,be.type)}if(C.errors.length===0)return new dh(a,m,V,q)}}if(c.length===1)t.errors.push(...C.errors);else{const R=(c.length?c:g).map(([q])=>TU(q)).join(" | "),V=[];for(let q=1;q<e.length;q++){const J=t.parse(e[q],1+V.length);if(!J)return null;V.push(Ta(J.type))}t.error(`Expected arguments of type ${R}, but found (${V.join(", ")}) instead.`)}return null}static register(e,t){dh.definitions=t;for(const a in t)e[a]=dh}}function DE(n,[e,t,a,d]){e=e.evaluate(n),t=t.evaluate(n),a=a.evaluate(n);const m=d?d.evaluate(n):1,g=hM(e,t,a,m);if(g)throw new Ba(g);return new Ar(e/255,t/255,a/255,m,!1)}function zE(n,e){return n in e}function Zx(n,e){const t=e[n];return typeof t>"u"?null:t}function wU(n,e,t,a){for(;t<=a;){const d=t+a>>1;if(e[d]===n)return!0;e[d]>n?a=d-1:t=d+1}return!1}function Rp(n){return{type:n}}dh.register(D2,{error:[gV,[vi],(n,[e])=>{throw new Ba(e.evaluate(n))}],typeof:[vi,[ci],(n,[e])=>Ta(Ns(e.evaluate(n)))],"to-rgba":[Uu(Qt,4),[Qh],(n,[e])=>{const[t,a,d,m]=e.evaluate(n).rgb;return[t*255,a*255,d*255,m]}],rgb:[Qh,[Qt,Qt,Qt],DE],rgba:[Qh,[Qt,Qt,Qt,Qt],DE],has:{type:di,overloads:[[[vi],(n,[e])=>zE(e.evaluate(n),n.properties())],[[vi,Gp],(n,[e,t])=>zE(e.evaluate(n),t.evaluate(n))]]},get:{type:ci,overloads:[[[vi],(n,[e])=>Zx(e.evaluate(n),n.properties())],[[vi,Gp],(n,[e,t])=>Zx(e.evaluate(n),t.evaluate(n))]]},"feature-state":[ci,[vi],(n,[e])=>Zx(e.evaluate(n),n.featureState||{})],properties:[Gp,[],n=>n.properties()],"geometry-type":[vi,[],n=>n.geometryType()],id:[ci,[],n=>n.id()],zoom:[Qt,[],n=>n.globals.zoom],"heatmap-density":[Qt,[],n=>n.globals.heatmapDensity||0],elevation:[Qt,[],n=>n.globals.elevation||0],"line-progress":[Qt,[],n=>n.globals.lineProgress||0],accumulated:[ci,[],n=>n.globals.accumulated===void 0?null:n.globals.accumulated],"+":[Qt,Rp(Qt),(n,e)=>{let t=0;for(const a of e)t+=a.evaluate(n);return t}],"*":[Qt,Rp(Qt),(n,e)=>{let t=1;for(const a of e)t*=a.evaluate(n);return t}],"-":{type:Qt,overloads:[[[Qt,Qt],(n,[e,t])=>e.evaluate(n)-t.evaluate(n)],[[Qt],(n,[e])=>-e.evaluate(n)]]},"/":[Qt,[Qt,Qt],(n,[e,t])=>e.evaluate(n)/t.evaluate(n)],"%":[Qt,[Qt,Qt],(n,[e,t])=>e.evaluate(n)%t.evaluate(n)],ln2:[Qt,[],()=>Math.LN2],pi:[Qt,[],()=>Math.PI],e:[Qt,[],()=>Math.E],"^":[Qt,[Qt,Qt],(n,[e,t])=>Math.pow(e.evaluate(n),t.evaluate(n))],sqrt:[Qt,[Qt],(n,[e])=>Math.sqrt(e.evaluate(n))],log10:[Qt,[Qt],(n,[e])=>Math.log(e.evaluate(n))/Math.LN10],ln:[Qt,[Qt],(n,[e])=>Math.log(e.evaluate(n))],log2:[Qt,[Qt],(n,[e])=>Math.log(e.evaluate(n))/Math.LN2],sin:[Qt,[Qt],(n,[e])=>Math.sin(e.evaluate(n))],cos:[Qt,[Qt],(n,[e])=>Math.cos(e.evaluate(n))],tan:[Qt,[Qt],(n,[e])=>Math.tan(e.evaluate(n))],asin:[Qt,[Qt],(n,[e])=>Math.asin(e.evaluate(n))],acos:[Qt,[Qt],(n,[e])=>Math.acos(e.evaluate(n))],atan:[Qt,[Qt],(n,[e])=>Math.atan(e.evaluate(n))],min:[Qt,Rp(Qt),(n,e)=>Math.min(...e.map(t=>t.evaluate(n)))],max:[Qt,Rp(Qt),(n,e)=>Math.max(...e.map(t=>t.evaluate(n)))],abs:[Qt,[Qt],(n,[e])=>Math.abs(e.evaluate(n))],round:[Qt,[Qt],(n,[e])=>{const t=e.evaluate(n);return t<0?-Math.round(-t):Math.round(t)}],floor:[Qt,[Qt],(n,[e])=>Math.floor(e.evaluate(n))],ceil:[Qt,[Qt],(n,[e])=>Math.ceil(e.evaluate(n))],"filter-==":[di,[vi,ci],(n,[e,t])=>n.properties()[e.value]===t.value],"filter-id-==":[di,[ci],(n,[e])=>n.id()===e.value],"filter-type-==":[di,[vi],(n,[e])=>n.geometryType()===e.value],"filter-<":[di,[vi,ci],(n,[e,t])=>{const a=n.properties()[e.value],d=t.value;return typeof a==typeof d&&a<d}],"filter-id-<":[di,[ci],(n,[e])=>{const t=n.id(),a=e.value;return typeof t==typeof a&&t<a}],"filter->":[di,[vi,ci],(n,[e,t])=>{const a=n.properties()[e.value],d=t.value;return typeof a==typeof d&&a>d}],"filter-id->":[di,[ci],(n,[e])=>{const t=n.id(),a=e.value;return typeof t==typeof a&&t>a}],"filter-<=":[di,[vi,ci],(n,[e,t])=>{const a=n.properties()[e.value],d=t.value;return typeof a==typeof d&&a<=d}],"filter-id-<=":[di,[ci],(n,[e])=>{const t=n.id(),a=e.value;return typeof t==typeof a&&t<=a}],"filter->=":[di,[vi,ci],(n,[e,t])=>{const a=n.properties()[e.value],d=t.value;return typeof a==typeof d&&a>=d}],"filter-id->=":[di,[ci],(n,[e])=>{const t=n.id(),a=e.value;return typeof t==typeof a&&t>=a}],"filter-has":[di,[ci],(n,[e])=>e.value in n.properties()],"filter-has-id":[di,[],n=>n.id()!==null&&n.id()!==void 0],"filter-type-in":[di,[Uu(vi)],(n,[e])=>e.value.indexOf(n.geometryType())>=0],"filter-id-in":[di,[Uu(ci)],(n,[e])=>e.value.indexOf(n.id())>=0],"filter-in-small":[di,[vi,Uu(ci)],(n,[e,t])=>t.value.indexOf(n.properties()[e.value])>=0],"filter-in-large":[di,[vi,Uu(ci)],(n,[e,t])=>wU(n.properties()[e.value],t.value,0,t.value.length-1)],all:{type:di,overloads:[[[di,di],(n,[e,t])=>e.evaluate(n)&&t.evaluate(n)],[Rp(di),(n,e)=>{for(const t of e)if(!t.evaluate(n))return!1;return!0}]]},any:{type:di,overloads:[[[di,di],(n,[e,t])=>e.evaluate(n)||t.evaluate(n)],[Rp(di),(n,e)=>{for(const t of e)if(t.evaluate(n))return!0;return!1}]]},"!":[di,[di],(n,[e])=>!e.evaluate(n)],"is-supported-script":[di,[vi],(n,[e])=>{const t=n.globals&&n.globals.isSupportedScript;return t?t(e.evaluate(n)):!0}],upcase:[vi,[vi],(n,[e])=>e.evaluate(n).toUpperCase()],downcase:[vi,[vi],(n,[e])=>e.evaluate(n).toLowerCase()],concat:[vi,Rp(ci),(n,e)=>e.map(t=>oy(t.evaluate(n))).join("")],"resolved-locale":[vi,[Fb],(n,[e])=>e.evaluate(n).resolvedLocale()]});function TU(n){return Array.isArray(n)?`(${n.map(Ta).join(", ")})`:`(${Ta(n.type)}...)`}function ub(n){if(n instanceof Hb)return ub(n.boundExpression);if(n instanceof dh&&n.name==="error"||n instanceof Wb||n instanceof Wp||n instanceof Kp||n instanceof Ky)return!1;const e=n instanceof Of||n instanceof oh;let t=!0;return n.eachChild(a=>{e?t=t&&ub(a):t=t&&a instanceof Tg}),t?Xb(n)&&Yb(n,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"]):!1}function Xb(n){if(n instanceof dh&&(n.name==="get"&&n.args.length===1||n.name==="feature-state"||n.name==="has"&&n.args.length===1||n.name==="properties"||n.name==="geometry-type"||n.name==="id"||/^filter-/.test(n.name))||n instanceof Wp||n instanceof Kp)return!1;let e=!0;return n.eachChild(t=>{e&&!Xb(t)&&(e=!1)}),e}function Cy(n){if(n instanceof dh&&n.name==="feature-state")return!1;let e=!0;return n.eachChild(t=>{e&&!Cy(t)&&(e=!1)}),e}function Yb(n,e){if(n instanceof dh&&e.indexOf(n.name)>=0)return!1;let t=!0;return n.eachChild(a=>{t&&!Yb(a,e)&&(t=!1)}),t}function X1(n){return{result:"success",value:n}}function ig(n){return{result:"error",value:n}}function cb(n){return n["property-type"]==="data-driven"||n["property-type"]==="cross-faded-data-driven"}function xM(n){return!!n.expression&&n.expression.parameters.indexOf("zoom")>-1}function wM(n){return!!n.expression&&n.expression.interpolated}function Pi(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":n===null?"null":typeof n}function z2(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)&&Ns(n)===Gp}class SU{constructor(e,t){this.expression=e,this._warningHistory={},this._evaluator=new dM,this._defaultValue=t?CU(t):null,this._enumValues=t&&t.type==="enum"?t.values:null}evaluateWithoutErrorHandling(e,t,a,d,m,g){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=a,this._evaluator.canonical=d,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=g,this.expression.evaluate(this._evaluator)}evaluate(e,t,a,d,m,g){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=a||null,this._evaluator.canonical=d,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=g||null;try{const c=this.expression.evaluate(this._evaluator);if(c==null||typeof c=="number"&&c!==c)return this._defaultValue;if(this._enumValues&&!(c in this._enumValues))throw new Ba(`Expected value to be one of ${Object.keys(this._enumValues).map(C=>JSON.stringify(C)).join(", ")}, but found ${JSON.stringify(c)} instead.`);return c}catch(c){return this._warningHistory[c.message]||(this._warningHistory[c.message]=!0,typeof console<"u"&&console.warn(c.message)),this._defaultValue}}}function TM(n){return Array.isArray(n)&&n.length>0&&typeof n[0]=="string"&&n[0]in D2}function SM(n,e){const t=new qb(D2,ub,[],e?AU(e):void 0),a=t.parse(n,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return a?X1(new SU(a,e)):ig(t.errors)}class OE{constructor(e,t){this.kind=e,this._styleExpression=t,this.isStateDependent=e!=="constant"&&!Cy(t.expression),this.globalStateRefs=O2(t.expression)}evaluateWithoutErrorHandling(e,t,a,d,m,g){return this._styleExpression.evaluateWithoutErrorHandling(e,t,a,d,m,g)}evaluate(e,t,a,d,m,g){return this._styleExpression.evaluate(e,t,a,d,m,g)}}class NE{constructor(e,t,a,d){this.kind=e,this.zoomStops=a,this._styleExpression=t,this.isStateDependent=e!=="camera"&&!Cy(t.expression),this.globalStateRefs=O2(t.expression),this.interpolationType=d}evaluateWithoutErrorHandling(e,t,a,d,m,g){return this._styleExpression.evaluateWithoutErrorHandling(e,t,a,d,m,g)}evaluate(e,t,a,d,m,g){return this._styleExpression.evaluate(e,t,a,d,m,g)}interpolationFactor(e,t,a){return this.interpolationType?ed.interpolationFactor(this.interpolationType,e,t,a):0}}function EU(n,e){const t=SM(n,e);if(t.result==="error")return t;const a=t.value.expression,d=Xb(a);if(!d&&!cb(e))return ig([new Gh("","data expressions not supported")]);const m=Yb(a,["zoom"]);if(!m&&!xM(e))return ig([new Gh("","zoom expressions not supported")]);const g=C0(a);if(!g&&!m)return ig([new Gh("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')]);if(g instanceof Gh)return ig([g]);if(g instanceof ed&&!wM(e))return ig([new Gh("",'"interpolate" expressions cannot be used with this property')]);if(!g)return X1(d?new OE("constant",t.value):new OE("source",t.value));const c=g instanceof ed?g.interpolation:void 0;return X1(d?new NE("camera",t.value,g.labels,c):new NE("composite",t.value,g.labels,c))}function C0(n){let e=null;if(n instanceof Gb)e=C0(n.result);else if(n instanceof Ey){for(const t of n.args)if(e=C0(t),e)break}else(n instanceof Zb||n instanceof ed)&&n.input instanceof dh&&n.input.name==="zoom"&&(e=n);return e instanceof Gh||n.eachChild(t=>{const a=C0(t);a instanceof Gh?e=a:!e&&a?e=new Gh("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&a&&e!==a&&(e=new Gh("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function O2(n,e=new Set){return n instanceof Ky&&e.add(n.key),n.eachChild(t=>{O2(t,e)}),e}function AU(n){const e={color:Qh,string:vi,number:Qt,enum:vi,boolean:di,formatted:Vb,padding:Ub,numberArray:jb,colorArray:xy,projectionDefinition:Bb,resolvedImage:Zy,variableAnchorOffsetCollection:$b};return n.type==="array"?Uu(e[n.value]||ci,n.length):e[n.type]}function CU(n){if(n.type==="color"&&z2(n.default))return new Ar(0,0,0,0);switch(n.type){case"color":return Ar.parse(n.default)||null;case"padding":return ch.parse(n.default)||null;case"numberArray":return hh.parse(n.default)||null;case"colorArray":return ju.parse(n.default)||null;case"variableAnchorOffsetCollection":return Jh.parse(n.default)||null;case"projectionDefinition":return sh.parse(n.default)||null;default:return n.default===void 0?null:n.default}}function EM(n){if(n===!0||n===!1)return!0;if(!Array.isArray(n)||n.length===0)return!1;switch(n[0]){case"has":return n.length>=2&&n[1]!=="$id"&&n[1]!=="$type";case"in":return n.length>=3&&(typeof n[1]!="string"||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return n.length!==3||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const e of n.slice(1))if(!EM(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function AM(n){const e=n.key,t=n.value;return t?[new Zt(e,t,"constants have been deprecated as of v8")]:[]}function Qa(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function im(n){if(Array.isArray(n))return n.map(im);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){const e={};for(const t in n)e[t]=im(n[t]);return e}return Qa(n)}function Dc(n){const e=n.key,t=n.value,a=n.valueSpec||{},d=n.objectElementValidators||{},m=n.style,g=n.styleSpec,c=n.validateSpec;let C=[];const R=Pi(t);if(R!=="object")return[new Zt(e,t,`object expected, ${R} found`)];for(const V in t){const q=V.split(".")[0],J=sy(a,q)||a["*"];let Y;if(sy(d,q))Y=d[q];else if(sy(a,q))Y=c;else if(d["*"])Y=d["*"];else if(a["*"])Y=c;else{C.push(new Zt(e,t[V],`unknown property "${V}"`));continue}C=C.concat(Y({key:(e&&`${e}.`)+V,value:t[V],valueSpec:J,style:m,styleSpec:g,object:t,objectKey:V,validateSpec:c},t))}for(const V in a)d[V]||a[V].required&&a[V].default===void 0&&t[V]===void 0&&C.push(new Zt(e,t,`missing required property "${V}"`));return C}function N2(n){const e=n.value,t=n.valueSpec,a=n.validateSpec,d=n.style,m=n.styleSpec,g=n.key,c=n.arrayElementValidator||a;if(Pi(e)!=="array")return[new Zt(g,e,`array expected, ${Pi(e)} found`)];if(t.length&&e.length!==t.length)return[new Zt(g,e,`array length ${t.length} expected, length ${e.length} found`)];if(t["min-length"]&&e.length<t["min-length"])return[new Zt(g,e,`array length at least ${t["min-length"]} expected, length ${e.length} found`)];let C={type:t.value,values:t.values};m.$version<7&&(C.function=t.function),Pi(t.value)==="object"&&(C=t.value);let R=[];for(let V=0;V<e.length;V++)R=R.concat(c({array:e,arrayIndex:V,value:e[V],valueSpec:C,validateSpec:n.validateSpec,style:d,styleSpec:m,key:`${g}[${V}]`}));return R}function Qb(n){const e=n.key,t=n.value,a=n.valueSpec;let d=Pi(t);return d==="number"&&t!==t&&(d="NaN"),d!=="number"?[new Zt(e,t,`number expected, ${d} found`)]:"minimum"in a&&t<a.minimum?[new Zt(e,t,`${t} is less than the minimum value ${a.minimum}`)]:"maximum"in a&&t>a.maximum?[new Zt(e,t,`${t} is greater than the maximum value ${a.maximum}`)]:[]}function CM(n){const e=n.valueSpec,t=Qa(n.value.type);let a,d={},m,g;const c=t!=="categorical"&&n.value.property===void 0,C=!c,R=Pi(n.value.stops)==="array"&&Pi(n.value.stops[0])==="array"&&Pi(n.value.stops[0][0])==="object",V=Dc({key:n.key,value:n.value,valueSpec:n.styleSpec.function,validateSpec:n.validateSpec,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{stops:q,default:xe}});return t==="identity"&&c&&V.push(new Zt(n.key,n.value,'missing required property "property"')),t!=="identity"&&!n.value.stops&&V.push(new Zt(n.key,n.value,'missing required property "stops"')),t==="exponential"&&n.valueSpec.expression&&!wM(n.valueSpec)&&V.push(new Zt(n.key,n.value,"exponential functions not supported")),n.styleSpec.$version>=8&&(C&&!cb(n.valueSpec)?V.push(new Zt(n.key,n.value,"property functions not supported")):c&&!xM(n.valueSpec)&&V.push(new Zt(n.key,n.value,"zoom functions not supported"))),(t==="categorical"||R)&&n.value.property===void 0&&V.push(new Zt(n.key,n.value,'"property" property is required')),V;function q(be){if(t==="identity")return[new Zt(be.key,be.value,'identity function may not have a "stops" property')];let Oe=[];const et=be.value;return Oe=Oe.concat(N2({key:be.key,value:et,valueSpec:be.valueSpec,validateSpec:be.validateSpec,style:be.style,styleSpec:be.styleSpec,arrayElementValidator:J})),Pi(et)==="array"&&et.length===0&&Oe.push(new Zt(be.key,et,"array must have at least one stop")),Oe}function J(be){let Oe=[];const et=be.value,Je=be.key;if(Pi(et)!=="array")return[new Zt(Je,et,`array expected, ${Pi(et)} found`)];if(et.length!==2)return[new Zt(Je,et,`array length 2 expected, length ${et.length} found`)];if(R){if(Pi(et[0])!=="object")return[new Zt(Je,et,`object expected, ${Pi(et[0])} found`)];if(et[0].zoom===void 0)return[new Zt(Je,et,"object stop key must have zoom")];if(et[0].value===void 0)return[new Zt(Je,et,"object stop key must have value")];if(g&&g>Qa(et[0].zoom))return[new Zt(Je,et[0].zoom,"stop zoom values must appear in ascending order")];Qa(et[0].zoom)!==g&&(g=Qa(et[0].zoom),m=void 0,d={}),Oe=Oe.concat(Dc({key:`${Je}[0]`,value:et[0],valueSpec:{zoom:{}},validateSpec:be.validateSpec,style:be.style,styleSpec:be.styleSpec,objectElementValidators:{zoom:Qb,value:Y}}))}else Oe=Oe.concat(Y({key:`${Je}[0]`,value:et[0],validateSpec:be.validateSpec,style:be.style,styleSpec:be.styleSpec},et));return TM(im(et[1]))?Oe.concat([new Zt(`${Je}[1]`,et[1],"expressions are not allowed in function stops.")]):Oe.concat(be.validateSpec({key:`${Je}[1]`,value:et[1],valueSpec:e,validateSpec:be.validateSpec,style:be.style,styleSpec:be.styleSpec}))}function Y(be,Oe){const et=Pi(be.value),Je=Qa(be.value),qe=be.value!==null?be.value:Oe;if(!a)a=et;else if(et!==a)return[new Zt(be.key,qe,`${et} stop domain type must match previous stop domain type ${a}`)];if(et!=="number"&&et!=="string"&&et!=="boolean")return[new Zt(be.key,qe,"stop domain value must be a number, string, or boolean")];if(et!=="number"&&t!=="categorical"){let Ze=`number expected, ${et} found`;return cb(e)&&t===void 0&&(Ze+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Zt(be.key,qe,Ze)]}return t==="categorical"&&et==="number"&&(!isFinite(Je)||Math.floor(Je)!==Je)?[new Zt(be.key,qe,`integer expected, found ${Je}`)]:t!=="categorical"&&et==="number"&&m!==void 0&&Je<m?[new Zt(be.key,qe,"stop domain values must appear in ascending order")]:(m=Je,t==="categorical"&&Je in d?[new Zt(be.key,qe,"stop domain values must be unique")]:(d[Je]=!0,[]))}function xe(be){return be.validateSpec({key:be.key,value:be.value,valueSpec:e,validateSpec:be.validateSpec,style:be.style,styleSpec:be.styleSpec})}}function Sg(n){const e=(n.expressionContext==="property"?EU:SM)(im(n.value),n.valueSpec);if(e.result==="error")return e.value.map(a=>new Zt(`${n.key}${a.key}`,n.value,a.message));const t=e.value.expression||e.value._styleExpression.expression;if(n.expressionContext==="property"&&n.propertyKey==="text-font"&&!t.outputDefined())return[new Zt(n.key,n.value,`Invalid data expression for "${n.propertyKey}". Output values must be contained as literals within the expression.`)];if(n.expressionContext==="property"&&n.propertyType==="layout"&&!Cy(t))return[new Zt(n.key,n.value,'"feature-state" data expressions are not supported with layout properties.')];if(n.expressionContext==="filter"&&!Cy(t))return[new Zt(n.key,n.value,'"feature-state" data expressions are not supported with filters.')];if(n.expressionContext&&n.expressionContext.indexOf("cluster")===0){if(!Yb(t,["zoom","feature-state"]))return[new Zt(n.key,n.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(n.expressionContext==="cluster-initial"&&!Xb(t))return[new Zt(n.key,n.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function IU(n){const e=n.value,t=n.key,a=Pi(e);return a!=="boolean"?[new Zt(t,e,`boolean expected, ${a} found`)]:[]}function Y1(n){const e=n.key,t=n.value,a=Pi(t);return a!=="string"?[new Zt(e,t,`color expected, ${a} found`)]:Ar.parse(String(t))?[]:[new Zt(e,t,`color expected, "${t}" found`)]}function Iy(n){const e=n.key,t=n.value,a=n.valueSpec,d=[];return Array.isArray(a.values)?a.values.indexOf(Qa(t))===-1&&d.push(new Zt(e,t,`expected one of [${a.values.join(", ")}], ${JSON.stringify(t)} found`)):Object.keys(a.values).indexOf(Qa(t))===-1&&d.push(new Zt(e,t,`expected one of [${Object.keys(a.values).join(", ")}], ${JSON.stringify(t)} found`)),d}function B2(n){return EM(im(n.value))?Sg(ib({},n,{expressionContext:"filter",valueSpec:{value:"boolean"}})):IM(n)}function IM(n){const e=n.value,t=n.key;if(Pi(e)!=="array")return[new Zt(t,e,`array expected, ${Pi(e)} found`)];const a=n.styleSpec;let d,m=[];if(e.length<1)return[new Zt(t,e,"filter array must have at least 1 element")];switch(m=m.concat(Iy({key:`${t}[0]`,value:e[0],valueSpec:a.filter_operator,style:n.style,styleSpec:n.styleSpec})),Qa(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&Qa(e[1])==="$type"&&m.push(new Zt(t,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&m.push(new Zt(t,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(d=Pi(e[1]),d!=="string"&&m.push(new Zt(`${t}[1]`,e[1],`string expected, ${d} found`)));for(let g=2;g<e.length;g++)d=Pi(e[g]),Qa(e[1])==="$type"?m=m.concat(Iy({key:`${t}[${g}]`,value:e[g],valueSpec:a.geometry_type,style:n.style,styleSpec:n.styleSpec})):d!=="string"&&d!=="number"&&d!=="boolean"&&m.push(new Zt(`${t}[${g}]`,e[g],`string, number, or boolean expected, ${d} found`));break;case"any":case"all":case"none":for(let g=1;g<e.length;g++)m=m.concat(IM({key:`${t}[${g}]`,value:e[g],style:n.style,styleSpec:n.styleSpec}));break;case"has":case"!has":d=Pi(e[1]),e.length!==2?m.push(new Zt(t,e,`filter array for "${e[0]}" operator must have 2 elements`)):d!=="string"&&m.push(new Zt(`${t}[1]`,e[1],`string expected, ${d} found`));break}return m}function PM(n,e){const t=n.key,a=n.validateSpec,d=n.style,m=n.styleSpec,g=n.value,c=n.objectKey,C=m[`${e}_${n.layerType}`];if(!C)return[];const R=c.match(/^(.*)-transition$/);if(e==="paint"&&R&&C[R[1]]&&C[R[1]].transition)return a({key:t,value:g,valueSpec:m.transition,style:d,styleSpec:m});const V=n.valueSpec||C[c];if(!V)return[new Zt(t,g,`unknown property "${c}"`)];let q;if(Pi(g)==="string"&&cb(V)&&!V.tokens&&(q=/^{([^}]+)}$/.exec(g)))return[new Zt(t,g,`"${c}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(q[1])} }\`.`)];const J=[];return n.layerType==="symbol"&&(c==="text-field"&&d&&!d.glyphs&&J.push(new Zt(t,g,'use of "text-field" requires a style "glyphs" property')),c==="text-font"&&z2(im(g))&&Qa(g.type)==="identity"&&J.push(new Zt(t,g,'"text-font" does not support identity functions'))),J.concat(a({key:n.key,value:g,valueSpec:V,style:d,styleSpec:m,expressionContext:"property",propertyType:e,propertyKey:c}))}function MM(n){return PM(n,"paint")}function RM(n){return PM(n,"layout")}function kM(n){let e=[];const t=n.value,a=n.key,d=n.style,m=n.styleSpec;if(Pi(t)!=="object")return[new Zt(a,t,`object expected, ${Pi(t)} found`)];!t.type&&!t.ref&&e.push(new Zt(a,t,'either "type" or "ref" is required'));let g=Qa(t.type);const c=Qa(t.ref);if(t.id){const C=Qa(t.id);for(let R=0;R<n.arrayIndex;R++){const V=d.layers[R];Qa(V.id)===C&&e.push(new Zt(a,t.id,`duplicate layer id "${t.id}", previously used at line ${V.id.__line__}`))}}if("ref"in t){["type","source","source-layer","filter","layout"].forEach(R=>{R in t&&e.push(new Zt(a,t[R],`"${R}" is prohibited for ref layers`))});let C;d.layers.forEach(R=>{Qa(R.id)===c&&(C=R)}),C?C.ref?e.push(new Zt(a,t.ref,"ref cannot reference another ref layer")):g=Qa(C.type):e.push(new Zt(a,t.ref,`ref layer "${c}" not found`))}else if(g!=="background")if(!t.source)e.push(new Zt(a,t,'missing required property "source"'));else{const C=d.sources&&d.sources[t.source],R=C&&Qa(C.type);C?R==="vector"&&g==="raster"?e.push(new Zt(a,t.source,`layer "${t.id}" requires a raster source`)):R!=="raster-dem"&&g==="hillshade"?e.push(new Zt(a,t.source,`layer "${t.id}" requires a raster-dem source`)):R!=="raster-dem"&&g==="color-relief"?e.push(new Zt(a,t.source,`layer "${t.id}" requires a raster-dem source`)):R==="raster"&&g!=="raster"?e.push(new Zt(a,t.source,`layer "${t.id}" requires a vector source`)):R==="vector"&&!t["source-layer"]?e.push(new Zt(a,t,`layer "${t.id}" must specify a "source-layer"`)):R==="raster-dem"&&g!=="hillshade"&&g!=="color-relief"?e.push(new Zt(a,t.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):g==="line"&&t.paint&&t.paint["line-gradient"]&&(R!=="geojson"||!C.lineMetrics)&&e.push(new Zt(a,t,`layer "${t.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Zt(a,t.source,`source "${t.source}" not found`))}return e=e.concat(Dc({key:a,value:t,valueSpec:m.layer,style:n.style,styleSpec:n.styleSpec,validateSpec:n.validateSpec,objectElementValidators:{"*"(){return[]},type(){return n.validateSpec({key:`${a}.type`,value:t.type,valueSpec:m.layer.type,style:n.style,styleSpec:n.styleSpec,validateSpec:n.validateSpec,object:t,objectKey:"type"})},filter:B2,layout(C){return Dc({layer:t,key:C.key,value:C.value,style:C.style,styleSpec:C.styleSpec,validateSpec:C.validateSpec,objectElementValidators:{"*"(R){return RM(ib({layerType:g},R))}}})},paint(C){return Dc({layer:t,key:C.key,value:C.value,style:C.style,styleSpec:C.styleSpec,validateSpec:C.validateSpec,objectElementValidators:{"*"(R){return MM(ib({layerType:g},R))}}})}}})),e}function rm(n){const e=n.value,t=n.key,a=Pi(e);return a!=="string"?[new Zt(t,e,`string expected, ${a} found`)]:[]}function PU(n){var e;const t=(e=n.sourceName)!==null&&e!==void 0?e:"",a=n.value,d=n.styleSpec,m=d.source_raster_dem,g=n.style;let c=[];const C=Pi(a);if(a===void 0)return c;if(C!=="object")return c.push(new Zt("source_raster_dem",a,`object expected, ${C} found`)),c;const R=Qa(a.encoding)==="custom",V=["redFactor","greenFactor","blueFactor","baseShift"],q=n.value.encoding?`"${n.value.encoding}"`:"Default";for(const J in a)!R&&V.includes(J)?c.push(new Zt(J,a[J],`In "${t}": "${J}" is only valid when "encoding" is set to "custom". ${q} encoding found`)):m[J]?c=c.concat(n.validateSpec({key:J,value:a[J],valueSpec:m[J],validateSpec:n.validateSpec,style:g,styleSpec:d})):c.push(new Zt(J,a[J],`unknown property "${J}"`));return c}const BE={promoteId:MU};function LM(n){const e=n.value,t=n.key,a=n.styleSpec,d=n.style,m=n.validateSpec;if(!e.type)return[new Zt(t,e,'"type" is required')];const g=Qa(e.type);let c;switch(g){case"vector":case"raster":return c=Dc({key:t,value:e,valueSpec:a[`source_${g.replace("-","_")}`],style:n.style,styleSpec:a,objectElementValidators:BE,validateSpec:m}),c;case"raster-dem":return c=PU({sourceName:t,value:e,style:n.style,styleSpec:a,validateSpec:m}),c;case"geojson":if(c=Dc({key:t,value:e,valueSpec:a.source_geojson,style:d,styleSpec:a,validateSpec:m,objectElementValidators:BE}),e.cluster)for(const C in e.clusterProperties){const[R,V]=e.clusterProperties[C],q=typeof R=="string"?[R,["accumulated"],["get",C]]:R;c.push(...Sg({key:`${t}.${C}.map`,value:V,expressionContext:"cluster-map"})),c.push(...Sg({key:`${t}.${C}.reduce`,value:q,expressionContext:"cluster-reduce"}))}return c;case"video":return Dc({key:t,value:e,valueSpec:a.source_video,style:d,validateSpec:m,styleSpec:a});case"image":return Dc({key:t,value:e,valueSpec:a.source_image,style:d,validateSpec:m,styleSpec:a});case"canvas":return[new Zt(t,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Iy({key:`${t}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function MU({key:n,value:e}){if(Pi(e)==="string")return rm({key:n,value:e});{const t=[];for(const a in e)t.push(...rm({key:`${n}.${a}`,value:e[a]}));return t}}function DM(n){const e=n.value,t=n.styleSpec,a=t.light,d=n.style;let m=[];const g=Pi(e);if(e===void 0)return m;if(g!=="object")return m=m.concat([new Zt("light",e,`object expected, ${g} found`)]),m;for(const c in e){const C=c.match(/^(.*)-transition$/);C&&a[C[1]]&&a[C[1]].transition?m=m.concat(n.validateSpec({key:c,value:e[c],valueSpec:t.transition,validateSpec:n.validateSpec,style:d,styleSpec:t})):a[c]?m=m.concat(n.validateSpec({key:c,value:e[c],valueSpec:a[c],validateSpec:n.validateSpec,style:d,styleSpec:t})):m=m.concat([new Zt(c,e[c],`unknown property "${c}"`)])}return m}function zM(n){const e=n.value,t=n.styleSpec,a=t.sky,d=n.style,m=Pi(e);if(e===void 0)return[];if(m!=="object")return[new Zt("sky",e,`object expected, ${m} found`)];let g=[];for(const c in e)a[c]?g=g.concat(n.validateSpec({key:c,value:e[c],valueSpec:a[c],style:d,styleSpec:t})):g=g.concat([new Zt(c,e[c],`unknown property "${c}"`)]);return g}function OM(n){const e=n.value,t=n.styleSpec,a=t.terrain,d=n.style;let m=[];const g=Pi(e);if(e===void 0)return m;if(g!=="object")return m=m.concat([new Zt("terrain",e,`object expected, ${g} found`)]),m;for(const c in e)a[c]?m=m.concat(n.validateSpec({key:c,value:e[c],valueSpec:a[c],validateSpec:n.validateSpec,style:d,styleSpec:t})):m=m.concat([new Zt(c,e[c],`unknown property "${c}"`)]);return m}function RU(n){return rm(n).length===0?[]:Sg(n)}function kU(n){return rm(n).length===0?[]:Sg(n)}function LU(n){const e=n.key,t=n.value;if(Pi(t)==="array"){if(t.length<1||t.length>4)return[new Zt(e,t,`padding requires 1 to 4 values; ${t.length} values found`)];const a={type:"number"};let d=[];for(let m=0;m<t.length;m++)d=d.concat(n.validateSpec({key:`${e}[${m}]`,value:t[m],validateSpec:n.validateSpec,valueSpec:a}));return d}else return Qb({key:e,value:t,valueSpec:{}})}function DU(n){const e=n.key,t=n.value;if(Pi(t)==="array"){const a={type:"number"};if(t.length<1)return[new Zt(e,t,"array length at least 1 expected, length 0 found")];let d=[];for(let m=0;m<t.length;m++)d=d.concat(n.validateSpec({key:`${e}[${m}]`,value:t[m],validateSpec:n.validateSpec,valueSpec:a}));return d}else return Qb({key:e,value:t,valueSpec:{}})}function zU(n){const e=n.key,t=n.value;if(Pi(t)==="array"){if(t.length<1)return[new Zt(e,t,"array length at least 1 expected, length 0 found")];let a=[];for(let d=0;d<t.length;d++)a=a.concat(Y1({key:`${e}[${d}]`,value:t[d]}));return a}else return Y1({key:e,value:t})}function OU(n){const e=n.key,t=n.value,a=Pi(t),d=n.styleSpec;if(a!=="array"||t.length<1||t.length%2!==0)return[new Zt(e,t,"variableAnchorOffsetCollection requires a non-empty array of even length")];let m=[];for(let g=0;g<t.length;g+=2)m=m.concat(Iy({key:`${e}[${g}]`,value:t[g],valueSpec:d.layout_symbol["text-anchor"]})),m=m.concat(N2({key:`${e}[${g+1}]`,value:t[g+1],valueSpec:{length:2,value:"number"},validateSpec:n.validateSpec,style:n.style,styleSpec:d}));return m}function NM(n){let e=[];const t=n.value,a=n.key;if(Array.isArray(t)){const d=[],m=[];for(const g in t){t[g].id&&d.includes(t[g].id)&&e.push(new Zt(a,t,`all the sprites' ids must be unique, but ${t[g].id} is duplicated`)),d.push(t[g].id),t[g].url&&m.includes(t[g].url)&&e.push(new Zt(a,t,`all the sprites' URLs must be unique, but ${t[g].url} is duplicated`)),m.push(t[g].url);const c={id:{type:"string",required:!0},url:{type:"string",required:!0}};e=e.concat(Dc({key:`${a}[${g}]`,value:t[g],valueSpec:c,validateSpec:n.validateSpec}))}return e}else return rm({key:a,value:t})}function NU(n){const e=n.value,t=n.styleSpec,a=t.projection,d=n.style,m=Pi(e);if(e===void 0)return[];if(m!=="object")return[new Zt("projection",e,`object expected, ${m} found`)];let g=[];for(const c in e)a[c]?g=g.concat(n.validateSpec({key:c,value:e[c],valueSpec:a[c],style:d,styleSpec:t})):g=g.concat([new Zt(c,e[c],`unknown property "${c}"`)]);return g}function BU(n){const e=n.key;let t=n.value;t=t instanceof String?t.valueOf():t;const a=Pi(t);return a==="array"&&!VU(t)&&!FU(t)?[new Zt(e,t,`projection expected, invalid array ${JSON.stringify(t)} found`)]:["array","string"].includes(a)?[]:[new Zt(e,t,`projection expected, invalid type "${a}" found`)]}function FU(n){return!!["interpolate","step","literal"].includes(n[0])}function VU(n){return Array.isArray(n)&&n.length===3&&typeof n[0]=="string"&&typeof n[1]=="string"&&typeof n[2]=="number"}function UU(n){return!!n&&n.constructor===Object}function BM(n){return UU(n.value)?[]:[new Zt(n.key,n.value,`object expected, ${Pi(n.value)} found`)]}const FE={"*"(){return[]},array:N2,boolean:IU,number:Qb,color:Y1,constants:AM,enum:Iy,filter:B2,function:CM,layer:kM,object:Dc,source:LM,light:DM,sky:zM,terrain:OM,projection:NU,projectionDefinition:BU,string:rm,formatted:RU,resolvedImage:kU,padding:LU,numberArray:DU,colorArray:zU,variableAnchorOffsetCollection:OU,sprite:NM,state:BM};function hb(n){const e=n.value,t=n.valueSpec,a=n.styleSpec;return n.validateSpec=hb,t.expression&&z2(Qa(e))?CM(n):t.expression&&TM(im(e))?Sg(n):t.type&&FE[t.type]?FE[t.type](n):Dc(ib({},n,{valueSpec:t.type?a[t.type]:t}))}function FM(n){const e=n.value,t=n.key,a=rm(n);return a.length||(e.indexOf("{fontstack}")===-1&&a.push(new Zt(t,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&a.push(new Zt(t,e,'"glyphs" url must include a "{range}" token'))),a}function Hu(n,e=mV){let t=[];return t=t.concat(hb({key:"",value:n,valueSpec:e.$root,styleSpec:e,style:n,validateSpec:hb,objectElementValidators:{glyphs:FM,"*"(){return[]}}})),n.constants&&(t=t.concat(AM({key:"constants",value:n.constants}))),VM(t)}Hu.source=_h(gh(LM));Hu.sprite=_h(gh(NM));Hu.glyphs=_h(gh(FM));Hu.light=_h(gh(DM));Hu.sky=_h(gh(zM));Hu.terrain=_h(gh(OM));Hu.state=_h(gh(BM));Hu.layer=_h(gh(kM));Hu.filter=_h(gh(B2));Hu.paintProperty=_h(gh(MM));Hu.layoutProperty=_h(gh(RM));function gh(n){return function(e){return n({...e,validateSpec:hb})}}function VM(n){return[].concat(n).sort((e,t)=>e.line-t.line)}function _h(n){return function(...e){return VM(n.apply(this,e))}}function VE(n){if(!n)return{style:ay[ry[0].referenceStyleID].getDefaultVariant().getExpandedStyleURL(),requiresUrlMonitoring:!1,isFallback:!0};if(typeof n=="string"){const e=$U(n);return e.isValidStyle?{style:e.styleObject,requiresUrlMonitoring:!1,isFallback:!1}:e.isValidJSON?{style:ay[ry[0].referenceStyleID].getDefaultVariant().getExpandedStyleURL(),requiresUrlMonitoring:!1,isFallback:!0}:n.startsWith("http")?{style:n,requiresUrlMonitoring:!0,isFallback:!1}:n.toLowerCase().includes(".json")?{style:jU(n),requiresUrlMonitoring:!0,isFallback:!1}:{style:BP(n),requiresUrlMonitoring:!0,isFallback:!1}}return n instanceof FP?{style:n.getExpandedStyleURL(),requiresUrlMonitoring:!1,isFallback:!1}:n instanceof VP?{style:n.getDefaultVariant().getExpandedStyleURL(),requiresUrlMonitoring:!1,isFallback:!1}:Hu(n).length===0?{style:n,requiresUrlMonitoring:!1,isFallback:!1}:{style:ay[ry[0].referenceStyleID].getDefaultVariant().getExpandedStyleURL(),requiresUrlMonitoring:!1,isFallback:!0}}function jU(n){try{return new URL(n).href}catch{}return new URL(n,location.origin).href}function $U(n){try{const e=JSON.parse(n),t=Hu(e);return{isValidJSON:!0,isValidStyle:t.length===0,styleObject:t.length===0?e:null}}catch{return{isValidJSON:!1,isValidStyle:!1,styleObject:null}}}function $d(n,e,t){const a=window.document.createElement(n);return e!==void 0&&(a.className=e),t&&t.appendChild(a),a}function Py(n){n.parentNode&&n.parentNode.removeChild(n)}class qU{constructor(){rn(this,"_map"),rn(this,"_container"),rn(this,"_terrainButton"),fF(["_toggleTerrain","_updateTerrainIcon"],this)}onAdd(e){return this._map=e,this._container=$d("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=$d("button","maplibregl-ctrl-terrain",this._container),$d("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){Py(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}_toggleTerrain(){UM(this._map),this._updateTerrainIcon()}_updateTerrainIcon(){this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.hasTerrain()?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))}}function UM(n){n.hasTerrain()?n.disableTerrain():n.enableTerrain()}class GU extends SF{constructor(e={}){super({showCompass:e.showCompass??!0,showZoom:e.showZoom??!0,visualizePitch:e.visualizePitch??!0}),rn(this,"_rotateCompassArrow",()=>{const t=this._map.getBearing(),a=this._map.getPitch(),d=this.options.visualizePitch?`scale(${Math.min(1.5,1/Math.cos(a*(Math.PI/180))**.5)}) rotateX(${Math.min(70,a)}deg) rotateZ(${-t}deg)`:`rotate(${-t}deg)`;this._compassIcon.style.transform=d}),this._compass&&(this._compass.removeEventListener("click",this._compass.clickFunction),this._compass.addEventListener("click",t=>{this._map.getPitch()===0?this._map.easeTo({pitch:Math.min(this._map.getMaxPitch(),80)}):this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})}))}_createButton(e,t){const a=super._createButton(e,t);return a.clickFunction=t,a}}const UE=wn.Marker,jE=wn.LngLat,HU=wn.LngLatBounds;class ZU extends EF{constructor(){super(...arguments),rn(this,"lastUpdatedCenter",new jE(0,0)),rn(this,"_updateCamera",e=>{var t;const a=new jE(e.coords.longitude,e.coords.latitude),d=e.coords.accuracy,m={bearing:this._map.getBearing(),...this.options.fitBoundsOptions,linear:!0},g=this._map.getZoom();g>(((t=this.options.fitBoundsOptions)==null?void 0:t.maxZoom)??30)&&(m.zoom=g),this._map.fitBounds(HU.fromLngLat(a,d),m,{geolocateSource:!0});let c=!1;const C=()=>{c=!0};this._map.once("click",C),this._map.once("dblclick",C),this._map.once("dragstart",C),this._map.once("mousedown",C),this._map.once("touchstart",C),this._map.once("wheel",C),this._map.once("moveend",()=>{this._map.off("click",C),this._map.off("dblclick",C),this._map.off("dragstart",C),this._map.off("mousedown",C),this._map.off("touchstart",C),this._map.off("wheel",C),!c&&(this.lastUpdatedCenter=this._map.getCenter())})}),rn(this,"_finishSetupUI",e=>{if(this._map){if(e===!1){const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=$d("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new UE({element:this._dotElement}),this._circleElement=$d("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new UE({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("move",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("moveend",t=>{const a=t.originalEvent&&t.originalEvent.type==="resize",d=this.lastUpdatedCenter.distanceTo(this._map.getCenter());!t.geolocateSource&&this._watchState==="ACTIVE_LOCK"&&!a&&d>1&&(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new Event("trackuserlocationend")))})}}),rn(this,"_onZoom",()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()})}_updateCircleRadius(){if(this._watchState!=="BACKGROUND"&&this._watchState!=="ACTIVE_LOCK")return;const e=[this._lastKnownPosition.coords.longitude,this._lastKnownPosition.coords.latitude],t=this._map.project(e),a=this._map.unproject([t.x,t.y]),d=this._map.unproject([t.x+20,t.y]),m=a.distanceTo(d)/20,g=Math.ceil(2*this._accuracy/m);this._circleElement.style.width=`${g}px`,this._circleElement.style.height=`${g}px`}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;case"BACKGROUND_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}}var zp,Nu,Op,Np,W_;class WU{constructor(e,t,a){if(hu(this,zp),hu(this,Nu),hu(this,Op),hu(this,Np),hu(this,W_),typeof e=="string"){const d=document.querySelector(e);if(!d)throw new Error(`No element has been found with selector "${e}" when creating an external control.`);Vu(this,Nu,d)}else Vu(this,Nu,e);t&&Vu(this,Op,d=>{t(An(this,zp),An(this,Nu),d)}),a&&Vu(this,Np,d=>{a(An(this,zp),An(this,Nu),d)}),Vu(this,W_,An(this,Nu).parentElement)}onAdd(e){return Vu(this,zp,e),An(this,Op)&&An(this,Nu).addEventListener("click",An(this,Op)),An(this,Np)&&An(this,zp).on("render",An(this,Np)),Py(An(this,Nu)),An(this,Nu)}onRemove(){An(this,Op)&&An(this,Nu).removeEventListener("click",An(this,Op)),An(this,Np)&&An(this,zp).off("render",An(this,Np)),An(this,W_)?An(this,W_).appendChild(An(this,Nu)):Py(An(this,Nu))}}zp=new WeakMap,Nu=new WeakMap,Op=new WeakMap,Np=new WeakMap,W_=new WeakMap;class KU{constructor(){rn(this,"map"),rn(this,"container"),rn(this,"projectionButton")}onAdd(e){return this.map=e,this.container=$d("div","maplibregl-ctrl maplibregl-ctrl-group"),this.projectionButton=$d("button","maplibregl-ctrl-projection",this.container),$d("span","maplibregl-ctrl-icon",this.projectionButton).setAttribute("aria-hidden","true"),this.projectionButton.type="button",this.projectionButton.addEventListener("click",this.toggleProjection.bind(this)),e.on("projectiontransition",this.updateProjectionIcon.bind(this)),this.updateProjectionIcon(),this.container}onRemove(){Py(this.container),this.map.off("projectiontransition",this.updateProjectionIcon),this.map=void 0}toggleProjection(){jM(this.map),this.updateProjectionIcon()}updateProjectionIcon(){this.projectionButton.classList.remove("maplibregl-ctrl-projection-globe"),this.projectionButton.classList.remove("maplibregl-ctrl-projection-mercator"),this.map.isGlobeProjection()?(this.projectionButton.classList.add("maplibregl-ctrl-projection-mercator"),this.projectionButton.title="Enable Mercator projection"):(this.projectionButton.classList.add("maplibregl-ctrl-projection-globe"),this.projectionButton.title="Enable Globe projection")}}function jM(n){n.getProjection()===void 0&&n.setProjection({type:"mercator"}),n.isGlobeProjection()?n.enableMercatorProjection():n.enableGlobeProjection()}const K_={"zoom-in":n=>n.zoomIn(),"zoom-out":n=>n.zoomOut(),"toggle-projection":jM,"toggle-terrain":UM,"reset-view":n=>{n.getPitch()===0?n.easeTo({pitch:Math.min(n.getMaxPitch(),80)}):n.resetNorthPitch()},"reset-bearing":n=>{n.rotateTo(0)},"reset-pitch":n=>{n.setPitch(0)},"reset-roll":n=>{n.setRoll(0)}};var I0,X_;class Q1 extends WU{constructor(e,t){if(t&&!(t in K_))throw new Error(`data-maptiler-control value "${t}" is invalid.`);super(e,t&&K_[t]),hu(this,I0),hu(this,X_,new Map)}onAdd(e){return Vu(this,I0,e),super.onAdd(e)}onRemove(){for(const[e,t]of An(this,X_)){const a=e.deref();a&&a.removeEventListener("click",t)}An(this,X_).clear(),super.onRemove()}configureGroupItem(e,t){if(!t)return;if(!(t in K_))throw new Error(`data-maptiler-control value "${t}" is invalid.`);const a=d=>{K_[t](An(this,I0),e,d)};e.addEventListener("click",a),An(this,X_).set(new WeakRef(e),a)}}I0=new WeakMap,X_=new WeakMap,rn(Q1,"controlCallbacks",K_);var Fu,jh,Bp,Fp,Mc,P0,ql,$M,Rc,qM;class Wx{constructor(e,t){hu(this,ql),hu(this,Fu),rn(this,"map"),hu(this,jh),hu(this,Bp),hu(this,Fp),hu(this,Mc,!1),hu(this,P0),e.style!==void 0&&Vu(this,Mc,!0),Vu(this,Fu,{zoomAdjust:-4,position:"top-right",...t,forceNoAttributionControl:!0,attributionControl:!1,navigationControl:!1,geolocateControl:!1,maptilerLogo:!1,minimap:!1,hash:!1,pitchAdjust:!1,...e,containerStyle:{border:"1px solid #000",width:"400px",height:"300px",...e.containerStyle??{}}}),e.lockZoom!==void 0&&(An(this,Fu).minZoom=e.lockZoom,An(this,Fu).maxZoom=e.lockZoom)}setStyle(e,t){An(this,Mc)||this.map.setStyle(e,t),Bu(this,ql,Rc).call(this)}addLayer(e,t){return An(this,Mc)||this.map.addLayer(e,t),Bu(this,ql,Rc).call(this),this.map}moveLayer(e,t){return An(this,Mc)||this.map.moveLayer(e,t),Bu(this,ql,Rc).call(this),this.map}removeLayer(e){return An(this,Mc)||this.map.removeLayer(e),Bu(this,ql,Rc).call(this),this}setLayerZoomRange(e,t,a){return An(this,Mc)||this.map.setLayerZoomRange(e,t,a),Bu(this,ql,Rc).call(this),this}setFilter(e,t,a){return An(this,Mc)||this.map.setFilter(e,t,a),Bu(this,ql,Rc).call(this),this}setPaintProperty(e,t,a,d){return An(this,Mc)||this.map.setPaintProperty(e,t,a,d),Bu(this,ql,Rc).call(this),this}setLayoutProperty(e,t,a,d){return An(this,Mc)||this.map.setLayoutProperty(e,t,a,d),Bu(this,ql,Rc).call(this),this}setGlyphs(e,t){return An(this,Mc)||this.map.setGlyphs(e,t),Bu(this,ql,Rc).call(this),this}onAdd(e){Vu(this,jh,e),Vu(this,Bp,$d("div","maplibregl-ctrl maplibregl-ctrl-group"));for(const[t,a]of Object.entries(An(this,Fu).containerStyle))An(this,Bp).style.setProperty(t,a);return An(this,Fu).container=An(this,Bp),An(this,Fu).zoom=e.getZoom()+An(this,Fu).zoomAdjust,this.map=new WM(An(this,Fu)),this.map.once("style.load",()=>{this.map.resize()}),this.map.once("load",()=>{Bu(this,ql,$M).call(this,An(this,Fu).parentRect),Vu(this,P0,Bu(this,ql,qM).call(this))}),An(this,Bp)}onRemove(){var e;(e=An(this,P0))==null||e.call(this),Py(An(this,Bp))}}Fu=new WeakMap,jh=new WeakMap,Bp=new WeakMap,Fp=new WeakMap,Mc=new WeakMap,P0=new WeakMap,ql=new WeakSet,$M=function(n){n===void 0||n.linePaint===void 0&&n.fillPaint===void 0||(Vu(this,Fp,{type:"Feature",properties:{name:"parentRect"},geometry:{type:"Polygon",coordinates:[[[],[],[],[],[]]]}}),this.map.addSource("parentRect",{type:"geojson",data:An(this,Fp)}),(n.lineLayout!==void 0||n.linePaint!==void 0)&&this.map.addLayer({id:"parentRectOutline",type:"line",source:"parentRect",layout:{...n.lineLayout},paint:{"line-color":"#FFF","line-width":1,"line-opacity":.85,...n.linePaint}}),n.fillPaint!==void 0&&this.map.addLayer({id:"parentRectFill",type:"fill",source:"parentRect",layout:{},paint:{"fill-color":"#08F","fill-opacity":.135,...n.fillPaint}}),Bu(this,ql,Rc).call(this))},Rc=function(){if(An(this,Fp)===void 0)return;const{devicePixelRatio:n}=window,e=An(this,jh).getCanvas(),t=e.width/n,a=e.height/n,d=An(this,jh).unproject.bind(An(this,jh)),m=d([0,0]),g=d([t,0]),c=d([0,a]),C=d([t,a]);An(this,Fp).geometry.coordinates=[[c.toArray(),C.toArray(),g.toArray(),m.toArray(),c.toArray()]];const R=this.map.getSource("parentRect");R!==void 0&&R.setData(An(this,Fp))},qM=function(){const{pitchAdjust:n}=An(this,Fu),e=()=>{m("parent")},t=()=>{m("minimap")},a=()=>{An(this,jh).on("move",e),this.map.on("move",t)},d=()=>{An(this,jh).off("move",e),this.map.off("move",t)},m=g=>{d();const c=g==="parent"?An(this,jh):this.map,C=g==="parent"?this.map:An(this,jh),R=c.getCenter(),V=c.getZoom()+An(this,Fu).zoomAdjust*(g==="parent"?1:-1),q=c.getBearing(),J=c.getPitch();C.jumpTo({center:R,zoom:V,bearing:q,pitch:n?J:0}),Bu(this,ql,Rc).call(this),a()};return a(),()=>{d()}};class XU{constructor(e,t=2e3){rn(this,"map"),rn(this,"registeredModules",new Set),rn(this,"viewerType"),this.map=e,this.viewerType="Map",setTimeout(async()=>{if(!Ya.telemetry)return;const a=this.preparePayload();try{(await fetch(a,{method:"POST"})).ok||console.warn("The metrics could not be sent to MapTiler Cloud")}catch(d){console.warn("The metrics could not be sent to MapTiler Cloud",d)}},Math.max(1e3,t))}registerModule(e,t){this.registeredModules.add(`${e}:${t}`)}registerViewerType(e="Map"){this.viewerType=e}preparePayload(){const e=new URL(Gl.telemetryURL);return e.searchParams.append("sdk",Qj()),e.searchParams.append("key",Ya.apiKey),e.searchParams.append("mtsid",_2),e.searchParams.append("session",Ya.session?"1":"0"),e.searchParams.append("caching",Ya.caching?"1":"0"),e.searchParams.append("lang-updated",this.map.isLanguageUpdated()?"1":"0"),e.searchParams.append("terrain",this.map.getTerrain()?"1":"0"),e.searchParams.append("globe",this.map.isGlobeProjection()?"1":"0"),e.searchParams.append("viewerType",this.viewerType),this.registeredModules.size>0&&e.searchParams.append("modules",Array.from(this.registeredModules).join("|")),e.href}}var My=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var n=0,e=arguments.length;e--;)n+=arguments[e]*arguments[e];return Math.sqrt(n)});function ly(){var n=new My(16);return My!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n}function YU(n,e,t,a,d,m,g,c,C,R,V,q,J,Y,xe,be,Oe){return n[0]=e,n[1]=t,n[2]=a,n[3]=d,n[4]=m,n[5]=g,n[6]=c,n[7]=C,n[8]=R,n[9]=V,n[10]=q,n[11]=J,n[12]=Y,n[13]=xe,n[14]=be,n[15]=Oe,n}function QU(n,e,t){var a=e[0],d=e[1],m=e[2],g=e[3],c=e[4],C=e[5],R=e[6],V=e[7],q=e[8],J=e[9],Y=e[10],xe=e[11],be=e[12],Oe=e[13],et=e[14],Je=e[15],qe=t[0],Ze=t[1],je=t[2],Be=t[3];return n[0]=qe*a+Ze*c+je*q+Be*be,n[1]=qe*d+Ze*C+je*J+Be*Oe,n[2]=qe*m+Ze*R+je*Y+Be*et,n[3]=qe*g+Ze*V+je*xe+Be*Je,qe=t[4],Ze=t[5],je=t[6],Be=t[7],n[4]=qe*a+Ze*c+je*q+Be*be,n[5]=qe*d+Ze*C+je*J+Be*Oe,n[6]=qe*m+Ze*R+je*Y+Be*et,n[7]=qe*g+Ze*V+je*xe+Be*Je,qe=t[8],Ze=t[9],je=t[10],Be=t[11],n[8]=qe*a+Ze*c+je*q+Be*be,n[9]=qe*d+Ze*C+je*J+Be*Oe,n[10]=qe*m+Ze*R+je*Y+Be*et,n[11]=qe*g+Ze*V+je*xe+Be*Je,qe=t[12],Ze=t[13],je=t[14],Be=t[15],n[12]=qe*a+Ze*c+je*q+Be*be,n[13]=qe*d+Ze*C+je*J+Be*Oe,n[14]=qe*m+Ze*R+je*Y+Be*et,n[15]=qe*g+Ze*V+je*xe+Be*Je,n}function JU(n,e,t){var a=t[0],d=t[1],m=t[2];return n[0]=e[0]*a,n[1]=e[1]*a,n[2]=e[2]*a,n[3]=e[3]*a,n[4]=e[4]*d,n[5]=e[5]*d,n[6]=e[6]*d,n[7]=e[7]*d,n[8]=e[8]*m,n[9]=e[9]*m,n[10]=e[10]*m,n[11]=e[11]*m,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n}function $E(n,e,t){var a=Math.sin(t),d=Math.cos(t),m=e[4],g=e[5],c=e[6],C=e[7],R=e[8],V=e[9],q=e[10],J=e[11];return e!==n&&(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[4]=m*d+R*a,n[5]=g*d+V*a,n[6]=c*d+q*a,n[7]=C*d+J*a,n[8]=R*d-m*a,n[9]=V*d-g*a,n[10]=q*d-c*a,n[11]=J*d-C*a,n}function ej(n,e,t){var a=Math.sin(t),d=Math.cos(t),m=e[0],g=e[1],c=e[2],C=e[3],R=e[8],V=e[9],q=e[10],J=e[11];return e!==n&&(n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=m*d-R*a,n[1]=g*d-V*a,n[2]=c*d-q*a,n[3]=C*d-J*a,n[8]=m*a+R*d,n[9]=g*a+V*d,n[10]=c*a+q*d,n[11]=C*a+J*d,n}function qE(n,e,t){var a=Math.sin(t),d=Math.cos(t),m=e[0],g=e[1],c=e[2],C=e[3],R=e[4],V=e[5],q=e[6],J=e[7];return e!==n&&(n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=m*d+R*a,n[1]=g*d+V*a,n[2]=c*d+q*a,n[3]=C*d+J*a,n[4]=R*d-m*a,n[5]=V*d-g*a,n[6]=q*d-c*a,n[7]=J*d-C*a,n}function tj(n,e,t,a,d){var m=1/Math.tan(e/2),g;return n[0]=m/t,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=m,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,d!=null&&d!==1/0?(g=1/(a-d),n[10]=(d+a)*g,n[14]=2*d*a*g):(n[10]=-1,n[14]=-2*a),n}var nj=tj;function M0(){var n=new My(3);return My!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function ij(n,e,t){var a=new My(3);return a[0]=n,a[1]=e,a[2]=t,a}function Kx(n,e){var t=e[0],a=e[1],d=e[2],m=t*t+a*a+d*d;return m>0&&(m=1/Math.sqrt(m)),n[0]=e[0]*m,n[1]=e[1]*m,n[2]=e[2]*m,n}function GE(n,e,t){var a=e[0],d=e[1],m=e[2],g=t[0],c=t[1],C=t[2];return n[0]=d*C-m*c,n[1]=m*g-a*C,n[2]=a*c-d*g,n}(function(){var n=M0();return function(e,t,a,d,m,g){var c,C;for(t||(t=3),a||(a=0),d?C=Math.min(d*t+a,e.length):C=e.length,c=a;c<C;c+=t)n[0]=e[c],n[1]=e[c+1],n[2]=e[c+2],m(n,n,g),e[c]=n[0],e[c+1]=n[1],e[c+2]=n[2];return e}})();function rj(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var HE,ZE;function aj(){return ZE||(ZE=1,HE={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}),HE}var Xx,WE;function GM(){if(WE)return Xx;WE=1;const n=aj(),e={};for(const d of Object.keys(n))e[n[d]]=d;const t={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};Xx=t;for(const d of Object.keys(t)){if(!("channels"in t[d]))throw new Error("missing channels property: "+d);if(!("labels"in t[d]))throw new Error("missing channel labels property: "+d);if(t[d].labels.length!==t[d].channels)throw new Error("channel and label counts mismatch: "+d);const{channels:m,labels:g}=t[d];delete t[d].channels,delete t[d].labels,Object.defineProperty(t[d],"channels",{value:m}),Object.defineProperty(t[d],"labels",{value:g})}t.rgb.hsl=function(d){const m=d[0]/255,g=d[1]/255,c=d[2]/255,C=Math.min(m,g,c),R=Math.max(m,g,c),V=R-C;let q,J;R===C?q=0:m===R?q=(g-c)/V:g===R?q=2+(c-m)/V:c===R&&(q=4+(m-g)/V),q=Math.min(q*60,360),q<0&&(q+=360);const Y=(C+R)/2;return R===C?J=0:Y<=.5?J=V/(R+C):J=V/(2-R-C),[q,J*100,Y*100]},t.rgb.hsv=function(d){let m,g,c,C,R;const V=d[0]/255,q=d[1]/255,J=d[2]/255,Y=Math.max(V,q,J),xe=Y-Math.min(V,q,J),be=function(Oe){return(Y-Oe)/6/xe+1/2};return xe===0?(C=0,R=0):(R=xe/Y,m=be(V),g=be(q),c=be(J),V===Y?C=c-g:q===Y?C=1/3+m-c:J===Y&&(C=2/3+g-m),C<0?C+=1:C>1&&(C-=1)),[C*360,R*100,Y*100]},t.rgb.hwb=function(d){const m=d[0],g=d[1];let c=d[2];const C=t.rgb.hsl(d)[0],R=1/255*Math.min(m,Math.min(g,c));return c=1-1/255*Math.max(m,Math.max(g,c)),[C,R*100,c*100]},t.rgb.cmyk=function(d){const m=d[0]/255,g=d[1]/255,c=d[2]/255,C=Math.min(1-m,1-g,1-c),R=(1-m-C)/(1-C)||0,V=(1-g-C)/(1-C)||0,q=(1-c-C)/(1-C)||0;return[R*100,V*100,q*100,C*100]};function a(d,m){return(d[0]-m[0])**2+(d[1]-m[1])**2+(d[2]-m[2])**2}return t.rgb.keyword=function(d){const m=e[d];if(m)return m;let g=1/0,c;for(const C of Object.keys(n)){const R=n[C],V=a(d,R);V<g&&(g=V,c=C)}return c},t.keyword.rgb=function(d){return n[d]},t.rgb.xyz=function(d){let m=d[0]/255,g=d[1]/255,c=d[2]/255;m=m>.04045?((m+.055)/1.055)**2.4:m/12.92,g=g>.04045?((g+.055)/1.055)**2.4:g/12.92,c=c>.04045?((c+.055)/1.055)**2.4:c/12.92;const C=m*.4124+g*.3576+c*.1805,R=m*.2126+g*.7152+c*.0722,V=m*.0193+g*.1192+c*.9505;return[C*100,R*100,V*100]},t.rgb.lab=function(d){const m=t.rgb.xyz(d);let g=m[0],c=m[1],C=m[2];g/=95.047,c/=100,C/=108.883,g=g>.008856?g**(1/3):7.787*g+16/116,c=c>.008856?c**(1/3):7.787*c+16/116,C=C>.008856?C**(1/3):7.787*C+16/116;const R=116*c-16,V=500*(g-c),q=200*(c-C);return[R,V,q]},t.hsl.rgb=function(d){const m=d[0]/360,g=d[1]/100,c=d[2]/100;let C,R,V;if(g===0)return V=c*255,[V,V,V];c<.5?C=c*(1+g):C=c+g-c*g;const q=2*c-C,J=[0,0,0];for(let Y=0;Y<3;Y++)R=m+1/3*-(Y-1),R<0&&R++,R>1&&R--,6*R<1?V=q+(C-q)*6*R:2*R<1?V=C:3*R<2?V=q+(C-q)*(2/3-R)*6:V=q,J[Y]=V*255;return J},t.hsl.hsv=function(d){const m=d[0];let g=d[1]/100,c=d[2]/100,C=g;const R=Math.max(c,.01);c*=2,g*=c<=1?c:2-c,C*=R<=1?R:2-R;const V=(c+g)/2,q=c===0?2*C/(R+C):2*g/(c+g);return[m,q*100,V*100]},t.hsv.rgb=function(d){const m=d[0]/60,g=d[1]/100;let c=d[2]/100;const C=Math.floor(m)%6,R=m-Math.floor(m),V=255*c*(1-g),q=255*c*(1-g*R),J=255*c*(1-g*(1-R));switch(c*=255,C){case 0:return[c,J,V];case 1:return[q,c,V];case 2:return[V,c,J];case 3:return[V,q,c];case 4:return[J,V,c];case 5:return[c,V,q]}},t.hsv.hsl=function(d){const m=d[0],g=d[1]/100,c=d[2]/100,C=Math.max(c,.01);let R,V;V=(2-g)*c;const q=(2-g)*C;return R=g*C,R/=q<=1?q:2-q,R=R||0,V/=2,[m,R*100,V*100]},t.hwb.rgb=function(d){const m=d[0]/360;let g=d[1]/100,c=d[2]/100;const C=g+c;let R;C>1&&(g/=C,c/=C);const V=Math.floor(6*m),q=1-c;R=6*m-V,V&1&&(R=1-R);const J=g+R*(q-g);let Y,xe,be;switch(V){default:case 6:case 0:Y=q,xe=J,be=g;break;case 1:Y=J,xe=q,be=g;break;case 2:Y=g,xe=q,be=J;break;case 3:Y=g,xe=J,be=q;break;case 4:Y=J,xe=g,be=q;break;case 5:Y=q,xe=g,be=J;break}return[Y*255,xe*255,be*255]},t.cmyk.rgb=function(d){const m=d[0]/100,g=d[1]/100,c=d[2]/100,C=d[3]/100,R=1-Math.min(1,m*(1-C)+C),V=1-Math.min(1,g*(1-C)+C),q=1-Math.min(1,c*(1-C)+C);return[R*255,V*255,q*255]},t.xyz.rgb=function(d){const m=d[0]/100,g=d[1]/100,c=d[2]/100;let C,R,V;return C=m*3.2406+g*-1.5372+c*-.4986,R=m*-.9689+g*1.8758+c*.0415,V=m*.0557+g*-.204+c*1.057,C=C>.0031308?1.055*C**(1/2.4)-.055:C*12.92,R=R>.0031308?1.055*R**(1/2.4)-.055:R*12.92,V=V>.0031308?1.055*V**(1/2.4)-.055:V*12.92,C=Math.min(Math.max(0,C),1),R=Math.min(Math.max(0,R),1),V=Math.min(Math.max(0,V),1),[C*255,R*255,V*255]},t.xyz.lab=function(d){let m=d[0],g=d[1],c=d[2];m/=95.047,g/=100,c/=108.883,m=m>.008856?m**(1/3):7.787*m+16/116,g=g>.008856?g**(1/3):7.787*g+16/116,c=c>.008856?c**(1/3):7.787*c+16/116;const C=116*g-16,R=500*(m-g),V=200*(g-c);return[C,R,V]},t.lab.xyz=function(d){const m=d[0],g=d[1],c=d[2];let C,R,V;R=(m+16)/116,C=g/500+R,V=R-c/200;const q=R**3,J=C**3,Y=V**3;return R=q>.008856?q:(R-16/116)/7.787,C=J>.008856?J:(C-16/116)/7.787,V=Y>.008856?Y:(V-16/116)/7.787,C*=95.047,R*=100,V*=108.883,[C,R,V]},t.lab.lch=function(d){const m=d[0],g=d[1],c=d[2];let C;C=Math.atan2(c,g)*360/2/Math.PI,C<0&&(C+=360);const R=Math.sqrt(g*g+c*c);return[m,R,C]},t.lch.lab=function(d){const m=d[0],g=d[1],c=d[2]/360*2*Math.PI,C=g*Math.cos(c),R=g*Math.sin(c);return[m,C,R]},t.rgb.ansi16=function(d,m=null){const[g,c,C]=d;let R=m===null?t.rgb.hsv(d)[2]:m;if(R=Math.round(R/50),R===0)return 30;let V=30+(Math.round(C/255)<<2|Math.round(c/255)<<1|Math.round(g/255));return R===2&&(V+=60),V},t.hsv.ansi16=function(d){return t.rgb.ansi16(t.hsv.rgb(d),d[2])},t.rgb.ansi256=function(d){const m=d[0],g=d[1],c=d[2];return m===g&&g===c?m<8?16:m>248?231:Math.round((m-8)/247*24)+232:16+36*Math.round(m/255*5)+6*Math.round(g/255*5)+Math.round(c/255*5)},t.ansi16.rgb=function(d){let m=d%10;if(m===0||m===7)return d>50&&(m+=3.5),m=m/10.5*255,[m,m,m];const g=(~~(d>50)+1)*.5,c=(m&1)*g*255,C=(m>>1&1)*g*255,R=(m>>2&1)*g*255;return[c,C,R]},t.ansi256.rgb=function(d){if(d>=232){const R=(d-232)*10+8;return[R,R,R]}d-=16;let m;const g=Math.floor(d/36)/5*255,c=Math.floor((m=d%36)/6)/5*255,C=m%6/5*255;return[g,c,C]},t.rgb.hex=function(d){const m=(((Math.round(d[0])&255)<<16)+((Math.round(d[1])&255)<<8)+(Math.round(d[2])&255)).toString(16).toUpperCase();return"000000".substring(m.length)+m},t.hex.rgb=function(d){const m=d.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!m)return[0,0,0];let g=m[0];m[0].length===3&&(g=g.split("").map(q=>q+q).join(""));const c=parseInt(g,16),C=c>>16&255,R=c>>8&255,V=c&255;return[C,R,V]},t.rgb.hcg=function(d){const m=d[0]/255,g=d[1]/255,c=d[2]/255,C=Math.max(Math.max(m,g),c),R=Math.min(Math.min(m,g),c),V=C-R;let q,J;return V<1?q=R/(1-V):q=0,V<=0?J=0:C===m?J=(g-c)/V%6:C===g?J=2+(c-m)/V:J=4+(m-g)/V,J/=6,J%=1,[J*360,V*100,q*100]},t.hsl.hcg=function(d){const m=d[1]/100,g=d[2]/100,c=g<.5?2*m*g:2*m*(1-g);let C=0;return c<1&&(C=(g-.5*c)/(1-c)),[d[0],c*100,C*100]},t.hsv.hcg=function(d){const m=d[1]/100,g=d[2]/100,c=m*g;let C=0;return c<1&&(C=(g-c)/(1-c)),[d[0],c*100,C*100]},t.hcg.rgb=function(d){const m=d[0]/360,g=d[1]/100,c=d[2]/100;if(g===0)return[c*255,c*255,c*255];const C=[0,0,0],R=m%1*6,V=R%1,q=1-V;let J=0;switch(Math.floor(R)){case 0:C[0]=1,C[1]=V,C[2]=0;break;case 1:C[0]=q,C[1]=1,C[2]=0;break;case 2:C[0]=0,C[1]=1,C[2]=V;break;case 3:C[0]=0,C[1]=q,C[2]=1;break;case 4:C[0]=V,C[1]=0,C[2]=1;break;default:C[0]=1,C[1]=0,C[2]=q}return J=(1-g)*c,[(g*C[0]+J)*255,(g*C[1]+J)*255,(g*C[2]+J)*255]},t.hcg.hsv=function(d){const m=d[1]/100,g=d[2]/100,c=m+g*(1-m);let C=0;return c>0&&(C=m/c),[d[0],C*100,c*100]},t.hcg.hsl=function(d){const m=d[1]/100,g=d[2]/100*(1-m)+.5*m;let c=0;return g>0&&g<.5?c=m/(2*g):g>=.5&&g<1&&(c=m/(2*(1-g))),[d[0],c*100,g*100]},t.hcg.hwb=function(d){const m=d[1]/100,g=d[2]/100,c=m+g*(1-m);return[d[0],(c-m)*100,(1-c)*100]},t.hwb.hcg=function(d){const m=d[1]/100,g=1-d[2]/100,c=g-m;let C=0;return c<1&&(C=(g-c)/(1-c)),[d[0],c*100,C*100]},t.apple.rgb=function(d){return[d[0]/65535*255,d[1]/65535*255,d[2]/65535*255]},t.rgb.apple=function(d){return[d[0]/255*65535,d[1]/255*65535,d[2]/255*65535]},t.gray.rgb=function(d){return[d[0]/100*255,d[0]/100*255,d[0]/100*255]},t.gray.hsl=function(d){return[0,0,d[0]]},t.gray.hsv=t.gray.hsl,t.gray.hwb=function(d){return[0,100,d[0]]},t.gray.cmyk=function(d){return[0,0,0,d[0]]},t.gray.lab=function(d){return[d[0],0,0]},t.gray.hex=function(d){const m=Math.round(d[0]/100*255)&255,g=((m<<16)+(m<<8)+m).toString(16).toUpperCase();return"000000".substring(g.length)+g},t.rgb.gray=function(d){return[(d[0]+d[1]+d[2])/3/255*100]},Xx}var Yx,KE;function sj(){if(KE)return Yx;KE=1;const n=GM();function e(){const m={},g=Object.keys(n);for(let c=g.length,C=0;C<c;C++)m[g[C]]={distance:-1,parent:null};return m}function t(m){const g=e(),c=[m];for(g[m].distance=0;c.length;){const C=c.pop(),R=Object.keys(n[C]);for(let V=R.length,q=0;q<V;q++){const J=R[q],Y=g[J];Y.distance===-1&&(Y.distance=g[C].distance+1,Y.parent=C,c.unshift(J))}}return g}function a(m,g){return function(c){return g(m(c))}}function d(m,g){const c=[g[m].parent,m];let C=n[g[m].parent][m],R=g[m].parent;for(;g[R].parent;)c.unshift(g[R].parent),C=a(n[g[R].parent][R],C),R=g[R].parent;return C.conversion=c,C}return Yx=function(m){const g=t(m),c={},C=Object.keys(g);for(let R=C.length,V=0;V<R;V++){const q=C[V];g[q].parent!==null&&(c[q]=d(q,g))}return c},Yx}var Qx,XE;function oj(){if(XE)return Qx;XE=1;const n=GM(),e=sj(),t={},a=Object.keys(n);function d(g){const c=function(...C){const R=C[0];return R==null?R:(R.length>1&&(C=R),g(C))};return"conversion"in g&&(c.conversion=g.conversion),c}function m(g){const c=function(...C){const R=C[0];if(R==null)return R;R.length>1&&(C=R);const V=g(C);if(typeof V=="object")for(let q=V.length,J=0;J<q;J++)V[J]=Math.round(V[J]);return V};return"conversion"in g&&(c.conversion=g.conversion),c}return a.forEach(g=>{t[g]={},Object.defineProperty(t[g],"channels",{value:n[g].channels}),Object.defineProperty(t[g],"labels",{value:n[g].labels});const c=e(g);Object.keys(c).forEach(C=>{const R=c[C];t[g][C]=m(R),t[g][C].raw=d(R)})}),Qx=t,Qx}var lj=oj();const uj=rj(lj);function YE({gl:n,type:e,source:t}){const a=n.createShader(e);if(a===null)throw new Error("Cannot create shader");if(n.shaderSource(a,t),n.compileShader(a),!n.getShaderParameter(a,n.COMPILE_STATUS))throw console.error("Shader compilation error:",n.getShaderInfoLog(a)),n.deleteShader(a),new Error("Cannot compile shader");return a}function cj({gl:n,vertexShaderSource:e,fragmentShaderSource:t}){const a=YE({gl:n,type:n.VERTEX_SHADER,source:e}),d=YE({gl:n,type:n.FRAGMENT_SHADER,source:t}),m=n.createProgram();if(n.attachShader(m,a),n.attachShader(m,d),n.linkProgram(m),!n.getProgramParameter(m,n.LINK_STATUS))throw console.error("Error: ",n.getProgramInfoLog(m)),new Error("Cannot link shader program");return m}function hj(n,e,t){const a=n.getUniformLocation(e,t);if(a===null)throw new Error(`Cannot get uniform location for ${t}`);return a}function HM({gl:n,vertexShaderSource:e,fragmentShaderSource:t,attributesKeys:a,uniformsKeys:d,vertices:m,indices:g}){const c=cj({gl:n,vertexShaderSource:e,fragmentShaderSource:t}),C=a.reduce((Y,xe)=>(Y[xe]=n.getAttribLocation(c,`a_${xe}`),Y),{}),R=d.reduce((Y,xe)=>(Y[xe]=hj(n,c,`u_${xe}`),Y),{}),V=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,V),n.bufferData(n.ARRAY_BUFFER,new Float32Array(m),n.STATIC_DRAW);let q,J;return g!==void 0&&(q=n.createBuffer(),J=g.length,n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,q),n.bufferData(n.ELEMENT_ARRAY_BUFFER,new Uint16Array(g),n.STATIC_DRAW)),{shaderProgram:c,programInfo:{attributesLocations:C,uniformsLocations:R},positionBuffer:V,indexBuffer:q,indexBufferLength:J}}function R0(n){if(!n)return[1,1,1,0];if(n==="transparent")return[1,1,1,0];try{const e=dj(n),t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})?$/i.exec(e);if(t!=null&&t.length){const d=!!t[4];return[...uj.hex.rgb(e).map(m=>m/255),d?parseInt(t[4],16)/255:1]}const a=e.match(/(\d\.\d(\d+)?|\d{3}|\d{2}|\d{1})/gi)??["0","0","0"];if(e.includes("rgb")){const d=e.includes("rgba"),m=[...a.map(g=>parseFloat(g)).map((g,c)=>c<3?g/255:g)];return d||m.push(1),m}}catch{}return console.warn([`[parseColorStringToVec4]: Color ${n} is either not a valid color or its type is not supported, defaulting to black`]),[0,0,0,1]}let U_;function dj(n){return U_=U_??document.createElement("canvas").getContext("2d"),U_?(U_.fillStyle=n,U_.fillStyle):"#000000"}const F2=1,zc=F2/2,Oc=F2/2,Nc=F2/2,fj=[-.5,-.5,Nc,zc,-.5,Nc,zc,Oc,Nc,-.5,Oc,Nc],pj=[-.5,-.5,-.5,-.5,Oc,-.5,zc,Oc,-.5,zc,-.5,-.5],mj=[-.5,Oc,-.5,-.5,Oc,Nc,zc,Oc,Nc,zc,Oc,-.5],gj=[-.5,-.5,-.5,zc,-.5,-.5,zc,-.5,Nc,-.5,-.5,Nc],_j=[zc,-.5,-.5,zc,Oc,-.5,zc,Oc,Nc,zc,-.5,Nc],yj=[-.5,-.5,-.5,-.5,-.5,Nc,-.5,Oc,Nc,-.5,Oc,-.5],vj=[...fj,...pj,...mj,...gj,..._j,...yj],bj=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23],xj=`attribute vec3 a_vertexPosition;
varying vec3 vTextureCoord;

uniform mat4 u_projectionMatrix;
uniform mat4 u_modelViewMatrix;
  
void main(void) {
  vTextureCoord = vec3(-a_vertexPosition.x, a_vertexPosition.y, a_vertexPosition.z);
  gl_Position = u_projectionMatrix * u_modelViewMatrix * vec4(a_vertexPosition, 1.0);
}
`,QE=`precision mediump float;

varying vec3 vTextureCoord;

%USE_TEXTURE_MACRO_MARKER%

# ifdef USE_TEXTURE
uniform samplerCube u_cubeSampler;
uniform float u_fadeOpacity;
# endif

uniform vec4 u_bgColor;

void main(void) {
  #ifdef USE_TEXTURE
  vec4 texColor = textureCube(u_cubeSampler, vTextureCoord);

    gl_FragColor = mix(
      u_bgColor,
      texColor,
      min(texColor.a, u_fadeOpacity)
    );

    gl_FragColor.a = max(gl_FragColor.a, u_fadeOpacity);

  #else
  gl_FragColor = u_bgColor;
  #endif
}
`,Xp={stars:{color:"hsl(233,100%,92%)",preset:"stars"},space:{color:"hsl(210, 100%, 4%)",preset:"space"},milkyway:{color:"hsl(233,100%,92%)",preset:"milkyway"},"milkyway-subtle":{color:"hsl(233,100%,92%)",preset:"milkyway-subtle"},"milkyway-bright":{color:"hsl(233,100%,92%)",preset:"milkyway-bright"},"milkyway-colored":{color:"black",preset:"milkyway-colored"}};var Vp=(n=>(n.POSITIVE_X="pX",n.NEGATIVE_X="nX",n.POSITIVE_Y="pY",n.NEGATIVE_Y="nY",n.POSITIVE_Z="pZ",n.NEGATIVE_Z="nZ",n))(Vp||{});let n0,JE,eA;function wj({gl:n,faces:e,onReady:t,forceRefresh:a}){n0&&!a&&eA===JSON.stringify(e)&&t(n0,JE),eA=JSON.stringify(e);const d=n0??n.createTexture();if(n.bindTexture(n.TEXTURE_CUBE_MAP,d),!e){console.warn("[CubemapLayer][loadCubemapTexture]: Faces are null");return}const m=Object.keys(e).length;if(m!==6){console.warn(`[CubemapLayer][loadCubemapTexture]: Faces should contain exactly 6 images, but found ${m}`);return}const g=Object.entries(e).map(([c,C])=>new Promise((R,V)=>{const q=c;if(C===void 0){V(new Error(`[CubemapLayer][loadCubemapTexture]: Face ${c} is undefined`));return}const J=new Image;J.crossOrigin="anonymous";const Y=()=>{R({image:J,key:q})};J.src=C,J.complete&&J.naturalWidth>0?Y():J.onload=Y,J.onerror=()=>{V(new Error(`[CubemapLayer][loadCubemapTexture]: Error loading image ${C}`))}}));Promise.all(g).then(c=>{for(let R=0;R<c.length;R++){const V=n.RGBA,q=n.RGBA,J=n.UNSIGNED_BYTE,{image:Y,key:xe}=c[R]??{};if(!Y||!xe){console.warn("[CubemapLayer][loadCubemapTexture]: Image or key is null");continue}const be=Tj(n,xe);n.bindTexture(n.TEXTURE_CUBE_MAP,d),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texImage2D(be,0,V,q,J,Y)}n.bindTexture(n.TEXTURE_CUBE_MAP,d),n.generateMipmap(n.TEXTURE_CUBE_MAP),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_MIN_FILTER,n.LINEAR_MIPMAP_LINEAR),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_MAG_FILTER,n.LINEAR);const C=c.map(R=>R.image);t(d,C),JE=C,n0=d}).catch(c=>{console.error("[CubemapLayer][loadCubemapTexture]: Error loading cubemap texture",c)})}function Tj(n,e){if(e===Vp.POSITIVE_X)return n.TEXTURE_CUBE_MAP_POSITIVE_X;if(e===Vp.NEGATIVE_X)return n.TEXTURE_CUBE_MAP_NEGATIVE_X;if(e===Vp.POSITIVE_Y)return n.TEXTURE_CUBE_MAP_POSITIVE_Y;if(e===Vp.NEGATIVE_Y)return n.TEXTURE_CUBE_MAP_NEGATIVE_Y;if(e===Vp.POSITIVE_Z)return n.TEXTURE_CUBE_MAP_POSITIVE_Z;if(e===Vp.NEGATIVE_Z)return n.TEXTURE_CUBE_MAP_NEGATIVE_Z;throw new Error(`[CubemapLayer][loadCubemapTexture]: Invalid key ${e}`)}function Sj(n,e,t){return[Nf(n[0],e[0],t),Nf(n[1],e[1],t),Nf(n[2],e[2],t),Nf(n[3],e[3],t)]}function Nf(n,e,t){return n+(e-n)*t}const Ym="https://api.maptiler.com/resources/space",Ej=["vertexPosition"],Aj=["projectionMatrix","modelViewMatrix","cubeSampler","bgColor","fadeOpacity"],tA="%USE_TEXTURE_MACRO_MARKER%",Cj="#define USE_TEXTURE",nA=Xp.stars;function Ij(n,e){if(!ZM(n))return{color:"transparent"};if(n===!0)return e;const t={...n};if(n.faces||n.path)return delete t.preset,t;const a=n.preset;if(a!==void 0&&!(a in Xp))throw new Error(`[CubemapLayer]: Invalid preset "${a}". Available presets: ${Object.keys(Xp).join(", ")}`);return{...t,color:t.color??Xp[a].color??"hsl(233,100%,92%)"}}class Jx{constructor(e){rn(this,"id","Cubemap Layer"),rn(this,"type","custom"),rn(this,"renderingMode","3d"),rn(this,"map"),rn(this,"faces"),rn(this,"useCubemapTexture",!0),rn(this,"currentFadeOpacity",0),rn(this,"cubeMapNeedsUpdate",!1),rn(this,"bgColor"),rn(this,"previousBgColor",[0,0,0,0]),rn(this,"targetBgColor",[0,0,0,0]),rn(this,"transitionDelta",0),rn(this,"gl"),rn(this,"cubemap"),rn(this,"texture"),rn(this,"currentFacesDefinitionKey",""),rn(this,"options"),rn(this,"animationActive",!0),rn(this,"imageIsAnimating",!1),rn(this,"imageFadeInDelta",0);const t=Ij(e,nA);this.options=t,this.currentFacesDefinitionKey=JSON.stringify(t.faces??t.preset??t.path),this.bgColor=[0,0,0,0],this.targetBgColor=R0(t.color),this.faces=iA(t),this.useCubemapTexture=this.faces!==null}updateCubemap({facesNeedUpdate:e}={facesNeedUpdate:!0}){this.useCubemapTexture=this.faces!==null;const t=Aj.filter(a=>a==="cubeSampler"||a==="fadeOpacity"?this.useCubemapTexture:!0);this.cubemap=HM({gl:this.gl,vertexShaderSource:xj,fragmentShaderSource:this.useCubemapTexture?QE.replace(tA,Cj):QE.replace(tA,""),attributesKeys:Ej,uniformsKeys:t,vertices:vj,indices:bj}),this.cubeMapNeedsUpdate=e,this.useCubemapTexture&&this.updateTexture(this.gl,this.faces),this.animateColorChange()}onAdd(e,t){this.map=e,this.gl=t,this.updateCubemap()}onRemove(e,t){this.cubemap&&(t.deleteProgram(this.cubemap.shaderProgram),t.deleteBuffer(this.cubemap.positionBuffer))}updateTexture(e,t){if(this.cubeMapNeedsUpdate===!0&&!this.imageIsAnimating){if(this.cubeMapNeedsUpdate=!1,!this.useCubemapTexture)return;wj({gl:e,faces:t,onReady:a=>{this.texture=a,this.animateIn()}})}}prerender(e,t){this.faces&&this.updateTexture(this.gl,this.faces)}animateColorChange(){const e=()=>{this.transitionDelta<1&&(requestAnimationFrame(e),this.bgColor=Sj(this.previousBgColor,this.targetBgColor,this.transitionDelta),this.transitionDelta+=.075,this.map.triggerRepaint())};requestAnimationFrame(e)}async animateIn(){if(!this.imageIsAnimating){if(!this.animationActive){this.currentFadeOpacity=1,this.imageFadeInDelta=1,this.map.triggerRepaint();return}return new Promise(e=>{this.imageIsAnimating=!0;const t=()=>{if(this.imageFadeInDelta=Math.min(this.imageFadeInDelta+.05,1),this.currentFadeOpacity=Nf(0,1,this.imageFadeInDelta),this.map.triggerRepaint(),this.imageFadeInDelta<1){requestAnimationFrame(t);return}this.imageIsAnimating=!1,this.imageFadeInDelta=0,e()};requestAnimationFrame(t)})}}async animateOut(){if(!(this.imageIsAnimating||!this.animationActive))return new Promise(e=>{const t=()=>{if(this.imageFadeInDelta=Math.min(this.imageFadeInDelta+.05,1),this.currentFadeOpacity=Nf(1,0,this.imageFadeInDelta),this.map.triggerRepaint(),this.imageFadeInDelta>=1){this.imageIsAnimating=!1,this.imageFadeInDelta=0,e();return}requestAnimationFrame(t)};requestAnimationFrame(t)})}setAnimationActive(e){this.animationActive=e}render(e,t){if(!this.map.isGlobeProjection())return;if(this.map===void 0)throw new Error("[CubemapLayer]: Map is undefined");if(this.cubemap===void 0)throw new Error("[CubemapLayer]: Cubemap is undefined");this.texture,e.disable(e.DEPTH_TEST),e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.DST_ALPHA),e.useProgram(this.cubemap.shaderProgram),e.bindBuffer(e.ARRAY_BUFFER,this.cubemap.positionBuffer),e.vertexAttribPointer(this.cubemap.programInfo.attributesLocations.vertexPosition,3,e.FLOAT,!1,0,0),e.enableVertexAttribArray(this.cubemap.programInfo.attributesLocations.vertexPosition);const a=.1,d=1e4,m=e.canvas,g=m.clientWidth/m.clientHeight,c=this.map.transform,C=c.fov*(Math.PI/180),R=ly();nj(R,C,g,a,d),qE(R,R,c.rollInRadians),$E(R,R,-c.pitchInRadians),qE(R,R,c.bearingInRadians);const V=c.center.lat*Math.PI/180,q=c.center.lng*Math.PI/180;$E(R,R,V),ej(R,R,-q),e.uniformMatrix4fv(this.cubemap.programInfo.uniformsLocations.projectionMatrix,!1,R);const J=ly();if(e.uniformMatrix4fv(this.cubemap.programInfo.uniformsLocations.modelViewMatrix,!1,J),e.uniform4fv(this.cubemap.programInfo.uniformsLocations.bgColor,new Float32Array(this.bgColor)),e.uniform1f(this.cubemap.programInfo.uniformsLocations.fadeOpacity,this.currentFadeOpacity),this.useCubemapTexture&&this.texture&&(e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_CUBE_MAP,this.texture),e.uniform1i(this.cubemap.programInfo.uniformsLocations.cubeSampler,0)),this.cubemap.indexBuffer===void 0)throw new Error("Index buffer is undefined");if(this.cubemap.indexBufferLength===void 0)throw new Error("Index buffer length is undefined");e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.cubemap.indexBuffer),e.drawElements(e.TRIANGLES,this.cubemap.indexBufferLength,e.UNSIGNED_SHORT,0)}setBgColor(e){this.targetBgColor=e,this.previousBgColor=this.bgColor,this.transitionDelta=0}getConfig(){return this.options}async setCubemapFaces(e){if(await this.animateOut(),!e.faces&&!e.preset&&!e.path){this.faces=null,this.useCubemapTexture=!1,this.currentFacesDefinitionKey="empty",await this.animateIn();return}this.faces=iA(e),this.currentFacesDefinitionKey=JSON.stringify(e.faces??e.preset??e.path)}async setCubemap(e){const t=typeof e=="boolean"?nA:e;this.options=t;const a=JSON.stringify(t.faces??t.preset??t.path),d=this.currentFacesDefinitionKey!==a;d&&(await this.setCubemapFaces(t),this.cubeMapNeedsUpdate=!0);const m=R0(t.color);if(t.color&&this.targetBgColor.toString()!==m.toString())this.setBgColor(m);else if(!t.color&&t.preset&&t.preset in Xp){const g=Xp[t.preset];this.setBgColor(R0(g.color))}this.updateCubemap({facesNeedUpdate:d})}show(){this.map.setLayoutProperty(this.id,"visibility","visible")}hide(){this.map.setLayoutProperty(this.id,"visibility","none")}}function ZM(n){return n?typeof n=="boolean"?!0:!(!n.path&&!n.preset&&!n.faces&&!n.color||n.preset&&!(n.preset in Xp)||n.faces&&(!n.faces.pX||!n.faces.nX||!n.faces.pY||!n.faces.nY||!n.faces.pZ||!n.faces.nZ)):!1}function iA(n){if(n.faces)return n.faces;if(n.preset)return{pX:`${Ym}/${n.preset}/px.webp`,nX:`${Ym}/${n.preset}/nx.webp`,pY:`${Ym}/${n.preset}/py.webp`,nY:`${Ym}/${n.preset}/ny.webp`,pZ:`${Ym}/${n.preset}/pz.webp`,nZ:`${Ym}/${n.preset}/nz.webp`};if(n.path){const e=n.path.baseUrl,t=n.path.format??"png";return{pX:`${e}/px.${t}`,nX:`${e}/nx.${t}`,pY:`${e}/py.${t}`,nY:`${e}/ny.${t}`,pZ:`${e}/pz.${t}`,nZ:`${e}/nz.${t}`}}return null}const Pj=`attribute vec3 a_position;

uniform mat4 u_matrix;
uniform mat4 u_rotationMatrix;

uniform float u_scale;

varying vec2 v_pos;
varying float v_scale;

void main() {
  v_scale = u_scale;
  v_pos = a_position.xy * u_scale;
  gl_Position = u_matrix * u_rotationMatrix * vec4(a_position, 1.0);
}
`,Mj=`precision mediump float;
varying vec2 v_pos;
      
uniform int u_stopsNumber;
uniform float u_stops[100];
uniform vec4 u_colors[100];
uniform float u_maxDistance;

varying float v_scale;

const float EPSILON = 0.000001;

vec2 center = vec2(0.0, 0.0);
void main() {
  float rawDistance = distance(center, v_pos);
  float distanceFromGlobeEdge = rawDistance - 1.0;

    vec4 color = u_colors[0];

  // if we're further than the max distance, we should not render anything.
  // This is to always render a circle, otherwise we end up rendering
  // to the corners of the plane.
  if (distance(center, v_pos) > u_maxDistance * v_scale) {
    discard;
  }

  for (int i = 1; i < 100; i++) {
    // if we're past the last stop
    // we should fill to the end with the last stop color
    if (i >= u_stopsNumber) {
      color = u_colors[i - 1];
      break;
    }

    float scaledStopPosition = u_stops[i] * pow(v_scale, 1.6);
    float lastStopValue = u_stops[i - 1];
    float thisStopValue = u_stops[i];

    // this is to avoid blending errors when the stops are the same
    // eg when you would want a sharp edge between two stops.
    // \`numbersAreEqual\` will be 1.0 if the numbers are equal, 0.0 if they are not.
    // We then subtract EPSILON from the last stop making the stop value _almost_ equal
    // to the next stop but not enough to cause blending issues.
    // It's more efficient to do this than an if / else statement.
    float numbersAreEqual = 1.0 - step(EPSILON, abs(lastStopValue - thisStopValue));
    lastStopValue = lastStopValue - numbersAreEqual * EPSILON;

    float lastScaledStopPosition = lastStopValue * pow(v_scale, 1.6);

    if (distanceFromGlobeEdge <= scaledStopPosition) {
      float stopBlendFactor = (distanceFromGlobeEdge - lastScaledStopPosition) / (scaledStopPosition - lastScaledStopPosition);
      color = mix(u_colors[i - 1], u_colors[i], stopBlendFactor);
      break;
    }
  }
  
  // gl_FragColor = color;
  gl_FragColor = vec4(color.rgb * color.a, color.a);
}
`,Y_=2,Rj=["position"],kj=["matrix","rotationMatrix","stopsNumber","stops","colors","maxDistance","scale"],Lj=[-2,-2,0,Y_,-2,0,-2,Y_,0,Y_,Y_,0],kp={scale:.9,stops:[[0,"rgba(176, 208, 240, 1)"],[.1,"rgba(98, 168, 229, 0.3)"],[.2,"rgba(98, 168, 229, 0.0)"]]},rA=.06;class e1{constructor(e){if(rn(this,"id","Halo Layer"),rn(this,"type","custom"),rn(this,"renderingMode","3d"),rn(this,"gradient"),rn(this,"scale",0),rn(this,"animationDelta",0),rn(this,"map"),rn(this,"plane"),rn(this,"animationActive",!0),typeof e=="boolean"){this.gradient=kp;return}this.gradient={...kp,...e}}onAdd(e,t){this.map=e,this.plane=HM({gl:t,vertexShaderSource:Pj,fragmentShaderSource:Mj,attributesKeys:Rj,uniformsKeys:kj,vertices:Lj}),this.animateIn()}getConfig(){return this.gradient}async animateIn(){if(!this.animationActive){this.scale=this.gradient.scale,this.animationDelta=1,this.map.triggerRepaint();return}return new Promise(e=>{this.animationDelta=0;const t=()=>{if(this.animationDelta<1){this.scale=Nf(0,this.gradient.scale,this.animationDelta),this.animationDelta+=rA,this.map.triggerRepaint(),requestAnimationFrame(t);return}e()};requestAnimationFrame(t)})}async animateOut(){if(this.animationActive)return this.animationDelta=0,new Promise(e=>{const t=()=>{if(this.animationDelta<1){this.scale=Nf(this.gradient.scale,0,this.animationDelta),this.animationDelta+=rA,this.map.triggerRepaint(),requestAnimationFrame(t);return}e()};t()})}onRemove(e,t){this.plane!==void 0&&(t.deleteProgram(this.plane.shaderProgram),t.deleteBuffer(this.plane.positionBuffer))}prerender(e,t){}render(e,t){if(this.map===void 0)throw new Error("[RadialGradientLayer]: Map is undefined");if(!this.map.isGlobeProjection())return;if(this.plane===void 0)throw new Error("[RadialGradientLayer]: Plane is undefined");e.disable(e.DEPTH_TEST),e.enable(e.BLEND),e.useProgram(this.plane.shaderProgram),e.bindBuffer(e.ARRAY_BUFFER,this.plane.positionBuffer);const a=this.plane.programInfo.attributesLocations.position;e.enableVertexAttribArray(a),e.vertexAttribPointer(a,3,e.FLOAT,!1,0,0);const d=ly(),m=this.scale;JU(d,d,[m,m,m]);const g=ly();QU(g,t.defaultProjectionData.mainMatrix,d);const c=this.plane.programInfo.uniformsLocations.matrix;e.uniformMatrix4fv(c,!1,g);const C=ly(),R=this.map.transform.cameraPosition,V=Kx(M0(),R),q=ij(0,1,0),J=M0();GE(J,q,V),Kx(J,J);const Y=M0();GE(Y,V,J),Kx(Y,Y),YU(C,J[0],J[1],J[2],0,Y[0],Y[1],Y[2],0,V[0],V[1],V[2],0,0,0,0,1);const xe=this.plane.programInfo.uniformsLocations.rotationMatrix;e.uniformMatrix4fv(xe,!1,C);const be=this.gradient.stops.length,Oe=[],et=[];for(let Je=0;Je<=be;Je++)if(Je<be){Oe[Je]=this.gradient.stops[Je][0];const qe=R0(this.gradient.stops[Je][1]);et.push(...qe)}e.uniform1i(this.plane.programInfo.uniformsLocations.stopsNumber,be),e.uniform1fv(this.plane.programInfo.uniformsLocations.stops,new Float32Array(Oe)),e.uniform4fv(this.plane.programInfo.uniformsLocations.colors,new Float32Array(et)),e.uniform1f(this.plane.programInfo.uniformsLocations.maxDistance,Y_),e.uniform1f(this.plane.programInfo.uniformsLocations.scale,m),e.drawArrays(e.TRIANGLE_STRIP,0,4)}async setGradient(e){if(e===!1){await this.animateOut();return}if(await this.animateOut(),!Dj(e)){this.gradient.scale=kp.scale,this.gradient.stops=[[0,"transparent"],[1,"transparent"]];return}e===!0?(this.gradient.scale=kp.scale,this.gradient.stops=kp.stops):(this.gradient.scale=e.scale??kp.scale,this.gradient.stops=e.stops??kp.stops),await this.animateIn()}setAnimationActive(e){this.animationActive=e}show(){this.map.setLayoutProperty(this.id,"visibility","visible")}hide(){this.map.setLayoutProperty(this.id,"visibility","none")}}function Dj(n){return typeof n=="boolean"?!0:!(typeof n.scale!="number"||!n.stops||n.stops.length===0||n.stops.some(e=>typeof e[0]!="number"||typeof e[1]!="string"))}const zj={POINT:"POINT",COUNTRY:"COUNTRY"};let WM=class KM extends wn.Map{constructor(e){gF(e.container),e.apiKey&&(Ya.apiKey=e.apiKey);const{style:t,requiresUrlMonitoring:a,isFallback:d}=VE(e.style);d&&console.warn("Invalid style. A style must be a valid URL to a style.json, a JSON string representing a valid StyleSpecification or a valid StyleSpecification object. Fallback to default MapTiler style."),Ya.apiKey||console.warn("MapTiler Cloud API key is not set. Visit https://maptiler.com and try Cloud for free!");const m=location.hash;let g={compact:!1};e.customAttribution?g.customAttribution=e.customAttribution:e.attributionControl&&typeof e.attributionControl=="object"&&(g={...g,...e.attributionControl});const c={...e,style:t,maplibreLogo:!1,transformRequest:_E(e.transformRequest),attributionControl:e.forceNoAttributionControl===!0?!1:g};delete c.style,super(c),rn(this,"telemetry"),rn(this,"space"),rn(this,"halo"),rn(this,"options"),rn(this,"isTerrainEnabled",!1),rn(this,"terrainExaggeration",1),rn(this,"primaryLanguage"),rn(this,"terrainGrowing",!1),rn(this,"terrainFlattening",!1),rn(this,"minimap"),rn(this,"forceLanguageUpdate"),rn(this,"languageAlwaysBeenStyle"),rn(this,"isReady",!1),rn(this,"terrainAnimationDuration",1e3),rn(this,"monitoredStyleUrls"),rn(this,"styleInProcess",!1),rn(this,"curentProjection"),rn(this,"originalLabelStyle",new window.Map),rn(this,"isStyleLocalized",!1),rn(this,"languageIsUpdated",!1),rn(this,"spaceboxLoadingState",{styleLoadCallbackSet:!1}),this.options=e,this.setStyle(t),a&&this.monitorStyleUrl(t);const C=()=>{let Y="The distant style could not be loaded.";this.getStyle()?Y+="Leaving the style as is.":(this.setStyle(ay.STREETS),Y+=`Loading default MapTiler Cloud style "${ay.STREETS.getDefaultVariant().getId()}" as a fallback.`),console.warn(Y)};if(this.on("style.load",()=>{this.styleInProcess=!1}),this.on("error",Y=>{if(Y.error instanceof wn.AJAXError){const xe=Y.error.url,be=new URL(xe);be.search="";const Oe=be.href;this.monitoredStyleUrls&&this.monitoredStyleUrls.has(Oe)&&(this.monitoredStyleUrls.delete(Oe),C());return}if(this.styleInProcess){C();return}}),Ya.caching&&!$1&&console.warn("The cache API is only available in secure contexts. More info at https://developer.mozilla.org/en-US/docs/Web/API/Cache"),Ya.caching&&$1&&hF(),typeof e.language>"u")this.primaryLanguage=Ya.primaryLanguage;else{const Y=iE(e.language,er);this.primaryLanguage=Y??Ya.primaryLanguage}this.forceLanguageUpdate=!(this.primaryLanguage===er.STYLE||this.primaryLanguage===er.STYLE_LOCK),this.languageAlwaysBeenStyle=this.primaryLanguage===er.STYLE,this.terrainExaggeration=e.terrainExaggeration??this.terrainExaggeration,this.curentProjection=e.projection,this.on("styledata",()=>{this.curentProjection==="mercator"?this.setProjection({type:"mercator"}):this.curentProjection==="globe"&&this.setProjection({type:"globe"})}),this.once("styledata",async()=>{if(!e.geolocate||e.center||e.hash&&m)return;try{if(e.geolocate===zj.COUNTRY){await this.fitToIpBounds();return}}catch(xe){console.warn(xe.message)}let Y;try{await this.centerOnIpPoint(e.zoom),Y=this.getCameraHash()}catch(xe){console.warn(xe.message)}(await navigator.permissions.query({name:"geolocation"})).state==="granted"&&navigator.geolocation.getCurrentPosition(xe=>{Y===this.getCameraHash()&&(this.terrain?this.easeTo({center:[xe.coords.longitude,xe.coords.latitude],zoom:e.zoom||12,duration:2e3}):this.once("terrain",()=>{this.easeTo({center:[xe.coords.longitude,xe.coords.latitude],zoom:e.zoom||12,duration:2e3})}))},null,{maximumAge:24*3600*1e3,timeout:5e3,enableHighAccuracy:!1})}),this.on("styledata",()=>{this.setPrimaryLanguage(this.primaryLanguage)}),this.on("styledata",()=>{this.getTerrain()===null&&this.isTerrainEnabled&&this.enableTerrain(this.terrainExaggeration)}),this.once("load",async()=>{let Y={logo:null};try{const xe=Object.keys(this.style.sourceCaches).map(Oe=>this.getSource(Oe)).filter(Oe=>Oe&&"url"in Oe&&typeof Oe.url=="string"&&Oe.url.includes("tiles.json")),be=new URL(xe[0].url);be.searchParams.has("key")||be.searchParams.append("key",Ya.apiKey),Y=await(await fetch(be.href)).json()}catch{}if(e.customControls){const xe="[data-maptiler-control-group]",be="[data-maptiler-control]",Oe=je=>{let Be=je.dataset.maptilerControl;return(Be==="true"||Be==="")&&(Be=void 0),Be},et=je=>je.dataset.maptilerPosition;let Je=[...this._container.ownerDocument.querySelectorAll(xe)],qe=[...this._container.ownerDocument.querySelectorAll(be)].filter(je=>je.closest(xe)===null);if(typeof e.customControls=="string"){const je=e.customControls;Je=Je.filter(Be=>Be.matches(je)||Be.closest(je)!==null),qe=qe.filter(Be=>Be.matches(je)||Be.closest(je)!==null)}for(const je of Je){const Be=new Q1(je);this.addControl(Be,et(je));for(const de of je.querySelectorAll(be))Be.configureGroupItem(de,Oe(de))}for(const je of qe)this.addControl(new Q1(je,Oe(je)),et(je));const Ze=()=>{const{lng:je,lat:Be}=this.getCenter();this._container.style.setProperty("--maptiler-center-lng",String(je)),this._container.style.setProperty("--maptiler-center-lat",String(Be)),this._container.style.setProperty("--maptiler-zoom",String(this.getZoom())),this._container.style.setProperty("--maptiler-bearing",String(this.getBearing())),this._container.style.setProperty("--maptiler-pitch",String(this.getPitch())),this._container.style.setProperty("--maptiler-roll",String(this.getRoll())),this._container.style.setProperty("--maptiler-is-globe-projection",String(this.isGlobeProjection())),this._container.style.setProperty("--maptiler-has-terrain",String(this.hasTerrain()))};Ze(),this.on("render",Ze)}if(e.forceNoAttributionControl!==!0)if("logo"in Y&&Y.logo){const xe=Y.logo;this.addControl(new vE({logoURL:xe}),e.logoPosition)}else e.maptilerLogo&&this.addControl(new vE,e.logoPosition);if(e.scaleControl){const xe=e.scaleControl===!0||e.scaleControl===void 0?"bottom-right":e.scaleControl,be=new CF({unit:Ya.unit});this.addControl(be,xe),Ya.on("unit",Oe=>{be.setUnit(Oe)})}if(e.navigationControl!==!1){const xe=e.navigationControl===!0||e.navigationControl===void 0?"top-right":e.navigationControl;this.addControl(new GU,xe)}if(e.geolocateControl!==!1){const xe=e.geolocateControl===!0||e.geolocateControl===void 0?"top-right":e.geolocateControl;this.addControl(new ZU({positionOptions:{enableHighAccuracy:!0,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!0,showAccuracyCircle:!0,showUserLocation:!0}),xe)}if(e.terrainControl){const xe=e.terrainControl===!0||e.terrainControl===void 0?"top-right":e.terrainControl;this.addControl(new qU,xe)}if(e.projectionControl){const xe=e.projectionControl===!0||e.projectionControl===void 0?"top-right":e.projectionControl;this.addControl(new KU,xe)}if(e.fullscreenControl){const xe=e.fullscreenControl===!0||e.fullscreenControl===void 0?"top-right":e.fullscreenControl;this.addControl(new IF({}),xe)}this.isReady=!0,this.fire("ready",{target:this})});let R=!1,V=!1,q;this.once("ready",()=>{R=!0,V&&this.fire("loadWithTerrain",q)}),this.once("style.load",()=>{const{minimap:Y}=e;if(typeof Y=="object"){const{zoom:xe,center:be,style:Oe,language:et,apiKey:Je,maptilerLogo:qe,canvasContextAttributes:Ze,refreshExpiredTiles:je,maxBounds:Be,scrollZoom:de,minZoom:ce,maxZoom:_e,boxZoom:Ae,locale:Me,fadeDuration:Ge,crossSourceCollisions:Re,clickTolerance:Pn,bounds:ei,fitBoundsOptions:mt,pixelRatio:$t,validateStyle:Tt}=e;this.minimap=new Wx(Y,{zoom:xe,center:be,style:Oe,language:et,apiKey:Je,container:"null",maptilerLogo:qe,canvasContextAttributes:Ze,refreshExpiredTiles:je,maxBounds:Be,scrollZoom:de,minZoom:ce,maxZoom:_e,boxZoom:Ae,locale:Me,fadeDuration:Ge,crossSourceCollisions:Re,clickTolerance:Pn,bounds:ei,fitBoundsOptions:mt,pixelRatio:$t,validateStyle:Tt}),this.addControl(this.minimap,Y.position??"bottom-left")}else Y===!0?(this.minimap=new Wx({},e),this.addControl(this.minimap,"bottom-left")):Y!==void 0&&Y!==!1&&(this.minimap=new Wx({},e),this.addControl(this.minimap,Y))});const J=Y=>{Y.terrain&&(V=!0,q={type:"loadWithTerrain",target:this,terrain:Y.terrain},this.off("terrain",J),R&&this.fire("loadWithTerrain",q))};this.on("terrain",J),e.terrain&&this.enableTerrain(e.terrainExaggeration??this.terrainExaggeration),this.once("load",()=>{this.getCanvas().addEventListener("webglcontextlost",xe=>{if(this._removed===!0){console.warn("[webglcontextlost]","WebGL context lost after map removal. This is harmless.");return}console.warn("[webglcontextlost]","Unexpected loss of WebGL context!"),this.fire("webglContextLost",xe)});const Y=this.getLayersOrder()[0];e.space&&this.initSpace({options:e,before:Y}),e.halo&&this.initHalo({options:e,before:Y})}),this.telemetry=new XU(this)}getSpace(){return this.space}setSpace(e){if(e===!1){this.space=void 0;return}if(this.isGlobeProjection()){if(this.space){this.space.setCubemap(e),this.getLayer(this.space.id)||this.addLayer(this.space,this.getLayersOrder()[0]);return}this.space=new Jx(e),this.once("load",()=>{const t=this.getLayersOrder()[0];this.space&&this.addLayer(this.space,t)})}}enableSpaceAnimations(){this.setSpaceAnimationActive(!0)}disableSpaceAnimations(){this.setSpaceAnimationActive(!1)}enableHaloAnimations(){this.setHaloAnimationActive(!0)}disableHaloAnimations(){this.setHaloAnimationActive(!1)}setHaloAnimationActive(e){this.halo?this.halo.setAnimationActive(e):this.once("load",()=>{var t;(t=this.halo)==null||t.setAnimationActive(e)})}setSpaceAnimationActive(e){this.space?this.space.setAnimationActive(e):this.once("load",()=>{var t;(t=this.space)==null||t.setAnimationActive(e)})}setSpaceFromStyle({style:e}){var t,a,d;if(this.options.space){this.setSpace(this.options.space);return}const m=(a=(t=e.metadata)==null?void 0:t.maptiler)==null?void 0:a.space;if(!m){this.setSpace({color:"transparent"});return}if(!ZM(m)){this.setSpace({color:"transparent"});return}if(JSON.stringify((d=this.space)==null?void 0:d.getConfig())===JSON.stringify(m)){if(this.space&&!this.getLayer(this.space.id)){const g=this.getLayersOrder()[0];this.addLayer(this.space,g)}return}(()=>{if(this.space&&this.isGlobeProjection()){if(!this.getLayer(this.space.id)){const g=this.getLayersOrder()[0];this.addLayer(this.space,g)}this.space.setCubemap(m)}})()}setHaloFromStyle({style:e}){var t,a,d;const m=(t=e.metadata)==null?void 0:t.maptiler;if(JSON.stringify((a=this.halo)==null?void 0:a.getConfig())===JSON.stringify(m==null?void 0:m.halo)){if(this.halo&&!this.getLayer(this.halo.id)){const g=this.getLayersOrder().indexOf(((d=this.space)==null?void 0:d.id)??"")+1,c=this.getLayersOrder()[g];this.addLayer(this.halo,c)}return}if(!(m!=null&&m.halo)&&!this.options.halo){this.setHalo({stops:[[0,"transparent"],[1,"transparent"]],scale:1});return}(()=>{var g;if(this.halo){if(!this.getLayer(this.halo.id)){const C=this.getLayersOrder().indexOf(((g=this.space)==null?void 0:g.id)??"")+1,R=this.getLayersOrder()[C];this.addLayer(this.halo,R)}const c=(m==null?void 0:m.halo)??this.options.halo;c&&this.halo.setGradient(c)}})()}initSpace({options:e=this.options,before:t,spec:a}){if(this.space){this.getLayer(this.space.id)||this.addLayer(this.space,t);return}if(e.space===!1)return;const d=a;if(e.space){this.space=new Jx(e.space),this.addLayer(this.space,t);return}d&&(this.space=new Jx(d),this.addLayer(this.space,t))}initHalo({options:e=this.options,before:t,spec:a}){if(this.halo&&this.getLayer(this.halo.id)||e.halo===!1)return;const d=a;if(e.halo){this.halo=new e1(e.halo),this.addLayer(this.halo,t);return}d&&(this.halo=new e1(d),this.addLayer(this.halo,t))}getHalo(){return this.halo}setHalo(e){if(this.isGlobeProjection()){if(this.halo){this.halo.setGradient(e);return}this.halo=new e1(e),this.once("load",()=>{var t;const a=this.getLayersOrder(),d=a[0],m=a.indexOf(((t=this.space)==null?void 0:t.id)??"")+2,g=a[m];this.halo&&this.addLayer(this.halo,this.space?g:d)})}}recreate(){const e={center:this.getCenter(),zoom:this.getZoom(),bearing:this.getBearing(),pitch:this.getPitch()};this.remove(),Object.assign(this,new KM({...this.options})),this.once("load",()=>{this.jumpTo(e)})}setTerrainAnimationDuration(e){this.terrainAnimationDuration=Math.max(e,0)}async onLoadAsync(){return new Promise(e=>{if(this.loaded()){e(this);return}this.once("load",()=>{e(this)})})}async onReadyAsync(){return new Promise(e=>{if(this.isReady){e(this);return}this.once("ready",()=>{e(this)})})}async onLoadWithTerrainAsync(){return new Promise(e=>{if(this.isReady&&this.terrain){e(this);return}this.once("loadWithTerrain",()=>{e(this)})})}monitorStyleUrl(e){typeof this.monitoredStyleUrls>"u"&&(this.monitoredStyleUrls=new Set);const t=new URL(e);t.search="",this.monitoredStyleUrls.add(t.href)}setStyle(e,t){var a,d,m,g,c;this.originalLabelStyle.clear(),(a=this.minimap)==null||a.setStyle(e),this.forceLanguageUpdate=!0,this.once("idle",()=>{this.forceLanguageUpdate=!1});const C=VE(e);if(C.requiresUrlMonitoring&&this.monitorStyleUrl(C.style),C.isFallback){if(this.getStyle())return console.warn("[Map.setStyle]: Invalid style. A style must be a valid URL to a style.json, a JSON string representing a valid StyleSpecification or a valid StyleSpecification object. Keeping the curent style instead."),this;console.warn("[Map.setStyle]: Invalid style. A style must be a valid URL to a style.json, a JSON string representing a valid StyleSpecification or a valid StyleSpecification object. Fallback to default MapTiler style.")}const R=this.getStyle(),V=C.style;try{super.setStyle(C.style,t),this.styleInProcess=!0}catch(Y){this.styleInProcess=!1,console.error("[Map.setStyle]: Error while setting style:",Y)}const q=()=>{const Y=C.style;if(!Y.projection||Y.projection.type==="mercator"){console.warn("[Map.setStyle]: Neither space nor halo is supported for mercator projection. Ignoring...");return}this.setSpaceFromStyle({style:C.style}),this.setHaloFromStyle({style:C.style})},J=Y=>{var xe,be,Oe,et;const Je=(Y==null?void 0:Y.target.getStyle())??C.style,qe=this.getLayersOrder()[0];this.space?this.setSpaceFromStyle({style:Je}):this.initSpace({before:qe,spec:(be=(xe=Je.metadata)==null?void 0:xe.maptiler)==null?void 0:be.space}),this.halo?this.setHaloFromStyle({style:Je}):this.initHalo({before:qe,spec:(et=(Oe=Je.metadata)==null?void 0:Oe.maptiler)==null?void 0:et.halo})};if(typeof C.style=="string"||C.requiresUrlMonitoring)return this.on("styledata",J),this;if(this.styleInProcess&&!this.spaceboxLoadingState.styleLoadCallbackSet)return this.once("style.load",J),this.once("styledata",J),this.spaceboxLoadingState.styleLoadCallbackSet=!0,this;if(((d=R==null?void 0:R.terrain)==null?void 0:d.source)!==((m=V==null?void 0:V.terrain)==null?void 0:m.source)||((g=R==null?void 0:R.terrain)==null?void 0:g.exaggeration)!==((c=V==null?void 0:V.terrain)==null?void 0:c.exaggeration))return this.once("terrain",q),this;try{J()}catch{}return this}addLayer(e,t){var a;return(a=this.minimap)==null||a.addLayer(e,t),super.addLayer(e,t)}moveLayer(e,t){var a;return(a=this.minimap)==null||a.moveLayer(e,t),super.moveLayer(e,t)}removeLayer(e){var t;return(t=this.minimap)==null||t.removeLayer(e),super.removeLayer(e)}setLayerZoomRange(e,t,a){var d;return(d=this.minimap)==null||d.setLayerZoomRange(e,t,a),super.setLayerZoomRange(e,t,a)}setFilter(e,t,a){var d;return(d=this.minimap)==null||d.setFilter(e,t,a),super.setFilter(e,t,a)}setPaintProperty(e,t,a,d){var m;return(m=this.minimap)==null||m.setPaintProperty(e,t,a,d),super.setPaintProperty(e,t,a,d)}setLayoutProperty(e,t,a,d){var m;return(m=this.minimap)==null||m.setLayoutProperty(e,t,a,d),super.setLayoutProperty(e,t,a,d)}setGlyphs(e,t){var a;return(a=this.minimap)==null||a.setGlyphs(e,t),super.setGlyphs(e,t)}getStyleLanguage(){return!this.style||!this.style.stylesheet||!this.style.stylesheet.metadata||typeof this.style.stylesheet.metadata!="object"?null:"maptiler:language"in this.style.stylesheet.metadata&&typeof this.style.stylesheet.metadata["maptiler:language"]=="string"?B1(this.style.stylesheet.metadata["maptiler:language"]):null}setLanguage(e){var t;(t=this.minimap)==null||t.map.setLanguage(e),this.onStyleReady(()=>{this.setPrimaryLanguage(e)})}setPrimaryLanguage(e){const t=this.getStyleLanguage(),a=iE(e,er);if(!a){console.warn(`The language "${a}" is not supported.`);return}if(!(a.flag===er.STYLE.flag&&t&&(t.flag===er.AUTO.flag||t.flag===er.VISITOR.flag))&&(a.flag!==er.STYLE.flag&&(this.languageAlwaysBeenStyle=!1),this.languageAlwaysBeenStyle||this.primaryLanguage===a&&!this.forceLanguageUpdate))return;if(this.primaryLanguage.flag===er.STYLE_LOCK.flag){console.warn("The language cannot be changed because this map has been instantiated with the STYLE_LOCK language flag.");return}this.primaryLanguage=a;let d=a;if(a.flag===er.STYLE.flag){if(!t){console.warn("The style has no default languages or has an invalid one.");return}d=t}let m=er.LOCAL.flag,g=["get",m];d.flag===er.VISITOR.flag?(m=fE().flag,g=["case",["all",["has",m],["has",er.LOCAL.flag]],["case",["==",["get",m],["get",er.LOCAL.flag]],["get",er.LOCAL.flag],["format",["get",m],{"font-scale":.8},`
`,["get",er.LOCAL.flag],{"font-scale":1.1}]],["get",er.LOCAL.flag]]):d.flag===er.VISITOR_ENGLISH.flag?(m=er.ENGLISH.flag,g=["case",["all",["has",m],["has",er.LOCAL.flag]],["case",["==",["get",m],["get",er.LOCAL.flag]],["get",er.LOCAL.flag],["format",["get",m],{"font-scale":.8},`
`,["get",er.LOCAL.flag],{"font-scale":1.1}]],["get",er.LOCAL.flag]]):d.flag===er.AUTO.flag?(m=fE().flag,g=["coalesce",["get",m],["get",er.LOCAL.flag]]):d===er.LOCAL?(m=er.LOCAL.flag,g=["get",m]):(m=d.flag,g=["coalesce",["get",m],["get",er.LOCAL.flag]]);const{layers:c}=this.getStyle(),C=this.originalLabelStyle.size===0;if(C){const R=TF(c,this);this.isStyleLocalized=Object.keys(R.localized).length>0}for(const R of c){if(R.type!=="symbol")continue;const V=R,q=this.getSource(V.source);if(!q||!("url"in q&&typeof q.url=="string")||new URL(q.url).host!==Gl.maptilerApiHost)continue;const{id:J,layout:Y}=V;if(!Y||!("text-field"in Y))continue;let xe;if(C?(xe=this.getLayoutProperty(J,"text-field"),this.originalLabelStyle.set(J,xe)):xe=this.originalLabelStyle.get(J),typeof xe=="string"){const{contains:be,exactMatch:Oe}=yF(xe,this.isStyleLocalized);if(!be)continue;if(Oe)this.setLayoutProperty(J,"text-field",g);else{const et=vF(xe,g,this.isStyleLocalized);this.setLayoutProperty(J,"text-field",et)}}else{const be=_F(xe,g,this.isStyleLocalized);this.setLayoutProperty(J,"text-field",be)}}this.languageIsUpdated=!0}getPrimaryLanguage(){return this.primaryLanguage}getTerrainExaggeration(){return this.terrainExaggeration}hasTerrain(){return this.isTerrainEnabled}growTerrain(e){if(!this.terrain)return;const t=performance.now(),a=this.terrain.exaggeration,d=e-a,m=()=>{if(!this.terrain||this.terrainFlattening)return;const g=(performance.now()-t)/this.terrainAnimationDuration;if(g<.99){const c=1-(1-g)**4,C=a+c*d;this.terrain.exaggeration=C,requestAnimationFrame(m)}else this.terrainGrowing=!1,this.terrainFlattening=!1,this.terrain.exaggeration=e,this.fire("terrainAnimationStop",{terrain:this.terrain});this._elevationFreeze=!1,this.triggerRepaint()};!this.terrainGrowing&&!this.terrainFlattening&&this.fire("terrainAnimationStart",{terrain:this.terrain}),this.terrainGrowing=!0,this.terrainFlattening=!1,requestAnimationFrame(m)}enableTerrain(e=this.terrainExaggeration){if(e<0){console.warn("Terrain exaggeration cannot be negative.");return}const t=d=>{!this.terrain||d.type!=="data"||d.dataType!=="source"||!("source"in d)||d.sourceId!=="maptiler-terrain"||d.source.type!=="raster-dem"||d.isSourceLoaded&&(this.off("data",t),this.growTerrain(e))},a=()=>{this.isTerrainEnabled=!0,this.terrainExaggeration=e,this.on("data",t),this.addSource(Gl.terrainSourceId,{type:"raster-dem",url:Gl.terrainSourceURL}),this.setTerrain({source:Gl.terrainSourceId,exaggeration:0})};if(this.getTerrain()){this.isTerrainEnabled=!0,this.growTerrain(e);return}if(this.loaded()||this.isTerrainEnabled)a();else{const d=()=>{this.getTerrain()&&this.getSource(Gl.terrainSourceId)||a()};this.once("load",()=>{d()}),this.once("moveend",()=>{d()})}}disableTerrain(){if(!this.terrain)return;this.isTerrainEnabled=!1;const e=performance.now(),t=this.terrain.exaggeration,a=()=>{if(!this.terrain||this.terrainGrowing)return;const d=(performance.now()-e)/this.terrainAnimationDuration;if(this._elevationFreeze=!1,d<.99){const m=(1-d)**4,g=t*m;this.terrain.exaggeration=g,requestAnimationFrame(a)}else this.terrain.exaggeration=0,this.terrainGrowing=!1,this.terrainFlattening=!1,this.setTerrain(),this.getSource(Gl.terrainSourceId)&&this.removeSource(Gl.terrainSourceId),this.fire("terrainAnimationStop",{terrain:null});this.triggerRepaint()};!this.terrainGrowing&&!this.terrainFlattening&&this.fire("terrainAnimationStart",{terrain:this.terrain}),this.terrainGrowing=!1,this.terrainFlattening=!0,requestAnimationFrame(a)}setTerrainExaggeration(e,t=!0){!t&&this.terrain?(this.terrainExaggeration=e,this.terrain.exaggeration=e,this.triggerRepaint()):this.enableTerrain(e)}onStyleReady(e){this.isStyleLoaded()?e():this.once("styledata",()=>{e()})}async fitToIpBounds(){const e=await aE.info();this.fitBounds(e.country_bounds,{duration:0,padding:100})}async centerOnIpPoint(e){const t=await aE.info();this.jumpTo({center:[t.longitude??0,t.latitude??0],zoom:e||11})}getCameraHash(){const e=new Float32Array(5),t=this.getCenter();return e[0]=t.lng,e[1]=t.lat,e[2]=this.getZoom(),e[3]=this.getPitch(),e[4]=this.getBearing(),nF.fromUint8Array(new Uint8Array(e.buffer))}getSdkConfig(){return Ya}getMaptilerSessionId(){return _2}setTransformRequest(e){return super.setTransformRequest(_E(e)),this}isGlobeProjection(){const e=this.getProjection();return e?e.type==="globe":!1}enableGlobeProjection(){this.isGlobeProjection()!==!0&&(this.setProjection({type:"globe"}),this.curentProjection="globe")}enableMercatorProjection(){this.isGlobeProjection()!==!1&&(this.setProjection({type:"mercator"}),this.curentProjection="mercator")}isLanguageUpdated(){return this.languageIsUpdated}};wn.Evented;function V2(n){if(typeof DOMParser<"u"){const e=new DOMParser().parseFromString(n,"application/xml");if(e.querySelector("parsererror"))throw new Error("The provided string is not valid XML");return e}throw new Error("No XML parser found")}function XM(n,e){if(!n.hasChildNodes())return!1;for(const t of Array.from(n.childNodes)){const a=t.nodeName;if(typeof a=="string"&&a.trim().toLowerCase()===e.toLowerCase())return!0}return!1}function aA(n){if(typeof XMLSerializer<"u")return new XMLSerializer().serializeToString(n);throw new Error("No XML serializer found")}function YM(n){const e=typeof n=="string"?V2(n):n;if(!XM(e,"gpx"))throw new Error("The XML document is not valid GPX");const t=To(e,"trk"),a=To(e,"rte"),d=To(e,"wpt"),m={type:"FeatureCollection",features:[]};for(const g of Array.from(t)){const c=Fj(g);c&&m.features.push(c)}for(const g of Array.from(a)){const c=Vj(g);c&&m.features.push(c)}for(const g of Array.from(d))m.features.push(Uj(g));return m}function QM(n,e){let t=n;if(typeof t=="string"&&(t=V2(t)),!XM(t,"kml"))throw new Error("The XML document is not valid KML");const a={type:"FeatureCollection",features:[]},d={},m={},g={},c=To(t,"Placemark"),C=To(t,"Style"),R=To(t,"StyleMap");for(const V of Array.from(C)){const q=oA(aA(V)).toString(16);d[`#${Yp(V,"id")}`]=q,m[q]=V}for(const V of Array.from(R)){d[`#${Yp(V,"id")}`]=oA(aA(V)).toString(16);const q=To(V,"Pair"),J={};for(const Y of Array.from(q))J[Er(ti(Y,"key"))??""]=Er(ti(Y,"styleUrl"));g[`#${Yp(V,"id")}`]=J}for(const V of Array.from(c))a.features=a.features.concat(Bj(V,d,m,g));return a}function sA(n){if(n===null)return["#000000",1];let e="",t=1,a=n;return a.startsWith("#")&&(a=a.substring(1)),(a.length===6||a.length===3)&&(e=a),a.length===8&&(t=Number.parseInt(a.substring(0,2),16)/255,e=`#${a.substring(6,8)}${a.substring(4,6)}${a.substring(2,4)}`),[e??"#000000",t??1]}function Oj(n){return tR(n.split(" "))}function Nj(n){let e=To(n,"coord");const t=[],a=[];e.length===0&&(e=To(n,"gx:coord"));for(const m of Array.from(e))t.push(Oj(Er(m)??""));const d=To(n,"when");for(const m of Array.from(d))a.push(Er(m));return{coords:t,times:a}}function k0(n){const e=["Polygon","LineString","Point","Track","gx:Track"];let t,a,d,m,g;const c=[],C=[];if(ti(n,"MultiGeometry")!==null)return k0(ti(n,"MultiGeometry"));if(ti(n,"MultiTrack")!==null)return k0(ti(n,"MultiTrack"));if(ti(n,"gx:MultiTrack")!==null)return k0(ti(n,"gx:MultiTrack"));for(d=0;d<e.length;d++)if(a=To(n,e[d]),a){for(m=0;m<a.length;m++)if(t=a[m],e[d]==="Point")c.push({type:"Point",coordinates:nR(Er(ti(t,"coordinates"))??"")});else if(e[d]==="LineString")c.push({type:"LineString",coordinates:uA(Er(ti(t,"coordinates"))??"")});else if(e[d]==="Polygon"){const R=To(t,"LinearRing"),V=[];for(g=0;g<R.length;g++)V.push(uA(Er(ti(R[g],"coordinates"))??""));c.push({type:"Polygon",coordinates:V})}else if(e[d]==="Track"||e[d]==="gx:Track"){const R=Nj(t);c.push({type:"LineString",coordinates:R.coords}),R.times.length&&C.push(R.times)}}return{geoms:c,coordTimes:C}}function Bj(n,e,t,a){const d=k0(n),m={},g=Er(ti(n,"name")),c=Er(ti(n,"address")),C=Er(ti(n,"description")),R=ti(n,"TimeSpan"),V=ti(n,"TimeStamp"),q=ti(n,"ExtendedData"),J=ti(n,"visibility");let Y,xe=Er(ti(n,"styleUrl")),be=ti(n,"LineStyle"),Oe=ti(n,"PolyStyle");if(!d.geoms.length)return[];if(g&&(m.name=g),c&&(m.address=c),xe){xe.startsWith("#")||(xe=`#${xe}`),m.styleUrl=xe,e[xe]&&(m.styleHash=e[xe]),a[xe]&&(m.styleMapHash=a[xe],m.styleHash=e[a[xe].normal??""]);const Je=t[m.styleHash??""];if(Je){be||(be=ti(Je,"LineStyle")),Oe||(Oe=ti(Je,"PolyStyle"));const qe=ti(Je,"IconStyle");if(qe){const Ze=ti(qe,"Icon");if(Ze){const je=Er(ti(Ze,"href"));je&&(m.icon=je)}}}}if(C&&(m.description=C),R){const Je=Er(ti(R,"begin")),qe=Er(ti(R,"end"));Je&&qe&&(m.timespan={begin:Je,end:qe})}if(V!==null&&(m.timestamp=Er(ti(V,"when"))??new Date().toISOString()),be!==null){const Je=sA(Er(ti(be,"color"))),qe=Je[0],Ze=Je[1],je=Number.parseFloat(Er(ti(be,"width"))??"");qe&&(m.stroke=qe),Number.isNaN(Ze)||(m["stroke-opacity"]=Ze),Number.isNaN(je)||(m["stroke-width"]=je)}if(Oe){const Je=sA(Er(ti(Oe,"color"))),qe=Je[0],Ze=Je[1],je=Er(ti(Oe,"fill")),Be=Er(ti(Oe,"outline"));qe&&(m.fill=qe),Number.isNaN(Ze)||(m["fill-opacity"]=Ze),je&&(m["fill-opacity"]=je==="1"?m["fill-opacity"]||1:0),Be&&(m["stroke-opacity"]=Be==="1"?m["stroke-opacity"]||1:0)}if(q){const Je=To(q,"Data"),qe=To(q,"SimpleData");for(Y=0;Y<Je.length;Y++)m[Je[Y].getAttribute("name")??""]=Er(ti(Je[Y],"value"))??"";for(Y=0;Y<qe.length;Y++)m[qe[Y].getAttribute("name")??""]=Er(qe[Y])??""}J!==null&&(m.visibility=Er(J)??""),d.coordTimes.length!==0&&(m.coordTimes=d.coordTimes.length===1?d.coordTimes[0]:d.coordTimes);const et={type:"Feature",geometry:d.geoms.length===1?d.geoms[0]:{type:"GeometryCollection",geometries:d.geoms},properties:m};return Yp(n,"id")&&(et.id=Yp(n,"id")??void 0),[et]}function JM(n,e){const t=To(n,e),a=[],d=[];let m=[];const g=t.length;if(!(g<2)){for(let c=0;c<g;c++){const C=iR(t[c]);a.push(C.coordinates),C.time&&d.push(C.time),(C.heartRate||m.length)&&(m.length===0&&(m=new Array(c).fill(null)),m.push(C.heartRate))}return{line:a,times:d,heartRates:m}}}function Fj(n){const e=To(n,"trkseg"),t=[],a=[],d=[];let m;for(let c=0;c<e.length;c++)if(m=JM(e[c],"trkpt"),m!==void 0&&(m.line&&t.push(m.line),m.times&&m.times.length&&a.push(m.times),d.length||m.heartRates&&m.heartRates.length)){if(!d.length)for(let C=0;C<c;C++)d.push(new Array(t[C].length).fill(null));m.heartRates&&m.heartRates.length?d.push(m.heartRates):d.push(new Array(m.line.length).fill(null))}if(t.length===0)return;const g={...U2(n),...eR(ti(n,"extensions"))};return a.length!==0&&(g.coordTimes=t.length===1?a[0]:a),d.length!==0&&(g.heartRates=t.length===1?d[0]:d),t.length===1?{type:"Feature",properties:g,geometry:{type:"LineString",coordinates:t[0]}}:{type:"Feature",properties:g,geometry:{type:"MultiLineString",coordinates:t}}}function Vj(n){const e=JM(n,"rtept");return e===void 0?void 0:{type:"Feature",properties:{...U2(n),...eR(ti(n,"extensions"))},geometry:{type:"LineString",coordinates:e.line}}}function Uj(n){return{type:"Feature",properties:{...U2(n),...J1(n,["sym"])},geometry:{type:"Point",coordinates:iR(n).coordinates}}}function eR(n){const e={};if(n){const t=ti(n,"line");if(t){const a=Er(ti(t,"color")),d=Number.parseFloat(Er(ti(t,"opacity"))??"0"),m=Number.parseFloat(Er(ti(t,"width"))??"0");a&&(e.stroke=a),Number.isNaN(d)||(e["stroke-opacity"]=d),Number.isNaN(m)||(e["stroke-width"]=m*96/25.4)}}return e}function U2(n){const e=J1(n,["name","cmt","desc","type","time","keywords"]),t=To(n,"link");if(t.length!==0){e.links=[];for(const a of Array.from(t)){const d={href:Yp(a,"href"),...J1(a,["text","type"])};e.links.push(d)}}return e}function oA(n){let e=0;if(!n||!n.length)return e;for(let t=0;t<n.length;t++)e=(e<<5)-e+n.charCodeAt(t)|0;return e}function To(n,e){return n.getElementsByTagName(e)}function Yp(n,e){return n.getAttribute(e)}function lA(n,e){return Number.parseFloat(Yp(n,e)??"0")}function ti(n,e){const t=To(n,e);return t.length?t[0]:null}function jj(n){return n.normalize&&n.normalize(),n}function tR(n){return n.map(Number.parseFloat).map(e=>Number.isNaN(e)?null:e)}function Er(n){return n&&jj(n),n&&n.textContent}function J1(n,e){const t={};let a,d;for(d=0;d<e.length;d++)a=ti(n,e[d]),a&&(t[e[d]]=Er(a)??"");return t}function nR(n){return tR(n.replace(/\s*/g,"").split(","))}function uA(n){const e=n.replace(/^\s*|\s*$/g,"").split(/\s+/),t=[];for(const a of e)t.push(nR(a));return t}function iR(n){const e=[lA(n,"lon"),lA(n,"lat")],t=ti(n,"ele"),a=ti(n,"gpxtpx:hr")||ti(n,"hr"),d=ti(n,"time");let m;return t&&(m=Number.parseFloat(Er(t)??"0"),Number.isNaN(m)||e.push(m)),{coordinates:e,time:d?Er(d):null,heartRate:a!==null?Number.parseFloat(Er(a)??"0"):null}}function $j(n){let e=n;try{typeof e=="string"&&(e=V2(e))}catch{return null}try{return YM(e)}catch{}try{return QM(e)}catch{}return null}async function qj(n,e={}){const t=e.download??!1,a=await Gj(n);if(t){const d=e.filename??"maptiler_screenshot.png",m=document.createElement("a");m.style.display="none",document.body.appendChild(m),m.href=URL.createObjectURL(a),m.download=d,m.click(),setTimeout(()=>{document.body.removeChild(m),URL.revokeObjectURL(m.href)},0)}return a}function Gj(n){return new Promise((e,t)=>{n.redraw(),n.once("idle",()=>{n.getCanvas().toBlob(a=>{if(!a){t(Error("Screenshot could not be created."));return}e(a)},"image/png")})})}const ew=[["#1D5B79","#468B97","#EF6262","#F3AA60"],["#614BC3","#33BBC5","#85E6C5","#C8FFE0"],["#461959","#7A316F","#CD6688","#AED8CC"],["#0079FF","#00DFA2","#F6FA70","#FF0060"],["#39B5E0","#A31ACB","#FF78F0","#F5EA5A"],["#37E2D5","#590696","#C70A80","#FBCB0A"],["#FFD36E","#FFF56D","#99FFCD","#9FB4FF"],["#00EAD3","#FFF5B7","#FF449F","#005F99"],["#10A19D","#540375","#FF7000","#FFBF00"]];function Jb(){return ew[~~(Math.random()*ew.length)][~~(Math.random()*4)]}function Xy(){return`maptiler_source_${nM()}`}function Yy(){return`maptiler_layer_${nM()}`}function tw(n,e){if(e<=n[0].zoom)return n[0].value;if(e>=n[n.length-1].zoom)return n[n.length-1].value;for(let t=0;t<n.length-1;t+=1)if(e>=n[t].zoom&&e<n[t+1].zoom){const a=n[t+1].zoom-n[t].zoom,d=(e-n[t].zoom)/a;return d*n[t+1].value+(1-d)*n[t].value}return 0}function $f(n){return["interpolate",["linear"],["zoom"],...n.flatMap(e=>[e.zoom,e.value])]}function vr(n){return["interpolate",["linear"],["zoom"],...n.flatMap(e=>[e.zoom,e.value])]}function rR(n,e){if(typeof e=="number"&&typeof n=="number")return 2*e+n;if(typeof e=="number"&&Array.isArray(n))return["interpolate",["linear"],["zoom"],...n.flatMap(t=>[t.zoom,2*e+t.value])];if(typeof n=="number"&&Array.isArray(e))return["interpolate",["linear"],["zoom"],...e.flatMap(t=>[t.zoom,2*t.value+n])];if(Array.isArray(n)&&Array.isArray(e)){const t=Array.from(new Set([...n.map(a=>a.zoom),...e.map(a=>a.zoom)])).sort((a,d)=>a<d?-1:1);return["interpolate",["linear"],["zoom"],...t.flatMap(a=>[a,2*tw(e,a)+tw(n,a)])]}return 0}function aR(n,e){return["interpolate",["linear"],["get",e],...n.flatMap(t=>[t.propertyValue,t.value])]}function j2(n){const e=n.trimStart(),t=`${e}${" ".repeat(n.length-e.length)}`,a=Array.from(t);if(!a.every(m=>m===" "||m==="_"))throw new Error("A dash pattern must be composed only of whitespace and underscore characters.");if(!(a.some(m=>m==="_")&&a.some(m=>m===" ")))throw new Error("A dash pattern must contain at least one underscore and one whitespace character");const d=[1];for(let m=1;m<a.length;m+=1){const g=a[m-1],c=a[m];g===c?d[d.length-1]+=1:d.push(1)}return d}function nw(n,e){return["interpolate",["linear"],["get",e],...n.flatMap(t=>[t.value,t.color])]}function iw(n,e,t=!0){return t?["interpolate",["linear"],["zoom"],0,["interpolate",["linear"],["get",e],...n.flatMap(a=>[a.value,a.pointRadius*.025])],2,["interpolate",["linear"],["get",e],...n.flatMap(a=>[a.value,a.pointRadius*.05])],4,["interpolate",["linear"],["get",e],...n.flatMap(a=>[a.value,a.pointRadius*.1])],8,["interpolate",["linear"],["get",e],...n.flatMap(a=>[a.value,a.pointRadius*.25])],16,["interpolate",["linear"],["get",e],...n.flatMap(a=>[a.value,a.pointRadius])]]:["interpolate",["linear"],["get",e],...n.flatMap(a=>[a.value,a.pointRadius])]}function sR(n,e,t=!0){return t?["interpolate",["linear"],["zoom"],0,["interpolate",["linear"],["get",e],...n.flatMap(a=>[a.propertyValue,a.value*.025])],2,["interpolate",["linear"],["get",e],...n.flatMap(a=>[a.propertyValue,a.value*.05])],4,["interpolate",["linear"],["get",e],...n.flatMap(a=>[a.propertyValue,a.value*.1])],8,["interpolate",["linear"],["get",e],...n.flatMap(a=>[a.propertyValue,a.value*.25])],16,["interpolate",["linear"],["get",e],...n.flatMap(a=>[a.propertyValue,a.value])]]:["interpolate",["linear"],["get",e],...n.flatMap(a=>[a.propertyValue,a.value])]}function rw(n,e){return n.every(t=>t.color[3]===n[0].color[3])?n[0].color[3]?n[0].color[3]/255:1:["interpolate",["linear"],["get",e],...n.getRawColorStops().flatMap(t=>{const a=t.value,d=t.color;return[a,d.length===4?d[3]/255:1]})]}function oR(n,e=10){return["interpolate",["linear"],["heatmap-density"],...Array.from({length:e+1},(t,a)=>{const d=a/e;return[d,n.getColorHex(d)]}).flat()]}function i0(n){const e=n.toString(16);return e.length===1?`0${e}`:e}function Hj(n){return`#${i0(n[0])}${i0(n[1])}${i0(n[2])}${n.length===4?i0(n[3]):""}`}class zn extends Array{constructor(e={}){super(),rn(this,"min",0),rn(this,"max",1),"min"in e&&(this.min=e.min),"max"in e&&(this.max=e.max),"stops"in e&&this.setStops(e.stops,{clone:!1})}static fromArrayDefinition(e){return new zn({stops:e.map(t=>({value:t[0],color:t[1]}))})}setStops(e,t={clone:!0}){const a=t.clone?this.clone():this;a.length=0;let d=Number.POSITIVE_INFINITY,m=Number.NEGATIVE_INFINITY;for(let g=0;g<e.length;g+=1)d=Math.min(d,e[g].value),m=Math.max(m,e[g].value),a.push({value:e[g].value,color:e[g].color.slice()});return a.sort((g,c)=>g.value<c.value?-1:1),this.min=d,this.max=m,a}scale(e,t,a={clone:!0}){const d=a.clone,m=this[0].value,g=this.at(-1).value-m,c=t-e,C=[];for(let R=0;R<this.length;R+=1){const V=(this[R].value-m)/g*c+e;d?C.push({value:V,color:this[R].color.slice()}):this[R].value=V}return d?new zn({stops:C}):this}at(e){return e<0?this[this.length+e]:this[e]}clone(){return new zn({stops:this.getRawColorStops()})}getRawColorStops(){const e=[];for(let t=0;t<this.length;t+=1)e.push({value:this[t].value,color:this[t].color});return e}reverse(e={clone:!0}){const t=e.clone?this.clone():this;for(let a=0;a<~~(t.length/2);a+=1){const d=t[a].color;t[a].color=t.at(-(a+1)).color,t.at(-(a+1)).color=d}return t}getBounds(){return{min:this.min,max:this.max}}getColor(e,t={smooth:!0}){if(e<=this[0].value)return this[0].color;if(e>=this.at(-1).value)return this.at(-1).color;for(let a=0;a<this.length-1;a+=1){if(e>this[a+1].value)continue;const d=this[a].color;if(!t.smooth)return d.slice();const m=this[a].value,g=this[a+1].value,c=this[a+1].color,C=(g-e)/(g-m);return d.map((R,V)=>Math.round(R*C+c[V]*(1-C)))}return[0,0,0]}getColorHex(e,t={smooth:!0,withAlpha:!1}){return Hj(this.getColor(e,t))}getColorRelative(e,t={smooth:!0}){const a=this.getBounds();return this.getColor(a.min+e*(a.max-a.min),t)}getCanvasStrip(e={horizontal:!0,size:512,smooth:!0}){const t=document.createElement("canvas");t.width=e.horizontal?e.size:1,t.height=e.horizontal?1:e.size;const a=t.getContext("2d");if(!a)throw new Error("Canvs context is missing");const d=a.getImageData(0,0,t.width,t.height),m=d.data,g=e.size,c=this[0].value,C=(this.at(-1).value-c)/g;for(let R=0;R<g;R+=1){const V=this.getColor(c+R*C,{smooth:e.smooth});m[R*4]=V[0],m[R*4+1]=V[1],m[R*4+2]=V[2],m[R*4+3]=V.length>3?V[3]:255}return a.putImageData(d,0,0),t}resample(e,t=15){const a=this.getBounds(),d=this.scale(0,1),m=1/(t-1);let g;if(e==="ease-in-square")g=Array.from({length:t},(c,C)=>{const R=C*m,V=R**2,q=d.getColor(V);return{value:R,color:q}});else if(e==="ease-out-square")g=Array.from({length:t},(c,C)=>{const R=C*m,V=1-(1-R)**2,q=d.getColor(V);return{value:R,color:q}});else if(e==="ease-out-sqrt")g=Array.from({length:t},(c,C)=>{const R=C*m,V=R**.5,q=d.getColor(V);return{value:R,color:q}});else if(e==="ease-in-sqrt")g=Array.from({length:t},(c,C)=>{const R=C*m,V=1-(1-R)**.5,q=d.getColor(V);return{value:R,color:q}});else if(e==="ease-out-exp")g=Array.from({length:t},(c,C)=>{const R=C*m,V=1-2**(-10*R),q=d.getColor(V);return{value:R,color:q}});else if(e==="ease-in-exp")g=Array.from({length:t},(c,C)=>{const R=C*m,V=2**(10*R-10),q=d.getColor(V);return{value:R,color:q}});else throw new Error("Invalid ressampling method.");return new zn({stops:g}).scale(a.min,a.max)}transparentStart(){const e=this.getRawColorStops();e.unshift({value:e[0].value,color:e[0].color.slice()}),e[1].value+=.001;for(const t of e)t.color.length===3&&t.color.push(255);return e[0].color[3]=0,new zn({stops:e})}hasTransparentStart(){return this[0].color.length===4&&this[0].color[3]===0}}const lR={NULL:new zn({stops:[{value:0,color:[0,0,0,0]},{value:1,color:[0,0,0,0]}]}),GRAY:new zn({stops:[{value:0,color:[0,0,0]},{value:1,color:[255,255,255]}]}),JET:new zn({stops:[{value:0,color:[0,0,131]},{value:.125,color:[0,60,170]},{value:.375,color:[5,255,255]},{value:.625,color:[255,255,0]},{value:.875,color:[250,0,0]},{value:1,color:[128,0,0]}]}),HSV:new zn({stops:[{value:0,color:[255,0,0]},{value:.169,color:[253,255,2]},{value:.173,color:[247,255,2]},{value:.337,color:[0,252,4]},{value:.341,color:[0,252,10]},{value:.506,color:[1,249,255]},{value:.671,color:[2,0,253]},{value:.675,color:[8,0,253]},{value:.839,color:[255,0,251]},{value:.843,color:[255,0,245]},{value:1,color:[255,0,6]}]}),HOT:new zn({stops:[{value:0,color:[0,0,0]},{value:.3,color:[230,0,0]},{value:.6,color:[255,210,0]},{value:1,color:[255,255,255]}]}),SPRING:new zn({stops:[{value:0,color:[255,0,255]},{value:1,color:[255,255,0]}]}),SUMMER:new zn({stops:[{value:0,color:[0,128,102]},{value:1,color:[255,255,102]}]}),AUTOMN:new zn({stops:[{value:0,color:[255,0,0]},{value:1,color:[255,255,0]}]}),WINTER:new zn({stops:[{value:0,color:[0,0,255]},{value:1,color:[0,255,128]}]}),BONE:new zn({stops:[{value:0,color:[0,0,0]},{value:.376,color:[84,84,116]},{value:.753,color:[169,200,200]},{value:1,color:[255,255,255]}]}),COPPER:new zn({stops:[{value:0,color:[0,0,0]},{value:.804,color:[255,160,102]},{value:1,color:[255,199,127]}]}),GREYS:new zn({stops:[{value:0,color:[0,0,0]},{value:1,color:[255,255,255]}]}),YIGNBU:new zn({stops:[{value:0,color:[8,29,88]},{value:.125,color:[37,52,148]},{value:.25,color:[34,94,168]},{value:.375,color:[29,145,192]},{value:.5,color:[65,182,196]},{value:.625,color:[127,205,187]},{value:.75,color:[199,233,180]},{value:.875,color:[237,248,217]},{value:1,color:[255,255,217]}]}),GREENS:new zn({stops:[{value:0,color:[0,68,27]},{value:.125,color:[0,109,44]},{value:.25,color:[35,139,69]},{value:.375,color:[65,171,93]},{value:.5,color:[116,196,118]},{value:.625,color:[161,217,155]},{value:.75,color:[199,233,192]},{value:.875,color:[229,245,224]},{value:1,color:[247,252,245]}]}),YIORRD:new zn({stops:[{value:0,color:[128,0,38]},{value:.125,color:[189,0,38]},{value:.25,color:[227,26,28]},{value:.375,color:[252,78,42]},{value:.5,color:[253,141,60]},{value:.625,color:[254,178,76]},{value:.75,color:[254,217,118]},{value:.875,color:[255,237,160]},{value:1,color:[255,255,204]}]}),BLUERED:new zn({stops:[{value:0,color:[0,0,255]},{value:1,color:[255,0,0]}]}),RDBU:new zn({stops:[{value:0,color:[5,10,172]},{value:.35,color:[106,137,247]},{value:.5,color:[190,190,190]},{value:.6,color:[220,170,132]},{value:.7,color:[230,145,90]},{value:1,color:[178,10,28]}]}),PICNIC:new zn({stops:[{value:0,color:[0,0,255]},{value:.1,color:[51,153,255]},{value:.2,color:[102,204,255]},{value:.3,color:[153,204,255]},{value:.4,color:[204,204,255]},{value:.5,color:[255,255,255]},{value:.6,color:[255,204,255]},{value:.7,color:[255,153,255]},{value:.8,color:[255,102,204]},{value:.9,color:[255,102,102]},{value:1,color:[255,0,0]}]}),RAINBOW:new zn({stops:[{value:0,color:[150,0,90]},{value:.125,color:[0,0,200]},{value:.25,color:[0,25,255]},{value:.375,color:[0,152,255]},{value:.5,color:[44,255,150]},{value:.625,color:[151,255,0]},{value:.75,color:[255,234,0]},{value:.875,color:[255,111,0]},{value:1,color:[255,0,0]}]}),PORTLAND:new zn({stops:[{value:0,color:[12,51,131]},{value:.25,color:[10,136,186]},{value:.5,color:[242,211,56]},{value:.75,color:[242,143,56]},{value:1,color:[217,30,30]}]}),BLACKBODY:new zn({stops:[{value:0,color:[0,0,0]},{value:.2,color:[230,0,0]},{value:.4,color:[230,210,0]},{value:.7,color:[255,255,255]},{value:1,color:[160,200,255]}]}),EARTH:new zn({stops:[{value:0,color:[0,0,130]},{value:.1,color:[0,180,180]},{value:.2,color:[40,210,40]},{value:.4,color:[230,230,50]},{value:.6,color:[120,70,20]},{value:1,color:[255,255,255]}]}),ELECTRIC:new zn({stops:[{value:0,color:[0,0,0]},{value:.15,color:[30,0,100]},{value:.4,color:[120,0,100]},{value:.6,color:[160,90,0]},{value:.8,color:[230,200,0]},{value:1,color:[255,250,220]}]}),VIRIDIS:new zn({stops:[{value:0,color:[68,1,84]},{value:.13,color:[71,44,122]},{value:.25,color:[59,81,139]},{value:.38,color:[44,113,142]},{value:.5,color:[33,144,141]},{value:.63,color:[39,173,129]},{value:.75,color:[92,200,99]},{value:.88,color:[170,220,50]},{value:1,color:[253,231,37]}]}),INFERNO:new zn({stops:[{value:0,color:[0,0,4]},{value:.13,color:[31,12,72]},{value:.25,color:[85,15,109]},{value:.38,color:[136,34,106]},{value:.5,color:[186,54,85]},{value:.63,color:[227,89,51]},{value:.75,color:[249,140,10]},{value:.88,color:[249,201,50]},{value:1,color:[252,255,164]}]}),MAGMA:new zn({stops:[{value:0,color:[0,0,4]},{value:.13,color:[28,16,68]},{value:.25,color:[79,18,123]},{value:.38,color:[129,37,129]},{value:.5,color:[181,54,122]},{value:.63,color:[229,80,100]},{value:.75,color:[251,135,97]},{value:.88,color:[254,194,135]},{value:1,color:[252,253,191]}]}),PLASMA:new zn({stops:[{value:0,color:[13,8,135]},{value:.13,color:[75,3,161]},{value:.25,color:[125,3,168]},{value:.38,color:[168,34,150]},{value:.5,color:[203,70,121]},{value:.63,color:[229,107,93]},{value:.75,color:[248,148,65]},{value:.88,color:[253,195,40]},{value:1,color:[240,249,33]}]}),WARM:new zn({stops:[{value:0,color:[125,0,179]},{value:.13,color:[172,0,187]},{value:.25,color:[219,0,170]},{value:.38,color:[255,0,130]},{value:.5,color:[255,63,74]},{value:.63,color:[255,123,0]},{value:.75,color:[234,176,0]},{value:.88,color:[190,228,0]},{value:1,color:[147,255,0]}]}),COOL:new zn({stops:[{value:0,color:[125,0,179]},{value:.13,color:[116,0,218]},{value:.25,color:[98,74,237]},{value:.38,color:[68,146,231]},{value:.5,color:[0,204,197]},{value:.63,color:[0,247,146]},{value:.75,color:[0,255,88]},{value:.88,color:[40,255,8]},{value:1,color:[147,255,0]}]}),RAINBOW_SOFT:new zn({stops:[{value:0,color:[125,0,179]},{value:.1,color:[199,0,180]},{value:.2,color:[255,0,121]},{value:.3,color:[255,108,0]},{value:.4,color:[222,194,0]},{value:.5,color:[150,255,0]},{value:.6,color:[0,255,55]},{value:.7,color:[0,246,150]},{value:.8,color:[50,167,222]},{value:.9,color:[103,51,235]},{value:1,color:[124,0,186]}]}),BATHYMETRY:new zn({stops:[{value:0,color:[40,26,44]},{value:.13,color:[59,49,90]},{value:.25,color:[64,76,139]},{value:.38,color:[63,110,151]},{value:.5,color:[72,142,158]},{value:.63,color:[85,174,163]},{value:.75,color:[120,206,163]},{value:.88,color:[187,230,172]},{value:1,color:[253,254,204]}]}),CDOM:new zn({stops:[{value:0,color:[47,15,62]},{value:.13,color:[87,23,86]},{value:.25,color:[130,28,99]},{value:.38,color:[171,41,96]},{value:.5,color:[206,67,86]},{value:.63,color:[230,106,84]},{value:.75,color:[242,149,103]},{value:.88,color:[249,193,135]},{value:1,color:[254,237,176]}]}),CHLOROPHYLL:new zn({stops:[{value:0,color:[18,36,20]},{value:.13,color:[25,63,41]},{value:.25,color:[24,91,59]},{value:.38,color:[13,119,72]},{value:.5,color:[18,148,80]},{value:.63,color:[80,173,89]},{value:.75,color:[132,196,122]},{value:.88,color:[175,221,162]},{value:1,color:[215,249,208]}]}),DENSITY:new zn({stops:[{value:0,color:[54,14,36]},{value:.13,color:[89,23,80]},{value:.25,color:[110,45,132]},{value:.38,color:[120,77,178]},{value:.5,color:[120,113,213]},{value:.63,color:[115,151,228]},{value:.75,color:[134,185,227]},{value:.88,color:[177,214,227]},{value:1,color:[230,241,241]}]}),FREESURFACE_BLUE:new zn({stops:[{value:0,color:[30,4,110]},{value:.13,color:[47,14,176]},{value:.25,color:[41,45,236]},{value:.38,color:[25,99,212]},{value:.5,color:[68,131,200]},{value:.63,color:[114,156,197]},{value:.75,color:[157,181,203]},{value:.88,color:[200,208,216]},{value:1,color:[241,237,236]}]}),FREESURFACE_RED:new zn({stops:[{value:0,color:[60,9,18]},{value:.13,color:[100,17,27]},{value:.25,color:[142,20,29]},{value:.38,color:[177,43,27]},{value:.5,color:[192,87,63]},{value:.63,color:[205,125,105]},{value:.75,color:[216,162,148]},{value:.88,color:[227,199,193]},{value:1,color:[241,237,236]}]}),OXYGEN:new zn({stops:[{value:0,color:[64,5,5]},{value:.13,color:[106,6,15]},{value:.25,color:[144,26,7]},{value:.38,color:[168,64,3]},{value:.5,color:[188,100,4]},{value:.63,color:[206,136,11]},{value:.75,color:[220,174,25]},{value:.88,color:[231,215,44]},{value:1,color:[248,254,105]}]}),PAR:new zn({stops:[{value:0,color:[51,20,24]},{value:.13,color:[90,32,35]},{value:.25,color:[129,44,34]},{value:.38,color:[159,68,25]},{value:.5,color:[182,99,19]},{value:.63,color:[199,134,22]},{value:.75,color:[212,171,35]},{value:.88,color:[221,210,54]},{value:1,color:[225,253,75]}]}),PHASE:new zn({stops:[{value:0,color:[145,105,18]},{value:.13,color:[184,71,38]},{value:.25,color:[186,58,115]},{value:.38,color:[160,71,185]},{value:.5,color:[110,97,218]},{value:.63,color:[50,123,164]},{value:.75,color:[31,131,110]},{value:.88,color:[77,129,34]},{value:1,color:[145,105,18]}]}),SALINITY:new zn({stops:[{value:0,color:[42,24,108]},{value:.13,color:[33,50,162]},{value:.25,color:[15,90,145]},{value:.38,color:[40,118,137]},{value:.5,color:[59,146,135]},{value:.63,color:[79,175,126]},{value:.75,color:[120,203,104]},{value:.88,color:[193,221,100]},{value:1,color:[253,239,154]}]}),TEMPERATURE:new zn({stops:[{value:0,color:[4,35,51]},{value:.13,color:[23,51,122]},{value:.25,color:[85,59,157]},{value:.38,color:[129,79,143]},{value:.5,color:[175,95,130]},{value:.63,color:[222,112,101]},{value:.75,color:[249,146,66]},{value:.88,color:[249,196,65]},{value:1,color:[232,250,91]}]}),TURBIDITY:new zn({stops:[{value:0,color:[34,31,27]},{value:.13,color:[65,50,41]},{value:.25,color:[98,69,52]},{value:.38,color:[131,89,57]},{value:.5,color:[161,112,59]},{value:.63,color:[185,140,66]},{value:.75,color:[202,174,88]},{value:.88,color:[216,209,126]},{value:1,color:[233,246,171]}]}),VELOCITY_BLUE:new zn({stops:[{value:0,color:[17,32,64]},{value:.13,color:[35,52,116]},{value:.25,color:[29,81,156]},{value:.38,color:[31,113,162]},{value:.5,color:[50,144,169]},{value:.63,color:[87,173,176]},{value:.75,color:[149,196,189]},{value:.88,color:[203,221,211]},{value:1,color:[254,251,230]}]}),VELOCITY_GREEN:new zn({stops:[{value:0,color:[23,35,19]},{value:.13,color:[24,64,38]},{value:.25,color:[11,95,45]},{value:.38,color:[39,123,35]},{value:.5,color:[95,146,12]},{value:.63,color:[152,165,18]},{value:.75,color:[201,186,69]},{value:.88,color:[233,216,137]},{value:1,color:[255,253,205]}]}),CUBEHELIX:new zn({stops:[{value:0,color:[0,0,0]},{value:.07,color:[22,5,59]},{value:.13,color:[60,4,105]},{value:.2,color:[109,1,135]},{value:.27,color:[161,0,147]},{value:.33,color:[210,2,142]},{value:.4,color:[251,11,123]},{value:.47,color:[255,29,97]},{value:.53,color:[255,54,69]},{value:.6,color:[255,85,46]},{value:.67,color:[255,120,34]},{value:.73,color:[255,157,37]},{value:.8,color:[241,191,57]},{value:.87,color:[224,220,93]},{value:.93,color:[218,241,142]},{value:1,color:[227,253,198]}]}),CIVIDIS:new zn({stops:[{value:0,color:[0,32,77,255]},{value:.125,color:[5,54,110,255]},{value:.25,color:[65,77,108,255]},{value:.375,color:[97,100,111,255]},{value:.5,color:[125,124,121,255]},{value:.625,color:[156,149,120,255]},{value:.75,color:[190,175,111,255]},{value:.875,color:[225,204,94,255]},{value:1,color:[255,235,70,255]}]}),TURBO:new zn({stops:[{value:0,color:[48,18,59,255]},{value:.125,color:[70,107,227,255]},{value:.25,color:[40,187,236,255]},{value:.375,color:[49,242,153,255]},{value:.5,color:[162,252,60,255]},{value:.625,color:[237,208,58,255]},{value:.75,color:[251,128,34,255]},{value:.875,color:[210,49,5,255]},{value:1,color:[122,4,3,255]}]}),ROCKET:new zn({stops:[{value:0,color:[250,235,221,0]},{value:.133,color:[250,235,221,255]},{value:.266,color:[246,170,130,255]},{value:.4,color:[240,96,67,255]},{value:.533,color:[203,27,79,255]},{value:.666,color:[132,30,90,255]},{value:.8,color:[63,27,68,255]},{value:1,color:[3,5,26,255]}]}),MAKO:new zn({stops:[{value:0,color:[11,4,5,255]},{value:.125,color:[43,28,53,255]},{value:.25,color:[62,53,107,255]},{value:.375,color:[59,86,152,255]},{value:.5,color:[53,123,162,255]},{value:.625,color:[53,158,170,255]},{value:.75,color:[73,193,173,255]},{value:.875,color:[150,221,181,255]},{value:1,color:[222,245,229,255]}]})};async function Zj(n,e,t={}){var a,d;if(!e.sourceId&&!e.data)throw new Error("Creating a polyline layer requires an existing .sourceId or a valid .data property");let m=e.data;if(typeof m=="string"){if(Ob(m))m=`https://api.maptiler.com/data/${e.data}/features.json?key=${Ya.apiKey}`;else if(((a=m.split(".").pop())==null?void 0:a.toLowerCase().trim())==="gpx"){const g=await(await fetch(m,t)).text();m=YM(g)}else if(((d=m.split(".").pop())==null?void 0:d.toLowerCase().trim())==="kml"){const g=await(await fetch(m,t)).text();m=QM(g)}else{const g=pF(m)??$j(m);g&&(m=g)}if(!m)throw new Error("Polyline data was provided as string but is incompatible with valid formats.")}return Wj(n,{...e,data:m})}function Wj(n,e){if(e.layerId&&n.getLayer(e.layerId))throw new Error(`A layer already exists with the layer id: ${e.layerId}`);const t=e.sourceId??Xy(),a=e.layerId??Yy(),d={polylineLayerId:a,polylineOutlineLayerId:"",polylineSourceId:t};e.data&&!n.getSource(t)&&n.addSource(t,{type:"geojson",data:e.data});const m=e.lineWidth??3,g=e.lineColor??Jb(),c=e.lineOpacity??1,C=e.lineBlur??0,R=e.lineGapWidth??0;let V=e.lineDashArray??null;const q=e.outlineWidth??1,J=e.outlineColor??"#FFFFFF",Y=e.outlineOpacity??1,xe=e.outlineBlur??0;if(typeof V=="string"&&(V=j2(V)),e.outline===!0){const be=`${a}_outline`;d.polylineOutlineLayerId=be,n.addLayer({id:be,type:"line",source:t,layout:{"line-join":e.lineJoin??"round","line-cap":e.lineCap??"round"},minzoom:e.minzoom??0,maxzoom:e.maxzoom??23,paint:{"line-opacity":typeof Y=="number"?Y:vr(Y),"line-color":typeof J=="string"?J:$f(J),"line-width":rR(m,q),"line-blur":typeof xe=="number"?xe:vr(xe)}},e.beforeId)}return n.addLayer({id:a,type:"line",source:t,layout:{"line-join":e.lineJoin??"round","line-cap":e.lineCap??"round"},minzoom:e.minzoom??0,maxzoom:e.maxzoom??23,paint:{"line-opacity":typeof c=="number"?c:vr(c),"line-color":typeof g=="string"?g:$f(g),"line-width":typeof m=="number"?m:vr(m),"line-blur":typeof C=="number"?C:vr(C),"line-gap-width":typeof R=="number"?R:vr(R),...V&&{"line-dasharray":V}}},e.beforeId),d}function Kj(n,e){if(e.layerId&&n.getLayer(e.layerId))throw new Error(`A layer already exists with the layer id: ${e.layerId}`);const t=e.sourceId??Xy(),a=e.layerId??Yy(),d={polygonLayerId:a,polygonOutlineLayerId:e.outline?`${a}_outline`:"",polygonSourceId:t};if(e.data&&!n.getSource(t)){let be=e.data;typeof be=="string"&&Ob(be)&&(be=`https://api.maptiler.com/data/${be}/features.json?key=${Ya.apiKey}`),n.addSource(t,{type:"geojson",data:be})}let m=e.outlineDashArray??null;const g=e.outlineWidth??1,c=e.outlineColor??"#FFFFFF",C=e.outlineOpacity??1,R=e.outlineBlur??0,V=e.fillColor??Jb(),q=e.fillOpacity??1,J=e.outlinePosition??"center",Y=e.pattern??null;typeof m=="string"&&(m=j2(m));const xe=(be=null)=>{if(n.addLayer({id:a,type:"fill",source:t,minzoom:e.minzoom??0,maxzoom:e.maxzoom??23,paint:{"fill-color":typeof V=="string"?V:$f(V),"fill-opacity":typeof q=="number"?q:vr(q),...be&&{"fill-pattern":be}}},e.beforeId),e.outline===!0){let Oe;J==="inside"?typeof g=="number"?Oe=.5*g:Oe=vr(g.map(({zoom:et,value:Je})=>({zoom:et,value:.5*Je}))):J==="outside"?typeof g=="number"?Oe=-.5*g:Oe=vr(g.map(et=>({zoom:et.zoom,value:-.5*et.value}))):Oe=0,n.addLayer({id:d.polygonOutlineLayerId,type:"line",source:t,layout:{"line-join":e.outlineJoin??"round","line-cap":e.outlineCap??"butt"},minzoom:e.minzoom??0,maxzoom:e.maxzoom??23,paint:{"line-opacity":typeof C=="number"?C:vr(C),"line-color":typeof c=="string"?c:$f(c),"line-width":typeof g=="number"?g:vr(g),"line-blur":typeof R=="number"?R:vr(R),"line-offset":Oe,...m&&{"line-dasharray":m}}},e.beforeId)}};return Y?n.hasImage(Y)?xe(Y):n.loadImage(Y).then(be=>{n.addImage(Y,be.data),xe(Y)}).catch(be=>{console.error("Could not load the pattern image.",be.message),xe()}):xe(),d}function Xj(n,e){if(e.layerId&&n.getLayer(e.layerId))throw new Error(`A layer already exists with the layer id: ${e.layerId}`);const t=e.minPointRadius??10,a=e.maxPointRadius??50,d=e.cluster??!1,m=20,g=Array.isArray(e.pointColor)?e.pointColor:lR.TURBO.scale(10,e.cluster?1e4:1e3).resample("ease-out-square"),c=g.getBounds(),C=e.sourceId??Xy(),R=e.layerId??Yy(),V=e.showLabel??d,q=e.alignOnViewport??!0,J=e.outline??!1,Y=e.outlineOpacity??1,xe=e.outlineWidth??1,be=e.outlineColor??"#FFFFFF";let Oe;const et=e.zoomCompensation??!0,Je=e.minzoom??0,qe=e.maxzoom??23;typeof e.pointOpacity=="number"?Oe=e.pointOpacity:Array.isArray(e.pointOpacity)?Oe=vr(e.pointOpacity):e.cluster?Oe=rw(g,"point_count"):e.property?Oe=rw(g,e.property):Oe=vr([{zoom:Je,value:0},{zoom:Je+.25,value:1},{zoom:qe-.25,value:1},{zoom:qe,value:0}]);const Ze={pointLayerId:R,clusterLayerId:"",labelLayerId:"",pointSourceId:C};if(e.data&&!n.getSource(C)){let je=e.data;typeof je=="string"&&Ob(je)&&(je=`https://api.maptiler.com/data/${je}/features.json?key=${Ya.apiKey}`),n.addSource(C,{type:"geojson",data:je,cluster:d})}if(d){Ze.clusterLayerId=`${R}_cluster`;const je=Array.from({length:m},(Be,de)=>{const ce=c.min+de*(c.max-c.min)/(m-1);return{value:ce,pointRadius:t+(a-t)*(de/(m-1))**.5,color:g.getColorHex(ce)}});n.addLayer({id:Ze.clusterLayerId,type:"circle",source:C,filter:["has","point_count"],paint:{"circle-color":typeof e.pointColor=="string"?e.pointColor:nw(je,"point_count"),"circle-radius":typeof e.pointRadius=="number"?e.pointRadius:Array.isArray(e.pointRadius)?vr(e.pointRadius):iw(je,"point_count",!1),"circle-pitch-alignment":q?"viewport":"map","circle-pitch-scale":"map","circle-opacity":Oe,...J&&{"circle-stroke-opacity":typeof Y=="number"?Y:vr(Y),"circle-stroke-width":typeof xe=="number"?xe:vr(xe),"circle-stroke-color":typeof be=="string"?be:$f(be)}},minzoom:Je,maxzoom:qe},e.beforeId),n.addLayer({id:Ze.pointLayerId,type:"circle",source:C,filter:["!",["has","point_count"]],paint:{"circle-pitch-alignment":q?"viewport":"map","circle-pitch-scale":"map","circle-color":typeof e.pointColor=="string"?e.pointColor:g.getColorHex(g.getBounds().min),"circle-radius":typeof e.pointRadius=="number"?e.pointRadius:Array.isArray(e.pointRadius)?vr(e.pointRadius):je[0].pointRadius*.75,"circle-opacity":Oe,...J&&{"circle-stroke-opacity":typeof Y=="number"?Y:vr(Y),"circle-stroke-width":typeof xe=="number"?xe:vr(xe),"circle-stroke-color":typeof be=="string"?be:$f(be)}},minzoom:Je,maxzoom:qe},e.beforeId)}else{let je=typeof e.pointColor=="string"?e.pointColor:Array.isArray(e.pointColor)?e.pointColor.getColorHex(e.pointColor.getBounds().min):Jb(),Be=typeof e.pointRadius=="number"?et?vr([{zoom:0,value:e.pointRadius*.025},{zoom:2,value:e.pointRadius*.05},{zoom:4,value:e.pointRadius*.1},{zoom:8,value:e.pointRadius*.25},{zoom:16,value:e.pointRadius*1}]):e.pointRadius:Array.isArray(e.pointRadius)?vr(e.pointRadius):et?vr([{zoom:0,value:t*.05},{zoom:2,value:t*.1},{zoom:4,value:t*.2},{zoom:8,value:t*.5},{zoom:16,value:t*1}]):t;if(e.property&&Array.isArray(e.pointColor)){const de=Array.from({length:m},(ce,_e)=>{const Ae=c.min+_e*(c.max-c.min)/(m-1);return{value:Ae,pointRadius:typeof e.pointRadius=="number"?e.pointRadius:t+(a-t)*(_e/(m-1))**.5,color:typeof e.pointColor=="string"?e.pointColor:g.getColorHex(Ae)}});je=nw(de,e.property),Be=iw(de,e.property,et)}n.addLayer({id:Ze.pointLayerId,type:"circle",source:C,layout:{"circle-sort-key":e.property?["/",1,["get",e.property]]:0},paint:{"circle-pitch-alignment":q?"viewport":"map","circle-pitch-scale":"map","circle-color":je,"circle-opacity":Oe,"circle-radius":Be,...J&&{"circle-stroke-opacity":typeof Y=="number"?Y:vr(Y),"circle-stroke-width":typeof xe=="number"?xe:vr(xe),"circle-stroke-color":typeof be=="string"?be:$f(be)}},minzoom:Je,maxzoom:qe},e.beforeId)}if(V!==!1&&(e.cluster||e.property)){Ze.labelLayerId=`${R}_label`;const je=e.labelColor??"#fff",Be=e.labelSize??12;n.addLayer({id:Ze.labelLayerId,type:"symbol",source:C,filter:["has",e.cluster?"point_count":e.property],layout:{"text-field":e.cluster?"{point_count_abbreviated}":`{${e.property}}`,"text-font":["Noto Sans Regular"],"text-size":Be,"text-pitch-alignment":q?"viewport":"map","symbol-sort-key":["/",1,["get",e.cluster?"point_count":e.property]]},paint:{"text-color":je,"text-opacity":Oe},minzoom:Je,maxzoom:qe},e.beforeId)}return Ze}function Yj(n,e){if(e.layerId&&n.getLayer(e.layerId))throw new Error(`A layer already exists with the layer id: ${e.layerId}`);const t=e.sourceId??Xy(),a=e.layerId??Yy(),d=e.minzoom??0,m=e.maxzoom??23,g=e.zoomCompensation??!0,c=e.opacity??[{zoom:d,value:0},{zoom:d+.25,value:1},{zoom:m-.25,value:1},{zoom:m,value:0}];let C=Array.isArray(e.colorRamp)?e.colorRamp:lR.TURBO.transparentStart();const R=C.getBounds();(R.min!==0||R.max!==1)&&(C=C.scale(0,1)),C.hasTransparentStart()||(C=C.transparentStart());const V=e.intensity??[{zoom:0,value:.01},{zoom:4,value:.2},{zoom:16,value:1}],q=e.property??null,J=e.weight??1;let Y=1;q?typeof J=="number"?(Y=J,typeof e.weight=="number"&&console.warn("The option `.property` is ignored when `.propertyValueWeights` is not of type `PropertyValueWeights`")):Array.isArray(J)?Y=aR(J,q):console.warn("The option `.property` is ignored when `.propertyValueWeights` is not of type `PropertyValueWeights`"):typeof J=="number"?Y=J:Array.isArray(J)&&console.warn("The options `.propertyValueWeights` can only be used when `.property` is provided.");const xe=[{zoom:0,value:50*.025},{zoom:2,value:50*.05},{zoom:4,value:50*.1},{zoom:8,value:50*.25},{zoom:16,value:50}],be=e.radius??(g?xe:10);let Oe=1;typeof be=="number"?Oe=be:Array.isArray(be)&&"zoom"in be[0]?Oe=vr(be):q&&Array.isArray(be)&&"propertyValue"in be[0]?Oe=sR(be,q,g):!q&&Array.isArray(be)&&"propertyValue"in be[0]?(Oe=vr(xe),console.warn("The option `.radius` can only be property-driven if the option `.property` is provided.")):Oe=vr(xe);const et={heatmapLayerId:a,heatmapSourceId:t};if(e.data&&!n.getSource(t)){let Je=e.data;typeof Je=="string"&&Ob(Je)&&(Je=`https://api.maptiler.com/data/${Je}/features.json?key=${Ya.apiKey}`),n.addSource(t,{type:"geojson",data:Je})}return n.addLayer({id:a,type:"heatmap",source:t,minzoom:d,maxzoom:m,paint:{"heatmap-weight":Y,"heatmap-intensity":typeof V=="number"?V:vr(V),"heatmap-color":oR(C),"heatmap-radius":Oe,"heatmap-opacity":typeof c=="number"?c:vr(c)}},e.beforeId),et}const j_=Object.freeze(Object.defineProperty({__proto__:null,addHeatmap:Yj,addPoint:Xj,addPolygon:Kj,addPolyline:Zj,colorDrivenByProperty:nw,colorPalettes:ew,computeRampedOutlineWidth:rR,dashArrayMaker:j2,generateRandomLayerName:Yy,generateRandomSourceName:Xy,getRandomColor:Jb,heatmapIntensityFromColorRamp:oR,lerpZoomNumberValues:tw,opacityDrivenByProperty:rw,paintColorOptionsToPaintSpec:$f,radiusDrivenByProperty:iw,radiusDrivenByPropertyHeatmap:sR,rampedOptionsToLayerPaintSpec:vr,rampedPropertyValueWeight:aR,takeScreenshot:qj},Symbol.toStringTag,{value:"Module"}));dF();function Qj(){return"3.8.0"}wn.Map;wn.Marker;wn.Popup;wn.Style;wn.CanvasSource;wn.GeoJSONSource;wn.ImageSource;wn.RasterTileSource;wn.RasterDEMTileSource;wn.VectorTileSource;wn.VideoSource;wn.NavigationControl;wn.GeolocateControl;wn.AttributionControl;wn.LogoControl;wn.ScaleControl;wn.FullscreenControl;wn.TerrainControl;wn.BoxZoomHandler;wn.ScrollZoomHandler;wn.CooperativeGesturesHandler;wn.KeyboardHandler;wn.TwoFingersTouchPitchHandler;wn.MapWheelEvent;wn.MapTouchEvent;wn.MapMouseEvent;wn.config;wn.getVersion;const{setRTLTextPlugin:A8,getRTLTextPluginStatus:C8,LngLat:I8,LngLatBounds:P8,MercatorCoordinate:M8,Evented:R8,AJAXError:k8,prewarm:L8,clearPrewarmedResources:D8,Hash:z8,Point:O8,EdgeInsets:N8,DragRotateHandler:B8,DragPanHandler:F8,TwoFingersTouchZoomRotateHandler:V8,DoubleClickZoomHandler:U8,TwoFingersTouchZoomHandler:j8,TwoFingersTouchRotateHandler:$8,getWorkerCount:q8,setWorkerCount:G8,getMaxParallelImageRequests:H8,setMaxParallelImageRequests:Z8,getWorkerUrl:W8,setWorkerUrl:K8,addSourceType:X8,importScriptInWorkers:Y8,addProtocol:Q8,removeProtocol:J8}=wn,Jj="@maptiler/leaflet-maptilersdk",e8="4.1.1",t8=Lr.Layer.extend({options:{updateInterval:32,padding:.1,interactive:!1,pane:"tilePane"},map:null,initialize:function(n){Lr.setOptions(this,n),this._throttledUpdate=Lr.Util.throttle(this._update,this.options.updateInterval,this)},onAdd:function(n){var e;this._container||this._initContainer();const t=this.getPaneName();(e=n.getPane(t))==null||e.appendChild(this._container),this._initMaptilerSDK(),this._offset=this._map.containerPointToLayerPoint([0,0]),n.options.zoomAnimation&&Lr.DomEvent.on(n._proxy,Lr.DomUtil.TRANSITION_END,this._transitionEnd,this),n.attributionControl.addAttribution('<a href="https://www.maptiler.com/copyright/" target="_blank">&copy; MapTiler</a> <a href="https://www.openstreetmap.org/copyright" target="_blank">&copy; OpenStreetMap contributors</a>')},onRemove:function(n){var e;this._map._proxy&&this._map.options.zoomAnimation&&Lr.DomEvent.off(this._map._proxy,Lr.DomUtil.TRANSITION_END,this._transitionEnd,this);const t=this.getPaneName();(e=n.getPane(t))==null||e.removeChild(this._container),this._maptilerMap.remove(),this._maptilerMap=null},getEvents:function(){return{move:this._throttledUpdate,zoomanim:this._animateZoom,zoom:this._pinchZoom,zoomstart:this._zoomStart,zoomend:this._zoomEnd,resize:this._resize}},getMaptilerSDKMap:function(){return this._maptilerMap},getCanvas:function(){return this._maptilerMap.getCanvas()},getSize:function(){return this._map.getSize().multiplyBy(1+this.options.padding*2)},getBounds:function(){const n=this.getSize().multiplyBy(.5),e=this._map.latLngToContainerPoint(this._map.getCenter());return Lr.latLngBounds(this._map.containerPointToLatLng(e.subtract(n)),this._map.containerPointToLatLng(e.add(n)))},getContainer:function(){return this._container},getPaneName:function(){return this._map.getPane(this.options.pane)?this.options.pane:"tilePane"},setStyle:function(n){this._maptilerMap.setStyle(n)},setLanguage:function(n){this._maptilerMap.setLanguage(n)},_roundPoint:n=>({x:Math.round(n.x),y:Math.round(n.y)}),_initContainer:function(){this._container=Lr.DomUtil.create("div","leaflet-gl-layer");const n=this.getSize(),e=this._map.getSize().multiplyBy(this.options.padding);this._container.style.width=`${n.x}px`,this._container.style.height=`${n.y}px`;const t=this._map.containerPointToLayerPoint([0,0]).subtract(e);Lr.DomUtil.setPosition(this._container,this._roundPoint(t))},_initMaptilerSDK:function(){const n=this._map.getCenter(),e=this.options.maxBounds?this.options.maxBounds:[[Number.NEGATIVE_INFINITY,-90],[Number.POSITIVE_INFINITY,90]];this._map.setMaxBounds(Lr.latLngBounds(Lr.latLng(e[0][1],e[0][0]),Lr.latLng(e[1][1],e[1][0])));const t={maxBounds:e,...this.options,projection:"mercator",container:this._container,center:[n.lng,n.lat],zoom:this._map.getZoom()-1,attributionControl:!1};this.options.geolocate&&(t.center=void 0,t.zoom=void 0),this._maptilerMap=new WM(t),this._maptilerMap.telemetry.registerModule(Jj,e8),this._maptilerMap.once("load",()=>{this.fire("ready")}),this._maptilerMap.once("load",async()=>{let d={logo:null};try{const m=Object.keys(this._maptilerMap.style.sourceCaches).map(c=>this._maptilerMap.getSource(c)).filter(c=>c&&"url"in c&&typeof c.url=="string"&&(c==null?void 0:c.url.includes("tiles.json"))),g=new URL(m[0].url);g.searchParams.has("key")||g.searchParams.append("key",t.apiKey),d=await(await fetch(g.href)).json()}catch{}if(d.logo||t.maptilerLogo){const m=d.logo??"https://api.maptiler.com/resources/logo.svg",g=document.createElement("a");g.href="https://www.maptiler.com",g.style.setProperty("position","absolute"),g.style.setProperty("left","10px"),g.style.setProperty("bottom","2px"),g.style.setProperty("z-index","999");const c=document.createElement("img");c.src=m,c.alt="MapTiler logo",c.width=100,c.height=30,g.appendChild(c),this._map.getContainer().appendChild(g)}}),this._maptilerMap.transform.freezeElevation=!0,this.options.geolocate&&this._maptilerMap.on("load",()=>{this._map.setView(this._maptilerMap.getCenter(),this._maptilerMap.getZoom()+1)}),this._transformGL(),this._maptilerMap._actualCanvas=this._maptilerMap._canvas;const a=this._maptilerMap._actualCanvas;Lr.DomUtil.addClass(a,"leaflet-image-layer"),Lr.DomUtil.addClass(a,"leaflet-zoom-animated"),this.options.interactive&&Lr.DomUtil.addClass(a,"leaflet-interactive"),this.options.className&&Lr.DomUtil.addClass(a,this.options.className),this.addHeatmap=d=>j_.addHeatmap(this._maptilerMap,d),this.addPolygon=d=>j_.addPolygon(this._maptilerMap,d),this.addPoint=d=>j_.addPoint(this._maptilerMap,d),this.addPolyline=d=>j_.addPolyline(this._maptilerMap,d),this.takeScreenshot=d=>j_.takeScreenshot(this._maptilerMap,d)},_update:function(){if(this._offset=this._map.containerPointToLayerPoint([0,0]),this._zooming)return;const n=this.getSize(),e=this._map.getSize().multiplyBy(this.options.padding),t=this._map.containerPointToLayerPoint([0,0]).subtract(e);Lr.DomUtil.setPosition(this._container,this._roundPoint(t)),this._transformGL(),this._maptilerMap.transform.width!==n.x||this._maptilerMap.transform.height!==n.y?(this._container.style.width=`${n.x}px`,this._container.style.height=`${n.y}px`,this._maptilerMap._resize!==null&&this._maptilerMap._resize!==void 0?this._maptilerMap._resize():this._maptilerMap.resize()):this._maptilerMap._update!==null&&this._maptilerMap._update!==void 0?this._maptilerMap._update():this._maptilerMap.update()},_transformGL:function(){this._maptilerMap.setCenter(this._map.getCenter()),this._maptilerMap.setZoom(this._map.getZoom()-1)},_pinchZoom:function(){this._maptilerMap.jumpTo({zoom:this._map.getZoom()-1,center:this._map.getCenter()})},_animateZoom:function(n){const e=this._map.getZoomScale(n.zoom),t=this._map.getSize().multiplyBy(this.options.padding*e),a=this.getSize()._divideBy(2),d=this._map.project(n.center,n.zoom)._subtract(a)._add(this._map._getMapPanePos().add(t))._round(),m=this._map.project(this._map.getBounds().getNorthWest(),n.zoom)._subtract(d);Lr.DomUtil.setTransform(this._maptilerMap.getCanvas(),m.subtract(this._offset),e)},_zoomStart:function(){this._zooming=!0},_zoomEnd:function(){const n=this._map.getZoomScale(this._map.getZoom());Lr.DomUtil.setTransform(this._maptilerMap.getCanvas(),new Lr.Point(0,0),n),this._zooming=!1,this._update()},_transitionEnd:function(){Lr.Util.requestAnimFrame(()=>{const n=this._map.getZoom(),e=this._map.getCenter(),t=this._map.latLngToContainerPoint(this._map.getBounds().getNorthWest());Lr.DomUtil.setTransform(this._maptilerMap._actualCanvas,t,1),this._maptilerMap.once("moveend",Lr.Util.bind(()=>{this._zoomEnd()},this)),this._maptilerMap.jumpTo({center:e,zoom:n-1})},this)},_resize:function(n){this._transitionEnd(n)}}),cA=[{id:0,name:"uncomfortable-situation",color:"#de9e36"},{id:1,name:"sexual-misconduct",color:"#ca3c25"},{id:2,name:"physical-aggression",color:"#701d52"},{id:3,name:"verbal-aggression",color:"#212475"},{id:4,name:"discrimination",color:"#1d1a05"}];function hA(){const[n,e]=wt.useState([]),[t,a]=wt.useState({}),[d,m]=wt.useState(!0),[g,c]=wt.useState(null),[C,R]=wt.useState({selectedCampus:"All",selectedMonth:"All",selectedTypes:[],showMenu:!1}),V=wt.useRef(null),q=wt.useRef(null);wt.useEffect(()=>{(async()=>{try{const de=fI(DP,"reports"),ce=H3(de),_e=await Y3(ce);console.log("Firebase Points: ",_e.docs.map(Ae=>Ae.data())),e(_e.docs.map(Ae=>Ae.data())),m(!1)}catch(de){console.error("Error fetching incidents:",de),c("Failed to fetch incident data"),m(!1)}})(),V.current||(V.current=Lr.map("map",{maxZoom:19}).setView([41.7002,-86.2379],15).setMinZoom(15).setMaxBounds([[41.7852,-86.1779],[41.5852,-86.2879]]),new t8({style:"streets-v2",apiKey:"0UGrg19TXtYRROinsJ9a"}).addTo(V.current),q.current=Lr.layerGroup().addTo(V.current))},[]),wt.useEffect(()=>{Y()},[n,C]);const J=()=>{const Be={};return et(n).forEach(ce=>{var Pn;const _e=KS.find(ei=>ei.name===ce.specificLocation);(Pn=Be[ce.specificLocation])!=null&&Pn.totalIncidents&&Be[ce.specificLocation].totalIncidents+1;const Ae=ce.specificLocation||(_e==null?void 0:_e.name)||"Unknown Location",Me=_e&&typeof _e.latitude=="number"&&typeof _e.longitude=="number"?[_e.latitude,_e.longitude]:[0,0],Ge=ce.campus||(_e==null?void 0:_e.campus)||"Unknown Campus",Re=(_e==null?void 0:_e.type)||(_e==null?void 0:_e.buildingType)||"Unknown Type";Be[Ae]?(Be[Ae].totalIncidents++,Be[Ae].recentIncidents.push(ce)):Be[Ae]={buildingName:Ae,coordinates:Me,totalIncidents:1,incidentCounts:{"uncomfortable-situation":0,"sexual-misconduct":0,"physical-aggression":0,"verbal-aggression":0,discrimination:0},campus:Ge,buildingType:Re,recentIncidents:[ce]},ce.offenseTypes&&ce.offenseTypes.forEach(ei=>{Be[Ae].incidentCounts[ei]!==void 0&&Be[Ae].incidentCounts[ei]++})}),a(Be),Be},Y=()=>{var de;const Be=J();q.current&&((de=q.current)==null||de.clearLayers()),Object.values(Be).forEach(ce=>{if(ce.totalIncidents>0){const _e=Math.min(ce.totalIncidents*10+15,100),Ae=Object.entries(ce.incidentCounts).sort(([,ei],[,mt])=>mt-ei)[0][0],Ge={"uncomfortable-situation":"#de9e36","sexual-misconduct":"#ca3c25","physical-aggression":"#701d52","verbal-aggression":"#212475",discrimination:"#1d1a05"}[Ae]||"#666666";Lr.circle(ce.coordinates,{color:Ge,fillColor:Ge,fillOpacity:.7,radius:_e,weight:2}).addTo(q.current);const Re=je(ce);let Pn="black";ce.campus=="Notre-Dame"?Pn="#FFD700":ce.campus=="Holy-Cross"?Pn="#fff":ce.campus=="Saint-Marys"&&(Pn="#87CEEB"),Lr.circle(ce.coordinates,{fillColor:Pn,fillOpacity:.5,color:Pn,stroke:!1,radius:15}).addTo(q.current).bindPopup(Re,{maxWidth:400,className:"enhanced-popup"})}})},xe=()=>{const Be=new Set;return n.forEach(de=>{const ce=new Date(de.createdAt.toMillis()),_e=`${ce.getFullYear()}-${String(ce.getMonth()+1).padStart(2,"0")}`;Be.add(_e)}),["All",...Array.from(Be).sort().reverse()]};function be(Be){const de=Be.createdAt.toMillis(),ce=Date.now(),_e=1440*60*1e3;let Ae=0,Me=ce-de;switch(Be.time){case"within-24-hours":Ae=(Me+_e/2)/_e;break;case"within-week":Ae=(Me+_e*3.5)/_e;break;case"within-month":Ae=(Me+_e*15)/_e;break;case"longer-ago":Ae=(Me+_e*45)/_e;break}return Ae}function Oe(Be){let de=0,ce=0;const _e=12;for(const Me of Be){const Ge=be(Me);Ge<7&&ce++;const Re=Math.min(3/Ge*2,2);de+=Re}if(de===0)return[1,0];let Ae=10+de/_e*40;return Ae=Math.min(Ae,50),[Math.round(Ae)/10,ce]}const et=Be=>Be.filter(de=>{if(C.selectedCampus!=="All"){const ce=ZS.find(_e=>_e===de.campus);if(!ce||ce!==C.selectedCampus)return!1}if(C.selectedMonth!=="All"){const ce=new Date(de.createdAt.toMillis());if(`${ce.getFullYear()}-${String(ce.getMonth()+1).padStart(2,"0")}`!==C.selectedMonth)return!1}return!(C.selectedTypes.length>0&&!C.selectedTypes.some(ce=>de.offenseTypes.includes(ce)))}),Je=(Be,de)=>{R(ce=>({...ce,[Be]:de}))},qe=Be=>{R(de=>({...de,selectedTypes:de.selectedTypes.includes(Be)?de.selectedTypes.filter(ce=>ce!==Be):[...de.selectedTypes,Be]}))},Ze=Be=>{if(V.current)if(Be==="All")V.current.setView([41.7002,-86.2379],15);else{const de=KS.filter(ce=>ce.location===Be);if(de.length>0){const ce=Lr.latLngBounds(de.map(_e=>[_e.latitude,_e.longitude]));V.current.fitBounds(ce,{padding:[50,50]})}}},je=Be=>{const[de,ce]=Oe(Be.recentIncidents),_e=de>=4?"#ca3c25":de>=3?"#de9e36":de>=2?"#212475":"#28a745",Ae=[{name:"uncomfortable-situation",color:"#de9e36"},{name:"sexual-misconduct",color:"#ca3c25"},{name:"physical-aggression",color:"#701d52"},{name:"verbal-aggression",color:"#212475"},{name:"discrimination",color:"#1d1a05"}];return`
      <div class="enhanced-popup-content">
        <h3 style="margin: 0 0 10px 0; color: #333;">${Be.buildingName}</h3>
        
        <div style="margin-bottom: 10px;">
          <span style="font-weight: bold; color: #666;">Campus:</span> ${Be.campus}<br>
          <span style="font-weight: bold; color: #666;">Building Type:</span> ${Be.buildingType}
        </div>
        
        <div style="margin-bottom: 10px;">
          <span style="font-weight: bold; color: #666;">Total Cases:</span> ${Be.totalIncidents}
        </div>
        
        <div style="margin-bottom: 10px;">
          <span style="font-weight: bold; color: #666;">Types of Aggressions:</span><br>
          ${Object.entries(Be.incidentCounts).filter(([,Me])=>Me>0).map(([Me,Ge])=>{const Re=Ae.find(ei=>ei.name===Me);if(!Re)return"";const Pn=Re.name.replace(/-/g," ").replace(/\b\w/g,ei=>ei.toUpperCase());return`<div style="margin: 2px 0; font-size: 12px;">
                <span style="color: ${Re.color}; font-weight: bold;"></span>
                ${Pn}: ${Ge}
              </div>`}).join("")}
        </div>
        
        <div style="margin-bottom: 10px;">
          <span style="font-weight: bold; color: #666;">Risk Score:</span> 
          <span style="color: ${_e}; font-weight: bold; font-size: 16px;">
            ${de}/5
          </span>
          ${ce>0?`<br><span style="font-size: 12px; color: #666;">
              (${ce} recent case${ce>1?"s":""} in last 7 days)
            </span>`:'<br><span style="font-size: 12px; color: #28a745;">(No recent activity)</span>'}
        </div>
      </div>
    `};return Ee.jsxs("div",{className:"fullscreen-map-container",children:[Ee.jsxs("div",{className:"map-filter z-front",children:[Ee.jsx("div",{className:`map-filter-menu m-1${C.showMenu?" open":""}`,style:{zIndex:C.showMenu?1001:-1,opacity:C.showMenu?1:0},children:Ee.jsxs("div",{className:"filter-content",children:[Ee.jsx("h3",{children:"Map Filters"}),Ee.jsxs("div",{className:"filter-section",children:[Ee.jsx("label",{children:"Campus:"}),Ee.jsx("select",{value:C.selectedCampus,onChange:Be=>{Je("selectedCampus",Be.target.value),Ze(Be.target.value)},className:"form-select",children:ZS.map(Be=>Ee.jsx("option",{value:Be.toString(),children:Be.toString()},Be.toString()))})]}),Ee.jsxs("div",{className:"filter-section",children:[Ee.jsx("label",{children:"Month:"}),Ee.jsx("select",{value:C.selectedMonth,onChange:Be=>Je("selectedMonth",Be.target.value),className:"form-select",children:xe().map(Be=>Ee.jsx("option",{value:Be,children:Be==="All"?"All Time":Be},Be))})]}),Ee.jsxs("div",{className:"filter-section",children:[Ee.jsx("label",{children:"Incident Types:"}),Ee.jsx("div",{className:"type-filters",children:cA.map(Be=>Ee.jsxs("label",{className:"type-checkbox custom-circle-checkbox",style:{cursor:"pointer"},children:[Ee.jsx("input",{type:"checkbox",checked:C.selectedTypes.includes(Be.name),onChange:()=>qe(Be.name),style:{display:"none"}}),Ee.jsx("span",{className:`type-color-dot-circle ${C.selectedTypes.includes(Be.name)?"selected":""}`,style:{backgroundColor:Be.color,borderColor:Be.color},children:C.selectedTypes.includes(Be.name)&&Ee.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",style:{display:"block",margin:"auto"},children:Ee.jsx("circle",{cx:"13",cy:"13",r:"10",fill:"#fff",opacity:"0.8"})})}),Ee.jsx("span",{style:{marginLeft:8},children:Be.name})]},Be.name))})]}),Ee.jsx("button",{className:"clear-filters-btn",onClick:()=>R({selectedCampus:"All",selectedMonth:"All",selectedTypes:[],showMenu:C.showMenu}),children:"Clear All Filters"}),Ee.jsxs("div",{className:"results-summary",children:[Ee.jsxs("p",{children:["Showing ",Object.values(t).length," incidents"]}),C.selectedCampus!=="All"&&Ee.jsxs("p",{children:["Campus: ",C.selectedCampus]}),C.selectedMonth!=="All"&&Ee.jsxs("p",{children:["Period: ",C.selectedMonth]}),C.selectedTypes.length>0&&Ee.jsxs("p",{children:["Types:"," ",C.selectedTypes.map(Be=>{var de;return(de=cA.find(ce=>ce.name===Be))==null?void 0:de.name}).join(", ")]})]})]})}),Ee.jsx("button",{className:"menu-toggle-btn",onClick:()=>Je("showMenu",!C.showMenu),children:C.showMenu?"":""})]}),Ee.jsxs("div",{className:"form-group abs right ",children:[Ee.jsx("a",{href:"../",className:"back-button form-btn",children:Ee.jsx("button",{className:" small",children:"Back"})}),Ee.jsx("a",{"data-az-l":"1e9e1abc-2335-4838-949d-8ab8af0dd8c9",className:"back-button form-btn mt-4",children:Ee.jsx("button",{className:" small",children:"Leave Feedback"})})]}),d&&Ee.jsx("div",{className:"loading-overlay",children:Ee.jsx("div",{className:"loading-content",children:"Loading incident data..."})}),g&&Ee.jsx("div",{className:"error-overlay",children:g}),Ee.jsx("div",{id:"map",className:"fullscreen-map"})]})}function n8(n){try{(function(e,t,a,d,m,g,c){t.getElementById("clarity-script")||(e[a]=e[a]||function(){(e[a].q=e[a].q||[]).push(arguments)},g=t.createElement(d),g.async=1,g.src="https://www.clarity.ms/tag/"+m+"?ref=npm",g.id="clarity-script",c=t.getElementsByTagName(d)[0],c.parentNode.insertBefore(g,c))})(window,document,"clarity","script",n);return}catch{return}}const i8={init(n){n8(n)},setTag(n,e){window.clarity("set",n,e)},identify(n,e,t,a){window.clarity("identify",n,e,t,a)},consent(n=!0){window.clarity("consent",n)},upgrade(n){window.clarity("upgrade",n)},event(n){window.clarity("event",n)}},r8="tyjad302qq",a8="6LeMDQssAAAAAC3prYanNGr6ItRklzJicu190qUc";i8.init(r8);bR.createRoot(document.getElementById("root")).render(Ee.jsx(dA.StrictMode,{children:Ee.jsx(dB,{reCaptchaKey:a8,children:Ee.jsx(zk,{children:Ee.jsxs(dk,{children:[Ee.jsx(Lp,{path:"/",element:Ee.jsx(aT,{})}),Ee.jsx(Lp,{path:"/client/",element:Ee.jsx(aT,{})}),Ee.jsx(Lp,{path:"/report",element:Ee.jsx(eE,{})}),Ee.jsx(Lp,{path:"/client/report",element:Ee.jsx(eE,{})}),Ee.jsx(Lp,{path:"/map",element:Ee.jsx(hA,{})}),Ee.jsx(Lp,{path:"/client/map",element:Ee.jsx(hA,{})})]})})})}));
