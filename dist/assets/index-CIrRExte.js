(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))o(d);new MutationObserver(d=>{for(const g of d)if(g.type==="childList")for(const _ of g.addedNodes)_.tagName==="LINK"&&_.rel==="modulepreload"&&o(_)}).observe(document,{childList:!0,subtree:!0});function n(d){const g={};return d.integrity&&(g.integrity=d.integrity),d.referrerPolicy&&(g.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?g.credentials="include":d.crossOrigin==="anonymous"?g.credentials="omit":g.credentials="same-origin",g}function o(d){if(d.ep)return;d.ep=!0;const g=n(d);fetch(d.href,g)}})();function iy(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var bb={exports:{}},h_={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Fw;function sI(){if(Fw)return h_;Fw=1;var i=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function n(o,d,g){var _=null;if(g!==void 0&&(_=""+g),d.key!==void 0&&(_=""+d.key),"key"in d){g={};for(var c in d)c!=="key"&&(g[c]=d[c])}else g=d;return d=g.ref,{$$typeof:i,type:o,key:_,ref:d!==void 0?d:null,props:g}}return h_.Fragment=e,h_.jsx=n,h_.jsxs=n,h_}var Vw;function oI(){return Vw||(Vw=1,bb.exports=sI()),bb.exports}var Ee=oI(),xb={exports:{}},ri={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var jw;function lI(){if(jw)return ri;jw=1;var i=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),o=Symbol.for("react.strict_mode"),d=Symbol.for("react.profiler"),g=Symbol.for("react.consumer"),_=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),M=Symbol.for("react.suspense"),k=Symbol.for("react.memo"),j=Symbol.for("react.lazy"),G=Symbol.for("react.activity"),ee=Symbol.iterator;function Y(ke){return ke===null||typeof ke!="object"?null:(ke=ee&&ke[ee]||ke["@@iterator"],typeof ke=="function"?ke:null)}var xe={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},be=Object.assign,Ne={};function tt(ke,vt,Ot){this.props=ke,this.context=vt,this.refs=Ne,this.updater=Ot||xe}tt.prototype.isReactComponent={},tt.prototype.setState=function(ke,vt){if(typeof ke!="object"&&typeof ke!="function"&&ke!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,ke,vt,"setState")},tt.prototype.forceUpdate=function(ke){this.updater.enqueueForceUpdate(this,ke,"forceUpdate")};function Je(){}Je.prototype=tt.prototype;function qe(ke,vt,Ot){this.props=ke,this.context=vt,this.refs=Ne,this.updater=Ot||xe}var He=qe.prototype=new Je;He.constructor=qe,be(He,tt.prototype),He.isPureReactComponent=!0;var Ue=Array.isArray;function Be(){}var de={H:null,A:null,T:null,S:null},ce=Object.prototype.hasOwnProperty;function _e(ke,vt,Ot){var jt=Ot.ref;return{$$typeof:i,type:ke,key:vt,ref:jt!==void 0?jt:null,props:Ot}}function Ae(ke,vt){return _e(ke.type,vt,ke.props)}function Pe(ke){return typeof ke=="object"&&ke!==null&&ke.$$typeof===i}function Ge(ke){var vt={"=":"=0",":":"=2"};return"$"+ke.replace(/[=:]/g,function(Ot){return vt[Ot]})}var Re=/\/+/g;function In(ke,vt){return typeof ke=="object"&&ke!==null&&ke.key!=null?Ge(""+ke.key):vt.toString(36)}function Jn(ke){switch(ke.status){case"fulfilled":return ke.value;case"rejected":throw ke.reason;default:switch(typeof ke.status=="string"?ke.then(Be,Be):(ke.status="pending",ke.then(function(vt){ke.status==="pending"&&(ke.status="fulfilled",ke.value=vt)},function(vt){ke.status==="pending"&&(ke.status="rejected",ke.reason=vt)})),ke.status){case"fulfilled":return ke.value;case"rejected":throw ke.reason}}throw ke}function mt(ke,vt,Ot,jt,Jt){var Xt=typeof ke;(Xt==="undefined"||Xt==="boolean")&&(ke=null);var Fn=!1;if(ke===null)Fn=!0;else switch(Xt){case"bigint":case"string":case"number":Fn=!0;break;case"object":switch(ke.$$typeof){case i:case e:Fn=!0;break;case j:return Fn=ke._init,mt(Fn(ke._payload),vt,Ot,jt,Jt)}}if(Fn)return Jt=Jt(ke),Fn=jt===""?"."+In(ke,0):jt,Ue(Jt)?(Ot="",Fn!=null&&(Ot=Fn.replace(Re,"$&/")+"/"),mt(Jt,vt,Ot,"",function(ds){return ds})):Jt!=null&&(Pe(Jt)&&(Jt=Ae(Jt,Ot+(Jt.key==null||ke&&ke.key===Jt.key?"":(""+Jt.key).replace(Re,"$&/")+"/")+Fn)),vt.push(Jt)),1;Fn=0;var si=jt===""?".":jt+":";if(Ue(ke))for(var di=0;di<ke.length;di++)jt=ke[di],Xt=si+In(jt,di),Fn+=mt(jt,vt,Ot,Xt,Jt);else if(di=Y(ke),typeof di=="function")for(ke=di.call(ke),di=0;!(jt=ke.next()).done;)jt=jt.value,Xt=si+In(jt,di++),Fn+=mt(jt,vt,Ot,Xt,Jt);else if(Xt==="object"){if(typeof ke.then=="function")return mt(Jn(ke),vt,Ot,jt,Jt);throw vt=String(ke),Error("Objects are not valid as a React child (found: "+(vt==="[object Object]"?"object with keys {"+Object.keys(ke).join(", ")+"}":vt)+"). If you meant to render a collection of children, use an array instead.")}return Fn}function $t(ke,vt,Ot){if(ke==null)return ke;var jt=[],Jt=0;return mt(ke,jt,"","",function(Xt){return vt.call(Ot,Xt,Jt++)}),jt}function Tt(ke){if(ke._status===-1){var vt=ke._result;vt=vt(),vt.then(function(Ot){(ke._status===0||ke._status===-1)&&(ke._status=1,ke._result=Ot)},function(Ot){(ke._status===0||ke._status===-1)&&(ke._status=2,ke._result=Ot)}),ke._status===-1&&(ke._status=0,ke._result=vt)}if(ke._status===1)return ke._result.default;throw ke._result}var zt=typeof reportError=="function"?reportError:function(ke){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var vt=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof ke=="object"&&ke!==null&&typeof ke.message=="string"?String(ke.message):String(ke),error:ke});if(!window.dispatchEvent(vt))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",ke);return}console.error(ke)},Bt={map:$t,forEach:function(ke,vt,Ot){$t(ke,function(){vt.apply(this,arguments)},Ot)},count:function(ke){var vt=0;return $t(ke,function(){vt++}),vt},toArray:function(ke){return $t(ke,function(vt){return vt})||[]},only:function(ke){if(!Pe(ke))throw Error("React.Children.only expected to receive a single React element child.");return ke}};return ri.Activity=G,ri.Children=Bt,ri.Component=tt,ri.Fragment=n,ri.Profiler=d,ri.PureComponent=qe,ri.StrictMode=o,ri.Suspense=M,ri.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=de,ri.__COMPILER_RUNTIME={__proto__:null,c:function(ke){return de.H.useMemoCache(ke)}},ri.cache=function(ke){return function(){return ke.apply(null,arguments)}},ri.cacheSignal=function(){return null},ri.cloneElement=function(ke,vt,Ot){if(ke==null)throw Error("The argument must be a React element, but you passed "+ke+".");var jt=be({},ke.props),Jt=ke.key;if(vt!=null)for(Xt in vt.key!==void 0&&(Jt=""+vt.key),vt)!ce.call(vt,Xt)||Xt==="key"||Xt==="__self"||Xt==="__source"||Xt==="ref"&&vt.ref===void 0||(jt[Xt]=vt[Xt]);var Xt=arguments.length-2;if(Xt===1)jt.children=Ot;else if(1<Xt){for(var Fn=Array(Xt),si=0;si<Xt;si++)Fn[si]=arguments[si+2];jt.children=Fn}return _e(ke.type,Jt,jt)},ri.createContext=function(ke){return ke={$$typeof:_,_currentValue:ke,_currentValue2:ke,_threadCount:0,Provider:null,Consumer:null},ke.Provider=ke,ke.Consumer={$$typeof:g,_context:ke},ke},ri.createElement=function(ke,vt,Ot){var jt,Jt={},Xt=null;if(vt!=null)for(jt in vt.key!==void 0&&(Xt=""+vt.key),vt)ce.call(vt,jt)&&jt!=="key"&&jt!=="__self"&&jt!=="__source"&&(Jt[jt]=vt[jt]);var Fn=arguments.length-2;if(Fn===1)Jt.children=Ot;else if(1<Fn){for(var si=Array(Fn),di=0;di<Fn;di++)si[di]=arguments[di+2];Jt.children=si}if(ke&&ke.defaultProps)for(jt in Fn=ke.defaultProps,Fn)Jt[jt]===void 0&&(Jt[jt]=Fn[jt]);return _e(ke,Xt,Jt)},ri.createRef=function(){return{current:null}},ri.forwardRef=function(ke){return{$$typeof:c,render:ke}},ri.isValidElement=Pe,ri.lazy=function(ke){return{$$typeof:j,_payload:{_status:-1,_result:ke},_init:Tt}},ri.memo=function(ke,vt){return{$$typeof:k,type:ke,compare:vt===void 0?null:vt}},ri.startTransition=function(ke){var vt=de.T,Ot={};de.T=Ot;try{var jt=ke(),Jt=de.S;Jt!==null&&Jt(Ot,jt),typeof jt=="object"&&jt!==null&&typeof jt.then=="function"&&jt.then(Be,zt)}catch(Xt){zt(Xt)}finally{vt!==null&&Ot.types!==null&&(vt.types=Ot.types),de.T=vt}},ri.unstable_useCacheRefresh=function(){return de.H.useCacheRefresh()},ri.use=function(ke){return de.H.use(ke)},ri.useActionState=function(ke,vt,Ot){return de.H.useActionState(ke,vt,Ot)},ri.useCallback=function(ke,vt){return de.H.useCallback(ke,vt)},ri.useContext=function(ke){return de.H.useContext(ke)},ri.useDebugValue=function(){},ri.useDeferredValue=function(ke,vt){return de.H.useDeferredValue(ke,vt)},ri.useEffect=function(ke,vt){return de.H.useEffect(ke,vt)},ri.useEffectEvent=function(ke){return de.H.useEffectEvent(ke)},ri.useId=function(){return de.H.useId()},ri.useImperativeHandle=function(ke,vt,Ot){return de.H.useImperativeHandle(ke,vt,Ot)},ri.useInsertionEffect=function(ke,vt){return de.H.useInsertionEffect(ke,vt)},ri.useLayoutEffect=function(ke,vt){return de.H.useLayoutEffect(ke,vt)},ri.useMemo=function(ke,vt){return de.H.useMemo(ke,vt)},ri.useOptimistic=function(ke,vt){return de.H.useOptimistic(ke,vt)},ri.useReducer=function(ke,vt,Ot){return de.H.useReducer(ke,vt,Ot)},ri.useRef=function(ke){return de.H.useRef(ke)},ri.useState=function(ke){return de.H.useState(ke)},ri.useSyncExternalStore=function(ke,vt,Ot){return de.H.useSyncExternalStore(ke,vt,Ot)},ri.useTransition=function(){return de.H.useTransition()},ri.version="19.2.0",ri}var Uw;function s1(){return Uw||(Uw=1,xb.exports=lI()),xb.exports}var wt=s1();const GS=iy(wt);var wb={exports:{}},d_={},Tb={exports:{}},Sb={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $w;function uI(){return $w||($w=1,(function(i){function e(mt,$t){var Tt=mt.length;mt.push($t);e:for(;0<Tt;){var zt=Tt-1>>>1,Bt=mt[zt];if(0<d(Bt,$t))mt[zt]=$t,mt[Tt]=Bt,Tt=zt;else break e}}function n(mt){return mt.length===0?null:mt[0]}function o(mt){if(mt.length===0)return null;var $t=mt[0],Tt=mt.pop();if(Tt!==$t){mt[0]=Tt;e:for(var zt=0,Bt=mt.length,ke=Bt>>>1;zt<ke;){var vt=2*(zt+1)-1,Ot=mt[vt],jt=vt+1,Jt=mt[jt];if(0>d(Ot,Tt))jt<Bt&&0>d(Jt,Ot)?(mt[zt]=Jt,mt[jt]=Tt,zt=jt):(mt[zt]=Ot,mt[vt]=Tt,zt=vt);else if(jt<Bt&&0>d(Jt,Tt))mt[zt]=Jt,mt[jt]=Tt,zt=jt;else break e}}return $t}function d(mt,$t){var Tt=mt.sortIndex-$t.sortIndex;return Tt!==0?Tt:mt.id-$t.id}if(i.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var g=performance;i.unstable_now=function(){return g.now()}}else{var _=Date,c=_.now();i.unstable_now=function(){return _.now()-c}}var M=[],k=[],j=1,G=null,ee=3,Y=!1,xe=!1,be=!1,Ne=!1,tt=typeof setTimeout=="function"?setTimeout:null,Je=typeof clearTimeout=="function"?clearTimeout:null,qe=typeof setImmediate<"u"?setImmediate:null;function He(mt){for(var $t=n(k);$t!==null;){if($t.callback===null)o(k);else if($t.startTime<=mt)o(k),$t.sortIndex=$t.expirationTime,e(M,$t);else break;$t=n(k)}}function Ue(mt){if(be=!1,He(mt),!xe)if(n(M)!==null)xe=!0,Be||(Be=!0,Ge());else{var $t=n(k);$t!==null&&Jn(Ue,$t.startTime-mt)}}var Be=!1,de=-1,ce=5,_e=-1;function Ae(){return Ne?!0:!(i.unstable_now()-_e<ce)}function Pe(){if(Ne=!1,Be){var mt=i.unstable_now();_e=mt;var $t=!0;try{e:{xe=!1,be&&(be=!1,Je(de),de=-1),Y=!0;var Tt=ee;try{t:{for(He(mt),G=n(M);G!==null&&!(G.expirationTime>mt&&Ae());){var zt=G.callback;if(typeof zt=="function"){G.callback=null,ee=G.priorityLevel;var Bt=zt(G.expirationTime<=mt);if(mt=i.unstable_now(),typeof Bt=="function"){G.callback=Bt,He(mt),$t=!0;break t}G===n(M)&&o(M),He(mt)}else o(M);G=n(M)}if(G!==null)$t=!0;else{var ke=n(k);ke!==null&&Jn(Ue,ke.startTime-mt),$t=!1}}break e}finally{G=null,ee=Tt,Y=!1}$t=void 0}}finally{$t?Ge():Be=!1}}}var Ge;if(typeof qe=="function")Ge=function(){qe(Pe)};else if(typeof MessageChannel<"u"){var Re=new MessageChannel,In=Re.port2;Re.port1.onmessage=Pe,Ge=function(){In.postMessage(null)}}else Ge=function(){tt(Pe,0)};function Jn(mt,$t){de=tt(function(){mt(i.unstable_now())},$t)}i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function(mt){mt.callback=null},i.unstable_forceFrameRate=function(mt){0>mt||125<mt?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ce=0<mt?Math.floor(1e3/mt):5},i.unstable_getCurrentPriorityLevel=function(){return ee},i.unstable_next=function(mt){switch(ee){case 1:case 2:case 3:var $t=3;break;default:$t=ee}var Tt=ee;ee=$t;try{return mt()}finally{ee=Tt}},i.unstable_requestPaint=function(){Ne=!0},i.unstable_runWithPriority=function(mt,$t){switch(mt){case 1:case 2:case 3:case 4:case 5:break;default:mt=3}var Tt=ee;ee=mt;try{return $t()}finally{ee=Tt}},i.unstable_scheduleCallback=function(mt,$t,Tt){var zt=i.unstable_now();switch(typeof Tt=="object"&&Tt!==null?(Tt=Tt.delay,Tt=typeof Tt=="number"&&0<Tt?zt+Tt:zt):Tt=zt,mt){case 1:var Bt=-1;break;case 2:Bt=250;break;case 5:Bt=1073741823;break;case 4:Bt=1e4;break;default:Bt=5e3}return Bt=Tt+Bt,mt={id:j++,callback:$t,priorityLevel:mt,startTime:Tt,expirationTime:Bt,sortIndex:-1},Tt>zt?(mt.sortIndex=Tt,e(k,mt),n(M)===null&&mt===n(k)&&(be?(Je(de),de=-1):be=!0,Jn(Ue,Tt-zt))):(mt.sortIndex=Bt,e(M,mt),xe||Y||(xe=!0,Be||(Be=!0,Ge()))),mt},i.unstable_shouldYield=Ae,i.unstable_wrapCallback=function(mt){var $t=ee;return function(){var Tt=ee;ee=$t;try{return mt.apply(this,arguments)}finally{ee=Tt}}}})(Sb)),Sb}var qw;function cI(){return qw||(qw=1,Tb.exports=uI()),Tb.exports}var Eb={exports:{}},Cl={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Gw;function hI(){if(Gw)return Cl;Gw=1;var i=s1();function e(M){var k="https://react.dev/errors/"+M;if(1<arguments.length){k+="?args[]="+encodeURIComponent(arguments[1]);for(var j=2;j<arguments.length;j++)k+="&args[]="+encodeURIComponent(arguments[j])}return"Minified React error #"+M+"; visit "+k+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function n(){}var o={d:{f:n,r:function(){throw Error(e(522))},D:n,C:n,L:n,m:n,X:n,S:n,M:n},p:0,findDOMNode:null},d=Symbol.for("react.portal");function g(M,k,j){var G=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:d,key:G==null?null:""+G,children:M,containerInfo:k,implementation:j}}var _=i.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function c(M,k){if(M==="font")return"";if(typeof k=="string")return k==="use-credentials"?k:""}return Cl.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=o,Cl.createPortal=function(M,k){var j=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!k||k.nodeType!==1&&k.nodeType!==9&&k.nodeType!==11)throw Error(e(299));return g(M,k,null,j)},Cl.flushSync=function(M){var k=_.T,j=o.p;try{if(_.T=null,o.p=2,M)return M()}finally{_.T=k,o.p=j,o.d.f()}},Cl.preconnect=function(M,k){typeof M=="string"&&(k?(k=k.crossOrigin,k=typeof k=="string"?k==="use-credentials"?k:"":void 0):k=null,o.d.C(M,k))},Cl.prefetchDNS=function(M){typeof M=="string"&&o.d.D(M)},Cl.preinit=function(M,k){if(typeof M=="string"&&k&&typeof k.as=="string"){var j=k.as,G=c(j,k.crossOrigin),ee=typeof k.integrity=="string"?k.integrity:void 0,Y=typeof k.fetchPriority=="string"?k.fetchPriority:void 0;j==="style"?o.d.S(M,typeof k.precedence=="string"?k.precedence:void 0,{crossOrigin:G,integrity:ee,fetchPriority:Y}):j==="script"&&o.d.X(M,{crossOrigin:G,integrity:ee,fetchPriority:Y,nonce:typeof k.nonce=="string"?k.nonce:void 0})}},Cl.preinitModule=function(M,k){if(typeof M=="string")if(typeof k=="object"&&k!==null){if(k.as==null||k.as==="script"){var j=c(k.as,k.crossOrigin);o.d.M(M,{crossOrigin:j,integrity:typeof k.integrity=="string"?k.integrity:void 0,nonce:typeof k.nonce=="string"?k.nonce:void 0})}}else k==null&&o.d.M(M)},Cl.preload=function(M,k){if(typeof M=="string"&&typeof k=="object"&&k!==null&&typeof k.as=="string"){var j=k.as,G=c(j,k.crossOrigin);o.d.L(M,j,{crossOrigin:G,integrity:typeof k.integrity=="string"?k.integrity:void 0,nonce:typeof k.nonce=="string"?k.nonce:void 0,type:typeof k.type=="string"?k.type:void 0,fetchPriority:typeof k.fetchPriority=="string"?k.fetchPriority:void 0,referrerPolicy:typeof k.referrerPolicy=="string"?k.referrerPolicy:void 0,imageSrcSet:typeof k.imageSrcSet=="string"?k.imageSrcSet:void 0,imageSizes:typeof k.imageSizes=="string"?k.imageSizes:void 0,media:typeof k.media=="string"?k.media:void 0})}},Cl.preloadModule=function(M,k){if(typeof M=="string")if(k){var j=c(k.as,k.crossOrigin);o.d.m(M,{as:typeof k.as=="string"&&k.as!=="script"?k.as:void 0,crossOrigin:j,integrity:typeof k.integrity=="string"?k.integrity:void 0})}else o.d.m(M)},Cl.requestFormReset=function(M){o.d.r(M)},Cl.unstable_batchedUpdates=function(M,k){return M(k)},Cl.useFormState=function(M,k,j){return _.H.useFormState(M,k,j)},Cl.useFormStatus=function(){return _.H.useHostTransitionStatus()},Cl.version="19.2.0",Cl}var Zw;function dI(){if(Zw)return Eb.exports;Zw=1;function i(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(i)}catch(e){console.error(e)}}return i(),Eb.exports=hI(),Eb.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Hw;function fI(){if(Hw)return d_;Hw=1;var i=cI(),e=s1(),n=dI();function o(a){var h="https://react.dev/errors/"+a;if(1<arguments.length){h+="?args[]="+encodeURIComponent(arguments[1]);for(var y=2;y<arguments.length;y++)h+="&args[]="+encodeURIComponent(arguments[y])}return"Minified React error #"+a+"; visit "+h+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function d(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11)}function g(a){var h=a,y=a;if(a.alternate)for(;h.return;)h=h.return;else{a=h;do h=a,(h.flags&4098)!==0&&(y=h.return),a=h.return;while(a)}return h.tag===3?y:null}function _(a){if(a.tag===13){var h=a.memoizedState;if(h===null&&(a=a.alternate,a!==null&&(h=a.memoizedState)),h!==null)return h.dehydrated}return null}function c(a){if(a.tag===31){var h=a.memoizedState;if(h===null&&(a=a.alternate,a!==null&&(h=a.memoizedState)),h!==null)return h.dehydrated}return null}function M(a){if(g(a)!==a)throw Error(o(188))}function k(a){var h=a.alternate;if(!h){if(h=g(a),h===null)throw Error(o(188));return h!==a?null:a}for(var y=a,w=h;;){var D=y.return;if(D===null)break;var B=D.alternate;if(B===null){if(w=D.return,w!==null){y=w;continue}break}if(D.child===B.child){for(B=D.child;B;){if(B===y)return M(D),a;if(B===w)return M(D),h;B=B.sibling}throw Error(o(188))}if(y.return!==w.return)y=D,w=B;else{for(var Q=!1,he=D.child;he;){if(he===y){Q=!0,y=D,w=B;break}if(he===w){Q=!0,w=D,y=B;break}he=he.sibling}if(!Q){for(he=B.child;he;){if(he===y){Q=!0,y=B,w=D;break}if(he===w){Q=!0,w=B,y=D;break}he=he.sibling}if(!Q)throw Error(o(189))}}if(y.alternate!==w)throw Error(o(190))}if(y.tag!==3)throw Error(o(188));return y.stateNode.current===y?a:h}function j(a){var h=a.tag;if(h===5||h===26||h===27||h===6)return a;for(a=a.child;a!==null;){if(h=j(a),h!==null)return h;a=a.sibling}return null}var G=Object.assign,ee=Symbol.for("react.element"),Y=Symbol.for("react.transitional.element"),xe=Symbol.for("react.portal"),be=Symbol.for("react.fragment"),Ne=Symbol.for("react.strict_mode"),tt=Symbol.for("react.profiler"),Je=Symbol.for("react.consumer"),qe=Symbol.for("react.context"),He=Symbol.for("react.forward_ref"),Ue=Symbol.for("react.suspense"),Be=Symbol.for("react.suspense_list"),de=Symbol.for("react.memo"),ce=Symbol.for("react.lazy"),_e=Symbol.for("react.activity"),Ae=Symbol.for("react.memo_cache_sentinel"),Pe=Symbol.iterator;function Ge(a){return a===null||typeof a!="object"?null:(a=Pe&&a[Pe]||a["@@iterator"],typeof a=="function"?a:null)}var Re=Symbol.for("react.client.reference");function In(a){if(a==null)return null;if(typeof a=="function")return a.$$typeof===Re?null:a.displayName||a.name||null;if(typeof a=="string")return a;switch(a){case be:return"Fragment";case tt:return"Profiler";case Ne:return"StrictMode";case Ue:return"Suspense";case Be:return"SuspenseList";case _e:return"Activity"}if(typeof a=="object")switch(a.$$typeof){case xe:return"Portal";case qe:return a.displayName||"Context";case Je:return(a._context.displayName||"Context")+".Consumer";case He:var h=a.render;return a=a.displayName,a||(a=h.displayName||h.name||"",a=a!==""?"ForwardRef("+a+")":"ForwardRef"),a;case de:return h=a.displayName||null,h!==null?h:In(a.type)||"Memo";case ce:h=a._payload,a=a._init;try{return In(a(h))}catch{}}return null}var Jn=Array.isArray,mt=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,$t=n.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Tt={pending:!1,data:null,method:null,action:null},zt=[],Bt=-1;function ke(a){return{current:a}}function vt(a){0>Bt||(a.current=zt[Bt],zt[Bt]=null,Bt--)}function Ot(a,h){Bt++,zt[Bt]=a.current,a.current=h}var jt=ke(null),Jt=ke(null),Xt=ke(null),Fn=ke(null);function si(a,h){switch(Ot(Xt,h),Ot(Jt,a),Ot(jt,null),h.nodeType){case 9:case 11:a=(a=h.documentElement)&&(a=a.namespaceURI)?sp(a):0;break;default:if(a=h.tagName,h=h.namespaceURI)h=sp(h),a=op(h,a);else switch(a){case"svg":a=1;break;case"math":a=2;break;default:a=0}}vt(jt),Ot(jt,a)}function di(){vt(jt),vt(Jt),vt(Xt)}function ds(a){a.memoizedState!==null&&Ot(Fn,a);var h=jt.current,y=op(h,a.type);h!==y&&(Ot(Jt,a),Ot(jt,y))}function Ns(a){Jt.current===a&&(vt(jt),vt(Jt)),Fn.current===a&&(vt(Fn),Qn._currentValue=Tt)}var kr,Ni;function Ii(a){if(kr===void 0)try{throw Error()}catch(y){var h=y.stack.trim().match(/\n( *(at )?)/);kr=h&&h[1]||"",Ni=-1<y.stack.indexOf(`
    at`)?" (<anonymous>)":-1<y.stack.indexOf("@")?"@unknown:0:0":""}return`
`+kr+a+Ni}var Va=!1;function Ta(a,h){if(!a||Va)return"";Va=!0;var y=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var w={DetermineComponentFrameRoot:function(){try{if(h){var Et=function(){throw Error()};if(Object.defineProperty(Et.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Et,[])}catch(yt){var ft=yt}Reflect.construct(a,[],Et)}else{try{Et.call()}catch(yt){ft=yt}a.call(Et.prototype)}}else{try{throw Error()}catch(yt){ft=yt}(Et=a())&&typeof Et.catch=="function"&&Et.catch(function(){})}}catch(yt){if(yt&&ft&&typeof yt.stack=="string")return[yt.stack,ft.stack]}return[null,null]}};w.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var D=Object.getOwnPropertyDescriptor(w.DetermineComponentFrameRoot,"name");D&&D.configurable&&Object.defineProperty(w.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var B=w.DetermineComponentFrameRoot(),Q=B[0],he=B[1];if(Q&&he){var je=Q.split(`
`),dt=he.split(`
`);for(D=w=0;w<je.length&&!je[w].includes("DetermineComponentFrameRoot");)w++;for(;D<dt.length&&!dt[D].includes("DetermineComponentFrameRoot");)D++;if(w===je.length||D===dt.length)for(w=je.length-1,D=dt.length-1;1<=w&&0<=D&&je[w]!==dt[D];)D--;for(;1<=w&&0<=D;w--,D--)if(je[w]!==dt[D]){if(w!==1||D!==1)do if(w--,D--,0>D||je[w]!==dt[D]){var bt=`
`+je[w].replace(" at new "," at ");return a.displayName&&bt.includes("<anonymous>")&&(bt=bt.replace("<anonymous>",a.displayName)),bt}while(1<=w&&0<=D);break}}}finally{Va=!1,Error.prepareStackTrace=y}return(y=a?a.displayName||a.name:"")?Ii(y):""}function Bs(a,h){switch(a.tag){case 26:case 27:case 5:return Ii(a.type);case 16:return Ii("Lazy");case 13:return a.child!==h&&h!==null?Ii("Suspense Fallback"):Ii("Suspense");case 19:return Ii("SuspenseList");case 0:case 15:return Ta(a.type,!1);case 11:return Ta(a.type.render,!1);case 1:return Ta(a.type,!0);case 31:return Ii("Activity");default:return""}}function Sa(a){try{var h="",y=null;do h+=Bs(a,y),y=a,a=a.return;while(a);return h}catch(w){return`
Error generating stack: `+w.message+`
`+w.stack}}var Bi=Object.prototype.hasOwnProperty,fr=i.unstable_scheduleCallback,Ea=i.unstable_cancelCallback,So=i.unstable_shouldYield,so=i.unstable_requestPaint,$r=i.unstable_now,fs=i.unstable_getCurrentPriorityLevel,ps=i.unstable_ImmediatePriority,Fs=i.unstable_UserBlockingPriority,ms=i.unstable_NormalPriority,Ke=i.unstable_LowPriority,se=i.unstable_IdlePriority,le=i.log,fe=i.unstable_setDisableYieldValue,Se=null,De=null;function Ze(a){if(typeof le=="function"&&fe(a),De&&typeof De.setStrictMode=="function")try{De.setStrictMode(Se,a)}catch{}}var et=Math.clz32?Math.clz32:It,Xe=Math.log,_t=Math.LN2;function It(a){return a>>>=0,a===0?32:31-(Xe(a)/_t|0)|0}var xt=256,tn=262144,$e=4194304;function vn(a){var h=a&42;if(h!==0)return h;switch(a&-a){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return a&261888;case 262144:case 524288:case 1048576:case 2097152:return a&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return a&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return a}}function Rn(a,h,y){var w=a.pendingLanes;if(w===0)return 0;var D=0,B=a.suspendedLanes,Q=a.pingedLanes;a=a.warmLanes;var he=w&134217727;return he!==0?(w=he&~B,w!==0?D=vn(w):(Q&=he,Q!==0?D=vn(Q):y||(y=he&~a,y!==0&&(D=vn(y))))):(he=w&~B,he!==0?D=vn(he):Q!==0?D=vn(Q):y||(y=w&~a,y!==0&&(D=vn(y)))),D===0?0:h!==0&&h!==D&&(h&B)===0&&(B=D&-D,y=h&-h,B>=y||B===32&&(y&4194048)!==0)?h:D}function nn(a,h){return(a.pendingLanes&~(a.suspendedLanes&~a.pingedLanes)&h)===0}function Nn(a,h){switch(a){case 1:case 2:case 4:case 8:case 64:return h+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return h+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Pi(){var a=$e;return $e<<=1,($e&62914560)===0&&($e=4194304),a}function $i(a){for(var h=[],y=0;31>y;y++)h.push(a);return h}function er(a,h){a.pendingLanes|=h,h!==268435456&&(a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0)}function Cr(a,h,y,w,D,B){var Q=a.pendingLanes;a.pendingLanes=y,a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0,a.expiredLanes&=y,a.entangledLanes&=y,a.errorRecoveryDisabledLanes&=y,a.shellSuspendCounter=0;var he=a.entanglements,je=a.expirationTimes,dt=a.hiddenUpdates;for(y=Q&~y;0<y;){var bt=31-et(y),Et=1<<bt;he[bt]=0,je[bt]=-1;var ft=dt[bt];if(ft!==null)for(dt[bt]=null,bt=0;bt<ft.length;bt++){var yt=ft[bt];yt!==null&&(yt.lane&=-536870913)}y&=~Et}w!==0&&Vn(a,w,0),B!==0&&D===0&&a.tag!==0&&(a.suspendedLanes|=B&~(Q&~h))}function Vn(a,h,y){a.pendingLanes|=h,a.suspendedLanes&=~h;var w=31-et(h);a.entangledLanes|=h,a.entanglements[w]=a.entanglements[w]|1073741824|y&261930}function Kn(a,h){var y=a.entangledLanes|=h;for(a=a.entanglements;y;){var w=31-et(y),D=1<<w;D&h|a[w]&h&&(a[w]|=h),y&=~D}}function vr(a,h){var y=h&-h;return y=(y&42)!==0?1:Pt(y),(y&(a.suspendedLanes|h))!==0?0:y}function Pt(a){switch(a){case 2:a=1;break;case 8:a=4;break;case 32:a=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:a=128;break;case 268435456:a=134217728;break;default:a=0}return a}function en(a){return a&=-a,2<a?8<a?(a&134217727)!==0?32:268435456:8:2}function tr(){var a=$t.p;return a!==0?a:(a=window.event,a===void 0?32:Oa(a.type))}function ta(a,h){var y=$t.p;try{return $t.p=a,h()}finally{$t.p=y}}var Aa=Math.random().toString(36).slice(2),Lt="__reactFiber$"+Aa,yn="__reactProps$"+Aa,Mn="__reactContainer$"+Aa,nr="__reactEvents$"+Aa,il="__reactListeners$"+Aa,Eo="__reactHandles$"+Aa,Bn="__reactResources$"+Aa,Vs="__reactMarker$"+Aa;function js(a){delete a[Lt],delete a[yn],delete a[nr],delete a[il],delete a[Eo]}function gs(a){var h=a[Lt];if(h)return h;for(var y=a.parentNode;y;){if(h=y[Mn]||y[Lt]){if(y=h.alternate,h.child!==null||y!==null&&y.child!==null)for(a=cp(a);a!==null;){if(y=a[Lt])return y;a=cp(a)}return h}a=y,y=a.parentNode}return null}function qr(a){if(a=a[Lt]||a[Mn]){var h=a.tag;if(h===5||h===6||h===13||h===31||h===26||h===27||h===3)return a}return null}function Gr(a){var h=a.tag;if(h===5||h===26||h===27||h===6)return a.stateNode;throw Error(o(33))}function Si(a){var h=a[Bn];return h||(h=a[Bn]={hoistableStyles:new Map,hoistableScripts:new Map}),h}function Mr(a){a[Vs]=!0}var da=new Set,xi={};function Ao(a,h){ja(a,h),ja(a+"Capture",h)}function ja(a,h){for(xi[a]=h,a=0;a<h.length;a++)da.add(h[a])}var Co=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Us={},$s={};function rl(a){return Bi.call($s,a)?!0:Bi.call(Us,a)?!1:Co.test(a)?$s[a]=!0:(Us[a]=!0,!1)}function ni(a,h,y){if(rl(h))if(y===null)a.removeAttribute(h);else{switch(typeof y){case"undefined":case"function":case"symbol":a.removeAttribute(h);return;case"boolean":var w=h.toLowerCase().slice(0,5);if(w!=="data-"&&w!=="aria-"){a.removeAttribute(h);return}}a.setAttribute(h,""+y)}}function ci(a,h,y){if(y===null)a.removeAttribute(h);else{switch(typeof y){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(h);return}a.setAttribute(h,""+y)}}function qi(a,h,y,w){if(w===null)a.removeAttribute(y);else{switch(typeof w){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(y);return}a.setAttributeNS(h,y,""+w)}}function br(a){switch(typeof a){case"bigint":case"boolean":case"number":case"string":case"undefined":return a;case"object":return a;default:return""}}function qs(a){var h=a.type;return(a=a.nodeName)&&a.toLowerCase()==="input"&&(h==="checkbox"||h==="radio")}function cu(a,h,y){var w=Object.getOwnPropertyDescriptor(a.constructor.prototype,h);if(!a.hasOwnProperty(h)&&typeof w<"u"&&typeof w.get=="function"&&typeof w.set=="function"){var D=w.get,B=w.set;return Object.defineProperty(a,h,{configurable:!0,get:function(){return D.call(this)},set:function(Q){y=""+Q,B.call(this,Q)}}),Object.defineProperty(a,h,{enumerable:w.enumerable}),{getValue:function(){return y},setValue:function(Q){y=""+Q},stopTracking:function(){a._valueTracker=null,delete a[h]}}}}function on(a){if(!a._valueTracker){var h=qs(a)?"checked":"value";a._valueTracker=cu(a,h,""+a[h])}}function Fi(a){if(!a)return!1;var h=a._valueTracker;if(!h)return!0;var y=h.getValue(),w="";return a&&(w=qs(a)?a.checked?"true":"false":a.value),a=w,a!==y?(h.setValue(a),!0):!1}function Ca(a){if(a=a||(typeof document<"u"?document:void 0),typeof a>"u")return null;try{return a.activeElement||a.body}catch{return a.body}}var oo=/[\n"\\]/g;function ir(a){return a.replace(oo,function(h){return"\\"+h.charCodeAt(0).toString(16)+" "})}function Mo(a,h,y,w,D,B,Q,he){a.name="",Q!=null&&typeof Q!="function"&&typeof Q!="symbol"&&typeof Q!="boolean"?a.type=Q:a.removeAttribute("type"),h!=null?Q==="number"?(h===0&&a.value===""||a.value!=h)&&(a.value=""+br(h)):a.value!==""+br(h)&&(a.value=""+br(h)):Q!=="submit"&&Q!=="reset"||a.removeAttribute("value"),h!=null?Gs(a,Q,br(h)):y!=null?Gs(a,Q,br(y)):w!=null&&a.removeAttribute("value"),D==null&&B!=null&&(a.defaultChecked=!!B),D!=null&&(a.checked=D&&typeof D!="function"&&typeof D!="symbol"),he!=null&&typeof he!="function"&&typeof he!="symbol"&&typeof he!="boolean"?a.name=""+br(he):a.removeAttribute("name")}function Rl(a,h,y,w,D,B,Q,he){if(B!=null&&typeof B!="function"&&typeof B!="symbol"&&typeof B!="boolean"&&(a.type=B),h!=null||y!=null){if(!(B!=="submit"&&B!=="reset"||h!=null)){on(a);return}y=y!=null?""+br(y):"",h=h!=null?""+br(h):y,he||h===a.value||(a.value=h),a.defaultValue=h}w=w??D,w=typeof w!="function"&&typeof w!="symbol"&&!!w,a.checked=he?a.checked:!!w,a.defaultChecked=!!w,Q!=null&&typeof Q!="function"&&typeof Q!="symbol"&&typeof Q!="boolean"&&(a.name=Q),on(a)}function Gs(a,h,y){h==="number"&&Ca(a.ownerDocument)===a||a.defaultValue===""+y||(a.defaultValue=""+y)}function rr(a,h,y,w){if(a=a.options,h){h={};for(var D=0;D<y.length;D++)h["$"+y[D]]=!0;for(y=0;y<a.length;y++)D=h.hasOwnProperty("$"+a[y].value),a[y].selected!==D&&(a[y].selected=D),D&&w&&(a[y].defaultSelected=!0)}else{for(y=""+br(y),h=null,D=0;D<a.length;D++){if(a[D].value===y){a[D].selected=!0,w&&(a[D].defaultSelected=!0);return}h!==null||a[D].disabled||(h=a[D])}h!==null&&(h.selected=!0)}}function Qa(a,h,y){if(h!=null&&(h=""+br(h),h!==a.value&&(a.value=h),y==null)){a.defaultValue!==h&&(a.defaultValue=h);return}a.defaultValue=y!=null?""+br(y):""}function Ua(a,h,y,w){if(h==null){if(w!=null){if(y!=null)throw Error(o(92));if(Jn(w)){if(1<w.length)throw Error(o(93));w=w[0]}y=w}y==null&&(y=""),h=y}y=br(h),a.defaultValue=y,w=a.textContent,w===y&&w!==""&&w!==null&&(a.value=w),on(a)}function Gi(a,h){if(h){var y=a.firstChild;if(y&&y===a.lastChild&&y.nodeType===3){y.nodeValue=h;return}}a.textContent=h}var jn=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Ja(a,h,y){var w=h.indexOf("--")===0;y==null||typeof y=="boolean"||y===""?w?a.setProperty(h,""):h==="float"?a.cssFloat="":a[h]="":w?a.setProperty(h,y):typeof y!="number"||y===0||jn.has(h)?h==="float"?a.cssFloat=y:a[h]=(""+y).trim():a[h]=y+"px"}function _s(a,h,y){if(h!=null&&typeof h!="object")throw Error(o(62));if(a=a.style,y!=null){for(var w in y)!y.hasOwnProperty(w)||h!=null&&h.hasOwnProperty(w)||(w.indexOf("--")===0?a.setProperty(w,""):w==="float"?a.cssFloat="":a[w]="");for(var D in h)w=h[D],h.hasOwnProperty(D)&&y[D]!==w&&Ja(a,D,w)}else for(var B in h)h.hasOwnProperty(B)&&Ja(a,B,h[B])}function $a(a){if(a.indexOf("-")===-1)return!1;switch(a){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Zs=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Ln=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function ys(a){return Ln.test(""+a)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":a}function Ma(){}var Ll=null;function Zi(a){return a=a.target||a.srcElement||window,a.correspondingUseElement&&(a=a.correspondingUseElement),a.nodeType===3?a.parentNode:a}var pr=null,hn=null;function fi(a){var h=qr(a);if(h&&(a=h.stateNode)){var y=a[yn]||null;e:switch(a=h.stateNode,h.type){case"input":if(Mo(a,y.value,y.defaultValue,y.defaultValue,y.checked,y.defaultChecked,y.type,y.name),h=y.name,y.type==="radio"&&h!=null){for(y=a;y.parentNode;)y=y.parentNode;for(y=y.querySelectorAll('input[name="'+ir(""+h)+'"][type="radio"]'),h=0;h<y.length;h++){var w=y[h];if(w!==a&&w.form===a.form){var D=w[yn]||null;if(!D)throw Error(o(90));Mo(w,D.value,D.defaultValue,D.defaultValue,D.checked,D.defaultChecked,D.type,D.name)}}for(h=0;h<y.length;h++)w=y[h],w.form===a.form&&Fi(w)}break e;case"textarea":Qa(a,y.value,y.defaultValue);break e;case"select":h=y.value,h!=null&&rr(a,!!y.multiple,h,!1)}}}var xn=!1;function al(a,h,y){if(xn)return a(h,y);xn=!0;try{var w=a(h);return w}finally{if(xn=!1,(pr!==null||hn!==null)&&(Sd(),pr&&(h=pr,a=hn,hn=pr=null,fi(h),a)))for(h=0;h<a.length;h++)fi(a[h])}}function ar(a,h){var y=a.stateNode;if(y===null)return null;var w=y[yn]||null;if(w===null)return null;y=w[h];e:switch(h){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(w=!w.disabled)||(a=a.type,w=!(a==="button"||a==="input"||a==="select"||a==="textarea")),a=!w;break e;default:a=!1}if(a)return null;if(y&&typeof y!="function")throw Error(o(231,h,typeof y));return y}var ur=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),xr=!1;if(ur)try{var bn={};Object.defineProperty(bn,"passive",{get:function(){xr=!0}}),window.addEventListener("test",bn,bn),window.removeEventListener("test",bn,bn)}catch{xr=!1}var fa=null,fn=null,sn=null;function na(){if(sn)return sn;var a,h=fn,y=h.length,w,D="value"in fa?fa.value:fa.textContent,B=D.length;for(a=0;a<y&&h[a]===D[a];a++);var Q=y-a;for(w=1;w<=Q&&h[y-w]===D[B-w];w++);return sn=D.slice(a,1<w?1-w:void 0)}function $n(a){var h=a.keyCode;return"charCode"in a?(a=a.charCode,a===0&&h===13&&(a=13)):a=h,a===10&&(a=13),32<=a||a===13?a:0}function Dr(){return!0}function Yr(){return!1}function sr(a){function h(y,w,D,B,Q){this._reactName=y,this._targetInst=D,this.type=w,this.nativeEvent=B,this.target=Q,this.currentTarget=null;for(var he in a)a.hasOwnProperty(he)&&(y=a[he],this[he]=y?y(B):B[he]);return this.isDefaultPrevented=(B.defaultPrevented!=null?B.defaultPrevented:B.returnValue===!1)?Dr:Yr,this.isPropagationStopped=Yr,this}return G(h.prototype,{preventDefault:function(){this.defaultPrevented=!0;var y=this.nativeEvent;y&&(y.preventDefault?y.preventDefault():typeof y.returnValue!="unknown"&&(y.returnValue=!1),this.isDefaultPrevented=Dr)},stopPropagation:function(){var y=this.nativeEvent;y&&(y.stopPropagation?y.stopPropagation():typeof y.cancelBubble!="unknown"&&(y.cancelBubble=!0),this.isPropagationStopped=Dr)},persist:function(){},isPersistent:Dr}),h}var vs={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(a){return a.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},lo=sr(vs),bs=G({},vs,{view:0,detail:0}),Xn=sr(bs),Io,ia,Ia,Pa=G({},bs,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:uo,button:0,buttons:0,relatedTarget:function(a){return a.relatedTarget===void 0?a.fromElement===a.srcElement?a.toElement:a.fromElement:a.relatedTarget},movementX:function(a){return"movementX"in a?a.movementX:(a!==Ia&&(Ia&&a.type==="mousemove"?(Io=a.screenX-Ia.screenX,ia=a.screenY-Ia.screenY):ia=Io=0,Ia=a),Io)},movementY:function(a){return"movementY"in a?a.movementY:ia}}),zr=sr(Pa),xs=G({},Pa,{dataTransfer:0}),ql=sr(xs),Po=G({},bs,{relatedTarget:0}),Hi=sr(Po),Uu=G({},vs,{animationName:0,elapsedTime:0,pseudoElement:0}),sl=sr(Uu),Gl=G({},vs,{clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),Hs=sr(Gl),kl=G({},vs,{data:0}),or=sr(kl),es={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},ws={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Dl={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function ol(a){var h=this.nativeEvent;return h.getModifierState?h.getModifierState(a):(a=Dl[a])?!!h[a]:!1}function uo(){return ol}var Ei=G({},bs,{key:function(a){if(a.key){var h=es[a.key]||a.key;if(h!=="Unidentified")return h}return a.type==="keypress"?(a=$n(a),a===13?"Enter":String.fromCharCode(a)):a.type==="keydown"||a.type==="keyup"?ws[a.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:uo,charCode:function(a){return a.type==="keypress"?$n(a):0},keyCode:function(a){return a.type==="keydown"||a.type==="keyup"?a.keyCode:0},which:function(a){return a.type==="keypress"?$n(a):a.type==="keydown"||a.type==="keyup"?a.keyCode:0}}),$u=sr(Ei),hu=G({},Pa,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),zl=sr(hu),P=G({},bs,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:uo}),Z=sr(P),ne=G({},vs,{propertyName:0,elapsedTime:0,pseudoElement:0}),ye=sr(ne),at=G({},Pa,{deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?-a.wheelDelta:0},deltaZ:0,deltaMode:0}),ht=sr(at),Wt=G({},vs,{newState:0,oldState:0}),kn=sr(Wt),Wn=[9,13,27,32],wi=ur&&"CompositionEvent"in window,Xi=null;ur&&"documentMode"in document&&(Xi=document.documentMode);var qa=ur&&"TextEvent"in window&&!Xi,Ga=ur&&(!wi||Xi&&8<Xi&&11>=Xi),Xs=" ",Ts=!1;function du(a,h){switch(a){case"keyup":return Wn.indexOf(h.keyCode)!==-1;case"keydown":return h.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Ws(a){return a=a.detail,typeof a=="object"&&"data"in a?a.data:null}var fu=!1;function Ks(a,h){switch(a){case"compositionend":return Ws(h);case"keypress":return h.which!==32?null:(Ts=!0,Xs);case"textInput":return a=h.data,a===Xs&&Ts?null:a;default:return null}}function qu(a,h){if(fu)return a==="compositionend"||!wi&&du(a,h)?(a=na(),sn=fn=fa=null,fu=!1,a):null;switch(a){case"paste":return null;case"keypress":if(!(h.ctrlKey||h.altKey||h.metaKey)||h.ctrlKey&&h.altKey){if(h.char&&1<h.char.length)return h.char;if(h.which)return String.fromCharCode(h.which)}return null;case"compositionend":return Ga&&h.locale!=="ko"?null:h.data;default:return null}}var jd={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function co(a){var h=a&&a.nodeName&&a.nodeName.toLowerCase();return h==="input"?!!jd[a.type]:h==="textarea"}function Yh(a,h,y,w){pr?hn?hn.push(w):hn=[w]:pr=w,h=ap(h,"onChange"),0<h.length&&(y=new lo("onChange","change",null,y,w),a.push({event:y,listeners:h}))}var Ys=null,Gu=null;function Zu(a){gm(a,0)}function Ro(a){var h=Gr(a);if(Fi(h))return a}function pu(a,h){if(a==="change")return h}var dh=!1;if(ur){var Ss;if(ur){var Hu="oninput"in document;if(!Hu){var Xu=document.createElement("div");Xu.setAttribute("oninput","return;"),Hu=typeof Xu.oninput=="function"}Ss=Hu}else Ss=!1;dh=Ss&&(!document.documentMode||9<document.documentMode)}function kc(){Ys&&(Ys.detachEvent("onpropertychange",Ud),Gu=Ys=null)}function Ud(a){if(a.propertyName==="value"&&Ro(Gu)){var h=[];Yh(h,Gu,a,Zi(a)),al(Zu,h)}}function ll(a,h,y){a==="focusin"?(kc(),Ys=h,Gu=y,Ys.attachEvent("onpropertychange",Ud)):a==="focusout"&&kc()}function $d(a){if(a==="selectionchange"||a==="keyup"||a==="keydown")return Ro(Gu)}function Zl(a,h){if(a==="click")return Ro(h)}function Qh(a,h){if(a==="input"||a==="change")return Ro(h)}function ul(a,h){return a===h&&(a!==0||1/a===1/h)||a!==a&&h!==h}var ra=typeof Object.is=="function"?Object.is:ul;function Es(a,h){if(ra(a,h))return!0;if(typeof a!="object"||a===null||typeof h!="object"||h===null)return!1;var y=Object.keys(a),w=Object.keys(h);if(y.length!==w.length)return!1;for(w=0;w<y.length;w++){var D=y[w];if(!Bi.call(h,D)||!ra(a[D],h[D]))return!1}return!0}function oi(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function mu(a,h){var y=oi(a);a=0;for(var w;y;){if(y.nodeType===3){if(w=a+y.textContent.length,a<=h&&w>=h)return{node:y,offset:h-a};a=w}e:{for(;y;){if(y.nextSibling){y=y.nextSibling;break e}y=y.parentNode}y=void 0}y=oi(y)}}function Wu(a,h){return a&&h?a===h?!0:a&&a.nodeType===3?!1:h&&h.nodeType===3?Wu(a,h.parentNode):"contains"in a?a.contains(h):a.compareDocumentPosition?!!(a.compareDocumentPosition(h)&16):!1:!1}function Ku(a){a=a!=null&&a.ownerDocument!=null&&a.ownerDocument.defaultView!=null?a.ownerDocument.defaultView:window;for(var h=Ca(a.document);h instanceof a.HTMLIFrameElement;){try{var y=typeof h.contentWindow.location.href=="string"}catch{y=!1}if(y)a=h.contentWindow;else break;h=Ca(a.document)}return h}function cl(a){var h=a&&a.nodeName&&a.nodeName.toLowerCase();return h&&(h==="input"&&(a.type==="text"||a.type==="search"||a.type==="tel"||a.type==="url"||a.type==="password")||h==="textarea"||a.contentEditable==="true")}var hl=ur&&"documentMode"in document&&11>=document.documentMode,dl=null,fh=null,Dc=null,Yu=!1;function qd(a,h,y){var w=y.window===y?y.document:y.nodeType===9?y:y.ownerDocument;Yu||dl==null||dl!==Ca(w)||(w=dl,"selectionStart"in w&&cl(w)?w={start:w.selectionStart,end:w.selectionEnd}:(w=(w.ownerDocument&&w.ownerDocument.defaultView||window).getSelection(),w={anchorNode:w.anchorNode,anchorOffset:w.anchorOffset,focusNode:w.focusNode,focusOffset:w.focusOffset}),Dc&&Es(Dc,w)||(Dc=w,w=ap(fh,"onSelect"),0<w.length&&(h=new lo("onSelect","select",null,h,y),a.push({event:h,listeners:w}),h.target=dl)))}function Ol(a,h){var y={};return y[a.toLowerCase()]=h.toLowerCase(),y["Webkit"+a]="webkit"+h,y["Moz"+a]="moz"+h,y}var Qu={animationend:Ol("Animation","AnimationEnd"),animationiteration:Ol("Animation","AnimationIteration"),animationstart:Ol("Animation","AnimationStart"),transitionrun:Ol("Transition","TransitionRun"),transitionstart:Ol("Transition","TransitionStart"),transitioncancel:Ol("Transition","TransitionCancel"),transitionend:Ol("Transition","TransitionEnd")},zc={},Oc={};ur&&(Oc=document.createElement("div").style,"AnimationEvent"in window||(delete Qu.animationend.animation,delete Qu.animationiteration.animation,delete Qu.animationstart.animation),"TransitionEvent"in window||delete Qu.transitionend.transition);function aa(a){if(zc[a])return zc[a];if(!Qu[a])return a;var h=Qu[a],y;for(y in h)if(h.hasOwnProperty(y)&&y in Oc)return zc[a]=h[y];return a}var Hl=aa("animationend"),ph=aa("animationiteration"),Lo=aa("animationstart"),Nc=aa("transitionrun"),gu=aa("transitionstart"),ho=aa("transitioncancel"),_u=aa("transitionend"),Jh=new Map,fl="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");fl.push("scrollEnd");function pa(a,h){Jh.set(a,h),Ao(h,[a])}var Xl=typeof reportError=="function"?reportError:function(a){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var h=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof a=="object"&&a!==null&&typeof a.message=="string"?String(a.message):String(a),error:a});if(!window.dispatchEvent(h))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",a);return}console.error(a)},ts=[],ma=0,yu=0;function Ju(){for(var a=ma,h=yu=ma=0;h<a;){var y=ts[h];ts[h++]=null;var w=ts[h];ts[h++]=null;var D=ts[h];ts[h++]=null;var B=ts[h];if(ts[h++]=null,w!==null&&D!==null){var Q=w.pending;Q===null?D.next=D:(D.next=Q.next,Q.next=D),w.pending=D}B!==0&&Wl(y,D,B)}}function Qs(a,h,y,w){ts[ma++]=a,ts[ma++]=h,ts[ma++]=y,ts[ma++]=w,yu|=w,a.lanes|=w,a=a.alternate,a!==null&&(a.lanes|=w)}function pl(a,h,y,w){return Qs(a,h,y,w),qn(a)}function ko(a,h){return Qs(a,null,null,h),qn(a)}function Wl(a,h,y){a.lanes|=y;var w=a.alternate;w!==null&&(w.lanes|=y);for(var D=!1,B=a.return;B!==null;)B.childLanes|=y,w=B.alternate,w!==null&&(w.childLanes|=y),B.tag===22&&(a=B.stateNode,a===null||a._visibility&1||(D=!0)),a=B,B=B.return;return a.tag===3?(B=a.stateNode,D&&h!==null&&(D=31-et(y),a=B.hiddenUpdates,w=a[D],w===null?a[D]=[h]:w.push(h),h.lane=y|536870912),B):null}function qn(a){if(50<Jf)throw Jf=0,Ug=null,Error(o(185));for(var h=a.return;h!==null;)a=h,h=a.return;return a.tag===3?a.stateNode:null}var Do={};function zf(a,h,y,w){this.tag=a,this.key=y,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=h,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=w,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ns(a,h,y,w){return new zf(a,h,y,w)}function zo(a){return a=a.prototype,!(!a||!a.isReactComponent)}function Oo(a,h){var y=a.alternate;return y===null?(y=ns(a.tag,h,a.key,a.mode),y.elementType=a.elementType,y.type=a.type,y.stateNode=a.stateNode,y.alternate=a,a.alternate=y):(y.pendingProps=h,y.type=a.type,y.flags=0,y.subtreeFlags=0,y.deletions=null),y.flags=a.flags&65011712,y.childLanes=a.childLanes,y.lanes=a.lanes,y.child=a.child,y.memoizedProps=a.memoizedProps,y.memoizedState=a.memoizedState,y.updateQueue=a.updateQueue,h=a.dependencies,y.dependencies=h===null?null:{lanes:h.lanes,firstContext:h.firstContext},y.sibling=a.sibling,y.index=a.index,y.ref=a.ref,y.refCleanup=a.refCleanup,y}function ed(a,h){a.flags&=65011714;var y=a.alternate;return y===null?(a.childLanes=0,a.lanes=h,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=y.childLanes,a.lanes=y.lanes,a.child=y.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=y.memoizedProps,a.memoizedState=y.memoizedState,a.updateQueue=y.updateQueue,a.type=y.type,h=y.dependencies,a.dependencies=h===null?null:{lanes:h.lanes,firstContext:h.firstContext}),a}function ec(a,h,y,w,D,B){var Q=0;if(w=a,typeof a=="function")zo(a)&&(Q=1);else if(typeof a=="string")Q=Zt(a,y,jt.current)?26:a==="html"||a==="head"||a==="body"?27:5;else e:switch(a){case _e:return a=ns(31,y,h,D),a.elementType=_e,a.lanes=B,a;case be:return vu(y.children,D,B,h);case Ne:Q=8,D|=24;break;case tt:return a=ns(12,y,h,D|2),a.elementType=tt,a.lanes=B,a;case Ue:return a=ns(13,y,h,D),a.elementType=Ue,a.lanes=B,a;case Be:return a=ns(19,y,h,D),a.elementType=Be,a.lanes=B,a;default:if(typeof a=="object"&&a!==null)switch(a.$$typeof){case qe:Q=10;break e;case Je:Q=9;break e;case He:Q=11;break e;case de:Q=14;break e;case ce:Q=16,w=null;break e}Q=29,y=Error(o(130,a===null?"null":typeof a,"")),w=null}return h=ns(Q,y,h,D),h.elementType=a,h.type=w,h.lanes=B,h}function vu(a,h,y,w){return a=ns(7,a,w,h),a.lanes=y,a}function tc(a,h,y){return a=ns(6,a,null,h),a.lanes=y,a}function nc(a){var h=ns(18,null,null,0);return h.stateNode=a,h}function bu(a,h,y){return h=ns(4,a.children!==null?a.children:[],a.key,h),h.lanes=y,h.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation},h}var f=new WeakMap;function x(a,h){if(typeof a=="object"&&a!==null){var y=f.get(a);return y!==void 0?y:(h={value:a,source:h,stack:Sa(h)},f.set(a,h),h)}return{value:a,source:h,stack:Sa(h)}}var R=[],V=0,K=null,ue=0,Oe=[],nt=0,ut=null,Mt=1,Kt="";function pn(a,h){R[V++]=ue,R[V++]=K,K=a,ue=h}function Yn(a,h,y){Oe[nt++]=Mt,Oe[nt++]=Kt,Oe[nt++]=ut,ut=a;var w=Mt;a=Kt;var D=32-et(w)-1;w&=~(1<<D),y+=1;var B=32-et(h)+D;if(30<B){var Q=D-D%5;B=(w&(1<<Q)-1).toString(32),w>>=Q,D-=Q,Mt=1<<32-et(h)+D|y<<D|w,Kt=B+a}else Mt=1<<B|y<<D|w,Kt=a}function ga(a){a.return!==null&&(pn(a,1),Yn(a,1,0))}function Zr(a){for(;a===K;)K=R[--V],R[V]=null,ue=R[--V],R[V]=null;for(;a===ut;)ut=Oe[--nt],Oe[nt]=null,Kt=Oe[--nt],Oe[nt]=null,Mt=Oe[--nt],Oe[nt]=null}function Za(a,h){Oe[nt++]=Mt,Oe[nt++]=Kt,Oe[nt++]=ut,Mt=h.id,Kt=h.overflow,ut=a}var Ti=null,Ri=null,li=!1,Li=null,Hr=!1,is=Error(o(519));function No(a){var h=Error(o(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw wu(x(h,a)),is}function xu(a){var h=a.stateNode,y=a.type,w=a.memoizedProps;switch(h[Lt]=a,h[yn]=w,y){case"dialog":_i("cancel",h),_i("close",h);break;case"iframe":case"object":case"embed":_i("load",h);break;case"video":case"audio":for(y=0;y<Qc.length;y++)_i(Qc[y],h);break;case"source":_i("error",h);break;case"img":case"image":case"link":_i("error",h),_i("load",h);break;case"details":_i("toggle",h);break;case"input":_i("invalid",h),Rl(h,w.value,w.defaultValue,w.checked,w.defaultChecked,w.type,w.name,!0);break;case"select":_i("invalid",h);break;case"textarea":_i("invalid",h),Ua(h,w.value,w.defaultValue,w.children)}y=w.children,typeof y!="string"&&typeof y!="number"&&typeof y!="bigint"||h.textContent===""+y||w.suppressHydrationWarning===!0||r_(h.textContent,y)?(w.popover!=null&&(_i("beforetoggle",h),_i("toggle",h)),w.onScroll!=null&&_i("scroll",h),w.onScrollEnd!=null&&_i("scrollend",h),w.onClick!=null&&(h.onclick=Ma),h=!0):h=!1,h||No(a,!0)}function Or(a){for(Ti=a.return;Ti;)switch(Ti.tag){case 5:case 31:case 13:Hr=!1;return;case 27:case 3:Hr=!0;return;default:Ti=Ti.return}}function rs(a){if(a!==Ti)return!1;if(!li)return Or(a),li=!0,!1;var h=a.tag,y;if((y=h!==3&&h!==27)&&((y=h===5)&&(y=a.type,y=!(y!=="form"&&y!=="button")||s_(a.type,a.memoizedProps)),y=!y),y&&Ri&&No(a),Or(a),h===13){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(o(317));Ri=Em(a)}else if(h===31){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(o(317));Ri=Em(a)}else h===27?(h=Ri,wc(a.type)?(a=Sm,Sm=null,Ri=a):Ri=h):Ri=Ti?Tl(a.stateNode.nextSibling):null;return!0}function ml(){Ri=Ti=null,li=!1}function Bo(){var a=Li;return a!==null&&(Xo===null?Xo=a:Xo.push.apply(Xo,a),Li=null),a}function wu(a){Li===null?Li=[a]:Li.push(a)}var ic=ke(null),Nl=null,gl=null;function Tu(a,h,y){Ot(ic,h._currentValue),h._currentValue=y}function Kl(a){a._currentValue=ic.current,vt(ic)}function Fo(a,h,y){for(;a!==null;){var w=a.alternate;if((a.childLanes&h)!==h?(a.childLanes|=h,w!==null&&(w.childLanes|=h)):w!==null&&(w.childLanes&h)!==h&&(w.childLanes|=h),a===y)break;a=a.return}}function rc(a,h,y,w){var D=a.child;for(D!==null&&(D.return=a);D!==null;){var B=D.dependencies;if(B!==null){var Q=D.child;B=B.firstContext;e:for(;B!==null;){var he=B;B=D;for(var je=0;je<h.length;je++)if(he.context===h[je]){B.lanes|=y,he=B.alternate,he!==null&&(he.lanes|=y),Fo(B.return,y,a),w||(Q=null);break e}B=he.next}}else if(D.tag===18){if(Q=D.return,Q===null)throw Error(o(341));Q.lanes|=y,B=Q.alternate,B!==null&&(B.lanes|=y),Fo(Q,y,a),Q=null}else Q=D.child;if(Q!==null)Q.return=D;else for(Q=D;Q!==null;){if(Q===a){Q=null;break}if(D=Q.sibling,D!==null){D.return=Q.return,Q=D;break}Q=Q.return}D=Q}}function Ra(a,h,y,w){a=null;for(var D=h,B=!1;D!==null;){if(!B){if((D.flags&524288)!==0)B=!0;else if((D.flags&262144)!==0)break}if(D.tag===10){var Q=D.alternate;if(Q===null)throw Error(o(387));if(Q=Q.memoizedProps,Q!==null){var he=D.type;ra(D.pendingProps.value,Q.value)||(a!==null?a.push(he):a=[he])}}else if(D===Fn.current){if(Q=D.alternate,Q===null)throw Error(o(387));Q.memoizedState.memoizedState!==D.memoizedState.memoizedState&&(a!==null?a.push(Qn):a=[Qn])}D=D.return}a!==null&&rc(h,a,y,w),h.flags|=262144}function Su(a){for(a=a.firstContext;a!==null;){if(!ra(a.context._currentValue,a.memoizedValue))return!0;a=a.next}return!1}function Eu(a){Nl=a,gl=null,a=a.dependencies,a!==null&&(a.firstContext=null)}function Ha(a){return Bc(Nl,a)}function td(a,h){return Nl===null&&Eu(a),Bc(a,h)}function Bc(a,h){var y=h._currentValue;if(h={context:h,memoizedValue:y,next:null},gl===null){if(a===null)throw Error(o(308));gl=h,a.dependencies={lanes:0,firstContext:h},a.flags|=524288}else gl=gl.next=h;return y}var Of=typeof AbortController<"u"?AbortController:function(){var a=[],h=this.signal={aborted:!1,addEventListener:function(y,w){a.push(w)}};this.abort=function(){h.aborted=!0,a.forEach(function(y){return y()})}},mh=i.unstable_scheduleCallback,Gp=i.unstable_NormalPriority,Ai={$$typeof:qe,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Vo(){return{controller:new Of,data:new Map,refCount:0}}function Yl(a){a.refCount--,a.refCount===0&&mh(Gp,function(){a.controller.abort()})}var Js=null,ac=0,gh=0,Ql=null;function hg(a,h){if(Js===null){var y=Js=[];ac=0,gh=xc(),Ql={status:"pending",value:void 0,then:function(w){y.push(w)}}}return ac++,h.then(Zp,Zp),h}function Zp(){if(--ac===0&&Js!==null){Ql!==null&&(Ql.status="fulfilled");var a=Js;Js=null,gh=0,Ql=null;for(var h=0;h<a.length;h++)(0,a[h])()}}function nd(a,h){var y=[],w={status:"pending",value:null,reason:null,then:function(D){y.push(D)}};return a.then(function(){w.status="fulfilled",w.value=h;for(var D=0;D<y.length;D++)(0,y[D])(h)},function(D){for(w.status="rejected",w.reason=D,D=0;D<y.length;D++)(0,y[D])(void 0)}),w}var _h=mt.S;mt.S=function(a,h){Td=$r(),typeof h=="object"&&h!==null&&typeof h.then=="function"&&hg(a,h),_h!==null&&_h(a,h)};var as=ke(null);function Yt(){var a=as.current;return a!==null?a:Tr.pooledCache}function yh(a,h){h===null?Ot(as,as.current):Ot(as,h.pool)}function id(){var a=Yt();return a===null?null:{parent:Ai._currentValue,pool:a}}var sc=Error(o(460)),oc=Error(o(474)),Jl=Error(o(542)),Fc={then:function(){}};function ii(a){return a=a.status,a==="fulfilled"||a==="rejected"}function rd(a,h,y){switch(y=a[y],y===void 0?a.push(h):y!==h&&(h.then(Ma,Ma),h=y),h.status){case"fulfilled":return h.value;case"rejected":throw a=h.reason,Nf(a),a;default:if(typeof h.status=="string")h.then(Ma,Ma);else{if(a=Tr,a!==null&&100<a.shellSuspendCounter)throw Error(o(482));a=h,a.status="pending",a.then(function(w){if(h.status==="pending"){var D=h;D.status="fulfilled",D.value=w}},function(w){if(h.status==="pending"){var D=h;D.status="rejected",D.reason=w}})}switch(h.status){case"fulfilled":return h.value;case"rejected":throw a=h.reason,Nf(a),a}throw eu=h,sc}}function Vc(a){try{var h=a._init;return h(a._payload)}catch(y){throw y!==null&&typeof y=="object"&&typeof y.then=="function"?(eu=y,sc):y}}var eu=null;function Hp(){if(eu===null)throw Error(o(459));var a=eu;return eu=null,a}function Nf(a){if(a===sc||a===Jl)throw Error(o(483))}var lc=null,jc=0;function ad(a){var h=jc;return jc+=1,lc===null&&(lc=[]),rd(lc,a,h)}function vh(a,h){h=h.props.ref,a.ref=h!==void 0?h:null}function bh(a,h){throw h.$$typeof===ee?Error(o(525)):(a=Object.prototype.toString.call(h),Error(o(31,a==="[object Object]"?"object with keys {"+Object.keys(h).join(", ")+"}":a)))}function Bf(a){function h(it,Qe){if(a){var pt=it.deletions;pt===null?(it.deletions=[Qe],it.flags|=16):pt.push(Qe)}}function y(it,Qe){if(!a)return null;for(;Qe!==null;)h(it,Qe),Qe=Qe.sibling;return null}function w(it){for(var Qe=new Map;it!==null;)it.key!==null?Qe.set(it.key,it):Qe.set(it.index,it),it=it.sibling;return Qe}function D(it,Qe){return it=Oo(it,Qe),it.index=0,it.sibling=null,it}function B(it,Qe,pt){return it.index=pt,a?(pt=it.alternate,pt!==null?(pt=pt.index,pt<Qe?(it.flags|=67108866,Qe):pt):(it.flags|=67108866,Qe)):(it.flags|=1048576,Qe)}function Q(it){return a&&it.alternate===null&&(it.flags|=67108866),it}function he(it,Qe,pt,Rt){return Qe===null||Qe.tag!==6?(Qe=tc(pt,it.mode,Rt),Qe.return=it,Qe):(Qe=D(Qe,pt),Qe.return=it,Qe)}function je(it,Qe,pt,Rt){var Dn=pt.type;return Dn===be?bt(it,Qe,pt.props.children,Rt,pt.key):Qe!==null&&(Qe.elementType===Dn||typeof Dn=="object"&&Dn!==null&&Dn.$$typeof===ce&&Vc(Dn)===Qe.type)?(Qe=D(Qe,pt.props),vh(Qe,pt),Qe.return=it,Qe):(Qe=ec(pt.type,pt.key,pt.props,null,it.mode,Rt),vh(Qe,pt),Qe.return=it,Qe)}function dt(it,Qe,pt,Rt){return Qe===null||Qe.tag!==4||Qe.stateNode.containerInfo!==pt.containerInfo||Qe.stateNode.implementation!==pt.implementation?(Qe=bu(pt,it.mode,Rt),Qe.return=it,Qe):(Qe=D(Qe,pt.children||[]),Qe.return=it,Qe)}function bt(it,Qe,pt,Rt,Dn){return Qe===null||Qe.tag!==7?(Qe=vu(pt,it.mode,Rt,Dn),Qe.return=it,Qe):(Qe=D(Qe,pt),Qe.return=it,Qe)}function Et(it,Qe,pt){if(typeof Qe=="string"&&Qe!==""||typeof Qe=="number"||typeof Qe=="bigint")return Qe=tc(""+Qe,it.mode,pt),Qe.return=it,Qe;if(typeof Qe=="object"&&Qe!==null){switch(Qe.$$typeof){case Y:return pt=ec(Qe.type,Qe.key,Qe.props,null,it.mode,pt),vh(pt,Qe),pt.return=it,pt;case xe:return Qe=bu(Qe,it.mode,pt),Qe.return=it,Qe;case ce:return Qe=Vc(Qe),Et(it,Qe,pt)}if(Jn(Qe)||Ge(Qe))return Qe=vu(Qe,it.mode,pt,null),Qe.return=it,Qe;if(typeof Qe.then=="function")return Et(it,ad(Qe),pt);if(Qe.$$typeof===qe)return Et(it,td(it,Qe),pt);bh(it,Qe)}return null}function ft(it,Qe,pt,Rt){var Dn=Qe!==null?Qe.key:null;if(typeof pt=="string"&&pt!==""||typeof pt=="number"||typeof pt=="bigint")return Dn!==null?null:he(it,Qe,""+pt,Rt);if(typeof pt=="object"&&pt!==null){switch(pt.$$typeof){case Y:return pt.key===Dn?je(it,Qe,pt,Rt):null;case xe:return pt.key===Dn?dt(it,Qe,pt,Rt):null;case ce:return pt=Vc(pt),ft(it,Qe,pt,Rt)}if(Jn(pt)||Ge(pt))return Dn!==null?null:bt(it,Qe,pt,Rt,null);if(typeof pt.then=="function")return ft(it,Qe,ad(pt),Rt);if(pt.$$typeof===qe)return ft(it,Qe,td(it,pt),Rt);bh(it,pt)}return null}function yt(it,Qe,pt,Rt,Dn){if(typeof Rt=="string"&&Rt!==""||typeof Rt=="number"||typeof Rt=="bigint")return it=it.get(pt)||null,he(Qe,it,""+Rt,Dn);if(typeof Rt=="object"&&Rt!==null){switch(Rt.$$typeof){case Y:return it=it.get(Rt.key===null?pt:Rt.key)||null,je(Qe,it,Rt,Dn);case xe:return it=it.get(Rt.key===null?pt:Rt.key)||null,dt(Qe,it,Rt,Dn);case ce:return Rt=Vc(Rt),yt(it,Qe,pt,Rt,Dn)}if(Jn(Rt)||Ge(Rt))return it=it.get(pt)||null,bt(Qe,it,Rt,Dn,null);if(typeof Rt.then=="function")return yt(it,Qe,pt,ad(Rt),Dn);if(Rt.$$typeof===qe)return yt(it,Qe,pt,td(Qe,Rt),Dn);bh(Qe,Rt)}return null}function cn(it,Qe,pt,Rt){for(var Dn=null,hr=null,Cn=Qe,pi=Qe=0,Di=null;Cn!==null&&pi<pt.length;pi++){Cn.index>pi?(Di=Cn,Cn=null):Di=Cn.sibling;var dr=ft(it,Cn,pt[pi],Rt);if(dr===null){Cn===null&&(Cn=Di);break}a&&Cn&&dr.alternate===null&&h(it,Cn),Qe=B(dr,Qe,pi),hr===null?Dn=dr:hr.sibling=dr,hr=dr,Cn=Di}if(pi===pt.length)return y(it,Cn),li&&pn(it,pi),Dn;if(Cn===null){for(;pi<pt.length;pi++)Cn=Et(it,pt[pi],Rt),Cn!==null&&(Qe=B(Cn,Qe,pi),hr===null?Dn=Cn:hr.sibling=Cn,hr=Cn);return li&&pn(it,pi),Dn}for(Cn=w(Cn);pi<pt.length;pi++)Di=yt(Cn,it,pi,pt[pi],Rt),Di!==null&&(a&&Di.alternate!==null&&Cn.delete(Di.key===null?pi:Di.key),Qe=B(Di,Qe,pi),hr===null?Dn=Di:hr.sibling=Di,hr=Di);return a&&Cn.forEach(function(mf){return h(it,mf)}),li&&pn(it,pi),Dn}function En(it,Qe,pt,Rt){if(pt==null)throw Error(o(151));for(var Dn=null,hr=null,Cn=Qe,pi=Qe=0,Di=null,dr=pt.next();Cn!==null&&!dr.done;pi++,dr=pt.next()){Cn.index>pi?(Di=Cn,Cn=null):Di=Cn.sibling;var mf=ft(it,Cn,dr.value,Rt);if(mf===null){Cn===null&&(Cn=Di);break}a&&Cn&&mf.alternate===null&&h(it,Cn),Qe=B(mf,Qe,pi),hr===null?Dn=mf:hr.sibling=mf,hr=mf,Cn=Di}if(dr.done)return y(it,Cn),li&&pn(it,pi),Dn;if(Cn===null){for(;!dr.done;pi++,dr=pt.next())dr=Et(it,dr.value,Rt),dr!==null&&(Qe=B(dr,Qe,pi),hr===null?Dn=dr:hr.sibling=dr,hr=dr);return li&&pn(it,pi),Dn}for(Cn=w(Cn);!dr.done;pi++,dr=pt.next())dr=yt(Cn,it,pi,dr.value,Rt),dr!==null&&(a&&dr.alternate!==null&&Cn.delete(dr.key===null?pi:dr.key),Qe=B(dr,Qe,pi),hr===null?Dn=dr:hr.sibling=dr,hr=dr);return a&&Cn.forEach(function(aI){return h(it,aI)}),li&&pn(it,pi),Dn}function jr(it,Qe,pt,Rt){if(typeof pt=="object"&&pt!==null&&pt.type===be&&pt.key===null&&(pt=pt.props.children),typeof pt=="object"&&pt!==null){switch(pt.$$typeof){case Y:e:{for(var Dn=pt.key;Qe!==null;){if(Qe.key===Dn){if(Dn=pt.type,Dn===be){if(Qe.tag===7){y(it,Qe.sibling),Rt=D(Qe,pt.props.children),Rt.return=it,it=Rt;break e}}else if(Qe.elementType===Dn||typeof Dn=="object"&&Dn!==null&&Dn.$$typeof===ce&&Vc(Dn)===Qe.type){y(it,Qe.sibling),Rt=D(Qe,pt.props),vh(Rt,pt),Rt.return=it,it=Rt;break e}y(it,Qe);break}else h(it,Qe);Qe=Qe.sibling}pt.type===be?(Rt=vu(pt.props.children,it.mode,Rt,pt.key),Rt.return=it,it=Rt):(Rt=ec(pt.type,pt.key,pt.props,null,it.mode,Rt),vh(Rt,pt),Rt.return=it,it=Rt)}return Q(it);case xe:e:{for(Dn=pt.key;Qe!==null;){if(Qe.key===Dn)if(Qe.tag===4&&Qe.stateNode.containerInfo===pt.containerInfo&&Qe.stateNode.implementation===pt.implementation){y(it,Qe.sibling),Rt=D(Qe,pt.children||[]),Rt.return=it,it=Rt;break e}else{y(it,Qe);break}else h(it,Qe);Qe=Qe.sibling}Rt=bu(pt,it.mode,Rt),Rt.return=it,it=Rt}return Q(it);case ce:return pt=Vc(pt),jr(it,Qe,pt,Rt)}if(Jn(pt))return cn(it,Qe,pt,Rt);if(Ge(pt)){if(Dn=Ge(pt),typeof Dn!="function")throw Error(o(150));return pt=Dn.call(pt),En(it,Qe,pt,Rt)}if(typeof pt.then=="function")return jr(it,Qe,ad(pt),Rt);if(pt.$$typeof===qe)return jr(it,Qe,td(it,pt),Rt);bh(it,pt)}return typeof pt=="string"&&pt!==""||typeof pt=="number"||typeof pt=="bigint"?(pt=""+pt,Qe!==null&&Qe.tag===6?(y(it,Qe.sibling),Rt=D(Qe,pt),Rt.return=it,it=Rt):(y(it,Qe),Rt=tc(pt,it.mode,Rt),Rt.return=it,it=Rt),Q(it)):y(it,Qe)}return function(it,Qe,pt,Rt){try{jc=0;var Dn=jr(it,Qe,pt,Rt);return lc=null,Dn}catch(Cn){if(Cn===sc||Cn===Jl)throw Cn;var hr=ns(29,Cn,null,it.mode);return hr.lanes=Rt,hr.return=it,hr}finally{}}}var uc=Bf(!0),_l=Bf(!1),ki=!1;function cc(a){a.updateQueue={baseState:a.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function sd(a,h){a=a.updateQueue,h.updateQueue===a&&(h.updateQueue={baseState:a.baseState,firstBaseUpdate:a.firstBaseUpdate,lastBaseUpdate:a.lastBaseUpdate,shared:a.shared,callbacks:null})}function Au(a){return{lane:a,tag:0,payload:null,callback:null,next:null}}function tu(a,h,y){var w=a.updateQueue;if(w===null)return null;if(w=w.shared,(Ui&2)!==0){var D=w.pending;return D===null?h.next=h:(h.next=D.next,D.next=h),w.pending=h,h=qn(a),Wl(a,null,y),h}return Qs(a,w,h,y),qn(a)}function Uc(a,h,y){if(h=h.updateQueue,h!==null&&(h=h.shared,(y&4194048)!==0)){var w=h.lanes;w&=a.pendingLanes,y|=w,h.lanes=y,Kn(a,y)}}function Gd(a,h){var y=a.updateQueue,w=a.alternate;if(w!==null&&(w=w.updateQueue,y===w)){var D=null,B=null;if(y=y.firstBaseUpdate,y!==null){do{var Q={lane:y.lane,tag:y.tag,payload:y.payload,callback:null,next:null};B===null?D=B=Q:B=B.next=Q,y=y.next}while(y!==null);B===null?D=B=h:B=B.next=h}else D=B=h;y={baseState:w.baseState,firstBaseUpdate:D,lastBaseUpdate:B,shared:w.shared,callbacks:w.callbacks},a.updateQueue=y;return}a=y.lastBaseUpdate,a===null?y.firstBaseUpdate=h:a.next=h,y.lastBaseUpdate=h}var yl=!1;function hc(){if(yl){var a=Ql;if(a!==null)throw a}}function an(a,h,y,w){yl=!1;var D=a.updateQueue;ki=!1;var B=D.firstBaseUpdate,Q=D.lastBaseUpdate,he=D.shared.pending;if(he!==null){D.shared.pending=null;var je=he,dt=je.next;je.next=null,Q===null?B=dt:Q.next=dt,Q=je;var bt=a.alternate;bt!==null&&(bt=bt.updateQueue,he=bt.lastBaseUpdate,he!==Q&&(he===null?bt.firstBaseUpdate=dt:he.next=dt,bt.lastBaseUpdate=je))}if(B!==null){var Et=D.baseState;Q=0,bt=dt=je=null,he=B;do{var ft=he.lane&-536870913,yt=ft!==he.lane;if(yt?(bi&ft)===ft:(w&ft)===ft){ft!==0&&ft===gh&&(yl=!0),bt!==null&&(bt=bt.next={lane:0,tag:he.tag,payload:he.payload,callback:null,next:null});e:{var cn=a,En=he;ft=h;var jr=y;switch(En.tag){case 1:if(cn=En.payload,typeof cn=="function"){Et=cn.call(jr,Et,ft);break e}Et=cn;break e;case 3:cn.flags=cn.flags&-65537|128;case 0:if(cn=En.payload,ft=typeof cn=="function"?cn.call(jr,Et,ft):cn,ft==null)break e;Et=G({},Et,ft);break e;case 2:ki=!0}}ft=he.callback,ft!==null&&(a.flags|=64,yt&&(a.flags|=8192),yt=D.callbacks,yt===null?D.callbacks=[ft]:yt.push(ft))}else yt={lane:ft,tag:he.tag,payload:he.payload,callback:he.callback,next:null},bt===null?(dt=bt=yt,je=Et):bt=bt.next=yt,Q|=ft;if(he=he.next,he===null){if(he=D.shared.pending,he===null)break;yt=he,he=yt.next,yt.next=null,D.lastBaseUpdate=yt,D.shared.pending=null}}while(!0);bt===null&&(je=Et),D.baseState=je,D.firstBaseUpdate=dt,D.lastBaseUpdate=bt,B===null&&(D.shared.lanes=0),Xc|=Q,a.lanes=Q,a.memoizedState=Et}}function Tn(a,h){if(typeof a!="function")throw Error(o(191,a));a.call(h)}function od(a,h){var y=a.callbacks;if(y!==null)for(a.callbacks=null,a=0;a<y.length;a++)Tn(y[a],h)}var jo=ke(null),$c=ke(0);function As(a,h){a=Hc,Ot($c,a),Ot(jo,h),Hc=a|h.baseLanes}function Zd(){Ot($c,Hc),Ot(jo,jo.current)}function fo(){Hc=$c.current,vt(jo),vt($c)}var Uo=ke(null),Cs=null;function mi(a){var h=a.alternate;Ot(Xr,Xr.current&1),Ot(Uo,a),Cs===null&&(h===null||jo.current!==null||h.memoizedState!==null)&&(Cs=a)}function Nr(a){Ot(Xr,Xr.current),Ot(Uo,a),Cs===null&&(Cs=a)}function ld(a){a.tag===22?(Ot(Xr,Xr.current),Ot(Uo,a),Cs===null&&(Cs=a)):$o()}function $o(){Ot(Xr,Xr.current),Ot(Uo,Uo.current)}function Xa(a){vt(Uo),Cs===a&&(Cs=null),vt(Xr)}var Xr=ke(0);function Cu(a){for(var h=a;h!==null;){if(h.tag===13){var y=h.memoizedState;if(y!==null&&(y=y.dehydrated,y===null||lp(y)||Tm(y)))return h}else if(h.tag===19&&(h.memoizedProps.revealOrder==="forwards"||h.memoizedProps.revealOrder==="backwards"||h.memoizedProps.revealOrder==="unstable_legacy-backwards"||h.memoizedProps.revealOrder==="together")){if((h.flags&128)!==0)return h}else if(h.child!==null){h.child.return=h,h=h.child;continue}if(h===a)break;for(;h.sibling===null;){if(h.return===null||h.return===a)return null;h=h.return}h.sibling.return=h.return,h=h.sibling}return null}var eo=0,Gn=null,Vi=null,wr=null,xh=!1,dc=!1,nu=!1,wh=0,T=0,t=null,u=0;function m(){throw Error(o(321))}function b(a,h){if(h===null)return!1;for(var y=0;y<h.length&&y<a.length;y++)if(!ra(a[y],h[y]))return!1;return!0}function S(a,h,y,w,D,B){return eo=B,Gn=h,h.memoizedState=null,h.updateQueue=null,h.lanes=0,mt.H=a===null||a.memoizedState===null?fg:pg,nu=!1,B=y(w,D),nu=!1,dc&&(B=O(h,y,w,D)),C(a),B}function C(a){mt.H=hd;var h=Vi!==null&&Vi.next!==null;if(eo=0,wr=Vi=Gn=null,xh=!1,T=0,t=null,h)throw Error(o(300));a===null||ka||(a=a.dependencies,a!==null&&Su(a)&&(ka=!0))}function O(a,h,y,w){Gn=a;var D=0;do{if(dc&&(t=null),T=0,dc=!1,25<=D)throw Error(o(301));if(D+=1,wr=Vi=null,a.updateQueue!=null){var B=a.updateQueue;B.lastEffect=null,B.events=null,B.stores=null,B.memoCache!=null&&(B.memoCache.index=0)}mt.H=mg,B=h(y,w)}while(dc);return B}function N(){var a=mt.H,h=a.useState()[0];return h=typeof h.then=="function"?ge(h):h,a=a.useState()[0],(Vi!==null?Vi.memoizedState:null)!==a&&(Gn.flags|=1024),h}function U(){var a=wh!==0;return wh=0,a}function q(a,h,y){h.updateQueue=a.updateQueue,h.flags&=-2053,a.lanes&=~y}function W(a){if(xh){for(a=a.memoizedState;a!==null;){var h=a.queue;h!==null&&(h.pending=null),a=a.next}xh=!1}eo=0,wr=Vi=Gn=null,dc=!1,T=wh=0,t=null}function H(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return wr===null?Gn.memoizedState=wr=a:wr=wr.next=a,wr}function J(){if(Vi===null){var a=Gn.alternate;a=a!==null?a.memoizedState:null}else a=Vi.next;var h=wr===null?Gn.memoizedState:wr.next;if(h!==null)wr=h,Vi=a;else{if(a===null)throw Gn.alternate===null?Error(o(467)):Error(o(310));Vi=a,a={memoizedState:Vi.memoizedState,baseState:Vi.baseState,baseQueue:Vi.baseQueue,queue:Vi.queue,next:null},wr===null?Gn.memoizedState=wr=a:wr=wr.next=a}return wr}function ae(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function ge(a){var h=T;return T+=1,t===null&&(t=[]),a=rd(t,a,h),h=Gn,(wr===null?h.memoizedState:wr.next)===null&&(h=h.alternate,mt.H=h===null||h.memoizedState===null?fg:pg),a}function me(a){if(a!==null&&typeof a=="object"){if(typeof a.then=="function")return ge(a);if(a.$$typeof===qe)return Ha(a)}throw Error(o(438,String(a)))}function ve(a){var h=null,y=Gn.updateQueue;if(y!==null&&(h=y.memoCache),h==null){var w=Gn.alternate;w!==null&&(w=w.updateQueue,w!==null&&(w=w.memoCache,w!=null&&(h={data:w.data.map(function(D){return D.slice()}),index:0})))}if(h==null&&(h={data:[],index:0}),y===null&&(y=ae(),Gn.updateQueue=y),y.memoCache=h,y=h.data[h.index],y===void 0)for(y=h.data[h.index]=Array(a),w=0;w<a;w++)y[w]=Ae;return h.index++,y}function we(a,h){return typeof h=="function"?h(a):h}function Ie(a){var h=J();return Ce(h,Vi,a)}function Ce(a,h,y){var w=a.queue;if(w===null)throw Error(o(311));w.lastRenderedReducer=y;var D=a.baseQueue,B=w.pending;if(B!==null){if(D!==null){var Q=D.next;D.next=B.next,B.next=Q}h.baseQueue=D=B,w.pending=null}if(B=a.baseState,D===null)a.memoizedState=B;else{h=D.next;var he=Q=null,je=null,dt=h,bt=!1;do{var Et=dt.lane&-536870913;if(Et!==dt.lane?(bi&Et)===Et:(eo&Et)===Et){var ft=dt.revertLane;if(ft===0)je!==null&&(je=je.next={lane:0,revertLane:0,gesture:null,action:dt.action,hasEagerState:dt.hasEagerState,eagerState:dt.eagerState,next:null}),Et===gh&&(bt=!0);else if((eo&ft)===ft){dt=dt.next,ft===gh&&(bt=!0);continue}else Et={lane:0,revertLane:dt.revertLane,gesture:null,action:dt.action,hasEagerState:dt.hasEagerState,eagerState:dt.eagerState,next:null},je===null?(he=je=Et,Q=B):je=je.next=Et,Gn.lanes|=ft,Xc|=ft;Et=dt.action,nu&&y(B,Et),B=dt.hasEagerState?dt.eagerState:y(B,Et)}else ft={lane:Et,revertLane:dt.revertLane,gesture:dt.gesture,action:dt.action,hasEagerState:dt.hasEagerState,eagerState:dt.eagerState,next:null},je===null?(he=je=ft,Q=B):je=je.next=ft,Gn.lanes|=Et,Xc|=Et;dt=dt.next}while(dt!==null&&dt!==h);if(je===null?Q=B:je.next=he,!ra(B,a.memoizedState)&&(ka=!0,bt&&(y=Ql,y!==null)))throw y;a.memoizedState=B,a.baseState=Q,a.baseQueue=je,w.lastRenderedState=B}return D===null&&(w.lanes=0),[a.memoizedState,w.dispatch]}function ze(a){var h=J(),y=h.queue;if(y===null)throw Error(o(311));y.lastRenderedReducer=a;var w=y.dispatch,D=y.pending,B=h.memoizedState;if(D!==null){y.pending=null;var Q=D=D.next;do B=a(B,Q.action),Q=Q.next;while(Q!==D);ra(B,h.memoizedState)||(ka=!0),h.memoizedState=B,h.baseQueue===null&&(h.baseState=B),y.lastRenderedState=B}return[B,w]}function Ve(a,h,y){var w=Gn,D=J(),B=li;if(B){if(y===void 0)throw Error(o(407));y=y()}else y=h();var Q=!ra((Vi||D).memoizedState,y);if(Q&&(D.memoizedState=y,ka=!0),D=D.queue,iu(ct.bind(null,w,D,a),[a]),D.getSnapshot!==h||Q||wr!==null&&wr.memoizedState.tag&1){if(w.flags|=2048,Fr(9,{destroy:void 0},Ye.bind(null,w,D,y,h),null),Tr===null)throw Error(o(349));B||(eo&127)!==0||Me(w,h,y)}return y}function Me(a,h,y){a.flags|=16384,a={getSnapshot:h,value:y},h=Gn.updateQueue,h===null?(h=ae(),Gn.updateQueue=h,h.stores=[a]):(y=h.stores,y===null?h.stores=[a]:y.push(a))}function Ye(a,h,y,w){h.value=y,h.getSnapshot=w,rt(h)&&st(a)}function ct(a,h,y){return y(function(){rt(h)&&st(a)})}function rt(a){var h=a.getSnapshot;a=a.value;try{var y=h();return!ra(a,y)}catch{return!0}}function st(a){var h=ko(a,2);h!==null&&_o(h,a,2)}function lt(a){var h=H();if(typeof a=="function"){var y=a;if(a=y(),nu){Ze(!0);try{y()}finally{Ze(!1)}}}return h.memoizedState=h.baseState=a,h.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:we,lastRenderedState:a},h}function Nt(a,h,y,w){return a.baseState=y,Ce(a,Vi,typeof w=="function"?w:we)}function Vt(a,h,y,w,D){if(xl(a))throw Error(o(485));if(a=h.action,a!==null){var B={payload:D,action:a,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(Q){B.listeners.push(Q)}};mt.T!==null?y(!0):B.isTransition=!1,w(B),y=h.pending,y===null?(B.next=h.pending=B,At(h,B)):(B.next=y.next,h.pending=y.next=B)}}function At(a,h){var y=h.action,w=h.payload,D=a.state;if(h.isTransition){var B=mt.T,Q={};mt.T=Q;try{var he=y(D,w),je=mt.S;je!==null&&je(Q,he),ln(a,h,he)}catch(dt){vi(a,h,dt)}finally{B!==null&&Q.types!==null&&(B.types=Q.types),mt.T=B}}else try{B=y(D,w),ln(a,h,B)}catch(dt){vi(a,h,dt)}}function ln(a,h,y){y!==null&&typeof y=="object"&&typeof y.then=="function"?y.then(function(w){Zn(a,h,w)},function(w){return vi(a,h,w)}):Zn(a,h,y)}function Zn(a,h,y){h.status="fulfilled",h.value=y,Wi(h),a.state=y,h=a.pending,h!==null&&(y=h.next,y===h?a.pending=null:(y=y.next,h.next=y,At(a,y)))}function vi(a,h,y){var w=a.pending;if(a.pending=null,w!==null){w=w.next;do h.status="rejected",h.reason=y,Wi(h),h=h.next;while(h!==w)}a.action=null}function Wi(a){a=a.listeners;for(var h=0;h<a.length;h++)(0,a[h])()}function ji(a,h){return h}function Ir(a,h){if(li){var y=Tr.formState;if(y!==null){e:{var w=Gn;if(li){if(Ri){t:{for(var D=Ri,B=Hr;D.nodeType!==8;){if(!B){D=null;break t}if(D=Tl(D.nextSibling),D===null){D=null;break t}}B=D.data,D=B==="F!"||B==="F"?D:null}if(D){Ri=Tl(D.nextSibling),w=D.data==="F!";break e}}No(w)}w=!1}w&&(h=y[0])}}return y=H(),y.memoizedState=y.baseState=h,w={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ji,lastRenderedState:h},y.queue=w,y=cd.bind(null,Gn,w),w.dispatch=y,w=lt(!1),B=su.bind(null,Gn,!1,w.queue),w=H(),D={state:h,dispatch:null,action:a,pending:null},w.queue=D,y=Vt.bind(null,Gn,D,B,y),D.dispatch=y,w.memoizedState=a,[h,y,!1]}function Br(a){var h=J();return Un(h,Vi,a)}function Un(a,h,y){if(h=Ce(a,h,ji)[0],a=Ie(we)[0],typeof h=="object"&&h!==null&&typeof h.then=="function")try{var w=ge(h)}catch(Q){throw Q===sc?Jl:Q}else w=h;h=J();var D=h.queue,B=D.dispatch;return y!==h.memoizedState&&(Gn.flags|=2048,Fr(9,{destroy:void 0},lr.bind(null,D,y),null)),[w,B,a]}function lr(a,h){a.action=h}function sa(a){var h=J(),y=Vi;if(y!==null)return Un(h,y,a);J(),h=h.memoizedState,y=J();var w=y.queue.dispatch;return y.memoizedState=a,[h,w,!1]}function Fr(a,h,y,w){return a={tag:a,create:y,deps:w,inst:h,next:null},h=Gn.updateQueue,h===null&&(h=ae(),Gn.updateQueue=h),y=h.lastEffect,y===null?h.lastEffect=a.next=a:(w=y.next,y.next=a,a.next=w,h.lastEffect=a),a}function La(){return J().memoizedState}function Wa(a,h,y,w){var D=H();Gn.flags|=a,D.memoizedState=Fr(1|h,{destroy:void 0},y,w===void 0?null:w)}function po(a,h,y,w){var D=J();w=w===void 0?null:w;var B=D.memoizedState.inst;Vi!==null&&w!==null&&b(w,Vi.memoizedState.deps)?D.memoizedState=Fr(h,B,y,w):(Gn.flags|=a,D.memoizedState=Fr(1|h,B,y,w))}function Mu(a,h){Wa(8390656,8,a,h)}function iu(a,h){po(2048,8,a,h)}function Th(a){Gn.flags|=4;var h=Gn.updateQueue;if(h===null)h=ae(),Gn.updateQueue=h,h.events=[a];else{var y=h.events;y===null?h.events=[a]:y.push(a)}}function qc(a){var h=J().memoizedState;return Th({ref:h,nextImpl:a}),function(){if((Ui&2)!==0)throw Error(o(440));return h.impl.apply(void 0,arguments)}}function fc(a,h){return po(4,2,a,h)}function pc(a,h){return po(4,4,a,h)}function to(a,h){if(typeof h=="function"){a=a();var y=h(a);return function(){typeof y=="function"?y():h(null)}}if(h!=null)return a=a(),h.current=a,function(){h.current=null}}function vl(a,h,y){y=y!=null?y.concat([a]):null,po(4,4,to.bind(null,h,a),y)}function ss(){}function Iu(a,h){var y=J();h=h===void 0?null:h;var w=y.memoizedState;return h!==null&&b(h,w[1])?w[0]:(y.memoizedState=[a,h],a)}function oa(a,h){var y=J();h=h===void 0?null:h;var w=y.memoizedState;if(h!==null&&b(h,w[1]))return w[0];if(w=a(),nu){Ze(!0);try{a()}finally{Ze(!1)}}return y.memoizedState=[w,h],w}function la(a,h,y){return y===void 0||(eo&1073741824)!==0&&(bi&261930)===0?a.memoizedState=h:(a.memoizedState=y,a=$g(),Gn.lanes|=a,Xc|=a,y)}function qo(a,h,y,w){return ra(y,h)?y:jo.current!==null?(a=la(a,y,w),ra(a,h)||(ka=!0),a):(eo&42)===0||(eo&1073741824)!==0&&(bi&261930)===0?(ka=!0,a.memoizedState=y):(a=$g(),Gn.lanes|=a,Xc|=a,h)}function ua(a,h,y,w,D){var B=$t.p;$t.p=B!==0&&8>B?B:8;var Q=mt.T,he={};mt.T=he,su(a,!1,h,y);try{var je=D(),dt=mt.S;if(dt!==null&&dt(he,je),je!==null&&typeof je=="object"&&typeof je.then=="function"){var bt=nd(je,w);gc(a,h,bt,Fl(a))}else gc(a,h,w,Fl(a))}catch(Et){gc(a,h,{then:function(){},status:"rejected",reason:Et},Fl())}finally{$t.p=B,Q!==null&&he.types!==null&&(Q.types=he.types),mt.T=Q}}function ud(){}function mc(a,h,y,w){if(a.tag!==5)throw Error(o(476));var D=ru(a).queue;ua(a,D,h,Tt,y===null?ud:function(){return bl(a),y(w)})}function ru(a){var h=a.memoizedState;if(h!==null)return h;h={memoizedState:Tt,baseState:Tt,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:we,lastRenderedState:Tt},next:null};var y={};return h.next={memoizedState:y,baseState:y,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:we,lastRenderedState:y},next:null},a.memoizedState=h,a=a.alternate,a!==null&&(a.memoizedState=h),h}function bl(a){var h=ru(a);h.next===null&&(h=a.alternate.memoizedState),gc(a,h.next.queue,{},Fl())}function au(){return Ha(Qn)}function Ff(){return J().memoizedState}function mo(){return J().memoizedState}function Xp(a){for(var h=a.return;h!==null;){switch(h.tag){case 24:case 3:var y=Fl();a=Au(y);var w=tu(h,a,y);w!==null&&(_o(w,h,y),Uc(w,h,y)),h={cache:Vo()},a.payload=h;return}h=h.return}}function Vf(a,h,y){var w=Fl();y={lane:w,revertLane:0,gesture:null,action:y,hasEagerState:!1,eagerState:null,next:null},xl(a)?dg(h,y):(y=pl(a,h,y,w),y!==null&&(_o(y,a,w),by(y,h,w)))}function cd(a,h,y){var w=Fl();gc(a,h,y,w)}function gc(a,h,y,w){var D={lane:w,revertLane:0,gesture:null,action:y,hasEagerState:!1,eagerState:null,next:null};if(xl(a))dg(h,D);else{var B=a.alternate;if(a.lanes===0&&(B===null||B.lanes===0)&&(B=h.lastRenderedReducer,B!==null))try{var Q=h.lastRenderedState,he=B(Q,y);if(D.hasEagerState=!0,D.eagerState=he,ra(he,Q))return Qs(a,h,D,0),Tr===null&&Ju(),!1}catch{}finally{}if(y=pl(a,h,D,w),y!==null)return _o(y,a,w),by(y,h,w),!0}return!1}function su(a,h,y,w){if(w={lane:2,revertLane:xc(),gesture:null,action:w,hasEagerState:!1,eagerState:null,next:null},xl(a)){if(h)throw Error(o(479))}else h=pl(a,y,w,2),h!==null&&_o(h,a,2)}function xl(a){var h=a.alternate;return a===Gn||h!==null&&h===Gn}function dg(a,h){dc=xh=!0;var y=a.pending;y===null?h.next=h:(h.next=y.next,y.next=h),a.pending=h}function by(a,h,y){if((y&4194048)!==0){var w=h.lanes;w&=a.pendingLanes,y|=w,h.lanes=y,Kn(a,y)}}var hd={readContext:Ha,use:me,useCallback:m,useContext:m,useEffect:m,useImperativeHandle:m,useLayoutEffect:m,useInsertionEffect:m,useMemo:m,useReducer:m,useRef:m,useState:m,useDebugValue:m,useDeferredValue:m,useTransition:m,useSyncExternalStore:m,useId:m,useHostTransitionStatus:m,useFormState:m,useActionState:m,useOptimistic:m,useMemoCache:m,useCacheRefresh:m};hd.useEffectEvent=m;var fg={readContext:Ha,use:me,useCallback:function(a,h){return H().memoizedState=[a,h===void 0?null:h],a},useContext:Ha,useEffect:Mu,useImperativeHandle:function(a,h,y){y=y!=null?y.concat([a]):null,Wa(4194308,4,to.bind(null,h,a),y)},useLayoutEffect:function(a,h){return Wa(4194308,4,a,h)},useInsertionEffect:function(a,h){Wa(4,2,a,h)},useMemo:function(a,h){var y=H();h=h===void 0?null:h;var w=a();if(nu){Ze(!0);try{a()}finally{Ze(!1)}}return y.memoizedState=[w,h],w},useReducer:function(a,h,y){var w=H();if(y!==void 0){var D=y(h);if(nu){Ze(!0);try{y(h)}finally{Ze(!1)}}}else D=h;return w.memoizedState=w.baseState=D,a={pending:null,lanes:0,dispatch:null,lastRenderedReducer:a,lastRenderedState:D},w.queue=a,a=a.dispatch=Vf.bind(null,Gn,a),[w.memoizedState,a]},useRef:function(a){var h=H();return a={current:a},h.memoizedState=a},useState:function(a){a=lt(a);var h=a.queue,y=cd.bind(null,Gn,h);return h.dispatch=y,[a.memoizedState,y]},useDebugValue:ss,useDeferredValue:function(a,h){var y=H();return la(y,a,h)},useTransition:function(){var a=lt(!1);return a=ua.bind(null,Gn,a.queue,!0,!1),H().memoizedState=a,[!1,a]},useSyncExternalStore:function(a,h,y){var w=Gn,D=H();if(li){if(y===void 0)throw Error(o(407));y=y()}else{if(y=h(),Tr===null)throw Error(o(349));(bi&127)!==0||Me(w,h,y)}D.memoizedState=y;var B={value:y,getSnapshot:h};return D.queue=B,Mu(ct.bind(null,w,B,a),[a]),w.flags|=2048,Fr(9,{destroy:void 0},Ye.bind(null,w,B,y,h),null),y},useId:function(){var a=H(),h=Tr.identifierPrefix;if(li){var y=Kt,w=Mt;y=(w&~(1<<32-et(w)-1)).toString(32)+y,h="_"+h+"R_"+y,y=wh++,0<y&&(h+="H"+y.toString(32)),h+="_"}else y=u++,h="_"+h+"r_"+y.toString(32)+"_";return a.memoizedState=h},useHostTransitionStatus:au,useFormState:Ir,useActionState:Ir,useOptimistic:function(a){var h=H();h.memoizedState=h.baseState=a;var y={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return h.queue=y,h=su.bind(null,Gn,!0,y),y.dispatch=h,[a,h]},useMemoCache:ve,useCacheRefresh:function(){return H().memoizedState=Xp.bind(null,Gn)},useEffectEvent:function(a){var h=H(),y={impl:a};return h.memoizedState=y,function(){if((Ui&2)!==0)throw Error(o(440));return y.impl.apply(void 0,arguments)}}},pg={readContext:Ha,use:me,useCallback:Iu,useContext:Ha,useEffect:iu,useImperativeHandle:vl,useInsertionEffect:fc,useLayoutEffect:pc,useMemo:oa,useReducer:Ie,useRef:La,useState:function(){return Ie(we)},useDebugValue:ss,useDeferredValue:function(a,h){var y=J();return qo(y,Vi.memoizedState,a,h)},useTransition:function(){var a=Ie(we)[0],h=J().memoizedState;return[typeof a=="boolean"?a:ge(a),h]},useSyncExternalStore:Ve,useId:Ff,useHostTransitionStatus:au,useFormState:Br,useActionState:Br,useOptimistic:function(a,h){var y=J();return Nt(y,Vi,a,h)},useMemoCache:ve,useCacheRefresh:mo};pg.useEffectEvent=qc;var mg={readContext:Ha,use:me,useCallback:Iu,useContext:Ha,useEffect:iu,useImperativeHandle:vl,useInsertionEffect:fc,useLayoutEffect:pc,useMemo:oa,useReducer:ze,useRef:La,useState:function(){return ze(we)},useDebugValue:ss,useDeferredValue:function(a,h){var y=J();return Vi===null?la(y,a,h):qo(y,Vi.memoizedState,a,h)},useTransition:function(){var a=ze(we)[0],h=J().memoizedState;return[typeof a=="boolean"?a:ge(a),h]},useSyncExternalStore:Ve,useId:Ff,useHostTransitionStatus:au,useFormState:sa,useActionState:sa,useOptimistic:function(a,h){var y=J();return Vi!==null?Nt(y,Vi,a,h):(y.baseState=a,[a,y.queue.dispatch])},useMemoCache:ve,useCacheRefresh:mo};mg.useEffectEvent=qc;function gg(a,h,y,w){h=a.memoizedState,y=y(w,h),y=y==null?h:G({},h,y),a.memoizedState=y,a.lanes===0&&(a.updateQueue.baseState=y)}var jf={enqueueSetState:function(a,h,y){a=a._reactInternals;var w=Fl(),D=Au(w);D.payload=h,y!=null&&(D.callback=y),h=tu(a,D,w),h!==null&&(_o(h,a,w),Uc(h,a,w))},enqueueReplaceState:function(a,h,y){a=a._reactInternals;var w=Fl(),D=Au(w);D.tag=1,D.payload=h,y!=null&&(D.callback=y),h=tu(a,D,w),h!==null&&(_o(h,a,w),Uc(h,a,w))},enqueueForceUpdate:function(a,h){a=a._reactInternals;var y=Fl(),w=Au(y);w.tag=2,h!=null&&(w.callback=h),h=tu(a,w,y),h!==null&&(_o(h,a,y),Uc(h,a,y))}};function xy(a,h,y,w,D,B,Q){return a=a.stateNode,typeof a.shouldComponentUpdate=="function"?a.shouldComponentUpdate(w,B,Q):h.prototype&&h.prototype.isPureReactComponent?!Es(y,w)||!Es(D,B):!0}function Wp(a,h,y,w){a=h.state,typeof h.componentWillReceiveProps=="function"&&h.componentWillReceiveProps(y,w),typeof h.UNSAFE_componentWillReceiveProps=="function"&&h.UNSAFE_componentWillReceiveProps(y,w),h.state!==a&&jf.enqueueReplaceState(h,h.state,null)}function Sh(a,h){var y=h;if("ref"in h){y={};for(var w in h)w!=="ref"&&(y[w]=h[w])}if(a=a.defaultProps){y===h&&(y=G({},y));for(var D in a)y[D]===void 0&&(y[D]=a[D])}return y}function _g(a){Xl(a)}function dd(a){console.error(a)}function wy(a){Xl(a)}function Eh(a,h){try{var y=a.onUncaughtError;y(h.value,{componentStack:h.stack})}catch(w){setTimeout(function(){throw w})}}function Uf(a,h,y){try{var w=a.onCaughtError;w(y.value,{componentStack:y.stack,errorBoundary:h.tag===1?h.stateNode:null})}catch(D){setTimeout(function(){throw D})}}function Hd(a,h,y){return y=Au(y),y.tag=3,y.payload={element:null},y.callback=function(){Eh(a,h)},y}function yg(a){return a=Au(a),a.tag=3,a}function vg(a,h,y,w){var D=y.type.getDerivedStateFromError;if(typeof D=="function"){var B=w.value;a.payload=function(){return D(B)},a.callback=function(){Uf(h,y,w)}}var Q=y.stateNode;Q!==null&&typeof Q.componentDidCatch=="function"&&(a.callback=function(){Uf(h,y,w),typeof D!="function"&&(Mh===null?Mh=new Set([this]):Mh.add(this));var he=w.stack;this.componentDidCatch(w.value,{componentStack:he!==null?he:""})})}function ob(a,h,y,w,D){if(y.flags|=32768,w!==null&&typeof w=="object"&&typeof w.then=="function"){if(h=y.alternate,h!==null&&Ra(h,y,D,!0),y=Uo.current,y!==null){switch(y.tag){case 31:case 13:return Cs===null?tp():y.alternate===null&&_a===0&&(_a=3),y.flags&=-257,y.flags|=65536,y.lanes=D,w===Fc?y.flags|=16384:(h=y.updateQueue,h===null?y.updateQueue=new Set([w]):h.add(w),ip(a,w,D)),!1;case 22:return y.flags|=65536,w===Fc?y.flags|=16384:(h=y.updateQueue,h===null?(h={transitions:null,markerInstances:null,retryQueue:new Set([w])},y.updateQueue=h):(y=h.retryQueue,y===null?h.retryQueue=new Set([w]):y.add(w)),ip(a,w,D)),!1}throw Error(o(435,y.tag))}return ip(a,w,D),tp(),!1}if(li)return h=Uo.current,h!==null?((h.flags&65536)===0&&(h.flags|=256),h.flags|=65536,h.lanes=D,w!==is&&(a=Error(o(422),{cause:w}),wu(x(a,y)))):(w!==is&&(h=Error(o(423),{cause:w}),wu(x(h,y))),a=a.current.alternate,a.flags|=65536,D&=-D,a.lanes|=D,w=x(w,y),D=Hd(a.stateNode,w,D),Gd(a,D),_a!==4&&(_a=2)),!1;var B=Error(o(520),{cause:w});if(B=x(B,y),wd===null?wd=[B]:wd.push(B),_a!==4&&(_a=2),h===null)return!0;w=x(w,y),y=h;do{switch(y.tag){case 3:return y.flags|=65536,a=D&-D,y.lanes|=a,a=Hd(y.stateNode,w,a),Gd(y,a),!1;case 1:if(h=y.type,B=y.stateNode,(y.flags&128)===0&&(typeof h.getDerivedStateFromError=="function"||B!==null&&typeof B.componentDidCatch=="function"&&(Mh===null||!Mh.has(B))))return y.flags|=65536,D&=-D,y.lanes|=D,D=yg(D),vg(D,a,y,w),Gd(y,D),!1}y=y.return}while(y!==null);return!1}var bg=Error(o(461)),ka=!1;function Ms(a,h,y,w){h.child=a===null?_l(h,null,y,w):uc(h,a.child,y,w)}function xg(a,h,y,w,D){y=y.render;var B=h.ref;if("ref"in w){var Q={};for(var he in w)he!=="ref"&&(Q[he]=w[he])}else Q=w;return Eu(h),w=S(a,h,y,Q,B,D),he=U(),a!==null&&!ka?(q(a,h,D),Go(a,h,D)):(li&&he&&ga(h),h.flags|=1,Ms(a,h,w,D),h.child)}function Ty(a,h,y,w,D){if(a===null){var B=y.type;return typeof B=="function"&&!zo(B)&&B.defaultProps===void 0&&y.compare===null?(h.tag=15,h.type=B,Kp(a,h,B,w,D)):(a=ec(y.type,null,w,h,h.mode,D),a.ref=h.ref,a.return=h,h.child=a)}if(B=a.child,!pd(a,D)){var Q=B.memoizedProps;if(y=y.compare,y=y!==null?y:Es,y(Q,w)&&a.ref===h.ref)return Go(a,h,D)}return h.flags|=1,a=Oo(B,w),a.ref=h.ref,a.return=h,h.child=a}function Kp(a,h,y,w,D){if(a!==null){var B=a.memoizedProps;if(Es(B,w)&&a.ref===h.ref)if(ka=!1,h.pendingProps=w=B,pd(a,D))(a.flags&131072)!==0&&(ka=!0);else return h.lanes=a.lanes,Go(a,h,D)}return Qp(a,h,y,w,D)}function wg(a,h,y,w){var D=w.children,B=a!==null?a.memoizedState:null;if(a===null&&h.stateNode===null&&(h.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),w.mode==="hidden"){if((h.flags&128)!==0){if(B=B!==null?B.baseLanes|y:y,a!==null){for(w=h.child=a.child,D=0;w!==null;)D=D|w.lanes|w.childLanes,w=w.sibling;w=D&~B}else w=0,h.child=null;return Xd(a,h,B,y,w)}if((y&536870912)!==0)h.memoizedState={baseLanes:0,cachePool:null},a!==null&&yh(h,B!==null?B.cachePool:null),B!==null?As(h,B):Zd(),ld(h);else return w=h.lanes=536870912,Xd(a,h,B!==null?B.baseLanes|y:y,y,w)}else B!==null?(yh(h,B.cachePool),As(h,B),$o(),h.memoizedState=null):(a!==null&&yh(h,null),Zd(),$o());return Ms(a,h,D,y),h.child}function fd(a,h){return a!==null&&a.tag===22||h.stateNode!==null||(h.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),h.sibling}function Xd(a,h,y,w,D){var B=Yt();return B=B===null?null:{parent:Ai._currentValue,pool:B},h.memoizedState={baseLanes:y,cachePool:B},a!==null&&yh(h,null),Zd(),ld(h),a!==null&&Ra(a,h,w,!0),h.childLanes=D,null}function Is(a,h){return h=em({mode:h.mode,children:h.children},a.mode),h.ref=a.ref,a.child=h,h.return=a,h}function Tg(a,h,y){return uc(h,a.child,null,y),a=Is(h,h.pendingProps),a.flags|=2,Xa(h),h.memoizedState=null,a}function Sg(a,h,y){var w=h.pendingProps,D=(h.flags&128)!==0;if(h.flags&=-129,a===null){if(li){if(w.mode==="hidden")return a=Is(h,w),h.lanes=536870912,fd(null,a);if(Nr(h),(a=Ri)?(a=wm(a,Hr),a=a!==null&&a.data==="&"?a:null,a!==null&&(h.memoizedState={dehydrated:a,treeContext:ut!==null?{id:Mt,overflow:Kt}:null,retryLane:536870912,hydrationErrors:null},y=nc(a),y.return=h,h.child=y,Ti=h,Ri=null)):a=null,a===null)throw No(h);return h.lanes=536870912,null}return Is(h,w)}var B=a.memoizedState;if(B!==null){var Q=B.dehydrated;if(Nr(h),D)if(h.flags&256)h.flags&=-257,h=Tg(a,h,y);else if(h.memoizedState!==null)h.child=a.child,h.flags|=128,h=null;else throw Error(o(558));else if(ka||Ra(a,h,y,!1),D=(y&a.childLanes)!==0,ka||D){if(w=Tr,w!==null&&(Q=vr(w,y),Q!==0&&Q!==B.retryLane))throw B.retryLane=Q,ko(a,Q),_o(w,a,Q),bg;tp(),h=Tg(a,h,y)}else a=B.treeContext,Ri=Tl(Q.nextSibling),Ti=h,li=!0,Li=null,Hr=!1,a!==null&&Za(h,a),h=Is(h,w),h.flags|=4096;return h}return a=Oo(a.child,{mode:w.mode,children:w.children}),a.ref=h.ref,h.child=a,a.return=h,a}function Yp(a,h){var y=h.ref;if(y===null)a!==null&&a.ref!==null&&(h.flags|=4194816);else{if(typeof y!="function"&&typeof y!="object")throw Error(o(284));(a===null||a.ref!==y)&&(h.flags|=4194816)}}function Qp(a,h,y,w,D){return Eu(h),y=S(a,h,y,w,void 0,D),w=U(),a!==null&&!ka?(q(a,h,D),Go(a,h,D)):(li&&w&&ga(h),h.flags|=1,Ms(a,h,y,D),h.child)}function Sy(a,h,y,w,D,B){return Eu(h),h.updateQueue=null,y=O(h,w,y,D),C(a),w=U(),a!==null&&!ka?(q(a,h,B),Go(a,h,B)):(li&&w&&ga(h),h.flags|=1,Ms(a,h,y,B),h.child)}function Ey(a,h,y,w,D){if(Eu(h),h.stateNode===null){var B=Do,Q=y.contextType;typeof Q=="object"&&Q!==null&&(B=Ha(Q)),B=new y(w,B),h.memoizedState=B.state!==null&&B.state!==void 0?B.state:null,B.updater=jf,h.stateNode=B,B._reactInternals=h,B=h.stateNode,B.props=w,B.state=h.memoizedState,B.refs={},cc(h),Q=y.contextType,B.context=typeof Q=="object"&&Q!==null?Ha(Q):Do,B.state=h.memoizedState,Q=y.getDerivedStateFromProps,typeof Q=="function"&&(gg(h,y,Q,w),B.state=h.memoizedState),typeof y.getDerivedStateFromProps=="function"||typeof B.getSnapshotBeforeUpdate=="function"||typeof B.UNSAFE_componentWillMount!="function"&&typeof B.componentWillMount!="function"||(Q=B.state,typeof B.componentWillMount=="function"&&B.componentWillMount(),typeof B.UNSAFE_componentWillMount=="function"&&B.UNSAFE_componentWillMount(),Q!==B.state&&jf.enqueueReplaceState(B,B.state,null),an(h,w,B,D),hc(),B.state=h.memoizedState),typeof B.componentDidMount=="function"&&(h.flags|=4194308),w=!0}else if(a===null){B=h.stateNode;var he=h.memoizedProps,je=Sh(y,he);B.props=je;var dt=B.context,bt=y.contextType;Q=Do,typeof bt=="object"&&bt!==null&&(Q=Ha(bt));var Et=y.getDerivedStateFromProps;bt=typeof Et=="function"||typeof B.getSnapshotBeforeUpdate=="function",he=h.pendingProps!==he,bt||typeof B.UNSAFE_componentWillReceiveProps!="function"&&typeof B.componentWillReceiveProps!="function"||(he||dt!==Q)&&Wp(h,B,w,Q),ki=!1;var ft=h.memoizedState;B.state=ft,an(h,w,B,D),hc(),dt=h.memoizedState,he||ft!==dt||ki?(typeof Et=="function"&&(gg(h,y,Et,w),dt=h.memoizedState),(je=ki||xy(h,y,je,w,ft,dt,Q))?(bt||typeof B.UNSAFE_componentWillMount!="function"&&typeof B.componentWillMount!="function"||(typeof B.componentWillMount=="function"&&B.componentWillMount(),typeof B.UNSAFE_componentWillMount=="function"&&B.UNSAFE_componentWillMount()),typeof B.componentDidMount=="function"&&(h.flags|=4194308)):(typeof B.componentDidMount=="function"&&(h.flags|=4194308),h.memoizedProps=w,h.memoizedState=dt),B.props=w,B.state=dt,B.context=Q,w=je):(typeof B.componentDidMount=="function"&&(h.flags|=4194308),w=!1)}else{B=h.stateNode,sd(a,h),Q=h.memoizedProps,bt=Sh(y,Q),B.props=bt,Et=h.pendingProps,ft=B.context,dt=y.contextType,je=Do,typeof dt=="object"&&dt!==null&&(je=Ha(dt)),he=y.getDerivedStateFromProps,(dt=typeof he=="function"||typeof B.getSnapshotBeforeUpdate=="function")||typeof B.UNSAFE_componentWillReceiveProps!="function"&&typeof B.componentWillReceiveProps!="function"||(Q!==Et||ft!==je)&&Wp(h,B,w,je),ki=!1,ft=h.memoizedState,B.state=ft,an(h,w,B,D),hc();var yt=h.memoizedState;Q!==Et||ft!==yt||ki||a!==null&&a.dependencies!==null&&Su(a.dependencies)?(typeof he=="function"&&(gg(h,y,he,w),yt=h.memoizedState),(bt=ki||xy(h,y,bt,w,ft,yt,je)||a!==null&&a.dependencies!==null&&Su(a.dependencies))?(dt||typeof B.UNSAFE_componentWillUpdate!="function"&&typeof B.componentWillUpdate!="function"||(typeof B.componentWillUpdate=="function"&&B.componentWillUpdate(w,yt,je),typeof B.UNSAFE_componentWillUpdate=="function"&&B.UNSAFE_componentWillUpdate(w,yt,je)),typeof B.componentDidUpdate=="function"&&(h.flags|=4),typeof B.getSnapshotBeforeUpdate=="function"&&(h.flags|=1024)):(typeof B.componentDidUpdate!="function"||Q===a.memoizedProps&&ft===a.memoizedState||(h.flags|=4),typeof B.getSnapshotBeforeUpdate!="function"||Q===a.memoizedProps&&ft===a.memoizedState||(h.flags|=1024),h.memoizedProps=w,h.memoizedState=yt),B.props=w,B.state=yt,B.context=je,w=bt):(typeof B.componentDidUpdate!="function"||Q===a.memoizedProps&&ft===a.memoizedState||(h.flags|=4),typeof B.getSnapshotBeforeUpdate!="function"||Q===a.memoizedProps&&ft===a.memoizedState||(h.flags|=1024),w=!1)}return B=w,Yp(a,h),w=(h.flags&128)!==0,B||w?(B=h.stateNode,y=w&&typeof y.getDerivedStateFromError!="function"?null:B.render(),h.flags|=1,a!==null&&w?(h.child=uc(h,a.child,null,D),h.child=uc(h,null,y,D)):Ms(a,h,y,D),h.memoizedState=B.state,a=h.child):a=Go(a,h,D),a}function Eg(a,h,y,w){return ml(),h.flags|=256,Ms(a,h,y,w),h.child}var Ag={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function $f(a){return{baseLanes:a,cachePool:id()}}function Jp(a,h,y){return a=a!==null?a.childLanes&~y:0,h&&(a|=no),a}function Cg(a,h,y){var w=h.pendingProps,D=!1,B=(h.flags&128)!==0,Q;if((Q=B)||(Q=a!==null&&a.memoizedState===null?!1:(Xr.current&2)!==0),Q&&(D=!0,h.flags&=-129),Q=(h.flags&32)!==0,h.flags&=-33,a===null){if(li){if(D?mi(h):$o(),(a=Ri)?(a=wm(a,Hr),a=a!==null&&a.data!=="&"?a:null,a!==null&&(h.memoizedState={dehydrated:a,treeContext:ut!==null?{id:Mt,overflow:Kt}:null,retryLane:536870912,hydrationErrors:null},y=nc(a),y.return=h,h.child=y,Ti=h,Ri=null)):a=null,a===null)throw No(h);return Tm(a)?h.lanes=32:h.lanes=536870912,null}var he=w.children;return w=w.fallback,D?($o(),D=h.mode,he=em({mode:"hidden",children:he},D),w=vu(w,D,y,null),he.return=h,w.return=h,he.sibling=w,h.child=he,w=h.child,w.memoizedState=$f(y),w.childLanes=Jp(a,Q,y),h.memoizedState=Ag,fd(null,w)):(mi(h),Mg(h,he))}var je=a.memoizedState;if(je!==null&&(he=je.dehydrated,he!==null)){if(B)h.flags&256?(mi(h),h.flags&=-257,h=Ig(a,h,y)):h.memoizedState!==null?($o(),h.child=a.child,h.flags|=128,h=null):($o(),he=w.fallback,D=h.mode,w=em({mode:"visible",children:w.children},D),he=vu(he,D,y,null),he.flags|=2,w.return=h,he.return=h,w.sibling=he,h.child=w,uc(h,a.child,null,y),w=h.child,w.memoizedState=$f(y),w.childLanes=Jp(a,Q,y),h.memoizedState=Ag,h=fd(null,w));else if(mi(h),Tm(he)){if(Q=he.nextSibling&&he.nextSibling.dataset,Q)var dt=Q.dgst;Q=dt,w=Error(o(419)),w.stack="",w.digest=Q,wu({value:w,source:null,stack:null}),h=Ig(a,h,y)}else if(ka||Ra(a,h,y,!1),Q=(y&a.childLanes)!==0,ka||Q){if(Q=Tr,Q!==null&&(w=vr(Q,y),w!==0&&w!==je.retryLane))throw je.retryLane=w,ko(a,w),_o(Q,a,w),bg;lp(he)||tp(),h=Ig(a,h,y)}else lp(he)?(h.flags|=192,h.child=a.child,h=null):(a=je.treeContext,Ri=Tl(he.nextSibling),Ti=h,li=!0,Li=null,Hr=!1,a!==null&&Za(h,a),h=Mg(h,w.children),h.flags|=4096);return h}return D?($o(),he=w.fallback,D=h.mode,je=a.child,dt=je.sibling,w=Oo(je,{mode:"hidden",children:w.children}),w.subtreeFlags=je.subtreeFlags&65011712,dt!==null?he=Oo(dt,he):(he=vu(he,D,y,null),he.flags|=2),he.return=h,w.return=h,w.sibling=he,h.child=w,fd(null,w),w=h.child,he=a.child.memoizedState,he===null?he=$f(y):(D=he.cachePool,D!==null?(je=Ai._currentValue,D=D.parent!==je?{parent:je,pool:je}:D):D=id(),he={baseLanes:he.baseLanes|y,cachePool:D}),w.memoizedState=he,w.childLanes=Jp(a,Q,y),h.memoizedState=Ag,fd(a.child,w)):(mi(h),y=a.child,a=y.sibling,y=Oo(y,{mode:"visible",children:w.children}),y.return=h,y.sibling=null,a!==null&&(Q=h.deletions,Q===null?(h.deletions=[a],h.flags|=16):Q.push(a)),h.child=y,h.memoizedState=null,y)}function Mg(a,h){return h=em({mode:"visible",children:h},a.mode),h.return=a,a.child=h}function em(a,h){return a=ns(22,a,null,h),a.lanes=0,a}function Ig(a,h,y){return uc(h,a.child,null,y),a=Mg(h,h.pendingProps.children),a.flags|=2,h.memoizedState=null,a}function tm(a,h,y){a.lanes|=h;var w=a.alternate;w!==null&&(w.lanes|=h),Fo(a.return,h,y)}function qf(a,h,y,w,D,B){var Q=a.memoizedState;Q===null?a.memoizedState={isBackwards:h,rendering:null,renderingStartTime:0,last:w,tail:y,tailMode:D,treeForkCount:B}:(Q.isBackwards=h,Q.rendering=null,Q.renderingStartTime=0,Q.last=w,Q.tail=y,Q.tailMode=D,Q.treeForkCount=B)}function Pg(a,h,y){var w=h.pendingProps,D=w.revealOrder,B=w.tail;w=w.children;var Q=Xr.current,he=(Q&2)!==0;if(he?(Q=Q&1|2,h.flags|=128):Q&=1,Ot(Xr,Q),Ms(a,h,w,y),w=li?ue:0,!he&&a!==null&&(a.flags&128)!==0)e:for(a=h.child;a!==null;){if(a.tag===13)a.memoizedState!==null&&tm(a,y,h);else if(a.tag===19)tm(a,y,h);else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===h)break e;for(;a.sibling===null;){if(a.return===null||a.return===h)break e;a=a.return}a.sibling.return=a.return,a=a.sibling}switch(D){case"forwards":for(y=h.child,D=null;y!==null;)a=y.alternate,a!==null&&Cu(a)===null&&(D=y),y=y.sibling;y=D,y===null?(D=h.child,h.child=null):(D=y.sibling,y.sibling=null),qf(h,!1,D,y,B,w);break;case"backwards":case"unstable_legacy-backwards":for(y=null,D=h.child,h.child=null;D!==null;){if(a=D.alternate,a!==null&&Cu(a)===null){h.child=D;break}a=D.sibling,D.sibling=y,y=D,D=a}qf(h,!0,y,null,B,w);break;case"together":qf(h,!1,null,null,void 0,w);break;default:h.memoizedState=null}return h.child}function Go(a,h,y){if(a!==null&&(h.dependencies=a.dependencies),Xc|=h.lanes,(y&h.childLanes)===0)if(a!==null){if(Ra(a,h,y,!1),(y&h.childLanes)===0)return null}else return null;if(a!==null&&h.child!==a.child)throw Error(o(153));if(h.child!==null){for(a=h.child,y=Oo(a,a.pendingProps),h.child=y,y.return=h;a.sibling!==null;)a=a.sibling,y=y.sibling=Oo(a,a.pendingProps),y.return=h;y.sibling=null}return h.child}function pd(a,h){return(a.lanes&h)!==0?!0:(a=a.dependencies,!!(a!==null&&Su(a)))}function lb(a,h,y){switch(h.tag){case 3:si(h,h.stateNode.containerInfo),Tu(h,Ai,a.memoizedState.cache),ml();break;case 27:case 5:ds(h);break;case 4:si(h,h.stateNode.containerInfo);break;case 10:Tu(h,h.type,h.memoizedProps.value);break;case 31:if(h.memoizedState!==null)return h.flags|=128,Nr(h),null;break;case 13:var w=h.memoizedState;if(w!==null)return w.dehydrated!==null?(mi(h),h.flags|=128,null):(y&h.child.childLanes)!==0?Cg(a,h,y):(mi(h),a=Go(a,h,y),a!==null?a.sibling:null);mi(h);break;case 19:var D=(a.flags&128)!==0;if(w=(y&h.childLanes)!==0,w||(Ra(a,h,y,!1),w=(y&h.childLanes)!==0),D){if(w)return Pg(a,h,y);h.flags|=128}if(D=h.memoizedState,D!==null&&(D.rendering=null,D.tail=null,D.lastEffect=null),Ot(Xr,Xr.current),w)break;return null;case 22:return h.lanes=0,wg(a,h,y,h.pendingProps);case 24:Tu(h,Ai,a.memoizedState.cache)}return Go(a,h,y)}function Ay(a,h,y){if(a!==null)if(a.memoizedProps!==h.pendingProps)ka=!0;else{if(!pd(a,y)&&(h.flags&128)===0)return ka=!1,lb(a,h,y);ka=(a.flags&131072)!==0}else ka=!1,li&&(h.flags&1048576)!==0&&Yn(h,ue,h.index);switch(h.lanes=0,h.tag){case 16:e:{var w=h.pendingProps;if(a=Vc(h.elementType),h.type=a,typeof a=="function")zo(a)?(w=Sh(a,w),h.tag=1,h=Ey(null,h,a,w,y)):(h.tag=0,h=Qp(null,h,a,w,y));else{if(a!=null){var D=a.$$typeof;if(D===He){h.tag=11,h=xg(null,h,a,w,y);break e}else if(D===de){h.tag=14,h=Ty(null,h,a,w,y);break e}}throw h=In(a)||a,Error(o(306,h,""))}}return h;case 0:return Qp(a,h,h.type,h.pendingProps,y);case 1:return w=h.type,D=Sh(w,h.pendingProps),Ey(a,h,w,D,y);case 3:e:{if(si(h,h.stateNode.containerInfo),a===null)throw Error(o(387));w=h.pendingProps;var B=h.memoizedState;D=B.element,sd(a,h),an(h,w,null,y);var Q=h.memoizedState;if(w=Q.cache,Tu(h,Ai,w),w!==B.cache&&rc(h,[Ai],y,!0),hc(),w=Q.element,B.isDehydrated)if(B={element:w,isDehydrated:!1,cache:Q.cache},h.updateQueue.baseState=B,h.memoizedState=B,h.flags&256){h=Eg(a,h,w,y);break e}else if(w!==D){D=x(Error(o(424)),h),wu(D),h=Eg(a,h,w,y);break e}else{switch(a=h.stateNode.containerInfo,a.nodeType){case 9:a=a.body;break;default:a=a.nodeName==="HTML"?a.ownerDocument.body:a}for(Ri=Tl(a.firstChild),Ti=h,li=!0,Li=null,Hr=!0,y=_l(h,null,w,y),h.child=y;y;)y.flags=y.flags&-3|4096,y=y.sibling}else{if(ml(),w===D){h=Go(a,h,y);break e}Ms(a,h,w,y)}h=h.child}return h;case 26:return Yp(a,h),a===null?(y=te(h.type,null,h.pendingProps,null))?h.memoizedState=y:li||(y=h.type,a=h.pendingProps,w=Cd(Xt.current).createElement(y),w[Lt]=h,w[yn]=a,io(w,y,a),Mr(w),h.stateNode=w):h.memoizedState=te(h.type,a.memoizedProps,h.pendingProps,a.memoizedState),null;case 27:return ds(h),a===null&&li&&(w=h.stateNode=hf(h.type,h.pendingProps,Xt.current),Ti=h,Hr=!0,D=Ri,wc(h.type)?(Sm=D,Ri=Tl(w.firstChild)):Ri=D),Ms(a,h,h.pendingProps.children,y),Yp(a,h),a===null&&(h.flags|=4194304),h.child;case 5:return a===null&&li&&((D=w=Ri)&&(w=yb(w,h.type,h.pendingProps,Hr),w!==null?(h.stateNode=w,Ti=h,Ri=Tl(w.firstChild),Hr=!1,D=!0):D=!1),D||No(h)),ds(h),D=h.type,B=h.pendingProps,Q=a!==null?a.memoizedProps:null,w=B.children,s_(D,B)?w=null:Q!==null&&s_(D,Q)&&(h.flags|=32),h.memoizedState!==null&&(D=S(a,h,N,null,null,y),Qn._currentValue=D),Yp(a,h),Ms(a,h,w,y),h.child;case 6:return a===null&&li&&((a=y=Ri)&&(y=sv(y,h.pendingProps,Hr),y!==null?(h.stateNode=y,Ti=h,Ri=null,a=!0):a=!1),a||No(h)),null;case 13:return Cg(a,h,y);case 4:return si(h,h.stateNode.containerInfo),w=h.pendingProps,a===null?h.child=uc(h,null,w,y):Ms(a,h,w,y),h.child;case 11:return xg(a,h,h.type,h.pendingProps,y);case 7:return Ms(a,h,h.pendingProps,y),h.child;case 8:return Ms(a,h,h.pendingProps.children,y),h.child;case 12:return Ms(a,h,h.pendingProps.children,y),h.child;case 10:return w=h.pendingProps,Tu(h,h.type,w.value),Ms(a,h,w.children,y),h.child;case 9:return D=h.type._context,w=h.pendingProps.children,Eu(h),D=Ha(D),w=w(D),h.flags|=1,Ms(a,h,w,y),h.child;case 14:return Ty(a,h,h.type,h.pendingProps,y);case 15:return Kp(a,h,h.type,h.pendingProps,y);case 19:return Pg(a,h,y);case 31:return Sg(a,h,y);case 22:return wg(a,h,y,h.pendingProps);case 24:return Eu(h),w=Ha(Ai),a===null?(D=Yt(),D===null&&(D=Tr,B=Vo(),D.pooledCache=B,B.refCount++,B!==null&&(D.pooledCacheLanes|=y),D=B),h.memoizedState={parent:w,cache:D},cc(h),Tu(h,Ai,D)):((a.lanes&y)!==0&&(sd(a,h),an(h,null,null,y),hc()),D=a.memoizedState,B=h.memoizedState,D.parent!==w?(D={parent:w,cache:w},h.memoizedState=D,h.lanes===0&&(h.memoizedState=h.updateQueue.baseState=D),Tu(h,Ai,w)):(w=B.cache,Tu(h,Ai,w),w!==D.cache&&rc(h,[Ai],y,!0))),Ms(a,h,h.pendingProps.children,y),h.child;case 29:throw h.pendingProps}throw Error(o(156,h.tag))}function Gc(a){a.flags|=4}function Rg(a,h,y,w,D){if((h=(a.mode&32)!==0)&&(h=!1),h){if(a.flags|=16777216,(D&335544128)===D)if(a.stateNode.complete)a.flags|=8192;else if(Gg())a.flags|=8192;else throw eu=Fc,oc}else a.flags&=-16777217}function Cy(a,h){if(h.type!=="stylesheet"||(h.state.loading&4)!==0)a.flags&=-16777217;else if(a.flags|=16777216,!dn(h))if(Gg())a.flags|=8192;else throw eu=Fc,oc}function nm(a,h){h!==null&&(a.flags|=4),a.flags&16384&&(h=a.tag!==22?Pi():536870912,a.lanes|=h,Wr|=h)}function Gf(a,h){if(!li)switch(a.tailMode){case"hidden":h=a.tail;for(var y=null;h!==null;)h.alternate!==null&&(y=h),h=h.sibling;y===null?a.tail=null:y.sibling=null;break;case"collapsed":y=a.tail;for(var w=null;y!==null;)y.alternate!==null&&(w=y),y=y.sibling;w===null?h||a.tail===null?a.tail=null:a.tail.sibling=null:w.sibling=null}}function Pr(a){var h=a.alternate!==null&&a.alternate.child===a.child,y=0,w=0;if(h)for(var D=a.child;D!==null;)y|=D.lanes|D.childLanes,w|=D.subtreeFlags&65011712,w|=D.flags&65011712,D.return=a,D=D.sibling;else for(D=a.child;D!==null;)y|=D.lanes|D.childLanes,w|=D.subtreeFlags,w|=D.flags,D.return=a,D=D.sibling;return a.subtreeFlags|=w,a.childLanes=y,h}function ub(a,h,y){var w=h.pendingProps;switch(Zr(h),h.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Pr(h),null;case 1:return Pr(h),null;case 3:return y=h.stateNode,w=null,a!==null&&(w=a.memoizedState.cache),h.memoizedState.cache!==w&&(h.flags|=2048),Kl(Ai),di(),y.pendingContext&&(y.context=y.pendingContext,y.pendingContext=null),(a===null||a.child===null)&&(rs(h)?Gc(h):a===null||a.memoizedState.isDehydrated&&(h.flags&256)===0||(h.flags|=1024,Bo())),Pr(h),null;case 26:var D=h.type,B=h.memoizedState;return a===null?(Gc(h),B!==null?(Pr(h),Cy(h,B)):(Pr(h),Rg(h,D,null,w,y))):B?B!==a.memoizedState?(Gc(h),Pr(h),Cy(h,B)):(Pr(h),h.flags&=-16777217):(a=a.memoizedProps,a!==w&&Gc(h),Pr(h),Rg(h,D,a,w,y)),null;case 27:if(Ns(h),y=Xt.current,D=h.type,a!==null&&h.stateNode!=null)a.memoizedProps!==w&&Gc(h);else{if(!w){if(h.stateNode===null)throw Error(o(166));return Pr(h),null}a=jt.current,rs(h)?xu(h):(a=hf(D,w,y),h.stateNode=a,Gc(h))}return Pr(h),null;case 5:if(Ns(h),D=h.type,a!==null&&h.stateNode!=null)a.memoizedProps!==w&&Gc(h);else{if(!w){if(h.stateNode===null)throw Error(o(166));return Pr(h),null}if(B=jt.current,rs(h))xu(h);else{var Q=Cd(Xt.current);switch(B){case 1:B=Q.createElementNS("http://www.w3.org/2000/svg",D);break;case 2:B=Q.createElementNS("http://www.w3.org/1998/Math/MathML",D);break;default:switch(D){case"svg":B=Q.createElementNS("http://www.w3.org/2000/svg",D);break;case"math":B=Q.createElementNS("http://www.w3.org/1998/Math/MathML",D);break;case"script":B=Q.createElement("div"),B.innerHTML="<script><\/script>",B=B.removeChild(B.firstChild);break;case"select":B=typeof w.is=="string"?Q.createElement("select",{is:w.is}):Q.createElement("select"),w.multiple?B.multiple=!0:w.size&&(B.size=w.size);break;default:B=typeof w.is=="string"?Q.createElement(D,{is:w.is}):Q.createElement(D)}}B[Lt]=h,B[yn]=w;e:for(Q=h.child;Q!==null;){if(Q.tag===5||Q.tag===6)B.appendChild(Q.stateNode);else if(Q.tag!==4&&Q.tag!==27&&Q.child!==null){Q.child.return=Q,Q=Q.child;continue}if(Q===h)break e;for(;Q.sibling===null;){if(Q.return===null||Q.return===h)break e;Q=Q.return}Q.sibling.return=Q.return,Q=Q.sibling}h.stateNode=B;e:switch(io(B,D,w),D){case"button":case"input":case"select":case"textarea":w=!!w.autoFocus;break e;case"img":w=!0;break e;default:w=!1}w&&Gc(h)}}return Pr(h),Rg(h,h.type,a===null?null:a.memoizedProps,h.pendingProps,y),null;case 6:if(a&&h.stateNode!=null)a.memoizedProps!==w&&Gc(h);else{if(typeof w!="string"&&h.stateNode===null)throw Error(o(166));if(a=Xt.current,rs(h)){if(a=h.stateNode,y=h.memoizedProps,w=null,D=Ti,D!==null)switch(D.tag){case 27:case 5:w=D.memoizedProps}a[Lt]=h,a=!!(a.nodeValue===y||w!==null&&w.suppressHydrationWarning===!0||r_(a.nodeValue,y)),a||No(h,!0)}else a=Cd(a).createTextNode(w),a[Lt]=h,h.stateNode=a}return Pr(h),null;case 31:if(y=h.memoizedState,a===null||a.memoizedState!==null){if(w=rs(h),y!==null){if(a===null){if(!w)throw Error(o(318));if(a=h.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(o(557));a[Lt]=h}else ml(),(h.flags&128)===0&&(h.memoizedState=null),h.flags|=4;Pr(h),a=!1}else y=Bo(),a!==null&&a.memoizedState!==null&&(a.memoizedState.hydrationErrors=y),a=!0;if(!a)return h.flags&256?(Xa(h),h):(Xa(h),null);if((h.flags&128)!==0)throw Error(o(558))}return Pr(h),null;case 13:if(w=h.memoizedState,a===null||a.memoizedState!==null&&a.memoizedState.dehydrated!==null){if(D=rs(h),w!==null&&w.dehydrated!==null){if(a===null){if(!D)throw Error(o(318));if(D=h.memoizedState,D=D!==null?D.dehydrated:null,!D)throw Error(o(317));D[Lt]=h}else ml(),(h.flags&128)===0&&(h.memoizedState=null),h.flags|=4;Pr(h),D=!1}else D=Bo(),a!==null&&a.memoizedState!==null&&(a.memoizedState.hydrationErrors=D),D=!0;if(!D)return h.flags&256?(Xa(h),h):(Xa(h),null)}return Xa(h),(h.flags&128)!==0?(h.lanes=y,h):(y=w!==null,a=a!==null&&a.memoizedState!==null,y&&(w=h.child,D=null,w.alternate!==null&&w.alternate.memoizedState!==null&&w.alternate.memoizedState.cachePool!==null&&(D=w.alternate.memoizedState.cachePool.pool),B=null,w.memoizedState!==null&&w.memoizedState.cachePool!==null&&(B=w.memoizedState.cachePool.pool),B!==D&&(w.flags|=2048)),y!==a&&y&&(h.child.flags|=8192),nm(h,h.updateQueue),Pr(h),null);case 4:return di(),a===null&&Ad(h.stateNode.containerInfo),Pr(h),null;case 10:return Kl(h.type),Pr(h),null;case 19:if(vt(Xr),w=h.memoizedState,w===null)return Pr(h),null;if(D=(h.flags&128)!==0,B=w.rendering,B===null)if(D)Gf(w,!1);else{if(_a!==0||a!==null&&(a.flags&128)!==0)for(a=h.child;a!==null;){if(B=Cu(a),B!==null){for(h.flags|=128,Gf(w,!1),a=B.updateQueue,h.updateQueue=a,nm(h,a),h.subtreeFlags=0,a=y,y=h.child;y!==null;)ed(y,a),y=y.sibling;return Ot(Xr,Xr.current&1|2),li&&pn(h,w.treeForkCount),h.child}a=a.sibling}w.tail!==null&&$r()>Qf&&(h.flags|=128,D=!0,Gf(w,!1),h.lanes=4194304)}else{if(!D)if(a=Cu(B),a!==null){if(h.flags|=128,D=!0,a=a.updateQueue,h.updateQueue=a,nm(h,a),Gf(w,!0),w.tail===null&&w.tailMode==="hidden"&&!B.alternate&&!li)return Pr(h),null}else 2*$r()-w.renderingStartTime>Qf&&y!==536870912&&(h.flags|=128,D=!0,Gf(w,!1),h.lanes=4194304);w.isBackwards?(B.sibling=h.child,h.child=B):(a=w.last,a!==null?a.sibling=B:h.child=B,w.last=B)}return w.tail!==null?(a=w.tail,w.rendering=a,w.tail=a.sibling,w.renderingStartTime=$r(),a.sibling=null,y=Xr.current,Ot(Xr,D?y&1|2:y&1),li&&pn(h,w.treeForkCount),a):(Pr(h),null);case 22:case 23:return Xa(h),fo(),w=h.memoizedState!==null,a!==null?a.memoizedState!==null!==w&&(h.flags|=8192):w&&(h.flags|=8192),w?(y&536870912)!==0&&(h.flags&128)===0&&(Pr(h),h.subtreeFlags&6&&(h.flags|=8192)):Pr(h),y=h.updateQueue,y!==null&&nm(h,y.retryQueue),y=null,a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(y=a.memoizedState.cachePool.pool),w=null,h.memoizedState!==null&&h.memoizedState.cachePool!==null&&(w=h.memoizedState.cachePool.pool),w!==y&&(h.flags|=2048),a!==null&&vt(as),null;case 24:return y=null,a!==null&&(y=a.memoizedState.cache),h.memoizedState.cache!==y&&(h.flags|=2048),Kl(Ai),Pr(h),null;case 25:return null;case 30:return null}throw Error(o(156,h.tag))}function My(a,h){switch(Zr(h),h.tag){case 1:return a=h.flags,a&65536?(h.flags=a&-65537|128,h):null;case 3:return Kl(Ai),di(),a=h.flags,(a&65536)!==0&&(a&128)===0?(h.flags=a&-65537|128,h):null;case 26:case 27:case 5:return Ns(h),null;case 31:if(h.memoizedState!==null){if(Xa(h),h.alternate===null)throw Error(o(340));ml()}return a=h.flags,a&65536?(h.flags=a&-65537|128,h):null;case 13:if(Xa(h),a=h.memoizedState,a!==null&&a.dehydrated!==null){if(h.alternate===null)throw Error(o(340));ml()}return a=h.flags,a&65536?(h.flags=a&-65537|128,h):null;case 19:return vt(Xr),null;case 4:return di(),null;case 10:return Kl(h.type),null;case 22:case 23:return Xa(h),fo(),a!==null&&vt(as),a=h.flags,a&65536?(h.flags=a&-65537|128,h):null;case 24:return Kl(Ai),null;case 25:return null;default:return null}}function Wd(a,h){switch(Zr(h),h.tag){case 3:Kl(Ai),di();break;case 26:case 27:case 5:Ns(h);break;case 4:di();break;case 31:h.memoizedState!==null&&Xa(h);break;case 13:Xa(h);break;case 19:vt(Xr);break;case 10:Kl(h.type);break;case 22:case 23:Xa(h),fo(),a!==null&&vt(as);break;case 24:Kl(Ai)}}function Zf(a,h){try{var y=h.updateQueue,w=y!==null?y.lastEffect:null;if(w!==null){var D=w.next;y=D;do{if((y.tag&a)===a){w=void 0;var B=y.create,Q=y.inst;w=B(),Q.destroy=w}y=y.next}while(y!==D)}}catch(he){Ki(h,h.return,he)}}function cr(a,h,y){try{var w=h.updateQueue,D=w!==null?w.lastEffect:null;if(D!==null){var B=D.next;w=B;do{if((w.tag&a)===a){var Q=w.inst,he=Q.destroy;if(he!==void 0){Q.destroy=void 0,D=h;var je=y,dt=he;try{dt()}catch(bt){Ki(D,je,bt)}}}w=w.next}while(w!==B)}}catch(bt){Ki(h,h.return,bt)}}function md(a){var h=a.updateQueue;if(h!==null){var y=a.stateNode;try{od(h,y)}catch(w){Ki(a,a.return,w)}}}function Lg(a,h,y){y.props=Sh(a.type,a.memoizedProps),y.state=a.memoizedState;try{y.componentWillUnmount()}catch(w){Ki(a,h,w)}}function Ah(a,h){try{var y=a.ref;if(y!==null){switch(a.tag){case 26:case 27:case 5:var w=a.stateNode;break;case 30:w=a.stateNode;break;default:w=a.stateNode}typeof y=="function"?a.refCleanup=y(w):y.current=w}}catch(D){Ki(a,h,D)}}function Bl(a,h){var y=a.ref,w=a.refCleanup;if(y!==null)if(typeof w=="function")try{w()}catch(D){Ki(a,h,D)}finally{a.refCleanup=null,a=a.alternate,a!=null&&(a.refCleanup=null)}else if(typeof y=="function")try{y(null)}catch(D){Ki(a,h,D)}else y.current=null}function Kd(a){var h=a.type,y=a.memoizedProps,w=a.stateNode;try{e:switch(h){case"button":case"input":case"select":case"textarea":y.autoFocus&&w.focus();break e;case"img":y.src?w.src=y.src:y.srcSet&&(w.srcset=y.srcSet)}}catch(D){Ki(a,a.return,D)}}function im(a,h,y){try{var w=a.stateNode;gb(w,a.type,y,h),w[yn]=h}catch(D){Ki(a,a.return,D)}}function kg(a){return a.tag===5||a.tag===3||a.tag===26||a.tag===27&&wc(a.type)||a.tag===4}function gd(a){e:for(;;){for(;a.sibling===null;){if(a.return===null||kg(a.return))return null;a=a.return}for(a.sibling.return=a.return,a=a.sibling;a.tag!==5&&a.tag!==6&&a.tag!==18;){if(a.tag===27&&wc(a.type)||a.flags&2||a.child===null||a.tag===4)continue e;a.child.return=a,a=a.child}if(!(a.flags&2))return a.stateNode}}function Hf(a,h,y){var w=a.tag;if(w===5||w===6)a=a.stateNode,h?(y.nodeType===9?y.body:y.nodeName==="HTML"?y.ownerDocument.body:y).insertBefore(a,h):(h=y.nodeType===9?y.body:y.nodeName==="HTML"?y.ownerDocument.body:y,h.appendChild(a),y=y._reactRootContainer,y!=null||h.onclick!==null||(h.onclick=Ma));else if(w!==4&&(w===27&&wc(a.type)&&(y=a.stateNode,h=null),a=a.child,a!==null))for(Hf(a,h,y),a=a.sibling;a!==null;)Hf(a,h,y),a=a.sibling}function Zc(a,h,y){var w=a.tag;if(w===5||w===6)a=a.stateNode,h?y.insertBefore(a,h):y.appendChild(a);else if(w!==4&&(w===27&&wc(a.type)&&(y=a.stateNode),a=a.child,a!==null))for(Zc(a,h,y),a=a.sibling;a!==null;)Zc(a,h,y),a=a.sibling}function Xf(a){var h=a.stateNode,y=a.memoizedProps;try{for(var w=a.type,D=h.attributes;D.length;)h.removeAttributeNode(D[0]);io(h,w,y),h[Lt]=a,h[yn]=y}catch(B){Ki(a,a.return,B)}}var wl=!1,Qr=!1,Dg=!1,zg=typeof WeakSet=="function"?WeakSet:Set,Jr=null;function cb(a,h){if(a=a.containerInfo,cf=va,a=Ku(a),cl(a)){if("selectionStart"in a)var y={start:a.selectionStart,end:a.selectionEnd};else e:{y=(y=a.ownerDocument)&&y.defaultView||window;var w=y.getSelection&&y.getSelection();if(w&&w.rangeCount!==0){y=w.anchorNode;var D=w.anchorOffset,B=w.focusNode;w=w.focusOffset;try{y.nodeType,B.nodeType}catch{y=null;break e}var Q=0,he=-1,je=-1,dt=0,bt=0,Et=a,ft=null;t:for(;;){for(var yt;Et!==y||D!==0&&Et.nodeType!==3||(he=Q+D),Et!==B||w!==0&&Et.nodeType!==3||(je=Q+w),Et.nodeType===3&&(Q+=Et.nodeValue.length),(yt=Et.firstChild)!==null;)ft=Et,Et=yt;for(;;){if(Et===a)break t;if(ft===y&&++dt===D&&(he=Q),ft===B&&++bt===w&&(je=Q),(yt=Et.nextSibling)!==null)break;Et=ft,ft=Et.parentNode}Et=yt}y=he===-1||je===-1?null:{start:he,end:je}}else y=null}y=y||{start:0,end:0}}else y=null;for(vm={focusedElem:a,selectionRange:y},va=!1,Jr=h;Jr!==null;)if(h=Jr,a=h.child,(h.subtreeFlags&1028)!==0&&a!==null)a.return=h,Jr=a;else for(;Jr!==null;){switch(h=Jr,B=h.alternate,a=h.flags,h.tag){case 0:if((a&4)!==0&&(a=h.updateQueue,a=a!==null?a.events:null,a!==null))for(y=0;y<a.length;y++)D=a[y],D.ref.impl=D.nextImpl;break;case 11:case 15:break;case 1:if((a&1024)!==0&&B!==null){a=void 0,y=h,D=B.memoizedProps,B=B.memoizedState,w=y.stateNode;try{var cn=Sh(y.type,D);a=w.getSnapshotBeforeUpdate(cn,B),w.__reactInternalSnapshotBeforeUpdate=a}catch(En){Ki(y,y.return,En)}}break;case 3:if((a&1024)!==0){if(a=h.stateNode.containerInfo,y=a.nodeType,y===9)xm(a);else if(y===1)switch(a.nodeName){case"HEAD":case"HTML":case"BODY":xm(a);break;default:a.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((a&1024)!==0)throw Error(o(163))}if(a=h.sibling,a!==null){a.return=h.return,Jr=a;break}Jr=h.return}}function Og(a,h,y){var w=y.flags;switch(y.tag){case 0:case 11:case 15:yc(a,y),w&4&&Zf(5,y);break;case 1:if(yc(a,y),w&4)if(a=y.stateNode,h===null)try{a.componentDidMount()}catch(Q){Ki(y,y.return,Q)}else{var D=Sh(y.type,h.memoizedProps);h=h.memoizedState;try{a.componentDidUpdate(D,h,a.__reactInternalSnapshotBeforeUpdate)}catch(Q){Ki(y,y.return,Q)}}w&64&&md(y),w&512&&Ah(y,y.return);break;case 3:if(yc(a,y),w&64&&(a=y.updateQueue,a!==null)){if(h=null,y.child!==null)switch(y.child.tag){case 27:case 5:h=y.child.stateNode;break;case 1:h=y.child.stateNode}try{od(a,h)}catch(Q){Ki(y,y.return,Q)}}break;case 27:h===null&&w&4&&Xf(y);case 26:case 5:yc(a,y),h===null&&w&4&&Kd(y),w&512&&Ah(y,y.return);break;case 12:yc(a,y);break;case 31:yc(a,y),w&4&&Py(a,y);break;case 13:yc(a,y),w&4&&Ry(a,y),w&64&&(a=y.memoizedState,a!==null&&(a=a.dehydrated,a!==null&&(y=Qg.bind(null,y),up(a,y))));break;case 22:if(w=y.memoizedState!==null||wl,!w){h=h!==null&&h.memoizedState!==null||Qr,D=wl;var B=Qr;wl=w,(Qr=h)&&!B?Ru(a,y,(y.subtreeFlags&8772)!==0):yc(a,y),wl=D,Qr=B}break;case 30:break;default:yc(a,y)}}function Yd(a){var h=a.alternate;h!==null&&(a.alternate=null,Yd(h)),a.child=null,a.deletions=null,a.sibling=null,a.tag===5&&(h=a.stateNode,h!==null&&js(h)),a.stateNode=null,a.return=null,a.dependencies=null,a.memoizedProps=null,a.memoizedState=null,a.pendingProps=null,a.stateNode=null,a.updateQueue=null}var Vr=null,Zo=!1;function _c(a,h,y){for(y=y.child;y!==null;)Iy(a,h,y),y=y.sibling}function Iy(a,h,y){if(De&&typeof De.onCommitFiberUnmount=="function")try{De.onCommitFiberUnmount(Se,y)}catch{}switch(y.tag){case 26:Qr||Bl(y,h),_c(a,h,y),y.memoizedState?y.memoizedState.count--:y.stateNode&&(y=y.stateNode,y.parentNode.removeChild(y));break;case 27:Qr||Bl(y,h);var w=Vr,D=Zo;wc(y.type)&&(Vr=y.stateNode,Zo=!1),_c(a,h,y),Id(y.stateNode),Vr=w,Zo=D;break;case 5:Qr||Bl(y,h);case 6:if(w=Vr,D=Zo,Vr=null,_c(a,h,y),Vr=w,Zo=D,Vr!==null)if(Zo)try{(Vr.nodeType===9?Vr.body:Vr.nodeName==="HTML"?Vr.ownerDocument.body:Vr).removeChild(y.stateNode)}catch(B){Ki(y,h,B)}else try{Vr.removeChild(y.stateNode)}catch(B){Ki(y,h,B)}break;case 18:Vr!==null&&(Zo?(a=Vr,av(a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a,y.stateNode),Al(a)):av(Vr,y.stateNode));break;case 4:w=Vr,D=Zo,Vr=y.stateNode.containerInfo,Zo=!0,_c(a,h,y),Vr=w,Zo=D;break;case 0:case 11:case 14:case 15:cr(2,y,h),Qr||cr(4,y,h),_c(a,h,y);break;case 1:Qr||(Bl(y,h),w=y.stateNode,typeof w.componentWillUnmount=="function"&&Lg(y,h,w)),_c(a,h,y);break;case 21:_c(a,h,y);break;case 22:Qr=(w=Qr)||y.memoizedState!==null,_c(a,h,y),Qr=w;break;default:_c(a,h,y)}}function Py(a,h){if(h.memoizedState===null&&(a=h.alternate,a!==null&&(a=a.memoizedState,a!==null))){a=a.dehydrated;try{Al(a)}catch(y){Ki(h,h.return,y)}}}function Ry(a,h){if(h.memoizedState===null&&(a=h.alternate,a!==null&&(a=a.memoizedState,a!==null&&(a=a.dehydrated,a!==null))))try{Al(a)}catch(y){Ki(h,h.return,y)}}function hb(a){switch(a.tag){case 31:case 13:case 19:var h=a.stateNode;return h===null&&(h=a.stateNode=new zg),h;case 22:return a=a.stateNode,h=a._retryCache,h===null&&(h=a._retryCache=new zg),h;default:throw Error(o(435,a.tag))}}function rm(a,h){var y=hb(a);h.forEach(function(w){if(!y.has(w)){y.add(w);var D=of.bind(null,a,w);w.then(D,D)}})}function os(a,h){var y=h.deletions;if(y!==null)for(var w=0;w<y.length;w++){var D=y[w],B=a,Q=h,he=Q;e:for(;he!==null;){switch(he.tag){case 27:if(wc(he.type)){Vr=he.stateNode,Zo=!1;break e}break;case 5:Vr=he.stateNode,Zo=!1;break e;case 3:case 4:Vr=he.stateNode.containerInfo,Zo=!0;break e}he=he.return}if(Vr===null)throw Error(o(160));Iy(B,Q,D),Vr=null,Zo=!1,B=D.alternate,B!==null&&(B.return=null),D.return=null}if(h.subtreeFlags&13886)for(h=h.child;h!==null;)Ly(h,a),h=h.sibling}var Pu=null;function Ly(a,h){var y=a.alternate,w=a.flags;switch(a.tag){case 0:case 11:case 14:case 15:os(h,a),Ho(a),w&4&&(cr(3,a,a.return),Zf(3,a),cr(5,a,a.return));break;case 1:os(h,a),Ho(a),w&512&&(Qr||y===null||Bl(y,y.return)),w&64&&wl&&(a=a.updateQueue,a!==null&&(w=a.callbacks,w!==null&&(y=a.shared.hiddenCallbacks,a.shared.hiddenCallbacks=y===null?w:y.concat(w))));break;case 26:var D=Pu;if(os(h,a),Ho(a),w&512&&(Qr||y===null||Bl(y,y.return)),w&4){var B=y!==null?y.memoizedState:null;if(w=a.memoizedState,y===null)if(w===null)if(a.stateNode===null){e:{w=a.type,y=a.memoizedProps,D=D.ownerDocument||D;t:switch(w){case"title":B=D.getElementsByTagName("title")[0],(!B||B[Vs]||B[Lt]||B.namespaceURI==="http://www.w3.org/2000/svg"||B.hasAttribute("itemprop"))&&(B=D.createElement(w),D.head.insertBefore(B,D.querySelector("head > title"))),io(B,w,y),B[Lt]=a,Mr(B),w=B;break e;case"link":var Q=Gt("link","href",D).get(w+(y.href||""));if(Q){for(var he=0;he<Q.length;he++)if(B=Q[he],B.getAttribute("href")===(y.href==null||y.href===""?null:y.href)&&B.getAttribute("rel")===(y.rel==null?null:y.rel)&&B.getAttribute("title")===(y.title==null?null:y.title)&&B.getAttribute("crossorigin")===(y.crossOrigin==null?null:y.crossOrigin)){Q.splice(he,1);break t}}B=D.createElement(w),io(B,w,y),D.head.appendChild(B);break;case"meta":if(Q=Gt("meta","content",D).get(w+(y.content||""))){for(he=0;he<Q.length;he++)if(B=Q[he],B.getAttribute("content")===(y.content==null?null:""+y.content)&&B.getAttribute("name")===(y.name==null?null:y.name)&&B.getAttribute("property")===(y.property==null?null:y.property)&&B.getAttribute("http-equiv")===(y.httpEquiv==null?null:y.httpEquiv)&&B.getAttribute("charset")===(y.charSet==null?null:y.charSet)){Q.splice(he,1);break t}}B=D.createElement(w),io(B,w,y),D.head.appendChild(B);break;default:throw Error(o(468,w))}B[Lt]=a,Mr(B),w=B}a.stateNode=w}else Ft(D,a.type,a.stateNode);else a.stateNode=Le(D,w,a.memoizedProps);else B!==w?(B===null?y.stateNode!==null&&(y=y.stateNode,y.parentNode.removeChild(y)):B.count--,w===null?Ft(D,a.type,a.stateNode):Le(D,w,a.memoizedProps)):w===null&&a.stateNode!==null&&im(a,a.memoizedProps,y.memoizedProps)}break;case 27:os(h,a),Ho(a),w&512&&(Qr||y===null||Bl(y,y.return)),y!==null&&w&4&&im(a,a.memoizedProps,y.memoizedProps);break;case 5:if(os(h,a),Ho(a),w&512&&(Qr||y===null||Bl(y,y.return)),a.flags&32){D=a.stateNode;try{Gi(D,"")}catch(cn){Ki(a,a.return,cn)}}w&4&&a.stateNode!=null&&(D=a.memoizedProps,im(a,D,y!==null?y.memoizedProps:D)),w&1024&&(Dg=!0);break;case 6:if(os(h,a),Ho(a),w&4){if(a.stateNode===null)throw Error(o(162));w=a.memoizedProps,y=a.stateNode;try{y.nodeValue=w}catch(cn){Ki(a,a.return,cn)}}break;case 3:if(Ct=null,D=Pu,Pu=Cm(h.containerInfo),os(h,a),Pu=D,Ho(a),w&4&&y!==null&&y.memoizedState.isDehydrated)try{Al(h.containerInfo)}catch(cn){Ki(a,a.return,cn)}Dg&&(Dg=!1,ky(a));break;case 4:w=Pu,Pu=Cm(a.stateNode.containerInfo),os(h,a),Ho(a),Pu=w;break;case 12:os(h,a),Ho(a);break;case 31:os(h,a),Ho(a),w&4&&(w=a.updateQueue,w!==null&&(a.updateQueue=null,rm(a,w)));break;case 13:os(h,a),Ho(a),a.child.flags&8192&&a.memoizedState!==null!=(y!==null&&y.memoizedState!==null)&&(tf=$r()),w&4&&(w=a.updateQueue,w!==null&&(a.updateQueue=null,rm(a,w)));break;case 22:D=a.memoizedState!==null;var je=y!==null&&y.memoizedState!==null,dt=wl,bt=Qr;if(wl=dt||D,Qr=bt||je,os(h,a),Qr=bt,wl=dt,Ho(a),w&8192)e:for(h=a.stateNode,h._visibility=D?h._visibility&-2:h._visibility|1,D&&(y===null||je||wl||Qr||_d(a)),y=null,h=a;;){if(h.tag===5||h.tag===26){if(y===null){je=y=h;try{if(B=je.stateNode,D)Q=B.style,typeof Q.setProperty=="function"?Q.setProperty("display","none","important"):Q.display="none";else{he=je.stateNode;var Et=je.memoizedProps.style,ft=Et!=null&&Et.hasOwnProperty("display")?Et.display:null;he.style.display=ft==null||typeof ft=="boolean"?"":(""+ft).trim()}}catch(cn){Ki(je,je.return,cn)}}}else if(h.tag===6){if(y===null){je=h;try{je.stateNode.nodeValue=D?"":je.memoizedProps}catch(cn){Ki(je,je.return,cn)}}}else if(h.tag===18){if(y===null){je=h;try{var yt=je.stateNode;D?l_(yt,!0):l_(je.stateNode,!1)}catch(cn){Ki(je,je.return,cn)}}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===a)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===a)break e;for(;h.sibling===null;){if(h.return===null||h.return===a)break e;y===h&&(y=null),h=h.return}y===h&&(y=null),h.sibling.return=h.return,h=h.sibling}w&4&&(w=a.updateQueue,w!==null&&(y=w.retryQueue,y!==null&&(w.retryQueue=null,rm(a,y))));break;case 19:os(h,a),Ho(a),w&4&&(w=a.updateQueue,w!==null&&(a.updateQueue=null,rm(a,w)));break;case 30:break;case 21:break;default:os(h,a),Ho(a)}}function Ho(a){var h=a.flags;if(h&2){try{for(var y,w=a.return;w!==null;){if(kg(w)){y=w;break}w=w.return}if(y==null)throw Error(o(160));switch(y.tag){case 27:var D=y.stateNode,B=gd(a);Zc(a,B,D);break;case 5:var Q=y.stateNode;y.flags&32&&(Gi(Q,""),y.flags&=-33);var he=gd(a);Zc(a,he,Q);break;case 3:case 4:var je=y.stateNode.containerInfo,dt=gd(a);Hf(a,dt,je);break;default:throw Error(o(161))}}catch(bt){Ki(a,a.return,bt)}a.flags&=-3}h&4096&&(a.flags&=-4097)}function ky(a){if(a.subtreeFlags&1024)for(a=a.child;a!==null;){var h=a;ky(h),h.tag===5&&h.flags&1024&&h.stateNode.reset(),a=a.sibling}}function yc(a,h){if(h.subtreeFlags&8772)for(h=h.child;h!==null;)Og(a,h.alternate,h),h=h.sibling}function _d(a){for(a=a.child;a!==null;){var h=a;switch(h.tag){case 0:case 11:case 14:case 15:cr(4,h,h.return),_d(h);break;case 1:Bl(h,h.return);var y=h.stateNode;typeof y.componentWillUnmount=="function"&&Lg(h,h.return,y),_d(h);break;case 27:Id(h.stateNode);case 26:case 5:Bl(h,h.return),_d(h);break;case 22:h.memoizedState===null&&_d(h);break;case 30:_d(h);break;default:_d(h)}a=a.sibling}}function Ru(a,h,y){for(y=y&&(h.subtreeFlags&8772)!==0,h=h.child;h!==null;){var w=h.alternate,D=a,B=h,Q=B.flags;switch(B.tag){case 0:case 11:case 15:Ru(D,B,y),Zf(4,B);break;case 1:if(Ru(D,B,y),w=B,D=w.stateNode,typeof D.componentDidMount=="function")try{D.componentDidMount()}catch(dt){Ki(w,w.return,dt)}if(w=B,D=w.updateQueue,D!==null){var he=w.stateNode;try{var je=D.shared.hiddenCallbacks;if(je!==null)for(D.shared.hiddenCallbacks=null,D=0;D<je.length;D++)Tn(je[D],he)}catch(dt){Ki(w,w.return,dt)}}y&&Q&64&&md(B),Ah(B,B.return);break;case 27:Xf(B);case 26:case 5:Ru(D,B,y),y&&w===null&&Q&4&&Kd(B),Ah(B,B.return);break;case 12:Ru(D,B,y);break;case 31:Ru(D,B,y),y&&Q&4&&Py(D,B);break;case 13:Ru(D,B,y),y&&Q&4&&Ry(D,B);break;case 22:B.memoizedState===null&&Ru(D,B,y),Ah(B,B.return);break;case 30:break;default:Ru(D,B,y)}h=h.sibling}}function yd(a,h){var y=null;a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(y=a.memoizedState.cachePool.pool),a=null,h.memoizedState!==null&&h.memoizedState.cachePool!==null&&(a=h.memoizedState.cachePool.pool),a!==y&&(a!=null&&a.refCount++,y!=null&&Yl(y))}function Wf(a,h){a=null,h.alternate!==null&&(a=h.alternate.memoizedState.cache),h=h.memoizedState.cache,h!==a&&(h.refCount++,a!=null&&Yl(a))}function Lu(a,h,y,w){if(h.subtreeFlags&10256)for(h=h.child;h!==null;)Dy(a,h,y,w),h=h.sibling}function Dy(a,h,y,w){var D=h.flags;switch(h.tag){case 0:case 11:case 15:Lu(a,h,y,w),D&2048&&Zf(9,h);break;case 1:Lu(a,h,y,w);break;case 3:Lu(a,h,y,w),D&2048&&(a=null,h.alternate!==null&&(a=h.alternate.memoizedState.cache),h=h.memoizedState.cache,h!==a&&(h.refCount++,a!=null&&Yl(a)));break;case 12:if(D&2048){Lu(a,h,y,w),a=h.stateNode;try{var B=h.memoizedProps,Q=B.id,he=B.onPostCommit;typeof he=="function"&&he(Q,h.alternate===null?"mount":"update",a.passiveEffectDuration,-0)}catch(je){Ki(h,h.return,je)}}else Lu(a,h,y,w);break;case 31:Lu(a,h,y,w);break;case 13:Lu(a,h,y,w);break;case 23:break;case 22:B=h.stateNode,Q=h.alternate,h.memoizedState!==null?B._visibility&2?Lu(a,h,y,w):Qd(a,h):B._visibility&2?Lu(a,h,y,w):(B._visibility|=2,vd(a,h,y,w,(h.subtreeFlags&10256)!==0||!1)),D&2048&&yd(Q,h);break;case 24:Lu(a,h,y,w),D&2048&&Wf(h.alternate,h);break;default:Lu(a,h,y,w)}}function vd(a,h,y,w,D){for(D=D&&((h.subtreeFlags&10256)!==0||!1),h=h.child;h!==null;){var B=a,Q=h,he=y,je=w,dt=Q.flags;switch(Q.tag){case 0:case 11:case 15:vd(B,Q,he,je,D),Zf(8,Q);break;case 23:break;case 22:var bt=Q.stateNode;Q.memoizedState!==null?bt._visibility&2?vd(B,Q,he,je,D):Qd(B,Q):(bt._visibility|=2,vd(B,Q,he,je,D)),D&&dt&2048&&yd(Q.alternate,Q);break;case 24:vd(B,Q,he,je,D),D&&dt&2048&&Wf(Q.alternate,Q);break;default:vd(B,Q,he,je,D)}h=h.sibling}}function Qd(a,h){if(h.subtreeFlags&10256)for(h=h.child;h!==null;){var y=a,w=h,D=w.flags;switch(w.tag){case 22:Qd(y,w),D&2048&&yd(w.alternate,w);break;case 24:Qd(y,w),D&2048&&Wf(w.alternate,w);break;default:Qd(y,w)}h=h.sibling}}var Kf=8192;function Jd(a,h,y){if(a.subtreeFlags&Kf)for(a=a.child;a!==null;)ef(a,h,y),a=a.sibling}function ef(a,h,y){switch(a.tag){case 26:Jd(a,h,y),a.flags&Kf&&a.memoizedState!==null&&qt(y,Pu,a.memoizedState,a.memoizedProps);break;case 5:Jd(a,h,y);break;case 3:case 4:var w=Pu;Pu=Cm(a.stateNode.containerInfo),Jd(a,h,y),Pu=w;break;case 22:a.memoizedState===null&&(w=a.alternate,w!==null&&w.memoizedState!==null?(w=Kf,Kf=16777216,Jd(a,h,y),Kf=w):Jd(a,h,y));break;default:Jd(a,h,y)}}function Ng(a){var h=a.alternate;if(h!==null&&(a=h.child,a!==null)){h.child=null;do h=a.sibling,a.sibling=null,a=h;while(a!==null)}}function Yf(a){var h=a.deletions;if((a.flags&16)!==0){if(h!==null)for(var y=0;y<h.length;y++){var w=h[y];Jr=w,Oy(w,a)}Ng(a)}if(a.subtreeFlags&10256)for(a=a.child;a!==null;)zy(a),a=a.sibling}function zy(a){switch(a.tag){case 0:case 11:case 15:Yf(a),a.flags&2048&&cr(9,a,a.return);break;case 3:Yf(a);break;case 12:Yf(a);break;case 22:var h=a.stateNode;a.memoizedState!==null&&h._visibility&2&&(a.return===null||a.return.tag!==13)?(h._visibility&=-3,am(a)):Yf(a);break;default:Yf(a)}}function am(a){var h=a.deletions;if((a.flags&16)!==0){if(h!==null)for(var y=0;y<h.length;y++){var w=h[y];Jr=w,Oy(w,a)}Ng(a)}for(a=a.child;a!==null;){switch(h=a,h.tag){case 0:case 11:case 15:cr(8,h,h.return),am(h);break;case 22:y=h.stateNode,y._visibility&2&&(y._visibility&=-3,am(h));break;default:am(h)}a=a.sibling}}function Oy(a,h){for(;Jr!==null;){var y=Jr;switch(y.tag){case 0:case 11:case 15:cr(8,y,h);break;case 23:case 22:if(y.memoizedState!==null&&y.memoizedState.cachePool!==null){var w=y.memoizedState.cachePool.pool;w!=null&&w.refCount++}break;case 24:Yl(y.memoizedState.cache)}if(w=y.child,w!==null)w.return=y,Jr=w;else e:for(y=a;Jr!==null;){w=Jr;var D=w.sibling,B=w.return;if(Yd(w),w===y){Jr=null;break e}if(D!==null){D.return=B,Jr=D;break e}Jr=B}}}var db={getCacheForType:function(a){var h=Ha(Ai),y=h.data.get(a);return y===void 0&&(y=a(),h.data.set(a,y)),y},cacheSignal:function(){return Ha(Ai).controller.signal}},Ny=typeof WeakMap=="function"?WeakMap:Map,Ui=0,Tr=null,gi=null,bi=0,mr=0,go=null,Ch=!1,bd=!1,Bg=!1,Hc=0,_a=0,Xc=0,xd=0,Fg=0,no=0,Wr=0,wd=null,Xo=null,sm=!1,tf=0,Td=0,Qf=1/0,om=null,Mh=null,ls=0,Ih=null,nf=null,Wc=0,Vg=0,jg=null,By=null,Jf=0,Ug=null;function Fl(){return(Ui&2)!==0&&bi!==0?bi&-bi:mt.T!==null?xc():tr()}function $g(){if(no===0)if((bi&536870912)===0||li){var a=tn;tn<<=1,(tn&3932160)===0&&(tn=262144),no=a}else no=536870912;return a=Uo.current,a!==null&&(a.flags|=32),no}function _o(a,h,y){(a===Tr&&(mr===2||mr===9)||a.cancelPendingCommit!==null)&&(af(a,0),Vl(a,bi,no,!1)),er(a,y),((Ui&2)===0||a!==Tr)&&(a===Tr&&((Ui&2)===0&&(xd|=y),_a===4&&Vl(a,bi,no,!1)),bc(a))}function qg(a,h,y){if((Ui&6)!==0)throw Error(o(327));var w=!y&&(h&127)===0&&(h&a.expiredLanes)===0||nn(a,h),D=w?Xg(a,h):lm(a,h,!0),B=w;do{if(D===0){bd&&!w&&Vl(a,h,0,!1);break}else{if(y=a.current.alternate,B&&!ep(y)){D=lm(a,h,!1),B=!1;continue}if(D===2){if(B=h,a.errorRecoveryDisabledLanes&B)var Q=0;else Q=a.pendingLanes&-536870913,Q=Q!==0?Q:Q&536870912?536870912:0;if(Q!==0){h=Q;e:{var he=a;D=wd;var je=he.current.memoizedState.isDehydrated;if(je&&(af(he,Q).flags|=256),Q=lm(he,Q,!1),Q!==2){if(Bg&&!je){he.errorRecoveryDisabledLanes|=B,xd|=B,D=4;break e}B=Xo,Xo=D,B!==null&&(Xo===null?Xo=B:Xo.push.apply(Xo,B))}D=Q}if(B=!1,D!==2)continue}}if(D===1){af(a,0),Vl(a,h,0,!0);break}e:{switch(w=a,B=D,B){case 0:case 1:throw Error(o(345));case 4:if((h&4194048)!==h)break;case 6:Vl(w,h,no,!Ch);break e;case 2:Xo=null;break;case 3:case 5:break;default:throw Error(o(329))}if((h&62914560)===h&&(D=tf+300-$r(),10<D)){if(Vl(w,h,no,!Ch),Rn(w,0,!0)!==0)break e;Wc=h,w.timeoutHandle=Md(Kc.bind(null,w,y,Xo,om,sm,h,no,xd,Wr,Ch,B,"Throttled",-0,0),D);break e}Kc(w,y,Xo,om,sm,h,no,xd,Wr,Ch,B,null,-0,0)}}break}while(!0);bc(a)}function Kc(a,h,y,w,D,B,Q,he,je,dt,bt,Et,ft,yt){if(a.timeoutHandle=-1,Et=h.subtreeFlags,Et&8192||(Et&16785408)===16785408){Et={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Ma},ef(h,B,Et);var cn=(B&62914560)===B?tf-$r():(B&4194048)===B?Td-$r():0;if(cn=St(Et,cn),cn!==null){Wc=B,a.cancelPendingCommit=cn($y.bind(null,a,h,B,y,w,D,Q,he,je,bt,Et,null,ft,yt)),Vl(a,B,Q,!dt);return}}$y(a,h,B,y,w,D,Q,he,je)}function ep(a){for(var h=a;;){var y=h.tag;if((y===0||y===11||y===15)&&h.flags&16384&&(y=h.updateQueue,y!==null&&(y=y.stores,y!==null)))for(var w=0;w<y.length;w++){var D=y[w],B=D.getSnapshot;D=D.value;try{if(!ra(B(),D))return!1}catch{return!1}}if(y=h.child,h.subtreeFlags&16384&&y!==null)y.return=h,h=y;else{if(h===a)break;for(;h.sibling===null;){if(h.return===null||h.return===a)return!0;h=h.return}h.sibling.return=h.return,h=h.sibling}}return!0}function Vl(a,h,y,w){h&=~Fg,h&=~xd,a.suspendedLanes|=h,a.pingedLanes&=~h,w&&(a.warmLanes|=h),w=a.expirationTimes;for(var D=h;0<D;){var B=31-et(D),Q=1<<B;w[B]=-1,D&=~Q}y!==0&&Vn(a,y,h)}function Sd(){return(Ui&6)===0?(lf(0),!1):!0}function rf(){if(gi!==null){if(mr===0)var a=gi.return;else a=gi,gl=Nl=null,W(a),lc=null,jc=0,a=gi;for(;a!==null;)Wd(a.alternate,a),a=a.return;gi=null}}function af(a,h){var y=a.timeoutHandle;y!==-1&&(a.timeoutHandle=-1,Ps(y)),y=a.cancelPendingCommit,y!==null&&(a.cancelPendingCommit=null,y()),Wc=0,rf(),Tr=a,gi=y=Oo(a.current,null),bi=h,mr=0,go=null,Ch=!1,bd=nn(a,h),Bg=!1,Wr=no=Fg=xd=Xc=_a=0,Xo=wd=null,sm=!1,(h&8)!==0&&(h|=h&32);var w=a.entangledLanes;if(w!==0)for(a=a.entanglements,w&=h;0<w;){var D=31-et(w),B=1<<D;h|=a[D],w&=~B}return Hc=h,Ju(),y}function Fy(a,h){Gn=null,mt.H=hd,h===sc||h===Jl?(h=Hp(),mr=3):h===oc?(h=Hp(),mr=4):mr=h===bg?8:h!==null&&typeof h=="object"&&typeof h.then=="function"?6:1,go=h,gi===null&&(_a=1,Eh(a,x(h,a.current)))}function Gg(){var a=Uo.current;return a===null?!0:(bi&4194048)===bi?Cs===null:(bi&62914560)===bi||(bi&536870912)!==0?a===Cs:!1}function Zg(){var a=mt.H;return mt.H=hd,a===null?hd:a}function Vy(){var a=mt.A;return mt.A=db,a}function tp(){_a=4,Ch||(bi&4194048)!==bi&&Uo.current!==null||(bd=!0),(Xc&134217727)===0&&(xd&134217727)===0||Tr===null||Vl(Tr,bi,no,!1)}function lm(a,h,y){var w=Ui;Ui|=2;var D=Zg(),B=Vy();(Tr!==a||bi!==h)&&(om=null,af(a,h)),h=!1;var Q=_a;e:do try{if(mr!==0&&gi!==null){var he=gi,je=go;switch(mr){case 8:rf(),Q=6;break e;case 3:case 2:case 9:case 6:Uo.current===null&&(h=!0);var dt=mr;if(mr=0,go=null,sf(a,he,je,dt),y&&bd){Q=0;break e}break;default:dt=mr,mr=0,go=null,sf(a,he,je,dt)}}Hg(),Q=_a;break}catch(bt){Fy(a,bt)}while(!0);return h&&a.shellSuspendCounter++,gl=Nl=null,Ui=w,mt.H=D,mt.A=B,gi===null&&(Tr=null,bi=0,Ju()),Q}function Hg(){for(;gi!==null;)Wg(gi)}function Xg(a,h){var y=Ui;Ui|=2;var w=Zg(),D=Vy();Tr!==a||bi!==h?(om=null,Qf=$r()+500,af(a,h)):bd=nn(a,h);e:do try{if(mr!==0&&gi!==null){h=gi;var B=go;t:switch(mr){case 1:mr=0,go=null,sf(a,h,B,1);break;case 2:case 9:if(ii(B)){mr=0,go=null,jy(h);break}h=function(){mr!==2&&mr!==9||Tr!==a||(mr=7),bc(a)},B.then(h,h);break e;case 3:mr=7;break e;case 4:mr=5;break e;case 7:ii(B)?(mr=0,go=null,jy(h)):(mr=0,go=null,sf(a,h,B,7));break;case 5:var Q=null;switch(gi.tag){case 26:Q=gi.memoizedState;case 5:case 27:var he=gi;if(Q?dn(Q):he.stateNode.complete){mr=0,go=null;var je=he.sibling;if(je!==null)gi=je;else{var dt=he.return;dt!==null?(gi=dt,um(dt)):gi=null}break t}}mr=0,go=null,sf(a,h,B,5);break;case 6:mr=0,go=null,sf(a,h,B,6);break;case 8:rf(),_a=6;break e;default:throw Error(o(462))}}fb();break}catch(bt){Fy(a,bt)}while(!0);return gl=Nl=null,mt.H=w,mt.A=D,Ui=y,gi!==null?0:(Tr=null,bi=0,Ju(),_a)}function fb(){for(;gi!==null&&!So();)Wg(gi)}function Wg(a){var h=Ay(a.alternate,a,Hc);a.memoizedProps=a.pendingProps,h===null?um(a):gi=h}function jy(a){var h=a,y=h.alternate;switch(h.tag){case 15:case 0:h=Sy(y,h,h.pendingProps,h.type,void 0,bi);break;case 11:h=Sy(y,h,h.pendingProps,h.type.render,h.ref,bi);break;case 5:W(h);default:Wd(y,h),h=gi=ed(h,Hc),h=Ay(y,h,Hc)}a.memoizedProps=a.pendingProps,h===null?um(a):gi=h}function sf(a,h,y,w){gl=Nl=null,W(h),lc=null,jc=0;var D=h.return;try{if(ob(a,D,h,y,bi)){_a=1,Eh(a,x(y,a.current)),gi=null;return}}catch(B){if(D!==null)throw gi=D,B;_a=1,Eh(a,x(y,a.current)),gi=null;return}h.flags&32768?(li||w===1?a=!0:bd||(bi&536870912)!==0?a=!1:(Ch=a=!0,(w===2||w===9||w===3||w===6)&&(w=Uo.current,w!==null&&w.tag===13&&(w.flags|=16384))),Uy(h,a)):um(h)}function um(a){var h=a;do{if((h.flags&32768)!==0){Uy(h,Ch);return}a=h.return;var y=ub(h.alternate,h,Hc);if(y!==null){gi=y;return}if(h=h.sibling,h!==null){gi=h;return}gi=h=a}while(h!==null);_a===0&&(_a=5)}function Uy(a,h){do{var y=My(a.alternate,a);if(y!==null){y.flags&=32767,gi=y;return}if(y=a.return,y!==null&&(y.flags|=32768,y.subtreeFlags=0,y.deletions=null),!h&&(a=a.sibling,a!==null)){gi=a;return}gi=a=y}while(a!==null);_a=6,gi=null}function $y(a,h,y,w,D,B,Q,he,je){a.cancelPendingCommit=null;do np();while(ls!==0);if((Ui&6)!==0)throw Error(o(327));if(h!==null){if(h===a.current)throw Error(o(177));if(B=h.lanes|h.childLanes,B|=yu,Cr(a,y,B,Q,he,je),a===Tr&&(gi=Tr=null,bi=0),nf=h,Ih=a,Wc=y,Vg=B,jg=D,By=w,(h.subtreeFlags&10256)!==0||(h.flags&10256)!==0?(a.callbackNode=null,a.callbackPriority=0,Gy(ms,function(){return cm(),null})):(a.callbackNode=null,a.callbackPriority=0),w=(h.flags&13878)!==0,(h.subtreeFlags&13878)!==0||w){w=mt.T,mt.T=null,D=$t.p,$t.p=2,Q=Ui,Ui|=4;try{cb(a,h,y)}finally{Ui=Q,$t.p=D,mt.T=w}}ls=1,Kg(),Yg(),vc()}}function Kg(){if(ls===1){ls=0;var a=Ih,h=nf,y=(h.flags&13878)!==0;if((h.subtreeFlags&13878)!==0||y){y=mt.T,mt.T=null;var w=$t.p;$t.p=2;var D=Ui;Ui|=4;try{Ly(h,a);var B=vm,Q=Ku(a.containerInfo),he=B.focusedElem,je=B.selectionRange;if(Q!==he&&he&&he.ownerDocument&&Wu(he.ownerDocument.documentElement,he)){if(je!==null&&cl(he)){var dt=je.start,bt=je.end;if(bt===void 0&&(bt=dt),"selectionStart"in he)he.selectionStart=dt,he.selectionEnd=Math.min(bt,he.value.length);else{var Et=he.ownerDocument||document,ft=Et&&Et.defaultView||window;if(ft.getSelection){var yt=ft.getSelection(),cn=he.textContent.length,En=Math.min(je.start,cn),jr=je.end===void 0?En:Math.min(je.end,cn);!yt.extend&&En>jr&&(Q=jr,jr=En,En=Q);var it=mu(he,En),Qe=mu(he,jr);if(it&&Qe&&(yt.rangeCount!==1||yt.anchorNode!==it.node||yt.anchorOffset!==it.offset||yt.focusNode!==Qe.node||yt.focusOffset!==Qe.offset)){var pt=Et.createRange();pt.setStart(it.node,it.offset),yt.removeAllRanges(),En>jr?(yt.addRange(pt),yt.extend(Qe.node,Qe.offset)):(pt.setEnd(Qe.node,Qe.offset),yt.addRange(pt))}}}}for(Et=[],yt=he;yt=yt.parentNode;)yt.nodeType===1&&Et.push({element:yt,left:yt.scrollLeft,top:yt.scrollTop});for(typeof he.focus=="function"&&he.focus(),he=0;he<Et.length;he++){var Rt=Et[he];Rt.element.scrollLeft=Rt.left,Rt.element.scrollTop=Rt.top}}va=!!cf,vm=cf=null}finally{Ui=D,$t.p=w,mt.T=y}}a.current=h,ls=2}}function Yg(){if(ls===2){ls=0;var a=Ih,h=nf,y=(h.flags&8772)!==0;if((h.subtreeFlags&8772)!==0||y){y=mt.T,mt.T=null;var w=$t.p;$t.p=2;var D=Ui;Ui|=4;try{Og(a,h.alternate,h)}finally{Ui=D,$t.p=w,mt.T=y}}ls=3}}function vc(){if(ls===4||ls===3){ls=0,so();var a=Ih,h=nf,y=Wc,w=By;(h.subtreeFlags&10256)!==0||(h.flags&10256)!==0?ls=5:(ls=0,nf=Ih=null,Yc(a,a.pendingLanes));var D=a.pendingLanes;if(D===0&&(Mh=null),en(y),h=h.stateNode,De&&typeof De.onCommitFiberRoot=="function")try{De.onCommitFiberRoot(Se,h,void 0,(h.current.flags&128)===128)}catch{}if(w!==null){h=mt.T,D=$t.p,$t.p=2,mt.T=null;try{for(var B=a.onRecoverableError,Q=0;Q<w.length;Q++){var he=w[Q];B(he.value,{componentStack:he.stack})}}finally{mt.T=h,$t.p=D}}(Wc&3)!==0&&np(),bc(a),D=a.pendingLanes,(y&261930)!==0&&(D&42)!==0?a===Ug?Jf++:(Jf=0,Ug=a):Jf=0,lf(0)}}function Yc(a,h){(a.pooledCacheLanes&=h)===0&&(h=a.pooledCache,h!=null&&(a.pooledCache=null,Yl(h)))}function np(){return Kg(),Yg(),vc(),cm()}function cm(){if(ls!==5)return!1;var a=Ih,h=Vg;Vg=0;var y=en(Wc),w=mt.T,D=$t.p;try{$t.p=32>y?32:y,mt.T=null,y=jg,jg=null;var B=Ih,Q=Wc;if(ls=0,nf=Ih=null,Wc=0,(Ui&6)!==0)throw Error(o(331));var he=Ui;if(Ui|=4,zy(B.current),Dy(B,B.current,Q,y),Ui=he,lf(0,!1),De&&typeof De.onPostCommitFiberRoot=="function")try{De.onPostCommitFiberRoot(Se,B)}catch{}return!0}finally{$t.p=D,mt.T=w,Yc(a,h)}}function qy(a,h,y){h=x(y,h),h=Hd(a.stateNode,h,2),a=tu(a,h,2),a!==null&&(er(a,2),bc(a))}function Ki(a,h,y){if(a.tag===3)qy(a,a,y);else for(;h!==null;){if(h.tag===3){qy(h,a,y);break}else if(h.tag===1){var w=h.stateNode;if(typeof h.type.getDerivedStateFromError=="function"||typeof w.componentDidCatch=="function"&&(Mh===null||!Mh.has(w))){a=x(y,a),y=yg(2),w=tu(h,y,2),w!==null&&(vg(y,w,h,a),er(w,2),bc(w));break}}h=h.return}}function ip(a,h,y){var w=a.pingCache;if(w===null){w=a.pingCache=new Ny;var D=new Set;w.set(h,D)}else D=w.get(h),D===void 0&&(D=new Set,w.set(h,D));D.has(y)||(Bg=!0,D.add(y),a=pb.bind(null,a,h,y),h.then(a,a))}function pb(a,h,y){var w=a.pingCache;w!==null&&w.delete(h),a.pingedLanes|=a.suspendedLanes&y,a.warmLanes&=~y,Tr===a&&(bi&y)===y&&(_a===4||_a===3&&(bi&62914560)===bi&&300>$r()-tf?(Ui&2)===0&&af(a,0):Fg|=y,Wr===bi&&(Wr=0)),bc(a)}function hm(a,h){h===0&&(h=Pi()),a=ko(a,h),a!==null&&(er(a,h),bc(a))}function Qg(a){var h=a.memoizedState,y=0;h!==null&&(y=h.retryLane),hm(a,y)}function of(a,h){var y=0;switch(a.tag){case 31:case 13:var w=a.stateNode,D=a.memoizedState;D!==null&&(y=D.retryLane);break;case 19:w=a.stateNode;break;case 22:w=a.stateNode._retryCache;break;default:throw Error(o(314))}w!==null&&w.delete(h),hm(a,y)}function Gy(a,h){return fr(a,h)}var rp=null,Ph=null,dm=!1,Ed=!1,fm=!1,Rh=0;function bc(a){a!==Ph&&a.next===null&&(Ph===null?rp=Ph=a:Ph=Ph.next=a),Ed=!0,dm||(dm=!0,Jg())}function lf(a,h){if(!fm&&Ed){fm=!0;do for(var y=!1,w=rp;w!==null;){if(a!==0){var D=w.pendingLanes;if(D===0)var B=0;else{var Q=w.suspendedLanes,he=w.pingedLanes;B=(1<<31-et(42|a)+1)-1,B&=D&~(Q&~he),B=B&201326741?B&201326741|1:B?B|2:0}B!==0&&(y=!0,Wy(w,B))}else B=bi,B=Rn(w,w===Tr?B:0,w.cancelPendingCommit!==null||w.timeoutHandle!==-1),(B&3)===0||nn(w,B)||(y=!0,Wy(w,B));w=w.next}while(y);fm=!1}}function mb(){Zy()}function Zy(){Ed=dm=!1;var a=0;Rh!==0&&_b()&&(a=Rh);for(var h=$r(),y=null,w=rp;w!==null;){var D=w.next,B=Hy(w,h);B===0?(w.next=null,y===null?rp=D:y.next=D,D===null&&(Ph=y)):(y=w,(a!==0||(B&3)!==0)&&(Ed=!0)),w=D}ls!==0&&ls!==5||lf(a),Rh!==0&&(Rh=0)}function Hy(a,h){for(var y=a.suspendedLanes,w=a.pingedLanes,D=a.expirationTimes,B=a.pendingLanes&-62914561;0<B;){var Q=31-et(B),he=1<<Q,je=D[Q];je===-1?((he&y)===0||(he&w)!==0)&&(D[Q]=Nn(he,h)):je<=h&&(a.expiredLanes|=he),B&=~he}if(h=Tr,y=bi,y=Rn(a,a===h?y:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),w=a.callbackNode,y===0||a===h&&(mr===2||mr===9)||a.cancelPendingCommit!==null)return w!==null&&w!==null&&Ea(w),a.callbackNode=null,a.callbackPriority=0;if((y&3)===0||nn(a,y)){if(h=y&-y,h===a.callbackPriority)return h;switch(w!==null&&Ea(w),en(y)){case 2:case 8:y=Fs;break;case 32:y=ms;break;case 268435456:y=se;break;default:y=ms}return w=Xy.bind(null,a),y=fr(y,w),a.callbackPriority=h,a.callbackNode=y,h}return w!==null&&w!==null&&Ea(w),a.callbackPriority=2,a.callbackNode=null,2}function Xy(a,h){if(ls!==0&&ls!==5)return a.callbackNode=null,a.callbackPriority=0,null;var y=a.callbackNode;if(np()&&a.callbackNode!==y)return null;var w=bi;return w=Rn(a,a===Tr?w:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),w===0?null:(qg(a,w,h),Hy(a,$r()),a.callbackNode!=null&&a.callbackNode===y?Xy.bind(null,a):null)}function Wy(a,h){if(np())return null;qg(a,h,!0)}function Jg(){iv(function(){(Ui&6)!==0?fr(ps,mb):Zy()})}function xc(){if(Rh===0){var a=gh;a===0&&(a=xt,xt<<=1,(xt&261888)===0&&(xt=256)),Rh=a}return Rh}function e_(a){return a==null||typeof a=="symbol"||typeof a=="boolean"?null:typeof a=="function"?a:ys(""+a)}function t_(a,h){var y=h.ownerDocument.createElement("input");return y.name=h.name,y.value=h.value,a.id&&y.setAttribute("form",a.id),h.parentNode.insertBefore(y,h),a=new FormData(a),y.parentNode.removeChild(y),a}function Ky(a,h,y,w,D){if(h==="submit"&&y&&y.stateNode===D){var B=e_((D[yn]||null).action),Q=w.submitter;Q&&(h=(h=Q[yn]||null)?e_(h.formAction):Q.getAttribute("formAction"),h!==null&&(B=h,Q=null));var he=new lo("action","action",null,w,D);a.push({event:he,listeners:[{instance:null,listener:function(){if(w.defaultPrevented){if(Rh!==0){var je=Q?t_(D,Q):new FormData(D);mc(y,{pending:!0,data:je,method:D.method,action:B},null,je)}}else typeof B=="function"&&(he.preventDefault(),je=Q?t_(D,Q):new FormData(D),mc(y,{pending:!0,data:je,method:D.method,action:B},B,je))},currentTarget:D}]})}}for(var pm=0;pm<fl.length;pm++){var mm=fl[pm],n_=mm.toLowerCase(),Yy=mm[0].toUpperCase()+mm.slice(1);pa(n_,"on"+Yy)}pa(Hl,"onAnimationEnd"),pa(ph,"onAnimationIteration"),pa(Lo,"onAnimationStart"),pa("dblclick","onDoubleClick"),pa("focusin","onFocus"),pa("focusout","onBlur"),pa(Nc,"onTransitionRun"),pa(gu,"onTransitionStart"),pa(ho,"onTransitionCancel"),pa(_u,"onTransitionEnd"),ja("onMouseEnter",["mouseout","mouseover"]),ja("onMouseLeave",["mouseout","mouseover"]),ja("onPointerEnter",["pointerout","pointerover"]),ja("onPointerLeave",["pointerout","pointerover"]),Ao("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Ao("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Ao("onBeforeInput",["compositionend","keypress","textInput","paste"]),Ao("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Ao("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Ao("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Qc="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Qy=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Qc));function gm(a,h){h=(h&4)!==0;for(var y=0;y<a.length;y++){var w=a[y],D=w.event;w=w.listeners;e:{var B=void 0;if(h)for(var Q=w.length-1;0<=Q;Q--){var he=w[Q],je=he.instance,dt=he.currentTarget;if(he=he.listener,je!==B&&D.isPropagationStopped())break e;B=he,D.currentTarget=dt;try{B(D)}catch(bt){Xl(bt)}D.currentTarget=null,B=je}else for(Q=0;Q<w.length;Q++){if(he=w[Q],je=he.instance,dt=he.currentTarget,he=he.listener,je!==B&&D.isPropagationStopped())break e;B=he,D.currentTarget=dt;try{B(D)}catch(bt){Xl(bt)}D.currentTarget=null,B=je}}}}function _i(a,h){var y=h[nr];y===void 0&&(y=h[nr]=new Set);var w=a+"__bubble";y.has(w)||(Lh(h,a,2,!1),y.add(w))}function Wo(a,h,y){var w=0;h&&(w|=4),Lh(y,a,w,h)}var Jc="_reactListening"+Math.random().toString(36).slice(2);function Ad(a){if(!a[Jc]){a[Jc]=!0,da.forEach(function(y){y!=="selectionchange"&&(Qy.has(y)||Wo(y,!1,a),Wo(y,!0,a))});var h=a.nodeType===9?a:a.ownerDocument;h===null||h[Jc]||(h[Jc]=!0,Wo("selectionchange",!1,h))}}function Lh(a,h,y,w){switch(Oa(h)){case 2:var D=cs;break;case 8:D=vo;break;default:D=Ko}y=D.bind(null,h,y,a),D=void 0,!xr||h!=="touchstart"&&h!=="touchmove"&&h!=="wheel"||(D=!0),w?D!==void 0?a.addEventListener(h,y,{capture:!0,passive:D}):a.addEventListener(h,y,!0):D!==void 0?a.addEventListener(h,y,{passive:D}):a.addEventListener(h,y,!1)}function _m(a,h,y,w,D){var B=w;if((h&1)===0&&(h&2)===0&&w!==null)e:for(;;){if(w===null)return;var Q=w.tag;if(Q===3||Q===4){var he=w.stateNode.containerInfo;if(he===D)break;if(Q===4)for(Q=w.return;Q!==null;){var je=Q.tag;if((je===3||je===4)&&Q.stateNode.containerInfo===D)return;Q=Q.return}for(;he!==null;){if(Q=gs(he),Q===null)return;if(je=Q.tag,je===5||je===6||je===26||je===27){w=B=Q;continue e}he=he.parentNode}}w=w.return}al(function(){var dt=B,bt=Zi(y),Et=[];e:{var ft=Jh.get(a);if(ft!==void 0){var yt=lo,cn=a;switch(a){case"keypress":if($n(y)===0)break e;case"keydown":case"keyup":yt=$u;break;case"focusin":cn="focus",yt=Hi;break;case"focusout":cn="blur",yt=Hi;break;case"beforeblur":case"afterblur":yt=Hi;break;case"click":if(y.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":yt=zr;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":yt=ql;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":yt=Z;break;case Hl:case ph:case Lo:yt=sl;break;case _u:yt=ye;break;case"scroll":case"scrollend":yt=Xn;break;case"wheel":yt=ht;break;case"copy":case"cut":case"paste":yt=Hs;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":yt=zl;break;case"toggle":case"beforetoggle":yt=kn}var En=(h&4)!==0,jr=!En&&(a==="scroll"||a==="scrollend"),it=En?ft!==null?ft+"Capture":null:ft;En=[];for(var Qe=dt,pt;Qe!==null;){var Rt=Qe;if(pt=Rt.stateNode,Rt=Rt.tag,Rt!==5&&Rt!==26&&Rt!==27||pt===null||it===null||(Rt=ar(Qe,it),Rt!=null&&En.push(uf(Qe,Rt,pt))),jr)break;Qe=Qe.return}0<En.length&&(ft=new yt(ft,cn,null,y,bt),Et.push({event:ft,listeners:En}))}}if((h&7)===0){e:{if(ft=a==="mouseover"||a==="pointerover",yt=a==="mouseout"||a==="pointerout",ft&&y!==Ll&&(cn=y.relatedTarget||y.fromElement)&&(gs(cn)||cn[Mn]))break e;if((yt||ft)&&(ft=bt.window===bt?bt:(ft=bt.ownerDocument)?ft.defaultView||ft.parentWindow:window,yt?(cn=y.relatedTarget||y.toElement,yt=dt,cn=cn?gs(cn):null,cn!==null&&(jr=g(cn),En=cn.tag,cn!==jr||En!==5&&En!==27&&En!==6)&&(cn=null)):(yt=null,cn=dt),yt!==cn)){if(En=zr,Rt="onMouseLeave",it="onMouseEnter",Qe="mouse",(a==="pointerout"||a==="pointerover")&&(En=zl,Rt="onPointerLeave",it="onPointerEnter",Qe="pointer"),jr=yt==null?ft:Gr(yt),pt=cn==null?ft:Gr(cn),ft=new En(Rt,Qe+"leave",yt,y,bt),ft.target=jr,ft.relatedTarget=pt,Rt=null,gs(bt)===dt&&(En=new En(it,Qe+"enter",cn,y,bt),En.target=pt,En.relatedTarget=jr,Rt=En),jr=Rt,yt&&cn)t:{for(En=Jy,it=yt,Qe=cn,pt=0,Rt=it;Rt;Rt=En(Rt))pt++;Rt=0;for(var Dn=Qe;Dn;Dn=En(Dn))Rt++;for(;0<pt-Rt;)it=En(it),pt--;for(;0<Rt-pt;)Qe=En(Qe),Rt--;for(;pt--;){if(it===Qe||Qe!==null&&it===Qe.alternate){En=it;break t}it=En(it),Qe=En(Qe)}En=null}else En=null;yt!==null&&ev(Et,ft,yt,En,!1),cn!==null&&jr!==null&&ev(Et,jr,cn,En,!0)}}e:{if(ft=dt?Gr(dt):window,yt=ft.nodeName&&ft.nodeName.toLowerCase(),yt==="select"||yt==="input"&&ft.type==="file")var hr=pu;else if(co(ft))if(dh)hr=Qh;else{hr=$d;var Cn=ll}else yt=ft.nodeName,!yt||yt.toLowerCase()!=="input"||ft.type!=="checkbox"&&ft.type!=="radio"?dt&&$a(dt.elementType)&&(hr=pu):hr=Zl;if(hr&&(hr=hr(a,dt))){Yh(Et,hr,y,bt);break e}Cn&&Cn(a,ft,dt),a==="focusout"&&dt&&ft.type==="number"&&dt.memoizedProps.value!=null&&Gs(ft,"number",ft.value)}switch(Cn=dt?Gr(dt):window,a){case"focusin":(co(Cn)||Cn.contentEditable==="true")&&(dl=Cn,fh=dt,Dc=null);break;case"focusout":Dc=fh=dl=null;break;case"mousedown":Yu=!0;break;case"contextmenu":case"mouseup":case"dragend":Yu=!1,qd(Et,y,bt);break;case"selectionchange":if(hl)break;case"keydown":case"keyup":qd(Et,y,bt)}var pi;if(wi)e:{switch(a){case"compositionstart":var Di="onCompositionStart";break e;case"compositionend":Di="onCompositionEnd";break e;case"compositionupdate":Di="onCompositionUpdate";break e}Di=void 0}else fu?du(a,y)&&(Di="onCompositionEnd"):a==="keydown"&&y.keyCode===229&&(Di="onCompositionStart");Di&&(Ga&&y.locale!=="ko"&&(fu||Di!=="onCompositionStart"?Di==="onCompositionEnd"&&fu&&(pi=na()):(fa=bt,fn="value"in fa?fa.value:fa.textContent,fu=!0)),Cn=ap(dt,Di),0<Cn.length&&(Di=new or(Di,a,null,y,bt),Et.push({event:Di,listeners:Cn}),pi?Di.data=pi:(pi=Ws(y),pi!==null&&(Di.data=pi)))),(pi=qa?Ks(a,y):qu(a,y))&&(Di=ap(dt,"onBeforeInput"),0<Di.length&&(Cn=new or("onBeforeInput","beforeinput",null,y,bt),Et.push({event:Cn,listeners:Di}),Cn.data=pi)),Ky(Et,a,dt,y,bt)}gm(Et,h)})}function uf(a,h,y){return{instance:a,listener:h,currentTarget:y}}function ap(a,h){for(var y=h+"Capture",w=[];a!==null;){var D=a,B=D.stateNode;if(D=D.tag,D!==5&&D!==26&&D!==27||B===null||(D=ar(a,y),D!=null&&w.unshift(uf(a,D,B)),D=ar(a,h),D!=null&&w.push(uf(a,D,B))),a.tag===3)return w;a=a.return}return[]}function Jy(a){if(a===null)return null;do a=a.return;while(a&&a.tag!==5&&a.tag!==27);return a||null}function ev(a,h,y,w,D){for(var B=h._reactName,Q=[];y!==null&&y!==w;){var he=y,je=he.alternate,dt=he.stateNode;if(he=he.tag,je!==null&&je===w)break;he!==5&&he!==26&&he!==27||dt===null||(je=dt,D?(dt=ar(y,B),dt!=null&&Q.unshift(uf(y,dt,je))):D||(dt=ar(y,B),dt!=null&&Q.push(uf(y,dt,je)))),y=y.return}Q.length!==0&&a.push({event:h,listeners:Q})}var tv=/\r\n?/g,kh=/\u0000|\uFFFD/g;function i_(a){return(typeof a=="string"?a:""+a).replace(tv,`
`).replace(kh,"")}function r_(a,h){return h=i_(h),i_(a)===h}function gr(a,h,y,w,D,B){switch(y){case"children":typeof w=="string"?h==="body"||h==="textarea"&&w===""||Gi(a,w):(typeof w=="number"||typeof w=="bigint")&&h!=="body"&&Gi(a,""+w);break;case"className":ci(a,"class",w);break;case"tabIndex":ci(a,"tabindex",w);break;case"dir":case"role":case"viewBox":case"width":case"height":ci(a,y,w);break;case"style":_s(a,w,B);break;case"data":if(h!=="object"){ci(a,"data",w);break}case"src":case"href":if(w===""&&(h!=="a"||y!=="href")){a.removeAttribute(y);break}if(w==null||typeof w=="function"||typeof w=="symbol"||typeof w=="boolean"){a.removeAttribute(y);break}w=ys(""+w),a.setAttribute(y,w);break;case"action":case"formAction":if(typeof w=="function"){a.setAttribute(y,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof B=="function"&&(y==="formAction"?(h!=="input"&&gr(a,h,"name",D.name,D,null),gr(a,h,"formEncType",D.formEncType,D,null),gr(a,h,"formMethod",D.formMethod,D,null),gr(a,h,"formTarget",D.formTarget,D,null)):(gr(a,h,"encType",D.encType,D,null),gr(a,h,"method",D.method,D,null),gr(a,h,"target",D.target,D,null)));if(w==null||typeof w=="symbol"||typeof w=="boolean"){a.removeAttribute(y);break}w=ys(""+w),a.setAttribute(y,w);break;case"onClick":w!=null&&(a.onclick=Ma);break;case"onScroll":w!=null&&_i("scroll",a);break;case"onScrollEnd":w!=null&&_i("scrollend",a);break;case"dangerouslySetInnerHTML":if(w!=null){if(typeof w!="object"||!("__html"in w))throw Error(o(61));if(y=w.__html,y!=null){if(D.children!=null)throw Error(o(60));a.innerHTML=y}}break;case"multiple":a.multiple=w&&typeof w!="function"&&typeof w!="symbol";break;case"muted":a.muted=w&&typeof w!="function"&&typeof w!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(w==null||typeof w=="function"||typeof w=="boolean"||typeof w=="symbol"){a.removeAttribute("xlink:href");break}y=ys(""+w),a.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",y);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":w!=null&&typeof w!="function"&&typeof w!="symbol"?a.setAttribute(y,""+w):a.removeAttribute(y);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":w&&typeof w!="function"&&typeof w!="symbol"?a.setAttribute(y,""):a.removeAttribute(y);break;case"capture":case"download":w===!0?a.setAttribute(y,""):w!==!1&&w!=null&&typeof w!="function"&&typeof w!="symbol"?a.setAttribute(y,w):a.removeAttribute(y);break;case"cols":case"rows":case"size":case"span":w!=null&&typeof w!="function"&&typeof w!="symbol"&&!isNaN(w)&&1<=w?a.setAttribute(y,w):a.removeAttribute(y);break;case"rowSpan":case"start":w==null||typeof w=="function"||typeof w=="symbol"||isNaN(w)?a.removeAttribute(y):a.setAttribute(y,w);break;case"popover":_i("beforetoggle",a),_i("toggle",a),ni(a,"popover",w);break;case"xlinkActuate":qi(a,"http://www.w3.org/1999/xlink","xlink:actuate",w);break;case"xlinkArcrole":qi(a,"http://www.w3.org/1999/xlink","xlink:arcrole",w);break;case"xlinkRole":qi(a,"http://www.w3.org/1999/xlink","xlink:role",w);break;case"xlinkShow":qi(a,"http://www.w3.org/1999/xlink","xlink:show",w);break;case"xlinkTitle":qi(a,"http://www.w3.org/1999/xlink","xlink:title",w);break;case"xlinkType":qi(a,"http://www.w3.org/1999/xlink","xlink:type",w);break;case"xmlBase":qi(a,"http://www.w3.org/XML/1998/namespace","xml:base",w);break;case"xmlLang":qi(a,"http://www.w3.org/XML/1998/namespace","xml:lang",w);break;case"xmlSpace":qi(a,"http://www.w3.org/XML/1998/namespace","xml:space",w);break;case"is":ni(a,"is",w);break;case"innerText":case"textContent":break;default:(!(2<y.length)||y[0]!=="o"&&y[0]!=="O"||y[1]!=="n"&&y[1]!=="N")&&(y=Zs.get(y)||y,ni(a,y,w))}}function ym(a,h,y,w,D,B){switch(y){case"style":_s(a,w,B);break;case"dangerouslySetInnerHTML":if(w!=null){if(typeof w!="object"||!("__html"in w))throw Error(o(61));if(y=w.__html,y!=null){if(D.children!=null)throw Error(o(60));a.innerHTML=y}}break;case"children":typeof w=="string"?Gi(a,w):(typeof w=="number"||typeof w=="bigint")&&Gi(a,""+w);break;case"onScroll":w!=null&&_i("scroll",a);break;case"onScrollEnd":w!=null&&_i("scrollend",a);break;case"onClick":w!=null&&(a.onclick=Ma);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!xi.hasOwnProperty(y))e:{if(y[0]==="o"&&y[1]==="n"&&(D=y.endsWith("Capture"),h=y.slice(2,D?y.length-7:void 0),B=a[yn]||null,B=B!=null?B[y]:null,typeof B=="function"&&a.removeEventListener(h,B,D),typeof w=="function")){typeof B!="function"&&B!==null&&(y in a?a[y]=null:a.hasAttribute(y)&&a.removeAttribute(y)),a.addEventListener(h,w,D);break e}y in a?a[y]=w:w===!0?a.setAttribute(y,""):ni(a,y,w)}}}function io(a,h,y){switch(h){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":_i("error",a),_i("load",a);var w=!1,D=!1,B;for(B in y)if(y.hasOwnProperty(B)){var Q=y[B];if(Q!=null)switch(B){case"src":w=!0;break;case"srcSet":D=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(o(137,h));default:gr(a,h,B,Q,y,null)}}D&&gr(a,h,"srcSet",y.srcSet,y,null),w&&gr(a,h,"src",y.src,y,null);return;case"input":_i("invalid",a);var he=B=Q=D=null,je=null,dt=null;for(w in y)if(y.hasOwnProperty(w)){var bt=y[w];if(bt!=null)switch(w){case"name":D=bt;break;case"type":Q=bt;break;case"checked":je=bt;break;case"defaultChecked":dt=bt;break;case"value":B=bt;break;case"defaultValue":he=bt;break;case"children":case"dangerouslySetInnerHTML":if(bt!=null)throw Error(o(137,h));break;default:gr(a,h,w,bt,y,null)}}Rl(a,B,he,je,dt,Q,D,!1);return;case"select":_i("invalid",a),w=Q=B=null;for(D in y)if(y.hasOwnProperty(D)&&(he=y[D],he!=null))switch(D){case"value":B=he;break;case"defaultValue":Q=he;break;case"multiple":w=he;default:gr(a,h,D,he,y,null)}h=B,y=Q,a.multiple=!!w,h!=null?rr(a,!!w,h,!1):y!=null&&rr(a,!!w,y,!0);return;case"textarea":_i("invalid",a),B=D=w=null;for(Q in y)if(y.hasOwnProperty(Q)&&(he=y[Q],he!=null))switch(Q){case"value":w=he;break;case"defaultValue":D=he;break;case"children":B=he;break;case"dangerouslySetInnerHTML":if(he!=null)throw Error(o(91));break;default:gr(a,h,Q,he,y,null)}Ua(a,w,D,B);return;case"option":for(je in y)if(y.hasOwnProperty(je)&&(w=y[je],w!=null))switch(je){case"selected":a.selected=w&&typeof w!="function"&&typeof w!="symbol";break;default:gr(a,h,je,w,y,null)}return;case"dialog":_i("beforetoggle",a),_i("toggle",a),_i("cancel",a),_i("close",a);break;case"iframe":case"object":_i("load",a);break;case"video":case"audio":for(w=0;w<Qc.length;w++)_i(Qc[w],a);break;case"image":_i("error",a),_i("load",a);break;case"details":_i("toggle",a);break;case"embed":case"source":case"link":_i("error",a),_i("load",a);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(dt in y)if(y.hasOwnProperty(dt)&&(w=y[dt],w!=null))switch(dt){case"children":case"dangerouslySetInnerHTML":throw Error(o(137,h));default:gr(a,h,dt,w,y,null)}return;default:if($a(h)){for(bt in y)y.hasOwnProperty(bt)&&(w=y[bt],w!==void 0&&ym(a,h,bt,w,y,void 0));return}}for(he in y)y.hasOwnProperty(he)&&(w=y[he],w!=null&&gr(a,h,he,w,y,null))}function gb(a,h,y,w){switch(h){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var D=null,B=null,Q=null,he=null,je=null,dt=null,bt=null;for(yt in y){var Et=y[yt];if(y.hasOwnProperty(yt)&&Et!=null)switch(yt){case"checked":break;case"value":break;case"defaultValue":je=Et;default:w.hasOwnProperty(yt)||gr(a,h,yt,null,w,Et)}}for(var ft in w){var yt=w[ft];if(Et=y[ft],w.hasOwnProperty(ft)&&(yt!=null||Et!=null))switch(ft){case"type":B=yt;break;case"name":D=yt;break;case"checked":dt=yt;break;case"defaultChecked":bt=yt;break;case"value":Q=yt;break;case"defaultValue":he=yt;break;case"children":case"dangerouslySetInnerHTML":if(yt!=null)throw Error(o(137,h));break;default:yt!==Et&&gr(a,h,ft,yt,w,Et)}}Mo(a,Q,he,je,dt,bt,B,D);return;case"select":yt=Q=he=ft=null;for(B in y)if(je=y[B],y.hasOwnProperty(B)&&je!=null)switch(B){case"value":break;case"multiple":yt=je;default:w.hasOwnProperty(B)||gr(a,h,B,null,w,je)}for(D in w)if(B=w[D],je=y[D],w.hasOwnProperty(D)&&(B!=null||je!=null))switch(D){case"value":ft=B;break;case"defaultValue":he=B;break;case"multiple":Q=B;default:B!==je&&gr(a,h,D,B,w,je)}h=he,y=Q,w=yt,ft!=null?rr(a,!!y,ft,!1):!!w!=!!y&&(h!=null?rr(a,!!y,h,!0):rr(a,!!y,y?[]:"",!1));return;case"textarea":yt=ft=null;for(he in y)if(D=y[he],y.hasOwnProperty(he)&&D!=null&&!w.hasOwnProperty(he))switch(he){case"value":break;case"children":break;default:gr(a,h,he,null,w,D)}for(Q in w)if(D=w[Q],B=y[Q],w.hasOwnProperty(Q)&&(D!=null||B!=null))switch(Q){case"value":ft=D;break;case"defaultValue":yt=D;break;case"children":break;case"dangerouslySetInnerHTML":if(D!=null)throw Error(o(91));break;default:D!==B&&gr(a,h,Q,D,w,B)}Qa(a,ft,yt);return;case"option":for(var cn in y)if(ft=y[cn],y.hasOwnProperty(cn)&&ft!=null&&!w.hasOwnProperty(cn))switch(cn){case"selected":a.selected=!1;break;default:gr(a,h,cn,null,w,ft)}for(je in w)if(ft=w[je],yt=y[je],w.hasOwnProperty(je)&&ft!==yt&&(ft!=null||yt!=null))switch(je){case"selected":a.selected=ft&&typeof ft!="function"&&typeof ft!="symbol";break;default:gr(a,h,je,ft,w,yt)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var En in y)ft=y[En],y.hasOwnProperty(En)&&ft!=null&&!w.hasOwnProperty(En)&&gr(a,h,En,null,w,ft);for(dt in w)if(ft=w[dt],yt=y[dt],w.hasOwnProperty(dt)&&ft!==yt&&(ft!=null||yt!=null))switch(dt){case"children":case"dangerouslySetInnerHTML":if(ft!=null)throw Error(o(137,h));break;default:gr(a,h,dt,ft,w,yt)}return;default:if($a(h)){for(var jr in y)ft=y[jr],y.hasOwnProperty(jr)&&ft!==void 0&&!w.hasOwnProperty(jr)&&ym(a,h,jr,void 0,w,ft);for(bt in w)ft=w[bt],yt=y[bt],!w.hasOwnProperty(bt)||ft===yt||ft===void 0&&yt===void 0||ym(a,h,bt,ft,w,yt);return}}for(var it in y)ft=y[it],y.hasOwnProperty(it)&&ft!=null&&!w.hasOwnProperty(it)&&gr(a,h,it,null,w,ft);for(Et in w)ft=w[Et],yt=y[Et],!w.hasOwnProperty(Et)||ft===yt||ft==null&&yt==null||gr(a,h,Et,ft,w,yt)}function a_(a){switch(a){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function nv(){if(typeof performance.getEntriesByType=="function"){for(var a=0,h=0,y=performance.getEntriesByType("resource"),w=0;w<y.length;w++){var D=y[w],B=D.transferSize,Q=D.initiatorType,he=D.duration;if(B&&he&&a_(Q)){for(Q=0,he=D.responseEnd,w+=1;w<y.length;w++){var je=y[w],dt=je.startTime;if(dt>he)break;var bt=je.transferSize,Et=je.initiatorType;bt&&a_(Et)&&(je=je.responseEnd,Q+=bt*(je<he?1:(he-dt)/(je-dt)))}if(--w,h+=8*(B+Q)/(D.duration/1e3),a++,10<a)break}}if(0<a)return h/a/1e6}return navigator.connection&&(a=navigator.connection.downlink,typeof a=="number")?a:5}var cf=null,vm=null;function Cd(a){return a.nodeType===9?a:a.ownerDocument}function sp(a){switch(a){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function op(a,h){if(a===0)switch(h){case"svg":return 1;case"math":return 2;default:return 0}return a===1&&h==="foreignObject"?0:a}function s_(a,h){return a==="textarea"||a==="noscript"||typeof h.children=="string"||typeof h.children=="number"||typeof h.children=="bigint"||typeof h.dangerouslySetInnerHTML=="object"&&h.dangerouslySetInnerHTML!==null&&h.dangerouslySetInnerHTML.__html!=null}var o_=null;function _b(){var a=window.event;return a&&a.type==="popstate"?a===o_?!1:(o_=a,!0):(o_=null,!1)}var Md=typeof setTimeout=="function"?setTimeout:void 0,Ps=typeof clearTimeout=="function"?clearTimeout:void 0,bm=typeof Promise=="function"?Promise:void 0,iv=typeof queueMicrotask=="function"?queueMicrotask:typeof bm<"u"?function(a){return bm.resolve(null).then(a).catch(rv)}:Md;function rv(a){setTimeout(function(){throw a})}function wc(a){return a==="head"}function av(a,h){var y=h,w=0;do{var D=y.nextSibling;if(a.removeChild(y),D&&D.nodeType===8)if(y=D.data,y==="/$"||y==="/&"){if(w===0){a.removeChild(D),Al(h);return}w--}else if(y==="$"||y==="$?"||y==="$~"||y==="$!"||y==="&")w++;else if(y==="html")Id(a.ownerDocument.documentElement);else if(y==="head"){y=a.ownerDocument.head,Id(y);for(var B=y.firstChild;B;){var Q=B.nextSibling,he=B.nodeName;B[Vs]||he==="SCRIPT"||he==="STYLE"||he==="LINK"&&B.rel.toLowerCase()==="stylesheet"||y.removeChild(B),B=Q}}else y==="body"&&Id(a.ownerDocument.body);y=D}while(y);Al(h)}function l_(a,h){var y=a;a=0;do{var w=y.nextSibling;if(y.nodeType===1?h?(y._stashedDisplay=y.style.display,y.style.display="none"):(y.style.display=y._stashedDisplay||"",y.getAttribute("style")===""&&y.removeAttribute("style")):y.nodeType===3&&(h?(y._stashedText=y.nodeValue,y.nodeValue=""):y.nodeValue=y._stashedText||""),w&&w.nodeType===8)if(y=w.data,y==="/$"){if(a===0)break;a--}else y!=="$"&&y!=="$?"&&y!=="$~"&&y!=="$!"||a++;y=w}while(y)}function xm(a){var h=a.firstChild;for(h&&h.nodeType===10&&(h=h.nextSibling);h;){var y=h;switch(h=h.nextSibling,y.nodeName){case"HTML":case"HEAD":case"BODY":xm(y),js(y);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(y.rel.toLowerCase()==="stylesheet")continue}a.removeChild(y)}}function yb(a,h,y,w){for(;a.nodeType===1;){var D=y;if(a.nodeName.toLowerCase()!==h.toLowerCase()){if(!w&&(a.nodeName!=="INPUT"||a.type!=="hidden"))break}else if(w){if(!a[Vs])switch(h){case"meta":if(!a.hasAttribute("itemprop"))break;return a;case"link":if(B=a.getAttribute("rel"),B==="stylesheet"&&a.hasAttribute("data-precedence"))break;if(B!==D.rel||a.getAttribute("href")!==(D.href==null||D.href===""?null:D.href)||a.getAttribute("crossorigin")!==(D.crossOrigin==null?null:D.crossOrigin)||a.getAttribute("title")!==(D.title==null?null:D.title))break;return a;case"style":if(a.hasAttribute("data-precedence"))break;return a;case"script":if(B=a.getAttribute("src"),(B!==(D.src==null?null:D.src)||a.getAttribute("type")!==(D.type==null?null:D.type)||a.getAttribute("crossorigin")!==(D.crossOrigin==null?null:D.crossOrigin))&&B&&a.hasAttribute("async")&&!a.hasAttribute("itemprop"))break;return a;default:return a}}else if(h==="input"&&a.type==="hidden"){var B=D.name==null?null:""+D.name;if(D.type==="hidden"&&a.getAttribute("name")===B)return a}else return a;if(a=Tl(a.nextSibling),a===null)break}return null}function sv(a,h,y){if(h==="")return null;for(;a.nodeType!==3;)if((a.nodeType!==1||a.nodeName!=="INPUT"||a.type!=="hidden")&&!y||(a=Tl(a.nextSibling),a===null))return null;return a}function wm(a,h){for(;a.nodeType!==8;)if((a.nodeType!==1||a.nodeName!=="INPUT"||a.type!=="hidden")&&!h||(a=Tl(a.nextSibling),a===null))return null;return a}function lp(a){return a.data==="$?"||a.data==="$~"}function Tm(a){return a.data==="$!"||a.data==="$?"&&a.ownerDocument.readyState!=="loading"}function up(a,h){var y=a.ownerDocument;if(a.data==="$~")a._reactRetry=h;else if(a.data!=="$?"||y.readyState!=="loading")h();else{var w=function(){h(),y.removeEventListener("DOMContentLoaded",w)};y.addEventListener("DOMContentLoaded",w),a._reactRetry=w}}function Tl(a){for(;a!=null;a=a.nextSibling){var h=a.nodeType;if(h===1||h===3)break;if(h===8){if(h=a.data,h==="$"||h==="$!"||h==="$?"||h==="$~"||h==="&"||h==="F!"||h==="F")break;if(h==="/$"||h==="/&")return null}}return a}var Sm=null;function Em(a){a=a.nextSibling;for(var h=0;a;){if(a.nodeType===8){var y=a.data;if(y==="/$"||y==="/&"){if(h===0)return Tl(a.nextSibling);h--}else y!=="$"&&y!=="$!"&&y!=="$?"&&y!=="$~"&&y!=="&"||h++}a=a.nextSibling}return null}function cp(a){a=a.previousSibling;for(var h=0;a;){if(a.nodeType===8){var y=a.data;if(y==="$"||y==="$!"||y==="$?"||y==="$~"||y==="&"){if(h===0)return a;h--}else y!=="/$"&&y!=="/&"||h++}a=a.previousSibling}return null}function hf(a,h,y){switch(h=Cd(y),a){case"html":if(a=h.documentElement,!a)throw Error(o(452));return a;case"head":if(a=h.head,!a)throw Error(o(453));return a;case"body":if(a=h.body,!a)throw Error(o(454));return a;default:throw Error(o(451))}}function Id(a){for(var h=a.attributes;h.length;)a.removeAttributeNode(h[0]);js(a)}var Sl=new Map,Am=new Set;function Cm(a){return typeof a.getRootNode=="function"?a.getRootNode():a.nodeType===9?a:a.ownerDocument}var l=$t.d;$t.d={f:r,r:s,D:E,C:A,L:I,m:z,X:$,S:F,M:X};function r(){var a=l.f(),h=Sd();return a||h}function s(a){var h=qr(a);h!==null&&h.tag===5&&h.type==="form"?bl(h):l.r(a)}var p=typeof document>"u"?null:document;function v(a,h,y){var w=p;if(w&&typeof h=="string"&&h){var D=ir(h);D='link[rel="'+a+'"][href="'+D+'"]',typeof y=="string"&&(D+='[crossorigin="'+y+'"]'),Am.has(D)||(Am.add(D),a={rel:a,crossOrigin:y,href:h},w.querySelector(D)===null&&(h=w.createElement("link"),io(h,"link",a),Mr(h),w.head.appendChild(h)))}}function E(a){l.D(a),v("dns-prefetch",a,null)}function A(a,h){l.C(a,h),v("preconnect",a,h)}function I(a,h,y){l.L(a,h,y);var w=p;if(w&&a&&h){var D='link[rel="preload"][as="'+ir(h)+'"]';h==="image"&&y&&y.imageSrcSet?(D+='[imagesrcset="'+ir(y.imageSrcSet)+'"]',typeof y.imageSizes=="string"&&(D+='[imagesizes="'+ir(y.imageSizes)+'"]')):D+='[href="'+ir(a)+'"]';var B=D;switch(h){case"style":B=ie(a);break;case"script":B=Te(a)}Sl.has(B)||(a=G({rel:"preload",href:h==="image"&&y&&y.imageSrcSet?void 0:a,as:h},y),Sl.set(B,a),w.querySelector(D)!==null||h==="style"&&w.querySelector(re(B))||h==="script"&&w.querySelector(We(B))||(h=w.createElement("link"),io(h,"link",a),Mr(h),w.head.appendChild(h)))}}function z(a,h){l.m(a,h);var y=p;if(y&&a){var w=h&&typeof h.as=="string"?h.as:"script",D='link[rel="modulepreload"][as="'+ir(w)+'"][href="'+ir(a)+'"]',B=D;switch(w){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":B=Te(a)}if(!Sl.has(B)&&(a=G({rel:"modulepreload",href:a},h),Sl.set(B,a),y.querySelector(D)===null)){switch(w){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(y.querySelector(We(B)))return}w=y.createElement("link"),io(w,"link",a),Mr(w),y.head.appendChild(w)}}}function F(a,h,y){l.S(a,h,y);var w=p;if(w&&a){var D=Si(w).hoistableStyles,B=ie(a);h=h||"default";var Q=D.get(B);if(!Q){var he={loading:0,preload:null};if(Q=w.querySelector(re(B)))he.loading=5;else{a=G({rel:"stylesheet",href:a,"data-precedence":h},y),(y=Sl.get(B))&&ot(a,y);var je=Q=w.createElement("link");Mr(je),io(je,"link",a),je._p=new Promise(function(dt,bt){je.onload=dt,je.onerror=bt}),je.addEventListener("load",function(){he.loading|=1}),je.addEventListener("error",function(){he.loading|=2}),he.loading|=4,Fe(Q,h,w)}Q={type:"stylesheet",instance:Q,count:1,state:he},D.set(B,Q)}}}function $(a,h){l.X(a,h);var y=p;if(y&&a){var w=Si(y).hoistableScripts,D=Te(a),B=w.get(D);B||(B=y.querySelector(We(D)),B||(a=G({src:a,async:!0},h),(h=Sl.get(D))&&gt(a,h),B=y.createElement("script"),Mr(B),io(B,"link",a),y.head.appendChild(B)),B={type:"script",instance:B,count:1,state:null},w.set(D,B))}}function X(a,h){l.M(a,h);var y=p;if(y&&a){var w=Si(y).hoistableScripts,D=Te(a),B=w.get(D);B||(B=y.querySelector(We(D)),B||(a=G({src:a,async:!0,type:"module"},h),(h=Sl.get(D))&&gt(a,h),B=y.createElement("script"),Mr(B),io(B,"link",a),y.head.appendChild(B)),B={type:"script",instance:B,count:1,state:null},w.set(D,B))}}function te(a,h,y,w){var D=(D=Xt.current)?Cm(D):null;if(!D)throw Error(o(446));switch(a){case"meta":case"title":return null;case"style":return typeof y.precedence=="string"&&typeof y.href=="string"?(h=ie(y.href),y=Si(D).hoistableStyles,w=y.get(h),w||(w={type:"style",instance:null,count:0,state:null},y.set(h,w)),w):{type:"void",instance:null,count:0,state:null};case"link":if(y.rel==="stylesheet"&&typeof y.href=="string"&&typeof y.precedence=="string"){a=ie(y.href);var B=Si(D).hoistableStyles,Q=B.get(a);if(Q||(D=D.ownerDocument||D,Q={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},B.set(a,Q),(B=D.querySelector(re(a)))&&!B._p&&(Q.instance=B,Q.state.loading=5),Sl.has(a)||(y={rel:"preload",as:"style",href:y.href,crossOrigin:y.crossOrigin,integrity:y.integrity,media:y.media,hrefLang:y.hrefLang,referrerPolicy:y.referrerPolicy},Sl.set(a,y),B||pe(D,a,y,Q.state))),h&&w===null)throw Error(o(528,""));return Q}if(h&&w!==null)throw Error(o(529,""));return null;case"script":return h=y.async,y=y.src,typeof y=="string"&&h&&typeof h!="function"&&typeof h!="symbol"?(h=Te(y),y=Si(D).hoistableScripts,w=y.get(h),w||(w={type:"script",instance:null,count:0,state:null},y.set(h,w)),w):{type:"void",instance:null,count:0,state:null};default:throw Error(o(444,a))}}function ie(a){return'href="'+ir(a)+'"'}function re(a){return'link[rel="stylesheet"]['+a+"]"}function oe(a){return G({},a,{"data-precedence":a.precedence,precedence:null})}function pe(a,h,y,w){a.querySelector('link[rel="preload"][as="style"]['+h+"]")?w.loading=1:(h=a.createElement("link"),w.preload=h,h.addEventListener("load",function(){return w.loading|=1}),h.addEventListener("error",function(){return w.loading|=2}),io(h,"link",y),Mr(h),a.head.appendChild(h))}function Te(a){return'[src="'+ir(a)+'"]'}function We(a){return"script[async]"+a}function Le(a,h,y){if(h.count++,h.instance===null)switch(h.type){case"style":var w=a.querySelector('style[data-href~="'+ir(y.href)+'"]');if(w)return h.instance=w,Mr(w),w;var D=G({},y,{"data-href":y.href,"data-precedence":y.precedence,href:null,precedence:null});return w=(a.ownerDocument||a).createElement("style"),Mr(w),io(w,"style",D),Fe(w,y.precedence,a),h.instance=w;case"stylesheet":D=ie(y.href);var B=a.querySelector(re(D));if(B)return h.state.loading|=4,h.instance=B,Mr(B),B;w=oe(y),(D=Sl.get(D))&&ot(w,D),B=(a.ownerDocument||a).createElement("link"),Mr(B);var Q=B;return Q._p=new Promise(function(he,je){Q.onload=he,Q.onerror=je}),io(B,"link",w),h.state.loading|=4,Fe(B,y.precedence,a),h.instance=B;case"script":return B=Te(y.src),(D=a.querySelector(We(B)))?(h.instance=D,Mr(D),D):(w=y,(D=Sl.get(B))&&(w=G({},y),gt(w,D)),a=a.ownerDocument||a,D=a.createElement("script"),Mr(D),io(D,"link",w),a.head.appendChild(D),h.instance=D);case"void":return null;default:throw Error(o(443,h.type))}else h.type==="stylesheet"&&(h.state.loading&4)===0&&(w=h.instance,h.state.loading|=4,Fe(w,y.precedence,a));return h.instance}function Fe(a,h,y){for(var w=y.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),D=w.length?w[w.length-1]:null,B=D,Q=0;Q<w.length;Q++){var he=w[Q];if(he.dataset.precedence===h)B=he;else if(B!==D)break}B?B.parentNode.insertBefore(a,B.nextSibling):(h=y.nodeType===9?y.head:y,h.insertBefore(a,h.firstChild))}function ot(a,h){a.crossOrigin==null&&(a.crossOrigin=h.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=h.referrerPolicy),a.title==null&&(a.title=h.title)}function gt(a,h){a.crossOrigin==null&&(a.crossOrigin=h.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=h.referrerPolicy),a.integrity==null&&(a.integrity=h.integrity)}var Ct=null;function Gt(a,h,y){if(Ct===null){var w=new Map,D=Ct=new Map;D.set(y,w)}else D=Ct,w=D.get(y),w||(w=new Map,D.set(y,w));if(w.has(a))return w;for(w.set(a,null),y=y.getElementsByTagName(a),D=0;D<y.length;D++){var B=y[D];if(!(B[Vs]||B[Lt]||a==="link"&&B.getAttribute("rel")==="stylesheet")&&B.namespaceURI!=="http://www.w3.org/2000/svg"){var Q=B.getAttribute(h)||"";Q=a+Q;var he=w.get(Q);he?he.push(B):w.set(Q,[B])}}return w}function Ft(a,h,y){a=a.ownerDocument||a,a.head.insertBefore(y,h==="title"?a.querySelector("head > title"):null)}function Zt(a,h,y){if(y===1||h.itemProp!=null)return!1;switch(a){case"meta":case"title":return!0;case"style":if(typeof h.precedence!="string"||typeof h.href!="string"||h.href==="")break;return!0;case"link":if(typeof h.rel!="string"||typeof h.href!="string"||h.href===""||h.onLoad||h.onError)break;switch(h.rel){case"stylesheet":return a=h.disabled,typeof h.precedence=="string"&&a==null;default:return!0}case"script":if(h.async&&typeof h.async!="function"&&typeof h.async!="symbol"&&!h.onLoad&&!h.onError&&h.src&&typeof h.src=="string")return!0}return!1}function dn(a){return!(a.type==="stylesheet"&&(a.state.loading&3)===0)}function qt(a,h,y,w){if(y.type==="stylesheet"&&(typeof w.media!="string"||matchMedia(w.media).matches!==!1)&&(y.state.loading&4)===0){if(y.instance===null){var D=ie(w.href),B=h.querySelector(re(D));if(B){h=B._p,h!==null&&typeof h=="object"&&typeof h.then=="function"&&(a.count++,a=Sn.bind(a),h.then(a,a)),y.state.loading|=4,y.instance=B,Mr(B);return}B=h.ownerDocument||h,w=oe(w),(D=Sl.get(D))&&ot(w,D),B=B.createElement("link"),Mr(B);var Q=B;Q._p=new Promise(function(he,je){Q.onload=he,Q.onerror=je}),io(B,"link",w),y.instance=B}a.stylesheets===null&&(a.stylesheets=new Map),a.stylesheets.set(y,h),(h=y.state.preload)&&(y.state.loading&3)===0&&(a.count++,y=Sn.bind(a),h.addEventListener("load",y),h.addEventListener("error",y))}}var Ut=0;function St(a,h){return a.stylesheets&&a.count===0&&mn(a,a.stylesheets),0<a.count||0<a.imgCount?function(y){var w=setTimeout(function(){if(a.stylesheets&&mn(a,a.stylesheets),a.unsuspend){var B=a.unsuspend;a.unsuspend=null,B()}},6e4+h);0<a.imgBytes&&Ut===0&&(Ut=62500*nv());var D=setTimeout(function(){if(a.waitingForImages=!1,a.count===0&&(a.stylesheets&&mn(a,a.stylesheets),a.unsuspend)){var B=a.unsuspend;a.unsuspend=null,B()}},(a.imgBytes>Ut?50:800)+h);return a.unsuspend=y,function(){a.unsuspend=null,clearTimeout(w),clearTimeout(D)}}:null}function Sn(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)mn(this,this.stylesheets);else if(this.unsuspend){var a=this.unsuspend;this.unsuspend=null,a()}}}var Pn=null;function mn(a,h){a.stylesheets=null,a.unsuspend!==null&&(a.count++,Pn=new Map,h.forEach(un,a),Pn=null,Sn.call(a))}function un(a,h){if(!(h.state.loading&4)){var y=Pn.get(a);if(y)var w=y.get(null);else{y=new Map,Pn.set(a,y);for(var D=a.querySelectorAll("link[data-precedence],style[data-precedence]"),B=0;B<D.length;B++){var Q=D[B];(Q.nodeName==="LINK"||Q.getAttribute("media")!=="not all")&&(y.set(Q.dataset.precedence,Q),w=Q)}w&&y.set(null,w)}D=h.instance,Q=D.getAttribute("data-precedence"),B=y.get(Q)||w,B===w&&y.set(null,D),y.set(Q,D),this.count++,w=Sn.bind(this),D.addEventListener("load",w),D.addEventListener("error",w),B?B.parentNode.insertBefore(D,B.nextSibling):(a=a.nodeType===9?a.head:a,a.insertBefore(D,a.firstChild)),h.state.loading|=4}}var Qn={$$typeof:qe,Provider:null,Consumer:null,_currentValue:Tt,_currentValue2:Tt,_threadCount:0};function Kr(a,h,y,w,D,B,Q,he,je){this.tag=1,this.containerInfo=a,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=$i(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=$i(0),this.hiddenUpdates=$i(null),this.identifierPrefix=w,this.onUncaughtError=D,this.onCaughtError=B,this.onRecoverableError=Q,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=je,this.incompleteTransitions=new Map}function ya(a,h,y,w,D,B,Q,he,je,dt,bt,Et){return a=new Kr(a,h,y,Q,je,dt,bt,Et,he),h=1,B===!0&&(h|=24),B=ns(3,null,null,h),a.current=B,B.stateNode=a,h=Vo(),h.refCount++,a.pooledCache=h,h.refCount++,B.memoizedState={element:w,isDehydrated:y,cache:h},cc(B),a}function us(a){return a?(a=Do,a):Do}function El(a,h,y,w,D,B){D=us(D),w.context===null?w.context=D:w.pendingContext=D,w=Au(h),w.payload={element:y},B=B===void 0?null:B,B!==null&&(w.callback=B),y=tu(a,w,h),y!==null&&(_o(y,a,h),Uc(y,a,h))}function yo(a,h){if(a=a.memoizedState,a!==null&&a.dehydrated!==null){var y=a.retryLane;a.retryLane=y!==0&&y<h?y:h}}function Da(a,h){yo(a,h),(a=a.alternate)&&yo(a,h)}function Rr(a){if(a.tag===13||a.tag===31){var h=ko(a,67108864);h!==null&&_o(h,a,67108864),Da(a,67108864)}}function za(a){if(a.tag===13||a.tag===31){var h=Fl();h=Pt(h);var y=ko(a,h);y!==null&&_o(y,a,h),Da(a,h)}}var va=!0;function cs(a,h,y,w){var D=mt.T;mt.T=null;var B=$t.p;try{$t.p=2,Ko(a,h,y,w)}finally{$t.p=B,mt.T=D}}function vo(a,h,y,w){var D=mt.T;mt.T=null;var B=$t.p;try{$t.p=8,Ko(a,h,y,w)}finally{$t.p=B,mt.T=D}}function Ko(a,h,y,w){if(va){var D=ba(w);if(D===null)_m(a,h,w,Rs,y),zh(a,w);else if(ff(D,a,h,y,w))w.stopPropagation();else if(zh(a,w),h&4&&-1<df.indexOf(a)){for(;D!==null;){var B=qr(D);if(B!==null)switch(B.tag){case 3:if(B=B.stateNode,B.current.memoizedState.isDehydrated){var Q=vn(B.pendingLanes);if(Q!==0){var he=B;for(he.pendingLanes|=2,he.entangledLanes|=2;Q;){var je=1<<31-et(Q);he.entanglements[1]|=je,Q&=~je}bc(B),(Ui&6)===0&&(Qf=$r()+500,lf(0))}}break;case 31:case 13:he=ko(B,2),he!==null&&_o(he,B,2),Sd(),Da(B,2)}if(B=ba(w),B===null&&_m(a,h,w,Rs,y),B===D)break;D=B}D!==null&&w.stopPropagation()}else _m(a,h,w,null,y)}}function ba(a){return a=Zi(a),ca(a)}var Rs=null;function ca(a){if(Rs=null,a=gs(a),a!==null){var h=g(a);if(h===null)a=null;else{var y=h.tag;if(y===13){if(a=_(h),a!==null)return a;a=null}else if(y===31){if(a=c(h),a!==null)return a;a=null}else if(y===3){if(h.stateNode.current.memoizedState.isDehydrated)return h.tag===3?h.stateNode.containerInfo:null;a=null}else h!==a&&(a=null)}}return Rs=a,null}function Oa(a){switch(a){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(fs()){case ps:return 2;case Fs:return 8;case ms:case Ke:return 32;case se:return 268435456;default:return 32}default:return 32}}var xa=!1,_r=null,Ci=null,Ls=null,Tc=new Map,Yo=new Map,Dh=[],df="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function zh(a,h){switch(a){case"focusin":case"focusout":_r=null;break;case"dragenter":case"dragleave":Ci=null;break;case"mouseover":case"mouseout":Ls=null;break;case"pointerover":case"pointerout":Tc.delete(h.pointerId);break;case"gotpointercapture":case"lostpointercapture":Yo.delete(h.pointerId)}}function Sc(a,h,y,w,D,B){return a===null||a.nativeEvent!==B?(a={blockedOn:h,domEventName:y,eventSystemFlags:w,nativeEvent:B,targetContainers:[D]},h!==null&&(h=qr(h),h!==null&&Rr(h)),a):(a.eventSystemFlags|=w,h=a.targetContainers,D!==null&&h.indexOf(D)===-1&&h.push(D),a)}function ff(a,h,y,w,D){switch(h){case"focusin":return _r=Sc(_r,a,h,y,w,D),!0;case"dragenter":return Ci=Sc(Ci,a,h,y,w,D),!0;case"mouseover":return Ls=Sc(Ls,a,h,y,w,D),!0;case"pointerover":var B=D.pointerId;return Tc.set(B,Sc(Tc.get(B)||null,a,h,y,w,D)),!0;case"gotpointercapture":return B=D.pointerId,Yo.set(B,Sc(Yo.get(B)||null,a,h,y,w,D)),!0}return!1}function Pd(a){var h=gs(a.target);if(h!==null){var y=g(h);if(y!==null){if(h=y.tag,h===13){if(h=_(y),h!==null){a.blockedOn=h,ta(a.priority,function(){za(y)});return}}else if(h===31){if(h=c(y),h!==null){a.blockedOn=h,ta(a.priority,function(){za(y)});return}}else if(h===3&&y.stateNode.current.memoizedState.isDehydrated){a.blockedOn=y.tag===3?y.stateNode.containerInfo:null;return}}}a.blockedOn=null}function hp(a){if(a.blockedOn!==null)return!1;for(var h=a.targetContainers;0<h.length;){var y=ba(a.nativeEvent);if(y===null){y=a.nativeEvent;var w=new y.constructor(y.type,y);Ll=w,y.target.dispatchEvent(w),Ll=null}else return h=qr(y),h!==null&&Rr(h),a.blockedOn=y,!1;h.shift()}return!0}function u_(a,h,y){hp(a)&&y.delete(h)}function ov(){xa=!1,_r!==null&&hp(_r)&&(_r=null),Ci!==null&&hp(Ci)&&(Ci=null),Ls!==null&&hp(Ls)&&(Ls=null),Tc.forEach(u_),Yo.forEach(u_)}function dp(a,h){a.blockedOn===h&&(a.blockedOn=null,xa||(xa=!0,i.unstable_scheduleCallback(i.unstable_NormalPriority,ov)))}var pf=null;function Mm(a){pf!==a&&(pf=a,i.unstable_scheduleCallback(i.unstable_NormalPriority,function(){pf===a&&(pf=null);for(var h=0;h<a.length;h+=3){var y=a[h],w=a[h+1],D=a[h+2];if(typeof w!="function"){if(ca(w||y)===null)continue;break}var B=qr(y);B!==null&&(a.splice(h,3),h-=3,mc(B,{pending:!0,data:D,method:y.method,action:w},w,D))}}))}function Al(a){function h(je){return dp(je,a)}_r!==null&&dp(_r,a),Ci!==null&&dp(Ci,a),Ls!==null&&dp(Ls,a),Tc.forEach(h),Yo.forEach(h);for(var y=0;y<Dh.length;y++){var w=Dh[y];w.blockedOn===a&&(w.blockedOn=null)}for(;0<Dh.length&&(y=Dh[0],y.blockedOn===null);)Pd(y),y.blockedOn===null&&Dh.shift();if(y=(a.ownerDocument||a).$$reactFormReplay,y!=null)for(w=0;w<y.length;w+=3){var D=y[w],B=y[w+1],Q=D[yn]||null;if(typeof B=="function")Q||Mm(y);else if(Q){var he=null;if(B&&B.hasAttribute("formAction")){if(D=B,Q=B[yn]||null)he=Q.formAction;else if(ca(D)!==null)continue}else he=Q.action;typeof he=="function"?y[w+1]=he:(y.splice(w,3),w-=3),Mm(y)}}}function c_(){function a(B){B.canIntercept&&B.info==="react-transition"&&B.intercept({handler:function(){return new Promise(function(Q){return D=Q})},focusReset:"manual",scroll:"manual"})}function h(){D!==null&&(D(),D=null),w||setTimeout(y,20)}function y(){if(!w&&!navigation.transition){var B=navigation.currentEntry;B&&B.url!=null&&navigation.navigate(B.url,{state:B.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var w=!1,D=null;return navigation.addEventListener("navigate",a),navigation.addEventListener("navigatesuccess",h),navigation.addEventListener("navigateerror",h),setTimeout(y,100),function(){w=!0,navigation.removeEventListener("navigate",a),navigation.removeEventListener("navigatesuccess",h),navigation.removeEventListener("navigateerror",h),D!==null&&(D(),D=null)}}}function Im(a){this._internalRoot=a}Pm.prototype.render=Im.prototype.render=function(a){var h=this._internalRoot;if(h===null)throw Error(o(409));var y=h.current,w=Fl();El(y,w,a,h,null,null)},Pm.prototype.unmount=Im.prototype.unmount=function(){var a=this._internalRoot;if(a!==null){this._internalRoot=null;var h=a.containerInfo;El(a.current,2,null,a,null,null),Sd(),h[Mn]=null}};function Pm(a){this._internalRoot=a}Pm.prototype.unstable_scheduleHydration=function(a){if(a){var h=tr();a={blockedOn:null,target:a,priority:h};for(var y=0;y<Dh.length&&h!==0&&h<Dh[y].priority;y++);Dh.splice(y,0,a),y===0&&Pd(a)}};var lv=e.version;if(lv!=="19.2.0")throw Error(o(527,lv,"19.2.0"));$t.findDOMNode=function(a){var h=a._reactInternals;if(h===void 0)throw typeof a.render=="function"?Error(o(188)):(a=Object.keys(a).join(","),Error(o(268,a)));return a=k(h),a=a!==null?j(a):null,a=a===null?null:a.stateNode,a};var vb={bundleType:0,version:"19.2.0",rendererPackageName:"react-dom",currentDispatcherRef:mt,reconcilerVersion:"19.2.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Rm=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Rm.isDisabled&&Rm.supportsFiber)try{Se=Rm.inject(vb),De=Rm}catch{}}return d_.createRoot=function(a,h){if(!d(a))throw Error(o(299));var y=!1,w="",D=_g,B=dd,Q=wy;return h!=null&&(h.unstable_strictMode===!0&&(y=!0),h.identifierPrefix!==void 0&&(w=h.identifierPrefix),h.onUncaughtError!==void 0&&(D=h.onUncaughtError),h.onCaughtError!==void 0&&(B=h.onCaughtError),h.onRecoverableError!==void 0&&(Q=h.onRecoverableError)),h=ya(a,1,!1,null,null,y,w,null,D,B,Q,c_),a[Mn]=h.current,Ad(a),new Im(h)},d_.hydrateRoot=function(a,h,y){if(!d(a))throw Error(o(299));var w=!1,D="",B=_g,Q=dd,he=wy,je=null;return y!=null&&(y.unstable_strictMode===!0&&(w=!0),y.identifierPrefix!==void 0&&(D=y.identifierPrefix),y.onUncaughtError!==void 0&&(B=y.onUncaughtError),y.onCaughtError!==void 0&&(Q=y.onCaughtError),y.onRecoverableError!==void 0&&(he=y.onRecoverableError),y.formState!==void 0&&(je=y.formState)),h=ya(a,1,!0,h,y??null,w,D,je,B,Q,he,c_),h.context=us(null),y=h.current,w=Fl(),w=Pt(w),D=Au(w),D.callback=null,tu(y,D,w),y=w,h.current.lanes=y,er(h,y),bc(h),a[Mn]=h.current,Ad(a),new Pm(h)},d_.version="19.2.0",d_}var Xw;function pI(){if(Xw)return wb.exports;Xw=1;function i(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(i)}catch(e){console.error(e)}}return i(),wb.exports=fI(),wb.exports}var mI=pI();const gI=iy(mI);/**
 * react-router v7.9.6
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var Ww="popstate";function _I(i={}){function e(o,d){let{pathname:g,search:_,hash:c}=o.location;return ax("",{pathname:g,search:_,hash:c},d.state&&d.state.usr||null,d.state&&d.state.key||"default")}function n(o,d){return typeof d=="string"?d:z_(d)}return vI(e,n,null,i)}function Ba(i,e){if(i===!1||i===null||typeof i>"u")throw new Error(e)}function oh(i,e){if(!i){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function yI(){return Math.random().toString(36).substring(2,10)}function Kw(i,e){return{usr:i.state,key:i.key,idx:e}}function ax(i,e,n=null,o){return{pathname:typeof i=="string"?i:i.pathname,search:"",hash:"",...typeof e=="string"?tg(e):e,state:n,key:e&&e.key||o||yI()}}function z_({pathname:i="/",search:e="",hash:n=""}){return e&&e!=="?"&&(i+=e.charAt(0)==="?"?e:"?"+e),n&&n!=="#"&&(i+=n.charAt(0)==="#"?n:"#"+n),i}function tg(i){let e={};if(i){let n=i.indexOf("#");n>=0&&(e.hash=i.substring(n),i=i.substring(0,n));let o=i.indexOf("?");o>=0&&(e.search=i.substring(o),i=i.substring(0,o)),i&&(e.pathname=i)}return e}function vI(i,e,n,o={}){let{window:d=document.defaultView,v5Compat:g=!1}=o,_=d.history,c="POP",M=null,k=j();k==null&&(k=0,_.replaceState({..._.state,idx:k},""));function j(){return(_.state||{idx:null}).idx}function G(){c="POP";let Ne=j(),tt=Ne==null?null:Ne-k;k=Ne,M&&M({action:c,location:be.location,delta:tt})}function ee(Ne,tt){c="PUSH";let Je=ax(be.location,Ne,tt);k=j()+1;let qe=Kw(Je,k),He=be.createHref(Je);try{_.pushState(qe,"",He)}catch(Ue){if(Ue instanceof DOMException&&Ue.name==="DataCloneError")throw Ue;d.location.assign(He)}g&&M&&M({action:c,location:be.location,delta:1})}function Y(Ne,tt){c="REPLACE";let Je=ax(be.location,Ne,tt);k=j();let qe=Kw(Je,k),He=be.createHref(Je);_.replaceState(qe,"",He),g&&M&&M({action:c,location:be.location,delta:0})}function xe(Ne){return bI(Ne)}let be={get action(){return c},get location(){return i(d,_)},listen(Ne){if(M)throw new Error("A history only accepts one active listener");return d.addEventListener(Ww,G),M=Ne,()=>{d.removeEventListener(Ww,G),M=null}},createHref(Ne){return e(d,Ne)},createURL:xe,encodeLocation(Ne){let tt=xe(Ne);return{pathname:tt.pathname,search:tt.search,hash:tt.hash}},push:ee,replace:Y,go(Ne){return _.go(Ne)}};return be}function bI(i,e=!1){let n="http://localhost";typeof window<"u"&&(n=window.location.origin!=="null"?window.location.origin:window.location.href),Ba(n,"No window.location.(origin|href) available to create URL");let o=typeof i=="string"?i:z_(i);return o=o.replace(/ $/,"%20"),!e&&o.startsWith("//")&&(o=n+o),new URL(o,n)}function ZS(i,e,n="/"){return xI(i,e,n,!1)}function xI(i,e,n,o){let d=typeof e=="string"?tg(e):e,g=zd(d.pathname||"/",n);if(g==null)return null;let _=HS(i);wI(_);let c=null;for(let M=0;c==null&&M<_.length;++M){let k=kI(g);c=RI(_[M],k,o)}return c}function HS(i,e=[],n=[],o="",d=!1){let g=(_,c,M=d,k)=>{let j={relativePath:k===void 0?_.path||"":k,caseSensitive:_.caseSensitive===!0,childrenIndex:c,route:_};if(j.relativePath.startsWith("/")){if(!j.relativePath.startsWith(o)&&M)return;Ba(j.relativePath.startsWith(o),`Absolute route path "${j.relativePath}" nested under path "${o}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),j.relativePath=j.relativePath.slice(o.length)}let G=Rd([o,j.relativePath]),ee=n.concat(j);_.children&&_.children.length>0&&(Ba(_.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${G}".`),HS(_.children,e,ee,G,M)),!(_.path==null&&!_.index)&&e.push({path:G,score:II(G,_.index),routesMeta:ee})};return i.forEach((_,c)=>{var M;if(_.path===""||!((M=_.path)!=null&&M.includes("?")))g(_,c);else for(let k of XS(_.path))g(_,c,!0,k)}),e}function XS(i){let e=i.split("/");if(e.length===0)return[];let[n,...o]=e,d=n.endsWith("?"),g=n.replace(/\?$/,"");if(o.length===0)return d?[g,""]:[g];let _=XS(o.join("/")),c=[];return c.push(..._.map(M=>M===""?g:[g,M].join("/"))),d&&c.push(..._),c.map(M=>i.startsWith("/")&&M===""?"/":M)}function wI(i){i.sort((e,n)=>e.score!==n.score?n.score-e.score:PI(e.routesMeta.map(o=>o.childrenIndex),n.routesMeta.map(o=>o.childrenIndex)))}var TI=/^:[\w-]+$/,SI=3,EI=2,AI=1,CI=10,MI=-2,Yw=i=>i==="*";function II(i,e){let n=i.split("/"),o=n.length;return n.some(Yw)&&(o+=MI),e&&(o+=EI),n.filter(d=>!Yw(d)).reduce((d,g)=>d+(TI.test(g)?SI:g===""?AI:CI),o)}function PI(i,e){return i.length===e.length&&i.slice(0,-1).every((o,d)=>o===e[d])?i[i.length-1]-e[e.length-1]:0}function RI(i,e,n=!1){let{routesMeta:o}=i,d={},g="/",_=[];for(let c=0;c<o.length;++c){let M=o[c],k=c===o.length-1,j=g==="/"?e:e.slice(g.length)||"/",G=Kv({path:M.relativePath,caseSensitive:M.caseSensitive,end:k},j),ee=M.route;if(!G&&k&&n&&!o[o.length-1].route.index&&(G=Kv({path:M.relativePath,caseSensitive:M.caseSensitive,end:!1},j)),!G)return null;Object.assign(d,G.params),_.push({params:d,pathname:Rd([g,G.pathname]),pathnameBase:BI(Rd([g,G.pathnameBase])),route:ee}),G.pathnameBase!=="/"&&(g=Rd([g,G.pathnameBase]))}return _}function Kv(i,e){typeof i=="string"&&(i={path:i,caseSensitive:!1,end:!0});let[n,o]=LI(i.path,i.caseSensitive,i.end),d=e.match(n);if(!d)return null;let g=d[0],_=g.replace(/(.)\/+$/,"$1"),c=d.slice(1);return{params:o.reduce((k,{paramName:j,isOptional:G},ee)=>{if(j==="*"){let xe=c[ee]||"";_=g.slice(0,g.length-xe.length).replace(/(.)\/+$/,"$1")}const Y=c[ee];return G&&!Y?k[j]=void 0:k[j]=(Y||"").replace(/%2F/g,"/"),k},{}),pathname:g,pathnameBase:_,pattern:i}}function LI(i,e=!1,n=!0){oh(i==="*"||!i.endsWith("*")||i.endsWith("/*"),`Route path "${i}" will be treated as if it were "${i.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${i.replace(/\*$/,"/*")}".`);let o=[],d="^"+i.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(_,c,M)=>(o.push({paramName:c,isOptional:M!=null}),M?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return i.endsWith("*")?(o.push({paramName:"*"}),d+=i==="*"||i==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?d+="\\/*$":i!==""&&i!=="/"&&(d+="(?:(?=\\/|$))"),[new RegExp(d,e?void 0:"i"),o]}function kI(i){try{return i.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return oh(!1,`The URL path "${i}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),i}}function zd(i,e){if(e==="/")return i;if(!i.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,o=i.charAt(n);return o&&o!=="/"?null:i.slice(n)||"/"}var DI=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,zI=i=>DI.test(i);function OI(i,e="/"){let{pathname:n,search:o="",hash:d=""}=typeof i=="string"?tg(i):i,g;if(n)if(zI(n))g=n;else{if(n.includes("//")){let _=n;n=n.replace(/\/\/+/g,"/"),oh(!1,`Pathnames cannot have embedded double slashes - normalizing ${_} -> ${n}`)}n.startsWith("/")?g=Qw(n.substring(1),"/"):g=Qw(n,e)}else g=e;return{pathname:g,search:FI(o),hash:VI(d)}}function Qw(i,e){let n=e.replace(/\/+$/,"").split("/");return i.split("/").forEach(d=>{d===".."?n.length>1&&n.pop():d!=="."&&n.push(d)}),n.length>1?n.join("/"):"/"}function Ab(i,e,n,o){return`Cannot include a '${i}' character in a manually specified \`to.${e}\` field [${JSON.stringify(o)}].  Please separate it out to the \`to.${n}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function NI(i){return i.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function WS(i){let e=NI(i);return e.map((n,o)=>o===e.length-1?n.pathname:n.pathnameBase)}function KS(i,e,n,o=!1){let d;typeof i=="string"?d=tg(i):(d={...i},Ba(!d.pathname||!d.pathname.includes("?"),Ab("?","pathname","search",d)),Ba(!d.pathname||!d.pathname.includes("#"),Ab("#","pathname","hash",d)),Ba(!d.search||!d.search.includes("#"),Ab("#","search","hash",d)));let g=i===""||d.pathname==="",_=g?"/":d.pathname,c;if(_==null)c=n;else{let G=e.length-1;if(!o&&_.startsWith("..")){let ee=_.split("/");for(;ee[0]==="..";)ee.shift(),G-=1;d.pathname=ee.join("/")}c=G>=0?e[G]:"/"}let M=OI(d,c),k=_&&_!=="/"&&_.endsWith("/"),j=(g||_===".")&&n.endsWith("/");return!M.pathname.endsWith("/")&&(k||j)&&(M.pathname+="/"),M}var Rd=i=>i.join("/").replace(/\/\/+/g,"/"),BI=i=>i.replace(/\/+$/,"").replace(/^\/*/,"/"),FI=i=>!i||i==="?"?"":i.startsWith("?")?i:"?"+i,VI=i=>!i||i==="#"?"":i.startsWith("#")?i:"#"+i;function jI(i){return i!=null&&typeof i.status=="number"&&typeof i.statusText=="string"&&typeof i.internal=="boolean"&&"data"in i}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var YS=["POST","PUT","PATCH","DELETE"];new Set(YS);var UI=["GET",...YS];new Set(UI);var ng=wt.createContext(null);ng.displayName="DataRouter";var T0=wt.createContext(null);T0.displayName="DataRouterState";wt.createContext(!1);var QS=wt.createContext({isTransitioning:!1});QS.displayName="ViewTransition";var $I=wt.createContext(new Map);$I.displayName="Fetchers";var qI=wt.createContext(null);qI.displayName="Await";var Kh=wt.createContext(null);Kh.displayName="Navigation";var ry=wt.createContext(null);ry.displayName="Location";var Vd=wt.createContext({outlet:null,matches:[],isDataRoute:!1});Vd.displayName="Route";var o1=wt.createContext(null);o1.displayName="RouteError";function GI(i,{relative:e}={}){Ba(ay(),"useHref() may be used only in the context of a <Router> component.");let{basename:n,navigator:o}=wt.useContext(Kh),{hash:d,pathname:g,search:_}=sy(i,{relative:e}),c=g;return n!=="/"&&(c=g==="/"?n:Rd([n,g])),o.createHref({pathname:c,search:_,hash:d})}function ay(){return wt.useContext(ry)!=null}function Fp(){return Ba(ay(),"useLocation() may be used only in the context of a <Router> component."),wt.useContext(ry).location}var JS="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function eE(i){wt.useContext(Kh).static||wt.useLayoutEffect(i)}function ZI(){let{isDataRoute:i}=wt.useContext(Vd);return i?aP():HI()}function HI(){Ba(ay(),"useNavigate() may be used only in the context of a <Router> component.");let i=wt.useContext(ng),{basename:e,navigator:n}=wt.useContext(Kh),{matches:o}=wt.useContext(Vd),{pathname:d}=Fp(),g=JSON.stringify(WS(o)),_=wt.useRef(!1);return eE(()=>{_.current=!0}),wt.useCallback((M,k={})=>{if(oh(_.current,JS),!_.current)return;if(typeof M=="number"){n.go(M);return}let j=KS(M,JSON.parse(g),d,k.relative==="path");i==null&&e!=="/"&&(j.pathname=j.pathname==="/"?e:Rd([e,j.pathname])),(k.replace?n.replace:n.push)(j,k.state,k)},[e,n,g,d,i])}wt.createContext(null);function sy(i,{relative:e}={}){let{matches:n}=wt.useContext(Vd),{pathname:o}=Fp(),d=JSON.stringify(WS(n));return wt.useMemo(()=>KS(i,JSON.parse(d),o,e==="path"),[i,d,o,e])}function XI(i,e){return tE(i,e)}function tE(i,e,n,o,d){var Je;Ba(ay(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:g}=wt.useContext(Kh),{matches:_}=wt.useContext(Vd),c=_[_.length-1],M=c?c.params:{},k=c?c.pathname:"/",j=c?c.pathnameBase:"/",G=c&&c.route;{let qe=G&&G.path||"";nE(k,!G||qe.endsWith("*")||qe.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${k}" (under <Route path="${qe}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${qe}"> to <Route path="${qe==="/"?"*":`${qe}/*`}">.`)}let ee=Fp(),Y;if(e){let qe=typeof e=="string"?tg(e):e;Ba(j==="/"||((Je=qe.pathname)==null?void 0:Je.startsWith(j)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${j}" but pathname "${qe.pathname}" was given in the \`location\` prop.`),Y=qe}else Y=ee;let xe=Y.pathname||"/",be=xe;if(j!=="/"){let qe=j.replace(/^\//,"").split("/");be="/"+xe.replace(/^\//,"").split("/").slice(qe.length).join("/")}let Ne=ZS(i,{pathname:be});oh(G||Ne!=null,`No routes matched location "${Y.pathname}${Y.search}${Y.hash}" `),oh(Ne==null||Ne[Ne.length-1].route.element!==void 0||Ne[Ne.length-1].route.Component!==void 0||Ne[Ne.length-1].route.lazy!==void 0,`Matched leaf route at location "${Y.pathname}${Y.search}${Y.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let tt=JI(Ne&&Ne.map(qe=>Object.assign({},qe,{params:Object.assign({},M,qe.params),pathname:Rd([j,g.encodeLocation?g.encodeLocation(qe.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:qe.pathname]),pathnameBase:qe.pathnameBase==="/"?j:Rd([j,g.encodeLocation?g.encodeLocation(qe.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:qe.pathnameBase])})),_,n,o,d);return e&&tt?wt.createElement(ry.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...Y},navigationType:"POP"}},tt):tt}function WI(){let i=rP(),e=jI(i)?`${i.status} ${i.statusText}`:i instanceof Error?i.message:JSON.stringify(i),n=i instanceof Error?i.stack:null,o="rgba(200,200,200, 0.5)",d={padding:"0.5rem",backgroundColor:o},g={padding:"2px 4px",backgroundColor:o},_=null;return console.error("Error handled by React Router default ErrorBoundary:",i),_=wt.createElement(wt.Fragment,null,wt.createElement("p",null," Hey developer "),wt.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",wt.createElement("code",{style:g},"ErrorBoundary")," or"," ",wt.createElement("code",{style:g},"errorElement")," prop on your route.")),wt.createElement(wt.Fragment,null,wt.createElement("h2",null,"Unexpected Application Error!"),wt.createElement("h3",{style:{fontStyle:"italic"}},e),n?wt.createElement("pre",{style:d},n):null,_)}var KI=wt.createElement(WI,null),YI=class extends wt.Component{constructor(i){super(i),this.state={location:i.location,revalidation:i.revalidation,error:i.error}}static getDerivedStateFromError(i){return{error:i}}static getDerivedStateFromProps(i,e){return e.location!==i.location||e.revalidation!=="idle"&&i.revalidation==="idle"?{error:i.error,location:i.location,revalidation:i.revalidation}:{error:i.error!==void 0?i.error:e.error,location:e.location,revalidation:i.revalidation||e.revalidation}}componentDidCatch(i,e){this.props.onError?this.props.onError(i,e):console.error("React Router caught the following error during render",i)}render(){return this.state.error!==void 0?wt.createElement(Vd.Provider,{value:this.props.routeContext},wt.createElement(o1.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function QI({routeContext:i,match:e,children:n}){let o=wt.useContext(ng);return o&&o.static&&o.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(o.staticContext._deepestRenderedBoundaryId=e.route.id),wt.createElement(Vd.Provider,{value:i},n)}function JI(i,e=[],n=null,o=null,d=null){if(i==null){if(!n)return null;if(n.errors)i=n.matches;else if(e.length===0&&!n.initialized&&n.matches.length>0)i=n.matches;else return null}let g=i,_=n==null?void 0:n.errors;if(_!=null){let j=g.findIndex(G=>G.route.id&&(_==null?void 0:_[G.route.id])!==void 0);Ba(j>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(_).join(",")}`),g=g.slice(0,Math.min(g.length,j+1))}let c=!1,M=-1;if(n)for(let j=0;j<g.length;j++){let G=g[j];if((G.route.HydrateFallback||G.route.hydrateFallbackElement)&&(M=j),G.route.id){let{loaderData:ee,errors:Y}=n,xe=G.route.loader&&!ee.hasOwnProperty(G.route.id)&&(!Y||Y[G.route.id]===void 0);if(G.route.lazy||xe){c=!0,M>=0?g=g.slice(0,M+1):g=[g[0]];break}}}let k=n&&o?(j,G)=>{var ee,Y;o(j,{location:n.location,params:((Y=(ee=n.matches)==null?void 0:ee[0])==null?void 0:Y.params)??{},errorInfo:G})}:void 0;return g.reduceRight((j,G,ee)=>{let Y,xe=!1,be=null,Ne=null;n&&(Y=_&&G.route.id?_[G.route.id]:void 0,be=G.route.errorElement||KI,c&&(M<0&&ee===0?(nE("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),xe=!0,Ne=null):M===ee&&(xe=!0,Ne=G.route.hydrateFallbackElement||null)));let tt=e.concat(g.slice(0,ee+1)),Je=()=>{let qe;return Y?qe=be:xe?qe=Ne:G.route.Component?qe=wt.createElement(G.route.Component,null):G.route.element?qe=G.route.element:qe=j,wt.createElement(QI,{match:G,routeContext:{outlet:j,matches:tt,isDataRoute:n!=null},children:qe})};return n&&(G.route.ErrorBoundary||G.route.errorElement||ee===0)?wt.createElement(YI,{location:n.location,revalidation:n.revalidation,component:be,error:Y,children:Je(),routeContext:{outlet:null,matches:tt,isDataRoute:!0},onError:k}):Je()},null)}function l1(i){return`${i} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function eP(i){let e=wt.useContext(ng);return Ba(e,l1(i)),e}function tP(i){let e=wt.useContext(T0);return Ba(e,l1(i)),e}function nP(i){let e=wt.useContext(Vd);return Ba(e,l1(i)),e}function u1(i){let e=nP(i),n=e.matches[e.matches.length-1];return Ba(n.route.id,`${i} can only be used on routes that contain a unique "id"`),n.route.id}function iP(){return u1("useRouteId")}function rP(){var o;let i=wt.useContext(o1),e=tP("useRouteError"),n=u1("useRouteError");return i!==void 0?i:(o=e.errors)==null?void 0:o[n]}function aP(){let{router:i}=eP("useNavigate"),e=u1("useNavigate"),n=wt.useRef(!1);return eE(()=>{n.current=!0}),wt.useCallback(async(d,g={})=>{oh(n.current,JS),n.current&&(typeof d=="number"?i.navigate(d):await i.navigate(d,{fromRouteId:e,...g}))},[i,e])}var Jw={};function nE(i,e,n){!e&&!Jw[i]&&(Jw[i]=!0,oh(!1,n))}wt.memo(sP);function sP({routes:i,future:e,state:n,unstable_onError:o}){return tE(i,void 0,n,o,e)}function mp(i){Ba(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function oP({basename:i="/",children:e=null,location:n,navigationType:o="POP",navigator:d,static:g=!1}){Ba(!ay(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let _=i.replace(/^\/*/,"/"),c=wt.useMemo(()=>({basename:_,navigator:d,static:g,future:{}}),[_,d,g]);typeof n=="string"&&(n=tg(n));let{pathname:M="/",search:k="",hash:j="",state:G=null,key:ee="default"}=n,Y=wt.useMemo(()=>{let xe=zd(M,_);return xe==null?null:{location:{pathname:xe,search:k,hash:j,state:G,key:ee},navigationType:o}},[_,M,k,j,G,ee,o]);return oh(Y!=null,`<Router basename="${_}"> is not able to match the URL "${M}${k}${j}" because it does not start with the basename, so the <Router> won't render anything.`),Y==null?null:wt.createElement(Kh.Provider,{value:c},wt.createElement(ry.Provider,{children:e,value:Y}))}function lP({children:i,location:e}){return XI(sx(i),e)}function sx(i,e=[]){let n=[];return wt.Children.forEach(i,(o,d)=>{if(!wt.isValidElement(o))return;let g=[...e,d];if(o.type===wt.Fragment){n.push.apply(n,sx(o.props.children,g));return}Ba(o.type===mp,`[${typeof o.type=="string"?o.type:o.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),Ba(!o.props.index||!o.props.children,"An index route cannot have child routes.");let _={id:o.props.id||g.join("-"),caseSensitive:o.props.caseSensitive,element:o.props.element,Component:o.props.Component,index:o.props.index,path:o.props.path,middleware:o.props.middleware,loader:o.props.loader,action:o.props.action,hydrateFallbackElement:o.props.hydrateFallbackElement,HydrateFallback:o.props.HydrateFallback,errorElement:o.props.errorElement,ErrorBoundary:o.props.ErrorBoundary,hasErrorBoundary:o.props.hasErrorBoundary===!0||o.props.ErrorBoundary!=null||o.props.errorElement!=null,shouldRevalidate:o.props.shouldRevalidate,handle:o.props.handle,lazy:o.props.lazy};o.props.children&&(_.children=sx(o.props.children,g)),n.push(_)}),n}var Ev="get",Av="application/x-www-form-urlencoded";function S0(i){return i!=null&&typeof i.tagName=="string"}function uP(i){return S0(i)&&i.tagName.toLowerCase()==="button"}function cP(i){return S0(i)&&i.tagName.toLowerCase()==="form"}function hP(i){return S0(i)&&i.tagName.toLowerCase()==="input"}function dP(i){return!!(i.metaKey||i.altKey||i.ctrlKey||i.shiftKey)}function fP(i,e){return i.button===0&&(!e||e==="_self")&&!dP(i)}var uv=null;function pP(){if(uv===null)try{new FormData(document.createElement("form"),0),uv=!1}catch{uv=!0}return uv}var mP=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function Cb(i){return i!=null&&!mP.has(i)?(oh(!1,`"${i}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${Av}"`),null):i}function gP(i,e){let n,o,d,g,_;if(cP(i)){let c=i.getAttribute("action");o=c?zd(c,e):null,n=i.getAttribute("method")||Ev,d=Cb(i.getAttribute("enctype"))||Av,g=new FormData(i)}else if(uP(i)||hP(i)&&(i.type==="submit"||i.type==="image")){let c=i.form;if(c==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let M=i.getAttribute("formaction")||c.getAttribute("action");if(o=M?zd(M,e):null,n=i.getAttribute("formmethod")||c.getAttribute("method")||Ev,d=Cb(i.getAttribute("formenctype"))||Cb(c.getAttribute("enctype"))||Av,g=new FormData(c,i),!pP()){let{name:k,type:j,value:G}=i;if(j==="image"){let ee=k?`${k}.`:"";g.append(`${ee}x`,"0"),g.append(`${ee}y`,"0")}else k&&g.append(k,G)}}else{if(S0(i))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');n=Ev,o=null,d=Av,_=i}return g&&d==="text/plain"&&(_=g,g=void 0),{action:o,method:n.toLowerCase(),encType:d,formData:g,body:_}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function c1(i,e){if(i===!1||i===null||typeof i>"u")throw new Error(e)}function _P(i,e,n){let o=typeof i=="string"?new URL(i,typeof window>"u"?"server://singlefetch/":window.location.origin):i;return o.pathname==="/"?o.pathname=`_root.${n}`:e&&zd(o.pathname,e)==="/"?o.pathname=`${e.replace(/\/$/,"")}/_root.${n}`:o.pathname=`${o.pathname.replace(/\/$/,"")}.${n}`,o}async function yP(i,e){if(i.id in e)return e[i.id];try{let n=await import(i.module);return e[i.id]=n,n}catch(n){return console.error(`Error loading route module \`${i.module}\`, reloading page...`),console.error(n),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function vP(i){return i==null?!1:i.href==null?i.rel==="preload"&&typeof i.imageSrcSet=="string"&&typeof i.imageSizes=="string":typeof i.rel=="string"&&typeof i.href=="string"}async function bP(i,e,n){let o=await Promise.all(i.map(async d=>{let g=e.routes[d.route.id];if(g){let _=await yP(g,n);return _.links?_.links():[]}return[]}));return SP(o.flat(1).filter(vP).filter(d=>d.rel==="stylesheet"||d.rel==="preload").map(d=>d.rel==="stylesheet"?{...d,rel:"prefetch",as:"style"}:{...d,rel:"prefetch"}))}function e2(i,e,n,o,d,g){let _=(M,k)=>n[k]?M.route.id!==n[k].route.id:!0,c=(M,k)=>{var j;return n[k].pathname!==M.pathname||((j=n[k].route.path)==null?void 0:j.endsWith("*"))&&n[k].params["*"]!==M.params["*"]};return g==="assets"?e.filter((M,k)=>_(M,k)||c(M,k)):g==="data"?e.filter((M,k)=>{var G;let j=o.routes[M.route.id];if(!j||!j.hasLoader)return!1;if(_(M,k)||c(M,k))return!0;if(M.route.shouldRevalidate){let ee=M.route.shouldRevalidate({currentUrl:new URL(d.pathname+d.search+d.hash,window.origin),currentParams:((G=n[0])==null?void 0:G.params)||{},nextUrl:new URL(i,window.origin),nextParams:M.params,defaultShouldRevalidate:!0});if(typeof ee=="boolean")return ee}return!0}):[]}function xP(i,e,{includeHydrateFallback:n}={}){return wP(i.map(o=>{let d=e.routes[o.route.id];if(!d)return[];let g=[d.module];return d.clientActionModule&&(g=g.concat(d.clientActionModule)),d.clientLoaderModule&&(g=g.concat(d.clientLoaderModule)),n&&d.hydrateFallbackModule&&(g=g.concat(d.hydrateFallbackModule)),d.imports&&(g=g.concat(d.imports)),g}).flat(1))}function wP(i){return[...new Set(i)]}function TP(i){let e={},n=Object.keys(i).sort();for(let o of n)e[o]=i[o];return e}function SP(i,e){let n=new Set;return new Set(e),i.reduce((o,d)=>{let g=JSON.stringify(TP(d));return n.has(g)||(n.add(g),o.push({key:g,link:d})),o},[])}function iE(){let i=wt.useContext(ng);return c1(i,"You must render this element inside a <DataRouterContext.Provider> element"),i}function EP(){let i=wt.useContext(T0);return c1(i,"You must render this element inside a <DataRouterStateContext.Provider> element"),i}var h1=wt.createContext(void 0);h1.displayName="FrameworkContext";function rE(){let i=wt.useContext(h1);return c1(i,"You must render this element inside a <HydratedRouter> element"),i}function AP(i,e){let n=wt.useContext(h1),[o,d]=wt.useState(!1),[g,_]=wt.useState(!1),{onFocus:c,onBlur:M,onMouseEnter:k,onMouseLeave:j,onTouchStart:G}=e,ee=wt.useRef(null);wt.useEffect(()=>{if(i==="render"&&_(!0),i==="viewport"){let be=tt=>{tt.forEach(Je=>{_(Je.isIntersecting)})},Ne=new IntersectionObserver(be,{threshold:.5});return ee.current&&Ne.observe(ee.current),()=>{Ne.disconnect()}}},[i]),wt.useEffect(()=>{if(o){let be=setTimeout(()=>{_(!0)},100);return()=>{clearTimeout(be)}}},[o]);let Y=()=>{d(!0)},xe=()=>{d(!1),_(!1)};return n?i!=="intent"?[g,ee,{}]:[g,ee,{onFocus:f_(c,Y),onBlur:f_(M,xe),onMouseEnter:f_(k,Y),onMouseLeave:f_(j,xe),onTouchStart:f_(G,Y)}]:[!1,ee,{}]}function f_(i,e){return n=>{i&&i(n),n.defaultPrevented||e(n)}}function CP({page:i,...e}){let{router:n}=iE(),o=wt.useMemo(()=>ZS(n.routes,i,n.basename),[n.routes,i,n.basename]);return o?wt.createElement(IP,{page:i,matches:o,...e}):null}function MP(i){let{manifest:e,routeModules:n}=rE(),[o,d]=wt.useState([]);return wt.useEffect(()=>{let g=!1;return bP(i,e,n).then(_=>{g||d(_)}),()=>{g=!0}},[i,e,n]),o}function IP({page:i,matches:e,...n}){let o=Fp(),{manifest:d,routeModules:g}=rE(),{basename:_}=iE(),{loaderData:c,matches:M}=EP(),k=wt.useMemo(()=>e2(i,e,M,d,o,"data"),[i,e,M,d,o]),j=wt.useMemo(()=>e2(i,e,M,d,o,"assets"),[i,e,M,d,o]),G=wt.useMemo(()=>{if(i===o.pathname+o.search+o.hash)return[];let xe=new Set,be=!1;if(e.forEach(tt=>{var qe;let Je=d.routes[tt.route.id];!Je||!Je.hasLoader||(!k.some(He=>He.route.id===tt.route.id)&&tt.route.id in c&&((qe=g[tt.route.id])!=null&&qe.shouldRevalidate)||Je.hasClientLoader?be=!0:xe.add(tt.route.id))}),xe.size===0)return[];let Ne=_P(i,_,"data");return be&&xe.size>0&&Ne.searchParams.set("_routes",e.filter(tt=>xe.has(tt.route.id)).map(tt=>tt.route.id).join(",")),[Ne.pathname+Ne.search]},[_,c,o,d,k,e,i,g]),ee=wt.useMemo(()=>xP(j,d),[j,d]),Y=MP(j);return wt.createElement(wt.Fragment,null,G.map(xe=>wt.createElement("link",{key:xe,rel:"prefetch",as:"fetch",href:xe,...n})),ee.map(xe=>wt.createElement("link",{key:xe,rel:"modulepreload",href:xe,...n})),Y.map(({key:xe,link:be})=>wt.createElement("link",{key:xe,nonce:n.nonce,...be})))}function PP(...i){return e=>{i.forEach(n=>{typeof n=="function"?n(e):n!=null&&(n.current=e)})}}var aE=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{aE&&(window.__reactRouterVersion="7.9.6")}catch{}function RP({basename:i,children:e,window:n}){let o=wt.useRef();o.current==null&&(o.current=_I({window:n,v5Compat:!0}));let d=o.current,[g,_]=wt.useState({action:d.action,location:d.location}),c=wt.useCallback(M=>{wt.startTransition(()=>_(M))},[_]);return wt.useLayoutEffect(()=>d.listen(c),[d,c]),wt.createElement(oP,{basename:i,children:e,location:g.location,navigationType:g.action,navigator:d})}var sE=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,oE=wt.forwardRef(function({onClick:e,discover:n="render",prefetch:o="none",relative:d,reloadDocument:g,replace:_,state:c,target:M,to:k,preventScrollReset:j,viewTransition:G,...ee},Y){let{basename:xe}=wt.useContext(Kh),be=typeof k=="string"&&sE.test(k),Ne,tt=!1;if(typeof k=="string"&&be&&(Ne=k,aE))try{let _e=new URL(window.location.href),Ae=k.startsWith("//")?new URL(_e.protocol+k):new URL(k),Pe=zd(Ae.pathname,xe);Ae.origin===_e.origin&&Pe!=null?k=Pe+Ae.search+Ae.hash:tt=!0}catch{oh(!1,`<Link to="${k}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let Je=GI(k,{relative:d}),[qe,He,Ue]=AP(o,ee),Be=zP(k,{replace:_,state:c,target:M,preventScrollReset:j,relative:d,viewTransition:G});function de(_e){e&&e(_e),_e.defaultPrevented||Be(_e)}let ce=wt.createElement("a",{...ee,...Ue,href:Ne||Je,onClick:tt||g?e:de,ref:PP(Y,He),target:M,"data-discover":!be&&n==="render"?"true":void 0});return qe&&!be?wt.createElement(wt.Fragment,null,ce,wt.createElement(CP,{page:Je})):ce});oE.displayName="Link";var LP=wt.forwardRef(function({"aria-current":e="page",caseSensitive:n=!1,className:o="",end:d=!1,style:g,to:_,viewTransition:c,children:M,...k},j){let G=sy(_,{relative:k.relative}),ee=Fp(),Y=wt.useContext(T0),{navigator:xe,basename:be}=wt.useContext(Kh),Ne=Y!=null&&VP(G)&&c===!0,tt=xe.encodeLocation?xe.encodeLocation(G).pathname:G.pathname,Je=ee.pathname,qe=Y&&Y.navigation&&Y.navigation.location?Y.navigation.location.pathname:null;n||(Je=Je.toLowerCase(),qe=qe?qe.toLowerCase():null,tt=tt.toLowerCase()),qe&&be&&(qe=zd(qe,be)||qe);const He=tt!=="/"&&tt.endsWith("/")?tt.length-1:tt.length;let Ue=Je===tt||!d&&Je.startsWith(tt)&&Je.charAt(He)==="/",Be=qe!=null&&(qe===tt||!d&&qe.startsWith(tt)&&qe.charAt(tt.length)==="/"),de={isActive:Ue,isPending:Be,isTransitioning:Ne},ce=Ue?e:void 0,_e;typeof o=="function"?_e=o(de):_e=[o,Ue?"active":null,Be?"pending":null,Ne?"transitioning":null].filter(Boolean).join(" ");let Ae=typeof g=="function"?g(de):g;return wt.createElement(oE,{...k,"aria-current":ce,className:_e,ref:j,style:Ae,to:_,viewTransition:c},typeof M=="function"?M(de):M)});LP.displayName="NavLink";var kP=wt.forwardRef(({discover:i="render",fetcherKey:e,navigate:n,reloadDocument:o,replace:d,state:g,method:_=Ev,action:c,onSubmit:M,relative:k,preventScrollReset:j,viewTransition:G,...ee},Y)=>{let xe=BP(),be=FP(c,{relative:k}),Ne=_.toLowerCase()==="get"?"get":"post",tt=typeof c=="string"&&sE.test(c),Je=qe=>{if(M&&M(qe),qe.defaultPrevented)return;qe.preventDefault();let He=qe.nativeEvent.submitter,Ue=(He==null?void 0:He.getAttribute("formmethod"))||_;xe(He||qe.currentTarget,{fetcherKey:e,method:Ue,navigate:n,replace:d,state:g,relative:k,preventScrollReset:j,viewTransition:G})};return wt.createElement("form",{ref:Y,method:Ne,action:be,onSubmit:o?M:Je,...ee,"data-discover":!tt&&i==="render"?"true":void 0})});kP.displayName="Form";function DP(i){return`${i} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function lE(i){let e=wt.useContext(ng);return Ba(e,DP(i)),e}function zP(i,{target:e,replace:n,state:o,preventScrollReset:d,relative:g,viewTransition:_}={}){let c=ZI(),M=Fp(),k=sy(i,{relative:g});return wt.useCallback(j=>{if(fP(j,e)){j.preventDefault();let G=n!==void 0?n:z_(M)===z_(k);c(i,{replace:G,state:o,preventScrollReset:d,relative:g,viewTransition:_})}},[M,c,k,n,o,e,i,d,g,_])}var OP=0,NP=()=>`__${String(++OP)}__`;function BP(){let{router:i}=lE("useSubmit"),{basename:e}=wt.useContext(Kh),n=iP();return wt.useCallback(async(o,d={})=>{let{action:g,method:_,encType:c,formData:M,body:k}=gP(o,e);if(d.navigate===!1){let j=d.fetcherKey||NP();await i.fetch(j,n,d.action||g,{preventScrollReset:d.preventScrollReset,formData:M,body:k,formMethod:d.method||_,formEncType:d.encType||c,flushSync:d.flushSync})}else await i.navigate(d.action||g,{preventScrollReset:d.preventScrollReset,formData:M,body:k,formMethod:d.method||_,formEncType:d.encType||c,replace:d.replace,state:d.state,fromRouteId:n,flushSync:d.flushSync,viewTransition:d.viewTransition})},[i,e,n])}function FP(i,{relative:e}={}){let{basename:n}=wt.useContext(Kh),o=wt.useContext(Vd);Ba(o,"useFormAction must be used inside a RouteContext");let[d]=o.matches.slice(-1),g={...sy(i||".",{relative:e})},_=Fp();if(i==null){g.search=_.search;let c=new URLSearchParams(g.search),M=c.getAll("index");if(M.some(j=>j==="")){c.delete("index"),M.filter(G=>G).forEach(G=>c.append("index",G));let j=c.toString();g.search=j?`?${j}`:""}}return(!i||i===".")&&d.route.index&&(g.search=g.search?g.search.replace(/^\?/,"?index&"):"?index"),n!=="/"&&(g.pathname=g.pathname==="/"?n:Rd([n,g.pathname])),z_(g)}function VP(i,{relative:e}={}){let n=wt.useContext(QS);Ba(n!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:o}=lE("useViewTransitionState"),d=sy(i,{relative:e});if(!n.isTransitioning)return!1;let g=zd(n.currentLocation.pathname,o)||n.currentLocation.pathname,_=zd(n.nextLocation.pathname,o)||n.nextLocation.pathname;return Kv(d.pathname,_)!=null||Kv(d.pathname,g)!=null}const uE=()=>{const[i,e]=wt.useState(!1),n=()=>e(!i);return Ee.jsxs(Ee.Fragment,{children:[Ee.jsx("div",{className:"scroll-indicator"}),Ee.jsx("nav",{children:Ee.jsxs("div",{className:"nav-container",children:[Ee.jsxs("a",{href:"./#home",className:"logo",children:["Red",Ee.jsx("span",{className:"highlight",children:" Report "})]}),Ee.jsx("div",{className:"hamburger",onClick:n,children:Ee.jsx("span",{className:"hamburger-icon",children:""})}),Ee.jsxs("ul",{className:`nav-links${i?" open":""}`,children:[Ee.jsx("li",{children:Ee.jsx("a",{href:"./#home",children:"Home"})}),Ee.jsx("li",{children:Ee.jsx("a",{href:"./#mission",children:"Mission"})}),Ee.jsx("li",{children:Ee.jsx("a",{href:"./#timeline",children:"Timeline"})}),Ee.jsx("li",{children:Ee.jsx("a",{href:"/report",className:"report-btn",children:"REPORT"})}),Ee.jsx("li",{children:Ee.jsx("a",{href:"/map",className:"map-btn",children:"MAP"})})]})]})})]})},jP=()=>Ee.jsx("section",{id:"home",className:"hero",children:Ee.jsxs("div",{className:"hero-container",children:[Ee.jsxs("div",{className:"hero-content",children:[Ee.jsxs("h1",{children:[Ee.jsx("span",{className:"highlight",children:"Student voices"}),Ee.jsx("br",{}),"SAFER CAMPUS"]}),Ee.jsx("p",{children:"Anonymous reporting tool built by and for students in the Notre Dame Tricampus community. Empowering students to share experiences without fear while creating meaningful change."}),Ee.jsx("a",{href:"#mission",className:"cta-button",children:"Learn more"})]}),Ee.jsx("div",{className:"hero-visual",children:Ee.jsx("div",{className:"campus-circle",children:Ee.jsx("img",{src:"/abstract.svg",alt:"Logo",className:"campus-image"})})})]})}),UP=()=>Ee.jsxs("section",{id:"mission",className:"content-section",children:[Ee.jsxs("div",{className:"section-header",children:[Ee.jsxs("h2",{children:["Our ",Ee.jsx("span",{className:"highlight",children:"Mission"})]}),Ee.jsxs("p",{children:["Existing reporting systems are intimidating to the point nothing ever gets reported. ",Ee.jsx("span",{className:"highlight",children:"RedReport"})," makes everything entirely anonymous focusing on your safety."]})]}),Ee.jsxs("div",{className:"mission-grid",children:[Ee.jsxs("div",{className:"mission-card",children:[Ee.jsx("h3",{children:"Anonymous & Safe"}),Ee.jsx("p",{children:"Report experiences without fear of retaliation. We never collect any personal identifiers, our goal is to assist you when you are still not comfortable with a full report."})]}),Ee.jsxs("div",{className:"mission-card",children:[Ee.jsx("h3",{children:"Campus Wide Access to Data"}),Ee.jsx("p",{children:"We allow anyone on campus see current campus trends. No filter, we show the reality; the good, the bad, and the ugly."})]}),Ee.jsxs("div",{className:"mission-card",children:[Ee.jsx("h3",{children:"Working to prevent"}),Ee.jsx("p",{children:"We use our data to take action and prevent future cases. We wish our product didn't need to exist, so that's the goal we are working towards."})]})]}),Ee.jsxs("div",{className:"stats-grid",children:[Ee.jsxs("div",{className:"stat-card",children:[Ee.jsx("span",{className:"stat-number",children:"100%"}),Ee.jsx("span",{className:"stat-label",children:"Anonymous"})]}),Ee.jsxs("div",{className:"stat-card",children:[Ee.jsx("span",{className:"stat-number",children:"24/7"}),Ee.jsx("span",{className:"stat-label",children:"Available"})]}),Ee.jsxs("div",{className:"stat-card",children:[Ee.jsx("span",{className:"stat-number",children:"3"}),Ee.jsx("span",{className:"stat-label",children:"Campuses"})]}),Ee.jsxs("div",{className:"stat-card",children:[Ee.jsx("span",{className:"stat-number",children:""}),Ee.jsx("span",{className:"stat-label",children:"Impact"})]})]})]}),$P=()=>Ee.jsxs("section",{id:"timeline",className:"content-section",children:[Ee.jsxs("div",{className:"section-header",children:[Ee.jsxs("h2",{children:["Our ",Ee.jsx("span",{className:"highlight",children:"Timeline"})]}),Ee.jsx("p",{children:"See how RedReport is evolving to better serve the Notre Dame Tricampus community"})]}),Ee.jsxs("div",{className:"timeline",children:[Ee.jsxs("div",{className:"timeline-item",children:[Ee.jsx("div",{className:"timeline-dot"}),Ee.jsxs("div",{className:"timeline-content",children:[Ee.jsx("h3",{children:"Phase 1: Idea phase"}),Ee.jsx("p",{children:"RedReport started coming to life in notes rough prototypes and small user tests."})]})]}),Ee.jsxs("div",{className:"timeline-item",children:[Ee.jsx("div",{className:"timeline-dot"}),Ee.jsxs("div",{className:"timeline-content",children:[Ee.jsx("h3",{children:"Phase 2: Research and Proposal"}),Ee.jsxs("p",{children:["Wrote several reports backed by in depth research receiving recognition"," ",Ee.jsx("a",{href:"https://library-research-award.library.nd.edu/2025.html",children:"Hesburgh Libraries"}),"."]})]})]}),Ee.jsxs("div",{className:"timeline-item",children:[Ee.jsx("div",{className:"timeline-dot"}),Ee.jsxs("div",{className:"timeline-content current",children:[Ee.jsx("h3",{className:"highlight",children:"Phase 3: Launch"}),Ee.jsx("p",{className:"highlight",children:"Forming a small team to start making actual change across campus. Continously updating our system to get stuff done."})]})]}),Ee.jsxs("div",{className:"timeline-item",children:[Ee.jsx("div",{className:"timeline-dot"}),Ee.jsxs("div",{className:"timeline-content",children:[Ee.jsx("h3",{children:"Phase 4: Analyze Campus Behavior & Take Action"}),Ee.jsx("p",{children:"Prepare reports, establish communication with dorms, and share insights on specific campus trends with the community."})]})]}),Ee.jsxs("div",{className:"timeline-item",children:[Ee.jsx("div",{className:"timeline-dot"}),Ee.jsxs("div",{className:"timeline-content",children:[Ee.jsx("h3",{children:"Phase 5: Expansion"}),Ee.jsx("p",{children:"Transform RedReport into a crowdsourced tool as a universal reporting system for included campus, offices ad residencial areas. Allowing individuals to review a community's in addition to their offerings."})]})]})]})]});function qP(){return Ee.jsx(Ee.Fragment,{children:Ee.jsxs("div",{className:"",children:[Ee.jsx("div",{}),Ee.jsx("div",{})]})})}const t2=()=>(wt.useEffect(()=>{const i=()=>{const g=window.pageYOffset,_=document.body.scrollHeight-window.innerHeight,c=g/_*100,M=document.querySelector(".scroll-indicator");M&&(M.style.width=c+"%")},e=()=>{document.querySelectorAll('a[href^="#"]').forEach(g=>{g.addEventListener("click",function(_){_.preventDefault();const c=document.querySelector(this.getAttribute("href"));c&&c.scrollIntoView({behavior:"smooth",block:"start"})})})},n=()=>{const g=new IntersectionObserver(_=>{_.forEach(c=>{c.isIntersecting&&c.target.classList.add("visible")})},{threshold:.1});document.querySelectorAll(".content-section").forEach(_=>{g.observe(_)})},o=()=>{const g=document.querySelector("nav");g&&window.addEventListener("scroll",()=>{window.scrollY>100?g.style.background="rgba(255, 255, 255)":g.style.background="rgba(255, 255, 255, 0.4)"})};return e(),n(),o(),window.addEventListener("scroll",i),i(),(()=>{document.querySelectorAll(".stat-card").forEach(g=>{g.addEventListener("mouseenter",()=>{g.style.transform="scale(1.05) rotate(2deg)"}),g.addEventListener("mouseleave",()=>{g.style.transform="scale(1) rotate(0deg)"})})})(),()=>{window.removeEventListener("scroll",i)}},[]),Ee.jsxs("div",{className:"landing-page",children:[Ee.jsx(uE,{}),Ee.jsx(jP,{}),Ee.jsx(UP,{}),Ee.jsx(qP,{}),Ee.jsx($P,{})]})),GP=()=>{};var n2={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cE=function(i){const e=[];let n=0;for(let o=0;o<i.length;o++){let d=i.charCodeAt(o);d<128?e[n++]=d:d<2048?(e[n++]=d>>6|192,e[n++]=d&63|128):(d&64512)===55296&&o+1<i.length&&(i.charCodeAt(o+1)&64512)===56320?(d=65536+((d&1023)<<10)+(i.charCodeAt(++o)&1023),e[n++]=d>>18|240,e[n++]=d>>12&63|128,e[n++]=d>>6&63|128,e[n++]=d&63|128):(e[n++]=d>>12|224,e[n++]=d>>6&63|128,e[n++]=d&63|128)}return e},ZP=function(i){const e=[];let n=0,o=0;for(;n<i.length;){const d=i[n++];if(d<128)e[o++]=String.fromCharCode(d);else if(d>191&&d<224){const g=i[n++];e[o++]=String.fromCharCode((d&31)<<6|g&63)}else if(d>239&&d<365){const g=i[n++],_=i[n++],c=i[n++],M=((d&7)<<18|(g&63)<<12|(_&63)<<6|c&63)-65536;e[o++]=String.fromCharCode(55296+(M>>10)),e[o++]=String.fromCharCode(56320+(M&1023))}else{const g=i[n++],_=i[n++];e[o++]=String.fromCharCode((d&15)<<12|(g&63)<<6|_&63)}}return e.join("")},d1={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(i,e){if(!Array.isArray(i))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,o=[];for(let d=0;d<i.length;d+=3){const g=i[d],_=d+1<i.length,c=_?i[d+1]:0,M=d+2<i.length,k=M?i[d+2]:0,j=g>>2,G=(g&3)<<4|c>>4;let ee=(c&15)<<2|k>>6,Y=k&63;M||(Y=64,_||(ee=64)),o.push(n[j],n[G],n[ee],n[Y])}return o.join("")},encodeString(i,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(i):this.encodeByteArray(cE(i),e)},decodeString(i,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(i):ZP(this.decodeStringToByteArray(i,e))},decodeStringToByteArray(i,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,o=[];for(let d=0;d<i.length;){const g=n[i.charAt(d++)],c=d<i.length?n[i.charAt(d)]:0;++d;const k=d<i.length?n[i.charAt(d)]:64;++d;const G=d<i.length?n[i.charAt(d)]:64;if(++d,g==null||c==null||k==null||G==null)throw new HP;const ee=g<<2|c>>4;if(o.push(ee),k!==64){const Y=c<<4&240|k>>2;if(o.push(Y),G!==64){const xe=k<<6&192|G;o.push(xe)}}}return o},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let i=0;i<this.ENCODED_VALS.length;i++)this.byteToCharMap_[i]=this.ENCODED_VALS.charAt(i),this.charToByteMap_[this.byteToCharMap_[i]]=i,this.byteToCharMapWebSafe_[i]=this.ENCODED_VALS_WEBSAFE.charAt(i),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[i]]=i,i>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(i)]=i,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(i)]=i)}}};class HP extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const XP=function(i){const e=cE(i);return d1.encodeByteArray(e,!0)},Yv=function(i){return XP(i).replace(/\./g,"")},WP=function(i){try{return d1.decodeString(i,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hE(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KP=()=>hE().__FIREBASE_DEFAULTS__,YP=()=>{if(typeof process>"u"||typeof n2>"u")return;const i=n2.__FIREBASE_DEFAULTS__;if(i)return JSON.parse(i)},QP=()=>{if(typeof document>"u")return;let i;try{i=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=i&&WP(i[1]);return e&&JSON.parse(e)},f1=()=>{try{return GP()||KP()||YP()||QP()}catch(i){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${i}`);return}},JP=i=>{var e,n;return(n=(e=f1())==null?void 0:e.emulatorHosts)==null?void 0:n[i]},eR=i=>{const e=JP(i);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const o=parseInt(e.substring(n+1),10);return e[0]==="["?[e.substring(1,n-1),o]:[e.substring(0,n),o]},dE=()=>{var i;return(i=f1())==null?void 0:i.config};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class O_{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,o)=>{n?this.reject(n):this.resolve(o),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,o))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function p1(i){try{return(i.startsWith("http://")||i.startsWith("https://")?new URL(i).hostname:i).endsWith(".cloudworkstations.dev")}catch{return!1}}async function tR(i){return(await fetch(i,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nR(i,e){if(i.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n={alg:"none",type:"JWT"},o=e||"demo-project",d=i.iat||0,g=i.sub||i.user_id;if(!g)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const _={iss:`https://securetoken.google.com/${o}`,aud:o,iat:d,exp:d+3600,auth_time:d,sub:g,user_id:g,firebase:{sign_in_provider:"custom",identities:{}},...i};return[Yv(JSON.stringify(n)),Yv(JSON.stringify(_)),""].join(".")}const E_={};function iR(){const i={prod:[],emulator:[]};for(const e of Object.keys(E_))E_[e]?i.emulator.push(e):i.prod.push(e);return i}function rR(i){let e=document.getElementById(i),n=!1;return e||(e=document.createElement("div"),e.setAttribute("id",i),n=!0),{created:n,element:e}}let i2=!1;function aR(i,e){if(typeof window>"u"||typeof document>"u"||!p1(window.location.host)||E_[i]===e||E_[i]||i2)return;E_[i]=e;function n(ee){return`__firebase__banner__${ee}`}const o="__firebase__banner",g=iR().prod.length>0;function _(){const ee=document.getElementById(o);ee&&ee.remove()}function c(ee){ee.style.display="flex",ee.style.background="#7faaf0",ee.style.position="fixed",ee.style.bottom="5px",ee.style.left="5px",ee.style.padding=".5em",ee.style.borderRadius="5px",ee.style.alignItems="center"}function M(ee,Y){ee.setAttribute("width","24"),ee.setAttribute("id",Y),ee.setAttribute("height","24"),ee.setAttribute("viewBox","0 0 24 24"),ee.setAttribute("fill","none"),ee.style.marginLeft="-6px"}function k(){const ee=document.createElement("span");return ee.style.cursor="pointer",ee.style.marginLeft="16px",ee.style.fontSize="24px",ee.innerHTML=" &times;",ee.onclick=()=>{i2=!0,_()},ee}function j(ee,Y){ee.setAttribute("id",Y),ee.innerText="Learn more",ee.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",ee.setAttribute("target","__blank"),ee.style.paddingLeft="5px",ee.style.textDecoration="underline"}function G(){const ee=rR(o),Y=n("text"),xe=document.getElementById(Y)||document.createElement("span"),be=n("learnmore"),Ne=document.getElementById(be)||document.createElement("a"),tt=n("preprendIcon"),Je=document.getElementById(tt)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(ee.created){const qe=ee.element;c(qe),j(Ne,be);const He=k();M(Je,tt),qe.append(Je,xe,Ne,He),document.body.appendChild(qe)}g?(xe.innerText="Preview backend disconnected.",Je.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(Je.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,xe.innerText="Preview backend running in this workspace."),xe.setAttribute("id",Y)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",G):G()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sR(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function oR(){var e;const i=(e=f1())==null?void 0:e.forceEnvironment;if(i==="node")return!0;if(i==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function lR(){const i=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof i=="object"&&i.id!==void 0}function uR(){return!oR()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function E0(){try{return typeof indexedDB=="object"}catch{return!1}}function fE(){return new Promise((i,e)=>{try{let n=!0;const o="validate-browser-context-for-indexeddb-analytics-module",d=self.indexedDB.open(o);d.onsuccess=()=>{d.result.close(),n||self.indexedDB.deleteDatabase(o),i(!0)},d.onupgradeneeded=()=>{n=!1},d.onerror=()=>{var g;e(((g=d.error)==null?void 0:g.message)||"")}}catch(n){e(n)}})}function cR(){return!(typeof navigator>"u"||!navigator.cookieEnabled)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hR="FirebaseError";class kf extends Error{constructor(e,n,o){super(n),this.code=e,this.customData=o,this.name=hR,Object.setPrototypeOf(this,kf.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,oy.prototype.create)}}class oy{constructor(e,n,o){this.service=e,this.serviceName=n,this.errors=o}create(e,...n){const o=n[0]||{},d=`${this.service}/${e}`,g=this.errors[e],_=g?dR(g,o):"Error",c=`${this.serviceName}: ${_} (${d}).`;return new kf(d,c,o)}}function dR(i,e){return i.replace(fR,(n,o)=>{const d=e[o];return d!=null?String(d):`<${o}?>`})}const fR=/\{\$([^}]+)}/g;function N_(i,e){if(i===e)return!0;const n=Object.keys(i),o=Object.keys(e);for(const d of n){if(!o.includes(d))return!1;const g=i[d],_=e[d];if(r2(g)&&r2(_)){if(!N_(g,_))return!1}else if(g!==_)return!1}for(const d of o)if(!n.includes(d))return!1;return!0}function r2(i){return i!==null&&typeof i=="object"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pR=1e3,mR=2,gR=14400*1e3,_R=.5;function ox(i,e=pR,n=mR){const o=e*Math.pow(n,i),d=Math.round(_R*o*(Math.random()-.5)*2);return Math.min(gR,o+d)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hh(i){return i&&i._delegate?i._delegate:i}class lh{constructor(e,n,o){this.name=e,this.instanceFactory=n,this.type=o,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gp="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yR{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const o=new O_;if(this.instancesDeferred.set(n,o),this.isInitialized(n)||this.shouldAutoInitialize())try{const d=this.getOrInitializeService({instanceIdentifier:n});d&&o.resolve(d)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){const n=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),o=(e==null?void 0:e.optional)??!1;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(d){if(o)return null;throw d}else{if(o)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(bR(e))try{this.getOrInitializeService({instanceIdentifier:gp})}catch{}for(const[n,o]of this.instancesDeferred.entries()){const d=this.normalizeInstanceIdentifier(n);try{const g=this.getOrInitializeService({instanceIdentifier:d});o.resolve(g)}catch{}}}}clearInstance(e=gp){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=gp){return this.instances.has(e)}getOptions(e=gp){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:n={}}=e,o=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(o))throw Error(`${this.name}(${o}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const d=this.getOrInitializeService({instanceIdentifier:o,options:n});for(const[g,_]of this.instancesDeferred.entries()){const c=this.normalizeInstanceIdentifier(g);o===c&&_.resolve(d)}return d}onInit(e,n){const o=this.normalizeInstanceIdentifier(n),d=this.onInitCallbacks.get(o)??new Set;d.add(e),this.onInitCallbacks.set(o,d);const g=this.instances.get(o);return g&&e(g,o),()=>{d.delete(e)}}invokeOnInitCallbacks(e,n){const o=this.onInitCallbacks.get(n);if(o)for(const d of o)try{d(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let o=this.instances.get(e);if(!o&&this.component&&(o=this.component.instanceFactory(this.container,{instanceIdentifier:vR(e),options:n}),this.instances.set(e,o),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(o,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,o)}catch{}return o||null}normalizeInstanceIdentifier(e=gp){return this.component?this.component.multipleInstances?e:gp:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function vR(i){return i===gp?void 0:i}function bR(i){return i.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xR{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const n=new yR(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ji;(function(i){i[i.DEBUG=0]="DEBUG",i[i.VERBOSE=1]="VERBOSE",i[i.INFO=2]="INFO",i[i.WARN=3]="WARN",i[i.ERROR=4]="ERROR",i[i.SILENT=5]="SILENT"})(Ji||(Ji={}));const wR={debug:Ji.DEBUG,verbose:Ji.VERBOSE,info:Ji.INFO,warn:Ji.WARN,error:Ji.ERROR,silent:Ji.SILENT},TR=Ji.INFO,SR={[Ji.DEBUG]:"log",[Ji.VERBOSE]:"log",[Ji.INFO]:"info",[Ji.WARN]:"warn",[Ji.ERROR]:"error"},ER=(i,e,...n)=>{if(e<i.logLevel)return;const o=new Date().toISOString(),d=SR[e];if(d)console[d](`[${o}]  ${i.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class A0{constructor(e){this.name=e,this._logLevel=TR,this._logHandler=ER,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Ji))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?wR[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Ji.DEBUG,...e),this._logHandler(this,Ji.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Ji.VERBOSE,...e),this._logHandler(this,Ji.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Ji.INFO,...e),this._logHandler(this,Ji.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Ji.WARN,...e),this._logHandler(this,Ji.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Ji.ERROR,...e),this._logHandler(this,Ji.ERROR,...e)}}const AR=(i,e)=>e.some(n=>i instanceof n);let a2,s2;function CR(){return a2||(a2=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function MR(){return s2||(s2=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const pE=new WeakMap,lx=new WeakMap,mE=new WeakMap,Mb=new WeakMap,m1=new WeakMap;function IR(i){const e=new Promise((n,o)=>{const d=()=>{i.removeEventListener("success",g),i.removeEventListener("error",_)},g=()=>{n(xf(i.result)),d()},_=()=>{o(i.error),d()};i.addEventListener("success",g),i.addEventListener("error",_)});return e.then(n=>{n instanceof IDBCursor&&pE.set(n,i)}).catch(()=>{}),m1.set(e,i),e}function PR(i){if(lx.has(i))return;const e=new Promise((n,o)=>{const d=()=>{i.removeEventListener("complete",g),i.removeEventListener("error",_),i.removeEventListener("abort",_)},g=()=>{n(),d()},_=()=>{o(i.error||new DOMException("AbortError","AbortError")),d()};i.addEventListener("complete",g),i.addEventListener("error",_),i.addEventListener("abort",_)});lx.set(i,e)}let ux={get(i,e,n){if(i instanceof IDBTransaction){if(e==="done")return lx.get(i);if(e==="objectStoreNames")return i.objectStoreNames||mE.get(i);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return xf(i[e])},set(i,e,n){return i[e]=n,!0},has(i,e){return i instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in i}};function RR(i){ux=i(ux)}function LR(i){return i===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const o=i.call(Ib(this),e,...n);return mE.set(o,e.sort?e.sort():[e]),xf(o)}:MR().includes(i)?function(...e){return i.apply(Ib(this),e),xf(pE.get(this))}:function(...e){return xf(i.apply(Ib(this),e))}}function kR(i){return typeof i=="function"?LR(i):(i instanceof IDBTransaction&&PR(i),AR(i,CR())?new Proxy(i,ux):i)}function xf(i){if(i instanceof IDBRequest)return IR(i);if(Mb.has(i))return Mb.get(i);const e=kR(i);return e!==i&&(Mb.set(i,e),m1.set(e,i)),e}const Ib=i=>m1.get(i);function gE(i,e,{blocked:n,upgrade:o,blocking:d,terminated:g}={}){const _=indexedDB.open(i,e),c=xf(_);return o&&_.addEventListener("upgradeneeded",M=>{o(xf(_.result),M.oldVersion,M.newVersion,xf(_.transaction),M)}),n&&_.addEventListener("blocked",M=>n(M.oldVersion,M.newVersion,M)),c.then(M=>{g&&M.addEventListener("close",()=>g()),d&&M.addEventListener("versionchange",k=>d(k.oldVersion,k.newVersion,k))}).catch(()=>{}),c}const DR=["get","getKey","getAll","getAllKeys","count"],zR=["put","add","delete","clear"],Pb=new Map;function o2(i,e){if(!(i instanceof IDBDatabase&&!(e in i)&&typeof e=="string"))return;if(Pb.get(e))return Pb.get(e);const n=e.replace(/FromIndex$/,""),o=e!==n,d=zR.includes(n);if(!(n in(o?IDBIndex:IDBObjectStore).prototype)||!(d||DR.includes(n)))return;const g=async function(_,...c){const M=this.transaction(_,d?"readwrite":"readonly");let k=M.store;return o&&(k=k.index(c.shift())),(await Promise.all([k[n](...c),d&&M.done]))[0]};return Pb.set(e,g),g}RR(i=>({...i,get:(e,n,o)=>o2(e,n)||i.get(e,n,o),has:(e,n)=>!!o2(e,n)||i.has(e,n)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OR{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(NR(n)){const o=n.getImmediate();return`${o.library}/${o.version}`}else return null}).filter(n=>n).join(" ")}}function NR(i){const e=i.getComponent();return(e==null?void 0:e.type)==="VERSION"}const cx="@firebase/app",l2="0.14.6";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Od=new A0("@firebase/app"),BR="@firebase/app-compat",FR="@firebase/analytics-compat",VR="@firebase/analytics",jR="@firebase/app-check-compat",UR="@firebase/app-check",$R="@firebase/auth",qR="@firebase/auth-compat",GR="@firebase/database",ZR="@firebase/data-connect",HR="@firebase/database-compat",XR="@firebase/functions",WR="@firebase/functions-compat",KR="@firebase/installations",YR="@firebase/installations-compat",QR="@firebase/messaging",JR="@firebase/messaging-compat",e5="@firebase/performance",t5="@firebase/performance-compat",n5="@firebase/remote-config",i5="@firebase/remote-config-compat",r5="@firebase/storage",a5="@firebase/storage-compat",s5="@firebase/firestore",o5="@firebase/ai",l5="@firebase/firestore-compat",u5="firebase",c5="12.6.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hx="[DEFAULT]",h5={[cx]:"fire-core",[BR]:"fire-core-compat",[VR]:"fire-analytics",[FR]:"fire-analytics-compat",[UR]:"fire-app-check",[jR]:"fire-app-check-compat",[$R]:"fire-auth",[qR]:"fire-auth-compat",[GR]:"fire-rtdb",[ZR]:"fire-data-connect",[HR]:"fire-rtdb-compat",[XR]:"fire-fn",[WR]:"fire-fn-compat",[KR]:"fire-iid",[YR]:"fire-iid-compat",[QR]:"fire-fcm",[JR]:"fire-fcm-compat",[e5]:"fire-perf",[t5]:"fire-perf-compat",[n5]:"fire-rc",[i5]:"fire-rc-compat",[r5]:"fire-gcs",[a5]:"fire-gcs-compat",[s5]:"fire-fst",[l5]:"fire-fst-compat",[o5]:"fire-vertex","fire-js":"fire-js",[u5]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qv=new Map,d5=new Map,dx=new Map;function u2(i,e){try{i.container.addComponent(e)}catch(n){Od.debug(`Component ${e.name} failed to register with FirebaseApp ${i.name}`,n)}}function Xh(i){const e=i.name;if(dx.has(e))return Od.debug(`There were multiple attempts to register component ${e}.`),!1;dx.set(e,i);for(const n of Qv.values())u2(n,i);for(const n of d5.values())u2(n,i);return!0}function Vp(i,e){const n=i.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),i.container.getProvider(e)}function f5(i){return i==null?!1:i.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const p5={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},wf=new oy("app","Firebase",p5);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class m5{constructor(e,n,o){this._isDeleted=!1,this._options={...e},this._config={...n},this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=o,this.container.addComponent(new lh("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw wf.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const g5=c5;function _E(i,e={}){let n=i;typeof e!="object"&&(e={name:e});const o={name:hx,automaticDataCollectionEnabled:!0,...e},d=o.name;if(typeof d!="string"||!d)throw wf.create("bad-app-name",{appName:String(d)});if(n||(n=dE()),!n)throw wf.create("no-options");const g=Qv.get(d);if(g){if(N_(n,g.options)&&N_(o,g.config))return g;throw wf.create("duplicate-app",{appName:d})}const _=new xR(d);for(const M of dx.values())_.addComponent(M);const c=new m5(n,o,_);return Qv.set(d,c),c}function g1(i=hx){const e=Qv.get(i);if(!e&&i===hx&&dE())return _E();if(!e)throw wf.create("no-app",{appName:i});return e}function sh(i,e,n){let o=h5[i]??i;n&&(o+=`-${n}`);const d=o.match(/\s|\//),g=e.match(/\s|\//);if(d||g){const _=[`Unable to register library "${o}" with version "${e}":`];d&&_.push(`library name "${o}" contains illegal characters (whitespace or "/")`),d&&g&&_.push("and"),g&&_.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Od.warn(_.join(" "));return}Xh(new lh(`${o}-version`,()=>({library:o,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _5="firebase-heartbeat-database",y5=1,B_="firebase-heartbeat-store";let Rb=null;function yE(){return Rb||(Rb=gE(_5,y5,{upgrade:(i,e)=>{switch(e){case 0:try{i.createObjectStore(B_)}catch(n){console.warn(n)}}}}).catch(i=>{throw wf.create("idb-open",{originalErrorMessage:i.message})})),Rb}async function v5(i){try{const n=(await yE()).transaction(B_),o=await n.objectStore(B_).get(vE(i));return await n.done,o}catch(e){if(e instanceof kf)Od.warn(e.message);else{const n=wf.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Od.warn(n.message)}}}async function c2(i,e){try{const o=(await yE()).transaction(B_,"readwrite");await o.objectStore(B_).put(e,vE(i)),await o.done}catch(n){if(n instanceof kf)Od.warn(n.message);else{const o=wf.create("idb-set",{originalErrorMessage:n==null?void 0:n.message});Od.warn(o.message)}}}function vE(i){return`${i.name}!${i.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const b5=1024,x5=30;class w5{constructor(e){this.container=e,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new S5(n),this._heartbeatsCachePromise=this._storage.read().then(o=>(this._heartbeatsCache=o,o))}async triggerHeartbeat(){var e,n;try{const d=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),g=h2();if(((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((n=this._heartbeatsCache)==null?void 0:n.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===g||this._heartbeatsCache.heartbeats.some(_=>_.date===g))return;if(this._heartbeatsCache.heartbeats.push({date:g,agent:d}),this._heartbeatsCache.heartbeats.length>x5){const _=E5(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(_,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(o){Od.warn(o)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const n=h2(),{heartbeatsToSend:o,unsentEntries:d}=T5(this._heartbeatsCache.heartbeats),g=Yv(JSON.stringify({version:2,heartbeats:o}));return this._heartbeatsCache.lastSentHeartbeatDate=n,d.length>0?(this._heartbeatsCache.heartbeats=d,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),g}catch(n){return Od.warn(n),""}}}function h2(){return new Date().toISOString().substring(0,10)}function T5(i,e=b5){const n=[];let o=i.slice();for(const d of i){const g=n.find(_=>_.agent===d.agent);if(g){if(g.dates.push(d.date),d2(n)>e){g.dates.pop();break}}else if(n.push({agent:d.agent,dates:[d.date]}),d2(n)>e){n.pop();break}o=o.slice(1)}return{heartbeatsToSend:n,unsentEntries:o}}class S5{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return E0()?fE().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const n=await v5(this.app);return n!=null&&n.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const o=await this.read();return c2(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??o.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const o=await this.read();return c2(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??o.lastSentHeartbeatDate,heartbeats:[...o.heartbeats,...e.heartbeats]})}else return}}function d2(i){return Yv(JSON.stringify({version:2,heartbeats:i})).length}function E5(i){if(i.length===0)return-1;let e=0,n=i[0].date;for(let o=1;o<i.length;o++)i[o].date<n&&(n=i[o].date,e=o);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function A5(i){Xh(new lh("platform-logger",e=>new OR(e),"PRIVATE")),Xh(new lh("heartbeat",e=>new w5(e),"PRIVATE")),sh(cx,l2,i),sh(cx,l2,"esm2020"),sh("fire-js","")}A5("");var f2=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Tf,bE;(function(){var i;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(de,ce){function _e(){}_e.prototype=ce.prototype,de.F=ce.prototype,de.prototype=new _e,de.prototype.constructor=de,de.D=function(Ae,Pe,Ge){for(var Re=Array(arguments.length-2),In=2;In<arguments.length;In++)Re[In-2]=arguments[In];return ce.prototype[Pe].apply(Ae,Re)}}function n(){this.blockSize=-1}function o(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(o,n),o.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function d(de,ce,_e){_e||(_e=0);const Ae=Array(16);if(typeof ce=="string")for(var Pe=0;Pe<16;++Pe)Ae[Pe]=ce.charCodeAt(_e++)|ce.charCodeAt(_e++)<<8|ce.charCodeAt(_e++)<<16|ce.charCodeAt(_e++)<<24;else for(Pe=0;Pe<16;++Pe)Ae[Pe]=ce[_e++]|ce[_e++]<<8|ce[_e++]<<16|ce[_e++]<<24;ce=de.g[0],_e=de.g[1],Pe=de.g[2];let Ge=de.g[3],Re;Re=ce+(Ge^_e&(Pe^Ge))+Ae[0]+3614090360&4294967295,ce=_e+(Re<<7&4294967295|Re>>>25),Re=Ge+(Pe^ce&(_e^Pe))+Ae[1]+3905402710&4294967295,Ge=ce+(Re<<12&4294967295|Re>>>20),Re=Pe+(_e^Ge&(ce^_e))+Ae[2]+606105819&4294967295,Pe=Ge+(Re<<17&4294967295|Re>>>15),Re=_e+(ce^Pe&(Ge^ce))+Ae[3]+3250441966&4294967295,_e=Pe+(Re<<22&4294967295|Re>>>10),Re=ce+(Ge^_e&(Pe^Ge))+Ae[4]+4118548399&4294967295,ce=_e+(Re<<7&4294967295|Re>>>25),Re=Ge+(Pe^ce&(_e^Pe))+Ae[5]+1200080426&4294967295,Ge=ce+(Re<<12&4294967295|Re>>>20),Re=Pe+(_e^Ge&(ce^_e))+Ae[6]+2821735955&4294967295,Pe=Ge+(Re<<17&4294967295|Re>>>15),Re=_e+(ce^Pe&(Ge^ce))+Ae[7]+4249261313&4294967295,_e=Pe+(Re<<22&4294967295|Re>>>10),Re=ce+(Ge^_e&(Pe^Ge))+Ae[8]+1770035416&4294967295,ce=_e+(Re<<7&4294967295|Re>>>25),Re=Ge+(Pe^ce&(_e^Pe))+Ae[9]+2336552879&4294967295,Ge=ce+(Re<<12&4294967295|Re>>>20),Re=Pe+(_e^Ge&(ce^_e))+Ae[10]+4294925233&4294967295,Pe=Ge+(Re<<17&4294967295|Re>>>15),Re=_e+(ce^Pe&(Ge^ce))+Ae[11]+2304563134&4294967295,_e=Pe+(Re<<22&4294967295|Re>>>10),Re=ce+(Ge^_e&(Pe^Ge))+Ae[12]+1804603682&4294967295,ce=_e+(Re<<7&4294967295|Re>>>25),Re=Ge+(Pe^ce&(_e^Pe))+Ae[13]+4254626195&4294967295,Ge=ce+(Re<<12&4294967295|Re>>>20),Re=Pe+(_e^Ge&(ce^_e))+Ae[14]+2792965006&4294967295,Pe=Ge+(Re<<17&4294967295|Re>>>15),Re=_e+(ce^Pe&(Ge^ce))+Ae[15]+1236535329&4294967295,_e=Pe+(Re<<22&4294967295|Re>>>10),Re=ce+(Pe^Ge&(_e^Pe))+Ae[1]+4129170786&4294967295,ce=_e+(Re<<5&4294967295|Re>>>27),Re=Ge+(_e^Pe&(ce^_e))+Ae[6]+3225465664&4294967295,Ge=ce+(Re<<9&4294967295|Re>>>23),Re=Pe+(ce^_e&(Ge^ce))+Ae[11]+643717713&4294967295,Pe=Ge+(Re<<14&4294967295|Re>>>18),Re=_e+(Ge^ce&(Pe^Ge))+Ae[0]+3921069994&4294967295,_e=Pe+(Re<<20&4294967295|Re>>>12),Re=ce+(Pe^Ge&(_e^Pe))+Ae[5]+3593408605&4294967295,ce=_e+(Re<<5&4294967295|Re>>>27),Re=Ge+(_e^Pe&(ce^_e))+Ae[10]+38016083&4294967295,Ge=ce+(Re<<9&4294967295|Re>>>23),Re=Pe+(ce^_e&(Ge^ce))+Ae[15]+3634488961&4294967295,Pe=Ge+(Re<<14&4294967295|Re>>>18),Re=_e+(Ge^ce&(Pe^Ge))+Ae[4]+3889429448&4294967295,_e=Pe+(Re<<20&4294967295|Re>>>12),Re=ce+(Pe^Ge&(_e^Pe))+Ae[9]+568446438&4294967295,ce=_e+(Re<<5&4294967295|Re>>>27),Re=Ge+(_e^Pe&(ce^_e))+Ae[14]+3275163606&4294967295,Ge=ce+(Re<<9&4294967295|Re>>>23),Re=Pe+(ce^_e&(Ge^ce))+Ae[3]+4107603335&4294967295,Pe=Ge+(Re<<14&4294967295|Re>>>18),Re=_e+(Ge^ce&(Pe^Ge))+Ae[8]+1163531501&4294967295,_e=Pe+(Re<<20&4294967295|Re>>>12),Re=ce+(Pe^Ge&(_e^Pe))+Ae[13]+2850285829&4294967295,ce=_e+(Re<<5&4294967295|Re>>>27),Re=Ge+(_e^Pe&(ce^_e))+Ae[2]+4243563512&4294967295,Ge=ce+(Re<<9&4294967295|Re>>>23),Re=Pe+(ce^_e&(Ge^ce))+Ae[7]+1735328473&4294967295,Pe=Ge+(Re<<14&4294967295|Re>>>18),Re=_e+(Ge^ce&(Pe^Ge))+Ae[12]+2368359562&4294967295,_e=Pe+(Re<<20&4294967295|Re>>>12),Re=ce+(_e^Pe^Ge)+Ae[5]+4294588738&4294967295,ce=_e+(Re<<4&4294967295|Re>>>28),Re=Ge+(ce^_e^Pe)+Ae[8]+2272392833&4294967295,Ge=ce+(Re<<11&4294967295|Re>>>21),Re=Pe+(Ge^ce^_e)+Ae[11]+1839030562&4294967295,Pe=Ge+(Re<<16&4294967295|Re>>>16),Re=_e+(Pe^Ge^ce)+Ae[14]+4259657740&4294967295,_e=Pe+(Re<<23&4294967295|Re>>>9),Re=ce+(_e^Pe^Ge)+Ae[1]+2763975236&4294967295,ce=_e+(Re<<4&4294967295|Re>>>28),Re=Ge+(ce^_e^Pe)+Ae[4]+1272893353&4294967295,Ge=ce+(Re<<11&4294967295|Re>>>21),Re=Pe+(Ge^ce^_e)+Ae[7]+4139469664&4294967295,Pe=Ge+(Re<<16&4294967295|Re>>>16),Re=_e+(Pe^Ge^ce)+Ae[10]+3200236656&4294967295,_e=Pe+(Re<<23&4294967295|Re>>>9),Re=ce+(_e^Pe^Ge)+Ae[13]+681279174&4294967295,ce=_e+(Re<<4&4294967295|Re>>>28),Re=Ge+(ce^_e^Pe)+Ae[0]+3936430074&4294967295,Ge=ce+(Re<<11&4294967295|Re>>>21),Re=Pe+(Ge^ce^_e)+Ae[3]+3572445317&4294967295,Pe=Ge+(Re<<16&4294967295|Re>>>16),Re=_e+(Pe^Ge^ce)+Ae[6]+76029189&4294967295,_e=Pe+(Re<<23&4294967295|Re>>>9),Re=ce+(_e^Pe^Ge)+Ae[9]+3654602809&4294967295,ce=_e+(Re<<4&4294967295|Re>>>28),Re=Ge+(ce^_e^Pe)+Ae[12]+3873151461&4294967295,Ge=ce+(Re<<11&4294967295|Re>>>21),Re=Pe+(Ge^ce^_e)+Ae[15]+530742520&4294967295,Pe=Ge+(Re<<16&4294967295|Re>>>16),Re=_e+(Pe^Ge^ce)+Ae[2]+3299628645&4294967295,_e=Pe+(Re<<23&4294967295|Re>>>9),Re=ce+(Pe^(_e|~Ge))+Ae[0]+4096336452&4294967295,ce=_e+(Re<<6&4294967295|Re>>>26),Re=Ge+(_e^(ce|~Pe))+Ae[7]+1126891415&4294967295,Ge=ce+(Re<<10&4294967295|Re>>>22),Re=Pe+(ce^(Ge|~_e))+Ae[14]+2878612391&4294967295,Pe=Ge+(Re<<15&4294967295|Re>>>17),Re=_e+(Ge^(Pe|~ce))+Ae[5]+4237533241&4294967295,_e=Pe+(Re<<21&4294967295|Re>>>11),Re=ce+(Pe^(_e|~Ge))+Ae[12]+1700485571&4294967295,ce=_e+(Re<<6&4294967295|Re>>>26),Re=Ge+(_e^(ce|~Pe))+Ae[3]+2399980690&4294967295,Ge=ce+(Re<<10&4294967295|Re>>>22),Re=Pe+(ce^(Ge|~_e))+Ae[10]+4293915773&4294967295,Pe=Ge+(Re<<15&4294967295|Re>>>17),Re=_e+(Ge^(Pe|~ce))+Ae[1]+2240044497&4294967295,_e=Pe+(Re<<21&4294967295|Re>>>11),Re=ce+(Pe^(_e|~Ge))+Ae[8]+1873313359&4294967295,ce=_e+(Re<<6&4294967295|Re>>>26),Re=Ge+(_e^(ce|~Pe))+Ae[15]+4264355552&4294967295,Ge=ce+(Re<<10&4294967295|Re>>>22),Re=Pe+(ce^(Ge|~_e))+Ae[6]+2734768916&4294967295,Pe=Ge+(Re<<15&4294967295|Re>>>17),Re=_e+(Ge^(Pe|~ce))+Ae[13]+1309151649&4294967295,_e=Pe+(Re<<21&4294967295|Re>>>11),Re=ce+(Pe^(_e|~Ge))+Ae[4]+4149444226&4294967295,ce=_e+(Re<<6&4294967295|Re>>>26),Re=Ge+(_e^(ce|~Pe))+Ae[11]+3174756917&4294967295,Ge=ce+(Re<<10&4294967295|Re>>>22),Re=Pe+(ce^(Ge|~_e))+Ae[2]+718787259&4294967295,Pe=Ge+(Re<<15&4294967295|Re>>>17),Re=_e+(Ge^(Pe|~ce))+Ae[9]+3951481745&4294967295,de.g[0]=de.g[0]+ce&4294967295,de.g[1]=de.g[1]+(Pe+(Re<<21&4294967295|Re>>>11))&4294967295,de.g[2]=de.g[2]+Pe&4294967295,de.g[3]=de.g[3]+Ge&4294967295}o.prototype.v=function(de,ce){ce===void 0&&(ce=de.length);const _e=ce-this.blockSize,Ae=this.C;let Pe=this.h,Ge=0;for(;Ge<ce;){if(Pe==0)for(;Ge<=_e;)d(this,de,Ge),Ge+=this.blockSize;if(typeof de=="string"){for(;Ge<ce;)if(Ae[Pe++]=de.charCodeAt(Ge++),Pe==this.blockSize){d(this,Ae),Pe=0;break}}else for(;Ge<ce;)if(Ae[Pe++]=de[Ge++],Pe==this.blockSize){d(this,Ae),Pe=0;break}}this.h=Pe,this.o+=ce},o.prototype.A=function(){var de=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);de[0]=128;for(var ce=1;ce<de.length-8;++ce)de[ce]=0;ce=this.o*8;for(var _e=de.length-8;_e<de.length;++_e)de[_e]=ce&255,ce/=256;for(this.v(de),de=Array(16),ce=0,_e=0;_e<4;++_e)for(let Ae=0;Ae<32;Ae+=8)de[ce++]=this.g[_e]>>>Ae&255;return de};function g(de,ce){var _e=c;return Object.prototype.hasOwnProperty.call(_e,de)?_e[de]:_e[de]=ce(de)}function _(de,ce){this.h=ce;const _e=[];let Ae=!0;for(let Pe=de.length-1;Pe>=0;Pe--){const Ge=de[Pe]|0;Ae&&Ge==ce||(_e[Pe]=Ge,Ae=!1)}this.g=_e}var c={};function M(de){return-128<=de&&de<128?g(de,function(ce){return new _([ce|0],ce<0?-1:0)}):new _([de|0],de<0?-1:0)}function k(de){if(isNaN(de)||!isFinite(de))return G;if(de<0)return Ne(k(-de));const ce=[];let _e=1;for(let Ae=0;de>=_e;Ae++)ce[Ae]=de/_e|0,_e*=4294967296;return new _(ce,0)}function j(de,ce){if(de.length==0)throw Error("number format error: empty string");if(ce=ce||10,ce<2||36<ce)throw Error("radix out of range: "+ce);if(de.charAt(0)=="-")return Ne(j(de.substring(1),ce));if(de.indexOf("-")>=0)throw Error('number format error: interior "-" character');const _e=k(Math.pow(ce,8));let Ae=G;for(let Ge=0;Ge<de.length;Ge+=8){var Pe=Math.min(8,de.length-Ge);const Re=parseInt(de.substring(Ge,Ge+Pe),ce);Pe<8?(Pe=k(Math.pow(ce,Pe)),Ae=Ae.j(Pe).add(k(Re))):(Ae=Ae.j(_e),Ae=Ae.add(k(Re)))}return Ae}var G=M(0),ee=M(1),Y=M(16777216);i=_.prototype,i.m=function(){if(be(this))return-Ne(this).m();let de=0,ce=1;for(let _e=0;_e<this.g.length;_e++){const Ae=this.i(_e);de+=(Ae>=0?Ae:4294967296+Ae)*ce,ce*=4294967296}return de},i.toString=function(de){if(de=de||10,de<2||36<de)throw Error("radix out of range: "+de);if(xe(this))return"0";if(be(this))return"-"+Ne(this).toString(de);const ce=k(Math.pow(de,6));var _e=this;let Ae="";for(;;){const Pe=He(_e,ce).g;_e=tt(_e,Pe.j(ce));let Ge=((_e.g.length>0?_e.g[0]:_e.h)>>>0).toString(de);if(_e=Pe,xe(_e))return Ge+Ae;for(;Ge.length<6;)Ge="0"+Ge;Ae=Ge+Ae}},i.i=function(de){return de<0?0:de<this.g.length?this.g[de]:this.h};function xe(de){if(de.h!=0)return!1;for(let ce=0;ce<de.g.length;ce++)if(de.g[ce]!=0)return!1;return!0}function be(de){return de.h==-1}i.l=function(de){return de=tt(this,de),be(de)?-1:xe(de)?0:1};function Ne(de){const ce=de.g.length,_e=[];for(let Ae=0;Ae<ce;Ae++)_e[Ae]=~de.g[Ae];return new _(_e,~de.h).add(ee)}i.abs=function(){return be(this)?Ne(this):this},i.add=function(de){const ce=Math.max(this.g.length,de.g.length),_e=[];let Ae=0;for(let Pe=0;Pe<=ce;Pe++){let Ge=Ae+(this.i(Pe)&65535)+(de.i(Pe)&65535),Re=(Ge>>>16)+(this.i(Pe)>>>16)+(de.i(Pe)>>>16);Ae=Re>>>16,Ge&=65535,Re&=65535,_e[Pe]=Re<<16|Ge}return new _(_e,_e[_e.length-1]&-2147483648?-1:0)};function tt(de,ce){return de.add(Ne(ce))}i.j=function(de){if(xe(this)||xe(de))return G;if(be(this))return be(de)?Ne(this).j(Ne(de)):Ne(Ne(this).j(de));if(be(de))return Ne(this.j(Ne(de)));if(this.l(Y)<0&&de.l(Y)<0)return k(this.m()*de.m());const ce=this.g.length+de.g.length,_e=[];for(var Ae=0;Ae<2*ce;Ae++)_e[Ae]=0;for(Ae=0;Ae<this.g.length;Ae++)for(let Pe=0;Pe<de.g.length;Pe++){const Ge=this.i(Ae)>>>16,Re=this.i(Ae)&65535,In=de.i(Pe)>>>16,Jn=de.i(Pe)&65535;_e[2*Ae+2*Pe]+=Re*Jn,Je(_e,2*Ae+2*Pe),_e[2*Ae+2*Pe+1]+=Ge*Jn,Je(_e,2*Ae+2*Pe+1),_e[2*Ae+2*Pe+1]+=Re*In,Je(_e,2*Ae+2*Pe+1),_e[2*Ae+2*Pe+2]+=Ge*In,Je(_e,2*Ae+2*Pe+2)}for(de=0;de<ce;de++)_e[de]=_e[2*de+1]<<16|_e[2*de];for(de=ce;de<2*ce;de++)_e[de]=0;return new _(_e,0)};function Je(de,ce){for(;(de[ce]&65535)!=de[ce];)de[ce+1]+=de[ce]>>>16,de[ce]&=65535,ce++}function qe(de,ce){this.g=de,this.h=ce}function He(de,ce){if(xe(ce))throw Error("division by zero");if(xe(de))return new qe(G,G);if(be(de))return ce=He(Ne(de),ce),new qe(Ne(ce.g),Ne(ce.h));if(be(ce))return ce=He(de,Ne(ce)),new qe(Ne(ce.g),ce.h);if(de.g.length>30){if(be(de)||be(ce))throw Error("slowDivide_ only works with positive integers.");for(var _e=ee,Ae=ce;Ae.l(de)<=0;)_e=Ue(_e),Ae=Ue(Ae);var Pe=Be(_e,1),Ge=Be(Ae,1);for(Ae=Be(Ae,2),_e=Be(_e,2);!xe(Ae);){var Re=Ge.add(Ae);Re.l(de)<=0&&(Pe=Pe.add(_e),Ge=Re),Ae=Be(Ae,1),_e=Be(_e,1)}return ce=tt(de,Pe.j(ce)),new qe(Pe,ce)}for(Pe=G;de.l(ce)>=0;){for(_e=Math.max(1,Math.floor(de.m()/ce.m())),Ae=Math.ceil(Math.log(_e)/Math.LN2),Ae=Ae<=48?1:Math.pow(2,Ae-48),Ge=k(_e),Re=Ge.j(ce);be(Re)||Re.l(de)>0;)_e-=Ae,Ge=k(_e),Re=Ge.j(ce);xe(Ge)&&(Ge=ee),Pe=Pe.add(Ge),de=tt(de,Re)}return new qe(Pe,de)}i.B=function(de){return He(this,de).h},i.and=function(de){const ce=Math.max(this.g.length,de.g.length),_e=[];for(let Ae=0;Ae<ce;Ae++)_e[Ae]=this.i(Ae)&de.i(Ae);return new _(_e,this.h&de.h)},i.or=function(de){const ce=Math.max(this.g.length,de.g.length),_e=[];for(let Ae=0;Ae<ce;Ae++)_e[Ae]=this.i(Ae)|de.i(Ae);return new _(_e,this.h|de.h)},i.xor=function(de){const ce=Math.max(this.g.length,de.g.length),_e=[];for(let Ae=0;Ae<ce;Ae++)_e[Ae]=this.i(Ae)^de.i(Ae);return new _(_e,this.h^de.h)};function Ue(de){const ce=de.g.length+1,_e=[];for(let Ae=0;Ae<ce;Ae++)_e[Ae]=de.i(Ae)<<1|de.i(Ae-1)>>>31;return new _(_e,de.h)}function Be(de,ce){const _e=ce>>5;ce%=32;const Ae=de.g.length-_e,Pe=[];for(let Ge=0;Ge<Ae;Ge++)Pe[Ge]=ce>0?de.i(Ge+_e)>>>ce|de.i(Ge+_e+1)<<32-ce:de.i(Ge+_e);return new _(Pe,de.h)}o.prototype.digest=o.prototype.A,o.prototype.reset=o.prototype.u,o.prototype.update=o.prototype.v,bE=o,_.prototype.add=_.prototype.add,_.prototype.multiply=_.prototype.j,_.prototype.modulo=_.prototype.B,_.prototype.compare=_.prototype.l,_.prototype.toNumber=_.prototype.m,_.prototype.toString=_.prototype.toString,_.prototype.getBits=_.prototype.i,_.fromNumber=k,_.fromString=j,Tf=_}).apply(typeof f2<"u"?f2:typeof self<"u"?self:typeof window<"u"?window:{});var cv=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var xE,g_,wE,Cv,fx,TE,SE,EE;(function(){var i,e=Object.defineProperty;function n(P){P=[typeof globalThis=="object"&&globalThis,P,typeof window=="object"&&window,typeof self=="object"&&self,typeof cv=="object"&&cv];for(var Z=0;Z<P.length;++Z){var ne=P[Z];if(ne&&ne.Math==Math)return ne}throw Error("Cannot find global object")}var o=n(this);function d(P,Z){if(Z)e:{var ne=o;P=P.split(".");for(var ye=0;ye<P.length-1;ye++){var at=P[ye];if(!(at in ne))break e;ne=ne[at]}P=P[P.length-1],ye=ne[P],Z=Z(ye),Z!=ye&&Z!=null&&e(ne,P,{configurable:!0,writable:!0,value:Z})}}d("Symbol.dispose",function(P){return P||Symbol("Symbol.dispose")}),d("Array.prototype.values",function(P){return P||function(){return this[Symbol.iterator]()}}),d("Object.entries",function(P){return P||function(Z){var ne=[],ye;for(ye in Z)Object.prototype.hasOwnProperty.call(Z,ye)&&ne.push([ye,Z[ye]]);return ne}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var g=g||{},_=this||self;function c(P){var Z=typeof P;return Z=="object"&&P!=null||Z=="function"}function M(P,Z,ne){return P.call.apply(P.bind,arguments)}function k(P,Z,ne){return k=M,k.apply(null,arguments)}function j(P,Z){var ne=Array.prototype.slice.call(arguments,1);return function(){var ye=ne.slice();return ye.push.apply(ye,arguments),P.apply(this,ye)}}function G(P,Z){function ne(){}ne.prototype=Z.prototype,P.Z=Z.prototype,P.prototype=new ne,P.prototype.constructor=P,P.Ob=function(ye,at,ht){for(var Wt=Array(arguments.length-2),kn=2;kn<arguments.length;kn++)Wt[kn-2]=arguments[kn];return Z.prototype[at].apply(ye,Wt)}}var ee=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?P=>P&&AsyncContext.Snapshot.wrap(P):P=>P;function Y(P){const Z=P.length;if(Z>0){const ne=Array(Z);for(let ye=0;ye<Z;ye++)ne[ye]=P[ye];return ne}return[]}function xe(P,Z){for(let ye=1;ye<arguments.length;ye++){const at=arguments[ye];var ne=typeof at;if(ne=ne!="object"?ne:at?Array.isArray(at)?"array":ne:"null",ne=="array"||ne=="object"&&typeof at.length=="number"){ne=P.length||0;const ht=at.length||0;P.length=ne+ht;for(let Wt=0;Wt<ht;Wt++)P[ne+Wt]=at[Wt]}else P.push(at)}}class be{constructor(Z,ne){this.i=Z,this.j=ne,this.h=0,this.g=null}get(){let Z;return this.h>0?(this.h--,Z=this.g,this.g=Z.next,Z.next=null):Z=this.i(),Z}}function Ne(P){_.setTimeout(()=>{throw P},0)}function tt(){var P=de;let Z=null;return P.g&&(Z=P.g,P.g=P.g.next,P.g||(P.h=null),Z.next=null),Z}class Je{constructor(){this.h=this.g=null}add(Z,ne){const ye=qe.get();ye.set(Z,ne),this.h?this.h.next=ye:this.g=ye,this.h=ye}}var qe=new be(()=>new He,P=>P.reset());class He{constructor(){this.next=this.g=this.h=null}set(Z,ne){this.h=Z,this.g=ne,this.next=null}reset(){this.next=this.g=this.h=null}}let Ue,Be=!1,de=new Je,ce=()=>{const P=Promise.resolve(void 0);Ue=()=>{P.then(_e)}};function _e(){for(var P;P=tt();){try{P.h.call(P.g)}catch(ne){Ne(ne)}var Z=qe;Z.j(P),Z.h<100&&(Z.h++,P.next=Z.g,Z.g=P)}Be=!1}function Ae(){this.u=this.u,this.C=this.C}Ae.prototype.u=!1,Ae.prototype.dispose=function(){this.u||(this.u=!0,this.N())},Ae.prototype[Symbol.dispose]=function(){this.dispose()},Ae.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Pe(P,Z){this.type=P,this.g=this.target=Z,this.defaultPrevented=!1}Pe.prototype.h=function(){this.defaultPrevented=!0};var Ge=(function(){if(!_.addEventListener||!Object.defineProperty)return!1;var P=!1,Z=Object.defineProperty({},"passive",{get:function(){P=!0}});try{const ne=()=>{};_.addEventListener("test",ne,Z),_.removeEventListener("test",ne,Z)}catch{}return P})();function Re(P){return/^[\s\xa0]*$/.test(P)}function In(P,Z){Pe.call(this,P?P.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,P&&this.init(P,Z)}G(In,Pe),In.prototype.init=function(P,Z){const ne=this.type=P.type,ye=P.changedTouches&&P.changedTouches.length?P.changedTouches[0]:null;this.target=P.target||P.srcElement,this.g=Z,Z=P.relatedTarget,Z||(ne=="mouseover"?Z=P.fromElement:ne=="mouseout"&&(Z=P.toElement)),this.relatedTarget=Z,ye?(this.clientX=ye.clientX!==void 0?ye.clientX:ye.pageX,this.clientY=ye.clientY!==void 0?ye.clientY:ye.pageY,this.screenX=ye.screenX||0,this.screenY=ye.screenY||0):(this.clientX=P.clientX!==void 0?P.clientX:P.pageX,this.clientY=P.clientY!==void 0?P.clientY:P.pageY,this.screenX=P.screenX||0,this.screenY=P.screenY||0),this.button=P.button,this.key=P.key||"",this.ctrlKey=P.ctrlKey,this.altKey=P.altKey,this.shiftKey=P.shiftKey,this.metaKey=P.metaKey,this.pointerId=P.pointerId||0,this.pointerType=P.pointerType,this.state=P.state,this.i=P,P.defaultPrevented&&In.Z.h.call(this)},In.prototype.h=function(){In.Z.h.call(this);const P=this.i;P.preventDefault?P.preventDefault():P.returnValue=!1};var Jn="closure_listenable_"+(Math.random()*1e6|0),mt=0;function $t(P,Z,ne,ye,at){this.listener=P,this.proxy=null,this.src=Z,this.type=ne,this.capture=!!ye,this.ha=at,this.key=++mt,this.da=this.fa=!1}function Tt(P){P.da=!0,P.listener=null,P.proxy=null,P.src=null,P.ha=null}function zt(P,Z,ne){for(const ye in P)Z.call(ne,P[ye],ye,P)}function Bt(P,Z){for(const ne in P)Z.call(void 0,P[ne],ne,P)}function ke(P){const Z={};for(const ne in P)Z[ne]=P[ne];return Z}const vt="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Ot(P,Z){let ne,ye;for(let at=1;at<arguments.length;at++){ye=arguments[at];for(ne in ye)P[ne]=ye[ne];for(let ht=0;ht<vt.length;ht++)ne=vt[ht],Object.prototype.hasOwnProperty.call(ye,ne)&&(P[ne]=ye[ne])}}function jt(P){this.src=P,this.g={},this.h=0}jt.prototype.add=function(P,Z,ne,ye,at){const ht=P.toString();P=this.g[ht],P||(P=this.g[ht]=[],this.h++);const Wt=Xt(P,Z,ye,at);return Wt>-1?(Z=P[Wt],ne||(Z.fa=!1)):(Z=new $t(Z,this.src,ht,!!ye,at),Z.fa=ne,P.push(Z)),Z};function Jt(P,Z){const ne=Z.type;if(ne in P.g){var ye=P.g[ne],at=Array.prototype.indexOf.call(ye,Z,void 0),ht;(ht=at>=0)&&Array.prototype.splice.call(ye,at,1),ht&&(Tt(Z),P.g[ne].length==0&&(delete P.g[ne],P.h--))}}function Xt(P,Z,ne,ye){for(let at=0;at<P.length;++at){const ht=P[at];if(!ht.da&&ht.listener==Z&&ht.capture==!!ne&&ht.ha==ye)return at}return-1}var Fn="closure_lm_"+(Math.random()*1e6|0),si={};function di(P,Z,ne,ye,at){if(Array.isArray(Z)){for(let ht=0;ht<Z.length;ht++)di(P,Z[ht],ne,ye,at);return null}return ne=Sa(ne),P&&P[Jn]?P.J(Z,ne,c(ye)?!!ye.capture:!1,at):ds(P,Z,ne,!1,ye,at)}function ds(P,Z,ne,ye,at,ht){if(!Z)throw Error("Invalid event type");const Wt=c(at)?!!at.capture:!!at;let kn=Ta(P);if(kn||(P[Fn]=kn=new jt(P)),ne=kn.add(Z,ne,ye,Wt,ht),ne.proxy)return ne;if(ye=Ns(),ne.proxy=ye,ye.src=P,ye.listener=ne,P.addEventListener)Ge||(at=Wt),at===void 0&&(at=!1),P.addEventListener(Z.toString(),ye,at);else if(P.attachEvent)P.attachEvent(Ii(Z.toString()),ye);else if(P.addListener&&P.removeListener)P.addListener(ye);else throw Error("addEventListener and attachEvent are unavailable.");return ne}function Ns(){function P(ne){return Z.call(P.src,P.listener,ne)}const Z=Va;return P}function kr(P,Z,ne,ye,at){if(Array.isArray(Z))for(var ht=0;ht<Z.length;ht++)kr(P,Z[ht],ne,ye,at);else ye=c(ye)?!!ye.capture:!!ye,ne=Sa(ne),P&&P[Jn]?(P=P.i,ht=String(Z).toString(),ht in P.g&&(Z=P.g[ht],ne=Xt(Z,ne,ye,at),ne>-1&&(Tt(Z[ne]),Array.prototype.splice.call(Z,ne,1),Z.length==0&&(delete P.g[ht],P.h--)))):P&&(P=Ta(P))&&(Z=P.g[Z.toString()],P=-1,Z&&(P=Xt(Z,ne,ye,at)),(ne=P>-1?Z[P]:null)&&Ni(ne))}function Ni(P){if(typeof P!="number"&&P&&!P.da){var Z=P.src;if(Z&&Z[Jn])Jt(Z.i,P);else{var ne=P.type,ye=P.proxy;Z.removeEventListener?Z.removeEventListener(ne,ye,P.capture):Z.detachEvent?Z.detachEvent(Ii(ne),ye):Z.addListener&&Z.removeListener&&Z.removeListener(ye),(ne=Ta(Z))?(Jt(ne,P),ne.h==0&&(ne.src=null,Z[Fn]=null)):Tt(P)}}}function Ii(P){return P in si?si[P]:si[P]="on"+P}function Va(P,Z){if(P.da)P=!0;else{Z=new In(Z,this);const ne=P.listener,ye=P.ha||P.src;P.fa&&Ni(P),P=ne.call(ye,Z)}return P}function Ta(P){return P=P[Fn],P instanceof jt?P:null}var Bs="__closure_events_fn_"+(Math.random()*1e9>>>0);function Sa(P){return typeof P=="function"?P:(P[Bs]||(P[Bs]=function(Z){return P.handleEvent(Z)}),P[Bs])}function Bi(){Ae.call(this),this.i=new jt(this),this.M=this,this.G=null}G(Bi,Ae),Bi.prototype[Jn]=!0,Bi.prototype.removeEventListener=function(P,Z,ne,ye){kr(this,P,Z,ne,ye)};function fr(P,Z){var ne,ye=P.G;if(ye)for(ne=[];ye;ye=ye.G)ne.push(ye);if(P=P.M,ye=Z.type||Z,typeof Z=="string")Z=new Pe(Z,P);else if(Z instanceof Pe)Z.target=Z.target||P;else{var at=Z;Z=new Pe(ye,P),Ot(Z,at)}at=!0;let ht,Wt;if(ne)for(Wt=ne.length-1;Wt>=0;Wt--)ht=Z.g=ne[Wt],at=Ea(ht,ye,!0,Z)&&at;if(ht=Z.g=P,at=Ea(ht,ye,!0,Z)&&at,at=Ea(ht,ye,!1,Z)&&at,ne)for(Wt=0;Wt<ne.length;Wt++)ht=Z.g=ne[Wt],at=Ea(ht,ye,!1,Z)&&at}Bi.prototype.N=function(){if(Bi.Z.N.call(this),this.i){var P=this.i;for(const Z in P.g){const ne=P.g[Z];for(let ye=0;ye<ne.length;ye++)Tt(ne[ye]);delete P.g[Z],P.h--}}this.G=null},Bi.prototype.J=function(P,Z,ne,ye){return this.i.add(String(P),Z,!1,ne,ye)},Bi.prototype.K=function(P,Z,ne,ye){return this.i.add(String(P),Z,!0,ne,ye)};function Ea(P,Z,ne,ye){if(Z=P.i.g[String(Z)],!Z)return!0;Z=Z.concat();let at=!0;for(let ht=0;ht<Z.length;++ht){const Wt=Z[ht];if(Wt&&!Wt.da&&Wt.capture==ne){const kn=Wt.listener,Wn=Wt.ha||Wt.src;Wt.fa&&Jt(P.i,Wt),at=kn.call(Wn,ye)!==!1&&at}}return at&&!ye.defaultPrevented}function So(P,Z){if(typeof P!="function")if(P&&typeof P.handleEvent=="function")P=k(P.handleEvent,P);else throw Error("Invalid listener argument");return Number(Z)>2147483647?-1:_.setTimeout(P,Z||0)}function so(P){P.g=So(()=>{P.g=null,P.i&&(P.i=!1,so(P))},P.l);const Z=P.h;P.h=null,P.m.apply(null,Z)}class $r extends Ae{constructor(Z,ne){super(),this.m=Z,this.l=ne,this.h=null,this.i=!1,this.g=null}j(Z){this.h=arguments,this.g?this.i=!0:so(this)}N(){super.N(),this.g&&(_.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function fs(P){Ae.call(this),this.h=P,this.g={}}G(fs,Ae);var ps=[];function Fs(P){zt(P.g,function(Z,ne){this.g.hasOwnProperty(ne)&&Ni(Z)},P),P.g={}}fs.prototype.N=function(){fs.Z.N.call(this),Fs(this)},fs.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var ms=_.JSON.stringify,Ke=_.JSON.parse,se=class{stringify(P){return _.JSON.stringify(P,void 0)}parse(P){return _.JSON.parse(P,void 0)}};function le(){}function fe(){}var Se={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function De(){Pe.call(this,"d")}G(De,Pe);function Ze(){Pe.call(this,"c")}G(Ze,Pe);var et={},Xe=null;function _t(){return Xe=Xe||new Bi}et.Ia="serverreachability";function It(P){Pe.call(this,et.Ia,P)}G(It,Pe);function xt(P){const Z=_t();fr(Z,new It(Z))}et.STAT_EVENT="statevent";function tn(P,Z){Pe.call(this,et.STAT_EVENT,P),this.stat=Z}G(tn,Pe);function $e(P){const Z=_t();fr(Z,new tn(Z,P))}et.Ja="timingevent";function vn(P,Z){Pe.call(this,et.Ja,P),this.size=Z}G(vn,Pe);function Rn(P,Z){if(typeof P!="function")throw Error("Fn must not be null and must be a function");return _.setTimeout(function(){P()},Z)}function nn(){this.g=!0}nn.prototype.ua=function(){this.g=!1};function Nn(P,Z,ne,ye,at,ht){P.info(function(){if(P.g)if(ht){var Wt="",kn=ht.split("&");for(let wi=0;wi<kn.length;wi++){var Wn=kn[wi].split("=");if(Wn.length>1){const Xi=Wn[0];Wn=Wn[1];const qa=Xi.split("_");Wt=qa.length>=2&&qa[1]=="type"?Wt+(Xi+"="+Wn+"&"):Wt+(Xi+"=redacted&")}}}else Wt=null;else Wt=ht;return"XMLHTTP REQ ("+ye+") [attempt "+at+"]: "+Z+`
`+ne+`
`+Wt})}function Pi(P,Z,ne,ye,at,ht,Wt){P.info(function(){return"XMLHTTP RESP ("+ye+") [ attempt "+at+"]: "+Z+`
`+ne+`
`+ht+" "+Wt})}function $i(P,Z,ne,ye){P.info(function(){return"XMLHTTP TEXT ("+Z+"): "+Cr(P,ne)+(ye?" "+ye:"")})}function er(P,Z){P.info(function(){return"TIMEOUT: "+Z})}nn.prototype.info=function(){};function Cr(P,Z){if(!P.g)return Z;if(!Z)return null;try{const ht=JSON.parse(Z);if(ht){for(P=0;P<ht.length;P++)if(Array.isArray(ht[P])){var ne=ht[P];if(!(ne.length<2)){var ye=ne[1];if(Array.isArray(ye)&&!(ye.length<1)){var at=ye[0];if(at!="noop"&&at!="stop"&&at!="close")for(let Wt=1;Wt<ye.length;Wt++)ye[Wt]=""}}}}return ms(ht)}catch{return Z}}var Vn={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},Kn={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},vr;function Pt(){}G(Pt,le),Pt.prototype.g=function(){return new XMLHttpRequest},vr=new Pt;function en(P){return encodeURIComponent(String(P))}function tr(P){var Z=1;P=P.split(":");const ne=[];for(;Z>0&&P.length;)ne.push(P.shift()),Z--;return P.length&&ne.push(P.join(":")),ne}function ta(P,Z,ne,ye){this.j=P,this.i=Z,this.l=ne,this.S=ye||1,this.V=new fs(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new Aa}function Aa(){this.i=null,this.g="",this.h=!1}var Lt={},yn={};function Mn(P,Z,ne){P.M=1,P.A=Fi(qi(Z)),P.u=ne,P.R=!0,nr(P,null)}function nr(P,Z){P.F=Date.now(),Vs(P),P.B=qi(P.A);var ne=P.B,ye=P.S;Array.isArray(ye)||(ye=[String(ye)]),$a(ne.i,"t",ye),P.C=0,ne=P.j.L,P.h=new Aa,P.g=Dl(P.j,ne?Z:null,!P.u),P.P>0&&(P.O=new $r(k(P.Y,P,P.g),P.P)),Z=P.V,ne=P.g,ye=P.ba;var at="readystatechange";Array.isArray(at)||(at&&(ps[0]=at.toString()),at=ps);for(let ht=0;ht<at.length;ht++){const Wt=di(ne,at[ht],ye||Z.handleEvent,!1,Z.h||Z);if(!Wt)break;Z.g[Wt.key]=Wt}Z=P.J?ke(P.J):{},P.u?(P.v||(P.v="POST"),Z["Content-Type"]="application/x-www-form-urlencoded",P.g.ea(P.B,P.v,P.u,Z)):(P.v="GET",P.g.ea(P.B,P.v,null,Z)),xt(),Nn(P.i,P.v,P.B,P.l,P.S,P.u)}ta.prototype.ba=function(P){P=P.target;const Z=this.O;Z&&Yr(P)==3?Z.j():this.Y(P)},ta.prototype.Y=function(P){try{if(P==this.g)e:{const kn=Yr(this.g),Wn=this.g.ya(),wi=this.g.ca();if(!(kn<3)&&(kn!=3||this.g&&(this.h.h||this.g.la()||sr(this.g)))){this.K||kn!=4||Wn==7||(Wn==8||wi<=0?xt(3):xt(2)),gs(this);var Z=this.g.ca();this.X=Z;var ne=il(this);if(this.o=Z==200,Pi(this.i,this.v,this.B,this.l,this.S,kn,Z),this.o){if(this.U&&!this.L){t:{if(this.g){var ye,at=this.g;if((ye=at.g?at.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Re(ye)){var ht=ye;break t}}ht=null}if(P=ht)$i(this.i,this.l,P,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Si(this,P);else{this.o=!1,this.m=3,$e(12),Gr(this),qr(this);break e}}if(this.R){P=!0;let Xi;for(;!this.K&&this.C<ne.length;)if(Xi=Bn(this,ne),Xi==yn){kn==4&&(this.m=4,$e(14),P=!1),$i(this.i,this.l,null,"[Incomplete Response]");break}else if(Xi==Lt){this.m=4,$e(15),$i(this.i,this.l,ne,"[Invalid Chunk]"),P=!1;break}else $i(this.i,this.l,Xi,null),Si(this,Xi);if(Eo(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),kn!=4||ne.length!=0||this.h.h||(this.m=1,$e(16),P=!1),this.o=this.o&&P,!P)$i(this.i,this.l,ne,"[Invalid Chunked Response]"),Gr(this),qr(this);else if(ne.length>0&&!this.W){this.W=!0;var Wt=this.j;Wt.g==this&&Wt.aa&&!Wt.P&&(Wt.j.info("Great, no buffering proxy detected. Bytes received: "+ne.length),Uu(Wt),Wt.P=!0,$e(11))}}else $i(this.i,this.l,ne,null),Si(this,ne);kn==4&&Gr(this),this.o&&!this.K&&(kn==4?Hs(this.j,this):(this.o=!1,Vs(this)))}else vs(this.g),Z==400&&ne.indexOf("Unknown SID")>0?(this.m=3,$e(12)):(this.m=0,$e(13)),Gr(this),qr(this)}}}catch{}finally{}};function il(P){if(!Eo(P))return P.g.la();const Z=sr(P.g);if(Z==="")return"";let ne="";const ye=Z.length,at=Yr(P.g)==4;if(!P.h.i){if(typeof TextDecoder>"u")return Gr(P),qr(P),"";P.h.i=new _.TextDecoder}for(let ht=0;ht<ye;ht++)P.h.h=!0,ne+=P.h.i.decode(Z[ht],{stream:!(at&&ht==ye-1)});return Z.length=0,P.h.g+=ne,P.C=0,P.h.g}function Eo(P){return P.g?P.v=="GET"&&P.M!=2&&P.j.Aa:!1}function Bn(P,Z){var ne=P.C,ye=Z.indexOf(`
`,ne);return ye==-1?yn:(ne=Number(Z.substring(ne,ye)),isNaN(ne)?Lt:(ye+=1,ye+ne>Z.length?yn:(Z=Z.slice(ye,ye+ne),P.C=ye+ne,Z)))}ta.prototype.cancel=function(){this.K=!0,Gr(this)};function Vs(P){P.T=Date.now()+P.H,js(P,P.H)}function js(P,Z){if(P.D!=null)throw Error("WatchDog timer not null");P.D=Rn(k(P.aa,P),Z)}function gs(P){P.D&&(_.clearTimeout(P.D),P.D=null)}ta.prototype.aa=function(){this.D=null;const P=Date.now();P-this.T>=0?(er(this.i,this.B),this.M!=2&&(xt(),$e(17)),Gr(this),this.m=2,qr(this)):js(this,this.T-P)};function qr(P){P.j.I==0||P.K||Hs(P.j,P)}function Gr(P){gs(P);var Z=P.O;Z&&typeof Z.dispose=="function"&&Z.dispose(),P.O=null,Fs(P.V),P.g&&(Z=P.g,P.g=null,Z.abort(),Z.dispose())}function Si(P,Z){try{var ne=P.j;if(ne.I!=0&&(ne.g==P||ja(ne.h,P))){if(!P.L&&ja(ne.h,P)&&ne.I==3){try{var ye=ne.Ba.g.parse(Z)}catch{ye=null}if(Array.isArray(ye)&&ye.length==3){var at=ye;if(at[0]==0){e:if(!ne.v){if(ne.g)if(ne.g.F+3e3<P.F)Gl(ne),Io(ne);else break e;Hi(ne),$e(18)}}else ne.xa=at[1],0<ne.xa-ne.K&&at[2]<37500&&ne.F&&ne.A==0&&!ne.C&&(ne.C=Rn(k(ne.Va,ne),6e3));Ao(ne.h)<=1&&ne.ta&&(ne.ta=void 0)}else or(ne,11)}else if((P.L||ne.g==P)&&Gl(ne),!Re(Z))for(at=ne.Ba.g.parse(Z),Z=0;Z<at.length;Z++){let wi=at[Z];const Xi=wi[0];if(!(Xi<=ne.K))if(ne.K=Xi,wi=wi[1],ne.I==2)if(wi[0]=="c"){ne.M=wi[1],ne.ba=wi[2];const qa=wi[3];qa!=null&&(ne.ka=qa,ne.j.info("VER="+ne.ka));const Ga=wi[4];Ga!=null&&(ne.za=Ga,ne.j.info("SVER="+ne.za));const Xs=wi[5];Xs!=null&&typeof Xs=="number"&&Xs>0&&(ye=1.5*Xs,ne.O=ye,ne.j.info("backChannelRequestTimeoutMs_="+ye)),ye=ne;const Ts=P.g;if(Ts){const du=Ts.g?Ts.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(du){var ht=ye.h;ht.g||du.indexOf("spdy")==-1&&du.indexOf("quic")==-1&&du.indexOf("h2")==-1||(ht.j=ht.l,ht.g=new Set,ht.h&&(Co(ht,ht.h),ht.h=null))}if(ye.G){const Ws=Ts.g?Ts.g.getResponseHeader("X-HTTP-Session-Id"):null;Ws&&(ye.wa=Ws,on(ye.J,ye.G,Ws))}}ne.I=3,ne.l&&ne.l.ra(),ne.aa&&(ne.T=Date.now()-P.F,ne.j.info("Handshake RTT: "+ne.T+"ms")),ye=ne;var Wt=P;if(ye.na=ws(ye,ye.L?ye.ba:null,ye.W),Wt.L){Us(ye.h,Wt);var kn=Wt,Wn=ye.O;Wn&&(kn.H=Wn),kn.D&&(gs(kn),Vs(kn)),ye.g=Wt}else Po(ye);ne.i.length>0&&Ia(ne)}else wi[0]!="stop"&&wi[0]!="close"||or(ne,7);else ne.I==3&&(wi[0]=="stop"||wi[0]=="close"?wi[0]=="stop"?or(ne,7):Xn(ne):wi[0]!="noop"&&ne.l&&ne.l.qa(wi),ne.A=0)}}xt(4)}catch{}}var Mr=class{constructor(P,Z){this.g=P,this.map=Z}};function da(P){this.l=P||10,_.PerformanceNavigationTiming?(P=_.performance.getEntriesByType("navigation"),P=P.length>0&&(P[0].nextHopProtocol=="hq"||P[0].nextHopProtocol=="h2")):P=!!(_.chrome&&_.chrome.loadTimes&&_.chrome.loadTimes()&&_.chrome.loadTimes().wasFetchedViaSpdy),this.j=P?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function xi(P){return P.h?!0:P.g?P.g.size>=P.j:!1}function Ao(P){return P.h?1:P.g?P.g.size:0}function ja(P,Z){return P.h?P.h==Z:P.g?P.g.has(Z):!1}function Co(P,Z){P.g?P.g.add(Z):P.h=Z}function Us(P,Z){P.h&&P.h==Z?P.h=null:P.g&&P.g.has(Z)&&P.g.delete(Z)}da.prototype.cancel=function(){if(this.i=$s(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const P of this.g.values())P.cancel();this.g.clear()}};function $s(P){if(P.h!=null)return P.i.concat(P.h.G);if(P.g!=null&&P.g.size!==0){let Z=P.i;for(const ne of P.g.values())Z=Z.concat(ne.G);return Z}return Y(P.i)}var rl=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function ni(P,Z){if(P){P=P.split("&");for(let ne=0;ne<P.length;ne++){const ye=P[ne].indexOf("=");let at,ht=null;ye>=0?(at=P[ne].substring(0,ye),ht=P[ne].substring(ye+1)):at=P[ne],Z(at,ht?decodeURIComponent(ht.replace(/\+/g," ")):"")}}}function ci(P){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let Z;P instanceof ci?(this.l=P.l,br(this,P.j),this.o=P.o,this.g=P.g,qs(this,P.u),this.h=P.h,cu(this,Zs(P.i)),this.m=P.m):P&&(Z=String(P).match(rl))?(this.l=!1,br(this,Z[1]||"",!0),this.o=Ca(Z[2]||""),this.g=Ca(Z[3]||"",!0),qs(this,Z[4]),this.h=Ca(Z[5]||"",!0),cu(this,Z[6]||"",!0),this.m=Ca(Z[7]||"")):(this.l=!1,this.i=new Ua(null,this.l))}ci.prototype.toString=function(){const P=[];var Z=this.j;Z&&P.push(oo(Z,Mo,!0),":");var ne=this.g;return(ne||Z=="file")&&(P.push("//"),(Z=this.o)&&P.push(oo(Z,Mo,!0),"@"),P.push(en(ne).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),ne=this.u,ne!=null&&P.push(":",String(ne))),(ne=this.h)&&(this.g&&ne.charAt(0)!="/"&&P.push("/"),P.push(oo(ne,ne.charAt(0)=="/"?Gs:Rl,!0))),(ne=this.i.toString())&&P.push("?",ne),(ne=this.m)&&P.push("#",oo(ne,Qa)),P.join("")},ci.prototype.resolve=function(P){const Z=qi(this);let ne=!!P.j;ne?br(Z,P.j):ne=!!P.o,ne?Z.o=P.o:ne=!!P.g,ne?Z.g=P.g:ne=P.u!=null;var ye=P.h;if(ne)qs(Z,P.u);else if(ne=!!P.h){if(ye.charAt(0)!="/")if(this.g&&!this.h)ye="/"+ye;else{var at=Z.h.lastIndexOf("/");at!=-1&&(ye=Z.h.slice(0,at+1)+ye)}if(at=ye,at==".."||at==".")ye="";else if(at.indexOf("./")!=-1||at.indexOf("/.")!=-1){ye=at.lastIndexOf("/",0)==0,at=at.split("/");const ht=[];for(let Wt=0;Wt<at.length;){const kn=at[Wt++];kn=="."?ye&&Wt==at.length&&ht.push(""):kn==".."?((ht.length>1||ht.length==1&&ht[0]!="")&&ht.pop(),ye&&Wt==at.length&&ht.push("")):(ht.push(kn),ye=!0)}ye=ht.join("/")}else ye=at}return ne?Z.h=ye:ne=P.i.toString()!=="",ne?cu(Z,Zs(P.i)):ne=!!P.m,ne&&(Z.m=P.m),Z};function qi(P){return new ci(P)}function br(P,Z,ne){P.j=ne?Ca(Z,!0):Z,P.j&&(P.j=P.j.replace(/:$/,""))}function qs(P,Z){if(Z){if(Z=Number(Z),isNaN(Z)||Z<0)throw Error("Bad port number "+Z);P.u=Z}else P.u=null}function cu(P,Z,ne){Z instanceof Ua?(P.i=Z,ys(P.i,P.l)):(ne||(Z=oo(Z,rr)),P.i=new Ua(Z,P.l))}function on(P,Z,ne){P.i.set(Z,ne)}function Fi(P){return on(P,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),P}function Ca(P,Z){return P?Z?decodeURI(P.replace(/%25/g,"%2525")):decodeURIComponent(P):""}function oo(P,Z,ne){return typeof P=="string"?(P=encodeURI(P).replace(Z,ir),ne&&(P=P.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),P):null}function ir(P){return P=P.charCodeAt(0),"%"+(P>>4&15).toString(16)+(P&15).toString(16)}var Mo=/[#\/\?@]/g,Rl=/[#\?:]/g,Gs=/[#\?]/g,rr=/[#\?@]/g,Qa=/#/g;function Ua(P,Z){this.h=this.g=null,this.i=P||null,this.j=!!Z}function Gi(P){P.g||(P.g=new Map,P.h=0,P.i&&ni(P.i,function(Z,ne){P.add(decodeURIComponent(Z.replace(/\+/g," ")),ne)}))}i=Ua.prototype,i.add=function(P,Z){Gi(this),this.i=null,P=Ln(this,P);let ne=this.g.get(P);return ne||this.g.set(P,ne=[]),ne.push(Z),this.h+=1,this};function jn(P,Z){Gi(P),Z=Ln(P,Z),P.g.has(Z)&&(P.i=null,P.h-=P.g.get(Z).length,P.g.delete(Z))}function Ja(P,Z){return Gi(P),Z=Ln(P,Z),P.g.has(Z)}i.forEach=function(P,Z){Gi(this),this.g.forEach(function(ne,ye){ne.forEach(function(at){P.call(Z,at,ye,this)},this)},this)};function _s(P,Z){Gi(P);let ne=[];if(typeof Z=="string")Ja(P,Z)&&(ne=ne.concat(P.g.get(Ln(P,Z))));else for(P=Array.from(P.g.values()),Z=0;Z<P.length;Z++)ne=ne.concat(P[Z]);return ne}i.set=function(P,Z){return Gi(this),this.i=null,P=Ln(this,P),Ja(this,P)&&(this.h-=this.g.get(P).length),this.g.set(P,[Z]),this.h+=1,this},i.get=function(P,Z){return P?(P=_s(this,P),P.length>0?String(P[0]):Z):Z};function $a(P,Z,ne){jn(P,Z),ne.length>0&&(P.i=null,P.g.set(Ln(P,Z),Y(ne)),P.h+=ne.length)}i.toString=function(){if(this.i)return this.i;if(!this.g)return"";const P=[],Z=Array.from(this.g.keys());for(let ye=0;ye<Z.length;ye++){var ne=Z[ye];const at=en(ne);ne=_s(this,ne);for(let ht=0;ht<ne.length;ht++){let Wt=at;ne[ht]!==""&&(Wt+="="+en(ne[ht])),P.push(Wt)}}return this.i=P.join("&")};function Zs(P){const Z=new Ua;return Z.i=P.i,P.g&&(Z.g=new Map(P.g),Z.h=P.h),Z}function Ln(P,Z){return Z=String(Z),P.j&&(Z=Z.toLowerCase()),Z}function ys(P,Z){Z&&!P.j&&(Gi(P),P.i=null,P.g.forEach(function(ne,ye){const at=ye.toLowerCase();ye!=at&&(jn(this,ye),$a(this,at,ne))},P)),P.j=Z}function Ma(P,Z){const ne=new nn;if(_.Image){const ye=new Image;ye.onload=j(Zi,ne,"TestLoadImage: loaded",!0,Z,ye),ye.onerror=j(Zi,ne,"TestLoadImage: error",!1,Z,ye),ye.onabort=j(Zi,ne,"TestLoadImage: abort",!1,Z,ye),ye.ontimeout=j(Zi,ne,"TestLoadImage: timeout",!1,Z,ye),_.setTimeout(function(){ye.ontimeout&&ye.ontimeout()},1e4),ye.src=P}else Z(!1)}function Ll(P,Z){const ne=new nn,ye=new AbortController,at=setTimeout(()=>{ye.abort(),Zi(ne,"TestPingServer: timeout",!1,Z)},1e4);fetch(P,{signal:ye.signal}).then(ht=>{clearTimeout(at),ht.ok?Zi(ne,"TestPingServer: ok",!0,Z):Zi(ne,"TestPingServer: server error",!1,Z)}).catch(()=>{clearTimeout(at),Zi(ne,"TestPingServer: error",!1,Z)})}function Zi(P,Z,ne,ye,at){try{at&&(at.onload=null,at.onerror=null,at.onabort=null,at.ontimeout=null),ye(ne)}catch{}}function pr(){this.g=new se}function hn(P){this.i=P.Sb||null,this.h=P.ab||!1}G(hn,le),hn.prototype.g=function(){return new fi(this.i,this.h)};function fi(P,Z){Bi.call(this),this.H=P,this.o=Z,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}G(fi,Bi),i=fi.prototype,i.open=function(P,Z){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=P,this.D=Z,this.readyState=1,ar(this)},i.send=function(P){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const Z={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};P&&(Z.body=P),(this.H||_).fetch(new Request(this.D,Z)).then(this.Pa.bind(this),this.ga.bind(this))},i.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,al(this)),this.readyState=0},i.Pa=function(P){if(this.g&&(this.l=P,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=P.headers,this.readyState=2,ar(this)),this.g&&(this.readyState=3,ar(this),this.g)))if(this.responseType==="arraybuffer")P.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof _.ReadableStream<"u"&&"body"in P){if(this.j=P.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;xn(this)}else P.text().then(this.Oa.bind(this),this.ga.bind(this))};function xn(P){P.j.read().then(P.Ma.bind(P)).catch(P.ga.bind(P))}i.Ma=function(P){if(this.g){if(this.o&&P.value)this.response.push(P.value);else if(!this.o){var Z=P.value?P.value:new Uint8Array(0);(Z=this.B.decode(Z,{stream:!P.done}))&&(this.response=this.responseText+=Z)}P.done?al(this):ar(this),this.readyState==3&&xn(this)}},i.Oa=function(P){this.g&&(this.response=this.responseText=P,al(this))},i.Na=function(P){this.g&&(this.response=P,al(this))},i.ga=function(){this.g&&al(this)};function al(P){P.readyState=4,P.l=null,P.j=null,P.B=null,ar(P)}i.setRequestHeader=function(P,Z){this.A.append(P,Z)},i.getResponseHeader=function(P){return this.h&&this.h.get(P.toLowerCase())||""},i.getAllResponseHeaders=function(){if(!this.h)return"";const P=[],Z=this.h.entries();for(var ne=Z.next();!ne.done;)ne=ne.value,P.push(ne[0]+": "+ne[1]),ne=Z.next();return P.join(`\r
`)};function ar(P){P.onreadystatechange&&P.onreadystatechange.call(P)}Object.defineProperty(fi.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(P){this.m=P?"include":"same-origin"}});function ur(P){let Z="";return zt(P,function(ne,ye){Z+=ye,Z+=":",Z+=ne,Z+=`\r
`}),Z}function xr(P,Z,ne){e:{for(ye in ne){var ye=!1;break e}ye=!0}ye||(ne=ur(ne),typeof P=="string"?ne!=null&&en(ne):on(P,Z,ne))}function bn(P){Bi.call(this),this.headers=new Map,this.L=P||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}G(bn,Bi);var fa=/^https?$/i,fn=["POST","PUT"];i=bn.prototype,i.Fa=function(P){this.H=P},i.ea=function(P,Z,ne,ye){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+P);Z=Z?Z.toUpperCase():"GET",this.D=P,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():vr.g(),this.g.onreadystatechange=ee(k(this.Ca,this));try{this.B=!0,this.g.open(Z,String(P),!0),this.B=!1}catch(ht){sn(this,ht);return}if(P=ne||"",ne=new Map(this.headers),ye)if(Object.getPrototypeOf(ye)===Object.prototype)for(var at in ye)ne.set(at,ye[at]);else if(typeof ye.keys=="function"&&typeof ye.get=="function")for(const ht of ye.keys())ne.set(ht,ye.get(ht));else throw Error("Unknown input type for opt_headers: "+String(ye));ye=Array.from(ne.keys()).find(ht=>ht.toLowerCase()=="content-type"),at=_.FormData&&P instanceof _.FormData,!(Array.prototype.indexOf.call(fn,Z,void 0)>=0)||ye||at||ne.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[ht,Wt]of ne)this.g.setRequestHeader(ht,Wt);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(P),this.v=!1}catch(ht){sn(this,ht)}};function sn(P,Z){P.h=!1,P.g&&(P.j=!0,P.g.abort(),P.j=!1),P.l=Z,P.o=5,na(P),Dr(P)}function na(P){P.A||(P.A=!0,fr(P,"complete"),fr(P,"error"))}i.abort=function(P){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=P||7,fr(this,"complete"),fr(this,"abort"),Dr(this))},i.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Dr(this,!0)),bn.Z.N.call(this)},i.Ca=function(){this.u||(this.B||this.v||this.j?$n(this):this.Xa())},i.Xa=function(){$n(this)};function $n(P){if(P.h&&typeof g<"u"){if(P.v&&Yr(P)==4)setTimeout(P.Ca.bind(P),0);else if(fr(P,"readystatechange"),Yr(P)==4){P.h=!1;try{const ht=P.ca();e:switch(ht){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var Z=!0;break e;default:Z=!1}var ne;if(!(ne=Z)){var ye;if(ye=ht===0){let Wt=String(P.D).match(rl)[1]||null;!Wt&&_.self&&_.self.location&&(Wt=_.self.location.protocol.slice(0,-1)),ye=!fa.test(Wt?Wt.toLowerCase():"")}ne=ye}if(ne)fr(P,"complete"),fr(P,"success");else{P.o=6;try{var at=Yr(P)>2?P.g.statusText:""}catch{at=""}P.l=at+" ["+P.ca()+"]",na(P)}}finally{Dr(P)}}}}function Dr(P,Z){if(P.g){P.m&&(clearTimeout(P.m),P.m=null);const ne=P.g;P.g=null,Z||fr(P,"ready");try{ne.onreadystatechange=null}catch{}}}i.isActive=function(){return!!this.g};function Yr(P){return P.g?P.g.readyState:0}i.ca=function(){try{return Yr(this)>2?this.g.status:-1}catch{return-1}},i.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},i.La=function(P){if(this.g){var Z=this.g.responseText;return P&&Z.indexOf(P)==0&&(Z=Z.substring(P.length)),Ke(Z)}};function sr(P){try{if(!P.g)return null;if("response"in P.g)return P.g.response;switch(P.F){case"":case"text":return P.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in P.g)return P.g.mozResponseArrayBuffer}return null}catch{return null}}function vs(P){const Z={};P=(P.g&&Yr(P)>=2&&P.g.getAllResponseHeaders()||"").split(`\r
`);for(let ye=0;ye<P.length;ye++){if(Re(P[ye]))continue;var ne=tr(P[ye]);const at=ne[0];if(ne=ne[1],typeof ne!="string")continue;ne=ne.trim();const ht=Z[at]||[];Z[at]=ht,ht.push(ne)}Bt(Z,function(ye){return ye.join(", ")})}i.ya=function(){return this.o},i.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function lo(P,Z,ne){return ne&&ne.internalChannelParams&&ne.internalChannelParams[P]||Z}function bs(P){this.za=0,this.i=[],this.j=new nn,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=lo("failFast",!1,P),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=lo("baseRetryDelayMs",5e3,P),this.Za=lo("retryDelaySeedMs",1e4,P),this.Ta=lo("forwardChannelMaxRetries",2,P),this.va=lo("forwardChannelRequestTimeoutMs",2e4,P),this.ma=P&&P.xmlHttpFactory||void 0,this.Ua=P&&P.Rb||void 0,this.Aa=P&&P.useFetchStreams||!1,this.O=void 0,this.L=P&&P.supportsCrossDomainXhr||!1,this.M="",this.h=new da(P&&P.concurrentRequestLimit),this.Ba=new pr,this.S=P&&P.fastHandshake||!1,this.R=P&&P.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=P&&P.Pb||!1,P&&P.ua&&this.j.ua(),P&&P.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&P&&P.detectBufferingProxy||!1,this.ia=void 0,P&&P.longPollingTimeout&&P.longPollingTimeout>0&&(this.ia=P.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}i=bs.prototype,i.ka=8,i.I=1,i.connect=function(P,Z,ne,ye){$e(0),this.W=P,this.H=Z||{},ne&&ye!==void 0&&(this.H.OSID=ne,this.H.OAID=ye),this.F=this.X,this.J=ws(this,null,this.W),Ia(this)};function Xn(P){if(ia(P),P.I==3){var Z=P.V++,ne=qi(P.J);if(on(ne,"SID",P.M),on(ne,"RID",Z),on(ne,"TYPE","terminate"),xs(P,ne),Z=new ta(P,P.j,Z),Z.M=2,Z.A=Fi(qi(ne)),ne=!1,_.navigator&&_.navigator.sendBeacon)try{ne=_.navigator.sendBeacon(Z.A.toString(),"")}catch{}!ne&&_.Image&&(new Image().src=Z.A,ne=!0),ne||(Z.g=Dl(Z.j,null),Z.g.ea(Z.A)),Z.F=Date.now(),Vs(Z)}es(P)}function Io(P){P.g&&(Uu(P),P.g.cancel(),P.g=null)}function ia(P){Io(P),P.v&&(_.clearTimeout(P.v),P.v=null),Gl(P),P.h.cancel(),P.m&&(typeof P.m=="number"&&_.clearTimeout(P.m),P.m=null)}function Ia(P){if(!xi(P.h)&&!P.m){P.m=!0;var Z=P.Ea;Ue||ce(),Be||(Ue(),Be=!0),de.add(Z,P),P.D=0}}function Pa(P,Z){return Ao(P.h)>=P.h.j-(P.m?1:0)?!1:P.m?(P.i=Z.G.concat(P.i),!0):P.I==1||P.I==2||P.D>=(P.Sa?0:P.Ta)?!1:(P.m=Rn(k(P.Ea,P,Z),kl(P,P.D)),P.D++,!0)}i.Ea=function(P){if(this.m)if(this.m=null,this.I==1){if(!P){this.V=Math.floor(Math.random()*1e5),P=this.V++;const at=new ta(this,this.j,P);let ht=this.o;if(this.U&&(ht?(ht=ke(ht),Ot(ht,this.U)):ht=this.U),this.u!==null||this.R||(at.J=ht,ht=null),this.S)e:{for(var Z=0,ne=0;ne<this.i.length;ne++){t:{var ye=this.i[ne];if("__data__"in ye.map&&(ye=ye.map.__data__,typeof ye=="string")){ye=ye.length;break t}ye=void 0}if(ye===void 0)break;if(Z+=ye,Z>4096){Z=ne;break e}if(Z===4096||ne===this.i.length-1){Z=ne+1;break e}}Z=1e3}else Z=1e3;Z=ql(this,at,Z),ne=qi(this.J),on(ne,"RID",P),on(ne,"CVER",22),this.G&&on(ne,"X-HTTP-Session-Id",this.G),xs(this,ne),ht&&(this.R?Z="headers="+en(ur(ht))+"&"+Z:this.u&&xr(ne,this.u,ht)),Co(this.h,at),this.Ra&&on(ne,"TYPE","init"),this.S?(on(ne,"$req",Z),on(ne,"SID","null"),at.U=!0,Mn(at,ne,null)):Mn(at,ne,Z),this.I=2}}else this.I==3&&(P?zr(this,P):this.i.length==0||xi(this.h)||zr(this))};function zr(P,Z){var ne;Z?ne=Z.l:ne=P.V++;const ye=qi(P.J);on(ye,"SID",P.M),on(ye,"RID",ne),on(ye,"AID",P.K),xs(P,ye),P.u&&P.o&&xr(ye,P.u,P.o),ne=new ta(P,P.j,ne,P.D+1),P.u===null&&(ne.J=P.o),Z&&(P.i=Z.G.concat(P.i)),Z=ql(P,ne,1e3),ne.H=Math.round(P.va*.5)+Math.round(P.va*.5*Math.random()),Co(P.h,ne),Mn(ne,ye,Z)}function xs(P,Z){P.H&&zt(P.H,function(ne,ye){on(Z,ye,ne)}),P.l&&zt({},function(ne,ye){on(Z,ye,ne)})}function ql(P,Z,ne){ne=Math.min(P.i.length,ne);const ye=P.l?k(P.l.Ka,P.l,P):null;e:{var at=P.i;let kn=-1;for(;;){const Wn=["count="+ne];kn==-1?ne>0?(kn=at[0].g,Wn.push("ofs="+kn)):kn=0:Wn.push("ofs="+kn);let wi=!0;for(let Xi=0;Xi<ne;Xi++){var ht=at[Xi].g;const qa=at[Xi].map;if(ht-=kn,ht<0)kn=Math.max(0,at[Xi].g-100),wi=!1;else try{ht="req"+ht+"_"||"";try{var Wt=qa instanceof Map?qa:Object.entries(qa);for(const[Ga,Xs]of Wt){let Ts=Xs;c(Xs)&&(Ts=ms(Xs)),Wn.push(ht+Ga+"="+encodeURIComponent(Ts))}}catch(Ga){throw Wn.push(ht+"type="+encodeURIComponent("_badmap")),Ga}}catch{ye&&ye(qa)}}if(wi){Wt=Wn.join("&");break e}}Wt=void 0}return P=P.i.splice(0,ne),Z.G=P,Wt}function Po(P){if(!P.g&&!P.v){P.Y=1;var Z=P.Da;Ue||ce(),Be||(Ue(),Be=!0),de.add(Z,P),P.A=0}}function Hi(P){return P.g||P.v||P.A>=3?!1:(P.Y++,P.v=Rn(k(P.Da,P),kl(P,P.A)),P.A++,!0)}i.Da=function(){if(this.v=null,sl(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var P=4*this.T;this.j.info("BP detection timer enabled: "+P),this.B=Rn(k(this.Wa,this),P)}},i.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,$e(10),Io(this),sl(this))};function Uu(P){P.B!=null&&(_.clearTimeout(P.B),P.B=null)}function sl(P){P.g=new ta(P,P.j,"rpc",P.Y),P.u===null&&(P.g.J=P.o),P.g.P=0;var Z=qi(P.na);on(Z,"RID","rpc"),on(Z,"SID",P.M),on(Z,"AID",P.K),on(Z,"CI",P.F?"0":"1"),!P.F&&P.ia&&on(Z,"TO",P.ia),on(Z,"TYPE","xmlhttp"),xs(P,Z),P.u&&P.o&&xr(Z,P.u,P.o),P.O&&(P.g.H=P.O);var ne=P.g;P=P.ba,ne.M=1,ne.A=Fi(qi(Z)),ne.u=null,ne.R=!0,nr(ne,P)}i.Va=function(){this.C!=null&&(this.C=null,Io(this),Hi(this),$e(19))};function Gl(P){P.C!=null&&(_.clearTimeout(P.C),P.C=null)}function Hs(P,Z){var ne=null;if(P.g==Z){Gl(P),Uu(P),P.g=null;var ye=2}else if(ja(P.h,Z))ne=Z.G,Us(P.h,Z),ye=1;else return;if(P.I!=0){if(Z.o)if(ye==1){ne=Z.u?Z.u.length:0,Z=Date.now()-Z.F;var at=P.D;ye=_t(),fr(ye,new vn(ye,ne)),Ia(P)}else Po(P);else if(at=Z.m,at==3||at==0&&Z.X>0||!(ye==1&&Pa(P,Z)||ye==2&&Hi(P)))switch(ne&&ne.length>0&&(Z=P.h,Z.i=Z.i.concat(ne)),at){case 1:or(P,5);break;case 4:or(P,10);break;case 3:or(P,6);break;default:or(P,2)}}}function kl(P,Z){let ne=P.Qa+Math.floor(Math.random()*P.Za);return P.isActive()||(ne*=2),ne*Z}function or(P,Z){if(P.j.info("Error code "+Z),Z==2){var ne=k(P.bb,P),ye=P.Ua;const at=!ye;ye=new ci(ye||"//www.google.com/images/cleardot.gif"),_.location&&_.location.protocol=="http"||br(ye,"https"),Fi(ye),at?Ma(ye.toString(),ne):Ll(ye.toString(),ne)}else $e(2);P.I=0,P.l&&P.l.pa(Z),es(P),ia(P)}i.bb=function(P){P?(this.j.info("Successfully pinged google.com"),$e(2)):(this.j.info("Failed to ping google.com"),$e(1))};function es(P){if(P.I=0,P.ja=[],P.l){const Z=$s(P.h);(Z.length!=0||P.i.length!=0)&&(xe(P.ja,Z),xe(P.ja,P.i),P.h.i.length=0,Y(P.i),P.i.length=0),P.l.oa()}}function ws(P,Z,ne){var ye=ne instanceof ci?qi(ne):new ci(ne);if(ye.g!="")Z&&(ye.g=Z+"."+ye.g),qs(ye,ye.u);else{var at=_.location;ye=at.protocol,Z=Z?Z+"."+at.hostname:at.hostname,at=+at.port;const ht=new ci(null);ye&&br(ht,ye),Z&&(ht.g=Z),at&&qs(ht,at),ne&&(ht.h=ne),ye=ht}return ne=P.G,Z=P.wa,ne&&Z&&on(ye,ne,Z),on(ye,"VER",P.ka),xs(P,ye),ye}function Dl(P,Z,ne){if(Z&&!P.L)throw Error("Can't create secondary domain capable XhrIo object.");return Z=P.Aa&&!P.ma?new bn(new hn({ab:ne})):new bn(P.ma),Z.Fa(P.L),Z}i.isActive=function(){return!!this.l&&this.l.isActive(this)};function ol(){}i=ol.prototype,i.ra=function(){},i.qa=function(){},i.pa=function(){},i.oa=function(){},i.isActive=function(){return!0},i.Ka=function(){};function uo(){}uo.prototype.g=function(P,Z){return new Ei(P,Z)};function Ei(P,Z){Bi.call(this),this.g=new bs(Z),this.l=P,this.h=Z&&Z.messageUrlParams||null,P=Z&&Z.messageHeaders||null,Z&&Z.clientProtocolHeaderRequired&&(P?P["X-Client-Protocol"]="webchannel":P={"X-Client-Protocol":"webchannel"}),this.g.o=P,P=Z&&Z.initMessageHeaders||null,Z&&Z.messageContentType&&(P?P["X-WebChannel-Content-Type"]=Z.messageContentType:P={"X-WebChannel-Content-Type":Z.messageContentType}),Z&&Z.sa&&(P?P["X-WebChannel-Client-Profile"]=Z.sa:P={"X-WebChannel-Client-Profile":Z.sa}),this.g.U=P,(P=Z&&Z.Qb)&&!Re(P)&&(this.g.u=P),this.A=Z&&Z.supportsCrossDomainXhr||!1,this.v=Z&&Z.sendRawJson||!1,(Z=Z&&Z.httpSessionIdParam)&&!Re(Z)&&(this.g.G=Z,P=this.h,P!==null&&Z in P&&(P=this.h,Z in P&&delete P[Z])),this.j=new zl(this)}G(Ei,Bi),Ei.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},Ei.prototype.close=function(){Xn(this.g)},Ei.prototype.o=function(P){var Z=this.g;if(typeof P=="string"){var ne={};ne.__data__=P,P=ne}else this.v&&(ne={},ne.__data__=ms(P),P=ne);Z.i.push(new Mr(Z.Ya++,P)),Z.I==3&&Ia(Z)},Ei.prototype.N=function(){this.g.l=null,delete this.j,Xn(this.g),delete this.g,Ei.Z.N.call(this)};function $u(P){De.call(this),P.__headers__&&(this.headers=P.__headers__,this.statusCode=P.__status__,delete P.__headers__,delete P.__status__);var Z=P.__sm__;if(Z){e:{for(const ne in Z){P=ne;break e}P=void 0}(this.i=P)&&(P=this.i,Z=Z!==null&&P in Z?Z[P]:void 0),this.data=Z}else this.data=P}G($u,De);function hu(){Ze.call(this),this.status=1}G(hu,Ze);function zl(P){this.g=P}G(zl,ol),zl.prototype.ra=function(){fr(this.g,"a")},zl.prototype.qa=function(P){fr(this.g,new $u(P))},zl.prototype.pa=function(P){fr(this.g,new hu)},zl.prototype.oa=function(){fr(this.g,"b")},uo.prototype.createWebChannel=uo.prototype.g,Ei.prototype.send=Ei.prototype.o,Ei.prototype.open=Ei.prototype.m,Ei.prototype.close=Ei.prototype.close,EE=function(){return new uo},SE=function(){return _t()},TE=et,fx={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},Vn.NO_ERROR=0,Vn.TIMEOUT=8,Vn.HTTP_ERROR=6,Cv=Vn,Kn.COMPLETE="complete",wE=Kn,fe.EventType=Se,Se.OPEN="a",Se.CLOSE="b",Se.ERROR="c",Se.MESSAGE="d",Bi.prototype.listen=Bi.prototype.J,g_=fe,bn.prototype.listenOnce=bn.prototype.K,bn.prototype.getLastError=bn.prototype.Ha,bn.prototype.getLastErrorCode=bn.prototype.ya,bn.prototype.getStatus=bn.prototype.ca,bn.prototype.getResponseJson=bn.prototype.La,bn.prototype.getResponseText=bn.prototype.la,bn.prototype.send=bn.prototype.ea,bn.prototype.setWithCredentials=bn.prototype.Fa,xE=bn}).apply(typeof cv<"u"?cv:typeof self<"u"?self:typeof window<"u"?window:{});const p2="@firebase/firestore",m2="4.9.2";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Il{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Il.UNAUTHENTICATED=new Il(null),Il.GOOGLE_CREDENTIALS=new Il("google-credentials-uid"),Il.FIRST_PARTY=new Il("first-party-uid"),Il.MOCK_USER=new Il("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ig="12.3.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kp=new A0("@firebase/firestore");function km(){return kp.logLevel}function gn(i,...e){if(kp.logLevel<=Ji.DEBUG){const n=e.map(_1);kp.debug(`Firestore (${ig}): ${i}`,...n)}}function Nd(i,...e){if(kp.logLevel<=Ji.ERROR){const n=e.map(_1);kp.error(`Firestore (${ig}): ${i}`,...n)}}function Hm(i,...e){if(kp.logLevel<=Ji.WARN){const n=e.map(_1);kp.warn(`Firestore (${ig}): ${i}`,...n)}}function _1(i){if(typeof i=="string")return i;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return(function(n){return JSON.stringify(n)})(i)}catch{return i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hn(i,e,n){let o="Unexpected state";typeof e=="string"?o=e:n=e,AE(i,o,n)}function AE(i,e,n){let o=`FIRESTORE (${ig}) INTERNAL ASSERTION FAILED: ${e} (ID: ${i.toString(16)})`;if(n!==void 0)try{o+=" CONTEXT: "+JSON.stringify(n)}catch{o+=" CONTEXT: "+n}throw Nd(o),new Error(o)}function Ar(i,e,n,o){let d="Unexpected state";typeof n=="string"?d=n:o=n,i||AE(e,d,o)}function ai(i,e){return i}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kt={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class _n extends kf{constructor(e,n){super(e,n),this.code=e,this.message=n,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sf{constructor(){this.promise=new Promise(((e,n)=>{this.resolve=e,this.reject=n}))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CE{constructor(e,n){this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class C5{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,n){e.enqueueRetryable((()=>n(Il.UNAUTHENTICATED)))}shutdown(){}}class M5{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,n){this.changeListener=n,e.enqueueRetryable((()=>n(this.token.user)))}shutdown(){this.changeListener=null}}class I5{constructor(e){this.t=e,this.currentUser=Il.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,n){Ar(this.o===void 0,42304);let o=this.i;const d=M=>this.i!==o?(o=this.i,n(M)):Promise.resolve();let g=new Sf;this.o=()=>{this.i++,this.currentUser=this.u(),g.resolve(),g=new Sf,e.enqueueRetryable((()=>d(this.currentUser)))};const _=()=>{const M=g;e.enqueueRetryable((async()=>{await M.promise,await d(this.currentUser)}))},c=M=>{gn("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=M,this.o&&(this.auth.addAuthTokenListener(this.o),_())};this.t.onInit((M=>c(M))),setTimeout((()=>{if(!this.auth){const M=this.t.getImmediate({optional:!0});M?c(M):(gn("FirebaseAuthCredentialsProvider","Auth not yet detected"),g.resolve(),g=new Sf)}}),0),_()}getToken(){const e=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then((o=>this.i!==e?(gn("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):o?(Ar(typeof o.accessToken=="string",31837,{l:o}),new CE(o.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Ar(e===null||typeof e=="string",2055,{h:e}),new Il(e)}}class P5{constructor(e,n,o){this.P=e,this.T=n,this.I=o,this.type="FirstParty",this.user=Il.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class R5{constructor(e,n,o){this.P=e,this.T=n,this.I=o}getToken(){return Promise.resolve(new P5(this.P,this.T,this.I))}start(e,n){e.enqueueRetryable((()=>n(Il.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class g2{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class L5{constructor(e,n){this.V=n,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,f5(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,n){Ar(this.o===void 0,3512);const o=g=>{g.error!=null&&gn("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${g.error.message}`);const _=g.token!==this.m;return this.m=g.token,gn("FirebaseAppCheckTokenProvider",`Received ${_?"new":"existing"} token.`),_?n(g.token):Promise.resolve()};this.o=g=>{e.enqueueRetryable((()=>o(g)))};const d=g=>{gn("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=g,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((g=>d(g))),setTimeout((()=>{if(!this.appCheck){const g=this.V.getImmediate({optional:!0});g?d(g):gn("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new g2(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((n=>n?(Ar(typeof n.token=="string",44558,{tokenResult:n}),this.m=n.token,new g2(n.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function k5(i){const e=typeof self<"u"&&(self.crypto||self.msCrypto),n=new Uint8Array(i);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(n);else for(let o=0;o<i;o++)n[o]=Math.floor(256*Math.random());return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class y1{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=62*Math.floor(4.129032258064516);let o="";for(;o.length<20;){const d=k5(40);for(let g=0;g<d.length;++g)o.length<20&&d[g]<n&&(o+=e.charAt(d[g]%62))}return o}}function zi(i,e){return i<e?-1:i>e?1:0}function px(i,e){const n=Math.min(i.length,e.length);for(let o=0;o<n;o++){const d=i.charAt(o),g=e.charAt(o);if(d!==g)return Lb(d)===Lb(g)?zi(d,g):Lb(d)?1:-1}return zi(i.length,e.length)}const D5=55296,z5=57343;function Lb(i){const e=i.charCodeAt(0);return e>=D5&&e<=z5}function Xm(i,e,n){return i.length===e.length&&i.every(((o,d)=>n(o,e[d])))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _2="__name__";class Nh{constructor(e,n,o){n===void 0?n=0:n>e.length&&Hn(637,{offset:n,range:e.length}),o===void 0?o=e.length-n:o>e.length-n&&Hn(1746,{length:o,range:e.length-n}),this.segments=e,this.offset=n,this.len=o}get length(){return this.len}isEqual(e){return Nh.comparator(this,e)===0}child(e){const n=this.segments.slice(this.offset,this.limit());return e instanceof Nh?e.forEach((o=>{n.push(o)})):n.push(e),this.construct(n)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}forEach(e){for(let n=this.offset,o=this.limit();n<o;n++)e(this.segments[n])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,n){const o=Math.min(e.length,n.length);for(let d=0;d<o;d++){const g=Nh.compareSegments(e.get(d),n.get(d));if(g!==0)return g}return zi(e.length,n.length)}static compareSegments(e,n){const o=Nh.isNumericId(e),d=Nh.isNumericId(n);return o&&!d?-1:!o&&d?1:o&&d?Nh.extractNumericId(e).compare(Nh.extractNumericId(n)):px(e,n)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Tf.fromString(e.substring(4,e.length-2))}}class ea extends Nh{construct(e,n,o){return new ea(e,n,o)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const n=[];for(const o of e){if(o.indexOf("//")>=0)throw new _n(kt.INVALID_ARGUMENT,`Invalid segment (${o}). Paths must not contain // in them.`);n.push(...o.split("/").filter((d=>d.length>0)))}return new ea(n)}static emptyPath(){return new ea([])}}const O5=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class tl extends Nh{construct(e,n,o){return new tl(e,n,o)}static isValidIdentifier(e){return O5.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),tl.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===_2}static keyField(){return new tl([_2])}static fromServerFormat(e){const n=[];let o="",d=0;const g=()=>{if(o.length===0)throw new _n(kt.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);n.push(o),o=""};let _=!1;for(;d<e.length;){const c=e[d];if(c==="\\"){if(d+1===e.length)throw new _n(kt.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const M=e[d+1];if(M!=="\\"&&M!=="."&&M!=="`")throw new _n(kt.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);o+=M,d+=2}else c==="`"?(_=!_,d++):c!=="."||_?(o+=c,d++):(g(),d++)}if(g(),_)throw new _n(kt.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new tl(n)}static emptyPath(){return new tl([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class On{constructor(e){this.path=e}static fromPath(e){return new On(ea.fromString(e))}static fromName(e){return new On(ea.fromString(e).popFirst(5))}static empty(){return new On(ea.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&ea.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,n){return ea.comparator(e.path,n.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new On(new ea(e.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ME(i,e,n){if(!n)throw new _n(kt.INVALID_ARGUMENT,`Function ${i}() cannot be called with an empty ${e}.`)}function N5(i,e,n,o){if(e===!0&&o===!0)throw new _n(kt.INVALID_ARGUMENT,`${i} and ${n} cannot be used together.`)}function y2(i){if(!On.isDocumentKey(i))throw new _n(kt.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${i} has ${i.length}.`)}function v2(i){if(On.isDocumentKey(i))throw new _n(kt.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${i} has ${i.length}.`)}function IE(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}function C0(i){if(i===void 0)return"undefined";if(i===null)return"null";if(typeof i=="string")return i.length>20&&(i=`${i.substring(0,20)}...`),JSON.stringify(i);if(typeof i=="number"||typeof i=="boolean")return""+i;if(typeof i=="object"){if(i instanceof Array)return"an array";{const e=(function(o){return o.constructor?o.constructor.name:null})(i);return e?`a custom ${e} object`:"an object"}}return typeof i=="function"?"a function":Hn(12329,{type:typeof i})}function Jv(i,e){if("_delegate"in i&&(i=i._delegate),!(i instanceof e)){if(e.name===i.constructor.name)throw new _n(kt.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=C0(i);throw new _n(kt.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return i}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zs(i,e){const n={typeString:i};return e&&(n.value=e),n}function ly(i,e){if(!IE(i))throw new _n(kt.INVALID_ARGUMENT,"JSON must be an object");let n;for(const o in e)if(e[o]){const d=e[o].typeString,g="value"in e[o]?{value:e[o].value}:void 0;if(!(o in i)){n=`JSON missing required field: '${o}'`;break}const _=i[o];if(d&&typeof _!==d){n=`JSON field '${o}' must be a ${d}.`;break}if(g!==void 0&&_!==g.value){n=`Expected '${o}' field to equal '${g.value}'`;break}}if(n)throw new _n(kt.INVALID_ARGUMENT,n);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const b2=-62135596800,x2=1e6;class ha{static now(){return ha.fromMillis(Date.now())}static fromDate(e){return ha.fromMillis(e.getTime())}static fromMillis(e){const n=Math.floor(e/1e3),o=Math.floor((e-1e3*n)*x2);return new ha(n,o)}constructor(e,n){if(this.seconds=e,this.nanoseconds=n,n<0)throw new _n(kt.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new _n(kt.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(e<b2)throw new _n(kt.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new _n(kt.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/x2}_compareTo(e){return this.seconds===e.seconds?zi(this.nanoseconds,e.nanoseconds):zi(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:ha._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(ly(e,ha._jsonSchema))return new ha(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-b2;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}ha._jsonSchemaVersion="firestore/timestamp/1.0",ha._jsonSchema={type:zs("string",ha._jsonSchemaVersion),seconds:zs("number"),nanoseconds:zs("number")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ti{static fromTimestamp(e){return new ti(e)}static min(){return new ti(new ha(0,0))}static max(){return new ti(new ha(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const F_=-1;function B5(i,e){const n=i.toTimestamp().seconds,o=i.toTimestamp().nanoseconds+1,d=ti.fromTimestamp(o===1e9?new ha(n+1,0):new ha(n,o));return new Cf(d,On.empty(),e)}function F5(i){return new Cf(i.readTime,i.key,F_)}class Cf{constructor(e,n,o){this.readTime=e,this.documentKey=n,this.largestBatchId=o}static min(){return new Cf(ti.min(),On.empty(),F_)}static max(){return new Cf(ti.max(),On.empty(),F_)}}function V5(i,e){let n=i.readTime.compareTo(e.readTime);return n!==0?n:(n=On.comparator(i.documentKey,e.documentKey),n!==0?n:zi(i.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const j5="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class U5{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function rg(i){if(i.code!==kt.FAILED_PRECONDITION||i.message!==j5)throw i;gn("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dt{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((n=>{this.isDone=!0,this.result=n,this.nextCallback&&this.nextCallback(n)}),(n=>{this.isDone=!0,this.error=n,this.catchCallback&&this.catchCallback(n)}))}catch(e){return this.next(void 0,e)}next(e,n){return this.callbackAttached&&Hn(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new Dt(((o,d)=>{this.nextCallback=g=>{this.wrapSuccess(e,g).next(o,d)},this.catchCallback=g=>{this.wrapFailure(n,g).next(o,d)}}))}toPromise(){return new Promise(((e,n)=>{this.next(e,n)}))}wrapUserFunction(e){try{const n=e();return n instanceof Dt?n:Dt.resolve(n)}catch(n){return Dt.reject(n)}}wrapSuccess(e,n){return e?this.wrapUserFunction((()=>e(n))):Dt.resolve(n)}wrapFailure(e,n){return e?this.wrapUserFunction((()=>e(n))):Dt.reject(n)}static resolve(e){return new Dt(((n,o)=>{n(e)}))}static reject(e){return new Dt(((n,o)=>{o(e)}))}static waitFor(e){return new Dt(((n,o)=>{let d=0,g=0,_=!1;e.forEach((c=>{++d,c.next((()=>{++g,_&&g===d&&n()}),(M=>o(M)))})),_=!0,g===d&&n()}))}static or(e){let n=Dt.resolve(!1);for(const o of e)n=n.next((d=>d?Dt.resolve(d):o()));return n}static forEach(e,n){const o=[];return e.forEach(((d,g)=>{o.push(n.call(this,d,g))})),this.waitFor(o)}static mapArray(e,n){return new Dt(((o,d)=>{const g=e.length,_=new Array(g);let c=0;for(let M=0;M<g;M++){const k=M;n(e[k]).next((j=>{_[k]=j,++c,c===g&&o(_)}),(j=>d(j)))}}))}static doWhile(e,n){return new Dt(((o,d)=>{const g=()=>{e()===!0?n().next((()=>{g()}),d):o()};g()}))}}function $5(i){const e=i.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}function ag(i){return i.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class M0{constructor(e,n){this.previousValue=e,n&&(n.sequenceNumberHandler=o=>this.ae(o),this.ue=o=>n.writeSequenceNumber(o))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}M0.ce=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const v1=-1;function I0(i){return i==null}function e0(i){return i===0&&1/i==-1/0}function q5(i){return typeof i=="number"&&Number.isInteger(i)&&!e0(i)&&i<=Number.MAX_SAFE_INTEGER&&i>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PE="";function G5(i){let e="";for(let n=0;n<i.length;n++)e.length>0&&(e=w2(e)),e=Z5(i.get(n),e);return w2(e)}function Z5(i,e){let n=e;const o=i.length;for(let d=0;d<o;d++){const g=i.charAt(d);switch(g){case"\0":n+="";break;case PE:n+="";break;default:n+=g}}return n}function w2(i){return i+PE+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function T2(i){let e=0;for(const n in i)Object.prototype.hasOwnProperty.call(i,n)&&e++;return e}function jp(i,e){for(const n in i)Object.prototype.hasOwnProperty.call(i,n)&&e(n,i[n])}function RE(i){for(const e in i)if(Object.prototype.hasOwnProperty.call(i,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fa{constructor(e,n){this.comparator=e,this.root=n||el.EMPTY}insert(e,n){return new Fa(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,el.BLACK,null,null))}remove(e){return new Fa(this.comparator,this.root.remove(e,this.comparator).copy(null,null,el.BLACK,null,null))}get(e){let n=this.root;for(;!n.isEmpty();){const o=this.comparator(e,n.key);if(o===0)return n.value;o<0?n=n.left:o>0&&(n=n.right)}return null}indexOf(e){let n=0,o=this.root;for(;!o.isEmpty();){const d=this.comparator(e,o.key);if(d===0)return n+o.left.size;d<0?o=o.left:(n+=o.left.size+1,o=o.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((n,o)=>(e(n,o),!1)))}toString(){const e=[];return this.inorderTraversal(((n,o)=>(e.push(`${n}:${o}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new hv(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new hv(this.root,e,this.comparator,!1)}getReverseIterator(){return new hv(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new hv(this.root,e,this.comparator,!0)}}class hv{constructor(e,n,o,d){this.isReverse=d,this.nodeStack=[];let g=1;for(;!e.isEmpty();)if(g=n?o(e.key,n):1,n&&d&&(g*=-1),g<0)e=this.isReverse?e.left:e.right;else{if(g===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const n={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return n}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class el{constructor(e,n,o,d,g){this.key=e,this.value=n,this.color=o??el.RED,this.left=d??el.EMPTY,this.right=g??el.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,n,o,d,g){return new el(e??this.key,n??this.value,o??this.color,d??this.left,g??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,o){let d=this;const g=o(e,d.key);return d=g<0?d.copy(null,null,null,d.left.insert(e,n,o),null):g===0?d.copy(null,n,null,null,null):d.copy(null,null,null,null,d.right.insert(e,n,o)),d.fixUp()}removeMin(){if(this.left.isEmpty())return el.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,n){let o,d=this;if(n(e,d.key)<0)d.left.isEmpty()||d.left.isRed()||d.left.left.isRed()||(d=d.moveRedLeft()),d=d.copy(null,null,null,d.left.remove(e,n),null);else{if(d.left.isRed()&&(d=d.rotateRight()),d.right.isEmpty()||d.right.isRed()||d.right.left.isRed()||(d=d.moveRedRight()),n(e,d.key)===0){if(d.right.isEmpty())return el.EMPTY;o=d.right.min(),d=d.copy(o.key,o.value,null,null,d.right.removeMin())}d=d.copy(null,null,null,null,d.right.remove(e,n))}return d.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,el.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,el.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Hn(43730,{key:this.key,value:this.value});if(this.right.isRed())throw Hn(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw Hn(27949);return e+(this.isRed()?0:1)}}el.EMPTY=null,el.RED=!0,el.BLACK=!1;el.EMPTY=new class{constructor(){this.size=0}get key(){throw Hn(57766)}get value(){throw Hn(16141)}get color(){throw Hn(16727)}get left(){throw Hn(29726)}get right(){throw Hn(36894)}copy(e,n,o,d,g){return this}insert(e,n,o){return new el(e,n)}remove(e,n){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ro{constructor(e){this.comparator=e,this.data=new Fa(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((n,o)=>(e(n),!1)))}forEachInRange(e,n){const o=this.data.getIteratorFrom(e[0]);for(;o.hasNext();){const d=o.getNext();if(this.comparator(d.key,e[1])>=0)return;n(d.key)}}forEachWhile(e,n){let o;for(o=n!==void 0?this.data.getIteratorFrom(n):this.data.getIterator();o.hasNext();)if(!e(o.getNext().key))return}firstAfterOrEqual(e){const n=this.data.getIteratorFrom(e);return n.hasNext()?n.getNext().key:null}getIterator(){return new S2(this.data.getIterator())}getIteratorFrom(e){return new S2(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let n=this;return n.size<e.size&&(n=e,e=this),e.forEach((o=>{n=n.add(o)})),n}isEqual(e){if(!(e instanceof ro)||this.size!==e.size)return!1;const n=this.data.getIterator(),o=e.data.getIterator();for(;n.hasNext();){const d=n.getNext().key,g=o.getNext().key;if(this.comparator(d,g)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((n=>{e.push(n)})),e}toString(){const e=[];return this.forEach((n=>e.push(n))),"SortedSet("+e.toString()+")"}copy(e){const n=new ro(this.comparator);return n.data=e,n}}class S2{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nh{constructor(e){this.fields=e,e.sort(tl.comparator)}static empty(){return new nh([])}unionWith(e){let n=new ro(tl.comparator);for(const o of this.fields)n=n.add(o);for(const o of e)n=n.add(o);return new nh(n.toArray())}covers(e){for(const n of this.fields)if(n.isPrefixOf(e))return!0;return!1}isEqual(e){return Xm(this.fields,e.fields,((n,o)=>n.isEqual(o)))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LE extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nl{constructor(e){this.binaryString=e}static fromBase64String(e){const n=(function(d){try{return atob(d)}catch(g){throw typeof DOMException<"u"&&g instanceof DOMException?new LE("Invalid base64 string: "+g):g}})(e);return new nl(n)}static fromUint8Array(e){const n=(function(d){let g="";for(let _=0;_<d.length;++_)g+=String.fromCharCode(d[_]);return g})(e);return new nl(n)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(n){return btoa(n)})(this.binaryString)}toUint8Array(){return(function(n){const o=new Uint8Array(n.length);for(let d=0;d<n.length;d++)o[d]=n.charCodeAt(d);return o})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return zi(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}nl.EMPTY_BYTE_STRING=new nl("");const H5=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Mf(i){if(Ar(!!i,39018),typeof i=="string"){let e=0;const n=H5.exec(i);if(Ar(!!n,46558,{timestamp:i}),n[1]){let d=n[1];d=(d+"000000000").substr(0,9),e=Number(d)}const o=new Date(i);return{seconds:Math.floor(o.getTime()/1e3),nanos:e}}return{seconds:hs(i.seconds),nanos:hs(i.nanos)}}function hs(i){return typeof i=="number"?i:typeof i=="string"?Number(i):0}function If(i){return typeof i=="string"?nl.fromBase64String(i):nl.fromUint8Array(i)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kE="server_timestamp",DE="__type__",zE="__previous_value__",OE="__local_write_time__";function b1(i){var n,o;return((o=(((n=i==null?void 0:i.mapValue)==null?void 0:n.fields)||{})[DE])==null?void 0:o.stringValue)===kE}function P0(i){const e=i.mapValue.fields[zE];return b1(e)?P0(e):e}function V_(i){const e=Mf(i.mapValue.fields[OE].timestampValue);return new ha(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class X5{constructor(e,n,o,d,g,_,c,M,k,j){this.databaseId=e,this.appId=n,this.persistenceKey=o,this.host=d,this.ssl=g,this.forceLongPolling=_,this.autoDetectLongPolling=c,this.longPollingOptions=M,this.useFetchStreams=k,this.isUsingEmulator=j}}const t0="(default)";class j_{constructor(e,n){this.projectId=e,this.database=n||t0}static empty(){return new j_("","")}get isDefaultDatabase(){return this.database===t0}isEqual(e){return e instanceof j_&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const NE="__type__",W5="__max__",dv={mapValue:{}},BE="__vector__",n0="value";function Pf(i){return"nullValue"in i?0:"booleanValue"in i?1:"integerValue"in i||"doubleValue"in i?2:"timestampValue"in i?3:"stringValue"in i?5:"bytesValue"in i?6:"referenceValue"in i?7:"geoPointValue"in i?8:"arrayValue"in i?9:"mapValue"in i?b1(i)?4:Y5(i)?9007199254740991:K5(i)?10:11:Hn(28295,{value:i})}function Wh(i,e){if(i===e)return!0;const n=Pf(i);if(n!==Pf(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return i.booleanValue===e.booleanValue;case 4:return V_(i).isEqual(V_(e));case 3:return(function(d,g){if(typeof d.timestampValue=="string"&&typeof g.timestampValue=="string"&&d.timestampValue.length===g.timestampValue.length)return d.timestampValue===g.timestampValue;const _=Mf(d.timestampValue),c=Mf(g.timestampValue);return _.seconds===c.seconds&&_.nanos===c.nanos})(i,e);case 5:return i.stringValue===e.stringValue;case 6:return(function(d,g){return If(d.bytesValue).isEqual(If(g.bytesValue))})(i,e);case 7:return i.referenceValue===e.referenceValue;case 8:return(function(d,g){return hs(d.geoPointValue.latitude)===hs(g.geoPointValue.latitude)&&hs(d.geoPointValue.longitude)===hs(g.geoPointValue.longitude)})(i,e);case 2:return(function(d,g){if("integerValue"in d&&"integerValue"in g)return hs(d.integerValue)===hs(g.integerValue);if("doubleValue"in d&&"doubleValue"in g){const _=hs(d.doubleValue),c=hs(g.doubleValue);return _===c?e0(_)===e0(c):isNaN(_)&&isNaN(c)}return!1})(i,e);case 9:return Xm(i.arrayValue.values||[],e.arrayValue.values||[],Wh);case 10:case 11:return(function(d,g){const _=d.mapValue.fields||{},c=g.mapValue.fields||{};if(T2(_)!==T2(c))return!1;for(const M in _)if(_.hasOwnProperty(M)&&(c[M]===void 0||!Wh(_[M],c[M])))return!1;return!0})(i,e);default:return Hn(52216,{left:i})}}function U_(i,e){return(i.values||[]).find((n=>Wh(n,e)))!==void 0}function Wm(i,e){if(i===e)return 0;const n=Pf(i),o=Pf(e);if(n!==o)return zi(n,o);switch(n){case 0:case 9007199254740991:return 0;case 1:return zi(i.booleanValue,e.booleanValue);case 2:return(function(g,_){const c=hs(g.integerValue||g.doubleValue),M=hs(_.integerValue||_.doubleValue);return c<M?-1:c>M?1:c===M?0:isNaN(c)?isNaN(M)?0:-1:1})(i,e);case 3:return E2(i.timestampValue,e.timestampValue);case 4:return E2(V_(i),V_(e));case 5:return px(i.stringValue,e.stringValue);case 6:return(function(g,_){const c=If(g),M=If(_);return c.compareTo(M)})(i.bytesValue,e.bytesValue);case 7:return(function(g,_){const c=g.split("/"),M=_.split("/");for(let k=0;k<c.length&&k<M.length;k++){const j=zi(c[k],M[k]);if(j!==0)return j}return zi(c.length,M.length)})(i.referenceValue,e.referenceValue);case 8:return(function(g,_){const c=zi(hs(g.latitude),hs(_.latitude));return c!==0?c:zi(hs(g.longitude),hs(_.longitude))})(i.geoPointValue,e.geoPointValue);case 9:return A2(i.arrayValue,e.arrayValue);case 10:return(function(g,_){var ee,Y,xe,be;const c=g.fields||{},M=_.fields||{},k=(ee=c[n0])==null?void 0:ee.arrayValue,j=(Y=M[n0])==null?void 0:Y.arrayValue,G=zi(((xe=k==null?void 0:k.values)==null?void 0:xe.length)||0,((be=j==null?void 0:j.values)==null?void 0:be.length)||0);return G!==0?G:A2(k,j)})(i.mapValue,e.mapValue);case 11:return(function(g,_){if(g===dv.mapValue&&_===dv.mapValue)return 0;if(g===dv.mapValue)return 1;if(_===dv.mapValue)return-1;const c=g.fields||{},M=Object.keys(c),k=_.fields||{},j=Object.keys(k);M.sort(),j.sort();for(let G=0;G<M.length&&G<j.length;++G){const ee=px(M[G],j[G]);if(ee!==0)return ee;const Y=Wm(c[M[G]],k[j[G]]);if(Y!==0)return Y}return zi(M.length,j.length)})(i.mapValue,e.mapValue);default:throw Hn(23264,{he:n})}}function E2(i,e){if(typeof i=="string"&&typeof e=="string"&&i.length===e.length)return zi(i,e);const n=Mf(i),o=Mf(e),d=zi(n.seconds,o.seconds);return d!==0?d:zi(n.nanos,o.nanos)}function A2(i,e){const n=i.values||[],o=e.values||[];for(let d=0;d<n.length&&d<o.length;++d){const g=Wm(n[d],o[d]);if(g)return g}return zi(n.length,o.length)}function Km(i){return mx(i)}function mx(i){return"nullValue"in i?"null":"booleanValue"in i?""+i.booleanValue:"integerValue"in i?""+i.integerValue:"doubleValue"in i?""+i.doubleValue:"timestampValue"in i?(function(n){const o=Mf(n);return`time(${o.seconds},${o.nanos})`})(i.timestampValue):"stringValue"in i?i.stringValue:"bytesValue"in i?(function(n){return If(n).toBase64()})(i.bytesValue):"referenceValue"in i?(function(n){return On.fromName(n).toString()})(i.referenceValue):"geoPointValue"in i?(function(n){return`geo(${n.latitude},${n.longitude})`})(i.geoPointValue):"arrayValue"in i?(function(n){let o="[",d=!0;for(const g of n.values||[])d?d=!1:o+=",",o+=mx(g);return o+"]"})(i.arrayValue):"mapValue"in i?(function(n){const o=Object.keys(n.fields||{}).sort();let d="{",g=!0;for(const _ of o)g?g=!1:d+=",",d+=`${_}:${mx(n.fields[_])}`;return d+"}"})(i.mapValue):Hn(61005,{value:i})}function Mv(i){switch(Pf(i)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=P0(i);return e?16+Mv(e):16;case 5:return 2*i.stringValue.length;case 6:return If(i.bytesValue).approximateByteSize();case 7:return i.referenceValue.length;case 9:return(function(o){return(o.values||[]).reduce(((d,g)=>d+Mv(g)),0)})(i.arrayValue);case 10:case 11:return(function(o){let d=0;return jp(o.fields,((g,_)=>{d+=g.length+Mv(_)})),d})(i.mapValue);default:throw Hn(13486,{value:i})}}function C2(i,e){return{referenceValue:`projects/${i.projectId}/databases/${i.database}/documents/${e.path.canonicalString()}`}}function gx(i){return!!i&&"integerValue"in i}function x1(i){return!!i&&"arrayValue"in i}function M2(i){return!!i&&"nullValue"in i}function I2(i){return!!i&&"doubleValue"in i&&isNaN(Number(i.doubleValue))}function Iv(i){return!!i&&"mapValue"in i}function K5(i){var n,o;return((o=(((n=i==null?void 0:i.mapValue)==null?void 0:n.fields)||{})[NE])==null?void 0:o.stringValue)===BE}function A_(i){if(i.geoPointValue)return{geoPointValue:{...i.geoPointValue}};if(i.timestampValue&&typeof i.timestampValue=="object")return{timestampValue:{...i.timestampValue}};if(i.mapValue){const e={mapValue:{fields:{}}};return jp(i.mapValue.fields,((n,o)=>e.mapValue.fields[n]=A_(o))),e}if(i.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(i.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=A_(i.arrayValue.values[n]);return e}return{...i}}function Y5(i){return(((i.mapValue||{}).fields||{}).__type__||{}).stringValue===W5}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cc{constructor(e){this.value=e}static empty(){return new Cc({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let n=this.value;for(let o=0;o<e.length-1;++o)if(n=(n.mapValue.fields||{})[e.get(o)],!Iv(n))return null;return n=(n.mapValue.fields||{})[e.lastSegment()],n||null}}set(e,n){this.getFieldsMap(e.popLast())[e.lastSegment()]=A_(n)}setAll(e){let n=tl.emptyPath(),o={},d=[];e.forEach(((_,c)=>{if(!n.isImmediateParentOf(c)){const M=this.getFieldsMap(n);this.applyChanges(M,o,d),o={},d=[],n=c.popLast()}_?o[c.lastSegment()]=A_(_):d.push(c.lastSegment())}));const g=this.getFieldsMap(n);this.applyChanges(g,o,d)}delete(e){const n=this.field(e.popLast());Iv(n)&&n.mapValue.fields&&delete n.mapValue.fields[e.lastSegment()]}isEqual(e){return Wh(this.value,e.value)}getFieldsMap(e){let n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(let o=0;o<e.length;++o){let d=n.mapValue.fields[e.get(o)];Iv(d)&&d.mapValue.fields||(d={mapValue:{fields:{}}},n.mapValue.fields[e.get(o)]=d),n=d}return n.mapValue.fields}applyChanges(e,n,o){jp(n,((d,g)=>e[d]=g));for(const d of o)delete e[d]}clone(){return new Cc(A_(this.value))}}function FE(i){const e=[];return jp(i.fields,((n,o)=>{const d=new tl([n]);if(Iv(o)){const g=FE(o.mapValue).fields;if(g.length===0)e.push(d);else for(const _ of g)e.push(d.child(_))}else e.push(d)})),new nh(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pl{constructor(e,n,o,d,g,_,c){this.key=e,this.documentType=n,this.version=o,this.readTime=d,this.createTime=g,this.data=_,this.documentState=c}static newInvalidDocument(e){return new Pl(e,0,ti.min(),ti.min(),ti.min(),Cc.empty(),0)}static newFoundDocument(e,n,o,d){return new Pl(e,1,n,ti.min(),o,d,0)}static newNoDocument(e,n){return new Pl(e,2,n,ti.min(),ti.min(),Cc.empty(),0)}static newUnknownDocument(e,n){return new Pl(e,3,n,ti.min(),ti.min(),Cc.empty(),2)}convertToFoundDocument(e,n){return!this.createTime.isEqual(ti.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=n,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Cc.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Cc.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ti.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Pl&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Pl(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i0{constructor(e,n){this.position=e,this.inclusive=n}}function P2(i,e,n){let o=0;for(let d=0;d<i.position.length;d++){const g=e[d],_=i.position[d];if(g.field.isKeyField()?o=On.comparator(On.fromName(_.referenceValue),n.key):o=Wm(_,n.data.field(g.field)),g.dir==="desc"&&(o*=-1),o!==0)break}return o}function R2(i,e){if(i===null)return e===null;if(e===null||i.inclusive!==e.inclusive||i.position.length!==e.position.length)return!1;for(let n=0;n<i.position.length;n++)if(!Wh(i.position[n],e.position[n]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class r0{constructor(e,n="asc"){this.field=e,this.dir=n}}function Q5(i,e){return i.dir===e.dir&&i.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VE{}class Ds extends VE{constructor(e,n,o){super(),this.field=e,this.op=n,this.value=o}static create(e,n,o){return e.isKeyField()?n==="in"||n==="not-in"?this.createKeyFieldInFilter(e,n,o):new eL(e,n,o):n==="array-contains"?new iL(e,o):n==="in"?new rL(e,o):n==="not-in"?new aL(e,o):n==="array-contains-any"?new sL(e,o):new Ds(e,n,o)}static createKeyFieldInFilter(e,n,o){return n==="in"?new tL(e,o):new nL(e,o)}matches(e){const n=e.data.field(this.field);return this.op==="!="?n!==null&&n.nullValue===void 0&&this.matchesComparison(Wm(n,this.value)):n!==null&&Pf(this.value)===Pf(n)&&this.matchesComparison(Wm(n,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Hn(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class uh extends VE{constructor(e,n){super(),this.filters=e,this.op=n,this.Pe=null}static create(e,n){return new uh(e,n)}matches(e){return jE(this)?this.filters.find((n=>!n.matches(e)))===void 0:this.filters.find((n=>n.matches(e)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((e,n)=>e.concat(n.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function jE(i){return i.op==="and"}function UE(i){return J5(i)&&jE(i)}function J5(i){for(const e of i.filters)if(e instanceof uh)return!1;return!0}function _x(i){if(i instanceof Ds)return i.field.canonicalString()+i.op.toString()+Km(i.value);if(UE(i))return i.filters.map((e=>_x(e))).join(",");{const e=i.filters.map((n=>_x(n))).join(",");return`${i.op}(${e})`}}function $E(i,e){return i instanceof Ds?(function(o,d){return d instanceof Ds&&o.op===d.op&&o.field.isEqual(d.field)&&Wh(o.value,d.value)})(i,e):i instanceof uh?(function(o,d){return d instanceof uh&&o.op===d.op&&o.filters.length===d.filters.length?o.filters.reduce(((g,_,c)=>g&&$E(_,d.filters[c])),!0):!1})(i,e):void Hn(19439)}function qE(i){return i instanceof Ds?(function(n){return`${n.field.canonicalString()} ${n.op} ${Km(n.value)}`})(i):i instanceof uh?(function(n){return n.op.toString()+" {"+n.getFilters().map(qE).join(" ,")+"}"})(i):"Filter"}class eL extends Ds{constructor(e,n,o){super(e,n,o),this.key=On.fromName(o.referenceValue)}matches(e){const n=On.comparator(e.key,this.key);return this.matchesComparison(n)}}class tL extends Ds{constructor(e,n){super(e,"in",n),this.keys=GE("in",n)}matches(e){return this.keys.some((n=>n.isEqual(e.key)))}}class nL extends Ds{constructor(e,n){super(e,"not-in",n),this.keys=GE("not-in",n)}matches(e){return!this.keys.some((n=>n.isEqual(e.key)))}}function GE(i,e){var n;return(((n=e.arrayValue)==null?void 0:n.values)||[]).map((o=>On.fromName(o.referenceValue)))}class iL extends Ds{constructor(e,n){super(e,"array-contains",n)}matches(e){const n=e.data.field(this.field);return x1(n)&&U_(n.arrayValue,this.value)}}class rL extends Ds{constructor(e,n){super(e,"in",n)}matches(e){const n=e.data.field(this.field);return n!==null&&U_(this.value.arrayValue,n)}}class aL extends Ds{constructor(e,n){super(e,"not-in",n)}matches(e){if(U_(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const n=e.data.field(this.field);return n!==null&&n.nullValue===void 0&&!U_(this.value.arrayValue,n)}}class sL extends Ds{constructor(e,n){super(e,"array-contains-any",n)}matches(e){const n=e.data.field(this.field);return!(!x1(n)||!n.arrayValue.values)&&n.arrayValue.values.some((o=>U_(this.value.arrayValue,o)))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oL{constructor(e,n=null,o=[],d=[],g=null,_=null,c=null){this.path=e,this.collectionGroup=n,this.orderBy=o,this.filters=d,this.limit=g,this.startAt=_,this.endAt=c,this.Te=null}}function L2(i,e=null,n=[],o=[],d=null,g=null,_=null){return new oL(i,e,n,o,d,g,_)}function w1(i){const e=ai(i);if(e.Te===null){let n=e.path.canonicalString();e.collectionGroup!==null&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map((o=>_x(o))).join(","),n+="|ob:",n+=e.orderBy.map((o=>(function(g){return g.field.canonicalString()+g.dir})(o))).join(","),I0(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map((o=>Km(o))).join(",")),e.endAt&&(n+="|ub:",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map((o=>Km(o))).join(",")),e.Te=n}return e.Te}function T1(i,e){if(i.limit!==e.limit||i.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<i.orderBy.length;n++)if(!Q5(i.orderBy[n],e.orderBy[n]))return!1;if(i.filters.length!==e.filters.length)return!1;for(let n=0;n<i.filters.length;n++)if(!$E(i.filters[n],e.filters[n]))return!1;return i.collectionGroup===e.collectionGroup&&!!i.path.isEqual(e.path)&&!!R2(i.startAt,e.startAt)&&R2(i.endAt,e.endAt)}function yx(i){return On.isDocumentKey(i.path)&&i.collectionGroup===null&&i.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uy{constructor(e,n=null,o=[],d=[],g=null,_="F",c=null,M=null){this.path=e,this.collectionGroup=n,this.explicitOrderBy=o,this.filters=d,this.limit=g,this.limitType=_,this.startAt=c,this.endAt=M,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function lL(i,e,n,o,d,g,_,c){return new uy(i,e,n,o,d,g,_,c)}function ZE(i){return new uy(i)}function k2(i){return i.filters.length===0&&i.limit===null&&i.startAt==null&&i.endAt==null&&(i.explicitOrderBy.length===0||i.explicitOrderBy.length===1&&i.explicitOrderBy[0].field.isKeyField())}function HE(i){return i.collectionGroup!==null}function C_(i){const e=ai(i);if(e.Ie===null){e.Ie=[];const n=new Set;for(const g of e.explicitOrderBy)e.Ie.push(g),n.add(g.field.canonicalString());const o=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(_){let c=new ro(tl.comparator);return _.filters.forEach((M=>{M.getFlattenedFilters().forEach((k=>{k.isInequality()&&(c=c.add(k.field))}))})),c})(e).forEach((g=>{n.has(g.canonicalString())||g.isKeyField()||e.Ie.push(new r0(g,o))})),n.has(tl.keyField().canonicalString())||e.Ie.push(new r0(tl.keyField(),o))}return e.Ie}function Fh(i){const e=ai(i);return e.Ee||(e.Ee=uL(e,C_(i))),e.Ee}function uL(i,e){if(i.limitType==="F")return L2(i.path,i.collectionGroup,e,i.filters,i.limit,i.startAt,i.endAt);{e=e.map((d=>{const g=d.dir==="desc"?"asc":"desc";return new r0(d.field,g)}));const n=i.endAt?new i0(i.endAt.position,i.endAt.inclusive):null,o=i.startAt?new i0(i.startAt.position,i.startAt.inclusive):null;return L2(i.path,i.collectionGroup,e,i.filters,i.limit,n,o)}}function vx(i,e){const n=i.filters.concat([e]);return new uy(i.path,i.collectionGroup,i.explicitOrderBy.slice(),n,i.limit,i.limitType,i.startAt,i.endAt)}function bx(i,e,n){return new uy(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),e,n,i.startAt,i.endAt)}function R0(i,e){return T1(Fh(i),Fh(e))&&i.limitType===e.limitType}function XE(i){return`${w1(Fh(i))}|lt:${i.limitType}`}function Dm(i){return`Query(target=${(function(n){let o=n.path.canonicalString();return n.collectionGroup!==null&&(o+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(o+=`, filters: [${n.filters.map((d=>qE(d))).join(", ")}]`),I0(n.limit)||(o+=", limit: "+n.limit),n.orderBy.length>0&&(o+=`, orderBy: [${n.orderBy.map((d=>(function(_){return`${_.field.canonicalString()} (${_.dir})`})(d))).join(", ")}]`),n.startAt&&(o+=", startAt: ",o+=n.startAt.inclusive?"b:":"a:",o+=n.startAt.position.map((d=>Km(d))).join(",")),n.endAt&&(o+=", endAt: ",o+=n.endAt.inclusive?"a:":"b:",o+=n.endAt.position.map((d=>Km(d))).join(",")),`Target(${o})`})(Fh(i))}; limitType=${i.limitType})`}function L0(i,e){return e.isFoundDocument()&&(function(o,d){const g=d.key.path;return o.collectionGroup!==null?d.key.hasCollectionId(o.collectionGroup)&&o.path.isPrefixOf(g):On.isDocumentKey(o.path)?o.path.isEqual(g):o.path.isImmediateParentOf(g)})(i,e)&&(function(o,d){for(const g of C_(o))if(!g.field.isKeyField()&&d.data.field(g.field)===null)return!1;return!0})(i,e)&&(function(o,d){for(const g of o.filters)if(!g.matches(d))return!1;return!0})(i,e)&&(function(o,d){return!(o.startAt&&!(function(_,c,M){const k=P2(_,c,M);return _.inclusive?k<=0:k<0})(o.startAt,C_(o),d)||o.endAt&&!(function(_,c,M){const k=P2(_,c,M);return _.inclusive?k>=0:k>0})(o.endAt,C_(o),d))})(i,e)}function cL(i){return i.collectionGroup||(i.path.length%2==1?i.path.lastSegment():i.path.get(i.path.length-2))}function WE(i){return(e,n)=>{let o=!1;for(const d of C_(i)){const g=hL(d,e,n);if(g!==0)return g;o=o||d.field.isKeyField()}return 0}}function hL(i,e,n){const o=i.field.isKeyField()?On.comparator(e.key,n.key):(function(g,_,c){const M=_.data.field(g),k=c.data.field(g);return M!==null&&k!==null?Wm(M,k):Hn(42886)})(i.field,e,n);switch(i.dir){case"asc":return o;case"desc":return-1*o;default:return Hn(19790,{direction:i.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Up{constructor(e,n){this.mapKeyFn=e,this.equalsFn=n,this.inner={},this.innerSize=0}get(e){const n=this.mapKeyFn(e),o=this.inner[n];if(o!==void 0){for(const[d,g]of o)if(this.equalsFn(d,e))return g}}has(e){return this.get(e)!==void 0}set(e,n){const o=this.mapKeyFn(e),d=this.inner[o];if(d===void 0)return this.inner[o]=[[e,n]],void this.innerSize++;for(let g=0;g<d.length;g++)if(this.equalsFn(d[g][0],e))return void(d[g]=[e,n]);d.push([e,n]),this.innerSize++}delete(e){const n=this.mapKeyFn(e),o=this.inner[n];if(o===void 0)return!1;for(let d=0;d<o.length;d++)if(this.equalsFn(o[d][0],e))return o.length===1?delete this.inner[n]:o.splice(d,1),this.innerSize--,!0;return!1}forEach(e){jp(this.inner,((n,o)=>{for(const[d,g]of o)e(d,g)}))}isEmpty(){return RE(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dL=new Fa(On.comparator);function Bd(){return dL}const KE=new Fa(On.comparator);function __(...i){let e=KE;for(const n of i)e=e.insert(n.key,n);return e}function YE(i){let e=KE;return i.forEach(((n,o)=>e=e.insert(n,o.overlayedDocument))),e}function Tp(){return M_()}function QE(){return M_()}function M_(){return new Up((i=>i.toString()),((i,e)=>i.isEqual(e)))}const fL=new Fa(On.comparator),pL=new ro(On.comparator);function Oi(...i){let e=pL;for(const n of i)e=e.add(n);return e}const mL=new ro(zi);function gL(){return mL}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function S1(i,e){if(i.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:e0(e)?"-0":e}}function JE(i){return{integerValue:""+i}}function _L(i,e){return q5(e)?JE(e):S1(i,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class k0{constructor(){this._=void 0}}function yL(i,e,n){return i instanceof $_?(function(d,g){const _={fields:{[DE]:{stringValue:kE},[OE]:{timestampValue:{seconds:d.seconds,nanos:d.nanoseconds}}}};return g&&b1(g)&&(g=P0(g)),g&&(_.fields[zE]=g),{mapValue:_}})(n,e):i instanceof q_?tA(i,e):i instanceof G_?nA(i,e):(function(d,g){const _=eA(d,g),c=D2(_)+D2(d.Ae);return gx(_)&&gx(d.Ae)?JE(c):S1(d.serializer,c)})(i,e)}function vL(i,e,n){return i instanceof q_?tA(i,e):i instanceof G_?nA(i,e):n}function eA(i,e){return i instanceof a0?(function(o){return gx(o)||(function(g){return!!g&&"doubleValue"in g})(o)})(e)?e:{integerValue:0}:null}class $_ extends k0{}class q_ extends k0{constructor(e){super(),this.elements=e}}function tA(i,e){const n=iA(e);for(const o of i.elements)n.some((d=>Wh(d,o)))||n.push(o);return{arrayValue:{values:n}}}class G_ extends k0{constructor(e){super(),this.elements=e}}function nA(i,e){let n=iA(e);for(const o of i.elements)n=n.filter((d=>!Wh(d,o)));return{arrayValue:{values:n}}}class a0 extends k0{constructor(e,n){super(),this.serializer=e,this.Ae=n}}function D2(i){return hs(i.integerValue||i.doubleValue)}function iA(i){return x1(i)&&i.arrayValue.values?i.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bL{constructor(e,n){this.field=e,this.transform=n}}function xL(i,e){return i.field.isEqual(e.field)&&(function(o,d){return o instanceof q_&&d instanceof q_||o instanceof G_&&d instanceof G_?Xm(o.elements,d.elements,Wh):o instanceof a0&&d instanceof a0?Wh(o.Ae,d.Ae):o instanceof $_&&d instanceof $_})(i.transform,e.transform)}class wL{constructor(e,n){this.version=e,this.transformResults=n}}class Ld{constructor(e,n){this.updateTime=e,this.exists=n}static none(){return new Ld}static exists(e){return new Ld(void 0,e)}static updateTime(e){return new Ld(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Pv(i,e){return i.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(i.updateTime):i.exists===void 0||i.exists===e.isFoundDocument()}class D0{}function rA(i,e){if(!i.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return i.isNoDocument()?new sA(i.key,Ld.none()):new cy(i.key,i.data,Ld.none());{const n=i.data,o=Cc.empty();let d=new ro(tl.comparator);for(let g of e.fields)if(!d.has(g)){let _=n.field(g);_===null&&g.length>1&&(g=g.popLast(),_=n.field(g)),_===null?o.delete(g):o.set(g,_),d=d.add(g)}return new $p(i.key,o,new nh(d.toArray()),Ld.none())}}function TL(i,e,n){i instanceof cy?(function(d,g,_){const c=d.value.clone(),M=O2(d.fieldTransforms,g,_.transformResults);c.setAll(M),g.convertToFoundDocument(_.version,c).setHasCommittedMutations()})(i,e,n):i instanceof $p?(function(d,g,_){if(!Pv(d.precondition,g))return void g.convertToUnknownDocument(_.version);const c=O2(d.fieldTransforms,g,_.transformResults),M=g.data;M.setAll(aA(d)),M.setAll(c),g.convertToFoundDocument(_.version,M).setHasCommittedMutations()})(i,e,n):(function(d,g,_){g.convertToNoDocument(_.version).setHasCommittedMutations()})(0,e,n)}function I_(i,e,n,o){return i instanceof cy?(function(g,_,c,M){if(!Pv(g.precondition,_))return c;const k=g.value.clone(),j=N2(g.fieldTransforms,M,_);return k.setAll(j),_.convertToFoundDocument(_.version,k).setHasLocalMutations(),null})(i,e,n,o):i instanceof $p?(function(g,_,c,M){if(!Pv(g.precondition,_))return c;const k=N2(g.fieldTransforms,M,_),j=_.data;return j.setAll(aA(g)),j.setAll(k),_.convertToFoundDocument(_.version,j).setHasLocalMutations(),c===null?null:c.unionWith(g.fieldMask.fields).unionWith(g.fieldTransforms.map((G=>G.field)))})(i,e,n,o):(function(g,_,c){return Pv(g.precondition,_)?(_.convertToNoDocument(_.version).setHasLocalMutations(),null):c})(i,e,n)}function SL(i,e){let n=null;for(const o of i.fieldTransforms){const d=e.data.field(o.field),g=eA(o.transform,d||null);g!=null&&(n===null&&(n=Cc.empty()),n.set(o.field,g))}return n||null}function z2(i,e){return i.type===e.type&&!!i.key.isEqual(e.key)&&!!i.precondition.isEqual(e.precondition)&&!!(function(o,d){return o===void 0&&d===void 0||!(!o||!d)&&Xm(o,d,((g,_)=>xL(g,_)))})(i.fieldTransforms,e.fieldTransforms)&&(i.type===0?i.value.isEqual(e.value):i.type!==1||i.data.isEqual(e.data)&&i.fieldMask.isEqual(e.fieldMask))}class cy extends D0{constructor(e,n,o,d=[]){super(),this.key=e,this.value=n,this.precondition=o,this.fieldTransforms=d,this.type=0}getFieldMask(){return null}}class $p extends D0{constructor(e,n,o,d,g=[]){super(),this.key=e,this.data=n,this.fieldMask=o,this.precondition=d,this.fieldTransforms=g,this.type=1}getFieldMask(){return this.fieldMask}}function aA(i){const e=new Map;return i.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const o=i.data.field(n);e.set(n,o)}})),e}function O2(i,e,n){const o=new Map;Ar(i.length===n.length,32656,{Re:n.length,Ve:i.length});for(let d=0;d<n.length;d++){const g=i[d],_=g.transform,c=e.data.field(g.field);o.set(g.field,vL(_,c,n[d]))}return o}function N2(i,e,n){const o=new Map;for(const d of i){const g=d.transform,_=n.data.field(d.field);o.set(d.field,yL(g,_,e))}return o}class sA extends D0{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class EL extends D0{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AL{constructor(e,n,o,d){this.batchId=e,this.localWriteTime=n,this.baseMutations=o,this.mutations=d}applyToRemoteDocument(e,n){const o=n.mutationResults;for(let d=0;d<this.mutations.length;d++){const g=this.mutations[d];g.key.isEqual(e.key)&&TL(g,e,o[d])}}applyToLocalView(e,n){for(const o of this.baseMutations)o.key.isEqual(e.key)&&(n=I_(o,e,n,this.localWriteTime));for(const o of this.mutations)o.key.isEqual(e.key)&&(n=I_(o,e,n,this.localWriteTime));return n}applyToLocalDocumentSet(e,n){const o=QE();return this.mutations.forEach((d=>{const g=e.get(d.key),_=g.overlayedDocument;let c=this.applyToLocalView(_,g.mutatedFields);c=n.has(d.key)?null:c;const M=rA(_,c);M!==null&&o.set(d.key,M),_.isValidDocument()||_.convertToNoDocument(ti.min())})),o}keys(){return this.mutations.reduce(((e,n)=>e.add(n.key)),Oi())}isEqual(e){return this.batchId===e.batchId&&Xm(this.mutations,e.mutations,((n,o)=>z2(n,o)))&&Xm(this.baseMutations,e.baseMutations,((n,o)=>z2(n,o)))}}class E1{constructor(e,n,o,d){this.batch=e,this.commitVersion=n,this.mutationResults=o,this.docVersions=d}static from(e,n,o){Ar(e.mutations.length===o.length,58842,{me:e.mutations.length,fe:o.length});let d=(function(){return fL})();const g=e.mutations;for(let _=0;_<g.length;_++)d=d.insert(g[_].key,o[_].version);return new E1(e,n,o,d)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CL{constructor(e,n){this.largestBatchId=e,this.mutation=n}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ML{constructor(e,n){this.count=e,this.unchangedNames=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ks,Yi;function IL(i){switch(i){case kt.OK:return Hn(64938);case kt.CANCELLED:case kt.UNKNOWN:case kt.DEADLINE_EXCEEDED:case kt.RESOURCE_EXHAUSTED:case kt.INTERNAL:case kt.UNAVAILABLE:case kt.UNAUTHENTICATED:return!1;case kt.INVALID_ARGUMENT:case kt.NOT_FOUND:case kt.ALREADY_EXISTS:case kt.PERMISSION_DENIED:case kt.FAILED_PRECONDITION:case kt.ABORTED:case kt.OUT_OF_RANGE:case kt.UNIMPLEMENTED:case kt.DATA_LOSS:return!0;default:return Hn(15467,{code:i})}}function oA(i){if(i===void 0)return Nd("GRPC error has no .code"),kt.UNKNOWN;switch(i){case ks.OK:return kt.OK;case ks.CANCELLED:return kt.CANCELLED;case ks.UNKNOWN:return kt.UNKNOWN;case ks.DEADLINE_EXCEEDED:return kt.DEADLINE_EXCEEDED;case ks.RESOURCE_EXHAUSTED:return kt.RESOURCE_EXHAUSTED;case ks.INTERNAL:return kt.INTERNAL;case ks.UNAVAILABLE:return kt.UNAVAILABLE;case ks.UNAUTHENTICATED:return kt.UNAUTHENTICATED;case ks.INVALID_ARGUMENT:return kt.INVALID_ARGUMENT;case ks.NOT_FOUND:return kt.NOT_FOUND;case ks.ALREADY_EXISTS:return kt.ALREADY_EXISTS;case ks.PERMISSION_DENIED:return kt.PERMISSION_DENIED;case ks.FAILED_PRECONDITION:return kt.FAILED_PRECONDITION;case ks.ABORTED:return kt.ABORTED;case ks.OUT_OF_RANGE:return kt.OUT_OF_RANGE;case ks.UNIMPLEMENTED:return kt.UNIMPLEMENTED;case ks.DATA_LOSS:return kt.DATA_LOSS;default:return Hn(39323,{code:i})}}(Yi=ks||(ks={}))[Yi.OK=0]="OK",Yi[Yi.CANCELLED=1]="CANCELLED",Yi[Yi.UNKNOWN=2]="UNKNOWN",Yi[Yi.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Yi[Yi.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Yi[Yi.NOT_FOUND=5]="NOT_FOUND",Yi[Yi.ALREADY_EXISTS=6]="ALREADY_EXISTS",Yi[Yi.PERMISSION_DENIED=7]="PERMISSION_DENIED",Yi[Yi.UNAUTHENTICATED=16]="UNAUTHENTICATED",Yi[Yi.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Yi[Yi.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Yi[Yi.ABORTED=10]="ABORTED",Yi[Yi.OUT_OF_RANGE=11]="OUT_OF_RANGE",Yi[Yi.UNIMPLEMENTED=12]="UNIMPLEMENTED",Yi[Yi.INTERNAL=13]="INTERNAL",Yi[Yi.UNAVAILABLE=14]="UNAVAILABLE",Yi[Yi.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function PL(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RL=new Tf([4294967295,4294967295],0);function B2(i){const e=PL().encode(i),n=new bE;return n.update(e),new Uint8Array(n.digest())}function F2(i){const e=new DataView(i.buffer),n=e.getUint32(0,!0),o=e.getUint32(4,!0),d=e.getUint32(8,!0),g=e.getUint32(12,!0);return[new Tf([n,o],0),new Tf([d,g],0)]}class A1{constructor(e,n,o){if(this.bitmap=e,this.padding=n,this.hashCount=o,n<0||n>=8)throw new y_(`Invalid padding: ${n}`);if(o<0)throw new y_(`Invalid hash count: ${o}`);if(e.length>0&&this.hashCount===0)throw new y_(`Invalid hash count: ${o}`);if(e.length===0&&n!==0)throw new y_(`Invalid padding when bitmap length is 0: ${n}`);this.ge=8*e.length-n,this.pe=Tf.fromNumber(this.ge)}ye(e,n,o){let d=e.add(n.multiply(Tf.fromNumber(o)));return d.compare(RL)===1&&(d=new Tf([d.getBits(0),d.getBits(1)],0)),d.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const n=B2(e),[o,d]=F2(n);for(let g=0;g<this.hashCount;g++){const _=this.ye(o,d,g);if(!this.we(_))return!1}return!0}static create(e,n,o){const d=e%8==0?0:8-e%8,g=new Uint8Array(Math.ceil(e/8)),_=new A1(g,d,n);return o.forEach((c=>_.insert(c))),_}insert(e){if(this.ge===0)return;const n=B2(e),[o,d]=F2(n);for(let g=0;g<this.hashCount;g++){const _=this.ye(o,d,g);this.Se(_)}}Se(e){const n=Math.floor(e/8),o=e%8;this.bitmap[n]|=1<<o}}class y_ extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class z0{constructor(e,n,o,d,g){this.snapshotVersion=e,this.targetChanges=n,this.targetMismatches=o,this.documentUpdates=d,this.resolvedLimboDocuments=g}static createSynthesizedRemoteEventForCurrentChange(e,n,o){const d=new Map;return d.set(e,hy.createSynthesizedTargetChangeForCurrentChange(e,n,o)),new z0(ti.min(),d,new Fa(zi),Bd(),Oi())}}class hy{constructor(e,n,o,d,g){this.resumeToken=e,this.current=n,this.addedDocuments=o,this.modifiedDocuments=d,this.removedDocuments=g}static createSynthesizedTargetChangeForCurrentChange(e,n,o){return new hy(o,n,Oi(),Oi(),Oi())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rv{constructor(e,n,o,d){this.be=e,this.removedTargetIds=n,this.key=o,this.De=d}}class lA{constructor(e,n){this.targetId=e,this.Ce=n}}class uA{constructor(e,n,o=nl.EMPTY_BYTE_STRING,d=null){this.state=e,this.targetIds=n,this.resumeToken=o,this.cause=d}}class V2{constructor(){this.ve=0,this.Fe=j2(),this.Me=nl.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=Oi(),n=Oi(),o=Oi();return this.Fe.forEach(((d,g)=>{switch(g){case 0:e=e.add(d);break;case 2:n=n.add(d);break;case 1:o=o.add(d);break;default:Hn(38017,{changeType:g})}})),new hy(this.Me,this.xe,e,n,o)}qe(){this.Oe=!1,this.Fe=j2()}Qe(e,n){this.Oe=!0,this.Fe=this.Fe.insert(e,n)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,Ar(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class LL{constructor(e){this.Ge=e,this.ze=new Map,this.je=Bd(),this.Je=fv(),this.He=fv(),this.Ye=new Fa(zi)}Ze(e){for(const n of e.be)e.De&&e.De.isFoundDocument()?this.Xe(n,e.De):this.et(n,e.key,e.De);for(const n of e.removedTargetIds)this.et(n,e.key,e.De)}tt(e){this.forEachTarget(e,(n=>{const o=this.nt(n);switch(e.state){case 0:this.rt(n)&&o.Le(e.resumeToken);break;case 1:o.Ke(),o.Ne||o.qe(),o.Le(e.resumeToken);break;case 2:o.Ke(),o.Ne||this.removeTarget(n);break;case 3:this.rt(n)&&(o.We(),o.Le(e.resumeToken));break;case 4:this.rt(n)&&(this.it(n),o.Le(e.resumeToken));break;default:Hn(56790,{state:e.state})}}))}forEachTarget(e,n){e.targetIds.length>0?e.targetIds.forEach(n):this.ze.forEach(((o,d)=>{this.rt(d)&&n(d)}))}st(e){const n=e.targetId,o=e.Ce.count,d=this.ot(n);if(d){const g=d.target;if(yx(g))if(o===0){const _=new On(g.path);this.et(n,_,Pl.newNoDocument(_,ti.min()))}else Ar(o===1,20013,{expectedCount:o});else{const _=this._t(n);if(_!==o){const c=this.ut(e),M=c?this.ct(c,e,_):1;if(M!==0){this.it(n);const k=M===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(n,k)}}}}}ut(e){const n=e.Ce.unchangedNames;if(!n||!n.bits)return null;const{bits:{bitmap:o="",padding:d=0},hashCount:g=0}=n;let _,c;try{_=If(o).toUint8Array()}catch(M){if(M instanceof LE)return Hm("Decoding the base64 bloom filter in existence filter failed ("+M.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw M}try{c=new A1(_,d,g)}catch(M){return Hm(M instanceof y_?"BloomFilter error: ":"Applying bloom filter failed: ",M),null}return c.ge===0?null:c}ct(e,n,o){return n.Ce.count===o-this.Pt(e,n.targetId)?0:2}Pt(e,n){const o=this.Ge.getRemoteKeysForTarget(n);let d=0;return o.forEach((g=>{const _=this.Ge.ht(),c=`projects/${_.projectId}/databases/${_.database}/documents/${g.path.canonicalString()}`;e.mightContain(c)||(this.et(n,g,null),d++)})),d}Tt(e){const n=new Map;this.ze.forEach(((g,_)=>{const c=this.ot(_);if(c){if(g.current&&yx(c.target)){const M=new On(c.target.path);this.It(M).has(_)||this.Et(_,M)||this.et(_,M,Pl.newNoDocument(M,e))}g.Be&&(n.set(_,g.ke()),g.qe())}}));let o=Oi();this.He.forEach(((g,_)=>{let c=!0;_.forEachWhile((M=>{const k=this.ot(M);return!k||k.purpose==="TargetPurposeLimboResolution"||(c=!1,!1)})),c&&(o=o.add(g))})),this.je.forEach(((g,_)=>_.setReadTime(e)));const d=new z0(e,n,this.Ye,this.je,o);return this.je=Bd(),this.Je=fv(),this.He=fv(),this.Ye=new Fa(zi),d}Xe(e,n){if(!this.rt(e))return;const o=this.Et(e,n.key)?2:0;this.nt(e).Qe(n.key,o),this.je=this.je.insert(n.key,n),this.Je=this.Je.insert(n.key,this.It(n.key).add(e)),this.He=this.He.insert(n.key,this.dt(n.key).add(e))}et(e,n,o){if(!this.rt(e))return;const d=this.nt(e);this.Et(e,n)?d.Qe(n,1):d.$e(n),this.He=this.He.insert(n,this.dt(n).delete(e)),this.He=this.He.insert(n,this.dt(n).add(e)),o&&(this.je=this.je.insert(n,o))}removeTarget(e){this.ze.delete(e)}_t(e){const n=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+n.addedDocuments.size-n.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let n=this.ze.get(e);return n||(n=new V2,this.ze.set(e,n)),n}dt(e){let n=this.He.get(e);return n||(n=new ro(zi),this.He=this.He.insert(e,n)),n}It(e){let n=this.Je.get(e);return n||(n=new ro(zi),this.Je=this.Je.insert(e,n)),n}rt(e){const n=this.ot(e)!==null;return n||gn("WatchChangeAggregator","Detected inactive target",e),n}ot(e){const n=this.ze.get(e);return n&&n.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new V2),this.Ge.getRemoteKeysForTarget(e).forEach((n=>{this.et(e,n,null)}))}Et(e,n){return this.Ge.getRemoteKeysForTarget(e).has(n)}}function fv(){return new Fa(On.comparator)}function j2(){return new Fa(On.comparator)}const kL={asc:"ASCENDING",desc:"DESCENDING"},DL={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},zL={and:"AND",or:"OR"};class OL{constructor(e,n){this.databaseId=e,this.useProto3Json=n}}function xx(i,e){return i.useProto3Json||I0(e)?e:{value:e}}function s0(i,e){return i.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function cA(i,e){return i.useProto3Json?e.toBase64():e.toUint8Array()}function NL(i,e){return s0(i,e.toTimestamp())}function Vh(i){return Ar(!!i,49232),ti.fromTimestamp((function(n){const o=Mf(n);return new ha(o.seconds,o.nanos)})(i))}function C1(i,e){return wx(i,e).canonicalString()}function wx(i,e){const n=(function(d){return new ea(["projects",d.projectId,"databases",d.database])})(i).child("documents");return e===void 0?n:n.child(e)}function hA(i){const e=ea.fromString(i);return Ar(gA(e),10190,{key:e.toString()}),e}function Tx(i,e){return C1(i.databaseId,e.path)}function kb(i,e){const n=hA(e);if(n.get(1)!==i.databaseId.projectId)throw new _n(kt.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+i.databaseId.projectId);if(n.get(3)!==i.databaseId.database)throw new _n(kt.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+i.databaseId.database);return new On(fA(n))}function dA(i,e){return C1(i.databaseId,e)}function BL(i){const e=hA(i);return e.length===4?ea.emptyPath():fA(e)}function Sx(i){return new ea(["projects",i.databaseId.projectId,"databases",i.databaseId.database]).canonicalString()}function fA(i){return Ar(i.length>4&&i.get(4)==="documents",29091,{key:i.toString()}),i.popFirst(5)}function U2(i,e,n){return{name:Tx(i,e),fields:n.value.mapValue.fields}}function FL(i,e){let n;if("targetChange"in e){e.targetChange;const o=(function(k){return k==="NO_CHANGE"?0:k==="ADD"?1:k==="REMOVE"?2:k==="CURRENT"?3:k==="RESET"?4:Hn(39313,{state:k})})(e.targetChange.targetChangeType||"NO_CHANGE"),d=e.targetChange.targetIds||[],g=(function(k,j){return k.useProto3Json?(Ar(j===void 0||typeof j=="string",58123),nl.fromBase64String(j||"")):(Ar(j===void 0||j instanceof Buffer||j instanceof Uint8Array,16193),nl.fromUint8Array(j||new Uint8Array))})(i,e.targetChange.resumeToken),_=e.targetChange.cause,c=_&&(function(k){const j=k.code===void 0?kt.UNKNOWN:oA(k.code);return new _n(j,k.message||"")})(_);n=new uA(o,d,g,c||null)}else if("documentChange"in e){e.documentChange;const o=e.documentChange;o.document,o.document.name,o.document.updateTime;const d=kb(i,o.document.name),g=Vh(o.document.updateTime),_=o.document.createTime?Vh(o.document.createTime):ti.min(),c=new Cc({mapValue:{fields:o.document.fields}}),M=Pl.newFoundDocument(d,g,_,c),k=o.targetIds||[],j=o.removedTargetIds||[];n=new Rv(k,j,M.key,M)}else if("documentDelete"in e){e.documentDelete;const o=e.documentDelete;o.document;const d=kb(i,o.document),g=o.readTime?Vh(o.readTime):ti.min(),_=Pl.newNoDocument(d,g),c=o.removedTargetIds||[];n=new Rv([],c,_.key,_)}else if("documentRemove"in e){e.documentRemove;const o=e.documentRemove;o.document;const d=kb(i,o.document),g=o.removedTargetIds||[];n=new Rv([],g,d,null)}else{if(!("filter"in e))return Hn(11601,{Rt:e});{e.filter;const o=e.filter;o.targetId;const{count:d=0,unchangedNames:g}=o,_=new ML(d,g),c=o.targetId;n=new lA(c,_)}}return n}function VL(i,e){let n;if(e instanceof cy)n={update:U2(i,e.key,e.value)};else if(e instanceof sA)n={delete:Tx(i,e.key)};else if(e instanceof $p)n={update:U2(i,e.key,e.data),updateMask:WL(e.fieldMask)};else{if(!(e instanceof EL))return Hn(16599,{Vt:e.type});n={verify:Tx(i,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map((o=>(function(g,_){const c=_.transform;if(c instanceof $_)return{fieldPath:_.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(c instanceof q_)return{fieldPath:_.field.canonicalString(),appendMissingElements:{values:c.elements}};if(c instanceof G_)return{fieldPath:_.field.canonicalString(),removeAllFromArray:{values:c.elements}};if(c instanceof a0)return{fieldPath:_.field.canonicalString(),increment:c.Ae};throw Hn(20930,{transform:_.transform})})(0,o)))),e.precondition.isNone||(n.currentDocument=(function(d,g){return g.updateTime!==void 0?{updateTime:NL(d,g.updateTime)}:g.exists!==void 0?{exists:g.exists}:Hn(27497)})(i,e.precondition)),n}function jL(i,e){return i&&i.length>0?(Ar(e!==void 0,14353),i.map((n=>(function(d,g){let _=d.updateTime?Vh(d.updateTime):Vh(g);return _.isEqual(ti.min())&&(_=Vh(g)),new wL(_,d.transformResults||[])})(n,e)))):[]}function UL(i,e){return{documents:[dA(i,e.path)]}}function $L(i,e){const n={structuredQuery:{}},o=e.path;let d;e.collectionGroup!==null?(d=o,n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(d=o.popLast(),n.structuredQuery.from=[{collectionId:o.lastSegment()}]),n.parent=dA(i,d);const g=(function(k){if(k.length!==0)return mA(uh.create(k,"and"))})(e.filters);g&&(n.structuredQuery.where=g);const _=(function(k){if(k.length!==0)return k.map((j=>(function(ee){return{field:zm(ee.field),direction:ZL(ee.dir)}})(j)))})(e.orderBy);_&&(n.structuredQuery.orderBy=_);const c=xx(i,e.limit);return c!==null&&(n.structuredQuery.limit=c),e.startAt&&(n.structuredQuery.startAt=(function(k){return{before:k.inclusive,values:k.position}})(e.startAt)),e.endAt&&(n.structuredQuery.endAt=(function(k){return{before:!k.inclusive,values:k.position}})(e.endAt)),{ft:n,parent:d}}function qL(i){let e=BL(i.parent);const n=i.structuredQuery,o=n.from?n.from.length:0;let d=null;if(o>0){Ar(o===1,65062);const j=n.from[0];j.allDescendants?d=j.collectionId:e=e.child(j.collectionId)}let g=[];n.where&&(g=(function(G){const ee=pA(G);return ee instanceof uh&&UE(ee)?ee.getFilters():[ee]})(n.where));let _=[];n.orderBy&&(_=(function(G){return G.map((ee=>(function(xe){return new r0(Om(xe.field),(function(Ne){switch(Ne){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(xe.direction))})(ee)))})(n.orderBy));let c=null;n.limit&&(c=(function(G){let ee;return ee=typeof G=="object"?G.value:G,I0(ee)?null:ee})(n.limit));let M=null;n.startAt&&(M=(function(G){const ee=!!G.before,Y=G.values||[];return new i0(Y,ee)})(n.startAt));let k=null;return n.endAt&&(k=(function(G){const ee=!G.before,Y=G.values||[];return new i0(Y,ee)})(n.endAt)),lL(e,d,_,g,c,"F",M,k)}function GL(i,e){const n=(function(d){switch(d){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Hn(28987,{purpose:d})}})(e.purpose);return n==null?null:{"goog-listen-tags":n}}function pA(i){return i.unaryFilter!==void 0?(function(n){switch(n.unaryFilter.op){case"IS_NAN":const o=Om(n.unaryFilter.field);return Ds.create(o,"==",{doubleValue:NaN});case"IS_NULL":const d=Om(n.unaryFilter.field);return Ds.create(d,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const g=Om(n.unaryFilter.field);return Ds.create(g,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const _=Om(n.unaryFilter.field);return Ds.create(_,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return Hn(61313);default:return Hn(60726)}})(i):i.fieldFilter!==void 0?(function(n){return Ds.create(Om(n.fieldFilter.field),(function(d){switch(d){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return Hn(58110);default:return Hn(50506)}})(n.fieldFilter.op),n.fieldFilter.value)})(i):i.compositeFilter!==void 0?(function(n){return uh.create(n.compositeFilter.filters.map((o=>pA(o))),(function(d){switch(d){case"AND":return"and";case"OR":return"or";default:return Hn(1026)}})(n.compositeFilter.op))})(i):Hn(30097,{filter:i})}function ZL(i){return kL[i]}function HL(i){return DL[i]}function XL(i){return zL[i]}function zm(i){return{fieldPath:i.canonicalString()}}function Om(i){return tl.fromServerFormat(i.fieldPath)}function mA(i){return i instanceof Ds?(function(n){if(n.op==="=="){if(I2(n.value))return{unaryFilter:{field:zm(n.field),op:"IS_NAN"}};if(M2(n.value))return{unaryFilter:{field:zm(n.field),op:"IS_NULL"}}}else if(n.op==="!="){if(I2(n.value))return{unaryFilter:{field:zm(n.field),op:"IS_NOT_NAN"}};if(M2(n.value))return{unaryFilter:{field:zm(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:zm(n.field),op:HL(n.op),value:n.value}}})(i):i instanceof uh?(function(n){const o=n.getFilters().map((d=>mA(d)));return o.length===1?o[0]:{compositeFilter:{op:XL(n.op),filters:o}}})(i):Hn(54877,{filter:i})}function WL(i){const e=[];return i.fields.forEach((n=>e.push(n.canonicalString()))),{fieldPaths:e}}function gA(i){return i.length>=4&&i.get(0)==="projects"&&i.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _f{constructor(e,n,o,d,g=ti.min(),_=ti.min(),c=nl.EMPTY_BYTE_STRING,M=null){this.target=e,this.targetId=n,this.purpose=o,this.sequenceNumber=d,this.snapshotVersion=g,this.lastLimboFreeSnapshotVersion=_,this.resumeToken=c,this.expectedCount=M}withSequenceNumber(e){return new _f(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,n){return new _f(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new _f(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new _f(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KL{constructor(e){this.yt=e}}function YL(i){const e=qL({parent:i.parent,structuredQuery:i.structuredQuery});return i.limitType==="LAST"?bx(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QL{constructor(){this.Cn=new JL}addToCollectionParentIndex(e,n){return this.Cn.add(n),Dt.resolve()}getCollectionParents(e,n){return Dt.resolve(this.Cn.getEntries(n))}addFieldIndex(e,n){return Dt.resolve()}deleteFieldIndex(e,n){return Dt.resolve()}deleteAllFieldIndexes(e){return Dt.resolve()}createTargetIndexes(e,n){return Dt.resolve()}getDocumentsMatchingTarget(e,n){return Dt.resolve(null)}getIndexType(e,n){return Dt.resolve(0)}getFieldIndexes(e,n){return Dt.resolve([])}getNextCollectionGroupToUpdate(e){return Dt.resolve(null)}getMinOffset(e,n){return Dt.resolve(Cf.min())}getMinOffsetFromCollectionGroup(e,n){return Dt.resolve(Cf.min())}updateCollectionGroup(e,n,o){return Dt.resolve()}updateIndexEntries(e,n){return Dt.resolve()}}class JL{constructor(){this.index={}}add(e){const n=e.lastSegment(),o=e.popLast(),d=this.index[n]||new ro(ea.comparator),g=!d.has(o);return this.index[n]=d.add(o),g}has(e){const n=e.lastSegment(),o=e.popLast(),d=this.index[n];return d&&d.has(o)}getEntries(e){return(this.index[e]||new ro(ea.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $2={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},_A=41943040;class ou{static withCacheSize(e){return new ou(e,ou.DEFAULT_COLLECTION_PERCENTILE,ou.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,n,o){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=n,this.maximumSequenceNumbersToCollect=o}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */ou.DEFAULT_COLLECTION_PERCENTILE=10,ou.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,ou.DEFAULT=new ou(_A,ou.DEFAULT_COLLECTION_PERCENTILE,ou.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),ou.DISABLED=new ou(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ym{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new Ym(0)}static cr(){return new Ym(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const q2="LruGarbageCollector",ek=1048576;function G2([i,e],[n,o]){const d=zi(i,n);return d===0?zi(e,o):d}class tk{constructor(e){this.Ir=e,this.buffer=new ro(G2),this.Er=0}dr(){return++this.Er}Ar(e){const n=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(n);else{const o=this.buffer.last();G2(n,o)<0&&(this.buffer=this.buffer.delete(o).add(n))}}get maxValue(){return this.buffer.last()[0]}}class nk{constructor(e,n,o){this.garbageCollector=e,this.asyncQueue=n,this.localStore=o,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){gn(q2,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(n){ag(n)?gn(q2,"Ignoring IndexedDB error during garbage collection: ",n):await rg(n)}await this.Vr(3e5)}))}}class ik{constructor(e,n){this.mr=e,this.params=n}calculateTargetCount(e,n){return this.mr.gr(e).next((o=>Math.floor(n/100*o)))}nthSequenceNumber(e,n){if(n===0)return Dt.resolve(M0.ce);const o=new tk(n);return this.mr.forEachTarget(e,(d=>o.Ar(d.sequenceNumber))).next((()=>this.mr.pr(e,(d=>o.Ar(d))))).next((()=>o.maxValue))}removeTargets(e,n,o){return this.mr.removeTargets(e,n,o)}removeOrphanedDocuments(e,n){return this.mr.removeOrphanedDocuments(e,n)}collect(e,n){return this.params.cacheSizeCollectionThreshold===-1?(gn("LruGarbageCollector","Garbage collection skipped; disabled"),Dt.resolve($2)):this.getCacheSize(e).next((o=>o<this.params.cacheSizeCollectionThreshold?(gn("LruGarbageCollector",`Garbage collection skipped; Cache size ${o} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),$2):this.yr(e,n)))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,n){let o,d,g,_,c,M,k;const j=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((G=>(G>this.params.maximumSequenceNumbersToCollect?(gn("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${G}`),d=this.params.maximumSequenceNumbersToCollect):d=G,_=Date.now(),this.nthSequenceNumber(e,d)))).next((G=>(o=G,c=Date.now(),this.removeTargets(e,o,n)))).next((G=>(g=G,M=Date.now(),this.removeOrphanedDocuments(e,o)))).next((G=>(k=Date.now(),km()<=Ji.DEBUG&&gn("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${_-j}ms
	Determined least recently used ${d} in `+(c-_)+`ms
	Removed ${g} targets in `+(M-c)+`ms
	Removed ${G} documents in `+(k-M)+`ms
Total Duration: ${k-j}ms`),Dt.resolve({didRun:!0,sequenceNumbersCollected:d,targetsRemoved:g,documentsRemoved:G}))))}}function rk(i,e){return new ik(i,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ak{constructor(){this.changes=new Up((e=>e.toString()),((e,n)=>e.isEqual(n))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,n){this.assertNotApplied(),this.changes.set(e,Pl.newInvalidDocument(e).setReadTime(n))}getEntry(e,n){this.assertNotApplied();const o=this.changes.get(n);return o!==void 0?Dt.resolve(o):this.getFromCache(e,n)}getEntries(e,n){return this.getAllFromCache(e,n)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sk{constructor(e,n){this.overlayedDocument=e,this.mutatedFields=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ok{constructor(e,n,o,d){this.remoteDocumentCache=e,this.mutationQueue=n,this.documentOverlayCache=o,this.indexManager=d}getDocument(e,n){let o=null;return this.documentOverlayCache.getOverlay(e,n).next((d=>(o=d,this.remoteDocumentCache.getEntry(e,n)))).next((d=>(o!==null&&I_(o.mutation,d,nh.empty(),ha.now()),d)))}getDocuments(e,n){return this.remoteDocumentCache.getEntries(e,n).next((o=>this.getLocalViewOfDocuments(e,o,Oi()).next((()=>o))))}getLocalViewOfDocuments(e,n,o=Oi()){const d=Tp();return this.populateOverlays(e,d,n).next((()=>this.computeViews(e,n,d,o).next((g=>{let _=__();return g.forEach(((c,M)=>{_=_.insert(c,M.overlayedDocument)})),_}))))}getOverlayedDocuments(e,n){const o=Tp();return this.populateOverlays(e,o,n).next((()=>this.computeViews(e,n,o,Oi())))}populateOverlays(e,n,o){const d=[];return o.forEach((g=>{n.has(g)||d.push(g)})),this.documentOverlayCache.getOverlays(e,d).next((g=>{g.forEach(((_,c)=>{n.set(_,c)}))}))}computeViews(e,n,o,d){let g=Bd();const _=M_(),c=(function(){return M_()})();return n.forEach(((M,k)=>{const j=o.get(k.key);d.has(k.key)&&(j===void 0||j.mutation instanceof $p)?g=g.insert(k.key,k):j!==void 0?(_.set(k.key,j.mutation.getFieldMask()),I_(j.mutation,k,j.mutation.getFieldMask(),ha.now())):_.set(k.key,nh.empty())})),this.recalculateAndSaveOverlays(e,g).next((M=>(M.forEach(((k,j)=>_.set(k,j))),n.forEach(((k,j)=>c.set(k,new sk(j,_.get(k)??null)))),c)))}recalculateAndSaveOverlays(e,n){const o=M_();let d=new Fa(((_,c)=>_-c)),g=Oi();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,n).next((_=>{for(const c of _)c.keys().forEach((M=>{const k=n.get(M);if(k===null)return;let j=o.get(M)||nh.empty();j=c.applyToLocalView(k,j),o.set(M,j);const G=(d.get(c.batchId)||Oi()).add(M);d=d.insert(c.batchId,G)}))})).next((()=>{const _=[],c=d.getReverseIterator();for(;c.hasNext();){const M=c.getNext(),k=M.key,j=M.value,G=QE();j.forEach((ee=>{if(!g.has(ee)){const Y=rA(n.get(ee),o.get(ee));Y!==null&&G.set(ee,Y),g=g.add(ee)}})),_.push(this.documentOverlayCache.saveOverlays(e,k,G))}return Dt.waitFor(_)})).next((()=>o))}recalculateAndSaveOverlaysForDocumentKeys(e,n){return this.remoteDocumentCache.getEntries(e,n).next((o=>this.recalculateAndSaveOverlays(e,o)))}getDocumentsMatchingQuery(e,n,o,d){return(function(_){return On.isDocumentKey(_.path)&&_.collectionGroup===null&&_.filters.length===0})(n)?this.getDocumentsMatchingDocumentQuery(e,n.path):HE(n)?this.getDocumentsMatchingCollectionGroupQuery(e,n,o,d):this.getDocumentsMatchingCollectionQuery(e,n,o,d)}getNextDocuments(e,n,o,d){return this.remoteDocumentCache.getAllFromCollectionGroup(e,n,o,d).next((g=>{const _=d-g.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,n,o.largestBatchId,d-g.size):Dt.resolve(Tp());let c=F_,M=g;return _.next((k=>Dt.forEach(k,((j,G)=>(c<G.largestBatchId&&(c=G.largestBatchId),g.get(j)?Dt.resolve():this.remoteDocumentCache.getEntry(e,j).next((ee=>{M=M.insert(j,ee)}))))).next((()=>this.populateOverlays(e,k,g))).next((()=>this.computeViews(e,M,k,Oi()))).next((j=>({batchId:c,changes:YE(j)})))))}))}getDocumentsMatchingDocumentQuery(e,n){return this.getDocument(e,new On(n)).next((o=>{let d=__();return o.isFoundDocument()&&(d=d.insert(o.key,o)),d}))}getDocumentsMatchingCollectionGroupQuery(e,n,o,d){const g=n.collectionGroup;let _=__();return this.indexManager.getCollectionParents(e,g).next((c=>Dt.forEach(c,(M=>{const k=(function(G,ee){return new uy(ee,null,G.explicitOrderBy.slice(),G.filters.slice(),G.limit,G.limitType,G.startAt,G.endAt)})(n,M.child(g));return this.getDocumentsMatchingCollectionQuery(e,k,o,d).next((j=>{j.forEach(((G,ee)=>{_=_.insert(G,ee)}))}))})).next((()=>_))))}getDocumentsMatchingCollectionQuery(e,n,o,d){let g;return this.documentOverlayCache.getOverlaysForCollection(e,n.path,o.largestBatchId).next((_=>(g=_,this.remoteDocumentCache.getDocumentsMatchingQuery(e,n,o,g,d)))).next((_=>{g.forEach(((M,k)=>{const j=k.getKey();_.get(j)===null&&(_=_.insert(j,Pl.newInvalidDocument(j)))}));let c=__();return _.forEach(((M,k)=>{const j=g.get(M);j!==void 0&&I_(j.mutation,k,nh.empty(),ha.now()),L0(n,k)&&(c=c.insert(M,k))})),c}))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lk{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,n){return Dt.resolve(this.Lr.get(n))}saveBundleMetadata(e,n){return this.Lr.set(n.id,(function(d){return{id:d.id,version:d.version,createTime:Vh(d.createTime)}})(n)),Dt.resolve()}getNamedQuery(e,n){return Dt.resolve(this.kr.get(n))}saveNamedQuery(e,n){return this.kr.set(n.name,(function(d){return{name:d.name,query:YL(d.bundledQuery),readTime:Vh(d.readTime)}})(n)),Dt.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uk{constructor(){this.overlays=new Fa(On.comparator),this.qr=new Map}getOverlay(e,n){return Dt.resolve(this.overlays.get(n))}getOverlays(e,n){const o=Tp();return Dt.forEach(n,(d=>this.getOverlay(e,d).next((g=>{g!==null&&o.set(d,g)})))).next((()=>o))}saveOverlays(e,n,o){return o.forEach(((d,g)=>{this.St(e,n,g)})),Dt.resolve()}removeOverlaysForBatchId(e,n,o){const d=this.qr.get(o);return d!==void 0&&(d.forEach((g=>this.overlays=this.overlays.remove(g))),this.qr.delete(o)),Dt.resolve()}getOverlaysForCollection(e,n,o){const d=Tp(),g=n.length+1,_=new On(n.child("")),c=this.overlays.getIteratorFrom(_);for(;c.hasNext();){const M=c.getNext().value,k=M.getKey();if(!n.isPrefixOf(k.path))break;k.path.length===g&&M.largestBatchId>o&&d.set(M.getKey(),M)}return Dt.resolve(d)}getOverlaysForCollectionGroup(e,n,o,d){let g=new Fa(((k,j)=>k-j));const _=this.overlays.getIterator();for(;_.hasNext();){const k=_.getNext().value;if(k.getKey().getCollectionGroup()===n&&k.largestBatchId>o){let j=g.get(k.largestBatchId);j===null&&(j=Tp(),g=g.insert(k.largestBatchId,j)),j.set(k.getKey(),k)}}const c=Tp(),M=g.getIterator();for(;M.hasNext()&&(M.getNext().value.forEach(((k,j)=>c.set(k,j))),!(c.size()>=d)););return Dt.resolve(c)}St(e,n,o){const d=this.overlays.get(o.key);if(d!==null){const _=this.qr.get(d.largestBatchId).delete(o.key);this.qr.set(d.largestBatchId,_)}this.overlays=this.overlays.insert(o.key,new CL(n,o));let g=this.qr.get(n);g===void 0&&(g=Oi(),this.qr.set(n,g)),this.qr.set(n,g.add(o.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ck{constructor(){this.sessionToken=nl.EMPTY_BYTE_STRING}getSessionToken(e){return Dt.resolve(this.sessionToken)}setSessionToken(e,n){return this.sessionToken=n,Dt.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class M1{constructor(){this.Qr=new ro(bo.$r),this.Ur=new ro(bo.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,n){const o=new bo(e,n);this.Qr=this.Qr.add(o),this.Ur=this.Ur.add(o)}Wr(e,n){e.forEach((o=>this.addReference(o,n)))}removeReference(e,n){this.Gr(new bo(e,n))}zr(e,n){e.forEach((o=>this.removeReference(o,n)))}jr(e){const n=new On(new ea([])),o=new bo(n,e),d=new bo(n,e+1),g=[];return this.Ur.forEachInRange([o,d],(_=>{this.Gr(_),g.push(_.key)})),g}Jr(){this.Qr.forEach((e=>this.Gr(e)))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const n=new On(new ea([])),o=new bo(n,e),d=new bo(n,e+1);let g=Oi();return this.Ur.forEachInRange([o,d],(_=>{g=g.add(_.key)})),g}containsKey(e){const n=new bo(e,0),o=this.Qr.firstAfterOrEqual(n);return o!==null&&e.isEqual(o.key)}}class bo{constructor(e,n){this.key=e,this.Yr=n}static $r(e,n){return On.comparator(e.key,n.key)||zi(e.Yr,n.Yr)}static Kr(e,n){return zi(e.Yr,n.Yr)||On.comparator(e.key,n.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hk{constructor(e,n){this.indexManager=e,this.referenceDelegate=n,this.mutationQueue=[],this.tr=1,this.Zr=new ro(bo.$r)}checkEmpty(e){return Dt.resolve(this.mutationQueue.length===0)}addMutationBatch(e,n,o,d){const g=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const _=new AL(g,n,o,d);this.mutationQueue.push(_);for(const c of d)this.Zr=this.Zr.add(new bo(c.key,g)),this.indexManager.addToCollectionParentIndex(e,c.key.path.popLast());return Dt.resolve(_)}lookupMutationBatch(e,n){return Dt.resolve(this.Xr(n))}getNextMutationBatchAfterBatchId(e,n){const o=n+1,d=this.ei(o),g=d<0?0:d;return Dt.resolve(this.mutationQueue.length>g?this.mutationQueue[g]:null)}getHighestUnacknowledgedBatchId(){return Dt.resolve(this.mutationQueue.length===0?v1:this.tr-1)}getAllMutationBatches(e){return Dt.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,n){const o=new bo(n,0),d=new bo(n,Number.POSITIVE_INFINITY),g=[];return this.Zr.forEachInRange([o,d],(_=>{const c=this.Xr(_.Yr);g.push(c)})),Dt.resolve(g)}getAllMutationBatchesAffectingDocumentKeys(e,n){let o=new ro(zi);return n.forEach((d=>{const g=new bo(d,0),_=new bo(d,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([g,_],(c=>{o=o.add(c.Yr)}))})),Dt.resolve(this.ti(o))}getAllMutationBatchesAffectingQuery(e,n){const o=n.path,d=o.length+1;let g=o;On.isDocumentKey(g)||(g=g.child(""));const _=new bo(new On(g),0);let c=new ro(zi);return this.Zr.forEachWhile((M=>{const k=M.key.path;return!!o.isPrefixOf(k)&&(k.length===d&&(c=c.add(M.Yr)),!0)}),_),Dt.resolve(this.ti(c))}ti(e){const n=[];return e.forEach((o=>{const d=this.Xr(o);d!==null&&n.push(d)})),n}removeMutationBatch(e,n){Ar(this.ni(n.batchId,"removed")===0,55003),this.mutationQueue.shift();let o=this.Zr;return Dt.forEach(n.mutations,(d=>{const g=new bo(d.key,n.batchId);return o=o.delete(g),this.referenceDelegate.markPotentiallyOrphaned(e,d.key)})).next((()=>{this.Zr=o}))}ir(e){}containsKey(e,n){const o=new bo(n,0),d=this.Zr.firstAfterOrEqual(o);return Dt.resolve(n.isEqual(d&&d.key))}performConsistencyCheck(e){return this.mutationQueue.length,Dt.resolve()}ni(e,n){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const n=this.ei(e);return n<0||n>=this.mutationQueue.length?null:this.mutationQueue[n]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dk{constructor(e){this.ri=e,this.docs=(function(){return new Fa(On.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,n){const o=n.key,d=this.docs.get(o),g=d?d.size:0,_=this.ri(n);return this.docs=this.docs.insert(o,{document:n.mutableCopy(),size:_}),this.size+=_-g,this.indexManager.addToCollectionParentIndex(e,o.path.popLast())}removeEntry(e){const n=this.docs.get(e);n&&(this.docs=this.docs.remove(e),this.size-=n.size)}getEntry(e,n){const o=this.docs.get(n);return Dt.resolve(o?o.document.mutableCopy():Pl.newInvalidDocument(n))}getEntries(e,n){let o=Bd();return n.forEach((d=>{const g=this.docs.get(d);o=o.insert(d,g?g.document.mutableCopy():Pl.newInvalidDocument(d))})),Dt.resolve(o)}getDocumentsMatchingQuery(e,n,o,d){let g=Bd();const _=n.path,c=new On(_.child("__id-9223372036854775808__")),M=this.docs.getIteratorFrom(c);for(;M.hasNext();){const{key:k,value:{document:j}}=M.getNext();if(!_.isPrefixOf(k.path))break;k.path.length>_.length+1||V5(F5(j),o)<=0||(d.has(j.key)||L0(n,j))&&(g=g.insert(j.key,j.mutableCopy()))}return Dt.resolve(g)}getAllFromCollectionGroup(e,n,o,d){Hn(9500)}ii(e,n){return Dt.forEach(this.docs,(o=>n(o)))}newChangeBuffer(e){return new fk(this)}getSize(e){return Dt.resolve(this.size)}}class fk extends ak{constructor(e){super(),this.Nr=e}applyChanges(e){const n=[];return this.changes.forEach(((o,d)=>{d.isValidDocument()?n.push(this.Nr.addEntry(e,d)):this.Nr.removeEntry(o)})),Dt.waitFor(n)}getFromCache(e,n){return this.Nr.getEntry(e,n)}getAllFromCache(e,n){return this.Nr.getEntries(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pk{constructor(e){this.persistence=e,this.si=new Up((n=>w1(n)),T1),this.lastRemoteSnapshotVersion=ti.min(),this.highestTargetId=0,this.oi=0,this._i=new M1,this.targetCount=0,this.ai=Ym.ur()}forEachTarget(e,n){return this.si.forEach(((o,d)=>n(d))),Dt.resolve()}getLastRemoteSnapshotVersion(e){return Dt.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return Dt.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),Dt.resolve(this.highestTargetId)}setTargetsMetadata(e,n,o){return o&&(this.lastRemoteSnapshotVersion=o),n>this.oi&&(this.oi=n),Dt.resolve()}Pr(e){this.si.set(e.target,e);const n=e.targetId;n>this.highestTargetId&&(this.ai=new Ym(n),this.highestTargetId=n),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,n){return this.Pr(n),this.targetCount+=1,Dt.resolve()}updateTargetData(e,n){return this.Pr(n),Dt.resolve()}removeTargetData(e,n){return this.si.delete(n.target),this._i.jr(n.targetId),this.targetCount-=1,Dt.resolve()}removeTargets(e,n,o){let d=0;const g=[];return this.si.forEach(((_,c)=>{c.sequenceNumber<=n&&o.get(c.targetId)===null&&(this.si.delete(_),g.push(this.removeMatchingKeysForTargetId(e,c.targetId)),d++)})),Dt.waitFor(g).next((()=>d))}getTargetCount(e){return Dt.resolve(this.targetCount)}getTargetData(e,n){const o=this.si.get(n)||null;return Dt.resolve(o)}addMatchingKeys(e,n,o){return this._i.Wr(n,o),Dt.resolve()}removeMatchingKeys(e,n,o){this._i.zr(n,o);const d=this.persistence.referenceDelegate,g=[];return d&&n.forEach((_=>{g.push(d.markPotentiallyOrphaned(e,_))})),Dt.waitFor(g)}removeMatchingKeysForTargetId(e,n){return this._i.jr(n),Dt.resolve()}getMatchingKeysForTargetId(e,n){const o=this._i.Hr(n);return Dt.resolve(o)}containsKey(e,n){return Dt.resolve(this._i.containsKey(n))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yA{constructor(e,n){this.ui={},this.overlays={},this.ci=new M0(0),this.li=!1,this.li=!0,this.hi=new ck,this.referenceDelegate=e(this),this.Pi=new pk(this),this.indexManager=new QL,this.remoteDocumentCache=(function(d){return new dk(d)})((o=>this.referenceDelegate.Ti(o))),this.serializer=new KL(n),this.Ii=new lk(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let n=this.overlays[e.toKey()];return n||(n=new uk,this.overlays[e.toKey()]=n),n}getMutationQueue(e,n){let o=this.ui[e.toKey()];return o||(o=new hk(n,this.referenceDelegate),this.ui[e.toKey()]=o),o}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,n,o){gn("MemoryPersistence","Starting transaction:",e);const d=new mk(this.ci.next());return this.referenceDelegate.Ei(),o(d).next((g=>this.referenceDelegate.di(d).next((()=>g)))).toPromise().then((g=>(d.raiseOnCommittedEvent(),g)))}Ai(e,n){return Dt.or(Object.values(this.ui).map((o=>()=>o.containsKey(e,n))))}}class mk extends U5{constructor(e){super(),this.currentSequenceNumber=e}}class I1{constructor(e){this.persistence=e,this.Ri=new M1,this.Vi=null}static mi(e){return new I1(e)}get fi(){if(this.Vi)return this.Vi;throw Hn(60996)}addReference(e,n,o){return this.Ri.addReference(o,n),this.fi.delete(o.toString()),Dt.resolve()}removeReference(e,n,o){return this.Ri.removeReference(o,n),this.fi.add(o.toString()),Dt.resolve()}markPotentiallyOrphaned(e,n){return this.fi.add(n.toString()),Dt.resolve()}removeTarget(e,n){this.Ri.jr(n.targetId).forEach((d=>this.fi.add(d.toString())));const o=this.persistence.getTargetCache();return o.getMatchingKeysForTargetId(e,n.targetId).next((d=>{d.forEach((g=>this.fi.add(g.toString())))})).next((()=>o.removeTargetData(e,n)))}Ei(){this.Vi=new Set}di(e){const n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Dt.forEach(this.fi,(o=>{const d=On.fromPath(o);return this.gi(e,d).next((g=>{g||n.removeEntry(d,ti.min())}))})).next((()=>(this.Vi=null,n.apply(e))))}updateLimboDocument(e,n){return this.gi(e,n).next((o=>{o?this.fi.delete(n.toString()):this.fi.add(n.toString())}))}Ti(e){return 0}gi(e,n){return Dt.or([()=>Dt.resolve(this.Ri.containsKey(n)),()=>this.persistence.getTargetCache().containsKey(e,n),()=>this.persistence.Ai(e,n)])}}class o0{constructor(e,n){this.persistence=e,this.pi=new Up((o=>G5(o.path)),((o,d)=>o.isEqual(d))),this.garbageCollector=rk(this,n)}static mi(e,n){return new o0(e,n)}Ei(){}di(e){return Dt.resolve()}forEachTarget(e,n){return this.persistence.getTargetCache().forEachTarget(e,n)}gr(e){const n=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next((o=>n.next((d=>o+d))))}wr(e){let n=0;return this.pr(e,(o=>{n++})).next((()=>n))}pr(e,n){return Dt.forEach(this.pi,((o,d)=>this.br(e,o,d).next((g=>g?Dt.resolve():n(d)))))}removeTargets(e,n,o){return this.persistence.getTargetCache().removeTargets(e,n,o)}removeOrphanedDocuments(e,n){let o=0;const d=this.persistence.getRemoteDocumentCache(),g=d.newChangeBuffer();return d.ii(e,(_=>this.br(e,_,n).next((c=>{c||(o++,g.removeEntry(_,ti.min()))})))).next((()=>g.apply(e))).next((()=>o))}markPotentiallyOrphaned(e,n){return this.pi.set(n,e.currentSequenceNumber),Dt.resolve()}removeTarget(e,n){const o=n.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,o)}addReference(e,n,o){return this.pi.set(o,e.currentSequenceNumber),Dt.resolve()}removeReference(e,n,o){return this.pi.set(o,e.currentSequenceNumber),Dt.resolve()}updateLimboDocument(e,n){return this.pi.set(n,e.currentSequenceNumber),Dt.resolve()}Ti(e){let n=e.key.toString().length;return e.isFoundDocument()&&(n+=Mv(e.data.value)),n}br(e,n,o){return Dt.or([()=>this.persistence.Ai(e,n),()=>this.persistence.getTargetCache().containsKey(e,n),()=>{const d=this.pi.get(n);return Dt.resolve(d!==void 0&&d>o)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class P1{constructor(e,n,o,d){this.targetId=e,this.fromCache=n,this.Es=o,this.ds=d}static As(e,n){let o=Oi(),d=Oi();for(const g of n.docChanges)switch(g.type){case 0:o=o.add(g.doc.key);break;case 1:d=d.add(g.doc.key)}return new P1(e,n.fromCache,o,d)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gk{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _k{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(function(){return uR()?8:$5(sR())>0?6:4})()}initialize(e,n){this.ps=e,this.indexManager=n,this.Rs=!0}getDocumentsMatchingQuery(e,n,o,d){const g={result:null};return this.ys(e,n).next((_=>{g.result=_})).next((()=>{if(!g.result)return this.ws(e,n,d,o).next((_=>{g.result=_}))})).next((()=>{if(g.result)return;const _=new gk;return this.Ss(e,n,_).next((c=>{if(g.result=c,this.Vs)return this.bs(e,n,_,c.size)}))})).next((()=>g.result))}bs(e,n,o,d){return o.documentReadCount<this.fs?(km()<=Ji.DEBUG&&gn("QueryEngine","SDK will not create cache indexes for query:",Dm(n),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),Dt.resolve()):(km()<=Ji.DEBUG&&gn("QueryEngine","Query:",Dm(n),"scans",o.documentReadCount,"local documents and returns",d,"documents as results."),o.documentReadCount>this.gs*d?(km()<=Ji.DEBUG&&gn("QueryEngine","The SDK decides to create cache indexes for query:",Dm(n),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Fh(n))):Dt.resolve())}ys(e,n){if(k2(n))return Dt.resolve(null);let o=Fh(n);return this.indexManager.getIndexType(e,o).next((d=>d===0?null:(n.limit!==null&&d===1&&(n=bx(n,null,"F"),o=Fh(n)),this.indexManager.getDocumentsMatchingTarget(e,o).next((g=>{const _=Oi(...g);return this.ps.getDocuments(e,_).next((c=>this.indexManager.getMinOffset(e,o).next((M=>{const k=this.Ds(n,c);return this.Cs(n,k,_,M.readTime)?this.ys(e,bx(n,null,"F")):this.vs(e,k,n,M)}))))})))))}ws(e,n,o,d){return k2(n)||d.isEqual(ti.min())?Dt.resolve(null):this.ps.getDocuments(e,o).next((g=>{const _=this.Ds(n,g);return this.Cs(n,_,o,d)?Dt.resolve(null):(km()<=Ji.DEBUG&&gn("QueryEngine","Re-using previous result from %s to execute query: %s",d.toString(),Dm(n)),this.vs(e,_,n,B5(d,F_)).next((c=>c)))}))}Ds(e,n){let o=new ro(WE(e));return n.forEach(((d,g)=>{L0(e,g)&&(o=o.add(g))})),o}Cs(e,n,o,d){if(e.limit===null)return!1;if(o.size!==n.size)return!0;const g=e.limitType==="F"?n.last():n.first();return!!g&&(g.hasPendingWrites||g.version.compareTo(d)>0)}Ss(e,n,o){return km()<=Ji.DEBUG&&gn("QueryEngine","Using full collection scan to execute query:",Dm(n)),this.ps.getDocumentsMatchingQuery(e,n,Cf.min(),o)}vs(e,n,o,d){return this.ps.getDocumentsMatchingQuery(e,o,d).next((g=>(n.forEach((_=>{g=g.insert(_.key,_)})),g)))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const R1="LocalStore",yk=3e8;class vk{constructor(e,n,o,d){this.persistence=e,this.Fs=n,this.serializer=d,this.Ms=new Fa(zi),this.xs=new Up((g=>w1(g)),T1),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(o)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new ok(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(n=>e.collect(n,this.Ms)))}}function bk(i,e,n,o){return new vk(i,e,n,o)}async function vA(i,e){const n=ai(i);return await n.persistence.runTransaction("Handle user change","readonly",(o=>{let d;return n.mutationQueue.getAllMutationBatches(o).next((g=>(d=g,n.Bs(e),n.mutationQueue.getAllMutationBatches(o)))).next((g=>{const _=[],c=[];let M=Oi();for(const k of d){_.push(k.batchId);for(const j of k.mutations)M=M.add(j.key)}for(const k of g){c.push(k.batchId);for(const j of k.mutations)M=M.add(j.key)}return n.localDocuments.getDocuments(o,M).next((k=>({Ls:k,removedBatchIds:_,addedBatchIds:c})))}))}))}function xk(i,e){const n=ai(i);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(o=>{const d=e.batch.keys(),g=n.Ns.newChangeBuffer({trackRemovals:!0});return(function(c,M,k,j){const G=k.batch,ee=G.keys();let Y=Dt.resolve();return ee.forEach((xe=>{Y=Y.next((()=>j.getEntry(M,xe))).next((be=>{const Ne=k.docVersions.get(xe);Ar(Ne!==null,48541),be.version.compareTo(Ne)<0&&(G.applyToRemoteDocument(be,k),be.isValidDocument()&&(be.setReadTime(k.commitVersion),j.addEntry(be)))}))})),Y.next((()=>c.mutationQueue.removeMutationBatch(M,G)))})(n,o,e,g).next((()=>g.apply(o))).next((()=>n.mutationQueue.performConsistencyCheck(o))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(o,d,e.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(o,(function(c){let M=Oi();for(let k=0;k<c.mutationResults.length;++k)c.mutationResults[k].transformResults.length>0&&(M=M.add(c.batch.mutations[k].key));return M})(e)))).next((()=>n.localDocuments.getDocuments(o,d)))}))}function bA(i){const e=ai(i);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(n=>e.Pi.getLastRemoteSnapshotVersion(n)))}function wk(i,e){const n=ai(i),o=e.snapshotVersion;let d=n.Ms;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(g=>{const _=n.Ns.newChangeBuffer({trackRemovals:!0});d=n.Ms;const c=[];e.targetChanges.forEach(((j,G)=>{const ee=d.get(G);if(!ee)return;c.push(n.Pi.removeMatchingKeys(g,j.removedDocuments,G).next((()=>n.Pi.addMatchingKeys(g,j.addedDocuments,G))));let Y=ee.withSequenceNumber(g.currentSequenceNumber);e.targetMismatches.get(G)!==null?Y=Y.withResumeToken(nl.EMPTY_BYTE_STRING,ti.min()).withLastLimboFreeSnapshotVersion(ti.min()):j.resumeToken.approximateByteSize()>0&&(Y=Y.withResumeToken(j.resumeToken,o)),d=d.insert(G,Y),(function(be,Ne,tt){return be.resumeToken.approximateByteSize()===0||Ne.snapshotVersion.toMicroseconds()-be.snapshotVersion.toMicroseconds()>=yk?!0:tt.addedDocuments.size+tt.modifiedDocuments.size+tt.removedDocuments.size>0})(ee,Y,j)&&c.push(n.Pi.updateTargetData(g,Y))}));let M=Bd(),k=Oi();if(e.documentUpdates.forEach((j=>{e.resolvedLimboDocuments.has(j)&&c.push(n.persistence.referenceDelegate.updateLimboDocument(g,j))})),c.push(Tk(g,_,e.documentUpdates).next((j=>{M=j.ks,k=j.qs}))),!o.isEqual(ti.min())){const j=n.Pi.getLastRemoteSnapshotVersion(g).next((G=>n.Pi.setTargetsMetadata(g,g.currentSequenceNumber,o)));c.push(j)}return Dt.waitFor(c).next((()=>_.apply(g))).next((()=>n.localDocuments.getLocalViewOfDocuments(g,M,k))).next((()=>M))})).then((g=>(n.Ms=d,g)))}function Tk(i,e,n){let o=Oi(),d=Oi();return n.forEach((g=>o=o.add(g))),e.getEntries(i,o).next((g=>{let _=Bd();return n.forEach(((c,M)=>{const k=g.get(c);M.isFoundDocument()!==k.isFoundDocument()&&(d=d.add(c)),M.isNoDocument()&&M.version.isEqual(ti.min())?(e.removeEntry(c,M.readTime),_=_.insert(c,M)):!k.isValidDocument()||M.version.compareTo(k.version)>0||M.version.compareTo(k.version)===0&&k.hasPendingWrites?(e.addEntry(M),_=_.insert(c,M)):gn(R1,"Ignoring outdated watch update for ",c,". Current version:",k.version," Watch version:",M.version)})),{ks:_,qs:d}}))}function Sk(i,e){const n=ai(i);return n.persistence.runTransaction("Get next mutation batch","readonly",(o=>(e===void 0&&(e=v1),n.mutationQueue.getNextMutationBatchAfterBatchId(o,e))))}function Ek(i,e){const n=ai(i);return n.persistence.runTransaction("Allocate target","readwrite",(o=>{let d;return n.Pi.getTargetData(o,e).next((g=>g?(d=g,Dt.resolve(d)):n.Pi.allocateTargetId(o).next((_=>(d=new _f(e,_,"TargetPurposeListen",o.currentSequenceNumber),n.Pi.addTargetData(o,d).next((()=>d)))))))})).then((o=>{const d=n.Ms.get(o.targetId);return(d===null||o.snapshotVersion.compareTo(d.snapshotVersion)>0)&&(n.Ms=n.Ms.insert(o.targetId,o),n.xs.set(e,o.targetId)),o}))}async function Ex(i,e,n){const o=ai(i),d=o.Ms.get(e),g=n?"readwrite":"readwrite-primary";try{n||await o.persistence.runTransaction("Release target",g,(_=>o.persistence.referenceDelegate.removeTarget(_,d)))}catch(_){if(!ag(_))throw _;gn(R1,`Failed to update sequence numbers for target ${e}: ${_}`)}o.Ms=o.Ms.remove(e),o.xs.delete(d.target)}function Z2(i,e,n){const o=ai(i);let d=ti.min(),g=Oi();return o.persistence.runTransaction("Execute query","readwrite",(_=>(function(M,k,j){const G=ai(M),ee=G.xs.get(j);return ee!==void 0?Dt.resolve(G.Ms.get(ee)):G.Pi.getTargetData(k,j)})(o,_,Fh(e)).next((c=>{if(c)return d=c.lastLimboFreeSnapshotVersion,o.Pi.getMatchingKeysForTargetId(_,c.targetId).next((M=>{g=M}))})).next((()=>o.Fs.getDocumentsMatchingQuery(_,e,n?d:ti.min(),n?g:Oi()))).next((c=>(Ak(o,cL(e),c),{documents:c,Qs:g})))))}function Ak(i,e,n){let o=i.Os.get(e)||ti.min();n.forEach(((d,g)=>{g.readTime.compareTo(o)>0&&(o=g.readTime)})),i.Os.set(e,o)}class H2{constructor(){this.activeTargetIds=gL()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Ck{constructor(){this.Mo=new H2,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,n,o){}addLocalQueryTarget(e,n=!0){return n&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,n,o){this.xo[e]=n}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new H2,Promise.resolve()}handleUserChange(e,n,o){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mk{Oo(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const X2="ConnectivityMonitor";class W2{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){gn(X2,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){gn(X2,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let pv=null;function Ax(){return pv===null?pv=(function(){return 268435456+Math.round(2147483648*Math.random())})():pv++,"0x"+pv.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Db="RestConnection",Ik={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Pk{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const n=e.ssl?"https":"http",o=encodeURIComponent(this.databaseId.projectId),d=encodeURIComponent(this.databaseId.database);this.Uo=n+"://"+e.host,this.Ko=`projects/${o}/databases/${d}`,this.Wo=this.databaseId.database===t0?`project_id=${o}`:`project_id=${o}&database_id=${d}`}Go(e,n,o,d,g){const _=Ax(),c=this.zo(e,n.toUriEncodedString());gn(Db,`Sending RPC '${e}' ${_}:`,c,o);const M={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(M,d,g);const{host:k}=new URL(c),j=p1(k);return this.Jo(e,c,M,o,j).then((G=>(gn(Db,`Received RPC '${e}' ${_}: `,G),G)),(G=>{throw Hm(Db,`RPC '${e}' ${_} failed with error: `,G,"url: ",c,"request:",o),G}))}Ho(e,n,o,d,g,_){return this.Go(e,n,o,d,g)}jo(e,n,o){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+ig})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach(((d,g)=>e[g]=d)),o&&o.headers.forEach(((d,g)=>e[g]=d))}zo(e,n){const o=Ik[e];return`${this.Uo}/v1/${n}:${o}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rk{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ml="WebChannelConnection";class Lk extends Pk{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,n,o,d,g){const _=Ax();return new Promise(((c,M)=>{const k=new xE;k.setWithCredentials(!0),k.listenOnce(wE.COMPLETE,(()=>{try{switch(k.getLastErrorCode()){case Cv.NO_ERROR:const G=k.getResponseJson();gn(Ml,`XHR for RPC '${e}' ${_} received:`,JSON.stringify(G)),c(G);break;case Cv.TIMEOUT:gn(Ml,`RPC '${e}' ${_} timed out`),M(new _n(kt.DEADLINE_EXCEEDED,"Request time out"));break;case Cv.HTTP_ERROR:const ee=k.getStatus();if(gn(Ml,`RPC '${e}' ${_} failed with status:`,ee,"response text:",k.getResponseText()),ee>0){let Y=k.getResponseJson();Array.isArray(Y)&&(Y=Y[0]);const xe=Y==null?void 0:Y.error;if(xe&&xe.status&&xe.message){const be=(function(tt){const Je=tt.toLowerCase().replace(/_/g,"-");return Object.values(kt).indexOf(Je)>=0?Je:kt.UNKNOWN})(xe.status);M(new _n(be,xe.message))}else M(new _n(kt.UNKNOWN,"Server responded with status "+k.getStatus()))}else M(new _n(kt.UNAVAILABLE,"Connection failed."));break;default:Hn(9055,{l_:e,streamId:_,h_:k.getLastErrorCode(),P_:k.getLastError()})}}finally{gn(Ml,`RPC '${e}' ${_} completed.`)}}));const j=JSON.stringify(d);gn(Ml,`RPC '${e}' ${_} sending request:`,d),k.send(n,"POST",j,o,15)}))}T_(e,n,o){const d=Ax(),g=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],_=EE(),c=SE(),M={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},k=this.longPollingOptions.timeoutSeconds;k!==void 0&&(M.longPollingTimeout=Math.round(1e3*k)),this.useFetchStreams&&(M.useFetchStreams=!0),this.jo(M.initMessageHeaders,n,o),M.encodeInitMessageHeaders=!0;const j=g.join("");gn(Ml,`Creating RPC '${e}' stream ${d}: ${j}`,M);const G=_.createWebChannel(j,M);this.I_(G);let ee=!1,Y=!1;const xe=new Rk({Yo:Ne=>{Y?gn(Ml,`Not sending because RPC '${e}' stream ${d} is closed:`,Ne):(ee||(gn(Ml,`Opening RPC '${e}' stream ${d} transport.`),G.open(),ee=!0),gn(Ml,`RPC '${e}' stream ${d} sending:`,Ne),G.send(Ne))},Zo:()=>G.close()}),be=(Ne,tt,Je)=>{Ne.listen(tt,(qe=>{try{Je(qe)}catch(He){setTimeout((()=>{throw He}),0)}}))};return be(G,g_.EventType.OPEN,(()=>{Y||(gn(Ml,`RPC '${e}' stream ${d} transport opened.`),xe.o_())})),be(G,g_.EventType.CLOSE,(()=>{Y||(Y=!0,gn(Ml,`RPC '${e}' stream ${d} transport closed`),xe.a_(),this.E_(G))})),be(G,g_.EventType.ERROR,(Ne=>{Y||(Y=!0,Hm(Ml,`RPC '${e}' stream ${d} transport errored. Name:`,Ne.name,"Message:",Ne.message),xe.a_(new _n(kt.UNAVAILABLE,"The operation could not be completed")))})),be(G,g_.EventType.MESSAGE,(Ne=>{var tt;if(!Y){const Je=Ne.data[0];Ar(!!Je,16349);const qe=Je,He=(qe==null?void 0:qe.error)||((tt=qe[0])==null?void 0:tt.error);if(He){gn(Ml,`RPC '${e}' stream ${d} received error:`,He);const Ue=He.status;let Be=(function(_e){const Ae=ks[_e];if(Ae!==void 0)return oA(Ae)})(Ue),de=He.message;Be===void 0&&(Be=kt.INTERNAL,de="Unknown error status: "+Ue+" with message "+He.message),Y=!0,xe.a_(new _n(Be,de)),G.close()}else gn(Ml,`RPC '${e}' stream ${d} received:`,Je),xe.u_(Je)}})),be(c,TE.STAT_EVENT,(Ne=>{Ne.stat===fx.PROXY?gn(Ml,`RPC '${e}' stream ${d} detected buffering proxy`):Ne.stat===fx.NOPROXY&&gn(Ml,`RPC '${e}' stream ${d} detected no buffering proxy`)})),setTimeout((()=>{xe.__()}),0),xe}terminate(){this.c_.forEach((e=>e.close())),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter((n=>n===e))}}function zb(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function O0(i){return new OL(i,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xA{constructor(e,n,o=1e3,d=1.5,g=6e4){this.Mi=e,this.timerId=n,this.d_=o,this.A_=d,this.R_=g,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const n=Math.floor(this.V_+this.y_()),o=Math.max(0,Date.now()-this.f_),d=Math.max(0,n-o);d>0&&gn("ExponentialBackoff",`Backing off for ${d} ms (base delay: ${this.V_} ms, delay with jitter: ${n} ms, last attempt: ${o} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,d,(()=>(this.f_=Date.now(),e()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const K2="PersistentStream";class wA{constructor(e,n,o,d,g,_,c,M){this.Mi=e,this.S_=o,this.b_=d,this.connection=g,this.authCredentialsProvider=_,this.appCheckCredentialsProvider=c,this.listener=M,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new xA(e,n)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,n){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():n&&n.code===kt.RESOURCE_EXHAUSTED?(Nd(n.toString()),Nd("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):n&&n.code===kt.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(n)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),n=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([o,d])=>{this.D_===n&&this.G_(o,d)}),(o=>{e((()=>{const d=new _n(kt.UNKNOWN,"Fetching auth token failed: "+o.message);return this.z_(d)}))}))}G_(e,n){const o=this.W_(this.D_);this.stream=this.j_(e,n),this.stream.Xo((()=>{o((()=>this.listener.Xo()))})),this.stream.t_((()=>{o((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((d=>{o((()=>this.z_(d)))})),this.stream.onMessage((d=>{o((()=>++this.F_==1?this.J_(d):this.onNext(d)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(e){return gn(K2,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return n=>{this.Mi.enqueueAndForget((()=>this.D_===e?n():(gn(K2,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class kk extends wA{constructor(e,n,o,d,g,_){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",n,o,d,_),this.serializer=g}j_(e,n){return this.connection.T_("Listen",e,n)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const n=FL(this.serializer,e),o=(function(g){if(!("targetChange"in g))return ti.min();const _=g.targetChange;return _.targetIds&&_.targetIds.length?ti.min():_.readTime?Vh(_.readTime):ti.min()})(e);return this.listener.H_(n,o)}Y_(e){const n={};n.database=Sx(this.serializer),n.addTarget=(function(g,_){let c;const M=_.target;if(c=yx(M)?{documents:UL(g,M)}:{query:$L(g,M).ft},c.targetId=_.targetId,_.resumeToken.approximateByteSize()>0){c.resumeToken=cA(g,_.resumeToken);const k=xx(g,_.expectedCount);k!==null&&(c.expectedCount=k)}else if(_.snapshotVersion.compareTo(ti.min())>0){c.readTime=s0(g,_.snapshotVersion.toTimestamp());const k=xx(g,_.expectedCount);k!==null&&(c.expectedCount=k)}return c})(this.serializer,e);const o=GL(this.serializer,e);o&&(n.labels=o),this.q_(n)}Z_(e){const n={};n.database=Sx(this.serializer),n.removeTarget=e,this.q_(n)}}class Dk extends wA{constructor(e,n,o,d,g,_){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",n,o,d,_),this.serializer=g}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,n){return this.connection.T_("Write",e,n)}J_(e){return Ar(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,Ar(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){Ar(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const n=jL(e.writeResults,e.commitTime),o=Vh(e.commitTime);return this.listener.na(o,n)}ra(){const e={};e.database=Sx(this.serializer),this.q_(e)}ea(e){const n={streamToken:this.lastStreamToken,writes:e.map((o=>VL(this.serializer,o)))};this.q_(n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zk{}class Ok extends zk{constructor(e,n,o,d){super(),this.authCredentials=e,this.appCheckCredentials=n,this.connection=o,this.serializer=d,this.ia=!1}sa(){if(this.ia)throw new _n(kt.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,n,o,d){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([g,_])=>this.connection.Go(e,wx(n,o),d,g,_))).catch((g=>{throw g.name==="FirebaseError"?(g.code===kt.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),g):new _n(kt.UNKNOWN,g.toString())}))}Ho(e,n,o,d,g){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([_,c])=>this.connection.Ho(e,wx(n,o),d,_,c,g))).catch((_=>{throw _.name==="FirebaseError"?(_.code===kt.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),_):new _n(kt.UNKNOWN,_.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}class Nk{constructor(e,n){this.asyncQueue=e,this.onlineStateHandler=n,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const n=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(Nd(n),this.aa=!1):gn("OnlineStateTracker",n)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dp="RemoteStore";class Bk{constructor(e,n,o,d,g){this.localStore=e,this.datastore=n,this.asyncQueue=o,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=g,this.Aa.Oo((_=>{o.enqueueAndForget((async()=>{qp(this)&&(gn(Dp,"Restarting streams for network reachability change."),await(async function(M){const k=ai(M);k.Ea.add(4),await dy(k),k.Ra.set("Unknown"),k.Ea.delete(4),await N0(k)})(this))}))})),this.Ra=new Nk(o,d)}}async function N0(i){if(qp(i))for(const e of i.da)await e(!0)}async function dy(i){for(const e of i.da)await e(!1)}function TA(i,e){const n=ai(i);n.Ia.has(e.targetId)||(n.Ia.set(e.targetId,e),z1(n)?D1(n):sg(n).O_()&&k1(n,e))}function L1(i,e){const n=ai(i),o=sg(n);n.Ia.delete(e),o.O_()&&SA(n,e),n.Ia.size===0&&(o.O_()?o.L_():qp(n)&&n.Ra.set("Unknown"))}function k1(i,e){if(i.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(ti.min())>0){const n=i.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}sg(i).Y_(e)}function SA(i,e){i.Va.Ue(e),sg(i).Z_(e)}function D1(i){i.Va=new LL({getRemoteKeysForTarget:e=>i.remoteSyncer.getRemoteKeysForTarget(e),At:e=>i.Ia.get(e)||null,ht:()=>i.datastore.serializer.databaseId}),sg(i).start(),i.Ra.ua()}function z1(i){return qp(i)&&!sg(i).x_()&&i.Ia.size>0}function qp(i){return ai(i).Ea.size===0}function EA(i){i.Va=void 0}async function Fk(i){i.Ra.set("Online")}async function Vk(i){i.Ia.forEach(((e,n)=>{k1(i,e)}))}async function jk(i,e){EA(i),z1(i)?(i.Ra.ha(e),D1(i)):i.Ra.set("Unknown")}async function Uk(i,e,n){if(i.Ra.set("Online"),e instanceof uA&&e.state===2&&e.cause)try{await(async function(d,g){const _=g.cause;for(const c of g.targetIds)d.Ia.has(c)&&(await d.remoteSyncer.rejectListen(c,_),d.Ia.delete(c),d.Va.removeTarget(c))})(i,e)}catch(o){gn(Dp,"Failed to remove targets %s: %s ",e.targetIds.join(","),o),await l0(i,o)}else if(e instanceof Rv?i.Va.Ze(e):e instanceof lA?i.Va.st(e):i.Va.tt(e),!n.isEqual(ti.min()))try{const o=await bA(i.localStore);n.compareTo(o)>=0&&await(function(g,_){const c=g.Va.Tt(_);return c.targetChanges.forEach(((M,k)=>{if(M.resumeToken.approximateByteSize()>0){const j=g.Ia.get(k);j&&g.Ia.set(k,j.withResumeToken(M.resumeToken,_))}})),c.targetMismatches.forEach(((M,k)=>{const j=g.Ia.get(M);if(!j)return;g.Ia.set(M,j.withResumeToken(nl.EMPTY_BYTE_STRING,j.snapshotVersion)),SA(g,M);const G=new _f(j.target,M,k,j.sequenceNumber);k1(g,G)})),g.remoteSyncer.applyRemoteEvent(c)})(i,n)}catch(o){gn(Dp,"Failed to raise snapshot:",o),await l0(i,o)}}async function l0(i,e,n){if(!ag(e))throw e;i.Ea.add(1),await dy(i),i.Ra.set("Offline"),n||(n=()=>bA(i.localStore)),i.asyncQueue.enqueueRetryable((async()=>{gn(Dp,"Retrying IndexedDB access"),await n(),i.Ea.delete(1),await N0(i)}))}function AA(i,e){return e().catch((n=>l0(i,n,e)))}async function B0(i){const e=ai(i),n=Rf(e);let o=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:v1;for(;$k(e);)try{const d=await Sk(e.localStore,o);if(d===null){e.Ta.length===0&&n.L_();break}o=d.batchId,qk(e,d)}catch(d){await l0(e,d)}CA(e)&&MA(e)}function $k(i){return qp(i)&&i.Ta.length<10}function qk(i,e){i.Ta.push(e);const n=Rf(i);n.O_()&&n.X_&&n.ea(e.mutations)}function CA(i){return qp(i)&&!Rf(i).x_()&&i.Ta.length>0}function MA(i){Rf(i).start()}async function Gk(i){Rf(i).ra()}async function Zk(i){const e=Rf(i);for(const n of i.Ta)e.ea(n.mutations)}async function Hk(i,e,n){const o=i.Ta.shift(),d=E1.from(o,e,n);await AA(i,(()=>i.remoteSyncer.applySuccessfulWrite(d))),await B0(i)}async function Xk(i,e){e&&Rf(i).X_&&await(async function(o,d){if((function(_){return IL(_)&&_!==kt.ABORTED})(d.code)){const g=o.Ta.shift();Rf(o).B_(),await AA(o,(()=>o.remoteSyncer.rejectFailedWrite(g.batchId,d))),await B0(o)}})(i,e),CA(i)&&MA(i)}async function Y2(i,e){const n=ai(i);n.asyncQueue.verifyOperationInProgress(),gn(Dp,"RemoteStore received new credentials");const o=qp(n);n.Ea.add(3),await dy(n),o&&n.Ra.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.Ea.delete(3),await N0(n)}async function Wk(i,e){const n=ai(i);e?(n.Ea.delete(2),await N0(n)):e||(n.Ea.add(2),await dy(n),n.Ra.set("Unknown"))}function sg(i){return i.ma||(i.ma=(function(n,o,d){const g=ai(n);return g.sa(),new kk(o,g.connection,g.authCredentials,g.appCheckCredentials,g.serializer,d)})(i.datastore,i.asyncQueue,{Xo:Fk.bind(null,i),t_:Vk.bind(null,i),r_:jk.bind(null,i),H_:Uk.bind(null,i)}),i.da.push((async e=>{e?(i.ma.B_(),z1(i)?D1(i):i.Ra.set("Unknown")):(await i.ma.stop(),EA(i))}))),i.ma}function Rf(i){return i.fa||(i.fa=(function(n,o,d){const g=ai(n);return g.sa(),new Dk(o,g.connection,g.authCredentials,g.appCheckCredentials,g.serializer,d)})(i.datastore,i.asyncQueue,{Xo:()=>Promise.resolve(),t_:Gk.bind(null,i),r_:Xk.bind(null,i),ta:Zk.bind(null,i),na:Hk.bind(null,i)}),i.da.push((async e=>{e?(i.fa.B_(),await B0(i)):(await i.fa.stop(),i.Ta.length>0&&(gn(Dp,`Stopping write stream with ${i.Ta.length} pending writes`),i.Ta=[]))}))),i.fa}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class O1{constructor(e,n,o,d,g){this.asyncQueue=e,this.timerId=n,this.targetTimeMs=o,this.op=d,this.removalCallback=g,this.deferred=new Sf,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((_=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,n,o,d,g){const _=Date.now()+o,c=new O1(e,n,_,d,g);return c.start(o),c}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new _n(kt.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function N1(i,e){if(Nd("AsyncQueue",`${e}: ${i}`),ag(i))return new _n(kt.UNAVAILABLE,`${e}: ${i}`);throw i}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vm{static emptySet(e){return new Vm(e.comparator)}constructor(e){this.comparator=e?(n,o)=>e(n,o)||On.comparator(n.key,o.key):(n,o)=>On.comparator(n.key,o.key),this.keyedMap=__(),this.sortedSet=new Fa(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const n=this.keyedMap.get(e);return n?this.sortedSet.indexOf(n):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((n,o)=>(e(n),!1)))}add(e){const n=this.delete(e.key);return n.copy(n.keyedMap.insert(e.key,e),n.sortedSet.insert(e,null))}delete(e){const n=this.get(e);return n?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(n)):this}isEqual(e){if(!(e instanceof Vm)||this.size!==e.size)return!1;const n=this.sortedSet.getIterator(),o=e.sortedSet.getIterator();for(;n.hasNext();){const d=n.getNext().key,g=o.getNext().key;if(!d.isEqual(g))return!1}return!0}toString(){const e=[];return this.forEach((n=>{e.push(n.toString())})),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,n){const o=new Vm;return o.comparator=this.comparator,o.keyedMap=e,o.sortedSet=n,o}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Q2{constructor(){this.ga=new Fa(On.comparator)}track(e){const n=e.doc.key,o=this.ga.get(n);o?e.type!==0&&o.type===3?this.ga=this.ga.insert(n,e):e.type===3&&o.type!==1?this.ga=this.ga.insert(n,{type:o.type,doc:e.doc}):e.type===2&&o.type===2?this.ga=this.ga.insert(n,{type:2,doc:e.doc}):e.type===2&&o.type===0?this.ga=this.ga.insert(n,{type:0,doc:e.doc}):e.type===1&&o.type===0?this.ga=this.ga.remove(n):e.type===1&&o.type===2?this.ga=this.ga.insert(n,{type:1,doc:o.doc}):e.type===0&&o.type===1?this.ga=this.ga.insert(n,{type:2,doc:e.doc}):Hn(63341,{Rt:e,pa:o}):this.ga=this.ga.insert(n,e)}ya(){const e=[];return this.ga.inorderTraversal(((n,o)=>{e.push(o)})),e}}class Qm{constructor(e,n,o,d,g,_,c,M,k){this.query=e,this.docs=n,this.oldDocs=o,this.docChanges=d,this.mutatedKeys=g,this.fromCache=_,this.syncStateChanged=c,this.excludesMetadataChanges=M,this.hasCachedResults=k}static fromInitialDocuments(e,n,o,d,g){const _=[];return n.forEach((c=>{_.push({type:0,doc:c})})),new Qm(e,n,Vm.emptySet(n),_,o,d,!0,!1,g)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&R0(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const n=this.docChanges,o=e.docChanges;if(n.length!==o.length)return!1;for(let d=0;d<n.length;d++)if(n[d].type!==o[d].type||!n[d].doc.isEqual(o[d].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kk{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((e=>e.Da()))}}class Yk{constructor(){this.queries=J2(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(n,o){const d=ai(n),g=d.queries;d.queries=J2(),g.forEach(((_,c)=>{for(const M of c.Sa)M.onError(o)}))})(this,new _n(kt.ABORTED,"Firestore shutting down"))}}function J2(){return new Up((i=>XE(i)),R0)}async function Qk(i,e){const n=ai(i);let o=3;const d=e.query;let g=n.queries.get(d);g?!g.ba()&&e.Da()&&(o=2):(g=new Kk,o=e.Da()?0:1);try{switch(o){case 0:g.wa=await n.onListen(d,!0);break;case 1:g.wa=await n.onListen(d,!1);break;case 2:await n.onFirstRemoteStoreListen(d)}}catch(_){const c=N1(_,`Initialization of query '${Dm(e.query)}' failed`);return void e.onError(c)}n.queries.set(d,g),g.Sa.push(e),e.va(n.onlineState),g.wa&&e.Fa(g.wa)&&B1(n)}async function Jk(i,e){const n=ai(i),o=e.query;let d=3;const g=n.queries.get(o);if(g){const _=g.Sa.indexOf(e);_>=0&&(g.Sa.splice(_,1),g.Sa.length===0?d=e.Da()?0:1:!g.ba()&&e.Da()&&(d=2))}switch(d){case 0:return n.queries.delete(o),n.onUnlisten(o,!0);case 1:return n.queries.delete(o),n.onUnlisten(o,!1);case 2:return n.onLastRemoteStoreUnlisten(o);default:return}}function eD(i,e){const n=ai(i);let o=!1;for(const d of e){const g=d.query,_=n.queries.get(g);if(_){for(const c of _.Sa)c.Fa(d)&&(o=!0);_.wa=d}}o&&B1(n)}function tD(i,e,n){const o=ai(i),d=o.queries.get(e);if(d)for(const g of d.Sa)g.onError(n);o.queries.delete(e)}function B1(i){i.Ca.forEach((e=>{e.next()}))}var Cx,eT;(eT=Cx||(Cx={})).Ma="default",eT.Cache="cache";class nD{constructor(e,n,o){this.query=e,this.xa=n,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=o||{}}Fa(e){if(!this.options.includeMetadataChanges){const o=[];for(const d of e.docChanges)d.type!==3&&o.push(d);e=new Qm(e.query,e.docs,e.oldDocs,o,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let n=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),n=!0):this.La(e,this.onlineState)&&(this.ka(e),n=!0),this.Na=e,n}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let n=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),n=!0),n}La(e,n){if(!e.fromCache||!this.Da())return!0;const o=n!=="Offline";return(!this.options.qa||!o)&&(!e.docs.isEmpty()||e.hasCachedResults||n==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const n=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!n)&&this.options.includeMetadataChanges===!0}ka(e){e=Qm.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==Cx.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IA{constructor(e){this.key=e}}class PA{constructor(e){this.key=e}}class iD{constructor(e,n){this.query=e,this.Ya=n,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=Oi(),this.mutatedKeys=Oi(),this.eu=WE(e),this.tu=new Vm(this.eu)}get nu(){return this.Ya}ru(e,n){const o=n?n.iu:new Q2,d=n?n.tu:this.tu;let g=n?n.mutatedKeys:this.mutatedKeys,_=d,c=!1;const M=this.query.limitType==="F"&&d.size===this.query.limit?d.last():null,k=this.query.limitType==="L"&&d.size===this.query.limit?d.first():null;if(e.inorderTraversal(((j,G)=>{const ee=d.get(j),Y=L0(this.query,G)?G:null,xe=!!ee&&this.mutatedKeys.has(ee.key),be=!!Y&&(Y.hasLocalMutations||this.mutatedKeys.has(Y.key)&&Y.hasCommittedMutations);let Ne=!1;ee&&Y?ee.data.isEqual(Y.data)?xe!==be&&(o.track({type:3,doc:Y}),Ne=!0):this.su(ee,Y)||(o.track({type:2,doc:Y}),Ne=!0,(M&&this.eu(Y,M)>0||k&&this.eu(Y,k)<0)&&(c=!0)):!ee&&Y?(o.track({type:0,doc:Y}),Ne=!0):ee&&!Y&&(o.track({type:1,doc:ee}),Ne=!0,(M||k)&&(c=!0)),Ne&&(Y?(_=_.add(Y),g=be?g.add(j):g.delete(j)):(_=_.delete(j),g=g.delete(j)))})),this.query.limit!==null)for(;_.size>this.query.limit;){const j=this.query.limitType==="F"?_.last():_.first();_=_.delete(j.key),g=g.delete(j.key),o.track({type:1,doc:j})}return{tu:_,iu:o,Cs:c,mutatedKeys:g}}su(e,n){return e.hasLocalMutations&&n.hasCommittedMutations&&!n.hasLocalMutations}applyChanges(e,n,o,d){const g=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const _=e.iu.ya();_.sort(((j,G)=>(function(Y,xe){const be=Ne=>{switch(Ne){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Hn(20277,{Rt:Ne})}};return be(Y)-be(xe)})(j.type,G.type)||this.eu(j.doc,G.doc))),this.ou(o),d=d??!1;const c=n&&!d?this._u():[],M=this.Xa.size===0&&this.current&&!d?1:0,k=M!==this.Za;return this.Za=M,_.length!==0||k?{snapshot:new Qm(this.query,e.tu,g,_,e.mutatedKeys,M===0,k,!1,!!o&&o.resumeToken.approximateByteSize()>0),au:c}:{au:c}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new Q2,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach((n=>this.Ya=this.Ya.add(n))),e.modifiedDocuments.forEach((n=>{})),e.removedDocuments.forEach((n=>this.Ya=this.Ya.delete(n))),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=Oi(),this.tu.forEach((o=>{this.uu(o.key)&&(this.Xa=this.Xa.add(o.key))}));const n=[];return e.forEach((o=>{this.Xa.has(o)||n.push(new PA(o))})),this.Xa.forEach((o=>{e.has(o)||n.push(new IA(o))})),n}cu(e){this.Ya=e.Qs,this.Xa=Oi();const n=this.ru(e.documents);return this.applyChanges(n,!0)}lu(){return Qm.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const F1="SyncEngine";class rD{constructor(e,n,o){this.query=e,this.targetId=n,this.view=o}}class aD{constructor(e){this.key=e,this.hu=!1}}class sD{constructor(e,n,o,d,g,_){this.localStore=e,this.remoteStore=n,this.eventManager=o,this.sharedClientState=d,this.currentUser=g,this.maxConcurrentLimboResolutions=_,this.Pu={},this.Tu=new Up((c=>XE(c)),R0),this.Iu=new Map,this.Eu=new Set,this.du=new Fa(On.comparator),this.Au=new Map,this.Ru=new M1,this.Vu={},this.mu=new Map,this.fu=Ym.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function oD(i,e,n=!0){const o=OA(i);let d;const g=o.Tu.get(e);return g?(o.sharedClientState.addLocalQueryTarget(g.targetId),d=g.view.lu()):d=await RA(o,e,n,!0),d}async function lD(i,e){const n=OA(i);await RA(n,e,!0,!1)}async function RA(i,e,n,o){const d=await Ek(i.localStore,Fh(e)),g=d.targetId,_=i.sharedClientState.addLocalQueryTarget(g,n);let c;return o&&(c=await uD(i,e,g,_==="current",d.resumeToken)),i.isPrimaryClient&&n&&TA(i.remoteStore,d),c}async function uD(i,e,n,o,d){i.pu=(G,ee,Y)=>(async function(be,Ne,tt,Je){let qe=Ne.view.ru(tt);qe.Cs&&(qe=await Z2(be.localStore,Ne.query,!1).then((({documents:de})=>Ne.view.ru(de,qe))));const He=Je&&Je.targetChanges.get(Ne.targetId),Ue=Je&&Je.targetMismatches.get(Ne.targetId)!=null,Be=Ne.view.applyChanges(qe,be.isPrimaryClient,He,Ue);return nT(be,Ne.targetId,Be.au),Be.snapshot})(i,G,ee,Y);const g=await Z2(i.localStore,e,!0),_=new iD(e,g.Qs),c=_.ru(g.documents),M=hy.createSynthesizedTargetChangeForCurrentChange(n,o&&i.onlineState!=="Offline",d),k=_.applyChanges(c,i.isPrimaryClient,M);nT(i,n,k.au);const j=new rD(e,n,_);return i.Tu.set(e,j),i.Iu.has(n)?i.Iu.get(n).push(e):i.Iu.set(n,[e]),k.snapshot}async function cD(i,e,n){const o=ai(i),d=o.Tu.get(e),g=o.Iu.get(d.targetId);if(g.length>1)return o.Iu.set(d.targetId,g.filter((_=>!R0(_,e)))),void o.Tu.delete(e);o.isPrimaryClient?(o.sharedClientState.removeLocalQueryTarget(d.targetId),o.sharedClientState.isActiveQueryTarget(d.targetId)||await Ex(o.localStore,d.targetId,!1).then((()=>{o.sharedClientState.clearQueryState(d.targetId),n&&L1(o.remoteStore,d.targetId),Mx(o,d.targetId)})).catch(rg)):(Mx(o,d.targetId),await Ex(o.localStore,d.targetId,!0))}async function hD(i,e){const n=ai(i),o=n.Tu.get(e),d=n.Iu.get(o.targetId);n.isPrimaryClient&&d.length===1&&(n.sharedClientState.removeLocalQueryTarget(o.targetId),L1(n.remoteStore,o.targetId))}async function dD(i,e,n){const o=vD(i);try{const d=await(function(_,c){const M=ai(_),k=ha.now(),j=c.reduce(((Y,xe)=>Y.add(xe.key)),Oi());let G,ee;return M.persistence.runTransaction("Locally write mutations","readwrite",(Y=>{let xe=Bd(),be=Oi();return M.Ns.getEntries(Y,j).next((Ne=>{xe=Ne,xe.forEach(((tt,Je)=>{Je.isValidDocument()||(be=be.add(tt))}))})).next((()=>M.localDocuments.getOverlayedDocuments(Y,xe))).next((Ne=>{G=Ne;const tt=[];for(const Je of c){const qe=SL(Je,G.get(Je.key).overlayedDocument);qe!=null&&tt.push(new $p(Je.key,qe,FE(qe.value.mapValue),Ld.exists(!0)))}return M.mutationQueue.addMutationBatch(Y,k,tt,c)})).next((Ne=>{ee=Ne;const tt=Ne.applyToLocalDocumentSet(G,be);return M.documentOverlayCache.saveOverlays(Y,Ne.batchId,tt)}))})).then((()=>({batchId:ee.batchId,changes:YE(G)})))})(o.localStore,e);o.sharedClientState.addPendingMutation(d.batchId),(function(_,c,M){let k=_.Vu[_.currentUser.toKey()];k||(k=new Fa(zi)),k=k.insert(c,M),_.Vu[_.currentUser.toKey()]=k})(o,d.batchId,n),await fy(o,d.changes),await B0(o.remoteStore)}catch(d){const g=N1(d,"Failed to persist write");n.reject(g)}}async function LA(i,e){const n=ai(i);try{const o=await wk(n.localStore,e);e.targetChanges.forEach(((d,g)=>{const _=n.Au.get(g);_&&(Ar(d.addedDocuments.size+d.modifiedDocuments.size+d.removedDocuments.size<=1,22616),d.addedDocuments.size>0?_.hu=!0:d.modifiedDocuments.size>0?Ar(_.hu,14607):d.removedDocuments.size>0&&(Ar(_.hu,42227),_.hu=!1))})),await fy(n,o,e)}catch(o){await rg(o)}}function tT(i,e,n){const o=ai(i);if(o.isPrimaryClient&&n===0||!o.isPrimaryClient&&n===1){const d=[];o.Tu.forEach(((g,_)=>{const c=_.view.va(e);c.snapshot&&d.push(c.snapshot)})),(function(_,c){const M=ai(_);M.onlineState=c;let k=!1;M.queries.forEach(((j,G)=>{for(const ee of G.Sa)ee.va(c)&&(k=!0)})),k&&B1(M)})(o.eventManager,e),d.length&&o.Pu.H_(d),o.onlineState=e,o.isPrimaryClient&&o.sharedClientState.setOnlineState(e)}}async function fD(i,e,n){const o=ai(i);o.sharedClientState.updateQueryState(e,"rejected",n);const d=o.Au.get(e),g=d&&d.key;if(g){let _=new Fa(On.comparator);_=_.insert(g,Pl.newNoDocument(g,ti.min()));const c=Oi().add(g),M=new z0(ti.min(),new Map,new Fa(zi),_,c);await LA(o,M),o.du=o.du.remove(g),o.Au.delete(e),V1(o)}else await Ex(o.localStore,e,!1).then((()=>Mx(o,e,n))).catch(rg)}async function pD(i,e){const n=ai(i),o=e.batch.batchId;try{const d=await xk(n.localStore,e);DA(n,o,null),kA(n,o),n.sharedClientState.updateMutationState(o,"acknowledged"),await fy(n,d)}catch(d){await rg(d)}}async function mD(i,e,n){const o=ai(i);try{const d=await(function(_,c){const M=ai(_);return M.persistence.runTransaction("Reject batch","readwrite-primary",(k=>{let j;return M.mutationQueue.lookupMutationBatch(k,c).next((G=>(Ar(G!==null,37113),j=G.keys(),M.mutationQueue.removeMutationBatch(k,G)))).next((()=>M.mutationQueue.performConsistencyCheck(k))).next((()=>M.documentOverlayCache.removeOverlaysForBatchId(k,j,c))).next((()=>M.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(k,j))).next((()=>M.localDocuments.getDocuments(k,j)))}))})(o.localStore,e);DA(o,e,n),kA(o,e),o.sharedClientState.updateMutationState(e,"rejected",n),await fy(o,d)}catch(d){await rg(d)}}function kA(i,e){(i.mu.get(e)||[]).forEach((n=>{n.resolve()})),i.mu.delete(e)}function DA(i,e,n){const o=ai(i);let d=o.Vu[o.currentUser.toKey()];if(d){const g=d.get(e);g&&(n?g.reject(n):g.resolve(),d=d.remove(e)),o.Vu[o.currentUser.toKey()]=d}}function Mx(i,e,n=null){i.sharedClientState.removeLocalQueryTarget(e);for(const o of i.Iu.get(e))i.Tu.delete(o),n&&i.Pu.yu(o,n);i.Iu.delete(e),i.isPrimaryClient&&i.Ru.jr(e).forEach((o=>{i.Ru.containsKey(o)||zA(i,o)}))}function zA(i,e){i.Eu.delete(e.path.canonicalString());const n=i.du.get(e);n!==null&&(L1(i.remoteStore,n),i.du=i.du.remove(e),i.Au.delete(n),V1(i))}function nT(i,e,n){for(const o of n)o instanceof IA?(i.Ru.addReference(o.key,e),gD(i,o)):o instanceof PA?(gn(F1,"Document no longer in limbo: "+o.key),i.Ru.removeReference(o.key,e),i.Ru.containsKey(o.key)||zA(i,o.key)):Hn(19791,{wu:o})}function gD(i,e){const n=e.key,o=n.path.canonicalString();i.du.get(n)||i.Eu.has(o)||(gn(F1,"New document in limbo: "+n),i.Eu.add(o),V1(i))}function V1(i){for(;i.Eu.size>0&&i.du.size<i.maxConcurrentLimboResolutions;){const e=i.Eu.values().next().value;i.Eu.delete(e);const n=new On(ea.fromString(e)),o=i.fu.next();i.Au.set(o,new aD(n)),i.du=i.du.insert(n,o),TA(i.remoteStore,new _f(Fh(ZE(n.path)),o,"TargetPurposeLimboResolution",M0.ce))}}async function fy(i,e,n){const o=ai(i),d=[],g=[],_=[];o.Tu.isEmpty()||(o.Tu.forEach(((c,M)=>{_.push(o.pu(M,e,n).then((k=>{var j;if((k||n)&&o.isPrimaryClient){const G=k?!k.fromCache:(j=n==null?void 0:n.targetChanges.get(M.targetId))==null?void 0:j.current;o.sharedClientState.updateQueryState(M.targetId,G?"current":"not-current")}if(k){d.push(k);const G=P1.As(M.targetId,k);g.push(G)}})))})),await Promise.all(_),o.Pu.H_(d),await(async function(M,k){const j=ai(M);try{await j.persistence.runTransaction("notifyLocalViewChanges","readwrite",(G=>Dt.forEach(k,(ee=>Dt.forEach(ee.Es,(Y=>j.persistence.referenceDelegate.addReference(G,ee.targetId,Y))).next((()=>Dt.forEach(ee.ds,(Y=>j.persistence.referenceDelegate.removeReference(G,ee.targetId,Y)))))))))}catch(G){if(!ag(G))throw G;gn(R1,"Failed to update sequence numbers: "+G)}for(const G of k){const ee=G.targetId;if(!G.fromCache){const Y=j.Ms.get(ee),xe=Y.snapshotVersion,be=Y.withLastLimboFreeSnapshotVersion(xe);j.Ms=j.Ms.insert(ee,be)}}})(o.localStore,g))}async function _D(i,e){const n=ai(i);if(!n.currentUser.isEqual(e)){gn(F1,"User change. New user:",e.toKey());const o=await vA(n.localStore,e);n.currentUser=e,(function(g,_){g.mu.forEach((c=>{c.forEach((M=>{M.reject(new _n(kt.CANCELLED,_))}))})),g.mu.clear()})(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(e,o.removedBatchIds,o.addedBatchIds),await fy(n,o.Ls)}}function yD(i,e){const n=ai(i),o=n.Au.get(e);if(o&&o.hu)return Oi().add(o.key);{let d=Oi();const g=n.Iu.get(e);if(!g)return d;for(const _ of g){const c=n.Tu.get(_);d=d.unionWith(c.view.nu)}return d}}function OA(i){const e=ai(i);return e.remoteStore.remoteSyncer.applyRemoteEvent=LA.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=yD.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=fD.bind(null,e),e.Pu.H_=eD.bind(null,e.eventManager),e.Pu.yu=tD.bind(null,e.eventManager),e}function vD(i){const e=ai(i);return e.remoteStore.remoteSyncer.applySuccessfulWrite=pD.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=mD.bind(null,e),e}class u0{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=O0(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,n){return null}Mu(e,n){return null}vu(e){return bk(this.persistence,new _k,e.initialUser,this.serializer)}Cu(e){return new yA(I1.mi,this.serializer)}Du(e){return new Ck}async terminate(){var e,n;(e=this.gcScheduler)==null||e.stop(),(n=this.indexBackfillerScheduler)==null||n.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}u0.provider={build:()=>new u0};class bD extends u0{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,n){Ar(this.persistence.referenceDelegate instanceof o0,46915);const o=this.persistence.referenceDelegate.garbageCollector;return new nk(o,e.asyncQueue,n)}Cu(e){const n=this.cacheSizeBytes!==void 0?ou.withCacheSize(this.cacheSizeBytes):ou.DEFAULT;return new yA((o=>o0.mi(o,n)),this.serializer)}}class Ix{async initialize(e,n){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=o=>tT(this.syncEngine,o,1),this.remoteStore.remoteSyncer.handleCredentialChange=_D.bind(null,this.syncEngine),await Wk(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new Yk})()}createDatastore(e){const n=O0(e.databaseInfo.databaseId),o=(function(g){return new Lk(g)})(e.databaseInfo);return(function(g,_,c,M){return new Ok(g,_,c,M)})(e.authCredentials,e.appCheckCredentials,o,n)}createRemoteStore(e){return(function(o,d,g,_,c){return new Bk(o,d,g,_,c)})(this.localStore,this.datastore,e.asyncQueue,(n=>tT(this.syncEngine,n,0)),(function(){return W2.v()?new W2:new Mk})())}createSyncEngine(e,n){return(function(d,g,_,c,M,k,j){const G=new sD(d,g,_,c,M,k);return j&&(G.gu=!0),G})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,n)}async terminate(){var e,n;await(async function(d){const g=ai(d);gn(Dp,"RemoteStore shutting down."),g.Ea.add(5),await dy(g),g.Aa.shutdown(),g.Ra.set("Unknown")})(this.remoteStore),(e=this.datastore)==null||e.terminate(),(n=this.eventManager)==null||n.terminate()}}Ix.provider={build:()=>new Ix};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xD{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):Nd("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,n){setTimeout((()=>{this.muted||e(n)}),0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lf="FirestoreClient";class wD{constructor(e,n,o,d,g){this.authCredentials=e,this.appCheckCredentials=n,this.asyncQueue=o,this.databaseInfo=d,this.user=Il.UNAUTHENTICATED,this.clientId=y1.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=g,this.authCredentials.start(o,(async _=>{gn(Lf,"Received user=",_.uid),await this.authCredentialListener(_),this.user=_})),this.appCheckCredentials.start(o,(_=>(gn(Lf,"Received new app check token=",_),this.appCheckCredentialListener(_,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Sf;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){const o=N1(n,"Failed to shutdown persistence");e.reject(o)}})),e.promise}}async function Ob(i,e){i.asyncQueue.verifyOperationInProgress(),gn(Lf,"Initializing OfflineComponentProvider");const n=i.configuration;await e.initialize(n);let o=n.initialUser;i.setCredentialChangeListener((async d=>{o.isEqual(d)||(await vA(e.localStore,d),o=d)})),e.persistence.setDatabaseDeletedListener((()=>i.terminate())),i._offlineComponents=e}async function iT(i,e){i.asyncQueue.verifyOperationInProgress();const n=await TD(i);gn(Lf,"Initializing OnlineComponentProvider"),await e.initialize(n,i.configuration),i.setCredentialChangeListener((o=>Y2(e.remoteStore,o))),i.setAppCheckTokenChangeListener(((o,d)=>Y2(e.remoteStore,d))),i._onlineComponents=e}async function TD(i){if(!i._offlineComponents)if(i._uninitializedComponentsProvider){gn(Lf,"Using user provided OfflineComponentProvider");try{await Ob(i,i._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!(function(d){return d.name==="FirebaseError"?d.code===kt.FAILED_PRECONDITION||d.code===kt.UNIMPLEMENTED:!(typeof DOMException<"u"&&d instanceof DOMException)||d.code===22||d.code===20||d.code===11})(n))throw n;Hm("Error using user provided cache. Falling back to memory cache: "+n),await Ob(i,new u0)}}else gn(Lf,"Using default OfflineComponentProvider"),await Ob(i,new bD(void 0));return i._offlineComponents}async function NA(i){return i._onlineComponents||(i._uninitializedComponentsProvider?(gn(Lf,"Using user provided OnlineComponentProvider"),await iT(i,i._uninitializedComponentsProvider._online)):(gn(Lf,"Using default OnlineComponentProvider"),await iT(i,new Ix))),i._onlineComponents}function SD(i){return NA(i).then((e=>e.syncEngine))}async function ED(i){const e=await NA(i),n=e.eventManager;return n.onListen=oD.bind(null,e.syncEngine),n.onUnlisten=cD.bind(null,e.syncEngine),n.onFirstRemoteStoreListen=lD.bind(null,e.syncEngine),n.onLastRemoteStoreUnlisten=hD.bind(null,e.syncEngine),n}function AD(i,e,n={}){const o=new Sf;return i.asyncQueue.enqueueAndForget((async()=>(function(g,_,c,M,k){const j=new xD({next:ee=>{j.Nu(),_.enqueueAndForget((()=>Jk(g,G))),ee.fromCache&&M.source==="server"?k.reject(new _n(kt.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):k.resolve(ee)},error:ee=>k.reject(ee)}),G=new nD(c,j,{includeMetadataChanges:!0,qa:!0});return Qk(g,G)})(await ED(i),i.asyncQueue,e,n,o))),o.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function BA(i){const e={};return i.timeoutSeconds!==void 0&&(e.timeoutSeconds=i.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rT=new Map;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FA="firestore.googleapis.com",aT=!0;class sT{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new _n(kt.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=FA,this.ssl=aT}else this.host=e.host,this.ssl=e.ssl??aT;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=_A;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<ek)throw new _n(kt.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}N5("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=BA(e.experimentalLongPollingOptions??{}),(function(o){if(o.timeoutSeconds!==void 0){if(isNaN(o.timeoutSeconds))throw new _n(kt.INVALID_ARGUMENT,`invalid long polling timeout: ${o.timeoutSeconds} (must not be NaN)`);if(o.timeoutSeconds<5)throw new _n(kt.INVALID_ARGUMENT,`invalid long polling timeout: ${o.timeoutSeconds} (minimum allowed value is 5)`);if(o.timeoutSeconds>30)throw new _n(kt.INVALID_ARGUMENT,`invalid long polling timeout: ${o.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(o,d){return o.timeoutSeconds===d.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class F0{constructor(e,n,o,d){this._authCredentials=e,this._appCheckCredentials=n,this._databaseId=o,this._app=d,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new sT({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new _n(kt.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new _n(kt.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new sT(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(o){if(!o)return new C5;switch(o.type){case"firstParty":return new R5(o.sessionIndex||"0",o.iamToken||null,o.authTokenFactory||null);case"provider":return o.client;default:throw new _n(kt.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(n){const o=rT.get(n);o&&(gn("ComponentProvider","Removing Datastore"),rT.delete(n),o.terminate())})(this),Promise.resolve()}}function CD(i,e,n,o={}){var k;i=Jv(i,F0);const d=p1(e),g=i._getSettings(),_={...g,emulatorOptions:i._getEmulatorOptions()},c=`${e}:${n}`;d&&(tR(`https://${c}`),aR("Firestore",!0)),g.host!==FA&&g.host!==c&&Hm("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const M={...g,host:c,ssl:d,emulatorOptions:o};if(!N_(M,_)&&(i._setSettings(M),o.mockUserToken)){let j,G;if(typeof o.mockUserToken=="string")j=o.mockUserToken,G=Il.MOCK_USER;else{j=nR(o.mockUserToken,(k=i._app)==null?void 0:k.options.projectId);const ee=o.mockUserToken.sub||o.mockUserToken.user_id;if(!ee)throw new _n(kt.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");G=new Il(ee)}i._authCredentials=new M5(new CE(j,G))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class og{constructor(e,n,o){this.converter=n,this._query=o,this.type="query",this.firestore=e}withConverter(e){return new og(this.firestore,e,this._query)}}class xo{constructor(e,n,o){this.converter=n,this._key=o,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Ef(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new xo(this.firestore,e,this._key)}toJSON(){return{type:xo._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,n,o){if(ly(n,xo._jsonSchema))return new xo(e,o||null,new On(ea.fromString(n.referencePath)))}}xo._jsonSchemaVersion="firestore/documentReference/1.0",xo._jsonSchema={type:zs("string",xo._jsonSchemaVersion),referencePath:zs("string")};class Ef extends og{constructor(e,n,o){super(e,n,ZE(o)),this._path=o,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new xo(this.firestore,null,new On(e))}withConverter(e){return new Ef(this.firestore,e,this._path)}}function VA(i,e,...n){if(i=Hh(i),ME("collection","path",e),i instanceof F0){const o=ea.fromString(e,...n);return v2(o),new Ef(i,null,o)}{if(!(i instanceof xo||i instanceof Ef))throw new _n(kt.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const o=i._path.child(ea.fromString(e,...n));return v2(o),new Ef(i.firestore,null,o)}}function MD(i,e,...n){if(i=Hh(i),arguments.length===1&&(e=y1.newId()),ME("doc","path",e),i instanceof F0){const o=ea.fromString(e,...n);return y2(o),new xo(i,null,new On(o))}{if(!(i instanceof xo||i instanceof Ef))throw new _n(kt.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const o=i._path.child(ea.fromString(e,...n));return y2(o),new xo(i.firestore,i instanceof Ef?i.converter:null,new On(o))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oT="AsyncQueue";class lT{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new xA(this,"async_queue_retry"),this._c=()=>{const o=zb();o&&gn(oT,"Visibility state changed to "+o.visibilityState),this.M_.w_()},this.ac=e;const n=zb();n&&typeof n.addEventListener=="function"&&n.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const n=zb();n&&typeof n.removeEventListener=="function"&&n.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise((()=>{}));const n=new Sf;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(e().then(n.resolve,n.reject),n.promise))).then((()=>n.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Xu.push(e),this.lc())))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!ag(e))throw e;gn(oT,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(e){const n=this.ac.then((()=>(this.rc=!0,e().catch((o=>{throw this.nc=o,this.rc=!1,Nd("INTERNAL UNHANDLED ERROR: ",uT(o)),o})).then((o=>(this.rc=!1,o))))));return this.ac=n,n}enqueueAfterDelay(e,n,o){this.uc(),this.oc.indexOf(e)>-1&&(n=0);const d=O1.createAndSchedule(this,e,n,o,(g=>this.hc(g)));return this.tc.push(d),d}uc(){this.nc&&Hn(47125,{Pc:uT(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const n of this.tc)if(n.timerId===e)return!0;return!1}Ec(e){return this.Tc().then((()=>{this.tc.sort(((n,o)=>n.targetTimeMs-o.targetTimeMs));for(const n of this.tc)if(n.skipDelay(),e!=="all"&&n.timerId===e)break;return this.Tc()}))}dc(e){this.oc.push(e)}hc(e){const n=this.tc.indexOf(e);this.tc.splice(n,1)}}function uT(i){let e=i.message||"";return i.stack&&(e=i.stack.includes(i.message)?i.stack:i.message+`
`+i.stack),e}class j1 extends F0{constructor(e,n,o,d){super(e,n,o,d),this.type="firestore",this._queue=new lT,this._persistenceKey=(d==null?void 0:d.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new lT(e),this._firestoreClient=void 0,await e}}}function ID(i,e){const n=typeof i=="object"?i:g1(),o=typeof i=="string"?i:t0,d=Vp(n,"firestore").getImmediate({identifier:o});if(!d._initialized){const g=eR("firestore");g&&CD(d,...g)}return d}function jA(i){if(i._terminated)throw new _n(kt.FAILED_PRECONDITION,"The client has already been terminated.");return i._firestoreClient||PD(i),i._firestoreClient}function PD(i){var o,d,g;const e=i._freezeSettings(),n=(function(c,M,k,j){return new X5(c,M,k,j.host,j.ssl,j.experimentalForceLongPolling,j.experimentalAutoDetectLongPolling,BA(j.experimentalLongPollingOptions),j.useFetchStreams,j.isUsingEmulator)})(i._databaseId,((o=i._app)==null?void 0:o.options.appId)||"",i._persistenceKey,e);i._componentsProvider||(d=e.localCache)!=null&&d._offlineComponentProvider&&((g=e.localCache)!=null&&g._onlineComponentProvider)&&(i._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),i._firestoreClient=new wD(i._authCredentials,i._appCheckCredentials,i._queue,n,i._componentsProvider&&(function(c){const M=c==null?void 0:c._online.build();return{_offline:c==null?void 0:c._offline.build(M),_online:M}})(i._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mc{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Mc(nl.fromBase64String(e))}catch(n){throw new _n(kt.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+n)}}static fromUint8Array(e){return new Mc(nl.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:Mc._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(ly(e,Mc._jsonSchema))return Mc.fromBase64String(e.bytes)}}Mc._jsonSchemaVersion="firestore/bytes/1.0",Mc._jsonSchema={type:zs("string",Mc._jsonSchemaVersion),bytes:zs("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class U1{constructor(...e){for(let n=0;n<e.length;++n)if(e[n].length===0)throw new _n(kt.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new tl(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $1{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jh{constructor(e,n){if(!isFinite(e)||e<-90||e>90)throw new _n(kt.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(n)||n<-180||n>180)throw new _n(kt.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=e,this._long=n}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return zi(this._lat,e._lat)||zi(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:jh._jsonSchemaVersion}}static fromJSON(e){if(ly(e,jh._jsonSchema))return new jh(e.latitude,e.longitude)}}jh._jsonSchemaVersion="firestore/geoPoint/1.0",jh._jsonSchema={type:zs("string",jh._jsonSchemaVersion),latitude:zs("number"),longitude:zs("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uh{constructor(e){this._values=(e||[]).map((n=>n))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(o,d){if(o.length!==d.length)return!1;for(let g=0;g<o.length;++g)if(o[g]!==d[g])return!1;return!0})(this._values,e._values)}toJSON(){return{type:Uh._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(ly(e,Uh._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((n=>typeof n=="number")))return new Uh(e.vectorValues);throw new _n(kt.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Uh._jsonSchemaVersion="firestore/vectorValue/1.0",Uh._jsonSchema={type:zs("string",Uh._jsonSchemaVersion),vectorValues:zs("object")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RD=/^__.*__$/;class LD{constructor(e,n,o){this.data=e,this.fieldMask=n,this.fieldTransforms=o}toMutation(e,n){return this.fieldMask!==null?new $p(e,this.data,this.fieldMask,n,this.fieldTransforms):new cy(e,this.data,n,this.fieldTransforms)}}function UA(i){switch(i){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Hn(40011,{Ac:i})}}class q1{constructor(e,n,o,d,g,_){this.settings=e,this.databaseId=n,this.serializer=o,this.ignoreUndefinedProperties=d,g===void 0&&this.Rc(),this.fieldTransforms=g||[],this.fieldMask=_||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new q1({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){var d;const n=(d=this.path)==null?void 0:d.child(e),o=this.Vc({path:n,fc:!1});return o.gc(e),o}yc(e){var d;const n=(d=this.path)==null?void 0:d.child(e),o=this.Vc({path:n,fc:!1});return o.Rc(),o}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return c0(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find((n=>e.isPrefixOf(n)))!==void 0||this.fieldTransforms.find((n=>e.isPrefixOf(n.field)))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(UA(this.Ac)&&RD.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class kD{constructor(e,n,o){this.databaseId=e,this.ignoreUndefinedProperties=n,this.serializer=o||O0(e)}Cc(e,n,o,d=!1){return new q1({Ac:e,methodName:n,Dc:o,path:tl.emptyPath(),fc:!1,bc:d},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function $A(i){const e=i._freezeSettings(),n=O0(i._databaseId);return new kD(i._databaseId,!!e.ignoreUndefinedProperties,n)}function DD(i,e,n,o,d,g={}){const _=i.Cc(g.merge||g.mergeFields?2:0,e,n,d);ZA("Data must be an object, but it was:",_,o);const c=qA(o,_);let M,k;if(g.merge)M=new nh(_.fieldMask),k=_.fieldTransforms;else if(g.mergeFields){const j=[];for(const G of g.mergeFields){const ee=OD(e,G,n);if(!_.contains(ee))throw new _n(kt.INVALID_ARGUMENT,`Field '${ee}' is specified in your field mask but missing from your input data.`);BD(j,ee)||j.push(ee)}M=new nh(j),k=_.fieldTransforms.filter((G=>M.covers(G.field)))}else M=null,k=_.fieldTransforms;return new LD(new Cc(c),M,k)}class G1 extends $1{_toFieldTransform(e){return new bL(e.path,new $_)}isEqual(e){return e instanceof G1}}function zD(i,e,n,o=!1){return Z1(n,i.Cc(o?4:3,e))}function Z1(i,e){if(GA(i=Hh(i)))return ZA("Unsupported field value:",e,i),qA(i,e);if(i instanceof $1)return(function(o,d){if(!UA(d.Ac))throw d.Sc(`${o._methodName}() can only be used with update() and set()`);if(!d.path)throw d.Sc(`${o._methodName}() is not currently supported inside arrays`);const g=o._toFieldTransform(d);g&&d.fieldTransforms.push(g)})(i,e),null;if(i===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),i instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return(function(o,d){const g=[];let _=0;for(const c of o){let M=Z1(c,d.wc(_));M==null&&(M={nullValue:"NULL_VALUE"}),g.push(M),_++}return{arrayValue:{values:g}}})(i,e)}return(function(o,d){if((o=Hh(o))===null)return{nullValue:"NULL_VALUE"};if(typeof o=="number")return _L(d.serializer,o);if(typeof o=="boolean")return{booleanValue:o};if(typeof o=="string")return{stringValue:o};if(o instanceof Date){const g=ha.fromDate(o);return{timestampValue:s0(d.serializer,g)}}if(o instanceof ha){const g=new ha(o.seconds,1e3*Math.floor(o.nanoseconds/1e3));return{timestampValue:s0(d.serializer,g)}}if(o instanceof jh)return{geoPointValue:{latitude:o.latitude,longitude:o.longitude}};if(o instanceof Mc)return{bytesValue:cA(d.serializer,o._byteString)};if(o instanceof xo){const g=d.databaseId,_=o.firestore._databaseId;if(!_.isEqual(g))throw d.Sc(`Document reference is for database ${_.projectId}/${_.database} but should be for database ${g.projectId}/${g.database}`);return{referenceValue:C1(o.firestore._databaseId||d.databaseId,o._key.path)}}if(o instanceof Uh)return(function(_,c){return{mapValue:{fields:{[NE]:{stringValue:BE},[n0]:{arrayValue:{values:_.toArray().map((k=>{if(typeof k!="number")throw c.Sc("VectorValues must only contain numeric values.");return S1(c.serializer,k)}))}}}}}})(o,d);throw d.Sc(`Unsupported field value: ${C0(o)}`)})(i,e)}function qA(i,e){const n={};return RE(i)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):jp(i,((o,d)=>{const g=Z1(d,e.mc(o));g!=null&&(n[o]=g)})),{mapValue:{fields:n}}}function GA(i){return!(typeof i!="object"||i===null||i instanceof Array||i instanceof Date||i instanceof ha||i instanceof jh||i instanceof Mc||i instanceof xo||i instanceof $1||i instanceof Uh)}function ZA(i,e,n){if(!GA(n)||!IE(n)){const o=C0(n);throw o==="an object"?e.Sc(i+" a custom object"):e.Sc(i+" "+o)}}function OD(i,e,n){if((e=Hh(e))instanceof U1)return e._internalPath;if(typeof e=="string")return HA(i,e);throw c0("Field path arguments must be of type string or ",i,!1,void 0,n)}const ND=new RegExp("[~\\*/\\[\\]]");function HA(i,e,n){if(e.search(ND)>=0)throw c0(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,i,!1,void 0,n);try{return new U1(...e.split("."))._internalPath}catch{throw c0(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,i,!1,void 0,n)}}function c0(i,e,n,o,d){const g=o&&!o.isEmpty(),_=d!==void 0;let c=`Function ${e}() called with invalid data`;n&&(c+=" (via `toFirestore()`)"),c+=". ";let M="";return(g||_)&&(M+=" (found",g&&(M+=` in field ${o}`),_&&(M+=` in document ${d}`),M+=")"),new _n(kt.INVALID_ARGUMENT,c+i+M)}function BD(i,e){return i.some((n=>n.isEqual(e)))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XA{constructor(e,n,o,d,g){this._firestore=e,this._userDataWriter=n,this._key=o,this._document=d,this._converter=g}get id(){return this._key.path.lastSegment()}get ref(){return new xo(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new FD(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const n=this._document.data.field(WA("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n)}}}class FD extends XA{data(){return super.data()}}function WA(i,e){return typeof e=="string"?HA(i,e):e instanceof U1?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function VD(i){if(i.limitType==="L"&&i.explicitOrderBy.length===0)throw new _n(kt.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class H1{}class jD extends H1{}function UD(i,e,...n){let o=[];e instanceof H1&&o.push(e),o=o.concat(n),(function(g){const _=g.filter((M=>M instanceof W1)).length,c=g.filter((M=>M instanceof X1)).length;if(_>1||_>0&&c>0)throw new _n(kt.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(o);for(const d of o)i=d._apply(i);return i}class X1 extends jD{constructor(e,n,o){super(),this._field=e,this._op=n,this._value=o,this.type="where"}static _create(e,n,o){return new X1(e,n,o)}_apply(e){const n=this._parse(e);return KA(e._query,n),new og(e.firestore,e.converter,vx(e._query,n))}_parse(e){const n=$A(e.firestore);return(function(g,_,c,M,k,j,G){let ee;if(k.isKeyField()){if(j==="array-contains"||j==="array-contains-any")throw new _n(kt.INVALID_ARGUMENT,`Invalid Query. You can't perform '${j}' queries on documentId().`);if(j==="in"||j==="not-in"){hT(G,j);const xe=[];for(const be of G)xe.push(cT(M,g,be));ee={arrayValue:{values:xe}}}else ee=cT(M,g,G)}else j!=="in"&&j!=="not-in"&&j!=="array-contains-any"||hT(G,j),ee=zD(c,_,G,j==="in"||j==="not-in");return Ds.create(k,j,ee)})(e._query,"where",n,e.firestore._databaseId,this._field,this._op,this._value)}}class W1 extends H1{constructor(e,n){super(),this.type=e,this._queryConstraints=n}static _create(e,n){return new W1(e,n)}_parse(e){const n=this._queryConstraints.map((o=>o._parse(e))).filter((o=>o.getFilters().length>0));return n.length===1?n[0]:uh.create(n,this._getOperator())}_apply(e){const n=this._parse(e);return n.getFilters().length===0?e:((function(d,g){let _=d;const c=g.getFlattenedFilters();for(const M of c)KA(_,M),_=vx(_,M)})(e._query,n),new og(e.firestore,e.converter,vx(e._query,n)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function cT(i,e,n){if(typeof(n=Hh(n))=="string"){if(n==="")throw new _n(kt.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!HE(e)&&n.indexOf("/")!==-1)throw new _n(kt.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const o=e.path.child(ea.fromString(n));if(!On.isDocumentKey(o))throw new _n(kt.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${o}' is not because it has an odd number of segments (${o.length}).`);return C2(i,new On(o))}if(n instanceof xo)return C2(i,n._key);throw new _n(kt.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${C0(n)}.`)}function hT(i,e){if(!Array.isArray(i)||i.length===0)throw new _n(kt.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function KA(i,e){const n=(function(d,g){for(const _ of d)for(const c of _.getFlattenedFilters())if(g.indexOf(c.op)>=0)return c.op;return null})(i.filters,(function(d){switch(d){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(e.op));if(n!==null)throw n===e.op?new _n(kt.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new _n(kt.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}class $D{convertValue(e,n="none"){switch(Pf(e)){case 0:return null;case 1:return e.booleanValue;case 2:return hs(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,n);case 5:return e.stringValue;case 6:return this.convertBytes(If(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,n);case 11:return this.convertObject(e.mapValue,n);case 10:return this.convertVectorValue(e.mapValue);default:throw Hn(62114,{value:e})}}convertObject(e,n){return this.convertObjectMap(e.fields,n)}convertObjectMap(e,n="none"){const o={};return jp(e,((d,g)=>{o[d]=this.convertValue(g,n)})),o}convertVectorValue(e){var o,d,g;const n=(g=(d=(o=e.fields)==null?void 0:o[n0].arrayValue)==null?void 0:d.values)==null?void 0:g.map((_=>hs(_.doubleValue)));return new Uh(n)}convertGeoPoint(e){return new jh(hs(e.latitude),hs(e.longitude))}convertArray(e,n){return(e.values||[]).map((o=>this.convertValue(o,n)))}convertServerTimestamp(e,n){switch(n){case"previous":const o=P0(e);return o==null?null:this.convertValue(o,n);case"estimate":return this.convertTimestamp(V_(e));default:return null}}convertTimestamp(e){const n=Mf(e);return new ha(n.seconds,n.nanos)}convertDocumentKey(e,n){const o=ea.fromString(e);Ar(gA(o),9688,{name:e});const d=new j_(o.get(1),o.get(3)),g=new On(o.popFirst(5));return d.isEqual(n)||Nd(`Document ${g} contains a document reference within a different database (${d.projectId}/${d.database}) which is not supported. It will be treated as a reference in the current database (${n.projectId}/${n.database}) instead.`),g}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qD(i,e,n){let o;return o=i?i.toFirestore(e):e,o}class mv{constructor(e,n){this.hasPendingWrites=e,this.fromCache=n}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class jm extends XA{constructor(e,n,o,d,g,_){super(e,n,o,d,_),this._firestore=e,this._firestoreImpl=e,this.metadata=g}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const n=new Lv(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(n,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,n={}){if(this._document){const o=this._document.data.field(WA("DocumentSnapshot.get",e));if(o!==null)return this._userDataWriter.convertValue(o,n.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new _n(kt.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,n={};return n.type=jm._jsonSchemaVersion,n.bundle="",n.bundleSource="DocumentSnapshot",n.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?n:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),n.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),n)}}jm._jsonSchemaVersion="firestore/documentSnapshot/1.0",jm._jsonSchema={type:zs("string",jm._jsonSchemaVersion),bundleSource:zs("string","DocumentSnapshot"),bundleName:zs("string"),bundle:zs("string")};class Lv extends jm{data(e={}){return super.data(e)}}class Um{constructor(e,n,o,d){this._firestore=e,this._userDataWriter=n,this._snapshot=d,this.metadata=new mv(d.hasPendingWrites,d.fromCache),this.query=o}get docs(){const e=[];return this.forEach((n=>e.push(n))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,n){this._snapshot.docs.forEach((o=>{e.call(n,new Lv(this._firestore,this._userDataWriter,o.key,o,new mv(this._snapshot.mutatedKeys.has(o.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const n=!!e.includeMetadataChanges;if(n&&this._snapshot.excludesMetadataChanges)throw new _n(kt.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===n||(this._cachedChanges=(function(d,g){if(d._snapshot.oldDocs.isEmpty()){let _=0;return d._snapshot.docChanges.map((c=>{const M=new Lv(d._firestore,d._userDataWriter,c.doc.key,c.doc,new mv(d._snapshot.mutatedKeys.has(c.doc.key),d._snapshot.fromCache),d.query.converter);return c.doc,{type:"added",doc:M,oldIndex:-1,newIndex:_++}}))}{let _=d._snapshot.oldDocs;return d._snapshot.docChanges.filter((c=>g||c.type!==3)).map((c=>{const M=new Lv(d._firestore,d._userDataWriter,c.doc.key,c.doc,new mv(d._snapshot.mutatedKeys.has(c.doc.key),d._snapshot.fromCache),d.query.converter);let k=-1,j=-1;return c.type!==0&&(k=_.indexOf(c.doc.key),_=_.delete(c.doc.key)),c.type!==1&&(_=_.add(c.doc),j=_.indexOf(c.doc.key)),{type:GD(c.type),doc:M,oldIndex:k,newIndex:j}}))}})(this,n),this._cachedChangesIncludeMetadataChanges=n),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new _n(kt.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=Um._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=y1.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const n=[],o=[],d=[];return this.docs.forEach((g=>{g._document!==null&&(n.push(g._document),o.push(this._userDataWriter.convertObjectMap(g._document.data.value.mapValue.fields,"previous")),d.push(g.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function GD(i){switch(i){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Hn(61501,{type:i})}}Um._jsonSchemaVersion="firestore/querySnapshot/1.0",Um._jsonSchema={type:zs("string",Um._jsonSchemaVersion),bundleSource:zs("string","QuerySnapshot"),bundleName:zs("string"),bundle:zs("string")};class ZD extends $D{constructor(e){super(),this.firestore=e}convertBytes(e){return new Mc(e)}convertReference(e){const n=this.convertDocumentKey(e,this.firestore._databaseId);return new xo(this.firestore,null,n)}}function HD(i){i=Jv(i,og);const e=Jv(i.firestore,j1),n=jA(e),o=new ZD(e);return VD(i._query),AD(n,i._query).then((d=>new Um(e,o,i,d)))}function XD(i,e){const n=Jv(i.firestore,j1),o=MD(i),d=qD(i.converter,e);return WD(n,[DD($A(i.firestore),"addDoc",o._key,d,i.converter!==null,{}).toMutation(o._key,Ld.exists(!1))]).then((()=>o))}function WD(i,e){return(function(o,d){const g=new Sf;return o.asyncQueue.enqueueAndForget((async()=>dD(await SD(o),d,g))),g.promise})(jA(i),e)}function dT(){return new G1("serverTimestamp")}(function(e,n=!0){(function(d){ig=d})(g5),Xh(new lh("firestore",((o,{instanceIdentifier:d,options:g})=>{const _=o.getProvider("app").getImmediate(),c=new j1(new I5(o.getProvider("auth-internal")),new L5(_,o.getProvider("app-check-internal")),(function(k,j){if(!Object.prototype.hasOwnProperty.apply(k.options,["projectId"]))throw new _n(kt.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new j_(k.options.projectId,j)})(_,d),_);return g={useFetchStreams:n,...g},c._setSettings(g),c}),"PUBLIC").setMultipleInstances(!0)),sh(p2,m2,e),sh(p2,m2,"esm2020")})();var KD="firebase",YD="12.6.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */sh(KD,YD,"app");const YA="@firebase/installations",K1="0.6.19";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QA=1e4,JA=`w:${K1}`,eC="FIS_v2",QD="https://firebaseinstallations.googleapis.com/v1",JD=3600*1e3,ez="installations",tz="Installations";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nz={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},zp=new oy(ez,tz,nz);function tC(i){return i instanceof kf&&i.code.includes("request-failed")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nC({projectId:i}){return`${QD}/projects/${i}/installations`}function iC(i){return{token:i.token,requestStatus:2,expiresIn:rz(i.expiresIn),creationTime:Date.now()}}async function rC(i,e){const o=(await e.json()).error;return zp.create("request-failed",{requestName:i,serverCode:o.code,serverMessage:o.message,serverStatus:o.status})}function aC({apiKey:i}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":i})}function iz(i,{refreshToken:e}){const n=aC(i);return n.append("Authorization",az(e)),n}async function sC(i){const e=await i();return e.status>=500&&e.status<600?i():e}function rz(i){return Number(i.replace("s","000"))}function az(i){return`${eC} ${i}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function sz({appConfig:i,heartbeatServiceProvider:e},{fid:n}){const o=nC(i),d=aC(i),g=e.getImmediate({optional:!0});if(g){const k=await g.getHeartbeatsHeader();k&&d.append("x-firebase-client",k)}const _={fid:n,authVersion:eC,appId:i.appId,sdkVersion:JA},c={method:"POST",headers:d,body:JSON.stringify(_)},M=await sC(()=>fetch(o,c));if(M.ok){const k=await M.json();return{fid:k.fid||n,registrationStatus:2,refreshToken:k.refreshToken,authToken:iC(k.authToken)}}else throw await rC("Create Installation",M)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oC(i){return new Promise(e=>{setTimeout(e,i)})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oz(i){return btoa(String.fromCharCode(...i)).replace(/\+/g,"-").replace(/\//g,"_")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lz=/^[cdef][\w-]{21}$/,Px="";function uz(){try{const i=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(i),i[0]=112+i[0]%16;const n=cz(i);return lz.test(n)?n:Px}catch{return Px}}function cz(i){return oz(i).substr(0,22)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function V0(i){return`${i.appName}!${i.appId}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lC=new Map;function uC(i,e){const n=V0(i);cC(n,e),hz(n,e)}function cC(i,e){const n=lC.get(i);if(n)for(const o of n)o(e)}function hz(i,e){const n=dz();n&&n.postMessage({key:i,fid:e}),fz()}let Sp=null;function dz(){return!Sp&&"BroadcastChannel"in self&&(Sp=new BroadcastChannel("[Firebase] FID Change"),Sp.onmessage=i=>{cC(i.data.key,i.data.fid)}),Sp}function fz(){lC.size===0&&Sp&&(Sp.close(),Sp=null)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pz="firebase-installations-database",mz=1,Op="firebase-installations-store";let Nb=null;function Y1(){return Nb||(Nb=gE(pz,mz,{upgrade:(i,e)=>{switch(e){case 0:i.createObjectStore(Op)}}})),Nb}async function h0(i,e){const n=V0(i),d=(await Y1()).transaction(Op,"readwrite"),g=d.objectStore(Op),_=await g.get(n);return await g.put(e,n),await d.done,(!_||_.fid!==e.fid)&&uC(i,e.fid),e}async function hC(i){const e=V0(i),o=(await Y1()).transaction(Op,"readwrite");await o.objectStore(Op).delete(e),await o.done}async function j0(i,e){const n=V0(i),d=(await Y1()).transaction(Op,"readwrite"),g=d.objectStore(Op),_=await g.get(n),c=e(_);return c===void 0?await g.delete(n):await g.put(c,n),await d.done,c&&(!_||_.fid!==c.fid)&&uC(i,c.fid),c}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Q1(i){let e;const n=await j0(i.appConfig,o=>{const d=gz(o),g=_z(i,d);return e=g.registrationPromise,g.installationEntry});return n.fid===Px?{installationEntry:await e}:{installationEntry:n,registrationPromise:e}}function gz(i){const e=i||{fid:uz(),registrationStatus:0};return dC(e)}function _z(i,e){if(e.registrationStatus===0){if(!navigator.onLine){const d=Promise.reject(zp.create("app-offline"));return{installationEntry:e,registrationPromise:d}}const n={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},o=yz(i,n);return{installationEntry:n,registrationPromise:o}}else return e.registrationStatus===1?{installationEntry:e,registrationPromise:vz(i)}:{installationEntry:e}}async function yz(i,e){try{const n=await sz(i,e);return h0(i.appConfig,n)}catch(n){throw tC(n)&&n.customData.serverCode===409?await hC(i.appConfig):await h0(i.appConfig,{fid:e.fid,registrationStatus:0}),n}}async function vz(i){let e=await fT(i.appConfig);for(;e.registrationStatus===1;)await oC(100),e=await fT(i.appConfig);if(e.registrationStatus===0){const{installationEntry:n,registrationPromise:o}=await Q1(i);return o||n}return e}function fT(i){return j0(i,e=>{if(!e)throw zp.create("installation-not-found");return dC(e)})}function dC(i){return bz(i)?{fid:i.fid,registrationStatus:0}:i}function bz(i){return i.registrationStatus===1&&i.registrationTime+QA<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function xz({appConfig:i,heartbeatServiceProvider:e},n){const o=wz(i,n),d=iz(i,n),g=e.getImmediate({optional:!0});if(g){const k=await g.getHeartbeatsHeader();k&&d.append("x-firebase-client",k)}const _={installation:{sdkVersion:JA,appId:i.appId}},c={method:"POST",headers:d,body:JSON.stringify(_)},M=await sC(()=>fetch(o,c));if(M.ok){const k=await M.json();return iC(k)}else throw await rC("Generate Auth Token",M)}function wz(i,{fid:e}){return`${nC(i)}/${e}/authTokens:generate`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function J1(i,e=!1){let n;const o=await j0(i.appConfig,g=>{if(!fC(g))throw zp.create("not-registered");const _=g.authToken;if(!e&&Ez(_))return g;if(_.requestStatus===1)return n=Tz(i,e),g;{if(!navigator.onLine)throw zp.create("app-offline");const c=Cz(g);return n=Sz(i,c),c}});return n?await n:o.authToken}async function Tz(i,e){let n=await pT(i.appConfig);for(;n.authToken.requestStatus===1;)await oC(100),n=await pT(i.appConfig);const o=n.authToken;return o.requestStatus===0?J1(i,e):o}function pT(i){return j0(i,e=>{if(!fC(e))throw zp.create("not-registered");const n=e.authToken;return Mz(n)?{...e,authToken:{requestStatus:0}}:e})}async function Sz(i,e){try{const n=await xz(i,e),o={...e,authToken:n};return await h0(i.appConfig,o),n}catch(n){if(tC(n)&&(n.customData.serverCode===401||n.customData.serverCode===404))await hC(i.appConfig);else{const o={...e,authToken:{requestStatus:0}};await h0(i.appConfig,o)}throw n}}function fC(i){return i!==void 0&&i.registrationStatus===2}function Ez(i){return i.requestStatus===2&&!Az(i)}function Az(i){const e=Date.now();return e<i.creationTime||i.creationTime+i.expiresIn<e+JD}function Cz(i){const e={requestStatus:1,requestTime:Date.now()};return{...i,authToken:e}}function Mz(i){return i.requestStatus===1&&i.requestTime+QA<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Iz(i){const e=i,{installationEntry:n,registrationPromise:o}=await Q1(e);return o?o.catch(console.error):J1(e).catch(console.error),n.fid}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Pz(i,e=!1){const n=i;return await Rz(n),(await J1(n,e)).token}async function Rz(i){const{registrationPromise:e}=await Q1(i);e&&await e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lz(i){if(!i||!i.options)throw Bb("App Configuration");if(!i.name)throw Bb("App Name");const e=["projectId","apiKey","appId"];for(const n of e)if(!i.options[n])throw Bb(n);return{appName:i.name,projectId:i.options.projectId,apiKey:i.options.apiKey,appId:i.options.appId}}function Bb(i){return zp.create("missing-app-config-values",{valueName:i})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pC="installations",kz="installations-internal",Dz=i=>{const e=i.getProvider("app").getImmediate(),n=Lz(e),o=Vp(e,"heartbeat");return{app:e,appConfig:n,heartbeatServiceProvider:o,_delete:()=>Promise.resolve()}},zz=i=>{const e=i.getProvider("app").getImmediate(),n=Vp(e,pC).getImmediate();return{getId:()=>Iz(n),getToken:d=>Pz(n,d)}};function Oz(){Xh(new lh(pC,Dz,"PUBLIC")),Xh(new lh(kz,zz,"PRIVATE"))}Oz();sh(YA,K1);sh(YA,K1,"esm2020");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const d0="analytics",Nz="firebase_id",Bz="origin",Fz=60*1e3,Vz="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",ew="https://www.googletagmanager.com/gtag/js";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $l=new A0("@firebase/analytics");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jz={"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-initialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."},Vu=new oy("analytics","Analytics",jz);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Uz(i){if(!i.startsWith(ew)){const e=Vu.create("invalid-gtag-resource",{gtagURL:i});return $l.warn(e.message),""}return i}function mC(i){return Promise.all(i.map(e=>e.catch(n=>n)))}function $z(i,e){let n;return window.trustedTypes&&(n=window.trustedTypes.createPolicy(i,e)),n}function qz(i,e){const n=$z("firebase-js-sdk-policy",{createScriptURL:Uz}),o=document.createElement("script"),d=`${ew}?l=${i}&id=${e}`;o.src=n?n==null?void 0:n.createScriptURL(d):d,o.async=!0,document.head.appendChild(o)}function Gz(i){let e=[];return Array.isArray(window[i])?e=window[i]:window[i]=e,e}async function Zz(i,e,n,o,d,g){const _=o[d];try{if(_)await e[_];else{const M=(await mC(n)).find(k=>k.measurementId===d);M&&await e[M.appId]}}catch(c){$l.error(c)}i("config",d,g)}async function Hz(i,e,n,o,d){try{let g=[];if(d&&d.send_to){let _=d.send_to;Array.isArray(_)||(_=[_]);const c=await mC(n);for(const M of _){const k=c.find(G=>G.measurementId===M),j=k&&e[k.appId];if(j)g.push(j);else{g=[];break}}}g.length===0&&(g=Object.values(e)),await Promise.all(g),i("event",o,d||{})}catch(g){$l.error(g)}}function Xz(i,e,n,o){async function d(g,..._){try{if(g==="event"){const[c,M]=_;await Hz(i,e,n,c,M)}else if(g==="config"){const[c,M]=_;await Zz(i,e,n,o,c,M)}else if(g==="consent"){const[c,M]=_;i("consent",c,M)}else if(g==="get"){const[c,M,k]=_;i("get",c,M,k)}else if(g==="set"){const[c]=_;i("set",c)}else i(g,..._)}catch(c){$l.error(c)}}return d}function Wz(i,e,n,o,d){let g=function(..._){window[o].push(arguments)};return window[d]&&typeof window[d]=="function"&&(g=window[d]),window[d]=Xz(g,i,e,n),{gtagCore:g,wrappedGtag:window[d]}}function Kz(i){const e=window.document.getElementsByTagName("script");for(const n of Object.values(e))if(n.src&&n.src.includes(ew)&&n.src.includes(i))return n;return null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yz=30,Qz=1e3;class Jz{constructor(e={},n=Qz){this.throttleMetadata=e,this.intervalMillis=n}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,n){this.throttleMetadata[e]=n}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}}const gC=new Jz;function e3(i){return new Headers({Accept:"application/json","x-goog-api-key":i})}async function t3(i){var _;const{appId:e,apiKey:n}=i,o={method:"GET",headers:e3(n)},d=Vz.replace("{app-id}",e),g=await fetch(d,o);if(g.status!==200&&g.status!==304){let c="";try{const M=await g.json();(_=M.error)!=null&&_.message&&(c=M.error.message)}catch{}throw Vu.create("config-fetch-failed",{httpStatus:g.status,responseMessage:c})}return g.json()}async function n3(i,e=gC,n){const{appId:o,apiKey:d,measurementId:g}=i.options;if(!o)throw Vu.create("no-app-id");if(!d){if(g)return{measurementId:g,appId:o};throw Vu.create("no-api-key")}const _=e.getThrottleMetadata(o)||{backoffCount:0,throttleEndTimeMillis:Date.now()},c=new a3;return setTimeout(async()=>{c.abort()},Fz),_C({appId:o,apiKey:d,measurementId:g},_,c,e)}async function _C(i,{throttleEndTimeMillis:e,backoffCount:n},o,d=gC){var c;const{appId:g,measurementId:_}=i;try{await i3(o,e)}catch(M){if(_)return $l.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${_} provided in the "measurementId" field in the local Firebase config. [${M==null?void 0:M.message}]`),{appId:g,measurementId:_};throw M}try{const M=await t3(i);return d.deleteThrottleMetadata(g),M}catch(M){const k=M;if(!r3(k)){if(d.deleteThrottleMetadata(g),_)return $l.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${_} provided in the "measurementId" field in the local Firebase config. [${k==null?void 0:k.message}]`),{appId:g,measurementId:_};throw M}const j=Number((c=k==null?void 0:k.customData)==null?void 0:c.httpStatus)===503?ox(n,d.intervalMillis,Yz):ox(n,d.intervalMillis),G={throttleEndTimeMillis:Date.now()+j,backoffCount:n+1};return d.setThrottleMetadata(g,G),$l.debug(`Calling attemptFetch again in ${j} millis`),_C(i,G,o,d)}}function i3(i,e){return new Promise((n,o)=>{const d=Math.max(e-Date.now(),0),g=setTimeout(n,d);i.addEventListener(()=>{clearTimeout(g),o(Vu.create("fetch-throttle",{throttleEndTimeMillis:e}))})})}function r3(i){if(!(i instanceof kf)||!i.customData)return!1;const e=Number(i.customData.httpStatus);return e===429||e===500||e===503||e===504}class a3{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}async function s3(i,e,n,o,d){if(d&&d.global){i("event",n,o);return}else{const g=await e,_={...o,send_to:g};i("event",n,_)}}async function o3(i,e,n,o){if(o&&o.global){const d={};for(const g of Object.keys(n))d[`user_properties.${g}`]=n[g];return i("set",d),Promise.resolve()}else{const d=await e;i("config",d,{update:!0,user_properties:n})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function l3(){if(E0())try{await fE()}catch(i){return $l.warn(Vu.create("indexeddb-unavailable",{errorInfo:i==null?void 0:i.toString()}).message),!1}else return $l.warn(Vu.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;return!0}async function u3(i,e,n,o,d,g,_){const c=n3(i);c.then(ee=>{n[ee.measurementId]=ee.appId,i.options.measurementId&&ee.measurementId!==i.options.measurementId&&$l.warn(`The measurement ID in the local Firebase config (${i.options.measurementId}) does not match the measurement ID fetched from the server (${ee.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(ee=>$l.error(ee)),e.push(c);const M=l3().then(ee=>{if(ee)return o.getId()}),[k,j]=await Promise.all([c,M]);Kz(g)||qz(g,k.measurementId),d("js",new Date);const G=(_==null?void 0:_.config)??{};return G[Bz]="firebase",G.update=!0,j!=null&&(G[Nz]=j),d("config",k.measurementId,G),k.measurementId}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c3{constructor(e){this.app=e}_delete(){return delete $m[this.app.options.appId],Promise.resolve()}}let $m={},mT=[];const gT={};let Fb="dataLayer",h3="gtag",_T,tw,yT=!1;function d3(){const i=[];if(lR()&&i.push("This is a browser extension environment."),cR()||i.push("Cookies are not available."),i.length>0){const e=i.map((o,d)=>`(${d+1}) ${o}`).join(" "),n=Vu.create("invalid-analytics-context",{errorInfo:e});$l.warn(n.message)}}function f3(i,e,n){d3();const o=i.options.appId;if(!o)throw Vu.create("no-app-id");if(!i.options.apiKey)if(i.options.measurementId)$l.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${i.options.measurementId} provided in the "measurementId" field in the local Firebase config.`);else throw Vu.create("no-api-key");if($m[o]!=null)throw Vu.create("already-exists",{id:o});if(!yT){Gz(Fb);const{wrappedGtag:g,gtagCore:_}=Wz($m,mT,gT,Fb,h3);tw=g,_T=_,yT=!0}return $m[o]=u3(i,mT,gT,e,_T,Fb,n),new c3(i)}function p3(i=g1()){i=Hh(i);const e=Vp(i,d0);return e.isInitialized()?e.getImmediate():m3(i)}function m3(i,e={}){const n=Vp(i,d0);if(n.isInitialized()){const d=n.getImmediate();if(N_(e,n.getOptions()))return d;throw Vu.create("already-initialized")}return n.initialize({options:e})}function g3(i,e,n){i=Hh(i),o3(tw,$m[i.app.options.appId],e,n).catch(o=>$l.error(o))}function _3(i,e,n,o){i=Hh(i),s3(tw,$m[i.app.options.appId],e,n,o).catch(d=>$l.error(d))}const vT="@firebase/analytics",bT="0.10.19";function y3(){Xh(new lh(d0,(e,{options:n})=>{const o=e.getProvider("app").getImmediate(),d=e.getProvider("installations-internal").getImmediate();return f3(o,d,n)},"PUBLIC")),Xh(new lh("analytics-internal",i,"PRIVATE")),sh(vT,bT),sh(vT,bT,"esm2020");function i(e){try{const n=e.getProvider(d0).getImmediate();return{logEvent:(o,d,g)=>_3(n,o,d,g),setUserProperties:(o,d)=>g3(n,o,d)}}catch(n){throw Vu.create("interop-component-reg-failed",{reason:n})}}}y3();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rx=new Map,yC={activated:!1,tokenObservers:[]},v3={initialized:!1,enabled:!1};function ao(i){return Rx.get(i)||{...yC}}function b3(i,e){return Rx.set(i,e),Rx.get(i)}function U0(){return v3}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vC="https://content-firebaseappcheck.googleapis.com/v1",x3="exchangeRecaptchaV3Token",w3="exchangeDebugToken",xT={RETRIAL_MIN_WAIT:30*1e3,RETRIAL_MAX_WAIT:960*1e3},T3=1440*60*1e3;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class S3{constructor(e,n,o,d,g){if(this.operation=e,this.retryPolicy=n,this.getWaitDuration=o,this.lowerBound=d,this.upperBound=g,this.pending=null,this.nextErrorWaitInterval=d,d>g)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}async process(e){this.stop();try{this.pending=new O_,this.pending.promise.catch(n=>{}),await E3(this.getNextRun(e)),this.pending.resolve(),await this.pending.promise,this.pending=new O_,this.pending.promise.catch(n=>{}),await this.operation(),this.pending.resolve(),await this.pending.promise,this.process(!0).catch(()=>{})}catch(n){this.retryPolicy(n)?this.process(!1).catch(()=>{}):this.stop()}}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{const n=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),n}}}function E3(i){return new Promise(e=>{setTimeout(e,i)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const A3={"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.","initial-throttle":"{$httpStatus} error. Attempts allowed again after {$time}",throttled:"Requests throttled due to previous {$httpStatus} error. Attempts allowed again after {$time}"},uu=new oy("appCheck","AppCheck",A3);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wT(i=!1){var e;return i?(e=self.grecaptcha)==null?void 0:e.enterprise:self.grecaptcha}function nw(i){if(!ao(i).activated)throw uu.create("use-before-activation",{appName:i.name})}function bC(i){const e=Math.round(i/1e3),n=Math.floor(e/(3600*24)),o=Math.floor((e-n*3600*24)/3600),d=Math.floor((e-n*3600*24-o*3600)/60),g=e-n*3600*24-o*3600-d*60;let _="";return n&&(_+=gv(n)+"d:"),o&&(_+=gv(o)+"h:"),_+=gv(d)+"m:"+gv(g)+"s",_}function gv(i){return i===0?"00":i>=10?i.toString():"0"+i}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function iw({url:i,body:e},n){const o={"Content-Type":"application/json"},d=n.getImmediate({optional:!0});if(d){const G=await d.getHeartbeatsHeader();G&&(o["X-Firebase-Client"]=G)}const g={method:"POST",body:JSON.stringify(e),headers:o};let _;try{_=await fetch(i,g)}catch(G){throw uu.create("fetch-network-error",{originalErrorMessage:G==null?void 0:G.message})}if(_.status!==200)throw uu.create("fetch-status-error",{httpStatus:_.status});let c;try{c=await _.json()}catch(G){throw uu.create("fetch-parse-error",{originalErrorMessage:G==null?void 0:G.message})}const M=c.ttl.match(/^([\d.]+)(s)$/);if(!M||!M[2]||isNaN(Number(M[1])))throw uu.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${c.ttl}`});const k=Number(M[1])*1e3,j=Date.now();return{token:c.token,expireTimeMillis:j+k,issuedAtTimeMillis:j}}function C3(i,e){const{projectId:n,appId:o,apiKey:d}=i.options;return{url:`${vC}/projects/${n}/apps/${o}:${x3}?key=${d}`,body:{recaptcha_v3_token:e}}}function xC(i,e){const{projectId:n,appId:o,apiKey:d}=i.options;return{url:`${vC}/projects/${n}/apps/${o}:${w3}?key=${d}`,body:{debug_token:e}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const M3="firebase-app-check-database",I3=1,Z_="firebase-app-check-store",wC="debug-token";let _v=null;function TC(){return _v||(_v=new Promise((i,e)=>{try{const n=indexedDB.open(M3,I3);n.onsuccess=o=>{i(o.target.result)},n.onerror=o=>{var d;e(uu.create("storage-open",{originalErrorMessage:(d=o.target.error)==null?void 0:d.message}))},n.onupgradeneeded=o=>{const d=o.target.result;switch(o.oldVersion){case 0:d.createObjectStore(Z_,{keyPath:"compositeKey"})}}}catch(n){e(uu.create("storage-open",{originalErrorMessage:n==null?void 0:n.message}))}}),_v)}function P3(i){return EC(AC(i))}function R3(i,e){return SC(AC(i),e)}function L3(i){return SC(wC,i)}function k3(){return EC(wC)}async function SC(i,e){const o=(await TC()).transaction(Z_,"readwrite"),g=o.objectStore(Z_).put({compositeKey:i,value:e});return new Promise((_,c)=>{g.onsuccess=M=>{_()},o.onerror=M=>{var k;c(uu.create("storage-set",{originalErrorMessage:(k=M.target.error)==null?void 0:k.message}))}})}async function EC(i){const n=(await TC()).transaction(Z_,"readonly"),d=n.objectStore(Z_).get(i);return new Promise((g,_)=>{d.onsuccess=c=>{const M=c.target.result;g(M?M.value:void 0)},n.onerror=c=>{var M;_(uu.create("storage-get",{originalErrorMessage:(M=c.target.error)==null?void 0:M.message}))}})}function AC(i){return`${i.options.appId}-${i.name}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yf=new A0("@firebase/app-check");/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function D3(i){if(E0()){let e;try{e=await P3(i)}catch(n){yf.warn(`Failed to read token from IndexedDB. Error: ${n}`)}return e}}function Vb(i,e){return E0()?R3(i,e).catch(n=>{yf.warn(`Failed to write token to IndexedDB. Error: ${n}`)}):Promise.resolve()}async function z3(){let i;try{i=await k3()}catch{}if(i)return i;{const e=crypto.randomUUID();return L3(e).catch(n=>yf.warn(`Failed to persist debug token to IndexedDB. Error: ${n}`)),e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rw(){return U0().enabled}async function aw(){const i=U0();if(i.enabled&&i.token)return i.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)}function O3(){const i=hE(),e=U0();if(e.initialized=!0,typeof i.FIREBASE_APPCHECK_DEBUG_TOKEN!="string"&&i.FIREBASE_APPCHECK_DEBUG_TOKEN!==!0)return;e.enabled=!0;const n=new O_;e.token=n,typeof i.FIREBASE_APPCHECK_DEBUG_TOKEN=="string"?n.resolve(i.FIREBASE_APPCHECK_DEBUG_TOKEN):n.resolve(z3())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const N3={error:"UNKNOWN_ERROR"};function B3(i){return d1.encodeString(JSON.stringify(i),!1)}async function Lx(i,e=!1,n=!1){const o=i.app;nw(o);const d=ao(o);let g=d.token,_;if(g&&!Fm(g)&&(d.token=void 0,g=void 0),!g){const k=await d.cachedTokenPromise;k&&(Fm(k)?g=k:await Vb(o,void 0))}if(!e&&g&&Fm(g))return{token:g.token};let c=!1;if(rw())try{d.exchangeTokenPromise||(d.exchangeTokenPromise=iw(xC(o,await aw()),i.heartbeatServiceProvider).finally(()=>{d.exchangeTokenPromise=void 0}),c=!0);const k=await d.exchangeTokenPromise;return await Vb(o,k),d.token=k,{token:k.token}}catch(k){return k.code==="appCheck/throttled"||k.code==="appCheck/initial-throttle"?yf.warn(k.message):n&&yf.error(k),jb(k)}try{d.exchangeTokenPromise||(d.exchangeTokenPromise=d.provider.getToken().finally(()=>{d.exchangeTokenPromise=void 0}),c=!0),g=await ao(o).exchangeTokenPromise}catch(k){k.code==="appCheck/throttled"||k.code==="appCheck/initial-throttle"?yf.warn(k.message):n&&yf.error(k),_=k}let M;return g?_?Fm(g)?M={token:g.token,internalError:_}:M=jb(_):(M={token:g.token},d.token=g,await Vb(o,g)):M=jb(_),c&&IC(o,M),M}async function F3(i){const e=i.app;nw(e);const{provider:n}=ao(e);if(rw()){const o=await aw(),{token:d}=await iw(xC(e,o),i.heartbeatServiceProvider);return{token:d}}else{const{token:o}=await n.getToken();return{token:o}}}function CC(i,e,n,o){const{app:d}=i,g=ao(d),_={next:n,error:o,type:e};if(g.tokenObservers=[...g.tokenObservers,_],g.token&&Fm(g.token)){const c=g.token;Promise.resolve().then(()=>{n({token:c.token}),TT(i)}).catch(()=>{})}g.cachedTokenPromise.then(()=>TT(i))}function MC(i,e){const n=ao(i),o=n.tokenObservers.filter(d=>d.next!==e);o.length===0&&n.tokenRefresher&&n.tokenRefresher.isRunning()&&n.tokenRefresher.stop(),n.tokenObservers=o}function TT(i){const{app:e}=i,n=ao(e);let o=n.tokenRefresher;o||(o=V3(i),n.tokenRefresher=o),!o.isRunning()&&n.isTokenAutoRefreshEnabled&&o.start()}function V3(i){const{app:e}=i;return new S3(async()=>{const n=ao(e);let o;if(n.token?o=await Lx(i,!0):o=await Lx(i),o.error)throw o.error;if(o.internalError)throw o.internalError},()=>!0,()=>{const n=ao(e);if(n.token){let o=n.token.issuedAtTimeMillis+(n.token.expireTimeMillis-n.token.issuedAtTimeMillis)*.5+3e5;const d=n.token.expireTimeMillis-300*1e3;return o=Math.min(o,d),Math.max(0,o-Date.now())}else return 0},xT.RETRIAL_MIN_WAIT,xT.RETRIAL_MAX_WAIT)}function IC(i,e){const n=ao(i).tokenObservers;for(const o of n)try{o.type==="EXTERNAL"&&e.error!=null?o.error(e.error):o.next(e)}catch{}}function Fm(i){return i.expireTimeMillis-Date.now()>0}function jb(i){return{token:B3(N3),error:i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class j3{constructor(e,n){this.app=e,this.heartbeatServiceProvider=n}_delete(){const{tokenObservers:e}=ao(this.app);for(const n of e)MC(this.app,n.next);return Promise.resolve()}}function U3(i,e){return new j3(i,e)}function $3(i){return{getToken:e=>Lx(i,e),getLimitedUseToken:()=>F3(i),addTokenListener:e=>CC(i,"INTERNAL",e),removeTokenListener:e=>MC(i.app,e)}}const q3="@firebase/app-check",G3="0.11.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Z3="https://www.google.com/recaptcha/api.js";function H3(i,e){const n=new O_,o=ao(i);o.reCAPTCHAState={initialized:n};const d=X3(i),g=wT(!1);return g?ST(i,e,g,d,n):Y3(()=>{const _=wT(!1);if(!_)throw new Error("no recaptcha");ST(i,e,_,d,n)}),n.promise}function ST(i,e,n,o,d){n.ready(()=>{K3(i,e,n,o),d.resolve(n)})}function X3(i){const e=`fire_app_check_${i.name}`,n=document.createElement("div");return n.id=e,n.style.display="none",document.body.appendChild(n),e}async function W3(i){nw(i);const n=await ao(i).reCAPTCHAState.initialized.promise;return new Promise((o,d)=>{const g=ao(i).reCAPTCHAState;n.ready(()=>{o(n.execute(g.widgetId,{action:"fire_app_check"}))})})}function K3(i,e,n,o){const d=n.render(o,{sitekey:e,size:"invisible",callback:()=>{ao(i).reCAPTCHAState.succeeded=!0},"error-callback":()=>{ao(i).reCAPTCHAState.succeeded=!1}}),g=ao(i);g.reCAPTCHAState={...g.reCAPTCHAState,widgetId:d}}function Y3(i){const e=document.createElement("script");e.src=Z3,e.onload=i,document.head.appendChild(e)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sw{constructor(e){this._siteKey=e,this._throttleData=null}async getToken(){var o,d,g;J3(this._throttleData);const e=await W3(this._app).catch(_=>{throw uu.create("recaptcha-error")});if(!((o=ao(this._app).reCAPTCHAState)!=null&&o.succeeded))throw uu.create("recaptcha-error");let n;try{n=await iw(C3(this._app,e),this._heartbeatServiceProvider)}catch(_){throw(d=_.code)!=null&&d.includes("fetch-status-error")?(this._throttleData=Q3(Number((g=_.customData)==null?void 0:g.httpStatus),this._throttleData),uu.create("initial-throttle",{time:bC(this._throttleData.allowRequestsAfter-Date.now()),httpStatus:this._throttleData.httpStatus})):_}return this._throttleData=null,n}initialize(e){this._app=e,this._heartbeatServiceProvider=Vp(e,"heartbeat"),H3(e,this._siteKey).catch(()=>{})}isEqual(e){return e instanceof sw?this._siteKey===e._siteKey:!1}}function Q3(i,e){if(i===404||i===403)return{backoffCount:1,allowRequestsAfter:Date.now()+T3,httpStatus:i};{const n=e?e.backoffCount:0,o=ox(n,1e3,2);return{backoffCount:n+1,allowRequestsAfter:Date.now()+o,httpStatus:i}}}function J3(i){if(i&&Date.now()-i.allowRequestsAfter<=0)throw uu.create("throttled",{time:bC(i.allowRequestsAfter-Date.now()),httpStatus:i.httpStatus})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function e4(i=g1(),e){i=Hh(i);const n=Vp(i,"app-check");if(U0().initialized||O3(),rw()&&aw().then(d=>console.log(`App Check debug token: ${d}. You will need to add it to your app's App Check settings in the Firebase console for it to work.`)),n.isInitialized()){const d=n.getImmediate(),g=n.getOptions();if(g.isTokenAutoRefreshEnabled===e.isTokenAutoRefreshEnabled&&g.provider.isEqual(e.provider))return d;throw uu.create("already-initialized",{appName:i.name})}const o=n.initialize({options:e});return t4(i,e.provider,e.isTokenAutoRefreshEnabled),ao(i).isTokenAutoRefreshEnabled&&CC(o,"INTERNAL",()=>{}),o}function t4(i,e,n=!1){const o=b3(i,{...yC});o.activated=!0,o.provider=e,o.cachedTokenPromise=D3(i).then(d=>(d&&Fm(d)&&(o.token=d,IC(i,{token:d.token})),d)),o.isTokenAutoRefreshEnabled=n&&i.automaticDataCollectionEnabled,!i.automaticDataCollectionEnabled&&n&&yf.warn("`isTokenAutoRefreshEnabled` is true but `automaticDataCollectionEnabled` was set to false during `initializeApp()`. This blocks automatic token refresh."),o.provider.initialize(i)}const n4="app-check",ET="app-check-internal";function i4(){Xh(new lh(n4,i=>{const e=i.getProvider("app").getImmediate(),n=i.getProvider("heartbeat");return U3(e,n)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((i,e,n)=>{i.getProvider(ET).initialize()})),Xh(new lh(ET,i=>{const e=i.getProvider("app-check").getImmediate();return $3(e)},"PUBLIC").setInstantiationMode("EXPLICIT")),sh(q3,G3)}i4();const r4={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_CLARITY_ID:"tyjad302qq",VITE_FIREBASE_API_KEY:"AIzaSyC5EgMfrRpFh8_ZFyQ_ieF-YYD9xPrOaVU",VITE_FIREBASE_APP_ID:"1:1016256516850:web:5b902e0616dfc3c926766b",VITE_FIREBASE_AUTH_DOMAIN:"redreport-29023.firebaseapp.com",VITE_FIREBASE_MEASUREMENT_ID:"G-S4C6LSBB9G",VITE_FIREBASE_MESSAGING_SENDER_ID:"1016256516850",VITE_FIREBASE_PROJECT_ID:"redreport-29023",VITE_FIREBASE_STORAGE_BUCKET:"redreport-29023.firebasestorage.app",VITE_MAP_KEY:"0UGrg19TXtYRROinsJ9a",VITE_RECAPTCHA_SITE_KEY:"6LeMDQssAAAAAC3prYanNGr6ItRklzJicu190qUc"},a4={apiKey:"AIzaSyC5EgMfrRpFh8_ZFyQ_ieF-YYD9xPrOaVU",authDomain:"redreport-29023.firebaseapp.com",projectId:"redreport-29023",storageBucket:"redreport-29023.firebasestorage.app",messagingSenderId:"1016256516850",appId:"1:1016256516850:web:5b902e0616dfc3c926766b",measurementId:"G-S4C6LSBB9G"},s4=["VITE_FIREBASE_API_KEY","VITE_FIREBASE_AUTH_DOMAIN","VITE_FIREBASE_PROJECT_ID"];s4.forEach(i=>{if(!r4[i])throw new Error(`Missing required environment variable: ${i}`)});const ow=_E(a4),PC=ID(ow);typeof window<"u"&&e4(ow,{provider:new sw("6LeMDQssAAAAAC3prYanNGr6ItRklzJicu190qUc"),isTokenAutoRefreshEnabled:!0});typeof window<"u"&&p3(ow);const lw=[{"Notre-Dame":{"Residence Halls":[{name:"Alumni Hall",latitude:41.6984,longitude:-86.2339,id:"alumni-hall",type:"Residence Halls",location:"Notre Dame"},{name:"Badin Hall",latitude:41.7006,longitude:-86.2412,id:"badin-hall",type:"Residence Halls",location:"Notre Dame"},{name:"Breen-Phillips Hall",latitude:41.70278,longitude:-86.24,id:"breen-phillips-hall",type:"Residence Halls",location:"Notre Dame"},{name:"Carroll Hall",latitude:41.70194,longitude:-86.24778,id:"carroll-hall",type:"Residence Halls",location:"Notre Dame"},{name:"Cavanaugh Hall",latitude:41.702807,longitude:-86.237164,id:"cavanaugh-hall",type:"Residence Halls",location:"Notre Dame"},{name:"Dillon Hall",latitude:41.6984,longitude:-86.2339,id:"dillon-hall",type:"Residence Halls",location:"Notre Dame"},{name:"Duncan Hall",latitude:41.6984,longitude:-86.2339,id:"duncan-hall",type:"Residence Halls",location:"Notre Dame"},{name:"Dunne Hall",latitude:41.7045274,longitude:-86.2329434,id:"dunne-hall",type:"Residence Halls",location:"Notre Dame"},{name:"Farley Hall",latitude:41.7036468,longitude:-86.2361456,id:"farley-hall",type:"Residence Halls",location:"Notre Dame"},{name:"Fisher Hall",latitude:41.6984,longitude:-86.2339,id:"fisher-hall",type:"Residence Halls",location:"Notre Dame"},{name:"Keenan Hall",latitude:41.703917,longitude:-86.237477,id:"keenan-hall",type:"Residence Halls",location:"Notre Dame"},{name:"Sacred Heart Parish Center",latitude:41.7068221,longitude:-86.2450146,id:"sacred-heart-parish-center",type:"Residence Halls",location:"Notre Dame"},{name:"Baumer Hall",latitude:41.697,longitude:-86.2414,id:"baumer-hall",type:"Residence Halls",location:"Notre Dame"},{name:"Fischer Graduate Residences",latitude:41.7051,longitude:-86.229,id:"fischer-graduate-residences",type:"Residence Halls",location:"Notre Dame"},{name:"Harper Hall",latitude:41.69928,longitude:-86.238899,id:"harper-hall",type:"Residence Halls",location:"Notre Dame"},{name:"Flaherty Hall",latitude:41.7035,longitude:-86.2328,id:"flaherty-hall",type:"Residence Halls",location:"Notre Dame"},{name:"Howard Hall",latitude:41.700833,longitude:-86.241667,id:"howard-hall",type:"Residence Halls",location:"Notre Dame"}],"Academic Buildings":[{name:"Law School",latitude:41.698379,longitude:-86.23863,location:"Notre Dame",id:"law-school",buildingType:"Academic Buildings"},{name:"Hesburgh Library",latitude:41.7023892,longitude:-86.2341526,id:"hesburgh-library",type:"Academic Buildings",location:"Notre Dame"},{name:"Corbett Family Hall",latitude:41.699192,longitude:-86.234851,id:"corbett-family-hall",location:"Notre Dame",buildingType:"Academic Buildings"},{name:"Walsh Family Hall of Architecture",latitude:41.695,longitude:-86.235,id:"walsh-family-hall-of-architecture",type:"Academic Buildings",location:"Notre Dame"},{name:"Jordan Hall of Science",latitude:41.700685,longitude:-86.233075,id:"jordan-hall-of-science",type:"Academic Buildings",location:"Notre Dame"},{name:"DeBartolo Hall",latitude:41.6982522,longitude:-86.2362484,id:"debartolo-hall",type:"Academic Buildings",location:"Notre Dame"},{name:"Decio Faculty Hall",latitude:41.700545,longitude:-86.235967,id:"decio-family-hall",location:"Notre Dame",buildingType:"Academic Buildings"},{name:"Stayer Center for Executive Education",latitude:41.71048456,longitude:-86.2360535,id:"stayer-center-for-executive-education",type:"Academic Buildings",location:"Notre Dame"},{name:"O'Shaughnessy Hall",latitude:41.7003185,longitude:-86.2356855,id:"oshaughnessy-hall",type:"Academic Buildings",location:"Notre Dame"},{name:"Hayes-Healy Center",latitude:41.700344,longitude:-86.236814,id:"hayes-healy-center",location:"Notre Dame",buildingType:"Academic Buildings"},{name:"Mendoza College of Business",latitude:41.6970083,longitude:-86.23615,id:"mendoza-college-of-business",type:"Academic Buildings",location:"Notre Dame"},{name:"Raclin Murphy Museum of Art",latitude:41.693889,longitude:-86.235,id:"raclin-murphy-museum-of-art",type:"Academic Buildings",location:"Notre Dame"},{name:"Fitzpatrick College of Engineering",latitude:41.699234,longitude:-86.23695,id:"fitzpatrick-college-of-engineering",location:"Notre Dame",buildingType:"Academic Buildings"},{name:"Riley Hall of Art & Design",latitude:41.70083425,longitude:-86.23722792,id:"riley-hall-of-art-design",type:"Academic Buildings",location:"Notre Dame"},{name:"Spes Unica Hall",latitude:41.70632,longitude:-86.2570306,id:"spes-unica-hall",type:"Academic Buildings",location:"Notre Dame"},{name:"O'Neill Hall",latitude:41.69822114,longitude:-86.2319385,id:"oneill-hall",type:"Academic Buildings",location:"Notre Dame"},{name:"DPAC",latitude:41.694799,longitude:-86.236694,id:"DPAC",type:"Academic Buildings",location:"Notre Dame"},{name:"Nieuwland Science Hall",latitude:41.70153583,longitude:-86.2366288,id:"nieuwland-science-hall",type:"Academic Buildings",location:"Notre Dame"}],"Student Buildings":[{name:"LaFortune Student Center",latitude:41.7002,longitude:-86.2379,id:"lafortune-student-center",type:"Student Buildings",location:"Notre Dame"},{name:"LaFortune Food Court",latitude:41.7002,longitude:-86.2379,id:"lafortune-food-court",type:"Student Buildings",location:"Notre Dame"},{name:"Haggar Parlor",latitude:41.7002,longitude:-86.2379,id:"haggar-parlor",type:"Student Buildings",location:"Notre Dame"},{name:"Joyce Center",latitude:41.7002,longitude:-86.2379,id:"joyce-center",type:"Student Buildings",location:"Notre Dame"},{name:"Compton Family Ice Arena",latitude:41.7002,longitude:-86.2379,id:"compton-ice-arena",type:"Student Buildings",location:"Notre Dame"},{name:"Notre Dame Stadium",latitude:41.7002,longitude:-86.2379,id:"notre-dame-stadium",type:"Student Buildings",location:"Notre Dame"},{name:"Wellness Center",latitude:41.7002,longitude:-86.2379,id:"wellness-center",type:"Student Buildings",location:"Notre Dame"},{name:"Grotto of Our Lady of Lourdes",latitude:41.7002,longitude:-86.2379,id:"grotto",type:"Student Buildings",location:"Notre Dame"},{name:"Basilica",latitude:41.7026336,longitude:-86.2397856,id:"basilica-of-the-sacred-heart",type:"Student Buildings",location:"Notre Dame"}]},"Holy-Cross":{"Academic Buildings":[{name:"Holy Cross College",latitude:41.7000923,longitude:-86.2537078,location:"Holy Cross",buildingType:"Academic Buildings"}]},"Saint-Marys":{}}],AT=["All",...Object.keys(lw[0])],CT=lw[0],MT=Object.values(lw[0]).flatMap(i=>Object.values(i)).flat();/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var kx=function(){return kx=Object.assign||function(i){for(var e,n=1,o=arguments.length;n<o;n++)for(var d in e=arguments[n])Object.prototype.hasOwnProperty.call(e,d)&&(i[d]=e[d]);return i},kx.apply(this,arguments)},Dx,o4=function(i){var e;i?(function(n){if(n)for(;n.lastChild;)n.lastChild.remove()})(typeof i=="string"?document.getElementById(i):i):(e=document.querySelector(".grecaptcha-badge"))&&e.parentNode&&document.body.removeChild(e.parentNode)},l4=function(i,e){o4(e),window.___grecaptcha_cfg=void 0;var n=document.querySelector("#"+i);n&&n.remove(),(function(){var o=document.querySelector('script[src^="https://www.gstatic.com/recaptcha/releases"]');o&&o.remove()})()},u4=function(i){var e=i.render,n=i.onLoadCallbackName,o=i.language,d=i.onLoad,g=i.useRecaptchaNet,_=i.useEnterprise,c=i.scriptProps,M=c===void 0?{}:c,k=M.nonce,j=k===void 0?"":k,G=M.defer,ee=G!==void 0&&G,Y=M.async,xe=Y!==void 0&&Y,be=M.id,Ne=be===void 0?"":be,tt=M.appendTo,Je=Ne||"google-recaptcha-v3";if((function(Ue){return!!document.querySelector("#"+Ue)})(Je))d();else{var qe=(function(Ue){return"https://www."+(Ue.useRecaptchaNet?"recaptcha.net":"google.com")+"/recaptcha/"+(Ue.useEnterprise?"enterprise.js":"api.js")})({useEnterprise:_,useRecaptchaNet:g}),He=document.createElement("script");He.id=Je,He.src=qe+"?render="+e+(e==="explicit"?"&onload="+n:"")+(o?"&hl="+o:""),j&&(He.nonce=j),He.defer=!!ee,He.async=!!xe,He.onload=d,(tt==="body"?document.body:document.getElementsByTagName("head")[0]).appendChild(He)}},IT=function(i){console.warn(i)};(function(i){i.SCRIPT_NOT_AVAILABLE="Recaptcha script is not available"})(Dx||(Dx={}));var uw=wt.createContext({executeRecaptcha:function(){throw Error("GoogleReCaptcha Context has not yet been implemented, if you are using useGoogleReCaptcha hook, make sure the hook is called inside component wrapped by GoogleRecaptchaProvider")}});uw.Consumer;function c4(i){var e=i.reCaptchaKey,n=i.useEnterprise,o=n!==void 0&&n,d=i.useRecaptchaNet,g=d!==void 0&&d,_=i.scriptProps,c=i.language,M=i.container,k=i.children,j=wt.useState(null),G=j[0],ee=j[1],Y=wt.useRef(e),xe=JSON.stringify(_),be=JSON.stringify(M==null?void 0:M.parameters);wt.useEffect((function(){if(e){var Je=(_==null?void 0:_.id)||"google-recaptcha-v3",qe=(_==null?void 0:_.onLoadCallbackName)||"onRecaptchaLoadCallback";return window[qe]=function(){var He=o?window.grecaptcha.enterprise:window.grecaptcha,Ue=kx({badge:"inline",size:"invisible",sitekey:e},(M==null?void 0:M.parameters)||{});Y.current=He.render(M==null?void 0:M.element,Ue)},u4({render:M!=null&&M.element?"explicit":e,onLoadCallbackName:qe,useEnterprise:o,useRecaptchaNet:g,scriptProps:_,language:c,onLoad:function(){if(window&&window.grecaptcha){var He=o?window.grecaptcha.enterprise:window.grecaptcha;He.ready((function(){ee(He)}))}else IT("<GoogleRecaptchaProvider /> "+Dx.SCRIPT_NOT_AVAILABLE)}}),function(){l4(Je,M==null?void 0:M.element)}}IT("<GoogleReCaptchaProvider /> recaptcha key not provided")}),[o,g,xe,be,c,e,M==null?void 0:M.element]);var Ne=wt.useCallback((function(Je){if(!G||!G.execute)throw new Error("<GoogleReCaptchaProvider /> Google Recaptcha has not been loaded");return G.execute(Y.current,{action:Je})}),[G,Y]),tt=wt.useMemo((function(){return{executeRecaptcha:G?Ne:void 0,container:M==null?void 0:M.element}}),[Ne,G,M==null?void 0:M.element]);return GS.createElement(uw.Provider,{value:tt},k)}var h4=function(){return wt.useContext(uw)};function RC(i,e){return i(e={exports:{}},e.exports),e.exports;/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */}var To=typeof Symbol=="function"&&Symbol.for,zx=To?Symbol.for("react.element"):60103,Ox=To?Symbol.for("react.portal"):60106,kv=To?Symbol.for("react.fragment"):60107,Dv=To?Symbol.for("react.strict_mode"):60108,zv=To?Symbol.for("react.profiler"):60114,Ov=To?Symbol.for("react.provider"):60109,Nv=To?Symbol.for("react.context"):60110,Nx=To?Symbol.for("react.async_mode"):60111,f0=To?Symbol.for("react.concurrent_mode"):60111,Bv=To?Symbol.for("react.forward_ref"):60112,Fv=To?Symbol.for("react.suspense"):60113,d4=To?Symbol.for("react.suspense_list"):60120,Vv=To?Symbol.for("react.memo"):60115,jv=To?Symbol.for("react.lazy"):60116,f4=To?Symbol.for("react.block"):60121,p4=To?Symbol.for("react.fundamental"):60117,m4=To?Symbol.for("react.responder"):60118,g4=To?Symbol.for("react.scope"):60119;function ku(i){if(typeof i=="object"&&i!==null){var e=i.$$typeof;switch(e){case zx:switch(i=i.type){case Nx:case f0:case kv:case zv:case Dv:case Fv:return i;default:switch(i=i&&i.$$typeof){case Nv:case Bv:case jv:case Vv:case Ov:return i;default:return e}}case Ox:return e}}}function PT(i){return ku(i)===f0}var _4={AsyncMode:Nx,ConcurrentMode:f0,ContextConsumer:Nv,ContextProvider:Ov,Element:zx,ForwardRef:Bv,Fragment:kv,Lazy:jv,Memo:Vv,Portal:Ox,Profiler:zv,StrictMode:Dv,Suspense:Fv,isAsyncMode:function(i){return PT(i)||ku(i)===Nx},isConcurrentMode:PT,isContextConsumer:function(i){return ku(i)===Nv},isContextProvider:function(i){return ku(i)===Ov},isElement:function(i){return typeof i=="object"&&i!==null&&i.$$typeof===zx},isForwardRef:function(i){return ku(i)===Bv},isFragment:function(i){return ku(i)===kv},isLazy:function(i){return ku(i)===jv},isMemo:function(i){return ku(i)===Vv},isPortal:function(i){return ku(i)===Ox},isProfiler:function(i){return ku(i)===zv},isStrictMode:function(i){return ku(i)===Dv},isSuspense:function(i){return ku(i)===Fv},isValidElementType:function(i){return typeof i=="string"||typeof i=="function"||i===kv||i===f0||i===zv||i===Dv||i===Fv||i===d4||typeof i=="object"&&i!==null&&(i.$$typeof===jv||i.$$typeof===Vv||i.$$typeof===Ov||i.$$typeof===Nv||i.$$typeof===Bv||i.$$typeof===p4||i.$$typeof===m4||i.$$typeof===g4||i.$$typeof===f4)},typeOf:ku},Ur=RC((function(i,e){})),RT=(Ur.AsyncMode,Ur.ConcurrentMode,Ur.ContextConsumer,Ur.ContextProvider,Ur.Element,Ur.ForwardRef,Ur.Fragment,Ur.Lazy,Ur.Memo,Ur.Portal,Ur.Profiler,Ur.StrictMode,Ur.Suspense,Ur.isAsyncMode,Ur.isConcurrentMode,Ur.isContextConsumer,Ur.isContextProvider,Ur.isElement,Ur.isForwardRef,Ur.isFragment,Ur.isLazy,Ur.isMemo,Ur.isPortal,Ur.isProfiler,Ur.isStrictMode,Ur.isSuspense,Ur.isValidElementType,Ur.typeOf,RC((function(i){i.exports=_4}))),y4={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},LT={};LT[RT.ForwardRef]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},LT[RT.Memo]=y4;const kT=()=>{const[i,e]=wt.useState(1),[n,o]=wt.useState({userID:"",campus:"",location:"",specificLocation:"",offenseTypes:[],time:"",additionalInfo:""}),[d,g]=wt.useState(!1),[_,c]=wt.useState(""),[M,k]=wt.useState([]),[j,G]=wt.useState(""),[ee,Y]=wt.useState(""),[xe,be]=wt.useState([]),Ne=wt.useRef(null),{executeRecaptcha:tt}=h4(),Je=4;var[qe,He]=wt.useState(Object.values(CT["Notre-Dame"]));const Ue=Tt=>{const{name:zt,value:Bt}=Tt.target;if(console.log("Input Change ",zt,Bt),zt==="campus")(Bt=="Notre-Dame"||Bt=="Saint-Marys"||Bt=="Holy-Cross")&&He(CT[Bt]),o(ke=>({...ke,campus:Bt,location:"",specificLocation:""})),be([]);else if(zt==="location"){const ke=qe[Bt];be(ke.map(vt=>vt.name)),o(vt=>({...vt,[zt]:Bt,specificLocation:""}))}else o(ke=>({...ke,[zt]:Bt}))},Be=Tt=>{const{value:zt}=Tt.target;o(Bt=>({...Bt,offenseTypes:[zt]}))},de=()=>{if(i===1){if(!n.location)return alert("Please select where you felt unsafe."),!1}else if(i===2){if(n.offenseTypes.length===0)return alert("Please select at least one type of offense."),!1}else if(i===3&&!n.time)return alert("Please select when this occurred."),!1;return!0},ce=Tt=>{if(Tt>0&&!de())return;const zt=i+Tt;zt>=1&&zt<=Je&&e(zt)},_e=async Tt=>{Tt.preventDefault(),de()&&(g(!0),setTimeout(async()=>{const zt=await $t();if(zt==="Error"){alert("There was an error submitting your report. Please try again later.");return}c(zt),e(5),g(!1)},2e3))},Ae=Tt=>Tt.replace(/-/g," ").replace(/\b\w/g,zt=>zt.toUpperCase()),Pe=Tt=>Tt.replace(/-/g," ").replace(/\b\w/g,zt=>zt.toUpperCase()),Ge=Tt=>{const zt=Tt.replace(/[^a-zA-Z0-9]/g,"");if(!zt||!xe||xe.length===0)return[];const Bt=zt.toLowerCase();return xe.filter(vt=>vt.toLowerCase().replace(/[^a-z0-9]/g,"").includes(Bt.replace(/[^a-z0-9]/g,"")))},Re={"uncomfortable-situation":"Uncomfortable Situation","sexual-misconduct":"Sexual Misconduct","physical-aggression":"Physical Aggression","verbal-aggression":"Verbal Aggression",discrimination:"Discrimination"},In=()=>Ee.jsxs("div",{id:"report-summary",style:{background:"rgba(216, 47, 37, 0.05)",padding:"1.5rem",borderRadius:"10px",marginBottom:"2rem"},children:[Ee.jsxs("div",{style:{marginBottom:"1rem"},children:[Ee.jsx("strong",{children:"Campus:"})," ",Ae(n.campus),n.campus&&` (${n.campus})`]}),Ee.jsxs("div",{style:{marginBottom:"1rem"},children:[Ee.jsx("strong",{children:"Location:"})," ",Ae(n.location),n.specificLocation&&` (${n.specificLocation})`]}),Ee.jsxs("div",{style:{marginBottom:"1rem"},children:[Ee.jsx("strong",{children:"Incident Types:"})," ",n.offenseTypes.map(Tt=>Re[Tt]).join(", ")]}),Ee.jsxs("div",{style:{marginBottom:"1rem"},children:[Ee.jsx("strong",{children:"When:"})," ",Pe(n.time)]}),n.additionalInfo.trim()&&Ee.jsxs("div",{children:[Ee.jsx("strong",{children:"Additional Information:"})," ",n.additionalInfo.substring(0,200),n.additionalInfo.length>200?"...":""]})]}),Jn=Tt=>{Ue(Tt);const zt=Tt.target.value.trim();Y(zt);const Bt=Ge(zt);if(k(Bt),Bt.length>0){const ke=Bt[0].trim(),vt=zt.toLowerCase();ke.toLowerCase().startsWith(vt)&&vt.length>0?(console.log(zt+ke.substring(zt.length)),G(ke.substring(zt.length))):G("")}else G("")},mt=Tt=>{if((Tt.key==="Enter"||Tt.key==="Tab")&&j){Tt.preventDefault();const zt=n.specificLocation+j;console.log(zt),Ue({target:{name:"specificLocation",value:zt}}),G(""),k([])}};async function $t(){if(!tt)return console.warn("reCAPTCHA execution not ready yet."),"Error";const Tt=await tt("submit_report"),zt=await XD(VA(PC,"reports"),{...n,recaptchaToken:Tt,action:"submit_report",Time:dT(),createdAt:dT()});return console.log("Document written with ID: ",zt.id),zt.id}return Ee.jsxs(Ee.Fragment,{children:[Ee.jsx(uE,{}),Ee.jsx("div",{children:Ee.jsxs("div",{className:"report-container",children:[Ee.jsxs("div",{className:"report-header",children:[Ee.jsxs("h1",{children:["Anonymous ",Ee.jsx("span",{className:"highlight",children:"Report"})]}),Ee.jsx("p",{children:"What you went through is not acceptable. Help us make campus safer by sharing as much information you feel comfortable sharing. After, We will show you the different paths you can take based on your current comfort level."})]}),Ee.jsxs("div",{className:"security-notice",children:[Ee.jsx("h3",{children:"Your Privacy is Protected"}),Ee.jsxs("p",{children:["No identifying information is collected or stored. All fields are optional, the more information you provide the better we can assist you. No names will be requested from any party, and we cannot provide legal action."," ",Ee.jsx("b",{children:"If you feel ready to pursue legal action, please contact campus security or local authorities."})]})]}),Ee.jsxs("div",{className:"report-form",children:[Ee.jsxs("div",{className:"form-progress",children:[Ee.jsxs("div",{className:`progress-step ${i===1?"active":""}`,children:[Ee.jsx("div",{className:"step-circle",children:"1"}),Ee.jsx("span",{children:"Location"})]}),Ee.jsxs("div",{className:`progress-step ${i===2?"active":""}`,children:[Ee.jsx("div",{className:"step-circle",children:"2"}),Ee.jsx("span",{children:"Incident"})]}),Ee.jsxs("div",{className:`progress-step ${i===3?"active":""}`,children:[Ee.jsx("div",{className:"step-circle",children:"3"}),Ee.jsx("span",{children:"Details"})]}),Ee.jsxs("div",{className:`progress-step ${i===4?"active":""}`,children:[Ee.jsx("div",{className:"step-circle",children:"4"}),Ee.jsx("span",{children:"Submit"})]})]}),Ee.jsxs("form",{onSubmit:_e,children:[Ee.jsxs("div",{className:`form-section ${i===1?"active":""}`,children:[Ee.jsxs("div",{className:"form-group",children:[Ee.jsx("label",{htmlFor:"campus",children:"Where did you feel unsafe? *"}),Ee.jsx("div",{className:"label-description",children:"Select the campus where the incident occurred"}),Ee.jsxs("select",{id:"campus",name:"campus",value:n.campus,onChange:Ue,required:!0,children:[Ee.jsx("option",{value:"",children:"Choose a campus"}),Ee.jsx("option",{value:"Notre-Dame",children:"Notre Dame"}),Ee.jsx("option",{value:"Saint-Marys",children:"Saint Mary's College"}),Ee.jsx("option",{value:"Holy-Cross",children:"Holy Cross College"})]})]}),Ee.jsxs("div",{className:"form-group",children:[Ee.jsx("label",{htmlFor:"location",children:"Where did you feel unsafe? *"}),Ee.jsx("div",{className:"label-description",children:"What type of building was it?"}),Ee.jsxs("select",{id:"location",name:"location",value:n.location,onChange:Ue,required:!0,children:[Ee.jsx("option",{value:"",children:"Choose a location"}),Object.keys(qe).map(Tt=>Ee.jsx("option",{value:Tt,children:Tt.replace(/-/g," ").replace(/\b\w/g,zt=>zt.toUpperCase())},Tt))]})]}),Ee.jsxs("div",{className:"form-group",children:[Ee.jsx("label",{htmlFor:"specificLocation",children:"Specific Location (Optional)"}),Ee.jsx("div",{className:"label-description",children:"How is the building called?"}),Ee.jsxs("div",{style:{position:"relative",display:"inline-block"},children:[Ee.jsx("input",{className:"form-select",ref:Ne,type:"text",id:"specificLocation",name:"specificLocation",value:n.specificLocation,onChange:Jn,onKeyDown:mt,placeholder:"e.g., Main Library, 2nd floor",autoComplete:"off"}),Ee.jsx("span",{style:{position:"absolute",left:`${ee.length*10+18}px `,top:"50%",transform:"translateY(-50%)",opacity:.5,pointerEvents:"none",userSelect:"none",color:"#666"},children:j})]})]})]}),Ee.jsx("div",{className:`form-section ${i===2?"active":""}`,children:Ee.jsxs("div",{className:"form-group",children:[Ee.jsx("label",{children:"What type of offense would you group it as? *"}),Ee.jsx("div",{className:"label-description",children:"Select all that apply to your experience"}),Ee.jsxs("div",{className:"radio-group",children:[Ee.jsxs("label",{className:"radio-item",children:[Ee.jsx("input",{type:"radio",name:"offense-type",value:"uncomfortable-situation",checked:n.offenseTypes.includes("uncomfortable-situation"),onChange:Be}),Ee.jsxs("div",{className:"radio-content",children:[Ee.jsx("strong",{children:"Uncomfortable Situation"}),Ee.jsx("small",{children:"Situations that made you feel uneasy or uncomfortable"})]})]}),Ee.jsxs("label",{className:"radio-item",children:[Ee.jsx("input",{type:"radio",name:"offense-type",value:"sexual-misconduct",checked:n.offenseTypes.includes("sexual-misconduct"),onChange:Be}),Ee.jsxs("div",{className:"radio-content",children:[Ee.jsx("strong",{children:"Sexual Misconduct"}),Ee.jsx("small",{children:"Physical contact without permission"})]})]}),Ee.jsxs("label",{className:"radio-item",children:[Ee.jsx("input",{type:"radio",name:"offense-type",value:"physical-aggression",checked:n.offenseTypes.includes("physical-aggression"),onChange:Be}),Ee.jsxs("div",{className:"radio-content",children:[Ee.jsx("strong",{children:"Physical Aggression"}),Ee.jsx("small",{children:"Physical violence or threat of violence"})]})]}),Ee.jsxs("label",{className:"radio-item",children:[Ee.jsx("input",{type:"radio",name:"offense-type",value:"verbal-aggression",checked:n.offenseTypes.includes("verbal-aggression"),onChange:Be}),Ee.jsxs("div",{className:"radio-content",children:[Ee.jsx("strong",{children:"Verbal Aggression"}),Ee.jsx("small",{children:"Threatening, hostile, or abusive language"})]})]}),Ee.jsxs("label",{className:"radio-item",children:[Ee.jsx("input",{type:"radio",name:"offense-type",value:"discrimination",checked:n.offenseTypes.includes("discrimination"),onChange:Be}),Ee.jsxs("div",{className:"radio-content",children:[Ee.jsx("strong",{children:"Discrimination"}),Ee.jsx("small",{children:"Treatment based on identity, race, gender, religion, etc."})]})]})]})]})}),Ee.jsxs("div",{className:`form-section ${i===3?"active":""}`,children:[Ee.jsxs("div",{className:"form-group",children:[Ee.jsx("label",{htmlFor:"time",children:"When did this occur? *"}),Ee.jsxs("select",{id:"time",name:"time",value:n.time,onChange:Ue,required:!0,children:[Ee.jsx("option",{value:"",children:"Select timeframe"}),Ee.jsx("option",{value:"within-24-hours",children:"Within the last 24 hours"}),Ee.jsx("option",{value:"within-week",children:"Within the last week"}),Ee.jsx("option",{value:"within-month",children:"Within the last month"}),Ee.jsx("option",{value:"longer-ago",children:"Longer ago"})]})]}),Ee.jsxs("div",{className:"form-group",children:[Ee.jsx("label",{htmlFor:"additionalInfo",children:"Additional Information (Optional)"}),Ee.jsx("div",{className:"label-description",children:"Anything else you'd like to share"}),Ee.jsx("textarea",{id:"additionalInfo",name:"additionalInfo",value:n.additionalInfo,onChange:Ue,placeholder:"Any additional context, concerns, or information you'd like to provide"})]})]}),Ee.jsx("div",{className:`form-section ${i===4?"active":""}`,children:Ee.jsxs("div",{id:"review-content",children:[Ee.jsx("h3",{style:{color:"#113052",marginBottom:"1rem"},children:"Review Your Report"}),Ee.jsx("p",{style:{marginBottom:"2rem",opacity:.8},children:"Please review the information below before submitting your anonymous report."}),In(),Ee.jsxs("div",{className:"security-notice",style:{marginBottom:0},children:[Ee.jsx("h3",{children:"Final Privacy Reminder"}),Ee.jsx("p",{children:"Once submitted, this report cannot be traced back to you. Your anonymity is guaranteed."})]})]})}),i===5&&Ee.jsxs("div",{className:"success-message",children:[Ee.jsx("div",{className:"success-icon",children:""}),Ee.jsx("h2",{children:"Report Submitted Successfully"}),Ee.jsx("p",{children:"Thank you for sharing your experience. Your voice contributes to making our campus community safer for everyone."}),Ee.jsxs("p",{children:[Ee.jsx("strong",{children:"Report ID:"})," ",_]}),Ee.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>window.close(),children:"Return to Home"})]}),i<5&&Ee.jsxs("div",{className:"form-navigation",children:[Ee.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>ce(-1),style:{display:i>1?"block":"none"},children:"Previous"}),i<4&&Ee.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>ce(1),children:"Next"}),i===4&&Ee.jsxs("button",{type:"submit",className:"btn btn-primary g-recaptcha",disabled:d,"data-sitekey":"6LeMDQssAAAAAC3prYanNGr6ItRklzJicu190qUc","data-callback":"onSubmit","data-action":"submit",children:[!d&&Ee.jsx("span",{children:"Submit Anonymous Report"}),d&&Ee.jsxs("span",{children:[Ee.jsx("span",{className:"loading"}),"Submitting..."]})]})]})]})]})]})})]})};var v_={exports:{}};/* @preserve
 * Leaflet 1.9.4, a JS library for interactive maps. https://leafletjs.com
 * (c) 2010-2023 Vladimir Agafonkin, (c) 2010-2011 CloudMade
 */var v4=v_.exports,DT;function b4(){return DT||(DT=1,(function(i,e){(function(n,o){o(e)})(v4,(function(n){var o="1.9.4";function d(f){var x,R,V,K;for(R=1,V=arguments.length;R<V;R++){K=arguments[R];for(x in K)f[x]=K[x]}return f}var g=Object.create||(function(){function f(){}return function(x){return f.prototype=x,new f}})();function _(f,x){var R=Array.prototype.slice;if(f.bind)return f.bind.apply(f,R.call(arguments,1));var V=R.call(arguments,2);return function(){return f.apply(x,V.length?V.concat(R.call(arguments)):arguments)}}var c=0;function M(f){return"_leaflet_id"in f||(f._leaflet_id=++c),f._leaflet_id}function k(f,x,R){var V,K,ue,Oe;return Oe=function(){V=!1,K&&(ue.apply(R,K),K=!1)},ue=function(){V?K=arguments:(f.apply(R,arguments),setTimeout(Oe,x),V=!0)},ue}function j(f,x,R){var V=x[1],K=x[0],ue=V-K;return f===V&&R?f:((f-K)%ue+ue)%ue+K}function G(){return!1}function ee(f,x){if(x===!1)return f;var R=Math.pow(10,x===void 0?6:x);return Math.round(f*R)/R}function Y(f){return f.trim?f.trim():f.replace(/^\s+|\s+$/g,"")}function xe(f){return Y(f).split(/\s+/)}function be(f,x){Object.prototype.hasOwnProperty.call(f,"options")||(f.options=f.options?g(f.options):{});for(var R in x)f.options[R]=x[R];return f.options}function Ne(f,x,R){var V=[];for(var K in f)V.push(encodeURIComponent(R?K.toUpperCase():K)+"="+encodeURIComponent(f[K]));return(!x||x.indexOf("?")===-1?"?":"&")+V.join("&")}var tt=/\{ *([\w_ -]+) *\}/g;function Je(f,x){return f.replace(tt,function(R,V){var K=x[V];if(K===void 0)throw new Error("No value provided for variable "+R);return typeof K=="function"&&(K=K(x)),K})}var qe=Array.isArray||function(f){return Object.prototype.toString.call(f)==="[object Array]"};function He(f,x){for(var R=0;R<f.length;R++)if(f[R]===x)return R;return-1}var Ue="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function Be(f){return window["webkit"+f]||window["moz"+f]||window["ms"+f]}var de=0;function ce(f){var x=+new Date,R=Math.max(0,16-(x-de));return de=x+R,window.setTimeout(f,R)}var _e=window.requestAnimationFrame||Be("RequestAnimationFrame")||ce,Ae=window.cancelAnimationFrame||Be("CancelAnimationFrame")||Be("CancelRequestAnimationFrame")||function(f){window.clearTimeout(f)};function Pe(f,x,R){if(R&&_e===ce)f.call(x);else return _e.call(window,_(f,x))}function Ge(f){f&&Ae.call(window,f)}var Re={__proto__:null,extend:d,create:g,bind:_,get lastId(){return c},stamp:M,throttle:k,wrapNum:j,falseFn:G,formatNum:ee,trim:Y,splitWords:xe,setOptions:be,getParamString:Ne,template:Je,isArray:qe,indexOf:He,emptyImageUrl:Ue,requestFn:_e,cancelFn:Ae,requestAnimFrame:Pe,cancelAnimFrame:Ge};function In(){}In.extend=function(f){var x=function(){be(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},R=x.__super__=this.prototype,V=g(R);V.constructor=x,x.prototype=V;for(var K in this)Object.prototype.hasOwnProperty.call(this,K)&&K!=="prototype"&&K!=="__super__"&&(x[K]=this[K]);return f.statics&&d(x,f.statics),f.includes&&(Jn(f.includes),d.apply(null,[V].concat(f.includes))),d(V,f),delete V.statics,delete V.includes,V.options&&(V.options=R.options?g(R.options):{},d(V.options,f.options)),V._initHooks=[],V.callInitHooks=function(){if(!this._initHooksCalled){R.callInitHooks&&R.callInitHooks.call(this),this._initHooksCalled=!0;for(var ue=0,Oe=V._initHooks.length;ue<Oe;ue++)V._initHooks[ue].call(this)}},x},In.include=function(f){var x=this.prototype.options;return d(this.prototype,f),f.options&&(this.prototype.options=x,this.mergeOptions(f.options)),this},In.mergeOptions=function(f){return d(this.prototype.options,f),this},In.addInitHook=function(f){var x=Array.prototype.slice.call(arguments,1),R=typeof f=="function"?f:function(){this[f].apply(this,x)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(R),this};function Jn(f){if(!(typeof L>"u"||!L||!L.Mixin)){f=qe(f)?f:[f];for(var x=0;x<f.length;x++)f[x]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",new Error().stack)}}var mt={on:function(f,x,R){if(typeof f=="object")for(var V in f)this._on(V,f[V],x);else{f=xe(f);for(var K=0,ue=f.length;K<ue;K++)this._on(f[K],x,R)}return this},off:function(f,x,R){if(!arguments.length)delete this._events;else if(typeof f=="object")for(var V in f)this._off(V,f[V],x);else{f=xe(f);for(var K=arguments.length===1,ue=0,Oe=f.length;ue<Oe;ue++)K?this._off(f[ue]):this._off(f[ue],x,R)}return this},_on:function(f,x,R,V){if(typeof x!="function"){console.warn("wrong listener type: "+typeof x);return}if(this._listens(f,x,R)===!1){R===this&&(R=void 0);var K={fn:x,ctx:R};V&&(K.once=!0),this._events=this._events||{},this._events[f]=this._events[f]||[],this._events[f].push(K)}},_off:function(f,x,R){var V,K,ue;if(this._events&&(V=this._events[f],!!V)){if(arguments.length===1){if(this._firingCount)for(K=0,ue=V.length;K<ue;K++)V[K].fn=G;delete this._events[f];return}if(typeof x!="function"){console.warn("wrong listener type: "+typeof x);return}var Oe=this._listens(f,x,R);if(Oe!==!1){var nt=V[Oe];this._firingCount&&(nt.fn=G,this._events[f]=V=V.slice()),V.splice(Oe,1)}}},fire:function(f,x,R){if(!this.listens(f,R))return this;var V=d({},x,{type:f,target:this,sourceTarget:x&&x.sourceTarget||this});if(this._events){var K=this._events[f];if(K){this._firingCount=this._firingCount+1||1;for(var ue=0,Oe=K.length;ue<Oe;ue++){var nt=K[ue],ut=nt.fn;nt.once&&this.off(f,ut,nt.ctx),ut.call(nt.ctx||this,V)}this._firingCount--}}return R&&this._propagateEvent(V),this},listens:function(f,x,R,V){typeof f!="string"&&console.warn('"string" type argument expected');var K=x;typeof x!="function"&&(V=!!x,K=void 0,R=void 0);var ue=this._events&&this._events[f];if(ue&&ue.length&&this._listens(f,K,R)!==!1)return!0;if(V){for(var Oe in this._eventParents)if(this._eventParents[Oe].listens(f,x,R,V))return!0}return!1},_listens:function(f,x,R){if(!this._events)return!1;var V=this._events[f]||[];if(!x)return!!V.length;R===this&&(R=void 0);for(var K=0,ue=V.length;K<ue;K++)if(V[K].fn===x&&V[K].ctx===R)return K;return!1},once:function(f,x,R){if(typeof f=="object")for(var V in f)this._on(V,f[V],x,!0);else{f=xe(f);for(var K=0,ue=f.length;K<ue;K++)this._on(f[K],x,R,!0)}return this},addEventParent:function(f){return this._eventParents=this._eventParents||{},this._eventParents[M(f)]=f,this},removeEventParent:function(f){return this._eventParents&&delete this._eventParents[M(f)],this},_propagateEvent:function(f){for(var x in this._eventParents)this._eventParents[x].fire(f.type,d({layer:f.target,propagatedFrom:f.target},f),!0)}};mt.addEventListener=mt.on,mt.removeEventListener=mt.clearAllEventListeners=mt.off,mt.addOneTimeEventListener=mt.once,mt.fireEvent=mt.fire,mt.hasEventListeners=mt.listens;var $t=In.extend(mt);function Tt(f,x,R){this.x=R?Math.round(f):f,this.y=R?Math.round(x):x}var zt=Math.trunc||function(f){return f>0?Math.floor(f):Math.ceil(f)};Tt.prototype={clone:function(){return new Tt(this.x,this.y)},add:function(f){return this.clone()._add(Bt(f))},_add:function(f){return this.x+=f.x,this.y+=f.y,this},subtract:function(f){return this.clone()._subtract(Bt(f))},_subtract:function(f){return this.x-=f.x,this.y-=f.y,this},divideBy:function(f){return this.clone()._divideBy(f)},_divideBy:function(f){return this.x/=f,this.y/=f,this},multiplyBy:function(f){return this.clone()._multiplyBy(f)},_multiplyBy:function(f){return this.x*=f,this.y*=f,this},scaleBy:function(f){return new Tt(this.x*f.x,this.y*f.y)},unscaleBy:function(f){return new Tt(this.x/f.x,this.y/f.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=zt(this.x),this.y=zt(this.y),this},distanceTo:function(f){f=Bt(f);var x=f.x-this.x,R=f.y-this.y;return Math.sqrt(x*x+R*R)},equals:function(f){return f=Bt(f),f.x===this.x&&f.y===this.y},contains:function(f){return f=Bt(f),Math.abs(f.x)<=Math.abs(this.x)&&Math.abs(f.y)<=Math.abs(this.y)},toString:function(){return"Point("+ee(this.x)+", "+ee(this.y)+")"}};function Bt(f,x,R){return f instanceof Tt?f:qe(f)?new Tt(f[0],f[1]):f==null?f:typeof f=="object"&&"x"in f&&"y"in f?new Tt(f.x,f.y):new Tt(f,x,R)}function ke(f,x){if(f)for(var R=x?[f,x]:f,V=0,K=R.length;V<K;V++)this.extend(R[V])}ke.prototype={extend:function(f){var x,R;if(!f)return this;if(f instanceof Tt||typeof f[0]=="number"||"x"in f)x=R=Bt(f);else if(f=vt(f),x=f.min,R=f.max,!x||!R)return this;return!this.min&&!this.max?(this.min=x.clone(),this.max=R.clone()):(this.min.x=Math.min(x.x,this.min.x),this.max.x=Math.max(R.x,this.max.x),this.min.y=Math.min(x.y,this.min.y),this.max.y=Math.max(R.y,this.max.y)),this},getCenter:function(f){return Bt((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,f)},getBottomLeft:function(){return Bt(this.min.x,this.max.y)},getTopRight:function(){return Bt(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(f){var x,R;return typeof f[0]=="number"||f instanceof Tt?f=Bt(f):f=vt(f),f instanceof ke?(x=f.min,R=f.max):x=R=f,x.x>=this.min.x&&R.x<=this.max.x&&x.y>=this.min.y&&R.y<=this.max.y},intersects:function(f){f=vt(f);var x=this.min,R=this.max,V=f.min,K=f.max,ue=K.x>=x.x&&V.x<=R.x,Oe=K.y>=x.y&&V.y<=R.y;return ue&&Oe},overlaps:function(f){f=vt(f);var x=this.min,R=this.max,V=f.min,K=f.max,ue=K.x>x.x&&V.x<R.x,Oe=K.y>x.y&&V.y<R.y;return ue&&Oe},isValid:function(){return!!(this.min&&this.max)},pad:function(f){var x=this.min,R=this.max,V=Math.abs(x.x-R.x)*f,K=Math.abs(x.y-R.y)*f;return vt(Bt(x.x-V,x.y-K),Bt(R.x+V,R.y+K))},equals:function(f){return f?(f=vt(f),this.min.equals(f.getTopLeft())&&this.max.equals(f.getBottomRight())):!1}};function vt(f,x){return!f||f instanceof ke?f:new ke(f,x)}function Ot(f,x){if(f)for(var R=x?[f,x]:f,V=0,K=R.length;V<K;V++)this.extend(R[V])}Ot.prototype={extend:function(f){var x=this._southWest,R=this._northEast,V,K;if(f instanceof Jt)V=f,K=f;else if(f instanceof Ot){if(V=f._southWest,K=f._northEast,!V||!K)return this}else return f?this.extend(Xt(f)||jt(f)):this;return!x&&!R?(this._southWest=new Jt(V.lat,V.lng),this._northEast=new Jt(K.lat,K.lng)):(x.lat=Math.min(V.lat,x.lat),x.lng=Math.min(V.lng,x.lng),R.lat=Math.max(K.lat,R.lat),R.lng=Math.max(K.lng,R.lng)),this},pad:function(f){var x=this._southWest,R=this._northEast,V=Math.abs(x.lat-R.lat)*f,K=Math.abs(x.lng-R.lng)*f;return new Ot(new Jt(x.lat-V,x.lng-K),new Jt(R.lat+V,R.lng+K))},getCenter:function(){return new Jt((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new Jt(this.getNorth(),this.getWest())},getSouthEast:function(){return new Jt(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(f){typeof f[0]=="number"||f instanceof Jt||"lat"in f?f=Xt(f):f=jt(f);var x=this._southWest,R=this._northEast,V,K;return f instanceof Ot?(V=f.getSouthWest(),K=f.getNorthEast()):V=K=f,V.lat>=x.lat&&K.lat<=R.lat&&V.lng>=x.lng&&K.lng<=R.lng},intersects:function(f){f=jt(f);var x=this._southWest,R=this._northEast,V=f.getSouthWest(),K=f.getNorthEast(),ue=K.lat>=x.lat&&V.lat<=R.lat,Oe=K.lng>=x.lng&&V.lng<=R.lng;return ue&&Oe},overlaps:function(f){f=jt(f);var x=this._southWest,R=this._northEast,V=f.getSouthWest(),K=f.getNorthEast(),ue=K.lat>x.lat&&V.lat<R.lat,Oe=K.lng>x.lng&&V.lng<R.lng;return ue&&Oe},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(f,x){return f?(f=jt(f),this._southWest.equals(f.getSouthWest(),x)&&this._northEast.equals(f.getNorthEast(),x)):!1},isValid:function(){return!!(this._southWest&&this._northEast)}};function jt(f,x){return f instanceof Ot?f:new Ot(f,x)}function Jt(f,x,R){if(isNaN(f)||isNaN(x))throw new Error("Invalid LatLng object: ("+f+", "+x+")");this.lat=+f,this.lng=+x,R!==void 0&&(this.alt=+R)}Jt.prototype={equals:function(f,x){if(!f)return!1;f=Xt(f);var R=Math.max(Math.abs(this.lat-f.lat),Math.abs(this.lng-f.lng));return R<=(x===void 0?1e-9:x)},toString:function(f){return"LatLng("+ee(this.lat,f)+", "+ee(this.lng,f)+")"},distanceTo:function(f){return si.distance(this,Xt(f))},wrap:function(){return si.wrapLatLng(this)},toBounds:function(f){var x=180*f/40075017,R=x/Math.cos(Math.PI/180*this.lat);return jt([this.lat-x,this.lng-R],[this.lat+x,this.lng+R])},clone:function(){return new Jt(this.lat,this.lng,this.alt)}};function Xt(f,x,R){return f instanceof Jt?f:qe(f)&&typeof f[0]!="object"?f.length===3?new Jt(f[0],f[1],f[2]):f.length===2?new Jt(f[0],f[1]):null:f==null?f:typeof f=="object"&&"lat"in f?new Jt(f.lat,"lng"in f?f.lng:f.lon,f.alt):x===void 0?null:new Jt(f,x,R)}var Fn={latLngToPoint:function(f,x){var R=this.projection.project(f),V=this.scale(x);return this.transformation._transform(R,V)},pointToLatLng:function(f,x){var R=this.scale(x),V=this.transformation.untransform(f,R);return this.projection.unproject(V)},project:function(f){return this.projection.project(f)},unproject:function(f){return this.projection.unproject(f)},scale:function(f){return 256*Math.pow(2,f)},zoom:function(f){return Math.log(f/256)/Math.LN2},getProjectedBounds:function(f){if(this.infinite)return null;var x=this.projection.bounds,R=this.scale(f),V=this.transformation.transform(x.min,R),K=this.transformation.transform(x.max,R);return new ke(V,K)},infinite:!1,wrapLatLng:function(f){var x=this.wrapLng?j(f.lng,this.wrapLng,!0):f.lng,R=this.wrapLat?j(f.lat,this.wrapLat,!0):f.lat,V=f.alt;return new Jt(R,x,V)},wrapLatLngBounds:function(f){var x=f.getCenter(),R=this.wrapLatLng(x),V=x.lat-R.lat,K=x.lng-R.lng;if(V===0&&K===0)return f;var ue=f.getSouthWest(),Oe=f.getNorthEast(),nt=new Jt(ue.lat-V,ue.lng-K),ut=new Jt(Oe.lat-V,Oe.lng-K);return new Ot(nt,ut)}},si=d({},Fn,{wrapLng:[-180,180],R:6371e3,distance:function(f,x){var R=Math.PI/180,V=f.lat*R,K=x.lat*R,ue=Math.sin((x.lat-f.lat)*R/2),Oe=Math.sin((x.lng-f.lng)*R/2),nt=ue*ue+Math.cos(V)*Math.cos(K)*Oe*Oe,ut=2*Math.atan2(Math.sqrt(nt),Math.sqrt(1-nt));return this.R*ut}}),di=6378137,ds={R:di,MAX_LATITUDE:85.0511287798,project:function(f){var x=Math.PI/180,R=this.MAX_LATITUDE,V=Math.max(Math.min(R,f.lat),-R),K=Math.sin(V*x);return new Tt(this.R*f.lng*x,this.R*Math.log((1+K)/(1-K))/2)},unproject:function(f){var x=180/Math.PI;return new Jt((2*Math.atan(Math.exp(f.y/this.R))-Math.PI/2)*x,f.x*x/this.R)},bounds:(function(){var f=di*Math.PI;return new ke([-f,-f],[f,f])})()};function Ns(f,x,R,V){if(qe(f)){this._a=f[0],this._b=f[1],this._c=f[2],this._d=f[3];return}this._a=f,this._b=x,this._c=R,this._d=V}Ns.prototype={transform:function(f,x){return this._transform(f.clone(),x)},_transform:function(f,x){return x=x||1,f.x=x*(this._a*f.x+this._b),f.y=x*(this._c*f.y+this._d),f},untransform:function(f,x){return x=x||1,new Tt((f.x/x-this._b)/this._a,(f.y/x-this._d)/this._c)}};function kr(f,x,R,V){return new Ns(f,x,R,V)}var Ni=d({},si,{code:"EPSG:3857",projection:ds,transformation:(function(){var f=.5/(Math.PI*ds.R);return kr(f,.5,-f,.5)})()}),Ii=d({},Ni,{code:"EPSG:900913"});function Va(f){return document.createElementNS("http://www.w3.org/2000/svg",f)}function Ta(f,x){var R="",V,K,ue,Oe,nt,ut;for(V=0,ue=f.length;V<ue;V++){for(nt=f[V],K=0,Oe=nt.length;K<Oe;K++)ut=nt[K],R+=(K?"L":"M")+ut.x+" "+ut.y;R+=x?en.svg?"z":"x":""}return R||"M0 0"}var Bs=document.documentElement.style,Sa="ActiveXObject"in window,Bi=Sa&&!document.addEventListener,fr="msLaunchUri"in navigator&&!("documentMode"in document),Ea=Pt("webkit"),So=Pt("android"),so=Pt("android 2")||Pt("android 3"),$r=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),fs=So&&Pt("Google")&&$r<537&&!("AudioNode"in window),ps=!!window.opera,Fs=!fr&&Pt("chrome"),ms=Pt("gecko")&&!Ea&&!ps&&!Sa,Ke=!Fs&&Pt("safari"),se=Pt("phantom"),le="OTransition"in Bs,fe=navigator.platform.indexOf("Win")===0,Se=Sa&&"transition"in Bs,De="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!so,Ze="MozPerspective"in Bs,et=!window.L_DISABLE_3D&&(Se||De||Ze)&&!le&&!se,Xe=typeof orientation<"u"||Pt("mobile"),_t=Xe&&Ea,It=Xe&&De,xt=!window.PointerEvent&&window.MSPointerEvent,tn=!!(window.PointerEvent||xt),$e="ontouchstart"in window||!!window.TouchEvent,vn=!window.L_NO_TOUCH&&($e||tn),Rn=Xe&&ps,nn=Xe&&ms,Nn=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,Pi=(function(){var f=!1;try{var x=Object.defineProperty({},"passive",{get:function(){f=!0}});window.addEventListener("testPassiveEventSupport",G,x),window.removeEventListener("testPassiveEventSupport",G,x)}catch{}return f})(),$i=(function(){return!!document.createElement("canvas").getContext})(),er=!!(document.createElementNS&&Va("svg").createSVGRect),Cr=!!er&&(function(){var f=document.createElement("div");return f.innerHTML="<svg/>",(f.firstChild&&f.firstChild.namespaceURI)==="http://www.w3.org/2000/svg"})(),Vn=!er&&(function(){try{var f=document.createElement("div");f.innerHTML='<v:shape adj="1"/>';var x=f.firstChild;return x.style.behavior="url(#default#VML)",x&&typeof x.adj=="object"}catch{return!1}})(),Kn=navigator.platform.indexOf("Mac")===0,vr=navigator.platform.indexOf("Linux")===0;function Pt(f){return navigator.userAgent.toLowerCase().indexOf(f)>=0}var en={ie:Sa,ielt9:Bi,edge:fr,webkit:Ea,android:So,android23:so,androidStock:fs,opera:ps,chrome:Fs,gecko:ms,safari:Ke,phantom:se,opera12:le,win:fe,ie3d:Se,webkit3d:De,gecko3d:Ze,any3d:et,mobile:Xe,mobileWebkit:_t,mobileWebkit3d:It,msPointer:xt,pointer:tn,touch:vn,touchNative:$e,mobileOpera:Rn,mobileGecko:nn,retina:Nn,passiveEvents:Pi,canvas:$i,svg:er,vml:Vn,inlineSvg:Cr,mac:Kn,linux:vr},tr=en.msPointer?"MSPointerDown":"pointerdown",ta=en.msPointer?"MSPointerMove":"pointermove",Aa=en.msPointer?"MSPointerUp":"pointerup",Lt=en.msPointer?"MSPointerCancel":"pointercancel",yn={touchstart:tr,touchmove:ta,touchend:Aa,touchcancel:Lt},Mn={touchstart:Si,touchmove:Gr,touchend:Gr,touchcancel:Gr},nr={},il=!1;function Eo(f,x,R){return x==="touchstart"&&qr(),Mn[x]?(R=Mn[x].bind(this,R),f.addEventListener(yn[x],R,!1),R):(console.warn("wrong event specified:",x),G)}function Bn(f,x,R){if(!yn[x]){console.warn("wrong event specified:",x);return}f.removeEventListener(yn[x],R,!1)}function Vs(f){nr[f.pointerId]=f}function js(f){nr[f.pointerId]&&(nr[f.pointerId]=f)}function gs(f){delete nr[f.pointerId]}function qr(){il||(document.addEventListener(tr,Vs,!0),document.addEventListener(ta,js,!0),document.addEventListener(Aa,gs,!0),document.addEventListener(Lt,gs,!0),il=!0)}function Gr(f,x){if(x.pointerType!==(x.MSPOINTER_TYPE_MOUSE||"mouse")){x.touches=[];for(var R in nr)x.touches.push(nr[R]);x.changedTouches=[x],f(x)}}function Si(f,x){x.MSPOINTER_TYPE_TOUCH&&x.pointerType===x.MSPOINTER_TYPE_TOUCH&&sn(x),Gr(f,x)}function Mr(f){var x={},R,V;for(V in f)R=f[V],x[V]=R&&R.bind?R.bind(f):R;return f=x,x.type="dblclick",x.detail=2,x.isTrusted=!1,x._simulated=!0,x}var da=200;function xi(f,x){f.addEventListener("dblclick",x);var R=0,V;function K(ue){if(ue.detail!==1){V=ue.detail;return}if(!(ue.pointerType==="mouse"||ue.sourceCapabilities&&!ue.sourceCapabilities.firesTouchEvents)){var Oe=$n(ue);if(!(Oe.some(function(ut){return ut instanceof HTMLLabelElement&&ut.attributes.for})&&!Oe.some(function(ut){return ut instanceof HTMLInputElement||ut instanceof HTMLSelectElement}))){var nt=Date.now();nt-R<=da?(V++,V===2&&x(Mr(ue))):V=1,R=nt}}}return f.addEventListener("click",K),{dblclick:x,simDblclick:K}}function Ao(f,x){f.removeEventListener("dblclick",x.dblclick),f.removeEventListener("click",x.simDblclick)}var ja=Rl(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),Co=Rl(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),Us=Co==="webkitTransition"||Co==="OTransition"?Co+"End":"transitionend";function $s(f){return typeof f=="string"?document.getElementById(f):f}function rl(f,x){var R=f.style[x]||f.currentStyle&&f.currentStyle[x];if((!R||R==="auto")&&document.defaultView){var V=document.defaultView.getComputedStyle(f,null);R=V?V[x]:null}return R==="auto"?null:R}function ni(f,x,R){var V=document.createElement(f);return V.className=x||"",R&&R.appendChild(V),V}function ci(f){var x=f.parentNode;x&&x.removeChild(f)}function qi(f){for(;f.firstChild;)f.removeChild(f.firstChild)}function br(f){var x=f.parentNode;x&&x.lastChild!==f&&x.appendChild(f)}function qs(f){var x=f.parentNode;x&&x.firstChild!==f&&x.insertBefore(f,x.firstChild)}function cu(f,x){if(f.classList!==void 0)return f.classList.contains(x);var R=oo(f);return R.length>0&&new RegExp("(^|\\s)"+x+"(\\s|$)").test(R)}function on(f,x){if(f.classList!==void 0)for(var R=xe(x),V=0,K=R.length;V<K;V++)f.classList.add(R[V]);else if(!cu(f,x)){var ue=oo(f);Ca(f,(ue?ue+" ":"")+x)}}function Fi(f,x){f.classList!==void 0?f.classList.remove(x):Ca(f,Y((" "+oo(f)+" ").replace(" "+x+" "," ")))}function Ca(f,x){f.className.baseVal===void 0?f.className=x:f.className.baseVal=x}function oo(f){return f.correspondingElement&&(f=f.correspondingElement),f.className.baseVal===void 0?f.className:f.className.baseVal}function ir(f,x){"opacity"in f.style?f.style.opacity=x:"filter"in f.style&&Mo(f,x)}function Mo(f,x){var R=!1,V="DXImageTransform.Microsoft.Alpha";try{R=f.filters.item(V)}catch{if(x===1)return}x=Math.round(x*100),R?(R.Enabled=x!==100,R.Opacity=x):f.style.filter+=" progid:"+V+"(opacity="+x+")"}function Rl(f){for(var x=document.documentElement.style,R=0;R<f.length;R++)if(f[R]in x)return f[R];return!1}function Gs(f,x,R){var V=x||new Tt(0,0);f.style[ja]=(en.ie3d?"translate("+V.x+"px,"+V.y+"px)":"translate3d("+V.x+"px,"+V.y+"px,0)")+(R?" scale("+R+")":"")}function rr(f,x){f._leaflet_pos=x,en.any3d?Gs(f,x):(f.style.left=x.x+"px",f.style.top=x.y+"px")}function Qa(f){return f._leaflet_pos||new Tt(0,0)}var Ua,Gi,jn;if("onselectstart"in document)Ua=function(){hn(window,"selectstart",sn)},Gi=function(){xn(window,"selectstart",sn)};else{var Ja=Rl(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);Ua=function(){if(Ja){var f=document.documentElement.style;jn=f[Ja],f[Ja]="none"}},Gi=function(){Ja&&(document.documentElement.style[Ja]=jn,jn=void 0)}}function _s(){hn(window,"dragstart",sn)}function $a(){xn(window,"dragstart",sn)}var Zs,Ln;function ys(f){for(;f.tabIndex===-1;)f=f.parentNode;f.style&&(Ma(),Zs=f,Ln=f.style.outlineStyle,f.style.outlineStyle="none",hn(window,"keydown",Ma))}function Ma(){Zs&&(Zs.style.outlineStyle=Ln,Zs=void 0,Ln=void 0,xn(window,"keydown",Ma))}function Ll(f){do f=f.parentNode;while((!f.offsetWidth||!f.offsetHeight)&&f!==document.body);return f}function Zi(f){var x=f.getBoundingClientRect();return{x:x.width/f.offsetWidth||1,y:x.height/f.offsetHeight||1,boundingClientRect:x}}var pr={__proto__:null,TRANSFORM:ja,TRANSITION:Co,TRANSITION_END:Us,get:$s,getStyle:rl,create:ni,remove:ci,empty:qi,toFront:br,toBack:qs,hasClass:cu,addClass:on,removeClass:Fi,setClass:Ca,getClass:oo,setOpacity:ir,testProp:Rl,setTransform:Gs,setPosition:rr,getPosition:Qa,get disableTextSelection(){return Ua},get enableTextSelection(){return Gi},disableImageDrag:_s,enableImageDrag:$a,preventOutline:ys,restoreOutline:Ma,getSizedParentNode:Ll,getScale:Zi};function hn(f,x,R,V){if(x&&typeof x=="object")for(var K in x)ur(f,K,x[K],R);else{x=xe(x);for(var ue=0,Oe=x.length;ue<Oe;ue++)ur(f,x[ue],R,V)}return this}var fi="_leaflet_events";function xn(f,x,R,V){if(arguments.length===1)al(f),delete f[fi];else if(x&&typeof x=="object")for(var K in x)xr(f,K,x[K],R);else if(x=xe(x),arguments.length===2)al(f,function(nt){return He(x,nt)!==-1});else for(var ue=0,Oe=x.length;ue<Oe;ue++)xr(f,x[ue],R,V);return this}function al(f,x){for(var R in f[fi]){var V=R.split(/\d/)[0];(!x||x(V))&&xr(f,V,null,null,R)}}var ar={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function ur(f,x,R,V){var K=x+M(R)+(V?"_"+M(V):"");if(f[fi]&&f[fi][K])return this;var ue=function(nt){return R.call(V||f,nt||window.event)},Oe=ue;!en.touchNative&&en.pointer&&x.indexOf("touch")===0?ue=Eo(f,x,ue):en.touch&&x==="dblclick"?ue=xi(f,ue):"addEventListener"in f?x==="touchstart"||x==="touchmove"||x==="wheel"||x==="mousewheel"?f.addEventListener(ar[x]||x,ue,en.passiveEvents?{passive:!1}:!1):x==="mouseenter"||x==="mouseleave"?(ue=function(nt){nt=nt||window.event,vs(f,nt)&&Oe(nt)},f.addEventListener(ar[x],ue,!1)):f.addEventListener(x,Oe,!1):f.attachEvent("on"+x,ue),f[fi]=f[fi]||{},f[fi][K]=ue}function xr(f,x,R,V,K){K=K||x+M(R)+(V?"_"+M(V):"");var ue=f[fi]&&f[fi][K];if(!ue)return this;!en.touchNative&&en.pointer&&x.indexOf("touch")===0?Bn(f,x,ue):en.touch&&x==="dblclick"?Ao(f,ue):"removeEventListener"in f?f.removeEventListener(ar[x]||x,ue,!1):f.detachEvent("on"+x,ue),f[fi][K]=null}function bn(f){return f.stopPropagation?f.stopPropagation():f.originalEvent?f.originalEvent._stopped=!0:f.cancelBubble=!0,this}function fa(f){return ur(f,"wheel",bn),this}function fn(f){return hn(f,"mousedown touchstart dblclick contextmenu",bn),f._leaflet_disable_click=!0,this}function sn(f){return f.preventDefault?f.preventDefault():f.returnValue=!1,this}function na(f){return sn(f),bn(f),this}function $n(f){if(f.composedPath)return f.composedPath();for(var x=[],R=f.target;R;)x.push(R),R=R.parentNode;return x}function Dr(f,x){if(!x)return new Tt(f.clientX,f.clientY);var R=Zi(x),V=R.boundingClientRect;return new Tt((f.clientX-V.left)/R.x-x.clientLeft,(f.clientY-V.top)/R.y-x.clientTop)}var Yr=en.linux&&en.chrome?window.devicePixelRatio:en.mac?window.devicePixelRatio*3:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function sr(f){return en.edge?f.wheelDeltaY/2:f.deltaY&&f.deltaMode===0?-f.deltaY/Yr:f.deltaY&&f.deltaMode===1?-f.deltaY*20:f.deltaY&&f.deltaMode===2?-f.deltaY*60:f.deltaX||f.deltaZ?0:f.wheelDelta?(f.wheelDeltaY||f.wheelDelta)/2:f.detail&&Math.abs(f.detail)<32765?-f.detail*20:f.detail?f.detail/-32765*60:0}function vs(f,x){var R=x.relatedTarget;if(!R)return!0;try{for(;R&&R!==f;)R=R.parentNode}catch{return!1}return R!==f}var lo={__proto__:null,on:hn,off:xn,stopPropagation:bn,disableScrollPropagation:fa,disableClickPropagation:fn,preventDefault:sn,stop:na,getPropagationPath:$n,getMousePosition:Dr,getWheelDelta:sr,isExternalTarget:vs,addListener:hn,removeListener:xn},bs=$t.extend({run:function(f,x,R,V){this.stop(),this._el=f,this._inProgress=!0,this._duration=R||.25,this._easeOutPower=1/Math.max(V||.5,.2),this._startPos=Qa(f),this._offset=x.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=Pe(this._animate,this),this._step()},_step:function(f){var x=+new Date-this._startTime,R=this._duration*1e3;x<R?this._runFrame(this._easeOut(x/R),f):(this._runFrame(1),this._complete())},_runFrame:function(f,x){var R=this._startPos.add(this._offset.multiplyBy(f));x&&R._round(),rr(this._el,R),this.fire("step")},_complete:function(){Ge(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(f){return 1-Math.pow(1-f,this._easeOutPower)}}),Xn=$t.extend({options:{crs:Ni,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(f,x){x=be(this,x),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(f),this._initLayout(),this._onResize=_(this._onResize,this),this._initEvents(),x.maxBounds&&this.setMaxBounds(x.maxBounds),x.zoom!==void 0&&(this._zoom=this._limitZoom(x.zoom)),x.center&&x.zoom!==void 0&&this.setView(Xt(x.center),x.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=Co&&en.any3d&&!en.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),hn(this._proxy,Us,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(f,x,R){if(x=x===void 0?this._zoom:this._limitZoom(x),f=this._limitCenter(Xt(f),x,this.options.maxBounds),R=R||{},this._stop(),this._loaded&&!R.reset&&R!==!0){R.animate!==void 0&&(R.zoom=d({animate:R.animate},R.zoom),R.pan=d({animate:R.animate,duration:R.duration},R.pan));var V=this._zoom!==x?this._tryAnimatedZoom&&this._tryAnimatedZoom(f,x,R.zoom):this._tryAnimatedPan(f,R.pan);if(V)return clearTimeout(this._sizeTimer),this}return this._resetView(f,x,R.pan&&R.pan.noMoveStart),this},setZoom:function(f,x){return this._loaded?this.setView(this.getCenter(),f,{zoom:x}):(this._zoom=f,this)},zoomIn:function(f,x){return f=f||(en.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+f,x)},zoomOut:function(f,x){return f=f||(en.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-f,x)},setZoomAround:function(f,x,R){var V=this.getZoomScale(x),K=this.getSize().divideBy(2),ue=f instanceof Tt?f:this.latLngToContainerPoint(f),Oe=ue.subtract(K).multiplyBy(1-1/V),nt=this.containerPointToLatLng(K.add(Oe));return this.setView(nt,x,{zoom:R})},_getBoundsCenterZoom:function(f,x){x=x||{},f=f.getBounds?f.getBounds():jt(f);var R=Bt(x.paddingTopLeft||x.padding||[0,0]),V=Bt(x.paddingBottomRight||x.padding||[0,0]),K=this.getBoundsZoom(f,!1,R.add(V));if(K=typeof x.maxZoom=="number"?Math.min(x.maxZoom,K):K,K===1/0)return{center:f.getCenter(),zoom:K};var ue=V.subtract(R).divideBy(2),Oe=this.project(f.getSouthWest(),K),nt=this.project(f.getNorthEast(),K),ut=this.unproject(Oe.add(nt).divideBy(2).add(ue),K);return{center:ut,zoom:K}},fitBounds:function(f,x){if(f=jt(f),!f.isValid())throw new Error("Bounds are not valid.");var R=this._getBoundsCenterZoom(f,x);return this.setView(R.center,R.zoom,x)},fitWorld:function(f){return this.fitBounds([[-90,-180],[90,180]],f)},panTo:function(f,x){return this.setView(f,this._zoom,{pan:x})},panBy:function(f,x){if(f=Bt(f).round(),x=x||{},!f.x&&!f.y)return this.fire("moveend");if(x.animate!==!0&&!this.getSize().contains(f))return this._resetView(this.unproject(this.project(this.getCenter()).add(f)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new bs,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),x.noMoveStart||this.fire("movestart"),x.animate!==!1){on(this._mapPane,"leaflet-pan-anim");var R=this._getMapPanePos().subtract(f).round();this._panAnim.run(this._mapPane,R,x.duration||.25,x.easeLinearity)}else this._rawPanBy(f),this.fire("move").fire("moveend");return this},flyTo:function(f,x,R){if(R=R||{},R.animate===!1||!en.any3d)return this.setView(f,x,R);this._stop();var V=this.project(this.getCenter()),K=this.project(f),ue=this.getSize(),Oe=this._zoom;f=Xt(f),x=x===void 0?Oe:x;var nt=Math.max(ue.x,ue.y),ut=nt*this.getZoomScale(Oe,x),Mt=K.distanceTo(V)||1,Kt=1.42,pn=Kt*Kt;function Yn(Or){var rs=Or?-1:1,ml=Or?ut:nt,Bo=ut*ut-nt*nt+rs*pn*pn*Mt*Mt,wu=2*ml*pn*Mt,ic=Bo/wu,Nl=Math.sqrt(ic*ic+1)-ic,gl=Nl<1e-9?-18:Math.log(Nl);return gl}function ga(Or){return(Math.exp(Or)-Math.exp(-Or))/2}function Zr(Or){return(Math.exp(Or)+Math.exp(-Or))/2}function Za(Or){return ga(Or)/Zr(Or)}var Ti=Yn(0);function Ri(Or){return nt*(Zr(Ti)/Zr(Ti+Kt*Or))}function li(Or){return nt*(Zr(Ti)*Za(Ti+Kt*Or)-ga(Ti))/pn}function Li(Or){return 1-Math.pow(1-Or,1.5)}var Hr=Date.now(),is=(Yn(1)-Ti)/Kt,No=R.duration?1e3*R.duration:1e3*is*.8;function xu(){var Or=(Date.now()-Hr)/No,rs=Li(Or)*is;Or<=1?(this._flyToFrame=Pe(xu,this),this._move(this.unproject(V.add(K.subtract(V).multiplyBy(li(rs)/Mt)),Oe),this.getScaleZoom(nt/Ri(rs),Oe),{flyTo:!0})):this._move(f,x)._moveEnd(!0)}return this._moveStart(!0,R.noMoveStart),xu.call(this),this},flyToBounds:function(f,x){var R=this._getBoundsCenterZoom(f,x);return this.flyTo(R.center,R.zoom,x)},setMaxBounds:function(f){return f=jt(f),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),f.isValid()?(this.options.maxBounds=f,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(f){var x=this.options.minZoom;return this.options.minZoom=f,this._loaded&&x!==f&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(f):this},setMaxZoom:function(f){var x=this.options.maxZoom;return this.options.maxZoom=f,this._loaded&&x!==f&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(f):this},panInsideBounds:function(f,x){this._enforcingBounds=!0;var R=this.getCenter(),V=this._limitCenter(R,this._zoom,jt(f));return R.equals(V)||this.panTo(V,x),this._enforcingBounds=!1,this},panInside:function(f,x){x=x||{};var R=Bt(x.paddingTopLeft||x.padding||[0,0]),V=Bt(x.paddingBottomRight||x.padding||[0,0]),K=this.project(this.getCenter()),ue=this.project(f),Oe=this.getPixelBounds(),nt=vt([Oe.min.add(R),Oe.max.subtract(V)]),ut=nt.getSize();if(!nt.contains(ue)){this._enforcingBounds=!0;var Mt=ue.subtract(nt.getCenter()),Kt=nt.extend(ue).getSize().subtract(ut);K.x+=Mt.x<0?-Kt.x:Kt.x,K.y+=Mt.y<0?-Kt.y:Kt.y,this.panTo(this.unproject(K),x),this._enforcingBounds=!1}return this},invalidateSize:function(f){if(!this._loaded)return this;f=d({animate:!1,pan:!0},f===!0?{animate:!0}:f);var x=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var R=this.getSize(),V=x.divideBy(2).round(),K=R.divideBy(2).round(),ue=V.subtract(K);return!ue.x&&!ue.y?this:(f.animate&&f.pan?this.panBy(ue):(f.pan&&this._rawPanBy(ue),this.fire("move"),f.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(_(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:x,newSize:R}))},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(f){if(f=this._locateOptions=d({timeout:1e4,watch:!1},f),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var x=_(this._handleGeolocationResponse,this),R=_(this._handleGeolocationError,this);return f.watch?this._locationWatchId=navigator.geolocation.watchPosition(x,R,f):navigator.geolocation.getCurrentPosition(x,R,f),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(f){if(this._container._leaflet_id){var x=f.code,R=f.message||(x===1?"permission denied":x===2?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:x,message:"Geolocation error: "+R+"."})}},_handleGeolocationResponse:function(f){if(this._container._leaflet_id){var x=f.coords.latitude,R=f.coords.longitude,V=new Jt(x,R),K=V.toBounds(f.coords.accuracy*2),ue=this._locateOptions;if(ue.setView){var Oe=this.getBoundsZoom(K);this.setView(V,ue.maxZoom?Math.min(Oe,ue.maxZoom):Oe)}var nt={latlng:V,bounds:K,timestamp:f.timestamp};for(var ut in f.coords)typeof f.coords[ut]=="number"&&(nt[ut]=f.coords[ut]);this.fire("locationfound",nt)}},addHandler:function(f,x){if(!x)return this;var R=this[f]=new x(this);return this._handlers.push(R),this.options[f]&&R.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch{this._container._leaflet_id=void 0,this._containerId=void 0}this._locationWatchId!==void 0&&this.stopLocate(),this._stop(),ci(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(Ge(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload");var f;for(f in this._layers)this._layers[f].remove();for(f in this._panes)ci(this._panes[f]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(f,x){var R="leaflet-pane"+(f?" leaflet-"+f.replace("Pane","")+"-pane":""),V=ni("div",R,x||this._mapPane);return f&&(this._panes[f]=V),V},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var f=this.getPixelBounds(),x=this.unproject(f.getBottomLeft()),R=this.unproject(f.getTopRight());return new Ot(x,R)},getMinZoom:function(){return this.options.minZoom===void 0?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===void 0?this._layersMaxZoom===void 0?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(f,x,R){f=jt(f),R=Bt(R||[0,0]);var V=this.getZoom()||0,K=this.getMinZoom(),ue=this.getMaxZoom(),Oe=f.getNorthWest(),nt=f.getSouthEast(),ut=this.getSize().subtract(R),Mt=vt(this.project(nt,V),this.project(Oe,V)).getSize(),Kt=en.any3d?this.options.zoomSnap:1,pn=ut.x/Mt.x,Yn=ut.y/Mt.y,ga=x?Math.max(pn,Yn):Math.min(pn,Yn);return V=this.getScaleZoom(ga,V),Kt&&(V=Math.round(V/(Kt/100))*(Kt/100),V=x?Math.ceil(V/Kt)*Kt:Math.floor(V/Kt)*Kt),Math.max(K,Math.min(ue,V))},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new Tt(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(f,x){var R=this._getTopLeftPoint(f,x);return new ke(R,R.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(f){return this.options.crs.getProjectedBounds(f===void 0?this.getZoom():f)},getPane:function(f){return typeof f=="string"?this._panes[f]:f},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(f,x){var R=this.options.crs;return x=x===void 0?this._zoom:x,R.scale(f)/R.scale(x)},getScaleZoom:function(f,x){var R=this.options.crs;x=x===void 0?this._zoom:x;var V=R.zoom(f*R.scale(x));return isNaN(V)?1/0:V},project:function(f,x){return x=x===void 0?this._zoom:x,this.options.crs.latLngToPoint(Xt(f),x)},unproject:function(f,x){return x=x===void 0?this._zoom:x,this.options.crs.pointToLatLng(Bt(f),x)},layerPointToLatLng:function(f){var x=Bt(f).add(this.getPixelOrigin());return this.unproject(x)},latLngToLayerPoint:function(f){var x=this.project(Xt(f))._round();return x._subtract(this.getPixelOrigin())},wrapLatLng:function(f){return this.options.crs.wrapLatLng(Xt(f))},wrapLatLngBounds:function(f){return this.options.crs.wrapLatLngBounds(jt(f))},distance:function(f,x){return this.options.crs.distance(Xt(f),Xt(x))},containerPointToLayerPoint:function(f){return Bt(f).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(f){return Bt(f).add(this._getMapPanePos())},containerPointToLatLng:function(f){var x=this.containerPointToLayerPoint(Bt(f));return this.layerPointToLatLng(x)},latLngToContainerPoint:function(f){return this.layerPointToContainerPoint(this.latLngToLayerPoint(Xt(f)))},mouseEventToContainerPoint:function(f){return Dr(f,this._container)},mouseEventToLayerPoint:function(f){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(f))},mouseEventToLatLng:function(f){return this.layerPointToLatLng(this.mouseEventToLayerPoint(f))},_initContainer:function(f){var x=this._container=$s(f);if(x){if(x._leaflet_id)throw new Error("Map container is already initialized.")}else throw new Error("Map container not found.");hn(x,"scroll",this._onScroll,this),this._containerId=M(x)},_initLayout:function(){var f=this._container;this._fadeAnimated=this.options.fadeAnimation&&en.any3d,on(f,"leaflet-container"+(en.touch?" leaflet-touch":"")+(en.retina?" leaflet-retina":"")+(en.ielt9?" leaflet-oldie":"")+(en.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var x=rl(f,"position");x!=="absolute"&&x!=="relative"&&x!=="fixed"&&x!=="sticky"&&(f.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var f=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),rr(this._mapPane,new Tt(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(on(f.markerPane,"leaflet-zoom-hide"),on(f.shadowPane,"leaflet-zoom-hide"))},_resetView:function(f,x,R){rr(this._mapPane,new Tt(0,0));var V=!this._loaded;this._loaded=!0,x=this._limitZoom(x),this.fire("viewprereset");var K=this._zoom!==x;this._moveStart(K,R)._move(f,x)._moveEnd(K),this.fire("viewreset"),V&&this.fire("load")},_moveStart:function(f,x){return f&&this.fire("zoomstart"),x||this.fire("movestart"),this},_move:function(f,x,R,V){x===void 0&&(x=this._zoom);var K=this._zoom!==x;return this._zoom=x,this._lastCenter=f,this._pixelOrigin=this._getNewPixelOrigin(f),V?R&&R.pinch&&this.fire("zoom",R):((K||R&&R.pinch)&&this.fire("zoom",R),this.fire("move",R)),this},_moveEnd:function(f){return f&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return Ge(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(f){rr(this._mapPane,this._getMapPanePos().subtract(f))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(f){this._targets={},this._targets[M(this._container)]=this;var x=f?xn:hn;x(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&x(window,"resize",this._onResize,this),en.any3d&&this.options.transform3DLimit&&(f?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){Ge(this._resizeRequest),this._resizeRequest=Pe(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var f=this._getMapPanePos();Math.max(Math.abs(f.x),Math.abs(f.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(f,x){for(var R=[],V,K=x==="mouseout"||x==="mouseover",ue=f.target||f.srcElement,Oe=!1;ue;){if(V=this._targets[M(ue)],V&&(x==="click"||x==="preclick")&&this._draggableMoved(V)){Oe=!0;break}if(V&&V.listens(x,!0)&&(K&&!vs(ue,f)||(R.push(V),K))||ue===this._container)break;ue=ue.parentNode}return!R.length&&!Oe&&!K&&this.listens(x,!0)&&(R=[this]),R},_isClickDisabled:function(f){for(;f&&f!==this._container;){if(f._leaflet_disable_click)return!0;f=f.parentNode}},_handleDOMEvent:function(f){var x=f.target||f.srcElement;if(!(!this._loaded||x._leaflet_disable_events||f.type==="click"&&this._isClickDisabled(x))){var R=f.type;R==="mousedown"&&ys(x),this._fireDOMEvent(f,R)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(f,x,R){if(f.type==="click"){var V=d({},f);V.type="preclick",this._fireDOMEvent(V,V.type,R)}var K=this._findEventTargets(f,x);if(R){for(var ue=[],Oe=0;Oe<R.length;Oe++)R[Oe].listens(x,!0)&&ue.push(R[Oe]);K=ue.concat(K)}if(K.length){x==="contextmenu"&&sn(f);var nt=K[0],ut={originalEvent:f};if(f.type!=="keypress"&&f.type!=="keydown"&&f.type!=="keyup"){var Mt=nt.getLatLng&&(!nt._radius||nt._radius<=10);ut.containerPoint=Mt?this.latLngToContainerPoint(nt.getLatLng()):this.mouseEventToContainerPoint(f),ut.layerPoint=this.containerPointToLayerPoint(ut.containerPoint),ut.latlng=Mt?nt.getLatLng():this.layerPointToLatLng(ut.layerPoint)}for(Oe=0;Oe<K.length;Oe++)if(K[Oe].fire(x,ut,!0),ut.originalEvent._stopped||K[Oe].options.bubblingMouseEvents===!1&&He(this._mouseEvents,x)!==-1)return}},_draggableMoved:function(f){return f=f.dragging&&f.dragging.enabled()?f:this,f.dragging&&f.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var f=0,x=this._handlers.length;f<x;f++)this._handlers[f].disable()},whenReady:function(f,x){return this._loaded?f.call(x||this,{target:this}):this.on("load",f,x),this},_getMapPanePos:function(){return Qa(this._mapPane)||new Tt(0,0)},_moved:function(){var f=this._getMapPanePos();return f&&!f.equals([0,0])},_getTopLeftPoint:function(f,x){var R=f&&x!==void 0?this._getNewPixelOrigin(f,x):this.getPixelOrigin();return R.subtract(this._getMapPanePos())},_getNewPixelOrigin:function(f,x){var R=this.getSize()._divideBy(2);return this.project(f,x)._subtract(R)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(f,x,R){var V=this._getNewPixelOrigin(R,x);return this.project(f,x)._subtract(V)},_latLngBoundsToNewLayerBounds:function(f,x,R){var V=this._getNewPixelOrigin(R,x);return vt([this.project(f.getSouthWest(),x)._subtract(V),this.project(f.getNorthWest(),x)._subtract(V),this.project(f.getSouthEast(),x)._subtract(V),this.project(f.getNorthEast(),x)._subtract(V)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(f){return this.latLngToLayerPoint(f).subtract(this._getCenterLayerPoint())},_limitCenter:function(f,x,R){if(!R)return f;var V=this.project(f,x),K=this.getSize().divideBy(2),ue=new ke(V.subtract(K),V.add(K)),Oe=this._getBoundsOffset(ue,R,x);return Math.abs(Oe.x)<=1&&Math.abs(Oe.y)<=1?f:this.unproject(V.add(Oe),x)},_limitOffset:function(f,x){if(!x)return f;var R=this.getPixelBounds(),V=new ke(R.min.add(f),R.max.add(f));return f.add(this._getBoundsOffset(V,x))},_getBoundsOffset:function(f,x,R){var V=vt(this.project(x.getNorthEast(),R),this.project(x.getSouthWest(),R)),K=V.min.subtract(f.min),ue=V.max.subtract(f.max),Oe=this._rebound(K.x,-ue.x),nt=this._rebound(K.y,-ue.y);return new Tt(Oe,nt)},_rebound:function(f,x){return f+x>0?Math.round(f-x)/2:Math.max(0,Math.ceil(f))-Math.max(0,Math.floor(x))},_limitZoom:function(f){var x=this.getMinZoom(),R=this.getMaxZoom(),V=en.any3d?this.options.zoomSnap:1;return V&&(f=Math.round(f/V)*V),Math.max(x,Math.min(R,f))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){Fi(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(f,x){var R=this._getCenterOffset(f)._trunc();return(x&&x.animate)!==!0&&!this.getSize().contains(R)?!1:(this.panBy(R,x),!0)},_createAnimProxy:function(){var f=this._proxy=ni("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(f),this.on("zoomanim",function(x){var R=ja,V=this._proxy.style[R];Gs(this._proxy,this.project(x.center,x.zoom),this.getZoomScale(x.zoom,1)),V===this._proxy.style[R]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){ci(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var f=this.getCenter(),x=this.getZoom();Gs(this._proxy,this.project(f,x),this.getZoomScale(x,1))},_catchTransitionEnd:function(f){this._animatingZoom&&f.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(f,x,R){if(this._animatingZoom)return!0;if(R=R||{},!this._zoomAnimated||R.animate===!1||this._nothingToAnimate()||Math.abs(x-this._zoom)>this.options.zoomAnimationThreshold)return!1;var V=this.getZoomScale(x),K=this._getCenterOffset(f)._divideBy(1-1/V);return R.animate!==!0&&!this.getSize().contains(K)?!1:(Pe(function(){this._moveStart(!0,R.noMoveStart||!1)._animateZoom(f,x,!0)},this),!0)},_animateZoom:function(f,x,R,V){this._mapPane&&(R&&(this._animatingZoom=!0,this._animateToCenter=f,this._animateToZoom=x,on(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:f,zoom:x,noUpdate:V}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(_(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&Fi(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});function Io(f,x){return new Xn(f,x)}var ia=In.extend({options:{position:"topright"},initialize:function(f){be(this,f)},getPosition:function(){return this.options.position},setPosition:function(f){var x=this._map;return x&&x.removeControl(this),this.options.position=f,x&&x.addControl(this),this},getContainer:function(){return this._container},addTo:function(f){this.remove(),this._map=f;var x=this._container=this.onAdd(f),R=this.getPosition(),V=f._controlCorners[R];return on(x,"leaflet-control"),R.indexOf("bottom")!==-1?V.insertBefore(x,V.firstChild):V.appendChild(x),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(ci(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(f){this._map&&f&&f.screenX>0&&f.screenY>0&&this._map.getContainer().focus()}}),Ia=function(f){return new ia(f)};Xn.include({addControl:function(f){return f.addTo(this),this},removeControl:function(f){return f.remove(),this},_initControlPos:function(){var f=this._controlCorners={},x="leaflet-",R=this._controlContainer=ni("div",x+"control-container",this._container);function V(K,ue){var Oe=x+K+" "+x+ue;f[K+ue]=ni("div",Oe,R)}V("top","left"),V("top","right"),V("bottom","left"),V("bottom","right")},_clearControlPos:function(){for(var f in this._controlCorners)ci(this._controlCorners[f]);ci(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var Pa=ia.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(f,x,R,V){return R<V?-1:V<R?1:0}},initialize:function(f,x,R){be(this,R),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1;for(var V in f)this._addLayer(f[V],V);for(V in x)this._addLayer(x[V],V,!0)},onAdd:function(f){this._initLayout(),this._update(),this._map=f,f.on("zoomend",this._checkDisabledLayers,this);for(var x=0;x<this._layers.length;x++)this._layers[x].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(f){return ia.prototype.addTo.call(this,f),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var f=0;f<this._layers.length;f++)this._layers[f].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(f,x){return this._addLayer(f,x),this._map?this._update():this},addOverlay:function(f,x){return this._addLayer(f,x,!0),this._map?this._update():this},removeLayer:function(f){f.off("add remove",this._onLayerChange,this);var x=this._getLayer(M(f));return x&&this._layers.splice(this._layers.indexOf(x),1),this._map?this._update():this},expand:function(){on(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var f=this._map.getSize().y-(this._container.offsetTop+50);return f<this._section.clientHeight?(on(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=f+"px"):Fi(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return Fi(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var f="leaflet-control-layers",x=this._container=ni("div",f),R=this.options.collapsed;x.setAttribute("aria-haspopup",!0),fn(x),fa(x);var V=this._section=ni("section",f+"-list");R&&(this._map.on("click",this.collapse,this),hn(x,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var K=this._layersLink=ni("a",f+"-toggle",x);K.href="#",K.title="Layers",K.setAttribute("role","button"),hn(K,{keydown:function(ue){ue.keyCode===13&&this._expandSafely()},click:function(ue){sn(ue),this._expandSafely()}},this),R||this.expand(),this._baseLayersList=ni("div",f+"-base",V),this._separator=ni("div",f+"-separator",V),this._overlaysList=ni("div",f+"-overlays",V),x.appendChild(V)},_getLayer:function(f){for(var x=0;x<this._layers.length;x++)if(this._layers[x]&&M(this._layers[x].layer)===f)return this._layers[x]},_addLayer:function(f,x,R){this._map&&f.on("add remove",this._onLayerChange,this),this._layers.push({layer:f,name:x,overlay:R}),this.options.sortLayers&&this._layers.sort(_(function(V,K){return this.options.sortFunction(V.layer,K.layer,V.name,K.name)},this)),this.options.autoZIndex&&f.setZIndex&&(this._lastZIndex++,f.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;qi(this._baseLayersList),qi(this._overlaysList),this._layerControlInputs=[];var f,x,R,V,K=0;for(R=0;R<this._layers.length;R++)V=this._layers[R],this._addItem(V),x=x||V.overlay,f=f||!V.overlay,K+=V.overlay?0:1;return this.options.hideSingleBase&&(f=f&&K>1,this._baseLayersList.style.display=f?"":"none"),this._separator.style.display=x&&f?"":"none",this},_onLayerChange:function(f){this._handlingClick||this._update();var x=this._getLayer(M(f.target)),R=x.overlay?f.type==="add"?"overlayadd":"overlayremove":f.type==="add"?"baselayerchange":null;R&&this._map.fire(R,x)},_createRadioElement:function(f,x){var R='<input type="radio" class="leaflet-control-layers-selector" name="'+f+'"'+(x?' checked="checked"':"")+"/>",V=document.createElement("div");return V.innerHTML=R,V.firstChild},_addItem:function(f){var x=document.createElement("label"),R=this._map.hasLayer(f.layer),V;f.overlay?(V=document.createElement("input"),V.type="checkbox",V.className="leaflet-control-layers-selector",V.defaultChecked=R):V=this._createRadioElement("leaflet-base-layers_"+M(this),R),this._layerControlInputs.push(V),V.layerId=M(f.layer),hn(V,"click",this._onInputClick,this);var K=document.createElement("span");K.innerHTML=" "+f.name;var ue=document.createElement("span");x.appendChild(ue),ue.appendChild(V),ue.appendChild(K);var Oe=f.overlay?this._overlaysList:this._baseLayersList;return Oe.appendChild(x),this._checkDisabledLayers(),x},_onInputClick:function(){if(!this._preventClick){var f=this._layerControlInputs,x,R,V=[],K=[];this._handlingClick=!0;for(var ue=f.length-1;ue>=0;ue--)x=f[ue],R=this._getLayer(x.layerId).layer,x.checked?V.push(R):x.checked||K.push(R);for(ue=0;ue<K.length;ue++)this._map.hasLayer(K[ue])&&this._map.removeLayer(K[ue]);for(ue=0;ue<V.length;ue++)this._map.hasLayer(V[ue])||this._map.addLayer(V[ue]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var f=this._layerControlInputs,x,R,V=this._map.getZoom(),K=f.length-1;K>=0;K--)x=f[K],R=this._getLayer(x.layerId).layer,x.disabled=R.options.minZoom!==void 0&&V<R.options.minZoom||R.options.maxZoom!==void 0&&V>R.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var f=this._section;this._preventClick=!0,hn(f,"click",sn),this.expand();var x=this;setTimeout(function(){xn(f,"click",sn),x._preventClick=!1})}}),zr=function(f,x,R){return new Pa(f,x,R)},xs=ia.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(f){var x="leaflet-control-zoom",R=ni("div",x+" leaflet-bar"),V=this.options;return this._zoomInButton=this._createButton(V.zoomInText,V.zoomInTitle,x+"-in",R,this._zoomIn),this._zoomOutButton=this._createButton(V.zoomOutText,V.zoomOutTitle,x+"-out",R,this._zoomOut),this._updateDisabled(),f.on("zoomend zoomlevelschange",this._updateDisabled,this),R},onRemove:function(f){f.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(f){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(f.shiftKey?3:1))},_zoomOut:function(f){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(f.shiftKey?3:1))},_createButton:function(f,x,R,V,K){var ue=ni("a",R,V);return ue.innerHTML=f,ue.href="#",ue.title=x,ue.setAttribute("role","button"),ue.setAttribute("aria-label",x),fn(ue),hn(ue,"click",na),hn(ue,"click",K,this),hn(ue,"click",this._refocusOnMap,this),ue},_updateDisabled:function(){var f=this._map,x="leaflet-disabled";Fi(this._zoomInButton,x),Fi(this._zoomOutButton,x),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||f._zoom===f.getMinZoom())&&(on(this._zoomOutButton,x),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||f._zoom===f.getMaxZoom())&&(on(this._zoomInButton,x),this._zoomInButton.setAttribute("aria-disabled","true"))}});Xn.mergeOptions({zoomControl:!0}),Xn.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new xs,this.addControl(this.zoomControl))});var ql=function(f){return new xs(f)},Po=ia.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(f){var x="leaflet-control-scale",R=ni("div",x),V=this.options;return this._addScales(V,x+"-line",R),f.on(V.updateWhenIdle?"moveend":"move",this._update,this),f.whenReady(this._update,this),R},onRemove:function(f){f.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(f,x,R){f.metric&&(this._mScale=ni("div",x,R)),f.imperial&&(this._iScale=ni("div",x,R))},_update:function(){var f=this._map,x=f.getSize().y/2,R=f.distance(f.containerPointToLatLng([0,x]),f.containerPointToLatLng([this.options.maxWidth,x]));this._updateScales(R)},_updateScales:function(f){this.options.metric&&f&&this._updateMetric(f),this.options.imperial&&f&&this._updateImperial(f)},_updateMetric:function(f){var x=this._getRoundNum(f),R=x<1e3?x+" m":x/1e3+" km";this._updateScale(this._mScale,R,x/f)},_updateImperial:function(f){var x=f*3.2808399,R,V,K;x>5280?(R=x/5280,V=this._getRoundNum(R),this._updateScale(this._iScale,V+" mi",V/R)):(K=this._getRoundNum(x),this._updateScale(this._iScale,K+" ft",K/x))},_updateScale:function(f,x,R){f.style.width=Math.round(this.options.maxWidth*R)+"px",f.innerHTML=x},_getRoundNum:function(f){var x=Math.pow(10,(Math.floor(f)+"").length-1),R=f/x;return R=R>=10?10:R>=5?5:R>=3?3:R>=2?2:1,x*R}}),Hi=function(f){return new Po(f)},Uu='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg>',sl=ia.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(en.inlineSvg?Uu+" ":"")+"Leaflet</a>"},initialize:function(f){be(this,f),this._attributions={}},onAdd:function(f){f.attributionControl=this,this._container=ni("div","leaflet-control-attribution"),fn(this._container);for(var x in f._layers)f._layers[x].getAttribution&&this.addAttribution(f._layers[x].getAttribution());return this._update(),f.on("layeradd",this._addAttribution,this),this._container},onRemove:function(f){f.off("layeradd",this._addAttribution,this)},_addAttribution:function(f){f.layer.getAttribution&&(this.addAttribution(f.layer.getAttribution()),f.layer.once("remove",function(){this.removeAttribution(f.layer.getAttribution())},this))},setPrefix:function(f){return this.options.prefix=f,this._update(),this},addAttribution:function(f){return f?(this._attributions[f]||(this._attributions[f]=0),this._attributions[f]++,this._update(),this):this},removeAttribution:function(f){return f?(this._attributions[f]&&(this._attributions[f]--,this._update()),this):this},_update:function(){if(this._map){var f=[];for(var x in this._attributions)this._attributions[x]&&f.push(x);var R=[];this.options.prefix&&R.push(this.options.prefix),f.length&&R.push(f.join(", ")),this._container.innerHTML=R.join(' <span aria-hidden="true">|</span> ')}}});Xn.mergeOptions({attributionControl:!0}),Xn.addInitHook(function(){this.options.attributionControl&&new sl().addTo(this)});var Gl=function(f){return new sl(f)};ia.Layers=Pa,ia.Zoom=xs,ia.Scale=Po,ia.Attribution=sl,Ia.layers=zr,Ia.zoom=ql,Ia.scale=Hi,Ia.attribution=Gl;var Hs=In.extend({initialize:function(f){this._map=f},enable:function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});Hs.addTo=function(f,x){return f.addHandler(x,this),this};var kl={Events:mt},or=en.touch?"touchstart mousedown":"mousedown",es=$t.extend({options:{clickTolerance:3},initialize:function(f,x,R,V){be(this,V),this._element=f,this._dragStartTarget=x||f,this._preventOutline=R},enable:function(){this._enabled||(hn(this._dragStartTarget,or,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(es._dragging===this&&this.finishDrag(!0),xn(this._dragStartTarget,or,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(f){if(this._enabled&&(this._moved=!1,!cu(this._element,"leaflet-zoom-anim"))){if(f.touches&&f.touches.length!==1){es._dragging===this&&this.finishDrag();return}if(!(es._dragging||f.shiftKey||f.which!==1&&f.button!==1&&!f.touches)&&(es._dragging=this,this._preventOutline&&ys(this._element),_s(),Ua(),!this._moving)){this.fire("down");var x=f.touches?f.touches[0]:f,R=Ll(this._element);this._startPoint=new Tt(x.clientX,x.clientY),this._startPos=Qa(this._element),this._parentScale=Zi(R);var V=f.type==="mousedown";hn(document,V?"mousemove":"touchmove",this._onMove,this),hn(document,V?"mouseup":"touchend touchcancel",this._onUp,this)}}},_onMove:function(f){if(this._enabled){if(f.touches&&f.touches.length>1){this._moved=!0;return}var x=f.touches&&f.touches.length===1?f.touches[0]:f,R=new Tt(x.clientX,x.clientY)._subtract(this._startPoint);!R.x&&!R.y||Math.abs(R.x)+Math.abs(R.y)<this.options.clickTolerance||(R.x/=this._parentScale.x,R.y/=this._parentScale.y,sn(f),this._moved||(this.fire("dragstart"),this._moved=!0,on(document.body,"leaflet-dragging"),this._lastTarget=f.target||f.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),on(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(R),this._moving=!0,this._lastEvent=f,this._updatePosition())}},_updatePosition:function(){var f={originalEvent:this._lastEvent};this.fire("predrag",f),rr(this._element,this._newPos),this.fire("drag",f)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(f){Fi(document.body,"leaflet-dragging"),this._lastTarget&&(Fi(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),xn(document,"mousemove touchmove",this._onMove,this),xn(document,"mouseup touchend touchcancel",this._onUp,this),$a(),Gi();var x=this._moved&&this._moving;this._moving=!1,es._dragging=!1,x&&this.fire("dragend",{noInertia:f,distance:this._newPos.distanceTo(this._startPos)})}});function ws(f,x,R){var V,K=[1,4,2,8],ue,Oe,nt,ut,Mt,Kt,pn,Yn;for(ue=0,Kt=f.length;ue<Kt;ue++)f[ue]._code=ht(f[ue],x);for(nt=0;nt<4;nt++){for(pn=K[nt],V=[],ue=0,Kt=f.length,Oe=Kt-1;ue<Kt;Oe=ue++)ut=f[ue],Mt=f[Oe],ut._code&pn?Mt._code&pn||(Yn=at(Mt,ut,pn,x,R),Yn._code=ht(Yn,x),V.push(Yn)):(Mt._code&pn&&(Yn=at(Mt,ut,pn,x,R),Yn._code=ht(Yn,x),V.push(Yn)),V.push(ut));f=V}return f}function Dl(f,x){var R,V,K,ue,Oe,nt,ut,Mt,Kt;if(!f||f.length===0)throw new Error("latlngs not passed");Wn(f)||(console.warn("latlngs are not flat! Only the first ring will be used"),f=f[0]);var pn=Xt([0,0]),Yn=jt(f),ga=Yn.getNorthWest().distanceTo(Yn.getSouthWest())*Yn.getNorthEast().distanceTo(Yn.getNorthWest());ga<1700&&(pn=ol(f));var Zr=f.length,Za=[];for(R=0;R<Zr;R++){var Ti=Xt(f[R]);Za.push(x.project(Xt([Ti.lat-pn.lat,Ti.lng-pn.lng])))}for(nt=ut=Mt=0,R=0,V=Zr-1;R<Zr;V=R++)K=Za[R],ue=Za[V],Oe=K.y*ue.x-ue.y*K.x,ut+=(K.x+ue.x)*Oe,Mt+=(K.y+ue.y)*Oe,nt+=Oe*3;nt===0?Kt=Za[0]:Kt=[ut/nt,Mt/nt];var Ri=x.unproject(Bt(Kt));return Xt([Ri.lat+pn.lat,Ri.lng+pn.lng])}function ol(f){for(var x=0,R=0,V=0,K=0;K<f.length;K++){var ue=Xt(f[K]);x+=ue.lat,R+=ue.lng,V++}return Xt([x/V,R/V])}var uo={__proto__:null,clipPolygon:ws,polygonCenter:Dl,centroid:ol};function Ei(f,x){if(!x||!f.length)return f.slice();var R=x*x;return f=Z(f,R),f=zl(f,R),f}function $u(f,x,R){return Math.sqrt(kn(f,x,R,!0))}function hu(f,x,R){return kn(f,x,R)}function zl(f,x){var R=f.length,V=typeof Uint8Array<"u"?Uint8Array:Array,K=new V(R);K[0]=K[R-1]=1,P(f,K,x,0,R-1);var ue,Oe=[];for(ue=0;ue<R;ue++)K[ue]&&Oe.push(f[ue]);return Oe}function P(f,x,R,V,K){var ue=0,Oe,nt,ut;for(nt=V+1;nt<=K-1;nt++)ut=kn(f[nt],f[V],f[K],!0),ut>ue&&(Oe=nt,ue=ut);ue>R&&(x[Oe]=1,P(f,x,R,V,Oe),P(f,x,R,Oe,K))}function Z(f,x){for(var R=[f[0]],V=1,K=0,ue=f.length;V<ue;V++)Wt(f[V],f[K])>x&&(R.push(f[V]),K=V);return K<ue-1&&R.push(f[ue-1]),R}var ne;function ye(f,x,R,V,K){var ue=V?ne:ht(f,R),Oe=ht(x,R),nt,ut,Mt;for(ne=Oe;;){if(!(ue|Oe))return[f,x];if(ue&Oe)return!1;nt=ue||Oe,ut=at(f,x,nt,R,K),Mt=ht(ut,R),nt===ue?(f=ut,ue=Mt):(x=ut,Oe=Mt)}}function at(f,x,R,V,K){var ue=x.x-f.x,Oe=x.y-f.y,nt=V.min,ut=V.max,Mt,Kt;return R&8?(Mt=f.x+ue*(ut.y-f.y)/Oe,Kt=ut.y):R&4?(Mt=f.x+ue*(nt.y-f.y)/Oe,Kt=nt.y):R&2?(Mt=ut.x,Kt=f.y+Oe*(ut.x-f.x)/ue):R&1&&(Mt=nt.x,Kt=f.y+Oe*(nt.x-f.x)/ue),new Tt(Mt,Kt,K)}function ht(f,x){var R=0;return f.x<x.min.x?R|=1:f.x>x.max.x&&(R|=2),f.y<x.min.y?R|=4:f.y>x.max.y&&(R|=8),R}function Wt(f,x){var R=x.x-f.x,V=x.y-f.y;return R*R+V*V}function kn(f,x,R,V){var K=x.x,ue=x.y,Oe=R.x-K,nt=R.y-ue,ut=Oe*Oe+nt*nt,Mt;return ut>0&&(Mt=((f.x-K)*Oe+(f.y-ue)*nt)/ut,Mt>1?(K=R.x,ue=R.y):Mt>0&&(K+=Oe*Mt,ue+=nt*Mt)),Oe=f.x-K,nt=f.y-ue,V?Oe*Oe+nt*nt:new Tt(K,ue)}function Wn(f){return!qe(f[0])||typeof f[0][0]!="object"&&typeof f[0][0]<"u"}function wi(f){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),Wn(f)}function Xi(f,x){var R,V,K,ue,Oe,nt,ut,Mt;if(!f||f.length===0)throw new Error("latlngs not passed");Wn(f)||(console.warn("latlngs are not flat! Only the first ring will be used"),f=f[0]);var Kt=Xt([0,0]),pn=jt(f),Yn=pn.getNorthWest().distanceTo(pn.getSouthWest())*pn.getNorthEast().distanceTo(pn.getNorthWest());Yn<1700&&(Kt=ol(f));var ga=f.length,Zr=[];for(R=0;R<ga;R++){var Za=Xt(f[R]);Zr.push(x.project(Xt([Za.lat-Kt.lat,Za.lng-Kt.lng])))}for(R=0,V=0;R<ga-1;R++)V+=Zr[R].distanceTo(Zr[R+1])/2;if(V===0)Mt=Zr[0];else for(R=0,ue=0;R<ga-1;R++)if(Oe=Zr[R],nt=Zr[R+1],K=Oe.distanceTo(nt),ue+=K,ue>V){ut=(ue-V)/K,Mt=[nt.x-ut*(nt.x-Oe.x),nt.y-ut*(nt.y-Oe.y)];break}var Ti=x.unproject(Bt(Mt));return Xt([Ti.lat+Kt.lat,Ti.lng+Kt.lng])}var qa={__proto__:null,simplify:Ei,pointToSegmentDistance:$u,closestPointOnSegment:hu,clipSegment:ye,_getEdgeIntersection:at,_getBitCode:ht,_sqClosestPointOnSegment:kn,isFlat:Wn,_flat:wi,polylineCenter:Xi},Ga={project:function(f){return new Tt(f.lng,f.lat)},unproject:function(f){return new Jt(f.y,f.x)},bounds:new ke([-180,-90],[180,90])},Xs={R:6378137,R_MINOR:6356752314245179e-9,bounds:new ke([-2003750834279e-5,-1549657073972e-5],[2003750834279e-5,1876465623138e-5]),project:function(f){var x=Math.PI/180,R=this.R,V=f.lat*x,K=this.R_MINOR/R,ue=Math.sqrt(1-K*K),Oe=ue*Math.sin(V),nt=Math.tan(Math.PI/4-V/2)/Math.pow((1-Oe)/(1+Oe),ue/2);return V=-R*Math.log(Math.max(nt,1e-10)),new Tt(f.lng*x*R,V)},unproject:function(f){for(var x=180/Math.PI,R=this.R,V=this.R_MINOR/R,K=Math.sqrt(1-V*V),ue=Math.exp(-f.y/R),Oe=Math.PI/2-2*Math.atan(ue),nt=0,ut=.1,Mt;nt<15&&Math.abs(ut)>1e-7;nt++)Mt=K*Math.sin(Oe),Mt=Math.pow((1-Mt)/(1+Mt),K/2),ut=Math.PI/2-2*Math.atan(ue*Mt)-Oe,Oe+=ut;return new Jt(Oe*x,f.x*x/R)}},Ts={__proto__:null,LonLat:Ga,Mercator:Xs,SphericalMercator:ds},du=d({},si,{code:"EPSG:3395",projection:Xs,transformation:(function(){var f=.5/(Math.PI*Xs.R);return kr(f,.5,-f,.5)})()}),Ws=d({},si,{code:"EPSG:4326",projection:Ga,transformation:kr(1/180,1,-1/180,.5)}),fu=d({},Fn,{projection:Ga,transformation:kr(1,0,-1,0),scale:function(f){return Math.pow(2,f)},zoom:function(f){return Math.log(f)/Math.LN2},distance:function(f,x){var R=x.lng-f.lng,V=x.lat-f.lat;return Math.sqrt(R*R+V*V)},infinite:!0});Fn.Earth=si,Fn.EPSG3395=du,Fn.EPSG3857=Ni,Fn.EPSG900913=Ii,Fn.EPSG4326=Ws,Fn.Simple=fu;var Ks=$t.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(f){return f.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(f){return f&&f.removeLayer(this),this},getPane:function(f){return this._map.getPane(f?this.options[f]||f:this.options.pane)},addInteractiveTarget:function(f){return this._map._targets[M(f)]=this,this},removeInteractiveTarget:function(f){return delete this._map._targets[M(f)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(f){var x=f.target;if(x.hasLayer(this)){if(this._map=x,this._zoomAnimated=x._zoomAnimated,this.getEvents){var R=this.getEvents();x.on(R,this),this.once("remove",function(){x.off(R,this)},this)}this.onAdd(x),this.fire("add"),x.fire("layeradd",{layer:this})}}});Xn.include({addLayer:function(f){if(!f._layerAdd)throw new Error("The provided object is not a Layer.");var x=M(f);return this._layers[x]?this:(this._layers[x]=f,f._mapToAdd=this,f.beforeAdd&&f.beforeAdd(this),this.whenReady(f._layerAdd,f),this)},removeLayer:function(f){var x=M(f);return this._layers[x]?(this._loaded&&f.onRemove(this),delete this._layers[x],this._loaded&&(this.fire("layerremove",{layer:f}),f.fire("remove")),f._map=f._mapToAdd=null,this):this},hasLayer:function(f){return M(f)in this._layers},eachLayer:function(f,x){for(var R in this._layers)f.call(x,this._layers[R]);return this},_addLayers:function(f){f=f?qe(f)?f:[f]:[];for(var x=0,R=f.length;x<R;x++)this.addLayer(f[x])},_addZoomLimit:function(f){(!isNaN(f.options.maxZoom)||!isNaN(f.options.minZoom))&&(this._zoomBoundLayers[M(f)]=f,this._updateZoomLevels())},_removeZoomLimit:function(f){var x=M(f);this._zoomBoundLayers[x]&&(delete this._zoomBoundLayers[x],this._updateZoomLevels())},_updateZoomLevels:function(){var f=1/0,x=-1/0,R=this._getZoomSpan();for(var V in this._zoomBoundLayers){var K=this._zoomBoundLayers[V].options;f=K.minZoom===void 0?f:Math.min(f,K.minZoom),x=K.maxZoom===void 0?x:Math.max(x,K.maxZoom)}this._layersMaxZoom=x===-1/0?void 0:x,this._layersMinZoom=f===1/0?void 0:f,R!==this._getZoomSpan()&&this.fire("zoomlevelschange"),this.options.maxZoom===void 0&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),this.options.minZoom===void 0&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var qu=Ks.extend({initialize:function(f,x){be(this,x),this._layers={};var R,V;if(f)for(R=0,V=f.length;R<V;R++)this.addLayer(f[R])},addLayer:function(f){var x=this.getLayerId(f);return this._layers[x]=f,this._map&&this._map.addLayer(f),this},removeLayer:function(f){var x=f in this._layers?f:this.getLayerId(f);return this._map&&this._layers[x]&&this._map.removeLayer(this._layers[x]),delete this._layers[x],this},hasLayer:function(f){var x=typeof f=="number"?f:this.getLayerId(f);return x in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(f){var x=Array.prototype.slice.call(arguments,1),R,V;for(R in this._layers)V=this._layers[R],V[f]&&V[f].apply(V,x);return this},onAdd:function(f){this.eachLayer(f.addLayer,f)},onRemove:function(f){this.eachLayer(f.removeLayer,f)},eachLayer:function(f,x){for(var R in this._layers)f.call(x,this._layers[R]);return this},getLayer:function(f){return this._layers[f]},getLayers:function(){var f=[];return this.eachLayer(f.push,f),f},setZIndex:function(f){return this.invoke("setZIndex",f)},getLayerId:function(f){return M(f)}}),jd=function(f,x){return new qu(f,x)},co=qu.extend({addLayer:function(f){return this.hasLayer(f)?this:(f.addEventParent(this),qu.prototype.addLayer.call(this,f),this.fire("layeradd",{layer:f}))},removeLayer:function(f){return this.hasLayer(f)?(f in this._layers&&(f=this._layers[f]),f.removeEventParent(this),qu.prototype.removeLayer.call(this,f),this.fire("layerremove",{layer:f})):this},setStyle:function(f){return this.invoke("setStyle",f)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var f=new Ot;for(var x in this._layers){var R=this._layers[x];f.extend(R.getBounds?R.getBounds():R.getLatLng())}return f}}),Yh=function(f,x){return new co(f,x)},Ys=In.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(f){be(this,f)},createIcon:function(f){return this._createIcon("icon",f)},createShadow:function(f){return this._createIcon("shadow",f)},_createIcon:function(f,x){var R=this._getIconUrl(f);if(!R){if(f==="icon")throw new Error("iconUrl not set in Icon options (see the docs).");return null}var V=this._createImg(R,x&&x.tagName==="IMG"?x:null);return this._setIconStyles(V,f),(this.options.crossOrigin||this.options.crossOrigin==="")&&(V.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),V},_setIconStyles:function(f,x){var R=this.options,V=R[x+"Size"];typeof V=="number"&&(V=[V,V]);var K=Bt(V),ue=Bt(x==="shadow"&&R.shadowAnchor||R.iconAnchor||K&&K.divideBy(2,!0));f.className="leaflet-marker-"+x+" "+(R.className||""),ue&&(f.style.marginLeft=-ue.x+"px",f.style.marginTop=-ue.y+"px"),K&&(f.style.width=K.x+"px",f.style.height=K.y+"px")},_createImg:function(f,x){return x=x||document.createElement("img"),x.src=f,x},_getIconUrl:function(f){return en.retina&&this.options[f+"RetinaUrl"]||this.options[f+"Url"]}});function Gu(f){return new Ys(f)}var Zu=Ys.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(f){return typeof Zu.imagePath!="string"&&(Zu.imagePath=this._detectIconPath()),(this.options.imagePath||Zu.imagePath)+Ys.prototype._getIconUrl.call(this,f)},_stripUrl:function(f){var x=function(R,V,K){var ue=V.exec(R);return ue&&ue[K]};return f=x(f,/^url\((['"])?(.+)\1\)$/,2),f&&x(f,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var f=ni("div","leaflet-default-icon-path",document.body),x=rl(f,"background-image")||rl(f,"backgroundImage");if(document.body.removeChild(f),x=this._stripUrl(x),x)return x;var R=document.querySelector('link[href$="leaflet.css"]');return R?R.href.substring(0,R.href.length-11-1):""}}),Ro=Hs.extend({initialize:function(f){this._marker=f},addHooks:function(){var f=this._marker._icon;this._draggable||(this._draggable=new es(f,f,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),on(f,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&Fi(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(f){var x=this._marker,R=x._map,V=this._marker.options.autoPanSpeed,K=this._marker.options.autoPanPadding,ue=Qa(x._icon),Oe=R.getPixelBounds(),nt=R.getPixelOrigin(),ut=vt(Oe.min._subtract(nt).add(K),Oe.max._subtract(nt).subtract(K));if(!ut.contains(ue)){var Mt=Bt((Math.max(ut.max.x,ue.x)-ut.max.x)/(Oe.max.x-ut.max.x)-(Math.min(ut.min.x,ue.x)-ut.min.x)/(Oe.min.x-ut.min.x),(Math.max(ut.max.y,ue.y)-ut.max.y)/(Oe.max.y-ut.max.y)-(Math.min(ut.min.y,ue.y)-ut.min.y)/(Oe.min.y-ut.min.y)).multiplyBy(V);R.panBy(Mt,{animate:!1}),this._draggable._newPos._add(Mt),this._draggable._startPos._add(Mt),rr(x._icon,this._draggable._newPos),this._onDrag(f),this._panRequest=Pe(this._adjustPan.bind(this,f))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(f){this._marker.options.autoPan&&(Ge(this._panRequest),this._panRequest=Pe(this._adjustPan.bind(this,f)))},_onDrag:function(f){var x=this._marker,R=x._shadow,V=Qa(x._icon),K=x._map.layerPointToLatLng(V);R&&rr(R,V),x._latlng=K,f.latlng=K,f.oldLatLng=this._oldLatLng,x.fire("move",f).fire("drag",f)},_onDragEnd:function(f){Ge(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",f)}}),pu=Ks.extend({options:{icon:new Zu,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(f,x){be(this,x),this._latlng=Xt(f)},onAdd:function(f){this._zoomAnimated=this._zoomAnimated&&f.options.markerZoomAnimation,this._zoomAnimated&&f.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(f){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&f.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(f){var x=this._latlng;return this._latlng=Xt(f),this.update(),this.fire("move",{oldLatLng:x,latlng:this._latlng})},setZIndexOffset:function(f){return this.options.zIndexOffset=f,this.update()},getIcon:function(){return this.options.icon},setIcon:function(f){return this.options.icon=f,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var f=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(f)}return this},_initIcon:function(){var f=this.options,x="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),R=f.icon.createIcon(this._icon),V=!1;R!==this._icon&&(this._icon&&this._removeIcon(),V=!0,f.title&&(R.title=f.title),R.tagName==="IMG"&&(R.alt=f.alt||"")),on(R,x),f.keyboard&&(R.tabIndex="0",R.setAttribute("role","button")),this._icon=R,f.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&hn(R,"focus",this._panOnFocus,this);var K=f.icon.createShadow(this._shadow),ue=!1;K!==this._shadow&&(this._removeShadow(),ue=!0),K&&(on(K,x),K.alt=""),this._shadow=K,f.opacity<1&&this._updateOpacity(),V&&this.getPane().appendChild(this._icon),this._initInteraction(),K&&ue&&this.getPane(f.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&xn(this._icon,"focus",this._panOnFocus,this),ci(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&ci(this._shadow),this._shadow=null},_setPos:function(f){this._icon&&rr(this._icon,f),this._shadow&&rr(this._shadow,f),this._zIndex=f.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(f){this._icon&&(this._icon.style.zIndex=this._zIndex+f)},_animateZoom:function(f){var x=this._map._latLngToNewLayerPoint(this._latlng,f.zoom,f.center).round();this._setPos(x)},_initInteraction:function(){if(this.options.interactive&&(on(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),Ro)){var f=this.options.draggable;this.dragging&&(f=this.dragging.enabled(),this.dragging.disable()),this.dragging=new Ro(this),f&&this.dragging.enable()}},setOpacity:function(f){return this.options.opacity=f,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var f=this.options.opacity;this._icon&&ir(this._icon,f),this._shadow&&ir(this._shadow,f)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var f=this._map;if(f){var x=this.options.icon.options,R=x.iconSize?Bt(x.iconSize):Bt(0,0),V=x.iconAnchor?Bt(x.iconAnchor):Bt(0,0);f.panInside(this._latlng,{paddingTopLeft:V,paddingBottomRight:R.subtract(V)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});function dh(f,x){return new pu(f,x)}var Ss=Ks.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(f){this._renderer=f.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(f){return be(this,f),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&f&&Object.prototype.hasOwnProperty.call(f,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),Hu=Ss.extend({options:{fill:!0,radius:10},initialize:function(f,x){be(this,x),this._latlng=Xt(f),this._radius=this.options.radius},setLatLng:function(f){var x=this._latlng;return this._latlng=Xt(f),this.redraw(),this.fire("move",{oldLatLng:x,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(f){return this.options.radius=this._radius=f,this.redraw()},getRadius:function(){return this._radius},setStyle:function(f){var x=f&&f.radius||this._radius;return Ss.prototype.setStyle.call(this,f),this.setRadius(x),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var f=this._radius,x=this._radiusY||f,R=this._clickTolerance(),V=[f+R,x+R];this._pxBounds=new ke(this._point.subtract(V),this._point.add(V))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(f){return f.distanceTo(this._point)<=this._radius+this._clickTolerance()}});function Xu(f,x){return new Hu(f,x)}var kc=Hu.extend({initialize:function(f,x,R){if(typeof x=="number"&&(x=d({},R,{radius:x})),be(this,x),this._latlng=Xt(f),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(f){return this._mRadius=f,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var f=[this._radius,this._radiusY||this._radius];return new Ot(this._map.layerPointToLatLng(this._point.subtract(f)),this._map.layerPointToLatLng(this._point.add(f)))},setStyle:Ss.prototype.setStyle,_project:function(){var f=this._latlng.lng,x=this._latlng.lat,R=this._map,V=R.options.crs;if(V.distance===si.distance){var K=Math.PI/180,ue=this._mRadius/si.R/K,Oe=R.project([x+ue,f]),nt=R.project([x-ue,f]),ut=Oe.add(nt).divideBy(2),Mt=R.unproject(ut).lat,Kt=Math.acos((Math.cos(ue*K)-Math.sin(x*K)*Math.sin(Mt*K))/(Math.cos(x*K)*Math.cos(Mt*K)))/K;(isNaN(Kt)||Kt===0)&&(Kt=ue/Math.cos(Math.PI/180*x)),this._point=ut.subtract(R.getPixelOrigin()),this._radius=isNaN(Kt)?0:ut.x-R.project([Mt,f-Kt]).x,this._radiusY=ut.y-Oe.y}else{var pn=V.unproject(V.project(this._latlng).subtract([this._mRadius,0]));this._point=R.latLngToLayerPoint(this._latlng),this._radius=this._point.x-R.latLngToLayerPoint(pn).x}this._updateBounds()}});function Ud(f,x,R){return new kc(f,x,R)}var ll=Ss.extend({options:{smoothFactor:1,noClip:!1},initialize:function(f,x){be(this,x),this._setLatLngs(f)},getLatLngs:function(){return this._latlngs},setLatLngs:function(f){return this._setLatLngs(f),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(f){for(var x=1/0,R=null,V=kn,K,ue,Oe=0,nt=this._parts.length;Oe<nt;Oe++)for(var ut=this._parts[Oe],Mt=1,Kt=ut.length;Mt<Kt;Mt++){K=ut[Mt-1],ue=ut[Mt];var pn=V(f,K,ue,!0);pn<x&&(x=pn,R=V(f,K,ue))}return R&&(R.distance=Math.sqrt(x)),R},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return Xi(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(f,x){return x=x||this._defaultShape(),f=Xt(f),x.push(f),this._bounds.extend(f),this.redraw()},_setLatLngs:function(f){this._bounds=new Ot,this._latlngs=this._convertLatLngs(f)},_defaultShape:function(){return Wn(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(f){for(var x=[],R=Wn(f),V=0,K=f.length;V<K;V++)R?(x[V]=Xt(f[V]),this._bounds.extend(x[V])):x[V]=this._convertLatLngs(f[V]);return x},_project:function(){var f=new ke;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,f),this._bounds.isValid()&&f.isValid()&&(this._rawPxBounds=f,this._updateBounds())},_updateBounds:function(){var f=this._clickTolerance(),x=new Tt(f,f);this._rawPxBounds&&(this._pxBounds=new ke([this._rawPxBounds.min.subtract(x),this._rawPxBounds.max.add(x)]))},_projectLatlngs:function(f,x,R){var V=f[0]instanceof Jt,K=f.length,ue,Oe;if(V){for(Oe=[],ue=0;ue<K;ue++)Oe[ue]=this._map.latLngToLayerPoint(f[ue]),R.extend(Oe[ue]);x.push(Oe)}else for(ue=0;ue<K;ue++)this._projectLatlngs(f[ue],x,R)},_clipPoints:function(){var f=this._renderer._bounds;if(this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(f))){if(this.options.noClip){this._parts=this._rings;return}var x=this._parts,R,V,K,ue,Oe,nt,ut;for(R=0,K=0,ue=this._rings.length;R<ue;R++)for(ut=this._rings[R],V=0,Oe=ut.length;V<Oe-1;V++)nt=ye(ut[V],ut[V+1],f,V,!0),nt&&(x[K]=x[K]||[],x[K].push(nt[0]),(nt[1]!==ut[V+1]||V===Oe-2)&&(x[K].push(nt[1]),K++))}},_simplifyPoints:function(){for(var f=this._parts,x=this.options.smoothFactor,R=0,V=f.length;R<V;R++)f[R]=Ei(f[R],x)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(f,x){var R,V,K,ue,Oe,nt,ut=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(f))return!1;for(R=0,ue=this._parts.length;R<ue;R++)for(nt=this._parts[R],V=0,Oe=nt.length,K=Oe-1;V<Oe;K=V++)if(!(!x&&V===0)&&$u(f,nt[K],nt[V])<=ut)return!0;return!1}});function $d(f,x){return new ll(f,x)}ll._flat=wi;var Zl=ll.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return Dl(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(f){var x=ll.prototype._convertLatLngs.call(this,f),R=x.length;return R>=2&&x[0]instanceof Jt&&x[0].equals(x[R-1])&&x.pop(),x},_setLatLngs:function(f){ll.prototype._setLatLngs.call(this,f),Wn(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return Wn(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var f=this._renderer._bounds,x=this.options.weight,R=new Tt(x,x);if(f=new ke(f.min.subtract(R),f.max.add(R)),this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(f))){if(this.options.noClip){this._parts=this._rings;return}for(var V=0,K=this._rings.length,ue;V<K;V++)ue=ws(this._rings[V],f,!0),ue.length&&this._parts.push(ue)}},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(f){var x=!1,R,V,K,ue,Oe,nt,ut,Mt;if(!this._pxBounds||!this._pxBounds.contains(f))return!1;for(ue=0,ut=this._parts.length;ue<ut;ue++)for(R=this._parts[ue],Oe=0,Mt=R.length,nt=Mt-1;Oe<Mt;nt=Oe++)V=R[Oe],K=R[nt],V.y>f.y!=K.y>f.y&&f.x<(K.x-V.x)*(f.y-V.y)/(K.y-V.y)+V.x&&(x=!x);return x||ll.prototype._containsPoint.call(this,f,!0)}});function Qh(f,x){return new Zl(f,x)}var ul=co.extend({initialize:function(f,x){be(this,x),this._layers={},f&&this.addData(f)},addData:function(f){var x=qe(f)?f:f.features,R,V,K;if(x){for(R=0,V=x.length;R<V;R++)K=x[R],(K.geometries||K.geometry||K.features||K.coordinates)&&this.addData(K);return this}var ue=this.options;if(ue.filter&&!ue.filter(f))return this;var Oe=ra(f,ue);return Oe?(Oe.feature=hl(f),Oe.defaultOptions=Oe.options,this.resetStyle(Oe),ue.onEachFeature&&ue.onEachFeature(f,Oe),this.addLayer(Oe)):this},resetStyle:function(f){return f===void 0?this.eachLayer(this.resetStyle,this):(f.options=d({},f.defaultOptions),this._setLayerStyle(f,this.options.style),this)},setStyle:function(f){return this.eachLayer(function(x){this._setLayerStyle(x,f)},this)},_setLayerStyle:function(f,x){f.setStyle&&(typeof x=="function"&&(x=x(f.feature)),f.setStyle(x))}});function ra(f,x){var R=f.type==="Feature"?f.geometry:f,V=R?R.coordinates:null,K=[],ue=x&&x.pointToLayer,Oe=x&&x.coordsToLatLng||oi,nt,ut,Mt,Kt;if(!V&&!R)return null;switch(R.type){case"Point":return nt=Oe(V),Es(ue,f,nt,x);case"MultiPoint":for(Mt=0,Kt=V.length;Mt<Kt;Mt++)nt=Oe(V[Mt]),K.push(Es(ue,f,nt,x));return new co(K);case"LineString":case"MultiLineString":return ut=mu(V,R.type==="LineString"?0:1,Oe),new ll(ut,x);case"Polygon":case"MultiPolygon":return ut=mu(V,R.type==="Polygon"?1:2,Oe),new Zl(ut,x);case"GeometryCollection":for(Mt=0,Kt=R.geometries.length;Mt<Kt;Mt++){var pn=ra({geometry:R.geometries[Mt],type:"Feature",properties:f.properties},x);pn&&K.push(pn)}return new co(K);case"FeatureCollection":for(Mt=0,Kt=R.features.length;Mt<Kt;Mt++){var Yn=ra(R.features[Mt],x);Yn&&K.push(Yn)}return new co(K);default:throw new Error("Invalid GeoJSON object.")}}function Es(f,x,R,V){return f?f(x,R):new pu(R,V&&V.markersInheritOptions&&V)}function oi(f){return new Jt(f[1],f[0],f[2])}function mu(f,x,R){for(var V=[],K=0,ue=f.length,Oe;K<ue;K++)Oe=x?mu(f[K],x-1,R):(R||oi)(f[K]),V.push(Oe);return V}function Wu(f,x){return f=Xt(f),f.alt!==void 0?[ee(f.lng,x),ee(f.lat,x),ee(f.alt,x)]:[ee(f.lng,x),ee(f.lat,x)]}function Ku(f,x,R,V){for(var K=[],ue=0,Oe=f.length;ue<Oe;ue++)K.push(x?Ku(f[ue],Wn(f[ue])?0:x-1,R,V):Wu(f[ue],V));return!x&&R&&K.length>0&&K.push(K[0].slice()),K}function cl(f,x){return f.feature?d({},f.feature,{geometry:x}):hl(x)}function hl(f){return f.type==="Feature"||f.type==="FeatureCollection"?f:{type:"Feature",properties:{},geometry:f}}var dl={toGeoJSON:function(f){return cl(this,{type:"Point",coordinates:Wu(this.getLatLng(),f)})}};pu.include(dl),kc.include(dl),Hu.include(dl),ll.include({toGeoJSON:function(f){var x=!Wn(this._latlngs),R=Ku(this._latlngs,x?1:0,!1,f);return cl(this,{type:(x?"Multi":"")+"LineString",coordinates:R})}}),Zl.include({toGeoJSON:function(f){var x=!Wn(this._latlngs),R=x&&!Wn(this._latlngs[0]),V=Ku(this._latlngs,R?2:x?1:0,!0,f);return x||(V=[V]),cl(this,{type:(R?"Multi":"")+"Polygon",coordinates:V})}}),qu.include({toMultiPoint:function(f){var x=[];return this.eachLayer(function(R){x.push(R.toGeoJSON(f).geometry.coordinates)}),cl(this,{type:"MultiPoint",coordinates:x})},toGeoJSON:function(f){var x=this.feature&&this.feature.geometry&&this.feature.geometry.type;if(x==="MultiPoint")return this.toMultiPoint(f);var R=x==="GeometryCollection",V=[];return this.eachLayer(function(K){if(K.toGeoJSON){var ue=K.toGeoJSON(f);if(R)V.push(ue.geometry);else{var Oe=hl(ue);Oe.type==="FeatureCollection"?V.push.apply(V,Oe.features):V.push(Oe)}}}),R?cl(this,{geometries:V,type:"GeometryCollection"}):{type:"FeatureCollection",features:V}}});function fh(f,x){return new ul(f,x)}var Dc=fh,Yu=Ks.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(f,x,R){this._url=f,this._bounds=jt(x),be(this,R)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(on(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){ci(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(f){return this.options.opacity=f,this._image&&this._updateOpacity(),this},setStyle:function(f){return f.opacity&&this.setOpacity(f.opacity),this},bringToFront:function(){return this._map&&br(this._image),this},bringToBack:function(){return this._map&&qs(this._image),this},setUrl:function(f){return this._url=f,this._image&&(this._image.src=f),this},setBounds:function(f){return this._bounds=jt(f),this._map&&this._reset(),this},getEvents:function(){var f={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(f.zoomanim=this._animateZoom),f},setZIndex:function(f){return this.options.zIndex=f,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var f=this._url.tagName==="IMG",x=this._image=f?this._url:ni("img");if(on(x,"leaflet-image-layer"),this._zoomAnimated&&on(x,"leaflet-zoom-animated"),this.options.className&&on(x,this.options.className),x.onselectstart=G,x.onmousemove=G,x.onload=_(this.fire,this,"load"),x.onerror=_(this._overlayOnError,this,"error"),(this.options.crossOrigin||this.options.crossOrigin==="")&&(x.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),f){this._url=x.src;return}x.src=this._url,x.alt=this.options.alt},_animateZoom:function(f){var x=this._map.getZoomScale(f.zoom),R=this._map._latLngBoundsToNewLayerBounds(this._bounds,f.zoom,f.center).min;Gs(this._image,R,x)},_reset:function(){var f=this._image,x=new ke(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),R=x.getSize();rr(f,x.min),f.style.width=R.x+"px",f.style.height=R.y+"px"},_updateOpacity:function(){ir(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var f=this.options.errorOverlayUrl;f&&this._url!==f&&(this._url=f,this._image.src=f)},getCenter:function(){return this._bounds.getCenter()}}),qd=function(f,x,R){return new Yu(f,x,R)},Ol=Yu.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var f=this._url.tagName==="VIDEO",x=this._image=f?this._url:ni("video");if(on(x,"leaflet-image-layer"),this._zoomAnimated&&on(x,"leaflet-zoom-animated"),this.options.className&&on(x,this.options.className),x.onselectstart=G,x.onmousemove=G,x.onloadeddata=_(this.fire,this,"load"),f){for(var R=x.getElementsByTagName("source"),V=[],K=0;K<R.length;K++)V.push(R[K].src);this._url=R.length>0?V:[x.src];return}qe(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(x.style,"objectFit")&&(x.style.objectFit="fill"),x.autoplay=!!this.options.autoplay,x.loop=!!this.options.loop,x.muted=!!this.options.muted,x.playsInline=!!this.options.playsInline;for(var ue=0;ue<this._url.length;ue++){var Oe=ni("source");Oe.src=this._url[ue],x.appendChild(Oe)}}});function Qu(f,x,R){return new Ol(f,x,R)}var zc=Yu.extend({_initImage:function(){var f=this._image=this._url;on(f,"leaflet-image-layer"),this._zoomAnimated&&on(f,"leaflet-zoom-animated"),this.options.className&&on(f,this.options.className),f.onselectstart=G,f.onmousemove=G}});function Oc(f,x,R){return new zc(f,x,R)}var aa=Ks.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(f,x){f&&(f instanceof Jt||qe(f))?(this._latlng=Xt(f),be(this,x)):(be(this,f),this._source=x),this.options.content&&(this._content=this.options.content)},openOn:function(f){return f=arguments.length?f:this._source._map,f.hasLayer(this)||f.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(f){return this._map?this.close():(arguments.length?this._source=f:f=this._source,this._prepareOpen(),this.openOn(f._map)),this},onAdd:function(f){this._zoomAnimated=f._zoomAnimated,this._container||this._initLayout(),f._fadeAnimated&&ir(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),f._fadeAnimated&&ir(this._container,1),this.bringToFront(),this.options.interactive&&(on(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(f){f._fadeAnimated?(ir(this._container,0),this._removeTimeout=setTimeout(_(ci,void 0,this._container),200)):ci(this._container),this.options.interactive&&(Fi(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(f){return this._latlng=Xt(f),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(f){return this._content=f,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var f={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(f.zoomanim=this._animateZoom),f},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&br(this._container),this},bringToBack:function(){return this._map&&qs(this._container),this},_prepareOpen:function(f){var x=this._source;if(!x._map)return!1;if(x instanceof co){x=null;var R=this._source._layers;for(var V in R)if(R[V]._map){x=R[V];break}if(!x)return!1;this._source=x}if(!f)if(x.getCenter)f=x.getCenter();else if(x.getLatLng)f=x.getLatLng();else if(x.getBounds)f=x.getBounds().getCenter();else throw new Error("Unable to get source layer LatLng.");return this.setLatLng(f),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var f=this._contentNode,x=typeof this._content=="function"?this._content(this._source||this):this._content;if(typeof x=="string")f.innerHTML=x;else{for(;f.hasChildNodes();)f.removeChild(f.firstChild);f.appendChild(x)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var f=this._map.latLngToLayerPoint(this._latlng),x=Bt(this.options.offset),R=this._getAnchor();this._zoomAnimated?rr(this._container,f.add(R)):x=x.add(f).add(R);var V=this._containerBottom=-x.y,K=this._containerLeft=-Math.round(this._containerWidth/2)+x.x;this._container.style.bottom=V+"px",this._container.style.left=K+"px"}},_getAnchor:function(){return[0,0]}});Xn.include({_initOverlay:function(f,x,R,V){var K=x;return K instanceof f||(K=new f(V).setContent(x)),R&&K.setLatLng(R),K}}),Ks.include({_initOverlay:function(f,x,R,V){var K=R;return K instanceof f?(be(K,V),K._source=this):(K=x&&!V?x:new f(V,this),K.setContent(R)),K}});var Hl=aa.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(f){return f=arguments.length?f:this._source._map,!f.hasLayer(this)&&f._popup&&f._popup.options.autoClose&&f.removeLayer(f._popup),f._popup=this,aa.prototype.openOn.call(this,f)},onAdd:function(f){aa.prototype.onAdd.call(this,f),f.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof Ss||this._source.on("preclick",bn))},onRemove:function(f){aa.prototype.onRemove.call(this,f),f.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof Ss||this._source.off("preclick",bn))},getEvents:function(){var f=aa.prototype.getEvents.call(this);return(this.options.closeOnClick!==void 0?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(f.preclick=this.close),this.options.keepInView&&(f.moveend=this._adjustPan),f},_initLayout:function(){var f="leaflet-popup",x=this._container=ni("div",f+" "+(this.options.className||"")+" leaflet-zoom-animated"),R=this._wrapper=ni("div",f+"-content-wrapper",x);if(this._contentNode=ni("div",f+"-content",R),fn(x),fa(this._contentNode),hn(x,"contextmenu",bn),this._tipContainer=ni("div",f+"-tip-container",x),this._tip=ni("div",f+"-tip",this._tipContainer),this.options.closeButton){var V=this._closeButton=ni("a",f+"-close-button",x);V.setAttribute("role","button"),V.setAttribute("aria-label","Close popup"),V.href="#close",V.innerHTML='<span aria-hidden="true">&#215;</span>',hn(V,"click",function(K){sn(K),this.close()},this)}},_updateLayout:function(){var f=this._contentNode,x=f.style;x.width="",x.whiteSpace="nowrap";var R=f.offsetWidth;R=Math.min(R,this.options.maxWidth),R=Math.max(R,this.options.minWidth),x.width=R+1+"px",x.whiteSpace="",x.height="";var V=f.offsetHeight,K=this.options.maxHeight,ue="leaflet-popup-scrolled";K&&V>K?(x.height=K+"px",on(f,ue)):Fi(f,ue),this._containerWidth=this._container.offsetWidth},_animateZoom:function(f){var x=this._map._latLngToNewLayerPoint(this._latlng,f.zoom,f.center),R=this._getAnchor();rr(this._container,x.add(R))},_adjustPan:function(){if(this.options.autoPan){if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning){this._autopanning=!1;return}var f=this._map,x=parseInt(rl(this._container,"marginBottom"),10)||0,R=this._container.offsetHeight+x,V=this._containerWidth,K=new Tt(this._containerLeft,-R-this._containerBottom);K._add(Qa(this._container));var ue=f.layerPointToContainerPoint(K),Oe=Bt(this.options.autoPanPadding),nt=Bt(this.options.autoPanPaddingTopLeft||Oe),ut=Bt(this.options.autoPanPaddingBottomRight||Oe),Mt=f.getSize(),Kt=0,pn=0;ue.x+V+ut.x>Mt.x&&(Kt=ue.x+V-Mt.x+ut.x),ue.x-Kt-nt.x<0&&(Kt=ue.x-nt.x),ue.y+R+ut.y>Mt.y&&(pn=ue.y+R-Mt.y+ut.y),ue.y-pn-nt.y<0&&(pn=ue.y-nt.y),(Kt||pn)&&(this.options.keepInView&&(this._autopanning=!0),f.fire("autopanstart").panBy([Kt,pn]))}},_getAnchor:function(){return Bt(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),ph=function(f,x){return new Hl(f,x)};Xn.mergeOptions({closePopupOnClick:!0}),Xn.include({openPopup:function(f,x,R){return this._initOverlay(Hl,f,x,R).openOn(this),this},closePopup:function(f){return f=arguments.length?f:this._popup,f&&f.close(),this}}),Ks.include({bindPopup:function(f,x){return this._popup=this._initOverlay(Hl,this._popup,f,x),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(f){return this._popup&&(this instanceof co||(this._popup._source=this),this._popup._prepareOpen(f||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return this._popup?this._popup.isOpen():!1},setPopupContent:function(f){return this._popup&&this._popup.setContent(f),this},getPopup:function(){return this._popup},_openPopup:function(f){if(!(!this._popup||!this._map)){na(f);var x=f.layer||f.target;if(this._popup._source===x&&!(x instanceof Ss)){this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(f.latlng);return}this._popup._source=x,this.openPopup(f.latlng)}},_movePopup:function(f){this._popup.setLatLng(f.latlng)},_onKeyPress:function(f){f.originalEvent.keyCode===13&&this._openPopup(f)}});var Lo=aa.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(f){aa.prototype.onAdd.call(this,f),this.setOpacity(this.options.opacity),f.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(f){aa.prototype.onRemove.call(this,f),f.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var f=aa.prototype.getEvents.call(this);return this.options.permanent||(f.preclick=this.close),f},_initLayout:function(){var f="leaflet-tooltip",x=f+" "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=ni("div",x),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+M(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(f){var x,R,V=this._map,K=this._container,ue=V.latLngToContainerPoint(V.getCenter()),Oe=V.layerPointToContainerPoint(f),nt=this.options.direction,ut=K.offsetWidth,Mt=K.offsetHeight,Kt=Bt(this.options.offset),pn=this._getAnchor();nt==="top"?(x=ut/2,R=Mt):nt==="bottom"?(x=ut/2,R=0):nt==="center"?(x=ut/2,R=Mt/2):nt==="right"?(x=0,R=Mt/2):nt==="left"?(x=ut,R=Mt/2):Oe.x<ue.x?(nt="right",x=0,R=Mt/2):(nt="left",x=ut+(Kt.x+pn.x)*2,R=Mt/2),f=f.subtract(Bt(x,R,!0)).add(Kt).add(pn),Fi(K,"leaflet-tooltip-right"),Fi(K,"leaflet-tooltip-left"),Fi(K,"leaflet-tooltip-top"),Fi(K,"leaflet-tooltip-bottom"),on(K,"leaflet-tooltip-"+nt),rr(K,f)},_updatePosition:function(){var f=this._map.latLngToLayerPoint(this._latlng);this._setPosition(f)},setOpacity:function(f){this.options.opacity=f,this._container&&ir(this._container,f)},_animateZoom:function(f){var x=this._map._latLngToNewLayerPoint(this._latlng,f.zoom,f.center);this._setPosition(x)},_getAnchor:function(){return Bt(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),Nc=function(f,x){return new Lo(f,x)};Xn.include({openTooltip:function(f,x,R){return this._initOverlay(Lo,f,x,R).openOn(this),this},closeTooltip:function(f){return f.close(),this}}),Ks.include({bindTooltip:function(f,x){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(Lo,this._tooltip,f,x),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(f){if(!(!f&&this._tooltipHandlersAdded)){var x=f?"off":"on",R={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?R.add=this._openTooltip:(R.mouseover=this._openTooltip,R.mouseout=this.closeTooltip,R.click=this._openTooltip,this._map?this._addFocusListeners():R.add=this._addFocusListeners),this._tooltip.options.sticky&&(R.mousemove=this._moveTooltip),this[x](R),this._tooltipHandlersAdded=!f}},openTooltip:function(f){return this._tooltip&&(this instanceof co||(this._tooltip._source=this),this._tooltip._prepareOpen(f)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(f){return this._tooltip&&this._tooltip.setContent(f),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(f){var x=typeof f.getElement=="function"&&f.getElement();x&&(hn(x,"focus",function(){this._tooltip._source=f,this.openTooltip()},this),hn(x,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(f){var x=typeof f.getElement=="function"&&f.getElement();x&&x.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(f){if(!(!this._tooltip||!this._map)){if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var x=this;this._map.once("moveend",function(){x._openOnceFlag=!1,x._openTooltip(f)});return}this._tooltip._source=f.layer||f.target,this.openTooltip(this._tooltip.options.sticky?f.latlng:void 0)}},_moveTooltip:function(f){var x=f.latlng,R,V;this._tooltip.options.sticky&&f.originalEvent&&(R=this._map.mouseEventToContainerPoint(f.originalEvent),V=this._map.containerPointToLayerPoint(R),x=this._map.layerPointToLatLng(V)),this._tooltip.setLatLng(x)}});var gu=Ys.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(f){var x=f&&f.tagName==="DIV"?f:document.createElement("div"),R=this.options;if(R.html instanceof Element?(qi(x),x.appendChild(R.html)):x.innerHTML=R.html!==!1?R.html:"",R.bgPos){var V=Bt(R.bgPos);x.style.backgroundPosition=-V.x+"px "+-V.y+"px"}return this._setIconStyles(x,"icon"),x},createShadow:function(){return null}});function ho(f){return new gu(f)}Ys.Default=Zu;var _u=Ks.extend({options:{tileSize:256,opacity:1,updateWhenIdle:en.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(f){be(this,f)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(f){f._addZoomLimit(this)},onRemove:function(f){this._removeAllTiles(),ci(this._container),f._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(br(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(qs(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(f){return this.options.opacity=f,this._updateOpacity(),this},setZIndex:function(f){return this.options.zIndex=f,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var f=this._clampZoom(this._map.getZoom());f!==this._tileZoom&&(this._tileZoom=f,this._updateLevels()),this._update()}return this},getEvents:function(){var f={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=k(this._onMoveEnd,this.options.updateInterval,this)),f.move=this._onMove),this._zoomAnimated&&(f.zoomanim=this._animateZoom),f},createTile:function(){return document.createElement("div")},getTileSize:function(){var f=this.options.tileSize;return f instanceof Tt?f:new Tt(f,f)},_updateZIndex:function(){this._container&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(f){for(var x=this.getPane().children,R=-f(-1/0,1/0),V=0,K=x.length,ue;V<K;V++)ue=x[V].style.zIndex,x[V]!==this._container&&ue&&(R=f(R,+ue));isFinite(R)&&(this.options.zIndex=R+f(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!en.ielt9){ir(this._container,this.options.opacity);var f=+new Date,x=!1,R=!1;for(var V in this._tiles){var K=this._tiles[V];if(!(!K.current||!K.loaded)){var ue=Math.min(1,(f-K.loaded)/200);ir(K.el,ue),ue<1?x=!0:(K.active?R=!0:this._onOpaqueTile(K),K.active=!0)}}R&&!this._noPrune&&this._pruneTiles(),x&&(Ge(this._fadeFrame),this._fadeFrame=Pe(this._updateOpacity,this))}},_onOpaqueTile:G,_initContainer:function(){this._container||(this._container=ni("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var f=this._tileZoom,x=this.options.maxZoom;if(f!==void 0){for(var R in this._levels)R=Number(R),this._levels[R].el.children.length||R===f?(this._levels[R].el.style.zIndex=x-Math.abs(f-R),this._onUpdateLevel(R)):(ci(this._levels[R].el),this._removeTilesAtZoom(R),this._onRemoveLevel(R),delete this._levels[R]);var V=this._levels[f],K=this._map;return V||(V=this._levels[f]={},V.el=ni("div","leaflet-tile-container leaflet-zoom-animated",this._container),V.el.style.zIndex=x,V.origin=K.project(K.unproject(K.getPixelOrigin()),f).round(),V.zoom=f,this._setZoomTransform(V,K.getCenter(),K.getZoom()),G(V.el.offsetWidth),this._onCreateLevel(V)),this._level=V,V}},_onUpdateLevel:G,_onRemoveLevel:G,_onCreateLevel:G,_pruneTiles:function(){if(this._map){var f,x,R=this._map.getZoom();if(R>this.options.maxZoom||R<this.options.minZoom){this._removeAllTiles();return}for(f in this._tiles)x=this._tiles[f],x.retain=x.current;for(f in this._tiles)if(x=this._tiles[f],x.current&&!x.active){var V=x.coords;this._retainParent(V.x,V.y,V.z,V.z-5)||this._retainChildren(V.x,V.y,V.z,V.z+2)}for(f in this._tiles)this._tiles[f].retain||this._removeTile(f)}},_removeTilesAtZoom:function(f){for(var x in this._tiles)this._tiles[x].coords.z===f&&this._removeTile(x)},_removeAllTiles:function(){for(var f in this._tiles)this._removeTile(f)},_invalidateAll:function(){for(var f in this._levels)ci(this._levels[f].el),this._onRemoveLevel(Number(f)),delete this._levels[f];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(f,x,R,V){var K=Math.floor(f/2),ue=Math.floor(x/2),Oe=R-1,nt=new Tt(+K,+ue);nt.z=+Oe;var ut=this._tileCoordsToKey(nt),Mt=this._tiles[ut];return Mt&&Mt.active?(Mt.retain=!0,!0):(Mt&&Mt.loaded&&(Mt.retain=!0),Oe>V?this._retainParent(K,ue,Oe,V):!1)},_retainChildren:function(f,x,R,V){for(var K=2*f;K<2*f+2;K++)for(var ue=2*x;ue<2*x+2;ue++){var Oe=new Tt(K,ue);Oe.z=R+1;var nt=this._tileCoordsToKey(Oe),ut=this._tiles[nt];if(ut&&ut.active){ut.retain=!0;continue}else ut&&ut.loaded&&(ut.retain=!0);R+1<V&&this._retainChildren(K,ue,R+1,V)}},_resetView:function(f){var x=f&&(f.pinch||f.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),x,x)},_animateZoom:function(f){this._setView(f.center,f.zoom,!0,f.noUpdate)},_clampZoom:function(f){var x=this.options;return x.minNativeZoom!==void 0&&f<x.minNativeZoom?x.minNativeZoom:x.maxNativeZoom!==void 0&&x.maxNativeZoom<f?x.maxNativeZoom:f},_setView:function(f,x,R,V){var K=Math.round(x);this.options.maxZoom!==void 0&&K>this.options.maxZoom||this.options.minZoom!==void 0&&K<this.options.minZoom?K=void 0:K=this._clampZoom(K);var ue=this.options.updateWhenZooming&&K!==this._tileZoom;(!V||ue)&&(this._tileZoom=K,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),K!==void 0&&this._update(f),R||this._pruneTiles(),this._noPrune=!!R),this._setZoomTransforms(f,x)},_setZoomTransforms:function(f,x){for(var R in this._levels)this._setZoomTransform(this._levels[R],f,x)},_setZoomTransform:function(f,x,R){var V=this._map.getZoomScale(R,f.zoom),K=f.origin.multiplyBy(V).subtract(this._map._getNewPixelOrigin(x,R)).round();en.any3d?Gs(f.el,K,V):rr(f.el,K)},_resetGrid:function(){var f=this._map,x=f.options.crs,R=this._tileSize=this.getTileSize(),V=this._tileZoom,K=this._map.getPixelWorldBounds(this._tileZoom);K&&(this._globalTileRange=this._pxBoundsToTileRange(K)),this._wrapX=x.wrapLng&&!this.options.noWrap&&[Math.floor(f.project([0,x.wrapLng[0]],V).x/R.x),Math.ceil(f.project([0,x.wrapLng[1]],V).x/R.y)],this._wrapY=x.wrapLat&&!this.options.noWrap&&[Math.floor(f.project([x.wrapLat[0],0],V).y/R.x),Math.ceil(f.project([x.wrapLat[1],0],V).y/R.y)]},_onMoveEnd:function(){!this._map||this._map._animatingZoom||this._update()},_getTiledPixelBounds:function(f){var x=this._map,R=x._animatingZoom?Math.max(x._animateToZoom,x.getZoom()):x.getZoom(),V=x.getZoomScale(R,this._tileZoom),K=x.project(f,this._tileZoom).floor(),ue=x.getSize().divideBy(V*2);return new ke(K.subtract(ue),K.add(ue))},_update:function(f){var x=this._map;if(x){var R=this._clampZoom(x.getZoom());if(f===void 0&&(f=x.getCenter()),this._tileZoom!==void 0){var V=this._getTiledPixelBounds(f),K=this._pxBoundsToTileRange(V),ue=K.getCenter(),Oe=[],nt=this.options.keepBuffer,ut=new ke(K.getBottomLeft().subtract([nt,-nt]),K.getTopRight().add([nt,-nt]));if(!(isFinite(K.min.x)&&isFinite(K.min.y)&&isFinite(K.max.x)&&isFinite(K.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var Mt in this._tiles){var Kt=this._tiles[Mt].coords;(Kt.z!==this._tileZoom||!ut.contains(new Tt(Kt.x,Kt.y)))&&(this._tiles[Mt].current=!1)}if(Math.abs(R-this._tileZoom)>1){this._setView(f,R);return}for(var pn=K.min.y;pn<=K.max.y;pn++)for(var Yn=K.min.x;Yn<=K.max.x;Yn++){var ga=new Tt(Yn,pn);if(ga.z=this._tileZoom,!!this._isValidTile(ga)){var Zr=this._tiles[this._tileCoordsToKey(ga)];Zr?Zr.current=!0:Oe.push(ga)}}if(Oe.sort(function(Ti,Ri){return Ti.distanceTo(ue)-Ri.distanceTo(ue)}),Oe.length!==0){this._loading||(this._loading=!0,this.fire("loading"));var Za=document.createDocumentFragment();for(Yn=0;Yn<Oe.length;Yn++)this._addTile(Oe[Yn],Za);this._level.el.appendChild(Za)}}}},_isValidTile:function(f){var x=this._map.options.crs;if(!x.infinite){var R=this._globalTileRange;if(!x.wrapLng&&(f.x<R.min.x||f.x>R.max.x)||!x.wrapLat&&(f.y<R.min.y||f.y>R.max.y))return!1}if(!this.options.bounds)return!0;var V=this._tileCoordsToBounds(f);return jt(this.options.bounds).overlaps(V)},_keyToBounds:function(f){return this._tileCoordsToBounds(this._keyToTileCoords(f))},_tileCoordsToNwSe:function(f){var x=this._map,R=this.getTileSize(),V=f.scaleBy(R),K=V.add(R),ue=x.unproject(V,f.z),Oe=x.unproject(K,f.z);return[ue,Oe]},_tileCoordsToBounds:function(f){var x=this._tileCoordsToNwSe(f),R=new Ot(x[0],x[1]);return this.options.noWrap||(R=this._map.wrapLatLngBounds(R)),R},_tileCoordsToKey:function(f){return f.x+":"+f.y+":"+f.z},_keyToTileCoords:function(f){var x=f.split(":"),R=new Tt(+x[0],+x[1]);return R.z=+x[2],R},_removeTile:function(f){var x=this._tiles[f];x&&(ci(x.el),delete this._tiles[f],this.fire("tileunload",{tile:x.el,coords:this._keyToTileCoords(f)}))},_initTile:function(f){on(f,"leaflet-tile");var x=this.getTileSize();f.style.width=x.x+"px",f.style.height=x.y+"px",f.onselectstart=G,f.onmousemove=G,en.ielt9&&this.options.opacity<1&&ir(f,this.options.opacity)},_addTile:function(f,x){var R=this._getTilePos(f),V=this._tileCoordsToKey(f),K=this.createTile(this._wrapCoords(f),_(this._tileReady,this,f));this._initTile(K),this.createTile.length<2&&Pe(_(this._tileReady,this,f,null,K)),rr(K,R),this._tiles[V]={el:K,coords:f,current:!0},x.appendChild(K),this.fire("tileloadstart",{tile:K,coords:f})},_tileReady:function(f,x,R){x&&this.fire("tileerror",{error:x,tile:R,coords:f});var V=this._tileCoordsToKey(f);R=this._tiles[V],R&&(R.loaded=+new Date,this._map._fadeAnimated?(ir(R.el,0),Ge(this._fadeFrame),this._fadeFrame=Pe(this._updateOpacity,this)):(R.active=!0,this._pruneTiles()),x||(on(R.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:R.el,coords:f})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),en.ielt9||!this._map._fadeAnimated?Pe(this._pruneTiles,this):setTimeout(_(this._pruneTiles,this),250)))},_getTilePos:function(f){return f.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(f){var x=new Tt(this._wrapX?j(f.x,this._wrapX):f.x,this._wrapY?j(f.y,this._wrapY):f.y);return x.z=f.z,x},_pxBoundsToTileRange:function(f){var x=this.getTileSize();return new ke(f.min.unscaleBy(x).floor(),f.max.unscaleBy(x).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var f in this._tiles)if(!this._tiles[f].loaded)return!1;return!0}});function Jh(f){return new _u(f)}var fl=_u.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(f,x){this._url=f,x=be(this,x),x.detectRetina&&en.retina&&x.maxZoom>0?(x.tileSize=Math.floor(x.tileSize/2),x.zoomReverse?(x.zoomOffset--,x.minZoom=Math.min(x.maxZoom,x.minZoom+1)):(x.zoomOffset++,x.maxZoom=Math.max(x.minZoom,x.maxZoom-1)),x.minZoom=Math.max(0,x.minZoom)):x.zoomReverse?x.minZoom=Math.min(x.maxZoom,x.minZoom):x.maxZoom=Math.max(x.minZoom,x.maxZoom),typeof x.subdomains=="string"&&(x.subdomains=x.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(f,x){return this._url===f&&x===void 0&&(x=!0),this._url=f,x||this.redraw(),this},createTile:function(f,x){var R=document.createElement("img");return hn(R,"load",_(this._tileOnLoad,this,x,R)),hn(R,"error",_(this._tileOnError,this,x,R)),(this.options.crossOrigin||this.options.crossOrigin==="")&&(R.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),typeof this.options.referrerPolicy=="string"&&(R.referrerPolicy=this.options.referrerPolicy),R.alt="",R.src=this.getTileUrl(f),R},getTileUrl:function(f){var x={r:en.retina?"@2x":"",s:this._getSubdomain(f),x:f.x,y:f.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var R=this._globalTileRange.max.y-f.y;this.options.tms&&(x.y=R),x["-y"]=R}return Je(this._url,d(x,this.options))},_tileOnLoad:function(f,x){en.ielt9?setTimeout(_(f,this,null,x),0):f(null,x)},_tileOnError:function(f,x,R){var V=this.options.errorTileUrl;V&&x.getAttribute("src")!==V&&(x.src=V),f(R,x)},_onTileRemove:function(f){f.tile.onload=null},_getZoomForUrl:function(){var f=this._tileZoom,x=this.options.maxZoom,R=this.options.zoomReverse,V=this.options.zoomOffset;return R&&(f=x-f),f+V},_getSubdomain:function(f){var x=Math.abs(f.x+f.y)%this.options.subdomains.length;return this.options.subdomains[x]},_abortLoading:function(){var f,x;for(f in this._tiles)if(this._tiles[f].coords.z!==this._tileZoom&&(x=this._tiles[f].el,x.onload=G,x.onerror=G,!x.complete)){x.src=Ue;var R=this._tiles[f].coords;ci(x),delete this._tiles[f],this.fire("tileabort",{tile:x,coords:R})}},_removeTile:function(f){var x=this._tiles[f];if(x)return x.el.setAttribute("src",Ue),_u.prototype._removeTile.call(this,f)},_tileReady:function(f,x,R){if(!(!this._map||R&&R.getAttribute("src")===Ue))return _u.prototype._tileReady.call(this,f,x,R)}});function pa(f,x){return new fl(f,x)}var Xl=fl.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(f,x){this._url=f;var R=d({},this.defaultWmsParams);for(var V in x)V in this.options||(R[V]=x[V]);x=be(this,x);var K=x.detectRetina&&en.retina?2:1,ue=this.getTileSize();R.width=ue.x*K,R.height=ue.y*K,this.wmsParams=R},onAdd:function(f){this._crs=this.options.crs||f.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var x=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[x]=this._crs.code,fl.prototype.onAdd.call(this,f)},getTileUrl:function(f){var x=this._tileCoordsToNwSe(f),R=this._crs,V=vt(R.project(x[0]),R.project(x[1])),K=V.min,ue=V.max,Oe=(this._wmsVersion>=1.3&&this._crs===Ws?[K.y,K.x,ue.y,ue.x]:[K.x,K.y,ue.x,ue.y]).join(","),nt=fl.prototype.getTileUrl.call(this,f);return nt+Ne(this.wmsParams,nt,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+Oe},setParams:function(f,x){return d(this.wmsParams,f),x||this.redraw(),this}});function ts(f,x){return new Xl(f,x)}fl.WMS=Xl,pa.wms=ts;var ma=Ks.extend({options:{padding:.1},initialize:function(f){be(this,f),M(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),on(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var f={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(f.zoomanim=this._onAnimZoom),f},_onAnimZoom:function(f){this._updateTransform(f.center,f.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(f,x){var R=this._map.getZoomScale(x,this._zoom),V=this._map.getSize().multiplyBy(.5+this.options.padding),K=this._map.project(this._center,x),ue=V.multiplyBy(-R).add(K).subtract(this._map._getNewPixelOrigin(f,x));en.any3d?Gs(this._container,ue,R):rr(this._container,ue)},_reset:function(){this._update(),this._updateTransform(this._center,this._zoom);for(var f in this._layers)this._layers[f]._reset()},_onZoomEnd:function(){for(var f in this._layers)this._layers[f]._project()},_updatePaths:function(){for(var f in this._layers)this._layers[f]._update()},_update:function(){var f=this.options.padding,x=this._map.getSize(),R=this._map.containerPointToLayerPoint(x.multiplyBy(-f)).round();this._bounds=new ke(R,R.add(x.multiplyBy(1+f*2)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),yu=ma.extend({options:{tolerance:0},getEvents:function(){var f=ma.prototype.getEvents.call(this);return f.viewprereset=this._onViewPreReset,f},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){ma.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var f=this._container=document.createElement("canvas");hn(f,"mousemove",this._onMouseMove,this),hn(f,"click dblclick mousedown mouseup contextmenu",this._onClick,this),hn(f,"mouseout",this._handleMouseOut,this),f._leaflet_disable_events=!0,this._ctx=f.getContext("2d")},_destroyContainer:function(){Ge(this._redrawRequest),delete this._ctx,ci(this._container),xn(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){var f;this._redrawBounds=null;for(var x in this._layers)f=this._layers[x],f._update();this._redraw()}},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){ma.prototype._update.call(this);var f=this._bounds,x=this._container,R=f.getSize(),V=en.retina?2:1;rr(x,f.min),x.width=V*R.x,x.height=V*R.y,x.style.width=R.x+"px",x.style.height=R.y+"px",en.retina&&this._ctx.scale(2,2),this._ctx.translate(-f.min.x,-f.min.y),this.fire("update")}},_reset:function(){ma.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(f){this._updateDashArray(f),this._layers[M(f)]=f;var x=f._order={layer:f,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=x),this._drawLast=x,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(f){this._requestRedraw(f)},_removePath:function(f){var x=f._order,R=x.next,V=x.prev;R?R.prev=V:this._drawLast=V,V?V.next=R:this._drawFirst=R,delete f._order,delete this._layers[M(f)],this._requestRedraw(f)},_updatePath:function(f){this._extendRedrawBounds(f),f._project(),f._update(),this._requestRedraw(f)},_updateStyle:function(f){this._updateDashArray(f),this._requestRedraw(f)},_updateDashArray:function(f){if(typeof f.options.dashArray=="string"){var x=f.options.dashArray.split(/[, ]+/),R=[],V,K;for(K=0;K<x.length;K++){if(V=Number(x[K]),isNaN(V))return;R.push(V)}f.options._dashArray=R}else f.options._dashArray=f.options.dashArray},_requestRedraw:function(f){this._map&&(this._extendRedrawBounds(f),this._redrawRequest=this._redrawRequest||Pe(this._redraw,this))},_extendRedrawBounds:function(f){if(f._pxBounds){var x=(f.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new ke,this._redrawBounds.extend(f._pxBounds.min.subtract([x,x])),this._redrawBounds.extend(f._pxBounds.max.add([x,x]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var f=this._redrawBounds;if(f){var x=f.getSize();this._ctx.clearRect(f.min.x,f.min.y,x.x,x.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var f,x=this._redrawBounds;if(this._ctx.save(),x){var R=x.getSize();this._ctx.beginPath(),this._ctx.rect(x.min.x,x.min.y,R.x,R.y),this._ctx.clip()}this._drawing=!0;for(var V=this._drawFirst;V;V=V.next)f=V.layer,(!x||f._pxBounds&&f._pxBounds.intersects(x))&&f._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(f,x){if(this._drawing){var R,V,K,ue,Oe=f._parts,nt=Oe.length,ut=this._ctx;if(nt){for(ut.beginPath(),R=0;R<nt;R++){for(V=0,K=Oe[R].length;V<K;V++)ue=Oe[R][V],ut[V?"lineTo":"moveTo"](ue.x,ue.y);x&&ut.closePath()}this._fillStroke(ut,f)}}},_updateCircle:function(f){if(!(!this._drawing||f._empty())){var x=f._point,R=this._ctx,V=Math.max(Math.round(f._radius),1),K=(Math.max(Math.round(f._radiusY),1)||V)/V;K!==1&&(R.save(),R.scale(1,K)),R.beginPath(),R.arc(x.x,x.y/K,V,0,Math.PI*2,!1),K!==1&&R.restore(),this._fillStroke(R,f)}},_fillStroke:function(f,x){var R=x.options;R.fill&&(f.globalAlpha=R.fillOpacity,f.fillStyle=R.fillColor||R.color,f.fill(R.fillRule||"evenodd")),R.stroke&&R.weight!==0&&(f.setLineDash&&f.setLineDash(x.options&&x.options._dashArray||[]),f.globalAlpha=R.opacity,f.lineWidth=R.weight,f.strokeStyle=R.color,f.lineCap=R.lineCap,f.lineJoin=R.lineJoin,f.stroke())},_onClick:function(f){for(var x=this._map.mouseEventToLayerPoint(f),R,V,K=this._drawFirst;K;K=K.next)R=K.layer,R.options.interactive&&R._containsPoint(x)&&(!(f.type==="click"||f.type==="preclick")||!this._map._draggableMoved(R))&&(V=R);this._fireEvent(V?[V]:!1,f)},_onMouseMove:function(f){if(!(!this._map||this._map.dragging.moving()||this._map._animatingZoom)){var x=this._map.mouseEventToLayerPoint(f);this._handleMouseHover(f,x)}},_handleMouseOut:function(f){var x=this._hoveredLayer;x&&(Fi(this._container,"leaflet-interactive"),this._fireEvent([x],f,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(f,x){if(!this._mouseHoverThrottled){for(var R,V,K=this._drawFirst;K;K=K.next)R=K.layer,R.options.interactive&&R._containsPoint(x)&&(V=R);V!==this._hoveredLayer&&(this._handleMouseOut(f),V&&(on(this._container,"leaflet-interactive"),this._fireEvent([V],f,"mouseover"),this._hoveredLayer=V)),this._fireEvent(this._hoveredLayer?[this._hoveredLayer]:!1,f),this._mouseHoverThrottled=!0,setTimeout(_(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(f,x,R){this._map._fireDOMEvent(x,R||x.type,f)},_bringToFront:function(f){var x=f._order;if(x){var R=x.next,V=x.prev;if(R)R.prev=V;else return;V?V.next=R:R&&(this._drawFirst=R),x.prev=this._drawLast,this._drawLast.next=x,x.next=null,this._drawLast=x,this._requestRedraw(f)}},_bringToBack:function(f){var x=f._order;if(x){var R=x.next,V=x.prev;if(V)V.next=R;else return;R?R.prev=V:V&&(this._drawLast=V),x.prev=null,x.next=this._drawFirst,this._drawFirst.prev=x,this._drawFirst=x,this._requestRedraw(f)}}});function Ju(f){return en.canvas?new yu(f):null}var Qs=(function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(f){return document.createElement("<lvml:"+f+' class="lvml">')}}catch{}return function(f){return document.createElement("<"+f+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}})(),pl={_initContainer:function(){this._container=ni("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(ma.prototype._update.call(this),this.fire("update"))},_initPath:function(f){var x=f._container=Qs("shape");on(x,"leaflet-vml-shape "+(this.options.className||"")),x.coordsize="1 1",f._path=Qs("path"),x.appendChild(f._path),this._updateStyle(f),this._layers[M(f)]=f},_addPath:function(f){var x=f._container;this._container.appendChild(x),f.options.interactive&&f.addInteractiveTarget(x)},_removePath:function(f){var x=f._container;ci(x),f.removeInteractiveTarget(x),delete this._layers[M(f)]},_updateStyle:function(f){var x=f._stroke,R=f._fill,V=f.options,K=f._container;K.stroked=!!V.stroke,K.filled=!!V.fill,V.stroke?(x||(x=f._stroke=Qs("stroke")),K.appendChild(x),x.weight=V.weight+"px",x.color=V.color,x.opacity=V.opacity,V.dashArray?x.dashStyle=qe(V.dashArray)?V.dashArray.join(" "):V.dashArray.replace(/( *, *)/g," "):x.dashStyle="",x.endcap=V.lineCap.replace("butt","flat"),x.joinstyle=V.lineJoin):x&&(K.removeChild(x),f._stroke=null),V.fill?(R||(R=f._fill=Qs("fill")),K.appendChild(R),R.color=V.fillColor||V.color,R.opacity=V.fillOpacity):R&&(K.removeChild(R),f._fill=null)},_updateCircle:function(f){var x=f._point.round(),R=Math.round(f._radius),V=Math.round(f._radiusY||R);this._setPath(f,f._empty()?"M0 0":"AL "+x.x+","+x.y+" "+R+","+V+" 0,"+65535*360)},_setPath:function(f,x){f._path.v=x},_bringToFront:function(f){br(f._container)},_bringToBack:function(f){qs(f._container)}},ko=en.vml?Qs:Va,Wl=ma.extend({_initContainer:function(){this._container=ko("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=ko("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){ci(this._container),xn(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){ma.prototype._update.call(this);var f=this._bounds,x=f.getSize(),R=this._container;(!this._svgSize||!this._svgSize.equals(x))&&(this._svgSize=x,R.setAttribute("width",x.x),R.setAttribute("height",x.y)),rr(R,f.min),R.setAttribute("viewBox",[f.min.x,f.min.y,x.x,x.y].join(" ")),this.fire("update")}},_initPath:function(f){var x=f._path=ko("path");f.options.className&&on(x,f.options.className),f.options.interactive&&on(x,"leaflet-interactive"),this._updateStyle(f),this._layers[M(f)]=f},_addPath:function(f){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(f._path),f.addInteractiveTarget(f._path)},_removePath:function(f){ci(f._path),f.removeInteractiveTarget(f._path),delete this._layers[M(f)]},_updatePath:function(f){f._project(),f._update()},_updateStyle:function(f){var x=f._path,R=f.options;x&&(R.stroke?(x.setAttribute("stroke",R.color),x.setAttribute("stroke-opacity",R.opacity),x.setAttribute("stroke-width",R.weight),x.setAttribute("stroke-linecap",R.lineCap),x.setAttribute("stroke-linejoin",R.lineJoin),R.dashArray?x.setAttribute("stroke-dasharray",R.dashArray):x.removeAttribute("stroke-dasharray"),R.dashOffset?x.setAttribute("stroke-dashoffset",R.dashOffset):x.removeAttribute("stroke-dashoffset")):x.setAttribute("stroke","none"),R.fill?(x.setAttribute("fill",R.fillColor||R.color),x.setAttribute("fill-opacity",R.fillOpacity),x.setAttribute("fill-rule",R.fillRule||"evenodd")):x.setAttribute("fill","none"))},_updatePoly:function(f,x){this._setPath(f,Ta(f._parts,x))},_updateCircle:function(f){var x=f._point,R=Math.max(Math.round(f._radius),1),V=Math.max(Math.round(f._radiusY),1)||R,K="a"+R+","+V+" 0 1,0 ",ue=f._empty()?"M0 0":"M"+(x.x-R)+","+x.y+K+R*2+",0 "+K+-R*2+",0 ";this._setPath(f,ue)},_setPath:function(f,x){f._path.setAttribute("d",x)},_bringToFront:function(f){br(f._path)},_bringToBack:function(f){qs(f._path)}});en.vml&&Wl.include(pl);function qn(f){return en.svg||en.vml?new Wl(f):null}Xn.include({getRenderer:function(f){var x=f.options.renderer||this._getPaneRenderer(f.options.pane)||this.options.renderer||this._renderer;return x||(x=this._renderer=this._createRenderer()),this.hasLayer(x)||this.addLayer(x),x},_getPaneRenderer:function(f){if(f==="overlayPane"||f===void 0)return!1;var x=this._paneRenderers[f];return x===void 0&&(x=this._createRenderer({pane:f}),this._paneRenderers[f]=x),x},_createRenderer:function(f){return this.options.preferCanvas&&Ju(f)||qn(f)}});var Do=Zl.extend({initialize:function(f,x){Zl.prototype.initialize.call(this,this._boundsToLatLngs(f),x)},setBounds:function(f){return this.setLatLngs(this._boundsToLatLngs(f))},_boundsToLatLngs:function(f){return f=jt(f),[f.getSouthWest(),f.getNorthWest(),f.getNorthEast(),f.getSouthEast()]}});function zf(f,x){return new Do(f,x)}Wl.create=ko,Wl.pointsToPath=Ta,ul.geometryToLayer=ra,ul.coordsToLatLng=oi,ul.coordsToLatLngs=mu,ul.latLngToCoords=Wu,ul.latLngsToCoords=Ku,ul.getFeature=cl,ul.asFeature=hl,Xn.mergeOptions({boxZoom:!0});var ns=Hs.extend({initialize:function(f){this._map=f,this._container=f._container,this._pane=f._panes.overlayPane,this._resetStateTimeout=0,f.on("unload",this._destroy,this)},addHooks:function(){hn(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){xn(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){ci(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){this._resetStateTimeout!==0&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(f){if(!f.shiftKey||f.which!==1&&f.button!==1)return!1;this._clearDeferredResetState(),this._resetState(),Ua(),_s(),this._startPoint=this._map.mouseEventToContainerPoint(f),hn(document,{contextmenu:na,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(f){this._moved||(this._moved=!0,this._box=ni("div","leaflet-zoom-box",this._container),on(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(f);var x=new ke(this._point,this._startPoint),R=x.getSize();rr(this._box,x.min),this._box.style.width=R.x+"px",this._box.style.height=R.y+"px"},_finish:function(){this._moved&&(ci(this._box),Fi(this._container,"leaflet-crosshair")),Gi(),$a(),xn(document,{contextmenu:na,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(f){if(!(f.which!==1&&f.button!==1)&&(this._finish(),!!this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(_(this._resetState,this),0);var x=new Ot(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(x).fire("boxzoomend",{boxZoomBounds:x})}},_onKeyDown:function(f){f.keyCode===27&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});Xn.addInitHook("addHandler","boxZoom",ns),Xn.mergeOptions({doubleClickZoom:!0});var zo=Hs.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(f){var x=this._map,R=x.getZoom(),V=x.options.zoomDelta,K=f.originalEvent.shiftKey?R-V:R+V;x.options.doubleClickZoom==="center"?x.setZoom(K):x.setZoomAround(f.containerPoint,K)}});Xn.addInitHook("addHandler","doubleClickZoom",zo),Xn.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var Oo=Hs.extend({addHooks:function(){if(!this._draggable){var f=this._map;this._draggable=new es(f._mapPane,f._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),f.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),f.on("zoomend",this._onZoomEnd,this),f.whenReady(this._onZoomEnd,this))}on(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){Fi(this._map._container,"leaflet-grab"),Fi(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var f=this._map;if(f._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var x=jt(this._map.options.maxBounds);this._offsetLimit=vt(this._map.latLngToContainerPoint(x.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(x.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;f.fire("movestart").fire("dragstart"),f.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(f){if(this._map.options.inertia){var x=this._lastTime=+new Date,R=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(R),this._times.push(x),this._prunePositions(x)}this._map.fire("move",f).fire("drag",f)},_prunePositions:function(f){for(;this._positions.length>1&&f-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var f=this._map.getSize().divideBy(2),x=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=x.subtract(f).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(f,x){return f-(f-x)*this._viscosity},_onPreDragLimit:function(){if(!(!this._viscosity||!this._offsetLimit)){var f=this._draggable._newPos.subtract(this._draggable._startPos),x=this._offsetLimit;f.x<x.min.x&&(f.x=this._viscousLimit(f.x,x.min.x)),f.y<x.min.y&&(f.y=this._viscousLimit(f.y,x.min.y)),f.x>x.max.x&&(f.x=this._viscousLimit(f.x,x.max.x)),f.y>x.max.y&&(f.y=this._viscousLimit(f.y,x.max.y)),this._draggable._newPos=this._draggable._startPos.add(f)}},_onPreDragWrap:function(){var f=this._worldWidth,x=Math.round(f/2),R=this._initialWorldOffset,V=this._draggable._newPos.x,K=(V-x+R)%f+x-R,ue=(V+x+R)%f-x-R,Oe=Math.abs(K+R)<Math.abs(ue+R)?K:ue;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=Oe},_onDragEnd:function(f){var x=this._map,R=x.options,V=!R.inertia||f.noInertia||this._times.length<2;if(x.fire("dragend",f),V)x.fire("moveend");else{this._prunePositions(+new Date);var K=this._lastPos.subtract(this._positions[0]),ue=(this._lastTime-this._times[0])/1e3,Oe=R.easeLinearity,nt=K.multiplyBy(Oe/ue),ut=nt.distanceTo([0,0]),Mt=Math.min(R.inertiaMaxSpeed,ut),Kt=nt.multiplyBy(Mt/ut),pn=Mt/(R.inertiaDeceleration*Oe),Yn=Kt.multiplyBy(-pn/2).round();!Yn.x&&!Yn.y?x.fire("moveend"):(Yn=x._limitOffset(Yn,x.options.maxBounds),Pe(function(){x.panBy(Yn,{duration:pn,easeLinearity:Oe,noMoveStart:!0,animate:!0})}))}}});Xn.addInitHook("addHandler","dragging",Oo),Xn.mergeOptions({keyboard:!0,keyboardPanDelta:80});var ed=Hs.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(f){this._map=f,this._setPanDelta(f.options.keyboardPanDelta),this._setZoomDelta(f.options.zoomDelta)},addHooks:function(){var f=this._map._container;f.tabIndex<=0&&(f.tabIndex="0"),hn(f,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),xn(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var f=document.body,x=document.documentElement,R=f.scrollTop||x.scrollTop,V=f.scrollLeft||x.scrollLeft;this._map._container.focus(),window.scrollTo(V,R)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(f){var x=this._panKeys={},R=this.keyCodes,V,K;for(V=0,K=R.left.length;V<K;V++)x[R.left[V]]=[-1*f,0];for(V=0,K=R.right.length;V<K;V++)x[R.right[V]]=[f,0];for(V=0,K=R.down.length;V<K;V++)x[R.down[V]]=[0,f];for(V=0,K=R.up.length;V<K;V++)x[R.up[V]]=[0,-1*f]},_setZoomDelta:function(f){var x=this._zoomKeys={},R=this.keyCodes,V,K;for(V=0,K=R.zoomIn.length;V<K;V++)x[R.zoomIn[V]]=f;for(V=0,K=R.zoomOut.length;V<K;V++)x[R.zoomOut[V]]=-f},_addHooks:function(){hn(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){xn(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(f){if(!(f.altKey||f.ctrlKey||f.metaKey)){var x=f.keyCode,R=this._map,V;if(x in this._panKeys){if(!R._panAnim||!R._panAnim._inProgress)if(V=this._panKeys[x],f.shiftKey&&(V=Bt(V).multiplyBy(3)),R.options.maxBounds&&(V=R._limitOffset(Bt(V),R.options.maxBounds)),R.options.worldCopyJump){var K=R.wrapLatLng(R.unproject(R.project(R.getCenter()).add(V)));R.panTo(K)}else R.panBy(V)}else if(x in this._zoomKeys)R.setZoom(R.getZoom()+(f.shiftKey?3:1)*this._zoomKeys[x]);else if(x===27&&R._popup&&R._popup.options.closeOnEscapeKey)R.closePopup();else return;na(f)}}});Xn.addInitHook("addHandler","keyboard",ed),Xn.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var ec=Hs.extend({addHooks:function(){hn(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){xn(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(f){var x=sr(f),R=this._map.options.wheelDebounceTime;this._delta+=x,this._lastMousePos=this._map.mouseEventToContainerPoint(f),this._startTime||(this._startTime=+new Date);var V=Math.max(R-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(_(this._performZoom,this),V),na(f)},_performZoom:function(){var f=this._map,x=f.getZoom(),R=this._map.options.zoomSnap||0;f._stop();var V=this._delta/(this._map.options.wheelPxPerZoomLevel*4),K=4*Math.log(2/(1+Math.exp(-Math.abs(V))))/Math.LN2,ue=R?Math.ceil(K/R)*R:K,Oe=f._limitZoom(x+(this._delta>0?ue:-ue))-x;this._delta=0,this._startTime=null,Oe&&(f.options.scrollWheelZoom==="center"?f.setZoom(x+Oe):f.setZoomAround(this._lastMousePos,x+Oe))}});Xn.addInitHook("addHandler","scrollWheelZoom",ec);var vu=600;Xn.mergeOptions({tapHold:en.touchNative&&en.safari&&en.mobile,tapTolerance:15});var tc=Hs.extend({addHooks:function(){hn(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){xn(this._map._container,"touchstart",this._onDown,this)},_onDown:function(f){if(clearTimeout(this._holdTimeout),f.touches.length===1){var x=f.touches[0];this._startPos=this._newPos=new Tt(x.clientX,x.clientY),this._holdTimeout=setTimeout(_(function(){this._cancel(),this._isTapValid()&&(hn(document,"touchend",sn),hn(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",x))},this),vu),hn(document,"touchend touchcancel contextmenu",this._cancel,this),hn(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function f(){xn(document,"touchend",sn),xn(document,"touchend touchcancel",f)},_cancel:function(){clearTimeout(this._holdTimeout),xn(document,"touchend touchcancel contextmenu",this._cancel,this),xn(document,"touchmove",this._onMove,this)},_onMove:function(f){var x=f.touches[0];this._newPos=new Tt(x.clientX,x.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(f,x){var R=new MouseEvent(f,{bubbles:!0,cancelable:!0,view:window,screenX:x.screenX,screenY:x.screenY,clientX:x.clientX,clientY:x.clientY});R._simulated=!0,x.target.dispatchEvent(R)}});Xn.addInitHook("addHandler","tapHold",tc),Xn.mergeOptions({touchZoom:en.touch,bounceAtZoomLimits:!0});var nc=Hs.extend({addHooks:function(){on(this._map._container,"leaflet-touch-zoom"),hn(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){Fi(this._map._container,"leaflet-touch-zoom"),xn(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(f){var x=this._map;if(!(!f.touches||f.touches.length!==2||x._animatingZoom||this._zooming)){var R=x.mouseEventToContainerPoint(f.touches[0]),V=x.mouseEventToContainerPoint(f.touches[1]);this._centerPoint=x.getSize()._divideBy(2),this._startLatLng=x.containerPointToLatLng(this._centerPoint),x.options.touchZoom!=="center"&&(this._pinchStartLatLng=x.containerPointToLatLng(R.add(V)._divideBy(2))),this._startDist=R.distanceTo(V),this._startZoom=x.getZoom(),this._moved=!1,this._zooming=!0,x._stop(),hn(document,"touchmove",this._onTouchMove,this),hn(document,"touchend touchcancel",this._onTouchEnd,this),sn(f)}},_onTouchMove:function(f){if(!(!f.touches||f.touches.length!==2||!this._zooming)){var x=this._map,R=x.mouseEventToContainerPoint(f.touches[0]),V=x.mouseEventToContainerPoint(f.touches[1]),K=R.distanceTo(V)/this._startDist;if(this._zoom=x.getScaleZoom(K,this._startZoom),!x.options.bounceAtZoomLimits&&(this._zoom<x.getMinZoom()&&K<1||this._zoom>x.getMaxZoom()&&K>1)&&(this._zoom=x._limitZoom(this._zoom)),x.options.touchZoom==="center"){if(this._center=this._startLatLng,K===1)return}else{var ue=R._add(V)._divideBy(2)._subtract(this._centerPoint);if(K===1&&ue.x===0&&ue.y===0)return;this._center=x.unproject(x.project(this._pinchStartLatLng,this._zoom).subtract(ue),this._zoom)}this._moved||(x._moveStart(!0,!1),this._moved=!0),Ge(this._animRequest);var Oe=_(x._move,x,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=Pe(Oe,this,!0),sn(f)}},_onTouchEnd:function(){if(!this._moved||!this._zooming){this._zooming=!1;return}this._zooming=!1,Ge(this._animRequest),xn(document,"touchmove",this._onTouchMove,this),xn(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))}});Xn.addInitHook("addHandler","touchZoom",nc),Xn.BoxZoom=ns,Xn.DoubleClickZoom=zo,Xn.Drag=Oo,Xn.Keyboard=ed,Xn.ScrollWheelZoom=ec,Xn.TapHold=tc,Xn.TouchZoom=nc,n.Bounds=ke,n.Browser=en,n.CRS=Fn,n.Canvas=yu,n.Circle=kc,n.CircleMarker=Hu,n.Class=In,n.Control=ia,n.DivIcon=gu,n.DivOverlay=aa,n.DomEvent=lo,n.DomUtil=pr,n.Draggable=es,n.Evented=$t,n.FeatureGroup=co,n.GeoJSON=ul,n.GridLayer=_u,n.Handler=Hs,n.Icon=Ys,n.ImageOverlay=Yu,n.LatLng=Jt,n.LatLngBounds=Ot,n.Layer=Ks,n.LayerGroup=qu,n.LineUtil=qa,n.Map=Xn,n.Marker=pu,n.Mixin=kl,n.Path=Ss,n.Point=Tt,n.PolyUtil=uo,n.Polygon=Zl,n.Polyline=ll,n.Popup=Hl,n.PosAnimation=bs,n.Projection=Ts,n.Rectangle=Do,n.Renderer=ma,n.SVG=Wl,n.SVGOverlay=zc,n.TileLayer=fl,n.Tooltip=Lo,n.Transformation=Ns,n.Util=Re,n.VideoOverlay=Ol,n.bind=_,n.bounds=vt,n.canvas=Ju,n.circle=Ud,n.circleMarker=Xu,n.control=Ia,n.divIcon=ho,n.extend=d,n.featureGroup=Yh,n.geoJSON=fh,n.geoJson=Dc,n.gridLayer=Jh,n.icon=Gu,n.imageOverlay=qd,n.latLng=Xt,n.latLngBounds=jt,n.layerGroup=jd,n.map=Io,n.marker=dh,n.point=Bt,n.polygon=Qh,n.polyline=$d,n.popup=ph,n.rectangle=zf,n.setOptions=be,n.stamp=M,n.svg=qn,n.svgOverlay=Oc,n.tileLayer=pa,n.tooltip=Nc,n.transformation=kr,n.version=o,n.videoOverlay=Qu;var bu=window.L;n.noConflict=function(){return window.L=bu,this},window.L=n}))})(v_,v_.exports)),v_.exports}var x4=b4();const Lr=iy(x4);var Uv={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v5.6.2/LICENSE.txt
 */var w4=Uv.exports,zT;function T4(){return zT||(zT=1,(function(i,e){(function(n,o){i.exports=o()})(w4,(function(){var n={},o={};function d(_,c,M){if(o[_]=M,_==="index"){var k="var sharedModule = {}; ("+o.shared+")(sharedModule); ("+o.worker+")(sharedModule);",j={};return o.shared(j),o.index(n,j),typeof window<"u"&&n.setWorkerUrl(window.URL.createObjectURL(new Blob([k],{type:"text/javascript"}))),n}}d("shared",["exports"],(function(_){function c(l,r,s,p){return new(s||(s=Promise))((function(v,E){function A(F){try{z(p.next(F))}catch($){E($)}}function I(F){try{z(p.throw(F))}catch($){E($)}}function z(F){var $;F.done?v(F.value):($=F.value,$ instanceof s?$:new s((function(X){X($)}))).then(A,I)}z((p=p.apply(l,r||[])).next())}))}function M(l,r){this.x=l,this.y=r}function k(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}var j,G;typeof SuppressedError=="function"&&SuppressedError,M.prototype={clone(){return new M(this.x,this.y)},add(l){return this.clone()._add(l)},sub(l){return this.clone()._sub(l)},multByPoint(l){return this.clone()._multByPoint(l)},divByPoint(l){return this.clone()._divByPoint(l)},mult(l){return this.clone()._mult(l)},div(l){return this.clone()._div(l)},rotate(l){return this.clone()._rotate(l)},rotateAround(l,r){return this.clone()._rotateAround(l,r)},matMult(l){return this.clone()._matMult(l)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(l){return this.x===l.x&&this.y===l.y},dist(l){return Math.sqrt(this.distSqr(l))},distSqr(l){const r=l.x-this.x,s=l.y-this.y;return r*r+s*s},angle(){return Math.atan2(this.y,this.x)},angleTo(l){return Math.atan2(this.y-l.y,this.x-l.x)},angleWith(l){return this.angleWithSep(l.x,l.y)},angleWithSep(l,r){return Math.atan2(this.x*r-this.y*l,this.x*l+this.y*r)},_matMult(l){const r=l[2]*this.x+l[3]*this.y;return this.x=l[0]*this.x+l[1]*this.y,this.y=r,this},_add(l){return this.x+=l.x,this.y+=l.y,this},_sub(l){return this.x-=l.x,this.y-=l.y,this},_mult(l){return this.x*=l,this.y*=l,this},_div(l){return this.x/=l,this.y/=l,this},_multByPoint(l){return this.x*=l.x,this.y*=l.y,this},_divByPoint(l){return this.x/=l.x,this.y/=l.y,this},_unit(){return this._div(this.mag()),this},_perp(){const l=this.y;return this.y=this.x,this.x=-l,this},_rotate(l){const r=Math.cos(l),s=Math.sin(l),p=s*this.x+r*this.y;return this.x=r*this.x-s*this.y,this.y=p,this},_rotateAround(l,r){const s=Math.cos(l),p=Math.sin(l),v=r.y+p*(this.x-r.x)+s*(this.y-r.y);return this.x=r.x+s*(this.x-r.x)-p*(this.y-r.y),this.y=v,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:M},M.convert=function(l){if(l instanceof M)return l;if(Array.isArray(l))return new M(+l[0],+l[1]);if(l.x!==void 0&&l.y!==void 0)return new M(+l.x,+l.y);throw new Error("Expected [x, y] or {x, y} point format")};var ee=(function(){if(G)return j;function l(r,s,p,v){this.cx=3*r,this.bx=3*(p-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*s,this.by=3*(v-s)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=s,this.p2x=p,this.p2y=v}return G=1,j=l,l.prototype={sampleCurveX:function(r){return((this.ax*r+this.bx)*r+this.cx)*r},sampleCurveY:function(r){return((this.ay*r+this.by)*r+this.cy)*r},sampleCurveDerivativeX:function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},solveCurveX:function(r,s){if(s===void 0&&(s=1e-6),r<0)return 0;if(r>1)return 1;for(var p=r,v=0;v<8;v++){var E=this.sampleCurveX(p)-r;if(Math.abs(E)<s)return p;var A=this.sampleCurveDerivativeX(p);if(Math.abs(A)<1e-6)break;p-=E/A}var I=0,z=1;for(p=r,v=0;v<20&&(E=this.sampleCurveX(p),!(Math.abs(E-r)<s));v++)r>E?I=p:z=p,p=.5*(z-I)+I;return p},solve:function(r,s){return this.sampleCurveY(this.solveCurveX(r,s))}},j})(),Y=k(ee);let xe,be;function Ne(){return xe==null&&(xe=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),xe}function tt(){if(be==null&&(be=!1,Ne())){const r=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(r){for(let p=0;p<25;p++){const v=4*p;r.fillStyle=`rgb(${v},${v+1},${v+2})`,r.fillRect(p%5,Math.floor(p/5),1,1)}const s=r.getImageData(0,0,5,5).data;for(let p=0;p<100;p++)if(p%4!=3&&s[p]!==p){be=!0;break}}}return be||!1}var Je=1e-6,qe=typeof Float32Array<"u"?Float32Array:Array;function He(){var l=new qe(9);return qe!=Float32Array&&(l[1]=0,l[2]=0,l[3]=0,l[5]=0,l[6]=0,l[7]=0),l[0]=1,l[4]=1,l[8]=1,l}function Ue(l){return l[0]=1,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=1,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=1,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l}function Be(){var l=new qe(3);return qe!=Float32Array&&(l[0]=0,l[1]=0,l[2]=0),l}function de(l){return Math.hypot(l[0],l[1],l[2])}function ce(l,r,s){var p=new qe(3);return p[0]=l,p[1]=r,p[2]=s,p}function _e(l,r,s){return l[0]=r[0]+s[0],l[1]=r[1]+s[1],l[2]=r[2]+s[2],l}function Ae(l,r,s){return l[0]=r[0]*s,l[1]=r[1]*s,l[2]=r[2]*s,l}function Pe(l,r,s){var p=r[0],v=r[1],E=r[2],A=s[0],I=s[1],z=s[2];return l[0]=v*z-E*I,l[1]=E*A-p*z,l[2]=p*I-v*A,l}Math.hypot||(Math.hypot=function(){for(var l=0,r=arguments.length;r--;)l+=arguments[r]*arguments[r];return Math.sqrt(l)});var Ge,Re=de;function In(l,r,s){var p=r[0],v=r[1],E=r[2],A=r[3];return l[0]=s[0]*p+s[4]*v+s[8]*E+s[12]*A,l[1]=s[1]*p+s[5]*v+s[9]*E+s[13]*A,l[2]=s[2]*p+s[6]*v+s[10]*E+s[14]*A,l[3]=s[3]*p+s[7]*v+s[11]*E+s[15]*A,l}function Jn(){var l=new qe(4);return qe!=Float32Array&&(l[0]=0,l[1]=0,l[2]=0),l[3]=1,l}function mt(l,r,s,p){var v=.5*Math.PI/180;r*=v,s*=v,p*=v;var E=Math.sin(r),A=Math.cos(r),I=Math.sin(s),z=Math.cos(s),F=Math.sin(p),$=Math.cos(p);return l[0]=E*z*$-A*I*F,l[1]=A*I*$+E*z*F,l[2]=A*z*F-E*I*$,l[3]=A*z*$+E*I*F,l}function $t(){var l=new qe(2);return qe!=Float32Array&&(l[0]=0,l[1]=0),l}function Tt(l,r){var s=new qe(2);return s[0]=l,s[1]=r,s}Be(),Ge=new qe(4),qe!=Float32Array&&(Ge[0]=0,Ge[1]=0,Ge[2]=0,Ge[3]=0),Be(),ce(1,0,0),ce(0,1,0),Jn(),Jn(),He(),$t();const zt=8192;function Bt(l,r,s){return r*(zt/(l.tileSize*Math.pow(2,s-l.tileID.overscaledZ)))}function ke(l,r){return(l%r+r)%r}function vt(l,r,s){return l*(1-s)+r*s}function Ot(l){if(l<=0)return 0;if(l>=1)return 1;const r=l*l,s=r*l;return 4*(l<.5?s:3*(l-r)+s-.75)}function jt(l,r,s,p){const v=new Y(l,r,s,p);return E=>v.solve(E)}const Jt=jt(.25,.1,.25,1);function Xt(l,r,s){return Math.min(s,Math.max(r,l))}function Fn(l,r,s){const p=s-r,v=((l-r)%p+p)%p+r;return v===r?s:v}function si(l,...r){for(const s of r)for(const p in s)l[p]=s[p];return l}let di=1;function ds(l,r,s){const p={};for(const v in l)p[v]=r.call(this,l[v],v,l);return p}function Ns(l,r,s){const p={};for(const v in l)r.call(this,l[v],v,l)&&(p[v]=l[v]);return p}function kr(l){return Array.isArray(l)?l.map(kr):typeof l=="object"&&l?ds(l,kr):l}const Ni={};function Ii(l){Ni[l]||(typeof console<"u"&&console.warn(l),Ni[l]=!0)}function Va(l,r,s){return(s.y-l.y)*(r.x-l.x)>(r.y-l.y)*(s.x-l.x)}function Ta(l){return typeof WorkerGlobalScope<"u"&&l!==void 0&&l instanceof WorkerGlobalScope}let Bs=null;function Sa(l){return typeof ImageBitmap<"u"&&l instanceof ImageBitmap}const Bi="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function fr(l,r,s,p,v){return c(this,void 0,void 0,(function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const E=new VideoFrame(l,{timestamp:0});try{const A=E==null?void 0:E.format;if(!A||!A.startsWith("BGR")&&!A.startsWith("RGB"))throw new Error(`Unrecognized format ${A}`);const I=A.startsWith("BGR"),z=new Uint8ClampedArray(p*v*4);if(yield E.copyTo(z,(function(F,$,X,te,ie){const re=4*Math.max(-$,0),oe=(Math.max(0,X)-X)*te*4+re,pe=4*te,Te=Math.max(0,$),We=Math.max(0,X);return{rect:{x:Te,y:We,width:Math.min(F.width,$+te)-Te,height:Math.min(F.height,X+ie)-We},layout:[{offset:oe,stride:pe}]}})(l,r,s,p,v)),I)for(let F=0;F<z.length;F+=4){const $=z[F];z[F]=z[F+2],z[F+2]=$}return z}finally{E.close()}}))}let Ea,So;function so(l,r,s,p){return l.addEventListener(r,s,p),{unsubscribe:()=>{l.removeEventListener(r,s,p)}}}function $r(l){return l*Math.PI/180}function fs(l){return l/Math.PI*180}const ps={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},Fs={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},ms="AbortError";function Ke(){return new Error(ms)}const se={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function le(l){return se.REGISTERED_PROTOCOLS[l.substring(0,l.indexOf("://"))]}const fe="global-dispatcher";class Se extends Error{constructor(r,s,p,v){super(`AJAXError: ${s} (${r}): ${p}`),this.status=r,this.statusText=s,this.url=p,this.body=v}}const De=()=>Ta(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Ze=function(l,r){if(/:\/\//.test(l.url)&&!/^https?:|^file:/.test(l.url)){const p=le(l.url);if(p)return p(l,r);if(Ta(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:l,targetMapId:fe},r)}if(!(/^file:/.test(s=l.url)||/^file:/.test(De())&&!/^\w+:/.test(s))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return(function(p,v){return c(this,void 0,void 0,(function*(){const E=new Request(p.url,{method:p.method||"GET",body:p.body,credentials:p.credentials,headers:p.headers,cache:p.cache,referrer:De(),signal:v.signal});let A,I;p.type!=="json"||E.headers.has("Accept")||E.headers.set("Accept","application/json");try{A=yield fetch(E)}catch(F){throw new Se(0,F.message,p.url,new Blob)}if(!A.ok){const F=yield A.blob();throw new Se(A.status,A.statusText,p.url,F)}I=p.type==="arrayBuffer"||p.type==="image"?A.arrayBuffer():p.type==="json"?A.json():A.text();const z=yield I;if(v.signal.aborted)throw Ke();return{data:z,cacheControl:A.headers.get("Cache-Control"),expires:A.headers.get("Expires")}}))})(l,r);if(Ta(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:l,mustQueue:!0,targetMapId:fe},r)}var s;return(function(p,v){return new Promise(((E,A)=>{var I;const z=new XMLHttpRequest;z.open(p.method||"GET",p.url,!0),p.type!=="arrayBuffer"&&p.type!=="image"||(z.responseType="arraybuffer");for(const F in p.headers)z.setRequestHeader(F,p.headers[F]);p.type==="json"&&(z.responseType="text",!((I=p.headers)===null||I===void 0)&&I.Accept||z.setRequestHeader("Accept","application/json")),z.withCredentials=p.credentials==="include",z.onerror=()=>{A(new Error(z.statusText))},z.onload=()=>{if(!v.signal.aborted)if((z.status>=200&&z.status<300||z.status===0)&&z.response!==null){let F=z.response;if(p.type==="json")try{F=JSON.parse(z.response)}catch($){return void A($)}E({data:F,cacheControl:z.getResponseHeader("Cache-Control"),expires:z.getResponseHeader("Expires")})}else{const F=new Blob([z.response],{type:z.getResponseHeader("Content-Type")});A(new Se(z.status,z.statusText,p.url,F))}},v.signal.addEventListener("abort",(()=>{z.abort(),A(Ke())})),z.send(p.body)}))})(l,r)};function et(l){if(!l||l.indexOf("://")<=0||l.indexOf("data:image/")===0||l.indexOf("blob:")===0)return!0;const r=new URL(l),s=window.location;return r.protocol===s.protocol&&r.host===s.host}function Xe(l,r,s){s[l]&&s[l].indexOf(r)!==-1||(s[l]=s[l]||[],s[l].push(r))}function _t(l,r,s){if(s&&s[l]){const p=s[l].indexOf(r);p!==-1&&s[l].splice(p,1)}}class It{constructor(r,s={}){si(this,s),this.type=r}}class xt extends It{constructor(r,s={}){super("error",si({error:r},s))}}class tn{on(r,s){return this._listeners=this._listeners||{},Xe(r,s,this._listeners),{unsubscribe:()=>{this.off(r,s)}}}off(r,s){return _t(r,s,this._listeners),_t(r,s,this._oneTimeListeners),this}once(r,s){return s?(this._oneTimeListeners=this._oneTimeListeners||{},Xe(r,s,this._oneTimeListeners),this):new Promise((p=>this.once(r,p)))}fire(r,s){typeof r=="string"&&(r=new It(r,s||{}));const p=r.type;if(this.listens(p)){r.target=this;const v=this._listeners&&this._listeners[p]?this._listeners[p].slice():[];for(const I of v)I.call(this,r);const E=this._oneTimeListeners&&this._oneTimeListeners[p]?this._oneTimeListeners[p].slice():[];for(const I of E)_t(p,I,this._oneTimeListeners),I.call(this,r);const A=this._eventedParent;A&&(si(r,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),A.fire(r))}else r instanceof xt&&console.error(r.error);return this}listens(r){return this._listeners&&this._listeners[r]&&this._listeners[r].length>0||this._oneTimeListeners&&this._oneTimeListeners[r]&&this._oneTimeListeners[r].length>0||this._eventedParent&&this._eventedParent.listens(r)}setEventedParent(r,s){return this._eventedParent=r,this._eventedParentData=s,this}}var $e={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const vn=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Rn(l,r){const s={};for(const p in l)p!=="ref"&&(s[p]=l[p]);return vn.forEach((p=>{p in r&&(s[p]=r[p])})),s}function nn(l,r){if(Array.isArray(l)){if(!Array.isArray(r)||l.length!==r.length)return!1;for(let s=0;s<l.length;s++)if(!nn(l[s],r[s]))return!1;return!0}if(typeof l=="object"&&l!==null&&r!==null){if(typeof r!="object"||Object.keys(l).length!==Object.keys(r).length)return!1;for(const s in l)if(!nn(l[s],r[s]))return!1;return!0}return l===r}function Nn(l,r){l.push(r)}function Pi(l,r,s){Nn(s,{command:"addSource",args:[l,r[l]]})}function $i(l,r,s){Nn(r,{command:"removeSource",args:[l]}),s[l]=!0}function er(l,r,s,p){$i(l,s,p),Pi(l,r,s)}function Cr(l,r,s){let p;for(p in l[s])if(Object.prototype.hasOwnProperty.call(l[s],p)&&p!=="data"&&!nn(l[s][p],r[s][p]))return!1;for(p in r[s])if(Object.prototype.hasOwnProperty.call(r[s],p)&&p!=="data"&&!nn(l[s][p],r[s][p]))return!1;return!0}function Vn(l,r,s,p,v,E){l=l||{},r=r||{};for(const A in l)Object.prototype.hasOwnProperty.call(l,A)&&(nn(l[A],r[A])||s.push({command:E,args:[p,A,r[A],v]}));for(const A in r)Object.prototype.hasOwnProperty.call(r,A)&&!Object.prototype.hasOwnProperty.call(l,A)&&(nn(l[A],r[A])||s.push({command:E,args:[p,A,r[A],v]}))}function Kn(l){return l.id}function vr(l,r){return l[r.id]=r,l}class Pt{constructor(r,s,p,v){this.message=(r?`${r}: `:"")+p,v&&(this.identifier=v),s!=null&&s.__line__&&(this.line=s.__line__)}}function en(l,...r){for(const s of r)for(const p in s)l[p]=s[p];return l}class tr extends Error{constructor(r,s){super(s),this.message=s,this.key=r}}class ta{constructor(r,s=[]){this.parent=r,this.bindings={};for(const[p,v]of s)this.bindings[p]=v}concat(r){return new ta(this,r)}get(r){if(this.bindings[r])return this.bindings[r];if(this.parent)return this.parent.get(r);throw new Error(`${r} not found in scope.`)}has(r){return!!this.bindings[r]||!!this.parent&&this.parent.has(r)}}const Aa={kind:"null"},Lt={kind:"number"},yn={kind:"string"},Mn={kind:"boolean"},nr={kind:"color"},il={kind:"projectionDefinition"},Eo={kind:"object"},Bn={kind:"value"},Vs={kind:"collator"},js={kind:"formatted"},gs={kind:"padding"},qr={kind:"colorArray"},Gr={kind:"numberArray"},Si={kind:"resolvedImage"},Mr={kind:"variableAnchorOffsetCollection"};function da(l,r){return{kind:"array",itemType:l,N:r}}function xi(l){if(l.kind==="array"){const r=xi(l.itemType);return typeof l.N=="number"?`array<${r}, ${l.N}>`:l.itemType.kind==="value"?"array":`array<${r}>`}return l.kind}const Ao=[Aa,Lt,yn,Mn,nr,il,js,Eo,da(Bn),gs,Gr,qr,Si,Mr];function ja(l,r){if(r.kind==="error")return null;if(l.kind==="array"){if(r.kind==="array"&&(r.N===0&&r.itemType.kind==="value"||!ja(l.itemType,r.itemType))&&(typeof l.N!="number"||l.N===r.N))return null}else{if(l.kind===r.kind)return null;if(l.kind==="value"){for(const s of Ao)if(!ja(s,r))return null}}return`Expected ${xi(l)} but found ${xi(r)} instead.`}function Co(l,r){return r.some((s=>s.kind===l.kind))}function Us(l,r){return r.some((s=>s==="null"?l===null:s==="array"?Array.isArray(l):s==="object"?l&&!Array.isArray(l)&&typeof l=="object":s===typeof l))}function $s(l,r){return l.kind==="array"&&r.kind==="array"?l.itemType.kind===r.itemType.kind&&typeof l.N=="number":l.kind===r.kind}const rl=.96422,ni=.82521,ci=4/29,qi=6/29,br=3*qi*qi,qs=qi*qi*qi,cu=Math.PI/180,on=180/Math.PI;function Fi(l){return(l%=360)<0&&(l+=360),l}function Ca([l,r,s,p]){let v,E;const A=ir((.2225045*(l=oo(l))+.7168786*(r=oo(r))+.0606169*(s=oo(s)))/1);l===r&&r===s?v=E=A:(v=ir((.4360747*l+.3850649*r+.1430804*s)/rl),E=ir((.0139322*l+.0971045*r+.7141733*s)/ni));const I=116*A-16;return[I<0?0:I,500*(v-A),200*(A-E),p]}function oo(l){return l<=.04045?l/12.92:Math.pow((l+.055)/1.055,2.4)}function ir(l){return l>qs?Math.pow(l,1/3):l/br+ci}function Mo([l,r,s,p]){let v=(l+16)/116,E=isNaN(r)?v:v+r/500,A=isNaN(s)?v:v-s/200;return v=1*Gs(v),E=rl*Gs(E),A=ni*Gs(A),[Rl(3.1338561*E-1.6168667*v-.4906146*A),Rl(-.9787684*E+1.9161415*v+.033454*A),Rl(.0719453*E-.2289914*v+1.4052427*A),p]}function Rl(l){return(l=l<=.00304?12.92*l:1.055*Math.pow(l,1/2.4)-.055)<0?0:l>1?1:l}function Gs(l){return l>qi?l*l*l:br*(l-ci)}const rr=Object.hasOwn||function(l,r){return Object.prototype.hasOwnProperty.call(l,r)};function Qa(l,r){return rr(l,r)?l[r]:void 0}function Ua(l){return parseInt(l.padEnd(2,l),16)/255}function Gi(l,r){return jn(r?l/100:l,0,1)}function jn(l,r,s){return Math.min(Math.max(r,l),s)}function Ja(l){return!l.some(Number.isNaN)}const _s={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function $a(l,r,s){return l+s*(r-l)}function Zs(l,r,s){return l.map(((p,v)=>$a(p,r[v],s)))}class Ln{constructor(r,s,p,v=1,E=!0){this.r=r,this.g=s,this.b=p,this.a=v,E||(this.r*=v,this.g*=v,this.b*=v,v||this.overwriteGetter("rgb",[r,s,p,v]))}static parse(r){if(r instanceof Ln)return r;if(typeof r!="string")return;const s=(function(p){if((p=p.toLowerCase().trim())==="transparent")return[0,0,0,0];const v=Qa(_s,p);if(v){const[A,I,z]=v;return[A/255,I/255,z/255,1]}if(p.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(p)){const A=p.length<6?1:2;let I=1;return[Ua(p.slice(I,I+=A)),Ua(p.slice(I,I+=A)),Ua(p.slice(I,I+=A)),Ua(p.slice(I,I+A)||"ff")]}if(p.startsWith("rgb")){const A=p.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(A){const[I,z,F,$,X,te,ie,re,oe,pe,Te,We]=A,Le=[$||" ",ie||" ",pe].join("");if(Le==="  "||Le==="  /"||Le===",,"||Le===",,,"){const Fe=[F,te,oe].join(""),ot=Fe==="%%%"?100:Fe===""?255:0;if(ot){const gt=[jn(+z/ot,0,1),jn(+X/ot,0,1),jn(+re/ot,0,1),Te?Gi(+Te,We):1];if(Ja(gt))return gt}}return}}const E=p.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(E){const[A,I,z,F,$,X,te,ie,re]=E,oe=[z||" ",$||" ",te].join("");if(oe==="  "||oe==="  /"||oe===",,"||oe===",,,"){const pe=[+I,jn(+F,0,100),jn(+X,0,100),ie?Gi(+ie,re):1];if(Ja(pe))return(function([Te,We,Le,Fe]){function ot(gt){const Ct=(gt+Te/30)%12,Gt=We*Math.min(Le,1-Le);return Le-Gt*Math.max(-1,Math.min(Ct-3,9-Ct,1))}return Te=Fi(Te),We/=100,Le/=100,[ot(0),ot(8),ot(4),Fe]})(pe)}}})(r);return s?new Ln(...s,!1):void 0}get rgb(){const{r,g:s,b:p,a:v}=this,E=v||1/0;return this.overwriteGetter("rgb",[r/E,s/E,p/E,v])}get hcl(){return this.overwriteGetter("hcl",(function(r){const[s,p,v,E]=Ca(r),A=Math.sqrt(p*p+v*v);return[Math.round(1e4*A)?Fi(Math.atan2(v,p)*on):NaN,A,s,E]})(this.rgb))}get lab(){return this.overwriteGetter("lab",Ca(this.rgb))}overwriteGetter(r,s){return Object.defineProperty(this,r,{value:s}),s}toString(){const[r,s,p,v]=this.rgb;return`rgba(${[r,s,p].map((E=>Math.round(255*E))).join(",")},${v})`}static interpolate(r,s,p,v="rgb"){switch(v){case"rgb":{const[E,A,I,z]=Zs(r.rgb,s.rgb,p);return new Ln(E,A,I,z,!1)}case"hcl":{const[E,A,I,z]=r.hcl,[F,$,X,te]=s.hcl;let ie,re;if(isNaN(E)||isNaN(F))isNaN(E)?isNaN(F)?ie=NaN:(ie=F,I!==1&&I!==0||(re=$)):(ie=E,X!==1&&X!==0||(re=A));else{let Le=F-E;F>E&&Le>180?Le-=360:F<E&&E-F>180&&(Le+=360),ie=E+p*Le}const[oe,pe,Te,We]=(function([Le,Fe,ot,gt]){return Le=isNaN(Le)?0:Le*cu,Mo([ot,Math.cos(Le)*Fe,Math.sin(Le)*Fe,gt])})([ie,re??$a(A,$,p),$a(I,X,p),$a(z,te,p)]);return new Ln(oe,pe,Te,We,!1)}case"lab":{const[E,A,I,z]=Mo(Zs(r.lab,s.lab,p));return new Ln(E,A,I,z,!1)}}}}Ln.black=new Ln(0,0,0,1),Ln.white=new Ln(1,1,1,1),Ln.transparent=new Ln(0,0,0,0),Ln.red=new Ln(1,0,0,1);class ys{constructor(r,s,p){this.sensitivity=r?s?"variant":"case":s?"accent":"base",this.locale=p,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(r,s){return this.collator.compare(r,s)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const Ma=["bottom","center","top"];class Ll{constructor(r,s,p,v,E,A){this.text=r,this.image=s,this.scale=p,this.fontStack=v,this.textColor=E,this.verticalAlign=A}}class Zi{constructor(r){this.sections=r}static fromString(r){return new Zi([new Ll(r,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((r=>r.text.length!==0||r.image&&r.image.name.length!==0))}static factory(r){return r instanceof Zi?r:Zi.fromString(r)}toString(){return this.sections.length===0?"":this.sections.map((r=>r.text)).join("")}}class pr{constructor(r){this.values=r.slice()}static parse(r){if(r instanceof pr)return r;if(typeof r=="number")return new pr([r,r,r,r]);if(Array.isArray(r)&&!(r.length<1||r.length>4)){for(const s of r)if(typeof s!="number")return;switch(r.length){case 1:r=[r[0],r[0],r[0],r[0]];break;case 2:r=[r[0],r[1],r[0],r[1]];break;case 3:r=[r[0],r[1],r[2],r[1]]}return new pr(r)}}toString(){return JSON.stringify(this.values)}static interpolate(r,s,p){return new pr(Zs(r.values,s.values,p))}}class hn{constructor(r){this.values=r.slice()}static parse(r){if(r instanceof hn)return r;if(typeof r=="number")return new hn([r]);if(Array.isArray(r)){for(const s of r)if(typeof s!="number")return;return new hn(r)}}toString(){return JSON.stringify(this.values)}static interpolate(r,s,p){return new hn(Zs(r.values,s.values,p))}}class fi{constructor(r){this.values=r.slice()}static parse(r){if(r instanceof fi)return r;if(typeof r=="string"){const p=Ln.parse(r);return p?new fi([p]):void 0}if(!Array.isArray(r))return;const s=[];for(const p of r){if(typeof p!="string")return;const v=Ln.parse(p);if(!v)return;s.push(v)}return new fi(s)}toString(){return JSON.stringify(this.values)}static interpolate(r,s,p,v="rgb"){const E=[];if(r.values.length!=s.values.length)throw new Error(`colorArray: Arrays have mismatched length (${r.values.length} vs. ${s.values.length}), cannot interpolate.`);for(let A=0;A<r.values.length;A++)E.push(Ln.interpolate(r.values[A],s.values[A],p,v));return new fi(E)}}class xn extends Error{constructor(r){super(r),this.name="RuntimeError"}toJSON(){return this.message}}const al=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class ar{constructor(r){this.values=r.slice()}static parse(r){if(r instanceof ar)return r;if(Array.isArray(r)&&!(r.length<1)&&r.length%2==0){for(let s=0;s<r.length;s+=2){const p=r[s],v=r[s+1];if(typeof p!="string"||!al.has(p)||!Array.isArray(v)||v.length!==2||typeof v[0]!="number"||typeof v[1]!="number")return}return new ar(r)}}toString(){return JSON.stringify(this.values)}static interpolate(r,s,p){const v=r.values,E=s.values;if(v.length!==E.length)throw new xn(`Cannot interpolate values of different length. from: ${r.toString()}, to: ${s.toString()}`);const A=[];for(let I=0;I<v.length;I+=2){if(v[I]!==E[I])throw new xn(`Cannot interpolate values containing mismatched anchors. from[${I}]: ${v[I]}, to[${I}]: ${E[I]}`);A.push(v[I]);const[z,F]=v[I+1],[$,X]=E[I+1];A.push([$a(z,$,p),$a(F,X,p)])}return new ar(A)}}class ur{constructor(r){this.name=r.name,this.available=r.available}toString(){return this.name}static fromString(r){return r?new ur({name:r,available:!1}):null}}class xr{constructor(r,s,p){this.from=r,this.to=s,this.transition=p}static interpolate(r,s,p){return new xr(r,s,p)}static parse(r){return r instanceof xr?r:Array.isArray(r)&&r.length===3&&typeof r[0]=="string"&&typeof r[1]=="string"&&typeof r[2]=="number"?new xr(r[0],r[1],r[2]):typeof r=="object"&&typeof r.from=="string"&&typeof r.to=="string"&&typeof r.transition=="number"?new xr(r.from,r.to,r.transition):typeof r=="string"?new xr(r,r,1):void 0}}function bn(l,r,s,p){return typeof l=="number"&&l>=0&&l<=255&&typeof r=="number"&&r>=0&&r<=255&&typeof s=="number"&&s>=0&&s<=255?p===void 0||typeof p=="number"&&p>=0&&p<=1?null:`Invalid rgba value [${[l,r,s,p].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof p=="number"?[l,r,s,p]:[l,r,s]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function fa(l){if(l===null||typeof l=="string"||typeof l=="boolean"||typeof l=="number"||l instanceof xr||l instanceof Ln||l instanceof ys||l instanceof Zi||l instanceof pr||l instanceof hn||l instanceof fi||l instanceof ar||l instanceof ur)return!0;if(Array.isArray(l)){for(const r of l)if(!fa(r))return!1;return!0}if(typeof l=="object"){for(const r in l)if(!fa(l[r]))return!1;return!0}return!1}function fn(l){if(l===null)return Aa;if(typeof l=="string")return yn;if(typeof l=="boolean")return Mn;if(typeof l=="number")return Lt;if(l instanceof Ln)return nr;if(l instanceof xr)return il;if(l instanceof ys)return Vs;if(l instanceof Zi)return js;if(l instanceof pr)return gs;if(l instanceof hn)return Gr;if(l instanceof fi)return qr;if(l instanceof ar)return Mr;if(l instanceof ur)return Si;if(Array.isArray(l)){const r=l.length;let s;for(const p of l){const v=fn(p);if(s){if(s===v)continue;s=Bn;break}s=v}return da(s||Bn,r)}return Eo}function sn(l){const r=typeof l;return l===null?"":r==="string"||r==="number"||r==="boolean"?String(l):l instanceof Ln||l instanceof xr||l instanceof Zi||l instanceof pr||l instanceof hn||l instanceof fi||l instanceof ar||l instanceof ur?l.toString():JSON.stringify(l)}class na{constructor(r,s){this.type=r,this.value=s}static parse(r,s){if(r.length!==2)return s.error(`'literal' expression requires exactly one argument, but found ${r.length-1} instead.`);if(!fa(r[1]))return s.error("invalid value");const p=r[1];let v=fn(p);const E=s.expectedType;return v.kind!=="array"||v.N!==0||!E||E.kind!=="array"||typeof E.N=="number"&&E.N!==0||(v=E),new na(v,p)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const $n={string:yn,number:Lt,boolean:Mn,object:Eo};class Dr{constructor(r,s){this.type=r,this.args=s}static parse(r,s){if(r.length<2)return s.error("Expected at least one argument.");let p,v=1;const E=r[0];if(E==="array"){let I,z;if(r.length>2){const F=r[1];if(typeof F!="string"||!(F in $n)||F==="object")return s.error('The item type argument of "array" must be one of string, number, boolean',1);I=$n[F],v++}else I=Bn;if(r.length>3){if(r[2]!==null&&(typeof r[2]!="number"||r[2]<0||r[2]!==Math.floor(r[2])))return s.error('The length argument to "array" must be a positive integer literal',2);z=r[2],v++}p=da(I,z)}else{if(!$n[E])throw new Error(`Types doesn't contain name = ${E}`);p=$n[E]}const A=[];for(;v<r.length;v++){const I=s.parse(r[v],v,Bn);if(!I)return null;A.push(I)}return new Dr(p,A)}evaluate(r){for(let s=0;s<this.args.length;s++){const p=this.args[s].evaluate(r);if(!ja(this.type,fn(p)))return p;if(s===this.args.length-1)throw new xn(`Expected value to be of type ${xi(this.type)}, but found ${xi(fn(p))} instead.`)}throw new Error}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every((r=>r.outputDefined()))}}const Yr={"to-boolean":Mn,"to-color":nr,"to-number":Lt,"to-string":yn};class sr{constructor(r,s){this.type=r,this.args=s}static parse(r,s){if(r.length<2)return s.error("Expected at least one argument.");const p=r[0];if(!Yr[p])throw new Error(`Can't parse ${p} as it is not part of the known types`);if((p==="to-boolean"||p==="to-string")&&r.length!==2)return s.error("Expected one argument.");const v=Yr[p],E=[];for(let A=1;A<r.length;A++){const I=s.parse(r[A],A,Bn);if(!I)return null;E.push(I)}return new sr(v,E)}evaluate(r){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(r);case"color":{let s,p;for(const v of this.args){if(s=v.evaluate(r),p=null,s instanceof Ln)return s;if(typeof s=="string"){const E=r.parseColor(s);if(E)return E}else if(Array.isArray(s)&&(p=s.length<3||s.length>4?`Invalid rgba value ${JSON.stringify(s)}: expected an array containing either three or four numeric values.`:bn(s[0],s[1],s[2],s[3]),!p))return new Ln(s[0]/255,s[1]/255,s[2]/255,s[3])}throw new xn(p||`Could not parse color from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"padding":{let s;for(const p of this.args){s=p.evaluate(r);const v=pr.parse(s);if(v)return v}throw new xn(`Could not parse padding from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"numberArray":{let s;for(const p of this.args){s=p.evaluate(r);const v=hn.parse(s);if(v)return v}throw new xn(`Could not parse numberArray from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"colorArray":{let s;for(const p of this.args){s=p.evaluate(r);const v=fi.parse(s);if(v)return v}throw new xn(`Could not parse colorArray from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"variableAnchorOffsetCollection":{let s;for(const p of this.args){s=p.evaluate(r);const v=ar.parse(s);if(v)return v}throw new xn(`Could not parse variableAnchorOffsetCollection from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"number":{let s=null;for(const p of this.args){if(s=p.evaluate(r),s===null)return 0;const v=Number(s);if(!isNaN(v))return v}throw new xn(`Could not convert ${JSON.stringify(s)} to number.`)}case"formatted":return Zi.fromString(sn(this.args[0].evaluate(r)));case"resolvedImage":return ur.fromString(sn(this.args[0].evaluate(r)));case"projectionDefinition":return this.args[0].evaluate(r);default:return sn(this.args[0].evaluate(r))}}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every((r=>r.outputDefined()))}}const vs=["Unknown","Point","LineString","Polygon"];class lo{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?vs[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(r){let s=this._parseColorCache.get(r);return s||(s=Ln.parse(r),this._parseColorCache.set(r,s)),s}}class bs{constructor(r,s,p=[],v,E=new ta,A=[]){this.registry=r,this.path=p,this.key=p.map((I=>`[${I}]`)).join(""),this.scope=E,this.errors=A,this.expectedType=v,this._isConstant=s}parse(r,s,p,v,E={}){return s?this.concat(s,p,v)._parse(r,E):this._parse(r,E)}_parse(r,s){function p(v,E,A){return A==="assert"?new Dr(E,[v]):A==="coerce"?new sr(E,[v]):v}if(r!==null&&typeof r!="string"&&typeof r!="boolean"&&typeof r!="number"||(r=["literal",r]),Array.isArray(r)){if(r.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const v=r[0];if(typeof v!="string")return this.error(`Expression name must be a string, but found ${typeof v} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const E=this.registry[v];if(E){let A=E.parse(r,this);if(!A)return null;if(this.expectedType){const I=this.expectedType,z=A.type;if(I.kind!=="string"&&I.kind!=="number"&&I.kind!=="boolean"&&I.kind!=="object"&&I.kind!=="array"||z.kind!=="value"){if(I.kind==="projectionDefinition"&&["string","array"].includes(z.kind)||["color","formatted","resolvedImage"].includes(I.kind)&&["value","string"].includes(z.kind)||["padding","numberArray"].includes(I.kind)&&["value","number","array"].includes(z.kind)||I.kind==="colorArray"&&["value","string","array"].includes(z.kind)||I.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(z.kind))A=p(A,I,s.typeAnnotation||"coerce");else if(this.checkSubtype(I,z))return null}else A=p(A,I,s.typeAnnotation||"assert")}if(!(A instanceof na)&&A.type.kind!=="resolvedImage"&&this._isConstant(A)){const I=new lo;try{A=new na(A.type,A.evaluate(I))}catch(z){return this.error(z.message),null}}return A}return this.error(`Unknown expression "${v}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(r===void 0?"'undefined' value invalid. Use null instead.":typeof r=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof r} instead.`)}concat(r,s,p){const v=typeof r=="number"?this.path.concat(r):this.path,E=p?this.scope.concat(p):this.scope;return new bs(this.registry,this._isConstant,v,s||null,E,this.errors)}error(r,...s){const p=`${this.key}${s.map((v=>`[${v}]`)).join("")}`;this.errors.push(new tr(p,r))}checkSubtype(r,s){const p=ja(r,s);return p&&this.error(p),p}}class Xn{constructor(r,s){this.type=s.type,this.bindings=[].concat(r),this.result=s}evaluate(r){return this.result.evaluate(r)}eachChild(r){for(const s of this.bindings)r(s[1]);r(this.result)}static parse(r,s){if(r.length<4)return s.error(`Expected at least 3 arguments, but found ${r.length-1} instead.`);const p=[];for(let E=1;E<r.length-1;E+=2){const A=r[E];if(typeof A!="string")return s.error(`Expected string, but found ${typeof A} instead.`,E);if(/[^a-zA-Z0-9_]/.test(A))return s.error("Variable names must contain only alphanumeric characters or '_'.",E);const I=s.parse(r[E+1],E+1);if(!I)return null;p.push([A,I])}const v=s.parse(r[r.length-1],r.length-1,s.expectedType,p);return v?new Xn(p,v):null}outputDefined(){return this.result.outputDefined()}}class Io{constructor(r,s){this.type=s.type,this.name=r,this.boundExpression=s}static parse(r,s){if(r.length!==2||typeof r[1]!="string")return s.error("'var' expression requires exactly one string literal argument.");const p=r[1];return s.scope.has(p)?new Io(p,s.scope.get(p)):s.error(`Unknown variable "${p}". Make sure "${p}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(r){return this.boundExpression.evaluate(r)}eachChild(){}outputDefined(){return!1}}class ia{constructor(r,s,p){this.type=r,this.index=s,this.input=p}static parse(r,s){if(r.length!==3)return s.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const p=s.parse(r[1],1,Lt),v=s.parse(r[2],2,da(s.expectedType||Bn));return p&&v?new ia(v.type.itemType,p,v):null}evaluate(r){const s=this.index.evaluate(r),p=this.input.evaluate(r);if(s<0)throw new xn(`Array index out of bounds: ${s} < 0.`);if(s>=p.length)throw new xn(`Array index out of bounds: ${s} > ${p.length-1}.`);if(s!==Math.floor(s))throw new xn(`Array index must be an integer, but found ${s} instead.`);return p[s]}eachChild(r){r(this.index),r(this.input)}outputDefined(){return!1}}class Ia{constructor(r,s){this.type=Mn,this.needle=r,this.haystack=s}static parse(r,s){if(r.length!==3)return s.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const p=s.parse(r[1],1,Bn),v=s.parse(r[2],2,Bn);return p&&v?Co(p.type,[Mn,yn,Lt,Aa,Bn])?new Ia(p,v):s.error(`Expected first argument to be of type boolean, string, number or null, but found ${xi(p.type)} instead`):null}evaluate(r){const s=this.needle.evaluate(r),p=this.haystack.evaluate(r);if(!p)return!1;if(!Us(s,["boolean","string","number","null"]))throw new xn(`Expected first argument to be of type boolean, string, number or null, but found ${xi(fn(s))} instead.`);if(!Us(p,["string","array"]))throw new xn(`Expected second argument to be of type array or string, but found ${xi(fn(p))} instead.`);return p.indexOf(s)>=0}eachChild(r){r(this.needle),r(this.haystack)}outputDefined(){return!0}}class Pa{constructor(r,s,p){this.type=Lt,this.needle=r,this.haystack=s,this.fromIndex=p}static parse(r,s){if(r.length<=2||r.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const p=s.parse(r[1],1,Bn),v=s.parse(r[2],2,Bn);if(!p||!v)return null;if(!Co(p.type,[Mn,yn,Lt,Aa,Bn]))return s.error(`Expected first argument to be of type boolean, string, number or null, but found ${xi(p.type)} instead`);if(r.length===4){const E=s.parse(r[3],3,Lt);return E?new Pa(p,v,E):null}return new Pa(p,v)}evaluate(r){const s=this.needle.evaluate(r),p=this.haystack.evaluate(r);if(!Us(s,["boolean","string","number","null"]))throw new xn(`Expected first argument to be of type boolean, string, number or null, but found ${xi(fn(s))} instead.`);let v;if(this.fromIndex&&(v=this.fromIndex.evaluate(r)),Us(p,["string"])){const E=p.indexOf(s,v);return E===-1?-1:[...p.slice(0,E)].length}if(Us(p,["array"]))return p.indexOf(s,v);throw new xn(`Expected second argument to be of type array or string, but found ${xi(fn(p))} instead.`)}eachChild(r){r(this.needle),r(this.haystack),this.fromIndex&&r(this.fromIndex)}outputDefined(){return!1}}class zr{constructor(r,s,p,v,E,A){this.inputType=r,this.type=s,this.input=p,this.cases=v,this.outputs=E,this.otherwise=A}static parse(r,s){if(r.length<5)return s.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if(r.length%2!=1)return s.error("Expected an even number of arguments.");let p,v;s.expectedType&&s.expectedType.kind!=="value"&&(v=s.expectedType);const E={},A=[];for(let F=2;F<r.length-1;F+=2){let $=r[F];const X=r[F+1];Array.isArray($)||($=[$]);const te=s.concat(F);if($.length===0)return te.error("Expected at least one branch label.");for(const re of $){if(typeof re!="number"&&typeof re!="string")return te.error("Branch labels must be numbers or strings.");if(typeof re=="number"&&Math.abs(re)>Number.MAX_SAFE_INTEGER)return te.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof re=="number"&&Math.floor(re)!==re)return te.error("Numeric branch labels must be integer values.");if(p){if(te.checkSubtype(p,fn(re)))return null}else p=fn(re);if(E[String(re)]!==void 0)return te.error("Branch labels must be unique.");E[String(re)]=A.length}const ie=s.parse(X,F,v);if(!ie)return null;v=v||ie.type,A.push(ie)}const I=s.parse(r[1],1,Bn);if(!I)return null;const z=s.parse(r[r.length-1],r.length-1,v);return z?I.type.kind!=="value"&&s.concat(1).checkSubtype(p,I.type)?null:new zr(p,v,I,E,A,z):null}evaluate(r){const s=this.input.evaluate(r);return(fn(s)===this.inputType&&this.outputs[this.cases[s]]||this.otherwise).evaluate(r)}eachChild(r){r(this.input),this.outputs.forEach(r),r(this.otherwise)}outputDefined(){return this.outputs.every((r=>r.outputDefined()))&&this.otherwise.outputDefined()}}class xs{constructor(r,s,p){this.type=r,this.branches=s,this.otherwise=p}static parse(r,s){if(r.length<4)return s.error(`Expected at least 3 arguments, but found only ${r.length-1}.`);if(r.length%2!=0)return s.error("Expected an odd number of arguments.");let p;s.expectedType&&s.expectedType.kind!=="value"&&(p=s.expectedType);const v=[];for(let A=1;A<r.length-1;A+=2){const I=s.parse(r[A],A,Mn);if(!I)return null;const z=s.parse(r[A+1],A+1,p);if(!z)return null;v.push([I,z]),p=p||z.type}const E=s.parse(r[r.length-1],r.length-1,p);if(!E)return null;if(!p)throw new Error("Can't infer output type");return new xs(p,v,E)}evaluate(r){for(const[s,p]of this.branches)if(s.evaluate(r))return p.evaluate(r);return this.otherwise.evaluate(r)}eachChild(r){for(const[s,p]of this.branches)r(s),r(p);r(this.otherwise)}outputDefined(){return this.branches.every((([r,s])=>s.outputDefined()))&&this.otherwise.outputDefined()}}class ql{constructor(r,s,p,v){this.type=r,this.input=s,this.beginIndex=p,this.endIndex=v}static parse(r,s){if(r.length<=2||r.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const p=s.parse(r[1],1,Bn),v=s.parse(r[2],2,Lt);if(!p||!v)return null;if(!Co(p.type,[da(Bn),yn,Bn]))return s.error(`Expected first argument to be of type array or string, but found ${xi(p.type)} instead`);if(r.length===4){const E=s.parse(r[3],3,Lt);return E?new ql(p.type,p,v,E):null}return new ql(p.type,p,v)}evaluate(r){const s=this.input.evaluate(r),p=this.beginIndex.evaluate(r);let v;if(this.endIndex&&(v=this.endIndex.evaluate(r)),Us(s,["string"]))return[...s].slice(p,v).join("");if(Us(s,["array"]))return s.slice(p,v);throw new xn(`Expected first argument to be of type array or string, but found ${xi(fn(s))} instead.`)}eachChild(r){r(this.input),r(this.beginIndex),this.endIndex&&r(this.endIndex)}outputDefined(){return!1}}function Po(l,r){const s=l.length-1;let p,v,E=0,A=s,I=0;for(;E<=A;)if(I=Math.floor((E+A)/2),p=l[I],v=l[I+1],p<=r){if(I===s||r<v)return I;E=I+1}else{if(!(p>r))throw new xn("Input is not a number.");A=I-1}return 0}class Hi{constructor(r,s,p){this.type=r,this.input=s,this.labels=[],this.outputs=[];for(const[v,E]of p)this.labels.push(v),this.outputs.push(E)}static parse(r,s){if(r.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return s.error("Expected an even number of arguments.");const p=s.parse(r[1],1,Lt);if(!p)return null;const v=[];let E=null;s.expectedType&&s.expectedType.kind!=="value"&&(E=s.expectedType);for(let A=1;A<r.length;A+=2){const I=A===1?-1/0:r[A],z=r[A+1],F=A,$=A+1;if(typeof I!="number")return s.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',F);if(v.length&&v[v.length-1][0]>=I)return s.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',F);const X=s.parse(z,$,E);if(!X)return null;E=E||X.type,v.push([I,X])}return new Hi(E,p,v)}evaluate(r){const s=this.labels,p=this.outputs;if(s.length===1)return p[0].evaluate(r);const v=this.input.evaluate(r);if(v<=s[0])return p[0].evaluate(r);const E=s.length;return v>=s[E-1]?p[E-1].evaluate(r):p[Po(s,v)].evaluate(r)}eachChild(r){r(this.input);for(const s of this.outputs)r(s)}outputDefined(){return this.outputs.every((r=>r.outputDefined()))}}function Uu(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}var sl,Gl,Hs=(function(){if(Gl)return sl;function l(r,s,p,v){this.cx=3*r,this.bx=3*(p-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*s,this.by=3*(v-s)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=s,this.p2x=p,this.p2y=v}return Gl=1,sl=l,l.prototype={sampleCurveX:function(r){return((this.ax*r+this.bx)*r+this.cx)*r},sampleCurveY:function(r){return((this.ay*r+this.by)*r+this.cy)*r},sampleCurveDerivativeX:function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},solveCurveX:function(r,s){if(s===void 0&&(s=1e-6),r<0)return 0;if(r>1)return 1;for(var p=r,v=0;v<8;v++){var E=this.sampleCurveX(p)-r;if(Math.abs(E)<s)return p;var A=this.sampleCurveDerivativeX(p);if(Math.abs(A)<1e-6)break;p-=E/A}var I=0,z=1;for(p=r,v=0;v<20&&(E=this.sampleCurveX(p),!(Math.abs(E-r)<s));v++)r>E?I=p:z=p,p=.5*(z-I)+I;return p},solve:function(r,s){return this.sampleCurveY(this.solveCurveX(r,s))}},sl})(),kl=Uu(Hs);class or{constructor(r,s,p,v,E){this.type=r,this.operator=s,this.interpolation=p,this.input=v,this.labels=[],this.outputs=[];for(const[A,I]of E)this.labels.push(A),this.outputs.push(I)}static interpolationFactor(r,s,p,v){let E=0;if(r.name==="exponential")E=es(s,r.base,p,v);else if(r.name==="linear")E=es(s,1,p,v);else if(r.name==="cubic-bezier"){const A=r.controlPoints;E=new kl(A[0],A[1],A[2],A[3]).solve(es(s,1,p,v))}return E}static parse(r,s){let[p,v,E,...A]=r;if(!Array.isArray(v)||v.length===0)return s.error("Expected an interpolation type expression.",1);if(v[0]==="linear")v={name:"linear"};else if(v[0]==="exponential"){const F=v[1];if(typeof F!="number")return s.error("Exponential interpolation requires a numeric base.",1,1);v={name:"exponential",base:F}}else{if(v[0]!=="cubic-bezier")return s.error(`Unknown interpolation type ${String(v[0])}`,1,0);{const F=v.slice(1);if(F.length!==4||F.some(($=>typeof $!="number"||$<0||$>1)))return s.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);v={name:"cubic-bezier",controlPoints:F}}}if(r.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return s.error("Expected an even number of arguments.");if(E=s.parse(E,2,Lt),!E)return null;const I=[];let z=null;p!=="interpolate-hcl"&&p!=="interpolate-lab"||s.expectedType==qr?s.expectedType&&s.expectedType.kind!=="value"&&(z=s.expectedType):z=nr;for(let F=0;F<A.length;F+=2){const $=A[F],X=A[F+1],te=F+3,ie=F+4;if(typeof $!="number")return s.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',te);if(I.length&&I[I.length-1][0]>=$)return s.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',te);const re=s.parse(X,ie,z);if(!re)return null;z=z||re.type,I.push([$,re])}return $s(z,Lt)||$s(z,il)||$s(z,nr)||$s(z,gs)||$s(z,Gr)||$s(z,qr)||$s(z,Mr)||$s(z,da(Lt))?new or(z,p,v,E,I):s.error(`Type ${xi(z)} is not interpolatable.`)}evaluate(r){const s=this.labels,p=this.outputs;if(s.length===1)return p[0].evaluate(r);const v=this.input.evaluate(r);if(v<=s[0])return p[0].evaluate(r);const E=s.length;if(v>=s[E-1])return p[E-1].evaluate(r);const A=Po(s,v),I=or.interpolationFactor(this.interpolation,v,s[A],s[A+1]),z=p[A].evaluate(r),F=p[A+1].evaluate(r);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return $a(z,F,I);case"color":return Ln.interpolate(z,F,I);case"padding":return pr.interpolate(z,F,I);case"colorArray":return fi.interpolate(z,F,I);case"numberArray":return hn.interpolate(z,F,I);case"variableAnchorOffsetCollection":return ar.interpolate(z,F,I);case"array":return Zs(z,F,I);case"projectionDefinition":return xr.interpolate(z,F,I)}case"interpolate-hcl":switch(this.type.kind){case"color":return Ln.interpolate(z,F,I,"hcl");case"colorArray":return fi.interpolate(z,F,I,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return Ln.interpolate(z,F,I,"lab");case"colorArray":return fi.interpolate(z,F,I,"lab")}}}eachChild(r){r(this.input);for(const s of this.outputs)r(s)}outputDefined(){return this.outputs.every((r=>r.outputDefined()))}}function es(l,r,s,p){const v=p-s,E=l-s;return v===0?0:r===1?E/v:(Math.pow(r,E)-1)/(Math.pow(r,v)-1)}const ws={color:Ln.interpolate,number:$a,padding:pr.interpolate,numberArray:hn.interpolate,colorArray:fi.interpolate,variableAnchorOffsetCollection:ar.interpolate,array:Zs};class Dl{constructor(r,s){this.type=r,this.args=s}static parse(r,s){if(r.length<2)return s.error("Expected at least one argument.");let p=null;const v=s.expectedType;v&&v.kind!=="value"&&(p=v);const E=[];for(const I of r.slice(1)){const z=s.parse(I,1+E.length,p,void 0,{typeAnnotation:"omit"});if(!z)return null;p=p||z.type,E.push(z)}if(!p)throw new Error("No output type");const A=v&&E.some((I=>ja(v,I.type)));return new Dl(A?Bn:p,E)}evaluate(r){let s,p=null,v=0;for(const E of this.args)if(v++,p=E.evaluate(r),p&&p instanceof ur&&!p.available&&(s||(s=p.name),p=null,v===this.args.length&&(p=s)),p!==null)break;return p}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every((r=>r.outputDefined()))}}function ol(l,r){return l==="=="||l==="!="?r.kind==="boolean"||r.kind==="string"||r.kind==="number"||r.kind==="null"||r.kind==="value":r.kind==="string"||r.kind==="number"||r.kind==="value"}function uo(l,r,s,p){return p.compare(r,s)===0}function Ei(l,r,s){const p=l!=="=="&&l!=="!=";return class LC{constructor(E,A,I){this.type=Mn,this.lhs=E,this.rhs=A,this.collator=I,this.hasUntypedArgument=E.type.kind==="value"||A.type.kind==="value"}static parse(E,A){if(E.length!==3&&E.length!==4)return A.error("Expected two or three arguments.");const I=E[0];let z=A.parse(E[1],1,Bn);if(!z)return null;if(!ol(I,z.type))return A.concat(1).error(`"${I}" comparisons are not supported for type '${xi(z.type)}'.`);let F=A.parse(E[2],2,Bn);if(!F)return null;if(!ol(I,F.type))return A.concat(2).error(`"${I}" comparisons are not supported for type '${xi(F.type)}'.`);if(z.type.kind!==F.type.kind&&z.type.kind!=="value"&&F.type.kind!=="value")return A.error(`Cannot compare types '${xi(z.type)}' and '${xi(F.type)}'.`);p&&(z.type.kind==="value"&&F.type.kind!=="value"?z=new Dr(F.type,[z]):z.type.kind!=="value"&&F.type.kind==="value"&&(F=new Dr(z.type,[F])));let $=null;if(E.length===4){if(z.type.kind!=="string"&&F.type.kind!=="string"&&z.type.kind!=="value"&&F.type.kind!=="value")return A.error("Cannot use collator to compare non-string types.");if($=A.parse(E[3],3,Vs),!$)return null}return new LC(z,F,$)}evaluate(E){const A=this.lhs.evaluate(E),I=this.rhs.evaluate(E);if(p&&this.hasUntypedArgument){const z=fn(A),F=fn(I);if(z.kind!==F.kind||z.kind!=="string"&&z.kind!=="number")throw new xn(`Expected arguments for "${l}" to be (string, string) or (number, number), but found (${z.kind}, ${F.kind}) instead.`)}if(this.collator&&!p&&this.hasUntypedArgument){const z=fn(A),F=fn(I);if(z.kind!=="string"||F.kind!=="string")return r(E,A,I)}return this.collator?s(E,A,I,this.collator.evaluate(E)):r(E,A,I)}eachChild(E){E(this.lhs),E(this.rhs),this.collator&&E(this.collator)}outputDefined(){return!0}}}const $u=Ei("==",(function(l,r,s){return r===s}),uo),hu=Ei("!=",(function(l,r,s){return r!==s}),(function(l,r,s,p){return!uo(0,r,s,p)})),zl=Ei("<",(function(l,r,s){return r<s}),(function(l,r,s,p){return p.compare(r,s)<0})),P=Ei(">",(function(l,r,s){return r>s}),(function(l,r,s,p){return p.compare(r,s)>0})),Z=Ei("<=",(function(l,r,s){return r<=s}),(function(l,r,s,p){return p.compare(r,s)<=0})),ne=Ei(">=",(function(l,r,s){return r>=s}),(function(l,r,s,p){return p.compare(r,s)>=0}));class ye{constructor(r,s,p){this.type=Vs,this.locale=p,this.caseSensitive=r,this.diacriticSensitive=s}static parse(r,s){if(r.length!==2)return s.error("Expected one argument.");const p=r[1];if(typeof p!="object"||Array.isArray(p))return s.error("Collator options argument must be an object.");const v=s.parse(p["case-sensitive"]!==void 0&&p["case-sensitive"],1,Mn);if(!v)return null;const E=s.parse(p["diacritic-sensitive"]!==void 0&&p["diacritic-sensitive"],1,Mn);if(!E)return null;let A=null;return p.locale&&(A=s.parse(p.locale,1,yn),!A)?null:new ye(v,E,A)}evaluate(r){return new ys(this.caseSensitive.evaluate(r),this.diacriticSensitive.evaluate(r),this.locale?this.locale.evaluate(r):null)}eachChild(r){r(this.caseSensitive),r(this.diacriticSensitive),this.locale&&r(this.locale)}outputDefined(){return!1}}class at{constructor(r,s,p,v,E){this.type=yn,this.number=r,this.locale=s,this.currency=p,this.minFractionDigits=v,this.maxFractionDigits=E}static parse(r,s){if(r.length!==3)return s.error("Expected two arguments.");const p=s.parse(r[1],1,Lt);if(!p)return null;const v=r[2];if(typeof v!="object"||Array.isArray(v))return s.error("NumberFormat options argument must be an object.");let E=null;if(v.locale&&(E=s.parse(v.locale,1,yn),!E))return null;let A=null;if(v.currency&&(A=s.parse(v.currency,1,yn),!A))return null;let I=null;if(v["min-fraction-digits"]&&(I=s.parse(v["min-fraction-digits"],1,Lt),!I))return null;let z=null;return v["max-fraction-digits"]&&(z=s.parse(v["max-fraction-digits"],1,Lt),!z)?null:new at(p,E,A,I,z)}evaluate(r){return new Intl.NumberFormat(this.locale?this.locale.evaluate(r):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(r):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(r):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(r):void 0}).format(this.number.evaluate(r))}eachChild(r){r(this.number),this.locale&&r(this.locale),this.currency&&r(this.currency),this.minFractionDigits&&r(this.minFractionDigits),this.maxFractionDigits&&r(this.maxFractionDigits)}outputDefined(){return!1}}class ht{constructor(r){this.type=js,this.sections=r}static parse(r,s){if(r.length<2)return s.error("Expected at least one argument.");const p=r[1];if(!Array.isArray(p)&&typeof p=="object")return s.error("First argument must be an image or text section.");const v=[];let E=!1;for(let A=1;A<=r.length-1;++A){const I=r[A];if(E&&typeof I=="object"&&!Array.isArray(I)){E=!1;let z=null;if(I["font-scale"]&&(z=s.parse(I["font-scale"],1,Lt),!z))return null;let F=null;if(I["text-font"]&&(F=s.parse(I["text-font"],1,da(yn)),!F))return null;let $=null;if(I["text-color"]&&($=s.parse(I["text-color"],1,nr),!$))return null;let X=null;if(I["vertical-align"]){if(typeof I["vertical-align"]=="string"&&!Ma.includes(I["vertical-align"]))return s.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${I["vertical-align"]}' instead.`);if(X=s.parse(I["vertical-align"],1,yn),!X)return null}const te=v[v.length-1];te.scale=z,te.font=F,te.textColor=$,te.verticalAlign=X}else{const z=s.parse(r[A],1,Bn);if(!z)return null;const F=z.type.kind;if(F!=="string"&&F!=="value"&&F!=="null"&&F!=="resolvedImage")return s.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");E=!0,v.push({content:z,scale:null,font:null,textColor:null,verticalAlign:null})}}return new ht(v)}evaluate(r){return new Zi(this.sections.map((s=>{const p=s.content.evaluate(r);return fn(p)===Si?new Ll("",p,null,null,null,s.verticalAlign?s.verticalAlign.evaluate(r):null):new Ll(sn(p),null,s.scale?s.scale.evaluate(r):null,s.font?s.font.evaluate(r).join(","):null,s.textColor?s.textColor.evaluate(r):null,s.verticalAlign?s.verticalAlign.evaluate(r):null)})))}eachChild(r){for(const s of this.sections)r(s.content),s.scale&&r(s.scale),s.font&&r(s.font),s.textColor&&r(s.textColor),s.verticalAlign&&r(s.verticalAlign)}outputDefined(){return!1}}class Wt{constructor(r){this.type=Si,this.input=r}static parse(r,s){if(r.length!==2)return s.error("Expected two arguments.");const p=s.parse(r[1],1,yn);return p?new Wt(p):s.error("No image name provided.")}evaluate(r){const s=this.input.evaluate(r),p=ur.fromString(s);return p&&r.availableImages&&(p.available=r.availableImages.indexOf(s)>-1),p}eachChild(r){r(this.input)}outputDefined(){return!1}}class kn{constructor(r){this.type=Lt,this.input=r}static parse(r,s){if(r.length!==2)return s.error(`Expected 1 argument, but found ${r.length-1} instead.`);const p=s.parse(r[1],1);return p?p.type.kind!=="array"&&p.type.kind!=="string"&&p.type.kind!=="value"?s.error(`Expected argument of type string or array, but found ${xi(p.type)} instead.`):new kn(p):null}evaluate(r){const s=this.input.evaluate(r);if(typeof s=="string")return[...s].length;if(Array.isArray(s))return s.length;throw new xn(`Expected value to be of type string or array, but found ${xi(fn(s))} instead.`)}eachChild(r){r(this.input)}outputDefined(){return!1}}const Wn=8192;function wi(l,r){const s=(180+l[0])/360,p=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+l[1]*Math.PI/360)))/360,v=Math.pow(2,r.z);return[Math.round(s*v*Wn),Math.round(p*v*Wn)]}function Xi(l,r){const s=Math.pow(2,r.z);return[(v=(l[0]/Wn+r.x)/s,360*v-180),(p=(l[1]/Wn+r.y)/s,360/Math.PI*Math.atan(Math.exp((180-360*p)*Math.PI/180))-90)];var p,v}function qa(l,r){l[0]=Math.min(l[0],r[0]),l[1]=Math.min(l[1],r[1]),l[2]=Math.max(l[2],r[0]),l[3]=Math.max(l[3],r[1])}function Ga(l,r){return!(l[0]<=r[0]||l[2]>=r[2]||l[1]<=r[1]||l[3]>=r[3])}function Xs(l,r,s){const p=l[0]-r[0],v=l[1]-r[1],E=l[0]-s[0],A=l[1]-s[1];return p*A-E*v==0&&p*E<=0&&v*A<=0}function Ts(l,r,s,p){return(v=[p[0]-s[0],p[1]-s[1]])[0]*(E=[r[0]-l[0],r[1]-l[1]])[1]-v[1]*E[0]!=0&&!(!jd(l,r,s,p)||!jd(s,p,l,r));var v,E}function du(l,r,s){for(const p of s)for(let v=0;v<p.length-1;++v)if(Ts(l,r,p[v],p[v+1]))return!0;return!1}function Ws(l,r,s=!1){let p=!1;for(const I of r)for(let z=0;z<I.length-1;z++){if(Xs(l,I[z],I[z+1]))return s;(E=I[z])[1]>(v=l)[1]!=(A=I[z+1])[1]>v[1]&&v[0]<(A[0]-E[0])*(v[1]-E[1])/(A[1]-E[1])+E[0]&&(p=!p)}var v,E,A;return p}function fu(l,r){for(const s of r)if(Ws(l,s))return!0;return!1}function Ks(l,r){for(const s of l)if(!Ws(s,r))return!1;for(let s=0;s<l.length-1;++s)if(du(l[s],l[s+1],r))return!1;return!0}function qu(l,r){for(const s of r)if(Ks(l,s))return!0;return!1}function jd(l,r,s,p){const v=p[0]-s[0],E=p[1]-s[1],A=(l[0]-s[0])*E-v*(l[1]-s[1]),I=(r[0]-s[0])*E-v*(r[1]-s[1]);return A>0&&I<0||A<0&&I>0}function co(l,r,s){const p=[];for(let v=0;v<l.length;v++){const E=[];for(let A=0;A<l[v].length;A++){const I=wi(l[v][A],s);qa(r,I),E.push(I)}p.push(E)}return p}function Yh(l,r,s){const p=[];for(let v=0;v<l.length;v++){const E=co(l[v],r,s);p.push(E)}return p}function Ys(l,r,s,p){if(l[0]<s[0]||l[0]>s[2]){const v=.5*p;let E=l[0]-s[0]>v?-p:s[0]-l[0]>v?p:0;E===0&&(E=l[0]-s[2]>v?-p:s[2]-l[0]>v?p:0),l[0]+=E}qa(r,l)}function Gu(l,r,s,p){const v=Math.pow(2,p.z)*Wn,E=[p.x*Wn,p.y*Wn],A=[];for(const I of l)for(const z of I){const F=[z.x+E[0],z.y+E[1]];Ys(F,r,s,v),A.push(F)}return A}function Zu(l,r,s,p){const v=Math.pow(2,p.z)*Wn,E=[p.x*Wn,p.y*Wn],A=[];for(const z of l){const F=[];for(const $ of z){const X=[$.x+E[0],$.y+E[1]];qa(r,X),F.push(X)}A.push(F)}if(r[2]-r[0]<=v/2){(I=r)[0]=I[1]=1/0,I[2]=I[3]=-1/0;for(const z of A)for(const F of z)Ys(F,r,s,v)}var I;return A}class Ro{constructor(r,s){this.type=Mn,this.geojson=r,this.geometries=s}static parse(r,s){if(r.length!==2)return s.error(`'within' expression requires exactly one argument, but found ${r.length-1} instead.`);if(fa(r[1])){const p=r[1];if(p.type==="FeatureCollection"){const v=[];for(const E of p.features){const{type:A,coordinates:I}=E.geometry;A==="Polygon"&&v.push(I),A==="MultiPolygon"&&v.push(...I)}if(v.length)return new Ro(p,{type:"MultiPolygon",coordinates:v})}else if(p.type==="Feature"){const v=p.geometry.type;if(v==="Polygon"||v==="MultiPolygon")return new Ro(p,p.geometry)}else if(p.type==="Polygon"||p.type==="MultiPolygon")return new Ro(p,p)}return s.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(r){if(r.geometry()!=null&&r.canonicalID()!=null){if(r.geometryType()==="Point")return(function(s,p){const v=[1/0,1/0,-1/0,-1/0],E=[1/0,1/0,-1/0,-1/0],A=s.canonicalID();if(p.type==="Polygon"){const I=co(p.coordinates,E,A),z=Gu(s.geometry(),v,E,A);if(!Ga(v,E))return!1;for(const F of z)if(!Ws(F,I))return!1}if(p.type==="MultiPolygon"){const I=Yh(p.coordinates,E,A),z=Gu(s.geometry(),v,E,A);if(!Ga(v,E))return!1;for(const F of z)if(!fu(F,I))return!1}return!0})(r,this.geometries);if(r.geometryType()==="LineString")return(function(s,p){const v=[1/0,1/0,-1/0,-1/0],E=[1/0,1/0,-1/0,-1/0],A=s.canonicalID();if(p.type==="Polygon"){const I=co(p.coordinates,E,A),z=Zu(s.geometry(),v,E,A);if(!Ga(v,E))return!1;for(const F of z)if(!Ks(F,I))return!1}if(p.type==="MultiPolygon"){const I=Yh(p.coordinates,E,A),z=Zu(s.geometry(),v,E,A);if(!Ga(v,E))return!1;for(const F of z)if(!qu(F,I))return!1}return!0})(r,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let pu=class{constructor(l=[],r=(s,p)=>s<p?-1:s>p?1:0){if(this.data=l,this.length=this.data.length,this.compare=r,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(l){this.data.push(l),this._up(this.length++)}pop(){if(this.length===0)return;const l=this.data[0],r=this.data.pop();return--this.length>0&&(this.data[0]=r,this._down(0)),l}peek(){return this.data[0]}_up(l){const{data:r,compare:s}=this,p=r[l];for(;l>0;){const v=l-1>>1,E=r[v];if(s(p,E)>=0)break;r[l]=E,l=v}r[l]=p}_down(l){const{data:r,compare:s}=this,p=this.length>>1,v=r[l];for(;l<p;){let E=1+(l<<1);const A=E+1;if(A<this.length&&s(r[A],r[E])<0&&(E=A),s(r[E],v)>=0)break;r[l]=r[E],l=E}r[l]=v}};function dh(l,r,s=0,p=l.length-1,v=Hu){for(;p>s;){if(p-s>600){const z=p-s+1,F=r-s+1,$=Math.log(z),X=.5*Math.exp(2*$/3),te=.5*Math.sqrt($*X*(z-X)/z)*(F-z/2<0?-1:1);dh(l,r,Math.max(s,Math.floor(r-F*X/z+te)),Math.min(p,Math.floor(r+(z-F)*X/z+te)),v)}const E=l[r];let A=s,I=p;for(Ss(l,s,r),v(l[p],E)>0&&Ss(l,s,p);A<I;){for(Ss(l,A,I),A++,I--;v(l[A],E)<0;)A++;for(;v(l[I],E)>0;)I--}v(l[s],E)===0?Ss(l,s,I):(I++,Ss(l,I,p)),I<=r&&(s=I+1),r<=I&&(p=I-1)}}function Ss(l,r,s){const p=l[r];l[r]=l[s],l[s]=p}function Hu(l,r){return l<r?-1:l>r?1:0}function Xu(l,r){if(l.length<=1)return[l];const s=[];let p,v;for(const E of l){const A=Ud(E);A!==0&&(E.area=Math.abs(A),v===void 0&&(v=A<0),v===A<0?(p&&s.push(p),p=[E]):p.push(E))}if(p&&s.push(p),r>1)for(let E=0;E<s.length;E++)s[E].length<=r||(dh(s[E],r,1,s[E].length-1,kc),s[E]=s[E].slice(0,r));return s}function kc(l,r){return r.area-l.area}function Ud(l){let r=0;for(let s,p,v=0,E=l.length,A=E-1;v<E;A=v++)s=l[v],p=l[A],r+=(p.x-s.x)*(s.y+p.y);return r}const ll=1/298.257223563,$d=ll*(2-ll),Zl=Math.PI/180;class Qh{constructor(r){const s=6378.137*Zl*1e3,p=Math.cos(r*Zl),v=1/(1-$d*(1-p*p)),E=Math.sqrt(v);this.kx=s*E*p,this.ky=s*E*v*(1-$d)}distance(r,s){const p=this.wrap(r[0]-s[0])*this.kx,v=(r[1]-s[1])*this.ky;return Math.sqrt(p*p+v*v)}pointOnLine(r,s){let p,v,E,A,I=1/0;for(let z=0;z<r.length-1;z++){let F=r[z][0],$=r[z][1],X=this.wrap(r[z+1][0]-F)*this.kx,te=(r[z+1][1]-$)*this.ky,ie=0;X===0&&te===0||(ie=(this.wrap(s[0]-F)*this.kx*X+(s[1]-$)*this.ky*te)/(X*X+te*te),ie>1?(F=r[z+1][0],$=r[z+1][1]):ie>0&&(F+=X/this.kx*ie,$+=te/this.ky*ie)),X=this.wrap(s[0]-F)*this.kx,te=(s[1]-$)*this.ky;const re=X*X+te*te;re<I&&(I=re,p=F,v=$,E=z,A=ie)}return{point:[p,v],index:E,t:Math.max(0,Math.min(1,A))}}wrap(r){for(;r<-180;)r+=360;for(;r>180;)r-=360;return r}}function ul(l,r){return r[0]-l[0]}function ra(l){return l[1]-l[0]+1}function Es(l,r){return l[1]>=l[0]&&l[1]<r}function oi(l,r){if(l[0]>l[1])return[null,null];const s=ra(l);if(r){if(s===2)return[l,null];const v=Math.floor(s/2);return[[l[0],l[0]+v],[l[0]+v,l[1]]]}if(s===1)return[l,null];const p=Math.floor(s/2)-1;return[[l[0],l[0]+p],[l[0]+p+1,l[1]]]}function mu(l,r){if(!Es(r,l.length))return[1/0,1/0,-1/0,-1/0];const s=[1/0,1/0,-1/0,-1/0];for(let p=r[0];p<=r[1];++p)qa(s,l[p]);return s}function Wu(l){const r=[1/0,1/0,-1/0,-1/0];for(const s of l)for(const p of s)qa(r,p);return r}function Ku(l){return l[0]!==-1/0&&l[1]!==-1/0&&l[2]!==1/0&&l[3]!==1/0}function cl(l,r,s){if(!Ku(l)||!Ku(r))return NaN;let p=0,v=0;return l[2]<r[0]&&(p=r[0]-l[2]),l[0]>r[2]&&(p=l[0]-r[2]),l[1]>r[3]&&(v=l[1]-r[3]),l[3]<r[1]&&(v=r[1]-l[3]),s.distance([0,0],[p,v])}function hl(l,r,s){const p=s.pointOnLine(r,l);return s.distance(l,p.point)}function dl(l,r,s,p,v){const E=Math.min(hl(l,[s,p],v),hl(r,[s,p],v)),A=Math.min(hl(s,[l,r],v),hl(p,[l,r],v));return Math.min(E,A)}function fh(l,r,s,p,v){if(!Es(r,l.length)||!Es(p,s.length))return 1/0;let E=1/0;for(let A=r[0];A<r[1];++A){const I=l[A],z=l[A+1];for(let F=p[0];F<p[1];++F){const $=s[F],X=s[F+1];if(Ts(I,z,$,X))return 0;E=Math.min(E,dl(I,z,$,X,v))}}return E}function Dc(l,r,s,p,v){if(!Es(r,l.length)||!Es(p,s.length))return NaN;let E=1/0;for(let A=r[0];A<=r[1];++A)for(let I=p[0];I<=p[1];++I)if(E=Math.min(E,v.distance(l[A],s[I])),E===0)return E;return E}function Yu(l,r,s){if(Ws(l,r,!0))return 0;let p=1/0;for(const v of r){const E=v[0],A=v[v.length-1];if(E!==A&&(p=Math.min(p,hl(l,[A,E],s)),p===0))return p;const I=s.pointOnLine(v,l);if(p=Math.min(p,s.distance(l,I.point)),p===0)return p}return p}function qd(l,r,s,p){if(!Es(r,l.length))return NaN;for(let E=r[0];E<=r[1];++E)if(Ws(l[E],s,!0))return 0;let v=1/0;for(let E=r[0];E<r[1];++E){const A=l[E],I=l[E+1];for(const z of s)for(let F=0,$=z.length,X=$-1;F<$;X=F++){const te=z[X],ie=z[F];if(Ts(A,I,te,ie))return 0;v=Math.min(v,dl(A,I,te,ie,p))}}return v}function Ol(l,r){for(const s of l)for(const p of s)if(Ws(p,r,!0))return!0;return!1}function Qu(l,r,s,p=1/0){const v=Wu(l),E=Wu(r);if(p!==1/0&&cl(v,E,s)>=p)return p;if(Ga(v,E)){if(Ol(l,r))return 0}else if(Ol(r,l))return 0;let A=1/0;for(const I of l)for(let z=0,F=I.length,$=F-1;z<F;$=z++){const X=I[$],te=I[z];for(const ie of r)for(let re=0,oe=ie.length,pe=oe-1;re<oe;pe=re++){const Te=ie[pe],We=ie[re];if(Ts(X,te,Te,We))return 0;A=Math.min(A,dl(X,te,Te,We,s))}}return A}function zc(l,r,s,p,v,E){if(!E)return;const A=cl(mu(p,E),v,s);A<r&&l.push([A,E,[0,0]])}function Oc(l,r,s,p,v,E,A){if(!E||!A)return;const I=cl(mu(p,E),mu(v,A),s);I<r&&l.push([I,E,A])}function aa(l,r,s,p,v=1/0){let E=Math.min(p.distance(l[0],s[0][0]),v);if(E===0)return E;const A=new pu([[0,[0,l.length-1],[0,0]]],ul),I=Wu(s);for(;A.length>0;){const z=A.pop();if(z[0]>=E)continue;const F=z[1],$=r?50:100;if(ra(F)<=$){if(!Es(F,l.length))return NaN;if(r){const X=qd(l,F,s,p);if(isNaN(X)||X===0)return X;E=Math.min(E,X)}else for(let X=F[0];X<=F[1];++X){const te=Yu(l[X],s,p);if(E=Math.min(E,te),E===0)return 0}}else{const X=oi(F,r);zc(A,E,p,l,I,X[0]),zc(A,E,p,l,I,X[1])}}return E}function Hl(l,r,s,p,v,E=1/0){let A=Math.min(E,v.distance(l[0],s[0]));if(A===0)return A;const I=new pu([[0,[0,l.length-1],[0,s.length-1]]],ul);for(;I.length>0;){const z=I.pop();if(z[0]>=A)continue;const F=z[1],$=z[2],X=r?50:100,te=p?50:100;if(ra(F)<=X&&ra($)<=te){if(!Es(F,l.length)&&Es($,s.length))return NaN;let ie;if(r&&p)ie=fh(l,F,s,$,v),A=Math.min(A,ie);else if(r&&!p){const re=l.slice(F[0],F[1]+1);for(let oe=$[0];oe<=$[1];++oe)if(ie=hl(s[oe],re,v),A=Math.min(A,ie),A===0)return A}else if(!r&&p){const re=s.slice($[0],$[1]+1);for(let oe=F[0];oe<=F[1];++oe)if(ie=hl(l[oe],re,v),A=Math.min(A,ie),A===0)return A}else ie=Dc(l,F,s,$,v),A=Math.min(A,ie)}else{const ie=oi(F,r),re=oi($,p);Oc(I,A,v,l,s,ie[0],re[0]),Oc(I,A,v,l,s,ie[0],re[1]),Oc(I,A,v,l,s,ie[1],re[0]),Oc(I,A,v,l,s,ie[1],re[1])}}return A}function ph(l){return l.type==="MultiPolygon"?l.coordinates.map((r=>({type:"Polygon",coordinates:r}))):l.type==="MultiLineString"?l.coordinates.map((r=>({type:"LineString",coordinates:r}))):l.type==="MultiPoint"?l.coordinates.map((r=>({type:"Point",coordinates:r}))):[l]}class Lo{constructor(r,s){this.type=Lt,this.geojson=r,this.geometries=s}static parse(r,s){if(r.length!==2)return s.error(`'distance' expression requires exactly one argument, but found ${r.length-1} instead.`);if(fa(r[1])){const p=r[1];if(p.type==="FeatureCollection")return new Lo(p,p.features.map((v=>ph(v.geometry))).flat());if(p.type==="Feature")return new Lo(p,ph(p.geometry));if("type"in p&&"coordinates"in p)return new Lo(p,ph(p))}return s.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(r){if(r.geometry()!=null&&r.canonicalID()!=null){if(r.geometryType()==="Point")return(function(s,p){const v=s.geometry(),E=v.flat().map((z=>Xi([z.x,z.y],s.canonical)));if(v.length===0)return NaN;const A=new Qh(E[0][1]);let I=1/0;for(const z of p){switch(z.type){case"Point":I=Math.min(I,Hl(E,!1,[z.coordinates],!1,A,I));break;case"LineString":I=Math.min(I,Hl(E,!1,z.coordinates,!0,A,I));break;case"Polygon":I=Math.min(I,aa(E,!1,z.coordinates,A,I))}if(I===0)return I}return I})(r,this.geometries);if(r.geometryType()==="LineString")return(function(s,p){const v=s.geometry(),E=v.flat().map((z=>Xi([z.x,z.y],s.canonical)));if(v.length===0)return NaN;const A=new Qh(E[0][1]);let I=1/0;for(const z of p){switch(z.type){case"Point":I=Math.min(I,Hl(E,!0,[z.coordinates],!1,A,I));break;case"LineString":I=Math.min(I,Hl(E,!0,z.coordinates,!0,A,I));break;case"Polygon":I=Math.min(I,aa(E,!0,z.coordinates,A,I))}if(I===0)return I}return I})(r,this.geometries);if(r.geometryType()==="Polygon")return(function(s,p){const v=s.geometry();if(v.length===0||v[0].length===0)return NaN;const E=Xu(v,0).map((z=>z.map((F=>F.map(($=>Xi([$.x,$.y],s.canonical))))))),A=new Qh(E[0][0][0][1]);let I=1/0;for(const z of p)for(const F of E){switch(z.type){case"Point":I=Math.min(I,aa([z.coordinates],!1,F,A,I));break;case"LineString":I=Math.min(I,aa(z.coordinates,!0,F,A,I));break;case"Polygon":I=Math.min(I,Qu(F,z.coordinates,A,I))}if(I===0)return I}return I})(r,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class Nc{constructor(r){this.type=Bn,this.key=r}static parse(r,s){if(r.length!==2)return s.error(`Expected 1 argument, but found ${r.length-1} instead.`);const p=r[1];return p==null?s.error("Global state property must be defined."):typeof p!="string"?s.error(`Global state property must be string, but found ${typeof r[1]} instead.`):new Nc(p)}evaluate(r){var s;const p=(s=r.globals)===null||s===void 0?void 0:s.globalState;return p&&Object.keys(p).length!==0?Qa(p,this.key):null}eachChild(){}outputDefined(){return!1}}const gu={"==":$u,"!=":hu,">":P,"<":zl,">=":ne,"<=":Z,array:Dr,at:ia,boolean:Dr,case:xs,coalesce:Dl,collator:ye,format:ht,image:Wt,in:Ia,"index-of":Pa,interpolate:or,"interpolate-hcl":or,"interpolate-lab":or,length:kn,let:Xn,literal:na,match:zr,number:Dr,"number-format":at,object:Dr,slice:ql,step:Hi,string:Dr,"to-boolean":sr,"to-color":sr,"to-number":sr,"to-string":sr,var:Io,within:Ro,distance:Lo,"global-state":Nc};class ho{constructor(r,s,p,v){this.name=r,this.type=s,this._evaluate=p,this.args=v}evaluate(r){return this._evaluate(r,this.args)}eachChild(r){this.args.forEach(r)}outputDefined(){return!1}static parse(r,s){const p=r[0],v=ho.definitions[p];if(!v)return s.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0);const E=Array.isArray(v)?v[0]:v.type,A=Array.isArray(v)?[[v[1],v[2]]]:v.overloads,I=A.filter((([F])=>!Array.isArray(F)||F.length===r.length-1));let z=null;for(const[F,$]of I){z=new bs(s.registry,Xl,s.path,null,s.scope);const X=[];let te=!1;for(let ie=1;ie<r.length;ie++){const re=r[ie],oe=Array.isArray(F)?F[ie-1]:F.type,pe=z.parse(re,1+X.length,oe);if(!pe){te=!0;break}X.push(pe)}if(!te)if(Array.isArray(F)&&F.length!==X.length)z.error(`Expected ${F.length} arguments, but found ${X.length} instead.`);else{for(let ie=0;ie<X.length;ie++){const re=Array.isArray(F)?F[ie]:F.type,oe=X[ie];z.concat(ie+1).checkSubtype(re,oe.type)}if(z.errors.length===0)return new ho(p,E,$,X)}}if(I.length===1)s.errors.push(...z.errors);else{const F=(I.length?I:A).map((([X])=>{return te=X,Array.isArray(te)?`(${te.map(xi).join(", ")})`:`(${xi(te.type)}...)`;var te})).join(" | "),$=[];for(let X=1;X<r.length;X++){const te=s.parse(r[X],1+$.length);if(!te)return null;$.push(xi(te.type))}s.error(`Expected arguments of type ${F}, but found (${$.join(", ")}) instead.`)}return null}static register(r,s){ho.definitions=s;for(const p in s)r[p]=ho}}function _u(l,[r,s,p,v]){r=r.evaluate(l),s=s.evaluate(l),p=p.evaluate(l);const E=v?v.evaluate(l):1,A=bn(r,s,p,E);if(A)throw new xn(A);return new Ln(r/255,s/255,p/255,E,!1)}function Jh(l,r){return l in r}function fl(l,r){const s=r[l];return s===void 0?null:s}function pa(l){return{type:l}}function Xl(l){if(l instanceof Io)return Xl(l.boundExpression);if(l instanceof ho&&l.name==="error"||l instanceof ye||l instanceof Ro||l instanceof Lo||l instanceof Nc)return!1;const r=l instanceof sr||l instanceof Dr;let s=!0;return l.eachChild((p=>{s=r?s&&Xl(p):s&&p instanceof na})),!!s&&ts(l)&&yu(l,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function ts(l){if(l instanceof ho&&(l.name==="get"&&l.args.length===1||l.name==="feature-state"||l.name==="has"&&l.args.length===1||l.name==="properties"||l.name==="geometry-type"||l.name==="id"||/^filter-/.test(l.name))||l instanceof Ro||l instanceof Lo)return!1;let r=!0;return l.eachChild((s=>{r&&!ts(s)&&(r=!1)})),r}function ma(l){if(l instanceof ho&&l.name==="feature-state")return!1;let r=!0;return l.eachChild((s=>{r&&!ma(s)&&(r=!1)})),r}function yu(l,r){if(l instanceof ho&&r.indexOf(l.name)>=0)return!1;let s=!0;return l.eachChild((p=>{s&&!yu(p,r)&&(s=!1)})),s}function Ju(l){return{result:"success",value:l}}function Qs(l){return{result:"error",value:l}}function pl(l){return l["property-type"]==="data-driven"||l["property-type"]==="cross-faded-data-driven"}function ko(l){return!!l.expression&&l.expression.parameters.indexOf("zoom")>-1}function Wl(l){return!!l.expression&&l.expression.interpolated}function qn(l){return l instanceof Number?"number":l instanceof String?"string":l instanceof Boolean?"boolean":Array.isArray(l)?"array":l===null?"null":typeof l}function Do(l){return typeof l=="object"&&l!==null&&!Array.isArray(l)&&fn(l)===Eo}function zf(l){return l}function ns(l,r){const s=l.stops&&typeof l.stops[0][0]=="object",p=s||!(s||l.property!==void 0),v=l.type||(Wl(r)?"exponential":"interval"),E=(function($){switch($.type){case"color":return Ln.parse;case"padding":return pr.parse;case"numberArray":return hn.parse;case"colorArray":return fi.parse;default:return null}})(r);if(E&&((l=en({},l)).stops&&(l.stops=l.stops.map(($=>[$[0],E($[1])]))),l.default=E(l.default?l.default:r.default)),l.colorSpace&&(A=l.colorSpace)!=="rgb"&&A!=="hcl"&&A!=="lab")throw new Error(`Unknown color space: "${l.colorSpace}"`);var A;const I=(function($){switch($){case"exponential":return ec;case"interval":return ed;case"categorical":return Oo;case"identity":return vu;default:throw new Error(`Unknown function type "${$}"`)}})(v);let z,F;if(v==="categorical"){z=Object.create(null);for(const $ of l.stops)z[$[0]]=$[1];F=typeof l.stops[0][0]}if(s){const $={},X=[];for(let re=0;re<l.stops.length;re++){const oe=l.stops[re],pe=oe[0].zoom;$[pe]===void 0&&($[pe]={zoom:pe,type:l.type,property:l.property,default:l.default,stops:[]},X.push(pe)),$[pe].stops.push([oe[0].value,oe[1]])}const te=[];for(const re of X)te.push([$[re].zoom,ns($[re],r)]);const ie={name:"linear"};return{kind:"composite",interpolationType:ie,interpolationFactor:or.interpolationFactor.bind(void 0,ie),zoomStops:te.map((re=>re[0])),evaluate:({zoom:re},oe)=>ec({stops:te,base:l.base},r,re).evaluate(re,oe)}}if(p){const $=v==="exponential"?{name:"exponential",base:l.base!==void 0?l.base:1}:null;return{kind:"camera",interpolationType:$,interpolationFactor:or.interpolationFactor.bind(void 0,$),zoomStops:l.stops.map((X=>X[0])),evaluate:({zoom:X})=>I(l,r,X,z,F)}}return{kind:"source",evaluate($,X){const te=X&&X.properties?X.properties[l.property]:void 0;return te===void 0?zo(l.default,r.default):I(l,r,te,z,F)}}}function zo(l,r,s){return l!==void 0?l:r!==void 0?r:s!==void 0?s:void 0}function Oo(l,r,s,p,v){return zo(typeof s===v?p[s]:void 0,l.default,r.default)}function ed(l,r,s){if(qn(s)!=="number")return zo(l.default,r.default);const p=l.stops.length;if(p===1||s<=l.stops[0][0])return l.stops[0][1];if(s>=l.stops[p-1][0])return l.stops[p-1][1];const v=Po(l.stops.map((E=>E[0])),s);return l.stops[v][1]}function ec(l,r,s){const p=l.base!==void 0?l.base:1;if(qn(s)!=="number")return zo(l.default,r.default);const v=l.stops.length;if(v===1||s<=l.stops[0][0])return l.stops[0][1];if(s>=l.stops[v-1][0])return l.stops[v-1][1];const E=Po(l.stops.map(($=>$[0])),s),A=(function($,X,te,ie){const re=ie-te,oe=$-te;return re===0?0:X===1?oe/re:(Math.pow(X,oe)-1)/(Math.pow(X,re)-1)})(s,p,l.stops[E][0],l.stops[E+1][0]),I=l.stops[E][1],z=l.stops[E+1][1],F=ws[r.type]||zf;return typeof I.evaluate=="function"?{evaluate(...$){const X=I.evaluate.apply(void 0,$),te=z.evaluate.apply(void 0,$);if(X!==void 0&&te!==void 0)return F(X,te,A,l.colorSpace)}}:F(I,z,A,l.colorSpace)}function vu(l,r,s){switch(r.type){case"color":s=Ln.parse(s);break;case"formatted":s=Zi.fromString(s.toString());break;case"resolvedImage":s=ur.fromString(s.toString());break;case"padding":s=pr.parse(s);break;case"colorArray":s=fi.parse(s);break;case"numberArray":s=hn.parse(s);break;default:qn(s)===r.type||r.type==="enum"&&r.values[s]||(s=void 0)}return zo(s,l.default,r.default)}ho.register(gu,{error:[{kind:"error"},[yn],(l,[r])=>{throw new xn(r.evaluate(l))}],typeof:[yn,[Bn],(l,[r])=>xi(fn(r.evaluate(l)))],"to-rgba":[da(Lt,4),[nr],(l,[r])=>{const[s,p,v,E]=r.evaluate(l).rgb;return[255*s,255*p,255*v,E]}],rgb:[nr,[Lt,Lt,Lt],_u],rgba:[nr,[Lt,Lt,Lt,Lt],_u],has:{type:Mn,overloads:[[[yn],(l,[r])=>Jh(r.evaluate(l),l.properties())],[[yn,Eo],(l,[r,s])=>Jh(r.evaluate(l),s.evaluate(l))]]},get:{type:Bn,overloads:[[[yn],(l,[r])=>fl(r.evaluate(l),l.properties())],[[yn,Eo],(l,[r,s])=>fl(r.evaluate(l),s.evaluate(l))]]},"feature-state":[Bn,[yn],(l,[r])=>fl(r.evaluate(l),l.featureState||{})],properties:[Eo,[],l=>l.properties()],"geometry-type":[yn,[],l=>l.geometryType()],id:[Bn,[],l=>l.id()],zoom:[Lt,[],l=>l.globals.zoom],"heatmap-density":[Lt,[],l=>l.globals.heatmapDensity||0],elevation:[Lt,[],l=>l.globals.elevation||0],"line-progress":[Lt,[],l=>l.globals.lineProgress||0],accumulated:[Bn,[],l=>l.globals.accumulated===void 0?null:l.globals.accumulated],"+":[Lt,pa(Lt),(l,r)=>{let s=0;for(const p of r)s+=p.evaluate(l);return s}],"*":[Lt,pa(Lt),(l,r)=>{let s=1;for(const p of r)s*=p.evaluate(l);return s}],"-":{type:Lt,overloads:[[[Lt,Lt],(l,[r,s])=>r.evaluate(l)-s.evaluate(l)],[[Lt],(l,[r])=>-r.evaluate(l)]]},"/":[Lt,[Lt,Lt],(l,[r,s])=>r.evaluate(l)/s.evaluate(l)],"%":[Lt,[Lt,Lt],(l,[r,s])=>r.evaluate(l)%s.evaluate(l)],ln2:[Lt,[],()=>Math.LN2],pi:[Lt,[],()=>Math.PI],e:[Lt,[],()=>Math.E],"^":[Lt,[Lt,Lt],(l,[r,s])=>Math.pow(r.evaluate(l),s.evaluate(l))],sqrt:[Lt,[Lt],(l,[r])=>Math.sqrt(r.evaluate(l))],log10:[Lt,[Lt],(l,[r])=>Math.log(r.evaluate(l))/Math.LN10],ln:[Lt,[Lt],(l,[r])=>Math.log(r.evaluate(l))],log2:[Lt,[Lt],(l,[r])=>Math.log(r.evaluate(l))/Math.LN2],sin:[Lt,[Lt],(l,[r])=>Math.sin(r.evaluate(l))],cos:[Lt,[Lt],(l,[r])=>Math.cos(r.evaluate(l))],tan:[Lt,[Lt],(l,[r])=>Math.tan(r.evaluate(l))],asin:[Lt,[Lt],(l,[r])=>Math.asin(r.evaluate(l))],acos:[Lt,[Lt],(l,[r])=>Math.acos(r.evaluate(l))],atan:[Lt,[Lt],(l,[r])=>Math.atan(r.evaluate(l))],min:[Lt,pa(Lt),(l,r)=>Math.min(...r.map((s=>s.evaluate(l))))],max:[Lt,pa(Lt),(l,r)=>Math.max(...r.map((s=>s.evaluate(l))))],abs:[Lt,[Lt],(l,[r])=>Math.abs(r.evaluate(l))],round:[Lt,[Lt],(l,[r])=>{const s=r.evaluate(l);return s<0?-Math.round(-s):Math.round(s)}],floor:[Lt,[Lt],(l,[r])=>Math.floor(r.evaluate(l))],ceil:[Lt,[Lt],(l,[r])=>Math.ceil(r.evaluate(l))],"filter-==":[Mn,[yn,Bn],(l,[r,s])=>l.properties()[r.value]===s.value],"filter-id-==":[Mn,[Bn],(l,[r])=>l.id()===r.value],"filter-type-==":[Mn,[yn],(l,[r])=>l.geometryType()===r.value],"filter-<":[Mn,[yn,Bn],(l,[r,s])=>{const p=l.properties()[r.value],v=s.value;return typeof p==typeof v&&p<v}],"filter-id-<":[Mn,[Bn],(l,[r])=>{const s=l.id(),p=r.value;return typeof s==typeof p&&s<p}],"filter->":[Mn,[yn,Bn],(l,[r,s])=>{const p=l.properties()[r.value],v=s.value;return typeof p==typeof v&&p>v}],"filter-id->":[Mn,[Bn],(l,[r])=>{const s=l.id(),p=r.value;return typeof s==typeof p&&s>p}],"filter-<=":[Mn,[yn,Bn],(l,[r,s])=>{const p=l.properties()[r.value],v=s.value;return typeof p==typeof v&&p<=v}],"filter-id-<=":[Mn,[Bn],(l,[r])=>{const s=l.id(),p=r.value;return typeof s==typeof p&&s<=p}],"filter->=":[Mn,[yn,Bn],(l,[r,s])=>{const p=l.properties()[r.value],v=s.value;return typeof p==typeof v&&p>=v}],"filter-id->=":[Mn,[Bn],(l,[r])=>{const s=l.id(),p=r.value;return typeof s==typeof p&&s>=p}],"filter-has":[Mn,[Bn],(l,[r])=>r.value in l.properties()],"filter-has-id":[Mn,[],l=>l.id()!==null&&l.id()!==void 0],"filter-type-in":[Mn,[da(yn)],(l,[r])=>r.value.indexOf(l.geometryType())>=0],"filter-id-in":[Mn,[da(Bn)],(l,[r])=>r.value.indexOf(l.id())>=0],"filter-in-small":[Mn,[yn,da(Bn)],(l,[r,s])=>s.value.indexOf(l.properties()[r.value])>=0],"filter-in-large":[Mn,[yn,da(Bn)],(l,[r,s])=>(function(p,v,E,A){for(;E<=A;){const I=E+A>>1;if(v[I]===p)return!0;v[I]>p?A=I-1:E=I+1}return!1})(l.properties()[r.value],s.value,0,s.value.length-1)],all:{type:Mn,overloads:[[[Mn,Mn],(l,[r,s])=>r.evaluate(l)&&s.evaluate(l)],[pa(Mn),(l,r)=>{for(const s of r)if(!s.evaluate(l))return!1;return!0}]]},any:{type:Mn,overloads:[[[Mn,Mn],(l,[r,s])=>r.evaluate(l)||s.evaluate(l)],[pa(Mn),(l,r)=>{for(const s of r)if(s.evaluate(l))return!0;return!1}]]},"!":[Mn,[Mn],(l,[r])=>!r.evaluate(l)],"is-supported-script":[Mn,[yn],(l,[r])=>{const s=l.globals&&l.globals.isSupportedScript;return!s||s(r.evaluate(l))}],upcase:[yn,[yn],(l,[r])=>r.evaluate(l).toUpperCase()],downcase:[yn,[yn],(l,[r])=>r.evaluate(l).toLowerCase()],concat:[yn,pa(Bn),(l,r)=>r.map((s=>sn(s.evaluate(l)))).join("")],"resolved-locale":[yn,[Vs],(l,[r])=>r.evaluate(l).resolvedLocale()]});class tc{constructor(r,s){this.expression=r,this._warningHistory={},this._evaluator=new lo,this._defaultValue=s?(function(p){if(p.type==="color"&&Do(p.default))return new Ln(0,0,0,0);switch(p.type){case"color":return Ln.parse(p.default)||null;case"padding":return pr.parse(p.default)||null;case"numberArray":return hn.parse(p.default)||null;case"colorArray":return fi.parse(p.default)||null;case"variableAnchorOffsetCollection":return ar.parse(p.default)||null;case"projectionDefinition":return xr.parse(p.default)||null;default:return p.default===void 0?null:p.default}})(s):null,this._enumValues=s&&s.type==="enum"?s.values:null}evaluateWithoutErrorHandling(r,s,p,v,E,A){return this._evaluator.globals=r,this._evaluator.feature=s,this._evaluator.featureState=p,this._evaluator.canonical=v,this._evaluator.availableImages=E||null,this._evaluator.formattedSection=A,this.expression.evaluate(this._evaluator)}evaluate(r,s,p,v,E,A){this._evaluator.globals=r,this._evaluator.feature=s||null,this._evaluator.featureState=p||null,this._evaluator.canonical=v,this._evaluator.availableImages=E||null,this._evaluator.formattedSection=A||null;try{const I=this.expression.evaluate(this._evaluator);if(I==null||typeof I=="number"&&I!=I)return this._defaultValue;if(this._enumValues&&!(I in this._enumValues))throw new xn(`Expected value to be one of ${Object.keys(this._enumValues).map((z=>JSON.stringify(z))).join(", ")}, but found ${JSON.stringify(I)} instead.`);return I}catch(I){return this._warningHistory[I.message]||(this._warningHistory[I.message]=!0,typeof console<"u"&&console.warn(I.message)),this._defaultValue}}}function nc(l){return Array.isArray(l)&&l.length>0&&typeof l[0]=="string"&&l[0]in gu}function bu(l,r){const s=new bs(gu,Xl,[],r?(function(v){const E={color:nr,string:yn,number:Lt,enum:yn,boolean:Mn,formatted:js,padding:gs,numberArray:Gr,colorArray:qr,projectionDefinition:il,resolvedImage:Si,variableAnchorOffsetCollection:Mr};return v.type==="array"?da(E[v.value]||Bn,v.length):E[v.type]})(r):void 0),p=s.parse(l,void 0,void 0,void 0,r&&r.type==="string"?{typeAnnotation:"coerce"}:void 0);return p?Ju(new tc(p,r)):Qs(s.errors)}class f{constructor(r,s){this.kind=r,this._styleExpression=s,this.isStateDependent=r!=="constant"&&!ma(s.expression),this.globalStateRefs=ue(s.expression)}evaluateWithoutErrorHandling(r,s,p,v,E,A){return this._styleExpression.evaluateWithoutErrorHandling(r,s,p,v,E,A)}evaluate(r,s,p,v,E,A){return this._styleExpression.evaluate(r,s,p,v,E,A)}}class x{constructor(r,s,p,v){this.kind=r,this.zoomStops=p,this._styleExpression=s,this.isStateDependent=r!=="camera"&&!ma(s.expression),this.globalStateRefs=ue(s.expression),this.interpolationType=v}evaluateWithoutErrorHandling(r,s,p,v,E,A){return this._styleExpression.evaluateWithoutErrorHandling(r,s,p,v,E,A)}evaluate(r,s,p,v,E,A){return this._styleExpression.evaluate(r,s,p,v,E,A)}interpolationFactor(r,s,p){return this.interpolationType?or.interpolationFactor(this.interpolationType,r,s,p):0}}function R(l,r){const s=bu(l,r);if(s.result==="error")return s;const p=s.value.expression,v=ts(p);if(!v&&!pl(r))return Qs([new tr("","data expressions not supported")]);const E=yu(p,["zoom"]);if(!E&&!ko(r))return Qs([new tr("","zoom expressions not supported")]);const A=K(p);return A||E?A instanceof tr?Qs([A]):A instanceof or&&!Wl(r)?Qs([new tr("",'"interpolate" expressions cannot be used with this property')]):Ju(A?new x(v?"camera":"composite",s.value,A.labels,A instanceof or?A.interpolation:void 0):new f(v?"constant":"source",s.value)):Qs([new tr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class V{constructor(r,s){this._parameters=r,this._specification=s,en(this,ns(this._parameters,this._specification))}static deserialize(r){return new V(r._parameters,r._specification)}static serialize(r){return{_parameters:r._parameters,_specification:r._specification}}}function K(l){let r=null;if(l instanceof Xn)r=K(l.result);else if(l instanceof Dl){for(const s of l.args)if(r=K(s),r)break}else(l instanceof Hi||l instanceof or)&&l.input instanceof ho&&l.input.name==="zoom"&&(r=l);return r instanceof tr||l.eachChild((s=>{const p=K(s);p instanceof tr?r=p:!r&&p?r=new tr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):r&&p&&r!==p&&(r=new tr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),r}function ue(l,r=new Set){return l instanceof Nc&&r.add(l.key),l.eachChild((s=>{ue(s,r)})),r}function Oe(l){if(l===!0||l===!1)return!0;if(!Array.isArray(l)||l.length===0)return!1;switch(l[0]){case"has":return l.length>=2&&l[1]!=="$id"&&l[1]!=="$type";case"in":return l.length>=3&&(typeof l[1]!="string"||Array.isArray(l[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return l.length!==3||Array.isArray(l[1])||Array.isArray(l[2]);case"any":case"all":for(const r of l.slice(1))if(!Oe(r)&&typeof r!="boolean")return!1;return!0;default:return!0}}const nt={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function ut(l){if(l==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};Oe(l)||(l=pn(l));const r=bu(l,nt);if(r.result==="error")throw new Error(r.value.map((s=>`${s.key}: ${s.message}`)).join(", "));return{filter:(s,p,v)=>r.value.evaluate(s,p,{},v),needGeometry:Kt(l),getGlobalStateRefs:()=>ue(r.value.expression)}}function Mt(l,r){return l<r?-1:l>r?1:0}function Kt(l){if(!Array.isArray(l))return!1;if(l[0]==="within"||l[0]==="distance")return!0;for(let r=1;r<l.length;r++)if(Kt(l[r]))return!0;return!1}function pn(l){if(!l)return!0;const r=l[0];return l.length<=1?r!=="any":r==="=="?Yn(l[1],l[2],"=="):r==="!="?Za(Yn(l[1],l[2],"==")):r==="<"||r===">"||r==="<="||r===">="?Yn(l[1],l[2],r):r==="any"?(s=l.slice(1),["any"].concat(s.map(pn))):r==="all"?["all"].concat(l.slice(1).map(pn)):r==="none"?["all"].concat(l.slice(1).map(pn).map(Za)):r==="in"?ga(l[1],l.slice(2)):r==="!in"?Za(ga(l[1],l.slice(2))):r==="has"?Zr(l[1]):r!=="!has"||Za(Zr(l[1]));var s}function Yn(l,r,s){switch(l){case"$type":return[`filter-type-${s}`,r];case"$id":return[`filter-id-${s}`,r];default:return[`filter-${s}`,l,r]}}function ga(l,r){if(r.length===0)return!1;switch(l){case"$type":return["filter-type-in",["literal",r]];case"$id":return["filter-id-in",["literal",r]];default:return r.length>200&&!r.some((s=>typeof s!=typeof r[0]))?["filter-in-large",l,["literal",r.sort(Mt)]]:["filter-in-small",l,["literal",r]]}}function Zr(l){switch(l){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",l]}}function Za(l){return["!",l]}function Ti(l){const r=typeof l;if(r==="number"||r==="boolean"||r==="string"||l==null)return JSON.stringify(l);if(Array.isArray(l)){let v="[";for(const E of l)v+=`${Ti(E)},`;return`${v}]`}const s=Object.keys(l).sort();let p="{";for(let v=0;v<s.length;v++)p+=`${JSON.stringify(s[v])}:${Ti(l[s[v]])},`;return`${p}}`}function Ri(l){let r="";for(const s of vn)r+=`/${Ti(l[s])}`;return r}function li(l){const r=l.value;return r?[new Pt(l.key,r,"constants have been deprecated as of v8")]:[]}function Li(l){return l instanceof Number||l instanceof String||l instanceof Boolean?l.valueOf():l}function Hr(l){if(Array.isArray(l))return l.map(Hr);if(l instanceof Object&&!(l instanceof Number||l instanceof String||l instanceof Boolean)){const r={};for(const s in l)r[s]=Hr(l[s]);return r}return Li(l)}function is(l){const r=l.key,s=l.value,p=l.valueSpec||{},v=l.objectElementValidators||{},E=l.style,A=l.styleSpec,I=l.validateSpec;let z=[];const F=qn(s);if(F!=="object")return[new Pt(r,s,`object expected, ${F} found`)];for(const $ in s){const X=$.split(".")[0],te=Qa(p,X)||p["*"];let ie;if(Qa(v,X))ie=v[X];else if(Qa(p,X))ie=I;else if(v["*"])ie=v["*"];else{if(!p["*"]){z.push(new Pt(r,s[$],`unknown property "${$}"`));continue}ie=I}z=z.concat(ie({key:(r&&`${r}.`)+$,value:s[$],valueSpec:te,style:E,styleSpec:A,object:s,objectKey:$,validateSpec:I},s))}for(const $ in p)v[$]||p[$].required&&p[$].default===void 0&&s[$]===void 0&&z.push(new Pt(r,s,`missing required property "${$}"`));return z}function No(l){const r=l.value,s=l.valueSpec,p=l.style,v=l.styleSpec,E=l.key,A=l.arrayElementValidator||l.validateSpec;if(qn(r)!=="array")return[new Pt(E,r,`array expected, ${qn(r)} found`)];if(s.length&&r.length!==s.length)return[new Pt(E,r,`array length ${s.length} expected, length ${r.length} found`)];if(s["min-length"]&&r.length<s["min-length"])return[new Pt(E,r,`array length at least ${s["min-length"]} expected, length ${r.length} found`)];let I={type:s.value,values:s.values};v.$version<7&&(I.function=s.function),qn(s.value)==="object"&&(I=s.value);let z=[];for(let F=0;F<r.length;F++)z=z.concat(A({array:r,arrayIndex:F,value:r[F],valueSpec:I,validateSpec:l.validateSpec,style:p,styleSpec:v,key:`${E}[${F}]`}));return z}function xu(l){const r=l.key,s=l.value,p=l.valueSpec;let v=qn(s);return v==="number"&&s!=s&&(v="NaN"),v!=="number"?[new Pt(r,s,`number expected, ${v} found`)]:"minimum"in p&&s<p.minimum?[new Pt(r,s,`${s} is less than the minimum value ${p.minimum}`)]:"maximum"in p&&s>p.maximum?[new Pt(r,s,`${s} is greater than the maximum value ${p.maximum}`)]:[]}function Or(l){const r=l.valueSpec,s=Li(l.value.type);let p,v,E,A={};const I=s!=="categorical"&&l.value.property===void 0,z=!I,F=qn(l.value.stops)==="array"&&qn(l.value.stops[0])==="array"&&qn(l.value.stops[0][0])==="object",$=is({key:l.key,value:l.value,valueSpec:l.styleSpec.function,validateSpec:l.validateSpec,style:l.style,styleSpec:l.styleSpec,objectElementValidators:{stops:function(ie){if(s==="identity")return[new Pt(ie.key,ie.value,'identity function may not have a "stops" property')];let re=[];const oe=ie.value;return re=re.concat(No({key:ie.key,value:oe,valueSpec:ie.valueSpec,validateSpec:ie.validateSpec,style:ie.style,styleSpec:ie.styleSpec,arrayElementValidator:X})),qn(oe)==="array"&&oe.length===0&&re.push(new Pt(ie.key,oe,"array must have at least one stop")),re},default:function(ie){return ie.validateSpec({key:ie.key,value:ie.value,valueSpec:r,validateSpec:ie.validateSpec,style:ie.style,styleSpec:ie.styleSpec})}}});return s==="identity"&&I&&$.push(new Pt(l.key,l.value,'missing required property "property"')),s==="identity"||l.value.stops||$.push(new Pt(l.key,l.value,'missing required property "stops"')),s==="exponential"&&l.valueSpec.expression&&!Wl(l.valueSpec)&&$.push(new Pt(l.key,l.value,"exponential functions not supported")),l.styleSpec.$version>=8&&(z&&!pl(l.valueSpec)?$.push(new Pt(l.key,l.value,"property functions not supported")):I&&!ko(l.valueSpec)&&$.push(new Pt(l.key,l.value,"zoom functions not supported"))),s!=="categorical"&&!F||l.value.property!==void 0||$.push(new Pt(l.key,l.value,'"property" property is required')),$;function X(ie){let re=[];const oe=ie.value,pe=ie.key;if(qn(oe)!=="array")return[new Pt(pe,oe,`array expected, ${qn(oe)} found`)];if(oe.length!==2)return[new Pt(pe,oe,`array length 2 expected, length ${oe.length} found`)];if(F){if(qn(oe[0])!=="object")return[new Pt(pe,oe,`object expected, ${qn(oe[0])} found`)];if(oe[0].zoom===void 0)return[new Pt(pe,oe,"object stop key must have zoom")];if(oe[0].value===void 0)return[new Pt(pe,oe,"object stop key must have value")];if(E&&E>Li(oe[0].zoom))return[new Pt(pe,oe[0].zoom,"stop zoom values must appear in ascending order")];Li(oe[0].zoom)!==E&&(E=Li(oe[0].zoom),v=void 0,A={}),re=re.concat(is({key:`${pe}[0]`,value:oe[0],valueSpec:{zoom:{}},validateSpec:ie.validateSpec,style:ie.style,styleSpec:ie.styleSpec,objectElementValidators:{zoom:xu,value:te}}))}else re=re.concat(te({key:`${pe}[0]`,value:oe[0],validateSpec:ie.validateSpec,style:ie.style,styleSpec:ie.styleSpec},oe));return nc(Hr(oe[1]))?re.concat([new Pt(`${pe}[1]`,oe[1],"expressions are not allowed in function stops.")]):re.concat(ie.validateSpec({key:`${pe}[1]`,value:oe[1],valueSpec:r,validateSpec:ie.validateSpec,style:ie.style,styleSpec:ie.styleSpec}))}function te(ie,re){const oe=qn(ie.value),pe=Li(ie.value),Te=ie.value!==null?ie.value:re;if(p){if(oe!==p)return[new Pt(ie.key,Te,`${oe} stop domain type must match previous stop domain type ${p}`)]}else p=oe;if(oe!=="number"&&oe!=="string"&&oe!=="boolean")return[new Pt(ie.key,Te,"stop domain value must be a number, string, or boolean")];if(oe!=="number"&&s!=="categorical"){let We=`number expected, ${oe} found`;return pl(r)&&s===void 0&&(We+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Pt(ie.key,Te,We)]}return s!=="categorical"||oe!=="number"||isFinite(pe)&&Math.floor(pe)===pe?s!=="categorical"&&oe==="number"&&v!==void 0&&pe<v?[new Pt(ie.key,Te,"stop domain values must appear in ascending order")]:(v=pe,s==="categorical"&&pe in A?[new Pt(ie.key,Te,"stop domain values must be unique")]:(A[pe]=!0,[])):[new Pt(ie.key,Te,`integer expected, found ${pe}`)]}}function rs(l){const r=(l.expressionContext==="property"?R:bu)(Hr(l.value),l.valueSpec);if(r.result==="error")return r.value.map((p=>new Pt(`${l.key}${p.key}`,l.value,p.message)));const s=r.value.expression||r.value._styleExpression.expression;if(l.expressionContext==="property"&&l.propertyKey==="text-font"&&!s.outputDefined())return[new Pt(l.key,l.value,`Invalid data expression for "${l.propertyKey}". Output values must be contained as literals within the expression.`)];if(l.expressionContext==="property"&&l.propertyType==="layout"&&!ma(s))return[new Pt(l.key,l.value,'"feature-state" data expressions are not supported with layout properties.')];if(l.expressionContext==="filter"&&!ma(s))return[new Pt(l.key,l.value,'"feature-state" data expressions are not supported with filters.')];if(l.expressionContext&&l.expressionContext.indexOf("cluster")===0){if(!yu(s,["zoom","feature-state"]))return[new Pt(l.key,l.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(l.expressionContext==="cluster-initial"&&!ts(s))return[new Pt(l.key,l.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ml(l){const r=l.key,s=l.value,p=qn(s);return p!=="string"?[new Pt(r,s,`color expected, ${p} found`)]:Ln.parse(String(s))?[]:[new Pt(r,s,`color expected, "${s}" found`)]}function Bo(l){const r=l.key,s=l.value,p=l.valueSpec,v=[];return Array.isArray(p.values)?p.values.indexOf(Li(s))===-1&&v.push(new Pt(r,s,`expected one of [${p.values.join(", ")}], ${JSON.stringify(s)} found`)):Object.keys(p.values).indexOf(Li(s))===-1&&v.push(new Pt(r,s,`expected one of [${Object.keys(p.values).join(", ")}], ${JSON.stringify(s)} found`)),v}function wu(l){return Oe(Hr(l.value))?rs(en({},l,{expressionContext:"filter",valueSpec:{value:"boolean"}})):ic(l)}function ic(l){const r=l.value,s=l.key;if(qn(r)!=="array")return[new Pt(s,r,`array expected, ${qn(r)} found`)];const p=l.styleSpec;let v,E=[];if(r.length<1)return[new Pt(s,r,"filter array must have at least 1 element")];switch(E=E.concat(Bo({key:`${s}[0]`,value:r[0],valueSpec:p.filter_operator,style:l.style,styleSpec:l.styleSpec})),Li(r[0])){case"<":case"<=":case">":case">=":r.length>=2&&Li(r[1])==="$type"&&E.push(new Pt(s,r,`"$type" cannot be use with operator "${r[0]}"`));case"==":case"!=":r.length!==3&&E.push(new Pt(s,r,`filter array for operator "${r[0]}" must have 3 elements`));case"in":case"!in":r.length>=2&&(v=qn(r[1]),v!=="string"&&E.push(new Pt(`${s}[1]`,r[1],`string expected, ${v} found`)));for(let A=2;A<r.length;A++)v=qn(r[A]),Li(r[1])==="$type"?E=E.concat(Bo({key:`${s}[${A}]`,value:r[A],valueSpec:p.geometry_type,style:l.style,styleSpec:l.styleSpec})):v!=="string"&&v!=="number"&&v!=="boolean"&&E.push(new Pt(`${s}[${A}]`,r[A],`string, number, or boolean expected, ${v} found`));break;case"any":case"all":case"none":for(let A=1;A<r.length;A++)E=E.concat(ic({key:`${s}[${A}]`,value:r[A],style:l.style,styleSpec:l.styleSpec}));break;case"has":case"!has":v=qn(r[1]),r.length!==2?E.push(new Pt(s,r,`filter array for "${r[0]}" operator must have 2 elements`)):v!=="string"&&E.push(new Pt(`${s}[1]`,r[1],`string expected, ${v} found`))}return E}function Nl(l,r){const s=l.key,p=l.validateSpec,v=l.style,E=l.styleSpec,A=l.value,I=l.objectKey,z=E[`${r}_${l.layerType}`];if(!z)return[];const F=I.match(/^(.*)-transition$/);if(r==="paint"&&F&&z[F[1]]&&z[F[1]].transition)return p({key:s,value:A,valueSpec:E.transition,style:v,styleSpec:E});const $=l.valueSpec||z[I];if(!$)return[new Pt(s,A,`unknown property "${I}"`)];let X;if(qn(A)==="string"&&pl($)&&!$.tokens&&(X=/^{([^}]+)}$/.exec(A)))return[new Pt(s,A,`"${I}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(X[1])} }\`.`)];const te=[];return l.layerType==="symbol"&&(I==="text-field"&&v&&!v.glyphs&&te.push(new Pt(s,A,'use of "text-field" requires a style "glyphs" property')),I==="text-font"&&Do(Hr(A))&&Li(A.type)==="identity"&&te.push(new Pt(s,A,'"text-font" does not support identity functions'))),te.concat(p({key:l.key,value:A,valueSpec:$,style:v,styleSpec:E,expressionContext:"property",propertyType:r,propertyKey:I}))}function gl(l){return Nl(l,"paint")}function Tu(l){return Nl(l,"layout")}function Kl(l){let r=[];const s=l.value,p=l.key,v=l.style,E=l.styleSpec;if(qn(s)!=="object")return[new Pt(p,s,`object expected, ${qn(s)} found`)];s.type||s.ref||r.push(new Pt(p,s,'either "type" or "ref" is required'));let A=Li(s.type);const I=Li(s.ref);if(s.id){const z=Li(s.id);for(let F=0;F<l.arrayIndex;F++){const $=v.layers[F];Li($.id)===z&&r.push(new Pt(p,s.id,`duplicate layer id "${s.id}", previously used at line ${$.id.__line__}`))}}if("ref"in s){let z;["type","source","source-layer","filter","layout"].forEach((F=>{F in s&&r.push(new Pt(p,s[F],`"${F}" is prohibited for ref layers`))})),v.layers.forEach((F=>{Li(F.id)===I&&(z=F)})),z?z.ref?r.push(new Pt(p,s.ref,"ref cannot reference another ref layer")):A=Li(z.type):r.push(new Pt(p,s.ref,`ref layer "${I}" not found`))}else if(A!=="background")if(s.source){const z=v.sources&&v.sources[s.source],F=z&&Li(z.type);z?F==="vector"&&A==="raster"?r.push(new Pt(p,s.source,`layer "${s.id}" requires a raster source`)):F!=="raster-dem"&&A==="hillshade"||F!=="raster-dem"&&A==="color-relief"?r.push(new Pt(p,s.source,`layer "${s.id}" requires a raster-dem source`)):F==="raster"&&A!=="raster"?r.push(new Pt(p,s.source,`layer "${s.id}" requires a vector source`)):F!=="vector"||s["source-layer"]?F==="raster-dem"&&A!=="hillshade"&&A!=="color-relief"?r.push(new Pt(p,s.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):A!=="line"||!s.paint||!s.paint["line-gradient"]||F==="geojson"&&z.lineMetrics||r.push(new Pt(p,s,`layer "${s.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):r.push(new Pt(p,s,`layer "${s.id}" must specify a "source-layer"`)):r.push(new Pt(p,s.source,`source "${s.source}" not found`))}else r.push(new Pt(p,s,'missing required property "source"'));return r=r.concat(is({key:p,value:s,valueSpec:E.layer,style:l.style,styleSpec:l.styleSpec,validateSpec:l.validateSpec,objectElementValidators:{"*":()=>[],type:()=>l.validateSpec({key:`${p}.type`,value:s.type,valueSpec:E.layer.type,style:l.style,styleSpec:l.styleSpec,validateSpec:l.validateSpec,object:s,objectKey:"type"}),filter:wu,layout:z=>is({layer:s,key:z.key,value:z.value,style:z.style,styleSpec:z.styleSpec,validateSpec:z.validateSpec,objectElementValidators:{"*":F=>Tu(en({layerType:A},F))}}),paint:z=>is({layer:s,key:z.key,value:z.value,style:z.style,styleSpec:z.styleSpec,validateSpec:z.validateSpec,objectElementValidators:{"*":F=>gl(en({layerType:A},F))}})}})),r}function Fo(l){const r=l.value,s=l.key,p=qn(r);return p!=="string"?[new Pt(s,r,`string expected, ${p} found`)]:[]}const rc={promoteId:function({key:l,value:r}){if(qn(r)==="string")return Fo({key:l,value:r});{const s=[];for(const p in r)s.push(...Fo({key:`${l}.${p}`,value:r[p]}));return s}}};function Ra(l){const r=l.value,s=l.key,p=l.styleSpec,v=l.style,E=l.validateSpec;if(!r.type)return[new Pt(s,r,'"type" is required')];const A=Li(r.type);let I;switch(A){case"vector":case"raster":return I=is({key:s,value:r,valueSpec:p[`source_${A.replace("-","_")}`],style:l.style,styleSpec:p,objectElementValidators:rc,validateSpec:E}),I;case"raster-dem":return I=(function(z){var F;const $=(F=z.sourceName)!==null&&F!==void 0?F:"",X=z.value,te=z.styleSpec,ie=te.source_raster_dem,re=z.style;let oe=[];const pe=qn(X);if(X===void 0)return oe;if(pe!=="object")return oe.push(new Pt("source_raster_dem",X,`object expected, ${pe} found`)),oe;const Te=Li(X.encoding)==="custom",We=["redFactor","greenFactor","blueFactor","baseShift"],Le=z.value.encoding?`"${z.value.encoding}"`:"Default";for(const Fe in X)!Te&&We.includes(Fe)?oe.push(new Pt(Fe,X[Fe],`In "${$}": "${Fe}" is only valid when "encoding" is set to "custom". ${Le} encoding found`)):ie[Fe]?oe=oe.concat(z.validateSpec({key:Fe,value:X[Fe],valueSpec:ie[Fe],validateSpec:z.validateSpec,style:re,styleSpec:te})):oe.push(new Pt(Fe,X[Fe],`unknown property "${Fe}"`));return oe})({sourceName:s,value:r,style:l.style,styleSpec:p,validateSpec:E}),I;case"geojson":if(I=is({key:s,value:r,valueSpec:p.source_geojson,style:v,styleSpec:p,validateSpec:E,objectElementValidators:rc}),r.cluster)for(const z in r.clusterProperties){const[F,$]=r.clusterProperties[z],X=typeof F=="string"?[F,["accumulated"],["get",z]]:F;I.push(...rs({key:`${s}.${z}.map`,value:$,expressionContext:"cluster-map"})),I.push(...rs({key:`${s}.${z}.reduce`,value:X,expressionContext:"cluster-reduce"}))}return I;case"video":return is({key:s,value:r,valueSpec:p.source_video,style:v,validateSpec:E,styleSpec:p});case"image":return is({key:s,value:r,valueSpec:p.source_image,style:v,validateSpec:E,styleSpec:p});case"canvas":return[new Pt(s,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Bo({key:`${s}.type`,value:r.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function Su(l){const r=l.value,s=l.styleSpec,p=s.light,v=l.style;let E=[];const A=qn(r);if(r===void 0)return E;if(A!=="object")return E=E.concat([new Pt("light",r,`object expected, ${A} found`)]),E;for(const I in r){const z=I.match(/^(.*)-transition$/);E=E.concat(z&&p[z[1]]&&p[z[1]].transition?l.validateSpec({key:I,value:r[I],valueSpec:s.transition,validateSpec:l.validateSpec,style:v,styleSpec:s}):p[I]?l.validateSpec({key:I,value:r[I],valueSpec:p[I],validateSpec:l.validateSpec,style:v,styleSpec:s}):[new Pt(I,r[I],`unknown property "${I}"`)])}return E}function Eu(l){const r=l.value,s=l.styleSpec,p=s.sky,v=l.style,E=qn(r);if(r===void 0)return[];if(E!=="object")return[new Pt("sky",r,`object expected, ${E} found`)];let A=[];for(const I in r)A=A.concat(p[I]?l.validateSpec({key:I,value:r[I],valueSpec:p[I],style:v,styleSpec:s}):[new Pt(I,r[I],`unknown property "${I}"`)]);return A}function Ha(l){const r=l.value,s=l.styleSpec,p=s.terrain,v=l.style;let E=[];const A=qn(r);if(r===void 0)return E;if(A!=="object")return E=E.concat([new Pt("terrain",r,`object expected, ${A} found`)]),E;for(const I in r)E=E.concat(p[I]?l.validateSpec({key:I,value:r[I],valueSpec:p[I],validateSpec:l.validateSpec,style:v,styleSpec:s}):[new Pt(I,r[I],`unknown property "${I}"`)]);return E}function td(l){let r=[];const s=l.value,p=l.key;if(Array.isArray(s)){const v=[],E=[];for(const A in s)s[A].id&&v.includes(s[A].id)&&r.push(new Pt(p,s,`all the sprites' ids must be unique, but ${s[A].id} is duplicated`)),v.push(s[A].id),s[A].url&&E.includes(s[A].url)&&r.push(new Pt(p,s,`all the sprites' URLs must be unique, but ${s[A].url} is duplicated`)),E.push(s[A].url),r=r.concat(is({key:`${p}[${A}]`,value:s[A],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:l.validateSpec}));return r}return Fo({key:p,value:s})}function Bc(l){return r=l.value,r&&r.constructor===Object?[]:[new Pt(l.key,l.value,`object expected, ${qn(l.value)} found`)];var r}const Of={"*":()=>[],array:No,boolean:function(l){const r=l.value,s=l.key,p=qn(r);return p!=="boolean"?[new Pt(s,r,`boolean expected, ${p} found`)]:[]},number:xu,color:ml,constants:li,enum:Bo,filter:wu,function:Or,layer:Kl,object:is,source:Ra,light:Su,sky:Eu,terrain:Ha,projection:function(l){const r=l.value,s=l.styleSpec,p=s.projection,v=l.style,E=qn(r);if(r===void 0)return[];if(E!=="object")return[new Pt("projection",r,`object expected, ${E} found`)];let A=[];for(const I in r)A=A.concat(p[I]?l.validateSpec({key:I,value:r[I],valueSpec:p[I],style:v,styleSpec:s}):[new Pt(I,r[I],`unknown property "${I}"`)]);return A},projectionDefinition:function(l){const r=l.key;let s=l.value;s=s instanceof String?s.valueOf():s;const p=qn(s);return p!=="array"||(function(v){return Array.isArray(v)&&v.length===3&&typeof v[0]=="string"&&typeof v[1]=="string"&&typeof v[2]=="number"})(s)||(function(v){return!!["interpolate","step","literal"].includes(v[0])})(s)?["array","string"].includes(p)?[]:[new Pt(r,s,`projection expected, invalid type "${p}" found`)]:[new Pt(r,s,`projection expected, invalid array ${JSON.stringify(s)} found`)]},string:Fo,formatted:function(l){return Fo(l).length===0?[]:rs(l)},resolvedImage:function(l){return Fo(l).length===0?[]:rs(l)},padding:function(l){const r=l.key,s=l.value;if(qn(s)==="array"){if(s.length<1||s.length>4)return[new Pt(r,s,`padding requires 1 to 4 values; ${s.length} values found`)];const p={type:"number"};let v=[];for(let E=0;E<s.length;E++)v=v.concat(l.validateSpec({key:`${r}[${E}]`,value:s[E],validateSpec:l.validateSpec,valueSpec:p}));return v}return xu({key:r,value:s,valueSpec:{}})},numberArray:function(l){const r=l.key,s=l.value;if(qn(s)==="array"){const p={type:"number"};if(s.length<1)return[new Pt(r,s,"array length at least 1 expected, length 0 found")];let v=[];for(let E=0;E<s.length;E++)v=v.concat(l.validateSpec({key:`${r}[${E}]`,value:s[E],validateSpec:l.validateSpec,valueSpec:p}));return v}return xu({key:r,value:s,valueSpec:{}})},colorArray:function(l){const r=l.key,s=l.value;if(qn(s)==="array"){if(s.length<1)return[new Pt(r,s,"array length at least 1 expected, length 0 found")];let p=[];for(let v=0;v<s.length;v++)p=p.concat(ml({key:`${r}[${v}]`,value:s[v]}));return p}return ml({key:r,value:s})},variableAnchorOffsetCollection:function(l){const r=l.key,s=l.value,p=qn(s),v=l.styleSpec;if(p!=="array"||s.length<1||s.length%2!=0)return[new Pt(r,s,"variableAnchorOffsetCollection requires a non-empty array of even length")];let E=[];for(let A=0;A<s.length;A+=2)E=E.concat(Bo({key:`${r}[${A}]`,value:s[A],valueSpec:v.layout_symbol["text-anchor"]})),E=E.concat(No({key:`${r}[${A+1}]`,value:s[A+1],valueSpec:{length:2,value:"number"},validateSpec:l.validateSpec,style:l.style,styleSpec:v}));return E},sprite:td,state:Bc};function mh(l){const r=l.value,s=l.valueSpec,p=l.styleSpec;return l.validateSpec=mh,s.expression&&Do(Li(r))?Or(l):s.expression&&nc(Hr(r))?rs(l):s.type&&Of[s.type]?Of[s.type](l):is(en({},l,{valueSpec:s.type?p[s.type]:s}))}function Gp(l){const r=l.value,s=l.key,p=Fo(l);return p.length||(r.indexOf("{fontstack}")===-1&&p.push(new Pt(s,r,'"glyphs" url must include a "{fontstack}" token')),r.indexOf("{range}")===-1&&p.push(new Pt(s,r,'"glyphs" url must include a "{range}" token'))),p}function Ai(l,r=$e){let s=[];return s=s.concat(mh({key:"",value:l,valueSpec:r.$root,styleSpec:r,style:l,validateSpec:mh,objectElementValidators:{glyphs:Gp,"*":()=>[]}})),l.constants&&(s=s.concat(li({key:"constants",value:l.constants}))),Yl(s)}function Vo(l){return function(r){return l({...r,validateSpec:mh})}}function Yl(l){return[].concat(l).sort(((r,s)=>r.line-s.line))}function Js(l){return function(...r){return Yl(l.apply(this,r))}}Ai.source=Js(Vo(Ra)),Ai.sprite=Js(Vo(td)),Ai.glyphs=Js(Vo(Gp)),Ai.light=Js(Vo(Su)),Ai.sky=Js(Vo(Eu)),Ai.terrain=Js(Vo(Ha)),Ai.state=Js(Vo(Bc)),Ai.layer=Js(Vo(Kl)),Ai.filter=Js(Vo(wu)),Ai.paintProperty=Js(Vo(gl)),Ai.layoutProperty=Js(Vo(Tu));const ac=Ai,gh=ac.light,Ql=ac.sky,hg=ac.paintProperty,Zp=ac.layoutProperty;function nd(l,r){let s=!1;if(r&&r.length)for(const p of r)l.fire(new xt(new Error(p.message))),s=!0;return s}class _h{constructor(r,s,p){const v=this.cells=[];if(r instanceof ArrayBuffer){this.arrayBuffer=r;const A=new Int32Array(this.arrayBuffer);r=A[0],this.d=(s=A[1])+2*(p=A[2]);for(let z=0;z<this.d*this.d;z++){const F=A[3+z],$=A[3+z+1];v.push(F===$?null:A.subarray(F,$))}const I=A[3+v.length+1];this.keys=A.subarray(A[3+v.length],I),this.bboxes=A.subarray(I),this.insert=this._insertReadonly}else{this.d=s+2*p;for(let A=0;A<this.d*this.d;A++)v.push([]);this.keys=[],this.bboxes=[]}this.n=s,this.extent=r,this.padding=p,this.scale=s/r,this.uid=0;const E=p/s*r;this.min=-E,this.max=r+E}insert(r,s,p,v,E){this._forEachCell(s,p,v,E,this._insertCell,this.uid++,void 0,void 0),this.keys.push(r),this.bboxes.push(s),this.bboxes.push(p),this.bboxes.push(v),this.bboxes.push(E)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(r,s,p,v,E,A){this.cells[E].push(A)}query(r,s,p,v,E){const A=this.min,I=this.max;if(r<=A&&s<=A&&I<=p&&I<=v&&!E)return Array.prototype.slice.call(this.keys);{const z=[];return this._forEachCell(r,s,p,v,this._queryCell,z,{},E),z}}_queryCell(r,s,p,v,E,A,I,z){const F=this.cells[E];if(F!==null){const $=this.keys,X=this.bboxes;for(let te=0;te<F.length;te++){const ie=F[te];if(I[ie]===void 0){const re=4*ie;(z?z(X[re+0],X[re+1],X[re+2],X[re+3]):r<=X[re+2]&&s<=X[re+3]&&p>=X[re+0]&&v>=X[re+1])?(I[ie]=!0,A.push($[ie])):I[ie]=!1}}}}_forEachCell(r,s,p,v,E,A,I,z){const F=this._convertToCellCoord(r),$=this._convertToCellCoord(s),X=this._convertToCellCoord(p),te=this._convertToCellCoord(v);for(let ie=F;ie<=X;ie++)for(let re=$;re<=te;re++){const oe=this.d*re+ie;if((!z||z(this._convertFromCellCoord(ie),this._convertFromCellCoord(re),this._convertFromCellCoord(ie+1),this._convertFromCellCoord(re+1)))&&E.call(this,r,s,p,v,oe,A,I,z))return}}_convertFromCellCoord(r){return(r-this.padding)/this.scale}_convertToCellCoord(r){return Math.max(0,Math.min(this.d-1,Math.floor(r*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const r=this.cells,s=3+this.cells.length+1+1;let p=0;for(let A=0;A<this.cells.length;A++)p+=this.cells[A].length;const v=new Int32Array(s+p+this.keys.length+this.bboxes.length);v[0]=this.extent,v[1]=this.n,v[2]=this.padding;let E=s;for(let A=0;A<r.length;A++){const I=r[A];v[3+A]=E,v.set(I,E),E+=I.length}return v[3+r.length]=E,v.set(this.keys,E),E+=this.keys.length,v[3+r.length+1]=E,v.set(this.bboxes,E),E+=this.bboxes.length,v.buffer}static serialize(r,s){const p=r.toArrayBuffer();return s&&s.push(p),{buffer:p}}static deserialize(r){return new _h(r.buffer)}}const as={};function Yt(l,r,s={}){if(as[l])throw new Error(`${l} is already registered.`);Object.defineProperty(r,"_classRegistryKey",{value:l,writeable:!1}),as[l]={klass:r,omit:s.omit||[],shallow:s.shallow||[]}}Yt("Object",Object),Yt("Set",Set),Yt("TransferableGridIndex",_h),Yt("Color",Ln),Yt("Error",Error),Yt("AJAXError",Se),Yt("ResolvedImage",ur),Yt("StylePropertyFunction",V),Yt("StyleExpression",tc,{omit:["_evaluator"]}),Yt("ZoomDependentExpression",x),Yt("ZoomConstantExpression",f),Yt("CompoundExpression",ho,{omit:["_evaluate"]});for(const l in gu)gu[l]._classRegistryKey||Yt(`Expression_${l}`,gu[l]);function yh(l){return l&&typeof ArrayBuffer<"u"&&(l instanceof ArrayBuffer||l.constructor&&l.constructor.name==="ArrayBuffer")}function id(l){return l.$name||l.constructor._classRegistryKey}function sc(l){return!(function(r){if(r===null||typeof r!="object")return!1;const s=id(r);return!(!s||s==="Object")})(l)&&(l==null||typeof l=="boolean"||typeof l=="number"||typeof l=="string"||l instanceof Boolean||l instanceof Number||l instanceof String||l instanceof Date||l instanceof RegExp||l instanceof Blob||l instanceof Error||yh(l)||Sa(l)||ArrayBuffer.isView(l)||l instanceof ImageData)}function oc(l,r){if(sc(l))return(yh(l)||Sa(l))&&r&&r.push(l),ArrayBuffer.isView(l)&&r&&r.push(l.buffer),l instanceof ImageData&&r&&r.push(l.data.buffer),l;if(Array.isArray(l)){const E=[];for(const A of l)E.push(oc(A,r));return E}if(typeof l!="object")throw new Error("can't serialize object of type "+typeof l);const s=id(l);if(!s)throw new Error(`can't serialize object of unregistered class ${l.constructor.name}`);if(!as[s])throw new Error(`${s} is not registered.`);const{klass:p}=as[s],v=p.serialize?p.serialize(l,r):{};if(p.serialize){if(r&&v===r[r.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const E in l){if(!l.hasOwnProperty(E)||as[s].omit.indexOf(E)>=0)continue;const A=l[E];v[E]=as[s].shallow.indexOf(E)>=0?A:oc(A,r)}l instanceof Error&&(v.message=l.message)}if(v.$name)throw new Error("$name property is reserved for worker serialization logic.");return s!=="Object"&&(v.$name=s),v}function Jl(l){if(sc(l))return l;if(Array.isArray(l))return l.map(Jl);if(typeof l!="object")throw new Error("can't deserialize object of type "+typeof l);const r=id(l)||"Object";if(!as[r])throw new Error(`can't deserialize unregistered class ${r}`);const{klass:s}=as[r];if(!s)throw new Error(`can't deserialize unregistered class ${r}`);if(s.deserialize)return s.deserialize(l);const p=Object.create(s.prototype);for(const v of Object.keys(l)){if(v==="$name")continue;const E=l[v];p[v]=as[r].shallow.indexOf(v)>=0?E:Jl(E)}return p}class Fc{constructor(){this.first=!0}update(r,s){const p=Math.floor(r);return this.first?(this.first=!1,this.lastIntegerZoom=p,this.lastIntegerZoomTime=0,this.lastZoom=r,this.lastFloorZoom=p,!0):(this.lastFloorZoom>p?(this.lastIntegerZoom=p+1,this.lastIntegerZoomTime=s):this.lastFloorZoom<p&&(this.lastIntegerZoom=p,this.lastIntegerZoomTime=s),r!==this.lastZoom&&(this.lastZoom=r,this.lastFloorZoom=p,!0))}}const ii={"Latin-1 Supplement":l=>l>=128&&l<=255,"Hangul Jamo":l=>l>=4352&&l<=4607,Khmer:l=>l>=6016&&l<=6143,"General Punctuation":l=>l>=8192&&l<=8303,"Letterlike Symbols":l=>l>=8448&&l<=8527,"Number Forms":l=>l>=8528&&l<=8591,"Miscellaneous Technical":l=>l>=8960&&l<=9215,"Control Pictures":l=>l>=9216&&l<=9279,"Optical Character Recognition":l=>l>=9280&&l<=9311,"Enclosed Alphanumerics":l=>l>=9312&&l<=9471,"Geometric Shapes":l=>l>=9632&&l<=9727,"Miscellaneous Symbols":l=>l>=9728&&l<=9983,"Miscellaneous Symbols and Arrows":l=>l>=11008&&l<=11263,"Ideographic Description Characters":l=>l>=12272&&l<=12287,"CJK Symbols and Punctuation":l=>l>=12288&&l<=12351,Hiragana:l=>l>=12352&&l<=12447,Katakana:l=>l>=12448&&l<=12543,Kanbun:l=>l>=12688&&l<=12703,"CJK Strokes":l=>l>=12736&&l<=12783,"Enclosed CJK Letters and Months":l=>l>=12800&&l<=13055,"CJK Compatibility":l=>l>=13056&&l<=13311,"Yijing Hexagram Symbols":l=>l>=19904&&l<=19967,"CJK Unified Ideographs":l=>l>=19968&&l<=40959,"Hangul Syllables":l=>l>=44032&&l<=55215,"Private Use Area":l=>l>=57344&&l<=63743,"Vertical Forms":l=>l>=65040&&l<=65055,"CJK Compatibility Forms":l=>l>=65072&&l<=65103,"Small Form Variants":l=>l>=65104&&l<=65135,"Halfwidth and Fullwidth Forms":l=>l>=65280&&l<=65519};function rd(l){for(const r of l)if(jc(r.charCodeAt(0)))return!0;return!1}function Vc(l){for(const r of l)if(!Nf(r.charCodeAt(0)))return!1;return!0}function eu(l){const r=l.map((s=>{try{return new RegExp(`\\p{sc=${s}}`,"u").source}catch{return null}})).filter((s=>s));return new RegExp(r.join("|"),"u")}const Hp=eu(["Arab","Dupl","Mong","Ougr","Syrc"]);function Nf(l){return!Hp.test(String.fromCodePoint(l))}const lc=eu(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function jc(l){return!(l!==746&&l!==747&&(l<4352||!(ii["CJK Compatibility Forms"](l)&&!(l>=65097&&l<=65103)||ii["CJK Compatibility"](l)||ii["CJK Strokes"](l)||!(!ii["CJK Symbols and Punctuation"](l)||l>=12296&&l<=12305||l>=12308&&l<=12319||l===12336)||ii["Enclosed CJK Letters and Months"](l)||ii["Ideographic Description Characters"](l)||ii.Kanbun(l)||ii.Katakana(l)&&l!==12540||!(!ii["Halfwidth and Fullwidth Forms"](l)||l===65288||l===65289||l===65293||l>=65306&&l<=65310||l===65339||l===65341||l===65343||l>=65371&&l<=65503||l===65507||l>=65512&&l<=65519)||!(!ii["Small Form Variants"](l)||l>=65112&&l<=65118||l>=65123&&l<=65126)||ii["Vertical Forms"](l)||ii["Yijing Hexagram Symbols"](l)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(l))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(l))||lc.test(String.fromCodePoint(l)))))}function ad(l){return!(jc(l)||(function(r){return!!(ii["Latin-1 Supplement"](r)&&(r===167||r===169||r===174||r===177||r===188||r===189||r===190||r===215||r===247)||ii["General Punctuation"](r)&&(r===8214||r===8224||r===8225||r===8240||r===8241||r===8251||r===8252||r===8258||r===8263||r===8264||r===8265||r===8273)||ii["Letterlike Symbols"](r)||ii["Number Forms"](r)||ii["Miscellaneous Technical"](r)&&(r>=8960&&r<=8967||r>=8972&&r<=8991||r>=8996&&r<=9e3||r===9003||r>=9085&&r<=9114||r>=9150&&r<=9165||r===9167||r>=9169&&r<=9179||r>=9186&&r<=9215)||ii["Control Pictures"](r)&&r!==9251||ii["Optical Character Recognition"](r)||ii["Enclosed Alphanumerics"](r)||ii["Geometric Shapes"](r)||ii["Miscellaneous Symbols"](r)&&!(r>=9754&&r<=9759)||ii["Miscellaneous Symbols and Arrows"](r)&&(r>=11026&&r<=11055||r>=11088&&r<=11097||r>=11192&&r<=11243)||ii["CJK Symbols and Punctuation"](r)||ii.Katakana(r)||ii["Private Use Area"](r)||ii["CJK Compatibility Forms"](r)||ii["Small Form Variants"](r)||ii["Halfwidth and Fullwidth Forms"](r)||r===8734||r===8756||r===8757||r>=9984&&r<=10087||r>=10102&&r<=10131||r===65532||r===65533)})(l))}const vh=eu(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function bh(l){return vh.test(String.fromCodePoint(l))}function Bf(l,r){return!(!r&&bh(l)||l>=2304&&l<=3583||l>=3840&&l<=4255||ii.Khmer(l))}function uc(l){for(const r of l)if(bh(r.charCodeAt(0)))return!0;return!1}const _l=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(l){this.pluginStatus=l.pluginStatus,this.pluginURL=l.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(l){if(_l.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=l.applyArabicShaping,this.processBidirectionalText=l.processBidirectionalText,this.processStyledBidirectionalText=l.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(l,r){return c(this,void 0,void 0,(function*(){if(this.isParsed())return this.getState();if(l.pluginStatus!=="loading")return this.setState(l),l;const s=l.pluginURL,p=new Promise((E=>{this.loadScriptResolve=E}));r(s);const v=new Promise((E=>setTimeout((()=>E()),this.TIMEOUT)));if(yield Promise.race([p,v]),this.isParsed()){const E={pluginStatus:"loaded",pluginURL:s};return this.setState(E),E}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${s}`)}))}};class ki{constructor(r,s){this.zoom=r,s?(this.now=s.now||0,this.fadeDuration=s.fadeDuration||0,this.zoomHistory=s.zoomHistory||new Fc,this.transition=s.transition||{},this.globalState=s.globalState||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Fc,this.transition={},this.globalState={})}isSupportedScript(r){return(function(s,p){for(const v of s)if(!Bf(v.charCodeAt(0),p))return!1;return!0})(r,_l.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const r=this.zoom,s=r-Math.floor(r),p=this.crossFadingFactor();return r>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:s+(1-s)*p}:{fromScale:.5,toScale:1,t:1-(1-p)*s}}}class cc{constructor(r,s){this.property=r,this.value=s,this.expression=(function(p,v){if(Do(p))return new V(p,v);if(nc(p)){const E=R(p,v);if(E.result==="error")throw new Error(E.value.map((A=>`${A.key}: ${A.message}`)).join(", "));return E.value}{let E=p;return v.type==="color"&&typeof p=="string"?E=Ln.parse(p):v.type!=="padding"||typeof p!="number"&&!Array.isArray(p)?v.type!=="numberArray"||typeof p!="number"&&!Array.isArray(p)?v.type!=="colorArray"||typeof p!="string"&&!Array.isArray(p)?v.type==="variableAnchorOffsetCollection"&&Array.isArray(p)?E=ar.parse(p):v.type==="projectionDefinition"&&typeof p=="string"&&(E=xr.parse(p)):E=fi.parse(p):E=hn.parse(p):E=pr.parse(p),{globalStateRefs:new Set,kind:"constant",evaluate:()=>E}}})(s===void 0?r.specification.default:s,r.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(r,s,p){return this.property.possiblyEvaluate(this,r,s,p)}}class sd{constructor(r){this.property=r,this.value=new cc(r,void 0)}transitioned(r,s){return new tu(this.property,this.value,s,si({},r.transition,this.transition),r.now)}untransitioned(){return new tu(this.property,this.value,null,{},0)}}class Au{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitionablePropertyValues)}getValue(r){return kr(this._values[r].value.value)}setValue(r,s){Object.prototype.hasOwnProperty.call(this._values,r)||(this._values[r]=new sd(this._values[r].property)),this._values[r].value=new cc(this._values[r].property,s===null?void 0:kr(s))}getTransition(r){return kr(this._values[r].transition)}setTransition(r,s){Object.prototype.hasOwnProperty.call(this._values,r)||(this._values[r]=new sd(this._values[r].property)),this._values[r].transition=kr(s)||void 0}serialize(){const r={};for(const s of Object.keys(this._values)){const p=this.getValue(s);p!==void 0&&(r[s]=p);const v=this.getTransition(s);v!==void 0&&(r[`${s}-transition`]=v)}return r}transitioned(r,s){const p=new Uc(this._properties);for(const v of Object.keys(this._values))p._values[v]=this._values[v].transitioned(r,s._values[v]);return p}untransitioned(){const r=new Uc(this._properties);for(const s of Object.keys(this._values))r._values[s]=this._values[s].untransitioned();return r}}class tu{constructor(r,s,p,v,E){this.property=r,this.value=s,this.begin=E+v.delay||0,this.end=this.begin+v.duration||0,r.specification.transition&&(v.delay||v.duration)&&(this.prior=p)}possiblyEvaluate(r,s,p){const v=r.now||0,E=this.value.possiblyEvaluate(r,s,p),A=this.prior;if(A){if(v>this.end)return this.prior=null,E;if(this.value.isDataDriven())return this.prior=null,E;if(v<this.begin)return A.possiblyEvaluate(r,s,p);{const I=(v-this.begin)/(this.end-this.begin);return this.property.interpolate(A.possiblyEvaluate(r,s,p),E,Ot(I))}}return E}}class Uc{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitioningPropertyValues)}possiblyEvaluate(r,s,p){const v=new hc(this._properties);for(const E of Object.keys(this._values))v._values[E]=this._values[E].possiblyEvaluate(r,s,p);return v}hasTransition(){for(const r of Object.keys(this._values))if(this._values[r].prior)return!0;return!1}}class Gd{constructor(r){this._properties=r,this._values=Object.create(r.defaultPropertyValues)}hasValue(r){return this._values[r].value!==void 0}getValue(r){return kr(this._values[r].value)}setValue(r,s){this._values[r]=new cc(this._values[r].property,s===null?void 0:kr(s))}serialize(){const r={};for(const s of Object.keys(this._values)){const p=this.getValue(s);p!==void 0&&(r[s]=p)}return r}possiblyEvaluate(r,s,p){const v=new hc(this._properties);for(const E of Object.keys(this._values))v._values[E]=this._values[E].possiblyEvaluate(r,s,p);return v}}class yl{constructor(r,s,p){this.property=r,this.value=s,this.parameters=p}isConstant(){return this.value.kind==="constant"}constantOr(r){return this.value.kind==="constant"?this.value.value:r}evaluate(r,s,p,v){return this.property.evaluate(this.value,this.parameters,r,s,p,v)}}class hc{constructor(r){this._properties=r,this._values=Object.create(r.defaultPossiblyEvaluatedValues)}get(r){return this._values[r]}}class an{constructor(r){this.specification=r}possiblyEvaluate(r,s){if(r.isDataDriven())throw new Error("Value should not be data driven");return r.expression.evaluate(s)}interpolate(r,s,p){const v=ws[this.specification.type];return v?v(r,s,p):r}}class Tn{constructor(r,s){this.specification=r,this.overrides=s}possiblyEvaluate(r,s,p,v){return new yl(this,r.expression.kind==="constant"||r.expression.kind==="camera"?{kind:"constant",value:r.expression.evaluate(s,null,{},p,v)}:r.expression,s)}interpolate(r,s,p){if(r.value.kind!=="constant"||s.value.kind!=="constant")return r;if(r.value.value===void 0||s.value.value===void 0)return new yl(this,{kind:"constant",value:void 0},r.parameters);const v=ws[this.specification.type];if(v){const E=v(r.value.value,s.value.value,p);return new yl(this,{kind:"constant",value:E},r.parameters)}return r}evaluate(r,s,p,v,E,A){return r.kind==="constant"?r.value:r.evaluate(s,p,v,E,A)}}class od extends Tn{possiblyEvaluate(r,s,p,v){if(r.value===void 0)return new yl(this,{kind:"constant",value:void 0},s);if(r.expression.kind==="constant"){const E=r.expression.evaluate(s,null,{},p,v),A=r.property.specification.type==="resolvedImage"&&typeof E!="string"?E.name:E,I=this._calculate(A,A,A,s);return new yl(this,{kind:"constant",value:I},s)}if(r.expression.kind==="camera"){const E=this._calculate(r.expression.evaluate({zoom:s.zoom-1}),r.expression.evaluate({zoom:s.zoom}),r.expression.evaluate({zoom:s.zoom+1}),s);return new yl(this,{kind:"constant",value:E},s)}return new yl(this,r.expression,s)}evaluate(r,s,p,v,E,A){if(r.kind==="source"){const I=r.evaluate(s,p,v,E,A);return this._calculate(I,I,I,s)}return r.kind==="composite"?this._calculate(r.evaluate({zoom:Math.floor(s.zoom)-1},p,v),r.evaluate({zoom:Math.floor(s.zoom)},p,v),r.evaluate({zoom:Math.floor(s.zoom)+1},p,v),s):r.value}_calculate(r,s,p,v){return v.zoom>v.zoomHistory.lastIntegerZoom?{from:r,to:s}:{from:p,to:s}}interpolate(r){return r}}class jo{constructor(r){this.specification=r}possiblyEvaluate(r,s,p,v){if(r.value!==void 0){if(r.expression.kind==="constant"){const E=r.expression.evaluate(s,null,{},p,v);return this._calculate(E,E,E,s)}return this._calculate(r.expression.evaluate(new ki(Math.floor(s.zoom-1),s)),r.expression.evaluate(new ki(Math.floor(s.zoom),s)),r.expression.evaluate(new ki(Math.floor(s.zoom+1),s)),s)}}_calculate(r,s,p,v){return v.zoom>v.zoomHistory.lastIntegerZoom?{from:r,to:s}:{from:p,to:s}}interpolate(r){return r}}class $c{constructor(r){this.specification=r}possiblyEvaluate(r,s,p,v){return!!r.expression.evaluate(s,null,{},p,v)}interpolate(){return!1}}class As{constructor(r){this.properties=r,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const s in r){const p=r[s];p.specification.overridable&&this.overridableProperties.push(s);const v=this.defaultPropertyValues[s]=new cc(p,void 0),E=this.defaultTransitionablePropertyValues[s]=new sd(p);this.defaultTransitioningPropertyValues[s]=E.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=v.possiblyEvaluate({})}}}Yt("DataDrivenProperty",Tn),Yt("DataConstantProperty",an),Yt("CrossFadedDataDrivenProperty",od),Yt("CrossFadedProperty",jo),Yt("ColorRampProperty",$c);const Zd="-transition";class fo extends tn{constructor(r,s){if(super(),this.id=r.id,this.type=r.type,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},r.type!=="custom"&&(this.metadata=r.metadata,this.minzoom=r.minzoom,this.maxzoom=r.maxzoom,r.type!=="background"&&(this.source=r.source,this.sourceLayer=r["source-layer"],this.filter=r.filter,this._featureFilter=ut(r.filter)),s.layout&&(this._unevaluatedLayout=new Gd(s.layout)),s.paint)){this._transitionablePaint=new Au(s.paint);for(const p in r.paint)this.setPaintProperty(p,r.paint[p],{validate:!1});for(const p in r.layout)this.setLayoutProperty(p,r.layout[p],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new hc(s.paint)}}setFilter(r){this.filter=r,this._featureFilter=ut(r)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(r){return r==="visibility"?this.visibility:this._unevaluatedLayout.getValue(r)}getLayoutAffectingGlobalStateRefs(){const r=new Set;if(this._unevaluatedLayout)for(const s in this._unevaluatedLayout._values){const p=this._unevaluatedLayout._values[s];for(const v of p.getGlobalStateRefs())r.add(v)}for(const s of this._featureFilter.getGlobalStateRefs())r.add(s);return r}setLayoutProperty(r,s,p={}){s!=null&&this._validate(Zp,`layers.${this.id}.layout.${r}`,r,s,p)||(r!=="visibility"?this._unevaluatedLayout.setValue(r,s):this.visibility=s)}getPaintProperty(r){return r.endsWith(Zd)?this._transitionablePaint.getTransition(r.slice(0,-11)):this._transitionablePaint.getValue(r)}setPaintProperty(r,s,p={}){if(s!=null&&this._validate(hg,`layers.${this.id}.paint.${r}`,r,s,p))return!1;if(r.endsWith(Zd))return this._transitionablePaint.setTransition(r.slice(0,-11),s||void 0),!1;{const v=this._transitionablePaint._values[r],E=v.property.specification["property-type"]==="cross-faded-data-driven",A=v.value.isDataDriven(),I=v.value;this._transitionablePaint.setValue(r,s),this._handleSpecialPaintPropertyUpdate(r);const z=this._transitionablePaint._values[r].value;return z.isDataDriven()||A||E||this._handleOverridablePaintPropertyUpdate(r,I,z)}}_handleSpecialPaintPropertyUpdate(r){}_handleOverridablePaintPropertyUpdate(r,s,p){return!1}isHidden(r){return!!(this.minzoom&&r<this.minzoom)||!!(this.maxzoom&&r>=this.maxzoom)||this.visibility==="none"}updateTransitions(r){this._transitioningPaint=this._transitionablePaint.transitioned(r,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(r,s){r.getCrossfadeParameters&&(this._crossfadeParameters=r.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(r,void 0,s)),this.paint=this._transitioningPaint.possiblyEvaluate(r,void 0,s)}serialize(){const r={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(r.layout=r.layout||{},r.layout.visibility=this.visibility),Ns(r,((s,p)=>!(s===void 0||p==="layout"&&!Object.keys(s).length||p==="paint"&&!Object.keys(s).length)))}_validate(r,s,p,v,E={}){return(!E||E.validate!==!1)&&nd(this,r.call(ac,{key:s,layerType:this.type,objectKey:p,value:v,styleSpec:$e,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const r in this.paint._values){const s=this.paint.get(r);if(s instanceof yl&&pl(s.property.specification)&&(s.value.kind==="source"||s.value.kind==="composite")&&s.value.isStateDependent)return!0}return!1}}const Uo={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Cs{constructor(r,s){this._structArray=r,this._pos1=s*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class mi{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(r,s){return r._trim(),s&&(r.isTransferred=!0,s.push(r.arrayBuffer)),{length:r.length,arrayBuffer:r.arrayBuffer}}static deserialize(r){const s=Object.create(this.prototype);return s.arrayBuffer=r.arrayBuffer,s.length=r.length,s.capacity=r.arrayBuffer.byteLength/s.bytesPerElement,s._refreshViews(),s}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(r){this.reserve(r),this.length=r}reserve(r){if(r>this.capacity){this.capacity=Math.max(r,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const s=this.uint8;this._refreshViews(),s&&this.uint8.set(s)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Nr(l,r=1){let s=0,p=0;return{members:l.map((v=>{const E=Uo[v.type].BYTES_PER_ELEMENT,A=s=ld(s,Math.max(r,E)),I=v.components||1;return p=Math.max(p,E),s+=E*I,{name:v.name,type:v.type,components:I,offset:A}})),size:ld(s,Math.max(p,r)),alignment:r}}function ld(l,r){return Math.ceil(l/r)*r}class $o extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,s){const p=this.length;return this.resize(p+1),this.emplace(p,r,s)}emplace(r,s,p){const v=2*r;return this.int16[v+0]=s,this.int16[v+1]=p,r}}$o.prototype.bytesPerElement=4,Yt("StructArrayLayout2i4",$o);class Xa extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,s,p){const v=this.length;return this.resize(v+1),this.emplace(v,r,s,p)}emplace(r,s,p,v){const E=3*r;return this.int16[E+0]=s,this.int16[E+1]=p,this.int16[E+2]=v,r}}Xa.prototype.bytesPerElement=6,Yt("StructArrayLayout3i6",Xa);class Xr extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,s,p,v){const E=this.length;return this.resize(E+1),this.emplace(E,r,s,p,v)}emplace(r,s,p,v,E){const A=4*r;return this.int16[A+0]=s,this.int16[A+1]=p,this.int16[A+2]=v,this.int16[A+3]=E,r}}Xr.prototype.bytesPerElement=8,Yt("StructArrayLayout4i8",Xr);class Cu extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,s,p,v,E,A){const I=this.length;return this.resize(I+1),this.emplace(I,r,s,p,v,E,A)}emplace(r,s,p,v,E,A,I){const z=6*r;return this.int16[z+0]=s,this.int16[z+1]=p,this.int16[z+2]=v,this.int16[z+3]=E,this.int16[z+4]=A,this.int16[z+5]=I,r}}Cu.prototype.bytesPerElement=12,Yt("StructArrayLayout2i4i12",Cu);class eo extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,s,p,v,E,A){const I=this.length;return this.resize(I+1),this.emplace(I,r,s,p,v,E,A)}emplace(r,s,p,v,E,A,I){const z=4*r,F=8*r;return this.int16[z+0]=s,this.int16[z+1]=p,this.uint8[F+4]=v,this.uint8[F+5]=E,this.uint8[F+6]=A,this.uint8[F+7]=I,r}}eo.prototype.bytesPerElement=8,Yt("StructArrayLayout2i4ub8",eo);class Gn extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s){const p=this.length;return this.resize(p+1),this.emplace(p,r,s)}emplace(r,s,p){const v=2*r;return this.float32[v+0]=s,this.float32[v+1]=p,r}}Gn.prototype.bytesPerElement=8,Yt("StructArrayLayout2f8",Gn);class Vi extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,s,p,v,E,A,I,z,F,$){const X=this.length;return this.resize(X+1),this.emplace(X,r,s,p,v,E,A,I,z,F,$)}emplace(r,s,p,v,E,A,I,z,F,$,X){const te=10*r;return this.uint16[te+0]=s,this.uint16[te+1]=p,this.uint16[te+2]=v,this.uint16[te+3]=E,this.uint16[te+4]=A,this.uint16[te+5]=I,this.uint16[te+6]=z,this.uint16[te+7]=F,this.uint16[te+8]=$,this.uint16[te+9]=X,r}}Vi.prototype.bytesPerElement=20,Yt("StructArrayLayout10ui20",Vi);class wr extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,s,p,v,E,A,I,z,F,$,X,te){const ie=this.length;return this.resize(ie+1),this.emplace(ie,r,s,p,v,E,A,I,z,F,$,X,te)}emplace(r,s,p,v,E,A,I,z,F,$,X,te,ie){const re=12*r;return this.int16[re+0]=s,this.int16[re+1]=p,this.int16[re+2]=v,this.int16[re+3]=E,this.uint16[re+4]=A,this.uint16[re+5]=I,this.uint16[re+6]=z,this.uint16[re+7]=F,this.int16[re+8]=$,this.int16[re+9]=X,this.int16[re+10]=te,this.int16[re+11]=ie,r}}wr.prototype.bytesPerElement=24,Yt("StructArrayLayout4i4ui4i24",wr);class xh extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s,p){const v=this.length;return this.resize(v+1),this.emplace(v,r,s,p)}emplace(r,s,p,v){const E=3*r;return this.float32[E+0]=s,this.float32[E+1]=p,this.float32[E+2]=v,r}}xh.prototype.bytesPerElement=12,Yt("StructArrayLayout3f12",xh);class dc extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r){const s=this.length;return this.resize(s+1),this.emplace(s,r)}emplace(r,s){return this.uint32[1*r+0]=s,r}}dc.prototype.bytesPerElement=4,Yt("StructArrayLayout1ul4",dc);class nu extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,s,p,v,E,A,I,z,F){const $=this.length;return this.resize($+1),this.emplace($,r,s,p,v,E,A,I,z,F)}emplace(r,s,p,v,E,A,I,z,F,$){const X=10*r,te=5*r;return this.int16[X+0]=s,this.int16[X+1]=p,this.int16[X+2]=v,this.int16[X+3]=E,this.int16[X+4]=A,this.int16[X+5]=I,this.uint32[te+3]=z,this.uint16[X+8]=F,this.uint16[X+9]=$,r}}nu.prototype.bytesPerElement=20,Yt("StructArrayLayout6i1ul2ui20",nu);class wh extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,s,p,v,E,A){const I=this.length;return this.resize(I+1),this.emplace(I,r,s,p,v,E,A)}emplace(r,s,p,v,E,A,I){const z=6*r;return this.int16[z+0]=s,this.int16[z+1]=p,this.int16[z+2]=v,this.int16[z+3]=E,this.int16[z+4]=A,this.int16[z+5]=I,r}}wh.prototype.bytesPerElement=12,Yt("StructArrayLayout2i2i2i12",wh);class T extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,s,p,v,E){const A=this.length;return this.resize(A+1),this.emplace(A,r,s,p,v,E)}emplace(r,s,p,v,E,A){const I=4*r,z=8*r;return this.float32[I+0]=s,this.float32[I+1]=p,this.float32[I+2]=v,this.int16[z+6]=E,this.int16[z+7]=A,r}}T.prototype.bytesPerElement=16,Yt("StructArrayLayout2f1f2i16",T);class t extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,s,p,v,E,A){const I=this.length;return this.resize(I+1),this.emplace(I,r,s,p,v,E,A)}emplace(r,s,p,v,E,A,I){const z=16*r,F=4*r,$=8*r;return this.uint8[z+0]=s,this.uint8[z+1]=p,this.float32[F+1]=v,this.float32[F+2]=E,this.int16[$+6]=A,this.int16[$+7]=I,r}}t.prototype.bytesPerElement=16,Yt("StructArrayLayout2ub2f2i16",t);class u extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,s,p){const v=this.length;return this.resize(v+1),this.emplace(v,r,s,p)}emplace(r,s,p,v){const E=3*r;return this.uint16[E+0]=s,this.uint16[E+1]=p,this.uint16[E+2]=v,r}}u.prototype.bytesPerElement=6,Yt("StructArrayLayout3ui6",u);class m extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s,p,v,E,A,I,z,F,$,X,te,ie,re,oe,pe,Te){const We=this.length;return this.resize(We+1),this.emplace(We,r,s,p,v,E,A,I,z,F,$,X,te,ie,re,oe,pe,Te)}emplace(r,s,p,v,E,A,I,z,F,$,X,te,ie,re,oe,pe,Te,We){const Le=24*r,Fe=12*r,ot=48*r;return this.int16[Le+0]=s,this.int16[Le+1]=p,this.uint16[Le+2]=v,this.uint16[Le+3]=E,this.uint32[Fe+2]=A,this.uint32[Fe+3]=I,this.uint32[Fe+4]=z,this.uint16[Le+10]=F,this.uint16[Le+11]=$,this.uint16[Le+12]=X,this.float32[Fe+7]=te,this.float32[Fe+8]=ie,this.uint8[ot+36]=re,this.uint8[ot+37]=oe,this.uint8[ot+38]=pe,this.uint32[Fe+10]=Te,this.int16[Le+22]=We,r}}m.prototype.bytesPerElement=48,Yt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",m);class b extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s,p,v,E,A,I,z,F,$,X,te,ie,re,oe,pe,Te,We,Le,Fe,ot,gt,Ct,Gt,Ft,Zt,dn,qt){const Ut=this.length;return this.resize(Ut+1),this.emplace(Ut,r,s,p,v,E,A,I,z,F,$,X,te,ie,re,oe,pe,Te,We,Le,Fe,ot,gt,Ct,Gt,Ft,Zt,dn,qt)}emplace(r,s,p,v,E,A,I,z,F,$,X,te,ie,re,oe,pe,Te,We,Le,Fe,ot,gt,Ct,Gt,Ft,Zt,dn,qt,Ut){const St=32*r,Sn=16*r;return this.int16[St+0]=s,this.int16[St+1]=p,this.int16[St+2]=v,this.int16[St+3]=E,this.int16[St+4]=A,this.int16[St+5]=I,this.int16[St+6]=z,this.int16[St+7]=F,this.uint16[St+8]=$,this.uint16[St+9]=X,this.uint16[St+10]=te,this.uint16[St+11]=ie,this.uint16[St+12]=re,this.uint16[St+13]=oe,this.uint16[St+14]=pe,this.uint16[St+15]=Te,this.uint16[St+16]=We,this.uint16[St+17]=Le,this.uint16[St+18]=Fe,this.uint16[St+19]=ot,this.uint16[St+20]=gt,this.uint16[St+21]=Ct,this.uint16[St+22]=Gt,this.uint32[Sn+12]=Ft,this.float32[Sn+13]=Zt,this.float32[Sn+14]=dn,this.uint16[St+30]=qt,this.uint16[St+31]=Ut,r}}b.prototype.bytesPerElement=64,Yt("StructArrayLayout8i15ui1ul2f2ui64",b);class S extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r){const s=this.length;return this.resize(s+1),this.emplace(s,r)}emplace(r,s){return this.float32[1*r+0]=s,r}}S.prototype.bytesPerElement=4,Yt("StructArrayLayout1f4",S);class C extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s,p){const v=this.length;return this.resize(v+1),this.emplace(v,r,s,p)}emplace(r,s,p,v){const E=3*r;return this.uint16[6*r+0]=s,this.float32[E+1]=p,this.float32[E+2]=v,r}}C.prototype.bytesPerElement=12,Yt("StructArrayLayout1ui2f12",C);class O extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,s,p){const v=this.length;return this.resize(v+1),this.emplace(v,r,s,p)}emplace(r,s,p,v){const E=4*r;return this.uint32[2*r+0]=s,this.uint16[E+2]=p,this.uint16[E+3]=v,r}}O.prototype.bytesPerElement=8,Yt("StructArrayLayout1ul2ui8",O);class N extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,s){const p=this.length;return this.resize(p+1),this.emplace(p,r,s)}emplace(r,s,p){const v=2*r;return this.uint16[v+0]=s,this.uint16[v+1]=p,r}}N.prototype.bytesPerElement=4,Yt("StructArrayLayout2ui4",N);class U extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r){const s=this.length;return this.resize(s+1),this.emplace(s,r)}emplace(r,s){return this.uint16[1*r+0]=s,r}}U.prototype.bytesPerElement=2,Yt("StructArrayLayout1ui2",U);class q extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s,p,v){const E=this.length;return this.resize(E+1),this.emplace(E,r,s,p,v)}emplace(r,s,p,v,E){const A=4*r;return this.float32[A+0]=s,this.float32[A+1]=p,this.float32[A+2]=v,this.float32[A+3]=E,r}}q.prototype.bytesPerElement=16,Yt("StructArrayLayout4f16",q);class W extends Cs{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new M(this.anchorPointX,this.anchorPointY)}}W.prototype.size=20;class H extends nu{get(r){return new W(this,r)}}Yt("CollisionBoxArray",H);class J extends Cs{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(r){this._structArray.uint8[this._pos1+37]=r}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(r){this._structArray.uint8[this._pos1+38]=r}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(r){this._structArray.uint32[this._pos4+10]=r}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}J.prototype.size=48;class ae extends m{get(r){return new J(this,r)}}Yt("PlacedSymbolArray",ae);class ge extends Cs{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(r){this._structArray.uint32[this._pos4+12]=r}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}ge.prototype.size=64;class me extends b{get(r){return new ge(this,r)}}Yt("SymbolInstanceArray",me);class ve extends S{getoffsetX(r){return this.float32[1*r+0]}}Yt("GlyphOffsetArray",ve);class we extends Xa{getx(r){return this.int16[3*r+0]}gety(r){return this.int16[3*r+1]}gettileUnitDistanceFromAnchor(r){return this.int16[3*r+2]}}Yt("SymbolLineVertexArray",we);class Ie extends Cs{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}Ie.prototype.size=12;class Ce extends C{get(r){return new Ie(this,r)}}Yt("TextAnchorOffsetArray",Ce);class ze extends Cs{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}ze.prototype.size=8;class Ve extends O{get(r){return new ze(this,r)}}Yt("FeatureIndexArray",Ve);class Me extends $o{}class Ye extends $o{}class ct extends $o{}class rt extends Cu{}class st extends eo{}class lt extends Gn{}class Nt extends Vi{}class Vt extends wr{}class At extends xh{}class ln extends dc{}class Zn extends wh{}class vi extends t{}class Wi extends u{}class ji extends N{}const Ir=Nr([{name:"a_pos",components:2,type:"Int16"}],4),{members:Br}=Ir;class Un{constructor(r=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=r}prepareSegment(r,s,p,v){const E=this.segments[this.segments.length-1];return r>Un.MAX_VERTEX_ARRAY_LENGTH&&Ii(`Max vertices per segment is ${Un.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${r}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${Un.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!E||E.vertexLength+r>Un.MAX_VERTEX_ARRAY_LENGTH||E.sortKey!==v?this.createNewSegment(s,p,v):E}createNewSegment(r,s,p){const v={vertexOffset:r.length,primitiveOffset:s.length,vertexLength:0,primitiveLength:0,vaos:{}};return p!==void 0&&(v.sortKey=p),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(v),v}getOrCreateLatestSegment(r,s,p){return this.prepareSegment(0,r,s,p)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const r of this.segments)for(const s in r.vaos)r.vaos[s].destroy()}static simpleSegment(r,s,p,v){return new Un([{vertexOffset:r,primitiveOffset:s,vertexLength:p,primitiveLength:v,vaos:{},sortKey:0}])}}function lr(l,r){return 256*(l=Xt(Math.floor(l),0,255))+Xt(Math.floor(r),0,255)}Un.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Yt("SegmentVector",Un);const sa=Nr([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Fr,La,Wa,po={exports:{}},Mu={exports:{}},iu={exports:{}},Th=(function(){if(Wa)return po.exports;Wa=1;var l=(Fr||(Fr=1,Mu.exports=function(s,p){var v,E,A,I,z,F,$,X;for(E=s.length-(v=3&s.length),A=p,z=3432918353,F=461845907,X=0;X<E;)$=255&s.charCodeAt(X)|(255&s.charCodeAt(++X))<<8|(255&s.charCodeAt(++X))<<16|(255&s.charCodeAt(++X))<<24,++X,A=27492+(65535&(I=5*(65535&(A=(A^=$=(65535&($=($=(65535&$)*z+((($>>>16)*z&65535)<<16)&4294967295)<<15|$>>>17))*F+((($>>>16)*F&65535)<<16)&4294967295)<<13|A>>>19))+((5*(A>>>16)&65535)<<16)&4294967295))+((58964+(I>>>16)&65535)<<16);switch($=0,v){case 3:$^=(255&s.charCodeAt(X+2))<<16;case 2:$^=(255&s.charCodeAt(X+1))<<8;case 1:A^=$=(65535&($=($=(65535&($^=255&s.charCodeAt(X)))*z+((($>>>16)*z&65535)<<16)&4294967295)<<15|$>>>17))*F+((($>>>16)*F&65535)<<16)&4294967295}return A^=s.length,A=2246822507*(65535&(A^=A>>>16))+((2246822507*(A>>>16)&65535)<<16)&4294967295,A=3266489909*(65535&(A^=A>>>13))+((3266489909*(A>>>16)&65535)<<16)&4294967295,(A^=A>>>16)>>>0}),Mu.exports),r=(La||(La=1,iu.exports=function(s,p){for(var v,E=s.length,A=p^E,I=0;E>=4;)v=1540483477*(65535&(v=255&s.charCodeAt(I)|(255&s.charCodeAt(++I))<<8|(255&s.charCodeAt(++I))<<16|(255&s.charCodeAt(++I))<<24))+((1540483477*(v>>>16)&65535)<<16),A=1540483477*(65535&A)+((1540483477*(A>>>16)&65535)<<16)^(v=1540483477*(65535&(v^=v>>>24))+((1540483477*(v>>>16)&65535)<<16)),E-=4,++I;switch(E){case 3:A^=(255&s.charCodeAt(I+2))<<16;case 2:A^=(255&s.charCodeAt(I+1))<<8;case 1:A=1540483477*(65535&(A^=255&s.charCodeAt(I)))+((1540483477*(A>>>16)&65535)<<16)}return A=1540483477*(65535&(A^=A>>>13))+((1540483477*(A>>>16)&65535)<<16),(A^=A>>>15)>>>0}),iu.exports);return po.exports=l,po.exports.murmur3=l,po.exports.murmur2=r,po.exports})(),qc=k(Th);class fc{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(r,s,p,v){this.ids.push(pc(r)),this.positions.push(s,p,v)}getPositions(r){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const s=pc(r);let p=0,v=this.ids.length-1;for(;p<v;){const A=p+v>>1;this.ids[A]>=s?v=A:p=A+1}const E=[];for(;this.ids[p]===s;)E.push({index:this.positions[3*p],start:this.positions[3*p+1],end:this.positions[3*p+2]}),p++;return E}static serialize(r,s){const p=new Float64Array(r.ids),v=new Uint32Array(r.positions);return to(p,v,0,p.length-1),s&&s.push(p.buffer,v.buffer),{ids:p,positions:v}}static deserialize(r){const s=new fc;return s.ids=r.ids,s.positions=r.positions,s.indexed=!0,s}}function pc(l){const r=+l;return!isNaN(r)&&r<=Number.MAX_SAFE_INTEGER?r:qc(String(l))}function to(l,r,s,p){for(;s<p;){const v=l[s+p>>1];let E=s-1,A=p+1;for(;;){do E++;while(l[E]<v);do A--;while(l[A]>v);if(E>=A)break;vl(l,E,A),vl(r,3*E,3*A),vl(r,3*E+1,3*A+1),vl(r,3*E+2,3*A+2)}A-s<p-A?(to(l,r,s,A),s=A+1):(to(l,r,A+1,p),p=A)}}function vl(l,r,s){const p=l[r];l[r]=l[s],l[s]=p}Yt("FeaturePositionMap",fc);class ss{constructor(r,s){this.gl=r.gl,this.location=s}}class Iu extends ss{constructor(r,s){super(r,s),this.current=0}set(r){this.current!==r&&(this.current=r,this.gl.uniform1f(this.location,r))}}class oa extends ss{constructor(r,s){super(r,s),this.current=[0,0,0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]&&r[3]===this.current[3]||(this.current=r,this.gl.uniform4f(this.location,r[0],r[1],r[2],r[3]))}}class la extends ss{constructor(r,s){super(r,s),this.current=Ln.transparent}set(r){r.r===this.current.r&&r.g===this.current.g&&r.b===this.current.b&&r.a===this.current.a||(this.current=r,this.gl.uniform4f(this.location,r.r,r.g,r.b,r.a))}}const qo=new Float32Array(16);function ua(l){return[lr(255*l.r,255*l.g),lr(255*l.b,255*l.a)]}class ud{constructor(r,s,p){this.value=r,this.uniformNames=s.map((v=>`u_${v}`)),this.type=p}setUniform(r,s,p){r.set(p.constantOr(this.value))}getBinding(r,s,p){return this.type==="color"?new la(r,s):new Iu(r,s)}}class mc{constructor(r,s){this.uniformNames=s.map((p=>`u_${p}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(r,s){this.pixelRatioFrom=s.pixelRatio,this.pixelRatioTo=r.pixelRatio,this.patternFrom=s.tlbr,this.patternTo=r.tlbr}setUniform(r,s,p,v){const E=v==="u_pattern_to"?this.patternTo:v==="u_pattern_from"?this.patternFrom:v==="u_pixel_ratio_to"?this.pixelRatioTo:v==="u_pixel_ratio_from"?this.pixelRatioFrom:null;E&&r.set(E)}getBinding(r,s,p){return p.substr(0,9)==="u_pattern"?new oa(r,s):new Iu(r,s)}}class ru{constructor(r,s,p,v){this.expression=r,this.type=p,this.maxValue=0,this.paintVertexAttributes=s.map((E=>({name:`a_${E}`,type:"Float32",components:p==="color"?2:1,offset:0}))),this.paintVertexArray=new v}populatePaintArray(r,s,p,v,E){const A=this.paintVertexArray.length,I=this.expression.evaluate(new ki(0),s,{},v,[],E);this.paintVertexArray.resize(r),this._setPaintValue(A,r,I)}updatePaintArray(r,s,p,v){const E=this.expression.evaluate({zoom:0},p,v);this._setPaintValue(r,s,E)}_setPaintValue(r,s,p){if(this.type==="color"){const v=ua(p);for(let E=r;E<s;E++)this.paintVertexArray.emplace(E,v[0],v[1])}else{for(let v=r;v<s;v++)this.paintVertexArray.emplace(v,p);this.maxValue=Math.max(this.maxValue,Math.abs(p))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class bl{constructor(r,s,p,v,E,A){this.expression=r,this.uniformNames=s.map((I=>`u_${I}_t`)),this.type=p,this.useIntegerZoom=v,this.zoom=E,this.maxValue=0,this.paintVertexAttributes=s.map((I=>({name:`a_${I}`,type:"Float32",components:p==="color"?4:2,offset:0}))),this.paintVertexArray=new A}populatePaintArray(r,s,p,v,E){const A=this.expression.evaluate(new ki(this.zoom),s,{},v,[],E),I=this.expression.evaluate(new ki(this.zoom+1),s,{},v,[],E),z=this.paintVertexArray.length;this.paintVertexArray.resize(r),this._setPaintValue(z,r,A,I)}updatePaintArray(r,s,p,v){const E=this.expression.evaluate({zoom:this.zoom},p,v),A=this.expression.evaluate({zoom:this.zoom+1},p,v);this._setPaintValue(r,s,E,A)}_setPaintValue(r,s,p,v){if(this.type==="color"){const E=ua(p),A=ua(v);for(let I=r;I<s;I++)this.paintVertexArray.emplace(I,E[0],E[1],A[0],A[1])}else{for(let E=r;E<s;E++)this.paintVertexArray.emplace(E,p,v);this.maxValue=Math.max(this.maxValue,Math.abs(p),Math.abs(v))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(r,s){const p=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,v=Xt(this.expression.interpolationFactor(p,this.zoom,this.zoom+1),0,1);r.set(v)}getBinding(r,s,p){return new Iu(r,s)}}class au{constructor(r,s,p,v,E,A){this.expression=r,this.type=s,this.useIntegerZoom=p,this.zoom=v,this.layerId=A,this.zoomInPaintVertexArray=new E,this.zoomOutPaintVertexArray=new E}populatePaintArray(r,s,p){const v=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(r),this.zoomOutPaintVertexArray.resize(r),this._setPaintValues(v,r,s.patterns&&s.patterns[this.layerId],p)}updatePaintArray(r,s,p,v,E){this._setPaintValues(r,s,p.patterns&&p.patterns[this.layerId],E)}_setPaintValues(r,s,p,v){if(!v||!p)return;const{min:E,mid:A,max:I}=p,z=v[E],F=v[A],$=v[I];if(z&&F&&$)for(let X=r;X<s;X++)this.zoomInPaintVertexArray.emplace(X,F.tl[0],F.tl[1],F.br[0],F.br[1],z.tl[0],z.tl[1],z.br[0],z.br[1],F.pixelRatio,z.pixelRatio),this.zoomOutPaintVertexArray.emplace(X,F.tl[0],F.tl[1],F.br[0],F.br[1],$.tl[0],$.tl[1],$.br[0],$.br[1],F.pixelRatio,$.pixelRatio)}upload(r){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=r.createVertexBuffer(this.zoomInPaintVertexArray,sa.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=r.createVertexBuffer(this.zoomOutPaintVertexArray,sa.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Ff{constructor(r,s,p){this.binders={},this._buffers=[];const v=[];for(const E in r.paint._values){if(!p(E))continue;const A=r.paint.get(E);if(!(A instanceof yl&&pl(A.property.specification)))continue;const I=Xp(E,r.type),z=A.value,F=A.property.specification.type,$=A.property.useIntegerZoom,X=A.property.specification["property-type"],te=X==="cross-faded"||X==="cross-faded-data-driven";if(z.kind==="constant")this.binders[E]=te?new mc(z.value,I):new ud(z.value,I,F),v.push(`/u_${E}`);else if(z.kind==="source"||te){const ie=Vf(E,F,"source");this.binders[E]=te?new au(z,F,$,s,ie,r.id):new ru(z,I,F,ie),v.push(`/a_${E}`)}else{const ie=Vf(E,F,"composite");this.binders[E]=new bl(z,I,F,$,s,ie),v.push(`/z_${E}`)}}this.cacheKey=v.sort().join("")}getMaxValue(r){const s=this.binders[r];return s instanceof ru||s instanceof bl?s.maxValue:0}populatePaintArrays(r,s,p,v,E){for(const A in this.binders){const I=this.binders[A];(I instanceof ru||I instanceof bl||I instanceof au)&&I.populatePaintArray(r,s,p,v,E)}}setConstantPatternPositions(r,s){for(const p in this.binders){const v=this.binders[p];v instanceof mc&&v.setConstantPatternPositions(r,s)}}updatePaintArrays(r,s,p,v,E){let A=!1;for(const I in r){const z=s.getPositions(I);for(const F of z){const $=p.feature(F.index);for(const X in this.binders){const te=this.binders[X];if((te instanceof ru||te instanceof bl||te instanceof au)&&te.expression.isStateDependent===!0){const ie=v.paint.get(X);te.expression=ie.value,te.updatePaintArray(F.start,F.end,$,r[I],E),A=!0}}}}return A}defines(){const r=[];for(const s in this.binders){const p=this.binders[s];(p instanceof ud||p instanceof mc)&&r.push(...p.uniformNames.map((v=>`#define HAS_UNIFORM_${v}`)))}return r}getBinderAttributes(){const r=[];for(const s in this.binders){const p=this.binders[s];if(p instanceof ru||p instanceof bl)for(let v=0;v<p.paintVertexAttributes.length;v++)r.push(p.paintVertexAttributes[v].name);else if(p instanceof au)for(let v=0;v<sa.members.length;v++)r.push(sa.members[v].name)}return r}getBinderUniforms(){const r=[];for(const s in this.binders){const p=this.binders[s];if(p instanceof ud||p instanceof mc||p instanceof bl)for(const v of p.uniformNames)r.push(v)}return r}getPaintVertexBuffers(){return this._buffers}getUniforms(r,s){const p=[];for(const v in this.binders){const E=this.binders[v];if(E instanceof ud||E instanceof mc||E instanceof bl){for(const A of E.uniformNames)if(s[A]){const I=E.getBinding(r,s[A],A);p.push({name:A,property:v,binding:I})}}}return p}setUniforms(r,s,p,v){for(const{name:E,property:A,binding:I}of s)this.binders[A].setUniform(I,v,p.get(A),E)}updatePaintBuffers(r){this._buffers=[];for(const s in this.binders){const p=this.binders[s];if(r&&p instanceof au){const v=r.fromScale===2?p.zoomInPaintVertexBuffer:p.zoomOutPaintVertexBuffer;v&&this._buffers.push(v)}else(p instanceof ru||p instanceof bl)&&p.paintVertexBuffer&&this._buffers.push(p.paintVertexBuffer)}}upload(r){for(const s in this.binders){const p=this.binders[s];(p instanceof ru||p instanceof bl||p instanceof au)&&p.upload(r)}this.updatePaintBuffers()}destroy(){for(const r in this.binders){const s=this.binders[r];(s instanceof ru||s instanceof bl||s instanceof au)&&s.destroy()}}}class mo{constructor(r,s,p=()=>!0){this.programConfigurations={};for(const v of r)this.programConfigurations[v.id]=new Ff(v,s,p);this.needsUpload=!1,this._featureMap=new fc,this._bufferOffset=0}populatePaintArrays(r,s,p,v,E,A){for(const I in this.programConfigurations)this.programConfigurations[I].populatePaintArrays(r,s,v,E,A);s.id!==void 0&&this._featureMap.add(s.id,p,this._bufferOffset,r),this._bufferOffset=r,this.needsUpload=!0}updatePaintArrays(r,s,p,v){for(const E of p)this.needsUpload=this.programConfigurations[E.id].updatePaintArrays(r,this._featureMap,s,E,v)||this.needsUpload}get(r){return this.programConfigurations[r]}upload(r){if(this.needsUpload){for(const s in this.programConfigurations)this.programConfigurations[s].upload(r);this.needsUpload=!1}}destroy(){for(const r in this.programConfigurations)this.programConfigurations[r].destroy()}}function Xp(l,r){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[l]||[l.replace(`${r}-`,"").replace(/-/g,"_")]}function Vf(l,r,s){const p={color:{source:Gn,composite:q},number:{source:S,composite:Gn}},v=(function(E){return{"line-pattern":{source:Nt,composite:Nt},"fill-pattern":{source:Nt,composite:Nt},"fill-extrusion-pattern":{source:Nt,composite:Nt}}[E]})(l);return v&&v[s]||p[r][s]}Yt("ConstantBinder",ud),Yt("CrossFadedConstantBinder",mc),Yt("SourceExpressionBinder",ru),Yt("CrossFadedCompositeBinder",au),Yt("CompositeExpressionBinder",bl),Yt("ProgramConfiguration",Ff,{omit:["_buffers"]}),Yt("ProgramConfigurationSet",mo);const cd=Math.pow(2,14)-1,gc=-cd-1;function su(l){const r=zt/l.extent,s=l.loadGeometry();for(let p=0;p<s.length;p++){const v=s[p];for(let E=0;E<v.length;E++){const A=v[E],I=Math.round(A.x*r),z=Math.round(A.y*r);A.x=Xt(I,gc,cd),A.y=Xt(z,gc,cd),(I<A.x||I>A.x+1||z<A.y||z>A.y+1)&&Ii("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return s}function xl(l,r){return{type:l.type,id:l.id,properties:l.properties,geometry:r?su(l):[]}}const dg=-32768;function by(l,r,s,p,v){l.emplaceBack(dg+8*r+p,dg+8*s+v)}class hd{constructor(r){this.zoom=r.zoom,this.globalState=r.globalState,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map((s=>s.id)),this.index=r.index,this.hasPattern=!1,this.layoutVertexArray=new Ye,this.indexArray=new Wi,this.segments=new Un,this.programConfigurations=new mo(r.layers,r.zoom),this.stateDependentLayerIds=this.layers.filter((s=>s.isStateDependent())).map((s=>s.id))}populate(r,s,p){const v=this.layers[0],E=[];let A=null,I=!1,z=v.type==="heatmap";if(v.type==="circle"){const $=v;A=$.layout.get("circle-sort-key"),I=!A.isConstant(),z=z||$.paint.get("circle-pitch-alignment")==="map"}const F=z?s.subdivisionGranularity.circle:1;for(const{feature:$,id:X,index:te,sourceLayerIndex:ie}of r){const re=this.layers[0]._featureFilter.needGeometry,oe=xl($,re);if(!this.layers[0]._featureFilter.filter(new ki(this.zoom,{globalState:this.globalState}),oe,p))continue;const pe=I?A.evaluate(oe,{},p):void 0,Te={id:X,properties:$.properties,type:$.type,sourceLayerIndex:ie,index:te,geometry:re?oe.geometry:su($),patterns:{},sortKey:pe};E.push(Te)}I&&E.sort((($,X)=>$.sortKey-X.sortKey));for(const $ of E){const{geometry:X,index:te,sourceLayerIndex:ie}=$,re=r[te].feature;this.addFeature($,X,te,p,F),s.featureIndex.insert(re,X,te,ie,this.index)}}update(r,s,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,s,this.stateDependentLayers,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,Br),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(r,s,p,v,E=1){let A;switch(E){case 1:A=[0,7];break;case 3:A=[0,2,5,7];break;case 5:A=[0,1,3,4,6,7];break;case 7:A=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${E}; valid values are 1, 3, 5, 7.`)}const I=A.length;for(const z of s)for(const F of z){const $=F.x,X=F.y;if($<0||$>=zt||X<0||X>=zt)continue;const te=this.segments.prepareSegment(I*I,this.layoutVertexArray,this.indexArray,r.sortKey),ie=te.vertexLength;for(let re=0;re<I;re++)for(let oe=0;oe<I;oe++)by(this.layoutVertexArray,$,X,A[oe],A[re]);for(let re=0;re<I-1;re++)for(let oe=0;oe<I-1;oe++){const pe=ie+re*I+oe,Te=ie+(re+1)*I+oe;this.indexArray.emplaceBack(pe,Te+1,pe+1),this.indexArray.emplaceBack(pe,Te,Te+1)}te.vertexLength+=I*I,te.primitiveLength+=(I-1)*(I-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,p,{},v)}}function fg(l,r){for(let s=0;s<l.length;s++)if(dd(r,l[s]))return!0;for(let s=0;s<r.length;s++)if(dd(l,r[s]))return!0;return!!jf(l,r)}function pg(l,r,s){return!!dd(l,r)||!!Wp(r,l,s)}function mg(l,r){if(l.length===1)return _g(r,l[0]);for(let s=0;s<r.length;s++){const p=r[s];for(let v=0;v<p.length;v++)if(dd(l,p[v]))return!0}for(let s=0;s<l.length;s++)if(_g(r,l[s]))return!0;for(let s=0;s<r.length;s++)if(jf(l,r[s]))return!0;return!1}function gg(l,r,s){if(l.length>1){if(jf(l,r))return!0;for(let p=0;p<r.length;p++)if(Wp(r[p],l,s))return!0}for(let p=0;p<l.length;p++)if(Wp(l[p],r,s))return!0;return!1}function jf(l,r){if(l.length===0||r.length===0)return!1;for(let s=0;s<l.length-1;s++){const p=l[s],v=l[s+1];for(let E=0;E<r.length-1;E++)if(xy(p,v,r[E],r[E+1]))return!0}return!1}function xy(l,r,s,p){return Va(l,s,p)!==Va(r,s,p)&&Va(l,r,s)!==Va(l,r,p)}function Wp(l,r,s){const p=s*s;if(r.length===1)return l.distSqr(r[0])<p;for(let v=1;v<r.length;v++)if(Sh(l,r[v-1],r[v])<p)return!0;return!1}function Sh(l,r,s){const p=r.distSqr(s);if(p===0)return l.distSqr(r);const v=((l.x-r.x)*(s.x-r.x)+(l.y-r.y)*(s.y-r.y))/p;return l.distSqr(v<0?r:v>1?s:s.sub(r)._mult(v)._add(r))}function _g(l,r){let s,p,v,E=!1;for(let A=0;A<l.length;A++){s=l[A];for(let I=0,z=s.length-1;I<s.length;z=I++)p=s[I],v=s[z],p.y>r.y!=v.y>r.y&&r.x<(v.x-p.x)*(r.y-p.y)/(v.y-p.y)+p.x&&(E=!E)}return E}function dd(l,r){let s=!1;for(let p=0,v=l.length-1;p<l.length;v=p++){const E=l[p],A=l[v];E.y>r.y!=A.y>r.y&&r.x<(A.x-E.x)*(r.y-E.y)/(A.y-E.y)+E.x&&(s=!s)}return s}function wy(l,r,s){const p=s[0],v=s[2];if(l.x<p.x&&r.x<p.x||l.x>v.x&&r.x>v.x||l.y<p.y&&r.y<p.y||l.y>v.y&&r.y>v.y)return!1;const E=Va(l,r,s[0]);return E!==Va(l,r,s[1])||E!==Va(l,r,s[2])||E!==Va(l,r,s[3])}function Eh(l,r,s){const p=r.paint.get(l).value;return p.kind==="constant"?p.value:s.programConfigurations.get(r.id).getMaxValue(l)}function Uf(l){return Math.sqrt(l[0]*l[0]+l[1]*l[1])}function Hd(l,r,s,p,v){if(!r[0]&&!r[1])return l;const E=M.convert(r)._mult(v);s==="viewport"&&E._rotate(-p);const A=[];for(let I=0;I<l.length;I++)A.push(l[I].sub(E));return A}let yg,vg;Yt("CircleBucket",hd,{omit:["layers"]});var ob={get paint(){return vg=vg||new As({"circle-radius":new Tn($e.paint_circle["circle-radius"]),"circle-color":new Tn($e.paint_circle["circle-color"]),"circle-blur":new Tn($e.paint_circle["circle-blur"]),"circle-opacity":new Tn($e.paint_circle["circle-opacity"]),"circle-translate":new an($e.paint_circle["circle-translate"]),"circle-translate-anchor":new an($e.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new an($e.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new an($e.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Tn($e.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Tn($e.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Tn($e.paint_circle["circle-stroke-opacity"])})},get layout(){return yg=yg||new As({"circle-sort-key":new Tn($e.layout_circle["circle-sort-key"])})}};class bg extends fo{constructor(r){super(r,ob)}createBucket(r){return new hd(r)}queryRadius(r){const s=r;return Eh("circle-radius",this,s)+Eh("circle-stroke-width",this,s)+Uf(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:r,feature:s,featureState:p,geometry:v,transform:E,pixelsToTileUnits:A,unwrappedTileID:I,getElevation:z}){const F=Hd(r,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-E.bearingInRadians,A),$=this.paint.get("circle-radius").evaluate(s,p)+this.paint.get("circle-stroke-width").evaluate(s,p),X=this.paint.get("circle-pitch-alignment")==="map",te=X?F:(function(re,oe,pe,Te){return re.map((We=>ka(We,oe,pe,Te)))})(F,E,I,z),ie=X?$*A:$;for(const re of v)for(const oe of re){const pe=X?oe:ka(oe,E,I,z);let Te=ie;const We=E.projectTileCoordinates(oe.x,oe.y,I,z).signedDistanceFromCamera;if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Te*=We/E.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Te*=E.cameraToCenterDistance/We),pg(te,pe,Te))return!0}return!1}}function ka(l,r,s,p){const v=r.projectTileCoordinates(l.x,l.y,s,p).point;return new M((.5*v.x+.5)*r.width,(.5*-v.y+.5)*r.height)}class Ms extends hd{}let xg;Yt("HeatmapBucket",Ms,{omit:["layers"]});var Ty={get paint(){return xg=xg||new As({"heatmap-radius":new Tn($e.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Tn($e.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new an($e.paint_heatmap["heatmap-intensity"]),"heatmap-color":new $c($e.paint_heatmap["heatmap-color"]),"heatmap-opacity":new an($e.paint_heatmap["heatmap-opacity"])})}};function Kp(l,{width:r,height:s},p,v){if(v){if(v instanceof Uint8ClampedArray)v=new Uint8Array(v.buffer);else if(v.length!==r*s*p)throw new RangeError(`mismatched image size. expected: ${v.length} but got: ${r*s*p}`)}else v=new Uint8Array(r*s*p);return l.width=r,l.height=s,l.data=v,l}function wg(l,{width:r,height:s},p){if(r===l.width&&s===l.height)return;const v=Kp({},{width:r,height:s},p);fd(l,v,{x:0,y:0},{x:0,y:0},{width:Math.min(l.width,r),height:Math.min(l.height,s)},p),l.width=r,l.height=s,l.data=v.data}function fd(l,r,s,p,v,E){if(v.width===0||v.height===0)return r;if(v.width>l.width||v.height>l.height||s.x>l.width-v.width||s.y>l.height-v.height)throw new RangeError("out of range source coordinates for image copy");if(v.width>r.width||v.height>r.height||p.x>r.width-v.width||p.y>r.height-v.height)throw new RangeError("out of range destination coordinates for image copy");const A=l.data,I=r.data;if(A===I)throw new Error("srcData equals dstData, so image is already copied");for(let z=0;z<v.height;z++){const F=((s.y+z)*l.width+s.x)*E,$=((p.y+z)*r.width+p.x)*E;for(let X=0;X<v.width*E;X++)I[$+X]=A[F+X]}return r}class Xd{constructor(r,s){Kp(this,r,1,s)}resize(r){wg(this,r,1)}clone(){return new Xd({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,s,p,v,E){fd(r,s,p,v,E,1)}}class Is{constructor(r,s){Kp(this,r,4,s)}resize(r){wg(this,r,4)}replace(r,s){s?this.data.set(r):this.data=r instanceof Uint8ClampedArray?new Uint8Array(r.buffer):r}clone(){return new Is({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,s,p,v,E){fd(r,s,p,v,E,4)}setPixel(r,s,p){const v=4*(r*this.width+s);this.data[v+0]=Math.round(255*p.r/p.a),this.data[v+1]=Math.round(255*p.g/p.a),this.data[v+2]=Math.round(255*p.b/p.a),this.data[v+3]=Math.round(255*p.a)}}function Tg(l){const r={},s=l.resolution||256,p=l.clips?l.clips.length:1,v=l.image||new Is({width:s,height:p});if(Math.log(s)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${s}`);const E=(A,I,z)=>{r[l.evaluationKey]=z;const F=l.expression.evaluate(r);v.setPixel(A/4/s,I/4,F)};if(l.clips)for(let A=0,I=0;A<p;++A,I+=4*s)for(let z=0,F=0;z<s;z++,F+=4){const $=z/(s-1),{start:X,end:te}=l.clips[A];E(I,F,X*(1-$)+te*$)}else for(let A=0,I=0;A<s;A++,I+=4)E(0,I,A/(s-1));return v}Yt("AlphaImage",Xd),Yt("RGBAImage",Is);const Sg="big-fb";class Yp extends fo{createBucket(r){return new Ms(r)}constructor(r){super(r,Ty),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(r){r==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Tg({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(Sg)&&this.heatmapFbos.delete(Sg)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let Qp;var Sy={get paint(){return Qp=Qp||new As({"hillshade-illumination-direction":new an($e.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new an($e.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new an($e.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new an($e.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new an($e.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new an($e.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new an($e.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new an($e.paint_hillshade["hillshade-method"])})}};class Ey extends fo{constructor(r){super(r,Sy),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let r=this.paint.get("hillshade-illumination-direction").values,s=this.paint.get("hillshade-illumination-altitude").values,p=this.paint.get("hillshade-highlight-color").values,v=this.paint.get("hillshade-shadow-color").values;const E=Math.max(r.length,s.length,p.length,v.length);r=r.concat(Array(E-r.length).fill(r.at(-1))),s=s.concat(Array(E-s.length).fill(s.at(-1))),p=p.concat(Array(E-p.length).fill(p.at(-1))),v=v.concat(Array(E-v.length).fill(v.at(-1)));const A=s.map($r);return{directionRadians:r.map($r),altitudeRadians:A,shadowColor:v,highlightColor:p}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}let Eg;var Ag={get paint(){return Eg=Eg||new As({"color-relief-opacity":new an($e["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new $c($e["paint_color-relief"]["color-relief-color"])})}};class $f{constructor(r,s,p,v){this.context=r,this.format=p,this.texture=r.gl.createTexture(),this.update(s,v)}update(r,s,p){const{width:v,height:E}=r,A=!(this.size&&this.size[0]===v&&this.size[1]===E||p),{context:I}=this,{gl:z}=I;if(this.useMipmap=!!(s&&s.useMipmap),z.bindTexture(z.TEXTURE_2D,this.texture),I.pixelStoreUnpackFlipY.set(!1),I.pixelStoreUnpack.set(1),I.pixelStoreUnpackPremultiplyAlpha.set(this.format===z.RGBA&&(!s||s.premultiply!==!1)),A)this.size=[v,E],r instanceof HTMLImageElement||r instanceof HTMLCanvasElement||r instanceof HTMLVideoElement||r instanceof ImageData||Sa(r)?z.texImage2D(z.TEXTURE_2D,0,this.format,this.format,z.UNSIGNED_BYTE,r):z.texImage2D(z.TEXTURE_2D,0,this.format,v,E,0,this.format,z.UNSIGNED_BYTE,r.data);else{const{x:F,y:$}=p||{x:0,y:0};r instanceof HTMLImageElement||r instanceof HTMLCanvasElement||r instanceof HTMLVideoElement||r instanceof ImageData||Sa(r)?z.texSubImage2D(z.TEXTURE_2D,0,F,$,z.RGBA,z.UNSIGNED_BYTE,r):z.texSubImage2D(z.TEXTURE_2D,0,F,$,v,E,z.RGBA,z.UNSIGNED_BYTE,r.data)}this.useMipmap&&this.isSizePowerOfTwo()&&z.generateMipmap(z.TEXTURE_2D),I.pixelStoreUnpackFlipY.setDefault(),I.pixelStoreUnpack.setDefault(),I.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(r,s,p){const{context:v}=this,{gl:E}=v;E.bindTexture(E.TEXTURE_2D,this.texture),p!==E.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(p=E.LINEAR),r!==this.filter&&(E.texParameteri(E.TEXTURE_2D,E.TEXTURE_MAG_FILTER,r),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_MIN_FILTER,p||r),this.filter=r),s!==this.wrap&&(E.texParameteri(E.TEXTURE_2D,E.TEXTURE_WRAP_S,s),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_WRAP_T,s),this.wrap=s)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:r}=this.context;r.deleteTexture(this.texture),this.texture=null}}class Jp{constructor(r,s,p,v=1,E=1,A=1,I=0){if(this.uid=r,s.height!==s.width)throw new RangeError("DEM tiles must be square");if(p&&!["mapbox","terrarium","custom"].includes(p))return void Ii(`"${p}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=s.height;const z=this.dim=s.height-2;switch(this.data=new Uint32Array(s.data.buffer),p){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=v,this.greenFactor=E,this.blueFactor=A,this.baseShift=I;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let F=0;F<z;F++)this.data[this._idx(-1,F)]=this.data[this._idx(0,F)],this.data[this._idx(z,F)]=this.data[this._idx(z-1,F)],this.data[this._idx(F,-1)]=this.data[this._idx(F,0)],this.data[this._idx(F,z)]=this.data[this._idx(F,z-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(z,-1)]=this.data[this._idx(z-1,0)],this.data[this._idx(-1,z)]=this.data[this._idx(0,z-1)],this.data[this._idx(z,z)]=this.data[this._idx(z-1,z-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let F=0;F<z;F++)for(let $=0;$<z;$++){const X=this.get(F,$);X>this.max&&(this.max=X),X<this.min&&(this.min=X)}}get(r,s){const p=new Uint8Array(this.data.buffer),v=4*this._idx(r,s);return this.unpack(p[v],p[v+1],p[v+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(r,s){if(r<-1||r>=this.dim+1||s<-1||s>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(s+1)*this.stride+(r+1)}unpack(r,s,p){return r*this.redFactor+s*this.greenFactor+p*this.blueFactor-this.baseShift}pack(r){return Cg(r,this.getUnpackVector())}getPixels(){return new Is({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(r,s,p){if(this.dim!==r.dim)throw new Error("dem dimension mismatch");let v=s*this.dim,E=s*this.dim+this.dim,A=p*this.dim,I=p*this.dim+this.dim;switch(s){case-1:v=E-1;break;case 1:E=v+1}switch(p){case-1:A=I-1;break;case 1:I=A+1}const z=-s*this.dim,F=-p*this.dim;for(let $=A;$<I;$++)for(let X=v;X<E;X++)this.data[this._idx(X,$)]=r.data[this._idx(X+z,$+F)]}}function Cg(l,r){const s=r[0],p=r[1],v=r[2],E=r[3],A=Math.min(s,p,v),I=Math.round((l+E)/A);return{r:Math.floor(I*A/s)%256,g:Math.floor(I*A/p)%256,b:Math.floor(I*A/v)%256}}Yt("DEMData",Jp);class Mg extends fo{constructor(r){super(r,Ag)}_createColorRamp(r){const s={elevationStops:[],colorStops:[]},p=this._transitionablePaint._values["color-relief-color"].value.expression;if(p instanceof f&&p._styleExpression.expression instanceof or){this.colorRampExpression=p;const A=p._styleExpression.expression;s.elevationStops=A.labels,s.colorStops=[];for(const I of s.elevationStops)s.colorStops.push(A.evaluate({globals:{elevation:I}}))}if(s.elevationStops.length<1&&(s.elevationStops=[0],s.colorStops=[Ln.transparent]),s.elevationStops.length<2&&(s.elevationStops.push(s.elevationStops[0]+1),s.colorStops.push(s.colorStops[0])),s.elevationStops.length<=r)return s;const v={elevationStops:[],colorStops:[]},E=(s.elevationStops.length-1)/(r-1);for(let A=0;A<s.elevationStops.length-.5;A+=E)v.elevationStops.push(s.elevationStops[Math.round(A)]),v.colorStops.push(s.colorStops[Math.round(A)]);return Ii(`Too many colors in specification of ${this.id} color-relief layer, may not render properly.`),v}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(r,s,p){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const v=this._createColorRamp(s),E=new Is({width:v.colorStops.length,height:1}),A=new Is({width:v.colorStops.length,height:1});for(let I=0;I<v.elevationStops.length;I++){const z=Cg(v.elevationStops[I],p);A.setPixel(0,I,new Ln(z.r/255,z.g/255,z.b/255,1)),E.setPixel(0,I,v.colorStops[I])}return this.colorRampTextures={elevationTexture:new $f(r,A,r.gl.RGBA),colorTexture:new $f(r,E,r.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return this.visibility!=="none"&&!!this.colorRampTextures}}const em=Nr([{name:"a_pos",components:2,type:"Int16"}],4),{members:Ig}=em;function tm(l,r,s){const p=s.patternDependencies;let v=!1;for(const E of r){const A=E.paint.get(`${l}-pattern`);A.isConstant()||(v=!0);const I=A.constantOr(null);I&&(v=!0,p[I.to]=!0,p[I.from]=!0)}return v}function qf(l,r,s,p,v){const E=v.patternDependencies;for(const A of r){const I=A.paint.get(`${l}-pattern`).value;if(I.kind!=="constant"){let z=I.evaluate({zoom:p-1},s,{},v.availableImages),F=I.evaluate({zoom:p},s,{},v.availableImages),$=I.evaluate({zoom:p+1},s,{},v.availableImages);z=z&&z.name?z.name:z,F=F&&F.name?F.name:F,$=$&&$.name?$.name:$,E[z]=!0,E[F]=!0,E[$]=!0,s.patterns[A.id]={min:z,mid:F,max:$}}}return s}function Pg(l,r,s,p,v){let E;if(v===(function(A,I,z,F){let $=0;for(let X=I,te=z-F;X<z;X+=F)$+=(A[te]-A[X])*(A[X+1]+A[te+1]),te=X;return $})(l,r,s,p)>0)for(let A=r;A<s;A+=p)E=kg(A/p|0,l[A],l[A+1],E);else for(let A=s-p;A>=r;A-=p)E=kg(A/p|0,l[A],l[A+1],E);return E&&md(E,E.next)&&(gd(E),E=E.next),E}function Go(l,r){if(!l)return l;r||(r=l);let s,p=l;do if(s=!1,p.steiner||!md(p,p.next)&&cr(p.prev,p,p.next)!==0)p=p.next;else{if(gd(p),p=r=p.prev,p===p.next)break;s=!0}while(s||p!==r);return r}function pd(l,r,s,p,v,E,A){if(!l)return;!A&&E&&(function(z,F,$,X){let te=z;do te.z===0&&(te.z=Pr(te.x,te.y,F,$,X)),te.prevZ=te.prev,te.nextZ=te.next,te=te.next;while(te!==z);te.prevZ.nextZ=null,te.prevZ=null,(function(ie){let re,oe=1;do{let pe,Te=ie;ie=null;let We=null;for(re=0;Te;){re++;let Le=Te,Fe=0;for(let gt=0;gt<oe&&(Fe++,Le=Le.nextZ,Le);gt++);let ot=oe;for(;Fe>0||ot>0&&Le;)Fe!==0&&(ot===0||!Le||Te.z<=Le.z)?(pe=Te,Te=Te.nextZ,Fe--):(pe=Le,Le=Le.nextZ,ot--),We?We.nextZ=pe:ie=pe,pe.prevZ=We,We=pe;Te=Le}We.nextZ=null,oe*=2}while(re>1)})(te)})(l,p,v,E);let I=l;for(;l.prev!==l.next;){const z=l.prev,F=l.next;if(E?Ay(l,p,v,E):lb(l))r.push(z.i,l.i,F.i),gd(l),l=F.next,I=F.next;else if((l=F)===I){A?A===1?pd(l=Gc(Go(l),r),r,s,p,v,E,2):A===2&&Rg(l,r,s,p,v,E):pd(Go(l),r,s,p,v,E,1);break}}}function lb(l){const r=l.prev,s=l,p=l.next;if(cr(r,s,p)>=0)return!1;const v=r.x,E=s.x,A=p.x,I=r.y,z=s.y,F=p.y,$=Math.min(v,E,A),X=Math.min(I,z,F),te=Math.max(v,E,A),ie=Math.max(I,z,F);let re=p.next;for(;re!==r;){if(re.x>=$&&re.x<=te&&re.y>=X&&re.y<=ie&&Wd(v,I,E,z,A,F,re.x,re.y)&&cr(re.prev,re,re.next)>=0)return!1;re=re.next}return!0}function Ay(l,r,s,p){const v=l.prev,E=l,A=l.next;if(cr(v,E,A)>=0)return!1;const I=v.x,z=E.x,F=A.x,$=v.y,X=E.y,te=A.y,ie=Math.min(I,z,F),re=Math.min($,X,te),oe=Math.max(I,z,F),pe=Math.max($,X,te),Te=Pr(ie,re,r,s,p),We=Pr(oe,pe,r,s,p);let Le=l.prevZ,Fe=l.nextZ;for(;Le&&Le.z>=Te&&Fe&&Fe.z<=We;){if(Le.x>=ie&&Le.x<=oe&&Le.y>=re&&Le.y<=pe&&Le!==v&&Le!==A&&Wd(I,$,z,X,F,te,Le.x,Le.y)&&cr(Le.prev,Le,Le.next)>=0||(Le=Le.prevZ,Fe.x>=ie&&Fe.x<=oe&&Fe.y>=re&&Fe.y<=pe&&Fe!==v&&Fe!==A&&Wd(I,$,z,X,F,te,Fe.x,Fe.y)&&cr(Fe.prev,Fe,Fe.next)>=0))return!1;Fe=Fe.nextZ}for(;Le&&Le.z>=Te;){if(Le.x>=ie&&Le.x<=oe&&Le.y>=re&&Le.y<=pe&&Le!==v&&Le!==A&&Wd(I,$,z,X,F,te,Le.x,Le.y)&&cr(Le.prev,Le,Le.next)>=0)return!1;Le=Le.prevZ}for(;Fe&&Fe.z<=We;){if(Fe.x>=ie&&Fe.x<=oe&&Fe.y>=re&&Fe.y<=pe&&Fe!==v&&Fe!==A&&Wd(I,$,z,X,F,te,Fe.x,Fe.y)&&cr(Fe.prev,Fe,Fe.next)>=0)return!1;Fe=Fe.nextZ}return!0}function Gc(l,r){let s=l;do{const p=s.prev,v=s.next.next;!md(p,v)&&Lg(p,s,s.next,v)&&Kd(p,v)&&Kd(v,p)&&(r.push(p.i,s.i,v.i),gd(s),gd(s.next),s=l=v),s=s.next}while(s!==l);return Go(s)}function Rg(l,r,s,p,v,E){let A=l;do{let I=A.next.next;for(;I!==A.prev;){if(A.i!==I.i&&Zf(A,I)){let z=im(A,I);return A=Go(A,A.next),z=Go(z,z.next),pd(A,r,s,p,v,E,0),void pd(z,r,s,p,v,E,0)}I=I.next}A=A.next}while(A!==l)}function Cy(l,r){let s=l.x-r.x;return s===0&&(s=l.y-r.y,s===0)&&(s=(l.next.y-l.y)/(l.next.x-l.x)-(r.next.y-r.y)/(r.next.x-r.x)),s}function nm(l,r){const s=(function(v,E){let A=E;const I=v.x,z=v.y;let F,$=-1/0;if(md(v,A))return A;do{if(md(v,A.next))return A.next;if(z<=A.y&&z>=A.next.y&&A.next.y!==A.y){const oe=A.x+(z-A.y)*(A.next.x-A.x)/(A.next.y-A.y);if(oe<=I&&oe>$&&($=oe,F=A.x<A.next.x?A:A.next,oe===I))return F}A=A.next}while(A!==E);if(!F)return null;const X=F,te=F.x,ie=F.y;let re=1/0;A=F;do{if(I>=A.x&&A.x>=te&&I!==A.x&&My(z<ie?I:$,z,te,ie,z<ie?$:I,z,A.x,A.y)){const oe=Math.abs(z-A.y)/(I-A.x);Kd(A,v)&&(oe<re||oe===re&&(A.x>F.x||A.x===F.x&&Gf(F,A)))&&(F=A,re=oe)}A=A.next}while(A!==X);return F})(l,r);if(!s)return r;const p=im(s,l);return Go(p,p.next),Go(s,s.next)}function Gf(l,r){return cr(l.prev,l,r.prev)<0&&cr(r.next,l,l.next)<0}function Pr(l,r,s,p,v){return(l=1431655765&((l=858993459&((l=252645135&((l=16711935&((l=(l-s)*v|0)|l<<8))|l<<4))|l<<2))|l<<1))|(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-p)*v|0)|r<<8))|r<<4))|r<<2))|r<<1))<<1}function ub(l){let r=l,s=l;do(r.x<s.x||r.x===s.x&&r.y<s.y)&&(s=r),r=r.next;while(r!==l);return s}function My(l,r,s,p,v,E,A,I){return(v-A)*(r-I)>=(l-A)*(E-I)&&(l-A)*(p-I)>=(s-A)*(r-I)&&(s-A)*(E-I)>=(v-A)*(p-I)}function Wd(l,r,s,p,v,E,A,I){return!(l===A&&r===I)&&My(l,r,s,p,v,E,A,I)}function Zf(l,r){return l.next.i!==r.i&&l.prev.i!==r.i&&!(function(s,p){let v=s;do{if(v.i!==s.i&&v.next.i!==s.i&&v.i!==p.i&&v.next.i!==p.i&&Lg(v,v.next,s,p))return!0;v=v.next}while(v!==s);return!1})(l,r)&&(Kd(l,r)&&Kd(r,l)&&(function(s,p){let v=s,E=!1;const A=(s.x+p.x)/2,I=(s.y+p.y)/2;do v.y>I!=v.next.y>I&&v.next.y!==v.y&&A<(v.next.x-v.x)*(I-v.y)/(v.next.y-v.y)+v.x&&(E=!E),v=v.next;while(v!==s);return E})(l,r)&&(cr(l.prev,l,r.prev)||cr(l,r.prev,r))||md(l,r)&&cr(l.prev,l,l.next)>0&&cr(r.prev,r,r.next)>0)}function cr(l,r,s){return(r.y-l.y)*(s.x-r.x)-(r.x-l.x)*(s.y-r.y)}function md(l,r){return l.x===r.x&&l.y===r.y}function Lg(l,r,s,p){const v=Bl(cr(l,r,s)),E=Bl(cr(l,r,p)),A=Bl(cr(s,p,l)),I=Bl(cr(s,p,r));return v!==E&&A!==I||!(v!==0||!Ah(l,s,r))||!(E!==0||!Ah(l,p,r))||!(A!==0||!Ah(s,l,p))||!(I!==0||!Ah(s,r,p))}function Ah(l,r,s){return r.x<=Math.max(l.x,s.x)&&r.x>=Math.min(l.x,s.x)&&r.y<=Math.max(l.y,s.y)&&r.y>=Math.min(l.y,s.y)}function Bl(l){return l>0?1:l<0?-1:0}function Kd(l,r){return cr(l.prev,l,l.next)<0?cr(l,r,l.next)>=0&&cr(l,l.prev,r)>=0:cr(l,r,l.prev)<0||cr(l,l.next,r)<0}function im(l,r){const s=Hf(l.i,l.x,l.y),p=Hf(r.i,r.x,r.y),v=l.next,E=r.prev;return l.next=r,r.prev=l,s.next=v,v.prev=s,p.next=s,s.prev=p,E.next=p,p.prev=E,p}function kg(l,r,s,p){const v=Hf(l,r,s);return p?(v.next=p.next,v.prev=p,p.next.prev=v,p.next=v):(v.prev=v,v.next=v),v}function gd(l){l.next.prev=l.prev,l.prev.next=l.next,l.prevZ&&(l.prevZ.nextZ=l.nextZ),l.nextZ&&(l.nextZ.prevZ=l.prevZ)}function Hf(l,r,s){return{i:l,x:r,y:s,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class Zc{constructor(r,s){if(s>r)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=r,this._minGranularity=s}getGranularityForZoomLevel(r){return Math.max(Math.floor(this._baseZoomGranularity/(1<<r)),this._minGranularity,1)}}class Xf{constructor(r){this.fill=r.fill,this.line=r.line,this.tile=r.tile,this.stencil=r.stencil,this.circle=r.circle}}Xf.noSubdivision=new Xf({fill:new Zc(0,0),line:new Zc(0,0),tile:new Zc(0,0),stencil:new Zc(0,0),circle:1}),Yt("SubdivisionGranularityExpression",Zc),Yt("SubdivisionGranularitySetting",Xf);const wl=-32768,Qr=32767;class Dg{constructor(r,s){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=r,this._granularityCellSize=zt/r,this._canonical=s}_getKey(r,s){return(r+=32768)<<16|s+32768}_vertexToIndex(r,s){if(r<-32768||s<-32768||r>32767||s>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const p=0|Math.round(r),v=0|Math.round(s),E=this._getKey(p,v);if(this._vertexDictionary.has(E))return this._vertexDictionary.get(E);const A=this._vertexBuffer.length/2;return this._vertexDictionary.set(E,A),this._vertexBuffer.push(p,v),A}_subdivideTrianglesScanline(r){if(this._granularity<2)return(function(v,E){const A=[];for(let I=0;I<E.length;I+=3){const z=E[I],F=E[I+1],$=E[I+2],X=v[2*z],te=v[2*z+1];(v[2*F]-X)*(v[2*$+1]-te)-(v[2*F+1]-te)*(v[2*$]-X)>0?(A.push(z),A.push($),A.push(F)):(A.push(z),A.push(F),A.push($))}return A})(this._vertexBuffer,r);const s=[],p=r.length;for(let v=0;v<p;v+=3){const E=[r[v+0],r[v+1],r[v+2]],A=[this._vertexBuffer[2*r[v+0]+0],this._vertexBuffer[2*r[v+0]+1],this._vertexBuffer[2*r[v+1]+0],this._vertexBuffer[2*r[v+1]+1],this._vertexBuffer[2*r[v+2]+0],this._vertexBuffer[2*r[v+2]+1]];let I=1/0,z=1/0,F=-1/0,$=-1/0;for(let oe=0;oe<3;oe++){const pe=A[2*oe],Te=A[2*oe+1];I=Math.min(I,pe),F=Math.max(F,pe),z=Math.min(z,Te),$=Math.max($,Te)}if(I===F||z===$)continue;const X=Math.floor(I/this._granularityCellSize),te=Math.ceil(F/this._granularityCellSize),ie=Math.floor(z/this._granularityCellSize),re=Math.ceil($/this._granularityCellSize);if(X!==te||ie!==re)for(let oe=ie;oe<re;oe++){const pe=this._scanlineGenerateVertexRingForCellRow(oe,A,E);cb(this._vertexBuffer,pe,s)}else s.push(...E)}return s}_scanlineGenerateVertexRingForCellRow(r,s,p){const v=r*this._granularityCellSize,E=v+this._granularityCellSize,A=[];for(let I=0;I<3;I++){const z=s[2*I],F=s[2*I+1],$=s[2*(I+1)%6],X=s[(2*(I+1)+1)%6],te=s[2*(I+2)%6],ie=s[(2*(I+2)+1)%6],re=$-z,oe=X-F,pe=re===0,Te=oe===0,We=(v-F)/oe,Le=(E-F)/oe,Fe=Math.min(We,Le),ot=Math.max(We,Le);if(!Te&&(Fe>=1||ot<=0)||Te&&(F<v||F>E)){X>=v&&X<=E&&A.push(p[(I+1)%3]);continue}!Te&&Fe>0&&A.push(this._vertexToIndex(z+re*Fe,F+oe*Fe));const gt=z+re*Math.max(Fe,0),Ct=z+re*Math.min(ot,1);pe||this._generateIntraEdgeVertices(A,z,F,$,X,gt,Ct),!Te&&ot<1&&A.push(this._vertexToIndex(z+re*ot,F+oe*ot)),(Te||X>=v&&X<=E)&&A.push(p[(I+1)%3]),!Te&&(X<=v||X>=E)&&this._generateInterEdgeVertices(A,z,F,$,X,te,ie,Ct,v,E)}return A}_generateIntraEdgeVertices(r,s,p,v,E,A,I){const z=v-s,F=E-p,$=F===0,X=$?Math.min(s,v):Math.min(A,I),te=$?Math.max(s,v):Math.max(A,I),ie=Math.floor(X/this._granularityCellSize)+1,re=Math.ceil(te/this._granularityCellSize)-1;if($?s<v:A<I)for(let oe=ie;oe<=re;oe++){const pe=oe*this._granularityCellSize;r.push(this._vertexToIndex(pe,p+F*(pe-s)/z))}else for(let oe=re;oe>=ie;oe--){const pe=oe*this._granularityCellSize;r.push(this._vertexToIndex(pe,p+F*(pe-s)/z))}}_generateInterEdgeVertices(r,s,p,v,E,A,I,z,F,$){const X=E-p,te=A-v,ie=I-E,re=(F-E)/ie,oe=($-E)/ie,pe=Math.min(re,oe),Te=Math.max(re,oe),We=v+te*pe;let Le=Math.floor(Math.min(We,z)/this._granularityCellSize)+1,Fe=Math.ceil(Math.max(We,z)/this._granularityCellSize)-1,ot=z<We;const gt=ie===0;if(gt&&(I===F||I===$))return;if(gt||pe>=1||Te<=0){const Gt=p-I,Ft=A+(s-A)*Math.min((F-I)/Gt,($-I)/Gt);Le=Math.floor(Math.min(Ft,z)/this._granularityCellSize)+1,Fe=Math.ceil(Math.max(Ft,z)/this._granularityCellSize)-1,ot=z<Ft}const Ct=X>0?$:F;if(ot)for(let Gt=Le;Gt<=Fe;Gt++)r.push(this._vertexToIndex(Gt*this._granularityCellSize,Ct));else for(let Gt=Fe;Gt>=Le;Gt--)r.push(this._vertexToIndex(Gt*this._granularityCellSize,Ct))}_generateOutline(r){const s=[];for(const p of r){const v=Jr(p,this._granularity,!0),E=this._pointArrayToIndices(v),A=[];for(let I=1;I<E.length;I++)A.push(E[I-1]),A.push(E[I]);s.push(A)}return s}_handlePoles(r){let s=!1,p=!1;this._canonical&&(this._canonical.y===0&&(s=!0),this._canonical.y===(1<<this._canonical.z)-1&&(p=!0)),(s||p)&&this._fillPoles(r,s,p)}_ensureNoPoleVertices(){const r=this._vertexBuffer;for(let s=0;s<r.length;s+=2){const p=r[s+1];p===wl&&(r[s+1]=-32767),p===Qr&&(r[s+1]=32766)}}_generatePoleQuad(r,s,p,v,E,A){v>E!=(A===wl)?(r.push(s),r.push(p),r.push(this._vertexToIndex(v,A)),r.push(p),r.push(this._vertexToIndex(E,A)),r.push(this._vertexToIndex(v,A))):(r.push(p),r.push(s),r.push(this._vertexToIndex(v,A)),r.push(this._vertexToIndex(E,A)),r.push(p),r.push(this._vertexToIndex(v,A)))}_fillPoles(r,s,p){const v=this._vertexBuffer,E=zt,A=r.length;for(let I=2;I<A;I+=3){const z=r[I-2],F=r[I-1],$=r[I],X=v[2*z],te=v[2*z+1],ie=v[2*F],re=v[2*F+1],oe=v[2*$],pe=v[2*$+1];s&&(te===0&&re===0&&this._generatePoleQuad(r,z,F,X,ie,wl),re===0&&pe===0&&this._generatePoleQuad(r,F,$,ie,oe,wl),pe===0&&te===0&&this._generatePoleQuad(r,$,z,oe,X,wl)),p&&(te===E&&re===E&&this._generatePoleQuad(r,z,F,X,ie,Qr),re===E&&pe===E&&this._generatePoleQuad(r,F,$,ie,oe,Qr),pe===E&&te===E&&this._generatePoleQuad(r,$,z,oe,X,Qr))}}_initializeVertices(r){for(let s=0;s<r.length;s+=2)this._vertexToIndex(r[s],r[s+1])}subdividePolygonInternal(r,s){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:p,holeIndices:v}=(function(I){const z=[],F=[];for(const $ of I)if($.length!==0){$!==I[0]&&z.push(F.length/2);for(let X=0;X<$.length;X++)F.push($[X].x),F.push($[X].y)}return{flattened:F,holeIndices:z}})(r);let E;this._initializeVertices(p);try{const I=(function(F,$,X=2){const te=$&&$.length,ie=te?$[0]*X:F.length;let re=Pg(F,0,ie,X,!0);const oe=[];if(!re||re.next===re.prev)return oe;let pe,Te,We;if(te&&(re=(function(Le,Fe,ot,gt){const Ct=[];for(let Gt=0,Ft=Fe.length;Gt<Ft;Gt++){const Zt=Pg(Le,Fe[Gt]*gt,Gt<Ft-1?Fe[Gt+1]*gt:Le.length,gt,!1);Zt===Zt.next&&(Zt.steiner=!0),Ct.push(ub(Zt))}Ct.sort(Cy);for(let Gt=0;Gt<Ct.length;Gt++)ot=nm(Ct[Gt],ot);return ot})(F,$,re,X)),F.length>80*X){pe=F[0],Te=F[1];let Le=pe,Fe=Te;for(let ot=X;ot<ie;ot+=X){const gt=F[ot],Ct=F[ot+1];gt<pe&&(pe=gt),Ct<Te&&(Te=Ct),gt>Le&&(Le=gt),Ct>Fe&&(Fe=Ct)}We=Math.max(Le-pe,Fe-Te),We=We!==0?32767/We:0}return pd(re,oe,X,pe,Te,We,0),oe})(p,v),z=this._convertIndices(p,I);E=this._subdivideTrianglesScanline(z)}catch(I){console.error(I)}let A=[];return s&&(A=this._generateOutline(r)),this._ensureNoPoleVertices(),this._handlePoles(E),{verticesFlattened:this._vertexBuffer,indicesTriangles:E,indicesLineList:A}}_convertIndices(r,s){const p=[];for(let v=0;v<s.length;v++)p.push(this._vertexToIndex(r[2*s[v]],r[2*s[v]+1]));return p}_pointArrayToIndices(r){const s=[];for(let p=0;p<r.length;p++){const v=r[p];s.push(this._vertexToIndex(v.x,v.y))}return s}}function zg(l,r,s,p=!0){return new Dg(s,r).subdividePolygonInternal(l,p)}function Jr(l,r,s=!1){if(!l||l.length<1)return[];if(l.length<2)return[];const p=l[0],v=l[l.length-1],E=s&&(p.x!==v.x||p.y!==v.y);if(r<2)return E?[...l,l[0]]:[...l];const A=Math.floor(zt/r),I=[];I.push(new M(l[0].x,l[0].y));const z=l.length,F=E?z:z-1;for(let $=0;$<F;$++){const X=l[$],te=$<z-1?l[$+1]:l[0],ie=X.x,re=X.y,oe=te.x,pe=te.y,Te=ie!==oe,We=re!==pe;if(!Te&&!We)continue;const Le=oe-ie,Fe=pe-re,ot=Math.abs(Le),gt=Math.abs(Fe);let Ct=ie,Gt=re;for(;;){const Zt=Le>0?(Math.floor(Ct/A)+1)*A:(Math.ceil(Ct/A)-1)*A,dn=Fe>0?(Math.floor(Gt/A)+1)*A:(Math.ceil(Gt/A)-1)*A,qt=Math.abs(Ct-Zt),Ut=Math.abs(Gt-dn),St=Math.abs(Ct-oe),Sn=Math.abs(Gt-pe),Pn=Te?qt/ot:Number.POSITIVE_INFINITY,mn=We?Ut/gt:Number.POSITIVE_INFINITY;if((St<=qt||!Te)&&(Sn<=Ut||!We))break;if(Pn<mn&&Te||!We){Ct=Zt,Gt+=Fe*Pn;const un=new M(Ct,Math.round(Gt));I[I.length-1].x===un.x&&I[I.length-1].y===un.y||I.push(un)}else{Ct+=Le*mn,Gt=dn;const un=new M(Math.round(Ct),Gt);I[I.length-1].x===un.x&&I[I.length-1].y===un.y||I.push(un)}}const Ft=new M(oe,pe);I[I.length-1].x===Ft.x&&I[I.length-1].y===Ft.y||I.push(Ft)}return I}function cb(l,r,s){if(r.length===0)throw new Error("Subdivision vertex ring is empty.");let p=0,v=l[2*r[0]];for(let z=1;z<r.length;z++){const F=l[2*r[z]];F<v&&(v=F,p=z)}const E=r.length;let A=p,I=(A+1)%E;for(;;){const z=A-1>=0?A-1:E-1,F=(I+1)%E,$=l[2*r[z]],X=l[2*r[F]],te=l[2*r[A]],ie=l[2*r[A]+1],re=l[2*r[I]+1];let oe=!1;if($<X)oe=!0;else if($>X)oe=!1;else{const pe=re-ie,Te=-(l[2*r[I]]-te),We=ie<re?1:-1;(($-te)*pe+(l[2*r[z]+1]-ie)*Te)*We>((X-te)*pe+(l[2*r[F]+1]-ie)*Te)*We&&(oe=!0)}if(oe){const pe=r[z],Te=r[A],We=r[I];pe!==Te&&pe!==We&&Te!==We&&s.push(We,Te,pe),A--,A<0&&(A=E-1)}else{const pe=r[F],Te=r[A],We=r[I];pe!==Te&&pe!==We&&Te!==We&&s.push(We,Te,pe),I++,I>=E&&(I=0)}if(z===F)break}}function Og(l,r,s,p,v,E,A,I,z){const F=v.length/2,$=A&&I&&z;if(F<Un.MAX_VERTEX_ARRAY_LENGTH){const X=r.prepareSegment(F,s,p),te=X.vertexLength;for(let oe=0;oe<E.length;oe+=3)p.emplaceBack(te+E[oe],te+E[oe+1],te+E[oe+2]);let ie,re;X.vertexLength+=F,X.primitiveLength+=E.length/3,$&&(re=A.prepareSegment(F,s,I),ie=re.vertexLength,re.vertexLength+=F);for(let oe=0;oe<v.length;oe+=2)l(v[oe],v[oe+1]);if($)for(let oe=0;oe<z.length;oe++){const pe=z[oe];for(let Te=1;Te<pe.length;Te+=2)I.emplaceBack(ie+pe[Te-1],ie+pe[Te]);re.primitiveLength+=pe.length/2}}else(function(X,te,ie,re,oe,pe){const Te=[];for(let gt=0;gt<re.length/2;gt++)Te.push(-1);const We={count:0};let Le=0,Fe=X.getOrCreateLatestSegment(te,ie),ot=Fe.vertexLength;for(let gt=2;gt<oe.length;gt+=3){const Ct=oe[gt-2],Gt=oe[gt-1],Ft=oe[gt];let Zt=Te[Ct]<Le,dn=Te[Gt]<Le,qt=Te[Ft]<Le;Fe.vertexLength+((Zt?1:0)+(dn?1:0)+(qt?1:0))>Un.MAX_VERTEX_ARRAY_LENGTH&&(Fe=X.createNewSegment(te,ie),Le=We.count,Zt=!0,dn=!0,qt=!0,ot=0);const Ut=Yd(Te,re,pe,We,Ct,Zt,Fe),St=Yd(Te,re,pe,We,Gt,dn,Fe),Sn=Yd(Te,re,pe,We,Ft,qt,Fe);ie.emplaceBack(ot+Ut-Le,ot+St-Le,ot+Sn-Le),Fe.primitiveLength++}})(r,s,p,v,E,l),$&&(function(X,te,ie,re,oe,pe){const Te=[];for(let gt=0;gt<re.length/2;gt++)Te.push(-1);const We={count:0};let Le=0,Fe=X.getOrCreateLatestSegment(te,ie),ot=Fe.vertexLength;for(let gt=0;gt<oe.length;gt++){const Ct=oe[gt];for(let Gt=1;Gt<oe[gt].length;Gt+=2){const Ft=Ct[Gt-1],Zt=Ct[Gt];let dn=Te[Ft]<Le,qt=Te[Zt]<Le;Fe.vertexLength+((dn?1:0)+(qt?1:0))>Un.MAX_VERTEX_ARRAY_LENGTH&&(Fe=X.createNewSegment(te,ie),Le=We.count,dn=!0,qt=!0,ot=0);const Ut=Yd(Te,re,pe,We,Ft,dn,Fe),St=Yd(Te,re,pe,We,Zt,qt,Fe);ie.emplaceBack(ot+Ut-Le,ot+St-Le),Fe.primitiveLength++}}})(A,s,I,v,z,l),r.forceNewSegmentOnNextPrepare(),A==null||A.forceNewSegmentOnNextPrepare()}function Yd(l,r,s,p,v,E,A){if(E){const I=p.count;return s(r[2*v],r[2*v+1]),l[v]=p.count,p.count++,A.vertexLength++,I}return l[v]}class Vr{constructor(r){this.zoom=r.zoom,this.globalState=r.globalState,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map((s=>s.id)),this.index=r.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ct,this.indexArray=new Wi,this.indexArray2=new ji,this.programConfigurations=new mo(r.layers,r.zoom),this.segments=new Un,this.segments2=new Un,this.stateDependentLayerIds=this.layers.filter((s=>s.isStateDependent())).map((s=>s.id))}populate(r,s,p){this.hasPattern=tm("fill",this.layers,s);const v=this.layers[0].layout.get("fill-sort-key"),E=!v.isConstant(),A=[];for(const{feature:I,id:z,index:F,sourceLayerIndex:$}of r){const X=this.layers[0]._featureFilter.needGeometry,te=xl(I,X);if(!this.layers[0]._featureFilter.filter(new ki(this.zoom,{globalState:this.globalState}),te,p))continue;const ie=E?v.evaluate(te,{},p,s.availableImages):void 0,re={id:z,properties:I.properties,type:I.type,sourceLayerIndex:$,index:F,geometry:X?te.geometry:su(I),patterns:{},sortKey:ie};A.push(re)}E&&A.sort(((I,z)=>I.sortKey-z.sortKey));for(const I of A){const{geometry:z,index:F,sourceLayerIndex:$}=I;if(this.hasPattern){const X=qf("fill",this.layers,I,this.zoom,s);this.patternFeatures.push(X)}else this.addFeature(I,z,F,p,{},s.subdivisionGranularity);s.featureIndex.insert(r[F].feature,z,F,$,this.index)}}update(r,s,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,s,this.stateDependentLayers,p)}addFeatures(r,s,p){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,s,p,r.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,Ig),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.indexBuffer2=r.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(r,s,p,v,E,A){for(const I of Xu(s,500)){const z=zg(I,v,A.fill.getGranularityForZoomLevel(v.z)),F=this.layoutVertexArray;Og((($,X)=>{F.emplaceBack($,X)}),this.segments,this.layoutVertexArray,this.indexArray,z.verticesFlattened,z.indicesTriangles,this.segments2,this.indexArray2,z.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,p,E,v)}}let Zo,_c;Yt("FillBucket",Vr,{omit:["layers","patternFeatures"]});var Iy={get paint(){return _c=_c||new As({"fill-antialias":new an($e.paint_fill["fill-antialias"]),"fill-opacity":new Tn($e.paint_fill["fill-opacity"]),"fill-color":new Tn($e.paint_fill["fill-color"]),"fill-outline-color":new Tn($e.paint_fill["fill-outline-color"]),"fill-translate":new an($e.paint_fill["fill-translate"]),"fill-translate-anchor":new an($e.paint_fill["fill-translate-anchor"]),"fill-pattern":new od($e.paint_fill["fill-pattern"])})},get layout(){return Zo=Zo||new As({"fill-sort-key":new Tn($e.layout_fill["fill-sort-key"])})}};class Py extends fo{constructor(r){super(r,Iy)}recalculate(r,s){super.recalculate(r,s);const p=this.paint._values["fill-outline-color"];p.value.kind==="constant"&&p.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(r){return new Vr(r)}queryRadius(){return Uf(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:r,geometry:s,transform:p,pixelsToTileUnits:v}){return mg(Hd(r,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-p.bearingInRadians,v),s)}isTileClipped(){return!0}}const Ry=Nr([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),hb=Nr([{name:"a_centroid",components:2,type:"Int16"}],4),{members:rm}=Ry;class os{constructor(r,s,p,v,E){this.properties={},this.extent=p,this.type=0,this.id=void 0,this._pbf=r,this._geometry=-1,this._keys=v,this._values=E,r.readFields(Pu,this,s)}loadGeometry(){const r=this._pbf;r.pos=this._geometry;const s=r.readVarint()+r.pos,p=[];let v,E=1,A=0,I=0,z=0;for(;r.pos<s;){if(A<=0){const F=r.readVarint();E=7&F,A=F>>3}if(A--,E===1||E===2)I+=r.readSVarint(),z+=r.readSVarint(),E===1&&(v&&p.push(v),v=[]),v&&v.push(new M(I,z));else{if(E!==7)throw new Error(`unknown command ${E}`);v&&v.push(v[0].clone())}}return v&&p.push(v),p}bbox(){const r=this._pbf;r.pos=this._geometry;const s=r.readVarint()+r.pos;let p=1,v=0,E=0,A=0,I=1/0,z=-1/0,F=1/0,$=-1/0;for(;r.pos<s;){if(v<=0){const X=r.readVarint();p=7&X,v=X>>3}if(v--,p===1||p===2)E+=r.readSVarint(),A+=r.readSVarint(),E<I&&(I=E),E>z&&(z=E),A<F&&(F=A),A>$&&($=A);else if(p!==7)throw new Error(`unknown command ${p}`)}return[I,F,z,$]}toGeoJSON(r,s,p){const v=this.extent*Math.pow(2,p),E=this.extent*r,A=this.extent*s,I=this.loadGeometry();function z(te){return[360*(te.x+E)/v-180,360/Math.PI*Math.atan(Math.exp((1-2*(te.y+A)/v)*Math.PI))-90]}function F(te){return te.map(z)}let $;if(this.type===1){const te=[];for(const re of I)te.push(re[0]);const ie=F(te);$=te.length===1?{type:"Point",coordinates:ie[0]}:{type:"MultiPoint",coordinates:ie}}else if(this.type===2){const te=I.map(F);$=te.length===1?{type:"LineString",coordinates:te[0]}:{type:"MultiLineString",coordinates:te}}else{if(this.type!==3)throw new Error("unknown feature type");{const te=(function(re){const oe=re.length;if(oe<=1)return[re];const pe=[];let Te,We;for(let Le=0;Le<oe;Le++){const Fe=Ly(re[Le]);Fe!==0&&(We===void 0&&(We=Fe<0),We===Fe<0?(Te&&pe.push(Te),Te=[re[Le]]):Te&&Te.push(re[Le]))}return Te&&pe.push(Te),pe})(I),ie=[];for(const re of te)ie.push(re.map(F));$=ie.length===1?{type:"Polygon",coordinates:ie[0]}:{type:"MultiPolygon",coordinates:ie}}}const X={type:"Feature",geometry:$,properties:this.properties};return this.id!=null&&(X.id=this.id),X}}function Pu(l,r,s){l===1?r.id=s.readVarint():l===2?(function(p,v){const E=p.readVarint()+p.pos;for(;p.pos<E;){const A=v._keys[p.readVarint()],I=v._values[p.readVarint()];v.properties[A]=I}})(s,r):l===3?r.type=s.readVarint():l===4&&(r._geometry=s.pos)}function Ly(l){let r=0;for(let s,p,v=0,E=l.length,A=E-1;v<E;A=v++)s=l[v],p=l[A],r+=(p.x-s.x)*(s.y+p.y);return r}os.types=["Unknown","Point","LineString","Polygon"];class Ho{constructor(r,s){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=r,this._keys=[],this._values=[],this._features=[],r.readFields(ky,this,s),this.length=this._features.length}feature(r){if(r<0||r>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[r];const s=this._pbf.readVarint()+this._pbf.pos;return new os(this._pbf,s,this.extent,this._keys,this._values)}}function ky(l,r,s){l===15?r.version=s.readVarint():l===1?r.name=s.readString():l===5?r.extent=s.readVarint():l===2?r._features.push(s.pos):l===3?r._keys.push(s.readString()):l===4&&r._values.push((function(p){let v=null;const E=p.readVarint()+p.pos;for(;p.pos<E;){const A=p.readVarint()>>3;v=A===1?p.readString():A===2?p.readFloat():A===3?p.readDouble():A===4?p.readVarint64():A===5?p.readVarint():A===6?p.readSVarint():A===7?p.readBoolean():null}if(v==null)throw new Error("unknown feature value");return v})(s))}class yc{constructor(r,s){this.layers=r.readFields(_d,{},s)}}function _d(l,r,s){if(l===3){const p=new Ho(s,s.readVarint()+s.pos);p.length&&(r[p.name]=p)}}const Ru=Math.pow(2,13);function yd(l,r,s,p,v,E,A,I){l.emplaceBack(r,s,2*Math.floor(p*Ru)+A,v*Ru*2,E*Ru*2,Math.round(I))}class Wf{constructor(r){this.zoom=r.zoom,this.globalState=r.globalState,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map((s=>s.id)),this.index=r.index,this.hasPattern=!1,this.layoutVertexArray=new rt,this.centroidVertexArray=new Me,this.indexArray=new Wi,this.programConfigurations=new mo(r.layers,r.zoom),this.segments=new Un,this.stateDependentLayerIds=this.layers.filter((s=>s.isStateDependent())).map((s=>s.id))}populate(r,s,p){this.features=[],this.hasPattern=tm("fill-extrusion",this.layers,s);for(const{feature:v,id:E,index:A,sourceLayerIndex:I}of r){const z=this.layers[0]._featureFilter.needGeometry,F=xl(v,z);if(!this.layers[0]._featureFilter.filter(new ki(this.zoom,{globalState:this.globalState}),F,p))continue;const $={id:E,sourceLayerIndex:I,index:A,geometry:z?F.geometry:su(v),properties:v.properties,type:v.type,patterns:{}};this.hasPattern?this.features.push(qf("fill-extrusion",this.layers,$,this.zoom,s)):this.addFeature($,$.geometry,A,p,{},s.subdivisionGranularity),s.featureIndex.insert(v,$.geometry,A,I,this.index,!0)}}addFeatures(r,s,p){for(const v of this.features){const{geometry:E}=v;this.addFeature(v,E,v.index,s,p,r.subdivisionGranularity)}}update(r,s,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,s,this.stateDependentLayers,p)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,rm),this.centroidVertexBuffer=r.createVertexBuffer(this.centroidVertexArray,hb.members,!0),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(r,s,p,v,E,A){for(const I of Xu(s,500)){const z={x:0,y:0,sampleCount:0},F=this.layoutVertexArray.length;this.processPolygon(z,v,r,I,A);const $=this.layoutVertexArray.length-F,X=Math.floor(z.x/z.sampleCount),te=Math.floor(z.y/z.sampleCount);for(let ie=0;ie<$;ie++)this.centroidVertexArray.emplaceBack(X,te)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,p,E,v)}processPolygon(r,s,p,v,E){if(v.length<1||vd(v[0]))return;for(const X of v)X.length!==0&&Lu(r,X);const A={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},I=E.fill.getGranularityForZoomLevel(s.z),z=os.types[p.type]==="Polygon";for(const X of v){if(X.length===0||vd(X))continue;const te=Jr(X,I,z);this._generateSideFaces(te,A)}if(!z)return;const F=zg(v,s,I,!1),$=this.layoutVertexArray;Og(((X,te)=>{yd($,X,te,0,0,1,1,0)}),this.segments,this.layoutVertexArray,this.indexArray,F.verticesFlattened,F.indicesTriangles)}_generateSideFaces(r,s){let p=0;for(let v=1;v<r.length;v++){const E=r[v],A=r[v-1];if(Dy(E,A))continue;s.segment.vertexLength+4>Un.MAX_VERTEX_ARRAY_LENGTH&&(s.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const I=E.sub(A)._perp()._unit(),z=A.dist(E);p+z>32768&&(p=0),yd(this.layoutVertexArray,E.x,E.y,I.x,I.y,0,0,p),yd(this.layoutVertexArray,E.x,E.y,I.x,I.y,0,1,p),p+=z,yd(this.layoutVertexArray,A.x,A.y,I.x,I.y,0,0,p),yd(this.layoutVertexArray,A.x,A.y,I.x,I.y,0,1,p);const F=s.segment.vertexLength;this.indexArray.emplaceBack(F,F+2,F+1),this.indexArray.emplaceBack(F+1,F+2,F+3),s.segment.vertexLength+=4,s.segment.primitiveLength+=2}}}function Lu(l,r){for(let s=0;s<r.length;s++){const p=r[s];s===r.length-1&&r[0].x===p.x&&r[0].y===p.y||(l.x+=p.x,l.y+=p.y,l.sampleCount++)}}function Dy(l,r){return l.x===r.x&&(l.x<0||l.x>zt)||l.y===r.y&&(l.y<0||l.y>zt)}function vd(l){return l.every((r=>r.x<0))||l.every((r=>r.x>zt))||l.every((r=>r.y<0))||l.every((r=>r.y>zt))}let Qd;Yt("FillExtrusionBucket",Wf,{omit:["layers","features"]});var Kf={get paint(){return Qd=Qd||new As({"fill-extrusion-opacity":new an($e["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Tn($e["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new an($e["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new an($e["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new od($e["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Tn($e["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Tn($e["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new an($e["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Jd extends fo{constructor(r){super(r,Kf)}createBucket(r){return new Wf(r)}queryRadius(){return Uf(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:r,feature:s,featureState:p,geometry:v,transform:E,pixelsToTileUnits:A,pixelPosMatrix:I}){const z=Hd(r,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-E.bearingInRadians,A),F=this.paint.get("fill-extrusion-height").evaluate(s,p),$=this.paint.get("fill-extrusion-base").evaluate(s,p),X=(function(ie,re){const oe=[];for(const pe of ie){const Te=[pe.x,pe.y,0,1];In(Te,Te,re),oe.push(new M(Te[0]/Te[3],Te[1]/Te[3]))}return oe})(z,I),te=(function(ie,re,oe,pe){const Te=[],We=[],Le=pe[8]*re,Fe=pe[9]*re,ot=pe[10]*re,gt=pe[11]*re,Ct=pe[8]*oe,Gt=pe[9]*oe,Ft=pe[10]*oe,Zt=pe[11]*oe;for(const dn of ie){const qt=[],Ut=[];for(const St of dn){const Sn=St.x,Pn=St.y,mn=pe[0]*Sn+pe[4]*Pn+pe[12],un=pe[1]*Sn+pe[5]*Pn+pe[13],Qn=pe[2]*Sn+pe[6]*Pn+pe[14],Kr=pe[3]*Sn+pe[7]*Pn+pe[15],ya=Qn+ot,us=Kr+gt,El=mn+Ct,yo=un+Gt,Da=Qn+Ft,Rr=Kr+Zt,za=new M((mn+Le)/us,(un+Fe)/us);za.z=ya/us,qt.push(za);const va=new M(El/Rr,yo/Rr);va.z=Da/Rr,Ut.push(va)}Te.push(qt),We.push(Ut)}return[Te,We]})(v,$,F,I);return(function(ie,re,oe){let pe=1/0;mg(oe,re)&&(pe=Ng(oe,re[0]));for(let Te=0;Te<re.length;Te++){const We=re[Te],Le=ie[Te];for(let Fe=0;Fe<We.length-1;Fe++){const ot=We[Fe],gt=[ot,We[Fe+1],Le[Fe+1],Le[Fe],ot];fg(oe,gt)&&(pe=Math.min(pe,Ng(oe,gt)))}}return pe!==1/0&&pe})(te[0],te[1],X)}}function ef(l,r){return l.x*r.x+l.y*r.y}function Ng(l,r){if(l.length===1){let s=0;const p=r[s++];let v;for(;!v||p.equals(v);)if(v=r[s++],!v)return 1/0;for(;s<r.length;s++){const E=r[s],A=l[0],I=v.sub(p),z=E.sub(p),F=A.sub(p),$=ef(I,I),X=ef(I,z),te=ef(z,z),ie=ef(F,I),re=ef(F,z),oe=$*te-X*X,pe=(te*ie-X*re)/oe,Te=($*re-X*ie)/oe,We=p.z*(1-pe-Te)+v.z*pe+E.z*Te;if(isFinite(We))return We}return 1/0}{let s=1/0;for(const p of r)s=Math.min(s,p.z);return s}}const Yf=Nr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:zy}=Yf,am=Nr([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Oy}=am,db=Math.cos(Math.PI/180*37.5),Ny=Math.pow(2,14)/.5;class Ui{constructor(r){this.zoom=r.zoom,this.globalState=r.globalState,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map((s=>s.id)),this.index=r.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((s=>{this.gradients[s.id]={}})),this.layoutVertexArray=new st,this.layoutVertexArray2=new lt,this.indexArray=new Wi,this.programConfigurations=new mo(r.layers,r.zoom),this.segments=new Un,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((s=>s.isStateDependent())).map((s=>s.id))}populate(r,s,p){this.hasPattern=tm("line",this.layers,s);const v=this.layers[0].layout.get("line-sort-key"),E=!v.isConstant(),A=[];for(const{feature:I,id:z,index:F,sourceLayerIndex:$}of r){const X=this.layers[0]._featureFilter.needGeometry,te=xl(I,X);if(!this.layers[0]._featureFilter.filter(new ki(this.zoom,{globalState:this.globalState}),te,p))continue;const ie=E?v.evaluate(te,{},p):void 0,re={id:z,properties:I.properties,type:I.type,sourceLayerIndex:$,index:F,geometry:X?te.geometry:su(I),patterns:{},sortKey:ie};A.push(re)}E&&A.sort(((I,z)=>I.sortKey-z.sortKey));for(const I of A){const{geometry:z,index:F,sourceLayerIndex:$}=I;if(this.hasPattern){const X=qf("line",this.layers,I,this.zoom,s);this.patternFeatures.push(X)}else this.addFeature(I,z,F,p,{},s.subdivisionGranularity);s.featureIndex.insert(r[F].feature,z,F,$,this.index)}}update(r,s,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,s,this.stateDependentLayers,p)}addFeatures(r,s,p){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,s,p,r.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=r.createVertexBuffer(this.layoutVertexArray2,Oy)),this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,zy),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(r){if(r.properties&&Object.prototype.hasOwnProperty.call(r.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(r.properties,"mapbox_clip_end"))return{start:+r.properties.mapbox_clip_start,end:+r.properties.mapbox_clip_end}}addFeature(r,s,p,v,E,A){const I=this.layers[0].layout,z=I.get("line-join").evaluate(r,{}),F=I.get("line-cap"),$=I.get("line-miter-limit"),X=I.get("line-round-limit");this.lineClips=this.lineFeatureClips(r);for(const te of s)this.addLine(te,r,z,F,$,X,v,A);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,p,E,v)}addLine(r,s,p,v,E,A,I,z){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,r=Jr(r,I?z.line.getGranularityForZoomLevel(I.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Le=0;Le<r.length-1;Le++)this.totalDistance+=r[Le].dist(r[Le+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const F=os.types[s.type]==="Polygon";let $=r.length;for(;$>=2&&r[$-1].equals(r[$-2]);)$--;let X=0;for(;X<$-1&&r[X].equals(r[X+1]);)X++;if($<(F?3:2))return;p==="bevel"&&(E=1.05);const te=this.overscaling<=16?122880/(512*this.overscaling):0,ie=this.segments.prepareSegment(10*$,this.layoutVertexArray,this.indexArray);let re,oe,pe,Te,We;this.e1=this.e2=-1,F&&(re=r[$-2],We=r[X].sub(re)._unit()._perp());for(let Le=X;Le<$;Le++){if(pe=Le===$-1?F?r[X+1]:void 0:r[Le+1],pe&&r[Le].equals(pe))continue;We&&(Te=We),re&&(oe=re),re=r[Le],We=pe?pe.sub(re)._unit()._perp():Te,Te=Te||We;let Fe=Te.add(We);Fe.x===0&&Fe.y===0||Fe._unit();const ot=Te.x*We.x+Te.y*We.y,gt=Fe.x*We.x+Fe.y*We.y,Ct=gt!==0?1/gt:1/0,Gt=2*Math.sqrt(2-2*gt),Ft=gt<db&&oe&&pe,Zt=Te.x*We.y-Te.y*We.x>0;if(Ft&&Le>X){const Ut=re.dist(oe);if(Ut>2*te){const St=re.sub(re.sub(oe)._mult(te/Ut)._round());this.updateDistance(oe,St),this.addCurrentVertex(St,Te,0,0,ie),oe=St}}const dn=oe&&pe;let qt=dn?p:F?"butt":v;if(dn&&qt==="round"&&(Ct<A?qt="miter":Ct<=2&&(qt="fakeround")),qt==="miter"&&Ct>E&&(qt="bevel"),qt==="bevel"&&(Ct>2&&(qt="flipbevel"),Ct<E&&(qt="miter")),oe&&this.updateDistance(oe,re),qt==="miter")Fe._mult(Ct),this.addCurrentVertex(re,Fe,0,0,ie);else if(qt==="flipbevel"){if(Ct>100)Fe=We.mult(-1);else{const Ut=Ct*Te.add(We).mag()/Te.sub(We).mag();Fe._perp()._mult(Ut*(Zt?-1:1))}this.addCurrentVertex(re,Fe,0,0,ie),this.addCurrentVertex(re,Fe.mult(-1),0,0,ie)}else if(qt==="bevel"||qt==="fakeround"){const Ut=-Math.sqrt(Ct*Ct-1),St=Zt?Ut:0,Sn=Zt?0:Ut;if(oe&&this.addCurrentVertex(re,Te,St,Sn,ie),qt==="fakeround"){const Pn=Math.round(180*Gt/Math.PI/20);for(let mn=1;mn<Pn;mn++){let un=mn/Pn;if(un!==.5){const Kr=un-.5;un+=un*Kr*(un-1)*((1.0904+ot*(ot*(3.55645-1.43519*ot)-3.2452))*Kr*Kr+(.848013+ot*(.215638*ot-1.06021)))}const Qn=We.sub(Te)._mult(un)._add(Te)._unit()._mult(Zt?-1:1);this.addHalfVertex(re,Qn.x,Qn.y,!1,Zt,0,ie)}}pe&&this.addCurrentVertex(re,We,-St,-Sn,ie)}else if(qt==="butt")this.addCurrentVertex(re,Fe,0,0,ie);else if(qt==="square"){const Ut=oe?1:-1;this.addCurrentVertex(re,Fe,Ut,Ut,ie)}else qt==="round"&&(oe&&(this.addCurrentVertex(re,Te,0,0,ie),this.addCurrentVertex(re,Te,1,1,ie,!0)),pe&&(this.addCurrentVertex(re,We,-1,-1,ie,!0),this.addCurrentVertex(re,We,0,0,ie)));if(Ft&&Le<$-1){const Ut=re.dist(pe);if(Ut>2*te){const St=re.add(pe.sub(re)._mult(te/Ut)._round());this.updateDistance(re,St),this.addCurrentVertex(St,We,0,0,ie),re=St}}}}addCurrentVertex(r,s,p,v,E,A=!1){const I=s.y*v-s.x,z=-s.y-s.x*v;this.addHalfVertex(r,s.x+s.y*p,s.y-s.x*p,A,!1,p,E),this.addHalfVertex(r,I,z,A,!0,-v,E),this.distance>Ny/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(r,s,p,v,E,A))}addHalfVertex({x:r,y:s},p,v,E,A,I,z){const F=.5*(this.lineClips?this.scaledDistance*(Ny-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((r<<1)+(E?1:0),(s<<1)+(A?1:0),Math.round(63*p)+128,Math.round(63*v)+128,1+(I===0?0:I<0?-1:1)|(63&F)<<2,F>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const $=z.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,$,this.e2),z.primitiveLength++),A?this.e2=$:this.e1=$}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(r,s){this.distance+=r.dist(s),this.updateScaledDistance()}}let Tr,gi;Yt("LineBucket",Ui,{omit:["layers","patternFeatures"]});var bi={get paint(){return gi=gi||new As({"line-opacity":new Tn($e.paint_line["line-opacity"]),"line-color":new Tn($e.paint_line["line-color"]),"line-translate":new an($e.paint_line["line-translate"]),"line-translate-anchor":new an($e.paint_line["line-translate-anchor"]),"line-width":new Tn($e.paint_line["line-width"]),"line-gap-width":new Tn($e.paint_line["line-gap-width"]),"line-offset":new Tn($e.paint_line["line-offset"]),"line-blur":new Tn($e.paint_line["line-blur"]),"line-dasharray":new jo($e.paint_line["line-dasharray"]),"line-pattern":new od($e.paint_line["line-pattern"]),"line-gradient":new $c($e.paint_line["line-gradient"])})},get layout(){return Tr=Tr||new As({"line-cap":new an($e.layout_line["line-cap"]),"line-join":new Tn($e.layout_line["line-join"]),"line-miter-limit":new an($e.layout_line["line-miter-limit"]),"line-round-limit":new an($e.layout_line["line-round-limit"]),"line-sort-key":new Tn($e.layout_line["line-sort-key"])})}};class mr extends Tn{possiblyEvaluate(r,s){return s=new ki(Math.floor(s.zoom),{now:s.now,fadeDuration:s.fadeDuration,zoomHistory:s.zoomHistory,transition:s.transition}),super.possiblyEvaluate(r,s)}evaluate(r,s,p,v){return s=si({},s,{zoom:Math.floor(s.zoom)}),super.evaluate(r,s,p,v)}}let go;class Ch extends fo{constructor(r){super(r,bi),this.gradientVersion=0,go||(go=new mr(bi.paint.properties["line-width"].specification),go.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(r){if(r==="line-gradient"){const s=this.gradientExpression();this.stepInterpolant=!!(function(p){return p._styleExpression!==void 0})(s)&&s._styleExpression.expression instanceof Hi,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(r,s){super.recalculate(r,s),this.paint._values["line-floorwidth"]=go.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,r)}createBucket(r){return new Ui(r)}queryRadius(r){const s=r,p=bd(Eh("line-width",this,s),Eh("line-gap-width",this,s)),v=Eh("line-offset",this,s);return p/2+Math.abs(v)+Uf(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:r,feature:s,featureState:p,geometry:v,transform:E,pixelsToTileUnits:A}){const I=Hd(r,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-E.bearingInRadians,A),z=A/2*bd(this.paint.get("line-width").evaluate(s,p),this.paint.get("line-gap-width").evaluate(s,p)),F=this.paint.get("line-offset").evaluate(s,p);return F&&(v=(function($,X){const te=[];for(let ie=0;ie<$.length;ie++){const re=$[ie],oe=[];for(let pe=0;pe<re.length;pe++){const Te=re[pe-1],We=re[pe],Le=re[pe+1],Fe=pe===0?new M(0,0):We.sub(Te)._unit()._perp(),ot=pe===re.length-1?new M(0,0):Le.sub(We)._unit()._perp(),gt=Fe._add(ot)._unit(),Ct=gt.x*ot.x+gt.y*ot.y;Ct!==0&&gt._mult(1/Ct),oe.push(gt._mult(X)._add(We))}te.push(oe)}return te})(v,F*A)),(function($,X,te){for(let ie=0;ie<X.length;ie++){const re=X[ie];if($.length>=3){for(let oe=0;oe<re.length;oe++)if(dd($,re[oe]))return!0}if(gg($,re,te))return!0}return!1})(I,v,z)}isTileClipped(){return!0}}function bd(l,r){return r>0?r+2*l:l}const Bg=Nr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Hc=Nr([{name:"a_projected_pos",components:3,type:"Float32"}],4);Nr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const _a=Nr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);Nr([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Xc=Nr([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),xd=Nr([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Fg(l,r,s){return l.sections.forEach((p=>{p.text=(function(v,E,A){const I=E.layout.get("text-transform").evaluate(A,{});return I==="uppercase"?v=v.toLocaleUpperCase():I==="lowercase"&&(v=v.toLocaleLowerCase()),_l.applyArabicShaping&&(v=_l.applyArabicShaping(v)),v})(p.text,r,s)})),l}Nr([{name:"triangle",components:3,type:"Uint16"}]),Nr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Nr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Nr([{type:"Float32",name:"offsetX"}]),Nr([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Nr([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const no={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var Wr=24;const wd=4294967296,Xo=1/wd,sm=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");class tf{constructor(r=new Uint8Array(16)){this.buf=ArrayBuffer.isView(r)?r:new Uint8Array(r),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(r,s,p=this.length){for(;this.pos<p;){const v=this.readVarint(),E=v>>3,A=this.pos;this.type=7&v,r(E,s,this),this.pos===A&&this.skip(v)}return s}readMessage(r,s){return this.readFields(r,s,this.readVarint()+this.pos)}readFixed32(){const r=this.dataView.getUint32(this.pos,!0);return this.pos+=4,r}readSFixed32(){const r=this.dataView.getInt32(this.pos,!0);return this.pos+=4,r}readFixed64(){const r=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*wd;return this.pos+=8,r}readSFixed64(){const r=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*wd;return this.pos+=8,r}readFloat(){const r=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,r}readDouble(){const r=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,r}readVarint(r){const s=this.buf;let p,v;return v=s[this.pos++],p=127&v,v<128?p:(v=s[this.pos++],p|=(127&v)<<7,v<128?p:(v=s[this.pos++],p|=(127&v)<<14,v<128?p:(v=s[this.pos++],p|=(127&v)<<21,v<128?p:(v=s[this.pos],p|=(15&v)<<28,(function(E,A,I){const z=I.buf;let F,$;if($=z[I.pos++],F=(112&$)>>4,$<128||($=z[I.pos++],F|=(127&$)<<3,$<128)||($=z[I.pos++],F|=(127&$)<<10,$<128)||($=z[I.pos++],F|=(127&$)<<17,$<128)||($=z[I.pos++],F|=(127&$)<<24,$<128)||($=z[I.pos++],F|=(1&$)<<31,$<128))return Td(E,F,A);throw new Error("Expected varint not more than 10 bytes")})(p,r,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const r=this.readVarint();return r%2==1?(r+1)/-2:r/2}readBoolean(){return!!this.readVarint()}readString(){const r=this.readVarint()+this.pos,s=this.pos;return this.pos=r,r-s>=12&&sm?sm.decode(this.buf.subarray(s,r)):(function(p,v,E){let A="",I=v;for(;I<E;){const z=p[I];let F,$,X,te=null,ie=z>239?4:z>223?3:z>191?2:1;if(I+ie>E)break;ie===1?z<128&&(te=z):ie===2?(F=p[I+1],(192&F)==128&&(te=(31&z)<<6|63&F,te<=127&&(te=null))):ie===3?(F=p[I+1],$=p[I+2],(192&F)==128&&(192&$)==128&&(te=(15&z)<<12|(63&F)<<6|63&$,(te<=2047||te>=55296&&te<=57343)&&(te=null))):ie===4&&(F=p[I+1],$=p[I+2],X=p[I+3],(192&F)==128&&(192&$)==128&&(192&X)==128&&(te=(15&z)<<18|(63&F)<<12|(63&$)<<6|63&X,(te<=65535||te>=1114112)&&(te=null))),te===null?(te=65533,ie=1):te>65535&&(te-=65536,A+=String.fromCharCode(te>>>10&1023|55296),te=56320|1023&te),A+=String.fromCharCode(te),I+=ie}return A})(this.buf,s,r)}readBytes(){const r=this.readVarint()+this.pos,s=this.buf.subarray(this.pos,r);return this.pos=r,s}readPackedVarint(r=[],s){const p=this.readPackedEnd();for(;this.pos<p;)r.push(this.readVarint(s));return r}readPackedSVarint(r=[]){const s=this.readPackedEnd();for(;this.pos<s;)r.push(this.readSVarint());return r}readPackedBoolean(r=[]){const s=this.readPackedEnd();for(;this.pos<s;)r.push(this.readBoolean());return r}readPackedFloat(r=[]){const s=this.readPackedEnd();for(;this.pos<s;)r.push(this.readFloat());return r}readPackedDouble(r=[]){const s=this.readPackedEnd();for(;this.pos<s;)r.push(this.readDouble());return r}readPackedFixed32(r=[]){const s=this.readPackedEnd();for(;this.pos<s;)r.push(this.readFixed32());return r}readPackedSFixed32(r=[]){const s=this.readPackedEnd();for(;this.pos<s;)r.push(this.readSFixed32());return r}readPackedFixed64(r=[]){const s=this.readPackedEnd();for(;this.pos<s;)r.push(this.readFixed64());return r}readPackedSFixed64(r=[]){const s=this.readPackedEnd();for(;this.pos<s;)r.push(this.readSFixed64());return r}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(r){const s=7&r;if(s===0)for(;this.buf[this.pos++]>127;);else if(s===2)this.pos=this.readVarint()+this.pos;else if(s===5)this.pos+=4;else{if(s!==1)throw new Error(`Unimplemented type: ${s}`);this.pos+=8}}writeTag(r,s){this.writeVarint(r<<3|s)}realloc(r){let s=this.length||16;for(;s<this.pos+r;)s*=2;if(s!==this.length){const p=new Uint8Array(s);p.set(this.buf),this.buf=p,this.dataView=new DataView(p.buffer),this.length=s}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(r){this.realloc(4),this.dataView.setInt32(this.pos,r,!0),this.pos+=4}writeSFixed32(r){this.realloc(4),this.dataView.setInt32(this.pos,r,!0),this.pos+=4}writeFixed64(r){this.realloc(8),this.dataView.setInt32(this.pos,-1&r,!0),this.dataView.setInt32(this.pos+4,Math.floor(r*Xo),!0),this.pos+=8}writeSFixed64(r){this.realloc(8),this.dataView.setInt32(this.pos,-1&r,!0),this.dataView.setInt32(this.pos+4,Math.floor(r*Xo),!0),this.pos+=8}writeVarint(r){(r=+r||0)>268435455||r<0?(function(s,p){let v,E;if(s>=0?(v=s%4294967296|0,E=s/4294967296|0):(v=~(-s%4294967296),E=~(-s/4294967296),4294967295^v?v=v+1|0:(v=0,E=E+1|0)),s>=18446744073709552e3||s<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");p.realloc(10),(function(A,I,z){z.buf[z.pos++]=127&A|128,A>>>=7,z.buf[z.pos++]=127&A|128,A>>>=7,z.buf[z.pos++]=127&A|128,A>>>=7,z.buf[z.pos++]=127&A|128,z.buf[z.pos]=127&(A>>>=7)})(v,0,p),(function(A,I){const z=(7&A)<<4;I.buf[I.pos++]|=z|((A>>>=3)?128:0),A&&(I.buf[I.pos++]=127&A|((A>>>=7)?128:0),A&&(I.buf[I.pos++]=127&A|((A>>>=7)?128:0),A&&(I.buf[I.pos++]=127&A|((A>>>=7)?128:0),A&&(I.buf[I.pos++]=127&A|((A>>>=7)?128:0),A&&(I.buf[I.pos++]=127&A)))))})(E,p)})(r,this):(this.realloc(4),this.buf[this.pos++]=127&r|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=r>>>7&127))))}writeSVarint(r){this.writeVarint(r<0?2*-r-1:2*r)}writeBoolean(r){this.writeVarint(+r)}writeString(r){r=String(r),this.realloc(4*r.length),this.pos++;const s=this.pos;this.pos=(function(v,E,A){for(let I,z,F=0;F<E.length;F++){if(I=E.charCodeAt(F),I>55295&&I<57344){if(!z){I>56319||F+1===E.length?(v[A++]=239,v[A++]=191,v[A++]=189):z=I;continue}if(I<56320){v[A++]=239,v[A++]=191,v[A++]=189,z=I;continue}I=z-55296<<10|I-56320|65536,z=null}else z&&(v[A++]=239,v[A++]=191,v[A++]=189,z=null);I<128?v[A++]=I:(I<2048?v[A++]=I>>6|192:(I<65536?v[A++]=I>>12|224:(v[A++]=I>>18|240,v[A++]=I>>12&63|128),v[A++]=I>>6&63|128),v[A++]=63&I|128)}return A})(this.buf,r,this.pos);const p=this.pos-s;p>=128&&Qf(s,p,this),this.pos=s-1,this.writeVarint(p),this.pos+=p}writeFloat(r){this.realloc(4),this.dataView.setFloat32(this.pos,r,!0),this.pos+=4}writeDouble(r){this.realloc(8),this.dataView.setFloat64(this.pos,r,!0),this.pos+=8}writeBytes(r){const s=r.length;this.writeVarint(s),this.realloc(s);for(let p=0;p<s;p++)this.buf[this.pos++]=r[p]}writeRawMessage(r,s){this.pos++;const p=this.pos;r(s,this);const v=this.pos-p;v>=128&&Qf(p,v,this),this.pos=p-1,this.writeVarint(v),this.pos+=v}writeMessage(r,s,p){this.writeTag(r,2),this.writeRawMessage(s,p)}writePackedVarint(r,s){s.length&&this.writeMessage(r,om,s)}writePackedSVarint(r,s){s.length&&this.writeMessage(r,Mh,s)}writePackedBoolean(r,s){s.length&&this.writeMessage(r,nf,s)}writePackedFloat(r,s){s.length&&this.writeMessage(r,ls,s)}writePackedDouble(r,s){s.length&&this.writeMessage(r,Ih,s)}writePackedFixed32(r,s){s.length&&this.writeMessage(r,Wc,s)}writePackedSFixed32(r,s){s.length&&this.writeMessage(r,Vg,s)}writePackedFixed64(r,s){s.length&&this.writeMessage(r,jg,s)}writePackedSFixed64(r,s){s.length&&this.writeMessage(r,By,s)}writeBytesField(r,s){this.writeTag(r,2),this.writeBytes(s)}writeFixed32Field(r,s){this.writeTag(r,5),this.writeFixed32(s)}writeSFixed32Field(r,s){this.writeTag(r,5),this.writeSFixed32(s)}writeFixed64Field(r,s){this.writeTag(r,1),this.writeFixed64(s)}writeSFixed64Field(r,s){this.writeTag(r,1),this.writeSFixed64(s)}writeVarintField(r,s){this.writeTag(r,0),this.writeVarint(s)}writeSVarintField(r,s){this.writeTag(r,0),this.writeSVarint(s)}writeStringField(r,s){this.writeTag(r,2),this.writeString(s)}writeFloatField(r,s){this.writeTag(r,5),this.writeFloat(s)}writeDoubleField(r,s){this.writeTag(r,1),this.writeDouble(s)}writeBooleanField(r,s){this.writeVarintField(r,+s)}}function Td(l,r,s){return s?4294967296*r+(l>>>0):4294967296*(r>>>0)+(l>>>0)}function Qf(l,r,s){const p=r<=16383?1:r<=2097151?2:r<=268435455?3:Math.floor(Math.log(r)/(7*Math.LN2));s.realloc(p);for(let v=s.pos-1;v>=l;v--)s.buf[v+p]=s.buf[v]}function om(l,r){for(let s=0;s<l.length;s++)r.writeVarint(l[s])}function Mh(l,r){for(let s=0;s<l.length;s++)r.writeSVarint(l[s])}function ls(l,r){for(let s=0;s<l.length;s++)r.writeFloat(l[s])}function Ih(l,r){for(let s=0;s<l.length;s++)r.writeDouble(l[s])}function nf(l,r){for(let s=0;s<l.length;s++)r.writeBoolean(l[s])}function Wc(l,r){for(let s=0;s<l.length;s++)r.writeFixed32(l[s])}function Vg(l,r){for(let s=0;s<l.length;s++)r.writeSFixed32(l[s])}function jg(l,r){for(let s=0;s<l.length;s++)r.writeFixed64(l[s])}function By(l,r){for(let s=0;s<l.length;s++)r.writeSFixed64(l[s])}function Jf(l,r,s){l===1&&s.readMessage(Ug,r)}function Ug(l,r,s){if(l===3){const{id:p,bitmap:v,width:E,height:A,left:I,top:z,advance:F}=s.readMessage(Fl,{});r.push({id:p,bitmap:new Xd({width:E+6,height:A+6},v),metrics:{width:E,height:A,left:I,top:z,advance:F}})}}function Fl(l,r,s){l===1?r.id=s.readVarint():l===2?r.bitmap=s.readBytes():l===3?r.width=s.readVarint():l===4?r.height=s.readVarint():l===5?r.left=s.readSVarint():l===6?r.top=s.readSVarint():l===7&&(r.advance=s.readVarint())}function $g(l){let r=0,s=0;for(const A of l)r+=A.w*A.h,s=Math.max(s,A.w);l.sort(((A,I)=>I.h-A.h));const p=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(r/.95)),s),h:1/0}];let v=0,E=0;for(const A of l)for(let I=p.length-1;I>=0;I--){const z=p[I];if(!(A.w>z.w||A.h>z.h)){if(A.x=z.x,A.y=z.y,E=Math.max(E,A.y+A.h),v=Math.max(v,A.x+A.w),A.w===z.w&&A.h===z.h){const F=p.pop();F&&I<p.length&&(p[I]=F)}else A.h===z.h?(z.x+=A.w,z.w-=A.w):A.w===z.w?(z.y+=A.h,z.h-=A.h):(p.push({x:z.x+A.w,y:z.y,w:z.w-A.w,h:A.h}),z.y+=A.h,z.h-=A.h);break}}return{w:v,h:E,fill:r/(v*E)||0}}class _o{constructor(r,{pixelRatio:s,version:p,stretchX:v,stretchY:E,content:A,textFitWidth:I,textFitHeight:z}){this.paddedRect=r,this.pixelRatio=s,this.stretchX=v,this.stretchY=E,this.content=A,this.version=p,this.textFitWidth=I,this.textFitHeight=z}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class qg{constructor(r,s){const p={},v={};this.haveRenderCallbacks=[];const E=[];this.addImages(r,p,E),this.addImages(s,v,E);const{w:A,h:I}=$g(E),z=new Is({width:A||1,height:I||1});for(const F in r){const $=r[F],X=p[F].paddedRect;Is.copy($.data,z,{x:0,y:0},{x:X.x+1,y:X.y+1},$.data)}for(const F in s){const $=s[F],X=v[F].paddedRect,te=X.x+1,ie=X.y+1,re=$.data.width,oe=$.data.height;Is.copy($.data,z,{x:0,y:0},{x:te,y:ie},$.data),Is.copy($.data,z,{x:0,y:oe-1},{x:te,y:ie-1},{width:re,height:1}),Is.copy($.data,z,{x:0,y:0},{x:te,y:ie+oe},{width:re,height:1}),Is.copy($.data,z,{x:re-1,y:0},{x:te-1,y:ie},{width:1,height:oe}),Is.copy($.data,z,{x:0,y:0},{x:te+re,y:ie},{width:1,height:oe})}this.image=z,this.iconPositions=p,this.patternPositions=v}addImages(r,s,p){for(const v in r){const E=r[v],A={x:0,y:0,w:E.data.width+2,h:E.data.height+2};p.push(A),s[v]=new _o(A,E),E.hasRenderCallback&&this.haveRenderCallbacks.push(v)}}patchUpdatedImages(r,s){r.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const p in r.updatedImages)this.patchUpdatedImage(this.iconPositions[p],r.getImage(p),s),this.patchUpdatedImage(this.patternPositions[p],r.getImage(p),s)}patchUpdatedImage(r,s,p){if(!r||!s||r.version===s.version)return;r.version=s.version;const[v,E]=r.tl;p.update(s.data,void 0,{x:v,y:E})}}var Kc;Yt("ImagePosition",_o),Yt("ImageAtlas",qg),_.ao=void 0,(Kc=_.ao||(_.ao={}))[Kc.none=0]="none",Kc[Kc.horizontal=1]="horizontal",Kc[Kc.vertical=2]="vertical",Kc[Kc.horizontalOnly=3]="horizontalOnly";class ep{constructor(){this.scale=1,this.fontStack="",this.imageName=null,this.verticalAlign="bottom"}static forText(r,s,p){const v=new ep;return v.scale=r||1,v.fontStack=s,v.verticalAlign=p||"bottom",v}static forImage(r,s){const p=new ep;return p.imageName=r,p.verticalAlign=s||"bottom",p}}class Vl{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(r,s){const p=new Vl;for(let v=0;v<r.sections.length;v++){const E=r.sections[v];E.image?p.addImageSection(E):p.addTextSection(E,s)}return p}length(){return this.text.length}getSection(r){return this.sections[this.sectionIndex[r]]}getSectionIndex(r){return this.sectionIndex[r]}getCharCode(r){return this.text.charCodeAt(r)}verticalizePunctuation(){this.text=(function(r){let s="";for(let p=0;p<r.length;p++){const v=r.charCodeAt(p+1)||null,E=r.charCodeAt(p-1)||null;s+=v&&ad(v)&&!no[r[p+1]]||E&&ad(E)&&!no[r[p-1]]||!no[r[p]]?r[p]:no[r[p]]}return s})(this.text)}trim(){let r=0;for(let p=0;p<this.text.length&&rf[this.text.charCodeAt(p)];p++)r++;let s=this.text.length;for(let p=this.text.length-1;p>=0&&p>=r&&rf[this.text.charCodeAt(p)];p--)s--;this.text=this.text.substring(r,s),this.sectionIndex=this.sectionIndex.slice(r,s)}substring(r,s){const p=new Vl;return p.text=this.text.substring(r,s),p.sectionIndex=this.sectionIndex.slice(r,s),p.sections=this.sections,p}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((r,s)=>Math.max(r,this.sections[s].scale)),0)}getMaxImageSize(r){let s=0,p=0;for(let v=0;v<this.length();v++){const E=this.getSection(v);if(E.imageName){const A=r[E.imageName];if(!A)continue;const I=A.displaySize;s=Math.max(s,I[0]),p=Math.max(p,I[1])}}return{maxImageWidth:s,maxImageHeight:p}}addTextSection(r,s){this.text+=r.text,this.sections.push(ep.forText(r.scale,r.fontStack||s,r.verticalAlign));const p=this.sections.length-1;for(let v=0;v<r.text.length;++v)this.sectionIndex.push(p)}addImageSection(r){const s=r.image?r.image.name:"";if(s.length===0)return void Ii("Can't add FormattedSection with an empty image.");const p=this.getNextImageSectionCharCode();p?(this.text+=String.fromCharCode(p),this.sections.push(ep.forImage(s,r.verticalAlign)),this.sectionIndex.push(this.sections.length-1)):Ii("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Sd(l,r,s,p,v,E,A,I,z,F,$,X,te,ie,re){const oe=Vl.fromFeature(l,v);let pe;X===_.ao.vertical&&oe.verticalizePunctuation();const{processBidirectionalText:Te,processStyledBidirectionalText:We}=_l;if(Te&&oe.sections.length===1){pe=[];const ot=Te(oe.toString(),Hg(oe,F,E,r,p,ie));for(const gt of ot){const Ct=new Vl;Ct.text=gt,Ct.sections=oe.sections;for(let Gt=0;Gt<gt.length;Gt++)Ct.sectionIndex.push(0);pe.push(Ct)}}else if(We){pe=[];const ot=We(oe.text,oe.sectionIndex,Hg(oe,F,E,r,p,ie));for(const gt of ot){const Ct=new Vl;Ct.text=gt[0],Ct.sectionIndex=gt[1],Ct.sections=oe.sections,pe.push(Ct)}}else pe=(function(ot,gt){const Ct=[],Gt=ot.text;let Ft=0;for(const Zt of gt)Ct.push(ot.substring(Ft,Zt)),Ft=Zt;return Ft<Gt.length&&Ct.push(ot.substring(Ft,Gt.length)),Ct})(oe,Hg(oe,F,E,r,p,ie));const Le=[],Fe={positionedLines:Le,text:oe.toString(),top:$[1],bottom:$[1],left:$[0],right:$[0],writingMode:X,iconsInText:!1,verticalizable:!1};return(function(ot,gt,Ct,Gt,Ft,Zt,dn,qt,Ut,St,Sn,Pn){let mn=0,un=0,Qn=0,Kr=0;const ya=qt==="right"?1:qt==="left"?0:.5,us=Wr/Pn;let El=0;for(const Rr of Ft){Rr.trim();const za=Rr.getMaxScale(),va={positionedGlyphs:[],lineOffset:0};ot.positionedLines[El]=va;const cs=va.positionedGlyphs;let vo=0;if(!Rr.length()){un+=Zt,++El;continue}const Ko=fb(Gt,Rr,us);for(let Rs=0;Rs<Rr.length();Rs++){const ca=Rr.getSection(Rs),Oa=Rr.getSectionIndex(Rs),xa=Rr.getCharCode(Rs),_r=jy(Ut,Sn,xa);let Ci;if(ca.imageName){if(ot.iconsInText=!0,ca.scale=ca.scale*us,Ci=um(ca,_r,za,Ko,Gt),!Ci)continue;vo=Math.max(vo,Ci.imageOffset)}else if(Ci=sf(ca,xa,_r,Ko,gt,Ct),!Ci)continue;const{rect:Ls,metrics:Tc,baselineOffset:Yo}=Ci;cs.push({glyph:xa,imageName:ca.imageName,x:mn,y:un+Yo+-17,vertical:_r,scale:ca.scale,fontStack:ca.fontStack,sectionIndex:Oa,metrics:Tc,rect:Ls}),_r?(ot.verticalizable=!0,mn+=(ca.imageName?Tc.advance:Wr)*ca.scale+St):mn+=Tc.advance*ca.scale+St}cs.length!==0&&(Qn=Math.max(mn-St,Qn),Uy(cs,0,cs.length-1,ya)),mn=0,va.lineOffset=Math.max(vo,(za-1)*Wr);const ba=Zt*za+vo;un+=ba,Kr=Math.max(ba,Kr),++El}const{horizontalAlign:yo,verticalAlign:Da}=Xg(dn);(function(Rr,za,va,cs,vo,Ko,ba,Rs,ca){const Oa=(za-va)*vo;let xa=0;xa=Ko!==ba?-Rs*cs- -17:-cs*ca*ba+.5*ba;for(const _r of Rr)for(const Ci of _r.positionedGlyphs)Ci.x+=Oa,Ci.y+=xa})(ot.positionedLines,ya,yo,Da,Qn,Kr,Zt,un,Ft.length),ot.top+=-Da*un,ot.bottom=ot.top+un,ot.left+=-yo*Qn,ot.right=ot.left+Qn})(Fe,r,s,p,pe,A,I,z,X,F,te,re),!(function(ot){for(const gt of ot)if(gt.positionedGlyphs.length!==0)return!1;return!0})(Le)&&Fe}const rf={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},af={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},Fy={40:!0};function Gg(l,r,s,p,v,E){if(r.imageName){const A=p[r.imageName];return A?A.displaySize[0]*r.scale*Wr/E+v:0}{const A=s[r.fontStack],I=A&&A[l];return I?I.metrics.advance*r.scale+v:0}}function Zg(l,r,s,p){const v=Math.pow(l-r,2);return p?l<r?v/2:2*v:v+Math.abs(s)*s}function Vy(l,r,s){let p=0;return l===10&&(p-=1e4),s&&(p+=150),l!==40&&l!==65288||(p+=50),r!==41&&r!==65289||(p+=50),p}function tp(l,r,s,p,v,E){let A=null,I=Zg(r,s,v,E);for(const z of p){const F=Zg(r-z.x,s,v,E)+z.badness;F<=I&&(A=z,I=F)}return{index:l,x:r,priorBreak:A,badness:I}}function lm(l){return l?lm(l.priorBreak).concat(l.index):[]}function Hg(l,r,s,p,v,E){if(!l)return[];const A=[],I=(function(X,te,ie,re,oe,pe){let Te=0;for(let We=0;We<X.length();We++){const Le=X.getSection(We);Te+=Gg(X.getCharCode(We),Le,re,oe,te,pe)}return Te/Math.max(1,Math.ceil(Te/ie))})(l,r,s,p,v,E),z=l.text.indexOf("")>=0;let F=0;for(let X=0;X<l.length();X++){const te=l.getSection(X),ie=l.getCharCode(X);if(rf[ie]||(F+=Gg(ie,te,p,v,r,E)),X<l.length()-1){const re=!(($=ie)<11904)&&(!!ii["CJK Compatibility Forms"]($)||!!ii["CJK Compatibility"]($)||!!ii["CJK Strokes"]($)||!!ii["CJK Symbols and Punctuation"]($)||!!ii["Enclosed CJK Letters and Months"]($)||!!ii["Halfwidth and Fullwidth Forms"]($)||!!ii["Ideographic Description Characters"]($)||!!ii["Vertical Forms"]($)||lc.test(String.fromCodePoint($)));(af[ie]||re||te.imageName||X!==l.length()-2&&Fy[l.getCharCode(X+1)])&&A.push(tp(X+1,F,I,A,Vy(ie,l.getCharCode(X+1),re&&z),!1))}}var $;return lm(tp(l.length(),F,I,A,0,!0))}function Xg(l){let r=.5,s=.5;switch(l){case"right":case"top-right":case"bottom-right":r=1;break;case"left":case"top-left":case"bottom-left":r=0}switch(l){case"bottom":case"bottom-right":case"bottom-left":s=1;break;case"top":case"top-right":case"top-left":s=0}return{horizontalAlign:r,verticalAlign:s}}function fb(l,r,s){const p=r.getMaxScale()*Wr,{maxImageWidth:v,maxImageHeight:E}=r.getMaxImageSize(l),A=Math.max(p,E*s);return{verticalLineContentWidth:Math.max(p,v*s),horizontalLineContentHeight:A}}function Wg(l){switch(l){case"top":return 0;case"center":return .5;default:return 1}}function jy(l,r,s){return!(l===_.ao.horizontal||!r&&!jc(s)||r&&(rf[s]||(p=s,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(p)))));var p}function sf(l,r,s,p,v,E){const A=E[l.fontStack],I=(function(F,$,X,te){if(F&&F.rect)return F;const ie=$[X.fontStack],re=ie&&ie[te];return re?{rect:null,metrics:re.metrics}:null})(A&&A[r],v,l,r);if(I===null)return null;let z;if(s)z=p.verticalLineContentWidth-l.scale*Wr;else{const F=Wg(l.verticalAlign);z=(p.horizontalLineContentHeight-l.scale*Wr)*F}return{rect:I.rect,metrics:I.metrics,baselineOffset:z}}function um(l,r,s,p,v){const E=v[l.imageName];if(!E)return null;const A=E.paddedRect,I=E.displaySize,z={width:I[0],height:I[1],left:1,top:-3,advance:r?I[1]:I[0]};let F;if(r)F=p.verticalLineContentWidth-I[1]*l.scale;else{const $=Wg(l.verticalAlign);F=(p.horizontalLineContentHeight-I[1]*l.scale)*$}return{rect:A,metrics:z,baselineOffset:F,imageOffset:(r?I[0]:I[1])*l.scale-Wr*s}}function Uy(l,r,s,p){if(p===0)return;const v=l[s],E=(l[s].x+v.metrics.advance*v.scale)*p;for(let A=r;A<=s;A++)l[A].x-=E}function $y(l,r,s){const{horizontalAlign:p,verticalAlign:v}=Xg(s),E=r[0]-l.displaySize[0]*p,A=r[1]-l.displaySize[1]*v;return{image:l,top:A,bottom:A+l.displaySize[1],left:E,right:E+l.displaySize[0]}}function Kg(l){var r,s;let p=l.left,v=l.top,E=l.right-p,A=l.bottom-v;const I=(r=l.image.textFitWidth)!==null&&r!==void 0?r:"stretchOrShrink",z=(s=l.image.textFitHeight)!==null&&s!==void 0?s:"stretchOrShrink",F=(l.image.content[2]-l.image.content[0])/(l.image.content[3]-l.image.content[1]);if(z==="proportional"){if(I==="stretchOnly"&&E/A<F||I==="proportional"){const $=Math.ceil(A*F);p*=$/E,E=$}}else if(I==="proportional"&&z==="stretchOnly"&&F!==0&&E/A>F){const $=Math.ceil(E/F);v*=$/A,A=$}return{x1:p,y1:v,x2:p+E,y2:v+A}}function Yg(l,r,s,p,v,E){const A=l.image;let I;if(A.content){const pe=A.content,Te=A.pixelRatio||1;I=[pe[0]/Te,pe[1]/Te,A.displaySize[0]-pe[2]/Te,A.displaySize[1]-pe[3]/Te]}const z=r.left*E,F=r.right*E;let $,X,te,ie;s==="width"||s==="both"?(ie=v[0]+z-p[3],X=v[0]+F+p[1]):(ie=v[0]+(z+F-A.displaySize[0])/2,X=ie+A.displaySize[0]);const re=r.top*E,oe=r.bottom*E;return s==="height"||s==="both"?($=v[1]+re-p[0],te=v[1]+oe+p[2]):($=v[1]+(re+oe-A.displaySize[1])/2,te=$+A.displaySize[1]),{image:A,top:$,right:X,bottom:te,left:ie,collisionPadding:I}}const vc=128,Yc=32640;function np(l,r){const{expression:s}=r;if(s.kind==="constant")return{kind:"constant",layoutSize:s.evaluate(new ki(l+1))};if(s.kind==="source")return{kind:"source"};{const{zoomStops:p,interpolationType:v}=s;let E=0;for(;E<p.length&&p[E]<=l;)E++;E=Math.max(0,E-1);let A=E;for(;A<p.length&&p[A]<l+1;)A++;A=Math.min(p.length-1,A);const I=p[E],z=p[A];return s.kind==="composite"?{kind:"composite",minZoom:I,maxZoom:z,interpolationType:v}:{kind:"camera",minZoom:I,maxZoom:z,minSize:s.evaluate(new ki(I)),maxSize:s.evaluate(new ki(z)),interpolationType:v}}}function cm(l,r,s){let p="never";const v=l.get(r);return v?p=v:l.get(s)&&(p="always"),p}const qy=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Ki(l,r,s,p,v,E,A,I,z,F,$,X,te){const ie=I?Math.min(Yc,Math.round(I[0])):0,re=I?Math.min(Yc,Math.round(I[1])):0;l.emplaceBack(r,s,Math.round(32*p),Math.round(32*v),E,A,(ie<<1)+(z?1:0),re,16*F,16*$,256*X,256*te)}function ip(l,r,s){l.emplaceBack(r.x,r.y,s),l.emplaceBack(r.x,r.y,s),l.emplaceBack(r.x,r.y,s),l.emplaceBack(r.x,r.y,s)}function pb(l){for(const r of l.sections)if(uc(r.text))return!0;return!1}class hm{constructor(r){this.layoutVertexArray=new Vt,this.indexArray=new Wi,this.programConfigurations=r,this.segments=new Un,this.dynamicLayoutVertexArray=new At,this.opacityVertexArray=new ln,this.hasVisibleVertices=!1,this.placedSymbolArray=new ae}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(r,s,p,v){this.isEmpty()||(p&&(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,Bg.members),this.indexBuffer=r.createIndexBuffer(this.indexArray,s),this.dynamicLayoutVertexBuffer=r.createVertexBuffer(this.dynamicLayoutVertexArray,Hc.members,!0),this.opacityVertexBuffer=r.createVertexBuffer(this.opacityVertexArray,qy,!0),this.opacityVertexBuffer.itemSize=1),(p||v)&&this.programConfigurations.upload(r))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Yt("SymbolBuffers",hm);class Qg{constructor(r,s,p){this.layoutVertexArray=new r,this.layoutAttributes=s,this.indexArray=new p,this.segments=new Un,this.collisionVertexArray=new vi}upload(r){this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=r.createVertexBuffer(this.collisionVertexArray,_a.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Yt("CollisionBuffers",Qg);class of{constructor(r){this.collisionBoxArray=r.collisionBoxArray,this.zoom=r.zoom,this.globalState=r.globalState,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map((A=>A.id)),this.index=r.index,this.pixelRatio=r.pixelRatio,this.sourceLayerIndex=r.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const s=this.layers[0]._unevaluatedLayout._values;this.textSizeData=np(this.zoom,s["text-size"]),this.iconSizeData=np(this.zoom,s["icon-size"]);const p=this.layers[0].layout,v=p.get("symbol-sort-key"),E=p.get("symbol-z-order");this.canOverlap=cm(p,"text-overlap","text-allow-overlap")!=="never"||cm(p,"icon-overlap","icon-allow-overlap")!=="never"||p.get("text-ignore-placement")||p.get("icon-ignore-placement"),this.sortFeaturesByKey=E!=="viewport-y"&&!v.isConstant(),this.sortFeaturesByY=(E==="viewport-y"||E==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,p.get("symbol-placement")==="point"&&(this.writingModes=p.get("text-writing-mode").map((A=>_.ao[A]))),this.stateDependentLayerIds=this.layers.filter((A=>A.isStateDependent())).map((A=>A.id)),this.sourceID=r.sourceID}createArrays(){this.text=new hm(new mo(this.layers,this.zoom,(r=>/^text/.test(r)))),this.icon=new hm(new mo(this.layers,this.zoom,(r=>/^icon/.test(r)))),this.glyphOffsetArray=new ve,this.lineVertexArray=new we,this.symbolInstances=new me,this.textAnchorOffsets=new Ce}calculateGlyphDependencies(r,s,p,v,E){for(let A=0;A<r.length;A++)if(s[r.charCodeAt(A)]=!0,(p||v)&&E){const I=no[r.charAt(A)];I&&(s[I.charCodeAt(0)]=!0)}}populate(r,s,p){const v=this.layers[0],E=v.layout,A=E.get("text-font"),I=E.get("text-field"),z=E.get("icon-image"),F=(I.value.kind!=="constant"||I.value.value instanceof Zi&&!I.value.value.isEmpty()||I.value.value.toString().length>0)&&(A.value.kind!=="constant"||A.value.value.length>0),$=z.value.kind!=="constant"||!!z.value.value||Object.keys(z.parameters).length>0,X=E.get("symbol-sort-key");if(this.features=[],!F&&!$)return;const te=s.iconDependencies,ie=s.glyphDependencies,re=s.availableImages,oe=new ki(this.zoom,{globalState:this.globalState});for(const{feature:pe,id:Te,index:We,sourceLayerIndex:Le}of r){const Fe=v._featureFilter.needGeometry,ot=xl(pe,Fe);if(!v._featureFilter.filter(oe,ot,p))continue;let gt,Ct;if(Fe||(ot.geometry=su(pe)),F){const Ft=v.getValueAndResolveTokens("text-field",ot,p,re),Zt=Zi.factory(Ft),dn=this.hasRTLText=this.hasRTLText||pb(Zt);(!dn||_l.getRTLTextPluginStatus()==="unavailable"||dn&&_l.isParsed())&&(gt=Fg(Zt,v,ot))}if($){const Ft=v.getValueAndResolveTokens("icon-image",ot,p,re);Ct=Ft instanceof ur?Ft:ur.fromString(Ft)}if(!gt&&!Ct)continue;const Gt=this.sortFeaturesByKey?X.evaluate(ot,{},p):void 0;if(this.features.push({id:Te,text:gt,icon:Ct,index:We,sourceLayerIndex:Le,geometry:ot.geometry,properties:pe.properties,type:os.types[pe.type],sortKey:Gt}),Ct&&(te[Ct.name]=!0),gt){const Ft=A.evaluate(ot,{},p).join(","),Zt=E.get("text-rotation-alignment")!=="viewport"&&E.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(_.ao.vertical)>=0;for(const dn of gt.sections)if(dn.image)te[dn.image.name]=!0;else{const qt=rd(gt.toString()),Ut=dn.fontStack||Ft,St=ie[Ut]=ie[Ut]||{};this.calculateGlyphDependencies(dn.text,St,Zt,this.allowVerticalPlacement,qt)}}}E.get("symbol-placement")==="line"&&(this.features=(function(pe){const Te={},We={},Le=[];let Fe=0;function ot(Ft){Le.push(pe[Ft]),Fe++}function gt(Ft,Zt,dn){const qt=We[Ft];return delete We[Ft],We[Zt]=qt,Le[qt].geometry[0].pop(),Le[qt].geometry[0]=Le[qt].geometry[0].concat(dn[0]),qt}function Ct(Ft,Zt,dn){const qt=Te[Zt];return delete Te[Zt],Te[Ft]=qt,Le[qt].geometry[0].shift(),Le[qt].geometry[0]=dn[0].concat(Le[qt].geometry[0]),qt}function Gt(Ft,Zt,dn){const qt=dn?Zt[0][Zt[0].length-1]:Zt[0][0];return`${Ft}:${qt.x}:${qt.y}`}for(let Ft=0;Ft<pe.length;Ft++){const Zt=pe[Ft],dn=Zt.geometry,qt=Zt.text?Zt.text.toString():null;if(!qt){ot(Ft);continue}const Ut=Gt(qt,dn),St=Gt(qt,dn,!0);if(Ut in We&&St in Te&&We[Ut]!==Te[St]){const Sn=Ct(Ut,St,dn),Pn=gt(Ut,St,Le[Sn].geometry);delete Te[Ut],delete We[St],We[Gt(qt,Le[Pn].geometry,!0)]=Pn,Le[Sn].geometry=null}else Ut in We?gt(Ut,St,dn):St in Te?Ct(Ut,St,dn):(ot(Ft),Te[Ut]=Fe-1,We[St]=Fe-1)}return Le.filter((Ft=>Ft.geometry))})(this.features)),this.sortFeaturesByKey&&this.features.sort(((pe,Te)=>pe.sortKey-Te.sortKey))}update(r,s,p){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(r,s,this.layers,p),this.icon.programConfigurations.updatePaintArrays(r,s,this.layers,p))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(r){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(r),this.iconCollisionBox.upload(r)),this.text.upload(r,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(r,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(r,s){const p=this.lineVertexArray.length;if(r.segment!==void 0){let v=r.dist(s[r.segment+1]),E=r.dist(s[r.segment]);const A={};for(let I=r.segment+1;I<s.length;I++)A[I]={x:s[I].x,y:s[I].y,tileUnitDistanceFromAnchor:v},I<s.length-1&&(v+=s[I+1].dist(s[I]));for(let I=r.segment||0;I>=0;I--)A[I]={x:s[I].x,y:s[I].y,tileUnitDistanceFromAnchor:E},I>0&&(E+=s[I-1].dist(s[I]));for(let I=0;I<s.length;I++){const z=A[I];this.lineVertexArray.emplaceBack(z.x,z.y,z.tileUnitDistanceFromAnchor)}}return{lineStartIndex:p,lineLength:this.lineVertexArray.length-p}}addSymbols(r,s,p,v,E,A,I,z,F,$,X,te){const ie=r.indexArray,re=r.layoutVertexArray,oe=r.segments.prepareSegment(4*s.length,re,ie,this.canOverlap?A.sortKey:void 0),pe=this.glyphOffsetArray.length,Te=oe.vertexLength,We=this.allowVerticalPlacement&&I===_.ao.vertical?Math.PI/2:0,Le=A.text&&A.text.sections;for(let Fe=0;Fe<s.length;Fe++){const{tl:ot,tr:gt,bl:Ct,br:Gt,tex:Ft,pixelOffsetTL:Zt,pixelOffsetBR:dn,minFontScaleX:qt,minFontScaleY:Ut,glyphOffset:St,isSDF:Sn,sectionIndex:Pn}=s[Fe],mn=oe.vertexLength,un=St[1];Ki(re,z.x,z.y,ot.x,un+ot.y,Ft.x,Ft.y,p,Sn,Zt.x,Zt.y,qt,Ut),Ki(re,z.x,z.y,gt.x,un+gt.y,Ft.x+Ft.w,Ft.y,p,Sn,dn.x,Zt.y,qt,Ut),Ki(re,z.x,z.y,Ct.x,un+Ct.y,Ft.x,Ft.y+Ft.h,p,Sn,Zt.x,dn.y,qt,Ut),Ki(re,z.x,z.y,Gt.x,un+Gt.y,Ft.x+Ft.w,Ft.y+Ft.h,p,Sn,dn.x,dn.y,qt,Ut),ip(r.dynamicLayoutVertexArray,z,We),ie.emplaceBack(mn,mn+2,mn+1),ie.emplaceBack(mn+1,mn+2,mn+3),oe.vertexLength+=4,oe.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(St[0]),Fe!==s.length-1&&Pn===s[Fe+1].sectionIndex||r.programConfigurations.populatePaintArrays(re.length,A,A.index,{},te,Le&&Le[Pn])}r.placedSymbolArray.emplaceBack(z.x,z.y,pe,this.glyphOffsetArray.length-pe,Te,F,$,z.segment,p?p[0]:0,p?p[1]:0,v[0],v[1],I,0,!1,0,X)}_addCollisionDebugVertex(r,s,p,v,E,A){return s.emplaceBack(0,0),r.emplaceBack(p.x,p.y,v,E,Math.round(A.x),Math.round(A.y))}addCollisionDebugVertices(r,s,p,v,E,A,I){const z=E.segments.prepareSegment(4,E.layoutVertexArray,E.indexArray),F=z.vertexLength,$=E.layoutVertexArray,X=E.collisionVertexArray,te=I.anchorX,ie=I.anchorY;this._addCollisionDebugVertex($,X,A,te,ie,new M(r,s)),this._addCollisionDebugVertex($,X,A,te,ie,new M(p,s)),this._addCollisionDebugVertex($,X,A,te,ie,new M(p,v)),this._addCollisionDebugVertex($,X,A,te,ie,new M(r,v)),z.vertexLength+=4;const re=E.indexArray;re.emplaceBack(F,F+1),re.emplaceBack(F+1,F+2),re.emplaceBack(F+2,F+3),re.emplaceBack(F+3,F),z.primitiveLength+=4}addDebugCollisionBoxes(r,s,p,v){for(let E=r;E<s;E++){const A=this.collisionBoxArray.get(E);this.addCollisionDebugVertices(A.x1,A.y1,A.x2,A.y2,v?this.textCollisionBox:this.iconCollisionBox,A.anchorPoint,p)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Qg(Zn,Xc.members,ji),this.iconCollisionBox=new Qg(Zn,Xc.members,ji);for(let r=0;r<this.symbolInstances.length;r++){const s=this.symbolInstances.get(r);this.addDebugCollisionBoxes(s.textBoxStartIndex,s.textBoxEndIndex,s,!0),this.addDebugCollisionBoxes(s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s,!0),this.addDebugCollisionBoxes(s.iconBoxStartIndex,s.iconBoxEndIndex,s,!1),this.addDebugCollisionBoxes(s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex,s,!1)}}_deserializeCollisionBoxesForSymbol(r,s,p,v,E,A,I,z,F){const $={};for(let X=s;X<p;X++){const te=r.get(X);$.textBox={x1:te.x1,y1:te.y1,x2:te.x2,y2:te.y2,anchorPointX:te.anchorPointX,anchorPointY:te.anchorPointY},$.textFeatureIndex=te.featureIndex;break}for(let X=v;X<E;X++){const te=r.get(X);$.verticalTextBox={x1:te.x1,y1:te.y1,x2:te.x2,y2:te.y2,anchorPointX:te.anchorPointX,anchorPointY:te.anchorPointY},$.verticalTextFeatureIndex=te.featureIndex;break}for(let X=A;X<I;X++){const te=r.get(X);$.iconBox={x1:te.x1,y1:te.y1,x2:te.x2,y2:te.y2,anchorPointX:te.anchorPointX,anchorPointY:te.anchorPointY},$.iconFeatureIndex=te.featureIndex;break}for(let X=z;X<F;X++){const te=r.get(X);$.verticalIconBox={x1:te.x1,y1:te.y1,x2:te.x2,y2:te.y2,anchorPointX:te.anchorPointX,anchorPointY:te.anchorPointY},$.verticalIconFeatureIndex=te.featureIndex;break}return $}deserializeCollisionBoxes(r){this.collisionArrays=[];for(let s=0;s<this.symbolInstances.length;s++){const p=this.symbolInstances.get(s);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(r,p.textBoxStartIndex,p.textBoxEndIndex,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p.iconBoxStartIndex,p.iconBoxEndIndex,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(r,s){const p=r.placedSymbolArray.get(s),v=p.vertexStartIndex+4*p.numGlyphs;for(let E=p.vertexStartIndex;E<v;E+=4)r.indexArray.emplaceBack(E,E+2,E+1),r.indexArray.emplaceBack(E+1,E+2,E+3)}getSortedSymbolIndexes(r){if(this.sortedAngle===r&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const s=Math.sin(r),p=Math.cos(r),v=[],E=[],A=[];for(let I=0;I<this.symbolInstances.length;++I){A.push(I);const z=this.symbolInstances.get(I);v.push(0|Math.round(s*z.anchorX+p*z.anchorY)),E.push(z.featureIndex)}return A.sort(((I,z)=>v[I]-v[z]||E[z]-E[I])),A}addToSortKeyRanges(r,s){const p=this.sortKeyRanges[this.sortKeyRanges.length-1];p&&p.sortKey===s?p.symbolInstanceEnd=r+1:this.sortKeyRanges.push({sortKey:s,symbolInstanceStart:r,symbolInstanceEnd:r+1})}sortFeatures(r){if(this.sortFeaturesByY&&this.sortedAngle!==r&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(r),this.sortedAngle=r,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const s of this.symbolInstanceIndexes){const p=this.symbolInstances.get(s);this.featureSortOrder.push(p.featureIndex),[p.rightJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.leftJustifiedTextSymbolIndex].forEach(((v,E,A)=>{v>=0&&A.indexOf(v)===E&&this.addIndicesForPlacedSymbol(this.text,v)})),p.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,p.verticalPlacedTextSymbolIndex),p.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,p.placedIconSymbolIndex),p.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,p.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Gy,rp;Yt("SymbolBucket",of,{omit:["layers","collisionBoxArray","features","compareText"]}),of.MAX_GLYPHS=65535,of.addDynamicAttributes=ip;var Ph={get paint(){return rp=rp||new As({"icon-opacity":new Tn($e.paint_symbol["icon-opacity"]),"icon-color":new Tn($e.paint_symbol["icon-color"]),"icon-halo-color":new Tn($e.paint_symbol["icon-halo-color"]),"icon-halo-width":new Tn($e.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Tn($e.paint_symbol["icon-halo-blur"]),"icon-translate":new an($e.paint_symbol["icon-translate"]),"icon-translate-anchor":new an($e.paint_symbol["icon-translate-anchor"]),"text-opacity":new Tn($e.paint_symbol["text-opacity"]),"text-color":new Tn($e.paint_symbol["text-color"],{runtimeType:nr,getOverride:l=>l.textColor,hasOverride:l=>!!l.textColor}),"text-halo-color":new Tn($e.paint_symbol["text-halo-color"]),"text-halo-width":new Tn($e.paint_symbol["text-halo-width"]),"text-halo-blur":new Tn($e.paint_symbol["text-halo-blur"]),"text-translate":new an($e.paint_symbol["text-translate"]),"text-translate-anchor":new an($e.paint_symbol["text-translate-anchor"])})},get layout(){return Gy=Gy||new As({"symbol-placement":new an($e.layout_symbol["symbol-placement"]),"symbol-spacing":new an($e.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new an($e.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Tn($e.layout_symbol["symbol-sort-key"]),"symbol-z-order":new an($e.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new an($e.layout_symbol["icon-allow-overlap"]),"icon-overlap":new an($e.layout_symbol["icon-overlap"]),"icon-ignore-placement":new an($e.layout_symbol["icon-ignore-placement"]),"icon-optional":new an($e.layout_symbol["icon-optional"]),"icon-rotation-alignment":new an($e.layout_symbol["icon-rotation-alignment"]),"icon-size":new Tn($e.layout_symbol["icon-size"]),"icon-text-fit":new an($e.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new an($e.layout_symbol["icon-text-fit-padding"]),"icon-image":new Tn($e.layout_symbol["icon-image"]),"icon-rotate":new Tn($e.layout_symbol["icon-rotate"]),"icon-padding":new Tn($e.layout_symbol["icon-padding"]),"icon-keep-upright":new an($e.layout_symbol["icon-keep-upright"]),"icon-offset":new Tn($e.layout_symbol["icon-offset"]),"icon-anchor":new Tn($e.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new an($e.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new an($e.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new an($e.layout_symbol["text-rotation-alignment"]),"text-field":new Tn($e.layout_symbol["text-field"]),"text-font":new Tn($e.layout_symbol["text-font"]),"text-size":new Tn($e.layout_symbol["text-size"]),"text-max-width":new Tn($e.layout_symbol["text-max-width"]),"text-line-height":new an($e.layout_symbol["text-line-height"]),"text-letter-spacing":new Tn($e.layout_symbol["text-letter-spacing"]),"text-justify":new Tn($e.layout_symbol["text-justify"]),"text-radial-offset":new Tn($e.layout_symbol["text-radial-offset"]),"text-variable-anchor":new an($e.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Tn($e.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Tn($e.layout_symbol["text-anchor"]),"text-max-angle":new an($e.layout_symbol["text-max-angle"]),"text-writing-mode":new an($e.layout_symbol["text-writing-mode"]),"text-rotate":new Tn($e.layout_symbol["text-rotate"]),"text-padding":new an($e.layout_symbol["text-padding"]),"text-keep-upright":new an($e.layout_symbol["text-keep-upright"]),"text-transform":new Tn($e.layout_symbol["text-transform"]),"text-offset":new Tn($e.layout_symbol["text-offset"]),"text-allow-overlap":new an($e.layout_symbol["text-allow-overlap"]),"text-overlap":new an($e.layout_symbol["text-overlap"]),"text-ignore-placement":new an($e.layout_symbol["text-ignore-placement"]),"text-optional":new an($e.layout_symbol["text-optional"])})}};class dm{constructor(r){if(r.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=r.property.overrides?r.property.overrides.runtimeType:Aa,this.defaultValue=r}evaluate(r){if(r.formattedSection){const s=this.defaultValue.property.overrides;if(s&&s.hasOverride(r.formattedSection))return s.getOverride(r.formattedSection)}return r.feature&&r.featureState?this.defaultValue.evaluate(r.feature,r.featureState):this.defaultValue.property.specification.default}eachChild(r){this.defaultValue.isConstant()||r(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Yt("FormatSectionOverride",dm,{omit:["defaultValue"]});class Ed extends fo{constructor(r){super(r,Ph)}recalculate(r,s){if(super.recalculate(r,s),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const p=this.layout.get("text-writing-mode");if(p){const v=[];for(const E of p)v.indexOf(E)<0&&v.push(E);this.layout._values["text-writing-mode"]=v}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(r,s,p,v){const E=this.layout.get(r).evaluate(s,{},p,v),A=this._unevaluatedLayout._values[r];return A.isDataDriven()||nc(A.value)||!E?E:(function(I,z){return z.replace(/{([^{}]+)}/g,((F,$)=>I&&$ in I?String(I[$]):""))})(s.properties,E)}createBucket(r){return new of(r)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const r of Ph.paint.overridableProperties){if(!Ed.hasPaintOverride(this.layout,r))continue;const s=this.paint.get(r),p=new dm(s),v=new tc(p,s.property.specification);let E=null;E=s.value.kind==="constant"||s.value.kind==="source"?new f("source",v):new x("composite",v,s.value.zoomStops),this.paint._values[r]=new yl(s.property,E,s.parameters)}}_handleOverridablePaintPropertyUpdate(r,s,p){return!(!this.layout||s.isDataDriven()||p.isDataDriven())&&Ed.hasPaintOverride(this.layout,r)}static hasPaintOverride(r,s){const p=r.get("text-field"),v=Ph.paint.properties[s];let E=!1;const A=I=>{for(const z of I)if(v.overrides&&v.overrides.hasOverride(z))return void(E=!0)};if(p.value.kind==="constant"&&p.value.value instanceof Zi)A(p.value.value.sections);else if(p.value.kind==="source"){const I=F=>{E||(F instanceof na&&fn(F.value)===js?A(F.value.sections):F instanceof ht?A(F.sections):F.eachChild(I))},z=p.value;z._styleExpression&&I(z._styleExpression.expression)}return E}}let fm;var Rh={get paint(){return fm=fm||new As({"background-color":new an($e.paint_background["background-color"]),"background-pattern":new jo($e.paint_background["background-pattern"]),"background-opacity":new an($e.paint_background["background-opacity"])})}};class bc extends fo{constructor(r){super(r,Rh)}}let lf;var mb={get paint(){return lf=lf||new As({"raster-opacity":new an($e.paint_raster["raster-opacity"]),"raster-hue-rotate":new an($e.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new an($e.paint_raster["raster-brightness-min"]),"raster-brightness-max":new an($e.paint_raster["raster-brightness-max"]),"raster-saturation":new an($e.paint_raster["raster-saturation"]),"raster-contrast":new an($e.paint_raster["raster-contrast"]),"raster-resampling":new an($e.paint_raster["raster-resampling"]),"raster-fade-duration":new an($e.paint_raster["raster-fade-duration"])})}};class Zy extends fo{constructor(r){super(r,mb)}}class Hy extends fo{constructor(r){super(r,{}),this.onAdd=s=>{this.implementation.onAdd&&this.implementation.onAdd(s,s.painter.context.gl)},this.onRemove=s=>{this.implementation.onRemove&&this.implementation.onRemove(s,s.painter.context.gl)},this.implementation=r}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Xy{constructor(r){this._methodToThrottle=r,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._methodToThrottle()}),0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const Wy={once:!0},Jg=63710088e-1;class xc{constructor(r,s){if(isNaN(r)||isNaN(s))throw new Error(`Invalid LngLat object: (${r}, ${s})`);if(this.lng=+r,this.lat=+s,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new xc(Fn(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(r){const s=Math.PI/180,p=this.lat*s,v=r.lat*s,E=Math.sin(p)*Math.sin(v)+Math.cos(p)*Math.cos(v)*Math.cos((r.lng-this.lng)*s);return Jg*Math.acos(Math.min(E,1))}static convert(r){if(r instanceof xc)return r;if(Array.isArray(r)&&(r.length===2||r.length===3))return new xc(Number(r[0]),Number(r[1]));if(!Array.isArray(r)&&typeof r=="object"&&r!==null)return new xc(Number("lng"in r?r.lng:r.lon),Number(r.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const e_=2*Math.PI*Jg;function t_(l){return e_*Math.cos(l*Math.PI/180)}function Ky(l){return(180+l)/360}function pm(l){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+l*Math.PI/360)))/360}function mm(l,r){return l/t_(r)}function n_(l){return 360/Math.PI*Math.atan(Math.exp((180-360*l)*Math.PI/180))-90}function Yy(l,r){return l*t_(n_(r))}class Qc{constructor(r,s,p=0){this.x=+r,this.y=+s,this.z=+p}static fromLngLat(r,s=0){const p=xc.convert(r);return new Qc(Ky(p.lng),pm(p.lat),mm(s,p.lat))}toLngLat(){return new xc(360*this.x-180,n_(this.y))}toAltitude(){return Yy(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/e_*(r=n_(this.y),1/Math.cos(r*Math.PI/180));var r}}function Qy(l,r,s){var p=2*Math.PI*6378137/256/Math.pow(2,s);return[l*p-2*Math.PI*6378137/2,r*p-2*Math.PI*6378137/2]}class gm{constructor(r,s,p){if(!(function(v,E,A){return!(v<0||v>25||A<0||A>=Math.pow(2,v)||E<0||E>=Math.pow(2,v))})(r,s,p))throw new Error(`x=${s}, y=${p}, z=${r} outside of bounds. 0<=x<${Math.pow(2,r)}, 0<=y<${Math.pow(2,r)} 0<=z<=25 `);this.z=r,this.x=s,this.y=p,this.key=Jc(0,r,r,s,p)}equals(r){return this.z===r.z&&this.x===r.x&&this.y===r.y}url(r,s,p){const v=(A=this.y,I=this.z,z=Qy(256*(E=this.x),256*(A=Math.pow(2,I)-A-1),I),F=Qy(256*(E+1),256*(A+1),I),z[0]+","+z[1]+","+F[0]+","+F[1]);var E,A,I,z,F;const $=(function(X,te,ie){let re,oe="";for(let pe=X;pe>0;pe--)re=1<<pe-1,oe+=(te&re?1:0)+(ie&re?2:0);return oe})(this.z,this.x,this.y);return r[(this.x+this.y)%r.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(p==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,s>1?"@2x":"").replace(/{quadkey}/g,$).replace(/{bbox-epsg-3857}/g,v)}isChildOf(r){const s=this.z-r.z;return s>0&&r.x===this.x>>s&&r.y===this.y>>s}getTilePoint(r){const s=Math.pow(2,this.z);return new M((r.x*s-this.x)*zt,(r.y*s-this.y)*zt)}toString(){return`${this.z}/${this.x}/${this.y}`}}class _i{constructor(r,s){this.wrap=r,this.canonical=s,this.key=Jc(r,s.z,s.z,s.x,s.y)}}class Wo{constructor(r,s,p,v,E){if(this.terrainRttPosMatrix32f=null,r<p)throw new Error(`overscaledZ should be >= z; overscaledZ = ${r}; z = ${p}`);this.overscaledZ=r,this.wrap=s,this.canonical=new gm(p,+v,+E),this.key=Jc(s,r,p,v,E)}clone(){return new Wo(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(r){return this.overscaledZ===r.overscaledZ&&this.wrap===r.wrap&&this.canonical.equals(r.canonical)}scaledTo(r){if(r>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${r}; overscaledZ = ${this.overscaledZ}`);const s=this.canonical.z-r;return r>this.canonical.z?new Wo(r,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Wo(r,this.wrap,r,this.canonical.x>>s,this.canonical.y>>s)}calculateScaledKey(r,s){if(r>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${r}; overscaledZ = ${this.overscaledZ}`);const p=this.canonical.z-r;return r>this.canonical.z?Jc(this.wrap*+s,r,this.canonical.z,this.canonical.x,this.canonical.y):Jc(this.wrap*+s,r,r,this.canonical.x>>p,this.canonical.y>>p)}isChildOf(r){if(r.wrap!==this.wrap)return!1;const s=this.canonical.z-r.canonical.z;return r.overscaledZ===0||r.overscaledZ<this.overscaledZ&&r.canonical.x===this.canonical.x>>s&&r.canonical.y===this.canonical.y>>s}children(r){if(this.overscaledZ>=r)return[new Wo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const s=this.canonical.z+1,p=2*this.canonical.x,v=2*this.canonical.y;return[new Wo(s,this.wrap,s,p,v),new Wo(s,this.wrap,s,p+1,v),new Wo(s,this.wrap,s,p,v+1),new Wo(s,this.wrap,s,p+1,v+1)]}isLessThan(r){return this.wrap<r.wrap||!(this.wrap>r.wrap)&&(this.overscaledZ<r.overscaledZ||!(this.overscaledZ>r.overscaledZ)&&(this.canonical.x<r.canonical.x||!(this.canonical.x>r.canonical.x)&&this.canonical.y<r.canonical.y))}wrapped(){return new Wo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(r){return new Wo(this.overscaledZ,r,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new _i(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(r){return this.canonical.getTilePoint(new Qc(r.x-this.wrap,r.y))}}function Jc(l,r,s,p,v){(l*=2)<0&&(l=-1*l-1);const E=1<<s;return(E*E*l+E*v+p).toString(36)+s.toString(36)+r.toString(36)}function Ad(l,r){return r?l.properties[r]:l.id}Yt("CanonicalTileID",gm),Yt("OverscaledTileID",Wo,{omit:["terrainRttPosMatrix32f"]});class Lh{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(r){return this.minX=Math.min(this.minX,r.x),this.minY=Math.min(this.minY,r.y),this.maxX=Math.max(this.maxX,r.x),this.maxY=Math.max(this.maxY,r.y),this}expandBy(r){return this.minX-=r,this.minY-=r,this.maxX+=r,this.maxY+=r,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(r){return this.expandBy(-r)}map(r){const s=new Lh;return s.extend(r(new M(this.minX,this.minY))),s.extend(r(new M(this.maxX,this.minY))),s.extend(r(new M(this.minX,this.maxY))),s.extend(r(new M(this.maxX,this.maxY))),s}static fromPoints(r){const s=new Lh;for(const p of r)s.extend(p);return s}contains(r){return r.x>=this.minX&&r.x<=this.maxX&&r.y>=this.minY&&r.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(r){return!this.empty()&&!r.empty()&&r.minX>=this.minX&&r.maxX<=this.maxX&&r.minY>=this.minY&&r.maxY<=this.maxY}intersects(r){return!this.empty()&&!r.empty()&&r.minX<=this.maxX&&r.maxX>=this.minX&&r.minY<=this.maxY&&r.maxY>=this.minY}}class _m{constructor(r){this._stringToNumber={},this._numberToString=[];for(let s=0;s<r.length;s++){const p=r[s];this._stringToNumber[p]=s,this._numberToString[s]=p}}encode(r){return this._stringToNumber[r]}decode(r){if(r>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${r} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[r]}}class uf{constructor(r,s,p,v,E){this.type="Feature",this._vectorTileFeature=r,r._z=s,r._x=p,r._y=v,this.properties=r.properties,this.id=E}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(r){this._geometry=r}toJSON(){const r={geometry:this.geometry};for(const s in this)s!=="_geometry"&&s!=="_vectorTileFeature"&&(r[s]=this[s]);return r}}class ap{constructor(r,s){this.tileID=r,this.x=r.canonical.x,this.y=r.canonical.y,this.z=r.canonical.z,this.grid=new _h(zt,16,0),this.grid3D=new _h(zt,16,0),this.featureIndexArray=new Ve,this.promoteId=s}insert(r,s,p,v,E,A){const I=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(p,v,E);const z=A?this.grid3D:this.grid;for(let F=0;F<s.length;F++){const $=s[F],X=[1/0,1/0,-1/0,-1/0];for(let te=0;te<$.length;te++){const ie=$[te];X[0]=Math.min(X[0],ie.x),X[1]=Math.min(X[1],ie.y),X[2]=Math.max(X[2],ie.x),X[3]=Math.max(X[3],ie.y)}X[0]<zt&&X[1]<zt&&X[2]>=0&&X[3]>=0&&z.insert(I,X[0],X[1],X[2],X[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new yc(new tf(this.rawTileData)).layers,this.sourceLayerCoder=new _m(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(r,s,p,v){this.loadVTLayers();const E=r.params,A=zt/r.tileSize/r.scale,I=ut(E.filter),z=r.queryGeometry,F=r.queryPadding*A,$=Lh.fromPoints(z),X=this.grid.query($.minX-F,$.minY-F,$.maxX+F,$.maxY+F),te=Lh.fromPoints(r.cameraQueryGeometry).expandBy(F),ie=this.grid3D.query(te.minX,te.minY,te.maxX,te.maxY,((pe,Te,We,Le)=>(function(Fe,ot,gt,Ct,Gt){for(const Zt of Fe)if(ot<=Zt.x&&gt<=Zt.y&&Ct>=Zt.x&&Gt>=Zt.y)return!0;const Ft=[new M(ot,gt),new M(ot,Gt),new M(Ct,Gt),new M(Ct,gt)];if(Fe.length>2){for(const Zt of Ft)if(dd(Fe,Zt))return!0}for(let Zt=0;Zt<Fe.length-1;Zt++)if(wy(Fe[Zt],Fe[Zt+1],Ft))return!0;return!1})(r.cameraQueryGeometry,pe-F,Te-F,We+F,Le+F)));for(const pe of ie)X.push(pe);X.sort(ev);const re={};let oe;for(let pe=0;pe<X.length;pe++){const Te=X[pe];if(Te===oe)continue;oe=Te;const We=this.featureIndexArray.get(Te);let Le=null;this.loadMatchingFeature(re,We.bucketIndex,We.sourceLayerIndex,We.featureIndex,I,E.layers,E.availableImages,s,p,v,((Fe,ot,gt)=>(Le||(Le=su(Fe)),ot.queryIntersectsFeature({queryGeometry:z,feature:Fe,featureState:gt,geometry:Le,zoom:this.z,transform:r.transform,pixelsToTileUnits:A,pixelPosMatrix:r.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:r.getElevation}))))}return re}loadMatchingFeature(r,s,p,v,E,A,I,z,F,$,X){const te=this.bucketLayerIDs[s];if(A&&!te.some((pe=>A.has(pe))))return;const ie=this.sourceLayerCoder.decode(p),re=this.vtLayers[ie].feature(v);if(E.needGeometry){const pe=xl(re,!0);if(!E.filter(new ki(this.tileID.overscaledZ),pe,this.tileID.canonical))return}else if(!E.filter(new ki(this.tileID.overscaledZ),re))return;const oe=this.getId(re,ie);for(let pe=0;pe<te.length;pe++){const Te=te[pe];if(A&&!A.has(Te))continue;const We=z[Te];if(!We)continue;let Le={};oe&&$&&(Le=$.getState(We.sourceLayer||"_geojsonTileLayer",oe));const Fe=si({},F[Te]);Fe.paint=Jy(Fe.paint,We.paint,re,Le,I),Fe.layout=Jy(Fe.layout,We.layout,re,Le,I);const ot=!X||X(re,We,Le);if(!ot)continue;const gt=new uf(re,this.z,this.x,this.y,oe);gt.layer=Fe;let Ct=r[Te];Ct===void 0&&(Ct=r[Te]=[]),Ct.push({featureIndex:v,feature:gt,intersectionZ:ot})}}lookupSymbolFeatures(r,s,p,v,E,A,I,z){const F={};this.loadVTLayers();const $=ut(E);for(const X of r)this.loadMatchingFeature(F,p,v,X,$,A,I,z,s);return F}hasLayer(r){for(const s of this.bucketLayerIDs)for(const p of s)if(r===p)return!0;return!1}getId(r,s){var p;let v=r.id;return this.promoteId&&(v=r.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[s]],typeof v=="boolean"&&(v=Number(v)),v===void 0&&(!((p=r.properties)===null||p===void 0)&&p.cluster)&&this.promoteId&&(v=Number(r.properties.cluster_id))),v}}function Jy(l,r,s,p,v){return ds(l,((E,A)=>{const I=r instanceof hc?r.get(A):null;return I&&I.evaluate?I.evaluate(s,p,v):I}))}function ev(l,r){return r-l}function tv(l,r,s,p,v){const E=[];for(let A=0;A<l.length;A++){const I=l[A];let z;for(let F=0;F<I.length-1;F++){let $=I[F],X=I[F+1];$.x<r&&X.x<r||($.x<r?$=new M(r,$.y+(r-$.x)/(X.x-$.x)*(X.y-$.y))._round():X.x<r&&(X=new M(r,$.y+(r-$.x)/(X.x-$.x)*(X.y-$.y))._round()),$.y<s&&X.y<s||($.y<s?$=new M($.x+(s-$.y)/(X.y-$.y)*(X.x-$.x),s)._round():X.y<s&&(X=new M($.x+(s-$.y)/(X.y-$.y)*(X.x-$.x),s)._round()),$.x>=p&&X.x>=p||($.x>=p?$=new M(p,$.y+(p-$.x)/(X.x-$.x)*(X.y-$.y))._round():X.x>=p&&(X=new M(p,$.y+(p-$.x)/(X.x-$.x)*(X.y-$.y))._round()),$.y>=v&&X.y>=v||($.y>=v?$=new M($.x+(v-$.y)/(X.y-$.y)*(X.x-$.x),v)._round():X.y>=v&&(X=new M($.x+(v-$.y)/(X.y-$.y)*(X.x-$.x),v)._round()),z&&$.equals(z[z.length-1])||(z=[$],E.push(z)),z.push(X)))))}}return E}Yt("FeatureIndex",ap,{omit:["rawTileData","sourceLayerCoder"]});class kh extends M{constructor(r,s,p,v){super(r,s),this.angle=p,v!==void 0&&(this.segment=v)}clone(){return new kh(this.x,this.y,this.angle,this.segment)}}function i_(l,r,s,p,v){if(r.segment===void 0||s===0)return!0;let E=r,A=r.segment+1,I=0;for(;I>-s/2;){if(A--,A<0)return!1;I-=l[A].dist(E),E=l[A]}I+=l[A].dist(l[A+1]),A++;const z=[];let F=0;for(;I<s/2;){const $=l[A],X=l[A+1];if(!X)return!1;let te=l[A-1].angleTo($)-$.angleTo(X);for(te=Math.abs((te+3*Math.PI)%(2*Math.PI)-Math.PI),z.push({distance:I,angleDelta:te}),F+=te;I-z[0].distance>p;)F-=z.shift().angleDelta;if(F>v)return!1;A++,I+=$.dist(X)}return!0}function r_(l){let r=0;for(let s=0;s<l.length-1;s++)r+=l[s].dist(l[s+1]);return r}function gr(l,r,s){return l?.6*r*s:0}function ym(l,r){return Math.max(l?l.right-l.left:0,r?r.right-r.left:0)}function io(l,r,s,p,v,E){const A=gr(s,v,E),I=ym(s,p)*E;let z=0;const F=r_(l)/2;for(let $=0;$<l.length-1;$++){const X=l[$],te=l[$+1],ie=X.dist(te);if(z+ie>F){const re=(F-z)/ie,oe=ws.number(X.x,te.x,re),pe=ws.number(X.y,te.y,re),Te=new kh(oe,pe,te.angleTo(X),$);return Te._round(),!A||i_(l,Te,I,A,r)?Te:void 0}z+=ie}}function gb(l,r,s,p,v,E,A,I,z){const F=gr(p,E,A),$=ym(p,v),X=$*A,te=l[0].x===0||l[0].x===z||l[0].y===0||l[0].y===z;return r-X<r/4&&(r=X+r/4),a_(l,te?r/2*I%r:($/2+2*E)*A*I%r,r,F,s,X,te,!1,z)}function a_(l,r,s,p,v,E,A,I,z){const F=E/2,$=r_(l);let X=0,te=r-s,ie=[];for(let re=0;re<l.length-1;re++){const oe=l[re],pe=l[re+1],Te=oe.dist(pe),We=pe.angleTo(oe);for(;te+s<X+Te;){te+=s;const Le=(te-X)/Te,Fe=ws.number(oe.x,pe.x,Le),ot=ws.number(oe.y,pe.y,Le);if(Fe>=0&&Fe<z&&ot>=0&&ot<z&&te-F>=0&&te+F<=$){const gt=new kh(Fe,ot,We,re);gt._round(),p&&!i_(l,gt,E,p,v)||ie.push(gt)}}X+=Te}return I||ie.length||A||(ie=a_(l,X/2,s,p,v,E,A,!0,z)),ie}function nv(l,r,s,p){const v=[],E=l.image,A=E.pixelRatio,I=E.paddedRect.w-2,z=E.paddedRect.h-2;let F={x1:l.left,y1:l.top,x2:l.right,y2:l.bottom};const $=E.stretchX||[[0,I]],X=E.stretchY||[[0,z]],te=(St,Sn)=>St+Sn[1]-Sn[0],ie=$.reduce(te,0),re=X.reduce(te,0),oe=I-ie,pe=z-re;let Te=0,We=ie,Le=0,Fe=re,ot=0,gt=oe,Ct=0,Gt=pe;if(E.content&&p){const St=E.content,Sn=St[2]-St[0],Pn=St[3]-St[1];(E.textFitWidth||E.textFitHeight)&&(F=Kg(l)),Te=cf($,0,St[0]),Le=cf(X,0,St[1]),We=cf($,St[0],St[2]),Fe=cf(X,St[1],St[3]),ot=St[0]-Te,Ct=St[1]-Le,gt=Sn-We,Gt=Pn-Fe}const Ft=F.x1,Zt=F.y1,dn=F.x2-Ft,qt=F.y2-Zt,Ut=(St,Sn,Pn,mn)=>{const un=Cd(St.stretch-Te,We,dn,Ft),Qn=sp(St.fixed-ot,gt,St.stretch,ie),Kr=Cd(Sn.stretch-Le,Fe,qt,Zt),ya=sp(Sn.fixed-Ct,Gt,Sn.stretch,re),us=Cd(Pn.stretch-Te,We,dn,Ft),El=sp(Pn.fixed-ot,gt,Pn.stretch,ie),yo=Cd(mn.stretch-Le,Fe,qt,Zt),Da=sp(mn.fixed-Ct,Gt,mn.stretch,re),Rr=new M(un,Kr),za=new M(us,Kr),va=new M(us,yo),cs=new M(un,yo),vo=new M(Qn/A,ya/A),Ko=new M(El/A,Da/A),ba=r*Math.PI/180;if(ba){const Oa=Math.sin(ba),xa=Math.cos(ba),_r=[xa,-Oa,Oa,xa];Rr._matMult(_r),za._matMult(_r),cs._matMult(_r),va._matMult(_r)}const Rs=St.stretch+St.fixed,ca=Sn.stretch+Sn.fixed;return{tl:Rr,tr:za,bl:cs,br:va,tex:{x:E.paddedRect.x+1+Rs,y:E.paddedRect.y+1+ca,w:Pn.stretch+Pn.fixed-Rs,h:mn.stretch+mn.fixed-ca},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:vo,pixelOffsetBR:Ko,minFontScaleX:gt/A/dn,minFontScaleY:Gt/A/qt,isSDF:s}};if(p&&(E.stretchX||E.stretchY)){const St=vm($,oe,ie),Sn=vm(X,pe,re);for(let Pn=0;Pn<St.length-1;Pn++){const mn=St[Pn],un=St[Pn+1];for(let Qn=0;Qn<Sn.length-1;Qn++)v.push(Ut(mn,Sn[Qn],un,Sn[Qn+1]))}}else v.push(Ut({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:I+1},{fixed:0,stretch:z+1}));return v}function cf(l,r,s){let p=0;for(const v of l)p+=Math.max(r,Math.min(s,v[1]))-Math.max(r,Math.min(s,v[0]));return p}function vm(l,r,s){const p=[{fixed:-1,stretch:0}];for(const[v,E]of l){const A=p[p.length-1];p.push({fixed:v-A.stretch,stretch:A.stretch}),p.push({fixed:v-A.stretch,stretch:A.stretch+(E-v)})}return p.push({fixed:r+1,stretch:s}),p}function Cd(l,r,s,p){return l/r*s+p}function sp(l,r,s,p){return l-r*s/p}Yt("Anchor",kh);class op{constructor(r,s,p,v,E,A,I,z,F,$){var X;if(this.boxStartIndex=r.length,F){let te=A.top,ie=A.bottom;const re=A.collisionPadding;re&&(te-=re[1],ie+=re[3]);let oe=ie-te;oe>0&&(oe=Math.max(10,oe),this.circleDiameter=oe)}else{const te=!((X=A.image)===null||X===void 0)&&X.content&&(A.image.textFitWidth||A.image.textFitHeight)?Kg(A):{x1:A.left,y1:A.top,x2:A.right,y2:A.bottom};te.y1=te.y1*I-z[0],te.y2=te.y2*I+z[2],te.x1=te.x1*I-z[3],te.x2=te.x2*I+z[1];const ie=A.collisionPadding;if(ie&&(te.x1-=ie[0]*I,te.y1-=ie[1]*I,te.x2+=ie[2]*I,te.y2+=ie[3]*I),$){const re=new M(te.x1,te.y1),oe=new M(te.x2,te.y1),pe=new M(te.x1,te.y2),Te=new M(te.x2,te.y2),We=$*Math.PI/180;re._rotate(We),oe._rotate(We),pe._rotate(We),Te._rotate(We),te.x1=Math.min(re.x,oe.x,pe.x,Te.x),te.x2=Math.max(re.x,oe.x,pe.x,Te.x),te.y1=Math.min(re.y,oe.y,pe.y,Te.y),te.y2=Math.max(re.y,oe.y,pe.y,Te.y)}r.emplaceBack(s.x,s.y,te.x1,te.y1,te.x2,te.y2,p,v,E)}this.boxEndIndex=r.length}}class s_{constructor(r=[],s=(p,v)=>p<v?-1:p>v?1:0){if(this.data=r,this.length=this.data.length,this.compare=s,this.length>0)for(let p=(this.length>>1)-1;p>=0;p--)this._down(p)}push(r){this.data.push(r),this._up(this.length++)}pop(){if(this.length===0)return;const r=this.data[0],s=this.data.pop();return--this.length>0&&(this.data[0]=s,this._down(0)),r}peek(){return this.data[0]}_up(r){const{data:s,compare:p}=this,v=s[r];for(;r>0;){const E=r-1>>1,A=s[E];if(p(v,A)>=0)break;s[r]=A,r=E}s[r]=v}_down(r){const{data:s,compare:p}=this,v=this.length>>1,E=s[r];for(;r<v;){let A=1+(r<<1);const I=A+1;if(I<this.length&&p(s[I],s[A])<0&&(A=I),p(s[A],E)>=0)break;s[r]=s[A],r=A}s[r]=E}}function o_(l,r=1,s=!1){const p=Lh.fromPoints(l[0]),v=Math.min(p.width(),p.height());let E=v/2;const A=new s_([],_b),{minX:I,minY:z,maxX:F,maxY:$}=p;if(v===0)return new M(I,z);for(let ie=I;ie<F;ie+=v)for(let re=z;re<$;re+=v)A.push(new Md(ie+E,re+E,E,l));let X=(function(ie){let re=0,oe=0,pe=0;const Te=ie[0];for(let We=0,Le=Te.length,Fe=Le-1;We<Le;Fe=We++){const ot=Te[We],gt=Te[Fe],Ct=ot.x*gt.y-gt.x*ot.y;oe+=(ot.x+gt.x)*Ct,pe+=(ot.y+gt.y)*Ct,re+=3*Ct}return new Md(oe/re,pe/re,0,ie)})(l),te=A.length;for(;A.length;){const ie=A.pop();(ie.d>X.d||!X.d)&&(X=ie,s&&console.log("found best %d after %d probes",Math.round(1e4*ie.d)/1e4,te)),ie.max-X.d<=r||(E=ie.h/2,A.push(new Md(ie.p.x-E,ie.p.y-E,E,l)),A.push(new Md(ie.p.x+E,ie.p.y-E,E,l)),A.push(new Md(ie.p.x-E,ie.p.y+E,E,l)),A.push(new Md(ie.p.x+E,ie.p.y+E,E,l)),te+=4)}return s&&(console.log(`num probes: ${te}`),console.log(`best distance: ${X.d}`)),X.p}function _b(l,r){return r.max-l.max}function Md(l,r,s,p){this.p=new M(l,r),this.h=s,this.d=(function(v,E){let A=!1,I=1/0;for(let z=0;z<E.length;z++){const F=E[z];for(let $=0,X=F.length,te=X-1;$<X;te=$++){const ie=F[$],re=F[te];ie.y>v.y!=re.y>v.y&&v.x<(re.x-ie.x)*(v.y-ie.y)/(re.y-ie.y)+ie.x&&(A=!A),I=Math.min(I,Sh(v,ie,re))}}return(A?1:-1)*Math.sqrt(I)})(this.p,p),this.max=this.d+this.h*Math.SQRT2}var Ps;_.aE=void 0,(Ps=_.aE||(_.aE={}))[Ps.center=1]="center",Ps[Ps.left=2]="left",Ps[Ps.right=3]="right",Ps[Ps.top=4]="top",Ps[Ps.bottom=5]="bottom",Ps[Ps["top-left"]=6]="top-left",Ps[Ps["top-right"]=7]="top-right",Ps[Ps["bottom-left"]=8]="bottom-left",Ps[Ps["bottom-right"]=9]="bottom-right";const bm=Number.POSITIVE_INFINITY;function iv(l,r){return r[1]!==bm?(function(s,p,v){let E=0,A=0;switch(p=Math.abs(p),v=Math.abs(v),s){case"top-right":case"top-left":case"top":A=v-7;break;case"bottom-right":case"bottom-left":case"bottom":A=7-v}switch(s){case"top-right":case"bottom-right":case"right":E=-p;break;case"top-left":case"bottom-left":case"left":E=p}return[E,A]})(l,r[0],r[1]):(function(s,p){let v=0,E=0;p<0&&(p=0);const A=p/Math.SQRT2;switch(s){case"top-right":case"top-left":E=A-7;break;case"bottom-right":case"bottom-left":E=7-A;break;case"bottom":E=7-p;break;case"top":E=p-7}switch(s){case"top-right":case"bottom-right":v=-A;break;case"top-left":case"bottom-left":v=A;break;case"left":v=p;break;case"right":v=-p}return[v,E]})(l,r[0])}function rv(l,r,s){var p;const v=l.layout,E=(p=v.get("text-variable-anchor-offset"))===null||p===void 0?void 0:p.evaluate(r,{},s);if(E){const I=E.values,z=[];for(let F=0;F<I.length;F+=2){const $=z[F]=I[F],X=I[F+1].map((te=>te*Wr));$.startsWith("top")?X[1]-=7:$.startsWith("bottom")&&(X[1]+=7),z[F+1]=X}return new ar(z)}const A=v.get("text-variable-anchor");if(A){let I;I=l._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[v.get("text-radial-offset").evaluate(r,{},s)*Wr,bm]:v.get("text-offset").evaluate(r,{},s).map((F=>F*Wr));const z=[];for(const F of A)z.push(F,iv(F,I));return new ar(z)}return null}function wc(l){switch(l){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function av(l,r,s,p,v,E,A,I,z,F,$,X){let te=E.textMaxSize.evaluate(r,{});te===void 0&&(te=A);const ie=l.layers[0].layout,re=ie.get("icon-offset").evaluate(r,{},$),oe=xm(s.horizontal),pe=A/24,Te=l.tilePixelRatio*pe,We=l.tilePixelRatio*te/24,Le=l.tilePixelRatio*I,Fe=l.tilePixelRatio*ie.get("symbol-spacing"),ot=ie.get("text-padding")*l.tilePixelRatio,gt=(function(Pn,mn,un,Qn=1){const Kr=Pn.get("icon-padding").evaluate(mn,{},un),ya=Kr&&Kr.values;return[ya[0]*Qn,ya[1]*Qn,ya[2]*Qn,ya[3]*Qn]})(ie,r,$,l.tilePixelRatio),Ct=ie.get("text-max-angle")/180*Math.PI,Gt=ie.get("text-rotation-alignment")!=="viewport"&&ie.get("symbol-placement")!=="point",Ft=ie.get("icon-rotation-alignment")==="map"&&ie.get("symbol-placement")!=="point",Zt=ie.get("symbol-placement"),dn=Fe/2,qt=ie.get("icon-text-fit");let Ut;p&&qt!=="none"&&(l.allowVerticalPlacement&&s.vertical&&(Ut=Yg(p,s.vertical,qt,ie.get("icon-text-fit-padding"),re,pe)),oe&&(p=Yg(p,oe,qt,ie.get("icon-text-fit-padding"),re,pe)));const St=$?X.line.getGranularityForZoomLevel($.z):1,Sn=(Pn,mn)=>{mn.x<0||mn.x>=zt||mn.y<0||mn.y>=zt||(function(un,Qn,Kr,ya,us,El,yo,Da,Rr,za,va,cs,vo,Ko,ba,Rs,ca,Oa,xa,_r,Ci,Ls,Tc,Yo,Dh){const df=un.addToLineVertexArray(Qn,Kr);let zh,Sc,ff,Pd,hp=0,u_=0,ov=0,dp=0,pf=-1,Mm=-1;const Al={};let c_=qc("");if(un.allowVerticalPlacement&&ya.vertical){const bt=Da.layout.get("text-rotate").evaluate(Ci,{},Yo)+90;ff=new op(Rr,Qn,za,va,cs,ya.vertical,vo,Ko,ba,bt),yo&&(Pd=new op(Rr,Qn,za,va,cs,yo,ca,Oa,ba,bt))}if(us){const bt=Da.layout.get("icon-rotate").evaluate(Ci,{}),Et=Da.layout.get("icon-text-fit")!=="none",ft=nv(us,bt,Tc,Et),yt=yo?nv(yo,bt,Tc,Et):void 0;Sc=new op(Rr,Qn,za,va,cs,us,ca,Oa,!1,bt),hp=4*ft.length;const cn=un.iconSizeData;let En=null;cn.kind==="source"?(En=[vc*Da.layout.get("icon-size").evaluate(Ci,{})],En[0]>Yc&&Ii(`${un.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):cn.kind==="composite"&&(En=[vc*Ls.compositeIconSizes[0].evaluate(Ci,{},Yo),vc*Ls.compositeIconSizes[1].evaluate(Ci,{},Yo)],(En[0]>Yc||En[1]>Yc)&&Ii(`${un.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),un.addSymbols(un.icon,ft,En,_r,xa,Ci,_.ao.none,Qn,df.lineStartIndex,df.lineLength,-1,Yo),pf=un.icon.placedSymbolArray.length-1,yt&&(u_=4*yt.length,un.addSymbols(un.icon,yt,En,_r,xa,Ci,_.ao.vertical,Qn,df.lineStartIndex,df.lineLength,-1,Yo),Mm=un.icon.placedSymbolArray.length-1)}const Im=Object.keys(ya.horizontal);for(const bt of Im){const Et=ya.horizontal[bt];if(!zh){c_=qc(Et.text);const yt=Da.layout.get("text-rotate").evaluate(Ci,{},Yo);zh=new op(Rr,Qn,za,va,cs,Et,vo,Ko,ba,yt)}const ft=Et.positionedLines.length===1;if(ov+=l_(un,Qn,Et,El,Da,ba,Ci,Rs,df,ya.vertical?_.ao.horizontal:_.ao.horizontalOnly,ft?Im:[bt],Al,pf,Ls,Yo),ft)break}ya.vertical&&(dp+=l_(un,Qn,ya.vertical,El,Da,ba,Ci,Rs,df,_.ao.vertical,["vertical"],Al,Mm,Ls,Yo));const Pm=zh?zh.boxStartIndex:un.collisionBoxArray.length,lv=zh?zh.boxEndIndex:un.collisionBoxArray.length,vb=ff?ff.boxStartIndex:un.collisionBoxArray.length,Rm=ff?ff.boxEndIndex:un.collisionBoxArray.length,a=Sc?Sc.boxStartIndex:un.collisionBoxArray.length,h=Sc?Sc.boxEndIndex:un.collisionBoxArray.length,y=Pd?Pd.boxStartIndex:un.collisionBoxArray.length,w=Pd?Pd.boxEndIndex:un.collisionBoxArray.length;let D=-1;const B=(bt,Et)=>bt&&bt.circleDiameter?Math.max(bt.circleDiameter,Et):Et;D=B(zh,D),D=B(ff,D),D=B(Sc,D),D=B(Pd,D);const Q=D>-1?1:0;Q&&(D*=Dh/Wr),un.glyphOffsetArray.length>=of.MAX_GLYPHS&&Ii("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Ci.sortKey!==void 0&&un.addToSortKeyRanges(un.symbolInstances.length,Ci.sortKey);const he=rv(Da,Ci,Yo),[je,dt]=(function(bt,Et){const ft=bt.length,yt=Et==null?void 0:Et.values;if((yt==null?void 0:yt.length)>0)for(let cn=0;cn<yt.length;cn+=2){const En=yt[cn+1];bt.emplaceBack(_.aE[yt[cn]],En[0],En[1])}return[ft,bt.length]})(un.textAnchorOffsets,he);un.symbolInstances.emplaceBack(Qn.x,Qn.y,Al.right>=0?Al.right:-1,Al.center>=0?Al.center:-1,Al.left>=0?Al.left:-1,Al.vertical||-1,pf,Mm,c_,Pm,lv,vb,Rm,a,h,y,w,za,ov,dp,hp,u_,Q,0,vo,D,je,dt)})(l,mn,Pn,s,p,v,Ut,l.layers[0],l.collisionBoxArray,r.index,r.sourceLayerIndex,l.index,Te,[ot,ot,ot,ot],Gt,z,Le,gt,Ft,re,r,E,F,$,A)};if(Zt==="line")for(const Pn of tv(r.geometry,0,0,zt,zt)){const mn=Jr(Pn,St),un=gb(mn,Fe,Ct,s.vertical||oe,p,24,We,l.overscaling,zt);for(const Qn of un)oe&&yb(l,oe.text,dn,Qn)||Sn(mn,Qn)}else if(Zt==="line-center"){for(const Pn of r.geometry)if(Pn.length>1){const mn=Jr(Pn,St),un=io(mn,Ct,s.vertical||oe,p,24,We);un&&Sn(mn,un)}}else if(r.type==="Polygon")for(const Pn of Xu(r.geometry,0)){const mn=o_(Pn,16);Sn(Jr(Pn[0],St,!0),new kh(mn.x,mn.y,0))}else if(r.type==="LineString")for(const Pn of r.geometry){const mn=Jr(Pn,St);Sn(mn,new kh(mn[0].x,mn[0].y,0))}else if(r.type==="Point")for(const Pn of r.geometry)for(const mn of Pn)Sn([mn],new kh(mn.x,mn.y,0))}function l_(l,r,s,p,v,E,A,I,z,F,$,X,te,ie,re){const oe=(function(We,Le,Fe,ot,gt,Ct,Gt,Ft){const Zt=ot.layout.get("text-rotate").evaluate(Ct,{})*Math.PI/180,dn=[];for(const qt of Le.positionedLines)for(const Ut of qt.positionedGlyphs){if(!Ut.rect)continue;const St=Ut.rect||{};let Sn=4,Pn=!0,mn=1,un=0;const Qn=(gt||Ft)&&Ut.vertical,Kr=Ut.metrics.advance*Ut.scale/2;if(Ft&&Le.verticalizable&&(un=qt.lineOffset/2-(Ut.imageName?-(Wr-Ut.metrics.width*Ut.scale)/2:(Ut.scale-1)*Wr)),Ut.imageName){const Oa=Gt[Ut.imageName];Pn=Oa.sdf,mn=Oa.pixelRatio,Sn=1/mn}const ya=gt?[Ut.x+Kr,Ut.y]:[0,0];let us=gt?[0,0]:[Ut.x+Kr+Fe[0],Ut.y+Fe[1]-un],El=[0,0];Qn&&(El=us,us=[0,0]);const yo=Ut.metrics.isDoubleResolution?2:1,Da=(Ut.metrics.left-Sn)*Ut.scale-Kr+us[0],Rr=(-Ut.metrics.top-Sn)*Ut.scale+us[1],za=Da+St.w/yo*Ut.scale/mn,va=Rr+St.h/yo*Ut.scale/mn,cs=new M(Da,Rr),vo=new M(za,Rr),Ko=new M(Da,va),ba=new M(za,va);if(Qn){const Oa=new M(-Kr,Kr- -17),xa=-Math.PI/2,_r=12-Kr,Ci=new M(22-_r,-(Ut.imageName?_r:0)),Ls=new M(...El);cs._rotateAround(xa,Oa)._add(Ci)._add(Ls),vo._rotateAround(xa,Oa)._add(Ci)._add(Ls),Ko._rotateAround(xa,Oa)._add(Ci)._add(Ls),ba._rotateAround(xa,Oa)._add(Ci)._add(Ls)}if(Zt){const Oa=Math.sin(Zt),xa=Math.cos(Zt),_r=[xa,-Oa,Oa,xa];cs._matMult(_r),vo._matMult(_r),Ko._matMult(_r),ba._matMult(_r)}const Rs=new M(0,0),ca=new M(0,0);dn.push({tl:cs,tr:vo,bl:Ko,br:ba,tex:St,writingMode:Le.writingMode,glyphOffset:ya,sectionIndex:Ut.sectionIndex,isSDF:Pn,pixelOffsetTL:Rs,pixelOffsetBR:ca,minFontScaleX:0,minFontScaleY:0})}return dn})(0,s,I,v,E,A,p,l.allowVerticalPlacement),pe=l.textSizeData;let Te=null;pe.kind==="source"?(Te=[vc*v.layout.get("text-size").evaluate(A,{})],Te[0]>Yc&&Ii(`${l.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):pe.kind==="composite"&&(Te=[vc*ie.compositeTextSizes[0].evaluate(A,{},re),vc*ie.compositeTextSizes[1].evaluate(A,{},re)],(Te[0]>Yc||Te[1]>Yc)&&Ii(`${l.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),l.addSymbols(l.text,oe,Te,I,E,A,F,r,z.lineStartIndex,z.lineLength,te,re);for(const We of $)X[We]=l.text.placedSymbolArray.length-1;return 4*oe.length}function xm(l){for(const r in l)return l[r];return null}function yb(l,r,s,p){const v=l.compareText;if(r in v){const E=v[r];for(let A=E.length-1;A>=0;A--)if(p.dist(E[A])<s)return!0}else v[r]=[];return v[r].push(p),!1}const sv=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class wm{static from(r){if(!(r instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[s,p]=new Uint8Array(r,0,2);if(s!==219)throw new Error("Data does not appear to be in a KDBush format.");const v=p>>4;if(v!==1)throw new Error(`Got v${v} data when expected v1.`);const E=sv[15&p];if(!E)throw new Error("Unrecognized array type.");const[A]=new Uint16Array(r,2,1),[I]=new Uint32Array(r,4,1);return new wm(I,A,E,r)}constructor(r,s=64,p=Float64Array,v){if(isNaN(r)||r<0)throw new Error(`Unpexpected numItems value: ${r}.`);this.numItems=+r,this.nodeSize=Math.min(Math.max(+s,2),65535),this.ArrayType=p,this.IndexArrayType=r<65536?Uint16Array:Uint32Array;const E=sv.indexOf(this.ArrayType),A=2*r*this.ArrayType.BYTES_PER_ELEMENT,I=r*this.IndexArrayType.BYTES_PER_ELEMENT,z=(8-I%8)%8;if(E<0)throw new Error(`Unexpected typed array class: ${p}.`);v&&v instanceof ArrayBuffer?(this.data=v,this.ids=new this.IndexArrayType(this.data,8,r),this.coords=new this.ArrayType(this.data,8+I+z,2*r),this._pos=2*r,this._finished=!0):(this.data=new ArrayBuffer(8+A+I+z),this.ids=new this.IndexArrayType(this.data,8,r),this.coords=new this.ArrayType(this.data,8+I+z,2*r),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+E]),new Uint16Array(this.data,2,1)[0]=s,new Uint32Array(this.data,4,1)[0]=r)}add(r,s){const p=this._pos>>1;return this.ids[p]=p,this.coords[this._pos++]=r,this.coords[this._pos++]=s,p}finish(){const r=this._pos>>1;if(r!==this.numItems)throw new Error(`Added ${r} items when expected ${this.numItems}.`);return lp(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(r,s,p,v){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:E,coords:A,nodeSize:I}=this,z=[0,E.length-1,0],F=[];for(;z.length;){const $=z.pop()||0,X=z.pop()||0,te=z.pop()||0;if(X-te<=I){for(let pe=te;pe<=X;pe++){const Te=A[2*pe],We=A[2*pe+1];Te>=r&&Te<=p&&We>=s&&We<=v&&F.push(E[pe])}continue}const ie=te+X>>1,re=A[2*ie],oe=A[2*ie+1];re>=r&&re<=p&&oe>=s&&oe<=v&&F.push(E[ie]),($===0?r<=re:s<=oe)&&(z.push(te),z.push(ie-1),z.push(1-$)),($===0?p>=re:v>=oe)&&(z.push(ie+1),z.push(X),z.push(1-$))}return F}within(r,s,p){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:v,coords:E,nodeSize:A}=this,I=[0,v.length-1,0],z=[],F=p*p;for(;I.length;){const $=I.pop()||0,X=I.pop()||0,te=I.pop()||0;if(X-te<=A){for(let pe=te;pe<=X;pe++)Sm(E[2*pe],E[2*pe+1],r,s)<=F&&z.push(v[pe]);continue}const ie=te+X>>1,re=E[2*ie],oe=E[2*ie+1];Sm(re,oe,r,s)<=F&&z.push(v[ie]),($===0?r-p<=re:s-p<=oe)&&(I.push(te),I.push(ie-1),I.push(1-$)),($===0?r+p>=re:s+p>=oe)&&(I.push(ie+1),I.push(X),I.push(1-$))}return z}}function lp(l,r,s,p,v,E){if(v-p<=s)return;const A=p+v>>1;Tm(l,r,A,p,v,E),lp(l,r,s,p,A-1,1-E),lp(l,r,s,A+1,v,1-E)}function Tm(l,r,s,p,v,E){for(;v>p;){if(v-p>600){const F=v-p+1,$=s-p+1,X=Math.log(F),te=.5*Math.exp(2*X/3),ie=.5*Math.sqrt(X*te*(F-te)/F)*($-F/2<0?-1:1);Tm(l,r,s,Math.max(p,Math.floor(s-$*te/F+ie)),Math.min(v,Math.floor(s+(F-$)*te/F+ie)),E)}const A=r[2*s+E];let I=p,z=v;for(up(l,r,p,s),r[2*v+E]>A&&up(l,r,p,v);I<z;){for(up(l,r,I,z),I++,z--;r[2*I+E]<A;)I++;for(;r[2*z+E]>A;)z--}r[2*p+E]===A?up(l,r,p,z):(z++,up(l,r,z,v)),z<=s&&(p=z+1),s<=z&&(v=z-1)}}function up(l,r,s,p){Tl(l,s,p),Tl(r,2*s,2*p),Tl(r,2*s+1,2*p+1)}function Tl(l,r,s){const p=l[r];l[r]=l[s],l[s]=p}function Sm(l,r,s,p){const v=l-s,E=r-p;return v*v+E*E}var Em;_.cx=void 0,(Em=_.cx||(_.cx={})).create="create",Em.load="load",Em.fullLoad="fullLoad";let cp=null,hf=[];const Id=1e3/60,Sl="loadTime",Am="fullLoadTime",Cm={mark(l){performance.mark(l)},frame(l){const r=l;cp!=null&&hf.push(r-cp),cp=r},clearMetrics(){cp=null,hf=[],performance.clearMeasures(Sl),performance.clearMeasures(Am);for(const l in _.cx)performance.clearMarks(_.cx[l])},getPerformanceMetrics(){performance.measure(Sl,_.cx.create,_.cx.load),performance.measure(Am,_.cx.create,_.cx.fullLoad);const l=performance.getEntriesByName(Sl)[0].duration,r=performance.getEntriesByName(Am)[0].duration,s=hf.length,p=1/(hf.reduce(((E,A)=>E+A),0)/s/1e3),v=hf.filter((E=>E>Id)).reduce(((E,A)=>E+(A-Id)/Id),0);return{loadTime:l,fullLoadTime:r,fps:p,percentDroppedFrames:v/(s+v)*100,totalFrames:s}}};_.$=zt,_.A=qe,_.B=function([l,r,s]){return r+=90,r*=Math.PI/180,s*=Math.PI/180,{x:l*Math.cos(r)*Math.sin(s),y:l*Math.sin(r)*Math.sin(s),z:l*Math.cos(s)}},_.C=ws,_.D=an,_.E=tn,_.F=ki,_.G=Ql,_.H=function(l){if(Bs==null){const r=l.navigator?l.navigator.userAgent:null;Bs=!!l.safari||!(!r||!(/\b(iPad|iPhone|iPod)\b/.test(r)||r.match("Safari")&&!r.match("Chrome")))}return Bs},_.I=_o,_.J=class{constructor(l,r){this.target=l,this.mapId=r,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new Xy((()=>this.process())),this.subscription=so(this.target,"message",(s=>this.receive(s)),!1),this.globalScope=Ta(self)?l:window}registerMessageHandler(l,r){this.messageHandlers[l]=r}sendAsync(l,r){return new Promise(((s,p)=>{const v=Math.round(1e18*Math.random()).toString(36).substring(0,10),E=r?so(r.signal,"abort",(()=>{E==null||E.unsubscribe(),delete this.resolveRejects[v];const z={id:v,type:"<cancel>",origin:location.origin,targetMapId:l.targetMapId,sourceMapId:this.mapId};this.target.postMessage(z)}),Wy):null;this.resolveRejects[v]={resolve:z=>{E==null||E.unsubscribe(),s(z)},reject:z=>{E==null||E.unsubscribe(),p(z)}};const A=[],I=Object.assign(Object.assign({},l),{id:v,sourceMapId:this.mapId,origin:location.origin,data:oc(l.data,A)});this.target.postMessage(I,{transfer:A})}))}receive(l){const r=l.data,s=r.id;if(!(r.origin!=="file://"&&location.origin!=="file://"&&r.origin!=="resource://android"&&location.origin!=="resource://android"&&r.origin!==location.origin||r.targetMapId&&this.mapId!==r.targetMapId)){if(r.type==="<cancel>"){delete this.tasks[s];const p=this.abortControllers[s];return delete this.abortControllers[s],void(p&&p.abort())}if(Ta(self)||r.mustQueue)return this.tasks[s]=r,this.taskQueue.push(s),void this.invoker.trigger();this.processTask(s,r)}}process(){if(this.taskQueue.length===0)return;const l=this.taskQueue.shift(),r=this.tasks[l];delete this.tasks[l],this.taskQueue.length>0&&this.invoker.trigger(),r&&this.processTask(l,r)}processTask(l,r){return c(this,void 0,void 0,(function*(){if(r.type==="<response>"){const v=this.resolveRejects[l];return delete this.resolveRejects[l],v?void(r.error?v.reject(Jl(r.error)):v.resolve(Jl(r.data))):void 0}if(!this.messageHandlers[r.type])return void this.completeTask(l,new Error(`Could not find a registered handler for ${r.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const s=Jl(r.data),p=new AbortController;this.abortControllers[l]=p;try{const v=yield this.messageHandlers[r.type](r.sourceMapId,s,p);this.completeTask(l,null,v)}catch(v){this.completeTask(l,v)}}))}completeTask(l,r,s){const p=[];delete this.abortControllers[l];const v={id:l,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:r?oc(r):null,data:oc(s,p)};this.target.postMessage(v,{transfer:p})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},_.K=fe,_.L=function(){var l=new qe(16);return qe!=Float32Array&&(l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[11]=0,l[12]=0,l[13]=0,l[14]=0),l[0]=1,l[5]=1,l[10]=1,l[15]=1,l},_.M=function(l,r,s){var p,v,E,A,I,z,F,$,X,te,ie,re,oe=s[0],pe=s[1],Te=s[2];return r===l?(l[12]=r[0]*oe+r[4]*pe+r[8]*Te+r[12],l[13]=r[1]*oe+r[5]*pe+r[9]*Te+r[13],l[14]=r[2]*oe+r[6]*pe+r[10]*Te+r[14],l[15]=r[3]*oe+r[7]*pe+r[11]*Te+r[15]):(v=r[1],E=r[2],A=r[3],I=r[4],z=r[5],F=r[6],$=r[7],X=r[8],te=r[9],ie=r[10],re=r[11],l[0]=p=r[0],l[1]=v,l[2]=E,l[3]=A,l[4]=I,l[5]=z,l[6]=F,l[7]=$,l[8]=X,l[9]=te,l[10]=ie,l[11]=re,l[12]=p*oe+I*pe+X*Te+r[12],l[13]=v*oe+z*pe+te*Te+r[13],l[14]=E*oe+F*pe+ie*Te+r[14],l[15]=A*oe+$*pe+re*Te+r[15]),l},_.N=function(l,r,s){var p=s[0],v=s[1],E=s[2];return l[0]=r[0]*p,l[1]=r[1]*p,l[2]=r[2]*p,l[3]=r[3]*p,l[4]=r[4]*v,l[5]=r[5]*v,l[6]=r[6]*v,l[7]=r[7]*v,l[8]=r[8]*E,l[9]=r[9]*E,l[10]=r[10]*E,l[11]=r[11]*E,l[12]=r[12],l[13]=r[13],l[14]=r[14],l[15]=r[15],l},_.O=function(l,r,s){var p=r[0],v=r[1],E=r[2],A=r[3],I=r[4],z=r[5],F=r[6],$=r[7],X=r[8],te=r[9],ie=r[10],re=r[11],oe=r[12],pe=r[13],Te=r[14],We=r[15],Le=s[0],Fe=s[1],ot=s[2],gt=s[3];return l[0]=Le*p+Fe*I+ot*X+gt*oe,l[1]=Le*v+Fe*z+ot*te+gt*pe,l[2]=Le*E+Fe*F+ot*ie+gt*Te,l[3]=Le*A+Fe*$+ot*re+gt*We,l[4]=(Le=s[4])*p+(Fe=s[5])*I+(ot=s[6])*X+(gt=s[7])*oe,l[5]=Le*v+Fe*z+ot*te+gt*pe,l[6]=Le*E+Fe*F+ot*ie+gt*Te,l[7]=Le*A+Fe*$+ot*re+gt*We,l[8]=(Le=s[8])*p+(Fe=s[9])*I+(ot=s[10])*X+(gt=s[11])*oe,l[9]=Le*v+Fe*z+ot*te+gt*pe,l[10]=Le*E+Fe*F+ot*ie+gt*Te,l[11]=Le*A+Fe*$+ot*re+gt*We,l[12]=(Le=s[12])*p+(Fe=s[13])*I+(ot=s[14])*X+(gt=s[15])*oe,l[13]=Le*v+Fe*z+ot*te+gt*pe,l[14]=Le*E+Fe*F+ot*ie+gt*Te,l[15]=Le*A+Fe*$+ot*re+gt*We,l},_.P=M,_.Q=function(l,r){const s={};for(let p=0;p<r.length;p++){const v=r[p];v in l&&(s[v]=l[v])}return s},_.R=Is,_.S=xc,_.T=$f,_.U=pm,_.V=Ky,_.W=Ne,_.X=tt,_.Y=fr,_.Z=Wo,_._=c,_.a=se,_.a$=Re,_.a0=function(l,r){var s,p,v,E;if(!l)return r??{};if(!r)return l;const A=Object.assign({},l);if(r.removeAll&&(A.removeAll=!0),r.remove){const I=new Set(A.remove?A.remove.concat(r.remove):r.remove);A.remove=Array.from(I.values())}if(r.add){const I=A.add?A.add.concat(r.add):r.add,z=new Map(I.map((F=>[F.id,F])));A.add=Array.from(z.values())}if(r.update){const I=new Map((s=A.update)===null||s===void 0?void 0:s.map((z=>[z.id,z])));for(const z of r.update){const F=(p=I.get(z.id))!==null&&p!==void 0?p:{id:z.id};z.newGeometry&&(F.newGeometry=z.newGeometry),z.addOrUpdateProperties&&(F.addOrUpdateProperties=((v=F.addOrUpdateProperties)!==null&&v!==void 0?v:[]).concat(z.addOrUpdateProperties)),z.removeProperties&&(F.removeProperties=((E=F.removeProperties)!==null&&E!==void 0?E:[]).concat(z.removeProperties)),z.removeAllProperties&&(F.removeAllProperties=!0),I.set(z.id,F)}A.update=Array.from(I.values())}return A},_.a1=Qc,_.a2=Lh,_.a3=25,_.a4=gm,_.a5=l=>{const r=window.document.createElement("video");return r.muted=!0,new Promise((s=>{r.onloadstart=()=>{s(r)};for(const p of l){const v=window.document.createElement("source");et(p)||(r.crossOrigin="Anonymous"),v.src=p,r.appendChild(v)}}))},_.a6=Pt,_.a7=function(){return di++},_.a8=H,_.a9=of,_.aA=function(l){let r=1/0,s=1/0,p=-1/0,v=-1/0;for(const E of l)r=Math.min(r,E.x),s=Math.min(s,E.y),p=Math.max(p,E.x),v=Math.max(v,E.y);return[r,s,p,v]},_.aB=Wr,_.aC=Bt,_.aD=function(l,r,s,p,v=!1){if(!s[0]&&!s[1])return[0,0];const E=v?p==="map"?-l.bearingInRadians:0:p==="viewport"?l.bearingInRadians:0;if(E){const A=Math.sin(E),I=Math.cos(E);s=[s[0]*I-s[1]*A,s[0]*A+s[1]*I]}return[v?s[0]:Bt(r,s[0],l.zoom),v?s[1]:Bt(r,s[1],l.zoom)]},_.aF=cm,_.aG=wc,_.aH=Xg,_.aI=wm,_.aJ=Nr,_.aK=Xf,_.aL=Me,_.aM=Un,_.aN=Wi,_.aO=Fn,_.aP=fs,_.aQ=Yy,_.aR=Ae,_.aS=_e,_.aT=function(l){var r=new qe(3);return r[0]=l[0],r[1]=l[1],r[2]=l[2],r},_.aU=function(l,r,s){return l[0]=r[0]-s[0],l[1]=r[1]-s[1],l[2]=r[2]-s[2],l},_.aV=function(l,r){var s=r[0],p=r[1],v=r[2],E=s*s+p*p+v*v;return E>0&&(E=1/Math.sqrt(E)),l[0]=r[0]*E,l[1]=r[1]*E,l[2]=r[2]*E,l},_.aW=Pe,_.aX=function(l,r){return l[0]*r[0]+l[1]*r[1]+l[2]*r[2]},_.aY=function(l,r,s){return l[0]=r[0]*s[0],l[1]=r[1]*s[1],l[2]=r[2]*s[2],l[3]=r[3]*s[3],l},_.aZ=de,_.a_=function(l,r,s){const p=r[0]*s[0]+r[1]*s[1]+r[2]*s[2];return p===0?null:(-(l[0]*s[0]+l[1]*s[1]+l[2]*s[2])-s[3])/p},_.aa=ut,_.ab=xl,_.ac=uf,_.ad=function(l){const r={};if(l.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((s,p,v,E)=>{const A=v||E;return r[p]=!A||A.toLowerCase(),""})),r["max-age"]){const s=parseInt(r["max-age"],10);isNaN(s)?delete r["max-age"]:r["max-age"]=s}return r},_.ae=$r,_.af=function(l){return Math.pow(2,l)},_.ag=Ue,_.ah=Xt,_.ai=85.051129,_.aj=mm,_.ak=function(l){return Math.log(l)/Math.LN2},_.al=function(l){var r=l[0],s=l[1];return r*r+s*s},_.am=function(l,r){const s=[];for(const p in l)p in r||s.push(p);return s},_.an=function(l,r){let s=0,p=0;if(l.kind==="constant")p=l.layoutSize;else if(l.kind!=="source"){const{interpolationType:v,minZoom:E,maxZoom:A}=l,I=v?Xt(or.interpolationFactor(v,r,E,A),0,1):0;l.kind==="camera"?p=ws.number(l.minSize,l.maxSize,I):s=I}return{uSizeT:s,uSize:p}},_.ap=function(l,{uSize:r,uSizeT:s},{lowerSize:p,upperSize:v}){return l.kind==="source"?p/vc:l.kind==="composite"?ws.number(p/vc,v/vc,s):r},_.aq=function(l,r){var s=r[0],p=r[1],v=r[2],E=r[3],A=r[4],I=r[5],z=r[6],F=r[7],$=r[8],X=r[9],te=r[10],ie=r[11],re=r[12],oe=r[13],pe=r[14],Te=r[15],We=s*I-p*A,Le=s*z-v*A,Fe=s*F-E*A,ot=p*z-v*I,gt=p*F-E*I,Ct=v*F-E*z,Gt=$*oe-X*re,Ft=$*pe-te*re,Zt=$*Te-ie*re,dn=X*pe-te*oe,qt=X*Te-ie*oe,Ut=te*Te-ie*pe,St=We*Ut-Le*qt+Fe*dn+ot*Zt-gt*Ft+Ct*Gt;return St?(l[0]=(I*Ut-z*qt+F*dn)*(St=1/St),l[1]=(v*qt-p*Ut-E*dn)*St,l[2]=(oe*Ct-pe*gt+Te*ot)*St,l[3]=(te*gt-X*Ct-ie*ot)*St,l[4]=(z*Zt-A*Ut-F*Ft)*St,l[5]=(s*Ut-v*Zt+E*Ft)*St,l[6]=(pe*Fe-re*Ct-Te*Le)*St,l[7]=($*Ct-te*Fe+ie*Le)*St,l[8]=(A*qt-I*Zt+F*Gt)*St,l[9]=(p*Zt-s*qt-E*Gt)*St,l[10]=(re*gt-oe*Fe+Te*We)*St,l[11]=(X*Fe-$*gt-ie*We)*St,l[12]=(I*Ft-A*dn-z*Gt)*St,l[13]=(s*dn-p*Ft+v*Gt)*St,l[14]=(oe*Le-re*ot-pe*We)*St,l[15]=($*ot-X*Le+te*We)*St,l):null},_.ar=$t,_.as=function(l){return Math.hypot(l[0],l[1])},_.at=function(l){return l[0]=0,l[1]=0,l},_.au=function(l,r,s){return l[0]=r[0]*s,l[1]=r[1]*s,l},_.av=ip,_.aw=In,_.ax=function(l,r,s,p){const v=r.y-l.y,E=r.x-l.x,A=p.y-s.y,I=p.x-s.x,z=A*E-I*v;if(z===0)return null;const F=(I*(l.y-s.y)-A*(l.x-s.x))/z;return new M(l.x+F*E,l.y+F*v)},_.ay=tv,_.az=fg,_.b=Sa,_.b$=class extends T{},_.b0=function(l,r,s){return l[0]=r[0]*s,l[1]=r[1]*s,l[2]=r[2]*s,l[3]=r[3]*s,l},_.b1=function(l,r){return l[0]*r[0]+l[1]*r[1]+l[2]*r[2]+l[3]},_.b2=_i,_.b3=Jc,_.b4=function(l,r,s,p,v){var E,A=1/Math.tan(r/2);return l[0]=A/s,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=A,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[11]=-1,l[12]=0,l[13]=0,l[15]=0,v!=null&&v!==1/0?(l[10]=(v+p)*(E=1/(p-v)),l[14]=2*v*p*E):(l[10]=-1,l[14]=-2*p),l},_.b5=function(l){var r=new qe(16);return r[0]=l[0],r[1]=l[1],r[2]=l[2],r[3]=l[3],r[4]=l[4],r[5]=l[5],r[6]=l[6],r[7]=l[7],r[8]=l[8],r[9]=l[9],r[10]=l[10],r[11]=l[11],r[12]=l[12],r[13]=l[13],r[14]=l[14],r[15]=l[15],r},_.b6=function(l,r,s){var p=Math.sin(s),v=Math.cos(s),E=r[0],A=r[1],I=r[2],z=r[3],F=r[4],$=r[5],X=r[6],te=r[7];return r!==l&&(l[8]=r[8],l[9]=r[9],l[10]=r[10],l[11]=r[11],l[12]=r[12],l[13]=r[13],l[14]=r[14],l[15]=r[15]),l[0]=E*v+F*p,l[1]=A*v+$*p,l[2]=I*v+X*p,l[3]=z*v+te*p,l[4]=F*v-E*p,l[5]=$*v-A*p,l[6]=X*v-I*p,l[7]=te*v-z*p,l},_.b7=function(l,r,s){var p=Math.sin(s),v=Math.cos(s),E=r[4],A=r[5],I=r[6],z=r[7],F=r[8],$=r[9],X=r[10],te=r[11];return r!==l&&(l[0]=r[0],l[1]=r[1],l[2]=r[2],l[3]=r[3],l[12]=r[12],l[13]=r[13],l[14]=r[14],l[15]=r[15]),l[4]=E*v+F*p,l[5]=A*v+$*p,l[6]=I*v+X*p,l[7]=z*v+te*p,l[8]=F*v-E*p,l[9]=$*v-A*p,l[10]=X*v-I*p,l[11]=te*v-z*p,l},_.b8=function(){const l=new Float32Array(16);return Ue(l),l},_.b9=function(){const l=new Float64Array(16);return Ue(l),l},_.bA=function(l,r){const s=ke(l,360),p=ke(r,360),v=p-s,E=p>s?v-360:v+360;return Math.abs(v)<Math.abs(E)?v:E},_.bB=function(l){return l[0]=0,l[1]=0,l[2]=0,l},_.bC=function(l,r,s,p){const v=Math.sqrt(l*l+r*r),E=Math.sqrt(s*s+p*p);l/=v,r/=v,s/=E,p/=E;const A=Math.acos(l*s+r*p);return-r*s+l*p>0?A:-A},_.bD=function(l,r){const s=ke(l,2*Math.PI),p=ke(r,2*Math.PI);return Math.min(Math.abs(s-p),Math.abs(s-p+2*Math.PI),Math.abs(s-p-2*Math.PI))},_.bE=function(){const l={},r=$e.$version;for(const s in $e.$root){const p=$e.$root[s];if(p.required){let v=null;v=s==="version"?r:p.type==="array"?[]:{},v!=null&&(l[s]=v)}}return l},_.bF=Fc,_.bG=De,_.bH=function l(r,s){if(Array.isArray(r)){if(!Array.isArray(s)||r.length!==s.length)return!1;for(let p=0;p<r.length;p++)if(!l(r[p],s[p]))return!1;return!0}if(typeof r=="object"&&r!==null&&s!==null){if(typeof s!="object"||Object.keys(r).length!==Object.keys(s).length)return!1;for(const p in r)if(!l(r[p],s[p]))return!1;return!0}return r===s},_.bI=function(l){l=l.slice();const r=Object.create(null);for(let s=0;s<l.length;s++)r[l[s].id]=l[s];for(let s=0;s<l.length;s++)"ref"in l[s]&&(l[s]=Rn(l[s],r[l[s].ref]));return l},_.bJ=function(l){if(l.type==="custom")return new Hy(l);switch(l.type){case"background":return new bc(l);case"circle":return new bg(l);case"color-relief":return new Mg(l);case"fill":return new Py(l);case"fill-extrusion":return new Jd(l);case"heatmap":return new Yp(l);case"hillshade":return new Ey(l);case"line":return new Ch(l);case"raster":return new Zy(l);case"symbol":return new Ed(l)}},_.bK=kr,_.bL=function(l,r){if(!l)return[{command:"setStyle",args:[r]}];let s=[];try{if(!nn(l.version,r.version))return[{command:"setStyle",args:[r]}];nn(l.center,r.center)||s.push({command:"setCenter",args:[r.center]}),nn(l.state,r.state)||s.push({command:"setGlobalState",args:[r.state]}),nn(l.centerAltitude,r.centerAltitude)||s.push({command:"setCenterAltitude",args:[r.centerAltitude]}),nn(l.zoom,r.zoom)||s.push({command:"setZoom",args:[r.zoom]}),nn(l.bearing,r.bearing)||s.push({command:"setBearing",args:[r.bearing]}),nn(l.pitch,r.pitch)||s.push({command:"setPitch",args:[r.pitch]}),nn(l.roll,r.roll)||s.push({command:"setRoll",args:[r.roll]}),nn(l.sprite,r.sprite)||s.push({command:"setSprite",args:[r.sprite]}),nn(l.glyphs,r.glyphs)||s.push({command:"setGlyphs",args:[r.glyphs]}),nn(l.transition,r.transition)||s.push({command:"setTransition",args:[r.transition]}),nn(l.light,r.light)||s.push({command:"setLight",args:[r.light]}),nn(l.terrain,r.terrain)||s.push({command:"setTerrain",args:[r.terrain]}),nn(l.sky,r.sky)||s.push({command:"setSky",args:[r.sky]}),nn(l.projection,r.projection)||s.push({command:"setProjection",args:[r.projection]});const p={},v=[];(function(A,I,z,F){let $;for($ in I=I||{},A=A||{})Object.prototype.hasOwnProperty.call(A,$)&&(Object.prototype.hasOwnProperty.call(I,$)||$i($,z,F));for($ in I)Object.prototype.hasOwnProperty.call(I,$)&&(Object.prototype.hasOwnProperty.call(A,$)?nn(A[$],I[$])||(A[$].type==="geojson"&&I[$].type==="geojson"&&Cr(A,I,$)?Nn(z,{command:"setGeoJSONSourceData",args:[$,I[$].data]}):er($,I,z,F)):Pi($,I,z))})(l.sources,r.sources,v,p);const E=[];l.layers&&l.layers.forEach((A=>{"source"in A&&p[A.source]?s.push({command:"removeLayer",args:[A.id]}):E.push(A)})),s=s.concat(v),(function(A,I,z){I=I||[];const F=(A=A||[]).map(Kn),$=I.map(Kn),X=A.reduce(vr,{}),te=I.reduce(vr,{}),ie=F.slice(),re=Object.create(null);let oe,pe,Te,We,Le;for(let Fe=0,ot=0;Fe<F.length;Fe++)oe=F[Fe],Object.prototype.hasOwnProperty.call(te,oe)?ot++:(Nn(z,{command:"removeLayer",args:[oe]}),ie.splice(ie.indexOf(oe,ot),1));for(let Fe=0,ot=0;Fe<$.length;Fe++)oe=$[$.length-1-Fe],ie[ie.length-1-Fe]!==oe&&(Object.prototype.hasOwnProperty.call(X,oe)?(Nn(z,{command:"removeLayer",args:[oe]}),ie.splice(ie.lastIndexOf(oe,ie.length-ot),1)):ot++,We=ie[ie.length-Fe],Nn(z,{command:"addLayer",args:[te[oe],We]}),ie.splice(ie.length-Fe,0,oe),re[oe]=!0);for(let Fe=0;Fe<$.length;Fe++)if(oe=$[Fe],pe=X[oe],Te=te[oe],!re[oe]&&!nn(pe,Te))if(nn(pe.source,Te.source)&&nn(pe["source-layer"],Te["source-layer"])&&nn(pe.type,Te.type)){for(Le in Vn(pe.layout,Te.layout,z,oe,null,"setLayoutProperty"),Vn(pe.paint,Te.paint,z,oe,null,"setPaintProperty"),nn(pe.filter,Te.filter)||Nn(z,{command:"setFilter",args:[oe,Te.filter]}),nn(pe.minzoom,Te.minzoom)&&nn(pe.maxzoom,Te.maxzoom)||Nn(z,{command:"setLayerZoomRange",args:[oe,Te.minzoom,Te.maxzoom]}),pe)Object.prototype.hasOwnProperty.call(pe,Le)&&Le!=="layout"&&Le!=="paint"&&Le!=="filter"&&Le!=="metadata"&&Le!=="minzoom"&&Le!=="maxzoom"&&(Le.indexOf("paint.")===0?Vn(pe[Le],Te[Le],z,oe,Le.slice(6),"setPaintProperty"):nn(pe[Le],Te[Le])||Nn(z,{command:"setLayerProperty",args:[oe,Le,Te[Le]]}));for(Le in Te)Object.prototype.hasOwnProperty.call(Te,Le)&&!Object.prototype.hasOwnProperty.call(pe,Le)&&Le!=="layout"&&Le!=="paint"&&Le!=="filter"&&Le!=="metadata"&&Le!=="minzoom"&&Le!=="maxzoom"&&(Le.indexOf("paint.")===0?Vn(pe[Le],Te[Le],z,oe,Le.slice(6),"setPaintProperty"):nn(pe[Le],Te[Le])||Nn(z,{command:"setLayerProperty",args:[oe,Le,Te[Le]]}))}else Nn(z,{command:"removeLayer",args:[oe]}),We=ie[ie.lastIndexOf(oe)+1],Nn(z,{command:"addLayer",args:[Te,We]})})(E,r.layers,s)}catch(p){console.warn("Unable to compute style diff:",p),s=[{command:"setStyle",args:[r]}]}return s},_.bM=function(l){const r=[],s=l.id;return s===void 0&&r.push({message:`layers.${s}: missing required property "id"`}),l.render===void 0&&r.push({message:`layers.${s}: missing required method "render"`}),l.renderingMode&&l.renderingMode!=="2d"&&l.renderingMode!=="3d"&&r.push({message:`layers.${s}: property "renderingMode" must be either "2d" or "3d"`}),r},_.bN=ds,_.bO=Ns,_.bP=class extends ss{constructor(l,r){super(l,r),this.current=0}set(l){this.current!==l&&(this.current=l,this.gl.uniform1i(this.location,l))}},_.bQ=la,_.bR=class extends ss{constructor(l,r){super(l,r),this.current=qo}set(l){if(l[12]!==this.current[12]||l[0]!==this.current[0])return this.current=l,void this.gl.uniformMatrix4fv(this.location,!1,l);for(let r=1;r<16;r++)if(l[r]!==this.current[r]){this.current=l,this.gl.uniformMatrix4fv(this.location,!1,l);break}}},_.bS=oa,_.bT=class extends ss{constructor(l,r){super(l,r),this.current=[0,0,0]}set(l){l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]||(this.current=l,this.gl.uniform3f(this.location,l[0],l[1],l[2]))}},_.bU=class extends ss{constructor(l,r){super(l,r),this.current=[0,0]}set(l){l[0]===this.current[0]&&l[1]===this.current[1]||(this.current=l,this.gl.uniform2f(this.location,l[0],l[1]))}},_.bV=He,_.bW=function(l,r){var s=Math.sin(r),p=Math.cos(r);return l[0]=p,l[1]=s,l[2]=0,l[3]=-s,l[4]=p,l[5]=0,l[6]=0,l[7]=0,l[8]=1,l},_.bX=function(l,r,s){var p=r[0],v=r[1],E=r[2];return l[0]=p*s[0]+v*s[3]+E*s[6],l[1]=p*s[1]+v*s[4]+E*s[7],l[2]=p*s[2]+v*s[5]+E*s[8],l},_.bY=function(l,r,s,p,v,E,A){var I=1/(r-s),z=1/(p-v),F=1/(E-A);return l[0]=-2*I,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=-2*z,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=2*F,l[11]=0,l[12]=(r+s)*I,l[13]=(v+p)*z,l[14]=(A+E)*F,l[15]=1,l},_.bZ=class extends ss{constructor(l,r){super(l,r),this.current=new Array}set(l){if(l!=this.current){this.current=l;const r=new Float32Array(4*l.length);for(let s=0;s<l.length;s++)r[4*s]=l[s].r,r[4*s+1]=l[s].g,r[4*s+2]=l[s].b,r[4*s+3]=l[s].a;this.gl.uniform4fv(this.location,r)}}},_.b_=class extends ss{constructor(l,r){super(l,r),this.current=new Array}set(l){if(l!=this.current){this.current=l;const r=new Float32Array(l);this.gl.uniform1fv(this.location,r)}}},_.ba=function(){return new Float64Array(16)},_.bb=function(l,r,s){const p=new Float64Array(4);return mt(p,l,r-90,s),p},_.bc=function(l,r,s,p){var v,E,A,I,z,F=r[0],$=r[1],X=r[2],te=r[3],ie=s[0],re=s[1],oe=s[2],pe=s[3];return(E=F*ie+$*re+X*oe+te*pe)<0&&(E=-E,ie=-ie,re=-re,oe=-oe,pe=-pe),1-E>Je?(v=Math.acos(E),A=Math.sin(v),I=Math.sin((1-p)*v)/A,z=Math.sin(p*v)/A):(I=1-p,z=p),l[0]=I*F+z*ie,l[1]=I*$+z*re,l[2]=I*X+z*oe,l[3]=I*te+z*pe,l},_.bd=function(l){const r=new Float64Array(9);var s,p,v,E,A,I,z,F,$,X,te,ie,re,oe,pe,Te,We,Le;X=(v=(p=l)[0])*(z=v+v),te=(E=p[1])*z,re=(A=p[2])*z,oe=A*(F=E+E),Te=(I=p[3])*z,We=I*F,Le=I*($=A+A),(s=r)[0]=1-(ie=E*F)-(pe=A*$),s[3]=te-Le,s[6]=re+We,s[1]=te+Le,s[4]=1-X-pe,s[7]=oe-Te,s[2]=re-We,s[5]=oe+Te,s[8]=1-X-ie;const Fe=fs(-Math.asin(Xt(r[2],-1,1)));let ot,gt;return Math.hypot(r[5],r[8])<.001?(ot=0,gt=-fs(Math.atan2(r[3],r[4]))):(ot=fs(r[5]===0&&r[8]===0?0:Math.atan2(r[5],r[8])),gt=fs(r[1]===0&&r[0]===0?0:Math.atan2(r[1],r[0]))),{roll:ot,pitch:Fe+90,bearing:gt}},_.be=function(l,r){return l.roll==r.roll&&l.pitch==r.pitch&&l.bearing==r.bearing},_.bf=Ln,_.bg=Iu,_.bh=wl,_.bi=Qr,_.bj=Zc,_.bk=vt,_.bl=Ot,_.bm=xr,_.bn=function(l,r,s,p,v){return vt(p,v,Xt((l-r)/(s-r),0,1))},_.bo=ke,_.bp=function(){return new Float64Array(3)},_.bq=function(l,r,s,p){return l[0]=r[0]+s[0]*p,l[1]=r[1]+s[1]*p,l[2]=r[2]+s[2]*p,l},_.br=mt,_.bs=function(l,r,s){var p=s[0],v=s[1],E=s[2],A=r[0],I=r[1],z=r[2],F=v*z-E*I,$=E*A-p*z,X=p*I-v*A,te=v*X-E*$,ie=E*F-p*X,re=p*$-v*F,oe=2*s[3];return $*=oe,X*=oe,ie*=2,re*=2,l[0]=A+(F*=oe)+(te*=2),l[1]=I+$+ie,l[2]=z+X+re,l},_.bt=function(l,r,s){const p=(v=[l[0],l[1],l[2],r[0],r[1],r[2],s[0],s[1],s[2]])[0]*(($=v[8])*(A=v[4])-(I=v[5])*(F=v[7]))+v[1]*(-$*(E=v[3])+I*(z=v[6]))+v[2]*(F*E-A*z);var v,E,A,I,z,F,$;if(p===0)return null;const X=Pe([],[r[0],r[1],r[2]],[s[0],s[1],s[2]]),te=Pe([],[s[0],s[1],s[2]],[l[0],l[1],l[2]]),ie=Pe([],[l[0],l[1],l[2]],[r[0],r[1],r[2]]),re=Ae([],X,-l[3]);return _e(re,re,Ae([],te,-r[3])),_e(re,re,Ae([],ie,-s[3])),Ae(re,re,1/p),re},_.bu=Jg,_.bv=function(){return new Float64Array(4)},_.bw=function(l,r,s,p){var v=[],E=[];return v[0]=r[0]-s[0],v[1]=r[1]-s[1],v[2]=r[2]-s[2],E[0]=v[0]*Math.cos(p)-v[1]*Math.sin(p),E[1]=v[0]*Math.sin(p)+v[1]*Math.cos(p),E[2]=v[2],l[0]=E[0]+s[0],l[1]=E[1]+s[1],l[2]=E[2]+s[2],l},_.bx=function(l,r,s,p){var v=[],E=[];return v[0]=r[0]-s[0],v[1]=r[1]-s[1],v[2]=r[2]-s[2],E[0]=v[0],E[1]=v[1]*Math.cos(p)-v[2]*Math.sin(p),E[2]=v[1]*Math.sin(p)+v[2]*Math.cos(p),l[0]=E[0]+s[0],l[1]=E[1]+s[1],l[2]=E[2]+s[2],l},_.by=function(l,r,s,p){var v=[],E=[];return v[0]=r[0]-s[0],v[1]=r[1]-s[1],v[2]=r[2]-s[2],E[0]=v[2]*Math.sin(p)+v[0]*Math.cos(p),E[1]=v[1],E[2]=v[2]*Math.cos(p)-v[0]*Math.sin(p),l[0]=E[0]+s[0],l[1]=E[1]+s[1],l[2]=E[2]+s[2],l},_.bz=function(l,r,s){var p=Math.sin(s),v=Math.cos(s),E=r[0],A=r[1],I=r[2],z=r[3],F=r[8],$=r[9],X=r[10],te=r[11];return r!==l&&(l[4]=r[4],l[5]=r[5],l[6]=r[6],l[7]=r[7],l[12]=r[12],l[13]=r[13],l[14]=r[14],l[15]=r[15]),l[0]=E*v-F*p,l[1]=A*v-$*p,l[2]=I*v-X*p,l[3]=z*v-te*p,l[8]=E*p+F*v,l[9]=A*p+$*v,l[10]=I*p+X*v,l[11]=z*p+te*v,l},_.c=Ke,_.c0=xd,_.c1=class extends u{},_.c2=Sg,_.c3=function(l){return l<=1?1:Math.pow(2,Math.ceil(Math.log(l)/Math.LN2))},_.c4=Tg,_.c5=function(l,r,s){var p=r[0],v=r[1],E=r[2],A=s[3]*p+s[7]*v+s[11]*E+s[15];return l[0]=(s[0]*p+s[4]*v+s[8]*E+s[12])/(A=A||1),l[1]=(s[1]*p+s[5]*v+s[9]*E+s[13])/A,l[2]=(s[2]*p+s[6]*v+s[10]*E+s[14])/A,l},_.c6=class extends Xr{},_.c7=class extends U{},_.c8=function(l,r){return l[0]===r[0]&&l[1]===r[1]&&l[2]===r[2]&&l[3]===r[3]&&l[4]===r[4]&&l[5]===r[5]&&l[6]===r[6]&&l[7]===r[7]&&l[8]===r[8]&&l[9]===r[9]&&l[10]===r[10]&&l[11]===r[11]&&l[12]===r[12]&&l[13]===r[13]&&l[14]===r[14]&&l[15]===r[15]},_.c9=function(l,r){var s=l[0],p=l[1],v=l[2],E=l[3],A=l[4],I=l[5],z=l[6],F=l[7],$=l[8],X=l[9],te=l[10],ie=l[11],re=l[12],oe=l[13],pe=l[14],Te=l[15],We=r[0],Le=r[1],Fe=r[2],ot=r[3],gt=r[4],Ct=r[5],Gt=r[6],Ft=r[7],Zt=r[8],dn=r[9],qt=r[10],Ut=r[11],St=r[12],Sn=r[13],Pn=r[14],mn=r[15];return Math.abs(s-We)<=Je*Math.max(1,Math.abs(s),Math.abs(We))&&Math.abs(p-Le)<=Je*Math.max(1,Math.abs(p),Math.abs(Le))&&Math.abs(v-Fe)<=Je*Math.max(1,Math.abs(v),Math.abs(Fe))&&Math.abs(E-ot)<=Je*Math.max(1,Math.abs(E),Math.abs(ot))&&Math.abs(A-gt)<=Je*Math.max(1,Math.abs(A),Math.abs(gt))&&Math.abs(I-Ct)<=Je*Math.max(1,Math.abs(I),Math.abs(Ct))&&Math.abs(z-Gt)<=Je*Math.max(1,Math.abs(z),Math.abs(Gt))&&Math.abs(F-Ft)<=Je*Math.max(1,Math.abs(F),Math.abs(Ft))&&Math.abs($-Zt)<=Je*Math.max(1,Math.abs($),Math.abs(Zt))&&Math.abs(X-dn)<=Je*Math.max(1,Math.abs(X),Math.abs(dn))&&Math.abs(te-qt)<=Je*Math.max(1,Math.abs(te),Math.abs(qt))&&Math.abs(ie-Ut)<=Je*Math.max(1,Math.abs(ie),Math.abs(Ut))&&Math.abs(re-St)<=Je*Math.max(1,Math.abs(re),Math.abs(St))&&Math.abs(oe-Sn)<=Je*Math.max(1,Math.abs(oe),Math.abs(Sn))&&Math.abs(pe-Pn)<=Je*Math.max(1,Math.abs(pe),Math.abs(Pn))&&Math.abs(Te-mn)<=Je*Math.max(1,Math.abs(Te),Math.abs(mn))},_.cA=function(l,r){se.REGISTERED_PROTOCOLS[l]=r},_.cB=function(l){delete se.REGISTERED_PROTOCOLS[l]},_.cC=function(l,r){const s={};for(let v=0;v<l.length;v++){const E=r&&r[l[v].id]||Ri(l[v]);r&&(r[l[v].id]=E);let A=s[E];A||(A=s[E]=[]),A.push(l[v])}const p=[];for(const v in s)p.push(s[v]);return p},_.cD=Yt,_.cE=_m,_.cF=ap,_.cG=qg,_.cH=function(l){l.bucket.createArrays(),l.bucket.tilePixelRatio=zt/(512*l.bucket.overscaling),l.bucket.compareText={},l.bucket.iconsNeedLinear=!1;const r=l.bucket.layers[0],s=r.layout,p=r._unevaluatedLayout._values,v={layoutIconSize:p["icon-size"].possiblyEvaluate(new ki(l.bucket.zoom+1),l.canonical),layoutTextSize:p["text-size"].possiblyEvaluate(new ki(l.bucket.zoom+1),l.canonical),textMaxSize:p["text-size"].possiblyEvaluate(new ki(18))};if(l.bucket.textSizeData.kind==="composite"){const{minZoom:F,maxZoom:$}=l.bucket.textSizeData;v.compositeTextSizes=[p["text-size"].possiblyEvaluate(new ki(F),l.canonical),p["text-size"].possiblyEvaluate(new ki($),l.canonical)]}if(l.bucket.iconSizeData.kind==="composite"){const{minZoom:F,maxZoom:$}=l.bucket.iconSizeData;v.compositeIconSizes=[p["icon-size"].possiblyEvaluate(new ki(F),l.canonical),p["icon-size"].possiblyEvaluate(new ki($),l.canonical)]}const E=s.get("text-line-height")*Wr,A=s.get("text-rotation-alignment")!=="viewport"&&s.get("symbol-placement")!=="point",I=s.get("text-keep-upright"),z=s.get("text-size");for(const F of l.bucket.features){const $=s.get("text-font").evaluate(F,{},l.canonical).join(","),X=z.evaluate(F,{},l.canonical),te=v.layoutTextSize.evaluate(F,{},l.canonical),ie=v.layoutIconSize.evaluate(F,{},l.canonical),re={horizontal:{},vertical:void 0},oe=F.text;let pe,Te=[0,0];if(oe){const Fe=oe.toString(),ot=s.get("text-letter-spacing").evaluate(F,{},l.canonical)*Wr,gt=Vc(Fe)?ot:0,Ct=s.get("text-anchor").evaluate(F,{},l.canonical),Gt=rv(r,F,l.canonical);if(!Gt){const qt=s.get("text-radial-offset").evaluate(F,{},l.canonical);Te=qt?iv(Ct,[qt*Wr,bm]):s.get("text-offset").evaluate(F,{},l.canonical).map((Ut=>Ut*Wr))}let Ft=A?"center":s.get("text-justify").evaluate(F,{},l.canonical);const Zt=s.get("symbol-placement")==="point"?s.get("text-max-width").evaluate(F,{},l.canonical)*Wr:1/0,dn=()=>{l.bucket.allowVerticalPlacement&&rd(Fe)&&(re.vertical=Sd(oe,l.glyphMap,l.glyphPositions,l.imagePositions,$,Zt,E,Ct,"left",gt,Te,_.ao.vertical,!0,te,X))};if(!A&&Gt){const qt=new Set;if(Ft==="auto")for(let St=0;St<Gt.values.length;St+=2)qt.add(wc(Gt.values[St]));else qt.add(Ft);let Ut=!1;for(const St of qt)if(!re.horizontal[St])if(Ut)re.horizontal[St]=re.horizontal[0];else{const Sn=Sd(oe,l.glyphMap,l.glyphPositions,l.imagePositions,$,Zt,E,"center",St,gt,Te,_.ao.horizontal,!1,te,X);Sn&&(re.horizontal[St]=Sn,Ut=Sn.positionedLines.length===1)}dn()}else{Ft==="auto"&&(Ft=wc(Ct));const qt=Sd(oe,l.glyphMap,l.glyphPositions,l.imagePositions,$,Zt,E,Ct,Ft,gt,Te,_.ao.horizontal,!1,te,X);qt&&(re.horizontal[Ft]=qt),dn(),rd(Fe)&&A&&I&&(re.vertical=Sd(oe,l.glyphMap,l.glyphPositions,l.imagePositions,$,Zt,E,Ct,Ft,gt,Te,_.ao.vertical,!1,te,X))}}let We=!1;if(F.icon&&F.icon.name){const Fe=l.imageMap[F.icon.name];Fe&&(pe=$y(l.imagePositions[F.icon.name],s.get("icon-offset").evaluate(F,{},l.canonical),s.get("icon-anchor").evaluate(F,{},l.canonical)),We=!!Fe.sdf,l.bucket.sdfIcons===void 0?l.bucket.sdfIcons=We:l.bucket.sdfIcons!==We&&Ii("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Fe.pixelRatio!==l.bucket.pixelRatio||s.get("icon-rotate").constantOr(1)!==0)&&(l.bucket.iconsNeedLinear=!0))}const Le=xm(re.horizontal)||re.vertical;l.bucket.iconsInText=!!Le&&Le.iconsInText,(Le||pe)&&av(l.bucket,F,re,pe,l.imageMap,v,te,ie,Te,We,l.canonical,l.subdivisionGranularity)}l.showCollisionBoxes&&l.bucket.generateCollisionDebugBuffers()},_.cI=Ui,_.cJ=Vr,_.cK=Wf,_.cL=yc,_.cM=tf,_.cN=class{constructor(l){this._marks={start:[l.url,"start"].join("#"),end:[l.url,"end"].join("#"),measure:l.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let l=performance.getEntriesByName(this._marks.measure);return l.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),l=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),l}},_.cO=function(l,r,s,p,v){return c(this,void 0,void 0,(function*(){if(tt())try{return yield fr(l,r,s,p,v)}catch{}return(function(E,A,I,z,F){const $=E.width,X=E.height;Ea&&So||(Ea=new OffscreenCanvas($,X),So=Ea.getContext("2d",{willReadFrequently:!0})),Ea.width=$,Ea.height=X,So.drawImage(E,0,0,$,X);const te=So.getImageData(A,I,z,F);return So.clearRect(0,0,$,X),te.data})(l,r,s,p,v)}))},_.cP=Jp,_.cQ=k,_.cR=Ho,_.cS=os,_.cT=bu,_.cU=function(l,r){const s=new Map;if(l!=null)if(l.type==="Feature")s.set(Ad(l,r),l);else for(const p of l.features)s.set(Ad(p,r),p);return s},_.cV=function(l,r){if(l==null)return!0;if(l.type==="Feature")return Ad(l,r)!=null;if(l.type==="FeatureCollection"){const s=new Set;for(const p of l.features){const v=Ad(p,r);if(v==null||s.has(v))return!1;s.add(v)}return!0}return!1},_.cW=function(l,r,s){var p,v,E,A;if(r.removeAll&&l.clear(),r.remove)for(const I of r.remove)l.delete(I);if(r.add)for(const I of r.add){const z=Ad(I,s);z!=null&&l.set(z,I)}if(r.update)for(const I of r.update){let z=l.get(I.id);if(z==null)continue;const F=!I.removeAllProperties&&(((p=I.removeProperties)===null||p===void 0?void 0:p.length)>0||((v=I.addOrUpdateProperties)===null||v===void 0?void 0:v.length)>0);if((I.newGeometry||I.removeAllProperties||F)&&(z=Object.assign({},z),l.set(I.id,z),F&&(z.properties=Object.assign({},z.properties))),I.newGeometry&&(z.geometry=I.newGeometry),I.removeAllProperties)z.properties={};else if(((E=I.removeProperties)===null||E===void 0?void 0:E.length)>0)for(const $ of I.removeProperties)Object.prototype.hasOwnProperty.call(z.properties,$)&&delete z.properties[$];if(((A=I.addOrUpdateProperties)===null||A===void 0?void 0:A.length)>0)for(const{key:$,value:X}of I.addOrUpdateProperties)z.properties[$]=X}},_.cX=_l,_.ca=function(l,r){return l[0]=r[0],l[1]=r[1],l[2]=r[2],l[3]=r[3],l[4]=r[4],l[5]=r[5],l[6]=r[6],l[7]=r[7],l[8]=r[8],l[9]=r[9],l[10]=r[10],l[11]=r[11],l[12]=r[12],l[13]=r[13],l[14]=r[14],l[15]=r[15],l},_.cb=l=>l.type==="symbol",_.cc=l=>l.type==="circle",_.cd=l=>l.type==="heatmap",_.ce=l=>l.type==="line",_.cf=l=>l.type==="fill",_.cg=l=>l.type==="fill-extrusion",_.ch=l=>l.type==="hillshade",_.ci=l=>l.type==="color-relief",_.cj=l=>l.type==="raster",_.ck=l=>l.type==="background",_.cl=l=>l.type==="custom",_.cm=jt,_.cn=function(l,r,s){const p=Tt(r.x-s.x,r.y-s.y),v=Tt(l.x-s.x,l.y-s.y);var E,A;return fs(Math.atan2(p[0]*v[1]-p[1]*v[0],(E=p)[0]*(A=v)[0]+E[1]*A[1]))},_.co=Jt,_.cp=function(l,r){return Fs[r]&&(l instanceof MouseEvent||l instanceof WheelEvent)},_.cq=function(l,r){return ps[r]&&"touches"in l},_.cr=function(l){return ps[l]||Fs[l]},_.cs=function(l,r,s){var p=r[0],v=r[1];return l[0]=s[0]*p+s[4]*v+s[12],l[1]=s[1]*p+s[5]*v+s[13],l},_.ct=function(l,r){const{x:s,y:p}=Qc.fromLngLat(r);return!(l<0||l>25||p<0||p>=1||s<0||s>=1)},_.cu=function(l,r){return l[0]=r[0],l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=r[1],l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=r[2],l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l},_.cv=class extends Xa{},_.cw=Cm,_.cy=function(l){return l.message===ms},_.cz=Se,_.d=et,_.e=si,_.f=l=>c(void 0,void 0,void 0,(function*(){if(l.byteLength===0)return createImageBitmap(new ImageData(1,1));const r=new Blob([new Uint8Array(l)],{type:"image/png"});try{return createImageBitmap(r)}catch(s){throw new Error(`Could not load image because of ${s.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}})),_.g=le,_.h=l=>new Promise(((r,s)=>{const p=new Image;p.onload=()=>{r(p),URL.revokeObjectURL(p.src),p.onload=null,window.requestAnimationFrame((()=>{p.src=Bi}))},p.onerror=()=>s(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const v=new Blob([new Uint8Array(l)],{type:"image/png"});p.src=l.byteLength?URL.createObjectURL(v):Bi})),_.i=Ta,_.j=(l,r)=>Ze(si(l,{type:"json"}),r),_.k=xt,_.l=It,_.m=Ze,_.n=(l,r)=>Ze(si(l,{type:"arrayBuffer"}),r),_.o=function(l){return new tf(l).readFields(Jf,[])},_.p=$g,_.q=Xd,_.r=As,_.s=so,_.t=Au,_.u=ii,_.v=$e,_.w=Ii,_.x=gh,_.y=nd,_.z=ac})),d("worker",["./shared"],(function(_){class c{constructor(se){this.keyCache={},se&&this.replace(se)}replace(se){this._layerConfigs={},this._layers={},this.update(se,[])}update(se,le){for(const Se of se){this._layerConfigs[Se.id]=Se;const De=this._layers[Se.id]=_.bJ(Se);De._featureFilter=_.aa(De.filter),this.keyCache[Se.id]&&delete this.keyCache[Se.id]}for(const Se of le)delete this.keyCache[Se],delete this._layerConfigs[Se],delete this._layers[Se];this.familiesBySource={};const fe=_.cC(Object.values(this._layerConfigs),this.keyCache);for(const Se of fe){const De=Se.map((xt=>this._layers[xt.id])),Ze=De[0];if(Ze.visibility==="none")continue;const et=Ze.source||"";let Xe=this.familiesBySource[et];Xe||(Xe=this.familiesBySource[et]={});const _t=Ze.sourceLayer||"_geojsonTileLayer";let It=Xe[_t];It||(It=Xe[_t]=[]),It.push(De)}}}class M{constructor(se){const le={},fe=[];for(const et in se){const Xe=se[et],_t=le[et]={};for(const It in Xe){const xt=Xe[+It];if(!xt||xt.bitmap.width===0||xt.bitmap.height===0)continue;const tn={x:0,y:0,w:xt.bitmap.width+2,h:xt.bitmap.height+2};fe.push(tn),_t[It]={rect:tn,metrics:xt.metrics}}}const{w:Se,h:De}=_.p(fe),Ze=new _.q({width:Se||1,height:De||1});for(const et in se){const Xe=se[et];for(const _t in Xe){const It=Xe[+_t];if(!It||It.bitmap.width===0||It.bitmap.height===0)continue;const xt=le[et][_t].rect;_.q.copy(It.bitmap,Ze,{x:0,y:0},{x:xt.x+1,y:xt.y+1},It.bitmap)}}this.image=Ze,this.positions=le}}_.cD("GlyphAtlas",M);class k{constructor(se){this.tileID=new _.Z(se.tileID.overscaledZ,se.tileID.wrap,se.tileID.canonical.z,se.tileID.canonical.x,se.tileID.canonical.y),this.uid=se.uid,this.zoom=se.zoom,this.pixelRatio=se.pixelRatio,this.tileSize=se.tileSize,this.source=se.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=se.showCollisionBoxes,this.collectResourceTiming=!!se.collectResourceTiming,this.returnDependencies=!!se.returnDependencies,this.promoteId=se.promoteId,this.inFlightDependencies=[],this.globalState=se.globalState}parse(se,le,fe,Se,De){return _._(this,void 0,void 0,(function*(){this.status="parsing",this.data=se,this.collisionBoxArray=new _.a8;const Ze=new _.cE(Object.keys(se.layers).sort()),et=new _.cF(this.tileID,this.promoteId);et.bucketLayerIDs=[];const Xe={},_t={featureIndex:et,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:fe,subdivisionGranularity:De},It=le.familiesBySource[this.source];for(const Vn in It){const Kn=se.layers[Vn];if(!Kn)continue;Kn.version===1&&_.w(`Vector tile source "${this.source}" layer "${Vn}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const vr=Ze.encode(Vn),Pt=[];for(let en=0;en<Kn.length;en++){const tr=Kn.feature(en),ta=et.getId(tr,Vn);Pt.push({feature:tr,id:ta,index:en,sourceLayerIndex:vr})}for(const en of It[Vn]){const tr=en[0];tr.source!==this.source&&_.w(`layer.source = ${tr.source} does not equal this.source = ${this.source}`),tr.minzoom&&this.zoom<Math.floor(tr.minzoom)||tr.maxzoom&&this.zoom>=tr.maxzoom||tr.visibility!=="none"&&(j(en,this.zoom,fe),(Xe[tr.id]=tr.createBucket({index:et.bucketLayerIDs.length,layers:en,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:vr,sourceID:this.source,globalState:this.globalState})).populate(Pt,_t,this.tileID.canonical),et.bucketLayerIDs.push(en.map((ta=>ta.id))))}}const xt=_.bN(_t.glyphDependencies,(Vn=>Object.keys(Vn).map(Number)));this.inFlightDependencies.forEach((Vn=>Vn==null?void 0:Vn.abort())),this.inFlightDependencies=[];let tn=Promise.resolve({});if(Object.keys(xt).length){const Vn=new AbortController;this.inFlightDependencies.push(Vn),tn=Se.sendAsync({type:"GG",data:{stacks:xt,source:this.source,tileID:this.tileID,type:"glyphs"}},Vn)}const $e=Object.keys(_t.iconDependencies);let vn=Promise.resolve({});if($e.length){const Vn=new AbortController;this.inFlightDependencies.push(Vn),vn=Se.sendAsync({type:"GI",data:{icons:$e,source:this.source,tileID:this.tileID,type:"icons"}},Vn)}const Rn=Object.keys(_t.patternDependencies);let nn=Promise.resolve({});if(Rn.length){const Vn=new AbortController;this.inFlightDependencies.push(Vn),nn=Se.sendAsync({type:"GI",data:{icons:Rn,source:this.source,tileID:this.tileID,type:"patterns"}},Vn)}const[Nn,Pi,$i]=yield Promise.all([tn,vn,nn]),er=new M(Nn),Cr=new _.cG(Pi,$i);for(const Vn in Xe){const Kn=Xe[Vn];Kn instanceof _.a9?(j(Kn.layers,this.zoom,fe),_.cH({bucket:Kn,glyphMap:Nn,glyphPositions:er.positions,imageMap:Pi,imagePositions:Cr.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:_t.subdivisionGranularity})):Kn.hasPattern&&(Kn instanceof _.cI||Kn instanceof _.cJ||Kn instanceof _.cK)&&(j(Kn.layers,this.zoom,fe),Kn.addFeatures(_t,this.tileID.canonical,Cr.patternPositions))}return this.status="done",{buckets:Object.values(Xe).filter((Vn=>!Vn.isEmpty())),featureIndex:et,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:er.image,imageAtlas:Cr,glyphMap:this.returnDependencies?Nn:null,iconMap:this.returnDependencies?Pi:null,glyphPositions:this.returnDependencies?er.positions:null}}))}}function j(Ke,se,le){const fe=new _.F(se);for(const Se of Ke)Se.recalculate(fe,le)}class G{constructor(se,le,fe){this.actor=se,this.layerIndex=le,this.availableImages=fe,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(se,le){return _._(this,void 0,void 0,(function*(){const fe=yield _.n(se.request,le);try{return{vectorTile:new _.cL(new _.cM(fe.data)),rawData:fe.data,cacheControl:fe.cacheControl,expires:fe.expires}}catch(Se){const De=new Uint8Array(fe.data);let Ze=`Unable to parse the tile at ${se.request.url}, `;throw Ze+=De[0]===31&&De[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${Se.message}`,new Error(Ze)}}))}loadTile(se){return _._(this,void 0,void 0,(function*(){const le=se.uid,fe=!!(se&&se.request&&se.request.collectResourceTiming)&&new _.cN(se.request),Se=new k(se);this.loading[le]=Se;const De=new AbortController;Se.abort=De;try{const Ze=yield this.loadVectorTile(se,De);if(delete this.loading[le],!Ze)return null;const et=Ze.rawData,Xe={};Ze.expires&&(Xe.expires=Ze.expires),Ze.cacheControl&&(Xe.cacheControl=Ze.cacheControl);const _t={};if(fe){const xt=fe.finish();xt&&(_t.resourceTiming=JSON.parse(JSON.stringify(xt)))}Se.vectorTile=Ze.vectorTile;const It=Se.parse(Ze.vectorTile,this.layerIndex,this.availableImages,this.actor,se.subdivisionGranularity);this.loaded[le]=Se,this.fetching[le]={rawTileData:et,cacheControl:Xe,resourceTiming:_t};try{const xt=yield It;return _.e({rawTileData:et.slice(0)},xt,Xe,_t)}finally{delete this.fetching[le]}}catch(Ze){throw delete this.loading[le],Se.status="done",this.loaded[le]=Se,Ze}}))}reloadTile(se){return _._(this,void 0,void 0,(function*(){const le=se.uid;if(!this.loaded||!this.loaded[le])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const fe=this.loaded[le];if(fe.showCollisionBoxes=se.showCollisionBoxes,fe.globalState=se.globalState,fe.status==="parsing"){const Se=yield fe.parse(fe.vectorTile,this.layerIndex,this.availableImages,this.actor,se.subdivisionGranularity);let De;if(this.fetching[le]){const{rawTileData:Ze,cacheControl:et,resourceTiming:Xe}=this.fetching[le];delete this.fetching[le],De=_.e({rawTileData:Ze.slice(0)},Se,et,Xe)}else De=Se;return De}if(fe.status==="done"&&fe.vectorTile)return fe.parse(fe.vectorTile,this.layerIndex,this.availableImages,this.actor,se.subdivisionGranularity)}))}abortTile(se){return _._(this,void 0,void 0,(function*(){const le=this.loading,fe=se.uid;le&&le[fe]&&le[fe].abort&&(le[fe].abort.abort(),delete le[fe])}))}removeTile(se){return _._(this,void 0,void 0,(function*(){this.loaded&&this.loaded[se.uid]&&delete this.loaded[se.uid]}))}}class ee{constructor(){this.loaded={}}loadTile(se){return _._(this,void 0,void 0,(function*(){const{uid:le,encoding:fe,rawImageData:Se,redFactor:De,greenFactor:Ze,blueFactor:et,baseShift:Xe}=se,_t=Se.width+2,It=Se.height+2,xt=_.b(Se)?new _.R({width:_t,height:It},yield _.cO(Se,-1,-1,_t,It)):Se,tn=new _.cP(le,xt,fe,De,Ze,et,Xe);return this.loaded=this.loaded||{},this.loaded[le]=tn,tn}))}removeTile(se){const le=this.loaded,fe=se.uid;le&&le[fe]&&delete le[fe]}}var Y,xe,be=(function(){if(xe)return Y;function Ke(le,fe){if(le.length!==0){se(le[0],fe);for(var Se=1;Se<le.length;Se++)se(le[Se],!fe)}}function se(le,fe){for(var Se=0,De=0,Ze=0,et=le.length,Xe=et-1;Ze<et;Xe=Ze++){var _t=(le[Ze][0]-le[Xe][0])*(le[Xe][1]+le[Ze][1]),It=Se+_t;De+=Math.abs(Se)>=Math.abs(_t)?Se-It+_t:_t-It+Se,Se=It}Se+De>=0!=!!fe&&le.reverse()}return xe=1,Y=function le(fe,Se){var De,Ze=fe&&fe.type;if(Ze==="FeatureCollection")for(De=0;De<fe.features.length;De++)le(fe.features[De],Se);else if(Ze==="GeometryCollection")for(De=0;De<fe.geometries.length;De++)le(fe.geometries[De],Se);else if(Ze==="Feature")le(fe.geometry,Se);else if(Ze==="Polygon")Ke(fe.coordinates,Se);else if(Ze==="MultiPolygon")for(De=0;De<fe.coordinates.length;De++)Ke(fe.coordinates[De],Se);return fe}})(),Ne=_.cQ(be);class tt extends _.cS{constructor(se,le){super(new _.cM,0,le,[],[]),this.feature=se,this.type=se.type,this.properties=se.tags?se.tags:{},"id"in se&&(typeof se.id=="string"?this.id=parseInt(se.id,10):typeof se.id!="number"||isNaN(se.id)||(this.id=se.id))}loadGeometry(){const se=[],le=this.feature.type===1?[this.feature.geometry]:this.feature.geometry;for(const fe of le){const Se=[];for(const De of fe)Se.push(new _.P(De[0],De[1]));se.push(Se)}return se}}class Je extends _.cR{constructor(se,le){super(new _.cM),this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.version=le?le.version:1,this.extent=le?le.extent:4096,this.length=se.length,this.features=se}feature(se){return new tt(this.features[se],this.extent)}}function qe(Ke,se){se.writeVarintField(15,Ke.version||1),se.writeStringField(1,Ke.name||""),se.writeVarintField(5,Ke.extent||4096);const le={keys:[],values:[],keycache:{},valuecache:{}};for(let De=0;De<Ke.length;De++)le.feature=Ke.feature(De),se.writeMessage(2,He,le);const fe=le.keys;for(const De of fe)se.writeStringField(3,De);const Se=le.values;for(const De of Se)se.writeMessage(4,_e,De)}function He(Ke,se){if(!Ke.feature)return;const le=Ke.feature;le.id!==void 0&&se.writeVarintField(1,le.id),se.writeMessage(2,Ue,Ke),se.writeVarintField(3,le.type),se.writeMessage(4,ce,le)}function Ue(Ke,se){var le;for(const fe in(le=Ke.feature)==null?void 0:le.properties){let Se=Ke.feature.properties[fe],De=Ke.keycache[fe];if(Se===null)continue;De===void 0&&(Ke.keys.push(fe),De=Ke.keys.length-1,Ke.keycache[fe]=De),se.writeVarint(De),typeof Se!="string"&&typeof Se!="boolean"&&typeof Se!="number"&&(Se=JSON.stringify(Se));const Ze=typeof Se+":"+Se;let et=Ke.valuecache[Ze];et===void 0&&(Ke.values.push(Se),et=Ke.values.length-1,Ke.valuecache[Ze]=et),se.writeVarint(et)}}function Be(Ke,se){return(se<<3)+(7&Ke)}function de(Ke){return Ke<<1^Ke>>31}function ce(Ke,se){const le=Ke.loadGeometry(),fe=Ke.type;let Se=0,De=0;for(const Ze of le){let et=1;fe===1&&(et=Ze.length),se.writeVarint(Be(1,et));const Xe=fe===3?Ze.length-1:Ze.length;for(let _t=0;_t<Xe;_t++){_t===1&&fe!==1&&se.writeVarint(Be(2,Xe-1));const It=Ze[_t].x-Se,xt=Ze[_t].y-De;se.writeVarint(de(It)),se.writeVarint(de(xt)),Se+=It,De+=xt}Ke.type===3&&se.writeVarint(Be(7,1))}}function _e(Ke,se){const le=typeof Ke;le==="string"?se.writeStringField(1,Ke):le==="boolean"?se.writeBooleanField(7,Ke):le==="number"&&(Ke%1!=0?se.writeDoubleField(3,Ke):Ke<0?se.writeSVarintField(6,Ke):se.writeVarintField(5,Ke))}const Ae={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ke=>Ke},Pe=Math.fround||(Ge=new Float32Array(1),Ke=>(Ge[0]=+Ke,Ge[0]));var Ge;class Re{constructor(se){this.options=Object.assign(Object.create(Ae),se),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(se){const{log:le,minZoom:fe,maxZoom:Se}=this.options;le&&console.time("total time");const De=`prepare ${se.length} points`;le&&console.time(De),this.points=se;const Ze=[];for(let Xe=0;Xe<se.length;Xe++){const _t=se[Xe];if(!_t.geometry)continue;const[It,xt]=_t.geometry.coordinates,tn=Pe(mt(It)),$e=Pe($t(xt));Ze.push(tn,$e,1/0,Xe,-1,1),this.options.reduce&&Ze.push(0)}let et=this.trees[Se+1]=this._createTree(Ze);le&&console.timeEnd(De);for(let Xe=Se;Xe>=fe;Xe--){const _t=+Date.now();et=this.trees[Xe]=this._createTree(this._cluster(et,Xe)),le&&console.log("z%d: %d clusters in %dms",Xe,et.numItems,+Date.now()-_t)}return le&&console.timeEnd("total time"),this}getClusters(se,le){let fe=((se[0]+180)%360+360)%360-180;const Se=Math.max(-90,Math.min(90,se[1]));let De=se[2]===180?180:((se[2]+180)%360+360)%360-180;const Ze=Math.max(-90,Math.min(90,se[3]));if(se[2]-se[0]>=360)fe=-180,De=180;else if(fe>De){const xt=this.getClusters([fe,Se,180,Ze],le),tn=this.getClusters([-180,Se,De,Ze],le);return xt.concat(tn)}const et=this.trees[this._limitZoom(le)],Xe=et.range(mt(fe),$t(Ze),mt(De),$t(Se)),_t=et.data,It=[];for(const xt of Xe){const tn=this.stride*xt;It.push(_t[tn+5]>1?In(_t,tn,this.clusterProps):this.points[_t[tn+3]])}return It}getChildren(se){const le=this._getOriginId(se),fe=this._getOriginZoom(se),Se="No cluster with the specified id.",De=this.trees[fe];if(!De)throw new Error(Se);const Ze=De.data;if(le*this.stride>=Ze.length)throw new Error(Se);const et=this.options.radius/(this.options.extent*Math.pow(2,fe-1)),Xe=De.within(Ze[le*this.stride],Ze[le*this.stride+1],et),_t=[];for(const It of Xe){const xt=It*this.stride;Ze[xt+4]===se&&_t.push(Ze[xt+5]>1?In(Ze,xt,this.clusterProps):this.points[Ze[xt+3]])}if(_t.length===0)throw new Error(Se);return _t}getLeaves(se,le,fe){const Se=[];return this._appendLeaves(Se,se,le=le||10,fe=fe||0,0),Se}getTile(se,le,fe){const Se=this.trees[this._limitZoom(se)],De=Math.pow(2,se),{extent:Ze,radius:et}=this.options,Xe=et/Ze,_t=(fe-Xe)/De,It=(fe+1+Xe)/De,xt={features:[]};return this._addTileFeatures(Se.range((le-Xe)/De,_t,(le+1+Xe)/De,It),Se.data,le,fe,De,xt),le===0&&this._addTileFeatures(Se.range(1-Xe/De,_t,1,It),Se.data,De,fe,De,xt),le===De-1&&this._addTileFeatures(Se.range(0,_t,Xe/De,It),Se.data,-1,fe,De,xt),xt.features.length?xt:null}getClusterExpansionZoom(se){let le=this._getOriginZoom(se)-1;for(;le<=this.options.maxZoom;){const fe=this.getChildren(se);if(le++,fe.length!==1)break;se=fe[0].properties.cluster_id}return le}_appendLeaves(se,le,fe,Se,De){const Ze=this.getChildren(le);for(const et of Ze){const Xe=et.properties;if(Xe&&Xe.cluster?De+Xe.point_count<=Se?De+=Xe.point_count:De=this._appendLeaves(se,Xe.cluster_id,fe,Se,De):De<Se?De++:se.push(et),se.length===fe)break}return De}_createTree(se){const le=new _.aI(se.length/this.stride|0,this.options.nodeSize,Float32Array);for(let fe=0;fe<se.length;fe+=this.stride)le.add(se[fe],se[fe+1]);return le.finish(),le.data=se,le}_addTileFeatures(se,le,fe,Se,De,Ze){for(const et of se){const Xe=et*this.stride,_t=le[Xe+5]>1;let It,xt,tn;if(_t)It=Jn(le,Xe,this.clusterProps),xt=le[Xe],tn=le[Xe+1];else{const Rn=this.points[le[Xe+3]];It=Rn.properties;const[nn,Nn]=Rn.geometry.coordinates;xt=mt(nn),tn=$t(Nn)}const $e={type:1,geometry:[[Math.round(this.options.extent*(xt*De-fe)),Math.round(this.options.extent*(tn*De-Se))]],tags:It};let vn;vn=_t||this.options.generateId?le[Xe+3]:this.points[le[Xe+3]].id,vn!==void 0&&($e.id=vn),Ze.features.push($e)}}_limitZoom(se){return Math.max(this.options.minZoom,Math.min(Math.floor(+se),this.options.maxZoom+1))}_cluster(se,le){const{radius:fe,extent:Se,reduce:De,minPoints:Ze}=this.options,et=fe/(Se*Math.pow(2,le)),Xe=se.data,_t=[],It=this.stride;for(let xt=0;xt<Xe.length;xt+=It){if(Xe[xt+2]<=le)continue;Xe[xt+2]=le;const tn=Xe[xt],$e=Xe[xt+1],vn=se.within(Xe[xt],Xe[xt+1],et),Rn=Xe[xt+5];let nn=Rn;for(const Nn of vn){const Pi=Nn*It;Xe[Pi+2]>le&&(nn+=Xe[Pi+5])}if(nn>Rn&&nn>=Ze){let Nn,Pi=tn*Rn,$i=$e*Rn,er=-1;const Cr=(xt/It<<5)+(le+1)+this.points.length;for(const Vn of vn){const Kn=Vn*It;if(Xe[Kn+2]<=le)continue;Xe[Kn+2]=le;const vr=Xe[Kn+5];Pi+=Xe[Kn]*vr,$i+=Xe[Kn+1]*vr,Xe[Kn+4]=Cr,De&&(Nn||(Nn=this._map(Xe,xt,!0),er=this.clusterProps.length,this.clusterProps.push(Nn)),De(Nn,this._map(Xe,Kn)))}Xe[xt+4]=Cr,_t.push(Pi/nn,$i/nn,1/0,Cr,-1,nn),De&&_t.push(er)}else{for(let Nn=0;Nn<It;Nn++)_t.push(Xe[xt+Nn]);if(nn>1)for(const Nn of vn){const Pi=Nn*It;if(!(Xe[Pi+2]<=le)){Xe[Pi+2]=le;for(let $i=0;$i<It;$i++)_t.push(Xe[Pi+$i])}}}}return _t}_getOriginId(se){return se-this.points.length>>5}_getOriginZoom(se){return(se-this.points.length)%32}_map(se,le,fe){if(se[le+5]>1){const Ze=this.clusterProps[se[le+6]];return fe?Object.assign({},Ze):Ze}const Se=this.points[se[le+3]].properties,De=this.options.map(Se);return fe&&De===Se?Object.assign({},De):De}}function In(Ke,se,le){return{type:"Feature",id:Ke[se+3],properties:Jn(Ke,se,le),geometry:{type:"Point",coordinates:[(fe=Ke[se],360*(fe-.5)),Tt(Ke[se+1])]}};var fe}function Jn(Ke,se,le){const fe=Ke[se+5],Se=fe>=1e4?`${Math.round(fe/1e3)}k`:fe>=1e3?Math.round(fe/100)/10+"k":fe,De=Ke[se+6],Ze=De===-1?{}:Object.assign({},le[De]);return Object.assign(Ze,{cluster:!0,cluster_id:Ke[se+3],point_count:fe,point_count_abbreviated:Se})}function mt(Ke){return Ke/360+.5}function $t(Ke){const se=Math.sin(Ke*Math.PI/180),le=.5-.25*Math.log((1+se)/(1-se))/Math.PI;return le<0?0:le>1?1:le}function Tt(Ke){const se=(180-360*Ke)*Math.PI/180;return 360*Math.atan(Math.exp(se))/Math.PI-90}function zt(Ke,se,le,fe){let Se=fe;const De=se+(le-se>>1);let Ze,et=le-se;const Xe=Ke[se],_t=Ke[se+1],It=Ke[le],xt=Ke[le+1];for(let tn=se+3;tn<le;tn+=3){const $e=Bt(Ke[tn],Ke[tn+1],Xe,_t,It,xt);if($e>Se)Ze=tn,Se=$e;else if($e===Se){const vn=Math.abs(tn-De);vn<et&&(Ze=tn,et=vn)}}Se>fe&&(Ze-se>3&&zt(Ke,se,Ze,fe),Ke[Ze+2]=Se,le-Ze>3&&zt(Ke,Ze,le,fe))}function Bt(Ke,se,le,fe,Se,De){let Ze=Se-le,et=De-fe;if(Ze!==0||et!==0){const Xe=((Ke-le)*Ze+(se-fe)*et)/(Ze*Ze+et*et);Xe>1?(le=Se,fe=De):Xe>0&&(le+=Ze*Xe,fe+=et*Xe)}return Ze=Ke-le,et=se-fe,Ze*Ze+et*et}function ke(Ke,se,le,fe){const Se={id:Ke??null,type:se,geometry:le,tags:fe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(se==="Point"||se==="MultiPoint"||se==="LineString")vt(Se,le);else if(se==="Polygon")vt(Se,le[0]);else if(se==="MultiLineString")for(const De of le)vt(Se,De);else if(se==="MultiPolygon")for(const De of le)vt(Se,De[0]);return Se}function vt(Ke,se){for(let le=0;le<se.length;le+=3)Ke.minX=Math.min(Ke.minX,se[le]),Ke.minY=Math.min(Ke.minY,se[le+1]),Ke.maxX=Math.max(Ke.maxX,se[le]),Ke.maxY=Math.max(Ke.maxY,se[le+1])}function Ot(Ke,se,le,fe){if(!se.geometry)return;const Se=se.geometry.coordinates;if(Se&&Se.length===0)return;const De=se.geometry.type,Ze=Math.pow(le.tolerance/((1<<le.maxZoom)*le.extent),2);let et=[],Xe=se.id;if(le.promoteId?Xe=se.properties[le.promoteId]:le.generateId&&(Xe=fe||0),De==="Point")jt(Se,et);else if(De==="MultiPoint")for(const _t of Se)jt(_t,et);else if(De==="LineString")Jt(Se,et,Ze,!1);else if(De==="MultiLineString"){if(le.lineMetrics){for(const _t of Se)et=[],Jt(_t,et,Ze,!1),Ke.push(ke(Xe,"LineString",et,se.properties));return}Xt(Se,et,Ze,!1)}else if(De==="Polygon")Xt(Se,et,Ze,!0);else{if(De!=="MultiPolygon"){if(De==="GeometryCollection"){for(const _t of se.geometry.geometries)Ot(Ke,{id:Xe,geometry:_t,properties:se.properties},le,fe);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const _t of Se){const It=[];Xt(_t,It,Ze,!0),et.push(It)}}Ke.push(ke(Xe,De,et,se.properties))}function jt(Ke,se){se.push(Fn(Ke[0]),si(Ke[1]),0)}function Jt(Ke,se,le,fe){let Se,De,Ze=0;for(let Xe=0;Xe<Ke.length;Xe++){const _t=Fn(Ke[Xe][0]),It=si(Ke[Xe][1]);se.push(_t,It,0),Xe>0&&(Ze+=fe?(Se*It-_t*De)/2:Math.sqrt(Math.pow(_t-Se,2)+Math.pow(It-De,2))),Se=_t,De=It}const et=se.length-3;se[2]=1,zt(se,0,et,le),se[et+2]=1,se.size=Math.abs(Ze),se.start=0,se.end=se.size}function Xt(Ke,se,le,fe){for(let Se=0;Se<Ke.length;Se++){const De=[];Jt(Ke[Se],De,le,fe),se.push(De)}}function Fn(Ke){return Ke/360+.5}function si(Ke){const se=Math.sin(Ke*Math.PI/180),le=.5-.25*Math.log((1+se)/(1-se))/Math.PI;return le<0?0:le>1?1:le}function di(Ke,se,le,fe,Se,De,Ze,et){if(fe/=se,De>=(le/=se)&&Ze<fe)return Ke;if(Ze<le||De>=fe)return null;const Xe=[];for(const _t of Ke){const It=_t.geometry;let xt=_t.type;const tn=Se===0?_t.minX:_t.minY,$e=Se===0?_t.maxX:_t.maxY;if(tn>=le&&$e<fe){Xe.push(_t);continue}if($e<le||tn>=fe)continue;let vn=[];if(xt==="Point"||xt==="MultiPoint")ds(It,vn,le,fe,Se);else if(xt==="LineString")Ns(It,vn,le,fe,Se,!1,et.lineMetrics);else if(xt==="MultiLineString")Ni(It,vn,le,fe,Se,!1);else if(xt==="Polygon")Ni(It,vn,le,fe,Se,!0);else if(xt==="MultiPolygon")for(const Rn of It){const nn=[];Ni(Rn,nn,le,fe,Se,!0),nn.length&&vn.push(nn)}if(vn.length){if(et.lineMetrics&&xt==="LineString"){for(const Rn of vn)Xe.push(ke(_t.id,xt,Rn,_t.tags));continue}xt!=="LineString"&&xt!=="MultiLineString"||(vn.length===1?(xt="LineString",vn=vn[0]):xt="MultiLineString"),xt!=="Point"&&xt!=="MultiPoint"||(xt=vn.length===3?"Point":"MultiPoint"),Xe.push(ke(_t.id,xt,vn,_t.tags))}}return Xe.length?Xe:null}function ds(Ke,se,le,fe,Se){for(let De=0;De<Ke.length;De+=3){const Ze=Ke[De+Se];Ze>=le&&Ze<=fe&&Ii(se,Ke[De],Ke[De+1],Ke[De+2])}}function Ns(Ke,se,le,fe,Se,De,Ze){let et=kr(Ke);const Xe=Se===0?Va:Ta;let _t,It,xt=Ke.start;for(let nn=0;nn<Ke.length-3;nn+=3){const Nn=Ke[nn],Pi=Ke[nn+1],$i=Ke[nn+2],er=Ke[nn+3],Cr=Ke[nn+4],Vn=Se===0?Nn:Pi,Kn=Se===0?er:Cr;let vr=!1;Ze&&(_t=Math.sqrt(Math.pow(Nn-er,2)+Math.pow(Pi-Cr,2))),Vn<le?Kn>le&&(It=Xe(et,Nn,Pi,er,Cr,le),Ze&&(et.start=xt+_t*It)):Vn>fe?Kn<fe&&(It=Xe(et,Nn,Pi,er,Cr,fe),Ze&&(et.start=xt+_t*It)):Ii(et,Nn,Pi,$i),Kn<le&&Vn>=le&&(It=Xe(et,Nn,Pi,er,Cr,le),vr=!0),Kn>fe&&Vn<=fe&&(It=Xe(et,Nn,Pi,er,Cr,fe),vr=!0),!De&&vr&&(Ze&&(et.end=xt+_t*It),se.push(et),et=kr(Ke)),Ze&&(xt+=_t)}let tn=Ke.length-3;const $e=Ke[tn],vn=Ke[tn+1],Rn=Se===0?$e:vn;Rn>=le&&Rn<=fe&&Ii(et,$e,vn,Ke[tn+2]),tn=et.length-3,De&&tn>=3&&(et[tn]!==et[0]||et[tn+1]!==et[1])&&Ii(et,et[0],et[1],et[2]),et.length&&se.push(et)}function kr(Ke){const se=[];return se.size=Ke.size,se.start=Ke.start,se.end=Ke.end,se}function Ni(Ke,se,le,fe,Se,De){for(const Ze of Ke)Ns(Ze,se,le,fe,Se,De,!1)}function Ii(Ke,se,le,fe){Ke.push(se,le,fe)}function Va(Ke,se,le,fe,Se,De){const Ze=(De-se)/(fe-se);return Ii(Ke,De,le+(Se-le)*Ze,1),Ze}function Ta(Ke,se,le,fe,Se,De){const Ze=(De-le)/(Se-le);return Ii(Ke,se+(fe-se)*Ze,De,1),Ze}function Bs(Ke,se){const le=[];for(let fe=0;fe<Ke.length;fe++){const Se=Ke[fe],De=Se.type;let Ze;if(De==="Point"||De==="MultiPoint"||De==="LineString")Ze=Sa(Se.geometry,se);else if(De==="MultiLineString"||De==="Polygon"){Ze=[];for(const et of Se.geometry)Ze.push(Sa(et,se))}else if(De==="MultiPolygon"){Ze=[];for(const et of Se.geometry){const Xe=[];for(const _t of et)Xe.push(Sa(_t,se));Ze.push(Xe)}}le.push(ke(Se.id,De,Ze,Se.tags))}return le}function Sa(Ke,se){const le=[];le.size=Ke.size,Ke.start!==void 0&&(le.start=Ke.start,le.end=Ke.end);for(let fe=0;fe<Ke.length;fe+=3)le.push(Ke[fe]+se,Ke[fe+1],Ke[fe+2]);return le}function Bi(Ke,se){if(Ke.transformed)return Ke;const le=1<<Ke.z,fe=Ke.x,Se=Ke.y;for(const De of Ke.features){const Ze=De.geometry,et=De.type;if(De.geometry=[],et===1)for(let Xe=0;Xe<Ze.length;Xe+=2)De.geometry.push(fr(Ze[Xe],Ze[Xe+1],se,le,fe,Se));else for(let Xe=0;Xe<Ze.length;Xe++){const _t=[];for(let It=0;It<Ze[Xe].length;It+=2)_t.push(fr(Ze[Xe][It],Ze[Xe][It+1],se,le,fe,Se));De.geometry.push(_t)}}return Ke.transformed=!0,Ke}function fr(Ke,se,le,fe,Se,De){return[Math.round(le*(Ke*fe-Se)),Math.round(le*(se*fe-De))]}function Ea(Ke,se,le,fe,Se){const De=se===Se.maxZoom?0:Se.tolerance/((1<<se)*Se.extent),Ze={features:[],numPoints:0,numSimplified:0,numFeatures:Ke.length,source:null,x:le,y:fe,z:se,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const et of Ke)So(Ze,et,De,Se);return Ze}function So(Ke,se,le,fe){const Se=se.geometry,De=se.type,Ze=[];if(Ke.minX=Math.min(Ke.minX,se.minX),Ke.minY=Math.min(Ke.minY,se.minY),Ke.maxX=Math.max(Ke.maxX,se.maxX),Ke.maxY=Math.max(Ke.maxY,se.maxY),De==="Point"||De==="MultiPoint")for(let et=0;et<Se.length;et+=3)Ze.push(Se[et],Se[et+1]),Ke.numPoints++,Ke.numSimplified++;else if(De==="LineString")so(Ze,Se,Ke,le,!1,!1);else if(De==="MultiLineString"||De==="Polygon")for(let et=0;et<Se.length;et++)so(Ze,Se[et],Ke,le,De==="Polygon",et===0);else if(De==="MultiPolygon")for(let et=0;et<Se.length;et++){const Xe=Se[et];for(let _t=0;_t<Xe.length;_t++)so(Ze,Xe[_t],Ke,le,!0,_t===0)}if(Ze.length){let et=se.tags||null;if(De==="LineString"&&fe.lineMetrics){et={};for(const _t in se.tags)et[_t]=se.tags[_t];et.mapbox_clip_start=Se.start/Se.size,et.mapbox_clip_end=Se.end/Se.size}const Xe={geometry:Ze,type:De==="Polygon"||De==="MultiPolygon"?3:De==="LineString"||De==="MultiLineString"?2:1,tags:et};se.id!==null&&(Xe.id=se.id),Ke.features.push(Xe)}}function so(Ke,se,le,fe,Se,De){const Ze=fe*fe;if(fe>0&&se.size<(Se?Ze:fe))return void(le.numPoints+=se.length/3);const et=[];for(let Xe=0;Xe<se.length;Xe+=3)(fe===0||se[Xe+2]>Ze)&&(le.numSimplified++,et.push(se[Xe],se[Xe+1])),le.numPoints++;Se&&(function(Xe,_t){let It=0;for(let xt=0,tn=Xe.length,$e=tn-2;xt<tn;$e=xt,xt+=2)It+=(Xe[xt]-Xe[$e])*(Xe[xt+1]+Xe[$e+1]);if(It>0===_t)for(let xt=0,tn=Xe.length;xt<tn/2;xt+=2){const $e=Xe[xt],vn=Xe[xt+1];Xe[xt]=Xe[tn-2-xt],Xe[xt+1]=Xe[tn-1-xt],Xe[tn-2-xt]=$e,Xe[tn-1-xt]=vn}})(et,De),Ke.push(et)}const $r={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class fs{constructor(se,le){const fe=(le=this.options=(function(De,Ze){for(const et in Ze)De[et]=Ze[et];return De})(Object.create($r),le)).debug;if(fe&&console.time("preprocess data"),le.maxZoom<0||le.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(le.promoteId&&le.generateId)throw new Error("promoteId and generateId cannot be used together.");let Se=(function(De,Ze){const et=[];if(De.type==="FeatureCollection")for(let Xe=0;Xe<De.features.length;Xe++)Ot(et,De.features[Xe],Ze,Xe);else Ot(et,De.type==="Feature"?De:{geometry:De},Ze);return et})(se,le);this.tiles={},this.tileCoords=[],fe&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",le.indexMaxZoom,le.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Se=(function(De,Ze){const et=Ze.buffer/Ze.extent;let Xe=De;const _t=di(De,1,-1-et,et,0,-1,2,Ze),It=di(De,1,1-et,2+et,0,-1,2,Ze);return(_t||It)&&(Xe=di(De,1,-et,1+et,0,-1,2,Ze)||[],_t&&(Xe=Bs(_t,1).concat(Xe)),It&&(Xe=Xe.concat(Bs(It,-1)))),Xe})(Se,le),Se.length&&this.splitTile(Se,0,0,0),fe&&(Se.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(se,le,fe,Se,De,Ze,et){const Xe=[se,le,fe,Se],_t=this.options,It=_t.debug;for(;Xe.length;){Se=Xe.pop(),fe=Xe.pop(),le=Xe.pop(),se=Xe.pop();const xt=1<<le,tn=ps(le,fe,Se);let $e=this.tiles[tn];if(!$e&&(It>1&&console.time("creation"),$e=this.tiles[tn]=Ea(se,le,fe,Se,_t),this.tileCoords.push({z:le,x:fe,y:Se}),It)){It>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",le,fe,Se,$e.numFeatures,$e.numPoints,$e.numSimplified),console.timeEnd("creation"));const vr=`z${le}`;this.stats[vr]=(this.stats[vr]||0)+1,this.total++}if($e.source=se,De==null){if(le===_t.indexMaxZoom||$e.numPoints<=_t.indexMaxPoints)continue}else{if(le===_t.maxZoom||le===De)continue;if(De!=null){const vr=De-le;if(fe!==Ze>>vr||Se!==et>>vr)continue}}if($e.source=null,se.length===0)continue;It>1&&console.time("clipping");const vn=.5*_t.buffer/_t.extent,Rn=.5-vn,nn=.5+vn,Nn=1+vn;let Pi=null,$i=null,er=null,Cr=null,Vn=di(se,xt,fe-vn,fe+nn,0,$e.minX,$e.maxX,_t),Kn=di(se,xt,fe+Rn,fe+Nn,0,$e.minX,$e.maxX,_t);se=null,Vn&&(Pi=di(Vn,xt,Se-vn,Se+nn,1,$e.minY,$e.maxY,_t),$i=di(Vn,xt,Se+Rn,Se+Nn,1,$e.minY,$e.maxY,_t),Vn=null),Kn&&(er=di(Kn,xt,Se-vn,Se+nn,1,$e.minY,$e.maxY,_t),Cr=di(Kn,xt,Se+Rn,Se+Nn,1,$e.minY,$e.maxY,_t),Kn=null),It>1&&console.timeEnd("clipping"),Xe.push(Pi||[],le+1,2*fe,2*Se),Xe.push($i||[],le+1,2*fe,2*Se+1),Xe.push(er||[],le+1,2*fe+1,2*Se),Xe.push(Cr||[],le+1,2*fe+1,2*Se+1)}}getTile(se,le,fe){se=+se,le=+le,fe=+fe;const Se=this.options,{extent:De,debug:Ze}=Se;if(se<0||se>24)return null;const et=1<<se,Xe=ps(se,le=le+et&et-1,fe);if(this.tiles[Xe])return Bi(this.tiles[Xe],De);Ze>1&&console.log("drilling down to z%d-%d-%d",se,le,fe);let _t,It=se,xt=le,tn=fe;for(;!_t&&It>0;)It--,xt>>=1,tn>>=1,_t=this.tiles[ps(It,xt,tn)];return _t&&_t.source?(Ze>1&&(console.log("found parent tile z%d-%d-%d",It,xt,tn),console.time("drilling down")),this.splitTile(_t.source,It,xt,tn,se,le,fe),Ze>1&&console.timeEnd("drilling down"),this.tiles[Xe]?Bi(this.tiles[Xe],De):null):null}}function ps(Ke,se,le){return 32*((1<<Ke)*le+se)+Ke}class Fs extends G{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(se,le){return _._(this,void 0,void 0,(function*(){const fe=se.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const Se=this._geoJSONIndex.getTile(fe.z,fe.x,fe.y);if(!Se)return null;const De=new Je(Se.features,{version:2,extent:_.$});let Ze=(function(et){const Xe=new _.cM;return(function(_t,It){for(const xt in _t.layers)It.writeMessage(3,qe,_t.layers[xt])})(et,Xe),Xe.finish()})(De);return Ze.byteOffset===0&&Ze.byteLength===Ze.buffer.byteLength||(Ze=new Uint8Array(Ze)),{vectorTile:De,rawData:Ze.buffer}}))}loadData(se){return _._(this,void 0,void 0,(function*(){var le;(le=this._pendingRequest)===null||le===void 0||le.abort();const fe=!!(se&&se.request&&se.request.collectResourceTiming)&&new _.cN(se.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(se,this._pendingRequest);const Se=yield this._pendingData;this._geoJSONIndex=se.cluster?new Re((function({superclusterOptions:Ze,clusterProperties:et}){if(!et||!Ze)return Ze;const Xe={},_t={},It={accumulated:null,zoom:0},xt={properties:null},tn=Object.keys(et);for(const $e of tn){const[vn,Rn]=et[$e],nn=_.cT(Rn),Nn=_.cT(typeof vn=="string"?[vn,["accumulated"],["get",$e]]:vn);Xe[$e]=nn.value,_t[$e]=Nn.value}return Ze.map=$e=>{xt.properties=$e;const vn={};for(const Rn of tn)vn[Rn]=Xe[Rn].evaluate(It,xt);return vn},Ze.reduce=($e,vn)=>{xt.properties=vn;for(const Rn of tn)It.accumulated=$e[Rn],$e[Rn]=_t[Rn].evaluate(It,xt)},Ze})(se)).load(Se.features):(function(Ze,et){return new fs(Ze,et)})(Se,se.geojsonVtOptions),this.loaded={};const De={data:Se};if(fe){const Ze=fe.finish();Ze&&(De.resourceTiming={},De.resourceTiming[se.source]=JSON.parse(JSON.stringify(Ze)))}return De}catch(Se){if(delete this._pendingRequest,_.cy(Se))return{abandoned:!0};throw Se}}))}getData(){return _._(this,void 0,void 0,(function*(){return this._pendingData}))}reloadTile(se){const le=this.loaded;return le&&le[se.uid]?super.reloadTile(se):this.loadTile(se)}loadAndProcessGeoJSON(se,le){return _._(this,void 0,void 0,(function*(){let fe=yield this.loadGeoJSON(se,le);if(delete this._pendingRequest,typeof fe!="object")throw new Error(`Input data given to '${se.source}' is not a valid GeoJSON object.`);if(Ne(fe,!0),se.filter){const Se=_.cT(se.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Se.result==="error")throw new Error(Se.value.map((Ze=>`${Ze.key}: ${Ze.message}`)).join(", "));fe={type:"FeatureCollection",features:fe.features.filter((Ze=>Se.value.evaluate({zoom:0},Ze)))}}return fe}))}loadGeoJSON(se,le){return _._(this,void 0,void 0,(function*(){const{promoteId:fe}=se;if(se.request){const Se=yield _.j(se.request,le);return this._dataUpdateable=_.cV(Se.data,fe)?_.cU(Se.data,fe):void 0,Se.data}if(typeof se.data=="string")try{const Se=JSON.parse(se.data);return this._dataUpdateable=_.cV(Se,fe)?_.cU(Se,fe):void 0,Se}catch{throw new Error(`Input data given to '${se.source}' is not a valid GeoJSON object.`)}if(!se.dataDiff)throw new Error(`Input data given to '${se.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${se.source}`);return _.cW(this._dataUpdateable,se.dataDiff,fe),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}}))}removeSource(se){return _._(this,void 0,void 0,(function*(){this._pendingRequest&&this._pendingRequest.abort()}))}getClusterExpansionZoom(se){return this._geoJSONIndex.getClusterExpansionZoom(se.clusterId)}getClusterChildren(se){return this._geoJSONIndex.getChildren(se.clusterId)}getClusterLeaves(se){return this._geoJSONIndex.getLeaves(se.clusterId,se.limit,se.offset)}}class ms{constructor(se){this.self=se,this.actor=new _.J(se),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(le,fe)=>{if(this.externalWorkerSourceTypes[le])throw new Error(`Worker source with name "${le}" already registered.`);this.externalWorkerSourceTypes[le]=fe},this.self.addProtocol=_.cA,this.self.removeProtocol=_.cB,this.self.registerRTLTextPlugin=le=>{_.cX.setMethods(le)},this.actor.registerMessageHandler("LDT",((le,fe)=>this._getDEMWorkerSource(le,fe.source).loadTile(fe))),this.actor.registerMessageHandler("RDT",((le,fe)=>_._(this,void 0,void 0,(function*(){this._getDEMWorkerSource(le,fe.source).removeTile(fe)})))),this.actor.registerMessageHandler("GCEZ",((le,fe)=>_._(this,void 0,void 0,(function*(){return this._getWorkerSource(le,fe.type,fe.source).getClusterExpansionZoom(fe)})))),this.actor.registerMessageHandler("GCC",((le,fe)=>_._(this,void 0,void 0,(function*(){return this._getWorkerSource(le,fe.type,fe.source).getClusterChildren(fe)})))),this.actor.registerMessageHandler("GCL",((le,fe)=>_._(this,void 0,void 0,(function*(){return this._getWorkerSource(le,fe.type,fe.source).getClusterLeaves(fe)})))),this.actor.registerMessageHandler("LD",((le,fe)=>this._getWorkerSource(le,fe.type,fe.source).loadData(fe))),this.actor.registerMessageHandler("GD",((le,fe)=>this._getWorkerSource(le,fe.type,fe.source).getData())),this.actor.registerMessageHandler("LT",((le,fe)=>this._getWorkerSource(le,fe.type,fe.source).loadTile(fe))),this.actor.registerMessageHandler("RT",((le,fe)=>this._getWorkerSource(le,fe.type,fe.source).reloadTile(fe))),this.actor.registerMessageHandler("AT",((le,fe)=>this._getWorkerSource(le,fe.type,fe.source).abortTile(fe))),this.actor.registerMessageHandler("RMT",((le,fe)=>this._getWorkerSource(le,fe.type,fe.source).removeTile(fe))),this.actor.registerMessageHandler("RS",((le,fe)=>_._(this,void 0,void 0,(function*(){if(!this.workerSources[le]||!this.workerSources[le][fe.type]||!this.workerSources[le][fe.type][fe.source])return;const Se=this.workerSources[le][fe.type][fe.source];delete this.workerSources[le][fe.type][fe.source],Se.removeSource!==void 0&&Se.removeSource(fe)})))),this.actor.registerMessageHandler("RM",(le=>_._(this,void 0,void 0,(function*(){delete this.layerIndexes[le],delete this.availableImages[le],delete this.workerSources[le],delete this.demWorkerSources[le]})))),this.actor.registerMessageHandler("SR",((le,fe)=>_._(this,void 0,void 0,(function*(){this.referrer=fe})))),this.actor.registerMessageHandler("SRPS",((le,fe)=>this._syncRTLPluginState(le,fe))),this.actor.registerMessageHandler("IS",((le,fe)=>_._(this,void 0,void 0,(function*(){this.self.importScripts(fe)})))),this.actor.registerMessageHandler("SI",((le,fe)=>this._setImages(le,fe))),this.actor.registerMessageHandler("UL",((le,fe)=>_._(this,void 0,void 0,(function*(){this._getLayerIndex(le).update(fe.layers,fe.removedIds)})))),this.actor.registerMessageHandler("SL",((le,fe)=>_._(this,void 0,void 0,(function*(){this._getLayerIndex(le).replace(fe)}))))}_setImages(se,le){return _._(this,void 0,void 0,(function*(){this.availableImages[se]=le;for(const fe in this.workerSources[se]){const Se=this.workerSources[se][fe];for(const De in Se)Se[De].availableImages=le}}))}_syncRTLPluginState(se,le){return _._(this,void 0,void 0,(function*(){return yield _.cX.syncState(le,this.self.importScripts)}))}_getAvailableImages(se){let le=this.availableImages[se];return le||(le=[]),le}_getLayerIndex(se){let le=this.layerIndexes[se];return le||(le=this.layerIndexes[se]=new c),le}_getWorkerSource(se,le,fe){if(this.workerSources[se]||(this.workerSources[se]={}),this.workerSources[se][le]||(this.workerSources[se][le]={}),!this.workerSources[se][le][fe]){const Se={sendAsync:(De,Ze)=>(De.targetMapId=se,this.actor.sendAsync(De,Ze))};switch(le){case"vector":this.workerSources[se][le][fe]=new G(Se,this._getLayerIndex(se),this._getAvailableImages(se));break;case"geojson":this.workerSources[se][le][fe]=new Fs(Se,this._getLayerIndex(se),this._getAvailableImages(se));break;default:this.workerSources[se][le][fe]=new this.externalWorkerSourceTypes[le](Se,this._getLayerIndex(se),this._getAvailableImages(se))}}return this.workerSources[se][le][fe]}_getDEMWorkerSource(se,le){return this.demWorkerSources[se]||(this.demWorkerSources[se]={}),this.demWorkerSources[se][le]||(this.demWorkerSources[se][le]=new ee),this.demWorkerSources[se][le]}}return _.i(self)&&(self.worker=new ms(self)),ms})),d("index",["exports","./shared"],(function(_,c){var M="5.6.2";function k(){var T=new c.A(4);return c.A!=Float32Array&&(T[1]=0,T[2]=0),T[0]=1,T[3]=1,T}let j,G;const ee={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(T,t,u){const m=requestAnimationFrame((S=>{b(),t(S)})),{unsubscribe:b}=c.s(T.signal,"abort",(()=>{b(),cancelAnimationFrame(m),u(c.c())}),!1)},frameAsync(T){return new Promise(((t,u)=>{this.frame(T,t,u)}))},getImageData(T,t=0){return this.getImageCanvasContext(T).getImageData(-t,-t,T.width+2*t,T.height+2*t)},getImageCanvasContext(T){const t=window.document.createElement("canvas"),u=t.getContext("2d",{willReadFrequently:!0});if(!u)throw new Error("failed to create canvas 2d context");return t.width=T.width,t.height=T.height,u.drawImage(T,0,0,T.width,T.height),u},resolveURL:T=>(j||(j=document.createElement("a")),j.href=T,j.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(G==null&&(G=matchMedia("(prefers-reduced-motion: reduce)")),G.matches)}};class Y{static testProp(t){if(!Y.docStyle)return t[0];for(let u=0;u<t.length;u++)if(t[u]in Y.docStyle)return t[u];return t[0]}static create(t,u,m){const b=window.document.createElement(t);return u!==void 0&&(b.className=u),m&&m.appendChild(b),b}static createNS(t,u){return window.document.createElementNS(t,u)}static disableDrag(){Y.docStyle&&Y.selectProp&&(Y.userSelect=Y.docStyle[Y.selectProp],Y.docStyle[Y.selectProp]="none")}static enableDrag(){Y.docStyle&&Y.selectProp&&(Y.docStyle[Y.selectProp]=Y.userSelect)}static setTransform(t,u){t.style[Y.transformProp]=u}static addEventListener(t,u,m,b={}){t.addEventListener(u,m,"passive"in b?b:b.capture)}static removeEventListener(t,u,m,b={}){t.removeEventListener(u,m,"passive"in b?b:b.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",Y.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",Y.suppressClickInternal,!0),window.setTimeout((()=>{window.removeEventListener("click",Y.suppressClickInternal,!0)}),0)}static getScale(t){const u=t.getBoundingClientRect();return{x:u.width/t.offsetWidth||1,y:u.height/t.offsetHeight||1,boundingClientRect:u}}static getPoint(t,u,m){const b=u.boundingClientRect;return new c.P((m.clientX-b.left)/u.x-t.clientLeft,(m.clientY-b.top)/u.y-t.clientTop)}static mousePos(t,u){const m=Y.getScale(t);return Y.getPoint(t,m,u)}static touchPos(t,u){const m=[],b=Y.getScale(t);for(let S=0;S<u.length;S++)m.push(Y.getPoint(t,b,u[S]));return m}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}static sanitize(t){const u=new DOMParser().parseFromString(t,"text/html").body||document.createElement("body"),m=u.querySelectorAll("script");for(const b of m)b.remove();return Y.clean(u),u.innerHTML}static isPossiblyDangerous(t,u){const m=u.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(t)||!m.includes("javascript:")&&!m.includes("data:"))||!!t.startsWith("on")||void 0}static clean(t){const u=t.children;for(const m of u)Y.removeAttributes(m),Y.clean(m)}static removeAttributes(t){for(const{name:u,value:m}of t.attributes)Y.isPossiblyDangerous(u,m)&&t.removeAttribute(u)}}Y.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,Y.selectProp=Y.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),Y.transformProp=Y.testProp(["transform","WebkitTransform"]);const xe={supported:!1,testSupport:function(T){!tt&&Ne&&(Je?qe(T):be=T)}};let be,Ne,tt=!1,Je=!1;function qe(T){const t=T.createTexture();T.bindTexture(T.TEXTURE_2D,t);try{if(T.texImage2D(T.TEXTURE_2D,0,T.RGBA,T.RGBA,T.UNSIGNED_BYTE,Ne),T.isContextLost())return;xe.supported=!0}catch{}T.deleteTexture(t),tt=!0}var He;typeof document<"u"&&(Ne=document.createElement("img"),Ne.onload=()=>{be&&qe(be),be=null,Je=!0},Ne.onerror=()=>{tt=!0,be=null},Ne.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),(function(T){let t,u,m,b;T.resetRequestQueue=()=>{t=[],u=0,m=0,b={}},T.addThrottleControl=N=>{const U=m++;return b[U]=N,U},T.removeThrottleControl=N=>{delete b[N],C()},T.getImage=(N,U,q=!0)=>new Promise(((W,H)=>{xe.supported&&(N.headers||(N.headers={}),N.headers.accept="image/webp,*/*"),c.e(N,{type:"image"}),t.push({abortController:U,requestParameters:N,supportImageRefresh:q,state:"queued",onError:J=>{H(J)},onSuccess:J=>{W(J)}}),C()}));const S=N=>c._(this,void 0,void 0,(function*(){N.state="running";const{requestParameters:U,supportImageRefresh:q,onError:W,onSuccess:H,abortController:J}=N,ae=q===!1&&!c.i(self)&&!c.g(U.url)&&(!U.headers||Object.keys(U.headers).reduce(((ve,we)=>ve&&we==="accept"),!0));u++;const ge=ae?O(U,J):c.m(U,J);try{const ve=yield ge;delete N.abortController,N.state="completed",ve.data instanceof HTMLImageElement||c.b(ve.data)?H(ve):ve.data&&H({data:yield(me=ve.data,typeof createImageBitmap=="function"?c.f(me):c.h(me)),cacheControl:ve.cacheControl,expires:ve.expires})}catch(ve){delete N.abortController,W(ve)}finally{u--,C()}var me})),C=()=>{const N=(()=>{for(const U of Object.keys(b))if(b[U]())return!0;return!1})()?c.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:c.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let U=u;U<N&&t.length>0;U++){const q=t.shift();q.abortController.signal.aborted?U--:S(q)}},O=(N,U)=>new Promise(((q,W)=>{const H=new Image,J=N.url,ae=N.credentials;ae&&ae==="include"?H.crossOrigin="use-credentials":(ae&&ae==="same-origin"||!c.d(J))&&(H.crossOrigin="anonymous"),U.signal.addEventListener("abort",(()=>{H.src="",W(c.c())})),H.fetchPriority="high",H.onload=()=>{H.onerror=H.onload=null,q({data:H})},H.onerror=()=>{H.onerror=H.onload=null,U.signal.aborted||W(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},H.src=J}))})(He||(He={})),He.resetRequestQueue();class Ue{constructor(t){this._transformRequestFn=t??null}transformRequest(t,u){return this._transformRequestFn&&this._transformRequestFn(t,u)||{url:t}}setTransformRequest(t){this._transformRequestFn=t}}function Be(T){const t=[];if(typeof T=="string")t.push({id:"default",url:T});else if(T&&T.length>0){const u=[];for(const{id:m,url:b}of T){const S=`${m}${b}`;u.indexOf(S)===-1&&(u.push(S),t.push({id:m,url:b}))}}return t}function de(T,t,u){try{const m=new URL(T);return m.pathname+=`${t}${u}`,m.toString()}catch{throw new Error(`Invalid sprite URL "${T}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function ce(T){const{userImage:t}=T;return!!(t&&t.render&&t.render())&&(T.data.replace(new Uint8Array(t.data.buffer)),!0)}class _e extends c.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new c.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:u,promiseResolve:m}of this.requestors)m(this._getImagesForIds(u));this.requestors=[]}}getImage(t){const u=this.images[t];if(u&&!u.data&&u.spriteData){const m=u.spriteData;u.data=new c.R({width:m.width,height:m.height},m.context.getImageData(m.x,m.y,m.width,m.height).data),u.spriteData=null}return u}addImage(t,u){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,u)&&(this.images[t]=u)}_validate(t,u){let m=!0;const b=u.data||u.spriteData;return this._validateStretch(u.stretchX,b&&b.width)||(this.fire(new c.k(new Error(`Image "${t}" has invalid "stretchX" value`))),m=!1),this._validateStretch(u.stretchY,b&&b.height)||(this.fire(new c.k(new Error(`Image "${t}" has invalid "stretchY" value`))),m=!1),this._validateContent(u.content,u)||(this.fire(new c.k(new Error(`Image "${t}" has invalid "content" value`))),m=!1),m}_validateStretch(t,u){if(!t)return!0;let m=0;for(const b of t){if(b[0]<m||b[1]<b[0]||u<b[1])return!1;m=b[1]}return!0}_validateContent(t,u){if(!t)return!0;if(t.length!==4)return!1;const m=u.spriteData,b=m&&m.width||u.data.width,S=m&&m.height||u.data.height;return!(t[0]<0||b<t[0]||t[1]<0||S<t[1]||t[2]<0||b<t[2]||t[3]<0||S<t[3]||t[2]<t[0]||t[3]<t[1])}updateImage(t,u,m=!0){const b=this.getImage(t);if(m&&(b.data.width!==u.data.width||b.data.height!==u.data.height))throw new Error(`size mismatch between old image (${b.data.width}x${b.data.height}) and new image (${u.data.width}x${u.data.height}).`);u.version=b.version+1,this.images[t]=u,this.updatedImages[t]=!0}removeImage(t){const u=this.images[t];delete this.images[t],delete this.patterns[t],u.userImage&&u.userImage.onRemove&&u.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t){return new Promise(((u,m)=>{let b=!0;if(!this.isLoaded())for(const S of t)this.images[S]||(b=!1);this.isLoaded()||b?u(this._getImagesForIds(t)):this.requestors.push({ids:t,promiseResolve:u})}))}_getImagesForIds(t){const u={};for(const m of t){let b=this.getImage(m);b||(this.fire(new c.l("styleimagemissing",{id:m})),b=this.getImage(m)),b?u[m]={data:b.data.clone(),pixelRatio:b.pixelRatio,sdf:b.sdf,version:b.version,stretchX:b.stretchX,stretchY:b.stretchY,content:b.content,textFitWidth:b.textFitWidth,textFitHeight:b.textFitHeight,hasRenderCallback:!!(b.userImage&&b.userImage.render)}:c.w(`Image "${m}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return u}getPixelSize(){const{width:t,height:u}=this.atlasImage;return{width:t,height:u}}getPattern(t){const u=this.patterns[t],m=this.getImage(t);if(!m)return null;if(u&&u.position.version===m.version)return u.position;if(u)u.position.version=m.version;else{const b={w:m.data.width+2,h:m.data.height+2,x:0,y:0},S=new c.I(b,m);this.patterns[t]={bin:b,position:S}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const u=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new c.T(t,this.atlasImage,u.RGBA),this.atlasTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const S in this.patterns)t.push(this.patterns[S].bin);const{w:u,h:m}=c.p(t),b=this.atlasImage;b.resize({width:u||1,height:m||1});for(const S in this.patterns){const{bin:C}=this.patterns[S],O=C.x+1,N=C.y+1,U=this.getImage(S).data,q=U.width,W=U.height;c.R.copy(U,b,{x:0,y:0},{x:O,y:N},{width:q,height:W}),c.R.copy(U,b,{x:0,y:W-1},{x:O,y:N-1},{width:q,height:1}),c.R.copy(U,b,{x:0,y:0},{x:O,y:N+W},{width:q,height:1}),c.R.copy(U,b,{x:q-1,y:0},{x:O-1,y:N},{width:1,height:W}),c.R.copy(U,b,{x:0,y:0},{x:O+q,y:N},{width:1,height:W})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const u of t){if(this.callbackDispatchedThisFrame[u])continue;this.callbackDispatchedThisFrame[u]=!0;const m=this.getImage(u);m||c.w(`Image with ID: "${u}" was not found`),ce(m)&&this.updateImage(u,m)}}}const Ae=1e20;function Pe(T,t,u,m,b,S,C,O,N){for(let U=t;U<t+m;U++)Ge(T,u*S+U,S,b,C,O,N);for(let U=u;U<u+b;U++)Ge(T,U*S+t,1,m,C,O,N)}function Ge(T,t,u,m,b,S,C){S[0]=0,C[0]=-Ae,C[1]=Ae,b[0]=T[t];for(let O=1,N=0,U=0;O<m;O++){b[O]=T[t+O*u];const q=O*O;do{const W=S[N];U=(b[O]-b[W]+q-W*W)/(O-W)/2}while(U<=C[N]&&--N>-1);N++,S[N]=O,C[N]=U,C[N+1]=Ae}for(let O=0,N=0;O<m;O++){for(;C[N+1]<O;)N++;const U=S[N],q=O-U;T[t+O*u]=b[U]+q*q}}class Re{constructor(t,u){this.requestManager=t,this.localIdeographFontFamily=u,this.entries={}}setURL(t){this.url=t}getGlyphs(t){return c._(this,void 0,void 0,(function*(){const u=[];for(const S in t)for(const C of t[S])u.push(this._getAndCacheGlyphsPromise(S,C));const m=yield Promise.all(u),b={};for(const{stack:S,id:C,glyph:O}of m)b[S]||(b[S]={}),b[S][C]=O&&{id:O.id,bitmap:O.bitmap.clone(),metrics:O.metrics};return b}))}_getAndCacheGlyphsPromise(t,u){return c._(this,void 0,void 0,(function*(){let m=this.entries[t];m||(m=this.entries[t]={glyphs:{},requests:{},ranges:{}});let b=m.glyphs[u];if(b!==void 0)return{stack:t,id:u,glyph:b};if(b=this._tinySDF(m,t,u),b)return m.glyphs[u]=b,{stack:t,id:u,glyph:b};const S=Math.floor(u/256);if(256*S>65535)throw new Error("glyphs > 65535 not supported");if(m.ranges[S])return{stack:t,id:u,glyph:b};if(!this.url)throw new Error("glyphsUrl is not set");if(!m.requests[S]){const O=Re.loadGlyphRange(t,S,this.url,this.requestManager);m.requests[S]=O}const C=yield m.requests[S];for(const O in C)this._doesCharSupportLocalGlyph(+O)||(m.glyphs[+O]=C[+O]);return m.ranges[S]=!0,{stack:t,id:u,glyph:C[u]||null}}))}_doesCharSupportLocalGlyph(t){return!!this.localIdeographFontFamily&&(new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(t))||c.u["CJK Unified Ideographs"](t)||c.u["Hangul Syllables"](t)||c.u.Hiragana(t)||c.u.Katakana(t)||c.u["CJK Symbols and Punctuation"](t)||c.u["Halfwidth and Fullwidth Forms"](t))}_tinySDF(t,u,m){const b=this.localIdeographFontFamily;if(!b||!this._doesCharSupportLocalGlyph(m))return;let S=t.tinySDF;if(!S){let O="400";/bold/i.test(u)?O="900":/medium/i.test(u)?O="500":/light/i.test(u)&&(O="200"),S=t.tinySDF=new Re.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:b,fontWeight:O})}const C=S.draw(String.fromCharCode(m));return{id:m,bitmap:new c.q({width:C.width||60,height:C.height||60},C.data),metrics:{width:C.glyphWidth/2||24,height:C.glyphHeight/2||24,left:C.glyphLeft/2+.5||0,top:C.glyphTop/2-27.5||-8,advance:C.glyphAdvance/2||24,isDoubleResolution:!0}}}}Re.loadGlyphRange=function(T,t,u,m){return c._(this,void 0,void 0,(function*(){const b=256*t,S=b+255,C=m.transformRequest(u.replace("{fontstack}",T).replace("{range}",`${b}-${S}`),"Glyphs"),O=yield c.n(C,new AbortController);if(!O||!O.data)throw new Error(`Could not load glyph range. range: ${t}, ${b}-${S}`);const N={};for(const U of c.o(O.data))N[U.id]=U;return N}))},Re.TinySDF=class{constructor({fontSize:T=24,buffer:t=3,radius:u=8,cutoff:m=.25,fontFamily:b="sans-serif",fontWeight:S="normal",fontStyle:C="normal",lang:O=null}={}){this.buffer=t,this.cutoff=m,this.radius=u,this.lang=O;const N=this.size=T+4*t,U=this._createCanvas(N),q=this.ctx=U.getContext("2d",{willReadFrequently:!0});q.font=`${C} ${S} ${T}px ${b}`,q.textBaseline="alphabetic",q.textAlign="left",q.fillStyle="black",this.gridOuter=new Float64Array(N*N),this.gridInner=new Float64Array(N*N),this.f=new Float64Array(N),this.z=new Float64Array(N+1),this.v=new Uint16Array(N)}_createCanvas(T){const t=document.createElement("canvas");return t.width=t.height=T,t}draw(T){const{width:t,actualBoundingBoxAscent:u,actualBoundingBoxDescent:m,actualBoundingBoxLeft:b,actualBoundingBoxRight:S}=this.ctx.measureText(T),C=Math.ceil(u),O=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(S-b))),N=Math.min(this.size-this.buffer,C+Math.ceil(m)),U=O+2*this.buffer,q=N+2*this.buffer,W=Math.max(U*q,0),H=new Uint8ClampedArray(W),J={data:H,width:U,height:q,glyphWidth:O,glyphHeight:N,glyphTop:C,glyphLeft:0,glyphAdvance:t};if(O===0||N===0)return J;const{ctx:ae,buffer:ge,gridInner:me,gridOuter:ve}=this;this.lang&&(ae.lang=this.lang),ae.clearRect(ge,ge,O,N),ae.fillText(T,ge,ge+C);const we=ae.getImageData(ge,ge,O,N);ve.fill(Ae,0,W),me.fill(0,0,W);for(let Ie=0;Ie<N;Ie++)for(let Ce=0;Ce<O;Ce++){const ze=we.data[4*(Ie*O+Ce)+3]/255;if(ze===0)continue;const Ve=(Ie+ge)*U+Ce+ge;if(ze===1)ve[Ve]=0,me[Ve]=Ae;else{const Me=.5-ze;ve[Ve]=Me>0?Me*Me:0,me[Ve]=Me<0?Me*Me:0}}Pe(ve,0,0,U,q,U,this.f,this.v,this.z),Pe(me,ge,ge,O,N,U,this.f,this.v,this.z);for(let Ie=0;Ie<W;Ie++){const Ce=Math.sqrt(ve[Ie])-Math.sqrt(me[Ie]);H[Ie]=Math.round(255-255*(Ce/this.radius+this.cutoff))}return J}};class In{constructor(){this.specification=c.v.light.position}possiblyEvaluate(t,u){return c.B(t.expression.evaluate(u))}interpolate(t,u,m){return{x:c.C.number(t.x,u.x,m),y:c.C.number(t.y,u.y,m),z:c.C.number(t.z,u.z,m)}}}let Jn;class mt extends c.E{constructor(t){super(),Jn=Jn||new c.r({anchor:new c.D(c.v.light.anchor),position:new In,color:new c.D(c.v.light.color),intensity:new c.D(c.v.light.intensity)}),this._transitionable=new c.t(Jn),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,u={}){if(!this._validate(c.x,t,u))for(const m in t){const b=t[m];m.endsWith("-transition")?this._transitionable.setTransition(m.slice(0,-11),b):this._transitionable.setValue(m,b)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,u,m){return(!m||m.validate!==!1)&&c.y(this,t.call(c.z,{value:u,style:{glyphs:!0,sprite:!0},styleSpec:c.v}))}}const $t=new c.r({"sky-color":new c.D(c.v.sky["sky-color"]),"horizon-color":new c.D(c.v.sky["horizon-color"]),"fog-color":new c.D(c.v.sky["fog-color"]),"fog-ground-blend":new c.D(c.v.sky["fog-ground-blend"]),"horizon-fog-blend":new c.D(c.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new c.D(c.v.sky["sky-horizon-blend"]),"atmosphere-blend":new c.D(c.v.sky["atmosphere-blend"])});class Tt extends c.E{constructor(t){super(),this._transitionable=new c.t($t),this.setSky(t),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new c.F(0))}setSky(t,u={}){if(!this._validate(c.G,t,u)){t||(t={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const m in t){const b=t[m];m.endsWith("-transition")?this._transitionable.setTransition(m.slice(0,-11),b):this._transitionable.setValue(m,b)}}}getSky(){return this._transitionable.serialize()}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,u,m={}){return(m==null?void 0:m.validate)!==!1&&c.y(this,t.call(c.z,c.e({value:u,style:{glyphs:!0,sprite:!0},styleSpec:c.v})))}calculateFogBlendOpacity(t){return t<60?0:t<70?(t-60)/10:1}}class zt{constructor(t,u){this.width=t,this.height=u,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,u){const m=t.join(",")+String(u);return this.dashEntry[m]||(this.dashEntry[m]=this.addDash(t,u)),this.dashEntry[m]}getDashRanges(t,u,m){const b=[];let S=t.length%2==1?-t[t.length-1]*m:0,C=t[0]*m,O=!0;b.push({left:S,right:C,isDash:O,zeroLength:t[0]===0});let N=t[0];for(let U=1;U<t.length;U++){O=!O;const q=t[U];S=N*m,N+=q,C=N*m,b.push({left:S,right:C,isDash:O,zeroLength:q===0})}return b}addRoundDash(t,u,m){const b=u/2;for(let S=-m;S<=m;S++){const C=this.width*(this.nextRow+m+S);let O=0,N=t[O];for(let U=0;U<this.width;U++){U/N.right>1&&(N=t[++O]);const q=Math.abs(U-N.left),W=Math.abs(U-N.right),H=Math.min(q,W);let J;const ae=S/m*(b+1);if(N.isDash){const ge=b-Math.abs(ae);J=Math.sqrt(H*H+ge*ge)}else J=b-Math.sqrt(H*H+ae*ae);this.data[C+U]=Math.max(0,Math.min(255,J+128))}}}addRegularDash(t){for(let O=t.length-1;O>=0;--O){const N=t[O],U=t[O+1];N.zeroLength?t.splice(O,1):U&&U.isDash===N.isDash&&(U.left=N.left,t.splice(O,1))}const u=t[0],m=t[t.length-1];u.isDash===m.isDash&&(u.left=m.left-this.width,m.right=u.right+this.width);const b=this.width*this.nextRow;let S=0,C=t[S];for(let O=0;O<this.width;O++){O/C.right>1&&(C=t[++S]);const N=Math.abs(O-C.left),U=Math.abs(O-C.right),q=Math.min(N,U);this.data[b+O]=Math.max(0,Math.min(255,(C.isDash?q:-q)+128))}}addDash(t,u){const m=u?7:0,b=2*m+1;if(this.nextRow+b>this.height)return c.w("LineAtlas out of space"),null;let S=0;for(let O=0;O<t.length;O++)S+=t[O];if(S!==0){const O=this.width/S,N=this.getDashRanges(t,this.width,O);u?this.addRoundDash(N,O,m):this.addRegularDash(N)}const C={y:(this.nextRow+m+.5)/this.height,height:2*m/this.height,width:S};return this.nextRow+=b,this.dirty=!0,C}bind(t){const u=t.gl;this.texture?(u.bindTexture(u.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,u.texSubImage2D(u.TEXTURE_2D,0,0,0,this.width,this.height,u.ALPHA,u.UNSIGNED_BYTE,this.data))):(this.texture=u.createTexture(),u.bindTexture(u.TEXTURE_2D,this.texture),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.REPEAT),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.REPEAT),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.LINEAR),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,u.LINEAR),u.texImage2D(u.TEXTURE_2D,0,u.ALPHA,this.width,this.height,0,u.ALPHA,u.UNSIGNED_BYTE,this.data))}}const Bt="maplibre_preloaded_worker_pool";class ke{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<ke.workerCount;)this.workers.push(new Worker(c.a.WORKER_URL));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach((u=>{u.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[Bt]}numActive(){return Object.keys(this.active).length}}const vt=Math.floor(ee.hardwareConcurrency/2);let Ot,jt;function Jt(){return Ot||(Ot=new ke),Ot}ke.workerCount=c.H(globalThis)?Math.max(Math.min(vt,3),1):1;class Xt{constructor(t,u){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=u;const m=this.workerPool.acquire(u);for(let b=0;b<m.length;b++){const S=new c.J(m[b],u);S.name=`Worker ${b}`,this.actors.push(S)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,u){const m=[];for(const b of this.actors)m.push(b.sendAsync({type:t,data:u}));return Promise.all(m)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(t=!0){this.actors.forEach((u=>{u.remove()})),this.actors=[],t&&this.workerPool.release(this.id)}registerMessageHandler(t,u){for(const m of this.actors)m.registerMessageHandler(t,u)}}function Fn(){return jt||(jt=new Xt(Jt(),c.K),jt.registerMessageHandler("GR",((T,t,u)=>c.m(t,u)))),jt}function si(T,t){const u=c.L();return c.M(u,u,[1,1,0]),c.N(u,u,[.5*T.width,.5*T.height,1]),T.calculatePosMatrix?c.O(u,u,T.calculatePosMatrix(t.toUnwrapped())):u}function di(T,t,u,m,b,S,C){var O;const N=(function(H,J,ae){if(H)for(const ge of H){const me=J[ge];if(me&&me.source===ae&&me.type==="fill-extrusion")return!0}else for(const ge in J){const me=J[ge];if(me.source===ae&&me.type==="fill-extrusion")return!0}return!1})((O=b==null?void 0:b.layers)!==null&&O!==void 0?O:null,t,T.id),U=S.maxPitchScaleFactor(),q=T.tilesIn(m,U,N);q.sort(ds);const W=[];for(const H of q)W.push({wrappedTileID:H.tileID.wrapped().key,queryResults:H.tile.queryRenderedFeatures(t,u,T._state,H.queryGeometry,H.cameraQueryGeometry,H.scale,b,S,U,si(T.transform,H.tileID),C?(J,ae)=>C(H.tileID,J,ae):void 0)});return(function(H,J){for(const ae in H)for(const ge of H[ae])Ns(ge,J);return H})((function(H){const J={},ae={};for(const ge of H){const me=ge.queryResults,ve=ge.wrappedTileID,we=ae[ve]=ae[ve]||{};for(const Ie in me){const Ce=me[Ie],ze=we[Ie]=we[Ie]||{},Ve=J[Ie]=J[Ie]||[];for(const Me of Ce)ze[Me.featureIndex]||(ze[Me.featureIndex]=!0,Ve.push(Me))}}return J})(W),T)}function ds(T,t){const u=T.tileID,m=t.tileID;return u.overscaledZ-m.overscaledZ||u.canonical.y-m.canonical.y||u.wrap-m.wrap||u.canonical.x-m.canonical.x}function Ns(T,t){const u=T.feature,m=t.getFeatureState(u.layer["source-layer"],u.id);u.source=u.layer.source,u.layer["source-layer"]&&(u.sourceLayer=u.layer["source-layer"]),u.state=m}function kr(T,t,u){return c._(this,void 0,void 0,(function*(){let m=T;if(T.url?m=(yield c.j(t.transformRequest(T.url,"Source"),u)).data:yield ee.frameAsync(u),!m)return null;const b=c.Q(c.e(m,T),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in m&&m.vector_layers&&(b.vectorLayerIds=m.vector_layers.map((S=>S.id))),b}))}class Ni{constructor(t,u){t&&(u?this.setSouthWest(t).setNorthEast(u):Array.isArray(t)&&(t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}setNorthEast(t){return this._ne=t instanceof c.S?new c.S(t.lng,t.lat):c.S.convert(t),this}setSouthWest(t){return this._sw=t instanceof c.S?new c.S(t.lng,t.lat):c.S.convert(t),this}extend(t){const u=this._sw,m=this._ne;let b,S;if(t instanceof c.S)b=t,S=t;else{if(!(t instanceof Ni))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(Ni.convert(t)):this.extend(c.S.convert(t)):t&&("lng"in t||"lon"in t)&&"lat"in t?this.extend(c.S.convert(t)):this;if(b=t._sw,S=t._ne,!b||!S)return this}return u||m?(u.lng=Math.min(b.lng,u.lng),u.lat=Math.min(b.lat,u.lat),m.lng=Math.max(S.lng,m.lng),m.lat=Math.max(S.lat,m.lat)):(this._sw=new c.S(b.lng,b.lat),this._ne=new c.S(S.lng,S.lat)),this}getCenter(){return new c.S((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new c.S(this.getWest(),this.getNorth())}getSouthEast(){return new c.S(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:u,lat:m}=c.S.convert(t);let b=this._sw.lng<=u&&u<=this._ne.lng;return this._sw.lng>this._ne.lng&&(b=this._sw.lng>=u&&u>=this._ne.lng),this._sw.lat<=m&&m<=this._ne.lat&&b}static convert(t){return t instanceof Ni?t:t&&new Ni(t)}static fromLngLat(t,u=0){const m=360*u/40075017,b=m/Math.cos(Math.PI/180*t.lat);return new Ni(new c.S(t.lng-b,t.lat-m),new c.S(t.lng+b,t.lat+m))}adjustAntiMeridian(){const t=new c.S(this._sw.lng,this._sw.lat),u=new c.S(this._ne.lng,this._ne.lat);return new Ni(t,t.lng>u.lng?new c.S(u.lng+360,u.lat):u)}}class Ii{constructor(t,u,m){this.bounds=Ni.convert(this.validateBounds(t)),this.minzoom=u||0,this.maxzoom=m||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const u=Math.pow(2,t.z),m=Math.floor(c.V(this.bounds.getWest())*u),b=Math.floor(c.U(this.bounds.getNorth())*u),S=Math.ceil(c.V(this.bounds.getEast())*u),C=Math.ceil(c.U(this.bounds.getSouth())*u);return t.x>=m&&t.x<S&&t.y>=b&&t.y<C}}class Va extends c.E{constructor(t,u,m,b){if(super(),this.id=t,this.dispatcher=m,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,c.e(this,c.Q(u,["url","scheme","tileSize","promoteId"])),this._options=c.e({type:"vector"},u),this._collectResourceTiming=u.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(b)}load(){return c._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new c.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const t=yield kr(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),t&&(c.e(this,t),t.bounds&&(this.tileBounds=new Ii(t.bounds,this.minzoom,this.maxzoom)),this.fire(new c.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.l("data",{dataType:"source",sourceDataType:"content"})))}catch(t){this._tileJSONRequest=null,this.fire(new c.k(t))}}))}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.abort(),t(),this.load()}setTiles(t){return this.setSourceProperty((()=>{this._options.tiles=t})),this}setUrl(t){return this.setSourceProperty((()=>{this.url=t,this._options.url=t})),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return c.e({},this._options)}loadTile(t){return c._(this,void 0,void 0,(function*(){const u=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),m={request:this.map._requestManager.transformRequest(u,"Tile"),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,globalState:this.map.getGlobalState()};m.request.collectResourceTiming=this._collectResourceTiming;let b="RT";if(t.actor&&t.state!=="expired"){if(t.state==="loading")return new Promise(((S,C)=>{t.reloadPromise={resolve:S,reject:C}}))}else t.actor=this.dispatcher.getActor(),b="LT";t.abortController=new AbortController;try{const S=yield t.actor.sendAsync({type:b,data:m},t.abortController);if(delete t.abortController,t.aborted)return;this._afterTileLoadWorkerResponse(t,S)}catch(S){if(delete t.abortController,t.aborted)return;if(S&&S.status!==404)throw S;this._afterTileLoadWorkerResponse(t,null)}}))}_afterTileLoadWorkerResponse(t,u){if(u&&u.resourceTiming&&(t.resourceTiming=u.resourceTiming),u&&this.map._refreshExpiredTiles&&t.setExpiryData(u),t.loadVectorData(u,this.map.painter),t.reloadPromise){const m=t.reloadPromise;t.reloadPromise=null,this.loadTile(t).then(m.resolve).catch(m.reject)}}abortTile(t){return c._(this,void 0,void 0,(function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.actor&&(yield t.actor.sendAsync({type:"AT",data:{uid:t.uid,type:this.type,source:this.id}}))}))}unloadTile(t){return c._(this,void 0,void 0,(function*(){t.unloadVectorData(),t.actor&&(yield t.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}}))}))}hasTransition(){return!1}}class Ta extends c.E{constructor(t,u,m,b){super(),this.id=t,this.dispatcher=m,this.setEventedParent(b),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=c.e({type:"raster"},u),c.e(this,c.Q(u,["url","scheme","tileSize"]))}load(){return c._(this,arguments,void 0,(function*(t=!1){this._loaded=!1,this.fire(new c.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const u=yield kr(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,u&&(c.e(this,u),u.bounds&&(this.tileBounds=new Ii(u.bounds,this.minzoom,this.maxzoom)),this.fire(new c.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:t})))}catch(u){this._tileJSONRequest=null,this.fire(new c.k(u))}}))}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(t){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),t(),this.load(!0)}setTiles(t){return this.setSourceProperty((()=>{this._options.tiles=t})),this}setUrl(t){return this.setSourceProperty((()=>{this.url=t,this._options.url=t})),this}serialize(){return c.e({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t){return c._(this,void 0,void 0,(function*(){const u=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.abortController=new AbortController;try{const m=yield He.getImage(this.map._requestManager.transformRequest(u,"Tile"),t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(m&&m.data){this.map._refreshExpiredTiles&&(m.cacheControl||m.expires)&&t.setExpiryData({cacheControl:m.cacheControl,expires:m.expires});const b=this.map.painter.context,S=b.gl,C=m.data;t.texture=this.map.painter.getTileTexture(C.width),t.texture?t.texture.update(C,{useMipmap:!0}):(t.texture=new c.T(b,C,S.RGBA,{useMipmap:!0}),t.texture.bind(S.LINEAR,S.CLAMP_TO_EDGE,S.LINEAR_MIPMAP_NEAREST)),t.state="loaded"}}catch(m){if(delete t.abortController,t.aborted)t.state="unloaded";else if(m)throw t.state="errored",m}}))}abortTile(t){return c._(this,void 0,void 0,(function*(){t.abortController&&(t.abortController.abort(),delete t.abortController)}))}unloadTile(t){return c._(this,void 0,void 0,(function*(){t.texture&&this.map.painter.saveTileTexture(t.texture)}))}hasTransition(){return!1}}class Bs extends Ta{constructor(t,u,m,b){super(t,u,m,b),this.type="raster-dem",this.maxzoom=22,this._options=c.e({type:"raster-dem"},u),this.encoding=u.encoding||"mapbox",this.redFactor=u.redFactor,this.greenFactor=u.greenFactor,this.blueFactor=u.blueFactor,this.baseShift=u.baseShift}loadTile(t){return c._(this,void 0,void 0,(function*(){const u=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),m=this.map._requestManager.transformRequest(u,"Tile");t.neighboringTiles=this._getNeighboringTiles(t.tileID),t.abortController=new AbortController;try{const b=yield He.getImage(m,t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(b&&b.data){const S=b.data;this.map._refreshExpiredTiles&&(b.cacheControl||b.expires)&&t.setExpiryData({cacheControl:b.cacheControl,expires:b.expires});const C=c.b(S)&&c.W()?S:yield this.readImageNow(S),O={type:this.type,uid:t.uid,source:this.id,rawImageData:C,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!t.actor||t.state==="expired"){t.actor=this.dispatcher.getActor();const N=yield t.actor.sendAsync({type:"LDT",data:O});t.dem=N,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded"}}}catch(b){if(delete t.abortController,t.aborted)t.state="unloaded";else if(b)throw t.state="errored",b}}))}readImageNow(t){return c._(this,void 0,void 0,(function*(){if(typeof VideoFrame<"u"&&c.X()){const u=t.width+2,m=t.height+2;try{return new c.R({width:u,height:m},yield c.Y(t,-1,-1,u,m))}catch{}}return ee.getImageData(t,1)}))}_getNeighboringTiles(t){const u=t.canonical,m=Math.pow(2,u.z),b=(u.x-1+m)%m,S=u.x===0?t.wrap-1:t.wrap,C=(u.x+1+m)%m,O=u.x+1===m?t.wrap+1:t.wrap,N={};return N[new c.Z(t.overscaledZ,S,u.z,b,u.y).key]={backfilled:!1},N[new c.Z(t.overscaledZ,O,u.z,C,u.y).key]={backfilled:!1},u.y>0&&(N[new c.Z(t.overscaledZ,S,u.z,b,u.y-1).key]={backfilled:!1},N[new c.Z(t.overscaledZ,t.wrap,u.z,u.x,u.y-1).key]={backfilled:!1},N[new c.Z(t.overscaledZ,O,u.z,C,u.y-1).key]={backfilled:!1}),u.y+1<m&&(N[new c.Z(t.overscaledZ,S,u.z,b,u.y+1).key]={backfilled:!1},N[new c.Z(t.overscaledZ,t.wrap,u.z,u.x,u.y+1).key]={backfilled:!1},N[new c.Z(t.overscaledZ,O,u.z,C,u.y+1).key]={backfilled:!1}),N}unloadTile(t){return c._(this,void 0,void 0,(function*(){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&(yield t.actor.sendAsync({type:"RDT",data:{type:this.type,uid:t.uid,source:this.id}}))}))}}class Sa extends c.E{constructor(t,u,m,b){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._isUpdatingWorker=!1,this._pendingWorkerUpdate={data:u.data},this.actor=m.getActor(),this.setEventedParent(b),this._data=u.data,this._options=c.e({},u),this._collectResourceTiming=u.collectResourceTiming,u.maxzoom!==void 0&&(this.maxzoom=u.maxzoom),u.type&&(this.type=u.type),u.attribution&&(this.attribution=u.attribution),this.promoteId=u.promoteId,u.clusterMaxZoom!==void 0&&this.maxzoom<=u.clusterMaxZoom&&c.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${u.clusterMaxZoom}".`),this.workerOptions=c.e({source:this.id,cluster:u.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(u.buffer!==void 0?u.buffer:128),tolerance:this._pixelsToTileUnits(u.tolerance!==void 0?u.tolerance:.375),extent:c.$,maxZoom:this.maxzoom,lineMetrics:u.lineMetrics||!1,generateId:u.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(u.clusterMaxZoom),minPoints:Math.max(2,u.clusterMinPoints||2),extent:c.$,radius:this._pixelsToTileUnits(u.clusterRadius||50),log:!1,generateId:u.generateId||!1},clusterProperties:u.clusterProperties,filter:u.filter},u.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_pixelsToTileUnits(t){return t*(c.$/this.tileSize)}_getClusterMaxZoom(t){const u=t?Math.round(t):this.maxzoom-1;return Number.isInteger(t)||t===void 0||c.w(`Integer expected for option 'clusterMaxZoom': provided value "${t}" rounded to "${u}"`),u}load(){return c._(this,void 0,void 0,(function*(){yield this._updateWorkerData()}))}onAdd(t){this.map=t,this.load()}setData(t){return this._data=t,this._pendingWorkerUpdate={data:t},this._updateWorkerData(),this}updateData(t){return this._pendingWorkerUpdate.diff=c.a0(this._pendingWorkerUpdate.diff,t),this._updateWorkerData(),this}getData(){return c._(this,void 0,void 0,(function*(){const t=c.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:t})}))}getCoordinatesFromGeometry(t){return t.type==="GeometryCollection"?t.geometries.map((u=>u.coordinates)).flat(1/0):t.coordinates.flat(1/0)}getBounds(){return c._(this,void 0,void 0,(function*(){const t=new Ni,u=yield this.getData();let m;switch(u.type){case"FeatureCollection":m=u.features.map((b=>this.getCoordinatesFromGeometry(b.geometry))).flat(1/0);break;case"Feature":m=this.getCoordinatesFromGeometry(u.geometry);break;default:m=this.getCoordinatesFromGeometry(u)}if(m.length==0)return t;for(let b=0;b<m.length-1;b+=2)t.extend([m[b],m[b+1]]);return t}))}setClusterOptions(t){return this.workerOptions.cluster=t.cluster,t&&(t.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(t.clusterRadius)),t.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(t.clusterMaxZoom))),this._updateWorkerData(),this}getClusterExpansionZoom(t){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:t,source:this.id}})}getClusterChildren(t){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:t,source:this.id}})}getClusterLeaves(t,u,m){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:t,limit:u,offset:m}})}_updateWorkerData(){return c._(this,void 0,void 0,(function*(){if(this._isUpdatingWorker)return;const{data:t,diff:u}=this._pendingWorkerUpdate;if(!t&&!u)return void c.w(`No data or diff provided to GeoJSONSource ${this.id}.`);const m=c.e({type:this.type},this.workerOptions);t?(typeof t=="string"?(m.request=this.map._requestManager.transformRequest(ee.resolveURL(t),"Source"),m.request.collectResourceTiming=this._collectResourceTiming):m.data=JSON.stringify(t),this._pendingWorkerUpdate.data=void 0):u&&(m.dataDiff=u,this._pendingWorkerUpdate.diff=void 0),this._isUpdatingWorker=!0,this.fire(new c.l("dataloading",{dataType:"source"}));try{const b=yield this.actor.sendAsync({type:"LD",data:m});if(this._isUpdatingWorker=!1,this._removed||b.abandoned)return void this.fire(new c.l("dataabort",{dataType:"source"}));this._data=b.data;let S=null;b.resourceTiming&&b.resourceTiming[this.id]&&(S=b.resourceTiming[this.id].slice(0));const C={dataType:"source"};this._collectResourceTiming&&S&&S.length>0&&c.e(C,{resourceTiming:S}),this.fire(new c.l("data",Object.assign(Object.assign({},C),{sourceDataType:"metadata"}))),this.fire(new c.l("data",Object.assign(Object.assign({},C),{sourceDataType:"content"})))}catch(b){if(this._isUpdatingWorker=!1,this._removed)return void this.fire(new c.l("dataabort",{dataType:"source"}));this.fire(new c.k(b))}finally{(this._pendingWorkerUpdate.data||this._pendingWorkerUpdate.diff)&&this._updateWorkerData()}}))}loaded(){return!this._isUpdatingWorker&&this._pendingWorkerUpdate.data===void 0&&this._pendingWorkerUpdate.diff===void 0}loadTile(t){return c._(this,void 0,void 0,(function*(){const u=t.actor?"RT":"LT";t.actor=this.actor;const m={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,globalState:this.map.getGlobalState()};t.abortController=new AbortController;const b=yield this.actor.sendAsync({type:u,data:m},t.abortController);delete t.abortController,t.unloadVectorData(),t.aborted||t.loadVectorData(b,this.map.painter,u==="RT")}))}abortTile(t){return c._(this,void 0,void 0,(function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.aborted=!0}))}unloadTile(t){return c._(this,void 0,void 0,(function*(){t.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}})}))}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return c.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}class Bi extends c.E{constructor(t,u,m,b){super(),this.flippedWindingOrder=!1,this.id=t,this.dispatcher=m,this.coordinates=u.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(b),this.options=u}load(t){return c._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new c.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const u=yield He.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,u&&u.data&&(this.image=u.data,t&&(this.coordinates=t),this._finishLoading())}catch(u){this._request=null,this._loaded=!0,this.fire(new c.k(u))}}))}loaded(){return this._loaded}updateImage(t){return t.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=t.url,this.load(t.coordinates).finally((()=>{this.texture=null})),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new c.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(t){this.coordinates=t;const u=t.map(c.a1.fromLngLat);var m;return this.tileID=(function(b){const S=c.a2.fromPoints(b),C=S.width(),O=S.height(),N=Math.max(C,O),U=Math.max(0,Math.floor(-Math.log(N)/Math.LN2)),q=Math.pow(2,U);return new c.a4(U,Math.floor((S.minX+S.maxX)/2*q),Math.floor((S.minY+S.maxY)/2*q))})(u),this.terrainTileRanges=this._getOverlappingTileRanges(u),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=u.map((b=>this.tileID.getTilePoint(b)._round())),this.flippedWindingOrder=((m=this.tileCoords)[1].x-m[0].x)*(m[2].y-m[0].y)-(m[1].y-m[0].y)*(m[2].x-m[0].x)<0,this.fire(new c.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const t=this.map.painter.context,u=t.gl;this.texture||(this.texture=new c.T(t,this.image,u.RGBA),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE));let m=!1;for(const b in this.tiles){const S=this.tiles[b];S.state!=="loaded"&&(S.state="loaded",S.texture=this.texture,m=!0)}m&&this.fire(new c.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(t){return c._(this,void 0,void 0,(function*(){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={}):t.state="errored"}))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(t){const{minX:u,minY:m,maxX:b,maxY:S}=c.a2.fromPoints(t),C={};for(let O=0;O<=c.a3;O++){const N=Math.pow(2,O),U=Math.floor(u*N),q=Math.floor(m*N),W=Math.floor(b*N),H=Math.floor(S*N);C[O]={minTileX:U,minTileY:q,maxTileX:W,maxTileY:H}}return C}}class fr extends Bi{constructor(t,u,m,b){super(t,u,m,b),this.roundZoom=!0,this.type="video",this.options=u}load(){return c._(this,void 0,void 0,(function*(){this._loaded=!1;const t=this.options;this.urls=[];for(const u of t.urls)this.urls.push(this.map._requestManager.transformRequest(u,"Source").url);try{const u=yield c.a5(this.urls);if(this._loaded=!0,!u)return;this.video=u,this.video.loop=!0,this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading()}catch(u){this.fire(new c.k(u))}}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const u=this.video.seekable;t<u.start(0)||t>u.end(0)?this.fire(new c.k(new c.a6(`sources.${this.id}`,null,`Playback for this video can be set only between the ${u.start(0)} and ${u.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const t=this.map.painter.context,u=t.gl;this.texture?this.video.paused||(this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE),u.texSubImage2D(u.TEXTURE_2D,0,0,0,u.RGBA,u.UNSIGNED_BYTE,this.video)):(this.texture=new c.T(t,this.video,u.RGBA),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE));let m=!1;for(const b in this.tiles){const S=this.tiles[b];S.state!=="loaded"&&(S.state="loaded",S.texture=this.texture,m=!0)}m&&this.fire(new c.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Ea extends Bi{constructor(t,u,m,b){super(t,u,m,b),u.coordinates?Array.isArray(u.coordinates)&&u.coordinates.length===4&&!u.coordinates.some((S=>!Array.isArray(S)||S.length!==2||S.some((C=>typeof C!="number"))))||this.fire(new c.k(new c.a6(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new c.k(new c.a6(`sources.${t}`,null,'missing required property "coordinates"'))),u.animate&&typeof u.animate!="boolean"&&this.fire(new c.k(new c.a6(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),u.canvas?typeof u.canvas=="string"||u.canvas instanceof HTMLCanvasElement||this.fire(new c.k(new c.a6(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new c.k(new c.a6(`sources.${t}`,null,'missing required property "canvas"'))),this.options=u,this.animate=u.animate===void 0||u.animate}load(){return c._(this,void 0,void 0,(function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new c.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}))}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const u=this.map.painter.context,m=u.gl;this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new c.T(u,this.canvas,m.RGBA,{premultiply:!0});let b=!1;for(const S in this.tiles){const C=this.tiles[S];C.state!=="loaded"&&(C.state="loaded",C.texture=this.texture,b=!0)}b&&this.fire(new c.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const So={},so=T=>{switch(T){case"geojson":return Sa;case"image":return Bi;case"raster":return Ta;case"raster-dem":return Bs;case"vector":return Va;case"video":return fr;case"canvas":return Ea}return So[T]},$r="RTLPluginLoaded";class fs extends c.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Fn()}_syncState(t){return this.status=t,this.dispatcher.broadcast("SRPS",{pluginStatus:t,pluginURL:this.url}).catch((u=>{throw this.status="error",u}))}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(t){return c._(this,arguments,void 0,(function*(u,m=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=ee.resolveURL(u),!this.url)throw new Error(`requested url ${u} is invalid`);if(this.status==="unavailable"){if(!m)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()}))}_requestImport(){return c._(this,void 0,void 0,(function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new c.l($r))}))}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let ps=null;function Fs(){return ps||(ps=new fs),ps}class ms{constructor(t,u){this.timeAdded=0,this.fadeEndTime=0,this.tileID=t,this.uid=c.a7(),this.uses=0,this.tileSize=u,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(t){const u=t+this.timeAdded;u<this.fadeEndTime||(this.fadeEndTime=u)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(t,u,m){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=(function(b,S){const C={};if(!S)return C;for(const O of b){const N=O.layerIds.map((U=>S.getLayer(U))).filter(Boolean);if(N.length!==0){O.layers=N,O.stateDependentLayerIds&&(O.stateDependentLayers=O.stateDependentLayerIds.map((U=>N.filter((q=>q.id===U))[0])));for(const U of N)C[U.id]=O}}return C})(t.buckets,u==null?void 0:u.style),this.hasSymbolBuckets=!1;for(const b in this.buckets){const S=this.buckets[b];if(S instanceof c.a9){if(this.hasSymbolBuckets=!0,!m)break;S.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const b in this.buckets){const S=this.buckets[b];if(S instanceof c.a9&&S.hasRTLText){this.hasRTLText=!0,Fs().lazyLoad();break}}this.queryPadding=0;for(const b in this.buckets){const S=this.buckets[b];this.queryPadding=Math.max(this.queryPadding,u.style.getLayer(b).queryRadius(S))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new c.a8}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const m in this.buckets){const b=this.buckets[m];b.uploadPending()&&b.upload(t)}const u=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new c.T(t,this.imageAtlas.image,u.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new c.T(t,this.glyphAtlasImage,u.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,u,m,b,S,C,O,N,U,q,W){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:b,cameraQueryGeometry:S,scale:C,tileSize:this.tileSize,pixelPosMatrix:q,transform:N,params:O,queryPadding:this.queryPadding*U,getElevation:W},t,u,m):{}}querySourceFeatures(t,u){const m=this.latestFeatureIndex;if(!m||!m.rawTileData)return;const b=m.loadVTLayers(),S=u&&u.sourceLayer?u.sourceLayer:"",C=b._geojsonTileLayer||b[S];if(!C)return;const O=c.aa(u&&u.filter),{z:N,x:U,y:q}=this.tileID.canonical,W={z:N,x:U,y:q};for(let H=0;H<C.length;H++){const J=C.feature(H);if(O.needGeometry){const me=c.ab(J,!0);if(!O.filter(new c.F(this.tileID.overscaledZ),me,this.tileID.canonical))continue}else if(!O.filter(new c.F(this.tileID.overscaledZ),J))continue;const ae=m.getId(J,S),ge=new c.ac(J,N,U,q,ae);ge.tile=W,t.push(ge)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const u=this.expirationTime;if(t.cacheControl){const m=c.ad(t.cacheControl);m["max-age"]&&(this.expirationTime=Date.now()+1e3*m["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const m=Date.now();let b=!1;if(this.expirationTime>m)b=!1;else if(u)if(this.expirationTime<u)b=!0;else{const S=this.expirationTime-u;S?this.expirationTime=m+Math.max(S,3e4):b=!0}else b=!0;b?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,u){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const m=this.latestFeatureIndex.loadVTLayers();for(const b in this.buckets){if(!u.style.hasLayer(b))continue;const S=this.buckets[b],C=S.layers[0].sourceLayer||"_geojsonTileLayer",O=m[C],N=t[C];if(!O||!N||Object.keys(N).length===0)continue;S.update(N,O,this.imageAtlas&&this.imageAtlas.patternPositions||{});const U=u&&u.style&&u.style.getLayer(b);U&&(this.queryPadding=Math.max(this.queryPadding,U.queryRadius(S)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<ee.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=ee.now()+t}setDependencies(t,u){const m={};for(const b of u)m[b]=!0;this.dependencies[t]=m}hasDependency(t,u){for(const m of t){const b=this.dependencies[m];if(b){for(const S of u)if(b[S])return!0}}return!1}}class Ke{constructor(t,u){this.max=t,this.onRemove=u,this.reset()}reset(){for(const t in this.data)for(const u of this.data[t])u.timeout&&clearTimeout(u.timeout),this.onRemove(u.value);return this.data={},this.order=[],this}add(t,u,m){const b=t.wrapped().key;this.data[b]===void 0&&(this.data[b]=[]);const S={value:u,timeout:void 0};if(m!==void 0&&(S.timeout=setTimeout((()=>{this.remove(t,S)}),m)),this.data[b].push(S),this.order.push(b),this.order.length>this.max){const C=this._getAndRemoveByKey(this.order[0]);C&&this.onRemove(C)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const u=this.data[t].shift();return u.timeout&&clearTimeout(u.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),u.value}getByKey(t){const u=this.data[t];return u?u[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,u){if(!this.has(t))return this;const m=t.wrapped().key,b=u===void 0?0:this.data[m].indexOf(u),S=this.data[m][b];return this.data[m].splice(b,1),S.timeout&&clearTimeout(S.timeout),this.data[m].length===0&&delete this.data[m],this.onRemove(S.value),this.order.splice(this.order.indexOf(m),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const u=this._getAndRemoveByKey(this.order[0]);u&&this.onRemove(u)}return this}filter(t){const u=[];for(const m in this.data)for(const b of this.data[m])t(b.value)||u.push(b);for(const m of u)this.remove(m.value.tileID,m)}}class se{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,u,m){const b=String(u);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][b]=this.stateChanges[t][b]||{},c.e(this.stateChanges[t][b],m),this.deletedStates[t]===null){this.deletedStates[t]={};for(const S in this.state[t])S!==b&&(this.deletedStates[t][S]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][b]===null){this.deletedStates[t][b]={};for(const S in this.state[t][b])m[S]||(this.deletedStates[t][b][S]=null)}else for(const S in m)this.deletedStates[t]&&this.deletedStates[t][b]&&this.deletedStates[t][b][S]===null&&delete this.deletedStates[t][b][S]}removeFeatureState(t,u,m){if(this.deletedStates[t]===null)return;const b=String(u);if(this.deletedStates[t]=this.deletedStates[t]||{},m&&u!==void 0)this.deletedStates[t][b]!==null&&(this.deletedStates[t][b]=this.deletedStates[t][b]||{},this.deletedStates[t][b][m]=null);else if(u!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][b])for(m in this.deletedStates[t][b]={},this.stateChanges[t][b])this.deletedStates[t][b][m]=null;else this.deletedStates[t][b]=null;else this.deletedStates[t]=null}getState(t,u){const m=String(u),b=c.e({},(this.state[t]||{})[m],(this.stateChanges[t]||{})[m]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const S=this.deletedStates[t][u];if(S===null)return{};for(const C in S)delete b[C]}return b}initializeTileState(t,u){t.setFeatureState(this.state,u)}coalesceChanges(t,u){const m={};for(const b in this.stateChanges){this.state[b]=this.state[b]||{};const S={};for(const C in this.stateChanges[b])this.state[b][C]||(this.state[b][C]={}),c.e(this.state[b][C],this.stateChanges[b][C]),S[C]=this.state[b][C];m[b]=S}for(const b in this.deletedStates){this.state[b]=this.state[b]||{};const S={};if(this.deletedStates[b]===null)for(const C in this.state[b])S[C]={},this.state[b][C]={};else for(const C in this.deletedStates[b]){if(this.deletedStates[b][C]===null)this.state[b][C]={};else for(const O of Object.keys(this.deletedStates[b][C]))delete this.state[b][C][O];S[C]=this.state[b][C]}m[b]=m[b]||{},c.e(m[b],S)}if(this.stateChanges={},this.deletedStates={},Object.keys(m).length!==0)for(const b in t)t[b].setFeatureState(m,u)}}const le=89.25;function fe(T,t){const u=c.ah(t.lat,-c.ai,c.ai);return new c.P(c.V(t.lng)*T,c.U(u)*T)}function Se(T,t){return new c.a1(t.x/T,t.y/T).toLngLat()}function De(T){return T.cameraToCenterDistance*Math.min(.85*Math.tan(c.ae(90-T.pitch)),Math.tan(c.ae(le-T.pitch)))}function Ze(T,t){const u=T.canonical,m=t/c.af(u.z),b=u.x+Math.pow(2,u.z)*T.wrap,S=c.ag(new Float64Array(16));return c.M(S,S,[b*m,u.y*m,0]),c.N(S,S,[m/c.$,m/c.$,1]),S}function et(T,t,u,m,b){const S=c.a1.fromLngLat(T,t),C=b*c.aj(1,T.lat),O=C*Math.cos(c.ae(u)),N=Math.sqrt(C*C-O*O),U=N*Math.sin(c.ae(-m)),q=N*Math.cos(c.ae(-m));return new c.a1(S.x+U,S.y+q,S.z+O)}function Xe(T,t,u){const m=t.intersectsFrustum(T);if(!u||m===0)return m;const b=t.intersectsPlane(u);return b===0?0:m===2&&b===2?2:1}function _t(T,t,u){let m=0;const b=(u-t)/10;for(let S=0;S<10;S++)m+=b*Math.pow(Math.cos(t+(S+.5)/10*(u-t)),T);return m}function It(T,t){return function(u,m,b,S,C){const O=2*((T-1)/c.ak(Math.cos(c.ae(le-C))/Math.cos(c.ae(le)))-1),N=Math.acos(b/S),U=2*_t(O-1,0,c.ae(C/2)),q=Math.min(c.ae(le),N+c.ae(C/2)),W=_t(O-1,Math.min(q,N-c.ae(C/2)),q),H=Math.atan(m/b),J=Math.hypot(m,b);let ae=u;return ae+=c.ak(S/J/Math.max(.5,Math.cos(c.ae(C/2)))),ae+=O*c.ak(Math.cos(H))/2,ae-=c.ak(Math.max(1,W/U/t))/2,ae}}const xt=It(9.314,3);function tn(T,t){const u=(t.roundZoom?Math.round:Math.floor)(T.zoom+c.ak(T.tileSize/t.tileSize));return Math.max(0,u)}function $e(T,t){const u=T.getCameraFrustum(),m=T.getClippingPlane(),b=T.screenPointToMercatorCoordinate(T.getCameraPoint()),S=c.a1.fromLngLat(T.center,T.elevation);b.z=S.z+Math.cos(T.pitchInRadians)*T.cameraToCenterDistance/T.worldSize;const C=T.getCoveringTilesDetailsProvider(),O=C.allowVariableZoom(T,t),N=tn(T,t),U=t.minzoom||0,q=t.maxzoom!==void 0?t.maxzoom:T.maxZoom,W=Math.min(Math.max(0,N),q),H=Math.pow(2,W),J=[H*b.x,H*b.y,0],ae=[H*S.x,H*S.y,0],ge=Math.hypot(S.x-b.x,S.y-b.y),me=Math.abs(S.z-b.z),ve=Math.hypot(ge,me),we=ze=>({zoom:0,x:0,y:0,wrap:ze,fullyVisible:!1}),Ie=[],Ce=[];if(T.renderWorldCopies&&C.allowWorldCopies())for(let ze=1;ze<=3;ze++)Ie.push(we(-ze)),Ie.push(we(ze));for(Ie.push(we(0));Ie.length>0;){const ze=Ie.pop(),Ve=ze.x,Me=ze.y;let Ye=ze.fullyVisible;const ct={x:Ve,y:Me,z:ze.zoom},rt=C.getTileBoundingVolume(ct,ze.wrap,T.elevation,t);if(!Ye){const Vt=Xe(u,rt,m);if(Vt===0)continue;Ye=Vt===2}const st=C.distanceToTile2d(b.x,b.y,ct,rt);let lt=N;O&&(lt=(t.calculateTileZoom||xt)(T.zoom+c.ak(T.tileSize/t.tileSize),st,me,ve,T.fov)),lt=(t.roundZoom?Math.round:Math.floor)(lt),lt=Math.max(0,lt);const Nt=Math.min(lt,q);if(ze.wrap=C.getWrap(S,ct,ze.wrap),ze.zoom>=Nt){if(ze.zoom<U)continue;const Vt=W-ze.zoom,At=J[0]-.5-(Ve<<Vt),ln=J[1]-.5-(Me<<Vt),Zn=t.reparseOverscaled?Math.max(ze.zoom,lt):ze.zoom;Ce.push({tileID:new c.Z(ze.zoom===q?Zn:ze.zoom,ze.wrap,ze.zoom,Ve,Me),distanceSq:c.al([ae[0]-.5-Ve,ae[1]-.5-Me]),tileDistanceToCamera:Math.sqrt(At*At+ln*ln)})}else for(let Vt=0;Vt<4;Vt++)Ie.push({zoom:ze.zoom+1,x:(Ve<<1)+Vt%2,y:(Me<<1)+(Vt>>1),wrap:ze.wrap,fullyVisible:Ye})}return Ce.sort(((ze,Ve)=>ze.distanceSq-Ve.distanceSq)).map((ze=>ze.tileID))}const vn=c.a2.fromPoints([new c.P(0,0),new c.P(c.$,c.$)]);class Rn extends c.E{constructor(t,u,m){super(),this.id=t,this.dispatcher=m,this.on("data",(b=>this._dataHandler(b))),this.on("dataloading",(()=>{this._sourceErrored=!1})),this.on("error",(()=>{this._sourceErrored=this._source.loaded()})),this._source=((b,S,C,O)=>{const N=new(so(S.type))(b,S,C,O);if(N.id!==b)throw new Error(`Expected Source id to be ${b} instead of ${N.id}`);return N})(t,u,m,this),this._tiles={},this._cache=new Ke(0,(b=>this._unloadTile(b))),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new se,this._didEmitContent=!1,this._updated=!1}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._maxTileCacheZoomLevels=t?t._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const t in this._tiles){const u=this._tiles[t];if(u.state!=="loaded"&&u.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,u,m){return c._(this,void 0,void 0,(function*(){try{yield this._source.loadTile(t),this._tileLoaded(t,u,m)}catch(b){t.state="errored",b.status!==404?this._source.fire(new c.k(b,{tile:t})):this.update(this.transform,this.terrain)}}))}_unloadTile(t){this._source.unloadTile&&this._source.unloadTile(t)}_abortTile(t){this._source.abortTile&&this._source.abortTile(t),this._source.fire(new c.l("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const u in this._tiles){const m=this._tiles[u];m.upload(t),m.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map((t=>t.tileID)).sort(nn).map((t=>t.key))}getRenderableIds(t){const u=[];for(const m in this._tiles)this._isIdRenderable(m,t)&&u.push(this._tiles[m]);return t?u.sort(((m,b)=>{const S=m.tileID,C=b.tileID,O=new c.P(S.canonical.x,S.canonical.y)._rotate(-this.transform.bearingInRadians),N=new c.P(C.canonical.x,C.canonical.y)._rotate(-this.transform.bearingInRadians);return S.overscaledZ-C.overscaledZ||N.y-O.y||N.x-O.x})).map((m=>m.tileID.key)):u.map((m=>m.tileID)).sort(nn).map((m=>m.key))}hasRenderableParent(t){const u=this.findLoadedParent(t,0);return!!u&&this._isIdRenderable(u.tileID.key)}_isIdRenderable(t,u){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(u||!this._tiles[t].holdingForFade())}reload(t){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const u in this._tiles)t?this._reloadTile(u,"expired"):this._tiles[u].state!=="errored"&&this._reloadTile(u,"reloading")}}_reloadTile(t,u){return c._(this,void 0,void 0,(function*(){const m=this._tiles[t];m&&(m.state!=="loading"&&(m.state=u),yield this._loadTile(m,t,u))}))}_tileLoaded(t,u,m){t.timeAdded=ee.now(),m==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(u,t),this.getSource().type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new c.l("data",{dataType:"source",tile:t,coord:t.tileID}))}_backfillDEM(t){const u=this.getRenderableIds();for(let b=0;b<u.length;b++){const S=u[b];if(t.neighboringTiles&&t.neighboringTiles[S]){const C=this.getTileByID(S);m(t,C),m(C,t)}}function m(b,S){b.needsHillshadePrepare=!0,b.needsTerrainPrepare=!0;let C=S.tileID.canonical.x-b.tileID.canonical.x;const O=S.tileID.canonical.y-b.tileID.canonical.y,N=Math.pow(2,b.tileID.canonical.z),U=S.tileID.key;C===0&&O===0||Math.abs(O)>1||(Math.abs(C)>1&&(Math.abs(C+N)===1?C+=N:Math.abs(C-N)===1&&(C-=N)),S.dem&&b.dem&&(b.dem.backfillBorder(S.dem,C,O),b.neighboringTiles&&b.neighboringTiles[U]&&(b.neighboringTiles[U].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,u,m,b){for(const S in this._tiles){let C=this._tiles[S];if(b[S]||!C.hasData()||C.tileID.overscaledZ<=u||C.tileID.overscaledZ>m)continue;let O=C.tileID;for(;C&&C.tileID.overscaledZ>u+1;){const U=C.tileID.scaledTo(C.tileID.overscaledZ-1);C=this._tiles[U.key],C&&C.hasData()&&(O=U)}let N=O;for(;N.overscaledZ>u;)if(N=N.scaledTo(N.overscaledZ-1),t[N.key]||t[N.canonical.key]){b[O.key]=O;break}}}findLoadedParent(t,u){if(t.key in this._loadedParentTiles){const m=this._loadedParentTiles[t.key];return m&&m.tileID.overscaledZ>=u?m:null}for(let m=t.overscaledZ-1;m>=u;m--){const b=t.scaledTo(m),S=this._getLoadedTile(b);if(S)return S}}findLoadedSibling(t){return this._getLoadedTile(t)}_getLoadedTile(t){const u=this._tiles[t.key];return u&&u.hasData()?u:this._cache.getByKey(t.wrapped().key)}updateCacheSize(t){const u=Math.ceil(t.width/this._source.tileSize)+1,m=Math.ceil(t.height/this._source.tileSize)+1,b=Math.floor(u*m*(this._maxTileCacheZoomLevels===null?c.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),S=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,b):b;this._cache.setMaxSize(S)}handleWrapJump(t){const u=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,u){const m={};for(const b in this._tiles){const S=this._tiles[b];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+u),m[S.tileID.key]=S}this._tiles=m;for(const b in this._timers)clearTimeout(this._timers[b]),delete this._timers[b];for(const b in this._tiles)this._setTileReloadTimer(b,this._tiles[b])}}_updateCoveredAndRetainedTiles(t,u,m,b,S,C){const O={},N={},U=Object.keys(t),q=ee.now();for(const W of U){const H=t[W],J=this._tiles[W];if(!J||J.fadeEndTime!==0&&J.fadeEndTime<=q)continue;const ae=this.findLoadedParent(H,u),ge=this.findLoadedSibling(H),me=ae||ge||null;me&&(this._addTile(me.tileID),O[me.tileID.key]=me.tileID),N[W]=H}this._retainLoadedChildren(N,b,m,t);for(const W in O)t[W]||(this._coveredTiles[W]=!0,t[W]=O[W]);if(C){const W={},H={};for(const J of S)this._tiles[J.key].hasData()?W[J.key]=J:H[J.key]=J;for(const J in H){const ae=H[J].children(this._source.maxzoom);this._tiles[ae[0].key]&&this._tiles[ae[1].key]&&this._tiles[ae[2].key]&&this._tiles[ae[3].key]&&(W[ae[0].key]=t[ae[0].key]=ae[0],W[ae[1].key]=t[ae[1].key]=ae[1],W[ae[2].key]=t[ae[2].key]=ae[2],W[ae[3].key]=t[ae[3].key]=ae[3],delete H[J])}for(const J in H){const ae=H[J],ge=this.findLoadedParent(ae,this._source.minzoom),me=this.findLoadedSibling(ae),ve=ge||me||null;if(ve){W[ve.tileID.key]=t[ve.tileID.key]=ve.tileID;for(const we in W)W[we].isChildOf(ve.tileID)&&delete W[we]}}for(const J in this._tiles)W[J]||(this._coveredTiles[J]=!0)}}update(t,u){if(!this._sourceLoaded||this._paused)return;let m;this.transform=t,this.terrain=u,this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?m=t.getVisibleUnwrappedCoordinates(this._source.tileID).map((q=>new c.Z(q.canonical.z,q.wrap,q.canonical.z,q.canonical.x,q.canonical.y))):(m=$e(t,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:u,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(m=m.filter((q=>this._source.hasTile(q))))):m=[];const b=tn(t,this._source),S=Math.max(b-Rn.maxOverzooming,this._source.minzoom),C=Math.max(b+Rn.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const q={};for(const W of m)if(W.canonical.z>this._source.minzoom){const H=W.scaledTo(W.canonical.z-1);q[H.key]=H;const J=W.scaledTo(Math.max(this._source.minzoom,Math.min(W.canonical.z,5)));q[J.key]=J}m=m.concat(Object.values(q))}const O=m.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,O&&this.fire(new c.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const N=this._updateRetainedTiles(m,b);Nn(this._source.type)&&this._updateCoveredAndRetainedTiles(N,S,C,b,m,u);for(const q in N)this._tiles[q].clearFadeHold();const U=c.am(this._tiles,N);for(const q of U){const W=this._tiles[q];W.hasSymbolBuckets&&!W.holdingForFade()?W.setHoldDuration(this.map._fadeDuration):W.hasSymbolBuckets&&!W.symbolFadeFinished()||this._removeTile(q)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)}_updateRetainedTiles(t,u){var m;const b={},S={},C=Math.max(u-Rn.maxOverzooming,this._source.minzoom),O=Math.max(u+Rn.maxUnderzooming,this._source.minzoom),N={};for(const U of t){const q=this._addTile(U);b[U.key]=U,q.hasData()||u<this._source.maxzoom&&(N[U.key]=U)}this._retainLoadedChildren(N,u,O,b);for(const U of t){let q=this._tiles[U.key];if(q.hasData())continue;if(u+1>this._source.maxzoom){const H=U.children(this._source.maxzoom)[0],J=this.getTile(H);if(J&&J.hasData()){b[H.key]=H;continue}}else{const H=U.children(this._source.maxzoom);if(b[H[0].key]&&b[H[1].key]&&b[H[2].key]&&b[H[3].key])continue}let W=q.wasRequested();for(let H=U.overscaledZ-1;H>=C;--H){const J=U.scaledTo(H);if(S[J.key])break;if(S[J.key]=!0,q=this.getTile(J),!q&&W&&(q=this._addTile(J)),q){const ae=q.hasData();if((ae||!(!((m=this.map)===null||m===void 0)&&m.cancelPendingTileRequestsWhileZooming)||W)&&(b[J.key]=J),W=q.wasRequested(),ae)break}}}return b}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const u=[];let m,b=this._tiles[t].tileID;for(;b.overscaledZ>0;){if(b.key in this._loadedParentTiles){m=this._loadedParentTiles[b.key];break}u.push(b.key);const S=b.scaledTo(b.overscaledZ-1);if(m=this._getLoadedTile(S),m)break;b=S}for(const S of u)this._loadedParentTiles[S]=m}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const t in this._tiles){const u=this._tiles[t].tileID,m=this._getLoadedTile(u);this._loadedSiblingTiles[u.key]=m}}_addTile(t){let u=this._tiles[t.key];if(u)return u;u=this._cache.getAndRemove(t),u&&(this._setTileReloadTimer(t.key,u),u.tileID=t,this._state.initializeTileState(u,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,u)));const m=u;return u||(u=new ms(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(u,t.key,u.state)),u.uses++,this._tiles[t.key]=u,m||this._source.fire(new c.l("dataloading",{tile:u,coord:u.tileID,dataType:"source"})),u}_setTileReloadTimer(t,u){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const m=u.getExpiryTimeout();m&&(this._timers[t]=setTimeout((()=>{this._reloadTile(t,"expired"),delete this._timers[t]}),m))}refreshTiles(t){for(const u in this._tiles)(this._isIdRenderable(u)||this._tiles[u].state=="errored")&&t.some((m=>m.equals(this._tiles[u].tileID.canonical)))&&this._reloadTile(u,"expired")}_removeTile(t){const u=this._tiles[t];u&&(u.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),u.uses>0||(u.hasData()&&u.state!=="reloading"?this._cache.add(u.tileID,u,u.getExpiryTimeout()):(u.aborted=!0,this._abortTile(u),this._unloadTile(u))))}_dataHandler(t){const u=t.sourceDataType;t.dataType==="source"&&u==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&t.dataType==="source"&&u==="content"&&(this.reload(t.sourceDataChanged),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(t);this._cache.reset()}tilesIn(t,u,m){const b=[],S=this.transform;if(!S)return b;const C=S.getCoveringTilesDetailsProvider().allowWorldCopies(),O=m?S.getCameraQueryGeometry(t):t,N=J=>S.screenPointToMercatorCoordinate(J,this.terrain),U=this.transformBbox(t,N,!C),q=this.transformBbox(O,N,!C),W=this.getIds(),H=c.a2.fromPoints(q);for(let J=0;J<W.length;J++){const ae=this._tiles[W[J]];if(ae.holdingForFade())continue;const ge=C?[ae.tileID]:[ae.tileID.unwrapTo(-1),ae.tileID.unwrapTo(0)],me=Math.pow(2,S.zoom-ae.tileID.overscaledZ),ve=u*ae.queryPadding*c.$/ae.tileSize/me;for(const we of ge){const Ie=H.map((Ce=>we.getTilePoint(new c.a1(Ce.x,Ce.y))));if(Ie.expandBy(ve),Ie.intersects(vn)){const Ce=U.map((Ve=>we.getTilePoint(Ve))),ze=q.map((Ve=>we.getTilePoint(Ve)));b.push({tile:ae,tileID:C?we:we.unwrapTo(0),queryGeometry:Ce,cameraQueryGeometry:ze,scale:me})}}}return b}transformBbox(t,u,m){let b=t.map(u);if(m){const S=c.a2.fromPoints(t);S.shrinkBy(.001*Math.min(S.width(),S.height()));const C=S.map(u);c.a2.fromPoints(b).covers(C)||(b=b.map((O=>O.x>.5?new c.a1(O.x-1,O.y,O.z):O)))}return b}getVisibleCoordinates(t){const u=this.getRenderableIds(t).map((m=>this._tiles[m].tileID));return this.transform&&this.transform.populateCache(u),u}hasTransition(){if(this._source.hasTransition())return!0;if(Nn(this._source.type)){const t=ee.now();for(const u in this._tiles)if(this._tiles[u].fadeEndTime>=t)return!0}return!1}setFeatureState(t,u,m){this._state.updateState(t=t||"_geojsonTileLayer",u,m)}removeFeatureState(t,u,m){this._state.removeFeatureState(t=t||"_geojsonTileLayer",u,m)}getFeatureState(t,u){return this._state.getState(t=t||"_geojsonTileLayer",u)}setDependencies(t,u,m){const b=this._tiles[t];b&&b.setDependencies(u,m)}reloadTilesForDependencies(t,u){for(const m in this._tiles)this._tiles[m].hasDependency(t,u)&&this._reloadTile(m,"reloading");this._cache.filter((m=>!m.hasDependency(t,u)))}}function nn(T,t){const u=Math.abs(2*T.wrap)-+(T.wrap<0),m=Math.abs(2*t.wrap)-+(t.wrap<0);return T.overscaledZ-t.overscaledZ||m-u||t.canonical.y-T.canonical.y||t.canonical.x-T.canonical.x}function Nn(T){return T==="raster"||T==="image"||T==="video"}Rn.maxOverzooming=10,Rn.maxUnderzooming=3;class Pi{constructor(t,u){this.reset(t,u)}reset(t,u){this.points=t||[],this._distances=[0];for(let m=1;m<this.points.length;m++)this._distances[m]=this._distances[m-1]+this.points[m].dist(this.points[m-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(u||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=c.ah(t,0,1);let u=1,m=this._distances[u];const b=t*this.paddedLength+this.padding;for(;m<b&&u<this._distances.length;)m=this._distances[++u];const S=u-1,C=this._distances[S],O=m-C,N=O>0?(b-C)/O:0;return this.points[S].mult(1-N).add(this.points[u].mult(N))}}function $i(T,t){let u=!0;return T==="always"||T!=="never"&&t!=="never"||(u=!1),u}class er{constructor(t,u,m){const b=this.boxCells=[],S=this.circleCells=[];this.xCellCount=Math.ceil(t/m),this.yCellCount=Math.ceil(u/m);for(let C=0;C<this.xCellCount*this.yCellCount;C++)b.push([]),S.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=u,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/u,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,u,m,b,S){this._forEachCell(u,m,b,S,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(u),this.bboxes.push(m),this.bboxes.push(b),this.bboxes.push(S)}insertCircle(t,u,m,b){this._forEachCell(u-b,m-b,u+b,m+b,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(u),this.circles.push(m),this.circles.push(b)}_insertBoxCell(t,u,m,b,S,C){this.boxCells[S].push(C)}_insertCircleCell(t,u,m,b,S,C){this.circleCells[S].push(C)}_query(t,u,m,b,S,C,O){if(m<0||t>this.width||b<0||u>this.height)return[];const N=[];if(t<=0&&u<=0&&this.width<=m&&this.height<=b){if(S)return[{key:null,x1:t,y1:u,x2:m,y2:b}];for(let U=0;U<this.boxKeys.length;U++)N.push({key:this.boxKeys[U],x1:this.bboxes[4*U],y1:this.bboxes[4*U+1],x2:this.bboxes[4*U+2],y2:this.bboxes[4*U+3]});for(let U=0;U<this.circleKeys.length;U++){const q=this.circles[3*U],W=this.circles[3*U+1],H=this.circles[3*U+2];N.push({key:this.circleKeys[U],x1:q-H,y1:W-H,x2:q+H,y2:W+H})}}else this._forEachCell(t,u,m,b,this._queryCell,N,{hitTest:S,overlapMode:C,seenUids:{box:{},circle:{}}},O);return N}query(t,u,m,b){return this._query(t,u,m,b,!1,null)}hitTest(t,u,m,b,S,C){return this._query(t,u,m,b,!0,S,C).length>0}hitTestCircle(t,u,m,b,S){const C=t-m,O=t+m,N=u-m,U=u+m;if(O<0||C>this.width||U<0||N>this.height)return!1;const q=[];return this._forEachCell(C,N,O,U,this._queryCellCircle,q,{hitTest:!0,overlapMode:b,circle:{x:t,y:u,radius:m},seenUids:{box:{},circle:{}}},S),q.length>0}_queryCell(t,u,m,b,S,C,O,N){const{seenUids:U,hitTest:q,overlapMode:W}=O,H=this.boxCells[S];if(H!==null){const ae=this.bboxes;for(const ge of H)if(!U.box[ge]){U.box[ge]=!0;const me=4*ge,ve=this.boxKeys[ge];if(t<=ae[me+2]&&u<=ae[me+3]&&m>=ae[me+0]&&b>=ae[me+1]&&(!N||N(ve))&&(!q||!$i(W,ve.overlapMode))&&(C.push({key:ve,x1:ae[me],y1:ae[me+1],x2:ae[me+2],y2:ae[me+3]}),q))return!0}}const J=this.circleCells[S];if(J!==null){const ae=this.circles;for(const ge of J)if(!U.circle[ge]){U.circle[ge]=!0;const me=3*ge,ve=this.circleKeys[ge];if(this._circleAndRectCollide(ae[me],ae[me+1],ae[me+2],t,u,m,b)&&(!N||N(ve))&&(!q||!$i(W,ve.overlapMode))){const we=ae[me],Ie=ae[me+1],Ce=ae[me+2];if(C.push({key:ve,x1:we-Ce,y1:Ie-Ce,x2:we+Ce,y2:Ie+Ce}),q)return!0}}}return!1}_queryCellCircle(t,u,m,b,S,C,O,N){const{circle:U,seenUids:q,overlapMode:W}=O,H=this.boxCells[S];if(H!==null){const ae=this.bboxes;for(const ge of H)if(!q.box[ge]){q.box[ge]=!0;const me=4*ge,ve=this.boxKeys[ge];if(this._circleAndRectCollide(U.x,U.y,U.radius,ae[me+0],ae[me+1],ae[me+2],ae[me+3])&&(!N||N(ve))&&!$i(W,ve.overlapMode))return C.push(!0),!0}}const J=this.circleCells[S];if(J!==null){const ae=this.circles;for(const ge of J)if(!q.circle[ge]){q.circle[ge]=!0;const me=3*ge,ve=this.circleKeys[ge];if(this._circlesCollide(ae[me],ae[me+1],ae[me+2],U.x,U.y,U.radius)&&(!N||N(ve))&&!$i(W,ve.overlapMode))return C.push(!0),!0}}}_forEachCell(t,u,m,b,S,C,O,N){const U=this._convertToXCellCoord(t),q=this._convertToYCellCoord(u),W=this._convertToXCellCoord(m),H=this._convertToYCellCoord(b);for(let J=U;J<=W;J++)for(let ae=q;ae<=H;ae++)if(S.call(this,t,u,m,b,this.xCellCount*ae+J,C,O,N))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,u,m,b,S,C){const O=b-t,N=S-u,U=m+C;return U*U>O*O+N*N}_circleAndRectCollide(t,u,m,b,S,C,O){const N=(C-b)/2,U=Math.abs(t-(b+N));if(U>N+m)return!1;const q=(O-S)/2,W=Math.abs(u-(S+q));if(W>q+m)return!1;if(U<=N||W<=q)return!0;const H=U-N,J=W-q;return H*H+J*J<=m*m}}function Cr(T,t,u){const m=c.L();if(!T){const{vecSouth:W,vecEast:H}=Kn(t),J=k();J[0]=H[0],J[1]=H[1],J[2]=W[0],J[3]=W[1],b=J,(q=(C=(S=J)[0])*(U=S[3])-(N=S[2])*(O=S[1]))&&(b[0]=U*(q=1/q),b[1]=-O*q,b[2]=-N*q,b[3]=C*q),m[0]=J[0],m[1]=J[1],m[4]=J[2],m[5]=J[3]}var b,S,C,O,N,U,q;return c.N(m,m,[1/u,1/u,1]),m}function Vn(T,t,u,m){if(T){const b=c.L();if(!t){const{vecSouth:S,vecEast:C}=Kn(u);b[0]=C[0],b[1]=C[1],b[4]=S[0],b[5]=S[1]}return c.N(b,b,[m,m,1]),b}return u.pixelsToClipSpaceMatrix}function Kn(T){const t=Math.cos(T.rollInRadians),u=Math.sin(T.rollInRadians),m=Math.cos(T.pitchInRadians),b=Math.cos(T.bearingInRadians),S=Math.sin(T.bearingInRadians),C=c.ar();C[0]=-b*m*u-S*t,C[1]=-S*m*u+b*t;const O=c.as(C);O<1e-9?c.at(C):c.au(C,C,1/O);const N=c.ar();N[0]=b*m*t-S*u,N[1]=S*m*t+b*u;const U=c.as(N);return U<1e-9?c.at(N):c.au(N,N,1/U),{vecEast:N,vecSouth:C}}function vr(T,t,u,m){let b;m?(b=[T,t,m(T,t),1],c.aw(b,b,u)):(b=[T,t,0,1],Gr(b,b,u));const S=b[3];return{point:new c.P(b[0]/S,b[1]/S),signedDistanceFromCamera:S,isOccluded:!1}}function Pt(T,t){return .5+T/t*.5}function en(T,t){return T.x>=-t[0]&&T.x<=t[0]&&T.y>=-t[1]&&T.y<=t[1]}function tr(T,t,u,m,b,S,C,O,N,U,q,W,H){const J=u?T.textSizeData:T.iconSizeData,ae=c.an(J,t.transform.zoom),ge=[256/t.width*2+1,256/t.height*2+1],me=u?T.text.dynamicLayoutVertexArray:T.icon.dynamicLayoutVertexArray;me.clear();const ve=T.lineVertexArray,we=u?T.text.placedSymbolArray:T.icon.placedSymbolArray,Ie=t.transform.width/t.transform.height;let Ce=!1;for(let ze=0;ze<we.length;ze++){const Ve=we.get(ze);if(Ve.hidden||Ve.writingMode===c.ao.vertical&&!Ce){qr(Ve.numGlyphs,me);continue}Ce=!1;const Me=new c.P(Ve.anchorX,Ve.anchorY),Ye={getElevation:H,pitchedLabelPlaneMatrix:m,lineVertexArray:ve,pitchWithMap:S,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:t.transform,tileAnchorPoint:Me,unwrappedTileID:N,width:U,height:q,translation:W},ct=Eo(Ve.anchorX,Ve.anchorY,Ye);if(!en(ct.point,ge)){qr(Ve.numGlyphs,me);continue}const rt=Pt(t.transform.cameraToCenterDistance,ct.signedDistanceFromCamera),st=c.ap(J,ae,Ve),lt=S?st*t.transform.getPitchedTextCorrection(Ve.anchorX,Ve.anchorY,N)/rt:st*rt,Nt=Lt({projectionContext:Ye,pitchedLabelPlaneMatrixInverse:b,symbol:Ve,fontSize:lt,flip:!1,keepUpright:C,glyphOffsetArray:T.glyphOffsetArray,dynamicLayoutVertexArray:me,aspectRatio:Ie,rotateToLine:O});Ce=Nt.useVertical,(Nt.notEnoughRoom||Ce||Nt.needsFlipping&&Lt({projectionContext:Ye,pitchedLabelPlaneMatrixInverse:b,symbol:Ve,fontSize:lt,flip:!0,keepUpright:C,glyphOffsetArray:T.glyphOffsetArray,dynamicLayoutVertexArray:me,aspectRatio:Ie,rotateToLine:O}).notEnoughRoom)&&qr(Ve.numGlyphs,me)}u?T.text.dynamicLayoutVertexBuffer.updateData(me):T.icon.dynamicLayoutVertexBuffer.updateData(me)}function ta(T,t,u,m,b,S,C,O){const N=S.glyphStartIndex+S.numGlyphs,U=S.lineStartIndex,q=S.lineStartIndex+S.lineLength,W=t.getoffsetX(S.glyphStartIndex),H=t.getoffsetX(N-1),J=js(T*W,u,m,b,S.segment,U,q,O,C);if(!J)return null;const ae=js(T*H,u,m,b,S.segment,U,q,O,C);return ae?O.projectionCache.anyProjectionOccluded?null:{first:J,last:ae}:null}function Aa(T,t,u,m){return T===c.ao.horizontal&&Math.abs(u.y-t.y)>Math.abs(u.x-t.x)*m?{useVertical:!0}:(T===c.ao.vertical?t.y<u.y:t.x>u.x)?{needsFlipping:!0}:null}function Lt(T){const{projectionContext:t,pitchedLabelPlaneMatrixInverse:u,symbol:m,fontSize:b,flip:S,keepUpright:C,glyphOffsetArray:O,dynamicLayoutVertexArray:N,aspectRatio:U,rotateToLine:q}=T,W=b/24,H=m.lineOffsetX*W,J=m.lineOffsetY*W;let ae;if(m.numGlyphs>1){const ge=m.glyphStartIndex+m.numGlyphs,me=m.lineStartIndex,ve=m.lineStartIndex+m.lineLength,we=ta(W,O,H,J,S,m,q,t);if(!we)return{notEnoughRoom:!0};const Ie=il(we.first.point.x,we.first.point.y,t,u),Ce=il(we.last.point.x,we.last.point.y,t,u);if(C&&!S){const ze=Aa(m.writingMode,Ie,Ce,U);if(ze)return ze}ae=[we.first];for(let ze=m.glyphStartIndex+1;ze<ge-1;ze++){const Ve=js(W*O.getoffsetX(ze),H,J,S,m.segment,me,ve,t,q);if(!Ve)return{notEnoughRoom:!0};ae.push(Ve)}ae.push(we.last)}else{if(C&&!S){const me=nr(t.tileAnchorPoint.x,t.tileAnchorPoint.y,t).point,ve=m.lineStartIndex+m.segment+1,we=new c.P(t.lineVertexArray.getx(ve),t.lineVertexArray.gety(ve)),Ie=nr(we.x,we.y,t),Ce=Ie.signedDistanceFromCamera>0?Ie.point:yn(t.tileAnchorPoint,we,me,1,t),ze=il(me.x,me.y,t,u),Ve=il(Ce.x,Ce.y,t,u),Me=Aa(m.writingMode,ze,Ve,U);if(Me)return Me}const ge=js(W*O.getoffsetX(m.glyphStartIndex),H,J,S,m.segment,m.lineStartIndex,m.lineStartIndex+m.lineLength,t,q);if(!ge||t.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};ae=[ge]}for(const ge of ae)c.av(N,ge.point,ge.angle);return{}}function yn(T,t,u,m,b){const S=T.add(T.sub(t)._unit()),C=nr(S.x,S.y,b).point,O=u.sub(C);return u.add(O._mult(m/O.mag()))}function Mn(T,t,u){const m=t.projectionCache;if(m.projections[T])return m.projections[T];const b=new c.P(t.lineVertexArray.getx(T),t.lineVertexArray.gety(T)),S=nr(b.x,b.y,t);if(S.signedDistanceFromCamera>0)return m.projections[T]=S.point,m.anyProjectionOccluded=m.anyProjectionOccluded||S.isOccluded,S.point;const C=T-u.direction;return yn(u.distanceFromAnchor===0?t.tileAnchorPoint:new c.P(t.lineVertexArray.getx(C),t.lineVertexArray.gety(C)),b,u.previousVertex,u.absOffsetX-u.distanceFromAnchor+1,t)}function nr(T,t,u){const m=T+u.translation[0],b=t+u.translation[1];let S;return u.pitchWithMap?(S=vr(m,b,u.pitchedLabelPlaneMatrix,u.getElevation),S.isOccluded=!1):(S=u.transform.projectTileCoordinates(m,b,u.unwrappedTileID,u.getElevation),S.point.x=(.5*S.point.x+.5)*u.width,S.point.y=(.5*-S.point.y+.5)*u.height),S}function il(T,t,u,m){if(u.pitchWithMap){const b=[T,t,0,1];return c.aw(b,b,m),u.transform.projectTileCoordinates(b[0]/b[3],b[1]/b[3],u.unwrappedTileID,u.getElevation).point}return{x:T/u.width*2-1,y:1-t/u.height*2}}function Eo(T,t,u){return u.transform.projectTileCoordinates(T,t,u.unwrappedTileID,u.getElevation)}function Bn(T,t,u){return T._unit()._perp()._mult(t*u)}function Vs(T,t,u,m,b,S,C,O,N){if(O.projectionCache.offsets[T])return O.projectionCache.offsets[T];const U=u.add(t);if(T+N.direction<m||T+N.direction>=b)return O.projectionCache.offsets[T]=U,U;const q=Mn(T+N.direction,O,N),W=Bn(q.sub(u),C,N.direction),H=u.add(W),J=q.add(W);return O.projectionCache.offsets[T]=c.ax(S,U,H,J)||U,O.projectionCache.offsets[T]}function js(T,t,u,m,b,S,C,O,N){const U=m?T-t:T+t;let q=U>0?1:-1,W=0;m&&(q*=-1,W=Math.PI),q<0&&(W+=Math.PI);let H,J=q>0?S+b:S+b+1;O.projectionCache.cachedAnchorPoint?H=O.projectionCache.cachedAnchorPoint:(H=nr(O.tileAnchorPoint.x,O.tileAnchorPoint.y,O).point,O.projectionCache.cachedAnchorPoint=H);let ae,ge,me=H,ve=H,we=0,Ie=0;const Ce=Math.abs(U),ze=[];let Ve;for(;we+Ie<=Ce;){if(J+=q,J<S||J>=C)return null;we+=Ie,ve=me,ge=ae;const ct={absOffsetX:Ce,direction:q,distanceFromAnchor:we,previousVertex:ve};if(me=Mn(J,O,ct),u===0)ze.push(ve),Ve=me.sub(ve);else{let rt;const st=me.sub(ve);rt=st.mag()===0?Bn(Mn(J+q,O,ct).sub(me),u,q):Bn(st,u,q),ge||(ge=ve.add(rt)),ae=Vs(J,rt,me,S,C,ge,u,O,ct),ze.push(ge),Ve=ae.sub(ge)}Ie=Ve.mag()}const Me=Ve._mult((Ce-we)/Ie)._add(ge||ve),Ye=W+Math.atan2(me.y-ve.y,me.x-ve.x);return ze.push(Me),{point:Me,angle:N?Ye:0,path:ze}}const gs=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function qr(T,t){for(let u=0;u<T;u++){const m=t.length;t.resize(m+4),t.float32.set(gs,3*m)}}function Gr(T,t,u){const m=t[0],b=t[1];return T[0]=u[0]*m+u[4]*b+u[12],T[1]=u[1]*m+u[5]*b+u[13],T[3]=u[3]*m+u[7]*b+u[15],T}const Si=100;class Mr{constructor(t,u=new er(t.width+200,t.height+200,25),m=new er(t.width+200,t.height+200,25)){this.transform=t,this.grid=u,this.ignoredGrid=m,this.pitchFactor=Math.cos(t.pitch*Math.PI/180)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+Si,this.screenBottomBoundary=t.height+Si,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,u,m,b,S,C,O,N,U,q,W,H){const J=this.projectAndGetPerspectiveRatio(t.anchorPointX+N[0],t.anchorPointY+N[1],S,q,H),ae=m*J.perspectiveRatio;let ge;if(C||O)ge=this._projectCollisionBox(t,ae,b,S,C,O,N,J,q,W,H);else{const Ve=J.x+(W?W.x*ae:0),Me=J.y+(W?W.y*ae:0);ge={allPointsOccluded:!1,box:[Ve+t.x1*ae,Me+t.y1*ae,Ve+t.x2*ae,Me+t.y2*ae]}}const[me,ve,we,Ie]=ge.box,Ce=C?ge.allPointsOccluded:J.isOccluded;let ze=Ce;return ze||(ze=J.perspectiveRatio<this.perspectiveRatioCutoff),ze||(ze=!this.isInsideGrid(me,ve,we,Ie)),ze||u!=="always"&&this.grid.hitTest(me,ve,we,Ie,u,U)?{box:[me,ve,we,Ie],placeable:!1,offscreen:!1,occluded:Ce}:{box:[me,ve,we,Ie],placeable:!0,offscreen:this.isOffscreen(me,ve,we,Ie),occluded:Ce}}placeCollisionCircles(t,u,m,b,S,C,O,N,U,q,W,H,J,ae){const ge=[],me=new c.P(u.anchorX,u.anchorY),ve=this.getPerspectiveRatio(me.x,me.y,C,ae),we=(U?S*this.transform.getPitchedTextCorrection(u.anchorX,u.anchorY,C)/ve:S*ve)/c.aB,Ie={getElevation:ae,pitchedLabelPlaneMatrix:O,lineVertexArray:m,pitchWithMap:U,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:me,unwrappedTileID:C,width:this.transform.width,height:this.transform.height,translation:J},Ce=ta(we,b,u.lineOffsetX*we,u.lineOffsetY*we,!1,u,!1,Ie);let ze=!1,Ve=!1,Me=!0;if(Ce){const Ye=.5*W*ve+H,ct=new c.P(-100,-100),rt=new c.P(this.screenRightBoundary,this.screenBottomBoundary),st=new Pi,lt=Ce.first,Nt=Ce.last;let Vt=[];for(let Zn=lt.path.length-1;Zn>=1;Zn--)Vt.push(lt.path[Zn]);for(let Zn=1;Zn<Nt.path.length;Zn++)Vt.push(Nt.path[Zn]);const At=2.5*Ye;if(U){const Zn=this.projectPathToScreenSpace(Vt,Ie);Vt=Zn.some((vi=>vi.signedDistanceFromCamera<=0))?[]:Zn.map((vi=>vi.point))}let ln=[];if(Vt.length>0){const Zn=Vt[0].clone(),vi=Vt[0].clone();for(let Wi=1;Wi<Vt.length;Wi++)Zn.x=Math.min(Zn.x,Vt[Wi].x),Zn.y=Math.min(Zn.y,Vt[Wi].y),vi.x=Math.max(vi.x,Vt[Wi].x),vi.y=Math.max(vi.y,Vt[Wi].y);ln=Zn.x>=ct.x&&vi.x<=rt.x&&Zn.y>=ct.y&&vi.y<=rt.y?[Vt]:vi.x<ct.x||Zn.x>rt.x||vi.y<ct.y||Zn.y>rt.y?[]:c.ay([Vt],ct.x,ct.y,rt.x,rt.y)}for(const Zn of ln){st.reset(Zn,.25*Ye);let vi=0;vi=st.length<=.5*Ye?1:Math.ceil(st.paddedLength/At)+1;for(let Wi=0;Wi<vi;Wi++){const ji=Wi/Math.max(vi-1,1),Ir=st.lerp(ji),Br=Ir.x+Si,Un=Ir.y+Si;ge.push(Br,Un,Ye,0);const lr=Br-Ye,sa=Un-Ye,Fr=Br+Ye,La=Un+Ye;if(Me=Me&&this.isOffscreen(lr,sa,Fr,La),Ve=Ve||this.isInsideGrid(lr,sa,Fr,La),t!=="always"&&this.grid.hitTestCircle(Br,Un,Ye,t,q)&&(ze=!0,!N))return{circles:[],offscreen:!1,collisionDetected:ze}}}}return{circles:!N&&ze||!Ve||ve<this.perspectiveRatioCutoff?[]:ge,offscreen:Me,collisionDetected:ze}}projectPathToScreenSpace(t,u){const m=(function(b,S){const C=c.L();return c.aq(C,S.pitchedLabelPlaneMatrix),b.map((O=>{const N=vr(O.x,O.y,C,S.getElevation),U=S.transform.projectTileCoordinates(N.point.x,N.point.y,S.unwrappedTileID,S.getElevation);return U.point.x=(.5*U.point.x+.5)*S.width,U.point.y=(.5*-U.point.y+.5)*S.height,U}))})(t,u);return(function(b){let S=0,C=0,O=0,N=0;for(let U=0;U<b.length;U++)b[U].isOccluded?(O=U+1,N=0):(N++,N>C&&(C=N,S=O));return b.slice(S,S+C)})(m)}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const u=[],m=new c.a2;for(const W of t){const H=new c.P(W.x+Si,W.y+Si);m.extend(H),u.push(H)}const{minX:b,minY:S,maxX:C,maxY:O}=m,N=this.grid.query(b,S,C,O).concat(this.ignoredGrid.query(b,S,C,O)),U={},q={};for(const W of N){const H=W.key;if(U[H.bucketInstanceId]===void 0&&(U[H.bucketInstanceId]={}),U[H.bucketInstanceId][H.featureIndex])continue;const J=[new c.P(W.x1,W.y1),new c.P(W.x2,W.y1),new c.P(W.x2,W.y2),new c.P(W.x1,W.y2)];c.az(u,J)&&(U[H.bucketInstanceId][H.featureIndex]=!0,q[H.bucketInstanceId]===void 0&&(q[H.bucketInstanceId]=[]),q[H.bucketInstanceId].push(H.featureIndex))}return q}insertCollisionBox(t,u,m,b,S,C){(m?this.ignoredGrid:this.grid).insert({bucketInstanceId:b,featureIndex:S,collisionGroupID:C,overlapMode:u},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,u,m,b,S,C){const O=m?this.ignoredGrid:this.grid,N={bucketInstanceId:b,featureIndex:S,collisionGroupID:C,overlapMode:u};for(let U=0;U<t.length;U+=4)O.insertCircle(N,t[U],t[U+1],t[U+2])}projectAndGetPerspectiveRatio(t,u,m,b,S){if(S){let C;b?(C=[t,u,b(t,u),1],c.aw(C,C,S)):(C=[t,u,0,1],Gr(C,C,S));const O=C[3];return{x:(C[0]/O+1)/2*this.transform.width+Si,y:(-C[1]/O+1)/2*this.transform.height+Si,perspectiveRatio:.5+this.transform.cameraToCenterDistance/O*.5,isOccluded:!1,signedDistanceFromCamera:O}}{const C=this.transform.projectTileCoordinates(t,u,m,b);return{x:(C.point.x+1)/2*this.transform.width+Si,y:(1-C.point.y)/2*this.transform.height+Si,perspectiveRatio:.5+this.transform.cameraToCenterDistance/C.signedDistanceFromCamera*.5,isOccluded:C.isOccluded,signedDistanceFromCamera:C.signedDistanceFromCamera}}}getPerspectiveRatio(t,u,m,b){const S=this.transform.projectTileCoordinates(t,u,m,b);return .5+this.transform.cameraToCenterDistance/S.signedDistanceFromCamera*.5}isOffscreen(t,u,m,b){return m<Si||t>=this.screenRightBoundary||b<Si||u>this.screenBottomBoundary}isInsideGrid(t,u,m,b){return m>=0&&t<this.gridRightBoundary&&b>=0&&u<this.gridBottomBoundary}getViewportMatrix(){const t=c.ag([]);return c.M(t,t,[-100,-100,0]),t}_projectCollisionBox(t,u,m,b,S,C,O,N,U,q,W){let H=1,J=0,ae=0,ge=1;const me=t.anchorPointX+O[0],ve=t.anchorPointY+O[1];if(C&&!S){const Vt=this.projectAndGetPerspectiveRatio(me+1,ve,b,U,W),At=Vt.x-N.x,ln=Math.atan((Vt.y-N.y)/At)+(At<0?Math.PI:0),Zn=Math.sin(ln),vi=Math.cos(ln);H=vi,J=Zn,ae=-Zn,ge=vi}else if(!C&&S){const Vt=Kn(this.transform);H=Vt.vecEast[0],J=Vt.vecEast[1],ae=Vt.vecSouth[0],ge=Vt.vecSouth[1]}let we=N.x,Ie=N.y,Ce=u;S&&(we=me,Ie=ve,Ce=Math.pow(2,-(this.transform.zoom-m.overscaledZ)),Ce*=this.transform.getPitchedTextCorrection(me,ve,b),q||(Ce*=c.ah(.5+N.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),q&&(we+=H*q.x*Ce+ae*q.y*Ce,Ie+=J*q.x*Ce+ge*q.y*Ce);const ze=t.x1*Ce,Ve=t.x2*Ce,Me=(ze+Ve)/2,Ye=t.y1*Ce,ct=t.y2*Ce,rt=(Ye+ct)/2,st=[{offsetX:ze,offsetY:Ye},{offsetX:Me,offsetY:Ye},{offsetX:Ve,offsetY:Ye},{offsetX:Ve,offsetY:rt},{offsetX:Ve,offsetY:ct},{offsetX:Me,offsetY:ct},{offsetX:ze,offsetY:ct},{offsetX:ze,offsetY:rt}];let lt=[];for(const{offsetX:Vt,offsetY:At}of st)lt.push(new c.P(we+H*Vt+ae*At,Ie+J*Vt+ge*At));let Nt=!1;if(S){const Vt=lt.map((At=>this.projectAndGetPerspectiveRatio(At.x,At.y,b,U,W)));Nt=Vt.some((At=>!At.isOccluded)),lt=Vt.map((At=>new c.P(At.x,At.y)))}else Nt=!0;return{box:c.aA(lt),allPointsOccluded:!Nt}}}class da{constructor(t,u,m,b){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?u:-u))):b&&m?1:0,this.placed=m}isHidden(){return this.opacity===0&&!this.placed}}class xi{constructor(t,u,m,b,S){this.text=new da(t?t.text:null,u,m,S),this.icon=new da(t?t.icon:null,u,b,S)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Ao{constructor(t,u,m){this.text=t,this.icon=u,this.skipFade=m}}class ja{constructor(t,u,m,b,S){this.bucketInstanceId=t,this.featureIndex=u,this.sourceLayerIndex=m,this.bucketIndex=b,this.tileID=S}}class Co{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const u=++this.maxGroupID;this.collisionGroups[t]={ID:u,predicate:m=>m.collisionGroupID===u}}return this.collisionGroups[t]}}function Us(T,t,u,m,b){const{horizontalAlign:S,verticalAlign:C}=c.aH(T);return new c.P(-(S-.5)*t+m[0]*b,-(C-.5)*u+m[1]*b)}class $s{constructor(t,u,m,b,S){this.transform=t.clone(),this.terrain=u,this.collisionIndex=new Mr(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=m,this.retainedQueryData={},this.collisionGroups=new Co(b),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=S,S&&(S.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(t){const u=this.terrain;return u?(m,b)=>u.getElevation(t,m,b):null}getBucketParts(t,u,m,b){const S=m.getBucket(u),C=m.latestFeatureIndex;if(!S||!C||u.id!==S.layerIds[0])return;const O=m.collisionBoxArray,N=S.layers[0].layout,U=S.layers[0].paint,q=Math.pow(2,this.transform.zoom-m.tileID.overscaledZ),W=m.tileSize/c.$,H=m.tileID.toUnwrapped(),J=N.get("text-rotation-alignment")==="map",ae=c.aC(m,1,this.transform.zoom),ge=c.aD(this.collisionIndex.transform,m,U.get("text-translate"),U.get("text-translate-anchor")),me=c.aD(this.collisionIndex.transform,m,U.get("icon-translate"),U.get("icon-translate-anchor")),ve=Cr(J,this.transform,ae);this.retainedQueryData[S.bucketInstanceId]=new ja(S.bucketInstanceId,C,S.sourceLayerIndex,S.index,m.tileID);const we={bucket:S,layout:N,translationText:ge,translationIcon:me,unwrappedTileID:H,pitchedLabelPlaneMatrix:ve,scale:q,textPixelRatio:W,holdingForFade:m.holdingForFade(),collisionBoxArray:O,partiallyEvaluatedTextSize:c.an(S.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(S.sourceID)};if(b)for(const Ie of S.sortKeyRanges){const{sortKey:Ce,symbolInstanceStart:ze,symbolInstanceEnd:Ve}=Ie;t.push({sortKey:Ce,symbolInstanceStart:ze,symbolInstanceEnd:Ve,parameters:we})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:S.symbolInstances.length,parameters:we})}attemptAnchorPlacement(t,u,m,b,S,C,O,N,U,q,W,H,J,ae,ge,me,ve,we,Ie,Ce){const ze=c.aE[t.textAnchor],Ve=[t.textOffset0,t.textOffset1],Me=Us(ze,m,b,Ve,S),Ye=this.collisionIndex.placeCollisionBox(u,H,N,U,q,O,C,me,W.predicate,Ie,Me,Ce);if((!we||this.collisionIndex.placeCollisionBox(we,H,N,U,q,O,C,ve,W.predicate,Ie,Me,Ce).placeable)&&Ye.placeable){let ct;if(this.prevPlacement&&this.prevPlacement.variableOffsets[J.crossTileID]&&this.prevPlacement.placements[J.crossTileID]&&this.prevPlacement.placements[J.crossTileID].text&&(ct=this.prevPlacement.variableOffsets[J.crossTileID].anchor),J.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[J.crossTileID]={textOffset:Ve,width:m,height:b,anchor:ze,textBoxScale:S,prevAnchor:ct},this.markUsedJustification(ae,ze,J,ge),ae.allowVerticalPlacement&&(this.markUsedOrientation(ae,ge,J),this.placedOrientations[J.crossTileID]=ge),{shift:Me,placedGlyphBoxes:Ye}}}placeLayerBucketPart(t,u,m){const{bucket:b,layout:S,translationText:C,translationIcon:O,unwrappedTileID:N,pitchedLabelPlaneMatrix:U,textPixelRatio:q,holdingForFade:W,collisionBoxArray:H,partiallyEvaluatedTextSize:J,collisionGroup:ae}=t.parameters,ge=S.get("text-optional"),me=S.get("icon-optional"),ve=c.aF(S,"text-overlap","text-allow-overlap"),we=ve==="always",Ie=c.aF(S,"icon-overlap","icon-allow-overlap"),Ce=Ie==="always",ze=S.get("text-rotation-alignment")==="map",Ve=S.get("text-pitch-alignment")==="map",Me=S.get("icon-text-fit")!=="none",Ye=S.get("symbol-z-order")==="viewport-y",ct=we&&(Ce||!b.hasIconData()||me),rt=Ce&&(we||!b.hasTextData()||ge);!b.collisionArrays&&H&&b.deserializeCollisionBoxes(H);const st=this.retainedQueryData[b.bucketInstanceId].tileID,lt=this._getTerrainElevationFunc(st),Nt=this.transform.getFastPathSimpleProjectionMatrix(st),Vt=(At,ln,Zn)=>{var vi,Wi;if(u[At.crossTileID])return;if(W)return void(this.placements[At.crossTileID]=new Ao(!1,!1,!1));let ji=!1,Ir=!1,Br=!0,Un=null,lr={box:null,placeable:!1,offscreen:null,occluded:!1},sa={placeable:!1},Fr=null,La=null,Wa=null,po=0,Mu=0,iu=0;ln.textFeatureIndex?po=ln.textFeatureIndex:At.useRuntimeCollisionCircles&&(po=At.featureIndex),ln.verticalTextFeatureIndex&&(Mu=ln.verticalTextFeatureIndex);const Th=ln.textBox;if(Th){const to=oa=>{let la=c.ao.horizontal;if(b.allowVerticalPlacement&&!oa&&this.prevPlacement){const qo=this.prevPlacement.placedOrientations[At.crossTileID];qo&&(this.placedOrientations[At.crossTileID]=qo,la=qo,this.markUsedOrientation(b,la,At))}return la},vl=(oa,la)=>{if(b.allowVerticalPlacement&&At.numVerticalGlyphVertices>0&&ln.verticalTextBox){for(const qo of b.writingModes)if(qo===c.ao.vertical?(lr=la(),sa=lr):lr=oa(),lr&&lr.placeable)break}else lr=oa()},ss=At.textAnchorOffsetStartIndex,Iu=At.textAnchorOffsetEndIndex;if(Iu===ss){const oa=(la,qo)=>{const ua=this.collisionIndex.placeCollisionBox(la,ve,q,st,N,Ve,ze,C,ae.predicate,lt,void 0,Nt);return ua&&ua.placeable&&(this.markUsedOrientation(b,qo,At),this.placedOrientations[At.crossTileID]=qo),ua};vl((()=>oa(Th,c.ao.horizontal)),(()=>{const la=ln.verticalTextBox;return b.allowVerticalPlacement&&At.numVerticalGlyphVertices>0&&la?oa(la,c.ao.vertical):{box:null,offscreen:null}})),to(lr&&lr.placeable)}else{let oa=c.aE[(Wi=(vi=this.prevPlacement)===null||vi===void 0?void 0:vi.variableOffsets[At.crossTileID])===null||Wi===void 0?void 0:Wi.anchor];const la=(ua,ud,mc)=>{const ru=ua.x2-ua.x1,bl=ua.y2-ua.y1,au=At.textBoxScale,Ff=Me&&Ie==="never"?ud:null;let mo=null,Xp=ve==="never"?1:2,Vf="never";oa&&Xp++;for(let cd=0;cd<Xp;cd++){for(let gc=ss;gc<Iu;gc++){const su=b.textAnchorOffsets.get(gc);if(oa&&su.textAnchor!==oa)continue;const xl=this.attemptAnchorPlacement(su,ua,ru,bl,au,ze,Ve,q,st,N,ae,Vf,At,b,mc,C,O,Ff,lt);if(xl&&(mo=xl.placedGlyphBoxes,mo&&mo.placeable))return ji=!0,Un=xl.shift,mo}oa?oa=null:Vf=ve}return m&&!mo&&(mo={box:this.collisionIndex.placeCollisionBox(Th,"always",q,st,N,Ve,ze,C,ae.predicate,lt,void 0,Nt).box,offscreen:!1,placeable:!1,occluded:!1}),mo};vl((()=>la(Th,ln.iconBox,c.ao.horizontal)),(()=>{const ua=ln.verticalTextBox;return b.allowVerticalPlacement&&(!lr||!lr.placeable)&&At.numVerticalGlyphVertices>0&&ua?la(ua,ln.verticalIconBox,c.ao.vertical):{box:null,occluded:!0,offscreen:null}})),lr&&(ji=lr.placeable,Br=lr.offscreen);const qo=to(lr&&lr.placeable);if(!ji&&this.prevPlacement){const ua=this.prevPlacement.variableOffsets[At.crossTileID];ua&&(this.variableOffsets[At.crossTileID]=ua,this.markUsedJustification(b,ua.anchor,At,qo))}}}if(Fr=lr,ji=Fr&&Fr.placeable,Br=Fr&&Fr.offscreen,At.useRuntimeCollisionCircles){const to=b.text.placedSymbolArray.get(At.centerJustifiedTextSymbolIndex),vl=c.ap(b.textSizeData,J,to),ss=S.get("text-padding");La=this.collisionIndex.placeCollisionCircles(ve,to,b.lineVertexArray,b.glyphOffsetArray,vl,N,U,m,Ve,ae.predicate,At.collisionCircleDiameter,ss,C,lt),La.circles.length&&La.collisionDetected&&!m&&c.w("Collisions detected, but collision boxes are not shown"),ji=we||La.circles.length>0&&!La.collisionDetected,Br=Br&&La.offscreen}if(ln.iconFeatureIndex&&(iu=ln.iconFeatureIndex),ln.iconBox){const to=vl=>this.collisionIndex.placeCollisionBox(vl,Ie,q,st,N,Ve,ze,O,ae.predicate,lt,Me&&Un?Un:void 0,Nt);sa&&sa.placeable&&ln.verticalIconBox?(Wa=to(ln.verticalIconBox),Ir=Wa.placeable):(Wa=to(ln.iconBox),Ir=Wa.placeable),Br=Br&&Wa.offscreen}const qc=ge||At.numHorizontalGlyphVertices===0&&At.numVerticalGlyphVertices===0,fc=me||At.numIconVertices===0;qc||fc?fc?qc||(Ir=Ir&&ji):ji=Ir&&ji:Ir=ji=Ir&&ji;const pc=Ir&&Wa.placeable;if(ji&&Fr.placeable&&this.collisionIndex.insertCollisionBox(Fr.box,ve,S.get("text-ignore-placement"),b.bucketInstanceId,sa&&sa.placeable&&Mu?Mu:po,ae.ID),pc&&this.collisionIndex.insertCollisionBox(Wa.box,Ie,S.get("icon-ignore-placement"),b.bucketInstanceId,iu,ae.ID),La&&ji&&this.collisionIndex.insertCollisionCircles(La.circles,ve,S.get("text-ignore-placement"),b.bucketInstanceId,po,ae.ID),m&&this.storeCollisionData(b.bucketInstanceId,Zn,ln,Fr,Wa,La),At.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(b.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[At.crossTileID]=new Ao((ji||ct)&&!(Fr!=null&&Fr.occluded),(Ir||rt)&&!(Wa!=null&&Wa.occluded),Br||b.justReloaded),u[At.crossTileID]=!0};if(Ye){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const At=b.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let ln=At.length-1;ln>=0;--ln){const Zn=At[ln];Vt(b.symbolInstances.get(Zn),b.collisionArrays[Zn],Zn)}}else for(let At=t.symbolInstanceStart;At<t.symbolInstanceEnd;At++)Vt(b.symbolInstances.get(At),b.collisionArrays[At],At);b.justReloaded=!1}storeCollisionData(t,u,m,b,S,C){if(m.textBox||m.iconBox){let O,N;this.collisionBoxArrays.has(t)?O=this.collisionBoxArrays.get(t):(O=new Map,this.collisionBoxArrays.set(t,O)),O.has(u)?N=O.get(u):(N={text:null,icon:null},O.set(u,N)),m.textBox&&(N.text=b.box),m.iconBox&&(N.icon=S.box)}if(C){let O=this.collisionCircleArrays[t];O===void 0&&(O=this.collisionCircleArrays[t]=[]);for(let N=0;N<C.circles.length;N+=4)O.push(C.circles[N+0]-Si),O.push(C.circles[N+1]-Si),O.push(C.circles[N+2]),O.push(C.collisionDetected?1:0)}}markUsedJustification(t,u,m,b){let S;S=b===c.ao.vertical?m.verticalPlacedTextSymbolIndex:{left:m.leftJustifiedTextSymbolIndex,center:m.centerJustifiedTextSymbolIndex,right:m.rightJustifiedTextSymbolIndex}[c.aG(u)];const C=[m.leftJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.rightJustifiedTextSymbolIndex,m.verticalPlacedTextSymbolIndex];for(const O of C)O>=0&&(t.text.placedSymbolArray.get(O).crossTileID=S>=0&&O!==S?0:m.crossTileID)}markUsedOrientation(t,u,m){const b=u===c.ao.horizontal||u===c.ao.horizontalOnly?u:0,S=u===c.ao.vertical?u:0,C=[m.leftJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.rightJustifiedTextSymbolIndex];for(const O of C)t.text.placedSymbolArray.get(O).placedOrientation=b;m.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(m.verticalPlacedTextSymbolIndex).placedOrientation=S)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const u=this.prevPlacement;let m=!1;this.prevZoomAdjustment=u?u.zoomAdjustment(this.transform.zoom):0;const b=u?u.symbolFadeChange(t):1,S=u?u.opacities:{},C=u?u.variableOffsets:{},O=u?u.placedOrientations:{};for(const N in this.placements){const U=this.placements[N],q=S[N];q?(this.opacities[N]=new xi(q,b,U.text,U.icon),m=m||U.text!==q.text.placed||U.icon!==q.icon.placed):(this.opacities[N]=new xi(null,b,U.text,U.icon,U.skipFade),m=m||U.text||U.icon)}for(const N in S){const U=S[N];if(!this.opacities[N]){const q=new xi(U,b,!1,!1);q.isHidden()||(this.opacities[N]=q,m=m||U.text.placed||U.icon.placed)}}for(const N in C)this.variableOffsets[N]||!this.opacities[N]||this.opacities[N].isHidden()||(this.variableOffsets[N]=C[N]);for(const N in O)this.placedOrientations[N]||!this.opacities[N]||this.opacities[N].isHidden()||(this.placedOrientations[N]=O[N]);if(u&&u.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");m?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=u?u.lastPlacementChangeTime:t)}updateLayerOpacities(t,u){const m={};for(const b of u){const S=b.getBucket(t);S&&b.latestFeatureIndex&&t.id===S.layerIds[0]&&this.updateBucketOpacities(S,b.tileID,m,b.collisionBoxArray)}}updateBucketOpacities(t,u,m,b){t.hasTextData()&&(t.text.opacityVertexArray.clear(),t.text.hasVisibleVertices=!1),t.hasIconData()&&(t.icon.opacityVertexArray.clear(),t.icon.hasVisibleVertices=!1),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const S=t.layers[0],C=S.layout,O=new xi(null,0,!1,!1,!0),N=C.get("text-allow-overlap"),U=C.get("icon-allow-overlap"),q=S._unevaluatedLayout.hasValue("text-variable-anchor")||S._unevaluatedLayout.hasValue("text-variable-anchor-offset"),W=C.get("text-rotation-alignment")==="map",H=C.get("text-pitch-alignment")==="map",J=C.get("icon-text-fit")!=="none",ae=new xi(null,0,N&&(U||!t.hasIconData()||C.get("icon-optional")),U&&(N||!t.hasTextData()||C.get("text-optional")),!0);!t.collisionArrays&&b&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(b);const ge=(ve,we,Ie)=>{for(let Ce=0;Ce<we/4;Ce++)ve.opacityVertexArray.emplaceBack(Ie);ve.hasVisibleVertices=ve.hasVisibleVertices||Ie!==Ca},me=this.collisionBoxArrays.get(t.bucketInstanceId);for(let ve=0;ve<t.symbolInstances.length;ve++){const we=t.symbolInstances.get(ve),{numHorizontalGlyphVertices:Ie,numVerticalGlyphVertices:Ce,crossTileID:ze}=we;let Ve=this.opacities[ze];m[ze]?Ve=O:Ve||(Ve=ae,this.opacities[ze]=Ve),m[ze]=!0;const Me=we.numIconVertices>0,Ye=this.placedOrientations[we.crossTileID],ct=Ye===c.ao.vertical,rt=Ye===c.ao.horizontal||Ye===c.ao.horizontalOnly;if(Ie>0||Ce>0){const lt=Fi(Ve.text);ge(t.text,Ie,ct?Ca:lt),ge(t.text,Ce,rt?Ca:lt);const Nt=Ve.text.isHidden();[we.rightJustifiedTextSymbolIndex,we.centerJustifiedTextSymbolIndex,we.leftJustifiedTextSymbolIndex].forEach((ln=>{ln>=0&&(t.text.placedSymbolArray.get(ln).hidden=Nt||ct?1:0)})),we.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(we.verticalPlacedTextSymbolIndex).hidden=Nt||rt?1:0);const Vt=this.variableOffsets[we.crossTileID];Vt&&this.markUsedJustification(t,Vt.anchor,we,Ye);const At=this.placedOrientations[we.crossTileID];At&&(this.markUsedJustification(t,"left",we,At),this.markUsedOrientation(t,At,we))}if(Me){const lt=Fi(Ve.icon),Nt=!(J&&we.verticalPlacedIconSymbolIndex&&ct);we.placedIconSymbolIndex>=0&&(ge(t.icon,we.numIconVertices,Nt?lt:Ca),t.icon.placedSymbolArray.get(we.placedIconSymbolIndex).hidden=Ve.icon.isHidden()),we.verticalPlacedIconSymbolIndex>=0&&(ge(t.icon,we.numVerticalIconVertices,Nt?Ca:lt),t.icon.placedSymbolArray.get(we.verticalPlacedIconSymbolIndex).hidden=Ve.icon.isHidden())}const st=me&&me.has(ve)?me.get(ve):{text:null,icon:null};if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const lt=t.collisionArrays[ve];if(lt){let Nt=new c.P(0,0);if(lt.textBox||lt.verticalTextBox){let Vt=!0;if(q){const At=this.variableOffsets[ze];At?(Nt=Us(At.anchor,At.width,At.height,At.textOffset,At.textBoxScale),W&&Nt._rotate(H?-this.transform.bearingInRadians:this.transform.bearingInRadians)):Vt=!1}if(lt.textBox||lt.verticalTextBox){let At;lt.textBox&&(At=ct),lt.verticalTextBox&&(At=rt),rl(t.textCollisionBox.collisionVertexArray,Ve.text.placed,!Vt||At,st.text,Nt.x,Nt.y)}}if(lt.iconBox||lt.verticalIconBox){const Vt=!!(!rt&&lt.verticalIconBox);let At;lt.iconBox&&(At=Vt),lt.verticalIconBox&&(At=!Vt),rl(t.iconCollisionBox.collisionVertexArray,Ve.icon.placed,At,st.icon,J?Nt.x:0,J?Nt.y:0)}}}}if(t.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);t.bucketInstanceId in this.collisionCircleArrays&&(t.collisionCircleArray=this.collisionCircleArrays[t.bucketInstanceId],delete this.collisionCircleArrays[t.bucketInstanceId])}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,u){const m=this.zoomAtLastRecencyCheck===u?1-this.zoomAdjustment(u):1;return this.zoomAtLastRecencyCheck=u,this.commitTime+this.fadeDuration*m>t}setStale(){this.stale=!0}}function rl(T,t,u,m,b,S){m&&m.length!==0||(m=[0,0,0,0]);const C=m[0]-Si,O=m[1]-Si,N=m[2]-Si,U=m[3]-Si;T.emplaceBack(t?1:0,u?1:0,b||0,S||0,C,O),T.emplaceBack(t?1:0,u?1:0,b||0,S||0,N,O),T.emplaceBack(t?1:0,u?1:0,b||0,S||0,N,U),T.emplaceBack(t?1:0,u?1:0,b||0,S||0,C,U)}const ni=Math.pow(2,25),ci=Math.pow(2,24),qi=Math.pow(2,17),br=Math.pow(2,16),qs=Math.pow(2,9),cu=Math.pow(2,8),on=Math.pow(2,1);function Fi(T){if(T.opacity===0&&!T.placed)return 0;if(T.opacity===1&&T.placed)return 4294967295;const t=T.placed?1:0,u=Math.floor(127*T.opacity);return u*ni+t*ci+u*qi+t*br+u*qs+t*cu+u*on+t}const Ca=0;class oo{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,u,m,b,S){const C=this._bucketParts;for(;this._currentTileIndex<t.length;)if(u.getBucketParts(C,b,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,S())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,C.sort(((O,N)=>O.sortKey-N.sortKey)));this._currentPartIndex<C.length;)if(u.placeLayerBucketPart(C[this._currentPartIndex],this._seenCrossTileIDs,m),this._currentPartIndex++,S())return!0;return!1}}class ir{constructor(t,u,m,b,S,C,O,N){this.placement=new $s(t,u,C,O,N),this._currentPlacementIndex=m.length-1,this._forceFullPlacement=b,this._showCollisionBoxes=S,this._done=!1}isDone(){return this._done}continuePlacement(t,u,m){const b=ee.now(),S=()=>!this._forceFullPlacement&&ee.now()-b>2;for(;this._currentPlacementIndex>=0;){const C=u[t[this._currentPlacementIndex]],O=this.placement.collisionIndex.transform.zoom;if(C.type==="symbol"&&(!C.minzoom||C.minzoom<=O)&&(!C.maxzoom||C.maxzoom>O)){if(this._inProgressLayer||(this._inProgressLayer=new oo(C)),this._inProgressLayer.continuePlacement(m[C.source],this.placement,this._showCollisionBoxes,C,S))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const Mo=512/c.$/2;class Rl{constructor(t,u,m){this.tileID=t,this.bucketInstanceId=m,this._symbolsByKey={};const b=new Map;for(let S=0;S<u.length;S++){const C=u.get(S),O=C.key,N=b.get(O);N?N.push(C):b.set(O,[C])}for(const[S,C]of b){const O={positions:C.map((N=>({x:Math.floor(N.anchorX*Mo),y:Math.floor(N.anchorY*Mo)}))),crossTileIDs:C.map((N=>N.crossTileID))};if(O.positions.length>128){const N=new c.aI(O.positions.length,16,Uint16Array);for(const{x:U,y:q}of O.positions)N.add(U,q);N.finish(),delete O.positions,O.index=N}this._symbolsByKey[S]=O}}getScaledCoordinates(t,u){const{x:m,y:b,z:S}=this.tileID.canonical,{x:C,y:O,z:N}=u.canonical,U=Mo/Math.pow(2,N-S),q=(O*c.$+t.anchorY)*U,W=b*c.$*Mo;return{x:Math.floor((C*c.$+t.anchorX)*U-m*c.$*Mo),y:Math.floor(q-W)}}findMatches(t,u,m){const b=this.tileID.canonical.z<u.canonical.z?1:Math.pow(2,this.tileID.canonical.z-u.canonical.z);for(let S=0;S<t.length;S++){const C=t.get(S);if(C.crossTileID)continue;const O=this._symbolsByKey[C.key];if(!O)continue;const N=this.getScaledCoordinates(C,u);if(O.index){const U=O.index.range(N.x-b,N.y-b,N.x+b,N.y+b).sort();for(const q of U){const W=O.crossTileIDs[q];if(!m[W]){m[W]=!0,C.crossTileID=W;break}}}else if(O.positions)for(let U=0;U<O.positions.length;U++){const q=O.positions[U],W=O.crossTileIDs[U];if(Math.abs(q.x-N.x)<=b&&Math.abs(q.y-N.y)<=b&&!m[W]){m[W]=!0,C.crossTileID=W;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map((({crossTileIDs:t})=>t))}}class Gs{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class rr{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const u=Math.round((t-this.lng)/360);if(u!==0)for(const m in this.indexes){const b=this.indexes[m],S={};for(const C in b){const O=b[C];O.tileID=O.tileID.unwrapTo(O.tileID.wrap+u),S[O.tileID.key]=O}this.indexes[m]=S}this.lng=t}addBucket(t,u,m){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===u.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let S=0;S<u.symbolInstances.length;S++)u.symbolInstances.get(S).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const b=this.usedCrossTileIDs[t.overscaledZ];for(const S in this.indexes){const C=this.indexes[S];if(Number(S)>t.overscaledZ)for(const O in C){const N=C[O];N.tileID.isChildOf(t)&&N.findMatches(u.symbolInstances,t,b)}else{const O=C[t.scaledTo(Number(S)).key];O&&O.findMatches(u.symbolInstances,t,b)}}for(let S=0;S<u.symbolInstances.length;S++){const C=u.symbolInstances.get(S);C.crossTileID||(C.crossTileID=m.generate(),b[C.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Rl(t,u.symbolInstances,u.bucketInstanceId),!0}removeBucketCrossTileIDs(t,u){for(const m of u.getCrossTileIDsLists())for(const b of m)delete this.usedCrossTileIDs[t][b]}removeStaleBuckets(t){let u=!1;for(const m in this.indexes){const b=this.indexes[m];for(const S in b)t[b[S].bucketInstanceId]||(this.removeBucketCrossTileIDs(m,b[S]),delete b[S],u=!0)}return u}}class Qa{constructor(){this.layerIndexes={},this.crossTileIDs=new Gs,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,u,m){let b=this.layerIndexes[t.id];b===void 0&&(b=this.layerIndexes[t.id]=new rr);let S=!1;const C={};b.handleWrapJump(m);for(const O of u){const N=O.getBucket(t);N&&t.id===N.layerIds[0]&&(N.bucketInstanceId||(N.bucketInstanceId=++this.maxBucketInstanceId),b.addBucket(O.tileID,N,this.crossTileIDs)&&(S=!0),C[N.bucketInstanceId]=!0)}return b.removeStaleBuckets(C)&&(S=!0),S}pruneUnusedLayers(t){const u={};t.forEach((m=>{u[m]=!0}));for(const m in this.layerIndexes)u[m]||delete this.layerIndexes[m]}}var Ua="void main() {fragColor=vec4(1.0);}";const Gi={prelude:jn(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:jn("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:jn("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:jn(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:jn(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:jn(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:jn(Ua,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:jn(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:jn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:jn("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:jn("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:jn(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:jn("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:jn(Ua,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:jn(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:jn(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:jn(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:jn(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:jn(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:jn(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:jn(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:jn(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:jn(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:jn(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:jn(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:jn(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:jn(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:jn(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:jn(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:jn(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:jn("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:jn("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:jn("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:jn("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:jn(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:jn("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function jn(T,t){const u=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,m=t.match(/in ([\w]+) ([\w]+)/g),b=T.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),S=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),C=S?S.concat(b):b,O={};return{fragmentSource:T=T.replace(u,((N,U,q,W,H)=>(O[H]=!0,U==="define"?`
#ifndef HAS_UNIFORM_u_${H}
in ${q} ${W} ${H};
#else
uniform ${q} ${W} u_${H};
#endif
`:`
#ifdef HAS_UNIFORM_u_${H}
    ${q} ${W} ${H} = u_${H};
#endif
`))),vertexSource:t=t.replace(u,((N,U,q,W,H)=>{const J=W==="float"?"vec2":"vec4",ae=H.match(/color/)?"color":J;return O[H]?U==="define"?`
#ifndef HAS_UNIFORM_u_${H}
uniform lowp float u_${H}_t;
in ${q} ${J} a_${H};
out ${q} ${W} ${H};
#else
uniform ${q} ${W} u_${H};
#endif
`:ae==="vec4"?`
#ifndef HAS_UNIFORM_u_${H}
    ${H} = a_${H};
#else
    ${q} ${W} ${H} = u_${H};
#endif
`:`
#ifndef HAS_UNIFORM_u_${H}
    ${H} = unpack_mix_${ae}(a_${H}, u_${H}_t);
#else
    ${q} ${W} ${H} = u_${H};
#endif
`:U==="define"?`
#ifndef HAS_UNIFORM_u_${H}
uniform lowp float u_${H}_t;
in ${q} ${J} a_${H};
#else
uniform ${q} ${W} u_${H};
#endif
`:ae==="vec4"?`
#ifndef HAS_UNIFORM_u_${H}
    ${q} ${W} ${H} = a_${H};
#else
    ${q} ${W} ${H} = u_${H};
#endif
`:`
#ifndef HAS_UNIFORM_u_${H}
    ${q} ${W} ${H} = unpack_mix_${ae}(a_${H}, u_${H}_t);
#else
    ${q} ${W} ${H} = u_${H};
#endif
`})),staticAttributes:m,staticUniforms:C}}class Ja{constructor(t,u,m){this.vertexBuffer=t,this.indexBuffer=u,this.segments=m}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var _s=c.aJ([{name:"a_pos",type:"Int16",components:2}]);const $a="#define PROJECTION_MERCATOR",Zs="mercator";class Ln{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return Zs}get shaderDefine(){return $a}get shaderPreludeCode(){return Gi.projectionMercator}get vertexShaderPreludeCode(){return Gi.projectionMercator.vertexSource}get subdivisionGranularity(){return c.aK.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(t){}getMeshFromTileID(t,u,m,b,S){if(this._cachedMesh)return this._cachedMesh;const C=new c.aL;C.emplaceBack(0,0),C.emplaceBack(c.$,0),C.emplaceBack(0,c.$),C.emplaceBack(c.$,c.$);const O=t.createVertexBuffer(C,_s.members),N=c.aM.simpleSegment(0,0,4,2),U=new c.aN;U.emplaceBack(1,0,2),U.emplaceBack(1,2,3);const q=t.createIndexBuffer(U);return this._cachedMesh=new Ja(O,q,N),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(t){}}class ys{constructor(t=0,u=0,m=0,b=0){if(isNaN(t)||t<0||isNaN(u)||u<0||isNaN(m)||m<0||isNaN(b)||b<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=u,this.left=m,this.right=b}interpolate(t,u,m){return u.top!=null&&t.top!=null&&(this.top=c.C.number(t.top,u.top,m)),u.bottom!=null&&t.bottom!=null&&(this.bottom=c.C.number(t.bottom,u.bottom,m)),u.left!=null&&t.left!=null&&(this.left=c.C.number(t.left,u.left,m)),u.right!=null&&t.right!=null&&(this.right=c.C.number(t.right,u.right,m)),this}getCenter(t,u){const m=c.ah((this.left+t-this.right)/2,0,t),b=c.ah((this.top+u-this.bottom)/2,0,u);return new c.P(m,b)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new ys(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Ma(T,t){if(!T.renderWorldCopies||T.lngRange)return;const u=t.lng-T.center.lng;t.lng+=u>180?-360:u<-180?360:0}function Ll(T){return Math.max(0,Math.floor(T))}class Zi{constructor(t,u,m,b,S,C){this._callbacks=t,this._tileSize=512,this._renderWorldCopies=C===void 0||!!C,this._minZoom=u||0,this._maxZoom=m||22,this._minPitch=b??0,this._maxPitch=S??60,this.setMaxBounds(),this._width=0,this._height=0,this._center=new c.S(0,0),this._elevation=0,this._zoom=0,this._tileZoom=Ll(this._zoom),this._scale=c.af(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new ys,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(t,u,m){this._latRange=t.latRange,this._lngRange=t.lngRange,this._width=t.width,this._height=t.height,this._center=t.center,this._elevation=t.elevation,this._minElevationForCurrentTile=t.minElevationForCurrentTile,this._zoom=t.zoom,this._tileZoom=Ll(this._zoom),this._scale=c.af(this._zoom),this._bearingInRadians=t.bearingInRadians,this._fovInRadians=t.fovInRadians,this._pitchInRadians=t.pitchInRadians,this._rollInRadians=t.rollInRadians,this._unmodified=t.unmodified,this._edgeInsets=new ys(t.padding.top,t.padding.bottom,t.padding.left,t.padding.right),this._minZoom=t.minZoom,this._maxZoom=t.maxZoom,this._minPitch=t.minPitch,this._maxPitch=t.maxPitch,this._renderWorldCopies=t.renderWorldCopies,this._cameraToCenterDistance=t.cameraToCenterDistance,this._nearZ=t.nearZ,this._farZ=t.farZ,this._autoCalculateNearFarZ=!m&&t.autoCalculateNearFarZ,u&&this._constrain(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(t){this._minElevationForCurrentTile=t}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(t){this._minZoom!==t&&(this._minZoom=t,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(t){this._minPitch!==t&&(this._minPitch=t,this.setPitch(Math.max(this.pitch,t)))}get maxPitch(){return this._maxPitch}setMaxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.setPitch(Math.min(this.pitch,t)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new c.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(t){const u=c.aO(t,-180,180)*Math.PI/180;var m,b,S,C,O,N,U,q,W;this._bearingInRadians!==u&&(this._unmodified=!1,this._bearingInRadians=u,this._calcMatrices(),this._rotationMatrix=k(),m=this._rotationMatrix,S=-this._bearingInRadians,C=(b=this._rotationMatrix)[0],O=b[1],N=b[2],U=b[3],q=Math.sin(S),W=Math.cos(S),m[0]=C*W+N*q,m[1]=O*W+U*q,m[2]=C*-q+N*W,m[3]=O*-q+U*W)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(t){const u=c.ah(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==u&&(this._unmodified=!1,this._pitchInRadians=u,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(t){const u=t/180*Math.PI;this._rollInRadians!==u&&(this._unmodified=!1,this._rollInRadians=u,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return c.aP(this._fovInRadians)}setFov(t){t=c.ah(t,.1,150),this.fov!==t&&(this._unmodified=!1,this._fovInRadians=c.ae(t),this._calcMatrices())}get zoom(){return this._zoom}setZoom(t){const u=this.getConstrained(this._center,t).zoom;this._zoom!==u&&(this._unmodified=!1,this._zoom=u,this._tileZoom=Math.max(0,Math.floor(u)),this._scale=c.af(u),this._constrain(),this._calcMatrices())}get center(){return this._center}setCenter(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(t){t!==this._elevation&&(this._elevation=t,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(t,u){this._autoCalculateNearFarZ=!1,this._nearZ=t,this._farZ=u,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,u,m){this._unmodified=!1,this._edgeInsets.interpolate(t,u,m),this._constrain(),this._calcMatrices()}resize(t,u,m=!0){this._width=t,this._height=u,m&&this._constrain(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new Ni([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(t){t?(this._lngRange=[t.getWest(),t.getEast()],this._latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this._lngRange=null,this._latRange=[-c.ai,c.ai])}getConstrained(t,u){return this._callbacks.getConstrained(t,u)}getCameraQueryGeometry(t,u){if(u.length===1)return[u[0],t];{const{minX:m,minY:b,maxX:S,maxY:C}=c.a2.fromPoints(u).extend(t);return[new c.P(m,b),new c.P(S,b),new c.P(S,C),new c.P(m,C),new c.P(m,b)]}}_constrain(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const t=this._unmodified,{center:u,zoom:m}=this.getConstrained(this.center,this.zoom);this.setCenter(u),this.setZoom(m),this._unmodified=t,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let t=c.ag(new Float64Array(16));c.N(t,t,[this._width/2,-this._height/2,1]),c.M(t,t,[1,-1,0]),this._clipSpaceToPixelsMatrix=t,t=c.ag(new Float64Array(16)),c.N(t,t,[1,-1,1]),c.M(t,t,[-1,-1,0]),c.N(t,t,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=t,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(t,u,m,b){const S=m!==void 0?m:this.bearing,C=b=b!==void 0?b:this.pitch,O=c.a1.fromLngLat(t,u),N=-Math.cos(c.ae(C)),U=Math.sin(c.ae(C)),q=U*Math.sin(c.ae(S)),W=-U*Math.cos(c.ae(S));let H=this.elevation;const J=u-H;let ae;N*J>=0||Math.abs(N)<.1?(ae=1e4,H=u+ae*N):ae=-J/N;let ge,me,ve=c.aQ(1,O.y),we=0;do{if(we+=1,we>10)break;me=ae/ve,ge=new c.a1(O.x+q*me,O.y+W*me),ve=1/ge.meterInMercatorCoordinateUnits()}while(Math.abs(ae-me*ve)>1e-12);return{center:ge.toLngLat(),elevation:H,zoom:c.ak(this.height/2/Math.tan(this.fovInRadians/2)/me/this.tileSize)}}recalculateZoomAndCenter(t){if(this.elevation-t==0)return;const u=c.aj(1,this.center.lat)*this.worldSize,m=this.cameraToCenterDistance/u,b=c.a1.fromLngLat(this.center,this.elevation),S=et(this.center,this.elevation,this.pitch,this.bearing,m);this._elevation=t;const C=this.calculateCenterFromCameraLngLatAlt(S.toLngLat(),c.aQ(S.z,b.y),this.bearing,this.pitch);this._elevation=C.elevation,this._center=C.center,this.setZoom(C.zoom)}getCameraPoint(){const t=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new c.P(t*Math.sin(this.rollInRadians),t*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const t=c.aj(1,this.center.lat)*this.worldSize;return et(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/t).toLngLat()}getMercatorTileCoordinates(t){if(!t)return[0,0,1,1];const u=t.canonical.z>=0?1<<t.canonical.z:Math.pow(2,t.canonical.z);return[t.canonical.x/u,t.canonical.y/u,1/u/c.$,1/u/c.$]}}class pr{constructor(t,u){this.min=t,this.max=u,this.center=c.aR([],c.aS([],this.min,this.max),.5)}quadrant(t){const u=[t%2==0,t<2],m=c.aT(this.min),b=c.aT(this.max);for(let S=0;S<u.length;S++)m[S]=u[S]?this.min[S]:this.center[S],b[S]=u[S]?this.center[S]:this.max[S];return b[2]=this.max[2],new pr(m,b)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersectsFrustum(t){let u=!0;for(let m=0;m<t.planes.length;m++){const b=this.intersectsPlane(t.planes[m]);if(b===0)return 0;b===1&&(u=!1)}return u?2:t.aabb.min[0]>this.max[0]||t.aabb.min[1]>this.max[1]||t.aabb.min[2]>this.max[2]||t.aabb.max[0]<this.min[0]||t.aabb.max[1]<this.min[1]||t.aabb.max[2]<this.min[2]?0:1}intersectsPlane(t){let u=t[3],m=t[3];for(let b=0;b<3;b++)t[b]>0?(u+=t[b]*this.min[b],m+=t[b]*this.max[b]):(m+=t[b]*this.min[b],u+=t[b]*this.max[b]);return u>=0?2:m<0?0:1}}class hn{distanceToTile2d(t,u,m,b){const S=b.distanceX([t,u]),C=b.distanceY([t,u]);return Math.hypot(S,C)}getWrap(t,u,m){return m}getTileBoundingVolume(t,u,m,b){var S,C;let O=0,N=0;if(b!=null&&b.terrain){const q=new c.Z(t.z,u,t.z,t.x,t.y),W=b.terrain.getMinMaxElevation(q);O=(S=W.minElevation)!==null&&S!==void 0?S:Math.min(0,m),N=(C=W.maxElevation)!==null&&C!==void 0?C:Math.max(0,m)}const U=1<<t.z;return new pr([u+t.x/U,t.y/U,O],[u+(t.x+1)/U,(t.y+1)/U,N])}allowVariableZoom(t,u){const m=t.fov*(Math.abs(Math.cos(t.rollInRadians))*t.height+Math.abs(Math.sin(t.rollInRadians))*t.width)/t.height,b=c.ah(78.5-m/2,0,60);return!!u.terrain||t.pitch>b}allowWorldCopies(){return!0}prepareNextFrame(){}}class fi{constructor(t,u,m){this.points=t,this.planes=u,this.aabb=m}static fromInvProjectionMatrix(t,u=1,m=0,b,S){const C=S?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],O=Math.pow(2,m),N=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((H=>(function(J,ae,ge,me){const ve=c.aw([],J,ae),we=1/ve[3]/ge*me;return c.aY(ve,ve,[we,we,1/ve[3],we])})(H,t,u,O)));b&&(function(H,J,ae,ge){const me=ge?4:0,ve=ge?0:4;let we=0;const Ie=[],Ce=[];for(let Me=0;Me<4;Me++){const Ye=c.aU([],H[Me+ve],H[Me+me]),ct=c.aZ(Ye);c.aR(Ye,Ye,1/ct),Ie.push(ct),Ce.push(Ye)}for(let Me=0;Me<4;Me++){const Ye=c.a_(H[Me+me],Ce[Me],ae);we=Ye!==null&&Ye>=0?Math.max(we,Ye):Math.max(we,Ie[Me])}const ze=(function(Me,Ye){const ct=c.aU([],Me[Ye[0]],Me[Ye[1]]),rt=c.aU([],Me[Ye[2]],Me[Ye[1]]),st=[0,0,0,0];return c.aV(st,c.aW([],ct,rt)),st[3]=-c.aX(st,Me[Ye[0]]),st})(H,J),Ve=(function(Me,Ye){const ct=c.a$(Me),rt=c.b0([],Me,1/ct),st=c.aU([],Ye,c.aR([],rt,c.aX(Ye,rt))),lt=c.a$(st);if(lt>0){const Nt=Math.sqrt(1-rt[3]*rt[3]),Vt=c.aR([],rt,-rt[3]),At=c.aS([],Vt,c.aR([],st,Nt/lt));return c.b1(Ye,At)}return null})(ae,ze);if(Ve!==null){const Me=Ve/c.aX(Ce[0],ze);we=Math.min(we,Me)}for(let Me=0;Me<4;Me++){const Ye=Math.min(we,Ie[Me]);H[Me+ve]=[H[Me+me][0]+Ce[Me][0]*Ye,H[Me+me][1]+Ce[Me][1]*Ye,H[Me+me][2]+Ce[Me][2]*Ye,1]}})(N,C[0],b,S);const U=C.map((H=>{const J=c.aU([],N[H[0]],N[H[1]]),ae=c.aU([],N[H[2]],N[H[1]]),ge=c.aV([],c.aW([],J,ae)),me=-c.aX(ge,N[H[1]]);return ge.concat(me)})),q=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],W=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const H of N)for(let J=0;J<3;J++)q[J]=Math.min(q[J],H[J]),W[J]=Math.max(W[J],H[J]);return new fi(N,U,new pr(q,W))}}class xn{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,u,m){return this._helper.interpolatePadding(t,u,m)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,u,m=!0){this._helper.resize(t,u,m)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}overrideNearFarZ(t,u){this._helper.overrideNearFarZ(t,u)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(t,u){}constructor(t,u,m,b,S){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this._helper=new Zi({calcMatrices:()=>{this._calcMatrices()},getConstrained:(C,O)=>this.getConstrained(C,O)},t,u,m,b,S),this._coveringTilesDetailsProvider=new hn}clone(){const t=new xn;return t.apply(this),t}apply(t,u,m){this._helper.apply(t,u,m)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(t){const u=[new c.b2(0,t)];if(this._helper._renderWorldCopies){const m=this.screenPointToMercatorCoordinate(new c.P(0,0)),b=this.screenPointToMercatorCoordinate(new c.P(this._helper._width,0)),S=this.screenPointToMercatorCoordinate(new c.P(this._helper._width,this._helper._height)),C=this.screenPointToMercatorCoordinate(new c.P(0,this._helper._height)),O=Math.floor(Math.min(m.x,b.x,S.x,C.x)),N=Math.floor(Math.max(m.x,b.x,S.x,C.x)),U=1;for(let q=O-U;q<=N+U;q++)q!==0&&u.push(new c.b2(q,t))}return u}getCameraFrustum(){return fi.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(t){const u=this.screenPointToLocation(this.centerPoint,t),m=t?t.getElevationForLngLatZoom(u,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(m)}setLocationAtPoint(t,u){const m=c.aj(this.elevation,this.center.lat),b=this.screenPointToMercatorCoordinateAtZ(u,m),S=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,m),C=c.a1.fromLngLat(t),O=new c.a1(C.x-(b.x-S.x),C.y-(b.y-S.y));this.setCenter(O==null?void 0:O.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(t,u){return u?this.coordinatePoint(c.a1.fromLngLat(t),u.getElevationForLngLatZoom(t,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(c.a1.fromLngLat(t))}screenPointToLocation(t,u){var m;return(m=this.screenPointToMercatorCoordinate(t,u))===null||m===void 0?void 0:m.toLngLat()}screenPointToMercatorCoordinate(t,u){if(u){const m=u.pointCoordinate(t);if(m!=null)return m}return this.screenPointToMercatorCoordinateAtZ(t)}screenPointToMercatorCoordinateAtZ(t,u){const m=u||0,b=[t.x,t.y,0,1],S=[t.x,t.y,1,1];c.aw(b,b,this._pixelMatrixInverse),c.aw(S,S,this._pixelMatrixInverse);const C=b[3],O=S[3],N=b[1]/C,U=S[1]/O,q=b[2]/C,W=S[2]/O,H=q===W?0:(m-q)/(W-q);return new c.a1(c.C.number(b[0]/C,S[0]/O,H)/this.worldSize,c.C.number(N,U,H)/this.worldSize,m)}coordinatePoint(t,u=0,m=this._pixelMatrix){const b=[t.x*this.worldSize,t.y*this.worldSize,u,1];return c.aw(b,b,m),new c.P(b[0]/b[3],b[1]/b[3])}getBounds(){const t=Math.max(0,this._helper._height/2-De(this));return new Ni().extend(this.screenPointToLocation(new c.P(0,t))).extend(this.screenPointToLocation(new c.P(this._helper._width,t))).extend(this.screenPointToLocation(new c.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new c.P(0,this._helper._height)))}isPointOnMapSurface(t,u){return u?u.pointCoordinate(t)!=null:t.y>this.height/2-De(this)}calculatePosMatrix(t,u=!1,m){var b;const S=(b=t.key)!==null&&b!==void 0?b:c.b3(t.wrap,t.canonical.z,t.canonical.z,t.canonical.x,t.canonical.y),C=u?this._alignedPosMatrixCache:this._posMatrixCache;if(C.has(S)){const U=C.get(S);return m?U.f32:U.f64}const O=Ze(t,this.worldSize);c.O(O,u?this._alignedProjMatrix:this._viewProjMatrix,O);const N={f64:O,f32:new Float32Array(O)};return C.set(S,N),m?N.f32:N.f64}calculateFogMatrix(t){const u=t.key,m=this._fogMatrixCacheF32;if(m.has(u))return m.get(u);const b=Ze(t,this.worldSize);return c.O(b,this._fogMatrix,b),m.set(u,new Float32Array(b)),m.get(u)}getConstrained(t,u){u=c.ah(+u,this.minZoom,this.maxZoom);const m={center:new c.S(t.lng,t.lat),zoom:u};let b=this._helper._lngRange;if(!this._helper._renderWorldCopies&&b===null){const Ie=179.9999999999;b=[-Ie,Ie]}const S=this.tileSize*c.af(m.zoom);let C=0,O=S,N=0,U=S,q=0,W=0;const{x:H,y:J}=this.size;if(this._helper._latRange){const Ie=this._helper._latRange;C=c.U(Ie[1])*S,O=c.U(Ie[0])*S,O-C<J&&(q=J/(O-C))}b&&(N=c.aO(c.V(b[0])*S,0,S),U=c.aO(c.V(b[1])*S,0,S),U<N&&(U+=S),U-N<H&&(W=H/(U-N)));const{x:ae,y:ge}=fe(S,t);let me,ve;const we=Math.max(W||0,q||0);if(we){const Ie=new c.P(W?(U+N)/2:ae,q?(O+C)/2:ge);return m.center=Se(S,Ie).wrap(),m.zoom+=c.ak(we),m}if(this._helper._latRange){const Ie=J/2;ge-Ie<C&&(ve=C+Ie),ge+Ie>O&&(ve=O-Ie)}if(b){const Ie=(N+U)/2;let Ce=ae;this._helper._renderWorldCopies&&(Ce=c.aO(ae,Ie-S/2,Ie+S/2));const ze=H/2;Ce-ze<N&&(me=N+ze),Ce+ze>U&&(me=U-ze)}if(me!==void 0||ve!==void 0){const Ie=new c.P(me??ae,ve??ge);m.center=Se(S,Ie).wrap()}return m}calculateCenterFromCameraLngLatAlt(t,u,m,b){return this._helper.calculateCenterFromCameraLngLatAlt(t,u,m,b)}_calculateNearFarZIfNeeded(t,u,m){if(!this._helper.autoCalculateNearFarZ)return;const b=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),S=t-b*this._helper._pixelPerMeter/Math.cos(u),C=b<0?S:t,O=Math.PI/2+this.pitchInRadians,N=c.ae(this.fov)*(Math.abs(Math.cos(c.ae(this.roll)))*this.height+Math.abs(Math.sin(c.ae(this.roll)))*this.width)/this.height*(.5+m.y/this.height),U=Math.sin(N)*C/Math.sin(c.ah(Math.PI-O-N,.01,Math.PI-.01)),q=De(this),W=Math.atan(q/this._helper.cameraToCenterDistance),H=c.ae(.75),J=W>H?2*W*(.5+m.y/(2*q)):H,ae=Math.sin(J)*C/Math.sin(c.ah(Math.PI-O-J,.01,Math.PI-.01)),ge=Math.min(U,ae);this._helper._farZ=1.01*(Math.cos(Math.PI/2-u)*ge+C),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const t=this.centerOffset,u=fe(this.worldSize,this.center),m=u.x,b=u.y;this._helper._pixelPerMeter=c.aj(1,this.center.lat)*this.worldSize;const S=c.ae(Math.min(this.pitch,le)),C=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(S));let O;this._calculateNearFarZIfNeeded(C,S,t),O=new Float64Array(16),c.b4(O,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),c.aq(this._invProjMatrix,O),O[8]=2*-t.x/this._helper._width,O[9]=2*t.y/this._helper._height,this._projectionMatrix=c.b5(O),c.N(O,O,[1,-1,1]),c.M(O,O,[0,0,-this._helper.cameraToCenterDistance]),c.b6(O,O,-this.rollInRadians),c.b7(O,O,this.pitchInRadians),c.b6(O,O,-this.bearingInRadians),c.M(O,O,[-m,-b,0]),this._mercatorMatrix=c.N([],O,[this.worldSize,this.worldSize,this.worldSize]),c.N(O,O,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=c.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,O),c.M(O,O,[0,0,-this.elevation]),this._viewProjMatrix=O,this._invViewProjMatrix=c.aq([],O);const N=[0,0,-1,1];c.aw(N,N,this._invViewProjMatrix),this._cameraPosition=[N[0]/N[3],N[1]/N[3],N[2]/N[3]],this._fogMatrix=new Float64Array(16),c.b4(this._fogMatrix,this.fovInRadians,this.width/this.height,C,this._helper._farZ),this._fogMatrix[8]=2*-t.x/this.width,this._fogMatrix[9]=2*t.y/this.height,c.N(this._fogMatrix,this._fogMatrix,[1,-1,1]),c.M(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),c.b6(this._fogMatrix,this._fogMatrix,-this.rollInRadians),c.b7(this._fogMatrix,this._fogMatrix,this.pitchInRadians),c.b6(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),c.M(this._fogMatrix,this._fogMatrix,[-m,-b,0]),c.N(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),c.M(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=c.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,O);const U=this._helper._width%2/2,q=this._helper._height%2/2,W=Math.cos(this.bearingInRadians),H=Math.sin(-this.bearingInRadians),J=m-Math.round(m)+W*U+H*q,ae=b-Math.round(b)+W*q+H*U,ge=new Float64Array(O);if(c.M(ge,ge,[J>.5?J-1:J,ae>.5?ae-1:ae,0]),this._alignedProjMatrix=ge,O=c.aq(new Float64Array(16),this._pixelMatrix),!O)throw new Error("failed to invert matrix");this._pixelMatrixInverse=O,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const t=this.screenPointToMercatorCoordinate(new c.P(0,0)),u=[t.x*this.worldSize,t.y*this.worldSize,0,1];return c.aw(u,u,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const t=c.aj(1,this.center.lat)*this.worldSize;return et(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/t).toLngLat()}lngLatToCameraDepth(t,u){const m=c.a1.fromLngLat(t),b=[m.x*this.worldSize,m.y*this.worldSize,u,1];return c.aw(b,b,this._viewProjMatrix),b[2]/b[3]}getProjectionData(t){const{overscaledTileID:u,aligned:m,applyTerrainMatrix:b}=t,S=this._helper.getMercatorTileCoordinates(u),C=u?this.calculatePosMatrix(u,m,!0):null;let O;return O=u&&u.terrainRttPosMatrix32f&&b?u.terrainRttPosMatrix32f:C||c.b8(),{mainMatrix:O,tileMercatorCoords:S,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:O}}isLocationOccluded(t){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(t,u,m){return 1}transformLightDirection(t){return c.aT(t)}getRayDirectionFromPixel(t){throw new Error("Not implemented.")}projectTileCoordinates(t,u,m,b){const S=this.calculatePosMatrix(m);let C;b?(C=[t,u,b(t,u),1],c.aw(C,C,S)):(C=[t,u,0,1],Gr(C,C,S));const O=C[3];return{point:new c.P(C[0]/O,C[1]/O),signedDistanceFromCamera:O,isOccluded:!1}}populateCache(t){for(const u of t)this.calculatePosMatrix(u)}getMatrixForModel(t,u){const m=c.a1.fromLngLat(t,u),b=m.meterInMercatorCoordinateUnits(),S=c.b9();return c.M(S,S,[m.x,m.y,m.z]),c.b6(S,S,Math.PI),c.b7(S,S,Math.PI/2),c.N(S,S,[-b,b,b]),S}getProjectionDataForCustomLayer(t=!0){const u=new c.Z(0,0,0,0,0),m=this.getProjectionData({overscaledTileID:u,applyGlobeMatrix:t}),b=Ze(u,this.worldSize);c.O(b,this._viewProjMatrix,b),m.tileMercatorCoords=[0,0,1,1];const S=[c.$,c.$,this.worldSize/this._helper.pixelsPerMeter],C=c.ba();return c.N(C,b,S),m.fallbackMatrix=C,m.mainMatrix=C,m}getFastPathSimpleProjectionMatrix(t){return this.calculatePosMatrix(t)}}function al(){c.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function ar(T){if(T.useSlerp)if(T.k<1){const t=c.bb(T.startEulerAngles.roll,T.startEulerAngles.pitch,T.startEulerAngles.bearing),u=c.bb(T.endEulerAngles.roll,T.endEulerAngles.pitch,T.endEulerAngles.bearing),m=new Float64Array(4);c.bc(m,t,u,T.k);const b=c.bd(m);T.tr.setRoll(b.roll),T.tr.setPitch(b.pitch),T.tr.setBearing(b.bearing)}else T.tr.setRoll(T.endEulerAngles.roll),T.tr.setPitch(T.endEulerAngles.pitch),T.tr.setBearing(T.endEulerAngles.bearing);else T.tr.setRoll(c.C.number(T.startEulerAngles.roll,T.endEulerAngles.roll,T.k)),T.tr.setPitch(c.C.number(T.startEulerAngles.pitch,T.endEulerAngles.pitch,T.k)),T.tr.setBearing(c.C.number(T.startEulerAngles.bearing,T.endEulerAngles.bearing,T.k))}function ur(T,t,u,m,b){const S=b.padding,C=fe(b.worldSize,u.getNorthWest()),O=fe(b.worldSize,u.getNorthEast()),N=fe(b.worldSize,u.getSouthEast()),U=fe(b.worldSize,u.getSouthWest()),q=c.ae(-m),W=C.rotate(q),H=O.rotate(q),J=N.rotate(q),ae=U.rotate(q),ge=new c.P(Math.max(W.x,H.x,ae.x,J.x),Math.max(W.y,H.y,ae.y,J.y)),me=new c.P(Math.min(W.x,H.x,ae.x,J.x),Math.min(W.y,H.y,ae.y,J.y)),ve=ge.sub(me),we=(b.width-(S.left+S.right+t.left+t.right))/ve.x,Ie=(b.height-(S.top+S.bottom+t.top+t.bottom))/ve.y;if(Ie<0||we<0)return void al();const Ce=Math.min(c.ak(b.scale*Math.min(we,Ie)),T.maxZoom),ze=c.P.convert(T.offset),Ve=new c.P((t.left-t.right)/2,(t.top-t.bottom)/2).rotate(c.ae(m)),Me=ze.add(Ve).mult(b.scale/c.af(Ce));return{center:Se(b.worldSize,C.add(N).div(2).sub(Me)),zoom:Ce,bearing:m}}class xr{get useGlobeControls(){return!1}handlePanInertia(t,u){return{easingOffset:t,easingCenter:u.center}}handleMapControlsRollPitchBearingZoom(t,u){t.bearingDelta&&u.setBearing(u.bearing+t.bearingDelta),t.pitchDelta&&u.setPitch(u.pitch+t.pitchDelta),t.rollDelta&&u.setRoll(u.roll+t.rollDelta),t.zoomDelta&&u.setZoom(u.zoom+t.zoomDelta)}handleMapControlsPan(t,u,m){t.around.distSqr(u.centerPoint)<.01||u.setLocationAtPoint(m,t.around)}cameraForBoxAndBearing(t,u,m,b,S){return ur(t,u,m,b,S)}handleJumpToCenterZoom(t,u){t.zoom!==(u.zoom!==void 0?+u.zoom:t.zoom)&&t.setZoom(+u.zoom),u.center!==void 0&&t.setCenter(c.S.convert(u.center))}handleEaseTo(t,u){const m=t.zoom,b=t.padding,S={roll:t.roll,pitch:t.pitch,bearing:t.bearing},C={roll:u.roll===void 0?t.roll:u.roll,pitch:u.pitch===void 0?t.pitch:u.pitch,bearing:u.bearing===void 0?t.bearing:u.bearing},O=u.zoom!==void 0,N=!t.isPaddingEqual(u.padding);let U=!1;const q=O?+u.zoom:t.zoom;let W=t.centerPoint.add(u.offsetAsPoint);const H=t.screenPointToLocation(W),{center:J,zoom:ae}=t.getConstrained(c.S.convert(u.center||H),q??m);Ma(t,J);const ge=fe(t.worldSize,H),me=fe(t.worldSize,J).sub(ge),ve=c.af(ae-m);return U=ae!==m,{easeFunc:we=>{if(U&&t.setZoom(c.C.number(m,ae,we)),c.be(S,C)||ar({startEulerAngles:S,endEulerAngles:C,tr:t,k:we,useSlerp:S.roll!=C.roll}),N&&(t.interpolatePadding(b,u.padding,we),W=t.centerPoint.add(u.offsetAsPoint)),u.around)t.setLocationAtPoint(u.around,u.aroundPoint);else{const Ie=c.af(t.zoom-m),Ce=ae>m?Math.min(2,ve):Math.max(.5,ve),ze=Math.pow(Ce,1-we),Ve=Se(t.worldSize,ge.add(me.mult(we*ze)).mult(Ie));t.setLocationAtPoint(t.renderWorldCopies?Ve.wrap():Ve,W)}},isZooming:U,elevationCenter:J}}handleFlyTo(t,u){const m=u.zoom!==void 0,b=t.zoom,S=t.getConstrained(c.S.convert(u.center||u.locationAtOffset),m?+u.zoom:b),C=S.center,O=S.zoom;Ma(t,C);const N=fe(t.worldSize,u.locationAtOffset),U=fe(t.worldSize,C).sub(N),q=U.mag(),W=c.af(O-b);let H;if(u.minZoom!==void 0){const J=Math.min(+u.minZoom,b,O),ae=t.getConstrained(C,J).zoom;H=c.af(ae-b)}return{easeFunc:(J,ae,ge,me)=>{t.setZoom(J===1?O:b+c.ak(ae));const ve=J===1?C:Se(t.worldSize,N.add(U.mult(ge)).mult(ae));t.setLocationAtPoint(t.renderWorldCopies?ve.wrap():ve,me)},scaleOfZoom:W,targetCenter:C,scaleOfMinZoom:H,pixelPathLength:q}}}class bn{constructor(t,u,m){this.blendFunction=t,this.blendColor=u,this.mask=m}}bn.Replace=[1,0],bn.disabled=new bn(bn.Replace,c.bf.transparent,[!1,!1,!1,!1]),bn.unblended=new bn(bn.Replace,c.bf.transparent,[!0,!0,!0,!0]),bn.alphaBlended=new bn([1,771],c.bf.transparent,[!0,!0,!0,!0]);const fa=2305;class fn{constructor(t,u,m){this.enable=t,this.mode=u,this.frontFace=m}}fn.disabled=new fn(!1,1029,fa),fn.backCCW=new fn(!0,1029,fa),fn.frontCCW=new fn(!0,1028,fa);class sn{constructor(t,u,m){this.func=t,this.mask=u,this.range=m}}sn.ReadOnly=!1,sn.ReadWrite=!0,sn.disabled=new sn(519,sn.ReadOnly,[0,1]);const na=7680;class $n{constructor(t,u,m,b,S,C){this.test=t,this.ref=u,this.mask=m,this.fail=b,this.depthFail=S,this.pass=C}}$n.disabled=new $n({func:519,mask:0},0,0,na,na,na);const Dr=new WeakMap;function Yr(T){var t;if(Dr.has(T))return Dr.get(T);{const u=(t=T.getParameter(T.VERSION))===null||t===void 0?void 0:t.startsWith("WebGL 2.0");return Dr.set(T,u),u}}class sr{get awaitingQuery(){return!!this._readbackQueue}constructor(t){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=t;const u=t.context,m=u.gl;this._texFormat=m.RGBA,this._texType=m.UNSIGNED_BYTE;const b=new c.aL;b.emplaceBack(-1,-1),b.emplaceBack(2,-1),b.emplaceBack(-1,2);const S=new c.aN;S.emplaceBack(0,1,2),this._fullscreenTriangle=new Ja(u.createVertexBuffer(b,_s.members),u.createIndexBuffer(S),c.aM.simpleSegment(0,0,b.length,S.length)),this._resultBuffer=new Uint8Array(4),u.activeTexture.set(m.TEXTURE1);const C=m.createTexture();m.bindTexture(m.TEXTURE_2D,C),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,m.CLAMP_TO_EDGE),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,m.CLAMP_TO_EDGE),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,m.NEAREST),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,m.NEAREST),m.texImage2D(m.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=u.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(C),Yr(m)&&(this._pbo=m.createBuffer(),m.bindBuffer(m.PIXEL_PACK_BUFFER,this._pbo),m.bufferData(m.PIXEL_PACK_BUFFER,4,m.STREAM_READ),m.bindBuffer(m.PIXEL_PACK_BUFFER,null))}destroy(){const t=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),t.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(t,u){const m=this._updateCount;return this._readbackQueue?m>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():m>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(t,u),this._updateCount++,this._measuredError}_bindFramebuffer(){const t=this._cachedRenderContext.context,u=t.gl;t.activeTexture.set(u.TEXTURE1),u.bindTexture(u.TEXTURE_2D,this._fbo.colorAttachment.get()),t.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(t,u){const m=this._cachedRenderContext.context,b=m.gl;if(this._bindFramebuffer(),m.viewport.set([0,0,this._texWidth,this._texHeight]),m.clear({color:c.bf.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(m,b.TRIANGLES,sn.disabled,$n.disabled,bn.unblended,fn.disabled,((S,C)=>({u_input:S,u_output_expected:C}))(t,u),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&Yr(b)){b.bindBuffer(b.PIXEL_PACK_BUFFER,this._pbo),b.readBuffer(b.COLOR_ATTACHMENT0),b.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),b.bindBuffer(b.PIXEL_PACK_BUFFER,null);const S=b.fenceSync(b.SYNC_GPU_COMMANDS_COMPLETE,0);b.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:S}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const t=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&Yr(t)){const u=t.clientWaitSync(this._readbackQueue.sync,0,0);if(u===t.WAIT_FAILED)return c.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(u===t.TIMEOUT_EXPIRED)return;t.bindBuffer(t.PIXEL_PACK_BUFFER,this._pbo),t.getBufferSubData(t.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),t.bindBuffer(t.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),t.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=sr._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(t){let u=0;return u+=t[0]/256,u+=t[1]/65536,u+=t[2]/16777216,t[3]<127&&(u=-u),u/128}}const vs=c.$/128;function lo(T,t){const u=T.granularity!==void 0?Math.max(T.granularity,1):1,m=u+(T.generateBorders?2:0),b=u+(T.extendToNorthPole||T.generateBorders?1:0)+(T.extendToSouthPole||T.generateBorders?1:0),S=m+1,C=b+1,O=T.generateBorders?-1:0,N=T.generateBorders||T.extendToNorthPole?-1:0,U=u+(T.generateBorders?1:0),q=u+(T.generateBorders||T.extendToSouthPole?1:0),W=S*C,H=m*b*6,J=S*C>65536;if(J&&t==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const ae=J||t==="32bit",ge=new Int16Array(2*W);let me=0;for(let Ie=N;Ie<=q;Ie++)for(let Ce=O;Ce<=U;Ce++){let ze=Ce/u*c.$;Ce===-1&&(ze=-vs),Ce===u+1&&(ze=c.$+vs);let Ve=Ie/u*c.$;Ie===-1&&(Ve=T.extendToNorthPole?c.bh:-vs),Ie===u+1&&(Ve=T.extendToSouthPole?c.bi:c.$+vs),ge[me++]=ze,ge[me++]=Ve}const ve=ae?new Uint32Array(H):new Uint16Array(H);let we=0;for(let Ie=0;Ie<b;Ie++)for(let Ce=0;Ce<m;Ce++){const ze=Ce+1+Ie*S,Ve=Ce+(Ie+1)*S,Me=Ce+1+(Ie+1)*S;ve[we++]=Ce+Ie*S,ve[we++]=Ve,ve[we++]=ze,ve[we++]=ze,ve[we++]=Ve,ve[we++]=Me}return{vertices:ge.buffer.slice(0),indices:ve.buffer.slice(0),uses32bitIndices:ae}}const bs=new c.aK({fill:new c.bj(128,2),line:new c.bj(512,0),tile:new c.bj(128,32),stencil:new c.bj(128,1),circle:3});class Xn{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return Gi.projectionGlobe}get vertexShaderPreludeCode(){return Gi.projectionMercator.vertexSource}get subdivisionGranularity(){return bs}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(t){this._errorMeasurement||(this._errorMeasurement=new sr(t));const u=c.U(this._errorQueryLatitudeDegrees),m=2*Math.atan(Math.exp(Math.PI-u*Math.PI*2))-.5*Math.PI,b=this._errorMeasurement.updateErrorLoop(u,m),S=ee.now();b!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=b,this._errorMeasurementLastChangeTime=S);const C=Math.min(Math.max((S-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=c.bk(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,c.bl(C))}_getMeshKey(t){return`${t.granularity.toString(36)}_${t.generateBorders?"b":""}${t.extendToNorthPole?"n":""}${t.extendToSouthPole?"s":""}`}getMeshFromTileID(t,u,m,b,S){const C=(S==="stencil"?bs.stencil:bs.tile).getGranularityForZoomLevel(u.z);return this._getMesh(t,{granularity:C,generateBorders:m,extendToNorthPole:u.y===0&&b,extendToSouthPole:u.y===(1<<u.z)-1&&b})}_getMesh(t,u){const m=this._getMeshKey(u);if(m in this._tileMeshCache)return this._tileMeshCache[m];const b=(function(S,C){const O=lo(C,"16bit"),N=c.aL.deserialize({arrayBuffer:O.vertices,length:O.vertices.byteLength/2/2}),U=c.aN.deserialize({arrayBuffer:O.indices,length:O.indices.byteLength/2/3});return new Ja(S.createVertexBuffer(N,_s.members),S.createIndexBuffer(U),c.aM.simpleSegment(0,0,N.length,U.length))})(t,u);return this._tileMeshCache[m]=b,b}recalculate(t){}hasTransition(){const t=ee.now();let u=!1;return u=u||(t-this._errorMeasurementLastChangeTime)/1e3<.7,u=u||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,u}setErrorQueryLatitudeDegrees(t){this._errorQueryLatitudeDegrees=t}}const Io=new c.r({type:new c.D(c.v.projection.type)});class ia extends c.E{constructor(t){super(),this._transitionable=new c.t(Io),this.setProjection(t),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new c.F(0)),this._mercatorProjection=new Ln,this._verticalPerspectiveProjection=new Xn}get transitionState(){const t=this.properties.get("type");if(typeof t=="string"&&t==="mercator")return 0;if(typeof t=="string"&&t==="vertical-perspective")return 1;if(t instanceof c.bm){if(t.from==="vertical-perspective"&&t.to==="mercator")return 1-t.transition;if(t.from==="mercator"&&t.to==="vertical-perspective")return t.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(t){this._mercatorProjection.updateGPUdependent(t),this._verticalPerspectiveProjection.updateGPUdependent(t)}getMeshFromTileID(t,u,m,b,S){return this.currentProjection.getMeshFromTileID(t,u,m,b,S)}setProjection(t){this._transitionable.setValue("type",(t==null?void 0:t.type)||"mercator")}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}setErrorQueryLatitudeDegrees(t){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(t),this._mercatorProjection.setErrorQueryLatitudeDegrees(t)}}function Ia(T){const t=xs(T.worldSize,T.center.lat);return 2*Math.PI*t}function Pa(T,t,u,m,b){const S=1/(1<<b),C=t/c.$*S+m*S,O=c.bo((T/c.$*S+u*S)*Math.PI*2+Math.PI,2*Math.PI),N=2*Math.atan(Math.exp(Math.PI-C*Math.PI*2))-.5*Math.PI,U=Math.cos(N),q=new Float64Array(3);return q[0]=Math.sin(O)*U,q[1]=Math.sin(N),q[2]=Math.cos(O)*U,q}function zr(T){return(function(t,u){const m=Math.cos(u),b=new Float64Array(3);return b[0]=Math.sin(t)*m,b[1]=Math.sin(u),b[2]=Math.cos(t)*m,b})(T.lng*Math.PI/180,T.lat*Math.PI/180)}function xs(T,t){return T/(2*Math.PI)/Math.cos(t*Math.PI/180)}function ql(T){const t=Math.asin(T[1])/Math.PI*180,u=Math.sqrt(T[0]*T[0]+T[2]*T[2]);if(u>1e-6){const m=T[0]/u,b=Math.acos(T[2]/u),S=(m>0?b:-b)/Math.PI*180;return new c.S(c.aO(S,-180,180),t)}return new c.S(0,t)}function Po(T){return Math.cos(T*Math.PI/180)}function Hi(T,t){const u=Po(T),m=Po(t);return c.ak(m/u)}function Uu(T,t){const u=T.rotate(t.bearingInRadians),m=t.zoom+Hi(t.center.lat,0),b=c.bk(1/Po(t.center.lat),1/Po(Math.min(Math.abs(t.center.lat),60)),c.bn(m,7,3,0,1)),S=360/Ia({worldSize:t.worldSize,center:{lat:t.center.lat}});return new c.S(t.center.lng-u.x*S*b,c.ah(t.center.lat+u.y*S,-c.ai,c.ai))}function sl(T){const t=.5*T,u=Math.sin(t),m=Math.cos(t);return Math.log(u+m)-Math.log(m-u)}function Gl(T,t,u,m){const b=T.lat+u*m;if(Math.abs(u)>1){const S=(Math.sign(T.lat+u)!==Math.sign(T.lat)?-Math.abs(T.lat):Math.abs(T.lat))*Math.PI/180,C=Math.abs(T.lat+u)*Math.PI/180,O=sl(S+m*(C-S)),N=sl(S),U=sl(C);return new c.S(T.lng+t*((O-N)/(U-N)),b)}return new c.S(T.lng+t*m,b)}class Hs{constructor(t){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=t}swapBuffers(){if(!this._hadAnyChanges)return;const t=this._cachePrevious;this._cachePrevious=this._cache,this._cache=t,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(t,u,m,b){const S=`${t.z}_${t.x}_${t.y}_${b!=null&&b.terrain?"t":""}`,C=this._cache.get(S);if(C)return C;const O=this._cachePrevious.get(S);if(O)return this._cache.set(S,O),O;const N=this._boundingVolumeFactory(t,u,m,b);return this._cache.set(S,N),this._hadAnyChanges=!0,N}}class kl{constructor(t,u,m,b){this.min=m,this.max=b,this.points=t,this.planes=u}static fromAabb(t,u){const m=[];for(let b=0;b<8;b++)m.push([1&~b?t[0]:u[0],(b>>1&1)==1?u[1]:t[1],(b>>2&1)==1?u[2]:t[2]]);return new kl(m,[[-1,0,0,u[0]],[1,0,0,-t[0]],[0,-1,0,u[1]],[0,1,0,-t[1]],[0,0,-1,u[2]],[0,0,1,-t[2]]],t,u)}static fromCenterSizeAngles(t,u,m){const b=c.br([],m[0],m[1],m[2]),S=c.bs([],[u[0],0,0],b),C=c.bs([],[0,u[1],0],b),O=c.bs([],[0,0,u[2]],b),N=[...t],U=[...t];for(let W=0;W<8;W++)for(let H=0;H<3;H++){const J=t[H]+S[H]*(1&~W?-1:1)+C[H]*((W>>1&1)==1?1:-1)+O[H]*((W>>2&1)==1?1:-1);N[H]=Math.min(N[H],J),U[H]=Math.max(U[H],J)}const q=[];for(let W=0;W<8;W++){const H=[...t];c.aS(H,H,c.aR([],S,1&~W?-1:1)),c.aS(H,H,c.aR([],C,(W>>1&1)==1?1:-1)),c.aS(H,H,c.aR([],O,(W>>2&1)==1?1:-1)),q.push(H)}return new kl(q,[[...S,-c.aX(S,q[0])],[...C,-c.aX(C,q[0])],[...O,-c.aX(O,q[0])],[-S[0],-S[1],-S[2],-c.aX(S,q[7])],[-C[0],-C[1],-C[2],-c.aX(C,q[7])],[-O[0],-O[1],-O[2],-c.aX(O,q[7])]],N,U)}intersectsFrustum(t){let u=!0;const m=this.points.length,b=this.planes.length,S=t.planes.length,C=t.points.length;for(let O=0;O<S;O++){const N=t.planes[O];let U=0;for(let q=0;q<m;q++){const W=this.points[q];N[0]*W[0]+N[1]*W[1]+N[2]*W[2]+N[3]>=0&&U++}if(U===0)return 0;U<m&&(u=!1)}if(u)return 2;for(let O=0;O<b;O++){const N=this.planes[O];let U=0;for(let q=0;q<C;q++){const W=t.points[q];N[0]*W[0]+N[1]*W[1]+N[2]*W[2]+N[3]>=0&&U++}if(U===0)return 0}return 1}intersectsPlane(t){const u=this.points.length;let m=0;for(let b=0;b<u;b++){const S=this.points[b];t[0]*S[0]+t[1]*S[1]+t[2]*S[2]+t[3]>=0&&m++}return m===u?2:m===0?0:1}}function or(T,t,u){const m=T-t;return m<0?-m:Math.max(0,m-u)}function es(T,t,u,m,b){const S=T-u;let C;return C=S<0?Math.min(-S,1+S-b):S>1?Math.min(Math.max(S-b,0),1-S):0,Math.max(C,or(t,m,b))}class ws{constructor(){this._boundingVolumeCache=new Hs(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(t,u,m,b){const S=1<<m.z,C=1/S,O=m.x/S,N=m.y/S;let U=2;return U=Math.min(U,es(t,u,O,N,C)),U=Math.min(U,es(t,u,O+.5,-N-C,C)),U=Math.min(U,es(t,u,O+.5,2-N-C,C)),U}getWrap(t,u,m){const b=1<<u.z,S=1/b,C=u.x/b,O=or(t.x,C,S),N=or(t.x,C-1,S),U=or(t.x,C+1,S),q=Math.min(O,N,U);return q===U?1:q===N?-1:0}allowVariableZoom(t,u){return tn(t,u)>4}allowWorldCopies(){return!1}getTileBoundingVolume(t,u,m,b){return this._boundingVolumeCache.getTileBoundingVolume(t,u,m,b)}_computeTileBoundingVolume(t,u,m,b){var S,C;let O=0,N=0;if(b!=null&&b.terrain){const U=new c.Z(t.z,u,t.z,t.x,t.y),q=b.terrain.getMinMaxElevation(U);O=(S=q.minElevation)!==null&&S!==void 0?S:Math.min(0,m),N=(C=q.maxElevation)!==null&&C!==void 0?C:Math.max(0,m)}if(O/=c.bu,N/=c.bu,O+=1,N+=1,t.z<=0)return kl.fromAabb([-N,-N,-N],[N,N,N]);if(t.z===1)return kl.fromAabb([t.x===0?-N:0,t.y===0?0:-N,-N],[t.x===0?0:N,t.y===0?N:0,N]);{const U=[Pa(0,0,t.x,t.y,t.z),Pa(c.$,0,t.x,t.y,t.z),Pa(c.$,c.$,t.x,t.y,t.z),Pa(0,c.$,t.x,t.y,t.z)],q=[];for(const st of U)q.push(c.aR([],st,N));if(N!==O)for(const st of U)q.push(c.aR([],st,O));t.y===0&&q.push([0,1,0]),t.y===(1<<t.z)-1&&q.push([0,-1,0]);const W=[1,1,1],H=[-1,-1,-1];for(const st of q)for(let lt=0;lt<3;lt++)W[lt]=Math.min(W[lt],st[lt]),H[lt]=Math.max(H[lt],st[lt]);const J=Pa(c.$/2,c.$/2,t.x,t.y,t.z),ae=c.aW([],[0,1,0],J);c.aV(ae,ae);const ge=c.aW([],J,ae);c.aV(ge,ge);const me=c.aW([],U[2],U[1]);c.aV(me,me);const ve=c.aW([],U[0],U[3]);c.aV(ve,ve),q.push(c.aR([],J,N)),t.y>=(1<<t.z)/2&&q.push(c.aR([],Pa(c.$/2,0,t.x,t.y,t.z),N)),t.y<(1<<t.z)/2&&q.push(c.aR([],Pa(c.$/2,c.$,t.x,t.y,t.z),N));const we=Dl(J,q),Ie=Dl(ge,q),Ce=[-J[0],-J[1],-J[2],we.max],ze=[J[0],J[1],J[2],-we.min],Ve=[-ge[0],-ge[1],-ge[2],Ie.max],Me=[ge[0],ge[1],ge[2],-Ie.min],Ye=[...me,0],ct=[...ve,0],rt=[];return t.y===0?rt.push(c.bt(ct,Ye,Ce),c.bt(ct,Ye,ze)):rt.push(c.bt(Ve,Ye,Ce),c.bt(Ve,Ye,ze),c.bt(Ve,ct,Ce),c.bt(Ve,ct,ze)),t.y===(1<<t.z)-1?rt.push(c.bt(ct,Ye,Ce),c.bt(ct,Ye,ze)):rt.push(c.bt(Me,Ye,Ce),c.bt(Me,Ye,ze),c.bt(Me,ct,Ce),c.bt(Me,ct,ze)),new kl(rt,[Ce,ze,Ve,Me,Ye,ct],W,H)}}}function Dl(T,t){let u=1/0,m=-1/0;for(const b of t){const S=c.aX(T,b);u=Math.min(u,S),m=Math.max(m,S)}return{min:u,max:m}}class ol{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,u,m){return this._helper.interpolatePadding(t,u,m)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,u){this._helper.resize(t,u)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}overrideNearFarZ(t,u){this._helper.overrideNearFarZ(t,u)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(t){}constructor(){this._cachedClippingPlane=c.bv(),this._projectionMatrix=c.b9(),this._globeViewProjMatrix32f=c.b8(),this._globeViewProjMatrixNoCorrection=c.b9(),this._globeViewProjMatrixNoCorrectionInverted=c.b9(),this._globeProjMatrixInverted=c.b9(),this._cameraPosition=c.bp(),this._globeLatitudeErrorCorrectionRadians=0,this._helper=new Zi({calcMatrices:()=>{this._calcMatrices()},getConstrained:(t,u)=>this.getConstrained(t,u)}),this._coveringTilesDetailsProvider=new ws}clone(){const t=new ol;return t.apply(this),t}apply(t,u){this._globeLatitudeErrorCorrectionRadians=u||0,this._helper.apply(t)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const t=c.bp();return t[0]=this._cameraPosition[0],t[1]=this._cameraPosition[1],t[2]=this._cameraPosition[2],t}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(t){const{overscaledTileID:u,applyGlobeMatrix:m}=t,b=this._helper.getMercatorTileCoordinates(u);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:b,clippingPlane:this._cachedClippingPlane,projectionTransition:m?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(t){const u=this.pitchInRadians,m=this.cameraToCenterDistance/t,b=Math.sin(u)*m,S=Math.cos(u)*m+1,C=1/Math.sqrt(b*b+S*S)*1;let O=-b,N=S;const U=Math.sqrt(O*O+N*N);O/=U,N/=U;const q=[0,O,N];c.bw(q,q,[0,0,0],-this.bearingInRadians),c.bx(q,q,[0,0,0],-1*this.center.lat*Math.PI/180),c.by(q,q,[0,0,0],this.center.lng*Math.PI/180);const W=1/c.aZ(q);return c.aR(q,q,W),[...q,-C*W]}isLocationOccluded(t){return!this.isSurfacePointVisible(zr(t))}transformLightDirection(t){const u=this._helper._center.lng*Math.PI/180,m=this._helper._center.lat*Math.PI/180,b=Math.cos(m),S=[Math.sin(u)*b,Math.sin(m),Math.cos(u)*b],C=[S[2],0,-S[0]],O=[0,0,0];c.aW(O,C,S),c.aV(C,C),c.aV(O,O);const N=[0,0,0];return c.aV(N,[C[0]*t[0]+O[0]*t[1]+S[0]*t[2],C[1]*t[0]+O[1]*t[1]+S[1]*t[2],C[2]*t[0]+O[2]*t[1]+S[2]*t[2]]),N}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(t,u,m){const b=(function(O,N,U){const q=1/(1<<U.z);return new c.a1(O/c.$*q+U.x*q,N/c.$*q+U.y*q)})(t,u,m.canonical),S=(C=b.y,[c.bo(b.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-C*Math.PI*2))-.5*Math.PI]);var C;return this.getCircleRadiusCorrection()/Math.cos(S[1])}projectTileCoordinates(t,u,m,b){const S=m.canonical,C=Pa(t,u,S.x,S.y,S.z),O=1+(b?b(t,u):0)/c.bu,N=[C[0]*O,C[1]*O,C[2]*O,1];c.aw(N,N,this._globeViewProjMatrixNoCorrection);const U=this._cachedClippingPlane,q=U[0]*C[0]+U[1]*C[1]+U[2]*C[2]+U[3]<0;return{point:new c.P(N[0]/N[3],N[1]/N[3]),signedDistanceFromCamera:N[3],isOccluded:q}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const t=xs(this.worldSize,this.center.lat),u=c.ba(),m=c.ba();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*t),c.b4(u,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const b=this.centerOffset;u[8]=2*-b.x/this._helper._width,u[9]=2*b.y/this._helper._height,this._projectionMatrix=c.b5(u),this._globeProjMatrixInverted=c.ba(),c.aq(this._globeProjMatrixInverted,u),c.M(u,u,[0,0,-this.cameraToCenterDistance]),c.b6(u,u,this.rollInRadians),c.b7(u,u,-this.pitchInRadians),c.b6(u,u,this.bearingInRadians),c.M(u,u,[0,0,-t]);const S=c.bp();S[0]=t,S[1]=t,S[2]=t,c.b7(m,u,this.center.lat*Math.PI/180),c.bz(m,m,-this.center.lng*Math.PI/180),c.N(m,m,S),this._globeViewProjMatrixNoCorrection=m,c.b7(u,u,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),c.bz(u,u,-this.center.lng*Math.PI/180),c.N(u,u,S),this._globeViewProjMatrix32f=new Float32Array(u),this._globeViewProjMatrixNoCorrectionInverted=c.ba(),c.aq(this._globeViewProjMatrixNoCorrectionInverted,m);const C=c.bp();this._cameraPosition=c.bp(),this._cameraPosition[2]=this.cameraToCenterDistance/t,c.bw(this._cameraPosition,this._cameraPosition,C,-this.rollInRadians),c.bx(this._cameraPosition,this._cameraPosition,C,this.pitchInRadians),c.bw(this._cameraPosition,this._cameraPosition,C,-this.bearingInRadians),c.aS(this._cameraPosition,this._cameraPosition,[0,0,1]),c.bx(this._cameraPosition,this._cameraPosition,C,-this.center.lat*Math.PI/180),c.by(this._cameraPosition,this._cameraPosition,C,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(t);const O=c.b5(this._globeViewProjMatrixNoCorrectionInverted);c.N(O,O,[1,1,-1]),this._cachedFrustum=fi.fromInvProjectionMatrix(O,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(t){c.w("calculateFogMatrix is not supported on globe projection.");const u=c.ba();return c.ag(u),u}getVisibleUnwrappedCoordinates(t){return[new c.b2(0,t)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(t){t&&c.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(t,u){if(!this._globeViewProjMatrixNoCorrection)return 1;const m=zr(t);c.aR(m,m,1+u/c.bu);const b=c.bv();return c.aw(b,[m[0],m[1],m[2],1],this._globeViewProjMatrixNoCorrection),b[2]/b[3]}populateCache(t){}getBounds(){const t=.5*this.width,u=.5*this.height,m=[new c.P(0,0),new c.P(t,0),new c.P(this.width,0),new c.P(this.width,u),new c.P(this.width,this.height),new c.P(t,this.height),new c.P(0,this.height),new c.P(0,u)],b=[];for(const W of m)b.push(this.unprojectScreenPoint(W));let S=0,C=0,O=0,N=0;const U=this.center;for(const W of b){const H=c.bA(U.lng,W.lng),J=c.bA(U.lat,W.lat);H<C&&(C=H),H>S&&(S=H),J<N&&(N=J),J>O&&(O=J)}const q=[U.lng+C,U.lat+N,U.lng+S,U.lat+O];return this.isSurfacePointOnScreen([0,1,0])&&(q[3]=90,q[0]=-180,q[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(q[1]=-90,q[0]=-180,q[2]=180),new Ni(q)}getConstrained(t,u){const m=c.ah(t.lat,-c.ai,c.ai),b=c.ah(+u,this.minZoom+Hi(0,m),this.maxZoom);return{center:new c.S(t.lng,m),zoom:b}}calculateCenterFromCameraLngLatAlt(t,u,m,b){return this._helper.calculateCenterFromCameraLngLatAlt(t,u,m,b)}setLocationAtPoint(t,u){const m=zr(this.unprojectScreenPoint(u)),b=zr(t),S=c.bp();c.bB(S);const C=c.bp();c.by(C,m,S,-this.center.lng*Math.PI/180),c.bx(C,C,S,this.center.lat*Math.PI/180);const O=b[0]*b[0]+b[2]*b[2],N=C[0]*C[0];if(O<N)return;const U=Math.sqrt(O-N),q=-U,W=c.bC(b[0],b[2],C[0],U),H=c.bC(b[0],b[2],C[0],q),J=c.bp();c.by(J,b,S,-W);const ae=c.bC(J[1],J[2],C[1],C[2]),ge=c.bp();c.by(ge,b,S,-H);const me=c.bC(ge[1],ge[2],C[1],C[2]),ve=.5*Math.PI,we=ae>=-ve&&ae<=ve,Ie=me>=-ve&&me<=ve;let Ce,ze;if(we&&Ie){const ct=this.center.lng*Math.PI/180,rt=this.center.lat*Math.PI/180;c.bD(W,ct)+c.bD(ae,rt)<c.bD(H,ct)+c.bD(me,rt)?(Ce=W,ze=ae):(Ce=H,ze=me)}else if(we)Ce=W,ze=ae;else{if(!Ie)return;Ce=H,ze=me}const Ve=Ce/Math.PI*180,Me=ze/Math.PI*180,Ye=this.center.lat;this.setCenter(new c.S(Ve,c.ah(Me,-90,90))),this.setZoom(this.zoom+Hi(Ye,this.center.lat))}locationToScreenPoint(t,u){const m=zr(t);if(u){const b=u.getElevationForLngLatZoom(t,this._helper._tileZoom);c.aR(m,m,1+b/c.bu)}return this._projectSurfacePointToScreen(m)}_projectSurfacePointToScreen(t){const u=c.bv();return c.aw(u,[...t,1],this._globeViewProjMatrixNoCorrection),u[0]/=u[3],u[1]/=u[3],new c.P((.5*u[0]+.5)*this.width,(.5*-u[1]+.5)*this.height)}screenPointToMercatorCoordinate(t,u){if(u){const m=u.pointCoordinate(t);if(m)return m}return c.a1.fromLngLat(this.unprojectScreenPoint(t))}screenPointToLocation(t,u){var m;return(m=this.screenPointToMercatorCoordinate(t,u))===null||m===void 0?void 0:m.toLngLat()}isPointOnMapSurface(t,u){const m=this._cameraPosition,b=this.getRayDirectionFromPixel(t);return!!this.rayPlanetIntersection(m,b)}getRayDirectionFromPixel(t){const u=c.bv();u[0]=t.x/this.width*2-1,u[1]=-1*(t.y/this.height*2-1),u[2]=1,u[3]=1,c.aw(u,u,this._globeViewProjMatrixNoCorrectionInverted),u[0]/=u[3],u[1]/=u[3],u[2]/=u[3];const m=c.bp();m[0]=u[0]-this._cameraPosition[0],m[1]=u[1]-this._cameraPosition[1],m[2]=u[2]-this._cameraPosition[2];const b=c.bp();return c.aV(b,m),b}isSurfacePointVisible(t){const u=this._cachedClippingPlane;return u[0]*t[0]+u[1]*t[1]+u[2]*t[2]+u[3]>=0}isSurfacePointOnScreen(t){if(!this.isSurfacePointVisible(t))return!1;const u=c.bv();return c.aw(u,[...t,1],this._globeViewProjMatrixNoCorrection),u[0]/=u[3],u[1]/=u[3],u[2]/=u[3],u[0]>-1&&u[0]<1&&u[1]>-1&&u[1]<1&&u[2]>-1&&u[2]<1}rayPlanetIntersection(t,u){const m=c.aX(t,u),b=c.bp(),S=c.bp();c.aR(S,u,m),c.aU(b,t,S);const C=1-c.aX(b,b);if(C<0)return null;const O=c.aX(t,t)-1,N=-m+(m<0?1:-1)*Math.sqrt(C),U=O/N,q=N;return{tMin:Math.min(U,q),tMax:Math.max(U,q)}}unprojectScreenPoint(t){const u=this._cameraPosition,m=this.getRayDirectionFromPixel(t),b=this.rayPlanetIntersection(u,m);if(b){const q=c.bp();c.aS(q,u,[m[0]*b.tMin,m[1]*b.tMin,m[2]*b.tMin]);const W=c.bp();return c.aV(W,q),ql(W)}const S=this._cachedClippingPlane,C=S[0]*m[0]+S[1]*m[1]+S[2]*m[2],O=-c.b1(S,u)/C,N=c.bp();if(O>0)c.aS(N,u,[m[0]*O,m[1]*O,m[2]*O]);else{const q=c.bp();c.aS(q,u,[2*m[0],2*m[1],2*m[2]]);const W=c.b1(this._cachedClippingPlane,q);c.aU(N,q,[this._cachedClippingPlane[0]*W,this._cachedClippingPlane[1]*W,this._cachedClippingPlane[2]*W])}const U=(function(q){const W=c.bp();return W[0]=q[0]*-q[3],W[1]=q[1]*-q[3],W[2]=q[2]*-q[3],{center:W,radius:Math.sqrt(1-q[3]*q[3])}})(S);return ql((function(q,W,H){const J=c.bp();c.aU(J,H,q);const ae=c.bp();return c.bq(ae,q,J,W/c.a$(J)),ae})(U.center,U.radius,N))}getMatrixForModel(t,u){const m=c.S.convert(t),b=1/c.bu,S=c.b9();return c.bz(S,S,m.lng/180*Math.PI),c.b7(S,S,-m.lat/180*Math.PI),c.M(S,S,[0,0,1+u/c.bu]),c.b7(S,S,.5*Math.PI),c.N(S,S,[b,b,b]),S}getProjectionDataForCustomLayer(t=!0){const u=this.getProjectionData({overscaledTileID:new c.Z(0,0,0,0,0),applyGlobeMatrix:t});return u.tileMercatorCoords=[0,0,1,1],u}getFastPathSimpleProjectionMatrix(t){}}class uo{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,u,m){return this._helper.interpolatePadding(t,u,m)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,u,m=!0){this._helper.resize(t,u,m)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}overrideNearFarZ(t,u){this._helper.overrideNearFarZ(t,u)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(t,u){this._globeness=t,this._globeLatitudeErrorCorrectionRadians=u,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this._helper=new Zi({calcMatrices:()=>{this._calcMatrices()},getConstrained:(t,u)=>this.getConstrained(t,u)}),this._globeness=1,this._mercatorTransform=new xn,this._verticalPerspectiveTransform=new ol}clone(){const t=new uo;return t._globeness=this._globeness,t._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,t.apply(this),t}apply(t){this._helper.apply(t),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(t){const u=this._mercatorTransform.getProjectionData(t),m=this._verticalPerspectiveTransform.getProjectionData(t);return{mainMatrix:this.isGlobeRendering?m.mainMatrix:u.mainMatrix,clippingPlane:m.clippingPlane,tileMercatorCoords:m.tileMercatorCoords,projectionTransition:t.applyGlobeMatrix?this._globeness:0,fallbackMatrix:u.fallbackMatrix}}isLocationOccluded(t){return this.currentTransform.isLocationOccluded(t)}transformLightDirection(t){return this.currentTransform.transformLightDirection(t)}getPixelScale(){return c.bk(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return c.bk(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(t,u,m){const b=this._mercatorTransform.getPitchedTextCorrection(t,u,m),S=this._verticalPerspectiveTransform.getPitchedTextCorrection(t,u,m);return c.bk(b,S,this._globeness)}projectTileCoordinates(t,u,m,b){return this.currentTransform.projectTileCoordinates(t,u,m,b)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(t){return this.currentTransform.calculateFogMatrix(t)}getVisibleUnwrappedCoordinates(t){return this.currentTransform.getVisibleUnwrappedCoordinates(t)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(t){this._mercatorTransform.recalculateZoomAndCenter(t),this._verticalPerspectiveTransform.recalculateZoomAndCenter(t)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(t,u){return this.currentTransform.lngLatToCameraDepth(t,u)}populateCache(t){this._mercatorTransform.populateCache(t),this._verticalPerspectiveTransform.populateCache(t)}getBounds(){return this.currentTransform.getBounds()}getConstrained(t,u){return this.currentTransform.getConstrained(t,u)}calculateCenterFromCameraLngLatAlt(t,u,m,b){return this._helper.calculateCenterFromCameraLngLatAlt(t,u,m,b)}setLocationAtPoint(t,u){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(t,u),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(t,u),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(t,u){return this.currentTransform.locationToScreenPoint(t,u)}screenPointToMercatorCoordinate(t,u){return this.currentTransform.screenPointToMercatorCoordinate(t,u)}screenPointToLocation(t,u){return this.currentTransform.screenPointToLocation(t,u)}isPointOnMapSurface(t,u){return this.currentTransform.isPointOnMapSurface(t,u)}getRayDirectionFromPixel(t){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(t)}getMatrixForModel(t,u){return this.currentTransform.getMatrixForModel(t,u)}getProjectionDataForCustomLayer(t=!0){const u=this._mercatorTransform.getProjectionDataForCustomLayer(t);if(!this.isGlobeRendering)return u;const m=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(t);return m.fallbackMatrix=u.mainMatrix,m}getFastPathSimpleProjectionMatrix(t){return this.currentTransform.getFastPathSimpleProjectionMatrix(t)}}class Ei{get useGlobeControls(){return!0}handlePanInertia(t,u){const m=Uu(t,u);return Math.abs(m.lng-u.center.lng)>180&&(m.lng=u.center.lng+179.5*Math.sign(m.lng-u.center.lng)),{easingCenter:m,easingOffset:new c.P(0,0)}}handleMapControlsRollPitchBearingZoom(t,u){const m=t.around,b=u.screenPointToLocation(m);t.bearingDelta&&u.setBearing(u.bearing+t.bearingDelta),t.pitchDelta&&u.setPitch(u.pitch+t.pitchDelta),t.rollDelta&&u.setRoll(u.roll+t.rollDelta);const S=u.zoom;t.zoomDelta&&u.setZoom(u.zoom+t.zoomDelta);const C=u.zoom-S;if(C===0)return;const O=c.bA(u.center.lng,b.lng),N=O/(Math.abs(O/180)+1),U=c.bA(u.center.lat,b.lat),q=u.getRayDirectionFromPixel(m),W=u.cameraPosition,H=-1*c.aX(W,q),J=c.bp();c.aS(J,W,[q[0]*H,q[1]*H,q[2]*H]);const ae=c.aZ(J)-1,ge=Math.exp(.5*-Math.max(ae-.3,0)),me=xs(u.worldSize,u.center.lat)/Math.min(u.width,u.height),ve=c.bn(me,.9,.5,1,.25),we=(1-c.af(-C))*Math.min(ge,ve),Ie=u.center.lat,Ce=u.zoom,ze=new c.S(u.center.lng+N*we,c.ah(u.center.lat+U*we,-c.ai,c.ai));u.setLocationAtPoint(b,m);const Ve=u.center,Me=c.bn(Math.abs(O),45,85,0,1),Ye=c.bn(me,.75,.35,0,1),ct=Math.pow(Math.max(Me,Ye),.25),rt=c.bA(Ve.lng,ze.lng),st=c.bA(Ve.lat,ze.lat);u.setCenter(new c.S(Ve.lng+rt*ct,Ve.lat+st*ct).wrap()),u.setZoom(Ce+Hi(Ie,u.center.lat))}handleMapControlsPan(t,u,m){if(!t.panDelta)return;const b=u.center.lat,S=u.zoom;u.setCenter(Uu(t.panDelta,u).wrap()),u.setZoom(S+Hi(b,u.center.lat))}cameraForBoxAndBearing(t,u,m,b,S){const C=ur(t,u,m,b,S),O=u.left/S.width*2-1,N=(S.width-u.right)/S.width*2-1,U=u.top/S.height*-2+1,q=(S.height-u.bottom)/S.height*-2+1,W=c.bA(m.getWest(),m.getEast())<0,H=W?m.getEast():m.getWest(),J=W?m.getWest():m.getEast(),ae=Math.max(m.getNorth(),m.getSouth()),ge=Math.min(m.getNorth(),m.getSouth()),me=H+.5*c.bA(H,J),ve=ae+.5*c.bA(ae,ge),we=S.clone();we.setCenter(C.center),we.setBearing(C.bearing),we.setPitch(0),we.setRoll(0),we.setZoom(C.zoom);const Ie=we.modelViewProjectionMatrix,Ce=[zr(m.getNorthWest()),zr(m.getNorthEast()),zr(m.getSouthWest()),zr(m.getSouthEast()),zr(new c.S(J,ve)),zr(new c.S(H,ve)),zr(new c.S(me,ae)),zr(new c.S(me,ge))],ze=zr(C.center);let Ve=Number.POSITIVE_INFINITY;for(const Me of Ce)O<0&&(Ve=Ei.getLesserNonNegativeNonNull(Ve,Ei.solveVectorScale(Me,ze,Ie,"x",O))),N>0&&(Ve=Ei.getLesserNonNegativeNonNull(Ve,Ei.solveVectorScale(Me,ze,Ie,"x",N))),U>0&&(Ve=Ei.getLesserNonNegativeNonNull(Ve,Ei.solveVectorScale(Me,ze,Ie,"y",U))),q<0&&(Ve=Ei.getLesserNonNegativeNonNull(Ve,Ei.solveVectorScale(Me,ze,Ie,"y",q)));if(Number.isFinite(Ve)&&Ve!==0)return C.zoom=we.zoom+c.ak(Ve),C;al()}handleJumpToCenterZoom(t,u){const m=t.center.lat,b=t.getConstrained(u.center?c.S.convert(u.center):t.center,t.zoom).center;t.setCenter(b.wrap());const S=u.zoom!==void 0?+u.zoom:t.zoom+Hi(m,b.lat);t.zoom!==S&&t.setZoom(S)}handleEaseTo(t,u){const m=t.zoom,b=t.center,S=t.padding,C={roll:t.roll,pitch:t.pitch,bearing:t.bearing},O={roll:u.roll===void 0?t.roll:u.roll,pitch:u.pitch===void 0?t.pitch:u.pitch,bearing:u.bearing===void 0?t.bearing:u.bearing},N=u.zoom!==void 0,U=!t.isPaddingEqual(u.padding);let q=!1;const W=u.center?c.S.convert(u.center):b,H=t.getConstrained(W,m).center;Ma(t,H);const J=t.clone();J.setCenter(H),J.setZoom(N?+u.zoom:m+Hi(b.lat,W.lat)),J.setBearing(u.bearing);const ae=new c.P(c.ah(t.centerPoint.x+u.offsetAsPoint.x,0,t.width),c.ah(t.centerPoint.y+u.offsetAsPoint.y,0,t.height));J.setLocationAtPoint(H,ae);const ge=(u.offset&&u.offsetAsPoint.mag())>0?J.center:H,me=N?+u.zoom:m+Hi(b.lat,ge.lat),ve=m+Hi(b.lat,0),we=me+Hi(ge.lat,0),Ie=c.bA(b.lng,ge.lng),Ce=c.bA(b.lat,ge.lat),ze=c.af(we-ve);return q=me!==m,{easeFunc:Ve=>{if(c.be(C,O)||ar({startEulerAngles:C,endEulerAngles:O,tr:t,k:Ve,useSlerp:C.roll!=O.roll}),U&&t.interpolatePadding(S,u.padding,Ve),u.around)c.w("Easing around a point is not supported under globe projection."),t.setLocationAtPoint(u.around,u.aroundPoint);else{const Me=we>ve?Math.min(2,ze):Math.max(.5,ze),Ye=Math.pow(Me,1-Ve),ct=Gl(b,Ie,Ce,Ve*Ye);t.setCenter(ct.wrap())}if(q){const Me=c.C.number(ve,we,Ve)+Hi(0,t.center.lat);t.setZoom(Me)}},isZooming:q,elevationCenter:ge}}handleFlyTo(t,u){const m=u.zoom!==void 0,b=t.center,S=t.zoom,C=t.padding,O=!t.isPaddingEqual(u.padding),N=t.getConstrained(c.S.convert(u.center||u.locationAtOffset),S).center,U=m?+u.zoom:t.zoom+Hi(t.center.lat,N.lat),q=t.clone();q.setCenter(N),q.setZoom(U),q.setBearing(u.bearing);const W=new c.P(c.ah(t.centerPoint.x+u.offsetAsPoint.x,0,t.width),c.ah(t.centerPoint.y+u.offsetAsPoint.y,0,t.height));q.setLocationAtPoint(N,W);const H=q.center;Ma(t,H);const J=(function(Ce,ze,Ve){const Me=zr(ze),Ye=zr(Ve),ct=c.aX(Me,Ye),rt=Math.acos(ct),st=Ia(Ce);return rt/(2*Math.PI)*st})(t,b,H),ae=S+Hi(b.lat,0),ge=U+Hi(H.lat,0),me=c.af(ge-ae);let ve;if(typeof u.minZoom=="number"){const Ce=+u.minZoom+Hi(H.lat,0),ze=Math.min(Ce,ae,ge)+Hi(0,H.lat),Ve=t.getConstrained(H,ze).zoom+Hi(H.lat,0);ve=c.af(Ve-ae)}const we=c.bA(b.lng,H.lng),Ie=c.bA(b.lat,H.lat);return{easeFunc:(Ce,ze,Ve,Me)=>{const Ye=Gl(b,we,Ie,Ve);O&&t.interpolatePadding(C,u.padding,Ce);const ct=Ce===1?H:Ye;t.setCenter(ct.wrap());const rt=ae+c.ak(ze);t.setZoom(Ce===1?U:rt+Hi(0,ct.lat))},scaleOfZoom:me,targetCenter:H,scaleOfMinZoom:ve,pixelPathLength:J}}static solveVectorScale(t,u,m,b,S){const C=b==="x"?[m[0],m[4],m[8],m[12]]:[m[1],m[5],m[9],m[13]],O=[m[3],m[7],m[11],m[15]],N=t[0]*C[0]+t[1]*C[1]+t[2]*C[2],U=t[0]*O[0]+t[1]*O[1]+t[2]*O[2],q=u[0]*C[0]+u[1]*C[1]+u[2]*C[2],W=u[0]*O[0]+u[1]*O[1]+u[2]*O[2];return q+S*U===N+S*W||O[3]*(N-q)+C[3]*(W-U)+N*W==q*U?null:(q+C[3]-S*W-S*O[3])/(q-N-S*W+S*U)}static getLesserNonNegativeNonNull(t,u){return u!==null&&u>=0&&u<t?u:t}}class $u{constructor(t){this._globe=t,this._mercatorCameraHelper=new xr,this._verticalPerspectiveCameraHelper=new Ei}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(t,u){return this.currentHelper.handlePanInertia(t,u)}handleMapControlsRollPitchBearingZoom(t,u){return this.currentHelper.handleMapControlsRollPitchBearingZoom(t,u)}handleMapControlsPan(t,u,m){this.currentHelper.handleMapControlsPan(t,u,m)}cameraForBoxAndBearing(t,u,m,b,S){return this.currentHelper.cameraForBoxAndBearing(t,u,m,b,S)}handleJumpToCenterZoom(t,u){this.currentHelper.handleJumpToCenterZoom(t,u)}handleEaseTo(t,u){return this.currentHelper.handleEaseTo(t,u)}handleFlyTo(t,u){return this.currentHelper.handleFlyTo(t,u)}}const hu=(T,t)=>c.y(T,t&&t.filter((u=>u.identifier!=="source.canvas"))),zl=c.bE();class P extends c.E{constructor(t,u={}){super(),this._rtlPluginLoaded=()=>{for(const m in this.sourceCaches){const b=this.sourceCaches[m].getSource().type;b!=="vector"&&b!=="geojson"||this.sourceCaches[m].reload()}},this.map=t,this.dispatcher=new Xt(Jt(),t._getMapId()),this.dispatcher.registerMessageHandler("GG",((m,b)=>this.getGlyphs(m,b))),this.dispatcher.registerMessageHandler("GI",((m,b)=>this.getImages(m,b))),this.imageManager=new _e,this.imageManager.setEventedParent(this),this.glyphManager=new Re(t._requestManager,u.localIdeographFontFamily),this.lineAtlas=new zt(256,512),this.crossTileSymbolIndex=new Qa,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new c.bF,this._loaded=!1,this._availableImages=[],this._globalState={},this._resetUpdates(),this.dispatcher.broadcast("SR",c.bG()),Fs().on($r,this._rtlPluginLoaded),this.on("data",(m=>{if(m.dataType!=="source"||m.sourceDataType!=="metadata")return;const b=this.sourceCaches[m.sourceId];if(!b)return;const S=b.getSource();if(S&&S.vectorLayerIds)for(const C in this._layers){const O=this._layers[C];O.source===S.id&&this._validateLayer(O)}}))}setGlobalStateProperty(t,u){var m,b,S;this._checkLoaded();const C=u===null?(S=(b=(m=this.stylesheet.state)===null||m===void 0?void 0:m[t])===null||b===void 0?void 0:b.default)!==null&&S!==void 0?S:null:u;if(c.bH(C,this._globalState[t]))return this;this._globalState[t]=C;const O=this._findGlobalStateAffectedSources([t]);for(const N in this.sourceCaches)O.has(N)&&(this._reloadSource(N),this._changed=!0)}getGlobalState(){return this._globalState}setGlobalState(t){this._checkLoaded();const u=[];for(const b in t)!c.bH(this._globalState[b],t[b].default)&&(u.push(b),this._globalState[b]=t[b].default);const m=this._findGlobalStateAffectedSources(u);for(const b in this.sourceCaches)m.has(b)&&(this._reloadSource(b),this._changed=!0)}_findGlobalStateAffectedSources(t){if(t.length===0)return new Set;const u=new Set;for(const m in this._layers){const b=this._layers[m],S=b.getLayoutAffectingGlobalStateRefs();for(const C of t)S.has(C)&&u.add(b.source)}return u}loadURL(t,u={},m){this.fire(new c.l("dataloading",{dataType:"style"})),u.validate=typeof u.validate!="boolean"||u.validate;const b=this.map._requestManager.transformRequest(t,"Style");this._loadStyleRequest=new AbortController;const S=this._loadStyleRequest;c.j(b,this._loadStyleRequest).then((C=>{this._loadStyleRequest=null,this._load(C.data,u,m)})).catch((C=>{this._loadStyleRequest=null,C&&!S.signal.aborted&&this.fire(new c.k(C))}))}loadJSON(t,u={},m){this.fire(new c.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,ee.frameAsync(this._frameRequest).then((()=>{this._frameRequest=null,u.validate=u.validate!==!1,this._load(t,u,m)})).catch((()=>{}))}loadEmpty(){this.fire(new c.l("dataloading",{dataType:"style"})),this._load(zl,{validate:!1})}_load(t,u,m){var b,S,C;const O=u.transformStyle?u.transformStyle(m,t):t;if(!u.validate||!hu(this,c.z(O))){this._loaded=!0,this.stylesheet=O;for(const N in O.sources)this.addSource(N,O.sources[N],{validate:!1});O.sprite?this._loadSprite(O.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(O.glyphs),this._createLayers(),this.light=new mt(this.stylesheet.light),this._setProjectionInternal(((b=this.stylesheet.projection)===null||b===void 0?void 0:b.type)||"mercator"),this.sky=new Tt(this.stylesheet.sky),this.map.setTerrain((S=this.stylesheet.terrain)!==null&&S!==void 0?S:null),this.setGlobalState((C=this.stylesheet.state)!==null&&C!==void 0?C:null),this.fire(new c.l("data",{dataType:"style"})),this.fire(new c.l("style.load"))}}_createLayers(){const t=c.bI(this.stylesheet.layers);this.dispatcher.broadcast("SL",t),this._order=t.map((u=>u.id)),this._layers={},this._serializedLayers=null;for(const u of t){const m=c.bJ(u);m.setEventedParent(this,{layer:{id:u.id}}),this._layers[u.id]=m}}_loadSprite(t,u=!1,m=void 0){let b;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,(function(S,C,O,N){return c._(this,void 0,void 0,(function*(){const U=Be(S),q=O>1?"@2x":"",W={},H={};for(const{id:J,url:ae}of U){const ge=C.transformRequest(de(ae,q,".json"),"SpriteJSON");W[J]=c.j(ge,N);const me=C.transformRequest(de(ae,q,".png"),"SpriteImage");H[J]=He.getImage(me,N)}return yield Promise.all([...Object.values(W),...Object.values(H)]),(function(J,ae){return c._(this,void 0,void 0,(function*(){const ge={};for(const me in J){ge[me]={};const ve=ee.getImageCanvasContext((yield ae[me]).data),we=(yield J[me]).data;for(const Ie in we){const{width:Ce,height:ze,x:Ve,y:Me,sdf:Ye,pixelRatio:ct,stretchX:rt,stretchY:st,content:lt,textFitWidth:Nt,textFitHeight:Vt}=we[Ie];ge[me][Ie]={data:null,pixelRatio:ct,sdf:Ye,stretchX:rt,stretchY:st,content:lt,textFitWidth:Nt,textFitHeight:Vt,spriteData:{width:Ce,height:ze,x:Ve,y:Me,context:ve}}}}return ge}))})(W,H)}))})(t,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then((S=>{if(this._spriteRequest=null,S)for(const C in S){this._spritesImagesIds[C]=[];const O=this._spritesImagesIds[C]?this._spritesImagesIds[C].filter((N=>!(N in S))):[];for(const N of O)this.imageManager.removeImage(N),this._changedImages[N]=!0;for(const N in S[C]){const U=C==="default"?N:`${C}:${N}`;this._spritesImagesIds[C].push(U),U in this.imageManager.images?this.imageManager.updateImage(U,S[C][N],!1):this.imageManager.addImage(U,S[C][N]),u&&(this._changedImages[U]=!0)}}})).catch((S=>{this._spriteRequest=null,b=S,this.fire(new c.k(b))})).finally((()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),u&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.l("data",{dataType:"style"})),m&&m(b)}))}_unloadSprite(){for(const t of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(t),this._changedImages[t]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.l("data",{dataType:"style"}))}_validateLayer(t){const u=this.sourceCaches[t.source];if(!u)return;const m=t.sourceLayer;if(!m)return;const b=u.getSource();(b.type==="geojson"||b.vectorLayerIds&&b.vectorLayerIds.indexOf(m)===-1)&&this.fire(new c.k(new Error(`Source layer "${m}" does not exist on source "${b.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(t,u=!1){const m=this._serializedAllLayers();if(!t||t.length===0)return Object.values(u?c.bK(m):m);const b=[];for(const S of t)if(m[S]){const C=u?c.bK(m[S]):m[S];b.push(C)}return b}_serializedAllLayers(){let t=this._serializedLayers;if(t)return t;t=this._serializedLayers={};const u=Object.keys(this._layers);for(const m of u){const b=this._layers[m];b.type!=="custom"&&(t[m]=b.serialize())}return t}hasTransitions(){var t,u,m;if(!((t=this.light)===null||t===void 0)&&t.hasTransition()||!((u=this.sky)===null||u===void 0)&&u.hasTransition()||!((m=this.projection)===null||m===void 0)&&m.hasTransition())return!0;for(const b in this.sourceCaches)if(this.sourceCaches[b].hasTransition())return!0;for(const b in this._layers)if(this._layers[b].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const u=this._changed;if(u){const b=Object.keys(this._updatedLayers),S=Object.keys(this._removedLayers);(b.length||S.length)&&this._updateWorkerLayers(b,S);for(const C in this._updatedSources){const O=this._updatedSources[C];if(O==="reload")this._reloadSource(C);else{if(O!=="clear")throw new Error(`Invalid action ${O}`);this._clearSource(C)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const C in this._updatedPaintProps)this._layers[C].updateTransitions(t);this.light.updateTransitions(t),this.sky.updateTransitions(t),this._resetUpdates()}const m={};for(const b in this.sourceCaches){const S=this.sourceCaches[b];m[b]=S.used,S.used=!1}for(const b of this._order){const S=this._layers[b];S.recalculate(t,this._availableImages),!S.isHidden(t.zoom)&&S.source&&(this.sourceCaches[S.source].used=!0)}for(const b in m){const S=this.sourceCaches[b];!!m[b]!=!!S.used&&S.fire(new c.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:b}))}this.light.recalculate(t),this.sky.recalculate(t),this.projection.recalculate(t),this.z=t.zoom,u&&this.fire(new c.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const u in this.sourceCaches)this.sourceCaches[u].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const t in this.sourceCaches)this.sourceCaches[t].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(t,u){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(t,!1),removedIds:u})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(t,u={}){var m;this._checkLoaded();const b=this.serialize();if(t=u.transformStyle?u.transformStyle(b,t):t,((m=u.validate)===null||m===void 0||m)&&hu(this,c.z(t)))return!1;(t=c.bK(t)).layers=c.bI(t.layers);const S=c.bL(b,t),C=this._getOperationsToPerform(S);if(C.unimplemented.length>0)throw new Error(`Unimplemented: ${C.unimplemented.join(", ")}.`);if(C.operations.length===0)return!1;for(const O of C.operations)O();return this.stylesheet=t,this._serializedLayers=null,!0}_getOperationsToPerform(t){const u=[],m=[];for(const b of t)switch(b.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":u.push((()=>this.addLayer.apply(this,b.args)));break;case"removeLayer":u.push((()=>this.removeLayer.apply(this,b.args)));break;case"setPaintProperty":u.push((()=>this.setPaintProperty.apply(this,b.args)));break;case"setLayoutProperty":u.push((()=>this.setLayoutProperty.apply(this,b.args)));break;case"setFilter":u.push((()=>this.setFilter.apply(this,b.args)));break;case"addSource":u.push((()=>this.addSource.apply(this,b.args)));break;case"removeSource":u.push((()=>this.removeSource.apply(this,b.args)));break;case"setLayerZoomRange":u.push((()=>this.setLayerZoomRange.apply(this,b.args)));break;case"setLight":u.push((()=>this.setLight.apply(this,b.args)));break;case"setGeoJSONSourceData":u.push((()=>this.setGeoJSONSourceData.apply(this,b.args)));break;case"setGlyphs":u.push((()=>this.setGlyphs.apply(this,b.args)));break;case"setSprite":u.push((()=>this.setSprite.apply(this,b.args)));break;case"setTerrain":u.push((()=>this.map.setTerrain.apply(this,b.args)));break;case"setSky":u.push((()=>this.setSky.apply(this,b.args)));break;case"setProjection":this.setProjection.apply(this,b.args);break;case"setGlobalState":u.push((()=>this.setGlobalState.apply(this,b.args)));break;case"setTransition":u.push((()=>{}));break;default:m.push(b.command)}return{operations:u,unimplemented:m}}addImage(t,u){if(this.getImage(t))return this.fire(new c.k(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,u),this._afterImageUpdated(t)}updateImage(t,u){this.imageManager.updateImage(t,u)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new c.k(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,u,m={}){if(this._checkLoaded(),this.sourceCaches[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!u.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(u).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(u.type)>=0&&this._validate(c.z.source,`sources.${t}`,u,null,m))return;this.map&&this.map._collectResourceTiming&&(u.collectResourceTiming=!0);const b=this.sourceCaches[t]=new Rn(t,u,this.dispatcher);b.style=this,b.setEventedParent(this,(()=>({isSourceLoaded:b.loaded(),source:b.serialize(),sourceId:t}))),b.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error("There is no source with this ID");for(const m in this._layers)if(this._layers[m].source===t)return this.fire(new c.k(new Error(`Source "${t}" cannot be removed while layer "${m}" is using it.`)));const u=this.sourceCaches[t];delete this.sourceCaches[t],delete this._updatedSources[t],u.fire(new c.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),u.setEventedParent(null),u.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,u){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const m=this.sourceCaches[t].getSource();if(m.type!=="geojson")throw new Error(`geojsonSource.type is ${m.type}, which is !== 'geojson`);m.setData(u),this._changed=!0}getSource(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()}addLayer(t,u,m={}){this._checkLoaded();const b=t.id;if(this.getLayer(b))return void this.fire(new c.k(new Error(`Layer "${b}" already exists on this map.`)));let S;if(t.type==="custom"){if(hu(this,c.bM(t)))return;S=c.bJ(t)}else{if("source"in t&&typeof t.source=="object"&&(this.addSource(b,t.source),t=c.bK(t),t=c.e(t,{source:b})),this._validate(c.z.layer,`layers.${b}`,t,{arrayIndex:-1},m))return;S=c.bJ(t),this._validateLayer(S),S.setEventedParent(this,{layer:{id:b}})}const C=u?this._order.indexOf(u):this._order.length;if(u&&C===-1)this.fire(new c.k(new Error(`Cannot add layer "${b}" before non-existing layer "${u}".`)));else{if(this._order.splice(C,0,b),this._layerOrderChanged=!0,this._layers[b]=S,this._removedLayers[b]&&S.source&&S.type!=="custom"){const O=this._removedLayers[b];delete this._removedLayers[b],O.type!==S.type?this._updatedSources[S.source]="clear":(this._updatedSources[S.source]="reload",this.sourceCaches[S.source].pause())}this._updateLayer(S),S.onAdd&&S.onAdd(this.map)}}moveLayer(t,u){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new c.k(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===u)return;const m=this._order.indexOf(t);this._order.splice(m,1);const b=u?this._order.indexOf(u):this._order.length;u&&b===-1?this.fire(new c.k(new Error(`Cannot move layer "${t}" before non-existing layer "${u}".`))):(this._order.splice(b,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const u=this._layers[t];if(!u)return void this.fire(new c.k(new Error(`Cannot remove non-existing layer "${t}".`)));u.setEventedParent(null);const m=this._order.indexOf(t);this._order.splice(m,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=u,delete this._layers[t],this._serializedLayers&&delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],u.onRemove&&u.onRemove(this.map)}getLayer(t){return this._layers[t]}getLayersOrder(){return[...this._order]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,u,m){this._checkLoaded();const b=this.getLayer(t);b?b.minzoom===u&&b.maxzoom===m||(u!=null&&(b.minzoom=u),m!=null&&(b.maxzoom=m),this._updateLayer(b)):this.fire(new c.k(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,u,m={}){this._checkLoaded();const b=this.getLayer(t);if(b){if(!c.bH(b.filter,u))return u==null?(b.setFilter(void 0),void this._updateLayer(b)):void(this._validate(c.z.filter,`layers.${b.id}.filter`,u,null,m)||(b.setFilter(c.bK(u)),this._updateLayer(b)))}else this.fire(new c.k(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return c.bK(this.getLayer(t).filter)}setLayoutProperty(t,u,m,b={}){this._checkLoaded();const S=this.getLayer(t);S?c.bH(S.getLayoutProperty(u),m)||(S.setLayoutProperty(u,m,b),this._updateLayer(S)):this.fire(new c.k(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,u){const m=this.getLayer(t);if(m)return m.getLayoutProperty(u);this.fire(new c.k(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,u,m,b={}){this._checkLoaded();const S=this.getLayer(t);S?c.bH(S.getPaintProperty(u),m)||(S.setPaintProperty(u,m,b)&&this._updateLayer(S),this._changed=!0,this._updatedPaintProps[t]=!0,this._serializedLayers=null):this.fire(new c.k(new Error(`Cannot style non-existing layer "${t}".`)))}getPaintProperty(t,u){return this.getLayer(t).getPaintProperty(u)}setFeatureState(t,u){this._checkLoaded();const m=t.source,b=t.sourceLayer,S=this.sourceCaches[m];if(S===void 0)return void this.fire(new c.k(new Error(`The source '${m}' does not exist in the map's style.`)));const C=S.getSource().type;C==="geojson"&&b?this.fire(new c.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):C!=="vector"||b?(t.id===void 0&&this.fire(new c.k(new Error("The feature id parameter must be provided."))),S.setFeatureState(b,t.id,u)):this.fire(new c.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,u){this._checkLoaded();const m=t.source,b=this.sourceCaches[m];if(b===void 0)return void this.fire(new c.k(new Error(`The source '${m}' does not exist in the map's style.`)));const S=b.getSource().type,C=S==="vector"?t.sourceLayer:void 0;S!=="vector"||C?u&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new c.k(new Error("A feature id is required to remove its specific state property."))):b.removeFeatureState(C,t.id,u):this.fire(new c.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const u=t.source,m=t.sourceLayer,b=this.sourceCaches[u];if(b!==void 0)return b.getSource().type!=="vector"||m?(t.id===void 0&&this.fire(new c.k(new Error("The feature id parameter must be provided."))),b.getFeatureState(m,t.id)):void this.fire(new c.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new c.k(new Error(`The source '${u}' does not exist in the map's style.`)))}getTransition(){return c.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const t=c.bN(this.sourceCaches,(S=>S.serialize())),u=this._serializeByIds(this._order,!0),m=this.map.getTerrain()||void 0,b=this.stylesheet;return c.bO({version:b.version,name:b.name,metadata:b.metadata,light:b.light,sky:b.sky,center:b.center,zoom:b.zoom,bearing:b.bearing,pitch:b.pitch,sprite:b.sprite,glyphs:b.glyphs,transition:b.transition,projection:b.projection,sources:t,layers:u,terrain:m},(S=>S!==void 0))}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.sourceCaches[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(t){const u=C=>this._layers[C].type==="fill-extrusion",m={},b=[];for(let C=this._order.length-1;C>=0;C--){const O=this._order[C];if(u(O)){m[O]=C;for(const N of t){const U=N[O];if(U)for(const q of U)b.push(q)}}}b.sort(((C,O)=>O.intersectionZ-C.intersectionZ));const S=[];for(let C=this._order.length-1;C>=0;C--){const O=this._order[C];if(u(O))for(let N=b.length-1;N>=0;N--){const U=b[N].feature;if(m[U.layer.id]<C)break;S.push(U),b.pop()}else for(const N of t){const U=N[O];if(U)for(const q of U)S.push(q.feature)}}return S}queryRenderedFeatures(t,u,m){u&&u.filter&&this._validate(c.z.filter,"queryRenderedFeatures.filter",u.filter,null,u);const b={};if(u&&u.layers){if(!(Array.isArray(u.layers)||u.layers instanceof Set))return this.fire(new c.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const U of u.layers){const q=this._layers[U];if(!q)return this.fire(new c.k(new Error(`The layer '${U}' does not exist in the map's style and cannot be queried for features.`))),[];b[q.source]=!0}}const S=[];u.availableImages=this._availableImages;const C=this._serializedAllLayers(),O=u.layers instanceof Set?u.layers:Array.isArray(u.layers)?new Set(u.layers):null,N=Object.assign(Object.assign({},u),{layers:O});for(const U in this.sourceCaches)u.layers&&!b[U]||S.push(di(this.sourceCaches[U],this._layers,C,t,N,m,this.map.terrain?(q,W,H)=>this.map.terrain.getElevation(q,W,H):void 0));return this.placement&&S.push((function(U,q,W,H,J,ae,ge){const me={},ve=ae.queryRenderedSymbols(H),we=[];for(const Ie of Object.keys(ve).map(Number))we.push(ge[Ie]);we.sort(ds);for(const Ie of we){const Ce=Ie.featureIndex.lookupSymbolFeatures(ve[Ie.bucketInstanceId],q,Ie.bucketIndex,Ie.sourceLayerIndex,J.filter,J.layers,J.availableImages,U);for(const ze in Ce){const Ve=me[ze]=me[ze]||[],Me=Ce[ze];Me.sort(((Ye,ct)=>{const rt=Ie.featureSortOrder;if(rt){const st=rt.indexOf(Ye.featureIndex);return rt.indexOf(ct.featureIndex)-st}return ct.featureIndex-Ye.featureIndex}));for(const Ye of Me)Ve.push(Ye)}}return(function(Ie,Ce,ze){for(const Ve in Ie)for(const Me of Ie[Ve])Ns(Me,ze[Ce[Ve].source]);return Ie})(me,U,W)})(this._layers,C,this.sourceCaches,t,N,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(S)}querySourceFeatures(t,u){u&&u.filter&&this._validate(c.z.filter,"querySourceFeatures.filter",u.filter,null,u);const m=this.sourceCaches[t];return m?(function(b,S){const C=b.getRenderableIds().map((U=>b.getTileByID(U))),O=[],N={};for(let U=0;U<C.length;U++){const q=C[U],W=q.tileID.canonical.key;N[W]||(N[W]=!0,q.querySourceFeatures(O,S))}return O})(m,u):[]}getLight(){return this.light.getLight()}setLight(t,u={}){this._checkLoaded();const m=this.light.getLight();let b=!1;for(const C in t)if(!c.bH(t[C],m[C])){b=!0;break}if(!b)return;const S={now:ee.now(),transition:c.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,u),this.light.updateTransitions(S)}getProjection(){var t;return(t=this.stylesheet)===null||t===void 0?void 0:t.projection}setProjection(t){if(this._checkLoaded(),this.projection){if(this.projection.name===t.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=t,this._setProjectionInternal(t.type)}getSky(){var t;return(t=this.stylesheet)===null||t===void 0?void 0:t.sky}setSky(t,u={}){this._checkLoaded();const m=this.getSky();let b=!1;if(!t&&!m)return;if(t&&!m)b=!0;else if(!t&&m)b=!0;else for(const C in t)if(!c.bH(t[C],m[C])){b=!0;break}if(!b)return;const S={now:ee.now(),transition:c.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=t,this.sky.setSky(t,u),this.sky.updateTransitions(S)}_setProjectionInternal(t){const u=(function(m){if(Array.isArray(m)){const b=new ia({type:m});return{projection:b,transform:new uo,cameraHelper:new $u(b)}}switch(m){case"mercator":return{projection:new Ln,transform:new xn,cameraHelper:new xr};case"globe":{const b=new ia({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:b,transform:new uo,cameraHelper:new $u(b)}}case"vertical-perspective":return{projection:new Xn,transform:new ol,cameraHelper:new Ei};default:return c.w(`Unknown projection name: ${m}. Falling back to mercator projection.`),{projection:new Ln,transform:new xn,cameraHelper:new xr}}})(t);this.projection=u.projection,this.map.migrateProjection(u.transform,u.cameraHelper);for(const m in this.sourceCaches)this.sourceCaches[m].reload()}_validate(t,u,m,b,S={}){return(!S||S.validate!==!1)&&hu(this,t.call(c.z,c.e({key:u,style:this.serialize(),value:m,styleSpec:c.v},b)))}_remove(t=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Fs().off($r,this._rtlPluginLoaded);for(const u in this._layers)this._layers[u].setEventedParent(null);for(const u in this.sourceCaches){const m=this.sourceCaches[u];m.setEventedParent(null),m.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),t&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(t)}_clearSource(t){this.sourceCaches[t].clearTiles()}_reloadSource(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()}_updateSources(t){for(const u in this.sourceCaches)this.sourceCaches[u].update(t,this.map.terrain)}_generateCollisionBoxes(){for(const t in this.sourceCaches)this._reloadSource(t)}_updatePlacement(t,u,m,b,S=!1){let C=!1,O=!1;const N={};for(const U of this._order){const q=this._layers[U];if(q.type!=="symbol")continue;if(!N[q.source]){const H=this.sourceCaches[q.source];N[q.source]=H.getRenderableIds(!0).map((J=>H.getTileByID(J))).sort(((J,ae)=>ae.tileID.overscaledZ-J.tileID.overscaledZ||(J.tileID.isLessThan(ae.tileID)?-1:1)))}const W=this.crossTileSymbolIndex.addLayer(q,N[q.source],t.center.lng);C=C||W}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((S=S||this._layerOrderChanged||m===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(ee.now(),t.zoom))&&(this.pauseablePlacement=new ir(t,this.map.terrain,this._order,S,u,m,b,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,N),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(ee.now()),O=!0),C&&this.pauseablePlacement.placement.setStale()),O||C)for(const U of this._order){const q=this._layers[U];q.type==="symbol"&&this.placement.updateLayerOpacities(q,N[q.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(ee.now())}_releaseSymbolFadeTiles(){for(const t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,u){return c._(this,void 0,void 0,(function*(){const m=yield this.imageManager.getImages(u.icons);this._updateTilesForChangedImages();const b=this.sourceCaches[u.source];return b&&b.setDependencies(u.tileID.key,u.type,u.icons),m}))}getGlyphs(t,u){return c._(this,void 0,void 0,(function*(){const m=yield this.glyphManager.getGlyphs(u.stacks),b=this.sourceCaches[u.source];return b&&b.setDependencies(u.tileID.key,u.type,[""]),m}))}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(t,u={}){this._checkLoaded(),t&&this._validate(c.z.glyphs,"glyphs",t,null,u)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=t,this.glyphManager.entries={},this.glyphManager.setURL(t))}addSprite(t,u,m={},b){this._checkLoaded();const S=[{id:t,url:u}],C=[...Be(this.stylesheet.sprite),...S];this._validate(c.z.sprite,"sprite",C,null,m)||(this.stylesheet.sprite=C,this._loadSprite(S,!0,b))}removeSprite(t){this._checkLoaded();const u=Be(this.stylesheet.sprite);if(u.find((m=>m.id===t))){if(this._spritesImagesIds[t])for(const m of this._spritesImagesIds[t])this.imageManager.removeImage(m),this._changedImages[m]=!0;u.splice(u.findIndex((m=>m.id===t)),1),this.stylesheet.sprite=u.length>0?u:void 0,delete this._spritesImagesIds[t],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.l("data",{dataType:"style"}))}else this.fire(new c.k(new Error(`Sprite "${t}" doesn't exists on this map.`)))}getSprite(){return Be(this.stylesheet.sprite)}setSprite(t,u={},m){this._checkLoaded(),t&&this._validate(c.z.sprite,"sprite",t,null,u)||(this.stylesheet.sprite=t,t?this._loadSprite(t,!0,m):(this._unloadSprite(),m&&m(null)))}}var Z=c.aJ([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class ne{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,u,m,b,S,C,O,N,U){this.context=t;let q=this.boundPaintVertexBuffers.length!==b.length;for(let W=0;!q&&W<b.length;W++)this.boundPaintVertexBuffers[W]!==b[W]&&(q=!0);!this.vao||this.boundProgram!==u||this.boundLayoutVertexBuffer!==m||q||this.boundIndexBuffer!==S||this.boundVertexOffset!==C||this.boundDynamicVertexBuffer!==O||this.boundDynamicVertexBuffer2!==N||this.boundDynamicVertexBuffer3!==U?this.freshBind(u,m,b,S,C,O,N,U):(t.bindVertexArray.set(this.vao),O&&O.bind(),S&&S.dynamicDraw&&S.bind(),N&&N.bind(),U&&U.bind())}freshBind(t,u,m,b,S,C,O,N){const U=t.numAttributes,q=this.context,W=q.gl;this.vao&&this.destroy(),this.vao=q.createVertexArray(),q.bindVertexArray.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=u,this.boundPaintVertexBuffers=m,this.boundIndexBuffer=b,this.boundVertexOffset=S,this.boundDynamicVertexBuffer=C,this.boundDynamicVertexBuffer2=O,this.boundDynamicVertexBuffer3=N,u.enableAttributes(W,t);for(const H of m)H.enableAttributes(W,t);C&&C.enableAttributes(W,t),O&&O.enableAttributes(W,t),N&&N.enableAttributes(W,t),u.bind(),u.setVertexAttribPointers(W,t,S);for(const H of m)H.bind(),H.setVertexAttribPointers(W,t,S);C&&(C.bind(),C.setVertexAttribPointers(W,t,S)),b&&b.bind(),O&&(O.bind(),O.setVertexAttribPointers(W,t,S)),N&&(N.bind(),N.setVertexAttribPointers(W,t,S)),q.currentNumAttributes=U}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const ye=(T,t,u,m,b)=>({u_texture:0,u_ele_delta:T,u_fog_matrix:t,u_fog_color:u?u.properties.get("fog-color"):c.bf.white,u_fog_ground_blend:u?u.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:b?0:u?u.calculateFogBlendOpacity(m):0,u_horizon_color:u?u.properties.get("horizon-color"):c.bf.white,u_horizon_fog_blend:u?u.properties.get("horizon-fog-blend"):1,u_is_globe_mode:b?1:0}),at={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function ht(T){const t=[];for(let u=0;u<T.length;u++){if(T[u]===null)continue;const m=T[u].split(" ");t.push(m.pop())}return t}class Wt{constructor(t,u,m,b,S,C,O,N,U=[]){const q=t.gl;this.program=q.createProgram();const W=ht(u.staticAttributes),H=m?m.getBinderAttributes():[],J=W.concat(H),ae=Gi.prelude.staticUniforms?ht(Gi.prelude.staticUniforms):[],ge=O.staticUniforms?ht(O.staticUniforms):[],me=u.staticUniforms?ht(u.staticUniforms):[],ve=m?m.getBinderUniforms():[],we=ae.concat(ge).concat(me).concat(ve),Ie=[];for(const rt of we)Ie.indexOf(rt)<0&&Ie.push(rt);const Ce=m?m.defines():[];Yr(q)&&Ce.unshift("#version 300 es"),S&&Ce.push("#define OVERDRAW_INSPECTOR;"),C&&Ce.push("#define TERRAIN3D;"),N&&Ce.push(N),U&&Ce.push(...U);let ze=Ce.concat(Gi.prelude.fragmentSource,O.fragmentSource,u.fragmentSource).join(`
`),Ve=Ce.concat(Gi.prelude.vertexSource,O.vertexSource,u.vertexSource).join(`
`);Yr(q)||(ze=(function(rt){return rt.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")})(ze),Ve=(function(rt){return rt.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")})(Ve));const Me=q.createShader(q.FRAGMENT_SHADER);if(q.isContextLost())return void(this.failedToCreate=!0);if(q.shaderSource(Me,ze),q.compileShader(Me),!q.getShaderParameter(Me,q.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${q.getShaderInfoLog(Me)}`);q.attachShader(this.program,Me);const Ye=q.createShader(q.VERTEX_SHADER);if(q.isContextLost())return void(this.failedToCreate=!0);if(q.shaderSource(Ye,Ve),q.compileShader(Ye),!q.getShaderParameter(Ye,q.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${q.getShaderInfoLog(Ye)}`);q.attachShader(this.program,Ye),this.attributes={};const ct={};this.numAttributes=J.length;for(let rt=0;rt<this.numAttributes;rt++)J[rt]&&(q.bindAttribLocation(this.program,rt,J[rt]),this.attributes[J[rt]]=rt);if(q.linkProgram(this.program),!q.getProgramParameter(this.program,q.LINK_STATUS))throw new Error(`Program failed to link: ${q.getProgramInfoLog(this.program)}`);q.deleteShader(Ye),q.deleteShader(Me);for(let rt=0;rt<Ie.length;rt++){const st=Ie[rt];if(st&&!ct[st]){const lt=q.getUniformLocation(this.program,st);lt&&(ct[st]=lt)}}this.fixedUniforms=b(t,ct),this.terrainUniforms=((rt,st)=>({u_depth:new c.bP(rt,st.u_depth),u_terrain:new c.bP(rt,st.u_terrain),u_terrain_dim:new c.bg(rt,st.u_terrain_dim),u_terrain_matrix:new c.bR(rt,st.u_terrain_matrix),u_terrain_unpack:new c.bS(rt,st.u_terrain_unpack),u_terrain_exaggeration:new c.bg(rt,st.u_terrain_exaggeration)}))(t,ct),this.projectionUniforms=((rt,st)=>({u_projection_matrix:new c.bR(rt,st.u_projection_matrix),u_projection_tile_mercator_coords:new c.bS(rt,st.u_projection_tile_mercator_coords),u_projection_clipping_plane:new c.bS(rt,st.u_projection_clipping_plane),u_projection_transition:new c.bg(rt,st.u_projection_transition),u_projection_fallback_matrix:new c.bR(rt,st.u_projection_fallback_matrix)}))(t,ct),this.binderUniforms=m?m.getUniforms(t,ct):[]}draw(t,u,m,b,S,C,O,N,U,q,W,H,J,ae,ge,me,ve,we,Ie){const Ce=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(m),t.setStencilMode(b),t.setColorMode(S),t.setCullFace(C),N){t.activeTexture.set(Ce.TEXTURE2),Ce.bindTexture(Ce.TEXTURE_2D,N.depthTexture),t.activeTexture.set(Ce.TEXTURE3),Ce.bindTexture(Ce.TEXTURE_2D,N.texture);for(const Ve in this.terrainUniforms)this.terrainUniforms[Ve].set(N[Ve])}if(U)for(const Ve in U)this.projectionUniforms[at[Ve]].set(U[Ve]);if(O)for(const Ve in this.fixedUniforms)this.fixedUniforms[Ve].set(O[Ve]);me&&me.setUniforms(t,this.binderUniforms,ae,{zoom:ge});let ze=0;switch(u){case Ce.LINES:ze=2;break;case Ce.TRIANGLES:ze=3;break;case Ce.LINE_STRIP:ze=1}for(const Ve of J.get()){const Me=Ve.vaos||(Ve.vaos={});(Me[q]||(Me[q]=new ne)).bind(t,this,W,me?me.getPaintVertexBuffers():[],H,Ve.vertexOffset,ve,we,Ie),Ce.drawElements(u,Ve.primitiveLength*ze,Ce.UNSIGNED_SHORT,Ve.primitiveOffset*ze*2)}}}function kn(T,t,u){const m=1/c.aC(u,1,t.transform.tileZoom),b=Math.pow(2,u.tileID.overscaledZ),S=u.tileSize*Math.pow(2,t.transform.tileZoom)/b,C=S*(u.tileID.canonical.x+u.tileID.wrap*b),O=S*u.tileID.canonical.y;return{u_image:0,u_texsize:u.imageAtlasTexture.size,u_scale:[m,T.fromScale,T.toScale],u_fade:T.t,u_pixel_coord_upper:[C>>16,O>>16],u_pixel_coord_lower:[65535&C,65535&O]}}const Wn=(T,t,u,m)=>{const b=T.style.light,S=b.properties.get("position"),C=[S.x,S.y,S.z],O=c.bV();b.properties.get("anchor")==="viewport"&&c.bW(O,T.transform.bearingInRadians),c.bX(C,C,O);const N=T.transform.transformLightDirection(C),U=b.properties.get("color");return{u_lightpos:C,u_lightpos_globe:N,u_lightintensity:b.properties.get("intensity"),u_lightcolor:[U.r,U.g,U.b],u_vertical_gradient:+t,u_opacity:u,u_fill_translate:m}},wi=(T,t,u,m,b,S,C)=>c.e(Wn(T,t,u,m),kn(S,T,C),{u_height_factor:-Math.pow(2,b.overscaledZ)/C.tileSize/8}),Xi=(T,t,u,m)=>c.e(kn(t,T,u),{u_fill_translate:m}),qa=(T,t)=>({u_world:T,u_fill_translate:t}),Ga=(T,t,u,m,b)=>c.e(Xi(T,t,u,b),{u_world:m}),Xs=(T,t,u,m,b)=>{const S=T.transform;let C,O,N=0;if(u.paint.get("circle-pitch-alignment")==="map"){const U=c.aC(t,1,S.zoom);C=!0,O=[U,U],N=U/(c.$*Math.pow(2,t.tileID.overscaledZ))*2*Math.PI*b}else C=!1,O=S.pixelsToGLUnits;return{u_camera_to_center_distance:S.cameraToCenterDistance,u_scale_with_map:+(u.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+C,u_device_pixel_ratio:T.pixelRatio,u_extrude_scale:O,u_globe_extrude_scale:N,u_translate:m}},Ts=T=>({u_pixel_extrude_scale:[1/T.width,1/T.height]}),du=T=>({u_viewport_size:[T.width,T.height]}),Ws=(T,t=1)=>({u_color:T,u_overlay:0,u_overlay_scale:t}),fu=(T,t,u,m)=>{const b=c.aC(T,1,t)/(c.$*Math.pow(2,T.tileID.overscaledZ))*2*Math.PI*m;return{u_extrude_scale:c.aC(T,1,t),u_intensity:u,u_globe_extrude_scale:b}},Ks=(T,t,u,m)=>{const b=c.L();c.bY(b,0,T.width,T.height,0,0,1);const S=T.context.gl;return{u_matrix:b,u_world:[S.drawingBufferWidth,S.drawingBufferHeight],u_image:u,u_color_ramp:m,u_opacity:t.paint.get("heatmap-opacity")}},qu=(T,t,u)=>{const m=u.paint.get("hillshade-accent-color");let b;switch(u.paint.get("hillshade-method")){case"basic":b=4;break;case"combined":b=1;break;case"igor":b=2;break;case"multidirectional":b=3;break;default:b=0}const S=u.getIlluminationProperties();for(let C=0;C<S.directionRadians.length;C++)u.paint.get("hillshade-illumination-anchor")==="viewport"&&(S.directionRadians[C]+=T.transform.bearingInRadians);return{u_image:0,u_latrange:co(0,t.tileID),u_exaggeration:u.paint.get("hillshade-exaggeration"),u_altitudes:S.altitudeRadians,u_azimuths:S.directionRadians,u_accent:m,u_method:b,u_highlights:S.highlightColor,u_shadows:S.shadowColor}},jd=(T,t)=>{const u=t.stride,m=c.L();return c.bY(m,0,c.$,-c.$,0,0,1),c.M(m,m,[0,-c.$,0]),{u_matrix:m,u_image:1,u_dimension:[u,u],u_zoom:T.overscaledZ,u_unpack:t.getUnpackVector()}};function co(T,t){const u=Math.pow(2,t.canonical.z),m=t.canonical.y;return[new c.a1(0,m/u).toLngLat().lat,new c.a1(0,(m+1)/u).toLngLat().lat]}const Yh=(T,t,u=0)=>({u_image:0,u_unpack:t.getUnpackVector(),u_dimension:[t.stride,t.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:u,u_opacity:T.paint.get("color-relief-opacity")}),Ys=(T,t,u,m)=>{const b=T.transform;return{u_translation:dh(T,t,u),u_ratio:m/c.aC(t,1,b.zoom),u_device_pixel_ratio:T.pixelRatio,u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]]}},Gu=(T,t,u,m,b)=>c.e(Ys(T,t,u,m),{u_image:0,u_image_height:b}),Zu=(T,t,u,m,b)=>{const S=T.transform,C=pu(t,S);return{u_translation:dh(T,t,u),u_texsize:t.imageAtlasTexture.size,u_ratio:m/c.aC(t,1,S.zoom),u_device_pixel_ratio:T.pixelRatio,u_image:0,u_scale:[C,b.fromScale,b.toScale],u_fade:b.t,u_units_to_pixels:[1/S.pixelsToGLUnits[0],1/S.pixelsToGLUnits[1]]}},Ro=(T,t,u,m,b,S)=>{const C=T.lineAtlas,O=pu(t,T.transform),N=u.layout.get("line-cap")==="round",U=C.getDash(b.from,N),q=C.getDash(b.to,N),W=U.width*S.fromScale,H=q.width*S.toScale;return c.e(Ys(T,t,u,m),{u_patternscale_a:[O/W,-U.height/2],u_patternscale_b:[O/H,-q.height/2],u_sdfgamma:C.width/(256*Math.min(W,H)*T.pixelRatio)/2,u_image:0,u_tex_y_a:U.y,u_tex_y_b:q.y,u_mix:S.t})};function pu(T,t){return 1/c.aC(T,1,t.tileZoom)}function dh(T,t,u){return c.aD(T.transform,t,u.paint.get("line-translate"),u.paint.get("line-translate-anchor"))}const Ss=(T,t,u,m,b)=>{return{u_tl_parent:T,u_scale_parent:t,u_buffer_scale:1,u_fade_t:u.mix,u_opacity:u.opacity*m.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:m.paint.get("raster-brightness-min"),u_brightness_high:m.paint.get("raster-brightness-max"),u_saturation_factor:(C=m.paint.get("raster-saturation"),C>0?1-1/(1.001-C):-C),u_contrast_factor:(S=m.paint.get("raster-contrast"),S>0?1/(1-S):1+S),u_spin_weights:Hu(m.paint.get("raster-hue-rotate")),u_coords_top:[b[0].x,b[0].y,b[1].x,b[1].y],u_coords_bottom:[b[3].x,b[3].y,b[2].x,b[2].y]};var S,C};function Hu(T){T*=Math.PI/180;const t=Math.sin(T),u=Math.cos(T);return[(2*u+1)/3,(-Math.sqrt(3)*t-u+1)/3,(Math.sqrt(3)*t-u+1)/3]}const Xu=(T,t,u,m,b,S,C,O,N,U,q,W,H)=>{const J=C.transform;return{u_is_size_zoom_constant:+(T==="constant"||T==="source"),u_is_size_feature_constant:+(T==="constant"||T==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:J.cameraToCenterDistance,u_pitch:J.pitch/360*2*Math.PI,u_rotate_symbol:+u,u_aspect_ratio:J.width/J.height,u_fade_change:C.options.fadeDuration?C.symbolFadeChange:1,u_label_plane_matrix:O,u_coord_matrix:N,u_is_text:+q,u_pitch_with_map:+m,u_is_along_line:b,u_is_variable_anchor:S,u_texsize:W,u_texture:0,u_translation:U,u_pitched_scale:H}},kc=(T,t,u,m,b,S,C,O,N,U,q,W,H,J)=>{const ae=C.transform;return c.e(Xu(T,t,u,m,b,S,C,O,N,U,q,W,J),{u_gamma_scale:m?Math.cos(ae.pitch*Math.PI/180)*ae.cameraToCenterDistance:1,u_device_pixel_ratio:C.pixelRatio,u_is_halo:1})},Ud=(T,t,u,m,b,S,C,O,N,U,q,W,H)=>c.e(kc(T,t,u,m,b,S,C,O,N,U,!0,q,0,H),{u_texsize_icon:W,u_texture_icon:1}),ll=(T,t)=>({u_opacity:T,u_color:t}),$d=(T,t,u,m,b)=>c.e((function(S,C,O,N){const U=O.imageManager.getPattern(S.from.toString()),q=O.imageManager.getPattern(S.to.toString()),{width:W,height:H}=O.imageManager.getPixelSize(),J=Math.pow(2,N.tileID.overscaledZ),ae=N.tileSize*Math.pow(2,O.transform.tileZoom)/J,ge=ae*(N.tileID.canonical.x+N.tileID.wrap*J),me=ae*N.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:U.tl,u_pattern_br_a:U.br,u_pattern_tl_b:q.tl,u_pattern_br_b:q.br,u_texsize:[W,H],u_mix:C.t,u_pattern_size_a:U.displaySize,u_pattern_size_b:q.displaySize,u_scale_a:C.fromScale,u_scale_b:C.toScale,u_tile_units_to_pixels:1/c.aC(N,1,O.transform.tileZoom),u_pixel_coord_upper:[ge>>16,me>>16],u_pixel_coord_lower:[65535&ge,65535&me]}})(u,b,t,m),{u_opacity:T}),Zl=(T,t)=>{},Qh={fillExtrusion:(T,t)=>({u_lightpos:new c.bT(T,t.u_lightpos),u_lightpos_globe:new c.bT(T,t.u_lightpos_globe),u_lightintensity:new c.bg(T,t.u_lightintensity),u_lightcolor:new c.bT(T,t.u_lightcolor),u_vertical_gradient:new c.bg(T,t.u_vertical_gradient),u_opacity:new c.bg(T,t.u_opacity),u_fill_translate:new c.bU(T,t.u_fill_translate)}),fillExtrusionPattern:(T,t)=>({u_lightpos:new c.bT(T,t.u_lightpos),u_lightpos_globe:new c.bT(T,t.u_lightpos_globe),u_lightintensity:new c.bg(T,t.u_lightintensity),u_lightcolor:new c.bT(T,t.u_lightcolor),u_vertical_gradient:new c.bg(T,t.u_vertical_gradient),u_height_factor:new c.bg(T,t.u_height_factor),u_opacity:new c.bg(T,t.u_opacity),u_fill_translate:new c.bU(T,t.u_fill_translate),u_image:new c.bP(T,t.u_image),u_texsize:new c.bU(T,t.u_texsize),u_pixel_coord_upper:new c.bU(T,t.u_pixel_coord_upper),u_pixel_coord_lower:new c.bU(T,t.u_pixel_coord_lower),u_scale:new c.bT(T,t.u_scale),u_fade:new c.bg(T,t.u_fade)}),fill:(T,t)=>({u_fill_translate:new c.bU(T,t.u_fill_translate)}),fillPattern:(T,t)=>({u_image:new c.bP(T,t.u_image),u_texsize:new c.bU(T,t.u_texsize),u_pixel_coord_upper:new c.bU(T,t.u_pixel_coord_upper),u_pixel_coord_lower:new c.bU(T,t.u_pixel_coord_lower),u_scale:new c.bT(T,t.u_scale),u_fade:new c.bg(T,t.u_fade),u_fill_translate:new c.bU(T,t.u_fill_translate)}),fillOutline:(T,t)=>({u_world:new c.bU(T,t.u_world),u_fill_translate:new c.bU(T,t.u_fill_translate)}),fillOutlinePattern:(T,t)=>({u_world:new c.bU(T,t.u_world),u_image:new c.bP(T,t.u_image),u_texsize:new c.bU(T,t.u_texsize),u_pixel_coord_upper:new c.bU(T,t.u_pixel_coord_upper),u_pixel_coord_lower:new c.bU(T,t.u_pixel_coord_lower),u_scale:new c.bT(T,t.u_scale),u_fade:new c.bg(T,t.u_fade),u_fill_translate:new c.bU(T,t.u_fill_translate)}),circle:(T,t)=>({u_camera_to_center_distance:new c.bg(T,t.u_camera_to_center_distance),u_scale_with_map:new c.bP(T,t.u_scale_with_map),u_pitch_with_map:new c.bP(T,t.u_pitch_with_map),u_extrude_scale:new c.bU(T,t.u_extrude_scale),u_device_pixel_ratio:new c.bg(T,t.u_device_pixel_ratio),u_globe_extrude_scale:new c.bg(T,t.u_globe_extrude_scale),u_translate:new c.bU(T,t.u_translate)}),collisionBox:(T,t)=>({u_pixel_extrude_scale:new c.bU(T,t.u_pixel_extrude_scale)}),collisionCircle:(T,t)=>({u_viewport_size:new c.bU(T,t.u_viewport_size)}),debug:(T,t)=>({u_color:new c.bQ(T,t.u_color),u_overlay:new c.bP(T,t.u_overlay),u_overlay_scale:new c.bg(T,t.u_overlay_scale)}),depth:Zl,clippingMask:Zl,heatmap:(T,t)=>({u_extrude_scale:new c.bg(T,t.u_extrude_scale),u_intensity:new c.bg(T,t.u_intensity),u_globe_extrude_scale:new c.bg(T,t.u_globe_extrude_scale)}),heatmapTexture:(T,t)=>({u_matrix:new c.bR(T,t.u_matrix),u_world:new c.bU(T,t.u_world),u_image:new c.bP(T,t.u_image),u_color_ramp:new c.bP(T,t.u_color_ramp),u_opacity:new c.bg(T,t.u_opacity)}),hillshade:(T,t)=>({u_image:new c.bP(T,t.u_image),u_latrange:new c.bU(T,t.u_latrange),u_exaggeration:new c.bg(T,t.u_exaggeration),u_altitudes:new c.b_(T,t.u_altitudes),u_azimuths:new c.b_(T,t.u_azimuths),u_accent:new c.bQ(T,t.u_accent),u_method:new c.bP(T,t.u_method),u_shadows:new c.bZ(T,t.u_shadows),u_highlights:new c.bZ(T,t.u_highlights)}),hillshadePrepare:(T,t)=>({u_matrix:new c.bR(T,t.u_matrix),u_image:new c.bP(T,t.u_image),u_dimension:new c.bU(T,t.u_dimension),u_zoom:new c.bg(T,t.u_zoom),u_unpack:new c.bS(T,t.u_unpack)}),colorRelief:(T,t)=>({u_image:new c.bP(T,t.u_image),u_unpack:new c.bS(T,t.u_unpack),u_dimension:new c.bU(T,t.u_dimension),u_elevation_stops:new c.bP(T,t.u_elevation_stops),u_color_stops:new c.bP(T,t.u_color_stops),u_color_ramp_size:new c.bP(T,t.u_color_ramp_size),u_opacity:new c.bg(T,t.u_opacity)}),line:(T,t)=>({u_translation:new c.bU(T,t.u_translation),u_ratio:new c.bg(T,t.u_ratio),u_device_pixel_ratio:new c.bg(T,t.u_device_pixel_ratio),u_units_to_pixels:new c.bU(T,t.u_units_to_pixels)}),lineGradient:(T,t)=>({u_translation:new c.bU(T,t.u_translation),u_ratio:new c.bg(T,t.u_ratio),u_device_pixel_ratio:new c.bg(T,t.u_device_pixel_ratio),u_units_to_pixels:new c.bU(T,t.u_units_to_pixels),u_image:new c.bP(T,t.u_image),u_image_height:new c.bg(T,t.u_image_height)}),linePattern:(T,t)=>({u_translation:new c.bU(T,t.u_translation),u_texsize:new c.bU(T,t.u_texsize),u_ratio:new c.bg(T,t.u_ratio),u_device_pixel_ratio:new c.bg(T,t.u_device_pixel_ratio),u_image:new c.bP(T,t.u_image),u_units_to_pixels:new c.bU(T,t.u_units_to_pixels),u_scale:new c.bT(T,t.u_scale),u_fade:new c.bg(T,t.u_fade)}),lineSDF:(T,t)=>({u_translation:new c.bU(T,t.u_translation),u_ratio:new c.bg(T,t.u_ratio),u_device_pixel_ratio:new c.bg(T,t.u_device_pixel_ratio),u_units_to_pixels:new c.bU(T,t.u_units_to_pixels),u_patternscale_a:new c.bU(T,t.u_patternscale_a),u_patternscale_b:new c.bU(T,t.u_patternscale_b),u_sdfgamma:new c.bg(T,t.u_sdfgamma),u_image:new c.bP(T,t.u_image),u_tex_y_a:new c.bg(T,t.u_tex_y_a),u_tex_y_b:new c.bg(T,t.u_tex_y_b),u_mix:new c.bg(T,t.u_mix)}),raster:(T,t)=>({u_tl_parent:new c.bU(T,t.u_tl_parent),u_scale_parent:new c.bg(T,t.u_scale_parent),u_buffer_scale:new c.bg(T,t.u_buffer_scale),u_fade_t:new c.bg(T,t.u_fade_t),u_opacity:new c.bg(T,t.u_opacity),u_image0:new c.bP(T,t.u_image0),u_image1:new c.bP(T,t.u_image1),u_brightness_low:new c.bg(T,t.u_brightness_low),u_brightness_high:new c.bg(T,t.u_brightness_high),u_saturation_factor:new c.bg(T,t.u_saturation_factor),u_contrast_factor:new c.bg(T,t.u_contrast_factor),u_spin_weights:new c.bT(T,t.u_spin_weights),u_coords_top:new c.bS(T,t.u_coords_top),u_coords_bottom:new c.bS(T,t.u_coords_bottom)}),symbolIcon:(T,t)=>({u_is_size_zoom_constant:new c.bP(T,t.u_is_size_zoom_constant),u_is_size_feature_constant:new c.bP(T,t.u_is_size_feature_constant),u_size_t:new c.bg(T,t.u_size_t),u_size:new c.bg(T,t.u_size),u_camera_to_center_distance:new c.bg(T,t.u_camera_to_center_distance),u_pitch:new c.bg(T,t.u_pitch),u_rotate_symbol:new c.bP(T,t.u_rotate_symbol),u_aspect_ratio:new c.bg(T,t.u_aspect_ratio),u_fade_change:new c.bg(T,t.u_fade_change),u_label_plane_matrix:new c.bR(T,t.u_label_plane_matrix),u_coord_matrix:new c.bR(T,t.u_coord_matrix),u_is_text:new c.bP(T,t.u_is_text),u_pitch_with_map:new c.bP(T,t.u_pitch_with_map),u_is_along_line:new c.bP(T,t.u_is_along_line),u_is_variable_anchor:new c.bP(T,t.u_is_variable_anchor),u_texsize:new c.bU(T,t.u_texsize),u_texture:new c.bP(T,t.u_texture),u_translation:new c.bU(T,t.u_translation),u_pitched_scale:new c.bg(T,t.u_pitched_scale)}),symbolSDF:(T,t)=>({u_is_size_zoom_constant:new c.bP(T,t.u_is_size_zoom_constant),u_is_size_feature_constant:new c.bP(T,t.u_is_size_feature_constant),u_size_t:new c.bg(T,t.u_size_t),u_size:new c.bg(T,t.u_size),u_camera_to_center_distance:new c.bg(T,t.u_camera_to_center_distance),u_pitch:new c.bg(T,t.u_pitch),u_rotate_symbol:new c.bP(T,t.u_rotate_symbol),u_aspect_ratio:new c.bg(T,t.u_aspect_ratio),u_fade_change:new c.bg(T,t.u_fade_change),u_label_plane_matrix:new c.bR(T,t.u_label_plane_matrix),u_coord_matrix:new c.bR(T,t.u_coord_matrix),u_is_text:new c.bP(T,t.u_is_text),u_pitch_with_map:new c.bP(T,t.u_pitch_with_map),u_is_along_line:new c.bP(T,t.u_is_along_line),u_is_variable_anchor:new c.bP(T,t.u_is_variable_anchor),u_texsize:new c.bU(T,t.u_texsize),u_texture:new c.bP(T,t.u_texture),u_gamma_scale:new c.bg(T,t.u_gamma_scale),u_device_pixel_ratio:new c.bg(T,t.u_device_pixel_ratio),u_is_halo:new c.bP(T,t.u_is_halo),u_translation:new c.bU(T,t.u_translation),u_pitched_scale:new c.bg(T,t.u_pitched_scale)}),symbolTextAndIcon:(T,t)=>({u_is_size_zoom_constant:new c.bP(T,t.u_is_size_zoom_constant),u_is_size_feature_constant:new c.bP(T,t.u_is_size_feature_constant),u_size_t:new c.bg(T,t.u_size_t),u_size:new c.bg(T,t.u_size),u_camera_to_center_distance:new c.bg(T,t.u_camera_to_center_distance),u_pitch:new c.bg(T,t.u_pitch),u_rotate_symbol:new c.bP(T,t.u_rotate_symbol),u_aspect_ratio:new c.bg(T,t.u_aspect_ratio),u_fade_change:new c.bg(T,t.u_fade_change),u_label_plane_matrix:new c.bR(T,t.u_label_plane_matrix),u_coord_matrix:new c.bR(T,t.u_coord_matrix),u_is_text:new c.bP(T,t.u_is_text),u_pitch_with_map:new c.bP(T,t.u_pitch_with_map),u_is_along_line:new c.bP(T,t.u_is_along_line),u_is_variable_anchor:new c.bP(T,t.u_is_variable_anchor),u_texsize:new c.bU(T,t.u_texsize),u_texsize_icon:new c.bU(T,t.u_texsize_icon),u_texture:new c.bP(T,t.u_texture),u_texture_icon:new c.bP(T,t.u_texture_icon),u_gamma_scale:new c.bg(T,t.u_gamma_scale),u_device_pixel_ratio:new c.bg(T,t.u_device_pixel_ratio),u_is_halo:new c.bP(T,t.u_is_halo),u_translation:new c.bU(T,t.u_translation),u_pitched_scale:new c.bg(T,t.u_pitched_scale)}),background:(T,t)=>({u_opacity:new c.bg(T,t.u_opacity),u_color:new c.bQ(T,t.u_color)}),backgroundPattern:(T,t)=>({u_opacity:new c.bg(T,t.u_opacity),u_image:new c.bP(T,t.u_image),u_pattern_tl_a:new c.bU(T,t.u_pattern_tl_a),u_pattern_br_a:new c.bU(T,t.u_pattern_br_a),u_pattern_tl_b:new c.bU(T,t.u_pattern_tl_b),u_pattern_br_b:new c.bU(T,t.u_pattern_br_b),u_texsize:new c.bU(T,t.u_texsize),u_mix:new c.bg(T,t.u_mix),u_pattern_size_a:new c.bU(T,t.u_pattern_size_a),u_pattern_size_b:new c.bU(T,t.u_pattern_size_b),u_scale_a:new c.bg(T,t.u_scale_a),u_scale_b:new c.bg(T,t.u_scale_b),u_pixel_coord_upper:new c.bU(T,t.u_pixel_coord_upper),u_pixel_coord_lower:new c.bU(T,t.u_pixel_coord_lower),u_tile_units_to_pixels:new c.bg(T,t.u_tile_units_to_pixels)}),terrain:(T,t)=>({u_texture:new c.bP(T,t.u_texture),u_ele_delta:new c.bg(T,t.u_ele_delta),u_fog_matrix:new c.bR(T,t.u_fog_matrix),u_fog_color:new c.bQ(T,t.u_fog_color),u_fog_ground_blend:new c.bg(T,t.u_fog_ground_blend),u_fog_ground_blend_opacity:new c.bg(T,t.u_fog_ground_blend_opacity),u_horizon_color:new c.bQ(T,t.u_horizon_color),u_horizon_fog_blend:new c.bg(T,t.u_horizon_fog_blend),u_is_globe_mode:new c.bg(T,t.u_is_globe_mode)}),terrainDepth:(T,t)=>({u_ele_delta:new c.bg(T,t.u_ele_delta)}),terrainCoords:(T,t)=>({u_texture:new c.bP(T,t.u_texture),u_terrain_coords_id:new c.bg(T,t.u_terrain_coords_id),u_ele_delta:new c.bg(T,t.u_ele_delta)}),projectionErrorMeasurement:(T,t)=>({u_input:new c.bg(T,t.u_input),u_output_expected:new c.bg(T,t.u_output_expected)}),atmosphere:(T,t)=>({u_sun_pos:new c.bT(T,t.u_sun_pos),u_atmosphere_blend:new c.bg(T,t.u_atmosphere_blend),u_globe_position:new c.bT(T,t.u_globe_position),u_globe_radius:new c.bg(T,t.u_globe_radius),u_inv_proj_matrix:new c.bR(T,t.u_inv_proj_matrix)}),sky:(T,t)=>({u_sky_color:new c.bQ(T,t.u_sky_color),u_horizon_color:new c.bQ(T,t.u_horizon_color),u_horizon:new c.bU(T,t.u_horizon),u_horizon_normal:new c.bU(T,t.u_horizon_normal),u_sky_horizon_blend:new c.bg(T,t.u_sky_horizon_blend),u_sky_blend:new c.bg(T,t.u_sky_blend)})};class ul{constructor(t,u,m){this.context=t;const b=t.gl;this.buffer=b.createBuffer(),this.dynamicDraw=!!m,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||delete u.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const u=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),u.bufferSubData(u.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const ra={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Es{constructor(t,u,m,b){this.length=u.length,this.attributes=m,this.itemSize=u.bytesPerElement,this.dynamicDraw=b,this.context=t;const S=t.gl;this.buffer=S.createBuffer(),t.bindVertexBuffer.set(this.buffer),S.bufferData(S.ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?S.DYNAMIC_DRAW:S.STATIC_DRAW),this.dynamicDraw||delete u.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const u=this.context.gl;this.bind(),u.bufferSubData(u.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,u){for(let m=0;m<this.attributes.length;m++){const b=u.attributes[this.attributes[m].name];b!==void 0&&t.enableVertexAttribArray(b)}}setVertexAttribPointers(t,u,m){for(let b=0;b<this.attributes.length;b++){const S=this.attributes[b],C=u.attributes[S.name];C!==void 0&&t.vertexAttribPointer(C,S.components,t[ra[S.type]],!1,this.itemSize,S.offset+this.itemSize*(m||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class oi{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class mu extends oi{getDefault(){return c.bf.transparent}set(t){const u=this.current;(t.r!==u.r||t.g!==u.g||t.b!==u.b||t.a!==u.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Wu extends oi{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Ku extends oi{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class cl extends oi{getDefault(){return[!0,!0,!0,!0]}set(t){const u=this.current;(t[0]!==u[0]||t[1]!==u[1]||t[2]!==u[2]||t[3]!==u[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class hl extends oi{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class dl extends oi{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class fh extends oi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const u=this.current;(t.func!==u.func||t.ref!==u.ref||t.mask!==u.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class Dc extends oi{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const u=this.current;(t[0]!==u[0]||t[1]!==u[1]||t[2]!==u[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class Yu extends oi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const u=this.gl;t?u.enable(u.STENCIL_TEST):u.disable(u.STENCIL_TEST),this.current=t,this.dirty=!1}}class qd extends oi{getDefault(){return[0,1]}set(t){const u=this.current;(t[0]!==u[0]||t[1]!==u[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class Ol extends oi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const u=this.gl;t?u.enable(u.DEPTH_TEST):u.disable(u.DEPTH_TEST),this.current=t,this.dirty=!1}}class Qu extends oi{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class zc extends oi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const u=this.gl;t?u.enable(u.BLEND):u.disable(u.BLEND),this.current=t,this.dirty=!1}}class Oc extends oi{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const u=this.current;(t[0]!==u[0]||t[1]!==u[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class aa extends oi{getDefault(){return c.bf.transparent}set(t){const u=this.current;(t.r!==u.r||t.g!==u.g||t.b!==u.b||t.a!==u.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Hl extends oi{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class ph extends oi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const u=this.gl;t?u.enable(u.CULL_FACE):u.disable(u.CULL_FACE),this.current=t,this.dirty=!1}}class Lo extends oi{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class Nc extends oi{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class gu extends oi{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class ho extends oi{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class _u extends oi{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const u=this.current;(t[0]!==u[0]||t[1]!==u[1]||t[2]!==u[2]||t[3]!==u[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Jh extends oi{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const u=this.gl;u.bindFramebuffer(u.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class fl extends oi{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const u=this.gl;u.bindRenderbuffer(u.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class pa extends oi{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const u=this.gl;u.bindTexture(u.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class Xl extends oi{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const u=this.gl;u.bindBuffer(u.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class ts extends oi{getDefault(){return null}set(t){const u=this.gl;u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class ma extends oi{getDefault(){return null}set(t){var u;if(t===this.current&&!this.dirty)return;const m=this.gl;Yr(m)?m.bindVertexArray(t):(u=m.getExtension("OES_vertex_array_object"))===null||u===void 0||u.bindVertexArrayOES(t),this.current=t,this.dirty=!1}}class yu extends oi{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class Ju extends oi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class Qs extends oi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class pl extends oi{constructor(t,u){super(t),this.context=t,this.parent=u}getDefault(){return null}}class ko extends pl{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Wl extends pl{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferRenderbuffer(u.FRAMEBUFFER,u.DEPTH_ATTACHMENT,u.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class qn extends pl{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferRenderbuffer(u.FRAMEBUFFER,u.DEPTH_STENCIL_ATTACHMENT,u.RENDERBUFFER,t),this.current=t,this.dirty=!1}}const Do="Framebuffer is not complete";class zf{constructor(t,u,m,b,S){this.context=t,this.width=u,this.height=m;const C=t.gl,O=this.framebuffer=C.createFramebuffer();if(this.colorAttachment=new ko(t,O),b)this.depthAttachment=S?new qn(t,O):new Wl(t,O);else if(S)throw new Error("Stencil cannot be set without depth");if(C.checkFramebufferStatus(C.FRAMEBUFFER)!==C.FRAMEBUFFER_COMPLETE)throw new Error(Do)}destroy(){const t=this.context.gl,u=this.colorAttachment.get();if(u&&t.deleteTexture(u),this.depthAttachment){const m=this.depthAttachment.get();m&&t.deleteRenderbuffer(m)}t.deleteFramebuffer(this.framebuffer)}}class ns{constructor(t){var u,m;if(this.gl=t,this.clearColor=new mu(this),this.clearDepth=new Wu(this),this.clearStencil=new Ku(this),this.colorMask=new cl(this),this.depthMask=new hl(this),this.stencilMask=new dl(this),this.stencilFunc=new fh(this),this.stencilOp=new Dc(this),this.stencilTest=new Yu(this),this.depthRange=new qd(this),this.depthTest=new Ol(this),this.depthFunc=new Qu(this),this.blend=new zc(this),this.blendFunc=new Oc(this),this.blendColor=new aa(this),this.blendEquation=new Hl(this),this.cullFace=new ph(this),this.cullFaceSide=new Lo(this),this.frontFace=new Nc(this),this.program=new gu(this),this.activeTexture=new ho(this),this.viewport=new _u(this),this.bindFramebuffer=new Jh(this),this.bindRenderbuffer=new fl(this),this.bindTexture=new pa(this),this.bindVertexBuffer=new Xl(this),this.bindElementBuffer=new ts(this),this.bindVertexArray=new ma(this),this.pixelStoreUnpack=new yu(this),this.pixelStoreUnpackPremultiplyAlpha=new Ju(this),this.pixelStoreUnpackFlipY=new Qs(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),Yr(t)){this.HALF_FLOAT=t.HALF_FLOAT;const b=t.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(u=t.RGBA16F)!==null&&u!==void 0?u:b==null?void 0:b.RGBA16F_EXT,this.RGB16F=(m=t.RGB16F)!==null&&m!==void 0?m:b==null?void 0:b.RGB16F_EXT,t.getExtension("EXT_color_buffer_float")}else{t.getExtension("EXT_color_buffer_half_float"),t.getExtension("OES_texture_half_float_linear");const b=t.getExtension("OES_texture_half_float");this.HALF_FLOAT=b==null?void 0:b.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,u){return new ul(this,t,u)}createVertexBuffer(t,u,m){return new Es(this,t,u,m)}createRenderbuffer(t,u,m){const b=this.gl,S=b.createRenderbuffer();return this.bindRenderbuffer.set(S),b.renderbufferStorage(b.RENDERBUFFER,t,u,m),this.bindRenderbuffer.set(null),S}createFramebuffer(t,u,m,b){return new zf(this,t,u,m,b)}clear({color:t,depth:u,stencil:m}){const b=this.gl;let S=0;t&&(S|=b.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),u!==void 0&&(S|=b.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(u),this.depthMask.set(!0)),m!==void 0&&(S|=b.STENCIL_BUFFER_BIT,this.clearStencil.set(m),this.stencilMask.set(255)),b.clear(S)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){c.bH(t.blendFunction,bn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}createVertexArray(){var t;return Yr(this.gl)?this.gl.createVertexArray():(t=this.gl.getExtension("OES_vertex_array_object"))===null||t===void 0?void 0:t.createVertexArrayOES()}deleteVertexArray(t){var u;return Yr(this.gl)?this.gl.deleteVertexArray(t):(u=this.gl.getExtension("OES_vertex_array_object"))===null||u===void 0?void 0:u.deleteVertexArrayOES(t)}unbindVAO(){this.bindVertexArray.set(null)}}let zo;function Oo(T,t,u,m,b){const S=T.context,C=T.transform,O=S.gl,N=T.useProgram("collisionBox"),U=[];let q=0,W=0;for(let ve=0;ve<m.length;ve++){const we=m[ve],Ie=t.getTile(we).getBucket(u);if(!Ie)continue;const Ce=b?Ie.textCollisionBox:Ie.iconCollisionBox,ze=Ie.collisionCircleArray;ze.length>0&&(U.push({circleArray:ze,circleOffset:W,coord:we}),q+=ze.length/4,W=q),Ce&&N.draw(S,O.LINES,sn.disabled,$n.disabled,T.colorModeForRenderPass(),fn.disabled,Ts(T.transform),T.style.map.terrain&&T.style.map.terrain.getTerrainData(we),C.getProjectionData({overscaledTileID:we,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),u.id,Ce.layoutVertexBuffer,Ce.indexBuffer,Ce.segments,null,T.transform.zoom,null,null,Ce.collisionVertexBuffer)}if(!b||!U.length)return;const H=T.useProgram("collisionCircle"),J=new c.b$;J.resize(4*q),J._trim();let ae=0;for(const ve of U)for(let we=0;we<ve.circleArray.length/4;we++){const Ie=4*we,Ce=ve.circleArray[Ie+0],ze=ve.circleArray[Ie+1],Ve=ve.circleArray[Ie+2],Me=ve.circleArray[Ie+3];J.emplace(ae++,Ce,ze,Ve,Me,0),J.emplace(ae++,Ce,ze,Ve,Me,1),J.emplace(ae++,Ce,ze,Ve,Me,2),J.emplace(ae++,Ce,ze,Ve,Me,3)}(!zo||zo.length<2*q)&&(zo=(function(ve){const we=2*ve,Ie=new c.c1;Ie.resize(we),Ie._trim();for(let Ce=0;Ce<we;Ce++){const ze=6*Ce;Ie.uint16[ze+0]=4*Ce+0,Ie.uint16[ze+1]=4*Ce+1,Ie.uint16[ze+2]=4*Ce+2,Ie.uint16[ze+3]=4*Ce+2,Ie.uint16[ze+4]=4*Ce+3,Ie.uint16[ze+5]=4*Ce+0}return Ie})(q));const ge=S.createIndexBuffer(zo,!0),me=S.createVertexBuffer(J,c.c0.members,!0);for(const ve of U){const we=du(T.transform);H.draw(S,O.TRIANGLES,sn.disabled,$n.disabled,T.colorModeForRenderPass(),fn.disabled,we,T.style.map.terrain&&T.style.map.terrain.getTerrainData(ve.coord),null,u.id,me,ge,c.aM.simpleSegment(0,2*ve.circleOffset,ve.circleArray.length,ve.circleArray.length/2),null,T.transform.zoom,null,null,null)}me.destroy(),ge.destroy()}const ed=c.ag(new Float32Array(16));function ec(T,t,u,m,b,S){const{horizontalAlign:C,verticalAlign:O}=c.aH(T);return new c.P((-(C-.5)*t/b+m[0])*S,(-(O-.5)*u/b+m[1])*S)}function vu(T,t,u,m,b,S){const C=t.tileAnchorPoint.add(new c.P(t.translation[0],t.translation[1]));if(t.pitchWithMap){let O=m.mult(S);u||(O=O.rotate(-b));const N=C.add(O);return vr(N.x,N.y,t.pitchedLabelPlaneMatrix,t.getElevation).point}if(u){const O=nr(t.tileAnchorPoint.x+1,t.tileAnchorPoint.y,t).point.sub(T),N=Math.atan(O.y/O.x)+(O.x<0?Math.PI:0);return T.add(m.rotate(N))}return T.add(m)}function tc(T,t,u,m,b,S,C,O,N,U,q,W){const H=T.text.placedSymbolArray,J=T.text.dynamicLayoutVertexArray,ae=T.icon.dynamicLayoutVertexArray,ge={};J.clear();for(let me=0;me<H.length;me++){const ve=H.get(me),we=ve.hidden||!ve.crossTileID||T.allowVerticalPlacement&&!ve.placedOrientation?null:m[ve.crossTileID];if(we){const Ie=new c.P(ve.anchorX,ve.anchorY),Ce={getElevation:W,width:b.width,height:b.height,pitchedLabelPlaneMatrix:S,pitchWithMap:u,transform:b,tileAnchorPoint:Ie,translation:U,unwrappedTileID:q},ze=u?Eo(Ie.x,Ie.y,Ce):nr(Ie.x,Ie.y,Ce),Ve=Pt(b.cameraToCenterDistance,ze.signedDistanceFromCamera);let Me=c.ap(T.textSizeData,O,ve)*Ve/c.aB;u&&(Me*=T.tilePixelRatio/C);const{width:Ye,height:ct,anchor:rt,textOffset:st,textBoxScale:lt}=we,Nt=ec(rt,Ye,ct,st,lt,Me),Vt=b.getPitchedTextCorrection(Ie.x+U[0],Ie.y+U[1],q),At=vu(ze.point,Ce,t,Nt,-b.bearingInRadians,Vt),ln=T.allowVerticalPlacement&&ve.placedOrientation===c.ao.vertical?Math.PI/2:0;for(let Zn=0;Zn<ve.numGlyphs;Zn++)c.av(J,At,ln);N&&ve.associatedIconIndex>=0&&(ge[ve.associatedIconIndex]={shiftedAnchor:At,angle:ln})}else qr(ve.numGlyphs,J)}if(N){ae.clear();const me=T.icon.placedSymbolArray;for(let ve=0;ve<me.length;ve++){const we=me.get(ve);if(we.hidden)qr(we.numGlyphs,ae);else{const Ie=ge[ve];if(Ie)for(let Ce=0;Ce<we.numGlyphs;Ce++)c.av(ae,Ie.shiftedAnchor,Ie.angle);else qr(we.numGlyphs,ae)}}T.icon.dynamicLayoutVertexBuffer.updateData(ae)}T.text.dynamicLayoutVertexBuffer.updateData(J)}function nc(T,t,u){return u.iconsInText&&t?"symbolTextAndIcon":T?"symbolSDF":"symbolIcon"}function bu(T,t,u,m,b,S,C,O,N,U,q,W,H){const J=T.context,ae=J.gl,ge=T.transform,me=O==="map",ve=N==="map",we=O!=="viewport"&&u.layout.get("symbol-placement")!=="point",Ie=me&&!ve&&!we,Ce=!u.layout.get("symbol-sort-key").isConstant();let ze=!1;const Ve=T.getDepthModeForSublayer(0,sn.ReadOnly),Me=u._unevaluatedLayout.hasValue("text-variable-anchor")||u._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Ye=[],ct=ge.getCircleRadiusCorrection();for(const rt of m){const st=t.getTile(rt),lt=st.getBucket(u);if(!lt)continue;const Nt=b?lt.text:lt.icon;if(!Nt||!Nt.segments.get().length||!Nt.hasVisibleVertices)continue;const Vt=Nt.programConfigurations.get(u.id),At=b||lt.sdfIcons,ln=b?lt.textSizeData:lt.iconSizeData,Zn=ve||ge.pitch!==0,vi=T.useProgram(nc(At,b,lt),Vt),Wi=c.an(ln,ge.zoom),ji=T.style.map.terrain&&T.style.map.terrain.getTerrainData(rt);let Ir,Br,Un,lr,sa=[0,0],Fr=null;if(b)Br=st.glyphAtlasTexture,Un=ae.LINEAR,Ir=st.glyphAtlasTexture.size,lt.iconsInText&&(sa=st.imageAtlasTexture.size,Fr=st.imageAtlasTexture,lr=Zn||T.options.rotating||T.options.zooming||ln.kind==="composite"||ln.kind==="camera"?ae.LINEAR:ae.NEAREST);else{const oa=u.layout.get("icon-size").constantOr(0)!==1||lt.iconsNeedLinear;Br=st.imageAtlasTexture,Un=At||T.options.rotating||T.options.zooming||oa||Zn?ae.LINEAR:ae.NEAREST,Ir=st.imageAtlasTexture.size}const La=c.aC(st,1,T.transform.zoom),Wa=Cr(me,T.transform,La),po=c.L();c.aq(po,Wa);const Mu=Vn(ve,me,T.transform,La),iu=c.aD(ge,st,S,C),Th=ge.getProjectionData({overscaledTileID:rt,applyGlobeMatrix:!H,applyTerrainMatrix:!0}),qc=Me&&lt.hasTextData(),fc=u.layout.get("icon-text-fit")!=="none"&&qc&&lt.hasIconData();if(we){const oa=T.style.map.terrain?(qo,ua)=>T.style.map.terrain.getElevation(rt,qo,ua):null,la=u.layout.get("text-rotation-alignment")==="map";tr(lt,T,b,Wa,po,ve,U,la,rt.toUnwrapped(),ge.width,ge.height,iu,oa)}const pc=b&&Me||fc,to=we||pc?ed:ve?Wa:T.transform.clipSpaceToPixelsMatrix,vl=At&&u.paint.get(b?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let ss;ss=At?lt.iconsInText?Ud(ln.kind,Wi,Ie,ve,we,pc,T,to,Mu,iu,Ir,sa,ct):kc(ln.kind,Wi,Ie,ve,we,pc,T,to,Mu,iu,b,Ir,0,ct):Xu(ln.kind,Wi,Ie,ve,we,pc,T,to,Mu,iu,b,Ir,ct);const Iu={program:vi,buffers:Nt,uniformValues:ss,projectionData:Th,atlasTexture:Br,atlasTextureIcon:Fr,atlasInterpolation:Un,atlasInterpolationIcon:lr,isSDF:At,hasHalo:vl};if(Ce&&lt.canOverlap){ze=!0;const oa=Nt.segments.get();for(const la of oa)Ye.push({segments:new c.aM([la]),sortKey:la.sortKey,state:Iu,terrainData:ji})}else Ye.push({segments:Nt.segments,sortKey:0,state:Iu,terrainData:ji})}ze&&Ye.sort(((rt,st)=>rt.sortKey-st.sortKey));for(const rt of Ye){const st=rt.state;if(J.activeTexture.set(ae.TEXTURE0),st.atlasTexture.bind(st.atlasInterpolation,ae.CLAMP_TO_EDGE),st.atlasTextureIcon&&(J.activeTexture.set(ae.TEXTURE1),st.atlasTextureIcon&&st.atlasTextureIcon.bind(st.atlasInterpolationIcon,ae.CLAMP_TO_EDGE)),st.isSDF){const lt=st.uniformValues;st.hasHalo&&(lt.u_is_halo=1,f(st.buffers,rt.segments,u,T,st.program,Ve,q,W,lt,st.projectionData,rt.terrainData)),lt.u_is_halo=0}f(st.buffers,rt.segments,u,T,st.program,Ve,q,W,st.uniformValues,st.projectionData,rt.terrainData)}}function f(T,t,u,m,b,S,C,O,N,U,q){const W=m.context;b.draw(W,W.gl.TRIANGLES,S,C,O,fn.backCCW,N,q,U,u.id,T.layoutVertexBuffer,T.indexBuffer,t,u.paint,m.transform.zoom,T.programConfigurations.get(u.id),T.dynamicLayoutVertexBuffer,T.opacityVertexBuffer)}function x(T,t,u,m,b){const S=T.context,C=S.gl,O=$n.disabled,N=new bn([C.ONE,C.ONE],c.bf.transparent,[!0,!0,!0,!0]),U=t.getBucket(u);if(!U)return;const q=m.key;let W=u.heatmapFbos.get(q);W||(W=V(S,t.tileSize,t.tileSize),u.heatmapFbos.set(q,W)),S.bindFramebuffer.set(W.framebuffer),S.viewport.set([0,0,t.tileSize,t.tileSize]),S.clear({color:c.bf.transparent});const H=U.programConfigurations.get(u.id),J=T.useProgram("heatmap",H,!b),ae=T.transform.getProjectionData({overscaledTileID:t.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),ge=T.style.map.terrain.getTerrainData(m);J.draw(S,C.TRIANGLES,sn.disabled,O,N,fn.disabled,fu(t,T.transform.zoom,u.paint.get("heatmap-intensity"),1),ge,ae,u.id,U.layoutVertexBuffer,U.indexBuffer,U.segments,u.paint,T.transform.zoom,H)}function R(T,t,u,m,b){const S=T.context,C=S.gl,O=T.transform;S.setColorMode(T.colorModeForRenderPass());const N=K(S,t),U=u.key,q=t.heatmapFbos.get(U);if(!q)return;S.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,q.colorAttachment.get()),S.activeTexture.set(C.TEXTURE1),N.bind(C.LINEAR,C.CLAMP_TO_EDGE);const W=O.getProjectionData({overscaledTileID:u,applyTerrainMatrix:b,applyGlobeMatrix:!m});T.useProgram("heatmapTexture").draw(S,C.TRIANGLES,sn.disabled,$n.disabled,T.colorModeForRenderPass(),fn.disabled,Ks(T,t,0,1),null,W,t.id,T.rasterBoundsBuffer,T.quadTriangleIndexBuffer,T.rasterBoundsSegments,t.paint,O.zoom),q.destroy(),t.heatmapFbos.delete(U)}function V(T,t,u){var m,b;const S=T.gl,C=S.createTexture();S.bindTexture(S.TEXTURE_2D,C),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_WRAP_S,S.CLAMP_TO_EDGE),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_WRAP_T,S.CLAMP_TO_EDGE),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_MIN_FILTER,S.LINEAR),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_MAG_FILTER,S.LINEAR);const O=(m=T.HALF_FLOAT)!==null&&m!==void 0?m:S.UNSIGNED_BYTE,N=(b=T.RGBA16F)!==null&&b!==void 0?b:S.RGBA;S.texImage2D(S.TEXTURE_2D,0,N,t,u,0,S.RGBA,O,null);const U=T.createFramebuffer(t,u,!1,!1);return U.colorAttachment.set(C),U}function K(T,t){return t.colorRampTexture||(t.colorRampTexture=new c.T(T,t.colorRamp,T.gl.RGBA)),t.colorRampTexture}function ue(T,t,u,m,b){if(!u||!m||!m.imageAtlas)return;const S=m.imageAtlas.patternPositions;let C=S[u.to.toString()],O=S[u.from.toString()];if(!C&&O&&(C=O),!O&&C&&(O=C),!C||!O){const N=b.getPaintProperty(t);C=S[N],O=S[N]}C&&O&&T.setConstantPatternPositions(C,O)}function Oe(T,t,u,m,b,S,C,O){const N=T.context.gl,U="fill-pattern",q=u.paint.get(U),W=q&&q.constantOr(1),H=u.getCrossfadeParameters();let J,ae,ge,me,ve;const we=T.transform,Ie=u.paint.get("fill-translate"),Ce=u.paint.get("fill-translate-anchor");C?(ae=W&&!u.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",J=N.LINES):(ae=W?"fillPattern":"fill",J=N.TRIANGLES);const ze=q.constantOr(null);for(const Ve of m){const Me=t.getTile(Ve);if(W&&!Me.patternsLoaded())continue;const Ye=Me.getBucket(u);if(!Ye)continue;const ct=Ye.programConfigurations.get(u.id),rt=T.useProgram(ae,ct),st=T.style.map.terrain&&T.style.map.terrain.getTerrainData(Ve);W&&(T.context.activeTexture.set(N.TEXTURE0),Me.imageAtlasTexture.bind(N.LINEAR,N.CLAMP_TO_EDGE),ct.updatePaintBuffers(H)),ue(ct,U,ze,Me,u);const lt=we.getProjectionData({overscaledTileID:Ve,applyGlobeMatrix:!O,applyTerrainMatrix:!0}),Nt=c.aD(we,Me,Ie,Ce);if(C){me=Ye.indexBuffer2,ve=Ye.segments2;const At=[N.drawingBufferWidth,N.drawingBufferHeight];ge=ae==="fillOutlinePattern"&&W?Ga(T,H,Me,At,Nt):qa(At,Nt)}else me=Ye.indexBuffer,ve=Ye.segments,ge=W?Xi(T,H,Me,Nt):{u_fill_translate:Nt};const Vt=T.stencilModeForClipping(Ve);rt.draw(T.context,J,b,Vt,S,fn.backCCW,ge,st,lt,u.id,Ye.layoutVertexBuffer,me,ve,u.paint,T.transform.zoom,ct)}}function nt(T,t,u,m,b,S,C,O){const N=T.context,U=N.gl,q="fill-extrusion-pattern",W=u.paint.get(q),H=W.constantOr(1),J=u.getCrossfadeParameters(),ae=u.paint.get("fill-extrusion-opacity"),ge=W.constantOr(null),me=T.transform;for(const ve of m){const we=t.getTile(ve),Ie=we.getBucket(u);if(!Ie)continue;const Ce=T.style.map.terrain&&T.style.map.terrain.getTerrainData(ve),ze=Ie.programConfigurations.get(u.id),Ve=T.useProgram(H?"fillExtrusionPattern":"fillExtrusion",ze);H&&(T.context.activeTexture.set(U.TEXTURE0),we.imageAtlasTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),ze.updatePaintBuffers(J));const Me=me.getProjectionData({overscaledTileID:ve,applyGlobeMatrix:!O,applyTerrainMatrix:!0});ue(ze,q,ge,we,u);const Ye=c.aD(me,we,u.paint.get("fill-extrusion-translate"),u.paint.get("fill-extrusion-translate-anchor")),ct=u.paint.get("fill-extrusion-vertical-gradient"),rt=H?wi(T,ct,ae,Ye,ve,J,we):Wn(T,ct,ae,Ye);Ve.draw(N,N.gl.TRIANGLES,b,S,C,fn.backCCW,rt,Ce,Me,u.id,Ie.layoutVertexBuffer,Ie.indexBuffer,Ie.segments,u.paint,T.transform.zoom,ze,T.style.map.terrain&&Ie.centroidVertexBuffer)}}function ut(T,t,u,m,b,S,C,O,N){var U;const q=T.style.projection,W=T.context,H=T.transform,J=W.gl,ae=[`#define NUM_ILLUMINATION_SOURCES ${u.paint.get("hillshade-highlight-color").values.length}`],ge=T.useProgram("hillshade",null,!1,ae),me=!T.options.moving;for(const ve of m){const we=t.getTile(ve),Ie=we.fbo;if(!Ie)continue;const Ce=q.getMeshFromTileID(W,ve.canonical,O,!0,"raster"),ze=(U=T.style.map.terrain)===null||U===void 0?void 0:U.getTerrainData(ve);W.activeTexture.set(J.TEXTURE0),J.bindTexture(J.TEXTURE_2D,Ie.colorAttachment.get());const Ve=H.getProjectionData({overscaledTileID:ve,aligned:me,applyGlobeMatrix:!N,applyTerrainMatrix:!0});ge.draw(W,J.TRIANGLES,S,b[ve.overscaledZ],C,fn.backCCW,qu(T,we,u),ze,Ve,u.id,Ce.vertexBuffer,Ce.indexBuffer,Ce.segments)}}function Mt(T,t,u,m,b,S,C,O,N){var U;const q=T.style.projection,W=T.context,H=T.transform,J=W.gl,ae=T.useProgram("colorRelief"),ge=!T.options.moving;let me=!0,ve=0;for(const we of m){const Ie=t.getTile(we),Ce=Ie.dem;if(me){const rt=J.getParameter(J.MAX_TEXTURE_SIZE),{elevationTexture:st,colorTexture:lt}=u.getColorRampTextures(W,rt,Ce.getUnpackVector());W.activeTexture.set(J.TEXTURE1),st.bind(J.NEAREST,J.CLAMP_TO_EDGE),W.activeTexture.set(J.TEXTURE4),lt.bind(J.LINEAR,J.CLAMP_TO_EDGE),me=!1,ve=st.size[0]}if(!Ce||!Ce.data)continue;const ze=Ce.stride,Ve=Ce.getPixels();if(W.activeTexture.set(J.TEXTURE0),W.pixelStoreUnpackPremultiplyAlpha.set(!1),Ie.demTexture=Ie.demTexture||T.getTileTexture(ze),Ie.demTexture){const rt=Ie.demTexture;rt.update(Ve,{premultiply:!1}),rt.bind(J.LINEAR,J.CLAMP_TO_EDGE)}else Ie.demTexture=new c.T(W,Ve,J.RGBA,{premultiply:!1}),Ie.demTexture.bind(J.LINEAR,J.CLAMP_TO_EDGE);const Me=q.getMeshFromTileID(W,we.canonical,O,!0,"raster"),Ye=(U=T.style.map.terrain)===null||U===void 0?void 0:U.getTerrainData(we),ct=H.getProjectionData({overscaledTileID:we,aligned:ge,applyGlobeMatrix:!N,applyTerrainMatrix:!0});ae.draw(W,J.TRIANGLES,S,b[we.overscaledZ],C,fn.backCCW,Yh(u,Ie.dem,ve),Ye,ct,u.id,Me.vertexBuffer,Me.indexBuffer,Me.segments)}}const Kt=[new c.P(0,0),new c.P(c.$,0),new c.P(c.$,c.$),new c.P(0,c.$)];function pn(T,t,u,m,b,S,C,O,N=!1,U=!1){const q=m[m.length-1].overscaledZ,W=T.context,H=W.gl,J=T.useProgram("raster"),ae=T.transform,ge=T.style.projection,me=T.colorModeForRenderPass(),ve=!T.options.moving;for(const we of m){const Ie=T.getDepthModeForSublayer(we.overscaledZ-q,u.paint.get("raster-opacity")===1?sn.ReadWrite:sn.ReadOnly,H.LESS),Ce=t.getTile(we);Ce.registerFadeDuration(u.paint.get("raster-fade-duration"));const ze=t.findLoadedParent(we,0),Ve=t.findLoadedSibling(we),Me=Yn(Ce,ze||Ve||null,t,u,T.transform,T.style.map.terrain);let Ye,ct;const rt=u.paint.get("raster-resampling")==="nearest"?H.NEAREST:H.LINEAR;W.activeTexture.set(H.TEXTURE0),Ce.texture.bind(rt,H.CLAMP_TO_EDGE,H.LINEAR_MIPMAP_NEAREST),W.activeTexture.set(H.TEXTURE1),ze?(ze.texture.bind(rt,H.CLAMP_TO_EDGE,H.LINEAR_MIPMAP_NEAREST),Ye=Math.pow(2,ze.tileID.overscaledZ-Ce.tileID.overscaledZ),ct=[Ce.tileID.canonical.x*Ye%1,Ce.tileID.canonical.y*Ye%1]):Ce.texture.bind(rt,H.CLAMP_TO_EDGE,H.LINEAR_MIPMAP_NEAREST),Ce.texture.useMipmap&&W.extTextureFilterAnisotropic&&T.transform.pitch>20&&H.texParameterf(H.TEXTURE_2D,W.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,W.extTextureFilterAnisotropicMax);const st=T.style.map.terrain&&T.style.map.terrain.getTerrainData(we),lt=ae.getProjectionData({overscaledTileID:we,aligned:ve,applyGlobeMatrix:!U,applyTerrainMatrix:!0}),Nt=Ss(ct||[0,0],Ye||1,Me,u,O),Vt=ge.getMeshFromTileID(W,we.canonical,S,C,"raster");J.draw(W,H.TRIANGLES,Ie,b?b[we.overscaledZ]:$n.disabled,me,N?fn.frontCCW:fn.backCCW,Nt,st,lt,u.id,Vt.vertexBuffer,Vt.indexBuffer,Vt.segments)}}function Yn(T,t,u,m,b,S){const C=m.paint.get("raster-fade-duration");if(!S&&C>0){const O=ee.now(),N=(O-T.timeAdded)/C,U=t?(O-t.timeAdded)/C:-1,q=u.getSource(),W=tn(b,{tileSize:q.tileSize,roundZoom:q.roundZoom}),H=!t||Math.abs(t.tileID.overscaledZ-W)>Math.abs(T.tileID.overscaledZ-W),J=H&&T.refreshedUponExpiration?1:c.ah(H?N:1-U,0,1);return T.refreshedUponExpiration&&N>=1&&(T.refreshedUponExpiration=!1),t?{opacity:1,mix:1-J}:{opacity:J,mix:0}}return{opacity:1,mix:0}}const ga=new c.bf(1,0,0,1),Zr=new c.bf(0,1,0,1),Za=new c.bf(0,0,1,1),Ti=new c.bf(1,0,1,1),Ri=new c.bf(0,1,1,1);function li(T,t,u,m){Hr(T,0,t+u/2,T.transform.width,u,m)}function Li(T,t,u,m){Hr(T,t-u/2,0,u,T.transform.height,m)}function Hr(T,t,u,m,b,S){const C=T.context,O=C.gl;O.enable(O.SCISSOR_TEST),O.scissor(t*T.pixelRatio,u*T.pixelRatio,m*T.pixelRatio,b*T.pixelRatio),C.clear({color:S}),O.disable(O.SCISSOR_TEST)}function is(T,t,u){const m=T.context,b=m.gl,S=T.useProgram("debug"),C=sn.disabled,O=$n.disabled,N=T.colorModeForRenderPass(),U="$debug",q=T.style.map.terrain&&T.style.map.terrain.getTerrainData(u);m.activeTexture.set(b.TEXTURE0);const W=t.getTileByID(u.key).latestRawTileData,H=Math.floor((W&&W.byteLength||0)/1024),J=t.getTile(u).tileSize,ae=512/Math.min(J,512)*(u.overscaledZ/T.transform.zoom)*.5;let ge=u.canonical.toString();u.overscaledZ!==u.canonical.z&&(ge+=` => ${u.overscaledZ}`),(function(ve,we){ve.initDebugOverlayCanvas();const Ie=ve.debugOverlayCanvas,Ce=ve.context.gl,ze=ve.debugOverlayCanvas.getContext("2d");ze.clearRect(0,0,Ie.width,Ie.height),ze.shadowColor="white",ze.shadowBlur=2,ze.lineWidth=1.5,ze.strokeStyle="white",ze.textBaseline="top",ze.font="bold 36px Open Sans, sans-serif",ze.fillText(we,5,5),ze.strokeText(we,5,5),ve.debugOverlayTexture.update(Ie),ve.debugOverlayTexture.bind(Ce.LINEAR,Ce.CLAMP_TO_EDGE)})(T,`${ge} ${H}kB`);const me=T.transform.getProjectionData({overscaledTileID:u,applyGlobeMatrix:!0,applyTerrainMatrix:!0});S.draw(m,b.TRIANGLES,C,O,bn.alphaBlended,fn.disabled,Ws(c.bf.transparent,ae),null,me,U,T.debugBuffer,T.quadTriangleIndexBuffer,T.debugSegments),S.draw(m,b.LINE_STRIP,C,O,N,fn.disabled,Ws(c.bf.red),q,me,U,T.debugBuffer,T.tileBorderIndexBuffer,T.debugSegments)}function No(T,t,u,m){const{isRenderingGlobe:b}=m,S=T.context,C=S.gl,O=T.transform,N=T.colorModeForRenderPass(),U=T.getDepthModeFor3D(),q=T.useProgram("terrain");S.bindFramebuffer.set(null),S.viewport.set([0,0,T.width,T.height]);for(const W of u){const H=t.getTerrainMesh(W.tileID),J=T.renderToTexture.getTexture(W),ae=t.getTerrainData(W.tileID);S.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,J.texture);const ge=t.getMeshFrameDelta(O.zoom),me=O.calculateFogMatrix(W.tileID.toUnwrapped()),ve=ye(ge,me,T.style.sky,O.pitch,b),we=O.getProjectionData({overscaledTileID:W.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});q.draw(S,C.TRIANGLES,U,$n.disabled,N,fn.backCCW,ve,ae,we,"terrain",H.vertexBuffer,H.indexBuffer,H.segments)}}function xu(T,t){if(!t.mesh){const u=new c.aL;u.emplaceBack(-1,-1),u.emplaceBack(1,-1),u.emplaceBack(1,1),u.emplaceBack(-1,1);const m=new c.aN;m.emplaceBack(0,1,2),m.emplaceBack(0,2,3),t.mesh=new Ja(T.createVertexBuffer(u,_s.members),T.createIndexBuffer(m),c.aM.simpleSegment(0,0,u.length,m.length))}return t.mesh}class Or{constructor(t,u){this.context=new ns(t),this.transform=u,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:c.ag(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Rn.maxUnderzooming+Rn.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Qa}resize(t,u,m){if(this.width=Math.floor(t*m),this.height=Math.floor(u*m),this.pixelRatio=m,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const b of this.style._order)this.style._layers[b].resize()}setup(){const t=this.context,u=new c.aL;u.emplaceBack(0,0),u.emplaceBack(c.$,0),u.emplaceBack(0,c.$),u.emplaceBack(c.$,c.$),this.tileExtentBuffer=t.createVertexBuffer(u,_s.members),this.tileExtentSegments=c.aM.simpleSegment(0,0,4,2);const m=new c.aL;m.emplaceBack(0,0),m.emplaceBack(c.$,0),m.emplaceBack(0,c.$),m.emplaceBack(c.$,c.$),this.debugBuffer=t.createVertexBuffer(m,_s.members),this.debugSegments=c.aM.simpleSegment(0,0,4,5);const b=new c.c6;b.emplaceBack(0,0,0,0),b.emplaceBack(c.$,0,c.$,0),b.emplaceBack(0,c.$,0,c.$),b.emplaceBack(c.$,c.$,c.$,c.$),this.rasterBoundsBuffer=t.createVertexBuffer(b,Z.members),this.rasterBoundsSegments=c.aM.simpleSegment(0,0,4,2);const S=new c.aL;S.emplaceBack(0,0),S.emplaceBack(c.$,0),S.emplaceBack(0,c.$),S.emplaceBack(c.$,c.$),this.rasterBoundsBufferPosOnly=t.createVertexBuffer(S,_s.members),this.rasterBoundsSegmentsPosOnly=c.aM.simpleSegment(0,0,4,5);const C=new c.aL;C.emplaceBack(0,0),C.emplaceBack(1,0),C.emplaceBack(0,1),C.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(C,_s.members),this.viewportSegments=c.aM.simpleSegment(0,0,4,2);const O=new c.c7;O.emplaceBack(0),O.emplaceBack(1),O.emplaceBack(3),O.emplaceBack(2),O.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(O);const N=new c.aN;N.emplaceBack(1,0,2),N.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(N);const U=this.context.gl;this.stencilClearMode=new $n({func:U.ALWAYS,mask:0},0,255,U.ZERO,U.ZERO,U.ZERO),this.tileExtentMesh=new Ja(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const t=this.context,u=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const m=c.L();c.bY(m,0,this.width,this.height,0,0,1),c.N(m,m,[u.drawingBufferWidth,u.drawingBufferHeight,0]);const b={mainMatrix:m,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:m};this.useProgram("clippingMask",null,!0).draw(t,u.TRIANGLES,sn.disabled,this.stencilClearMode,bn.disabled,fn.disabled,null,null,b,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,u,m){if(this.currentStencilSource===t.source||!t.isTileClipped()||!u||!u.length)return;this.currentStencilSource=t.source,this.nextStencilID+u.length>256&&this.clearStencil();const b=this.context;b.setColorMode(bn.disabled),b.setDepthMode(sn.disabled);const S={};for(const C of u)S[C.key]=this.nextStencilID++;this._renderTileMasks(S,u,m,!0),this._renderTileMasks(S,u,m,!1),this._tileClippingMaskIDs=S}_renderTileMasks(t,u,m,b){const S=this.context,C=S.gl,O=this.style.projection,N=this.transform,U=this.useProgram("clippingMask");for(const q of u){const W=t[q.key],H=this.style.map.terrain&&this.style.map.terrain.getTerrainData(q),J=O.getMeshFromTileID(this.context,q.canonical,b,!0,"stencil"),ae=N.getProjectionData({overscaledTileID:q,applyGlobeMatrix:!m,applyTerrainMatrix:!0});U.draw(S,C.TRIANGLES,sn.disabled,new $n({func:C.ALWAYS,mask:0},W,255,C.KEEP,C.KEEP,C.REPLACE),bn.disabled,m?fn.disabled:fn.backCCW,null,H,ae,"$clipping",J.vertexBuffer,J.indexBuffer,J.segments)}}_renderTilesDepthBuffer(){const t=this.context,u=t.gl,m=this.style.projection,b=this.transform,S=this.useProgram("depth"),C=this.getDepthModeFor3D(),O=$e(b,{tileSize:b.tileSize});for(const N of O){const U=this.style.map.terrain&&this.style.map.terrain.getTerrainData(N),q=m.getMeshFromTileID(this.context,N.canonical,!0,!0,"raster"),W=b.getProjectionData({overscaledTileID:N,applyGlobeMatrix:!0,applyTerrainMatrix:!0});S.draw(t,u.TRIANGLES,C,$n.disabled,bn.disabled,fn.backCCW,null,U,W,"$clipping",q.vertexBuffer,q.indexBuffer,q.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,u=this.context.gl;return new $n({func:u.NOTEQUAL,mask:255},t,255,u.KEEP,u.KEEP,u.REPLACE)}stencilModeForClipping(t){const u=this.context.gl;return new $n({func:u.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,u.KEEP,u.KEEP,u.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(t){const u=this.context.gl,m=t.sort(((C,O)=>O.overscaledZ-C.overscaledZ)),b=m[m.length-1].overscaledZ,S=m[0].overscaledZ-b+1;if(S>1){this.currentStencilSource=void 0,this.nextStencilID+S>256&&this.clearStencil();const C={};for(let O=0;O<S;O++)C[O+b]=new $n({func:u.GEQUAL,mask:255},O+this.nextStencilID,255,u.KEEP,u.KEEP,u.REPLACE);return this.nextStencilID+=S,[C,m]}return[{[b]:$n.disabled},m]}stencilConfigForOverlapTwoPass(t){const u=this.context.gl,m=t.sort(((C,O)=>O.overscaledZ-C.overscaledZ)),b=m[m.length-1].overscaledZ,S=m[0].overscaledZ-b+1;if(this.clearStencil(),S>1){const C={},O={};for(let N=0;N<S;N++)C[N+b]=new $n({func:u.GREATER,mask:255},S+1+N,255,u.KEEP,u.KEEP,u.REPLACE),O[N+b]=new $n({func:u.GREATER,mask:255},1+N,255,u.KEEP,u.KEEP,u.REPLACE);return this.nextStencilID=2*S+1,[C,O,m]}return this.nextStencilID=3,[{[b]:new $n({func:u.GREATER,mask:255},2,255,u.KEEP,u.KEEP,u.REPLACE)},{[b]:new $n({func:u.GREATER,mask:255},1,255,u.KEEP,u.KEEP,u.REPLACE)},m]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new bn([t.CONSTANT_COLOR,t.ONE],new c.bf(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?bn.unblended:bn.alphaBlended}getDepthModeForSublayer(t,u,m){if(!this.opaquePassEnabledForLayer())return sn.disabled;const b=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new sn(m||this.context.gl.LEQUAL,u,[b,b])}getDepthModeFor3D(){return new sn(this.context.gl.LEQUAL,sn.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,u){var m,b;this.style=t,this.options=u,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(ee.now()),this.imageManager.beginFrame();const S=this.style._order,C=this.style.sourceCaches,O={},N={},U={},q={isRenderingToTexture:!1,isRenderingGlobe:((m=t.projection)===null||m===void 0?void 0:m.transitionState)>0};for(const H in C){const J=C[H];J.used&&J.prepare(this.context),O[H]=J.getVisibleCoordinates(!1),N[H]=O[H].slice().reverse(),U[H]=J.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let H=0;H<S.length;H++)if(this.style._layers[S[H]].is3D()){this.opaquePassCutoff=H;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const H of S){const J=this.style._layers[H];if(!J.hasOffscreenPass()||J.isHidden(this.transform.zoom))continue;const ae=N[J.source];(J.type==="custom"||ae.length)&&this.renderLayer(this,C[J.source],J,ae,q)}if((b=this.style.projection)===null||b===void 0||b.updateGPUdependent({context:this.context,useProgram:H=>this.useProgram(H)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:u.showOverdrawInspector?c.bf.black:c.bf.transparent,depth:1}),this.clearStencil(),this.style.sky&&(function(H,J){const ae=H.context,ge=ae.gl,me=((Ve,Me,Ye)=>{const ct=Math.cos(Me.rollInRadians),rt=Math.sin(Me.rollInRadians),st=De(Me),lt=Me.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:Ve.properties.get("sky-color"),u_horizon_color:Ve.properties.get("horizon-color"),u_horizon:[(Me.width/2-st*rt)*Ye,(Me.height/2+st*ct)*Ye],u_horizon_normal:[-rt,ct],u_sky_horizon_blend:Ve.properties.get("sky-horizon-blend")*Me.height/2*Ye,u_sky_blend:lt}})(J,H.style.map.transform,H.pixelRatio),ve=new sn(ge.LEQUAL,sn.ReadWrite,[0,1]),we=$n.disabled,Ie=H.colorModeForRenderPass(),Ce=H.useProgram("sky"),ze=xu(ae,J);Ce.draw(ae,ge.TRIANGLES,ve,we,Ie,fn.disabled,me,null,void 0,"sky",ze.vertexBuffer,ze.indexBuffer,ze.segments)})(this,this.style.sky),this._showOverdrawInspector=u.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=S.length-1;this.currentLayer>=0;this.currentLayer--){const H=this.style._layers[S[this.currentLayer]],J=C[H.source],ae=O[H.source];this._renderTileClippingMasks(H,ae,!1),this.renderLayer(this,J,H,ae,q)}this.renderPass="translucent";let W=!1;for(this.currentLayer=0;this.currentLayer<S.length;this.currentLayer++){const H=this.style._layers[S[this.currentLayer]],J=C[H.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(H,q))continue;this.opaquePassEnabledForLayer()||W||(W=!0,q.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const ae=(H.type==="symbol"?U:N)[H.source];this._renderTileClippingMasks(H,O[H.source],!!this.renderToTexture),this.renderLayer(this,J,H,ae,q)}if(q.isRenderingGlobe&&(function(H,J,ae){const ge=H.context,me=ge.gl,ve=H.useProgram("atmosphere"),we=new sn(me.LEQUAL,sn.ReadOnly,[0,1]),Ie=H.transform,Ce=(function(lt,Nt){const Vt=lt.properties.get("position"),At=[-Vt.x,-Vt.y,-Vt.z],ln=c.ag(new Float64Array(16));return lt.properties.get("anchor")==="map"&&(c.b6(ln,ln,Nt.rollInRadians),c.b7(ln,ln,-Nt.pitchInRadians),c.b6(ln,ln,Nt.bearingInRadians),c.b7(ln,ln,Nt.center.lat*Math.PI/180),c.bz(ln,ln,-Nt.center.lng*Math.PI/180)),c.c5(At,At,ln),At})(ae,H.transform),ze=Ie.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),Ve=J.properties.get("atmosphere-blend")*ze.projectionTransition;if(Ve===0)return;const Me=xs(Ie.worldSize,Ie.center.lat),Ye=Ie.inverseProjectionMatrix,ct=new Float64Array(4);ct[3]=1,c.aw(ct,ct,Ie.modelViewProjectionMatrix),ct[0]/=ct[3],ct[1]/=ct[3],ct[2]/=ct[3],ct[3]=1,c.aw(ct,ct,Ye),ct[0]/=ct[3],ct[1]/=ct[3],ct[2]/=ct[3],ct[3]=1;const rt=((lt,Nt,Vt,At,ln)=>({u_sun_pos:lt,u_atmosphere_blend:Nt,u_globe_position:Vt,u_globe_radius:At,u_inv_proj_matrix:ln}))(Ce,Ve,[ct[0],ct[1],ct[2]],Me,Ye),st=xu(ge,J);ve.draw(ge,me.TRIANGLES,we,$n.disabled,bn.alphaBlended,fn.disabled,rt,null,null,"atmosphere",st.vertexBuffer,st.indexBuffer,st.segments)})(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const H=(function(J,ae){let ge=null;const me=Object.values(J._layers).flatMap((Ce=>Ce.source&&!Ce.isHidden(ae)?[J.sourceCaches[Ce.source]]:[])),ve=me.filter((Ce=>Ce.getSource().type==="vector")),we=me.filter((Ce=>Ce.getSource().type!=="vector")),Ie=Ce=>{(!ge||ge.getSource().maxzoom<Ce.getSource().maxzoom)&&(ge=Ce)};return ve.forEach((Ce=>Ie(Ce))),ge||we.forEach((Ce=>Ie(Ce))),ge})(this.style,this.transform.zoom);H&&(function(J,ae,ge){for(let me=0;me<ge.length;me++)is(J,ae,ge[me])})(this,H,H.getVisibleCoordinates())}this.options.showPadding&&(function(H){const J=H.transform.padding;li(H,H.transform.height-(J.top||0),3,ga),li(H,J.bottom||0,3,Zr),Li(H,J.left||0,3,Za),Li(H,H.transform.width-(J.right||0),3,Ti);const ae=H.transform.centerPoint;(function(ge,me,ve,we){Hr(ge,me-1,ve-10,2,20,we),Hr(ge,me-10,ve-1,20,2,we)})(H,ae.x,H.transform.height-ae.y,Ri)})(this),this.context.setDefault()}maybeDrawDepthAndCoords(t){if(!this.style||!this.style.map||!this.style.map.terrain)return;const u=this.terrainFacilitator.matrix,m=this.transform.modelViewProjectionMatrix;let b=this.terrainFacilitator.dirty;b||(b=t?!c.c8(u,m):!c.c9(u,m)),b||(b=this.style.map.terrain.sourceCache.anyTilesAfterTime(this.terrainFacilitator.renderTime)),b&&(c.ca(u,m),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,(function(S,C){const O=S.context,N=O.gl,U=S.transform,q=bn.unblended,W=new sn(N.LEQUAL,sn.ReadWrite,[0,1]),H=C.sourceCache.getRenderableTiles(),J=S.useProgram("terrainDepth");O.bindFramebuffer.set(C.getFramebuffer("depth").framebuffer),O.viewport.set([0,0,S.width/devicePixelRatio,S.height/devicePixelRatio]),O.clear({color:c.bf.transparent,depth:1});for(const ae of H){const ge=C.getTerrainMesh(ae.tileID),me=C.getTerrainData(ae.tileID),ve=U.getProjectionData({overscaledTileID:ae.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),we={u_ele_delta:C.getMeshFrameDelta(U.zoom)};J.draw(O,N.TRIANGLES,W,$n.disabled,q,fn.backCCW,we,me,ve,"terrain",ge.vertexBuffer,ge.indexBuffer,ge.segments)}O.bindFramebuffer.set(null),O.viewport.set([0,0,S.width,S.height])})(this,this.style.map.terrain),(function(S,C){const O=S.context,N=O.gl,U=S.transform,q=bn.unblended,W=new sn(N.LEQUAL,sn.ReadWrite,[0,1]),H=C.getCoordsTexture(),J=C.sourceCache.getRenderableTiles(),ae=S.useProgram("terrainCoords");O.bindFramebuffer.set(C.getFramebuffer("coords").framebuffer),O.viewport.set([0,0,S.width/devicePixelRatio,S.height/devicePixelRatio]),O.clear({color:c.bf.transparent,depth:1}),C.coordsIndex=[];for(const ge of J){const me=C.getTerrainMesh(ge.tileID),ve=C.getTerrainData(ge.tileID);O.activeTexture.set(N.TEXTURE0),N.bindTexture(N.TEXTURE_2D,H.texture);const we={u_terrain_coords_id:(255-C.coordsIndex.length)/255,u_texture:0,u_ele_delta:C.getMeshFrameDelta(U.zoom)},Ie=U.getProjectionData({overscaledTileID:ge.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});ae.draw(O,N.TRIANGLES,W,$n.disabled,q,fn.backCCW,we,ve,Ie,"terrain",me.vertexBuffer,me.indexBuffer,me.segments),C.coordsIndex.push(ge.tileID.key)}O.bindFramebuffer.set(null),O.viewport.set([0,0,S.width,S.height])})(this,this.style.map.terrain))}renderLayer(t,u,m,b,S){m.isHidden(this.transform.zoom)||(m.type==="background"||m.type==="custom"||(b||[]).length)&&(this.id=m.id,c.cb(m)?(function(C,O,N,U,q,W){if(C.renderPass!=="translucent")return;const{isRenderingToTexture:H}=W,J=$n.disabled,ae=C.colorModeForRenderPass();(N._unevaluatedLayout.hasValue("text-variable-anchor")||N._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&(function(ge,me,ve,we,Ie,Ce,ze,Ve,Me){const Ye=me.transform,ct=me.style.map.terrain,rt=Ie==="map",st=Ce==="map";for(const lt of ge){const Nt=we.getTile(lt),Vt=Nt.getBucket(ve);if(!Vt||!Vt.text||!Vt.text.segments.get().length)continue;const At=c.an(Vt.textSizeData,Ye.zoom),ln=c.aC(Nt,1,me.transform.zoom),Zn=Cr(rt,me.transform,ln),vi=ve.layout.get("icon-text-fit")!=="none"&&Vt.hasIconData();if(At){const Wi=Math.pow(2,Ye.zoom-Nt.tileID.overscaledZ),ji=ct?(Ir,Br)=>ct.getElevation(lt,Ir,Br):null;tc(Vt,rt,st,Me,Ye,Zn,Wi,At,vi,c.aD(Ye,Nt,ze,Ve),lt.toUnwrapped(),ji)}}})(U,C,N,O,N.layout.get("text-rotation-alignment"),N.layout.get("text-pitch-alignment"),N.paint.get("text-translate"),N.paint.get("text-translate-anchor"),q),N.paint.get("icon-opacity").constantOr(1)!==0&&bu(C,O,N,U,!1,N.paint.get("icon-translate"),N.paint.get("icon-translate-anchor"),N.layout.get("icon-rotation-alignment"),N.layout.get("icon-pitch-alignment"),N.layout.get("icon-keep-upright"),J,ae,H),N.paint.get("text-opacity").constantOr(1)!==0&&bu(C,O,N,U,!0,N.paint.get("text-translate"),N.paint.get("text-translate-anchor"),N.layout.get("text-rotation-alignment"),N.layout.get("text-pitch-alignment"),N.layout.get("text-keep-upright"),J,ae,H),O.map.showCollisionBoxes&&(Oo(C,O,N,U,!0),Oo(C,O,N,U,!1))})(t,u,m,b,this.style.placement.variableOffsets,S):c.cc(m)?(function(C,O,N,U,q){if(C.renderPass!=="translucent")return;const{isRenderingToTexture:W}=q,H=N.paint.get("circle-opacity"),J=N.paint.get("circle-stroke-width"),ae=N.paint.get("circle-stroke-opacity"),ge=!N.layout.get("circle-sort-key").isConstant();if(H.constantOr(1)===0&&(J.constantOr(1)===0||ae.constantOr(1)===0))return;const me=C.context,ve=me.gl,we=C.transform,Ie=C.getDepthModeForSublayer(0,sn.ReadOnly),Ce=$n.disabled,ze=C.colorModeForRenderPass(),Ve=[],Me=we.getCircleRadiusCorrection();for(let Ye=0;Ye<U.length;Ye++){const ct=U[Ye],rt=O.getTile(ct),st=rt.getBucket(N);if(!st)continue;const lt=N.paint.get("circle-translate"),Nt=N.paint.get("circle-translate-anchor"),Vt=c.aD(we,rt,lt,Nt),At=st.programConfigurations.get(N.id),ln=C.useProgram("circle",At),Zn=st.layoutVertexBuffer,vi=st.indexBuffer,Wi=C.style.map.terrain&&C.style.map.terrain.getTerrainData(ct),ji={programConfiguration:At,program:ln,layoutVertexBuffer:Zn,indexBuffer:vi,uniformValues:Xs(C,rt,N,Vt,Me),terrainData:Wi,projectionData:we.getProjectionData({overscaledTileID:ct,applyGlobeMatrix:!W,applyTerrainMatrix:!0})};if(ge){const Ir=st.segments.get();for(const Br of Ir)Ve.push({segments:new c.aM([Br]),sortKey:Br.sortKey,state:ji})}else Ve.push({segments:st.segments,sortKey:0,state:ji})}ge&&Ve.sort(((Ye,ct)=>Ye.sortKey-ct.sortKey));for(const Ye of Ve){const{programConfiguration:ct,program:rt,layoutVertexBuffer:st,indexBuffer:lt,uniformValues:Nt,terrainData:Vt,projectionData:At}=Ye.state;rt.draw(me,ve.TRIANGLES,Ie,Ce,ze,fn.backCCW,Nt,Vt,At,N.id,st,lt,Ye.segments,N.paint,C.transform.zoom,ct)}})(t,u,m,b,S):c.cd(m)?(function(C,O,N,U,q){if(N.paint.get("heatmap-opacity")===0)return;const W=C.context,{isRenderingToTexture:H,isRenderingGlobe:J}=q;if(C.style.map.terrain){for(const ae of U){const ge=O.getTile(ae);O.hasRenderableParent(ae)||(C.renderPass==="offscreen"?x(C,ge,N,ae,J):C.renderPass==="translucent"&&R(C,N,ae,H,J))}W.viewport.set([0,0,C.width,C.height])}else C.renderPass==="offscreen"?(function(ae,ge,me,ve){const we=ae.context,Ie=we.gl,Ce=ae.transform,ze=$n.disabled,Ve=new bn([Ie.ONE,Ie.ONE],c.bf.transparent,[!0,!0,!0,!0]);(function(Me,Ye,ct){const rt=Me.gl;Me.activeTexture.set(rt.TEXTURE1),Me.viewport.set([0,0,Ye.width/4,Ye.height/4]);let st=ct.heatmapFbos.get(c.c2);st?(rt.bindTexture(rt.TEXTURE_2D,st.colorAttachment.get()),Me.bindFramebuffer.set(st.framebuffer)):(st=V(Me,Ye.width/4,Ye.height/4),ct.heatmapFbos.set(c.c2,st))})(we,ae,me),we.clear({color:c.bf.transparent});for(let Me=0;Me<ve.length;Me++){const Ye=ve[Me];if(ge.hasRenderableParent(Ye))continue;const ct=ge.getTile(Ye),rt=ct.getBucket(me);if(!rt)continue;const st=rt.programConfigurations.get(me.id),lt=ae.useProgram("heatmap",st),Nt=Ce.getProjectionData({overscaledTileID:Ye,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),Vt=Ce.getCircleRadiusCorrection();lt.draw(we,Ie.TRIANGLES,sn.disabled,ze,Ve,fn.backCCW,fu(ct,Ce.zoom,me.paint.get("heatmap-intensity"),Vt),null,Nt,me.id,rt.layoutVertexBuffer,rt.indexBuffer,rt.segments,me.paint,Ce.zoom,st)}we.viewport.set([0,0,ae.width,ae.height])})(C,O,N,U):C.renderPass==="translucent"&&(function(ae,ge){const me=ae.context,ve=me.gl;me.setColorMode(ae.colorModeForRenderPass());const we=ge.heatmapFbos.get(c.c2);we&&(me.activeTexture.set(ve.TEXTURE0),ve.bindTexture(ve.TEXTURE_2D,we.colorAttachment.get()),me.activeTexture.set(ve.TEXTURE1),K(me,ge).bind(ve.LINEAR,ve.CLAMP_TO_EDGE),ae.useProgram("heatmapTexture").draw(me,ve.TRIANGLES,sn.disabled,$n.disabled,ae.colorModeForRenderPass(),fn.disabled,Ks(ae,ge,0,1),null,null,ge.id,ae.viewportBuffer,ae.quadTriangleIndexBuffer,ae.viewportSegments,ge.paint,ae.transform.zoom))})(C,N)})(t,u,m,b,S):c.ce(m)?(function(C,O,N,U,q){if(C.renderPass!=="translucent")return;const{isRenderingToTexture:W}=q,H=N.paint.get("line-opacity"),J=N.paint.get("line-width");if(H.constantOr(1)===0||J.constantOr(1)===0)return;const ae=C.getDepthModeForSublayer(0,sn.ReadOnly),ge=C.colorModeForRenderPass(),me=N.paint.get("line-dasharray"),ve=N.paint.get("line-pattern"),we=ve.constantOr(1),Ie=N.paint.get("line-gradient"),Ce=N.getCrossfadeParameters(),ze=we?"linePattern":me?"lineSDF":Ie?"lineGradient":"line",Ve=C.context,Me=Ve.gl,Ye=C.transform;let ct=!0;for(const rt of U){const st=O.getTile(rt);if(we&&!st.patternsLoaded())continue;const lt=st.getBucket(N);if(!lt)continue;const Nt=lt.programConfigurations.get(N.id),Vt=C.context.program.get(),At=C.useProgram(ze,Nt),ln=ct||At.program!==Vt,Zn=C.style.map.terrain&&C.style.map.terrain.getTerrainData(rt),vi=ve.constantOr(null);if(vi&&st.imageAtlas){const Un=st.imageAtlas,lr=Un.patternPositions[vi.to.toString()],sa=Un.patternPositions[vi.from.toString()];lr&&sa&&Nt.setConstantPatternPositions(lr,sa)}const Wi=Ye.getProjectionData({overscaledTileID:rt,applyGlobeMatrix:!W,applyTerrainMatrix:!0}),ji=Ye.getPixelScale(),Ir=we?Zu(C,st,N,ji,Ce):me?Ro(C,st,N,ji,me,Ce):Ie?Gu(C,st,N,ji,lt.lineClipsArray.length):Ys(C,st,N,ji);if(we)Ve.activeTexture.set(Me.TEXTURE0),st.imageAtlasTexture.bind(Me.LINEAR,Me.CLAMP_TO_EDGE),Nt.updatePaintBuffers(Ce);else if(me&&(ln||C.lineAtlas.dirty))Ve.activeTexture.set(Me.TEXTURE0),C.lineAtlas.bind(Ve);else if(Ie){const Un=lt.gradients[N.id];let lr=Un.texture;if(N.gradientVersion!==Un.version){let sa=256;if(N.stepInterpolant){const Fr=O.getSource().maxzoom,La=rt.canonical.z===Fr?Math.ceil(1<<C.transform.maxZoom-rt.canonical.z):1;sa=c.ah(c.c3(lt.maxLineLength/c.$*1024*La),256,Ve.maxTextureSize)}Un.gradient=c.c4({expression:N.gradientExpression(),evaluationKey:"lineProgress",resolution:sa,image:Un.gradient||void 0,clips:lt.lineClipsArray}),Un.texture?Un.texture.update(Un.gradient):Un.texture=new c.T(Ve,Un.gradient,Me.RGBA),Un.version=N.gradientVersion,lr=Un.texture}Ve.activeTexture.set(Me.TEXTURE0),lr.bind(N.stepInterpolant?Me.NEAREST:Me.LINEAR,Me.CLAMP_TO_EDGE)}const Br=C.stencilModeForClipping(rt);At.draw(Ve,Me.TRIANGLES,ae,Br,ge,fn.disabled,Ir,Zn,Wi,N.id,lt.layoutVertexBuffer,lt.indexBuffer,lt.segments,N.paint,C.transform.zoom,Nt,lt.layoutVertexBuffer2),ct=!1}})(t,u,m,b,S):c.cf(m)?(function(C,O,N,U,q){const W=N.paint.get("fill-color"),H=N.paint.get("fill-opacity");if(H.constantOr(1)===0)return;const{isRenderingToTexture:J}=q,ae=C.colorModeForRenderPass(),ge=N.paint.get("fill-pattern"),me=C.opaquePassEnabledForLayer()&&!ge.constantOr(1)&&W.constantOr(c.bf.transparent).a===1&&H.constantOr(0)===1?"opaque":"translucent";if(C.renderPass===me){const ve=C.getDepthModeForSublayer(1,C.renderPass==="opaque"?sn.ReadWrite:sn.ReadOnly);Oe(C,O,N,U,ve,ae,!1,J)}if(C.renderPass==="translucent"&&N.paint.get("fill-antialias")){const ve=C.getDepthModeForSublayer(N.getPaintProperty("fill-outline-color")?2:0,sn.ReadOnly);Oe(C,O,N,U,ve,ae,!0,J)}})(t,u,m,b,S):c.cg(m)?(function(C,O,N,U,q){const W=N.paint.get("fill-extrusion-opacity");if(W===0)return;const{isRenderingToTexture:H}=q;if(C.renderPass==="translucent"){const J=new sn(C.context.gl.LEQUAL,sn.ReadWrite,C.depthRangeFor3D);if(W!==1||N.paint.get("fill-extrusion-pattern").constantOr(1))nt(C,O,N,U,J,$n.disabled,bn.disabled,H),nt(C,O,N,U,J,C.stencilModeFor3D(),C.colorModeForRenderPass(),H);else{const ae=C.colorModeForRenderPass();nt(C,O,N,U,J,$n.disabled,ae,H)}}})(t,u,m,b,S):c.ch(m)?(function(C,O,N,U,q){if(C.renderPass!=="offscreen"&&C.renderPass!=="translucent")return;const{isRenderingToTexture:W}=q,H=C.context,J=C.style.projection.useSubdivision,ae=C.getDepthModeForSublayer(0,sn.ReadOnly),ge=C.colorModeForRenderPass();if(C.renderPass==="offscreen")(function(me,ve,we,Ie,Ce,ze,Ve){const Me=me.context,Ye=Me.gl;for(const ct of we){const rt=ve.getTile(ct),st=rt.dem;if(!st||!st.data||!rt.needsHillshadePrepare)continue;const lt=st.dim,Nt=st.stride,Vt=st.getPixels();if(Me.activeTexture.set(Ye.TEXTURE1),Me.pixelStoreUnpackPremultiplyAlpha.set(!1),rt.demTexture=rt.demTexture||me.getTileTexture(Nt),rt.demTexture){const ln=rt.demTexture;ln.update(Vt,{premultiply:!1}),ln.bind(Ye.NEAREST,Ye.CLAMP_TO_EDGE)}else rt.demTexture=new c.T(Me,Vt,Ye.RGBA,{premultiply:!1}),rt.demTexture.bind(Ye.NEAREST,Ye.CLAMP_TO_EDGE);Me.activeTexture.set(Ye.TEXTURE0);let At=rt.fbo;if(!At){const ln=new c.T(Me,{width:lt,height:lt,data:null},Ye.RGBA);ln.bind(Ye.LINEAR,Ye.CLAMP_TO_EDGE),At=rt.fbo=Me.createFramebuffer(lt,lt,!0,!1),At.colorAttachment.set(ln.texture)}Me.bindFramebuffer.set(At.framebuffer),Me.viewport.set([0,0,lt,lt]),me.useProgram("hillshadePrepare").draw(Me,Ye.TRIANGLES,Ce,ze,Ve,fn.disabled,jd(rt.tileID,st),null,null,Ie.id,me.rasterBoundsBuffer,me.quadTriangleIndexBuffer,me.rasterBoundsSegments),rt.needsHillshadePrepare=!1}})(C,O,U,N,ae,$n.disabled,ge),H.viewport.set([0,0,C.width,C.height]);else if(C.renderPass==="translucent")if(J){const[me,ve,we]=C.stencilConfigForOverlapTwoPass(U);ut(C,O,N,we,me,ae,ge,!1,W),ut(C,O,N,we,ve,ae,ge,!0,W)}else{const[me,ve]=C.getStencilConfigForOverlapAndUpdateStencilID(U);ut(C,O,N,ve,me,ae,ge,!1,W)}})(t,u,m,b,S):c.ci(m)?(function(C,O,N,U,q){if(C.renderPass!=="translucent"||!U.length)return;const{isRenderingToTexture:W}=q,H=C.style.projection.useSubdivision,J=C.getDepthModeForSublayer(0,sn.ReadOnly),ae=C.colorModeForRenderPass();if(H){const[ge,me,ve]=C.stencilConfigForOverlapTwoPass(U);Mt(C,O,N,ve,ge,J,ae,!1,W),Mt(C,O,N,ve,me,J,ae,!0,W)}else{const[ge,me]=C.getStencilConfigForOverlapAndUpdateStencilID(U);Mt(C,O,N,me,ge,J,ae,!1,W)}})(t,u,m,b,S):c.cj(m)?(function(C,O,N,U,q){if(C.renderPass!=="translucent"||N.paint.get("raster-opacity")===0||!U.length)return;const{isRenderingToTexture:W}=q,H=O.getSource(),J=C.style.projection.useSubdivision;if(H instanceof Bi)pn(C,O,N,U,null,!1,!1,H.tileCoords,H.flippedWindingOrder,W);else if(J){const[ae,ge,me]=C.stencilConfigForOverlapTwoPass(U);pn(C,O,N,me,ae,!1,!0,Kt,!1,W),pn(C,O,N,me,ge,!0,!0,Kt,!1,W)}else{const[ae,ge]=C.getStencilConfigForOverlapAndUpdateStencilID(U);pn(C,O,N,ge,ae,!1,!0,Kt,!1,W)}})(t,u,m,b,S):c.ck(m)?(function(C,O,N,U,q){const W=N.paint.get("background-color"),H=N.paint.get("background-opacity");if(H===0)return;const{isRenderingToTexture:J}=q,ae=C.context,ge=ae.gl,me=C.style.projection,ve=C.transform,we=ve.tileSize,Ie=N.paint.get("background-pattern");if(C.isPatternMissing(Ie))return;const Ce=!Ie&&W.a===1&&H===1&&C.opaquePassEnabledForLayer()?"opaque":"translucent";if(C.renderPass!==Ce)return;const ze=$n.disabled,Ve=C.getDepthModeForSublayer(0,Ce==="opaque"?sn.ReadWrite:sn.ReadOnly),Me=C.colorModeForRenderPass(),Ye=C.useProgram(Ie?"backgroundPattern":"background"),ct=U||$e(ve,{tileSize:we,terrain:C.style.map.terrain});Ie&&(ae.activeTexture.set(ge.TEXTURE0),C.imageManager.bind(C.context));const rt=N.getCrossfadeParameters();for(const st of ct){const lt=ve.getProjectionData({overscaledTileID:st,applyGlobeMatrix:!J,applyTerrainMatrix:!0}),Nt=Ie?$d(H,C,Ie,{tileID:st,tileSize:we},rt):ll(H,W),Vt=C.style.map.terrain&&C.style.map.terrain.getTerrainData(st),At=me.getMeshFromTileID(ae,st.canonical,!1,!0,"raster");Ye.draw(ae,ge.TRIANGLES,Ve,ze,Me,fn.backCCW,Nt,Vt,lt,N.id,At.vertexBuffer,At.indexBuffer,At.segments)}})(t,0,m,b,S):c.cl(m)&&(function(C,O,N,U){const{isRenderingGlobe:q}=U,W=C.context,H=N.implementation,J=C.style.projection,ae=C.transform,ge=ae.getProjectionDataForCustomLayer(q),me={farZ:ae.farZ,nearZ:ae.nearZ,fov:ae.fov*Math.PI/180,modelViewProjectionMatrix:ae.modelViewProjectionMatrix,projectionMatrix:ae.projectionMatrix,shaderData:{variantName:J.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${J.shaderPreludeCode.vertexSource}`,define:J.shaderDefine},defaultProjectionData:ge},ve=H.renderingMode?H.renderingMode:"2d";if(C.renderPass==="offscreen"){const we=H.prerender;we&&(C.setCustomLayerDefaults(),W.setColorMode(C.colorModeForRenderPass()),we.call(H,W.gl,me),W.setDirty(),C.setBaseState())}else if(C.renderPass==="translucent"){C.setCustomLayerDefaults(),W.setColorMode(C.colorModeForRenderPass()),W.setStencilMode($n.disabled);const we=ve==="3d"?C.getDepthModeFor3D():C.getDepthModeForSublayer(0,sn.ReadOnly);W.setDepthMode(we),H.render(W.gl,me),W.setDirty(),C.setBaseState(),W.bindFramebuffer.set(null)}})(t,0,m,S))}saveTileTexture(t){const u=this._tileTextures[t.size[0]];u?u.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const u=this._tileTextures[t];return u&&u.length>0?u.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const u=this.imageManager.getPattern(t.from.toString()),m=this.imageManager.getPattern(t.to.toString());return!u||!m}useProgram(t,u,m=!1,b=[]){this.cache=this.cache||{};const S=!!this.style.map.terrain,C=this.style.projection,O=m?Gi.projectionMercator:C.shaderPreludeCode,N=m?$a:C.shaderDefine,U=t+(u?u.cacheKey:"")+`/${m?Zs:C.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(S?"/terrain":"")+(b?`/${b.join("/")}`:"");return this.cache[U]||(this.cache[U]=new Wt(this.context,Gi[t],u,Qh[t],this._showOverdrawInspector,S,O,N,b)),this.cache[U]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new c.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:t,drawingBufferHeight:u}=this.context.gl;return this.width!==t||this.height!==u}}function rs(T,t){let u,m=!1,b=null,S=null;const C=()=>{b=null,m&&(T.apply(S,u),b=setTimeout(C,t),m=!1)};return(...O)=>(m=!0,S=this,u=O,b||C(),b)}class ml{constructor(t){this._getCurrentHash=()=>{const u=window.location.hash.replace("#","");if(this._hashName){let m;return u.split("&").map((b=>b.split("="))).forEach((b=>{b[0]===this._hashName&&(m=b)})),(m&&m[1]||"").split("/")}return u.split("/")},this._onHashChange=()=>{const u=this._getCurrentHash();if(!this._isValidHash(u))return!1;const m=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(u[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+u[2],+u[1]],zoom:+u[0],bearing:m,pitch:+(u[4]||0)}),!0},this._updateHashUnthrottled=()=>{const u=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,u)},this._removeHash=()=>{const u=this._getCurrentHash();if(u.length===0)return;const m=u.join("/");let b=m;b.split("&").length>0&&(b=b.split("&")[0]),this._hashName&&(b=`${this._hashName}=${m}`);let S=window.location.hash.replace(b,"");S.startsWith("#&")?S=S.slice(0,1)+S.slice(2):S==="#"&&(S="");let C=window.location.href.replace(/(#.+)?$/,S);C=C.replace("&&","&"),window.history.replaceState(window.history.state,null,C)},this._updateHash=rs(this._updateHashUnthrottled,300),this._hashName=t&&encodeURIComponent(t)}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(t){const u=this._map.getCenter(),m=Math.round(100*this._map.getZoom())/100,b=Math.ceil((m*Math.LN2+Math.log(512/360/.5))/Math.LN10),S=Math.pow(10,b),C=Math.round(u.lng*S)/S,O=Math.round(u.lat*S)/S,N=this._map.getBearing(),U=this._map.getPitch();let q="";if(q+=t?`/${C}/${O}/${m}`:`${m}/${O}/${C}`,(N||U)&&(q+="/"+Math.round(10*N)/10),U&&(q+=`/${Math.round(U)}`),this._hashName){const W=this._hashName;let H=!1;const J=window.location.hash.slice(1).split("&").map((ae=>{const ge=ae.split("=")[0];return ge===W?(H=!0,`${ge}=${q}`):ae})).filter((ae=>ae));return H||J.push(`${W}=${q}`),`#${J.join("&")}`}return`#${q}`}_isValidHash(t){if(t.length<3||t.some(isNaN))return!1;try{new c.S(+t[2],+t[1])}catch{return!1}const u=+t[0],m=+(t[3]||0),b=+(t[4]||0);return u>=this._map.getMinZoom()&&u<=this._map.getMaxZoom()&&m>=-180&&m<=180&&b>=this._map.getMinPitch()&&b<=this._map.getMaxPitch()}}const Bo={linearity:.3,easing:c.cm(0,0,.3,1)},wu=c.e({deceleration:2500,maxSpeed:1400},Bo),ic=c.e({deceleration:20,maxSpeed:1400},Bo),Nl=c.e({deceleration:1e3,maxSpeed:360},Bo),gl=c.e({deceleration:1e3,maxSpeed:90},Bo),Tu=c.e({deceleration:1e3,maxSpeed:360},Bo);class Kl{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:ee.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,u=ee.now();for(;t.length>0&&u-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const u={zoom:0,bearing:0,pitch:0,roll:0,pan:new c.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:S}of this._inertiaBuffer)u.zoom+=S.zoomDelta||0,u.bearing+=S.bearingDelta||0,u.pitch+=S.pitchDelta||0,u.roll+=S.rollDelta||0,S.panDelta&&u.pan._add(S.panDelta),S.around&&(u.around=S.around),S.pinchAround&&(u.pinchAround=S.pinchAround);const m=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,b={};if(u.pan.mag()){const S=rc(u.pan.mag(),m,c.e({},wu,t||{})),C=u.pan.mult(S.amount/u.pan.mag()),O=this._map.cameraHelper.handlePanInertia(C,this._map.transform);b.center=O.easingCenter,b.offset=O.easingOffset,Fo(b,S)}if(u.zoom){const S=rc(u.zoom,m,ic);b.zoom=this._map.transform.zoom+S.amount,Fo(b,S)}if(u.bearing){const S=rc(u.bearing,m,Nl);b.bearing=this._map.transform.bearing+c.ah(S.amount,-179,179),Fo(b,S)}if(u.pitch){const S=rc(u.pitch,m,gl);b.pitch=this._map.transform.pitch+S.amount,Fo(b,S)}if(u.roll){const S=rc(u.roll,m,Tu);b.roll=this._map.transform.roll+c.ah(S.amount,-179,179),Fo(b,S)}if(b.zoom||b.bearing){const S=u.pinchAround===void 0?u.around:u.pinchAround;b.around=S?this._map.unproject(S):this._map.getCenter()}return this.clear(),c.e(b,{noMoveStart:!0})}}function Fo(T,t){(!T.duration||T.duration<t.duration)&&(T.duration=t.duration,T.easing=t.easing)}function rc(T,t,u){const{maxSpeed:m,linearity:b,deceleration:S}=u,C=c.ah(T*b/(t/1e3),-m,m),O=Math.abs(C)/(S*b);return{easing:u.easing,duration:1e3*O,amount:C*(O/2)}}class Ra extends c.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,u,m,b={}){m=m instanceof MouseEvent?m:new MouseEvent(t,m);const S=Y.mousePos(u.getCanvas(),m),C=u.unproject(S);super(t,c.e({point:S,lngLat:C,originalEvent:m},b)),this._defaultPrevented=!1,this.target=u}}class Su extends c.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,u,m){const b=t==="touchend"?m.changedTouches:m.touches,S=Y.touchPos(u.getCanvasContainer(),b),C=S.map((N=>u.unproject(N))),O=S.reduce(((N,U,q,W)=>N.add(U.div(W.length))),new c.P(0,0));super(t,{points:S,point:O,lngLats:C,lngLat:u.unproject(O),originalEvent:m}),this._defaultPrevented=!1}}class Eu extends c.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,u,m){super(t,{originalEvent:m}),this._defaultPrevented=!1}}class Ha{constructor(t,u){this._map=t,this._clickTolerance=u.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new Eu(t.type,this._map,t))}mousedown(t,u){return this._mousedownPos=u,this._firePreventable(new Ra(t.type,this._map,t))}mouseup(t){this._map.fire(new Ra(t.type,this._map,t))}click(t,u){this._mousedownPos&&this._mousedownPos.dist(u)>=this._clickTolerance||this._map.fire(new Ra(t.type,this._map,t))}dblclick(t){return this._firePreventable(new Ra(t.type,this._map,t))}mouseover(t){this._map.fire(new Ra(t.type,this._map,t))}mouseout(t){this._map.fire(new Ra(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Su(t.type,this._map,t))}touchmove(t){this._map.fire(new Su(t.type,this._map,t))}touchend(t){this._map.fire(new Su(t.type,this._map,t))}touchcancel(t){this._map.fire(new Su(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class td{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new Ra(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ra("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new Ra(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Bc{constructor(t){this._map=t}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(t){return this.transform.screenPointToLocation(c.P.convert(t),this._map.terrain)}}class Of{constructor(t,u){this._map=t,this._tr=new Bc(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=u.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,u){this.isEnabled()&&t.shiftKey&&t.button===0&&(Y.disableDrag(),this._startPos=this._lastPos=u,this._active=!0)}mousemoveWindow(t,u){if(!this._active)return;const m=u;if(this._lastPos.equals(m)||!this._box&&m.dist(this._startPos)<this._clickTolerance)return;const b=this._startPos;this._lastPos=m,this._box||(this._box=Y.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",t));const S=Math.min(b.x,m.x),C=Math.max(b.x,m.x),O=Math.min(b.y,m.y),N=Math.max(b.y,m.y);Y.setTransform(this._box,`translate(${S}px,${O}px)`),this._box.style.width=C-S+"px",this._box.style.height=N-O+"px"}mouseupWindow(t,u){if(!this._active||t.button!==0)return;const m=this._startPos,b=u;if(this.reset(),Y.suppressClick(),m.x!==b.x||m.y!==b.y)return this._map.fire(new c.l("boxzoomend",{originalEvent:t})),{cameraAnimation:S=>S.fitScreenCoordinates(m,b,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(Y.remove(this._box),this._box=null),Y.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,u){return this._map.fire(new c.l(t,{originalEvent:u}))}}function mh(T,t){if(T.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${T.length}, points ${t.length}`);const u={};for(let m=0;m<T.length;m++)u[T[m].identifier]=t[m];return u}class Gp{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,u,m){(this.centroid||m.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),m.length===this.numTouches&&(this.centroid=(function(b){const S=new c.P(0,0);for(const C of b)S._add(C);return S.div(b.length)})(u),this.touches=mh(m,u)))}touchmove(t,u,m){if(this.aborted||!this.centroid)return;const b=mh(m,u);for(const S in this.touches){const C=b[S];(!C||C.dist(this.touches[S])>30)&&(this.aborted=!0)}}touchend(t,u,m){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),m.length===0){const b=!this.aborted&&this.centroid;if(this.reset(),b)return b}}}class Ai{constructor(t){this.singleTap=new Gp(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,u,m){this.singleTap.touchstart(t,u,m)}touchmove(t,u,m){this.singleTap.touchmove(t,u,m)}touchend(t,u,m){const b=this.singleTap.touchend(t,u,m);if(b){const S=t.timeStamp-this.lastTime<500,C=!this.lastTap||this.lastTap.dist(b)<30;if(S&&C||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=b,this.count===this.numTaps)return this.reset(),b}}}class Vo{constructor(t){this._tr=new Bc(t),this._zoomIn=new Ai({numTouches:1,numTaps:2}),this._zoomOut=new Ai({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,u,m){this._zoomIn.touchstart(t,u,m),this._zoomOut.touchstart(t,u,m)}touchmove(t,u,m){this._zoomIn.touchmove(t,u,m),this._zoomOut.touchmove(t,u,m)}touchend(t,u,m){const b=this._zoomIn.touchend(t,u,m),S=this._zoomOut.touchend(t,u,m),C=this._tr;return b?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:O=>O.easeTo({duration:300,zoom:C.zoom+1,around:C.unproject(b)},{originalEvent:t})}):S?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:O=>O.easeTo({duration:300,zoom:C.zoom-1,around:C.unproject(S)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Yl{constructor(t){this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}reset(t){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(t)}_move(...t){const u=this._moveFunction(...t);if(u.bearingDelta||u.pitchDelta||u.rollDelta||u.around||u.panDelta)return this._active=!0,u}dragStart(t,u){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(t)&&(this._moveStateManager.startMove(t),this._lastPoint=Array.isArray(u)?u[0]:u,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(t,u){if(!this.isEnabled())return;const m=this._lastPoint;if(!m)return;if(t.preventDefault(),!this._moveStateManager.isValidMoveEvent(t))return void this.reset(t);const b=Array.isArray(u)?u[0]:u;return!this._moved&&b.dist(m)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=b,this._move(m,b))}dragEnd(t){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(t)&&(this._moved&&Y.suppressClick(),this.reset(t))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Js=0,ac=2,gh={[Js]:1,[ac]:2};class Ql{constructor(t){this._correctEvent=t.checkCorrectEvent}startMove(t){const u=Y.mouseButton(t);this._eventButton=u}endMove(t){delete this._eventButton}isValidStartEvent(t){return this._correctEvent(t)}isValidMoveEvent(t){return!(function(u,m){const b=gh[m];return u.buttons===void 0||(u.buttons&b)!==b})(t,this._eventButton)}isValidEndEvent(t){return Y.mouseButton(t)===this._eventButton}}class hg{constructor(){this._firstTouch=void 0}_isOneFingerTouch(t){return t.targetTouches.length===1}_isSameTouchEvent(t){return t.targetTouches[0].identifier===this._firstTouch}startMove(t){this._firstTouch=t.targetTouches[0].identifier}endMove(t){delete this._firstTouch}isValidStartEvent(t){return this._isOneFingerTouch(t)}isValidMoveEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}isValidEndEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}}class Zp{constructor(t=new Ql({checkCorrectEvent:()=>!0}),u=new hg){this.mouseMoveStateManager=t,this.oneFingerTouchMoveStateManager=u}_executeRelevantHandler(t,u,m){return t instanceof MouseEvent?u(t):typeof TouchEvent<"u"&&t instanceof TouchEvent?m(t):void 0}startMove(t){this._executeRelevantHandler(t,(u=>this.mouseMoveStateManager.startMove(u)),(u=>this.oneFingerTouchMoveStateManager.startMove(u)))}endMove(t){this._executeRelevantHandler(t,(u=>this.mouseMoveStateManager.endMove(u)),(u=>this.oneFingerTouchMoveStateManager.endMove(u)))}isValidStartEvent(t){return this._executeRelevantHandler(t,(u=>this.mouseMoveStateManager.isValidStartEvent(u)),(u=>this.oneFingerTouchMoveStateManager.isValidStartEvent(u)))}isValidMoveEvent(t){return this._executeRelevantHandler(t,(u=>this.mouseMoveStateManager.isValidMoveEvent(u)),(u=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(u)))}isValidEndEvent(t){return this._executeRelevantHandler(t,(u=>this.mouseMoveStateManager.isValidEndEvent(u)),(u=>this.oneFingerTouchMoveStateManager.isValidEndEvent(u)))}}const nd=T=>{T.mousedown=T.dragStart,T.mousemoveWindow=T.dragMove,T.mouseup=T.dragEnd,T.contextmenu=t=>{t.preventDefault()}};class _h{constructor(t,u){this._clickTolerance=t.clickTolerance||1,this._map=u,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new c.P(0,0)}_shouldBePrevented(t){return t<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(t,u,m){return this._calculateTransform(t,u,m)}touchmove(t,u,m){if(this._active){if(!this._shouldBePrevented(m.length))return t.preventDefault(),this._calculateTransform(t,u,m);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",t)}}touchend(t,u,m){this._calculateTransform(t,u,m),this._active&&this._shouldBePrevented(m.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,u,m){m.length>0&&(this._active=!0);const b=mh(m,u),S=new c.P(0,0),C=new c.P(0,0);let O=0;for(const U in b){const q=b[U],W=this._touches[U];W&&(S._add(q),C._add(q.sub(W)),O++,b[U]=q)}if(this._touches=b,this._shouldBePrevented(O)||!C.mag())return;const N=C.div(O);return this._sum._add(N),this._sum.mag()<this._clickTolerance?void 0:{around:S.div(O),panDelta:N}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class as{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(t,u,m){this._firstTwoTouches||m.length<2||(this._firstTwoTouches=[m[0].identifier,m[1].identifier],this._start([u[0],u[1]]))}touchmove(t,u,m){if(!this._firstTwoTouches)return;t.preventDefault();const[b,S]=this._firstTwoTouches,C=Yt(m,u,b),O=Yt(m,u,S);if(!C||!O)return;const N=this._aroundCenter?null:C.add(O).div(2);return this._move([C,O],N,t)}touchend(t,u,m){if(!this._firstTwoTouches)return;const[b,S]=this._firstTwoTouches,C=Yt(m,u,b),O=Yt(m,u,S);C&&O||(this._active&&Y.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Yt(T,t,u){for(let m=0;m<T.length;m++)if(T[m].identifier===u)return t[m]}function yh(T,t){return Math.log(T/t)/Math.LN2}class id extends as{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,u){const m=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(yh(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:yh(this._distance,m),pinchAround:u}}}function sc(T,t){return 180*T.angleWith(t)/Math.PI}class oc extends as{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,u,m){const b=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:sc(this._vector,b),pinchAround:u}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const u=25/(Math.PI*this._minDiameter)*360,m=sc(t,this._startVector);return Math.abs(m)<u}}function Jl(T){return Math.abs(T.y)>Math.abs(T.x)}class Fc extends as{constructor(t){super(),this._currentTouchCount=0,this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,u,m){super.touchstart(t,u,m),this._currentTouchCount=m.length}_start(t){this._lastPoints=t,Jl(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,u,m){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const b=t[0].sub(this._lastPoints[0]),S=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(b,S,m.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(b.y+S.y)/2*-.5}):void 0}gestureBeginsVertically(t,u,m){if(this._valid!==void 0)return this._valid;const b=t.mag()>=2,S=u.mag()>=2;if(!b&&!S)return;if(!b||!S)return this._firstMove===void 0&&(this._firstMove=m),m-this._firstMove<100&&void 0;const C=t.y>0==u.y>0;return Jl(t)&&Jl(u)&&C}}const ii={panStep:100,bearingStep:15,pitchStep:10};class rd{constructor(t){this._tr=new Bc(t);const u=ii;this._panStep=u.panStep,this._bearingStep=u.bearingStep,this._pitchStep=u.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let u=0,m=0,b=0,S=0,C=0;switch(t.keyCode){case 61:case 107:case 171:case 187:u=1;break;case 189:case 109:case 173:u=-1;break;case 37:t.shiftKey?m=-1:(t.preventDefault(),S=-1);break;case 39:t.shiftKey?m=1:(t.preventDefault(),S=1);break;case 38:t.shiftKey?b=1:(t.preventDefault(),C=-1);break;case 40:t.shiftKey?b=-1:(t.preventDefault(),C=1);break;default:return}return this._rotationDisabled&&(m=0,b=0),{cameraAnimation:O=>{const N=this._tr;O.easeTo({duration:300,easeId:"keyboardHandler",easing:Vc,zoom:u?Math.round(N.zoom)+u*(t.shiftKey?2:1):N.zoom,bearing:N.bearing+m*this._bearingStep,pitch:N.pitch+b*this._pitchStep,offset:[-S*this._panStep,-C*this._panStep],center:N.center},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Vc(T){return T*(2-T)}const eu=4.000244140625,Hp=1/450;class Nf{constructor(t,u){this._onTimeout=m=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(m)},this._map=t,this._tr=new Bc(t),this._triggerRenderFrame=u,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Hp}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(t){return!!this._map.cooperativeGestures.isEnabled()&&!(t.ctrlKey||this._map.cooperativeGestures.isBypassed(t))}wheel(t){if(!this.isEnabled())return;if(this._shouldBePrevented(t))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",t);let u=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const m=ee.now(),b=m-(this._lastWheelEventTime||0);this._lastWheelEventTime=m,u!==0&&u%eu==0?this._type="wheel":u!==0&&Math.abs(u)<4?this._type="trackpad":b>400?(this._type=null,this._lastValue=u,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(b*u)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,u+=this._lastValue)),t.shiftKey&&u&&(u/=4),this._type&&(this._lastWheelEvent=t,this._delta-=u,this._active||this._start(t)),t.preventDefault()}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const u=Y.mousePos(this._map.getCanvas(),t),m=this._tr;this._aroundPoint=this._aroundCenter?m.transform.locationToScreenPoint(c.S.convert(m.center)):u,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const O=t.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=O),typeof this._targetZoom=="number"&&(this._targetZoom+=O)}if(this._delta!==0){const O=this._type==="wheel"&&Math.abs(this._delta)>eu?this._wheelZoomRate:this._defaultZoomRate;let N=2/(1+Math.exp(-Math.abs(this._delta*O)));this._delta<0&&N!==0&&(N=1/N);const U=typeof this._targetZoom!="number"?t.scale:c.af(this._targetZoom);this._targetZoom=t.getConstrained(t.getCameraLngLat(),c.ak(U*N)).zoom,this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const u=typeof this._targetZoom!="number"?t.zoom:this._targetZoom,m=this._startZoom,b=this._easing;let S,C=!1;if(this._type==="wheel"&&m&&b){const O=ee.now()-this._lastWheelEventTime,N=Math.min((O+5)/200,1),U=b(N);S=c.C.number(m,u,U),N<1?this._frameId||(this._frameId=!0):C=!0}else S=u,C=!0;return this._active=!0,C&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout}),200)),this._lastExpectedZoom=S,{noInertia:!0,needsRenderFrame:!C,zoomDelta:S-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let u=c.co;if(this._prevEase){const m=this._prevEase,b=(ee.now()-m.start)/m.duration,S=m.easing(b+.01)-m.easing(b),C=.27/Math.sqrt(S*S+1e-4)*.01,O=Math.sqrt(.0729-C*C);u=c.cm(C,O,.25,1)}return this._prevEase={start:ee.now(),duration:t,easing:u},u}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class lc{constructor(t,u){this._clickZoom=t,this._tapZoom=u}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class jc{constructor(t){this._tr=new Bc(t),this.reset()}reset(){this._active=!1}dblclick(t,u){return t.preventDefault(),{cameraAnimation:m=>{m.easeTo({duration:300,zoom:this._tr.zoom+(t.shiftKey?-1:1),around:this._tr.unproject(u)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ad{constructor(){this._tap=new Ai({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(t,u,m){if(!this._swipePoint)if(this._tapTime){const b=u[0],S=t.timeStamp-this._tapTime<500,C=this._tapPoint.dist(b)<30;S&&C?m.length>0&&(this._swipePoint=b,this._swipeTouch=m[0].identifier):this.reset()}else this._tap.touchstart(t,u,m)}touchmove(t,u,m){if(this._tapTime){if(this._swipePoint){if(m[0].identifier!==this._swipeTouch)return;const b=u[0],S=b.y-this._swipePoint.y;return this._swipePoint=b,t.preventDefault(),this._active=!0,{zoomDelta:S/128}}}else this._tap.touchmove(t,u,m)}touchend(t,u,m){if(this._tapTime)this._swipePoint&&m.length===0&&this.reset();else{const b=this._tap.touchend(t,u,m);b&&(this._tapTime=t.timeStamp,this._tapPoint=b)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class vh{constructor(t,u,m){this._el=t,this._mousePan=u,this._touchPan=m}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class bh{constructor(t,u,m,b){this._pitchWithRotate=t.pitchWithRotate,this._rollEnabled=t.rollEnabled,this._mouseRotate=u,this._mousePitch=m,this._mouseRoll=b}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class Bf{constructor(t,u,m,b){this._el=t,this._touchZoom=u,this._touchRotate=m,this._tapDragZoom=b,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class uc{constructor(t,u){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=t,this._options=u,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const t=this._map.getCanvasContainer();t.classList.add("maplibregl-cooperative-gestures"),this._container=Y.create("div","maplibregl-cooperative-gesture-screen",t);let u=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(u=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const m=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),b=document.createElement("div");b.className="maplibregl-desktop-message",b.textContent=u,this._container.appendChild(b);const S=document.createElement("div");S.className="maplibregl-mobile-message",S.textContent=m,this._container.appendChild(S),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(Y.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(t){return t[this._bypassKey]}notifyGestureBlocked(t,u){this._enabled&&(this._map.fire(new c.l("cooperativegestureprevented",{gestureType:t,originalEvent:u})),this._container.classList.add("maplibregl-show"),setTimeout((()=>{this._container.classList.remove("maplibregl-show")}),100))}}const _l=T=>T.zoom||T.drag||T.roll||T.pitch||T.rotate;class ki extends c.l{}function cc(T){return T.panDelta&&T.panDelta.mag()||T.zoomDelta||T.bearingDelta||T.pitchDelta||T.rollDelta}class sd{constructor(t,u){this.handleWindowEvent=b=>{this.handleEvent(b,`${b.type}Window`)},this.handleEvent=(b,S)=>{if(b.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const C=b.type==="renderFrame"?void 0:b,O={needsRenderFrame:!1},N={},U={};for(const{handlerName:H,handler:J,allowed:ae}of this._handlers){if(!J.isEnabled())continue;let ge;if(this._blockedByActive(U,ae,H))J.reset();else if(J[S||b.type]){if(c.cp(b,S||b.type)){const me=Y.mousePos(this._map.getCanvas(),b);ge=J[S||b.type](b,me)}else if(c.cq(b,S||b.type)){const me=this._getMapTouches(b.touches),ve=Y.touchPos(this._map.getCanvas(),me);ge=J[S||b.type](b,ve,me)}else c.cr(S||b.type)||(ge=J[S||b.type](b));this.mergeHandlerResult(O,N,ge,H,C),ge&&ge.needsRenderFrame&&this._triggerRenderFrame()}(ge||J.isActive())&&(U[H]=J)}const q={};for(const H in this._previousActiveHandlers)U[H]||(q[H]=C);this._previousActiveHandlers=U,(Object.keys(q).length||cc(O))&&(this._changes.push([O,N,q]),this._triggerRenderFrame()),(Object.keys(U).length||cc(O))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:W}=O;W&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],W(this._map))},this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Kl(t),this._bearingSnap=u.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(u);const m=this._el;this._listeners=[[m,"touchstart",{passive:!0}],[m,"touchmove",{passive:!1}],[m,"touchend",void 0],[m,"touchcancel",void 0],[m,"mousedown",void 0],[m,"mousemove",void 0],[m,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[m,"mouseover",void 0],[m,"mouseout",void 0],[m,"dblclick",void 0],[m,"click",void 0],[m,"keydown",{capture:!1}],[m,"keyup",void 0],[m,"wheel",{passive:!1}],[m,"contextmenu",void 0],[window,"blur",void 0]];for(const[b,S,C]of this._listeners)Y.addEventListener(b,S,b===document?this.handleWindowEvent:this.handleEvent,C)}destroy(){for(const[t,u,m]of this._listeners)Y.removeEventListener(t,u,t===document?this.handleWindowEvent:this.handleEvent,m)}_addDefaultHandlers(t){const u=this._map,m=u.getCanvasContainer();this._add("mapEvent",new Ha(u,t));const b=u.boxZoom=new Of(u,t);this._add("boxZoom",b),t.interactive&&t.boxZoom&&b.enable();const S=u.cooperativeGestures=new uc(u,t.cooperativeGestures);this._add("cooperativeGestures",S),t.cooperativeGestures&&S.enable();const C=new Vo(u),O=new jc(u);u.doubleClickZoom=new lc(O,C),this._add("tapZoom",C),this._add("clickZoom",O),t.interactive&&t.doubleClickZoom&&u.doubleClickZoom.enable();const N=new ad;this._add("tapDragZoom",N);const U=u.touchPitch=new Fc(u);this._add("touchPitch",U),t.interactive&&t.touchPitch&&u.touchPitch.enable(t.touchPitch);const q=()=>u.project(u.getCenter()),W=(function({enable:Ce,clickTolerance:ze,aroundCenter:Ve=!0,minPixelCenterThreshold:Me=100,rotateDegreesPerPixelMoved:Ye=.8},ct){const rt=new Ql({checkCorrectEvent:st=>Y.mouseButton(st)===0&&st.ctrlKey||Y.mouseButton(st)===2&&!st.ctrlKey});return new Yl({clickTolerance:ze,move:(st,lt)=>{const Nt=ct();if(Ve&&Math.abs(Nt.y-st.y)>Me)return{bearingDelta:c.cn(new c.P(st.x,lt.y),lt,Nt)};let Vt=(lt.x-st.x)*Ye;return Ve&&lt.y<Nt.y&&(Vt=-Vt),{bearingDelta:Vt}},moveStateManager:rt,enable:Ce,assignEvents:nd})})(t,q),H=(function({enable:Ce,clickTolerance:ze,pitchDegreesPerPixelMoved:Ve=-.5}){const Me=new Ql({checkCorrectEvent:Ye=>Y.mouseButton(Ye)===0&&Ye.ctrlKey||Y.mouseButton(Ye)===2});return new Yl({clickTolerance:ze,move:(Ye,ct)=>({pitchDelta:(ct.y-Ye.y)*Ve}),moveStateManager:Me,enable:Ce,assignEvents:nd})})(t),J=(function({enable:Ce,clickTolerance:ze,rollDegreesPerPixelMoved:Ve=.3},Me){const Ye=new Ql({checkCorrectEvent:ct=>Y.mouseButton(ct)===2&&ct.ctrlKey});return new Yl({clickTolerance:ze,move:(ct,rt)=>{const st=Me();let lt=(rt.x-ct.x)*Ve;return rt.y<st.y&&(lt=-lt),{rollDelta:lt}},moveStateManager:Ye,enable:Ce,assignEvents:nd})})(t,q);u.dragRotate=new bh(t,W,H,J),this._add("mouseRotate",W,["mousePitch"]),this._add("mousePitch",H,["mouseRotate","mouseRoll"]),this._add("mouseRoll",J,["mousePitch"]),t.interactive&&t.dragRotate&&u.dragRotate.enable();const ae=(function({enable:Ce,clickTolerance:ze}){const Ve=new Ql({checkCorrectEvent:Me=>Y.mouseButton(Me)===0&&!Me.ctrlKey});return new Yl({clickTolerance:ze,move:(Me,Ye)=>({around:Ye,panDelta:Ye.sub(Me)}),activateOnStart:!0,moveStateManager:Ve,enable:Ce,assignEvents:nd})})(t),ge=new _h(t,u);u.dragPan=new vh(m,ae,ge),this._add("mousePan",ae),this._add("touchPan",ge,["touchZoom","touchRotate"]),t.interactive&&t.dragPan&&u.dragPan.enable(t.dragPan);const me=new oc,ve=new id;u.touchZoomRotate=new Bf(m,ve,me,N),this._add("touchRotate",me,["touchPan","touchZoom"]),this._add("touchZoom",ve,["touchPan","touchRotate"]),t.interactive&&t.touchZoomRotate&&u.touchZoomRotate.enable(t.touchZoomRotate);const we=u.scrollZoom=new Nf(u,(()=>this._triggerRenderFrame()));this._add("scrollZoom",we,["mousePan"]),t.interactive&&t.scrollZoom&&u.scrollZoom.enable(t.scrollZoom);const Ie=u.keyboard=new rd(u);this._add("keyboard",Ie),t.interactive&&t.keyboard&&u.keyboard.enable(),this._add("blockableMapEvent",new td(u))}_add(t,u,m){this._handlers.push({handlerName:t,handler:u,allowed:m}),this._handlersById[t]=u}stop(t){if(!this._updatingCamera){for(const{handler:u}of this._handlers)u.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!_l(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,u,m){for(const b in t)if(b!==m&&(!u||u.indexOf(b)<0))return!0;return!1}_getMapTouches(t){const u=[];for(const m of t)this._el.contains(m.target)&&u.push(m);return u}mergeHandlerResult(t,u,m,b,S){if(!m)return;c.e(t,m);const C={handlerName:b,originalEvent:m.originalEvent||S};m.zoomDelta!==void 0&&(u.zoom=C),m.panDelta!==void 0&&(u.drag=C),m.rollDelta!==void 0&&(u.roll=C),m.pitchDelta!==void 0&&(u.pitch=C),m.bearingDelta!==void 0&&(u.rotate=C)}_applyChanges(){const t={},u={},m={};for(const[b,S,C]of this._changes)b.panDelta&&(t.panDelta=(t.panDelta||new c.P(0,0))._add(b.panDelta)),b.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+b.zoomDelta),b.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+b.bearingDelta),b.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+b.pitchDelta),b.rollDelta&&(t.rollDelta=(t.rollDelta||0)+b.rollDelta),b.around!==void 0&&(t.around=b.around),b.pinchAround!==void 0&&(t.pinchAround=b.pinchAround),b.noInertia&&(t.noInertia=b.noInertia),c.e(u,S),c.e(m,C);this._updateMapTransform(t,u,m),this._changes=[]}_updateMapTransform(t,u,m){const b=this._map,S=b._getTransformForUpdate(),C=b.terrain;if(!(cc(t)||C&&this._terrainMovement))return this._fireEvents(u,m,!0);b._stop(!0);let{panDelta:O,zoomDelta:N,bearingDelta:U,pitchDelta:q,rollDelta:W,around:H,pinchAround:J}=t;J!==void 0&&(H=J),H=H||b.transform.centerPoint,C&&!S.isPointOnMapSurface(H)&&(H=S.centerPoint);const ae={panDelta:O,zoomDelta:N,rollDelta:W,pitchDelta:q,bearingDelta:U,around:H};this._map.cameraHelper.useGlobeControls&&!S.isPointOnMapSurface(H)&&(H=S.centerPoint);const ge=H.distSqr(S.centerPoint)<.01?S.center:S.screenPointToLocation(O?H.sub(O):H);C?(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(ae,S),this._terrainMovement||!u.drag&&!u.zoom?u.drag&&this._terrainMovement?S.setCenter(S.screenPointToLocation(S.centerPoint.sub(O))):this._map.cameraHelper.handleMapControlsPan(ae,S,ge):(this._terrainMovement=!0,this._map._elevationFreeze=!0,this._map.cameraHelper.handleMapControlsPan(ae,S,ge))):(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(ae,S),this._map.cameraHelper.handleMapControlsPan(ae,S,ge)),b._applyUpdatedTransform(S),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(u,m,!0)}_fireEvents(t,u,m){const b=_l(this._eventsInProgress),S=_l(t),C={};for(const W in t){const{originalEvent:H}=t[W];this._eventsInProgress[W]||(C[`${W}start`]=H),this._eventsInProgress[W]=t[W]}!b&&S&&this._fireEvent("movestart",S.originalEvent);for(const W in C)this._fireEvent(W,C[W]);S&&this._fireEvent("move",S.originalEvent);for(const W in t){const{originalEvent:H}=t[W];this._fireEvent(W,H)}const O={};let N;for(const W in this._eventsInProgress){const{handlerName:H,originalEvent:J}=this._eventsInProgress[W];this._handlersById[H].isActive()||(delete this._eventsInProgress[W],N=u[H]||J,O[`${W}end`]=N)}for(const W in O)this._fireEvent(W,O[W]);const U=_l(this._eventsInProgress),q=(b||S)&&!U;if(q&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const W=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&W.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(W)}if(m&&q){this._updatingCamera=!0;const W=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),H=J=>J!==0&&-this._bearingSnap<J&&J<this._bearingSnap;!W||!W.essential&&ee.prefersReducedMotion?(this._map.fire(new c.l("moveend",{originalEvent:N})),H(this._map.getBearing())&&this._map.resetNorth()):(H(W.bearing||this._map.getBearing())&&(W.bearing=0),W.freezeElevation=!0,this._map.easeTo(W,{originalEvent:N})),this._updatingCamera=!1}}_fireEvent(t,u){this._map.fire(new c.l(t,u?{originalEvent:u}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((t=>{delete this._frameId,this.handleEvent(new ki("renderFrame",{timeStamp:t})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Au extends c.E{constructor(t,u,m){super(),this._renderFrameCallback=()=>{const b=Math.min((ee.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(b)),b<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=m.bearingSnap,this.cameraHelper=u,this.on("moveend",(()=>{delete this._requestedCameraState}))}migrateProjection(t,u){t.apply(this.transform),this.transform=t,this.cameraHelper=u}getCenter(){return new c.S(this.transform.center.lng,this.transform.center.lat)}setCenter(t,u){return this.jumpTo({center:t},u)}getCenterElevation(){return this.transform.elevation}setCenterElevation(t,u){return this.jumpTo({elevation:t},u),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(t){this._centerClampedToGround=t}panBy(t,u,m){return t=c.P.convert(t).mult(-1),this.panTo(this.transform.center,c.e({offset:t},u),m)}panTo(t,u,m){return this.easeTo(c.e({center:t},u),m)}getZoom(){return this.transform.zoom}setZoom(t,u){return this.jumpTo({zoom:t},u),this}zoomTo(t,u,m){return this.easeTo(c.e({zoom:t},u),m)}zoomIn(t,u){return this.zoomTo(this.getZoom()+1,t,u),this}zoomOut(t,u){return this.zoomTo(this.getZoom()-1,t,u),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(t,u){return t!=this.transform.fov&&(this.transform.setFov(t),this.fire(new c.l("movestart",u)).fire(new c.l("move",u)).fire(new c.l("moveend",u))),this}getBearing(){return this.transform.bearing}setBearing(t,u){return this.jumpTo({bearing:t},u),this}getPadding(){return this.transform.padding}setPadding(t,u){return this.jumpTo({padding:t},u),this}rotateTo(t,u,m){return this.easeTo(c.e({bearing:t},u),m)}resetNorth(t,u){return this.rotateTo(0,c.e({duration:1e3},t),u),this}resetNorthPitch(t,u){return this.easeTo(c.e({bearing:0,pitch:0,roll:0,duration:1e3},t),u),this}snapToNorth(t,u){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,u):this}getPitch(){return this.transform.pitch}setPitch(t,u){return this.jumpTo({pitch:t},u),this}getRoll(){return this.transform.roll}setRoll(t,u){return this.jumpTo({roll:t},u),this}cameraForBounds(t,u){t=Ni.convert(t).adjustAntiMeridian();const m=u&&u.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),m,u)}_cameraForBoxAndBearing(t,u,m,b){const S={top:0,bottom:0,right:0,left:0};if(typeof(b=c.e({padding:S,offset:[0,0],maxZoom:this.transform.maxZoom},b)).padding=="number"){const U=b.padding;b.padding={top:U,bottom:U,right:U,left:U}}const C=c.e(S,b.padding);b.padding=C;const O=this.transform,N=new Ni(t,u);return this.cameraHelper.cameraForBoxAndBearing(b,C,N,m,O)}fitBounds(t,u,m){return this._fitInternal(this.cameraForBounds(t,u),u,m)}fitScreenCoordinates(t,u,m,b,S){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(c.P.convert(t)),this.transform.screenPointToLocation(c.P.convert(u)),m,b),b,S)}_fitInternal(t,u,m){return t?(delete(u=c.e(t,u)).padding,u.linear?this.easeTo(u,m):this.flyTo(u,m)):this}jumpTo(t,u){this.stop();const m=this._getTransformForUpdate();let b=!1,S=!1,C=!1;const O=m.zoom;this.cameraHelper.handleJumpToCenterZoom(m,t);const N=m.zoom!==O;return"elevation"in t&&m.elevation!==+t.elevation&&m.setElevation(+t.elevation),"bearing"in t&&m.bearing!==+t.bearing&&(b=!0,m.setBearing(+t.bearing)),"pitch"in t&&m.pitch!==+t.pitch&&(S=!0,m.setPitch(+t.pitch)),"roll"in t&&m.roll!==+t.roll&&(C=!0,m.setRoll(+t.roll)),t.padding==null||m.isPaddingEqual(t.padding)||m.setPadding(t.padding),this._applyUpdatedTransform(m),this.fire(new c.l("movestart",u)).fire(new c.l("move",u)),N&&this.fire(new c.l("zoomstart",u)).fire(new c.l("zoom",u)).fire(new c.l("zoomend",u)),b&&this.fire(new c.l("rotatestart",u)).fire(new c.l("rotate",u)).fire(new c.l("rotateend",u)),S&&this.fire(new c.l("pitchstart",u)).fire(new c.l("pitch",u)).fire(new c.l("pitchend",u)),C&&this.fire(new c.l("rollstart",u)).fire(new c.l("roll",u)).fire(new c.l("rollend",u)),this.fire(new c.l("moveend",u))}calculateCameraOptionsFromTo(t,u,m,b=0){const S=c.a1.fromLngLat(t,u),C=c.a1.fromLngLat(m,b),O=C.x-S.x,N=C.y-S.y,U=C.z-S.z,q=Math.hypot(O,N,U);if(q===0)throw new Error("Can't calculate camera options with same From and To");const W=Math.hypot(O,N),H=c.ak(this.transform.cameraToCenterDistance/q/this.transform.tileSize),J=180*Math.atan2(O,-N)/Math.PI;let ae=180*Math.acos(W/q)/Math.PI;return ae=U<0?90-ae:90+ae,{center:C.toLngLat(),elevation:b,zoom:H,pitch:ae,bearing:J}}calculateCameraOptionsFromCameraLngLatAltRotation(t,u,m,b,S){const C=this.transform.calculateCenterFromCameraLngLatAlt(t,u,m,b);return{center:C.center,elevation:C.elevation,zoom:C.zoom,bearing:m,pitch:b,roll:S}}easeTo(t,u){this._stop(!1,t.easeId),((t=c.e({offset:[0,0],duration:500,easing:c.co},t)).animate===!1||!t.essential&&ee.prefersReducedMotion)&&(t.duration=0);const m=this._getTransformForUpdate(),b=this.getBearing(),S=m.pitch,C=m.roll,O="bearing"in t?this._normalizeBearing(t.bearing,b):b,N="pitch"in t?+t.pitch:S,U="roll"in t?this._normalizeBearing(t.roll,C):C,q="padding"in t?t.padding:m.padding,W=c.P.convert(t.offset);let H,J;t.around&&(H=c.S.convert(t.around),J=m.locationToScreenPoint(H));const ae={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},ge=this.cameraHelper.handleEaseTo(m,{bearing:O,pitch:N,roll:U,padding:q,around:H,aroundPoint:J,offsetAsPoint:W,offset:t.offset,zoom:t.zoom,center:t.center});return this._rotating=this._rotating||b!==O,this._pitching=this._pitching||N!==S,this._rolling=this._rolling||U!==C,this._padding=!m.isPaddingEqual(q),this._zooming=this._zooming||ge.isZooming,this._easeId=t.easeId,this._prepareEase(u,t.noMoveStart,ae),this.terrain&&this._prepareElevation(ge.elevationCenter),this._ease((me=>{ge.easeFunc(me),this.terrain&&!t.freezeElevation&&this._updateElevation(me),this._applyUpdatedTransform(m),this._fireMoveEvents(u)}),(me=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(u,me)}),t),this}_prepareEase(t,u,m={}){this._moving=!0,u||m.moving||this.fire(new c.l("movestart",t)),this._zooming&&!m.zooming&&this.fire(new c.l("zoomstart",t)),this._rotating&&!m.rotating&&this.fire(new c.l("rotatestart",t)),this._pitching&&!m.pitching&&this.fire(new c.l("pitchstart",t)),this._rolling&&!m.rolling&&this.fire(new c.l("rollstart",t))}_prepareElevation(t){this._elevationCenter=t,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(t,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(t){this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const u=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(t<1&&u!==this._elevationTarget){const m=this._elevationTarget-this._elevationStart;this._elevationStart+=t*(m-(u-(m*t+this._elevationStart))/(1-t)),this._elevationTarget=u}this.transform.setElevation(c.C.number(this._elevationStart,this._elevationTarget,t))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(t){if(!this.terrain&&t.elevation>=0&&t.pitch<=90)return{};const u=t.getCameraLngLat(),m=t.getCameraAltitude(),b=this.terrain?this.terrain.getElevationForLngLatZoom(u,t.zoom):0;if(m<b){const S=this.calculateCameraOptionsFromTo(u,b,t.center,t.elevation);return{pitch:S.pitch,zoom:S.zoom}}return{}}_applyUpdatedTransform(t){const u=[];if(u.push((b=>this._elevateCameraIfInsideTerrain(b))),this.transformCameraUpdate&&u.push((b=>this.transformCameraUpdate(b))),!u.length)return;const m=t.clone();for(const b of u){const S=m.clone(),{center:C,zoom:O,roll:N,pitch:U,bearing:q,elevation:W}=b(S);C&&S.setCenter(C),W!==void 0&&S.setElevation(W),O!==void 0&&S.setZoom(O),N!==void 0&&S.setRoll(N),U!==void 0&&S.setPitch(U),q!==void 0&&S.setBearing(q),m.apply(S)}this.transform.apply(m)}_fireMoveEvents(t){this.fire(new c.l("move",t)),this._zooming&&this.fire(new c.l("zoom",t)),this._rotating&&this.fire(new c.l("rotate",t)),this._pitching&&this.fire(new c.l("pitch",t)),this._rolling&&this.fire(new c.l("roll",t))}_afterEase(t,u){if(this._easeId&&u&&this._easeId===u)return;delete this._easeId;const m=this._zooming,b=this._rotating,S=this._pitching,C=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,m&&this.fire(new c.l("zoomend",t)),b&&this.fire(new c.l("rotateend",t)),S&&this.fire(new c.l("pitchend",t)),C&&this.fire(new c.l("rollend",t)),this.fire(new c.l("moveend",t))}flyTo(t,u){if(!t.essential&&ee.prefersReducedMotion){const lt=c.Q(t,["center","zoom","bearing","pitch","roll","elevation"]);return this.jumpTo(lt,u)}this.stop(),t=c.e({offset:[0,0],speed:1.2,curve:1.42,easing:c.co},t);const m=this._getTransformForUpdate(),b=m.bearing,S=m.pitch,C=m.roll,O=m.padding,N="bearing"in t?this._normalizeBearing(t.bearing,b):b,U="pitch"in t?+t.pitch:S,q="roll"in t?this._normalizeBearing(t.roll,C):C,W="padding"in t?t.padding:m.padding,H=c.P.convert(t.offset);let J=m.centerPoint.add(H);const ae=m.screenPointToLocation(J),ge=this.cameraHelper.handleFlyTo(m,{bearing:N,pitch:U,roll:q,padding:W,locationAtOffset:ae,offsetAsPoint:H,center:t.center,minZoom:t.minZoom,zoom:t.zoom});let me=t.curve;const ve=Math.max(m.width,m.height),we=ve/ge.scaleOfZoom,Ie=ge.pixelPathLength;typeof ge.scaleOfMinZoom=="number"&&(me=Math.sqrt(ve/ge.scaleOfMinZoom/Ie*2));const Ce=me*me;function ze(lt){const Nt=(we*we-ve*ve+(lt?-1:1)*Ce*Ce*Ie*Ie)/(2*(lt?we:ve)*Ce*Ie);return Math.log(Math.sqrt(Nt*Nt+1)-Nt)}function Ve(lt){return(Math.exp(lt)-Math.exp(-lt))/2}function Me(lt){return(Math.exp(lt)+Math.exp(-lt))/2}const Ye=ze(!1);let ct=function(lt){return Me(Ye)/Me(Ye+me*lt)},rt=function(lt){return ve*((Me(Ye)*(Ve(Nt=Ye+me*lt)/Me(Nt))-Ve(Ye))/Ce)/Ie;var Nt},st=(ze(!0)-Ye)/me;if(Math.abs(Ie)<2e-6||!isFinite(st)){if(Math.abs(ve-we)<1e-6)return this.easeTo(t,u);const lt=we<ve?-1:1;st=Math.abs(Math.log(we/ve))/me,rt=()=>0,ct=Nt=>Math.exp(lt*me*Nt)}return t.duration="duration"in t?+t.duration:1e3*st/("screenSpeed"in t?+t.screenSpeed/me:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=b!==N,this._pitching=U!==S,this._rolling=q!==C,this._padding=!m.isPaddingEqual(W),this._prepareEase(u,!1),this.terrain&&this._prepareElevation(ge.targetCenter),this._ease((lt=>{const Nt=lt*st,Vt=1/ct(Nt),At=rt(Nt);this._rotating&&m.setBearing(c.C.number(b,N,lt)),this._pitching&&m.setPitch(c.C.number(S,U,lt)),this._rolling&&m.setRoll(c.C.number(C,q,lt)),this._padding&&(m.interpolatePadding(O,W,lt),J=m.centerPoint.add(H)),ge.easeFunc(lt,Vt,At,J),this.terrain&&!t.freezeElevation&&this._updateElevation(lt),this._applyUpdatedTransform(m),this._fireMoveEvents(u)}),(()=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(u)}),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,u){var m;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const b=this._onEaseEnd;delete this._onEaseEnd,b.call(this,u)}return t||(m=this.handlers)===null||m===void 0||m.stop(!1),this}_ease(t,u,m){m.animate===!1||m.duration===0?(t(1),u()):(this._easeStart=ee.now(),this._easeOptions=m,this._onEaseFrame=t,this._onEaseEnd=u,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(t,u){t=c.aO(t,-180,180);const m=Math.abs(t-u);return Math.abs(t-360-u)<m&&(t-=360),Math.abs(t+360-u)<m&&(t+=360),t}queryTerrainElevation(t){return this.terrain?this.terrain.getElevationForLngLatZoom(c.S.convert(t),this.transform.tileZoom):null}}const tu={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Uc{constructor(t=tu){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=u=>{!u||u.sourceDataType!=="metadata"&&u.sourceDataType!=="visibility"&&u.dataType!=="style"&&u.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=t}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options.compact,this._container=Y.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=Y.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Y.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){Y.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,u){const m=this._map._getUIString(`AttributionControl.${u}`);t.title=m,t.setAttribute("aria-label",m)}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map((b=>typeof b!="string"?"":b))):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const b=this._map.style.stylesheet;this.styleOwner=b.owner,this.styleId=b.id}const u=this._map.style.sourceCaches;for(const b in u){const S=u[b];if(S.used||S.usedForTerrain){const C=S.getSource();C.attribution&&t.indexOf(C.attribution)<0&&t.push(C.attribution)}}t=t.filter((b=>String(b).trim())),t.sort(((b,S)=>b.length-S.length)),t=t.filter(((b,S)=>{for(let C=S+1;C<t.length;C++)if(t[C].indexOf(b)>=0)return!1;return!0}));const m=t.join(" | ");m!==this._attribHTML&&(this._attribHTML=m,t.length?(this._innerContainer.innerHTML=Y.sanitize(m),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Gd{constructor(t={}){this._updateCompact=()=>{const u=this._container.children;if(u.length){const m=u[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&m.classList.add("maplibregl-compact"):m.classList.remove("maplibregl-compact")}},this.options=t}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=Y.create("div","maplibregl-ctrl");const u=Y.create("a","maplibregl-ctrl-logo");return u.target="_blank",u.rel="noopener nofollow",u.href="https://maplibre.org/",u.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),u.setAttribute("rel","noopener nofollow"),this._container.appendChild(u),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){Y.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class yl{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const u=++this._id;return this._queue.push({callback:t,id:u,cancelled:!1}),u}remove(t){const u=this._currentlyRunning,m=u?this._queue.concat(u):this._queue;for(const b of m)if(b.id===t)return void(b.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const u=this._currentlyRunning=this._queue;this._queue=[];for(const m of u)if(!m.cancelled&&(m.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var hc=c.aJ([{name:"a_pos3d",type:"Int16",components:3}]);class an extends c.E{constructor(t){super(),this._lastTilesetChange=ee.now(),this.sourceCache=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=t._source.tileSize*2**this.deltaZoom,t.usedForTerrain=!0,t.tileSize=this.tileSize}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(t,u){this.sourceCache.update(t,u),this._renderableTilesKeys=[];const m={};for(const b of $e(t,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:u,calculateTileZoom:this.sourceCache._source.calculateTileZoom}))m[b.key]=!0,this._renderableTilesKeys.push(b.key),this._tiles[b.key]||(b.terrainRttPosMatrix32f=new Float64Array(16),c.bY(b.terrainRttPosMatrix32f,0,c.$,c.$,0,0,1),this._tiles[b.key]=new ms(b,this.tileSize),this._lastTilesetChange=ee.now());for(const b in this._tiles)m[b]||delete this._tiles[b]}freeRtt(t){for(const u in this._tiles){const m=this._tiles[u];(!t||m.tileID.equals(t)||m.tileID.isChildOf(t)||t.isChildOf(m.tileID))&&(m.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map((t=>this.getTileByID(t)))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t,u){return u?this._getTerrainCoordsForTileRanges(t,u):this._getTerrainCoordsForRegularTile(t)}_getTerrainCoordsForRegularTile(t){const u={};for(const m of this._renderableTilesKeys){const b=this._tiles[m].tileID,S=t.clone(),C=c.ba();if(b.canonical.equals(t.canonical))c.bY(C,0,c.$,c.$,0,0,1);else if(b.canonical.isChildOf(t.canonical)){const O=b.canonical.z-t.canonical.z,N=b.canonical.x-(b.canonical.x>>O<<O),U=b.canonical.y-(b.canonical.y>>O<<O),q=c.$>>O;c.bY(C,0,q,q,0,0,1),c.M(C,C,[-N*q,-U*q,0])}else{if(!t.canonical.isChildOf(b.canonical))continue;{const O=t.canonical.z-b.canonical.z,N=t.canonical.x-(t.canonical.x>>O<<O),U=t.canonical.y-(t.canonical.y>>O<<O),q=c.$>>O;c.bY(C,0,c.$,c.$,0,0,1),c.M(C,C,[N*q,U*q,0]),c.N(C,C,[1/2**O,1/2**O,0])}}S.terrainRttPosMatrix32f=new Float32Array(C),u[m]=S}return u}_getTerrainCoordsForTileRanges(t,u){const m={};for(const b of this._renderableTilesKeys){const S=this._tiles[b].tileID;if(!this._isWithinTileRanges(S,u))continue;const C=t.clone(),O=c.ba();if(S.canonical.z===t.canonical.z){const N=t.canonical.x-S.canonical.x,U=t.canonical.y-S.canonical.y;c.bY(O,0,c.$,c.$,0,0,1),c.M(O,O,[N*c.$,U*c.$,0])}else if(S.canonical.z>t.canonical.z){const N=S.canonical.z-t.canonical.z,U=S.canonical.x-(S.canonical.x>>N<<N),q=S.canonical.y-(S.canonical.y>>N<<N),W=t.canonical.x-(S.canonical.x>>N),H=t.canonical.y-(S.canonical.y>>N),J=c.$>>N;c.bY(O,0,J,J,0,0,1),c.M(O,O,[-U*J+W*c.$,-q*J+H*c.$,0])}else{const N=t.canonical.z-S.canonical.z,U=t.canonical.x-(t.canonical.x>>N<<N),q=t.canonical.y-(t.canonical.y>>N<<N),W=(t.canonical.x>>N)-S.canonical.x,H=(t.canonical.y>>N)-S.canonical.y,J=c.$<<N;c.bY(O,0,J,J,0,0,1),c.M(O,O,[U*c.$+W*J,q*c.$+H*J,0])}C.terrainRttPosMatrix32f=new Float32Array(O),m[b]=C}return m}getSourceTile(t,u){const m=this.sourceCache._source;let b=t.overscaledZ-this.deltaZoom;if(b>m.maxzoom&&(b=m.maxzoom),b<m.minzoom)return null;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(b).key);let S=this.sourceCache.getTileByID(this._sourceTileCache[t.key]);if((!S||!S.dem)&&u)for(;b>=m.minzoom&&(!S||!S.dem);)S=this.sourceCache.getTileByID(t.scaledTo(b--).key);return S}anyTilesAfterTime(t=Date.now()){return this._lastTilesetChange>=t}_isWithinTileRanges(t,u){return u[t.canonical.z]&&t.canonical.x>=u[t.canonical.z].minTileX&&t.canonical.x<=u[t.canonical.z].maxTileX&&t.canonical.y>=u[t.canonical.z].minTileY&&t.canonical.y<=u[t.canonical.z].maxTileY}}class Tn{constructor(t,u,m){this._meshCache={},this.painter=t,this.sourceCache=new an(u),this.options=m,this.exaggeration=typeof m.exaggeration=="number"?m.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(t,u,m,b=c.$){var S;if(!(u>=0&&u<b&&m>=0&&m<b))return 0;const C=this.getTerrainData(t),O=(S=C.tile)===null||S===void 0?void 0:S.dem;if(!O)return 0;const N=c.cs([],[u/b*c.$,m/b*c.$],C.u_terrain_matrix),U=[N[0]*O.dim,N[1]*O.dim],q=Math.floor(U[0]),W=Math.floor(U[1]),H=U[0]-q,J=U[1]-W;return O.get(q,W)*(1-H)*(1-J)+O.get(q+1,W)*H*(1-J)+O.get(q,W+1)*(1-H)*J+O.get(q+1,W+1)*H*J}getElevationForLngLatZoom(t,u){if(!c.ct(u,t.wrap()))return 0;const{tileID:m,mercatorX:b,mercatorY:S}=this._getOverscaledTileIDFromLngLatZoom(t,u);return this.getElevation(m,b%c.$,S%c.$,c.$)}getElevation(t,u,m,b=c.$){return this.getDEMElevation(t,u,m,b)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const b=this.painter.context,S=new c.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new c.T(b,S,b.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new c.T(b,new c.R({width:1,height:1}),b.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(b.gl.NEAREST,b.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=c.ag([])}const u=this.sourceCache.getSourceTile(t,!0);if(u&&u.dem&&(!u.demTexture||u.needsTerrainPrepare)){const b=this.painter.context;u.demTexture=this.painter.getTileTexture(u.dem.stride),u.demTexture?u.demTexture.update(u.dem.getPixels(),{premultiply:!1}):u.demTexture=new c.T(b,u.dem.getPixels(),b.gl.RGBA,{premultiply:!1}),u.demTexture.bind(b.gl.NEAREST,b.gl.CLAMP_TO_EDGE),u.needsTerrainPrepare=!1}const m=u&&u+u.tileID.key+t.key;if(m&&!this._demMatrixCache[m]){const b=this.sourceCache.sourceCache._source.maxzoom;let S=t.canonical.z-u.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=b?S=t.canonical.z-b:c.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const C=t.canonical.x-(t.canonical.x>>S<<S),O=t.canonical.y-(t.canonical.y>>S<<S),N=c.cu(new Float64Array(16),[1/(c.$<<S),1/(c.$<<S),0]);c.M(N,N,[C*c.$,O*c.$,0]),this._demMatrixCache[t.key]={matrix:N,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:u&&u.dem&&u.dem.dim||1,u_terrain_matrix:m?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:u&&u.dem&&u.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(u&&u.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:u}}getFramebuffer(t){const u=this.painter,m=u.width/devicePixelRatio,b=u.height/devicePixelRatio;return!this._fbo||this._fbo.width===m&&this._fbo.height===b||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new c.T(u.context,{width:m,height:b,data:null},u.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(u.context.gl.NEAREST,u.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new c.T(u.context,{width:m,height:b,data:null},u.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(u.context.gl.NEAREST,u.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=u.context.createFramebuffer(m,b,!0,!1),this._fbo.depthAttachment.set(u.context.createRenderbuffer(u.context.gl.DEPTH_COMPONENT16,m,b))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const u=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let S=0,C=0;S<this._coordsTextureSize;S++)for(let O=0;O<this._coordsTextureSize;O++,C+=4)u[C+0]=255&O,u[C+1]=255&S,u[C+2]=O>>8<<4|S>>8,u[C+3]=0;const m=new c.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(u.buffer)),b=new c.T(t,m,t.gl.RGBA,{premultiply:!1});return b.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=b,b}pointCoordinate(t){this.painter.maybeDrawDepthAndCoords(!0);const u=new Uint8Array(4),m=this.painter.context,b=m.gl,S=Math.round(t.x*this.painter.pixelRatio/devicePixelRatio),C=Math.round(t.y*this.painter.pixelRatio/devicePixelRatio),O=Math.round(this.painter.height/devicePixelRatio);m.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),b.readPixels(S,O-C-1,1,1,b.RGBA,b.UNSIGNED_BYTE,u),m.bindFramebuffer.set(null);const N=u[0]+(u[2]>>4<<8),U=u[1]+((15&u[2])<<8),q=this.coordsIndex[255-u[3]],W=q&&this.sourceCache.getTileByID(q);if(!W)return null;const H=this._coordsTextureSize,J=(1<<W.tileID.canonical.z)*H;return new c.a1((W.tileID.canonical.x*H+N)/J+W.tileID.wrap,(W.tileID.canonical.y*H+U)/J,this.getElevation(W.tileID,N,U,H))}depthAtPoint(t){const u=new Uint8Array(4),m=this.painter.context,b=m.gl;return m.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),b.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,b.RGBA,b.UNSIGNED_BYTE,u),m.bindFramebuffer.set(null),(u[0]/16777216+u[1]/65536+u[2]/256+u[3])/256}getTerrainMesh(t){var u;const m=((u=this.painter.style.projection)===null||u===void 0?void 0:u.transitionState)>0,b=m&&t.canonical.y===0,S=m&&t.canonical.y===(1<<t.canonical.z)-1,C=`m_${b?"n":""}_${S?"s":""}`;if(this._meshCache[C])return this._meshCache[C];const O=this.painter.context,N=new c.cv,U=new c.aN,q=this.meshSize,W=c.$/q,H=q*q;for(let Me=0;Me<=q;Me++)for(let Ye=0;Ye<=q;Ye++)N.emplaceBack(Ye*W,Me*W,0);for(let Me=0;Me<H;Me+=q+1)for(let Ye=0;Ye<q;Ye++)U.emplaceBack(Ye+Me,q+Ye+Me+1,q+Ye+Me+2),U.emplaceBack(Ye+Me,q+Ye+Me+2,Ye+Me+1);const J=N.length,ae=J+(q+1),ge=(q+1)*q,me=b?c.bh:0,ve=b?0:1,we=S?c.bi:c.$,Ie=S?0:1;for(let Me=0;Me<=q;Me++)N.emplaceBack(Me*W,me,ve);for(let Me=0;Me<=q;Me++)N.emplaceBack(Me*W,we,Ie);for(let Me=0;Me<q;Me++)U.emplaceBack(ge+Me,ae+Me,ae+Me+1),U.emplaceBack(ge+Me,ae+Me+1,ge+Me+1),U.emplaceBack(0+Me,J+Me+1,J+Me),U.emplaceBack(0+Me,0+Me+1,J+Me+1);const Ce=N.length,ze=Ce+2*(q+1);for(const Me of[0,1])for(let Ye=0;Ye<=q;Ye++)for(const ct of[0,1])N.emplaceBack(Me*c.$,Ye*W,ct);for(let Me=0;Me<2*q;Me+=2)U.emplaceBack(Ce+Me,Ce+Me+1,Ce+Me+3),U.emplaceBack(Ce+Me,Ce+Me+3,Ce+Me+2),U.emplaceBack(ze+Me,ze+Me+3,ze+Me+1),U.emplaceBack(ze+Me,ze+Me+2,ze+Me+3);const Ve=new Ja(O.createVertexBuffer(N,hc.members),O.createIndexBuffer(U),c.aM.simpleSegment(0,0,N.length,U.length));return this._meshCache[C]=Ve,Ve}getMeshFrameDelta(t){return 2*Math.PI*c.bu/Math.pow(2,Math.max(t,0))/5}getMinTileElevationForLngLatZoom(t,u){var m;const{tileID:b}=this._getOverscaledTileIDFromLngLatZoom(t,u);return(m=this.getMinMaxElevation(b).minElevation)!==null&&m!==void 0?m:0}getMinMaxElevation(t){const u=this.getTerrainData(t).tile,m={minElevation:null,maxElevation:null};return u&&u.dem&&(m.minElevation=u.dem.min*this.exaggeration,m.maxElevation=u.dem.max*this.exaggeration),m}_getOverscaledTileIDFromLngLatZoom(t,u){const m=c.a1.fromLngLat(t.wrap()),b=(1<<u)*c.$,S=m.x*b,C=m.y*b,O=Math.floor(S/c.$),N=Math.floor(C/c.$);return{tileID:new c.Z(u,0,u,O,N),mercatorX:S,mercatorY:C}}}class od{constructor(t,u,m){this._context=t,this._size=u,this._tileSize=m,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const t of this._objects)t.texture.destroy(),t.fbo.destroy()}_createObject(t){const u=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),m=new c.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return m.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),u.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),u.colorAttachment.set(m.texture),{id:t,fbo:u,texture:m,stamp:-1,inUse:!1}}getObjectForId(t){return this._objects[t]}useObject(t){t.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter((u=>t.id!==u)),this._recentlyUsed.push(t.id)}stampObject(t){t.stamp=++this._stamp}getOrCreateFreeObject(){for(const u of this._recentlyUsed)if(!this._objects[u].inUse)return this._objects[u];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const t=this._createObject(this._objects.length);return this._objects.push(t),t}freeObject(t){t.inUse=!1}freeAllObjects(){for(const t of this._objects)this.freeObject(t)}isFull(){return!(this._objects.length<this._size)&&this._objects.some((t=>!t.inUse))===!1}}const jo={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class $c{constructor(t,u){this.painter=t,this.terrain=u,this.pool=new od(t.context,30,u.sourceCache.tileSize*u.qualityFactor)}destruct(){this.pool.destruct()}getTexture(t){return this.pool.getObjectForId(t.rtt[this._stacks.length-1].id).texture}prepareForRender(t,u){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=t._order.filter((m=>!t._layers[m].isHidden(u))),this._coordsAscending={};for(const m in t.sourceCaches){this._coordsAscending[m]={};const b=t.sourceCaches[m].getVisibleCoordinates(),S=t.sourceCaches[m].getSource(),C=S instanceof Bi?S.terrainTileRanges:null;for(const O of b){const N=this.terrain.sourceCache.getTerrainCoords(O,C);for(const U in N)this._coordsAscending[m][U]||(this._coordsAscending[m][U]=[]),this._coordsAscending[m][U].push(N[U])}}this._coordsAscendingStr={};for(const m of t._order){const b=t._layers[m],S=b.source;if(jo[b.type]&&!this._coordsAscendingStr[S]){this._coordsAscendingStr[S]={};for(const C in this._coordsAscending[S])this._coordsAscendingStr[S][C]=this._coordsAscending[S][C].map((O=>O.key)).sort().join()}}for(const m of this._renderableTiles)for(const b in this._coordsAscendingStr){const S=this._coordsAscendingStr[b][m.tileID.key];S&&S!==m.rttCoords[b]&&(m.rtt=[])}}renderLayer(t,u){if(t.isHidden(this.painter.transform.zoom))return!1;const m=Object.assign(Object.assign({},u),{isRenderingToTexture:!0}),b=t.type,S=this.painter,C=this._renderableLayerIds[this._renderableLayerIds.length-1]===t.id;if(jo[b]&&(this._prevType&&jo[this._prevType]||this._stacks.push([]),this._prevType=b,this._stacks[this._stacks.length-1].push(t.id),!C))return!0;if(jo[this._prevType]||jo[b]&&C){this._prevType=b;const O=this._stacks.length-1,N=this._stacks[O]||[];for(const U of this._renderableTiles){if(this.pool.isFull()&&(No(this.painter,this.terrain,this._rttTiles,m),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(U),U.rtt[O]){const W=this.pool.getObjectForId(U.rtt[O].id);if(W.stamp===U.rtt[O].stamp){this.pool.useObject(W);continue}}const q=this.pool.getOrCreateFreeObject();this.pool.useObject(q),this.pool.stampObject(q),U.rtt[O]={id:q.id,stamp:q.stamp},S.context.bindFramebuffer.set(q.fbo.framebuffer),S.context.clear({color:c.bf.transparent,stencil:0}),S.currentStencilSource=void 0;for(let W=0;W<N.length;W++){const H=S.style._layers[N[W]],J=H.source?this._coordsAscending[H.source][U.tileID.key]:[U.tileID];S.context.viewport.set([0,0,q.fbo.width,q.fbo.height]),S._renderTileClippingMasks(H,J,!0),S.renderLayer(S,S.style.sourceCaches[H.source],H,J,m),H.source&&(U.rttCoords[H.source]=this._coordsAscendingStr[H.source][U.tileID.key])}}return No(this.painter,this.terrain,this._rttTiles,m),this._rttTiles=[],this.pool.freeAllObjects(),jo[b]}return!1}}const As={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Zd=M,fo={hash:!1,interactive:!0,bearingSnap:7,attributionControl:tu,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:c.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0},Uo={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class Cs{constructor(t,u,m=!1){this.mousedown=S=>{this.startMove(S,Y.mousePos(this.element,S)),Y.addEventListener(window,"mousemove",this.mousemove),Y.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=S=>{this.move(S,Y.mousePos(this.element,S))},this.mouseup=S=>{this._rotatePitchHandler.dragEnd(S),this.offTemp()},this.touchstart=S=>{S.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Y.touchPos(this.element,S.targetTouches)[0],this.startMove(S,this._startPos),Y.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),Y.addEventListener(window,"touchend",this.touchend))},this.touchmove=S=>{S.targetTouches.length!==1?this.reset():(this._lastPos=Y.touchPos(this.element,S.targetTouches)[0],this.move(S,this._lastPos))},this.touchend=S=>{S.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHandler.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=u;const b=new Zp;this._rotatePitchHandler=new Yl({clickTolerance:3,move:(S,C)=>{const O=u.getBoundingClientRect(),N=new c.P((O.bottom-O.top)/2,(O.right-O.left)/2);return{bearingDelta:c.cn(new c.P(S.x,C.y),C,N),pitchDelta:m?-.5*(C.y-S.y):void 0}},moveStateManager:b,enable:!0,assignEvents:()=>{}}),this.map=t,Y.addEventListener(u,"mousedown",this.mousedown),Y.addEventListener(u,"touchstart",this.touchstart,{passive:!1}),Y.addEventListener(u,"touchcancel",this.reset)}startMove(t,u){this._rotatePitchHandler.dragStart(t,u),Y.disableDrag()}move(t,u){const m=this.map,{bearingDelta:b,pitchDelta:S}=this._rotatePitchHandler.dragMove(t,u)||{};b&&m.setBearing(m.getBearing()+b),S&&m.setPitch(m.getPitch()+S)}off(){const t=this.element;Y.removeEventListener(t,"mousedown",this.mousedown),Y.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),Y.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),Y.removeEventListener(window,"touchend",this.touchend),Y.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){Y.enableDrag(),Y.removeEventListener(window,"mousemove",this.mousemove),Y.removeEventListener(window,"mouseup",this.mouseup),Y.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),Y.removeEventListener(window,"touchend",this.touchend)}}let mi;function Nr(T,t,u,m=!1){if(m||!u.getCoveringTilesDetailsProvider().allowWorldCopies())return T==null?void 0:T.wrap();const b=new c.S(T.lng,T.lat);if(T=new c.S(T.lng,T.lat),t){const S=new c.S(T.lng-360,T.lat),C=new c.S(T.lng+360,T.lat),O=u.locationToScreenPoint(T).distSqr(t);u.locationToScreenPoint(S).distSqr(t)<O?T=S:u.locationToScreenPoint(C).distSqr(t)<O&&(T=C)}for(;Math.abs(T.lng-u.center.lng)>180;){const S=u.locationToScreenPoint(T);if(S.x>=0&&S.y>=0&&S.x<=u.width&&S.y<=u.height)break;T.lng>u.center.lng?T.lng-=360:T.lng+=360}return T.lng!==b.lng&&u.isPointOnMapSurface(u.locationToScreenPoint(T))?T:b}const ld={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function $o(T,t,u){const m=T.classList;for(const b in ld)m.remove(`maplibregl-${u}-anchor-${b}`);m.add(`maplibregl-${u}-anchor-${t}`)}class Xa extends c.E{constructor(t){if(super(),this._onKeyPress=u=>{const m=u.code,b=u.charCode||u.keyCode;m!=="Space"&&m!=="Enter"&&b!==32&&b!==13||this.togglePopup()},this._onMapClick=u=>{const m=u.originalEvent.target,b=this._element;this._popup&&(m===b||b.contains(m))&&this.togglePopup()},this._update=u=>{if(!this._map)return;const m=this._map.loaded()&&!this._map.isMoving();((u==null?void 0:u.type)==="terrain"||(u==null?void 0:u.type)==="render"&&!m)&&this._map.once("render",this._update),this._lngLat=Nr(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let b="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?b=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(b=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let S="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?S="rotateX(0deg)":this._pitchAlignment==="map"&&(S=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||u&&u.type!=="moveend"||(this._pos=this._pos.round()),Y.setTransform(this._element,`${ld[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${S} ${b}`),ee.frameAsync(new AbortController).then((()=>{this._updateOpacity(u&&u.type==="moveend")})).catch((()=>{}))},this._onMove=u=>{if(!this._isDragging){const m=this._clickTolerance||this._map._clickTolerance;this._isDragging=u.point.dist(this._pointerdownPos)>=m}this._isDragging&&(this._pos=u.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new c.l("dragstart"))),this.fire(new c.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new c.l("dragend")),this._state="inactive"},this._addDragHandler=u=>{this._element.contains(u.originalEvent.target)&&(u.preventDefault(),this._positionDelta=u.point.sub(this._pos).add(this._offset),this._pointerdownPos=u.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._subpixelPositioning=t&&t.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,this.setOpacity(t==null?void 0:t.opacity,t==null?void 0:t.opacityWhenCovered),t&&t.element)this._element=t.element,this._offset=c.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=Y.create("div");const u=Y.createNS("http://www.w3.org/2000/svg","svg"),m=41,b=27;u.setAttributeNS(null,"display","block"),u.setAttributeNS(null,"height",`${m}px`),u.setAttributeNS(null,"width",`${b}px`),u.setAttributeNS(null,"viewBox",`0 0 ${b} ${m}`);const S=Y.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"stroke","none"),S.setAttributeNS(null,"stroke-width","1"),S.setAttributeNS(null,"fill","none"),S.setAttributeNS(null,"fill-rule","evenodd");const C=Y.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"fill-rule","nonzero");const O=Y.createNS("http://www.w3.org/2000/svg","g");O.setAttributeNS(null,"transform","translate(3.0, 29.0)"),O.setAttributeNS(null,"fill","#000000");const N=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const ve of N){const we=Y.createNS("http://www.w3.org/2000/svg","ellipse");we.setAttributeNS(null,"opacity","0.04"),we.setAttributeNS(null,"cx","10.5"),we.setAttributeNS(null,"cy","5.80029008"),we.setAttributeNS(null,"rx",ve.rx),we.setAttributeNS(null,"ry",ve.ry),O.appendChild(we)}const U=Y.createNS("http://www.w3.org/2000/svg","g");U.setAttributeNS(null,"fill",this._color);const q=Y.createNS("http://www.w3.org/2000/svg","path");q.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),U.appendChild(q);const W=Y.createNS("http://www.w3.org/2000/svg","g");W.setAttributeNS(null,"opacity","0.25"),W.setAttributeNS(null,"fill","#000000");const H=Y.createNS("http://www.w3.org/2000/svg","path");H.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),W.appendChild(H);const J=Y.createNS("http://www.w3.org/2000/svg","g");J.setAttributeNS(null,"transform","translate(6.0, 7.0)"),J.setAttributeNS(null,"fill","#FFFFFF");const ae=Y.createNS("http://www.w3.org/2000/svg","g");ae.setAttributeNS(null,"transform","translate(8.0, 8.0)");const ge=Y.createNS("http://www.w3.org/2000/svg","circle");ge.setAttributeNS(null,"fill","#000000"),ge.setAttributeNS(null,"opacity","0.25"),ge.setAttributeNS(null,"cx","5.5"),ge.setAttributeNS(null,"cy","5.5"),ge.setAttributeNS(null,"r","5.4999962");const me=Y.createNS("http://www.w3.org/2000/svg","circle");me.setAttributeNS(null,"fill","#FFFFFF"),me.setAttributeNS(null,"cx","5.5"),me.setAttributeNS(null,"cy","5.5"),me.setAttributeNS(null,"r","5.4999962"),ae.appendChild(ge),ae.appendChild(me),C.appendChild(O),C.appendChild(U),C.appendChild(W),C.appendChild(J),C.appendChild(ae),u.appendChild(C),u.setAttributeNS(null,"height",m*this._scale+"px"),u.setAttributeNS(null,"width",b*this._scale+"px"),this._element.appendChild(u),this._offset=c.P.convert(t&&t.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",(u=>{u.preventDefault()})),this._element.addEventListener("mousedown",(u=>{u.preventDefault()})),$o(this._element,this._anchor,"marker"),t&&t.className)for(const u of t.className.split(" "))this._element.classList.add(u);this._popup=null}addTo(t){return this.remove(),this._map=t,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",t._getUIString("Marker.Title")),t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.on("terrain",this._update),t.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),Y.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=c.S.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const b=Math.abs(13.5)/Math.SQRT2;t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[b,-1*(38.1-13.5+b)],"bottom-right":[-b,-1*(38.1-13.5+b)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(t){return this._subpixelPositioning=t,this}getPopup(){return this._popup}togglePopup(){const t=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:t?(t.isOpen()?t.remove():(t.setLngLat(this._lngLat),t.addTo(this._map)),this):this}_updateOpacity(t=!1){var u,m;const b=(u=this._map)===null||u===void 0?void 0:u.terrain,S=this._map.transform.isLocationOccluded(this._lngLat);if(!b||S){const J=S?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==J&&(this._element.style.opacity=J))}if(t)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout((()=>{this._opacityTimeout=null}),100)}const C=this._map,O=C.terrain.depthAtPoint(this._pos),N=C.terrain.getElevationForLngLatZoom(this._lngLat,C.transform.tileZoom);if(C.transform.lngLatToCameraDepth(this._lngLat,N)-O<.006)return void(this._element.style.opacity=this._opacity);const U=-this._offset.y/C.transform.pixelsPerMeter,q=Math.sin(C.getPitch()*Math.PI/180)*U,W=C.terrain.depthAtPoint(new c.P(this._pos.x,this._pos.y-this._offset.y)),H=C.transform.lngLatToCameraDepth(this._lngLat,N+q)-W>.006;!((m=this._popup)===null||m===void 0)&&m.isOpen()&&H&&this._popup.remove(),this._element.style.opacity=H?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(t){return this._offset=c.P.convert(t),this._update(),this}addClassName(t){this._element.classList.add(t)}removeClassName(t){this._element.classList.remove(t)}toggleClassName(t){return this._element.classList.toggle(t)}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(t,u){return(this._opacity===void 0||t===void 0&&u===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),t!==void 0&&(this._opacity=t),u!==void 0&&(this._opacityWhenCovered=u),this._map&&this._updateOpacity(!0),this}}const Xr={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Cu=0,eo=!1;const Gn={maxWidth:100,unit:"metric"};function Vi(T,t,u){const m=u&&u.maxWidth||100,b=T._container.clientHeight/2,S=T._container.clientWidth/2,C=T.unproject([S-m/2,b]),O=T.unproject([S+m/2,b]),N=Math.round(T.project(O).x-T.project(C).x),U=Math.min(m,N,T._container.clientWidth),q=C.distanceTo(O);if(u&&u.unit==="imperial"){const W=3.2808*q;W>5280?wr(t,U,W/5280,T._getUIString("ScaleControl.Miles")):wr(t,U,W,T._getUIString("ScaleControl.Feet"))}else u&&u.unit==="nautical"?wr(t,U,q/1852,T._getUIString("ScaleControl.NauticalMiles")):q>=1e3?wr(t,U,q/1e3,T._getUIString("ScaleControl.Kilometers")):wr(t,U,q,T._getUIString("ScaleControl.Meters"))}function wr(T,t,u,m){const b=(function(S){const C=Math.pow(10,`${Math.floor(S)}`.length-1);let O=S/C;return O=O>=10?10:O>=5?5:O>=3?3:O>=2?2:O>=1?1:(function(N){const U=Math.pow(10,Math.ceil(-Math.log(N)/Math.LN10));return Math.round(N*U)/U})(O),C*O})(u);T.style.width=t*(b/u)+"px",T.innerHTML=`${b}&nbsp;${m}`}const xh={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},dc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function nu(T){if(T){if(typeof T=="number"){const t=Math.round(Math.abs(T)/Math.SQRT2);return{center:new c.P(0,0),top:new c.P(0,T),"top-left":new c.P(t,t),"top-right":new c.P(-t,t),bottom:new c.P(0,-T),"bottom-left":new c.P(t,-t),"bottom-right":new c.P(-t,-t),left:new c.P(T,0),right:new c.P(-T,0)}}if(T instanceof c.P||Array.isArray(T)){const t=c.P.convert(T);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:c.P.convert(T.center||[0,0]),top:c.P.convert(T.top||[0,0]),"top-left":c.P.convert(T["top-left"]||[0,0]),"top-right":c.P.convert(T["top-right"]||[0,0]),bottom:c.P.convert(T.bottom||[0,0]),"bottom-left":c.P.convert(T["bottom-left"]||[0,0]),"bottom-right":c.P.convert(T["bottom-right"]||[0,0]),left:c.P.convert(T.left||[0,0]),right:c.P.convert(T.right||[0,0])}}return nu(new c.P(0,0))}const wh=M;_.AJAXError=c.cz,_.Event=c.l,_.Evented=c.E,_.LngLat=c.S,_.MercatorCoordinate=c.a1,_.Point=c.P,_.addProtocol=c.cA,_.config=c.a,_.removeProtocol=c.cB,_.AttributionControl=Uc,_.BoxZoomHandler=Of,_.CanvasSource=Ea,_.CooperativeGesturesHandler=uc,_.DoubleClickZoomHandler=lc,_.DragPanHandler=vh,_.DragRotateHandler=bh,_.EdgeInsets=ys,_.FullscreenControl=class extends c.E{constructor(T={}){super(),this._onFullscreenChange=()=>{var t;let u=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((t=u==null?void 0:u.shadowRoot)===null||t===void 0)&&t.fullscreenElement;)u=u.shadowRoot.fullscreenElement;u===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,T&&T.container&&(T.container instanceof HTMLElement?this._container=T.container:c.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(T){return this._map=T,this._container||(this._container=this._map.getContainer()),this._controlContainer=Y.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){Y.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const T=this._fullscreenButton=Y.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);Y.create("span","maplibregl-ctrl-icon",T).setAttribute("aria-hidden","true"),T.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const T=this._getTitle();this._fullscreenButton.setAttribute("aria-label",T),this._fullscreenButton.title=T}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new c.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new c.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},_.GeoJSONSource=Sa,_.GeolocateControl=class extends c.E{constructor(T){super(),this._onSuccess=t=>{if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new c.l("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(t),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new c.l("geolocate",t)),this._finish()}},this._updateCamera=t=>{const u=new c.S(t.coords.longitude,t.coords.latitude),m=t.coords.accuracy,b=this._map.getBearing(),S=c.e({bearing:b},this.options.fitBoundsOptions),C=Ni.fromLngLat(u,m);this._map.fitBounds(C,S,{geolocateSource:!0})},this._updateMarker=t=>{if(t){const u=new c.S(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(u).addTo(this._map),this._userLocationDotMarker.setLngLat(u).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=t=>{if(this._map){if(t.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const u=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=u,this._geolocateButton.setAttribute("aria-label",u),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(t.code===3&&eo)return;this.options.trackUserLocation&&this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new c.l("error",t)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this._geolocateButton=Y.create("button","maplibregl-ctrl-geolocate",this._container),Y.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=t=>{if(this._map){if(t===!1){c.w("Geolocation support is not available so the GeolocateControl will be disabled.");const u=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=u,this._geolocateButton.setAttribute("aria-label",u)}else{const u=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=u,this._geolocateButton.setAttribute("aria-label",u)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Y.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Xa({element:this._dotElement}),this._circleElement=Y.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Xa({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",(()=>this.trigger())),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(u=>{const m=(u==null?void 0:u[0])instanceof ResizeObserverEntry;u.geolocateSource||this._watchState!=="ACTIVE_LOCK"||m||this._map.isZooming()||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new c.l("trackuserlocationend")),this.fire(new c.l("userlocationlostfocus")))}))}},this.options=c.e({},Xr,T)}onAdd(T){return this._map=T,this._container=Y.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),(function(){return c._(this,arguments,void 0,(function*(t=!1){if(mi!==void 0&&!t)return mi;if(window.navigator.permissions===void 0)return mi=!!window.navigator.geolocation,mi;try{mi=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{mi=!!window.navigator.geolocation}return mi}))})().then((t=>this._finishSetupUI(t))),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),Y.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Cu=0,eo=!1}_isOutOfMapMaxBounds(T){const t=this._map.getMaxBounds(),u=T.coords;return t&&(u.longitude<t.getWest()||u.longitude>t.getEast()||u.latitude<t.getSouth()||u.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const T=this._map.getBounds(),t=T.getSouthEast(),u=T.getNorthEast(),m=t.distanceTo(u),b=Math.ceil(this._accuracy/(m/this._map._container.clientHeight)*2);this._circleElement.style.width=`${b}px`,this._circleElement.style.height=`${b}px`}trigger(){if(!this._setup)return c.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new c.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Cu--,eo=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new c.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new c.l("trackuserlocationstart")),this.fire(new c.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let T;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Cu++,Cu>1?(T={maximumAge:6e5,timeout:0},eo=!0):(T=this.options.positionOptions,eo=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,T)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},_.GlobeControl=class{constructor(){this._toggleProjection=()=>{var T;const t=(T=this._map.getProjection())===null||T===void 0?void 0:T.type;this._map.setProjection(t!=="mercator"&&t?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var T;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((T=this._map.getProjection())===null||T===void 0?void 0:T.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(T){return this._map=T,this._container=Y.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=Y.create("button","maplibregl-ctrl-globe",this._container),Y.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){Y.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},_.Hash=ml,_.ImageSource=Bi,_.KeyboardHandler=rd,_.LngLatBounds=Ni,_.LogoControl=Gd,_.Map=class extends Au{constructor(T){var t,u;c.cw.mark(c.cx.create);const m=Object.assign(Object.assign(Object.assign({},fo),T),{canvasContextAttributes:Object.assign(Object.assign({},fo.canvasContextAttributes),T.canvasContextAttributes)});if(m.minZoom!=null&&m.maxZoom!=null&&m.minZoom>m.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(m.minPitch!=null&&m.maxPitch!=null&&m.minPitch>m.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(m.minPitch!=null&&m.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(m.maxPitch!=null&&m.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const b=new xn,S=new xr;if(m.minZoom!==void 0&&b.setMinZoom(m.minZoom),m.maxZoom!==void 0&&b.setMaxZoom(m.maxZoom),m.minPitch!==void 0&&b.setMinPitch(m.minPitch),m.maxPitch!==void 0&&b.setMaxPitch(m.maxPitch),m.renderWorldCopies!==void 0&&b.setRenderWorldCopies(m.renderWorldCopies),super(b,S,{bearingSnap:m.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new yl,this._controls=[],this._mapId=c.a7(),this._contextLost=O=>{O.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new c.l("webglcontextlost",{originalEvent:O}))},this._contextRestored=O=>{this._setupPainter(),this.resize(),this._update(),this.fire(new c.l("webglcontextrestored",{originalEvent:O}))},this._onMapScroll=O=>{if(O.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=m.interactive,this._maxTileCacheSize=m.maxTileCacheSize,this._maxTileCacheZoomLevels=m.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},m.canvasContextAttributes),this._trackResize=m.trackResize===!0,this._bearingSnap=m.bearingSnap,this._centerClampedToGround=m.centerClampedToGround,this._refreshExpiredTiles=m.refreshExpiredTiles===!0,this._fadeDuration=m.fadeDuration,this._crossSourceCollisions=m.crossSourceCollisions===!0,this._collectResourceTiming=m.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},As),m.locale),this._clickTolerance=m.clickTolerance,this._overridePixelRatio=m.pixelRatio,this._maxCanvasSize=m.maxCanvasSize,this.transformCameraUpdate=m.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=m.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=He.addThrottleControl((()=>this.isMoving())),this._requestManager=new Ue(m.transformRequest),typeof m.container=="string"){if(this._container=document.getElementById(m.container),!this._container)throw new Error(`Container '${m.container}' not found.`)}else{if(!(m.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=m.container}if(m.maxBounds&&this.setMaxBounds(m.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this.on("terrain",(()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)})),this.once("idle",(()=>{this._idleTriggered=!0})),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let O=!1;const N=rs((U=>{this._trackResize&&!this._removed&&(this.resize(U),this.redraw())}),50);this._resizeObserver=new ResizeObserver((U=>{O?N(U):O=!0})),this._resizeObserver.observe(this._container)}this.handlers=new sd(this,m),this._hash=m.hash&&new ml(typeof m.hash=="string"&&m.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:m.center,elevation:m.elevation,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch,roll:m.roll}),m.bounds&&(this.resize(),this.fitBounds(m.bounds,c.e({},m.fitBoundsOptions,{duration:0}))));const C=typeof m.style=="string"||((u=(t=m.style)===null||t===void 0?void 0:t.projection)===null||u===void 0?void 0:u.type)!=="globe";this.resize(null,C),this._localIdeographFontFamily=m.localIdeographFontFamily,this._validateStyle=m.validateStyle,m.style&&this.setStyle(m.style,{localIdeographFontFamily:m.localIdeographFontFamily}),m.attributionControl&&this.addControl(new Uc(typeof m.attributionControl=="boolean"?void 0:m.attributionControl)),m.maplibreLogo&&this.addControl(new Gd,m.logoPosition),this.on("style.load",(()=>{if(C||this._resizeTransform(),this.transform.unmodified){const O=c.Q(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(O)}})),this.on("data",(O=>{this._update(O.dataType==="style"),this.fire(new c.l(`${O.dataType}data`,O))})),this.on("dataloading",(O=>{this.fire(new c.l(`${O.dataType}dataloading`,O))})),this.on("dataabort",(O=>{this.fire(new c.l("sourcedataabort",O))}))}_getMapId(){return this._mapId}setGlobalStateProperty(T,t){return this.style.setGlobalStateProperty(T,t),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(T,t){if(t===void 0&&(t=T.getDefaultPosition?T.getDefaultPosition():"top-right"),!T||!T.onAdd)return this.fire(new c.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const u=T.onAdd(this);this._controls.push(T);const m=this._controlPositions[t];return t.indexOf("bottom")!==-1?m.insertBefore(u,m.firstChild):m.appendChild(u),this}removeControl(T){if(!T||!T.onRemove)return this.fire(new c.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(T);return t>-1&&this._controls.splice(t,1),T.onRemove(this),this}hasControl(T){return this._controls.indexOf(T)>-1}calculateCameraOptionsFromTo(T,t,u,m){return m==null&&this.terrain&&(m=this.terrain.getElevationForLngLatZoom(u,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(T,t,u,m)}resize(T,t=!0){const[u,m]=this._containerDimensions(),b=this._getClampedPixelRatio(u,m);if(this._resizeCanvas(u,m,b),this.painter.resize(u,m,b),this.painter.overLimit()){const C=this.painter.context.gl;this._maxCanvasSize=[C.drawingBufferWidth,C.drawingBufferHeight];const O=this._getClampedPixelRatio(u,m);this._resizeCanvas(u,m,O),this.painter.resize(u,m,O)}this._resizeTransform(t);const S=!this._moving;return S&&(this.stop(),this.fire(new c.l("movestart",T)).fire(new c.l("move",T))),this.fire(new c.l("resize",T)),S&&this.fire(new c.l("moveend",T)),this}_resizeTransform(T=!0){var t;const[u,m]=this._containerDimensions();this.transform.resize(u,m,T),(t=this._requestedCameraState)===null||t===void 0||t.resize(u,m,T)}_getClampedPixelRatio(T,t){const{0:u,1:m}=this._maxCanvasSize,b=this.getPixelRatio(),S=T*b,C=t*b;return Math.min(S>u?u/S:1,C>m?m/C:1)*b}getPixelRatio(){var T;return(T=this._overridePixelRatio)!==null&&T!==void 0?T:devicePixelRatio}setPixelRatio(T){this._overridePixelRatio=T,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(T){return this.transform.setMaxBounds(Ni.convert(T)),this._update()}setMinZoom(T){if((T=T??-2)>=-2&&T<=this.transform.maxZoom)return this.transform.setMinZoom(T),this._update(),this.getZoom()<T&&this.setZoom(T),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(T){if((T=T??22)>=this.transform.minZoom)return this.transform.setMaxZoom(T),this._update(),this.getZoom()>T&&this.setZoom(T),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(T){if((T=T??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(T>=0&&T<=this.transform.maxPitch)return this.transform.setMinPitch(T),this._update(),this.getPitch()<T&&this.setPitch(T),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(T){if((T=T??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(T>=this.transform.minPitch)return this.transform.setMaxPitch(T),this._update(),this.getPitch()>T&&this.setPitch(T),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(T){return this.transform.setRenderWorldCopies(T),this._update()}project(T){return this.transform.locationToScreenPoint(c.S.convert(T),this.style&&this.terrain)}unproject(T){return this.transform.screenPointToLocation(c.P.convert(T),this.terrain)}isMoving(){var T;return this._moving||((T=this.handlers)===null||T===void 0?void 0:T.isMoving())}isZooming(){var T;return this._zooming||((T=this.handlers)===null||T===void 0?void 0:T.isZooming())}isRotating(){var T;return this._rotating||((T=this.handlers)===null||T===void 0?void 0:T.isRotating())}_createDelegatedListener(T,t,u){if(T==="mouseenter"||T==="mouseover"){let m=!1;return{layers:t,listener:u,delegates:{mousemove:S=>{const C=t.filter((N=>this.getLayer(N))),O=C.length!==0?this.queryRenderedFeatures(S.point,{layers:C}):[];O.length?m||(m=!0,u.call(this,new Ra(T,this,S.originalEvent,{features:O}))):m=!1},mouseout:()=>{m=!1}}}}if(T==="mouseleave"||T==="mouseout"){let m=!1;return{layers:t,listener:u,delegates:{mousemove:C=>{const O=t.filter((N=>this.getLayer(N)));(O.length!==0?this.queryRenderedFeatures(C.point,{layers:O}):[]).length?m=!0:m&&(m=!1,u.call(this,new Ra(T,this,C.originalEvent)))},mouseout:C=>{m&&(m=!1,u.call(this,new Ra(T,this,C.originalEvent)))}}}}{const m=b=>{const S=t.filter((O=>this.getLayer(O))),C=S.length!==0?this.queryRenderedFeatures(b.point,{layers:S}):[];C.length&&(b.features=C,u.call(this,b),delete b.features)};return{layers:t,listener:u,delegates:{[T]:m}}}}_saveDelegatedListener(T,t){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[T]=this._delegatedListeners[T]||[],this._delegatedListeners[T].push(t)}_removeDelegatedListener(T,t,u){if(!this._delegatedListeners||!this._delegatedListeners[T])return;const m=this._delegatedListeners[T];for(let b=0;b<m.length;b++){const S=m[b];if(S.listener===u&&S.layers.length===t.length&&S.layers.every((C=>t.includes(C)))){for(const C in S.delegates)this.off(C,S.delegates[C]);return void m.splice(b,1)}}}on(T,t,u){if(u===void 0)return super.on(T,t);const m=typeof t=="string"?[t]:t,b=this._createDelegatedListener(T,m,u);this._saveDelegatedListener(T,b);for(const S in b.delegates)this.on(S,b.delegates[S]);return{unsubscribe:()=>{this._removeDelegatedListener(T,m,u)}}}once(T,t,u){if(u===void 0)return super.once(T,t);const m=typeof t=="string"?[t]:t,b=this._createDelegatedListener(T,m,u);for(const S in b.delegates){const C=b.delegates[S];b.delegates[S]=(...O)=>{this._removeDelegatedListener(T,m,u),C(...O)}}this._saveDelegatedListener(T,b);for(const S in b.delegates)this.once(S,b.delegates[S]);return this}off(T,t,u){return u===void 0?super.off(T,t):(this._removeDelegatedListener(T,typeof t=="string"?[t]:t,u),this)}queryRenderedFeatures(T,t){if(!this.style)return[];let u;const m=T instanceof c.P||Array.isArray(T),b=m?T:[[0,0],[this.transform.width,this.transform.height]];if(t=t||(m?{}:T)||{},b instanceof c.P||typeof b[0]=="number")u=[c.P.convert(b)];else{const S=c.P.convert(b[0]),C=c.P.convert(b[1]);u=[S,new c.P(C.x,S.y),C,new c.P(S.x,C.y),S]}return this.style.queryRenderedFeatures(u,t,this.transform)}querySourceFeatures(T,t){return this.style.querySourceFeatures(T,t)}setStyle(T,t){return(t=c.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&T?(this._diffStyle(T,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(T,t))}setTransformRequest(T){return this._requestManager.setTransformRequest(T),this}_getUIString(T){const t=this._locale[T];if(t==null)throw new Error(`Missing UI string '${T}'`);return t}_updateStyle(T,t){var u,m;if(t.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",(()=>this._updateStyle(T,t)));const b=this.style&&t.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!T)),T?(this.style=new P(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof T=="string"?this.style.loadURL(T,t,b):this.style.loadJSON(T,t,b),this):((m=(u=this.style)===null||u===void 0?void 0:u.projection)===null||m===void 0||m.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new P(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(T,t){if(typeof T=="string"){const u=this._requestManager.transformRequest(T,"Style");c.j(u,new AbortController).then((m=>{this._updateDiff(m.data,t)})).catch((m=>{m&&this.fire(new c.k(m))}))}else typeof T=="object"&&this._updateDiff(T,t)}_updateDiff(T,t){try{this.style.setState(T,t)&&this._update(!0)}catch(u){c.w(`Unable to perform style diff: ${u.message||u.error||u}.  Rebuilding the style from scratch.`),this._updateStyle(T,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():c.w("There is no style added to the map.")}addSource(T,t){return this._lazyInitEmptyStyle(),this.style.addSource(T,t),this._update(!0)}isSourceLoaded(T){const t=this.style&&this.style.sourceCaches[T];if(t!==void 0)return t.loaded();this.fire(new c.k(new Error(`There is no source with ID '${T}'`)))}setTerrain(T){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),T){const t=this.style.sourceCaches[T.source];if(!t)throw new Error(`cannot load terrain, because there exists no source with ID: ${T.source}`);this.terrain===null&&t.reload();for(const u in this.style._layers){const m=this.style._layers[u];m.type==="hillshade"&&m.source===T.source&&c.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),m.type==="color-relief"&&m.source===T.source&&c.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Tn(this.painter,t,T),this.painter.renderToTexture=new $c(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=u=>{var m;u.dataType==="style"?this.terrain.sourceCache.freeRtt():u.dataType==="source"&&u.tile&&(u.sourceId!==T.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((m=u.source)===null||m===void 0?void 0:m.type)==="image"?this.terrain.sourceCache.freeRtt():this.terrain.sourceCache.freeRtt(u.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new c.l("terrain",{terrain:T})),this}getTerrain(){var T,t;return(t=(T=this.terrain)===null||T===void 0?void 0:T.options)!==null&&t!==void 0?t:null}areTilesLoaded(){const T=this.style&&this.style.sourceCaches;for(const t in T){const u=T[t]._tiles;for(const m in u){const b=u[m];if(b.state!=="loaded"&&b.state!=="errored")return!1}}return!0}removeSource(T){return this.style.removeSource(T),this._update(!0)}getSource(T){return this.style.getSource(T)}setSourceTileLodParams(T,t,u){if(u){const m=this.getSource(u);if(!m)throw new Error(`There is no source with ID "${u}", cannot set LOD parameters`);m.calculateTileZoom=It(Math.max(1,T),Math.max(1,t))}else for(const m in this.style.sourceCaches)this.style.sourceCaches[m].getSource().calculateTileZoom=It(Math.max(1,T),Math.max(1,t));return this._update(!0),this}refreshTiles(T,t){const u=this.style.sourceCaches[T];if(!u)throw new Error(`There is no source cache with ID "${T}", cannot refresh tile`);t===void 0?u.reload(!0):u.refreshTiles(t.map((m=>new c.a4(m.z,m.x,m.y))))}addImage(T,t,u={}){const{pixelRatio:m=1,sdf:b=!1,stretchX:S,stretchY:C,content:O,textFitWidth:N,textFitHeight:U}=u;if(this._lazyInitEmptyStyle(),!(t instanceof HTMLImageElement||c.b(t))){if(t.width===void 0||t.height===void 0)return this.fire(new c.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:q,height:W,data:H}=t,J=t;return this.style.addImage(T,{data:new c.R({width:q,height:W},new Uint8Array(H)),pixelRatio:m,stretchX:S,stretchY:C,content:O,textFitWidth:N,textFitHeight:U,sdf:b,version:0,userImage:J}),J.onAdd&&J.onAdd(this,T),this}}{const{width:q,height:W,data:H}=ee.getImageData(t);this.style.addImage(T,{data:new c.R({width:q,height:W},H),pixelRatio:m,stretchX:S,stretchY:C,content:O,textFitWidth:N,textFitHeight:U,sdf:b,version:0})}}updateImage(T,t){const u=this.style.getImage(T);if(!u)return this.fire(new c.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const m=t instanceof HTMLImageElement||c.b(t)?ee.getImageData(t):t,{width:b,height:S,data:C}=m;if(b===void 0||S===void 0)return this.fire(new c.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(b!==u.data.width||S!==u.data.height)return this.fire(new c.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const O=!(t instanceof HTMLImageElement||c.b(t));return u.data.replace(C,O),this.style.updateImage(T,u),this}getImage(T){return this.style.getImage(T)}hasImage(T){return T?!!this.style.getImage(T):(this.fire(new c.k(new Error("Missing required image id"))),!1)}removeImage(T){this.style.removeImage(T)}loadImage(T){return He.getImage(this._requestManager.transformRequest(T,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(T,t){return this._lazyInitEmptyStyle(),this.style.addLayer(T,t),this._update(!0)}moveLayer(T,t){return this.style.moveLayer(T,t),this._update(!0)}removeLayer(T){return this.style.removeLayer(T),this._update(!0)}getLayer(T){return this.style.getLayer(T)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(T,t,u){return this.style.setLayerZoomRange(T,t,u),this._update(!0)}setFilter(T,t,u={}){return this.style.setFilter(T,t,u),this._update(!0)}getFilter(T){return this.style.getFilter(T)}setPaintProperty(T,t,u,m={}){return this.style.setPaintProperty(T,t,u,m),this._update(!0)}getPaintProperty(T,t){return this.style.getPaintProperty(T,t)}setLayoutProperty(T,t,u,m={}){return this.style.setLayoutProperty(T,t,u,m),this._update(!0)}getLayoutProperty(T,t){return this.style.getLayoutProperty(T,t)}setGlyphs(T,t={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(T,t),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(T,t,u={}){return this._lazyInitEmptyStyle(),this.style.addSprite(T,t,u,(m=>{m||this._update(!0)})),this}removeSprite(T){return this._lazyInitEmptyStyle(),this.style.removeSprite(T),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(T,t={}){return this._lazyInitEmptyStyle(),this.style.setSprite(T,t,(u=>{u||this._update(!0)})),this}setLight(T,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(T,t),this._update(!0)}getLight(){return this.style.getLight()}setSky(T,t={}){return this._lazyInitEmptyStyle(),this.style.setSky(T,t),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(T,t){return this.style.setFeatureState(T,t),this._update()}removeFeatureState(T,t){return this.style.removeFeatureState(T,t),this._update()}getFeatureState(T){return this.style.getFeatureState(T)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let T=0,t=0;return this._container&&(T=this._container.clientWidth||400,t=this._container.clientHeight||300),[T,t]}_setupContainer(){const T=this._container;T.classList.add("maplibregl-map");const t=this._canvasContainer=Y.create("div","maplibregl-canvas-container",T);this._interactive&&t.classList.add("maplibregl-interactive"),this._canvas=Y.create("canvas","maplibregl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const u=this._containerDimensions(),m=this._getClampedPixelRatio(u[0],u[1]);this._resizeCanvas(u[0],u[1],m);const b=this._controlContainer=Y.create("div","maplibregl-control-container",T),S=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((C=>{S[C]=Y.create("div",`maplibregl-ctrl-${C} `,b)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(T,t,u){this._canvas.width=Math.floor(u*T),this._canvas.height=Math.floor(u*t),this._canvas.style.width=`${T}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const T=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let t=null;this._canvas.addEventListener("webglcontextcreationerror",(m=>{t={requestedAttributes:T},m&&(t.statusMessage=m.statusMessage,t.type=m.type)}),{once:!0});let u=null;if(u=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,T):this._canvas.getContext("webgl2",T)||this._canvas.getContext("webgl",T),!u){const m="Failed to initialize WebGL";throw t?(t.message=m,new Error(JSON.stringify(t))):new Error(m)}this.painter=new Or(u,this.transform),xe.testSupport(u)}migrateProjection(T,t){super.migrateProjection(T,t),this.painter.transform=T,this.fire(new c.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(T){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||T,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(T){return this._update(),this._renderTaskQueue.add(T)}_cancelRenderFrame(T){this._renderTaskQueue.remove(T)}_render(T){var t,u,m,b,S;const C=this._idleTriggered?this._fadeDuration:0,O=((t=this.style.projection)===null||t===void 0?void 0:t.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(T),this._removed)return;let N=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const W=this.transform.zoom,H=ee.now();this.style.zoomHistory.update(W,H);const J=new c.F(W,{now:H,fadeDuration:C,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition(),globalState:this.style.getGlobalState()}),ae=J.crossFadingFactor();ae===1&&ae===this._crossFadingFactor||(N=!0,this._crossFadingFactor=ae),this.style.update(J)}const U=((u=this.style.projection)===null||u===void 0?void 0:u.transitionState)>0!==O;(m=this.style.projection)===null||m===void 0||m.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((b=this.style.projection)===null||b===void 0?void 0:b.transitionState,(S=this.style.projection)===null||S===void 0?void 0:S.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||U)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,C,this._crossSourceCollisions,U),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:C,showPadding:this.showPadding}),this.fire(new c.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,c.cw.mark(c.cx.load),this.fire(new c.l("load"))),this.style&&(this.style.hasTransitions()||N)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const q=this._sourcesDirty||this._styleDirty||this._placementDirty;return q||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new c.l("idle")),!this._loaded||this._fullyLoaded||q||(this._fullyLoaded=!0,c.cw.mark(c.cx.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var T;this._hash&&this._hash.remove();for(const u of this._controls)u.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),He.removeThrottleControl(this._imageQueueHandle),(T=this._resizeObserver)===null||T===void 0||T.disconnect();const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t!=null&&t.loseContext&&t.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),Y.remove(this._canvasContainer),Y.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),c.cw.clearMetrics(),this._removed=!0,this.fire(new c.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,ee.frame(this._frameRequest,(T=>{c.cw.frame(T),this._frameRequest=null;try{this._render(T)}catch(t){if(!c.cy(t)&&!(function(u){return u.message===Do})(t))throw t}}),(()=>{})))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(T){this._showTileBoundaries!==T&&(this._showTileBoundaries=T,this._update())}get showPadding(){return!!this._showPadding}set showPadding(T){this._showPadding!==T&&(this._showPadding=T,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(T){this._showCollisionBoxes!==T&&(this._showCollisionBoxes=T,T?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(T){this._showOverdrawInspector!==T&&(this._showOverdrawInspector=T,this._update())}get repaint(){return!!this._repaint}set repaint(T){this._repaint!==T&&(this._repaint=T,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(T){this._vertices=T,this._update()}get version(){return Zd}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(T){return this._lazyInitEmptyStyle(),this.style.setProjection(T),this._update(!0)}},_.MapMouseEvent=Ra,_.MapTouchEvent=Su,_.MapWheelEvent=Eu,_.Marker=Xa,_.NavigationControl=class{constructor(T){this._updateZoomButtons=()=>{const t=this._map.getZoom(),u=t===this._map.getMaxZoom(),m=t===this._map.getMinZoom();this._zoomInButton.disabled=u,this._zoomOutButton.disabled=m,this._zoomInButton.setAttribute("aria-disabled",u.toString()),this._zoomOutButton.setAttribute("aria-disabled",m.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(t,u)=>{const m=this._map._getUIString(`NavigationControl.${u}`);t.title=m,t.setAttribute("aria-label",m)},this.options=c.e({},Uo,T),this._container=Y.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",(t=>this._map.zoomIn({},{originalEvent:t}))),Y.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",(t=>this._map.zoomOut({},{originalEvent:t}))),Y.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",(t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})})),this._compassIcon=Y.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(T){return this._map=T,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Cs(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){Y.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(T,t){const u=Y.create("button",T,this._container);return u.type="button",u.addEventListener("click",t),u}},_.Popup=class extends c.E{constructor(T){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&Y.remove(this._content),this._container&&(Y.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new c.l("close"))),this),this._onMouseUp=t=>{this._update(t.point)},this._onMouseMove=t=>{this._update(t.point)},this._onDrag=t=>{this._update(t.point)},this._update=t=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=Y.create("div","maplibregl-popup",this._map.getContainer()),this._tip=Y.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const C of this.options.className.split(" "))this._container.classList.add(C);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=Nr(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!t)return;const u=this._flatPos=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&t?t:this._map.transform.locationToScreenPoint(this._lngLat));let m=this.options.anchor;const b=nu(this.options.offset);if(!m){const C=this._container.offsetWidth,O=this._container.offsetHeight;let N;N=u.y+b.bottom.y<O?["top"]:u.y>this._map.transform.height-O?["bottom"]:[],u.x<C/2?N.push("left"):u.x>this._map.transform.width-C/2&&N.push("right"),m=N.length===0?"bottom":N.join("-")}let S=u.add(b[m]);this.options.subpixelPositioning||(S=S.round()),Y.setTransform(this._container,`${ld[m]} translate(${S.x}px,${S.y}px)`),$o(this._container,m,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=c.e(Object.create(xh),T)}addTo(T){return this._map&&this.remove(),this._map=T,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new c.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(T){return this._lngLat=c.S.convert(T),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(T){return this.setDOMContent(document.createTextNode(T))}setHTML(T){const t=document.createDocumentFragment(),u=document.createElement("body");let m;for(u.innerHTML=T;m=u.firstChild,m;)t.appendChild(m);return this.setDOMContent(t)}getMaxWidth(){var T;return(T=this._container)===null||T===void 0?void 0:T.style.maxWidth}setMaxWidth(T){return this.options.maxWidth=T,this._update(),this}setDOMContent(T){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=Y.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(T),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(T){return this._container&&this._container.classList.add(T),this}removeClassName(T){return this._container&&this._container.classList.remove(T),this}setOffset(T){return this.options.offset=T,this._update(),this}toggleClassName(T){if(this._container)return this._container.classList.toggle(T)}setSubpixelPositioning(T){this.options.subpixelPositioning=T}_createCloseButton(){this.options.closeButton&&(this._closeButton=Y.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const T=this._container.querySelector(dc);T&&T.focus()}},_.RasterDEMTileSource=Bs,_.RasterTileSource=Ta,_.ScaleControl=class{constructor(T){this._onMove=()=>{Vi(this._map,this._container,this.options)},this.setUnit=t=>{this.options.unit=t,Vi(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Gn),T)}getDefaultPosition(){return"bottom-left"}onAdd(T){return this._map=T,this._container=Y.create("div","maplibregl-ctrl maplibregl-ctrl-scale",T.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){Y.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},_.ScrollZoomHandler=Nf,_.Style=P,_.TerrainControl=class{constructor(T){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=T}onAdd(T){return this._map=T,this._container=Y.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=Y.create("button","maplibregl-ctrl-terrain",this._container),Y.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){Y.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},_.TwoFingersTouchPitchHandler=Fc,_.TwoFingersTouchRotateHandler=oc,_.TwoFingersTouchZoomHandler=id,_.TwoFingersTouchZoomRotateHandler=Bf,_.VectorTileSource=Va,_.VideoSource=fr,_.addSourceType=(T,t)=>c._(void 0,void 0,void 0,(function*(){if(so(T))throw new Error(`A source type called "${T}" already exists.`);((u,m)=>{So[u]=m})(T,t)})),_.clearPrewarmedResources=function(){const T=Ot;T&&(T.isPreloaded()&&T.numActive()===1?(T.release(Bt),Ot=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},_.createTileMesh=lo,_.getMaxParallelImageRequests=function(){return c.a.MAX_PARALLEL_IMAGE_REQUESTS},_.getRTLTextPluginStatus=function(){return Fs().getRTLTextPluginStatus()},_.getVersion=function(){return wh},_.getWorkerCount=function(){return ke.workerCount},_.getWorkerUrl=function(){return c.a.WORKER_URL},_.importScriptInWorkers=function(T){return Fn().broadcast("IS",T)},_.prewarm=function(){Jt().acquire(Bt)},_.setMaxParallelImageRequests=function(T){c.a.MAX_PARALLEL_IMAGE_REQUESTS=T},_.setRTLTextPlugin=function(T,t){return Fs().setRTLTextPlugin(T,t)},_.setWorkerCount=function(T){ke.workerCount=T},_.setWorkerUrl=function(T){c.a.WORKER_URL=T}}));var g=n;return g}))})(Uv)),Uv.exports}var S4=T4();const wn=iy(S4);function E4(){return typeof self<"u"?fetch.bind(self):typeof global<"u"&&global.fetch?global.fetch:null}class A4{constructor(){this._apiKey="",this._fetch=E4(),this.tileCacheSize=200}set apiKey(e){this._apiKey=e}get apiKey(){return this._apiKey}set fetch(e){this._fetch=e}get fetch(){return this._fetch}}const qm=new A4,C4={AUTO:{code:null,flag:"auto",name:"Auto",latin:!1,isMode:!0,geocoding:!0},LATIN:{code:"latin",flag:"name:latin",name:"Latin",latin:!0,isMode:!1,geocoding:!1},NON_LATIN:{code:"nonlatin",flag:"name:nonlatin",name:"Non Latin",latin:!1,isMode:!1,geocoding:!1},LOCAL:{code:null,flag:"name",name:"Local",latin:!0,isMode:!1,geocoding:!1}},M4={ALBANIAN:{code:"sq",flag:"name:sq",name:"Albanian",latin:!0,isMode:!1,geocoding:!0},AMHARIC:{code:"am",flag:"name:am",name:"Amharic",latin:!1,isMode:!1,geocoding:!0},ARABIC:{code:"ar",flag:"name:ar",name:"Arabic",latin:!1,isMode:!1,geocoding:!0},ARMENIAN:{code:"hy",flag:"name:hy",name:"Armenian",latin:!1,isMode:!1,geocoding:!0},AZERBAIJANI:{code:"az",flag:"name:az",name:"Azerbaijani",latin:!0,isMode:!1,geocoding:!0},BASQUE:{code:"eu",flag:"name:eu",name:"Basque",latin:!0,isMode:!1,geocoding:!0},BELARUSIAN:{code:"be",flag:"name:be",name:"Belarusian",latin:!1,isMode:!1,geocoding:!0},BENGALI:{code:"bn",flag:"name:bn",name:"Bengali",latin:!0,isMode:!1,geocoding:!0},BOSNIAN:{code:"bs",flag:"name:bs",name:"Bosnian",latin:!0,isMode:!1,geocoding:!0},BRETON:{code:"br",flag:"name:br",name:"Breton",latin:!0,isMode:!1,geocoding:!0},BULGARIAN:{code:"bg",flag:"bg",name:"Bulgarian",latin:!1,isMode:!1,geocoding:!0},CATALAN:{code:"ca",flag:"name:ca",name:"Catalan",latin:!0,isMode:!1,geocoding:!0},CHINESE:{code:"zh",flag:"name:zh",name:"Chinese",latin:!1,isMode:!1,geocoding:!0},TRADITIONAL_CHINESE:{code:"zh-Hant",flag:"name:zh-Hant",name:"Chinese (traditional)",latin:!1,isMode:!1,geocoding:!1},SIMPLIFIED_CHINESE:{code:"zh-Hans",flag:"name:zh-Hans",name:"Chinese (simplified)",latin:!1,isMode:!1,geocoding:!1},CORSICAN:{code:"co",flag:"name:co",name:"Corsican",latin:!0,isMode:!1,geocoding:!0},CROATIAN:{code:"hr",flag:"name:hr",name:"Croatian",latin:!0,isMode:!1,geocoding:!0},CZECH:{code:"cs",flag:"name:cs",name:"Czech",latin:!0,isMode:!1,geocoding:!0},DANISH:{code:"da",flag:"name:da",name:"Danish",latin:!0,isMode:!1,geocoding:!0},DUTCH:{code:"nl",flag:"name:nl",name:"Dutch",latin:!0,isMode:!1,geocoding:!0},GERMAN:{code:"de",flag:"name:de",name:"German",latin:!0,isMode:!1,geocoding:!0},GREEK:{code:"el",flag:"name:el",name:"Greek",latin:!1,isMode:!1,geocoding:!0},ENGLISH:{code:"en",flag:"name:en",name:"English",latin:!0,isMode:!1,geocoding:!0},ESPERANTO:{code:"eo",flag:"name:eo",name:"Esperanto",latin:!0,isMode:!1,geocoding:!0},ESTONIAN:{code:"et",flag:"name:et",name:"Estonian",latin:!0,isMode:!1,geocoding:!0},FINNISH:{code:"fi",flag:"name:fi",name:"Finnish",latin:!0,isMode:!1,geocoding:!0},FRENCH:{code:"fr",flag:"name:fr",name:"French",latin:!0,isMode:!1,geocoding:!0},FRISIAN:{code:"fy",flag:"name:fy",name:"Frisian (West)",latin:!0,isMode:!1,geocoding:!0},GEORGIAN:{code:"ka",flag:"name:ka",name:"Georgian",latin:!1,isMode:!1,geocoding:!0},HEBREW:{code:"he",flag:"name:he",name:"Hebrew",latin:!1,isMode:!1,geocoding:!0},HINDI:{code:"hi",flag:"name:hi",name:"Hindi",latin:!1,isMode:!1,geocoding:!0},HUNGARIAN:{code:"hu",flag:"name:hu",name:"Hungarian",latin:!0,isMode:!1,geocoding:!0},ICELANDIC:{code:"is",flag:"name:is",name:"Icelandic",latin:!0,isMode:!1,geocoding:!0},INDONESIAN:{code:"id",flag:"name:id",name:"Indonesian",latin:!0,isMode:!1,geocoding:!0},IRISH:{code:"ga",flag:"name:ga",name:"Irish",latin:!0,isMode:!1,geocoding:!0},ITALIAN:{code:"it",flag:"name:it",name:"Italian",latin:!0,isMode:!1,geocoding:!0},JAPANESE:{code:"ja",flag:"name:ja",name:"Japanese",latin:!1,isMode:!1,geocoding:!0},JAPANESE_HIRAGANA:{code:"ja-Hira",flag:"name:ja-Hira",name:"Japanese Hiragana form",latin:!1,isMode:!1,geocoding:!1},JAPANESE_2018:{code:"ja-Latn",flag:"name:ja-Latn",name:"Japanese (Latin 2018)",latin:!0,isMode:!1,geocoding:!1},JAPANESE_KANA:{code:"ja_kana",flag:"name:ja_kana",name:"Japanese (Kana)",latin:!1,isMode:!1,geocoding:!1},JAPANESE_LATIN:{code:"ja_rm",flag:"name:ja_rm",name:"Japanese (Latin script)",latin:!0,isMode:!1,geocoding:!1},KANNADA:{code:"kn",flag:"name:kn",name:"Kannada",latin:!0,isMode:!1,geocoding:!0},KAZAKH:{code:"kk",flag:"name:kk",name:"Kazakh",latin:!1,isMode:!1,geocoding:!0},KOREAN:{code:"ko",flag:"name:ko",name:"Korean",latin:!1,isMode:!1,geocoding:!0},KOREAN_LATIN:{code:"ko-Latn",flag:"name:ko-Latn",name:"Korean (Latin script)",latin:!0,isMode:!1,geocoding:!1},KURDISH:{code:"ku",flag:"name:ku",name:"Kurdish",latin:!0,isMode:!1,geocoding:!0},CLASSICAL_LATIN:{code:"la",flag:"name:la",name:"Latin",latin:!0,isMode:!1,geocoding:!0},LATVIAN:{code:"lv",flag:"name:lv",name:"Latvian",latin:!0,isMode:!1,geocoding:!0},LITHUANIAN:{code:"lt",flag:"name:lt",name:"Lithuanian",latin:!0,isMode:!1,geocoding:!0},LUXEMBOURGISH:{code:"lb",flag:"name:lb",name:"Luxembourgish",latin:!0,isMode:!1,geocoding:!0},MACEDONIAN:{code:"mk",flag:"name:mk",name:"Macedonian",latin:!1,isMode:!1,geocoding:!0},MALAYALAM:{code:"ml",flag:"name:ml",name:"Malayalam",latin:!1,isMode:!1,geocoding:!0},MALTESE:{code:"mt",flag:"name:mt",name:"Maltese",latin:!0,isMode:!1,geocoding:!0},NORWEGIAN:{code:"no",flag:"name:no",name:"Norwegian",latin:!0,isMode:!1,geocoding:!0},OCCITAN:{code:"oc",flag:"name:oc",name:"Occitan",latin:!0,isMode:!1,geocoding:!0},PERSIAN:{code:"fa",flag:"name:fa",name:"Persian",latin:!1,isMode:!1,geocoding:!0},POLISH:{code:"pl",flag:"name:pl",name:"Polish",latin:!0,isMode:!1,geocoding:!0},PORTUGUESE:{code:"pt",flag:"name:pt",name:"Portuguese",latin:!0,isMode:!1,geocoding:!0},PUNJABI:{code:"pa",flag:"name:pa",name:"Punjabi",latin:!1,isMode:!1,geocoding:!0},WESTERN_PUNJABI:{code:"pnb",flag:"name:pnb",name:"Western Punjabi",latin:!1,isMode:!1,geocoding:!1},ROMANIAN:{code:"ro",flag:"name:ro",name:"Romanian",latin:!0,isMode:!1,geocoding:!0},ROMANSH:{code:"rm",flag:"name:rm",name:"Romansh",latin:!0,isMode:!1,geocoding:!0},RUSSIAN:{code:"ru",flag:"name:ru",name:"Russian",latin:!1,isMode:!1,geocoding:!0},SERBIAN_CYRILLIC:{code:"sr",flag:"name:sr",name:"Serbian (Cyrillic script)",latin:!1,isMode:!1,geocoding:!0},SERBIAN_LATIN:{code:"sr-Latn",flag:"name:sr-Latn",name:"Serbian (Latin script)",latin:!0,isMode:!1,geocoding:!1},SCOTTISH_GAELIC:{code:"gd",flag:"name:gd",name:"Scottish Gaelic",latin:!0,isMode:!1,geocoding:!0},SLOVAK:{code:"sk",flag:"name:sk",name:"Slovak",latin:!0,isMode:!1,geocoding:!0},SLOVENE:{code:"sl",flag:"name:sl",name:"Slovene",latin:!0,isMode:!1,geocoding:!0},SPANISH:{code:"es",flag:"name:es",name:"Spanish",latin:!0,isMode:!1,geocoding:!0},SWEDISH:{code:"sv",flag:"name:sv",name:"Swedish",latin:!0,isMode:!1,geocoding:!0},TAMIL:{code:"ta",flag:"name:ta",name:"Tamil",latin:!1,isMode:!1,geocoding:!0},TELUGU:{code:"te",flag:"name:te",name:"Telugu",latin:!1,isMode:!1,geocoding:!0},THAI:{code:"th",flag:"name:th",name:"Thai",latin:!1,isMode:!1,geocoding:!0},TURKISH:{code:"tr",flag:"name:tr",name:"Turkish",latin:!0,isMode:!1,geocoding:!0},UKRAINIAN:{code:"uk",flag:"name:uk",name:"Ukrainian",latin:!1,isMode:!1,geocoding:!0},VIETNAMESE:{code:"vi",flag:"name:vi",name:"Vietnamese (Latin script)",latin:!0,isMode:!1,geocoding:!0},WELSH:{code:"cy",flag:"name:cy",name:"Welsh",latin:!0,isMode:!1,geocoding:!0}},py={...C4,...M4};function I4(i,e=py){return i in e?i[i]:null}function Bx(i,e=py){for(const n of Object.values(e))if(n.code===i)return n;return null}function Fx(i,e=py){for(const n of Object.values(e))if(n.flag===i)return n;return null}function P4(i){return i!==null&&typeof i=="object"&&"code"in i&&"flag"in i&&"name"in i&&"latin"in i&&"isMode"in i&&"geocoding"in i&&(typeof i.code=="string"||i.code===null)&&typeof i.flag=="string"&&typeof i.name=="string"&&typeof i.latin=="boolean"&&typeof i.isMode=="boolean"&&typeof i.geocoding=="boolean"}function OT(i,e=py){return P4(i)?Fx(i.flag,e):typeof i!="string"?null:I4(i,e)||Bx(i,e)||Fx(i,e)||null}async function R4(i,e={}){if(qm.fetch===null)throw new Error("The fetch function was not found. If on NodeJS < 18 please specify the fetch function with config.fetch");if(new URL(i).searchParams.get("key").trim()==="")throw new Error("The MapTiler Cloud API key is missing. Set it in `config.apiKey` or get one for free at https://maptiler.com");return qm.fetch(i,e)}const kC={maptilerApiURL:"https://api.maptiler.com/",mapStyle:"streets-v2"};Object.freeze(kC);class L4 extends Error{constructor(e,n=""){super(`Call to enpoint ${e.url} failed with the status code ${e.status}. ${n}`),this.res=e}}const NT={403:"Key is missing, invalid or restricted"};async function k4(i={}){const e=new URL("geolocation/ip.json",kC.maptilerApiURL);e.searchParams.set("key",i.apiKey??qm.apiKey),"elevation"in i&&e.searchParams.set("elevation",i.elevation?"true":"false");const n=e.toString(),o=await R4(n);if(!o.ok)throw new L4(o,o.status in NT?NT[o.status]:"");return await o.json()}const BT={info:k4};function DC(i){const e=/^maptiler:\/\/(.*)/;let n;const o=i.trim();let d;return o.startsWith("http://")||o.startsWith("https://")?d=o:(n=e.exec(o))!==null?d=`https://api.maptiler.com/maps/${n[1]}/style.json`:d=`https://api.maptiler.com/maps/${o}/style.json`,d}class zC{constructor(e,n,o,d,g,_,c=!1){this.name=e,this.variantType=n,this.id=o,this.referenceStyle=d,this.description=g,this.imageURL=_,this.deprecated=c}getName(){return this.name}getFullName(){return`${this.referenceStyle.getName()} ${this.name}`}getType(){return this.variantType}getId(){return this.id}getDescription(){return this.description}getReferenceStyle(){return this.referenceStyle}hasVariant(e){return this.referenceStyle.hasVariant(e)}getVariant(e){const n=this.referenceStyle.getVariant(e);return this.warnIfDeprecated(n),n}getVariants(){return this.referenceStyle.getVariants().filter(e=>e!==this).map(e=>(this.warnIfDeprecated(e),e))}getImageURL(){return this.imageURL}getExpandedStyleURL(){return DC(this.getId())}warnIfDeprecated(e=this){if(!e.deprecated)return e;const n=e.getFullName();return console.warn(`Style "${n}" is deprecated and will be removed in a future version.`),e}}class OC{constructor(e,n){this.name=e,this.id=n,this.variants={},this.orderedVariants=[]}getName(){return this.name}getId(){return this.id}addVariant(e){this.variants[e.getType()]=e,this.orderedVariants.push(e)}hasVariant(e){return e in this.variants}getVariant(e){return e in this.variants?this.variants[e]:this.orderedVariants[0]}getVariants(){return Object.values(this.variants)}getDefaultVariant(){return this.orderedVariants[0].warnIfDeprecated()}}const P_=[{referenceStyleID:"STREETS",name:"Streets",description:"",variants:[{id:"streets-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"streets-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"streets-v2-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""},{id:"streets-v2-night",name:"Night",variantType:"NIGHT",description:"",imageURL:""},{id:"streets-v2-pastel",name:"Pastel",variantType:"PASTEL",description:"",imageURL:""}]},{referenceStyleID:"OUTDOOR",name:"Outdoor",description:"",variants:[{id:"outdoor-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"outdoor-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""}]},{referenceStyleID:"WINTER",name:"Winter",description:"",variants:[{id:"winter-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"winter-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""}]},{referenceStyleID:"SATELLITE",name:"Satellite",description:"",variants:[{id:"satellite",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"HYBRID",name:"Hybrid",description:"",variants:[{id:"hybrid",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"BASIC",name:"Basic",description:"",variants:[{id:"basic-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"basic-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"basic-v2-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""}]},{referenceStyleID:"BRIGHT",name:"Bright",description:"",variants:[{id:"bright-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"bright-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"bright-v2-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""},{id:"bright-v2-pastel",name:"Pastel",variantType:"PASTEL",description:"",imageURL:""}]},{referenceStyleID:"OPENSTREETMAP",name:"OpenStreetMap",description:"",variants:[{id:"openstreetmap",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"TOPO",name:"Topo",description:"",variants:[{id:"topo-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"topo-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"topo-v2-shiny",name:"Shiny",deprecated:!0,variantType:"SHINY",description:"",imageURL:""},{id:"topo-v2-pastel",name:"Pastel",variantType:"PASTEL",description:"",imageURL:""},{id:"topo-v2-topographique",name:"Topographique",variantType:"TOPOGRAPHIQUE",description:"",imageURL:""}]},{referenceStyleID:"VOYAGER",name:"Voyager",description:"",variants:[{id:"voyager-v2",name:"Default",deprecated:!0,variantType:"DEFAULT",description:"",imageURL:""},{id:"voyager-v2-darkmatter",name:"Darkmatter",deprecated:!0,variantType:"DARK",description:"",imageURL:""},{id:"voyager-v2-positron",name:"Positron",deprecated:!0,variantType:"LIGHT",description:"",imageURL:""},{id:"voyager-v2-vintage",name:"Vintage",deprecated:!0,variantType:"VINTAGE",description:"",imageURL:""}]},{referenceStyleID:"TONER",name:"Toner",description:"",variants:[{id:"toner-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"toner-v2-background",name:"Background",variantType:"BACKGROUND",deprecated:!0,description:"",imageURL:""},{id:"toner-v2-lite",name:"Lite",variantType:"LITE",description:"",imageURL:""},{id:"toner-v2-lines",name:"Lines",variantType:"LINES",deprecated:!0,description:"",imageURL:""}]},{referenceStyleID:"DATAVIZ",name:"Dataviz",description:"",variants:[{id:"dataviz",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"dataviz-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"dataviz-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""}]},{referenceStyleID:"BACKDROP",name:"Backdrop",description:"",variants:[{id:"backdrop",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"backdrop-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"backdrop-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""}]},{referenceStyleID:"OCEAN",name:"Ocean",description:"",variants:[{id:"ocean",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"AQUARELLE",name:"Aquarelle",description:"Watercolor map for creative use",variants:[{id:"aquarelle",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"aquarelle-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"aquarelle-vivid",name:"Vivid",variantType:"VIVID",description:"",imageURL:""}]},{referenceStyleID:"LANDSCAPE",name:"Landscape",description:"Terrain map for data overlays and visualisations",variants:[{id:"landscape",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"landscape-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"landscape-vivid",name:"Vivid",variantType:"VIVID",description:"",imageURL:""}]}];function D4(i){return new Proxy(i,{get(e,n,o){return e.hasVariant(n)?e.getVariant(n):n.toString().toUpperCase()===n?i.getDefaultVariant():Reflect.get(e,n,o)}})}function z4(){const i={};for(let e=0;e<P_.length;e+=1){const n=P_[e],o=D4(new OC(n.name,n.referenceStyleID));for(let d=0;d<n.variants.length;d+=1){const g=n.variants[d],_=new zC(g.name,g.variantType,g.id,o,g.description,g.imageURL,g.deprecated);o.addVariant(_)}i[n.referenceStyleID]=o}return i}const R_=z4();var yv={exports:{}},FT;function O4(){if(FT)return yv.exports;FT=1;var i=typeof Reflect=="object"?Reflect:null,e=i&&typeof i.apply=="function"?i.apply:function(Ue,Be,de){return Function.prototype.apply.call(Ue,Be,de)},n;i&&typeof i.ownKeys=="function"?n=i.ownKeys:Object.getOwnPropertySymbols?n=function(Ue){return Object.getOwnPropertyNames(Ue).concat(Object.getOwnPropertySymbols(Ue))}:n=function(Ue){return Object.getOwnPropertyNames(Ue)};function o(He){console&&console.warn&&console.warn(He)}var d=Number.isNaN||function(Ue){return Ue!==Ue};function g(){g.init.call(this)}yv.exports=g,yv.exports.once=tt,g.EventEmitter=g,g.prototype._events=void 0,g.prototype._eventsCount=0,g.prototype._maxListeners=void 0;var _=10;function c(He){if(typeof He!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof He)}Object.defineProperty(g,"defaultMaxListeners",{enumerable:!0,get:function(){return _},set:function(He){if(typeof He!="number"||He<0||d(He))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+He+".");_=He}}),g.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},g.prototype.setMaxListeners=function(Ue){if(typeof Ue!="number"||Ue<0||d(Ue))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+Ue+".");return this._maxListeners=Ue,this};function M(He){return He._maxListeners===void 0?g.defaultMaxListeners:He._maxListeners}g.prototype.getMaxListeners=function(){return M(this)},g.prototype.emit=function(Ue){for(var Be=[],de=1;de<arguments.length;de++)Be.push(arguments[de]);var ce=Ue==="error",_e=this._events;if(_e!==void 0)ce=ce&&_e.error===void 0;else if(!ce)return!1;if(ce){var Ae;if(Be.length>0&&(Ae=Be[0]),Ae instanceof Error)throw Ae;var Pe=new Error("Unhandled error."+(Ae?" ("+Ae.message+")":""));throw Pe.context=Ae,Pe}var Ge=_e[Ue];if(Ge===void 0)return!1;if(typeof Ge=="function")e(Ge,this,Be);else for(var Re=Ge.length,In=xe(Ge,Re),de=0;de<Re;++de)e(In[de],this,Be);return!0};function k(He,Ue,Be,de){var ce,_e,Ae;if(c(Be),_e=He._events,_e===void 0?(_e=He._events=Object.create(null),He._eventsCount=0):(_e.newListener!==void 0&&(He.emit("newListener",Ue,Be.listener?Be.listener:Be),_e=He._events),Ae=_e[Ue]),Ae===void 0)Ae=_e[Ue]=Be,++He._eventsCount;else if(typeof Ae=="function"?Ae=_e[Ue]=de?[Be,Ae]:[Ae,Be]:de?Ae.unshift(Be):Ae.push(Be),ce=M(He),ce>0&&Ae.length>ce&&!Ae.warned){Ae.warned=!0;var Pe=new Error("Possible EventEmitter memory leak detected. "+Ae.length+" "+String(Ue)+" listeners added. Use emitter.setMaxListeners() to increase limit");Pe.name="MaxListenersExceededWarning",Pe.emitter=He,Pe.type=Ue,Pe.count=Ae.length,o(Pe)}return He}g.prototype.addListener=function(Ue,Be){return k(this,Ue,Be,!1)},g.prototype.on=g.prototype.addListener,g.prototype.prependListener=function(Ue,Be){return k(this,Ue,Be,!0)};function j(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function G(He,Ue,Be){var de={fired:!1,wrapFn:void 0,target:He,type:Ue,listener:Be},ce=j.bind(de);return ce.listener=Be,de.wrapFn=ce,ce}g.prototype.once=function(Ue,Be){return c(Be),this.on(Ue,G(this,Ue,Be)),this},g.prototype.prependOnceListener=function(Ue,Be){return c(Be),this.prependListener(Ue,G(this,Ue,Be)),this},g.prototype.removeListener=function(Ue,Be){var de,ce,_e,Ae,Pe;if(c(Be),ce=this._events,ce===void 0)return this;if(de=ce[Ue],de===void 0)return this;if(de===Be||de.listener===Be)--this._eventsCount===0?this._events=Object.create(null):(delete ce[Ue],ce.removeListener&&this.emit("removeListener",Ue,de.listener||Be));else if(typeof de!="function"){for(_e=-1,Ae=de.length-1;Ae>=0;Ae--)if(de[Ae]===Be||de[Ae].listener===Be){Pe=de[Ae].listener,_e=Ae;break}if(_e<0)return this;_e===0?de.shift():be(de,_e),de.length===1&&(ce[Ue]=de[0]),ce.removeListener!==void 0&&this.emit("removeListener",Ue,Pe||Be)}return this},g.prototype.off=g.prototype.removeListener,g.prototype.removeAllListeners=function(Ue){var Be,de,ce;if(de=this._events,de===void 0)return this;if(de.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):de[Ue]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete de[Ue]),this;if(arguments.length===0){var _e=Object.keys(de),Ae;for(ce=0;ce<_e.length;++ce)Ae=_e[ce],Ae!=="removeListener"&&this.removeAllListeners(Ae);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(Be=de[Ue],typeof Be=="function")this.removeListener(Ue,Be);else if(Be!==void 0)for(ce=Be.length-1;ce>=0;ce--)this.removeListener(Ue,Be[ce]);return this};function ee(He,Ue,Be){var de=He._events;if(de===void 0)return[];var ce=de[Ue];return ce===void 0?[]:typeof ce=="function"?Be?[ce.listener||ce]:[ce]:Be?Ne(ce):xe(ce,ce.length)}g.prototype.listeners=function(Ue){return ee(this,Ue,!0)},g.prototype.rawListeners=function(Ue){return ee(this,Ue,!1)},g.listenerCount=function(He,Ue){return typeof He.listenerCount=="function"?He.listenerCount(Ue):Y.call(He,Ue)},g.prototype.listenerCount=Y;function Y(He){var Ue=this._events;if(Ue!==void 0){var Be=Ue[He];if(typeof Be=="function")return 1;if(Be!==void 0)return Be.length}return 0}g.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]};function xe(He,Ue){for(var Be=new Array(Ue),de=0;de<Ue;++de)Be[de]=He[de];return Be}function be(He,Ue){for(;Ue+1<He.length;Ue++)He[Ue]=He[Ue+1];He.pop()}function Ne(He){for(var Ue=new Array(He.length),Be=0;Be<Ue.length;++Be)Ue[Be]=He[Be].listener||He[Be];return Ue}function tt(He,Ue){return new Promise(function(Be,de){function ce(Ae){He.removeListener(Ue,_e),de(Ae)}function _e(){typeof He.removeListener=="function"&&He.removeListener("error",ce),Be([].slice.call(arguments))}qe(He,Ue,_e,{once:!0}),Ue!=="error"&&Je(He,ce,{once:!0})})}function Je(He,Ue,Be){typeof He.on=="function"&&qe(He,"error",Ue,Be)}function qe(He,Ue,Be,de){if(typeof He.on=="function")de.once?He.once(Ue,Be):He.on(Ue,Be);else if(typeof He.addEventListener=="function")He.addEventListener(Ue,function ce(_e){de.once&&He.removeEventListener(Ue,ce),Be(_e)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof He)}return yv.exports}var N4=O4();const B4=iy(N4),Qo=[];for(let i=0;i<256;++i)Qo.push((i+256).toString(16).slice(1));function F4(i,e=0){return(Qo[i[e+0]]+Qo[i[e+1]]+Qo[i[e+2]]+Qo[i[e+3]]+"-"+Qo[i[e+4]]+Qo[i[e+5]]+"-"+Qo[i[e+6]]+Qo[i[e+7]]+"-"+Qo[i[e+8]]+Qo[i[e+9]]+"-"+Qo[i[e+10]]+Qo[i[e+11]]+Qo[i[e+12]]+Qo[i[e+13]]+Qo[i[e+14]]+Qo[i[e+15]]).toLowerCase()}let Ub;const V4=new Uint8Array(16);function j4(){if(!Ub){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Ub=crypto.getRandomValues.bind(crypto)}return Ub(V4)}const U4=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),VT={randomUUID:U4};function $4(i,e,n){var d;if(VT.randomUUID&&!i)return VT.randomUUID();i=i||{};const o=i.random??((d=i.rng)==null?void 0:d.call(i))??j4();if(o.length<16)throw new Error("Random bytes length must be >= 16");return o[6]=o[6]&15|64,o[8]=o[8]&63|128,F4(o)}const NC="3.7.8",q4=NC,lg=typeof Buffer=="function",jT=typeof TextDecoder=="function"?new TextDecoder:void 0,UT=typeof TextEncoder=="function"?new TextEncoder:void 0,G4="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",b_=Array.prototype.slice.call(G4),vv=(i=>{let e={};return i.forEach((n,o)=>e[n]=o),e})(b_),Z4=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,Jo=String.fromCharCode.bind(String),$T=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):i=>new Uint8Array(Array.prototype.slice.call(i,0)),BC=i=>i.replace(/=/g,"").replace(/[+\/]/g,e=>e=="+"?"-":"_"),FC=i=>i.replace(/[^A-Za-z0-9\+\/]/g,""),VC=i=>{let e,n,o,d,g="";const _=i.length%3;for(let c=0;c<i.length;){if((n=i.charCodeAt(c++))>255||(o=i.charCodeAt(c++))>255||(d=i.charCodeAt(c++))>255)throw new TypeError("invalid character found");e=n<<16|o<<8|d,g+=b_[e>>18&63]+b_[e>>12&63]+b_[e>>6&63]+b_[e&63]}return _?g.slice(0,_-3)+"===".substring(_):g},cw=typeof btoa=="function"?i=>btoa(i):lg?i=>Buffer.from(i,"binary").toString("base64"):VC,Vx=lg?i=>Buffer.from(i).toString("base64"):i=>{let n=[];for(let o=0,d=i.length;o<d;o+=4096)n.push(Jo.apply(null,i.subarray(o,o+4096)));return cw(n.join(""))},$v=(i,e=!1)=>e?BC(Vx(i)):Vx(i),H4=i=>{if(i.length<2){var e=i.charCodeAt(0);return e<128?i:e<2048?Jo(192|e>>>6)+Jo(128|e&63):Jo(224|e>>>12&15)+Jo(128|e>>>6&63)+Jo(128|e&63)}else{var e=65536+(i.charCodeAt(0)-55296)*1024+(i.charCodeAt(1)-56320);return Jo(240|e>>>18&7)+Jo(128|e>>>12&63)+Jo(128|e>>>6&63)+Jo(128|e&63)}},X4=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,jC=i=>i.replace(X4,H4),qT=lg?i=>Buffer.from(i,"utf8").toString("base64"):UT?i=>Vx(UT.encode(i)):i=>cw(jC(i)),Gm=(i,e=!1)=>e?BC(qT(i)):qT(i),GT=i=>Gm(i,!0),W4=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,K4=i=>{switch(i.length){case 4:var e=(7&i.charCodeAt(0))<<18|(63&i.charCodeAt(1))<<12|(63&i.charCodeAt(2))<<6|63&i.charCodeAt(3),n=e-65536;return Jo((n>>>10)+55296)+Jo((n&1023)+56320);case 3:return Jo((15&i.charCodeAt(0))<<12|(63&i.charCodeAt(1))<<6|63&i.charCodeAt(2));default:return Jo((31&i.charCodeAt(0))<<6|63&i.charCodeAt(1))}},UC=i=>i.replace(W4,K4),$C=i=>{if(i=i.replace(/\s+/g,""),!Z4.test(i))throw new TypeError("malformed base64.");i+="==".slice(2-(i.length&3));let e,n,o,d=[];for(let g=0;g<i.length;)e=vv[i.charAt(g++)]<<18|vv[i.charAt(g++)]<<12|(n=vv[i.charAt(g++)])<<6|(o=vv[i.charAt(g++)]),n===64?d.push(Jo(e>>16&255)):o===64?d.push(Jo(e>>16&255,e>>8&255)):d.push(Jo(e>>16&255,e>>8&255,e&255));return d.join("")},hw=typeof atob=="function"?i=>atob(FC(i)):lg?i=>Buffer.from(i,"base64").toString("binary"):$C,qC=lg?i=>$T(Buffer.from(i,"base64")):i=>$T(hw(i).split("").map(e=>e.charCodeAt(0))),GC=i=>qC(ZC(i)),Y4=lg?i=>Buffer.from(i,"base64").toString("utf8"):jT?i=>jT.decode(qC(i)):i=>UC(hw(i)),ZC=i=>FC(i.replace(/[-_]/g,e=>e=="-"?"+":"/")),jx=i=>Y4(ZC(i)),Q4=i=>{if(typeof i!="string")return!1;const e=i.replace(/\s+/g,"").replace(/={0,2}$/,"");return!/[^\s0-9a-zA-Z\+/]/.test(e)||!/[^\s0-9a-zA-Z\-_]/.test(e)},HC=i=>({value:i,enumerable:!1,writable:!0,configurable:!0}),XC=function(){const i=(e,n)=>Object.defineProperty(String.prototype,e,HC(n));i("fromBase64",function(){return jx(this)}),i("toBase64",function(e){return Gm(this,e)}),i("toBase64URI",function(){return Gm(this,!0)}),i("toBase64URL",function(){return Gm(this,!0)}),i("toUint8Array",function(){return GC(this)})},WC=function(){const i=(e,n)=>Object.defineProperty(Uint8Array.prototype,e,HC(n));i("toBase64",function(e){return $v(this,e)}),i("toBase64URI",function(){return $v(this,!0)}),i("toBase64URL",function(){return $v(this,!0)})},J4=()=>{XC(),WC()},eO={version:NC,VERSION:q4,atob:hw,atobPolyfill:$C,btoa:cw,btoaPolyfill:VC,fromBase64:jx,toBase64:Gm,encode:Gm,encodeURI:GT,encodeURL:GT,utob:jC,btou:UC,decode:jx,isValid:Q4,fromUint8Array:$v,toUint8Array:GC,extendString:XC,extendUint8Array:WC,extendBuiltins:J4};var tO=Object.defineProperty,KC=i=>{throw TypeError(i)},nO=(i,e,n)=>e in i?tO(i,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):i[e]=n,rn=(i,e,n)=>nO(i,typeof e!="symbol"?e+"":e,n),dw=(i,e,n)=>e.has(i)||KC("Cannot "+n),An=(i,e,n)=>(dw(i,e,"read from private field"),n?n.call(i):e.get(i)),lu=(i,e,n)=>e.has(i)?KC("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(i):e.set(i,n),Nu=(i,e,n,o)=>(dw(i,e,"write to private field"),e.set(i,n),n),zu=(i,e,n)=>(dw(i,e,"access private method"),n);const Qi={VISITOR:{code:null,flag:"visitor",name:"Visitor",latin:!0,isMode:!0,geocoding:!1},VISITOR_ENGLISH:{code:null,flag:"visitor_en",name:"Visitor English",latin:!0,isMode:!0,geocoding:!1},STYLE:{code:null,flag:"style",name:"Style",latin:!1,isMode:!0,geocoding:!1},STYLE_LOCK:{code:null,flag:"style_lock",name:"Style Lock",latin:!1,isMode:!0,geocoding:!1},...py};function ZT(){if(typeof navigator>"u"){const i=Intl.DateTimeFormat().resolvedOptions().locale.split("-")[0];return Bx(i)||Qi.ENGLISH}return Array.from(new Set(navigator.languages.map(i=>i.split("-")[0]))).map(i=>Bx(i)).filter(i=>i)[0]??Qi.LOCAL}const Ul={maptilerLogoURL:"https://api.maptiler.com/resources/logo.svg",maptilerURL:"https://www.maptiler.com/",maptilerApiHost:"api.maptiler.com",telemetryURL:"https://api.maptiler.com/metrics",rtlPluginURL:"https://cdn.maptiler.com/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.min.js",primaryLanguage:Qi.STYLE,secondaryLanguage:Qi.LOCAL,terrainSourceURL:"https://api.maptiler.com/tiles/terrain-rgb-v2/tiles.json",terrainSourceId:"maptiler-terrain"};Object.freeze(Ul);const fw=$4();class iO extends B4{constructor(){super(...arguments),rn(this,"primaryLanguage",Ul.primaryLanguage),rn(this,"secondaryLanguage"),rn(this,"session",!0),rn(this,"caching",!0),rn(this,"telemetry",!0),rn(this,"_unit","metric"),rn(this,"_apiKey","")}set unit(e){this._unit=e,this.emit("unit",e)}get unit(){return this._unit}set apiKey(e){this._apiKey=e,qm.apiKey=e,this.emit("apiKey",e)}get apiKey(){return this._apiKey}set fetch(e){qm.fetch=e}get fetch(){return qm.fetch}}const Ka=new iO,Ux="localcache_source",$x="localcache",rO="maptiler_sdk",aO=1e3,sO=100,qx=typeof caches<"u",{addProtocol:HT}=wn;function oO(i,e){if(qx&&Ka.caching&&Ka.session&&i.host===Ul.maptilerApiHost){if(e==="Source"&&i.href.includes("tiles.json"))return i.href.replace("https://",`${Ux}://`);if(e==="Tile"||e==="Glyphs")return i.href.replace("https://",`${$x}://`)}return i.href}let $b;async function YC(){return $b||($b=await caches.open(rO)),$b}let XT=0;async function lO(){const i=await YC(),e=await i.keys(),n=e.slice(0,Math.max(e.length-aO,0));for(const o of n)i.delete(o)}function uO(){HT(Ux,async(i,e)=>{if(!i.url)throw new Error("");i.url=i.url.replace(`${Ux}://`,"https://");const n=i;n.signal=e.signal;const o=await fetch(i.url,n),d=await o.json();return d.tiles&&d.tiles.length>0&&(d.tiles[0]+=`&last-modified=${o.headers.get("Last-Modified")}`),{data:d,cacheControl:o.headers.get("Cache-Control"),expires:o.headers.get("Expires")}}),HT($x,async(i,e)=>{if(!i.url)throw new Error("");i.url=i.url.replace(`${$x}://`,"https://");const n=new URL(i.url),o=new URL(n);o.searchParams.delete("mtsid"),o.searchParams.delete("key");const d=o.toString(),g=new URL(n);g.searchParams.delete("last-modified");const _=g.toString(),c=async ee=>({data:await ee.arrayBuffer(),cacheControl:ee.headers.get("Cache-Control"),expires:ee.headers.get("Expires")}),M=await YC(),k=await M.match(d);if(k)return c(k);const j=i;j.signal=e.signal;const G=await fetch(_,j);return G.status>=200&&G.status<300&&(M.put(d,G.clone()).catch(()=>{}),++XT>sO&&(lO(),XT=0)),c(G)})}function cO(){if(typeof window>"u")return;const i=wn.getRTLTextPluginStatus();if(i==="unavailable"||i==="requested")try{wn.setRTLTextPlugin(Ul.rtlPluginURL,!0)}catch{}}function hO(i,e){for(const n of i)typeof e[n]=="function"&&(e[n]=e[n].bind(e))}function WT(i,e){let n=null;try{n=new URL(i)}catch{return{url:i}}return n.host===Ul.maptilerApiHost&&(n.searchParams.has("key")||n.searchParams.append("key",Ka.apiKey),Ka.session&&n.searchParams.append("mtsid",fw)),{url:oO(n,e)}}function KT(i){return(e,n)=>{if(i!=null){const o=i(e,n),d=WT((o==null?void 0:o.url)??"",n);return{...o,...d}}return WT(e,n)}}function QC(){return Math.random().toString(36).substring(2)}function $0(i){return/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/gi.test(i)}function dO(i){try{return JSON.parse(i)}catch{}return null}function fO(){return document.createElement("canvas").getContext("webgl2")?null:typeof WebGL2RenderingContext<"u"?"Graphic rendering with WebGL2 has been disabled or is not supported by your graphic card. The map cannot be displayed.":"Your browser does not support graphic rendering with WebGL2. The map cannot be displayed."}function pO(i){const e=fO();if(!e)return;let n=null;if(typeof i=="string"?n=document.getElementById(i):i instanceof HTMLElement&&(n=i),!n)throw new Error("The Map container must be provided.");const o=document.createElement("div");throw o.innerHTML=e,o.classList.add("webgl-warning-div"),n.appendChild(o),new Error(e)}function YT(i,e){return!(!Array.isArray(i)||i.length!==2||i[0]!=="get"||typeof i[1]!="string"||e&&!i[1].startsWith("name:")||!e&&i[1]!=="name")}function mO(i,e,n){const o=structuredClone(i),d=g=>{if(typeof g!="string")for(let _=0;_<g.length;_+=1)YT(g[_],n)?g[_]=structuredClone(e):d(g[_])};return YT(o,n)?e:(d(o),o)}function gO(i,e){const n=e?/\{name:\S+\}/:/\{name\}/;return{contains:n.test(i),exactMatch:new RegExp(`^${n.source}$`).test(i)}}function _O(i,e,n){const o=n?/\{name:\S+\}/:/\{name\}/,d=i.split(o);return["concat",...d.flatMap((g,_)=>_===d.length-1?[g]:[g,e])]}function yO(i){var e;const n=/\{name(?::(?<language>\S+))?\}/g,o=[];for(;;){const d=n.exec(i);if(!d)break;const g=((e=d.groups)==null?void 0:e.language)??null;o.push(g)}return o}function vO(i){return!Array.isArray(i)||i.length!==2||i[0]!=="get"||typeof i[1]!="string"?null:i[1].trim()==="name"?{isLanguage:!0,localization:null}:i[1].trim().startsWith("name:")?{isLanguage:!0,localization:i[1].trim().split(":").pop()}:null}function bO(i){const e=[],n=structuredClone(i),o=d=>{if(typeof d!="string")for(let g=0;g<d.length;g+=1){const _=vO(d[g]);_?e.push(_.localization):o(d[g])}};return o([n]),e}function xO(i,e){const n=[];for(const g of i){if(g.type!=="symbol")continue;const _=g,{id:c,layout:M}=_;if(!M||!("text-field"in M))continue;const k=e.getLayoutProperty(c,"text-field");if(k)if(typeof k=="string"){const j=yO(k);n.push(j)}else{const j=bO(k);n.push(j)}}const o=n.flat(),d={unlocalized:0,localized:{}};for(const g of o)g===null?d.unlocalized+=1:(g in d.localized||(d.localized[g]=0),d.localized[g]+=1);return d}(class extends wn.Marker{addTo(i){return super.addTo(i)}});class aF extends wn.Popup{addTo(e){return super.addTo(e)}}class sF extends wn.Style{constructor(e,n={}){super(e,n)}}class oF extends wn.CanvasSource{onAdd(e){super.onAdd(e)}}class lF extends wn.GeoJSONSource{onAdd(e){super.onAdd(e)}}class uF extends wn.ImageSource{onAdd(e){super.onAdd(e)}}class cF extends wn.RasterTileSource{onAdd(e){super.onAdd(e)}}class hF extends wn.RasterDEMTileSource{onAdd(e){super.onAdd(e)}}class dF extends wn.VectorTileSource{onAdd(e){super.onAdd(e)}}class fF extends wn.VideoSource{onAdd(e){super.onAdd(e)}}class wO extends wn.NavigationControl{onAdd(e){return super.onAdd(e)}}class TO extends wn.GeolocateControl{onAdd(e){return super.onAdd(e)}}class pF extends wn.AttributionControl{onAdd(e){return super.onAdd(e)}}class SO extends wn.LogoControl{onAdd(e){return super.onAdd(e)}}class EO extends wn.ScaleControl{onAdd(e){return super.onAdd(e)}}class AO extends wn.FullscreenControl{onAdd(e){return super.onAdd(e)}}class mF extends wn.TerrainControl{onAdd(e){return super.onAdd(e)}}class gF extends wn.BoxZoomHandler{constructor(e,n){super(e,n)}}class _F extends wn.ScrollZoomHandler{constructor(e,n){super(e,n)}}class yF extends wn.CooperativeGesturesHandler{constructor(e,n){super(e,n)}}class vF extends wn.KeyboardHandler{constructor(e){super(e)}}class bF extends wn.TwoFingersTouchPitchHandler{constructor(e){super(e)}}class xF extends wn.MapWheelEvent{constructor(e,n,o){super(e,n,o)}}class wF extends wn.MapTouchEvent{constructor(e,n,o){super(e,n,o)}}class TF extends wn.MapMouseEvent{constructor(e,n,o,d={}){super(e,n,o,d)}}class QT extends SO{constructor(e={}){super(e),rn(this,"logoURL",""),rn(this,"linkURL",""),this.logoURL=e.logoURL??Ul.maptilerLogoURL,this.linkURL=e.linkURL??Ul.maptilerURL}onAdd(e){this._map=e,this._compact=this.options.compact??!1,this._container=window.document.createElement("div"),this._container.className="maplibregl-ctrl";const n=window.document.createElement("a");return n.style.backgroundRepeat="no-repeat",n.style.cursor="pointer",n.style.display="block",n.style.height="23px",n.style.margin="0 0 -4px -4px",n.style.overflow="hidden",n.style.width="88px",n.style.backgroundImage=`url(${this.logoURL})`,n.style.backgroundSize="100px 30px",n.style.width="100px",n.style.height="30px",n.target="_blank",n.rel="noopener",n.href=this.linkURL,n.setAttribute("aria-label","MapTiler logo"),n.setAttribute("rel","noopener"),this._container.appendChild(n),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}}var CO=8,MO={version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},IO={"*":{type:"source"}},PO=["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],RO={type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},LO={type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},kO={type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},DO={type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},zO={type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},OO={type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},NO={id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},BO=["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],FO={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},VO={"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},jO={"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},UO={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},$O={"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},qO={"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},GO={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},ZO={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},HO={type:"array",value:"*"},XO={type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},WO={type:"enum",values:{Point:{},LineString:{},Polygon:{}}},KO={type:"array",minimum:0,maximum:24,value:["number","color"],length:2},YO={type:"array",value:"*",minimum:1},QO={anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},JO={"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},e6={source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},t6={type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},n6=["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],i6={"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},r6={"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},a6={"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},s6={"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},o6={"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},l6={"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},u6={"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},c6={"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},h6={duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},d6={"*":{type:"string"}},f6={$version:CO,$root:MO,sources:IO,source:PO,source_vector:RO,source_raster:LO,source_raster_dem:kO,source_geojson:DO,source_video:zO,source_image:OO,layer:NO,layout:BO,layout_background:FO,layout_fill:VO,layout_circle:jO,layout_heatmap:UO,"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:$O,layout_symbol:qO,layout_raster:GO,layout_hillshade:ZO,"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:HO,filter_operator:XO,geometry_type:WO,function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:KO,expression:YO,light:QO,sky:JO,terrain:e6,projection:t6,paint:n6,paint_fill:i6,"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:r6,paint_circle:a6,paint_heatmap:s6,paint_symbol:o6,paint_raster:l6,paint_hillshade:u6,"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:c6,transition:h6,"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:d6};class Ht{constructor(e,n,o,d){this.message=(e?`${e}: `:"")+o,d&&(this.identifier=d),n!=null&&n.__line__&&(this.line=n.__line__)}}function p0(i,...e){for(const n of e)for(const o in n)i[o]=n[o];return i}class Bh extends Error{constructor(e,n){super(n),this.message=n,this.key=e}}class pw{constructor(e,n=[]){this.parent=e,this.bindings={};for(const[o,d]of n)this.bindings[o]=d}concat(e){return new pw(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return this.bindings[e]?!0:this.parent?this.parent.has(e):!1}}const q0={kind:"null"},Qt={kind:"number"},yi={kind:"string"},hi={kind:"boolean"},$h={kind:"color"},G0={kind:"projectionDefinition"},Ap={kind:"object"},ui={kind:"value"},p6={kind:"error"},Z0={kind:"collator"},H0={kind:"formatted"},X0={kind:"padding"},H_={kind:"colorArray"},W0={kind:"numberArray"},my={kind:"resolvedImage"},K0={kind:"variableAnchorOffsetCollection"};function Bu(i,e){return{kind:"array",itemType:i,N:e}}function wa(i){if(i.kind==="array"){const e=wa(i.itemType);return typeof i.N=="number"?`array<${e}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${e}>`}else return i.kind}const m6=[q0,Qt,yi,hi,$h,G0,H0,Ap,Bu(ui),X0,W0,H_,my,K0];function X_(i,e){if(e.kind==="error")return null;if(i.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!X_(i.itemType,e.itemType))&&(typeof i.N!="number"||i.N===e.N))return null}else{if(i.kind===e.kind)return null;if(i.kind==="value"){for(const n of m6)if(!X_(n,e))return null}}return`Expected ${wa(i)} but found ${wa(e)} instead.`}function mw(i,e){return e.some(n=>n.kind===i.kind)}function Cp(i,e){return e.some(n=>n==="null"?i===null:n==="array"?Array.isArray(i):n==="object"?i&&!Array.isArray(i)&&typeof i=="object":n===typeof i)}function gf(i,e){return i.kind==="array"&&e.kind==="array"?i.itemType.kind===e.itemType.kind&&typeof i.N=="number":i.kind===e.kind}const JC=.96422,eM=1,tM=.82521,nM=4/29,Zm=6/29,iM=3*Zm*Zm,g6=Zm*Zm*Zm,_6=Math.PI/180,y6=180/Math.PI;function rM(i){return i=i%360,i<0&&(i+=360),i}function aM([i,e,n,o]){i=qb(i),e=qb(e),n=qb(n);let d,g;const _=Gb((.2225045*i+.7168786*e+.0606169*n)/eM);i===e&&e===n?d=g=_:(d=Gb((.4360747*i+.3850649*e+.1430804*n)/JC),g=Gb((.0139322*i+.0971045*e+.7141733*n)/tM));const c=116*_-16;return[c<0?0:c,500*(d-_),200*(_-g),o]}function qb(i){return i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function Gb(i){return i>g6?Math.pow(i,1/3):i/iM+nM}function sM([i,e,n,o]){let d=(i+16)/116,g=isNaN(e)?d:d+e/500,_=isNaN(n)?d:d-n/200;return d=eM*Hb(d),g=JC*Hb(g),_=tM*Hb(_),[Zb(3.1338561*g-1.6168667*d-.4906146*_),Zb(-.9787684*g+1.9161415*d+.033454*_),Zb(.0719453*g-.2289914*d+1.4052427*_),o]}function Zb(i){return i=i<=.00304?12.92*i:1.055*Math.pow(i,1/2.4)-.055,i<0?0:i>1?1:i}function Hb(i){return i>Zm?i*i*i:iM*(i-nM)}function v6(i){const[e,n,o,d]=aM(i),g=Math.sqrt(n*n+o*o);return[Math.round(g*1e4)?rM(Math.atan2(o,n)*y6):NaN,g,e,d]}function b6([i,e,n,o]){return i=isNaN(i)?0:i*_6,sM([n,Math.cos(i)*e,Math.sin(i)*e,o])}function x6([i,e,n,o]){i=rM(i),e/=100,n/=100;function d(g){const _=(g+i/30)%12,c=e*Math.min(n,1-n);return n-c*Math.max(-1,Math.min(_-3,9-_,1))}return[d(0),d(8),d(4),o]}const w6=Object.hasOwn||function(i,e){return Object.prototype.hasOwnProperty.call(i,e)};function L_(i,e){return w6(i,e)?i[e]:void 0}function T6(i){if(i=i.toLowerCase().trim(),i==="transparent")return[0,0,0,0];const e=L_(S6,i);if(e){const[d,g,_]=e;return[d/255,g/255,_/255,1]}if(i.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(i)){const d=i.length<6?1:2;let g=1;return[bv(i.slice(g,g+=d)),bv(i.slice(g,g+=d)),bv(i.slice(g,g+=d)),bv(i.slice(g,g+d)||"ff")]}if(i.startsWith("rgb")){const d=/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/,g=i.match(d);if(g){const[_,c,M,k,j,G,ee,Y,xe,be,Ne,tt]=g,Je=[k||" ",ee||" ",be].join("");if(Je==="  "||Je==="  /"||Je===",,"||Je===",,,"){const qe=[M,G,xe].join(""),He=qe==="%%%"?100:qe===""?255:0;if(He){const Ue=[Nm(+c/He,0,1),Nm(+j/He,0,1),Nm(+Y/He,0,1),Ne?JT(+Ne,tt):1];if(eS(Ue))return Ue}}return}}const n=/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/,o=i.match(n);if(o){const[d,g,_,c,M,k,j,G,ee]=o,Y=[_||" ",M||" ",j].join("");if(Y==="  "||Y==="  /"||Y===",,"||Y===",,,"){const xe=[+g,Nm(+c,0,100),Nm(+k,0,100),G?JT(+G,ee):1];if(eS(xe))return x6(xe)}}}function bv(i){return parseInt(i.padEnd(2,i),16)/255}function JT(i,e){return Nm(e?i/100:i,0,1)}function Nm(i,e,n){return Math.min(Math.max(e,i),n)}function eS(i){return!i.some(Number.isNaN)}const S6={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function Mp(i,e,n){return i+n*(e-i)}function W_(i,e,n){return i.map((o,d)=>Mp(o,e[d],n))}class Er{constructor(e,n,o,d=1,g=!0){this.r=e,this.g=n,this.b=o,this.a=d,g||(this.r*=d,this.g*=d,this.b*=d,d||this.overwriteGetter("rgb",[e,n,o,d]))}static parse(e){if(e instanceof Er)return e;if(typeof e!="string")return;const n=T6(e);if(n)return new Er(...n,!1)}get rgb(){const{r:e,g:n,b:o,a:d}=this,g=d||1/0;return this.overwriteGetter("rgb",[e/g,n/g,o/g,d])}get hcl(){return this.overwriteGetter("hcl",v6(this.rgb))}get lab(){return this.overwriteGetter("lab",aM(this.rgb))}overwriteGetter(e,n){return Object.defineProperty(this,e,{value:n}),n}toString(){const[e,n,o,d]=this.rgb;return`rgba(${[e,n,o].map(g=>Math.round(g*255)).join(",")},${d})`}static interpolate(e,n,o,d="rgb"){switch(d){case"rgb":{const[g,_,c,M]=W_(e.rgb,n.rgb,o);return new Er(g,_,c,M,!1)}case"hcl":{const[g,_,c,M]=e.hcl,[k,j,G,ee]=n.hcl;let Y,xe;if(!isNaN(g)&&!isNaN(k)){let qe=k-g;k>g&&qe>180?qe-=360:k<g&&g-k>180&&(qe+=360),Y=g+o*qe}else isNaN(g)?isNaN(k)?Y=NaN:(Y=k,(c===1||c===0)&&(xe=j)):(Y=g,(G===1||G===0)&&(xe=_));const[be,Ne,tt,Je]=b6([Y,xe??Mp(_,j,o),Mp(c,G,o),Mp(M,ee,o)]);return new Er(be,Ne,tt,Je,!1)}case"lab":{const[g,_,c,M]=sM(W_(e.lab,n.lab,o));return new Er(g,_,c,M,!1)}}}}Er.black=new Er(0,0,0,1);Er.white=new Er(1,1,1,1);Er.transparent=new Er(0,0,0,0);Er.red=new Er(1,0,0,1);class gw{constructor(e,n,o){e?this.sensitivity=n?"variant":"case":this.sensitivity=n?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,n){return this.collator.compare(e,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const E6=["bottom","center","top"];class Gx{constructor(e,n,o,d,g,_){this.text=e,this.image=n,this.scale=o,this.fontStack=d,this.textColor=g,this.verticalAlign=_}}class kd{constructor(e){this.sections=e}static fromString(e){return new kd([new Gx(e,null,null,null,null,null)])}isEmpty(){return this.sections.length===0?!0:!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof kd?e:kd.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}}class ih{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof ih)return e;if(typeof e=="number")return new ih([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const n of e)if(typeof n!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]];break}return new ih(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,n,o){return new ih(W_(e.values,n.values,o))}}class rh{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof rh)return e;if(typeof e=="number")return new rh([e]);if(Array.isArray(e)){for(const n of e)if(typeof n!="number")return;return new rh(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,n,o){return new rh(W_(e.values,n.values,o))}}class Fu{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Fu)return e;if(typeof e=="string"){const o=Er.parse(e);return o?new Fu([o]):void 0}if(!Array.isArray(e))return;const n=[];for(const o of e){if(typeof o!="string")return;const d=Er.parse(o);if(!d)return;n.push(d)}return new Fu(n)}toString(){return JSON.stringify(this.values)}static interpolate(e,n,o,d="rgb"){const g=[];if(e.values.length!=n.values.length)throw new Error(`colorArray: Arrays have mismatched length (${e.values.length} vs. ${n.values.length}), cannot interpolate.`);for(let _=0;_<e.values.length;_++)g.push(Er.interpolate(e.values[_],n.values[_],o,d));return new Fu(g)}}class Na extends Error{constructor(e){super(e),this.name="RuntimeError"}toJSON(){return this.message}}const A6=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class qh{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof qh)return e;if(!(!Array.isArray(e)||e.length<1||e.length%2!==0)){for(let n=0;n<e.length;n+=2){const o=e[n],d=e[n+1];if(typeof o!="string"||!A6.has(o)||!Array.isArray(d)||d.length!==2||typeof d[0]!="number"||typeof d[1]!="number")return}return new qh(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,n,o){const d=e.values,g=n.values;if(d.length!==g.length)throw new Na(`Cannot interpolate values of different length. from: ${e.toString()}, to: ${n.toString()}`);const _=[];for(let c=0;c<d.length;c+=2){if(d[c]!==g[c])throw new Na(`Cannot interpolate values containing mismatched anchors. from[${c}]: ${d[c]}, to[${c}]: ${g[c]}`);_.push(d[c]);const[M,k]=d[c+1],[j,G]=g[c+1];_.push([Mp(M,j,o),Mp(k,G,o)])}return new qh(_)}}class Df{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Df({name:e,available:!1}):null}}class eh{constructor(e,n,o){this.from=e,this.to=n,this.transition=o}static interpolate(e,n,o){return new eh(e,n,o)}static parse(e){if(e instanceof eh)return e;if(Array.isArray(e)&&e.length===3&&typeof e[0]=="string"&&typeof e[1]=="string"&&typeof e[2]=="number")return new eh(e[0],e[1],e[2]);if(typeof e=="object"&&typeof e.from=="string"&&typeof e.to=="string"&&typeof e.transition=="number")return new eh(e.from,e.to,e.transition);if(typeof e=="string")return new eh(e,e,1)}}function oM(i,e,n,o){return typeof i=="number"&&i>=0&&i<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof n=="number"&&n>=0&&n<=255?typeof o>"u"||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[i,e,n,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[i,e,n,o]:[i,e,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function K_(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof eh||i instanceof Er||i instanceof gw||i instanceof kd||i instanceof ih||i instanceof rh||i instanceof Fu||i instanceof qh||i instanceof Df)return!0;if(Array.isArray(i)){for(const e of i)if(!K_(e))return!1;return!0}else if(typeof i=="object"){for(const e in i)if(!K_(i[e]))return!1;return!0}else return!1}function Os(i){if(i===null)return q0;if(typeof i=="string")return yi;if(typeof i=="boolean")return hi;if(typeof i=="number")return Qt;if(i instanceof Er)return $h;if(i instanceof eh)return G0;if(i instanceof gw)return Z0;if(i instanceof kd)return H0;if(i instanceof ih)return X0;if(i instanceof rh)return W0;if(i instanceof Fu)return H_;if(i instanceof qh)return K0;if(i instanceof Df)return my;if(Array.isArray(i)){const e=i.length;let n;for(const o of i){const d=Os(o);if(!n)n=d;else{if(n===d)continue;n=ui;break}}return Bu(n||ui,e)}else return Ap}function k_(i){const e=typeof i;return i===null?"":e==="string"||e==="number"||e==="boolean"?String(i):i instanceof Er||i instanceof eh||i instanceof kd||i instanceof ih||i instanceof rh||i instanceof Fu||i instanceof qh||i instanceof Df?i.toString():JSON.stringify(i)}class Jm{constructor(e,n){this.type=e,this.value=n}static parse(e,n){if(e.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!K_(e[1]))return n.error("invalid value");const o=e[1];let d=Os(o);const g=n.expectedType;return d.kind==="array"&&d.N===0&&g&&g.kind==="array"&&(typeof g.N!="number"||g.N===0)&&(d=g),new Jm(d,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const xv={string:yi,number:Qt,boolean:hi,object:Ap};class th{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let o=1,d;const g=e[0];if(g==="array"){let c;if(e.length>2){const k=e[1];if(typeof k!="string"||!(k in xv)||k==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);c=xv[k],o++}else c=ui;let M;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return n.error('The length argument to "array" must be a positive integer literal',2);M=e[2],o++}d=Bu(c,M)}else{if(!xv[g])throw new Error(`Types doesn't contain name = ${g}`);d=xv[g]}const _=[];for(;o<e.length;o++){const c=n.parse(e[o],o,ui);if(!c)return null;_.push(c)}return new th(d,_)}evaluate(e){for(let n=0;n<this.args.length;n++){const o=this.args[n].evaluate(e);if(X_(this.type,Os(o))){if(n===this.args.length-1)throw new Na(`Expected value to be of type ${wa(this.type)}, but found ${wa(Os(o))} instead.`)}else return o}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const tS={"to-boolean":hi,"to-color":$h,"to-number":Qt,"to-string":yi};class vf{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const o=e[0];if(!tS[o])throw new Error(`Can't parse ${o} as it is not part of the known types`);if((o==="to-boolean"||o==="to-string")&&e.length!==2)return n.error("Expected one argument.");const d=tS[o],g=[];for(let _=1;_<e.length;_++){const c=n.parse(e[_],_,ui);if(!c)return null;g.push(c)}return new vf(d,g)}evaluate(e){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(e);case"color":{let n,o;for(const d of this.args){if(n=d.evaluate(e),o=null,n instanceof Er)return n;if(typeof n=="string"){const g=e.parseColor(n);if(g)return g}else if(Array.isArray(n)&&(n.length<3||n.length>4?o=`Invalid rgba value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:o=oM(n[0],n[1],n[2],n[3]),!o))return new Er(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new Na(o||`Could not parse color from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"padding":{let n;for(const o of this.args){n=o.evaluate(e);const d=ih.parse(n);if(d)return d}throw new Na(`Could not parse padding from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"numberArray":{let n;for(const o of this.args){n=o.evaluate(e);const d=rh.parse(n);if(d)return d}throw new Na(`Could not parse numberArray from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"colorArray":{let n;for(const o of this.args){n=o.evaluate(e);const d=Fu.parse(n);if(d)return d}throw new Na(`Could not parse colorArray from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"variableAnchorOffsetCollection":{let n;for(const o of this.args){n=o.evaluate(e);const d=qh.parse(n);if(d)return d}throw new Na(`Could not parse variableAnchorOffsetCollection from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"number":{let n=null;for(const o of this.args){if(n=o.evaluate(e),n===null)return 0;const d=Number(n);if(!isNaN(d))return d}throw new Na(`Could not convert ${JSON.stringify(n)} to number.`)}case"formatted":return kd.fromString(k_(this.args[0].evaluate(e)));case"resolvedImage":return Df.fromString(k_(this.args[0].evaluate(e)));case"projectionDefinition":return this.args[0].evaluate(e);default:return k_(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const C6=["Unknown","Point","LineString","Polygon"];class lM{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?C6[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let n=this._parseColorCache.get(e);return n||(n=Er.parse(e),this._parseColorCache.set(e,n)),n}}class Y0{constructor(e,n,o=[],d,g=new pw,_=[]){this.registry=e,this.path=o,this.key=o.map(c=>`[${c}]`).join(""),this.scope=g,this.errors=_,this.expectedType=d,this._isConstant=n}parse(e,n,o,d,g={}){return n?this.concat(n,o,d)._parse(e,g):this._parse(e,g)}_parse(e,n){(e===null||typeof e=="string"||typeof e=="boolean"||typeof e=="number")&&(e=["literal",e]);function o(d,g,_){return _==="assert"?new th(g,[d]):_==="coerce"?new vf(g,[d]):d}if(Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const d=e[0];if(typeof d!="string")return this.error(`Expression name must be a string, but found ${typeof d} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const g=this.registry[d];if(g){let _=g.parse(e,this);if(!_)return null;if(this.expectedType){const c=this.expectedType,M=_.type;if((c.kind==="string"||c.kind==="number"||c.kind==="boolean"||c.kind==="object"||c.kind==="array")&&M.kind==="value")_=o(_,c,n.typeAnnotation||"assert");else if(c.kind==="projectionDefinition"&&["string","array"].includes(M.kind)||["color","formatted","resolvedImage"].includes(c.kind)&&["value","string"].includes(M.kind)||["padding","numberArray"].includes(c.kind)&&["value","number","array"].includes(M.kind)||c.kind==="colorArray"&&["value","string","array"].includes(M.kind)||c.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(M.kind))_=o(_,c,n.typeAnnotation||"coerce");else if(this.checkSubtype(c,M))return null}if(!(_ instanceof Jm)&&_.type.kind!=="resolvedImage"&&this._isConstant(_)){const c=new lM;try{_=new Jm(_.type,_.evaluate(c))}catch(M){return this.error(M.message),null}}return _}return this.error(`Unknown expression "${d}". If you wanted a literal array, use ["literal", [...]].`,0)}else return typeof e>"u"?this.error("'undefined' value invalid. Use null instead."):typeof e=="object"?this.error('Bare objects invalid. Use ["literal", {...}] instead.'):this.error(`Expected an array, but found ${typeof e} instead.`)}concat(e,n,o){const d=typeof e=="number"?this.path.concat(e):this.path,g=o?this.scope.concat(o):this.scope;return new Y0(this.registry,this._isConstant,d,n||null,g,this.errors)}error(e,...n){const o=`${this.key}${n.map(d=>`[${d}]`).join("")}`;this.errors.push(new Bh(o,e))}checkSubtype(e,n){const o=X_(e,n);return o&&this.error(o),o}}class Q0{constructor(e,n){this.type=n.type,this.bindings=[].concat(e),this.result=n}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const n of this.bindings)e(n[1]);e(this.result)}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const o=[];for(let g=1;g<e.length-1;g+=2){const _=e[g];if(typeof _!="string")return n.error(`Expected string, but found ${typeof _} instead.`,g);if(/[^a-zA-Z0-9_]/.test(_))return n.error("Variable names must contain only alphanumeric characters or '_'.",g);const c=n.parse(e[g+1],g+1);if(!c)return null;o.push([_,c])}const d=n.parse(e[e.length-1],e.length-1,n.expectedType,o);return d?new Q0(o,d):null}outputDefined(){return this.result.outputDefined()}}class J0{constructor(e,n){this.type=n.type,this.name=e,this.boundExpression=n}static parse(e,n){if(e.length!==2||typeof e[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");const o=e[1];return n.scope.has(o)?new J0(o,n.scope.get(o)):n.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class _w{constructor(e,n,o){this.type=e,this.index=n,this.input=o}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=n.parse(e[1],1,Qt),d=n.parse(e[2],2,Bu(n.expectedType||ui));if(!o||!d)return null;const g=d.type;return new _w(g.itemType,o,d)}evaluate(e){const n=this.index.evaluate(e),o=this.input.evaluate(e);if(n<0)throw new Na(`Array index out of bounds: ${n} < 0.`);if(n>=o.length)throw new Na(`Array index out of bounds: ${n} > ${o.length-1}.`);if(n!==Math.floor(n))throw new Na(`Array index must be an integer, but found ${n} instead.`);return o[n]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class yw{constructor(e,n){this.type=hi,this.needle=e,this.haystack=n}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=n.parse(e[1],1,ui),d=n.parse(e[2],2,ui);return!o||!d?null:mw(o.type,[hi,yi,Qt,q0,ui])?new yw(o,d):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${wa(o.type)} instead`)}evaluate(e){const n=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!o)return!1;if(!Cp(n,["boolean","string","number","null"]))throw new Na(`Expected first argument to be of type boolean, string, number or null, but found ${wa(Os(n))} instead.`);if(!Cp(o,["string","array"]))throw new Na(`Expected second argument to be of type array or string, but found ${wa(Os(o))} instead.`);return o.indexOf(n)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class m0{constructor(e,n,o){this.type=Qt,this.needle=e,this.haystack=n,this.fromIndex=o}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const o=n.parse(e[1],1,ui),d=n.parse(e[2],2,ui);if(!o||!d)return null;if(!mw(o.type,[hi,yi,Qt,q0,ui]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${wa(o.type)} instead`);if(e.length===4){const g=n.parse(e[3],3,Qt);return g?new m0(o,d,g):null}else return new m0(o,d)}evaluate(e){const n=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!Cp(n,["boolean","string","number","null"]))throw new Na(`Expected first argument to be of type boolean, string, number or null, but found ${wa(Os(n))} instead.`);let d;if(this.fromIndex&&(d=this.fromIndex.evaluate(e)),Cp(o,["string"])){const g=o.indexOf(n,d);return g===-1?-1:[...o.slice(0,g)].length}else{if(Cp(o,["array"]))return o.indexOf(n,d);throw new Na(`Expected second argument to be of type array or string, but found ${wa(Os(o))} instead.`)}}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class vw{constructor(e,n,o,d,g,_){this.inputType=e,this.type=n,this.input=o,this.cases=d,this.outputs=g,this.otherwise=_}static parse(e,n){if(e.length<5)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!==1)return n.error("Expected an even number of arguments.");let o,d;n.expectedType&&n.expectedType.kind!=="value"&&(d=n.expectedType);const g={},_=[];for(let k=2;k<e.length-1;k+=2){let j=e[k];const G=e[k+1];Array.isArray(j)||(j=[j]);const ee=n.concat(k);if(j.length===0)return ee.error("Expected at least one branch label.");for(const xe of j){if(typeof xe!="number"&&typeof xe!="string")return ee.error("Branch labels must be numbers or strings.");if(typeof xe=="number"&&Math.abs(xe)>Number.MAX_SAFE_INTEGER)return ee.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof xe=="number"&&Math.floor(xe)!==xe)return ee.error("Numeric branch labels must be integer values.");if(!o)o=Os(xe);else if(ee.checkSubtype(o,Os(xe)))return null;if(typeof g[String(xe)]<"u")return ee.error("Branch labels must be unique.");g[String(xe)]=_.length}const Y=n.parse(G,k,d);if(!Y)return null;d=d||Y.type,_.push(Y)}const c=n.parse(e[1],1,ui);if(!c)return null;const M=n.parse(e[e.length-1],e.length-1,d);return!M||c.type.kind!=="value"&&n.concat(1).checkSubtype(o,c.type)?null:new vw(o,d,c,g,_,M)}evaluate(e){const n=this.input.evaluate(e);return(Os(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}}class bw{constructor(e,n,o){this.type=e,this.branches=n,this.otherwise=o}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!==0)return n.error("Expected an odd number of arguments.");let o;n.expectedType&&n.expectedType.kind!=="value"&&(o=n.expectedType);const d=[];for(let _=1;_<e.length-1;_+=2){const c=n.parse(e[_],_,hi);if(!c)return null;const M=n.parse(e[_+1],_+1,o);if(!M)return null;d.push([c,M]),o=o||M.type}const g=n.parse(e[e.length-1],e.length-1,o);if(!g)return null;if(!o)throw new Error("Can't infer output type");return new bw(o,d,g)}evaluate(e){for(const[n,o]of this.branches)if(n.evaluate(e))return o.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[n,o]of this.branches)e(n),e(o);e(this.otherwise)}outputDefined(){return this.branches.every(([e,n])=>n.outputDefined())&&this.otherwise.outputDefined()}}class g0{constructor(e,n,o,d){this.type=e,this.input=n,this.beginIndex=o,this.endIndex=d}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const o=n.parse(e[1],1,ui),d=n.parse(e[2],2,Qt);if(!o||!d)return null;if(!mw(o.type,[Bu(ui),yi,ui]))return n.error(`Expected first argument to be of type array or string, but found ${wa(o.type)} instead`);if(e.length===4){const g=n.parse(e[3],3,Qt);return g?new g0(o.type,o,d,g):null}else return new g0(o.type,o,d)}evaluate(e){const n=this.input.evaluate(e),o=this.beginIndex.evaluate(e);let d;if(this.endIndex&&(d=this.endIndex.evaluate(e)),Cp(n,["string"]))return[...n].slice(o,d).join("");if(Cp(n,["array"]))return n.slice(o,d);throw new Na(`Expected first argument to be of type array or string, but found ${wa(Os(n))} instead.`)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function uM(i,e){const n=i.length-1;let o=0,d=n,g=0,_,c;for(;o<=d;)if(g=Math.floor((o+d)/2),_=i[g],c=i[g+1],_<=e){if(g===n||e<c)return g;o=g+1}else if(_>e)d=g-1;else throw new Na("Input is not a number.");return 0}class eb{constructor(e,n,o){this.type=e,this.input=n,this.labels=[],this.outputs=[];for(const[d,g]of o)this.labels.push(d),this.outputs.push(g)}static parse(e,n){if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!==0)return n.error("Expected an even number of arguments.");const o=n.parse(e[1],1,Qt);if(!o)return null;const d=[];let g=null;n.expectedType&&n.expectedType.kind!=="value"&&(g=n.expectedType);for(let _=1;_<e.length;_+=2){const c=_===1?-1/0:e[_],M=e[_+1],k=_,j=_+1;if(typeof c!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',k);if(d.length&&d[d.length-1][0]>=c)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',k);const G=n.parse(M,j,g);if(!G)return null;g=g||G.type,d.push([c,G])}return new eb(g,o,d)}evaluate(e){const n=this.labels,o=this.outputs;if(n.length===1)return o[0].evaluate(e);const d=this.input.evaluate(e);if(d<=n[0])return o[0].evaluate(e);const g=n.length;if(d>=n[g-1])return o[g-1].evaluate(e);const _=uM(n,d);return o[_].evaluate(e)}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function M6(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Xb,nS;function I6(){if(nS)return Xb;nS=1,Xb=i;function i(e,n,o,d){this.cx=3*e,this.bx=3*(o-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(d-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=n,this.p2x=o,this.p2y=d}return i.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,n){if(n===void 0&&(n=1e-6),e<0)return 0;if(e>1)return 1;for(var o=e,d=0;d<8;d++){var g=this.sampleCurveX(o)-e;if(Math.abs(g)<n)return o;var _=this.sampleCurveDerivativeX(o);if(Math.abs(_)<1e-6)break;o=o-g/_}var c=0,M=1;for(o=e,d=0;d<20&&(g=this.sampleCurveX(o),!(Math.abs(g-e)<n));d++)e>g?c=o:M=o,o=(M-c)*.5+c;return o},solve:function(e,n){return this.sampleCurveY(this.solveCurveX(e,n))}},Xb}var P6=I6(),R6=M6(P6);class Gh{constructor(e,n,o,d,g){this.type=e,this.operator=n,this.interpolation=o,this.input=d,this.labels=[],this.outputs=[];for(const[_,c]of g)this.labels.push(_),this.outputs.push(c)}static interpolationFactor(e,n,o,d){let g=0;if(e.name==="exponential")g=Wb(n,e.base,o,d);else if(e.name==="linear")g=Wb(n,1,o,d);else if(e.name==="cubic-bezier"){const _=e.controlPoints;g=new R6(_[0],_[1],_[2],_[3]).solve(Wb(n,1,o,d))}return g}static parse(e,n){let[o,d,g,..._]=e;if(!Array.isArray(d)||d.length===0)return n.error("Expected an interpolation type expression.",1);if(d[0]==="linear")d={name:"linear"};else if(d[0]==="exponential"){const k=d[1];if(typeof k!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);d={name:"exponential",base:k}}else if(d[0]==="cubic-bezier"){const k=d.slice(1);if(k.length!==4||k.some(j=>typeof j!="number"||j<0||j>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);d={name:"cubic-bezier",controlPoints:k}}else return n.error(`Unknown interpolation type ${String(d[0])}`,1,0);if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!==0)return n.error("Expected an even number of arguments.");if(g=n.parse(g,2,Qt),!g)return null;const c=[];let M=null;(o==="interpolate-hcl"||o==="interpolate-lab")&&n.expectedType!=H_?M=$h:n.expectedType&&n.expectedType.kind!=="value"&&(M=n.expectedType);for(let k=0;k<_.length;k+=2){const j=_[k],G=_[k+1],ee=k+3,Y=k+4;if(typeof j!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',ee);if(c.length&&c[c.length-1][0]>=j)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',ee);const xe=n.parse(G,Y,M);if(!xe)return null;M=M||xe.type,c.push([j,xe])}return!gf(M,Qt)&&!gf(M,G0)&&!gf(M,$h)&&!gf(M,X0)&&!gf(M,W0)&&!gf(M,H_)&&!gf(M,K0)&&!gf(M,Bu(Qt))?n.error(`Type ${wa(M)} is not interpolatable.`):new Gh(M,o,d,g,c)}evaluate(e){const n=this.labels,o=this.outputs;if(n.length===1)return o[0].evaluate(e);const d=this.input.evaluate(e);if(d<=n[0])return o[0].evaluate(e);const g=n.length;if(d>=n[g-1])return o[g-1].evaluate(e);const _=uM(n,d),c=n[_],M=n[_+1],k=Gh.interpolationFactor(this.interpolation,d,c,M),j=o[_].evaluate(e),G=o[_+1].evaluate(e);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return Mp(j,G,k);case"color":return Er.interpolate(j,G,k);case"padding":return ih.interpolate(j,G,k);case"colorArray":return Fu.interpolate(j,G,k);case"numberArray":return rh.interpolate(j,G,k);case"variableAnchorOffsetCollection":return qh.interpolate(j,G,k);case"array":return W_(j,G,k);case"projectionDefinition":return eh.interpolate(j,G,k)}case"interpolate-hcl":switch(this.type.kind){case"color":return Er.interpolate(j,G,k,"hcl");case"colorArray":return Fu.interpolate(j,G,k,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return Er.interpolate(j,G,k,"lab");case"colorArray":return Fu.interpolate(j,G,k,"lab")}}}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function Wb(i,e,n,o){const d=o-n,g=i-n;return d===0?0:e===1?g/d:(Math.pow(e,g)-1)/(Math.pow(e,d)-1)}class Y_{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let o=null;const d=n.expectedType;d&&d.kind!=="value"&&(o=d);const g=[];for(const _ of e.slice(1)){const c=n.parse(_,1+g.length,o,void 0,{typeAnnotation:"omit"});if(!c)return null;o=o||c.type,g.push(c)}if(!o)throw new Error("No output type");return d&&g.some(_=>X_(d,_.type))?new Y_(ui,g):new Y_(o,g)}evaluate(e){let n=null,o=0,d;for(const g of this.args)if(o++,n=g.evaluate(e),n&&n instanceof Df&&!n.available&&(d||(d=n.name),n=null,o===this.args.length&&(n=d)),n!==null)break;return n}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}function iS(i,e){return i==="=="||i==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function L6(i,e,n){return e===n}function k6(i,e,n){return e!==n}function D6(i,e,n){return e<n}function z6(i,e,n){return e>n}function O6(i,e,n){return e<=n}function N6(i,e,n){return e>=n}function cM(i,e,n,o){return o.compare(e,n)===0}function B6(i,e,n,o){return!cM(i,e,n,o)}function F6(i,e,n,o){return o.compare(e,n)<0}function V6(i,e,n,o){return o.compare(e,n)>0}function j6(i,e,n,o){return o.compare(e,n)<=0}function U6(i,e,n,o){return o.compare(e,n)>=0}function ug(i,e,n){const o=i!=="=="&&i!=="!=";return class hM{constructor(g,_,c){this.type=hi,this.lhs=g,this.rhs=_,this.collator=c,this.hasUntypedArgument=g.type.kind==="value"||_.type.kind==="value"}static parse(g,_){if(g.length!==3&&g.length!==4)return _.error("Expected two or three arguments.");const c=g[0];let M=_.parse(g[1],1,ui);if(!M)return null;if(!iS(c,M.type))return _.concat(1).error(`"${c}" comparisons are not supported for type '${wa(M.type)}'.`);let k=_.parse(g[2],2,ui);if(!k)return null;if(!iS(c,k.type))return _.concat(2).error(`"${c}" comparisons are not supported for type '${wa(k.type)}'.`);if(M.type.kind!==k.type.kind&&M.type.kind!=="value"&&k.type.kind!=="value")return _.error(`Cannot compare types '${wa(M.type)}' and '${wa(k.type)}'.`);o&&(M.type.kind==="value"&&k.type.kind!=="value"?M=new th(k.type,[M]):M.type.kind!=="value"&&k.type.kind==="value"&&(k=new th(M.type,[k])));let j=null;if(g.length===4){if(M.type.kind!=="string"&&k.type.kind!=="string"&&M.type.kind!=="value"&&k.type.kind!=="value")return _.error("Cannot use collator to compare non-string types.");if(j=_.parse(g[3],3,Z0),!j)return null}return new hM(M,k,j)}evaluate(g){const _=this.lhs.evaluate(g),c=this.rhs.evaluate(g);if(o&&this.hasUntypedArgument){const M=Os(_),k=Os(c);if(M.kind!==k.kind||!(M.kind==="string"||M.kind==="number"))throw new Na(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${M.kind}, ${k.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const M=Os(_),k=Os(c);if(M.kind!=="string"||k.kind!=="string")return e(g,_,c)}return this.collator?n(g,_,c,this.collator.evaluate(g)):e(g,_,c)}eachChild(g){g(this.lhs),g(this.rhs),this.collator&&g(this.collator)}outputDefined(){return!0}}}const $6=ug("==",L6,cM),q6=ug("!=",k6,B6),G6=ug("<",D6,F6),Z6=ug(">",z6,V6),H6=ug("<=",O6,j6),X6=ug(">=",N6,U6);class tb{constructor(e,n,o){this.type=Z0,this.locale=o,this.caseSensitive=e,this.diacriticSensitive=n}static parse(e,n){if(e.length!==2)return n.error("Expected one argument.");const o=e[1];if(typeof o!="object"||Array.isArray(o))return n.error("Collator options argument must be an object.");const d=n.parse(o["case-sensitive"]===void 0?!1:o["case-sensitive"],1,hi);if(!d)return null;const g=n.parse(o["diacritic-sensitive"]===void 0?!1:o["diacritic-sensitive"],1,hi);if(!g)return null;let _=null;return o.locale&&(_=n.parse(o.locale,1,yi),!_)?null:new tb(d,g,_)}evaluate(e){return new gw(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}class xw{constructor(e,n,o,d,g){this.type=yi,this.number=e,this.locale=n,this.currency=o,this.minFractionDigits=d,this.maxFractionDigits=g}static parse(e,n){if(e.length!==3)return n.error("Expected two arguments.");const o=n.parse(e[1],1,Qt);if(!o)return null;const d=e[2];if(typeof d!="object"||Array.isArray(d))return n.error("NumberFormat options argument must be an object.");let g=null;if(d.locale&&(g=n.parse(d.locale,1,yi),!g))return null;let _=null;if(d.currency&&(_=n.parse(d.currency,1,yi),!_))return null;let c=null;if(d["min-fraction-digits"]&&(c=n.parse(d["min-fraction-digits"],1,Qt),!c))return null;let M=null;return d["max-fraction-digits"]&&(M=n.parse(d["max-fraction-digits"],1,Qt),!M)?null:new xw(o,g,_,c,M)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class ww{constructor(e){this.type=H0,this.sections=e}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const o=e[1];if(!Array.isArray(o)&&typeof o=="object")return n.error("First argument must be an image or text section.");const d=[];let g=!1;for(let _=1;_<=e.length-1;++_){const c=e[_];if(g&&typeof c=="object"&&!Array.isArray(c)){g=!1;let M=null;if(c["font-scale"]&&(M=n.parse(c["font-scale"],1,Qt),!M))return null;let k=null;if(c["text-font"]&&(k=n.parse(c["text-font"],1,Bu(yi)),!k))return null;let j=null;if(c["text-color"]&&(j=n.parse(c["text-color"],1,$h),!j))return null;let G=null;if(c["vertical-align"]){if(typeof c["vertical-align"]=="string"&&!E6.includes(c["vertical-align"]))return n.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${c["vertical-align"]}' instead.`);if(G=n.parse(c["vertical-align"],1,yi),!G)return null}const ee=d[d.length-1];ee.scale=M,ee.font=k,ee.textColor=j,ee.verticalAlign=G}else{const M=n.parse(e[_],1,ui);if(!M)return null;const k=M.type.kind;if(k!=="string"&&k!=="value"&&k!=="null"&&k!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");g=!0,d.push({content:M,scale:null,font:null,textColor:null,verticalAlign:null})}}return new ww(d)}evaluate(e){const n=o=>{const d=o.content.evaluate(e);return Os(d)===my?new Gx("",d,null,null,null,o.verticalAlign?o.verticalAlign.evaluate(e):null):new Gx(k_(d),null,o.scale?o.scale.evaluate(e):null,o.font?o.font.evaluate(e).join(","):null,o.textColor?o.textColor.evaluate(e):null,o.verticalAlign?o.verticalAlign.evaluate(e):null)};return new kd(this.sections.map(n))}eachChild(e){for(const n of this.sections)e(n.content),n.scale&&e(n.scale),n.font&&e(n.font),n.textColor&&e(n.textColor),n.verticalAlign&&e(n.verticalAlign)}outputDefined(){return!1}}class Tw{constructor(e){this.type=my,this.input=e}static parse(e,n){if(e.length!==2)return n.error("Expected two arguments.");const o=n.parse(e[1],1,yi);return o?new Tw(o):n.error("No image name provided.")}evaluate(e){const n=this.input.evaluate(e),o=Df.fromString(n);return o&&e.availableImages&&(o.available=e.availableImages.indexOf(n)>-1),o}eachChild(e){e(this.input)}outputDefined(){return!1}}class Sw{constructor(e){this.type=Qt,this.input=e}static parse(e,n){if(e.length!==2)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);const o=n.parse(e[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${wa(o.type)} instead.`):new Sw(o):null}evaluate(e){const n=this.input.evaluate(e);if(typeof n=="string")return[...n].length;if(Array.isArray(n))return n.length;throw new Na(`Expected value to be of type string or array, but found ${wa(Os(n))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const Zh=8192;function W6(i,e){const n=K6(i[0]),o=Q6(i[1]),d=Math.pow(2,e.z);return[Math.round(n*d*Zh),Math.round(o*d*Zh)]}function Ew(i,e){const n=Math.pow(2,e.z),o=(i[0]/Zh+e.x)/n,d=(i[1]/Zh+e.y)/n;return[Y6(o),J6(d)]}function K6(i){return(180+i)/360}function Y6(i){return i*360-180}function Q6(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function J6(i){return 360/Math.PI*Math.atan(Math.exp((180-i*360)*Math.PI/180))-90}function gy(i,e){i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),i[2]=Math.max(i[2],e[0]),i[3]=Math.max(i[3],e[1])}function Q_(i,e){return!(i[0]<=e[0]||i[2]>=e[2]||i[1]<=e[1]||i[3]>=e[3])}function eN(i,e,n){return e[1]>i[1]!=n[1]>i[1]&&i[0]<(n[0]-e[0])*(i[1]-e[1])/(n[1]-e[1])+e[0]}function tN(i,e,n){const o=i[0]-e[0],d=i[1]-e[1],g=i[0]-n[0],_=i[1]-n[1];return o*_-g*d===0&&o*g<=0&&d*_<=0}function nb(i,e,n,o){const d=[e[0]-i[0],e[1]-i[1]],g=[o[0]-n[0],o[1]-n[1]];return aN(g,d)===0?!1:!!(rS(i,e,n,o)&&rS(n,o,i,e))}function nN(i,e,n){for(const o of n)for(let d=0;d<o.length-1;++d)if(nb(i,e,o[d],o[d+1]))return!0;return!1}function cg(i,e,n=!1){let o=!1;for(const d of e)for(let g=0;g<d.length-1;g++){if(tN(i,d[g],d[g+1]))return n;eN(i,d[g],d[g+1])&&(o=!o)}return o}function iN(i,e){for(const n of e)if(cg(i,n))return!0;return!1}function dM(i,e){for(const n of i)if(!cg(n,e))return!1;for(let n=0;n<i.length-1;++n)if(nN(i[n],i[n+1],e))return!1;return!0}function rN(i,e){for(const n of e)if(dM(i,n))return!0;return!1}function aN(i,e){return i[0]*e[1]-i[1]*e[0]}function rS(i,e,n,o){const d=i[0]-n[0],g=i[1]-n[1],_=e[0]-n[0],c=e[1]-n[1],M=o[0]-n[0],k=o[1]-n[1],j=d*k-M*g,G=_*k-M*c;return j>0&&G<0||j<0&&G>0}function Aw(i,e,n){const o=[];for(let d=0;d<i.length;d++){const g=[];for(let _=0;_<i[d].length;_++){const c=W6(i[d][_],n);gy(e,c),g.push(c)}o.push(g)}return o}function fM(i,e,n){const o=[];for(let d=0;d<i.length;d++){const g=Aw(i[d],e,n);o.push(g)}return o}function pM(i,e,n,o){if(i[0]<n[0]||i[0]>n[2]){const d=o*.5;let g=i[0]-n[0]>d?-o:n[0]-i[0]>d?o:0;g===0&&(g=i[0]-n[2]>d?-o:n[2]-i[0]>d?o:0),i[0]+=g}gy(e,i)}function sN(i){i[0]=i[1]=1/0,i[2]=i[3]=-1/0}function aS(i,e,n,o){const d=Math.pow(2,o.z)*Zh,g=[o.x*Zh,o.y*Zh],_=[];for(const c of i)for(const M of c){const k=[M.x+g[0],M.y+g[1]];pM(k,e,n,d),_.push(k)}return _}function sS(i,e,n,o){const d=Math.pow(2,o.z)*Zh,g=[o.x*Zh,o.y*Zh],_=[];for(const c of i){const M=[];for(const k of c){const j=[k.x+g[0],k.y+g[1]];gy(e,j),M.push(j)}_.push(M)}if(e[2]-e[0]<=d/2){sN(e);for(const c of _)for(const M of c)pM(M,e,n,d)}return _}function oN(i,e){const n=[1/0,1/0,-1/0,-1/0],o=[1/0,1/0,-1/0,-1/0],d=i.canonicalID();if(e.type==="Polygon"){const g=Aw(e.coordinates,o,d),_=aS(i.geometry(),n,o,d);if(!Q_(n,o))return!1;for(const c of _)if(!cg(c,g))return!1}if(e.type==="MultiPolygon"){const g=fM(e.coordinates,o,d),_=aS(i.geometry(),n,o,d);if(!Q_(n,o))return!1;for(const c of _)if(!iN(c,g))return!1}return!0}function lN(i,e){const n=[1/0,1/0,-1/0,-1/0],o=[1/0,1/0,-1/0,-1/0],d=i.canonicalID();if(e.type==="Polygon"){const g=Aw(e.coordinates,o,d),_=sS(i.geometry(),n,o,d);if(!Q_(n,o))return!1;for(const c of _)if(!dM(c,g))return!1}if(e.type==="MultiPolygon"){const g=fM(e.coordinates,o,d),_=sS(i.geometry(),n,o,d);if(!Q_(n,o))return!1;for(const c of _)if(!rN(c,g))return!1}return!0}class Ip{constructor(e,n){this.type=hi,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(K_(e[1])){const o=e[1];if(o.type==="FeatureCollection"){const d=[];for(const g of o.features){const{type:_,coordinates:c}=g.geometry;_==="Polygon"&&d.push(c),_==="MultiPolygon"&&d.push(...c)}if(d.length){const g={type:"MultiPolygon",coordinates:d};return new Ip(o,g)}}else if(o.type==="Feature"){const d=o.geometry.type;if(d==="Polygon"||d==="MultiPolygon")return new Ip(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new Ip(o,o)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return oN(e,this.geometries);if(e.geometryType()==="LineString")return lN(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class mM{constructor(e=[],n=(o,d)=>o<d?-1:o>d?1:0){if(this.data=e,this.length=this.data.length,this.compare=n,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],n=this.data.pop();return--this.length>0&&(this.data[0]=n,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:n,compare:o}=this,d=n[e];for(;e>0;){const g=e-1>>1,_=n[g];if(o(d,_)>=0)break;n[e]=_,e=g}n[e]=d}_down(e){const{data:n,compare:o}=this,d=this.length>>1,g=n[e];for(;e<d;){let _=(e<<1)+1;const c=_+1;if(c<this.length&&o(n[c],n[_])<0&&(_=c),o(n[_],g)>=0)break;n[e]=n[_],e=_}n[e]=g}}function uN(i,e){if(i.length<=1)return[i];const n=[];let o,d;for(const g of i){const _=cN(g);_!==0&&(g.area=Math.abs(_),d===void 0&&(d=_<0),d===_<0?(o&&n.push(o),o=[g]):o.push(g))}return o&&n.push(o),n}function cN(i){let e=0;for(let n=0,o=i.length,d=o-1,g,_;n<o;d=n++)g=i[n],_=i[d],e+=(_.x-g.x)*(g.y+_.y);return e}const hN=6378.137,oS=1/298.257223563,lS=oS*(2-oS),uS=Math.PI/180;class Cw{constructor(e){const n=uS*hN*1e3,o=Math.cos(e*uS),d=1/(1-lS*(1-o*o)),g=Math.sqrt(d);this.kx=n*g*o,this.ky=n*g*d*(1-lS)}distance(e,n){const o=this.wrap(e[0]-n[0])*this.kx,d=(e[1]-n[1])*this.ky;return Math.sqrt(o*o+d*d)}pointOnLine(e,n){let o=1/0,d,g,_,c;for(let M=0;M<e.length-1;M++){let k=e[M][0],j=e[M][1],G=this.wrap(e[M+1][0]-k)*this.kx,ee=(e[M+1][1]-j)*this.ky,Y=0;(G!==0||ee!==0)&&(Y=(this.wrap(n[0]-k)*this.kx*G+(n[1]-j)*this.ky*ee)/(G*G+ee*ee),Y>1?(k=e[M+1][0],j=e[M+1][1]):Y>0&&(k+=G/this.kx*Y,j+=ee/this.ky*Y)),G=this.wrap(n[0]-k)*this.kx,ee=(n[1]-j)*this.ky;const xe=G*G+ee*ee;xe<o&&(o=xe,d=k,g=j,_=M,c=Y)}return{point:[d,g],index:_,t:Math.max(0,Math.min(1,c))}}wrap(e){for(;e<-180;)e+=360;for(;e>180;)e-=360;return e}}const Zx=100,Hx=50;function gM(i,e){return e[0]-i[0]}function _0(i){return i[1]-i[0]+1}function Fd(i,e){return i[1]>=i[0]&&i[1]<e}function Xx(i,e){if(i[0]>i[1])return[null,null];const n=_0(i);if(e){if(n===2)return[i,null];const d=Math.floor(n/2);return[[i[0],i[0]+d],[i[0]+d,i[1]]]}if(n===1)return[i,null];const o=Math.floor(n/2)-1;return[[i[0],i[0]+o],[i[0]+o+1,i[1]]]}function Wx(i,e){if(!Fd(e,i.length))return[1/0,1/0,-1/0,-1/0];const n=[1/0,1/0,-1/0,-1/0];for(let o=e[0];o<=e[1];++o)gy(n,i[o]);return n}function Kx(i){const e=[1/0,1/0,-1/0,-1/0];for(const n of i)for(const o of n)gy(e,o);return e}function cS(i){return i[0]!==-1/0&&i[1]!==-1/0&&i[2]!==1/0&&i[3]!==1/0}function Mw(i,e,n){if(!cS(i)||!cS(e))return NaN;let o=0,d=0;return i[2]<e[0]&&(o=e[0]-i[2]),i[0]>e[2]&&(o=i[0]-e[2]),i[1]>e[3]&&(d=i[1]-e[3]),i[3]<e[1]&&(d=e[1]-i[3]),n.distance([0,0],[o,d])}function Ep(i,e,n){const o=n.pointOnLine(e,i);return n.distance(i,o.point)}function Iw(i,e,n,o,d){const g=Math.min(Ep(i,[n,o],d),Ep(e,[n,o],d)),_=Math.min(Ep(n,[i,e],d),Ep(o,[i,e],d));return Math.min(g,_)}function dN(i,e,n,o,d){if(!(Fd(e,i.length)&&Fd(o,n.length)))return 1/0;let g=1/0;for(let _=e[0];_<e[1];++_){const c=i[_],M=i[_+1];for(let k=o[0];k<o[1];++k){const j=n[k],G=n[k+1];if(nb(c,M,j,G))return 0;g=Math.min(g,Iw(c,M,j,G,d))}}return g}function fN(i,e,n,o,d){if(!(Fd(e,i.length)&&Fd(o,n.length)))return NaN;let g=1/0;for(let _=e[0];_<=e[1];++_)for(let c=o[0];c<=o[1];++c)if(g=Math.min(g,d.distance(i[_],n[c])),g===0)return g;return g}function pN(i,e,n){if(cg(i,e,!0))return 0;let o=1/0;for(const d of e){const g=d[0],_=d[d.length-1];if(g!==_&&(o=Math.min(o,Ep(i,[_,g],n)),o===0))return o;const c=n.pointOnLine(d,i);if(o=Math.min(o,n.distance(i,c.point)),o===0)return o}return o}function mN(i,e,n,o){if(!Fd(e,i.length))return NaN;for(let g=e[0];g<=e[1];++g)if(cg(i[g],n,!0))return 0;let d=1/0;for(let g=e[0];g<e[1];++g){const _=i[g],c=i[g+1];for(const M of n)for(let k=0,j=M.length,G=j-1;k<j;G=k++){const ee=M[G],Y=M[k];if(nb(_,c,ee,Y))return 0;d=Math.min(d,Iw(_,c,ee,Y,o))}}return d}function hS(i,e){for(const n of i)for(const o of n)if(cg(o,e,!0))return!0;return!1}function gN(i,e,n,o=1/0){const d=Kx(i),g=Kx(e);if(o!==1/0&&Mw(d,g,n)>=o)return o;if(Q_(d,g)){if(hS(i,e))return 0}else if(hS(e,i))return 0;let _=1/0;for(const c of i)for(let M=0,k=c.length,j=k-1;M<k;j=M++){const G=c[j],ee=c[M];for(const Y of e)for(let xe=0,be=Y.length,Ne=be-1;xe<be;Ne=xe++){const tt=Y[Ne],Je=Y[xe];if(nb(G,ee,tt,Je))return 0;_=Math.min(_,Iw(G,ee,tt,Je,n))}}return _}function dS(i,e,n,o,d,g){if(!g)return;const _=Mw(Wx(o,g),d,n);_<e&&i.push([_,g,[0,0]])}function wv(i,e,n,o,d,g,_){if(!g||!_)return;const c=Mw(Wx(o,g),Wx(d,_),n);c<e&&i.push([c,g,_])}function y0(i,e,n,o,d=1/0){let g=Math.min(o.distance(i[0],n[0][0]),d);if(g===0)return g;const _=new mM([[0,[0,i.length-1],[0,0]]],gM),c=Kx(n);for(;_.length>0;){const M=_.pop();if(M[0]>=g)continue;const k=M[1],j=e?Hx:Zx;if(_0(k)<=j){if(!Fd(k,i.length))return NaN;if(e){const G=mN(i,k,n,o);if(isNaN(G)||G===0)return G;g=Math.min(g,G)}else for(let G=k[0];G<=k[1];++G){const ee=pN(i[G],n,o);if(g=Math.min(g,ee),g===0)return 0}}else{const G=Xx(k,e);dS(_,g,o,i,c,G[0]),dS(_,g,o,i,c,G[1])}}return g}function v0(i,e,n,o,d,g=1/0){let _=Math.min(g,d.distance(i[0],n[0]));if(_===0)return _;const c=new mM([[0,[0,i.length-1],[0,n.length-1]]],gM);for(;c.length>0;){const M=c.pop();if(M[0]>=_)continue;const k=M[1],j=M[2],G=e?Hx:Zx,ee=o?Hx:Zx;if(_0(k)<=G&&_0(j)<=ee){if(!Fd(k,i.length)&&Fd(j,n.length))return NaN;let Y;if(e&&o)Y=dN(i,k,n,j,d),_=Math.min(_,Y);else if(e&&!o){const xe=i.slice(k[0],k[1]+1);for(let be=j[0];be<=j[1];++be)if(Y=Ep(n[be],xe,d),_=Math.min(_,Y),_===0)return _}else if(!e&&o){const xe=n.slice(j[0],j[1]+1);for(let be=k[0];be<=k[1];++be)if(Y=Ep(i[be],xe,d),_=Math.min(_,Y),_===0)return _}else Y=fN(i,k,n,j,d),_=Math.min(_,Y)}else{const Y=Xx(k,e),xe=Xx(j,o);wv(c,_,d,i,n,Y[0],xe[0]),wv(c,_,d,i,n,Y[0],xe[1]),wv(c,_,d,i,n,Y[1],xe[0]),wv(c,_,d,i,n,Y[1],xe[1])}}return _}function _N(i,e){const n=i.geometry(),o=n.flat().map(_=>Ew([_.x,_.y],i.canonical));if(n.length===0)return NaN;const d=new Cw(o[0][1]);let g=1/0;for(const _ of e){switch(_.type){case"Point":g=Math.min(g,v0(o,!1,[_.coordinates],!1,d,g));break;case"LineString":g=Math.min(g,v0(o,!1,_.coordinates,!0,d,g));break;case"Polygon":g=Math.min(g,y0(o,!1,_.coordinates,d,g));break}if(g===0)return g}return g}function yN(i,e){const n=i.geometry(),o=n.flat().map(_=>Ew([_.x,_.y],i.canonical));if(n.length===0)return NaN;const d=new Cw(o[0][1]);let g=1/0;for(const _ of e){switch(_.type){case"Point":g=Math.min(g,v0(o,!0,[_.coordinates],!1,d,g));break;case"LineString":g=Math.min(g,v0(o,!0,_.coordinates,!0,d,g));break;case"Polygon":g=Math.min(g,y0(o,!0,_.coordinates,d,g));break}if(g===0)return g}return g}function vN(i,e){const n=i.geometry();if(n.length===0||n[0].length===0)return NaN;const o=uN(n).map(_=>_.map(c=>c.map(M=>Ew([M.x,M.y],i.canonical)))),d=new Cw(o[0][0][0][1]);let g=1/0;for(const _ of e)for(const c of o){switch(_.type){case"Point":g=Math.min(g,y0([_.coordinates],!1,c,d,g));break;case"LineString":g=Math.min(g,y0(_.coordinates,!0,c,d,g));break;case"Polygon":g=Math.min(g,gN(c,_.coordinates,d,g));break}if(g===0)return g}return g}function Kb(i){return i.type==="MultiPolygon"?i.coordinates.map(e=>({type:"Polygon",coordinates:e})):i.type==="MultiLineString"?i.coordinates.map(e=>({type:"LineString",coordinates:e})):i.type==="MultiPoint"?i.coordinates.map(e=>({type:"Point",coordinates:e})):[i]}class Pp{constructor(e,n){this.type=Qt,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'distance' expression requires exactly one argument, but found ${e.length-1} instead.`);if(K_(e[1])){const o=e[1];if(o.type==="FeatureCollection")return new Pp(o,o.features.map(d=>Kb(d.geometry)).flat());if(o.type==="Feature")return new Pp(o,Kb(o.geometry));if("type"in o&&"coordinates"in o)return new Pp(o,Kb(o))}return n.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return _N(e,this.geometries);if(e.geometryType()==="LineString")return yN(e,this.geometries);if(e.geometryType()==="Polygon")return vN(e,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class _y{constructor(e){this.type=ui,this.key=e}static parse(e,n){if(e.length!==2)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);const o=e[1];return o==null?n.error("Global state property must be defined."):typeof o!="string"?n.error(`Global state property must be string, but found ${typeof e[1]} instead.`):new _y(o)}evaluate(e){var n;const o=(n=e.globals)===null||n===void 0?void 0:n.globalState;return!o||Object.keys(o).length===0?null:L_(o,this.key)}eachChild(){}outputDefined(){return!1}}const Pw={"==":$6,"!=":q6,">":Z6,"<":G6,">=":X6,"<=":H6,array:th,at:_w,boolean:th,case:bw,coalesce:Y_,collator:tb,format:ww,image:Tw,in:yw,"index-of":m0,interpolate:Gh,"interpolate-hcl":Gh,"interpolate-lab":Gh,length:Sw,let:Q0,literal:Jm,match:vw,number:th,"number-format":xw,object:th,slice:g0,step:eb,string:th,"to-boolean":vf,"to-color":vf,"to-number":vf,"to-string":vf,var:J0,within:Ip,distance:Pp,"global-state":_y};class ah{constructor(e,n,o,d){this.name=e,this.type=n,this._evaluate=o,this.args=d}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,n){const o=e[0],d=ah.definitions[o];if(!d)return n.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);const g=Array.isArray(d)?d[0]:d.type,_=Array.isArray(d)?[[d[1],d[2]]]:d.overloads,c=_.filter(([k])=>!Array.isArray(k)||k.length===e.length-1);let M=null;for(const[k,j]of c){M=new Y0(n.registry,b0,n.path,null,n.scope);const G=[];let ee=!1;for(let Y=1;Y<e.length;Y++){const xe=e[Y],be=Array.isArray(k)?k[Y-1]:k.type,Ne=M.parse(xe,1+G.length,be);if(!Ne){ee=!0;break}G.push(Ne)}if(!ee){if(Array.isArray(k)&&k.length!==G.length){M.error(`Expected ${k.length} arguments, but found ${G.length} instead.`);continue}for(let Y=0;Y<G.length;Y++){const xe=Array.isArray(k)?k[Y]:k.type,be=G[Y];M.concat(Y+1).checkSubtype(xe,be.type)}if(M.errors.length===0)return new ah(o,g,j,G)}}if(c.length===1)n.errors.push(...M.errors);else{const k=(c.length?c:_).map(([G])=>xN(G)).join(" | "),j=[];for(let G=1;G<e.length;G++){const ee=n.parse(e[G],1+j.length);if(!ee)return null;j.push(wa(ee.type))}n.error(`Expected arguments of type ${k}, but found (${j.join(", ")}) instead.`)}return null}static register(e,n){ah.definitions=n;for(const o in n)e[o]=ah}}function fS(i,[e,n,o,d]){e=e.evaluate(i),n=n.evaluate(i),o=o.evaluate(i);const g=d?d.evaluate(i):1,_=oM(e,n,o,g);if(_)throw new Na(_);return new Er(e/255,n/255,o/255,g,!1)}function pS(i,e){return i in e}function Yb(i,e){const n=e[i];return typeof n>"u"?null:n}function bN(i,e,n,o){for(;n<=o;){const d=n+o>>1;if(e[d]===i)return!0;e[d]>i?o=d-1:n=d+1}return!1}function fp(i){return{type:i}}ah.register(Pw,{error:[p6,[yi],(i,[e])=>{throw new Na(e.evaluate(i))}],typeof:[yi,[ui],(i,[e])=>wa(Os(e.evaluate(i)))],"to-rgba":[Bu(Qt,4),[$h],(i,[e])=>{const[n,o,d,g]=e.evaluate(i).rgb;return[n*255,o*255,d*255,g]}],rgb:[$h,[Qt,Qt,Qt],fS],rgba:[$h,[Qt,Qt,Qt,Qt],fS],has:{type:hi,overloads:[[[yi],(i,[e])=>pS(e.evaluate(i),i.properties())],[[yi,Ap],(i,[e,n])=>pS(e.evaluate(i),n.evaluate(i))]]},get:{type:ui,overloads:[[[yi],(i,[e])=>Yb(e.evaluate(i),i.properties())],[[yi,Ap],(i,[e,n])=>Yb(e.evaluate(i),n.evaluate(i))]]},"feature-state":[ui,[yi],(i,[e])=>Yb(e.evaluate(i),i.featureState||{})],properties:[Ap,[],i=>i.properties()],"geometry-type":[yi,[],i=>i.geometryType()],id:[ui,[],i=>i.id()],zoom:[Qt,[],i=>i.globals.zoom],"heatmap-density":[Qt,[],i=>i.globals.heatmapDensity||0],elevation:[Qt,[],i=>i.globals.elevation||0],"line-progress":[Qt,[],i=>i.globals.lineProgress||0],accumulated:[ui,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[Qt,fp(Qt),(i,e)=>{let n=0;for(const o of e)n+=o.evaluate(i);return n}],"*":[Qt,fp(Qt),(i,e)=>{let n=1;for(const o of e)n*=o.evaluate(i);return n}],"-":{type:Qt,overloads:[[[Qt,Qt],(i,[e,n])=>e.evaluate(i)-n.evaluate(i)],[[Qt],(i,[e])=>-e.evaluate(i)]]},"/":[Qt,[Qt,Qt],(i,[e,n])=>e.evaluate(i)/n.evaluate(i)],"%":[Qt,[Qt,Qt],(i,[e,n])=>e.evaluate(i)%n.evaluate(i)],ln2:[Qt,[],()=>Math.LN2],pi:[Qt,[],()=>Math.PI],e:[Qt,[],()=>Math.E],"^":[Qt,[Qt,Qt],(i,[e,n])=>Math.pow(e.evaluate(i),n.evaluate(i))],sqrt:[Qt,[Qt],(i,[e])=>Math.sqrt(e.evaluate(i))],log10:[Qt,[Qt],(i,[e])=>Math.log(e.evaluate(i))/Math.LN10],ln:[Qt,[Qt],(i,[e])=>Math.log(e.evaluate(i))],log2:[Qt,[Qt],(i,[e])=>Math.log(e.evaluate(i))/Math.LN2],sin:[Qt,[Qt],(i,[e])=>Math.sin(e.evaluate(i))],cos:[Qt,[Qt],(i,[e])=>Math.cos(e.evaluate(i))],tan:[Qt,[Qt],(i,[e])=>Math.tan(e.evaluate(i))],asin:[Qt,[Qt],(i,[e])=>Math.asin(e.evaluate(i))],acos:[Qt,[Qt],(i,[e])=>Math.acos(e.evaluate(i))],atan:[Qt,[Qt],(i,[e])=>Math.atan(e.evaluate(i))],min:[Qt,fp(Qt),(i,e)=>Math.min(...e.map(n=>n.evaluate(i)))],max:[Qt,fp(Qt),(i,e)=>Math.max(...e.map(n=>n.evaluate(i)))],abs:[Qt,[Qt],(i,[e])=>Math.abs(e.evaluate(i))],round:[Qt,[Qt],(i,[e])=>{const n=e.evaluate(i);return n<0?-Math.round(-n):Math.round(n)}],floor:[Qt,[Qt],(i,[e])=>Math.floor(e.evaluate(i))],ceil:[Qt,[Qt],(i,[e])=>Math.ceil(e.evaluate(i))],"filter-==":[hi,[yi,ui],(i,[e,n])=>i.properties()[e.value]===n.value],"filter-id-==":[hi,[ui],(i,[e])=>i.id()===e.value],"filter-type-==":[hi,[yi],(i,[e])=>i.geometryType()===e.value],"filter-<":[hi,[yi,ui],(i,[e,n])=>{const o=i.properties()[e.value],d=n.value;return typeof o==typeof d&&o<d}],"filter-id-<":[hi,[ui],(i,[e])=>{const n=i.id(),o=e.value;return typeof n==typeof o&&n<o}],"filter->":[hi,[yi,ui],(i,[e,n])=>{const o=i.properties()[e.value],d=n.value;return typeof o==typeof d&&o>d}],"filter-id->":[hi,[ui],(i,[e])=>{const n=i.id(),o=e.value;return typeof n==typeof o&&n>o}],"filter-<=":[hi,[yi,ui],(i,[e,n])=>{const o=i.properties()[e.value],d=n.value;return typeof o==typeof d&&o<=d}],"filter-id-<=":[hi,[ui],(i,[e])=>{const n=i.id(),o=e.value;return typeof n==typeof o&&n<=o}],"filter->=":[hi,[yi,ui],(i,[e,n])=>{const o=i.properties()[e.value],d=n.value;return typeof o==typeof d&&o>=d}],"filter-id->=":[hi,[ui],(i,[e])=>{const n=i.id(),o=e.value;return typeof n==typeof o&&n>=o}],"filter-has":[hi,[ui],(i,[e])=>e.value in i.properties()],"filter-has-id":[hi,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[hi,[Bu(yi)],(i,[e])=>e.value.indexOf(i.geometryType())>=0],"filter-id-in":[hi,[Bu(ui)],(i,[e])=>e.value.indexOf(i.id())>=0],"filter-in-small":[hi,[yi,Bu(ui)],(i,[e,n])=>n.value.indexOf(i.properties()[e.value])>=0],"filter-in-large":[hi,[yi,Bu(ui)],(i,[e,n])=>bN(i.properties()[e.value],n.value,0,n.value.length-1)],all:{type:hi,overloads:[[[hi,hi],(i,[e,n])=>e.evaluate(i)&&n.evaluate(i)],[fp(hi),(i,e)=>{for(const n of e)if(!n.evaluate(i))return!1;return!0}]]},any:{type:hi,overloads:[[[hi,hi],(i,[e,n])=>e.evaluate(i)||n.evaluate(i)],[fp(hi),(i,e)=>{for(const n of e)if(n.evaluate(i))return!0;return!1}]]},"!":[hi,[hi],(i,[e])=>!e.evaluate(i)],"is-supported-script":[hi,[yi],(i,[e])=>{const n=i.globals&&i.globals.isSupportedScript;return n?n(e.evaluate(i)):!0}],upcase:[yi,[yi],(i,[e])=>e.evaluate(i).toUpperCase()],downcase:[yi,[yi],(i,[e])=>e.evaluate(i).toLowerCase()],concat:[yi,fp(ui),(i,e)=>e.map(n=>k_(n.evaluate(i))).join("")],"resolved-locale":[yi,[Z0],(i,[e])=>e.evaluate(i).resolvedLocale()]});function xN(i){return Array.isArray(i)?`(${i.map(wa).join(", ")})`:`(${wa(i.type)}...)`}function b0(i){if(i instanceof J0)return b0(i.boundExpression);if(i instanceof ah&&i.name==="error"||i instanceof tb||i instanceof Ip||i instanceof Pp||i instanceof _y)return!1;const e=i instanceof vf||i instanceof th;let n=!0;return i.eachChild(o=>{e?n=n&&b0(o):n=n&&o instanceof Jm}),n?ib(i)&&rb(i,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"]):!1}function ib(i){if(i instanceof ah&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof Ip||i instanceof Pp)return!1;let e=!0;return i.eachChild(n=>{e&&!ib(n)&&(e=!1)}),e}function J_(i){if(i instanceof ah&&i.name==="feature-state")return!1;let e=!0;return i.eachChild(n=>{e&&!J_(n)&&(e=!1)}),e}function rb(i,e){if(i instanceof ah&&e.indexOf(i.name)>=0)return!1;let n=!0;return i.eachChild(o=>{n&&!rb(o,e)&&(n=!1)}),n}function Yx(i){return{result:"success",value:i}}function Bm(i){return{result:"error",value:i}}function x0(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function _M(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function yM(i){return!!i.expression&&i.expression.interpolated}function Mi(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function Rw(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)&&Os(i)===Ap}class wN{constructor(e,n){this.expression=e,this._warningHistory={},this._evaluator=new lM,this._defaultValue=n?EN(n):null,this._enumValues=n&&n.type==="enum"?n.values:null}evaluateWithoutErrorHandling(e,n,o,d,g,_){return this._evaluator.globals=e,this._evaluator.feature=n,this._evaluator.featureState=o,this._evaluator.canonical=d,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=_,this.expression.evaluate(this._evaluator)}evaluate(e,n,o,d,g,_){this._evaluator.globals=e,this._evaluator.feature=n||null,this._evaluator.featureState=o||null,this._evaluator.canonical=d,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=_||null;try{const c=this.expression.evaluate(this._evaluator);if(c==null||typeof c=="number"&&c!==c)return this._defaultValue;if(this._enumValues&&!(c in this._enumValues))throw new Na(`Expected value to be one of ${Object.keys(this._enumValues).map(M=>JSON.stringify(M)).join(", ")}, but found ${JSON.stringify(c)} instead.`);return c}catch(c){return this._warningHistory[c.message]||(this._warningHistory[c.message]=!0,typeof console<"u"&&console.warn(c.message)),this._defaultValue}}}function vM(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in Pw}function bM(i,e){const n=new Y0(Pw,b0,[],e?SN(e):void 0),o=n.parse(i,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return o?Yx(new wN(o,e)):Bm(n.errors)}class mS{constructor(e,n){this.kind=e,this._styleExpression=n,this.isStateDependent=e!=="constant"&&!J_(n.expression),this.globalStateRefs=Lw(n.expression)}evaluateWithoutErrorHandling(e,n,o,d,g,_){return this._styleExpression.evaluateWithoutErrorHandling(e,n,o,d,g,_)}evaluate(e,n,o,d,g,_){return this._styleExpression.evaluate(e,n,o,d,g,_)}}class gS{constructor(e,n,o,d){this.kind=e,this.zoomStops=o,this._styleExpression=n,this.isStateDependent=e!=="camera"&&!J_(n.expression),this.globalStateRefs=Lw(n.expression),this.interpolationType=d}evaluateWithoutErrorHandling(e,n,o,d,g,_){return this._styleExpression.evaluateWithoutErrorHandling(e,n,o,d,g,_)}evaluate(e,n,o,d,g,_){return this._styleExpression.evaluate(e,n,o,d,g,_)}interpolationFactor(e,n,o){return this.interpolationType?Gh.interpolationFactor(this.interpolationType,e,n,o):0}}function TN(i,e){const n=bM(i,e);if(n.result==="error")return n;const o=n.value.expression,d=ib(o);if(!d&&!x0(e))return Bm([new Bh("","data expressions not supported")]);const g=rb(o,["zoom"]);if(!g&&!_M(e))return Bm([new Bh("","zoom expressions not supported")]);const _=qv(o);if(!_&&!g)return Bm([new Bh("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')]);if(_ instanceof Bh)return Bm([_]);if(_ instanceof Gh&&!yM(e))return Bm([new Bh("",'"interpolate" expressions cannot be used with this property')]);if(!_)return Yx(d?new mS("constant",n.value):new mS("source",n.value));const c=_ instanceof Gh?_.interpolation:void 0;return Yx(d?new gS("camera",n.value,_.labels,c):new gS("composite",n.value,_.labels,c))}function qv(i){let e=null;if(i instanceof Q0)e=qv(i.result);else if(i instanceof Y_){for(const n of i.args)if(e=qv(n),e)break}else(i instanceof eb||i instanceof Gh)&&i.input instanceof ah&&i.input.name==="zoom"&&(e=i);return e instanceof Bh||i.eachChild(n=>{const o=qv(n);o instanceof Bh?e=o:!e&&o?e=new Bh("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&o&&e!==o&&(e=new Bh("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function Lw(i,e=new Set){return i instanceof _y&&e.add(i.key),i.eachChild(n=>{Lw(n,e)}),e}function SN(i){const e={color:$h,string:yi,number:Qt,enum:yi,boolean:hi,formatted:H0,padding:X0,numberArray:W0,colorArray:H_,projectionDefinition:G0,resolvedImage:my,variableAnchorOffsetCollection:K0};return i.type==="array"?Bu(e[i.value]||ui,i.length):e[i.type]}function EN(i){if(i.type==="color"&&Rw(i.default))return new Er(0,0,0,0);switch(i.type){case"color":return Er.parse(i.default)||null;case"padding":return ih.parse(i.default)||null;case"numberArray":return rh.parse(i.default)||null;case"colorArray":return Fu.parse(i.default)||null;case"variableAnchorOffsetCollection":return qh.parse(i.default)||null;case"projectionDefinition":return eh.parse(i.default)||null;default:return i.default===void 0?null:i.default}}function xM(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const e of i.slice(1))if(!xM(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function wM(i){const e=i.key,n=i.value;return n?[new Ht(e,n,"constants have been deprecated as of v8")]:[]}function Ya(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function Np(i){if(Array.isArray(i))return i.map(Np);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const e={};for(const n in i)e[n]=Np(i[n]);return e}return Ya(i)}function Ic(i){const e=i.key,n=i.value,o=i.valueSpec||{},d=i.objectElementValidators||{},g=i.style,_=i.styleSpec,c=i.validateSpec;let M=[];const k=Mi(n);if(k!=="object")return[new Ht(e,n,`object expected, ${k} found`)];for(const j in n){const G=j.split(".")[0],ee=L_(o,G)||o["*"];let Y;if(L_(d,G))Y=d[G];else if(L_(o,G))Y=c;else if(d["*"])Y=d["*"];else if(o["*"])Y=c;else{M.push(new Ht(e,n[j],`unknown property "${j}"`));continue}M=M.concat(Y({key:(e&&`${e}.`)+j,value:n[j],valueSpec:ee,style:g,styleSpec:_,object:n,objectKey:j,validateSpec:c},n))}for(const j in o)d[j]||o[j].required&&o[j].default===void 0&&n[j]===void 0&&M.push(new Ht(e,n,`missing required property "${j}"`));return M}function kw(i){const e=i.value,n=i.valueSpec,o=i.validateSpec,d=i.style,g=i.styleSpec,_=i.key,c=i.arrayElementValidator||o;if(Mi(e)!=="array")return[new Ht(_,e,`array expected, ${Mi(e)} found`)];if(n.length&&e.length!==n.length)return[new Ht(_,e,`array length ${n.length} expected, length ${e.length} found`)];if(n["min-length"]&&e.length<n["min-length"])return[new Ht(_,e,`array length at least ${n["min-length"]} expected, length ${e.length} found`)];let M={type:n.value,values:n.values};g.$version<7&&(M.function=n.function),Mi(n.value)==="object"&&(M=n.value);let k=[];for(let j=0;j<e.length;j++)k=k.concat(c({array:e,arrayIndex:j,value:e[j],valueSpec:M,validateSpec:i.validateSpec,style:d,styleSpec:g,key:`${_}[${j}]`}));return k}function ab(i){const e=i.key,n=i.value,o=i.valueSpec;let d=Mi(n);return d==="number"&&n!==n&&(d="NaN"),d!=="number"?[new Ht(e,n,`number expected, ${d} found`)]:"minimum"in o&&n<o.minimum?[new Ht(e,n,`${n} is less than the minimum value ${o.minimum}`)]:"maximum"in o&&n>o.maximum?[new Ht(e,n,`${n} is greater than the maximum value ${o.maximum}`)]:[]}function TM(i){const e=i.valueSpec,n=Ya(i.value.type);let o,d={},g,_;const c=n!=="categorical"&&i.value.property===void 0,M=!c,k=Mi(i.value.stops)==="array"&&Mi(i.value.stops[0])==="array"&&Mi(i.value.stops[0][0])==="object",j=Ic({key:i.key,value:i.value,valueSpec:i.styleSpec.function,validateSpec:i.validateSpec,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:G,default:xe}});return n==="identity"&&c&&j.push(new Ht(i.key,i.value,'missing required property "property"')),n!=="identity"&&!i.value.stops&&j.push(new Ht(i.key,i.value,'missing required property "stops"')),n==="exponential"&&i.valueSpec.expression&&!yM(i.valueSpec)&&j.push(new Ht(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(M&&!x0(i.valueSpec)?j.push(new Ht(i.key,i.value,"property functions not supported")):c&&!_M(i.valueSpec)&&j.push(new Ht(i.key,i.value,"zoom functions not supported"))),(n==="categorical"||k)&&i.value.property===void 0&&j.push(new Ht(i.key,i.value,'"property" property is required')),j;function G(be){if(n==="identity")return[new Ht(be.key,be.value,'identity function may not have a "stops" property')];let Ne=[];const tt=be.value;return Ne=Ne.concat(kw({key:be.key,value:tt,valueSpec:be.valueSpec,validateSpec:be.validateSpec,style:be.style,styleSpec:be.styleSpec,arrayElementValidator:ee})),Mi(tt)==="array"&&tt.length===0&&Ne.push(new Ht(be.key,tt,"array must have at least one stop")),Ne}function ee(be){let Ne=[];const tt=be.value,Je=be.key;if(Mi(tt)!=="array")return[new Ht(Je,tt,`array expected, ${Mi(tt)} found`)];if(tt.length!==2)return[new Ht(Je,tt,`array length 2 expected, length ${tt.length} found`)];if(k){if(Mi(tt[0])!=="object")return[new Ht(Je,tt,`object expected, ${Mi(tt[0])} found`)];if(tt[0].zoom===void 0)return[new Ht(Je,tt,"object stop key must have zoom")];if(tt[0].value===void 0)return[new Ht(Je,tt,"object stop key must have value")];if(_&&_>Ya(tt[0].zoom))return[new Ht(Je,tt[0].zoom,"stop zoom values must appear in ascending order")];Ya(tt[0].zoom)!==_&&(_=Ya(tt[0].zoom),g=void 0,d={}),Ne=Ne.concat(Ic({key:`${Je}[0]`,value:tt[0],valueSpec:{zoom:{}},validateSpec:be.validateSpec,style:be.style,styleSpec:be.styleSpec,objectElementValidators:{zoom:ab,value:Y}}))}else Ne=Ne.concat(Y({key:`${Je}[0]`,value:tt[0],validateSpec:be.validateSpec,style:be.style,styleSpec:be.styleSpec},tt));return vM(Np(tt[1]))?Ne.concat([new Ht(`${Je}[1]`,tt[1],"expressions are not allowed in function stops.")]):Ne.concat(be.validateSpec({key:`${Je}[1]`,value:tt[1],valueSpec:e,validateSpec:be.validateSpec,style:be.style,styleSpec:be.styleSpec}))}function Y(be,Ne){const tt=Mi(be.value),Je=Ya(be.value),qe=be.value!==null?be.value:Ne;if(!o)o=tt;else if(tt!==o)return[new Ht(be.key,qe,`${tt} stop domain type must match previous stop domain type ${o}`)];if(tt!=="number"&&tt!=="string"&&tt!=="boolean")return[new Ht(be.key,qe,"stop domain value must be a number, string, or boolean")];if(tt!=="number"&&n!=="categorical"){let He=`number expected, ${tt} found`;return x0(e)&&n===void 0&&(He+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ht(be.key,qe,He)]}return n==="categorical"&&tt==="number"&&(!isFinite(Je)||Math.floor(Je)!==Je)?[new Ht(be.key,qe,`integer expected, found ${Je}`)]:n!=="categorical"&&tt==="number"&&g!==void 0&&Je<g?[new Ht(be.key,qe,"stop domain values must appear in ascending order")]:(g=Je,n==="categorical"&&Je in d?[new Ht(be.key,qe,"stop domain values must be unique")]:(d[Je]=!0,[]))}function xe(be){return be.validateSpec({key:be.key,value:be.value,valueSpec:e,validateSpec:be.validateSpec,style:be.style,styleSpec:be.styleSpec})}}function eg(i){const e=(i.expressionContext==="property"?TN:bM)(Np(i.value),i.valueSpec);if(e.result==="error")return e.value.map(o=>new Ht(`${i.key}${o.key}`,i.value,o.message));const n=e.value.expression||e.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!n.outputDefined())return[new Ht(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!J_(n))return[new Ht(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!J_(n))return[new Ht(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!rb(n,["zoom","feature-state"]))return[new Ht(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!ib(n))return[new Ht(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function AN(i){const e=i.value,n=i.key,o=Mi(e);return o!=="boolean"?[new Ht(n,e,`boolean expected, ${o} found`)]:[]}function Qx(i){const e=i.key,n=i.value,o=Mi(n);return o!=="string"?[new Ht(e,n,`color expected, ${o} found`)]:Er.parse(String(n))?[]:[new Ht(e,n,`color expected, "${n}" found`)]}function ey(i){const e=i.key,n=i.value,o=i.valueSpec,d=[];return Array.isArray(o.values)?o.values.indexOf(Ya(n))===-1&&d.push(new Ht(e,n,`expected one of [${o.values.join(", ")}], ${JSON.stringify(n)} found`)):Object.keys(o.values).indexOf(Ya(n))===-1&&d.push(new Ht(e,n,`expected one of [${Object.keys(o.values).join(", ")}], ${JSON.stringify(n)} found`)),d}function Dw(i){return xM(Np(i.value))?eg(p0({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):SM(i)}function SM(i){const e=i.value,n=i.key;if(Mi(e)!=="array")return[new Ht(n,e,`array expected, ${Mi(e)} found`)];const o=i.styleSpec;let d,g=[];if(e.length<1)return[new Ht(n,e,"filter array must have at least 1 element")];switch(g=g.concat(ey({key:`${n}[0]`,value:e[0],valueSpec:o.filter_operator,style:i.style,styleSpec:i.styleSpec})),Ya(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&Ya(e[1])==="$type"&&g.push(new Ht(n,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&g.push(new Ht(n,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(d=Mi(e[1]),d!=="string"&&g.push(new Ht(`${n}[1]`,e[1],`string expected, ${d} found`)));for(let _=2;_<e.length;_++)d=Mi(e[_]),Ya(e[1])==="$type"?g=g.concat(ey({key:`${n}[${_}]`,value:e[_],valueSpec:o.geometry_type,style:i.style,styleSpec:i.styleSpec})):d!=="string"&&d!=="number"&&d!=="boolean"&&g.push(new Ht(`${n}[${_}]`,e[_],`string, number, or boolean expected, ${d} found`));break;case"any":case"all":case"none":for(let _=1;_<e.length;_++)g=g.concat(SM({key:`${n}[${_}]`,value:e[_],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":d=Mi(e[1]),e.length!==2?g.push(new Ht(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):d!=="string"&&g.push(new Ht(`${n}[1]`,e[1],`string expected, ${d} found`));break}return g}function EM(i,e){const n=i.key,o=i.validateSpec,d=i.style,g=i.styleSpec,_=i.value,c=i.objectKey,M=g[`${e}_${i.layerType}`];if(!M)return[];const k=c.match(/^(.*)-transition$/);if(e==="paint"&&k&&M[k[1]]&&M[k[1]].transition)return o({key:n,value:_,valueSpec:g.transition,style:d,styleSpec:g});const j=i.valueSpec||M[c];if(!j)return[new Ht(n,_,`unknown property "${c}"`)];let G;if(Mi(_)==="string"&&x0(j)&&!j.tokens&&(G=/^{([^}]+)}$/.exec(_)))return[new Ht(n,_,`"${c}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(G[1])} }\`.`)];const ee=[];return i.layerType==="symbol"&&(c==="text-field"&&d&&!d.glyphs&&ee.push(new Ht(n,_,'use of "text-field" requires a style "glyphs" property')),c==="text-font"&&Rw(Np(_))&&Ya(_.type)==="identity"&&ee.push(new Ht(n,_,'"text-font" does not support identity functions'))),ee.concat(o({key:i.key,value:_,valueSpec:j,style:d,styleSpec:g,expressionContext:"property",propertyType:e,propertyKey:c}))}function AM(i){return EM(i,"paint")}function CM(i){return EM(i,"layout")}function MM(i){let e=[];const n=i.value,o=i.key,d=i.style,g=i.styleSpec;if(Mi(n)!=="object")return[new Ht(o,n,`object expected, ${Mi(n)} found`)];!n.type&&!n.ref&&e.push(new Ht(o,n,'either "type" or "ref" is required'));let _=Ya(n.type);const c=Ya(n.ref);if(n.id){const M=Ya(n.id);for(let k=0;k<i.arrayIndex;k++){const j=d.layers[k];Ya(j.id)===M&&e.push(new Ht(o,n.id,`duplicate layer id "${n.id}", previously used at line ${j.id.__line__}`))}}if("ref"in n){["type","source","source-layer","filter","layout"].forEach(k=>{k in n&&e.push(new Ht(o,n[k],`"${k}" is prohibited for ref layers`))});let M;d.layers.forEach(k=>{Ya(k.id)===c&&(M=k)}),M?M.ref?e.push(new Ht(o,n.ref,"ref cannot reference another ref layer")):_=Ya(M.type):e.push(new Ht(o,n.ref,`ref layer "${c}" not found`))}else if(_!=="background")if(!n.source)e.push(new Ht(o,n,'missing required property "source"'));else{const M=d.sources&&d.sources[n.source],k=M&&Ya(M.type);M?k==="vector"&&_==="raster"?e.push(new Ht(o,n.source,`layer "${n.id}" requires a raster source`)):k!=="raster-dem"&&_==="hillshade"?e.push(new Ht(o,n.source,`layer "${n.id}" requires a raster-dem source`)):k!=="raster-dem"&&_==="color-relief"?e.push(new Ht(o,n.source,`layer "${n.id}" requires a raster-dem source`)):k==="raster"&&_!=="raster"?e.push(new Ht(o,n.source,`layer "${n.id}" requires a vector source`)):k==="vector"&&!n["source-layer"]?e.push(new Ht(o,n,`layer "${n.id}" must specify a "source-layer"`)):k==="raster-dem"&&_!=="hillshade"&&_!=="color-relief"?e.push(new Ht(o,n.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):_==="line"&&n.paint&&n.paint["line-gradient"]&&(k!=="geojson"||!M.lineMetrics)&&e.push(new Ht(o,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Ht(o,n.source,`source "${n.source}" not found`))}return e=e.concat(Ic({key:o,value:n,valueSpec:g.layer,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,objectElementValidators:{"*"(){return[]},type(){return i.validateSpec({key:`${o}.type`,value:n.type,valueSpec:g.layer.type,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,object:n,objectKey:"type"})},filter:Dw,layout(M){return Ic({layer:n,key:M.key,value:M.value,style:M.style,styleSpec:M.styleSpec,validateSpec:M.validateSpec,objectElementValidators:{"*"(k){return CM(p0({layerType:_},k))}}})},paint(M){return Ic({layer:n,key:M.key,value:M.value,style:M.style,styleSpec:M.styleSpec,validateSpec:M.validateSpec,objectElementValidators:{"*"(k){return AM(p0({layerType:_},k))}}})}}})),e}function Bp(i){const e=i.value,n=i.key,o=Mi(e);return o!=="string"?[new Ht(n,e,`string expected, ${o} found`)]:[]}function CN(i){var e;const n=(e=i.sourceName)!==null&&e!==void 0?e:"",o=i.value,d=i.styleSpec,g=d.source_raster_dem,_=i.style;let c=[];const M=Mi(o);if(o===void 0)return c;if(M!=="object")return c.push(new Ht("source_raster_dem",o,`object expected, ${M} found`)),c;const k=Ya(o.encoding)==="custom",j=["redFactor","greenFactor","blueFactor","baseShift"],G=i.value.encoding?`"${i.value.encoding}"`:"Default";for(const ee in o)!k&&j.includes(ee)?c.push(new Ht(ee,o[ee],`In "${n}": "${ee}" is only valid when "encoding" is set to "custom". ${G} encoding found`)):g[ee]?c=c.concat(i.validateSpec({key:ee,value:o[ee],valueSpec:g[ee],validateSpec:i.validateSpec,style:_,styleSpec:d})):c.push(new Ht(ee,o[ee],`unknown property "${ee}"`));return c}const _S={promoteId:MN};function IM(i){const e=i.value,n=i.key,o=i.styleSpec,d=i.style,g=i.validateSpec;if(!e.type)return[new Ht(n,e,'"type" is required')];const _=Ya(e.type);let c;switch(_){case"vector":case"raster":return c=Ic({key:n,value:e,valueSpec:o[`source_${_.replace("-","_")}`],style:i.style,styleSpec:o,objectElementValidators:_S,validateSpec:g}),c;case"raster-dem":return c=CN({sourceName:n,value:e,style:i.style,styleSpec:o,validateSpec:g}),c;case"geojson":if(c=Ic({key:n,value:e,valueSpec:o.source_geojson,style:d,styleSpec:o,validateSpec:g,objectElementValidators:_S}),e.cluster)for(const M in e.clusterProperties){const[k,j]=e.clusterProperties[M],G=typeof k=="string"?[k,["accumulated"],["get",M]]:k;c.push(...eg({key:`${n}.${M}.map`,value:j,expressionContext:"cluster-map"})),c.push(...eg({key:`${n}.${M}.reduce`,value:G,expressionContext:"cluster-reduce"}))}return c;case"video":return Ic({key:n,value:e,valueSpec:o.source_video,style:d,validateSpec:g,styleSpec:o});case"image":return Ic({key:n,value:e,valueSpec:o.source_image,style:d,validateSpec:g,styleSpec:o});case"canvas":return[new Ht(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ey({key:`${n}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function MN({key:i,value:e}){if(Mi(e)==="string")return Bp({key:i,value:e});{const n=[];for(const o in e)n.push(...Bp({key:`${i}.${o}`,value:e[o]}));return n}}function PM(i){const e=i.value,n=i.styleSpec,o=n.light,d=i.style;let g=[];const _=Mi(e);if(e===void 0)return g;if(_!=="object")return g=g.concat([new Ht("light",e,`object expected, ${_} found`)]),g;for(const c in e){const M=c.match(/^(.*)-transition$/);M&&o[M[1]]&&o[M[1]].transition?g=g.concat(i.validateSpec({key:c,value:e[c],valueSpec:n.transition,validateSpec:i.validateSpec,style:d,styleSpec:n})):o[c]?g=g.concat(i.validateSpec({key:c,value:e[c],valueSpec:o[c],validateSpec:i.validateSpec,style:d,styleSpec:n})):g=g.concat([new Ht(c,e[c],`unknown property "${c}"`)])}return g}function RM(i){const e=i.value,n=i.styleSpec,o=n.sky,d=i.style,g=Mi(e);if(e===void 0)return[];if(g!=="object")return[new Ht("sky",e,`object expected, ${g} found`)];let _=[];for(const c in e)o[c]?_=_.concat(i.validateSpec({key:c,value:e[c],valueSpec:o[c],style:d,styleSpec:n})):_=_.concat([new Ht(c,e[c],`unknown property "${c}"`)]);return _}function LM(i){const e=i.value,n=i.styleSpec,o=n.terrain,d=i.style;let g=[];const _=Mi(e);if(e===void 0)return g;if(_!=="object")return g=g.concat([new Ht("terrain",e,`object expected, ${_} found`)]),g;for(const c in e)o[c]?g=g.concat(i.validateSpec({key:c,value:e[c],valueSpec:o[c],validateSpec:i.validateSpec,style:d,styleSpec:n})):g=g.concat([new Ht(c,e[c],`unknown property "${c}"`)]);return g}function IN(i){return Bp(i).length===0?[]:eg(i)}function PN(i){return Bp(i).length===0?[]:eg(i)}function RN(i){const e=i.key,n=i.value;if(Mi(n)==="array"){if(n.length<1||n.length>4)return[new Ht(e,n,`padding requires 1 to 4 values; ${n.length} values found`)];const o={type:"number"};let d=[];for(let g=0;g<n.length;g++)d=d.concat(i.validateSpec({key:`${e}[${g}]`,value:n[g],validateSpec:i.validateSpec,valueSpec:o}));return d}else return ab({key:e,value:n,valueSpec:{}})}function LN(i){const e=i.key,n=i.value;if(Mi(n)==="array"){const o={type:"number"};if(n.length<1)return[new Ht(e,n,"array length at least 1 expected, length 0 found")];let d=[];for(let g=0;g<n.length;g++)d=d.concat(i.validateSpec({key:`${e}[${g}]`,value:n[g],validateSpec:i.validateSpec,valueSpec:o}));return d}else return ab({key:e,value:n,valueSpec:{}})}function kN(i){const e=i.key,n=i.value;if(Mi(n)==="array"){if(n.length<1)return[new Ht(e,n,"array length at least 1 expected, length 0 found")];let o=[];for(let d=0;d<n.length;d++)o=o.concat(Qx({key:`${e}[${d}]`,value:n[d]}));return o}else return Qx({key:e,value:n})}function DN(i){const e=i.key,n=i.value,o=Mi(n),d=i.styleSpec;if(o!=="array"||n.length<1||n.length%2!==0)return[new Ht(e,n,"variableAnchorOffsetCollection requires a non-empty array of even length")];let g=[];for(let _=0;_<n.length;_+=2)g=g.concat(ey({key:`${e}[${_}]`,value:n[_],valueSpec:d.layout_symbol["text-anchor"]})),g=g.concat(kw({key:`${e}[${_+1}]`,value:n[_+1],valueSpec:{length:2,value:"number"},validateSpec:i.validateSpec,style:i.style,styleSpec:d}));return g}function kM(i){let e=[];const n=i.value,o=i.key;if(Array.isArray(n)){const d=[],g=[];for(const _ in n){n[_].id&&d.includes(n[_].id)&&e.push(new Ht(o,n,`all the sprites' ids must be unique, but ${n[_].id} is duplicated`)),d.push(n[_].id),n[_].url&&g.includes(n[_].url)&&e.push(new Ht(o,n,`all the sprites' URLs must be unique, but ${n[_].url} is duplicated`)),g.push(n[_].url);const c={id:{type:"string",required:!0},url:{type:"string",required:!0}};e=e.concat(Ic({key:`${o}[${_}]`,value:n[_],valueSpec:c,validateSpec:i.validateSpec}))}return e}else return Bp({key:o,value:n})}function zN(i){const e=i.value,n=i.styleSpec,o=n.projection,d=i.style,g=Mi(e);if(e===void 0)return[];if(g!=="object")return[new Ht("projection",e,`object expected, ${g} found`)];let _=[];for(const c in e)o[c]?_=_.concat(i.validateSpec({key:c,value:e[c],valueSpec:o[c],style:d,styleSpec:n})):_=_.concat([new Ht(c,e[c],`unknown property "${c}"`)]);return _}function ON(i){const e=i.key;let n=i.value;n=n instanceof String?n.valueOf():n;const o=Mi(n);return o==="array"&&!BN(n)&&!NN(n)?[new Ht(e,n,`projection expected, invalid array ${JSON.stringify(n)} found`)]:["array","string"].includes(o)?[]:[new Ht(e,n,`projection expected, invalid type "${o}" found`)]}function NN(i){return!!["interpolate","step","literal"].includes(i[0])}function BN(i){return Array.isArray(i)&&i.length===3&&typeof i[0]=="string"&&typeof i[1]=="string"&&typeof i[2]=="number"}function FN(i){return!!i&&i.constructor===Object}function DM(i){return FN(i.value)?[]:[new Ht(i.key,i.value,`object expected, ${Mi(i.value)} found`)]}const yS={"*"(){return[]},array:kw,boolean:AN,number:ab,color:Qx,constants:wM,enum:ey,filter:Dw,function:TM,layer:MM,object:Ic,source:IM,light:PM,sky:RM,terrain:LM,projection:zN,projectionDefinition:ON,string:Bp,formatted:IN,resolvedImage:PN,padding:RN,numberArray:LN,colorArray:kN,variableAnchorOffsetCollection:DN,sprite:kM,state:DM};function w0(i){const e=i.value,n=i.valueSpec,o=i.styleSpec;return i.validateSpec=w0,n.expression&&Rw(Ya(e))?TM(i):n.expression&&vM(Np(e))?eg(i):n.type&&yS[n.type]?yS[n.type](i):Ic(p0({},i,{valueSpec:n.type?o[n.type]:n}))}function zM(i){const e=i.value,n=i.key,o=Bp(i);return o.length||(e.indexOf("{fontstack}")===-1&&o.push(new Ht(n,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&o.push(new Ht(n,e,'"glyphs" url must include a "{range}" token'))),o}function ju(i,e=f6){let n=[];return n=n.concat(w0({key:"",value:i,valueSpec:e.$root,styleSpec:e,style:i,validateSpec:w0,objectElementValidators:{glyphs:zM,"*"(){return[]}}})),i.constants&&(n=n.concat(wM({key:"constants",value:i.constants}))),OM(n)}ju.source=hh(ch(IM));ju.sprite=hh(ch(kM));ju.glyphs=hh(ch(zM));ju.light=hh(ch(PM));ju.sky=hh(ch(RM));ju.terrain=hh(ch(LM));ju.state=hh(ch(DM));ju.layer=hh(ch(MM));ju.filter=hh(ch(Dw));ju.paintProperty=hh(ch(AM));ju.layoutProperty=hh(ch(CM));function ch(i){return function(e){return i({...e,validateSpec:w0})}}function OM(i){return[].concat(i).sort((e,n)=>e.line-n.line)}function hh(i){return function(...e){return OM(i.apply(this,e))}}function vS(i){if(!i)return{style:R_[P_[0].referenceStyleID].getDefaultVariant().getExpandedStyleURL(),requiresUrlMonitoring:!1,isFallback:!0};if(typeof i=="string"){const e=jN(i);return e.isValidStyle?{style:e.styleObject,requiresUrlMonitoring:!1,isFallback:!1}:e.isValidJSON?{style:R_[P_[0].referenceStyleID].getDefaultVariant().getExpandedStyleURL(),requiresUrlMonitoring:!1,isFallback:!0}:i.startsWith("http")?{style:i,requiresUrlMonitoring:!0,isFallback:!1}:i.toLowerCase().includes(".json")?{style:VN(i),requiresUrlMonitoring:!0,isFallback:!1}:{style:DC(i),requiresUrlMonitoring:!0,isFallback:!1}}return i instanceof zC?{style:i.getExpandedStyleURL(),requiresUrlMonitoring:!1,isFallback:!1}:i instanceof OC?{style:i.getDefaultVariant().getExpandedStyleURL(),requiresUrlMonitoring:!1,isFallback:!1}:ju(i).length===0?{style:i,requiresUrlMonitoring:!1,isFallback:!1}:{style:R_[P_[0].referenceStyleID].getDefaultVariant().getExpandedStyleURL(),requiresUrlMonitoring:!1,isFallback:!0}}function VN(i){try{return new URL(i).href}catch{}return new URL(i,location.origin).href}function jN(i){try{const e=JSON.parse(i),n=ju(e);return{isValidJSON:!0,isValidStyle:n.length===0,styleObject:n.length===0?e:null}}catch{return{isValidJSON:!1,isValidStyle:!1,styleObject:null}}}function Dd(i,e,n){const o=window.document.createElement(i);return e!==void 0&&(o.className=e),n&&n.appendChild(o),o}function ty(i){i.parentNode&&i.parentNode.removeChild(i)}class UN{constructor(){rn(this,"_map"),rn(this,"_container"),rn(this,"_terrainButton"),hO(["_toggleTerrain","_updateTerrainIcon"],this)}onAdd(e){return this._map=e,this._container=Dd("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=Dd("button","maplibregl-ctrl-terrain",this._container),Dd("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){ty(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}_toggleTerrain(){NM(this._map),this._updateTerrainIcon()}_updateTerrainIcon(){this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.hasTerrain()?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))}}function NM(i){i.hasTerrain()?i.disableTerrain():i.enableTerrain()}class $N extends wO{constructor(e={}){super({showCompass:e.showCompass??!0,showZoom:e.showZoom??!0,visualizePitch:e.visualizePitch??!0}),rn(this,"_rotateCompassArrow",()=>{const n=this._map.getBearing(),o=this._map.getPitch(),d=this.options.visualizePitch?`scale(${Math.min(1.5,1/Math.cos(o*(Math.PI/180))**.5)}) rotateX(${Math.min(70,o)}deg) rotateZ(${-n}deg)`:`rotate(${-n}deg)`;this._compassIcon.style.transform=d}),this._compass&&(this._compass.removeEventListener("click",this._compass.clickFunction),this._compass.addEventListener("click",n=>{this._map.getPitch()===0?this._map.easeTo({pitch:Math.min(this._map.getMaxPitch(),80)}):this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:n}):this._map.resetNorth({},{originalEvent:n})}))}_createButton(e,n){const o=super._createButton(e,n);return o.clickFunction=n,o}}const bS=wn.Marker,xS=wn.LngLat,qN=wn.LngLatBounds;class GN extends TO{constructor(){super(...arguments),rn(this,"lastUpdatedCenter",new xS(0,0)),rn(this,"_updateCamera",e=>{var n;const o=new xS(e.coords.longitude,e.coords.latitude),d=e.coords.accuracy,g={bearing:this._map.getBearing(),...this.options.fitBoundsOptions,linear:!0},_=this._map.getZoom();_>(((n=this.options.fitBoundsOptions)==null?void 0:n.maxZoom)??30)&&(g.zoom=_),this._map.fitBounds(qN.fromLngLat(o,d),g,{geolocateSource:!0});let c=!1;const M=()=>{c=!0};this._map.once("click",M),this._map.once("dblclick",M),this._map.once("dragstart",M),this._map.once("mousedown",M),this._map.once("touchstart",M),this._map.once("wheel",M),this._map.once("moveend",()=>{this._map.off("click",M),this._map.off("dblclick",M),this._map.off("dragstart",M),this._map.off("mousedown",M),this._map.off("touchstart",M),this._map.off("wheel",M),!c&&(this.lastUpdatedCenter=this._map.getCenter())})}),rn(this,"_finishSetupUI",e=>{if(this._map){if(e===!1){const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n)}else{const n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Dd("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new bS({element:this._dotElement}),this._circleElement=Dd("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new bS({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("move",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("moveend",n=>{const o=n.originalEvent&&n.originalEvent.type==="resize",d=this.lastUpdatedCenter.distanceTo(this._map.getCenter());!n.geolocateSource&&this._watchState==="ACTIVE_LOCK"&&!o&&d>1&&(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new Event("trackuserlocationend")))})}}),rn(this,"_onZoom",()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()})}_updateCircleRadius(){if(this._watchState!=="BACKGROUND"&&this._watchState!=="ACTIVE_LOCK")return;const e=[this._lastKnownPosition.coords.longitude,this._lastKnownPosition.coords.latitude],n=this._map.project(e),o=this._map.unproject([n.x,n.y]),d=this._map.unproject([n.x+20,n.y]),g=o.distanceTo(d)/20,_=Math.ceil(2*this._accuracy/g);this._circleElement.style.width=`${_}px`,this._circleElement.style.height=`${_}px`}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;case"BACKGROUND_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}}var _p,Du,yp,vp,x_;class ZN{constructor(e,n,o){if(lu(this,_p),lu(this,Du),lu(this,yp),lu(this,vp),lu(this,x_),typeof e=="string"){const d=document.querySelector(e);if(!d)throw new Error(`No element has been found with selector "${e}" when creating an external control.`);Nu(this,Du,d)}else Nu(this,Du,e);n&&Nu(this,yp,d=>{n(An(this,_p),An(this,Du),d)}),o&&Nu(this,vp,d=>{o(An(this,_p),An(this,Du),d)}),Nu(this,x_,An(this,Du).parentElement)}onAdd(e){return Nu(this,_p,e),An(this,yp)&&An(this,Du).addEventListener("click",An(this,yp)),An(this,vp)&&An(this,_p).on("render",An(this,vp)),ty(An(this,Du)),An(this,Du)}onRemove(){An(this,yp)&&An(this,Du).removeEventListener("click",An(this,yp)),An(this,vp)&&An(this,_p).off("render",An(this,vp)),An(this,x_)?An(this,x_).appendChild(An(this,Du)):ty(An(this,Du))}}_p=new WeakMap,Du=new WeakMap,yp=new WeakMap,vp=new WeakMap,x_=new WeakMap;class HN{constructor(){rn(this,"map"),rn(this,"container"),rn(this,"projectionButton")}onAdd(e){return this.map=e,this.container=Dd("div","maplibregl-ctrl maplibregl-ctrl-group"),this.projectionButton=Dd("button","maplibregl-ctrl-projection",this.container),Dd("span","maplibregl-ctrl-icon",this.projectionButton).setAttribute("aria-hidden","true"),this.projectionButton.type="button",this.projectionButton.addEventListener("click",this.toggleProjection.bind(this)),e.on("projectiontransition",this.updateProjectionIcon.bind(this)),this.updateProjectionIcon(),this.container}onRemove(){ty(this.container),this.map.off("projectiontransition",this.updateProjectionIcon),this.map=void 0}toggleProjection(){BM(this.map),this.updateProjectionIcon()}updateProjectionIcon(){this.projectionButton.classList.remove("maplibregl-ctrl-projection-globe"),this.projectionButton.classList.remove("maplibregl-ctrl-projection-mercator"),this.map.isGlobeProjection()?(this.projectionButton.classList.add("maplibregl-ctrl-projection-mercator"),this.projectionButton.title="Enable Mercator projection"):(this.projectionButton.classList.add("maplibregl-ctrl-projection-globe"),this.projectionButton.title="Enable Globe projection")}}function BM(i){i.getProjection()===void 0&&i.setProjection({type:"mercator"}),i.isGlobeProjection()?i.enableMercatorProjection():i.enableGlobeProjection()}const w_={"zoom-in":i=>i.zoomIn(),"zoom-out":i=>i.zoomOut(),"toggle-projection":BM,"toggle-terrain":NM,"reset-view":i=>{i.getPitch()===0?i.easeTo({pitch:Math.min(i.getMaxPitch(),80)}):i.resetNorthPitch()},"reset-bearing":i=>{i.rotateTo(0)},"reset-pitch":i=>{i.setPitch(0)},"reset-roll":i=>{i.setRoll(0)}};var Gv,T_;class Jx extends ZN{constructor(e,n){if(n&&!(n in w_))throw new Error(`data-maptiler-control value "${n}" is invalid.`);super(e,n&&w_[n]),lu(this,Gv),lu(this,T_,new Map)}onAdd(e){return Nu(this,Gv,e),super.onAdd(e)}onRemove(){for(const[e,n]of An(this,T_)){const o=e.deref();o&&o.removeEventListener("click",n)}An(this,T_).clear(),super.onRemove()}configureGroupItem(e,n){if(!n)return;if(!(n in w_))throw new Error(`data-maptiler-control value "${n}" is invalid.`);const o=d=>{w_[n](An(this,Gv),e,d)};e.addEventListener("click",o),An(this,T_).set(new WeakRef(e),o)}}Gv=new WeakMap,T_=new WeakMap,rn(Jx,"controlCallbacks",w_);var Ou,Oh,bp,xp,Ec,Zv,jl,FM,Ac,VM;class Qb{constructor(e,n){lu(this,jl),lu(this,Ou),rn(this,"map"),lu(this,Oh),lu(this,bp),lu(this,xp),lu(this,Ec,!1),lu(this,Zv),e.style!==void 0&&Nu(this,Ec,!0),Nu(this,Ou,{zoomAdjust:-4,position:"top-right",...n,forceNoAttributionControl:!0,attributionControl:!1,navigationControl:!1,geolocateControl:!1,maptilerLogo:!1,minimap:!1,hash:!1,pitchAdjust:!1,...e,containerStyle:{border:"1px solid #000",width:"400px",height:"300px",...e.containerStyle??{}}}),e.lockZoom!==void 0&&(An(this,Ou).minZoom=e.lockZoom,An(this,Ou).maxZoom=e.lockZoom)}setStyle(e,n){An(this,Ec)||this.map.setStyle(e,n),zu(this,jl,Ac).call(this)}addLayer(e,n){return An(this,Ec)||this.map.addLayer(e,n),zu(this,jl,Ac).call(this),this.map}moveLayer(e,n){return An(this,Ec)||this.map.moveLayer(e,n),zu(this,jl,Ac).call(this),this.map}removeLayer(e){return An(this,Ec)||this.map.removeLayer(e),zu(this,jl,Ac).call(this),this}setLayerZoomRange(e,n,o){return An(this,Ec)||this.map.setLayerZoomRange(e,n,o),zu(this,jl,Ac).call(this),this}setFilter(e,n,o){return An(this,Ec)||this.map.setFilter(e,n,o),zu(this,jl,Ac).call(this),this}setPaintProperty(e,n,o,d){return An(this,Ec)||this.map.setPaintProperty(e,n,o,d),zu(this,jl,Ac).call(this),this}setLayoutProperty(e,n,o,d){return An(this,Ec)||this.map.setLayoutProperty(e,n,o,d),zu(this,jl,Ac).call(this),this}setGlyphs(e,n){return An(this,Ec)||this.map.setGlyphs(e,n),zu(this,jl,Ac).call(this),this}onAdd(e){Nu(this,Oh,e),Nu(this,bp,Dd("div","maplibregl-ctrl maplibregl-ctrl-group"));for(const[n,o]of Object.entries(An(this,Ou).containerStyle))An(this,bp).style.setProperty(n,o);return An(this,Ou).container=An(this,bp),An(this,Ou).zoom=e.getZoom()+An(this,Ou).zoomAdjust,this.map=new qM(An(this,Ou)),this.map.once("style.load",()=>{this.map.resize()}),this.map.once("load",()=>{zu(this,jl,FM).call(this,An(this,Ou).parentRect),Nu(this,Zv,zu(this,jl,VM).call(this))}),An(this,bp)}onRemove(){var e;(e=An(this,Zv))==null||e.call(this),ty(An(this,bp))}}Ou=new WeakMap,Oh=new WeakMap,bp=new WeakMap,xp=new WeakMap,Ec=new WeakMap,Zv=new WeakMap,jl=new WeakSet,FM=function(i){i===void 0||i.linePaint===void 0&&i.fillPaint===void 0||(Nu(this,xp,{type:"Feature",properties:{name:"parentRect"},geometry:{type:"Polygon",coordinates:[[[],[],[],[],[]]]}}),this.map.addSource("parentRect",{type:"geojson",data:An(this,xp)}),(i.lineLayout!==void 0||i.linePaint!==void 0)&&this.map.addLayer({id:"parentRectOutline",type:"line",source:"parentRect",layout:{...i.lineLayout},paint:{"line-color":"#FFF","line-width":1,"line-opacity":.85,...i.linePaint}}),i.fillPaint!==void 0&&this.map.addLayer({id:"parentRectFill",type:"fill",source:"parentRect",layout:{},paint:{"fill-color":"#08F","fill-opacity":.135,...i.fillPaint}}),zu(this,jl,Ac).call(this))},Ac=function(){if(An(this,xp)===void 0)return;const{devicePixelRatio:i}=window,e=An(this,Oh).getCanvas(),n=e.width/i,o=e.height/i,d=An(this,Oh).unproject.bind(An(this,Oh)),g=d([0,0]),_=d([n,0]),c=d([0,o]),M=d([n,o]);An(this,xp).geometry.coordinates=[[c.toArray(),M.toArray(),_.toArray(),g.toArray(),c.toArray()]];const k=this.map.getSource("parentRect");k!==void 0&&k.setData(An(this,xp))},VM=function(){const{pitchAdjust:i}=An(this,Ou),e=()=>{g("parent")},n=()=>{g("minimap")},o=()=>{An(this,Oh).on("move",e),this.map.on("move",n)},d=()=>{An(this,Oh).off("move",e),this.map.off("move",n)},g=_=>{d();const c=_==="parent"?An(this,Oh):this.map,M=_==="parent"?this.map:An(this,Oh),k=c.getCenter(),j=c.getZoom()+An(this,Ou).zoomAdjust*(_==="parent"?1:-1),G=c.getBearing(),ee=c.getPitch();M.jumpTo({center:k,zoom:j,bearing:G,pitch:i?ee:0}),zu(this,jl,Ac).call(this),o()};return o(),()=>{d()}};class XN{constructor(e,n=2e3){rn(this,"map"),rn(this,"registeredModules",new Set),rn(this,"viewerType"),this.map=e,this.viewerType="Map",setTimeout(async()=>{if(!Ka.telemetry)return;const o=this.preparePayload();try{(await fetch(o,{method:"POST"})).ok||console.warn("The metrics could not be sent to MapTiler Cloud")}catch(d){console.warn("The metrics could not be sent to MapTiler Cloud",d)}},Math.max(1e3,n))}registerModule(e,n){this.registeredModules.add(`${e}:${n}`)}registerViewerType(e="Map"){this.viewerType=e}preparePayload(){const e=new URL(Ul.telemetryURL);return e.searchParams.append("sdk",KB()),e.searchParams.append("key",Ka.apiKey),e.searchParams.append("mtsid",fw),e.searchParams.append("session",Ka.session?"1":"0"),e.searchParams.append("caching",Ka.caching?"1":"0"),e.searchParams.append("lang-updated",this.map.isLanguageUpdated()?"1":"0"),e.searchParams.append("terrain",this.map.getTerrain()?"1":"0"),e.searchParams.append("globe",this.map.isGlobeProjection()?"1":"0"),e.searchParams.append("viewerType",this.viewerType),this.registeredModules.size>0&&e.searchParams.append("modules",Array.from(this.registeredModules).join("|")),e.href}}var ny=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var i=0,e=arguments.length;e--;)i+=arguments[e]*arguments[e];return Math.sqrt(i)});function D_(){var i=new ny(16);return ny!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i}function WN(i,e,n,o,d,g,_,c,M,k,j,G,ee,Y,xe,be,Ne){return i[0]=e,i[1]=n,i[2]=o,i[3]=d,i[4]=g,i[5]=_,i[6]=c,i[7]=M,i[8]=k,i[9]=j,i[10]=G,i[11]=ee,i[12]=Y,i[13]=xe,i[14]=be,i[15]=Ne,i}function KN(i,e,n){var o=e[0],d=e[1],g=e[2],_=e[3],c=e[4],M=e[5],k=e[6],j=e[7],G=e[8],ee=e[9],Y=e[10],xe=e[11],be=e[12],Ne=e[13],tt=e[14],Je=e[15],qe=n[0],He=n[1],Ue=n[2],Be=n[3];return i[0]=qe*o+He*c+Ue*G+Be*be,i[1]=qe*d+He*M+Ue*ee+Be*Ne,i[2]=qe*g+He*k+Ue*Y+Be*tt,i[3]=qe*_+He*j+Ue*xe+Be*Je,qe=n[4],He=n[5],Ue=n[6],Be=n[7],i[4]=qe*o+He*c+Ue*G+Be*be,i[5]=qe*d+He*M+Ue*ee+Be*Ne,i[6]=qe*g+He*k+Ue*Y+Be*tt,i[7]=qe*_+He*j+Ue*xe+Be*Je,qe=n[8],He=n[9],Ue=n[10],Be=n[11],i[8]=qe*o+He*c+Ue*G+Be*be,i[9]=qe*d+He*M+Ue*ee+Be*Ne,i[10]=qe*g+He*k+Ue*Y+Be*tt,i[11]=qe*_+He*j+Ue*xe+Be*Je,qe=n[12],He=n[13],Ue=n[14],Be=n[15],i[12]=qe*o+He*c+Ue*G+Be*be,i[13]=qe*d+He*M+Ue*ee+Be*Ne,i[14]=qe*g+He*k+Ue*Y+Be*tt,i[15]=qe*_+He*j+Ue*xe+Be*Je,i}function YN(i,e,n){var o=n[0],d=n[1],g=n[2];return i[0]=e[0]*o,i[1]=e[1]*o,i[2]=e[2]*o,i[3]=e[3]*o,i[4]=e[4]*d,i[5]=e[5]*d,i[6]=e[6]*d,i[7]=e[7]*d,i[8]=e[8]*g,i[9]=e[9]*g,i[10]=e[10]*g,i[11]=e[11]*g,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i}function wS(i,e,n){var o=Math.sin(n),d=Math.cos(n),g=e[4],_=e[5],c=e[6],M=e[7],k=e[8],j=e[9],G=e[10],ee=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=g*d+k*o,i[5]=_*d+j*o,i[6]=c*d+G*o,i[7]=M*d+ee*o,i[8]=k*d-g*o,i[9]=j*d-_*o,i[10]=G*d-c*o,i[11]=ee*d-M*o,i}function QN(i,e,n){var o=Math.sin(n),d=Math.cos(n),g=e[0],_=e[1],c=e[2],M=e[3],k=e[8],j=e[9],G=e[10],ee=e[11];return e!==i&&(i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=g*d-k*o,i[1]=_*d-j*o,i[2]=c*d-G*o,i[3]=M*d-ee*o,i[8]=g*o+k*d,i[9]=_*o+j*d,i[10]=c*o+G*d,i[11]=M*o+ee*d,i}function TS(i,e,n){var o=Math.sin(n),d=Math.cos(n),g=e[0],_=e[1],c=e[2],M=e[3],k=e[4],j=e[5],G=e[6],ee=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=g*d+k*o,i[1]=_*d+j*o,i[2]=c*d+G*o,i[3]=M*d+ee*o,i[4]=k*d-g*o,i[5]=j*d-_*o,i[6]=G*d-c*o,i[7]=ee*d-M*o,i}function JN(i,e,n,o,d){var g=1/Math.tan(e/2),_;return i[0]=g/n,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=g,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,d!=null&&d!==1/0?(_=1/(o-d),i[10]=(d+o)*_,i[14]=2*d*o*_):(i[10]=-1,i[14]=-2*o),i}var eB=JN;function Hv(){var i=new ny(3);return ny!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function tB(i,e,n){var o=new ny(3);return o[0]=i,o[1]=e,o[2]=n,o}function Jb(i,e){var n=e[0],o=e[1],d=e[2],g=n*n+o*o+d*d;return g>0&&(g=1/Math.sqrt(g)),i[0]=e[0]*g,i[1]=e[1]*g,i[2]=e[2]*g,i}function SS(i,e,n){var o=e[0],d=e[1],g=e[2],_=n[0],c=n[1],M=n[2];return i[0]=d*M-g*c,i[1]=g*_-o*M,i[2]=o*c-d*_,i}(function(){var i=Hv();return function(e,n,o,d,g,_){var c,M;for(n||(n=3),o||(o=0),d?M=Math.min(d*n+o,e.length):M=e.length,c=o;c<M;c+=n)i[0]=e[c],i[1]=e[c+1],i[2]=e[c+2],g(i,i,_),e[c]=i[0],e[c+1]=i[1],e[c+2]=i[2];return e}})();function nB(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var ES,AS;function iB(){return AS||(AS=1,ES={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}),ES}var ex,CS;function jM(){if(CS)return ex;CS=1;const i=iB(),e={};for(const d of Object.keys(i))e[i[d]]=d;const n={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};ex=n;for(const d of Object.keys(n)){if(!("channels"in n[d]))throw new Error("missing channels property: "+d);if(!("labels"in n[d]))throw new Error("missing channel labels property: "+d);if(n[d].labels.length!==n[d].channels)throw new Error("channel and label counts mismatch: "+d);const{channels:g,labels:_}=n[d];delete n[d].channels,delete n[d].labels,Object.defineProperty(n[d],"channels",{value:g}),Object.defineProperty(n[d],"labels",{value:_})}n.rgb.hsl=function(d){const g=d[0]/255,_=d[1]/255,c=d[2]/255,M=Math.min(g,_,c),k=Math.max(g,_,c),j=k-M;let G,ee;k===M?G=0:g===k?G=(_-c)/j:_===k?G=2+(c-g)/j:c===k&&(G=4+(g-_)/j),G=Math.min(G*60,360),G<0&&(G+=360);const Y=(M+k)/2;return k===M?ee=0:Y<=.5?ee=j/(k+M):ee=j/(2-k-M),[G,ee*100,Y*100]},n.rgb.hsv=function(d){let g,_,c,M,k;const j=d[0]/255,G=d[1]/255,ee=d[2]/255,Y=Math.max(j,G,ee),xe=Y-Math.min(j,G,ee),be=function(Ne){return(Y-Ne)/6/xe+1/2};return xe===0?(M=0,k=0):(k=xe/Y,g=be(j),_=be(G),c=be(ee),j===Y?M=c-_:G===Y?M=1/3+g-c:ee===Y&&(M=2/3+_-g),M<0?M+=1:M>1&&(M-=1)),[M*360,k*100,Y*100]},n.rgb.hwb=function(d){const g=d[0],_=d[1];let c=d[2];const M=n.rgb.hsl(d)[0],k=1/255*Math.min(g,Math.min(_,c));return c=1-1/255*Math.max(g,Math.max(_,c)),[M,k*100,c*100]},n.rgb.cmyk=function(d){const g=d[0]/255,_=d[1]/255,c=d[2]/255,M=Math.min(1-g,1-_,1-c),k=(1-g-M)/(1-M)||0,j=(1-_-M)/(1-M)||0,G=(1-c-M)/(1-M)||0;return[k*100,j*100,G*100,M*100]};function o(d,g){return(d[0]-g[0])**2+(d[1]-g[1])**2+(d[2]-g[2])**2}return n.rgb.keyword=function(d){const g=e[d];if(g)return g;let _=1/0,c;for(const M of Object.keys(i)){const k=i[M],j=o(d,k);j<_&&(_=j,c=M)}return c},n.keyword.rgb=function(d){return i[d]},n.rgb.xyz=function(d){let g=d[0]/255,_=d[1]/255,c=d[2]/255;g=g>.04045?((g+.055)/1.055)**2.4:g/12.92,_=_>.04045?((_+.055)/1.055)**2.4:_/12.92,c=c>.04045?((c+.055)/1.055)**2.4:c/12.92;const M=g*.4124+_*.3576+c*.1805,k=g*.2126+_*.7152+c*.0722,j=g*.0193+_*.1192+c*.9505;return[M*100,k*100,j*100]},n.rgb.lab=function(d){const g=n.rgb.xyz(d);let _=g[0],c=g[1],M=g[2];_/=95.047,c/=100,M/=108.883,_=_>.008856?_**(1/3):7.787*_+16/116,c=c>.008856?c**(1/3):7.787*c+16/116,M=M>.008856?M**(1/3):7.787*M+16/116;const k=116*c-16,j=500*(_-c),G=200*(c-M);return[k,j,G]},n.hsl.rgb=function(d){const g=d[0]/360,_=d[1]/100,c=d[2]/100;let M,k,j;if(_===0)return j=c*255,[j,j,j];c<.5?M=c*(1+_):M=c+_-c*_;const G=2*c-M,ee=[0,0,0];for(let Y=0;Y<3;Y++)k=g+1/3*-(Y-1),k<0&&k++,k>1&&k--,6*k<1?j=G+(M-G)*6*k:2*k<1?j=M:3*k<2?j=G+(M-G)*(2/3-k)*6:j=G,ee[Y]=j*255;return ee},n.hsl.hsv=function(d){const g=d[0];let _=d[1]/100,c=d[2]/100,M=_;const k=Math.max(c,.01);c*=2,_*=c<=1?c:2-c,M*=k<=1?k:2-k;const j=(c+_)/2,G=c===0?2*M/(k+M):2*_/(c+_);return[g,G*100,j*100]},n.hsv.rgb=function(d){const g=d[0]/60,_=d[1]/100;let c=d[2]/100;const M=Math.floor(g)%6,k=g-Math.floor(g),j=255*c*(1-_),G=255*c*(1-_*k),ee=255*c*(1-_*(1-k));switch(c*=255,M){case 0:return[c,ee,j];case 1:return[G,c,j];case 2:return[j,c,ee];case 3:return[j,G,c];case 4:return[ee,j,c];case 5:return[c,j,G]}},n.hsv.hsl=function(d){const g=d[0],_=d[1]/100,c=d[2]/100,M=Math.max(c,.01);let k,j;j=(2-_)*c;const G=(2-_)*M;return k=_*M,k/=G<=1?G:2-G,k=k||0,j/=2,[g,k*100,j*100]},n.hwb.rgb=function(d){const g=d[0]/360;let _=d[1]/100,c=d[2]/100;const M=_+c;let k;M>1&&(_/=M,c/=M);const j=Math.floor(6*g),G=1-c;k=6*g-j,j&1&&(k=1-k);const ee=_+k*(G-_);let Y,xe,be;switch(j){default:case 6:case 0:Y=G,xe=ee,be=_;break;case 1:Y=ee,xe=G,be=_;break;case 2:Y=_,xe=G,be=ee;break;case 3:Y=_,xe=ee,be=G;break;case 4:Y=ee,xe=_,be=G;break;case 5:Y=G,xe=_,be=ee;break}return[Y*255,xe*255,be*255]},n.cmyk.rgb=function(d){const g=d[0]/100,_=d[1]/100,c=d[2]/100,M=d[3]/100,k=1-Math.min(1,g*(1-M)+M),j=1-Math.min(1,_*(1-M)+M),G=1-Math.min(1,c*(1-M)+M);return[k*255,j*255,G*255]},n.xyz.rgb=function(d){const g=d[0]/100,_=d[1]/100,c=d[2]/100;let M,k,j;return M=g*3.2406+_*-1.5372+c*-.4986,k=g*-.9689+_*1.8758+c*.0415,j=g*.0557+_*-.204+c*1.057,M=M>.0031308?1.055*M**(1/2.4)-.055:M*12.92,k=k>.0031308?1.055*k**(1/2.4)-.055:k*12.92,j=j>.0031308?1.055*j**(1/2.4)-.055:j*12.92,M=Math.min(Math.max(0,M),1),k=Math.min(Math.max(0,k),1),j=Math.min(Math.max(0,j),1),[M*255,k*255,j*255]},n.xyz.lab=function(d){let g=d[0],_=d[1],c=d[2];g/=95.047,_/=100,c/=108.883,g=g>.008856?g**(1/3):7.787*g+16/116,_=_>.008856?_**(1/3):7.787*_+16/116,c=c>.008856?c**(1/3):7.787*c+16/116;const M=116*_-16,k=500*(g-_),j=200*(_-c);return[M,k,j]},n.lab.xyz=function(d){const g=d[0],_=d[1],c=d[2];let M,k,j;k=(g+16)/116,M=_/500+k,j=k-c/200;const G=k**3,ee=M**3,Y=j**3;return k=G>.008856?G:(k-16/116)/7.787,M=ee>.008856?ee:(M-16/116)/7.787,j=Y>.008856?Y:(j-16/116)/7.787,M*=95.047,k*=100,j*=108.883,[M,k,j]},n.lab.lch=function(d){const g=d[0],_=d[1],c=d[2];let M;M=Math.atan2(c,_)*360/2/Math.PI,M<0&&(M+=360);const k=Math.sqrt(_*_+c*c);return[g,k,M]},n.lch.lab=function(d){const g=d[0],_=d[1],c=d[2]/360*2*Math.PI,M=_*Math.cos(c),k=_*Math.sin(c);return[g,M,k]},n.rgb.ansi16=function(d,g=null){const[_,c,M]=d;let k=g===null?n.rgb.hsv(d)[2]:g;if(k=Math.round(k/50),k===0)return 30;let j=30+(Math.round(M/255)<<2|Math.round(c/255)<<1|Math.round(_/255));return k===2&&(j+=60),j},n.hsv.ansi16=function(d){return n.rgb.ansi16(n.hsv.rgb(d),d[2])},n.rgb.ansi256=function(d){const g=d[0],_=d[1],c=d[2];return g===_&&_===c?g<8?16:g>248?231:Math.round((g-8)/247*24)+232:16+36*Math.round(g/255*5)+6*Math.round(_/255*5)+Math.round(c/255*5)},n.ansi16.rgb=function(d){let g=d%10;if(g===0||g===7)return d>50&&(g+=3.5),g=g/10.5*255,[g,g,g];const _=(~~(d>50)+1)*.5,c=(g&1)*_*255,M=(g>>1&1)*_*255,k=(g>>2&1)*_*255;return[c,M,k]},n.ansi256.rgb=function(d){if(d>=232){const k=(d-232)*10+8;return[k,k,k]}d-=16;let g;const _=Math.floor(d/36)/5*255,c=Math.floor((g=d%36)/6)/5*255,M=g%6/5*255;return[_,c,M]},n.rgb.hex=function(d){const g=(((Math.round(d[0])&255)<<16)+((Math.round(d[1])&255)<<8)+(Math.round(d[2])&255)).toString(16).toUpperCase();return"000000".substring(g.length)+g},n.hex.rgb=function(d){const g=d.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!g)return[0,0,0];let _=g[0];g[0].length===3&&(_=_.split("").map(G=>G+G).join(""));const c=parseInt(_,16),M=c>>16&255,k=c>>8&255,j=c&255;return[M,k,j]},n.rgb.hcg=function(d){const g=d[0]/255,_=d[1]/255,c=d[2]/255,M=Math.max(Math.max(g,_),c),k=Math.min(Math.min(g,_),c),j=M-k;let G,ee;return j<1?G=k/(1-j):G=0,j<=0?ee=0:M===g?ee=(_-c)/j%6:M===_?ee=2+(c-g)/j:ee=4+(g-_)/j,ee/=6,ee%=1,[ee*360,j*100,G*100]},n.hsl.hcg=function(d){const g=d[1]/100,_=d[2]/100,c=_<.5?2*g*_:2*g*(1-_);let M=0;return c<1&&(M=(_-.5*c)/(1-c)),[d[0],c*100,M*100]},n.hsv.hcg=function(d){const g=d[1]/100,_=d[2]/100,c=g*_;let M=0;return c<1&&(M=(_-c)/(1-c)),[d[0],c*100,M*100]},n.hcg.rgb=function(d){const g=d[0]/360,_=d[1]/100,c=d[2]/100;if(_===0)return[c*255,c*255,c*255];const M=[0,0,0],k=g%1*6,j=k%1,G=1-j;let ee=0;switch(Math.floor(k)){case 0:M[0]=1,M[1]=j,M[2]=0;break;case 1:M[0]=G,M[1]=1,M[2]=0;break;case 2:M[0]=0,M[1]=1,M[2]=j;break;case 3:M[0]=0,M[1]=G,M[2]=1;break;case 4:M[0]=j,M[1]=0,M[2]=1;break;default:M[0]=1,M[1]=0,M[2]=G}return ee=(1-_)*c,[(_*M[0]+ee)*255,(_*M[1]+ee)*255,(_*M[2]+ee)*255]},n.hcg.hsv=function(d){const g=d[1]/100,_=d[2]/100,c=g+_*(1-g);let M=0;return c>0&&(M=g/c),[d[0],M*100,c*100]},n.hcg.hsl=function(d){const g=d[1]/100,_=d[2]/100*(1-g)+.5*g;let c=0;return _>0&&_<.5?c=g/(2*_):_>=.5&&_<1&&(c=g/(2*(1-_))),[d[0],c*100,_*100]},n.hcg.hwb=function(d){const g=d[1]/100,_=d[2]/100,c=g+_*(1-g);return[d[0],(c-g)*100,(1-c)*100]},n.hwb.hcg=function(d){const g=d[1]/100,_=1-d[2]/100,c=_-g;let M=0;return c<1&&(M=(_-c)/(1-c)),[d[0],c*100,M*100]},n.apple.rgb=function(d){return[d[0]/65535*255,d[1]/65535*255,d[2]/65535*255]},n.rgb.apple=function(d){return[d[0]/255*65535,d[1]/255*65535,d[2]/255*65535]},n.gray.rgb=function(d){return[d[0]/100*255,d[0]/100*255,d[0]/100*255]},n.gray.hsl=function(d){return[0,0,d[0]]},n.gray.hsv=n.gray.hsl,n.gray.hwb=function(d){return[0,100,d[0]]},n.gray.cmyk=function(d){return[0,0,0,d[0]]},n.gray.lab=function(d){return[d[0],0,0]},n.gray.hex=function(d){const g=Math.round(d[0]/100*255)&255,_=((g<<16)+(g<<8)+g).toString(16).toUpperCase();return"000000".substring(_.length)+_},n.rgb.gray=function(d){return[(d[0]+d[1]+d[2])/3/255*100]},ex}var tx,MS;function rB(){if(MS)return tx;MS=1;const i=jM();function e(){const g={},_=Object.keys(i);for(let c=_.length,M=0;M<c;M++)g[_[M]]={distance:-1,parent:null};return g}function n(g){const _=e(),c=[g];for(_[g].distance=0;c.length;){const M=c.pop(),k=Object.keys(i[M]);for(let j=k.length,G=0;G<j;G++){const ee=k[G],Y=_[ee];Y.distance===-1&&(Y.distance=_[M].distance+1,Y.parent=M,c.unshift(ee))}}return _}function o(g,_){return function(c){return _(g(c))}}function d(g,_){const c=[_[g].parent,g];let M=i[_[g].parent][g],k=_[g].parent;for(;_[k].parent;)c.unshift(_[k].parent),M=o(i[_[k].parent][k],M),k=_[k].parent;return M.conversion=c,M}return tx=function(g){const _=n(g),c={},M=Object.keys(_);for(let k=M.length,j=0;j<k;j++){const G=M[j];_[G].parent!==null&&(c[G]=d(G,_))}return c},tx}var nx,IS;function aB(){if(IS)return nx;IS=1;const i=jM(),e=rB(),n={},o=Object.keys(i);function d(_){const c=function(...M){const k=M[0];return k==null?k:(k.length>1&&(M=k),_(M))};return"conversion"in _&&(c.conversion=_.conversion),c}function g(_){const c=function(...M){const k=M[0];if(k==null)return k;k.length>1&&(M=k);const j=_(M);if(typeof j=="object")for(let G=j.length,ee=0;ee<G;ee++)j[ee]=Math.round(j[ee]);return j};return"conversion"in _&&(c.conversion=_.conversion),c}return o.forEach(_=>{n[_]={},Object.defineProperty(n[_],"channels",{value:i[_].channels}),Object.defineProperty(n[_],"labels",{value:i[_].labels});const c=e(_);Object.keys(c).forEach(M=>{const k=c[M];n[_][M]=g(k),n[_][M].raw=d(k)})}),nx=n,nx}var sB=aB();const oB=nB(sB);function PS({gl:i,type:e,source:n}){const o=i.createShader(e);if(o===null)throw new Error("Cannot create shader");if(i.shaderSource(o,n),i.compileShader(o),!i.getShaderParameter(o,i.COMPILE_STATUS))throw console.error("Shader compilation error:",i.getShaderInfoLog(o)),i.deleteShader(o),new Error("Cannot compile shader");return o}function lB({gl:i,vertexShaderSource:e,fragmentShaderSource:n}){const o=PS({gl:i,type:i.VERTEX_SHADER,source:e}),d=PS({gl:i,type:i.FRAGMENT_SHADER,source:n}),g=i.createProgram();if(i.attachShader(g,o),i.attachShader(g,d),i.linkProgram(g),!i.getProgramParameter(g,i.LINK_STATUS))throw console.error("Error: ",i.getProgramInfoLog(g)),new Error("Cannot link shader program");return g}function uB(i,e,n){const o=i.getUniformLocation(e,n);if(o===null)throw new Error(`Cannot get uniform location for ${n}`);return o}function UM({gl:i,vertexShaderSource:e,fragmentShaderSource:n,attributesKeys:o,uniformsKeys:d,vertices:g,indices:_}){const c=lB({gl:i,vertexShaderSource:e,fragmentShaderSource:n}),M=o.reduce((Y,xe)=>(Y[xe]=i.getAttribLocation(c,`a_${xe}`),Y),{}),k=d.reduce((Y,xe)=>(Y[xe]=uB(i,c,`u_${xe}`),Y),{}),j=i.createBuffer();i.bindBuffer(i.ARRAY_BUFFER,j),i.bufferData(i.ARRAY_BUFFER,new Float32Array(g),i.STATIC_DRAW);let G,ee;return _!==void 0&&(G=i.createBuffer(),ee=_.length,i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,G),i.bufferData(i.ELEMENT_ARRAY_BUFFER,new Uint16Array(_),i.STATIC_DRAW)),{shaderProgram:c,programInfo:{attributesLocations:M,uniformsLocations:k},positionBuffer:j,indexBuffer:G,indexBufferLength:ee}}function Xv(i){if(!i)return[1,1,1,0];if(i==="transparent")return[1,1,1,0];try{const e=cB(i),n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})?$/i.exec(e);if(n!=null&&n.length){const d=!!n[4];return[...oB.hex.rgb(e).map(g=>g/255),d?parseInt(n[4],16)/255:1]}const o=e.match(/(\d\.\d(\d+)?|\d{3}|\d{2}|\d{1})/gi)??["0","0","0"];if(e.includes("rgb")){const d=e.includes("rgba"),g=[...o.map(_=>parseFloat(_)).map((_,c)=>c<3?_/255:_)];return d||g.push(1),g}}catch{}return console.warn([`[parseColorStringToVec4]: Color ${i} is either not a valid color or its type is not supported, defaulting to black`]),[0,0,0,1]}let p_;function cB(i){return p_=p_??document.createElement("canvas").getContext("2d"),p_?(p_.fillStyle=i,p_.fillStyle):"#000000"}const zw=1,Pc=zw/2,Rc=zw/2,Lc=zw/2,hB=[-.5,-.5,Lc,Pc,-.5,Lc,Pc,Rc,Lc,-.5,Rc,Lc],dB=[-.5,-.5,-.5,-.5,Rc,-.5,Pc,Rc,-.5,Pc,-.5,-.5],fB=[-.5,Rc,-.5,-.5,Rc,Lc,Pc,Rc,Lc,Pc,Rc,-.5],pB=[-.5,-.5,-.5,Pc,-.5,-.5,Pc,-.5,Lc,-.5,-.5,Lc],mB=[Pc,-.5,-.5,Pc,Rc,-.5,Pc,Rc,Lc,Pc,-.5,Lc],gB=[-.5,-.5,-.5,-.5,-.5,Lc,-.5,Rc,Lc,-.5,Rc,-.5],_B=[...hB,...dB,...fB,...pB,...mB,...gB],yB=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23],vB=`attribute vec3 a_vertexPosition;
varying vec3 vTextureCoord;

uniform mat4 u_projectionMatrix;
uniform mat4 u_modelViewMatrix;
  
void main(void) {
  vTextureCoord = vec3(-a_vertexPosition.x, a_vertexPosition.y, a_vertexPosition.z);
  gl_Position = u_projectionMatrix * u_modelViewMatrix * vec4(a_vertexPosition, 1.0);
}
`,RS=`precision mediump float;

varying vec3 vTextureCoord;

%USE_TEXTURE_MACRO_MARKER%

# ifdef USE_TEXTURE
uniform samplerCube u_cubeSampler;
uniform float u_fadeOpacity;
# endif

uniform vec4 u_bgColor;

void main(void) {
  #ifdef USE_TEXTURE
  vec4 texColor = textureCube(u_cubeSampler, vTextureCoord);

    gl_FragColor = mix(
      u_bgColor,
      texColor,
      min(texColor.a, u_fadeOpacity)
    );

    gl_FragColor.a = max(gl_FragColor.a, u_fadeOpacity);

  #else
  gl_FragColor = u_bgColor;
  #endif
}
`,Rp={stars:{color:"hsl(233,100%,92%)",preset:"stars"},space:{color:"hsl(210, 100%, 4%)",preset:"space"},milkyway:{color:"hsl(233,100%,92%)",preset:"milkyway"},"milkyway-subtle":{color:"hsl(233,100%,92%)",preset:"milkyway-subtle"},"milkyway-bright":{color:"hsl(233,100%,92%)",preset:"milkyway-bright"},"milkyway-colored":{color:"black",preset:"milkyway-colored"}};var wp=(i=>(i.POSITIVE_X="pX",i.NEGATIVE_X="nX",i.POSITIVE_Y="pY",i.NEGATIVE_Y="nY",i.POSITIVE_Z="pZ",i.NEGATIVE_Z="nZ",i))(wp||{});let Tv,LS,kS;function bB({gl:i,faces:e,onReady:n,forceRefresh:o}){Tv&&!o&&kS===JSON.stringify(e)&&n(Tv,LS),kS=JSON.stringify(e);const d=Tv??i.createTexture();if(i.bindTexture(i.TEXTURE_CUBE_MAP,d),!e){console.warn("[CubemapLayer][loadCubemapTexture]: Faces are null");return}const g=Object.keys(e).length;if(g!==6){console.warn(`[CubemapLayer][loadCubemapTexture]: Faces should contain exactly 6 images, but found ${g}`);return}const _=Object.entries(e).map(([c,M])=>new Promise((k,j)=>{const G=c;if(M===void 0){j(new Error(`[CubemapLayer][loadCubemapTexture]: Face ${c} is undefined`));return}const ee=new Image;ee.crossOrigin="anonymous";const Y=()=>{k({image:ee,key:G})};ee.src=M,ee.complete&&ee.naturalWidth>0?Y():ee.onload=Y,ee.onerror=()=>{j(new Error(`[CubemapLayer][loadCubemapTexture]: Error loading image ${M}`))}}));Promise.all(_).then(c=>{for(let k=0;k<c.length;k++){const j=i.RGBA,G=i.RGBA,ee=i.UNSIGNED_BYTE,{image:Y,key:xe}=c[k]??{};if(!Y||!xe){console.warn("[CubemapLayer][loadCubemapTexture]: Image or key is null");continue}const be=xB(i,xe);i.bindTexture(i.TEXTURE_CUBE_MAP,d),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texImage2D(be,0,j,G,ee,Y)}i.bindTexture(i.TEXTURE_CUBE_MAP,d),i.generateMipmap(i.TEXTURE_CUBE_MAP),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_MIN_FILTER,i.LINEAR_MIPMAP_LINEAR),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_MAG_FILTER,i.LINEAR);const M=c.map(k=>k.image);n(d,M),LS=M,Tv=d}).catch(c=>{console.error("[CubemapLayer][loadCubemapTexture]: Error loading cubemap texture",c)})}function xB(i,e){if(e===wp.POSITIVE_X)return i.TEXTURE_CUBE_MAP_POSITIVE_X;if(e===wp.NEGATIVE_X)return i.TEXTURE_CUBE_MAP_NEGATIVE_X;if(e===wp.POSITIVE_Y)return i.TEXTURE_CUBE_MAP_POSITIVE_Y;if(e===wp.NEGATIVE_Y)return i.TEXTURE_CUBE_MAP_NEGATIVE_Y;if(e===wp.POSITIVE_Z)return i.TEXTURE_CUBE_MAP_POSITIVE_Z;if(e===wp.NEGATIVE_Z)return i.TEXTURE_CUBE_MAP_NEGATIVE_Z;throw new Error(`[CubemapLayer][loadCubemapTexture]: Invalid key ${e}`)}function wB(i,e,n){return[bf(i[0],e[0],n),bf(i[1],e[1],n),bf(i[2],e[2],n),bf(i[3],e[3],n)]}function bf(i,e,n){return i+(e-i)*n}const Lm="https://api.maptiler.com/resources/space",TB=["vertexPosition"],SB=["projectionMatrix","modelViewMatrix","cubeSampler","bgColor","fadeOpacity"],DS="%USE_TEXTURE_MACRO_MARKER%",EB="#define USE_TEXTURE",zS=Rp.stars;function AB(i,e){if(!$M(i))return{color:"transparent"};if(i===!0)return e;const n={...i};if(i.faces||i.path)return delete n.preset,n;const o=i.preset;if(o!==void 0&&!(o in Rp))throw new Error(`[CubemapLayer]: Invalid preset "${o}". Available presets: ${Object.keys(Rp).join(", ")}`);return{...n,color:n.color??Rp[o].color??"hsl(233,100%,92%)"}}class ix{constructor(e){rn(this,"id","Cubemap Layer"),rn(this,"type","custom"),rn(this,"renderingMode","3d"),rn(this,"map"),rn(this,"faces"),rn(this,"useCubemapTexture",!0),rn(this,"currentFadeOpacity",0),rn(this,"cubeMapNeedsUpdate",!1),rn(this,"bgColor"),rn(this,"previousBgColor",[0,0,0,0]),rn(this,"targetBgColor",[0,0,0,0]),rn(this,"transitionDelta",0),rn(this,"gl"),rn(this,"cubemap"),rn(this,"texture"),rn(this,"currentFacesDefinitionKey",""),rn(this,"options"),rn(this,"animationActive",!0),rn(this,"imageIsAnimating",!1),rn(this,"imageFadeInDelta",0);const n=AB(e,zS);this.options=n,this.currentFacesDefinitionKey=JSON.stringify(n.faces??n.preset??n.path),this.bgColor=[0,0,0,0],this.targetBgColor=Xv(n.color),this.faces=OS(n),this.useCubemapTexture=this.faces!==null}updateCubemap({facesNeedUpdate:e}={facesNeedUpdate:!0}){this.useCubemapTexture=this.faces!==null;const n=SB.filter(o=>o==="cubeSampler"||o==="fadeOpacity"?this.useCubemapTexture:!0);this.cubemap=UM({gl:this.gl,vertexShaderSource:vB,fragmentShaderSource:this.useCubemapTexture?RS.replace(DS,EB):RS.replace(DS,""),attributesKeys:TB,uniformsKeys:n,vertices:_B,indices:yB}),this.cubeMapNeedsUpdate=e,this.useCubemapTexture&&this.updateTexture(this.gl,this.faces),this.animateColorChange()}onAdd(e,n){this.map=e,this.gl=n,this.updateCubemap()}onRemove(e,n){this.cubemap&&(n.deleteProgram(this.cubemap.shaderProgram),n.deleteBuffer(this.cubemap.positionBuffer))}updateTexture(e,n){if(this.cubeMapNeedsUpdate===!0&&!this.imageIsAnimating){if(this.cubeMapNeedsUpdate=!1,!this.useCubemapTexture)return;bB({gl:e,faces:n,onReady:o=>{this.texture=o,this.animateIn()}})}}prerender(e,n){this.faces&&this.updateTexture(this.gl,this.faces)}animateColorChange(){const e=()=>{this.transitionDelta<1&&(requestAnimationFrame(e),this.bgColor=wB(this.previousBgColor,this.targetBgColor,this.transitionDelta),this.transitionDelta+=.075,this.map.triggerRepaint())};requestAnimationFrame(e)}async animateIn(){if(!this.imageIsAnimating){if(!this.animationActive){this.currentFadeOpacity=1,this.imageFadeInDelta=1,this.map.triggerRepaint();return}return new Promise(e=>{this.imageIsAnimating=!0;const n=()=>{if(this.imageFadeInDelta=Math.min(this.imageFadeInDelta+.05,1),this.currentFadeOpacity=bf(0,1,this.imageFadeInDelta),this.map.triggerRepaint(),this.imageFadeInDelta<1){requestAnimationFrame(n);return}this.imageIsAnimating=!1,this.imageFadeInDelta=0,e()};requestAnimationFrame(n)})}}async animateOut(){if(!(this.imageIsAnimating||!this.animationActive))return new Promise(e=>{const n=()=>{if(this.imageFadeInDelta=Math.min(this.imageFadeInDelta+.05,1),this.currentFadeOpacity=bf(1,0,this.imageFadeInDelta),this.map.triggerRepaint(),this.imageFadeInDelta>=1){this.imageIsAnimating=!1,this.imageFadeInDelta=0,e();return}requestAnimationFrame(n)};requestAnimationFrame(n)})}setAnimationActive(e){this.animationActive=e}render(e,n){if(!this.map.isGlobeProjection())return;if(this.map===void 0)throw new Error("[CubemapLayer]: Map is undefined");if(this.cubemap===void 0)throw new Error("[CubemapLayer]: Cubemap is undefined");this.texture,e.disable(e.DEPTH_TEST),e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.DST_ALPHA),e.useProgram(this.cubemap.shaderProgram),e.bindBuffer(e.ARRAY_BUFFER,this.cubemap.positionBuffer),e.vertexAttribPointer(this.cubemap.programInfo.attributesLocations.vertexPosition,3,e.FLOAT,!1,0,0),e.enableVertexAttribArray(this.cubemap.programInfo.attributesLocations.vertexPosition);const o=.1,d=1e4,g=e.canvas,_=g.clientWidth/g.clientHeight,c=this.map.transform,M=c.fov*(Math.PI/180),k=D_();eB(k,M,_,o,d),TS(k,k,c.rollInRadians),wS(k,k,-c.pitchInRadians),TS(k,k,c.bearingInRadians);const j=c.center.lat*Math.PI/180,G=c.center.lng*Math.PI/180;wS(k,k,j),QN(k,k,-G),e.uniformMatrix4fv(this.cubemap.programInfo.uniformsLocations.projectionMatrix,!1,k);const ee=D_();if(e.uniformMatrix4fv(this.cubemap.programInfo.uniformsLocations.modelViewMatrix,!1,ee),e.uniform4fv(this.cubemap.programInfo.uniformsLocations.bgColor,new Float32Array(this.bgColor)),e.uniform1f(this.cubemap.programInfo.uniformsLocations.fadeOpacity,this.currentFadeOpacity),this.useCubemapTexture&&this.texture&&(e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_CUBE_MAP,this.texture),e.uniform1i(this.cubemap.programInfo.uniformsLocations.cubeSampler,0)),this.cubemap.indexBuffer===void 0)throw new Error("Index buffer is undefined");if(this.cubemap.indexBufferLength===void 0)throw new Error("Index buffer length is undefined");e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.cubemap.indexBuffer),e.drawElements(e.TRIANGLES,this.cubemap.indexBufferLength,e.UNSIGNED_SHORT,0)}setBgColor(e){this.targetBgColor=e,this.previousBgColor=this.bgColor,this.transitionDelta=0}getConfig(){return this.options}async setCubemapFaces(e){if(await this.animateOut(),!e.faces&&!e.preset&&!e.path){this.faces=null,this.useCubemapTexture=!1,this.currentFacesDefinitionKey="empty",await this.animateIn();return}this.faces=OS(e),this.currentFacesDefinitionKey=JSON.stringify(e.faces??e.preset??e.path)}async setCubemap(e){const n=typeof e=="boolean"?zS:e;this.options=n;const o=JSON.stringify(n.faces??n.preset??n.path),d=this.currentFacesDefinitionKey!==o;d&&(await this.setCubemapFaces(n),this.cubeMapNeedsUpdate=!0);const g=Xv(n.color);if(n.color&&this.targetBgColor.toString()!==g.toString())this.setBgColor(g);else if(!n.color&&n.preset&&n.preset in Rp){const _=Rp[n.preset];this.setBgColor(Xv(_.color))}this.updateCubemap({facesNeedUpdate:d})}show(){this.map.setLayoutProperty(this.id,"visibility","visible")}hide(){this.map.setLayoutProperty(this.id,"visibility","none")}}function $M(i){return i?typeof i=="boolean"?!0:!(!i.path&&!i.preset&&!i.faces&&!i.color||i.preset&&!(i.preset in Rp)||i.faces&&(!i.faces.pX||!i.faces.nX||!i.faces.pY||!i.faces.nY||!i.faces.pZ||!i.faces.nZ)):!1}function OS(i){if(i.faces)return i.faces;if(i.preset)return{pX:`${Lm}/${i.preset}/px.webp`,nX:`${Lm}/${i.preset}/nx.webp`,pY:`${Lm}/${i.preset}/py.webp`,nY:`${Lm}/${i.preset}/ny.webp`,pZ:`${Lm}/${i.preset}/pz.webp`,nZ:`${Lm}/${i.preset}/nz.webp`};if(i.path){const e=i.path.baseUrl,n=i.path.format??"png";return{pX:`${e}/px.${n}`,nX:`${e}/nx.${n}`,pY:`${e}/py.${n}`,nY:`${e}/ny.${n}`,pZ:`${e}/pz.${n}`,nZ:`${e}/nz.${n}`}}return null}const CB=`attribute vec3 a_position;

uniform mat4 u_matrix;
uniform mat4 u_rotationMatrix;

uniform float u_scale;

varying vec2 v_pos;
varying float v_scale;

void main() {
  v_scale = u_scale;
  v_pos = a_position.xy * u_scale;
  gl_Position = u_matrix * u_rotationMatrix * vec4(a_position, 1.0);
}
`,MB=`precision mediump float;
varying vec2 v_pos;
      
uniform int u_stopsNumber;
uniform float u_stops[100];
uniform vec4 u_colors[100];
uniform float u_maxDistance;

varying float v_scale;

const float EPSILON = 0.000001;

vec2 center = vec2(0.0, 0.0);
void main() {
  float rawDistance = distance(center, v_pos);
  float distanceFromGlobeEdge = rawDistance - 1.0;

    vec4 color = u_colors[0];

  // if we're further than the max distance, we should not render anything.
  // This is to always render a circle, otherwise we end up rendering
  // to the corners of the plane.
  if (distance(center, v_pos) > u_maxDistance * v_scale) {
    discard;
  }

  for (int i = 1; i < 100; i++) {
    // if we're past the last stop
    // we should fill to the end with the last stop color
    if (i >= u_stopsNumber) {
      color = u_colors[i - 1];
      break;
    }

    float scaledStopPosition = u_stops[i] * pow(v_scale, 1.6);
    float lastStopValue = u_stops[i - 1];
    float thisStopValue = u_stops[i];

    // this is to avoid blending errors when the stops are the same
    // eg when you would want a sharp edge between two stops.
    // \`numbersAreEqual\` will be 1.0 if the numbers are equal, 0.0 if they are not.
    // We then subtract EPSILON from the last stop making the stop value _almost_ equal
    // to the next stop but not enough to cause blending issues.
    // It's more efficient to do this than an if / else statement.
    float numbersAreEqual = 1.0 - step(EPSILON, abs(lastStopValue - thisStopValue));
    lastStopValue = lastStopValue - numbersAreEqual * EPSILON;

    float lastScaledStopPosition = lastStopValue * pow(v_scale, 1.6);

    if (distanceFromGlobeEdge <= scaledStopPosition) {
      float stopBlendFactor = (distanceFromGlobeEdge - lastScaledStopPosition) / (scaledStopPosition - lastScaledStopPosition);
      color = mix(u_colors[i - 1], u_colors[i], stopBlendFactor);
      break;
    }
  }
  
  // gl_FragColor = color;
  gl_FragColor = vec4(color.rgb * color.a, color.a);
}
`,S_=2,IB=["position"],PB=["matrix","rotationMatrix","stopsNumber","stops","colors","maxDistance","scale"],RB=[-2,-2,0,S_,-2,0,-2,S_,0,S_,S_,0],pp={scale:.9,stops:[[0,"rgba(176, 208, 240, 1)"],[.1,"rgba(98, 168, 229, 0.3)"],[.2,"rgba(98, 168, 229, 0.0)"]]},NS=.06;class rx{constructor(e){if(rn(this,"id","Halo Layer"),rn(this,"type","custom"),rn(this,"renderingMode","3d"),rn(this,"gradient"),rn(this,"scale",0),rn(this,"animationDelta",0),rn(this,"map"),rn(this,"plane"),rn(this,"animationActive",!0),typeof e=="boolean"){this.gradient=pp;return}this.gradient={...pp,...e}}onAdd(e,n){this.map=e,this.plane=UM({gl:n,vertexShaderSource:CB,fragmentShaderSource:MB,attributesKeys:IB,uniformsKeys:PB,vertices:RB}),this.animateIn()}getConfig(){return this.gradient}async animateIn(){if(!this.animationActive){this.scale=this.gradient.scale,this.animationDelta=1,this.map.triggerRepaint();return}return new Promise(e=>{this.animationDelta=0;const n=()=>{if(this.animationDelta<1){this.scale=bf(0,this.gradient.scale,this.animationDelta),this.animationDelta+=NS,this.map.triggerRepaint(),requestAnimationFrame(n);return}e()};requestAnimationFrame(n)})}async animateOut(){if(this.animationActive)return this.animationDelta=0,new Promise(e=>{const n=()=>{if(this.animationDelta<1){this.scale=bf(this.gradient.scale,0,this.animationDelta),this.animationDelta+=NS,this.map.triggerRepaint(),requestAnimationFrame(n);return}e()};n()})}onRemove(e,n){this.plane!==void 0&&(n.deleteProgram(this.plane.shaderProgram),n.deleteBuffer(this.plane.positionBuffer))}prerender(e,n){}render(e,n){if(this.map===void 0)throw new Error("[RadialGradientLayer]: Map is undefined");if(!this.map.isGlobeProjection())return;if(this.plane===void 0)throw new Error("[RadialGradientLayer]: Plane is undefined");e.disable(e.DEPTH_TEST),e.enable(e.BLEND),e.useProgram(this.plane.shaderProgram),e.bindBuffer(e.ARRAY_BUFFER,this.plane.positionBuffer);const o=this.plane.programInfo.attributesLocations.position;e.enableVertexAttribArray(o),e.vertexAttribPointer(o,3,e.FLOAT,!1,0,0);const d=D_(),g=this.scale;YN(d,d,[g,g,g]);const _=D_();KN(_,n.defaultProjectionData.mainMatrix,d);const c=this.plane.programInfo.uniformsLocations.matrix;e.uniformMatrix4fv(c,!1,_);const M=D_(),k=this.map.transform.cameraPosition,j=Jb(Hv(),k),G=tB(0,1,0),ee=Hv();SS(ee,G,j),Jb(ee,ee);const Y=Hv();SS(Y,j,ee),Jb(Y,Y),WN(M,ee[0],ee[1],ee[2],0,Y[0],Y[1],Y[2],0,j[0],j[1],j[2],0,0,0,0,1);const xe=this.plane.programInfo.uniformsLocations.rotationMatrix;e.uniformMatrix4fv(xe,!1,M);const be=this.gradient.stops.length,Ne=[],tt=[];for(let Je=0;Je<=be;Je++)if(Je<be){Ne[Je]=this.gradient.stops[Je][0];const qe=Xv(this.gradient.stops[Je][1]);tt.push(...qe)}e.uniform1i(this.plane.programInfo.uniformsLocations.stopsNumber,be),e.uniform1fv(this.plane.programInfo.uniformsLocations.stops,new Float32Array(Ne)),e.uniform4fv(this.plane.programInfo.uniformsLocations.colors,new Float32Array(tt)),e.uniform1f(this.plane.programInfo.uniformsLocations.maxDistance,S_),e.uniform1f(this.plane.programInfo.uniformsLocations.scale,g),e.drawArrays(e.TRIANGLE_STRIP,0,4)}async setGradient(e){if(e===!1){await this.animateOut();return}if(await this.animateOut(),!LB(e)){this.gradient.scale=pp.scale,this.gradient.stops=[[0,"transparent"],[1,"transparent"]];return}e===!0?(this.gradient.scale=pp.scale,this.gradient.stops=pp.stops):(this.gradient.scale=e.scale??pp.scale,this.gradient.stops=e.stops??pp.stops),await this.animateIn()}setAnimationActive(e){this.animationActive=e}show(){this.map.setLayoutProperty(this.id,"visibility","visible")}hide(){this.map.setLayoutProperty(this.id,"visibility","none")}}function LB(i){return typeof i=="boolean"?!0:!(typeof i.scale!="number"||!i.stops||i.stops.length===0||i.stops.some(e=>typeof e[0]!="number"||typeof e[1]!="string"))}const kB={POINT:"POINT",COUNTRY:"COUNTRY"};let qM=class GM extends wn.Map{constructor(e){pO(e.container),e.apiKey&&(Ka.apiKey=e.apiKey);const{style:n,requiresUrlMonitoring:o,isFallback:d}=vS(e.style);d&&console.warn("Invalid style. A style must be a valid URL to a style.json, a JSON string representing a valid StyleSpecification or a valid StyleSpecification object. Fallback to default MapTiler style."),Ka.apiKey||console.warn("MapTiler Cloud API key is not set. Visit https://maptiler.com and try Cloud for free!");const g=location.hash;let _={compact:!1};e.customAttribution?_.customAttribution=e.customAttribution:e.attributionControl&&typeof e.attributionControl=="object"&&(_={..._,...e.attributionControl});const c={...e,style:n,maplibreLogo:!1,transformRequest:KT(e.transformRequest),attributionControl:e.forceNoAttributionControl===!0?!1:_};delete c.style,super(c),rn(this,"telemetry"),rn(this,"space"),rn(this,"halo"),rn(this,"options"),rn(this,"isTerrainEnabled",!1),rn(this,"terrainExaggeration",1),rn(this,"primaryLanguage"),rn(this,"terrainGrowing",!1),rn(this,"terrainFlattening",!1),rn(this,"minimap"),rn(this,"forceLanguageUpdate"),rn(this,"languageAlwaysBeenStyle"),rn(this,"isReady",!1),rn(this,"terrainAnimationDuration",1e3),rn(this,"monitoredStyleUrls"),rn(this,"styleInProcess",!1),rn(this,"curentProjection"),rn(this,"originalLabelStyle",new window.Map),rn(this,"isStyleLocalized",!1),rn(this,"languageIsUpdated",!1),rn(this,"spaceboxLoadingState",{styleLoadCallbackSet:!1}),this.options=e,this.setStyle(n),o&&this.monitorStyleUrl(n);const M=()=>{let Y="The distant style could not be loaded.";this.getStyle()?Y+="Leaving the style as is.":(this.setStyle(R_.STREETS),Y+=`Loading default MapTiler Cloud style "${R_.STREETS.getDefaultVariant().getId()}" as a fallback.`),console.warn(Y)};if(this.on("style.load",()=>{this.styleInProcess=!1}),this.on("error",Y=>{if(Y.error instanceof wn.AJAXError){const xe=Y.error.url,be=new URL(xe);be.search="";const Ne=be.href;this.monitoredStyleUrls&&this.monitoredStyleUrls.has(Ne)&&(this.monitoredStyleUrls.delete(Ne),M());return}if(this.styleInProcess){M();return}}),Ka.caching&&!qx&&console.warn("The cache API is only available in secure contexts. More info at https://developer.mozilla.org/en-US/docs/Web/API/Cache"),Ka.caching&&qx&&uO(),typeof e.language>"u")this.primaryLanguage=Ka.primaryLanguage;else{const Y=OT(e.language,Qi);this.primaryLanguage=Y??Ka.primaryLanguage}this.forceLanguageUpdate=!(this.primaryLanguage===Qi.STYLE||this.primaryLanguage===Qi.STYLE_LOCK),this.languageAlwaysBeenStyle=this.primaryLanguage===Qi.STYLE,this.terrainExaggeration=e.terrainExaggeration??this.terrainExaggeration,this.curentProjection=e.projection,this.on("styledata",()=>{this.curentProjection==="mercator"?this.setProjection({type:"mercator"}):this.curentProjection==="globe"&&this.setProjection({type:"globe"})}),this.once("styledata",async()=>{if(!e.geolocate||e.center||e.hash&&g)return;try{if(e.geolocate===kB.COUNTRY){await this.fitToIpBounds();return}}catch(xe){console.warn(xe.message)}let Y;try{await this.centerOnIpPoint(e.zoom),Y=this.getCameraHash()}catch(xe){console.warn(xe.message)}(await navigator.permissions.query({name:"geolocation"})).state==="granted"&&navigator.geolocation.getCurrentPosition(xe=>{Y===this.getCameraHash()&&(this.terrain?this.easeTo({center:[xe.coords.longitude,xe.coords.latitude],zoom:e.zoom||12,duration:2e3}):this.once("terrain",()=>{this.easeTo({center:[xe.coords.longitude,xe.coords.latitude],zoom:e.zoom||12,duration:2e3})}))},null,{maximumAge:24*3600*1e3,timeout:5e3,enableHighAccuracy:!1})}),this.on("styledata",()=>{this.setPrimaryLanguage(this.primaryLanguage)}),this.on("styledata",()=>{this.getTerrain()===null&&this.isTerrainEnabled&&this.enableTerrain(this.terrainExaggeration)}),this.once("load",async()=>{let Y={logo:null};try{const xe=Object.keys(this.style.sourceCaches).map(Ne=>this.getSource(Ne)).filter(Ne=>Ne&&"url"in Ne&&typeof Ne.url=="string"&&Ne.url.includes("tiles.json")),be=new URL(xe[0].url);be.searchParams.has("key")||be.searchParams.append("key",Ka.apiKey),Y=await(await fetch(be.href)).json()}catch{}if(e.customControls){const xe="[data-maptiler-control-group]",be="[data-maptiler-control]",Ne=Ue=>{let Be=Ue.dataset.maptilerControl;return(Be==="true"||Be==="")&&(Be=void 0),Be},tt=Ue=>Ue.dataset.maptilerPosition;let Je=[...this._container.ownerDocument.querySelectorAll(xe)],qe=[...this._container.ownerDocument.querySelectorAll(be)].filter(Ue=>Ue.closest(xe)===null);if(typeof e.customControls=="string"){const Ue=e.customControls;Je=Je.filter(Be=>Be.matches(Ue)||Be.closest(Ue)!==null),qe=qe.filter(Be=>Be.matches(Ue)||Be.closest(Ue)!==null)}for(const Ue of Je){const Be=new Jx(Ue);this.addControl(Be,tt(Ue));for(const de of Ue.querySelectorAll(be))Be.configureGroupItem(de,Ne(de))}for(const Ue of qe)this.addControl(new Jx(Ue,Ne(Ue)),tt(Ue));const He=()=>{const{lng:Ue,lat:Be}=this.getCenter();this._container.style.setProperty("--maptiler-center-lng",String(Ue)),this._container.style.setProperty("--maptiler-center-lat",String(Be)),this._container.style.setProperty("--maptiler-zoom",String(this.getZoom())),this._container.style.setProperty("--maptiler-bearing",String(this.getBearing())),this._container.style.setProperty("--maptiler-pitch",String(this.getPitch())),this._container.style.setProperty("--maptiler-roll",String(this.getRoll())),this._container.style.setProperty("--maptiler-is-globe-projection",String(this.isGlobeProjection())),this._container.style.setProperty("--maptiler-has-terrain",String(this.hasTerrain()))};He(),this.on("render",He)}if(e.forceNoAttributionControl!==!0)if("logo"in Y&&Y.logo){const xe=Y.logo;this.addControl(new QT({logoURL:xe}),e.logoPosition)}else e.maptilerLogo&&this.addControl(new QT,e.logoPosition);if(e.scaleControl){const xe=e.scaleControl===!0||e.scaleControl===void 0?"bottom-right":e.scaleControl,be=new EO({unit:Ka.unit});this.addControl(be,xe),Ka.on("unit",Ne=>{be.setUnit(Ne)})}if(e.navigationControl!==!1){const xe=e.navigationControl===!0||e.navigationControl===void 0?"top-right":e.navigationControl;this.addControl(new $N,xe)}if(e.geolocateControl!==!1){const xe=e.geolocateControl===!0||e.geolocateControl===void 0?"top-right":e.geolocateControl;this.addControl(new GN({positionOptions:{enableHighAccuracy:!0,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!0,showAccuracyCircle:!0,showUserLocation:!0}),xe)}if(e.terrainControl){const xe=e.terrainControl===!0||e.terrainControl===void 0?"top-right":e.terrainControl;this.addControl(new UN,xe)}if(e.projectionControl){const xe=e.projectionControl===!0||e.projectionControl===void 0?"top-right":e.projectionControl;this.addControl(new HN,xe)}if(e.fullscreenControl){const xe=e.fullscreenControl===!0||e.fullscreenControl===void 0?"top-right":e.fullscreenControl;this.addControl(new AO({}),xe)}this.isReady=!0,this.fire("ready",{target:this})});let k=!1,j=!1,G;this.once("ready",()=>{k=!0,j&&this.fire("loadWithTerrain",G)}),this.once("style.load",()=>{const{minimap:Y}=e;if(typeof Y=="object"){const{zoom:xe,center:be,style:Ne,language:tt,apiKey:Je,maptilerLogo:qe,canvasContextAttributes:He,refreshExpiredTiles:Ue,maxBounds:Be,scrollZoom:de,minZoom:ce,maxZoom:_e,boxZoom:Ae,locale:Pe,fadeDuration:Ge,crossSourceCollisions:Re,clickTolerance:In,bounds:Jn,fitBoundsOptions:mt,pixelRatio:$t,validateStyle:Tt}=e;this.minimap=new Qb(Y,{zoom:xe,center:be,style:Ne,language:tt,apiKey:Je,container:"null",maptilerLogo:qe,canvasContextAttributes:He,refreshExpiredTiles:Ue,maxBounds:Be,scrollZoom:de,minZoom:ce,maxZoom:_e,boxZoom:Ae,locale:Pe,fadeDuration:Ge,crossSourceCollisions:Re,clickTolerance:In,bounds:Jn,fitBoundsOptions:mt,pixelRatio:$t,validateStyle:Tt}),this.addControl(this.minimap,Y.position??"bottom-left")}else Y===!0?(this.minimap=new Qb({},e),this.addControl(this.minimap,"bottom-left")):Y!==void 0&&Y!==!1&&(this.minimap=new Qb({},e),this.addControl(this.minimap,Y))});const ee=Y=>{Y.terrain&&(j=!0,G={type:"loadWithTerrain",target:this,terrain:Y.terrain},this.off("terrain",ee),k&&this.fire("loadWithTerrain",G))};this.on("terrain",ee),e.terrain&&this.enableTerrain(e.terrainExaggeration??this.terrainExaggeration),this.once("load",()=>{this.getCanvas().addEventListener("webglcontextlost",xe=>{if(this._removed===!0){console.warn("[webglcontextlost]","WebGL context lost after map removal. This is harmless.");return}console.warn("[webglcontextlost]","Unexpected loss of WebGL context!"),this.fire("webglContextLost",xe)});const Y=this.getLayersOrder()[0];e.space&&this.initSpace({options:e,before:Y}),e.halo&&this.initHalo({options:e,before:Y})}),this.telemetry=new XN(this)}getSpace(){return this.space}setSpace(e){if(e===!1){this.space=void 0;return}if(this.isGlobeProjection()){if(this.space){this.space.setCubemap(e),this.getLayer(this.space.id)||this.addLayer(this.space,this.getLayersOrder()[0]);return}this.space=new ix(e),this.once("load",()=>{const n=this.getLayersOrder()[0];this.space&&this.addLayer(this.space,n)})}}enableSpaceAnimations(){this.setSpaceAnimationActive(!0)}disableSpaceAnimations(){this.setSpaceAnimationActive(!1)}enableHaloAnimations(){this.setHaloAnimationActive(!0)}disableHaloAnimations(){this.setHaloAnimationActive(!1)}setHaloAnimationActive(e){this.halo?this.halo.setAnimationActive(e):this.once("load",()=>{var n;(n=this.halo)==null||n.setAnimationActive(e)})}setSpaceAnimationActive(e){this.space?this.space.setAnimationActive(e):this.once("load",()=>{var n;(n=this.space)==null||n.setAnimationActive(e)})}setSpaceFromStyle({style:e}){var n,o,d;if(this.options.space){this.setSpace(this.options.space);return}const g=(o=(n=e.metadata)==null?void 0:n.maptiler)==null?void 0:o.space;if(!g){this.setSpace({color:"transparent"});return}if(!$M(g)){this.setSpace({color:"transparent"});return}if(JSON.stringify((d=this.space)==null?void 0:d.getConfig())===JSON.stringify(g)){if(this.space&&!this.getLayer(this.space.id)){const _=this.getLayersOrder()[0];this.addLayer(this.space,_)}return}(()=>{if(this.space&&this.isGlobeProjection()){if(!this.getLayer(this.space.id)){const _=this.getLayersOrder()[0];this.addLayer(this.space,_)}this.space.setCubemap(g)}})()}setHaloFromStyle({style:e}){var n,o,d;const g=(n=e.metadata)==null?void 0:n.maptiler;if(JSON.stringify((o=this.halo)==null?void 0:o.getConfig())===JSON.stringify(g==null?void 0:g.halo)){if(this.halo&&!this.getLayer(this.halo.id)){const _=this.getLayersOrder().indexOf(((d=this.space)==null?void 0:d.id)??"")+1,c=this.getLayersOrder()[_];this.addLayer(this.halo,c)}return}if(!(g!=null&&g.halo)&&!this.options.halo){this.setHalo({stops:[[0,"transparent"],[1,"transparent"]],scale:1});return}(()=>{var _;if(this.halo){if(!this.getLayer(this.halo.id)){const M=this.getLayersOrder().indexOf(((_=this.space)==null?void 0:_.id)??"")+1,k=this.getLayersOrder()[M];this.addLayer(this.halo,k)}const c=(g==null?void 0:g.halo)??this.options.halo;c&&this.halo.setGradient(c)}})()}initSpace({options:e=this.options,before:n,spec:o}){if(this.space){this.getLayer(this.space.id)||this.addLayer(this.space,n);return}if(e.space===!1)return;const d=o;if(e.space){this.space=new ix(e.space),this.addLayer(this.space,n);return}d&&(this.space=new ix(d),this.addLayer(this.space,n))}initHalo({options:e=this.options,before:n,spec:o}){if(this.halo&&this.getLayer(this.halo.id)||e.halo===!1)return;const d=o;if(e.halo){this.halo=new rx(e.halo),this.addLayer(this.halo,n);return}d&&(this.halo=new rx(d),this.addLayer(this.halo,n))}getHalo(){return this.halo}setHalo(e){if(this.isGlobeProjection()){if(this.halo){this.halo.setGradient(e);return}this.halo=new rx(e),this.once("load",()=>{var n;const o=this.getLayersOrder(),d=o[0],g=o.indexOf(((n=this.space)==null?void 0:n.id)??"")+2,_=o[g];this.halo&&this.addLayer(this.halo,this.space?_:d)})}}recreate(){const e={center:this.getCenter(),zoom:this.getZoom(),bearing:this.getBearing(),pitch:this.getPitch()};this.remove(),Object.assign(this,new GM({...this.options})),this.once("load",()=>{this.jumpTo(e)})}setTerrainAnimationDuration(e){this.terrainAnimationDuration=Math.max(e,0)}async onLoadAsync(){return new Promise(e=>{if(this.loaded()){e(this);return}this.once("load",()=>{e(this)})})}async onReadyAsync(){return new Promise(e=>{if(this.isReady){e(this);return}this.once("ready",()=>{e(this)})})}async onLoadWithTerrainAsync(){return new Promise(e=>{if(this.isReady&&this.terrain){e(this);return}this.once("loadWithTerrain",()=>{e(this)})})}monitorStyleUrl(e){typeof this.monitoredStyleUrls>"u"&&(this.monitoredStyleUrls=new Set);const n=new URL(e);n.search="",this.monitoredStyleUrls.add(n.href)}setStyle(e,n){var o,d,g,_,c;this.originalLabelStyle.clear(),(o=this.minimap)==null||o.setStyle(e),this.forceLanguageUpdate=!0,this.once("idle",()=>{this.forceLanguageUpdate=!1});const M=vS(e);if(M.requiresUrlMonitoring&&this.monitorStyleUrl(M.style),M.isFallback){if(this.getStyle())return console.warn("[Map.setStyle]: Invalid style. A style must be a valid URL to a style.json, a JSON string representing a valid StyleSpecification or a valid StyleSpecification object. Keeping the curent style instead."),this;console.warn("[Map.setStyle]: Invalid style. A style must be a valid URL to a style.json, a JSON string representing a valid StyleSpecification or a valid StyleSpecification object. Fallback to default MapTiler style.")}const k=this.getStyle(),j=M.style;try{super.setStyle(M.style,n),this.styleInProcess=!0}catch(Y){this.styleInProcess=!1,console.error("[Map.setStyle]: Error while setting style:",Y)}const G=()=>{const Y=M.style;if(!Y.projection||Y.projection.type==="mercator"){console.warn("[Map.setStyle]: Neither space nor halo is supported for mercator projection. Ignoring...");return}this.setSpaceFromStyle({style:M.style}),this.setHaloFromStyle({style:M.style})},ee=Y=>{var xe,be,Ne,tt;const Je=(Y==null?void 0:Y.target.getStyle())??M.style,qe=this.getLayersOrder()[0];this.space?this.setSpaceFromStyle({style:Je}):this.initSpace({before:qe,spec:(be=(xe=Je.metadata)==null?void 0:xe.maptiler)==null?void 0:be.space}),this.halo?this.setHaloFromStyle({style:Je}):this.initHalo({before:qe,spec:(tt=(Ne=Je.metadata)==null?void 0:Ne.maptiler)==null?void 0:tt.halo})};if(typeof M.style=="string"||M.requiresUrlMonitoring)return this.on("styledata",ee),this;if(this.styleInProcess&&!this.spaceboxLoadingState.styleLoadCallbackSet)return this.once("style.load",ee),this.once("styledata",ee),this.spaceboxLoadingState.styleLoadCallbackSet=!0,this;if(((d=k==null?void 0:k.terrain)==null?void 0:d.source)!==((g=j==null?void 0:j.terrain)==null?void 0:g.source)||((_=k==null?void 0:k.terrain)==null?void 0:_.exaggeration)!==((c=j==null?void 0:j.terrain)==null?void 0:c.exaggeration))return this.once("terrain",G),this;try{ee()}catch{}return this}addLayer(e,n){var o;return(o=this.minimap)==null||o.addLayer(e,n),super.addLayer(e,n)}moveLayer(e,n){var o;return(o=this.minimap)==null||o.moveLayer(e,n),super.moveLayer(e,n)}removeLayer(e){var n;return(n=this.minimap)==null||n.removeLayer(e),super.removeLayer(e)}setLayerZoomRange(e,n,o){var d;return(d=this.minimap)==null||d.setLayerZoomRange(e,n,o),super.setLayerZoomRange(e,n,o)}setFilter(e,n,o){var d;return(d=this.minimap)==null||d.setFilter(e,n,o),super.setFilter(e,n,o)}setPaintProperty(e,n,o,d){var g;return(g=this.minimap)==null||g.setPaintProperty(e,n,o,d),super.setPaintProperty(e,n,o,d)}setLayoutProperty(e,n,o,d){var g;return(g=this.minimap)==null||g.setLayoutProperty(e,n,o,d),super.setLayoutProperty(e,n,o,d)}setGlyphs(e,n){var o;return(o=this.minimap)==null||o.setGlyphs(e,n),super.setGlyphs(e,n)}getStyleLanguage(){return!this.style||!this.style.stylesheet||!this.style.stylesheet.metadata||typeof this.style.stylesheet.metadata!="object"?null:"maptiler:language"in this.style.stylesheet.metadata&&typeof this.style.stylesheet.metadata["maptiler:language"]=="string"?Fx(this.style.stylesheet.metadata["maptiler:language"]):null}setLanguage(e){var n;(n=this.minimap)==null||n.map.setLanguage(e),this.onStyleReady(()=>{this.setPrimaryLanguage(e)})}setPrimaryLanguage(e){const n=this.getStyleLanguage(),o=OT(e,Qi);if(!o){console.warn(`The language "${o}" is not supported.`);return}if(!(o.flag===Qi.STYLE.flag&&n&&(n.flag===Qi.AUTO.flag||n.flag===Qi.VISITOR.flag))&&(o.flag!==Qi.STYLE.flag&&(this.languageAlwaysBeenStyle=!1),this.languageAlwaysBeenStyle||this.primaryLanguage===o&&!this.forceLanguageUpdate))return;if(this.primaryLanguage.flag===Qi.STYLE_LOCK.flag){console.warn("The language cannot be changed because this map has been instantiated with the STYLE_LOCK language flag.");return}this.primaryLanguage=o;let d=o;if(o.flag===Qi.STYLE.flag){if(!n){console.warn("The style has no default languages or has an invalid one.");return}d=n}let g=Qi.LOCAL.flag,_=["get",g];d.flag===Qi.VISITOR.flag?(g=ZT().flag,_=["case",["all",["has",g],["has",Qi.LOCAL.flag]],["case",["==",["get",g],["get",Qi.LOCAL.flag]],["get",Qi.LOCAL.flag],["format",["get",g],{"font-scale":.8},`
`,["get",Qi.LOCAL.flag],{"font-scale":1.1}]],["get",Qi.LOCAL.flag]]):d.flag===Qi.VISITOR_ENGLISH.flag?(g=Qi.ENGLISH.flag,_=["case",["all",["has",g],["has",Qi.LOCAL.flag]],["case",["==",["get",g],["get",Qi.LOCAL.flag]],["get",Qi.LOCAL.flag],["format",["get",g],{"font-scale":.8},`
`,["get",Qi.LOCAL.flag],{"font-scale":1.1}]],["get",Qi.LOCAL.flag]]):d.flag===Qi.AUTO.flag?(g=ZT().flag,_=["coalesce",["get",g],["get",Qi.LOCAL.flag]]):d===Qi.LOCAL?(g=Qi.LOCAL.flag,_=["get",g]):(g=d.flag,_=["coalesce",["get",g],["get",Qi.LOCAL.flag]]);const{layers:c}=this.getStyle(),M=this.originalLabelStyle.size===0;if(M){const k=xO(c,this);this.isStyleLocalized=Object.keys(k.localized).length>0}for(const k of c){if(k.type!=="symbol")continue;const j=k,G=this.getSource(j.source);if(!G||!("url"in G&&typeof G.url=="string")||new URL(G.url).host!==Ul.maptilerApiHost)continue;const{id:ee,layout:Y}=j;if(!Y||!("text-field"in Y))continue;let xe;if(M?(xe=this.getLayoutProperty(ee,"text-field"),this.originalLabelStyle.set(ee,xe)):xe=this.originalLabelStyle.get(ee),typeof xe=="string"){const{contains:be,exactMatch:Ne}=gO(xe,this.isStyleLocalized);if(!be)continue;if(Ne)this.setLayoutProperty(ee,"text-field",_);else{const tt=_O(xe,_,this.isStyleLocalized);this.setLayoutProperty(ee,"text-field",tt)}}else{const be=mO(xe,_,this.isStyleLocalized);this.setLayoutProperty(ee,"text-field",be)}}this.languageIsUpdated=!0}getPrimaryLanguage(){return this.primaryLanguage}getTerrainExaggeration(){return this.terrainExaggeration}hasTerrain(){return this.isTerrainEnabled}growTerrain(e){if(!this.terrain)return;const n=performance.now(),o=this.terrain.exaggeration,d=e-o,g=()=>{if(!this.terrain||this.terrainFlattening)return;const _=(performance.now()-n)/this.terrainAnimationDuration;if(_<.99){const c=1-(1-_)**4,M=o+c*d;this.terrain.exaggeration=M,requestAnimationFrame(g)}else this.terrainGrowing=!1,this.terrainFlattening=!1,this.terrain.exaggeration=e,this.fire("terrainAnimationStop",{terrain:this.terrain});this._elevationFreeze=!1,this.triggerRepaint()};!this.terrainGrowing&&!this.terrainFlattening&&this.fire("terrainAnimationStart",{terrain:this.terrain}),this.terrainGrowing=!0,this.terrainFlattening=!1,requestAnimationFrame(g)}enableTerrain(e=this.terrainExaggeration){if(e<0){console.warn("Terrain exaggeration cannot be negative.");return}const n=d=>{!this.terrain||d.type!=="data"||d.dataType!=="source"||!("source"in d)||d.sourceId!=="maptiler-terrain"||d.source.type!=="raster-dem"||d.isSourceLoaded&&(this.off("data",n),this.growTerrain(e))},o=()=>{this.isTerrainEnabled=!0,this.terrainExaggeration=e,this.on("data",n),this.addSource(Ul.terrainSourceId,{type:"raster-dem",url:Ul.terrainSourceURL}),this.setTerrain({source:Ul.terrainSourceId,exaggeration:0})};if(this.getTerrain()){this.isTerrainEnabled=!0,this.growTerrain(e);return}if(this.loaded()||this.isTerrainEnabled)o();else{const d=()=>{this.getTerrain()&&this.getSource(Ul.terrainSourceId)||o()};this.once("load",()=>{d()}),this.once("moveend",()=>{d()})}}disableTerrain(){if(!this.terrain)return;this.isTerrainEnabled=!1;const e=performance.now(),n=this.terrain.exaggeration,o=()=>{if(!this.terrain||this.terrainGrowing)return;const d=(performance.now()-e)/this.terrainAnimationDuration;if(this._elevationFreeze=!1,d<.99){const g=(1-d)**4,_=n*g;this.terrain.exaggeration=_,requestAnimationFrame(o)}else this.terrain.exaggeration=0,this.terrainGrowing=!1,this.terrainFlattening=!1,this.setTerrain(),this.getSource(Ul.terrainSourceId)&&this.removeSource(Ul.terrainSourceId),this.fire("terrainAnimationStop",{terrain:null});this.triggerRepaint()};!this.terrainGrowing&&!this.terrainFlattening&&this.fire("terrainAnimationStart",{terrain:this.terrain}),this.terrainGrowing=!1,this.terrainFlattening=!0,requestAnimationFrame(o)}setTerrainExaggeration(e,n=!0){!n&&this.terrain?(this.terrainExaggeration=e,this.terrain.exaggeration=e,this.triggerRepaint()):this.enableTerrain(e)}onStyleReady(e){this.isStyleLoaded()?e():this.once("styledata",()=>{e()})}async fitToIpBounds(){const e=await BT.info();this.fitBounds(e.country_bounds,{duration:0,padding:100})}async centerOnIpPoint(e){const n=await BT.info();this.jumpTo({center:[n.longitude??0,n.latitude??0],zoom:e||11})}getCameraHash(){const e=new Float32Array(5),n=this.getCenter();return e[0]=n.lng,e[1]=n.lat,e[2]=this.getZoom(),e[3]=this.getPitch(),e[4]=this.getBearing(),eO.fromUint8Array(new Uint8Array(e.buffer))}getSdkConfig(){return Ka}getMaptilerSessionId(){return fw}setTransformRequest(e){return super.setTransformRequest(KT(e)),this}isGlobeProjection(){const e=this.getProjection();return e?e.type==="globe":!1}enableGlobeProjection(){this.isGlobeProjection()!==!0&&(this.setProjection({type:"globe"}),this.curentProjection="globe")}enableMercatorProjection(){this.isGlobeProjection()!==!1&&(this.setProjection({type:"mercator"}),this.curentProjection="mercator")}isLanguageUpdated(){return this.languageIsUpdated}};wn.Evented;function Ow(i){if(typeof DOMParser<"u"){const e=new DOMParser().parseFromString(i,"application/xml");if(e.querySelector("parsererror"))throw new Error("The provided string is not valid XML");return e}throw new Error("No XML parser found")}function ZM(i,e){if(!i.hasChildNodes())return!1;for(const n of Array.from(i.childNodes)){const o=n.nodeName;if(typeof o=="string"&&o.trim().toLowerCase()===e.toLowerCase())return!0}return!1}function BS(i){if(typeof XMLSerializer<"u")return new XMLSerializer().serializeToString(i);throw new Error("No XML serializer found")}function HM(i){const e=typeof i=="string"?Ow(i):i;if(!ZM(e,"gpx"))throw new Error("The XML document is not valid GPX");const n=wo(e,"trk"),o=wo(e,"rte"),d=wo(e,"wpt"),g={type:"FeatureCollection",features:[]};for(const _ of Array.from(n)){const c=NB(_);c&&g.features.push(c)}for(const _ of Array.from(o)){const c=BB(_);c&&g.features.push(c)}for(const _ of Array.from(d))g.features.push(FB(_));return g}function XM(i,e){let n=i;if(typeof n=="string"&&(n=Ow(n)),!ZM(n,"kml"))throw new Error("The XML document is not valid KML");const o={type:"FeatureCollection",features:[]},d={},g={},_={},c=wo(n,"Placemark"),M=wo(n,"Style"),k=wo(n,"StyleMap");for(const j of Array.from(M)){const G=VS(BS(j)).toString(16);d[`#${Lp(j,"id")}`]=G,g[G]=j}for(const j of Array.from(k)){d[`#${Lp(j,"id")}`]=VS(BS(j)).toString(16);const G=wo(j,"Pair"),ee={};for(const Y of Array.from(G))ee[Sr(ei(Y,"key"))??""]=Sr(ei(Y,"styleUrl"));_[`#${Lp(j,"id")}`]=ee}for(const j of Array.from(c))o.features=o.features.concat(OB(j,d,g,_));return o}function FS(i){if(i===null)return["#000000",1];let e="",n=1,o=i;return o.startsWith("#")&&(o=o.substring(1)),(o.length===6||o.length===3)&&(e=o),o.length===8&&(n=Number.parseInt(o.substring(0,2),16)/255,e=`#${o.substring(6,8)}${o.substring(4,6)}${o.substring(2,4)}`),[e??"#000000",n??1]}function DB(i){return YM(i.split(" "))}function zB(i){let e=wo(i,"coord");const n=[],o=[];e.length===0&&(e=wo(i,"gx:coord"));for(const g of Array.from(e))n.push(DB(Sr(g)??""));const d=wo(i,"when");for(const g of Array.from(d))o.push(Sr(g));return{coords:n,times:o}}function Wv(i){const e=["Polygon","LineString","Point","Track","gx:Track"];let n,o,d,g,_;const c=[],M=[];if(ei(i,"MultiGeometry")!==null)return Wv(ei(i,"MultiGeometry"));if(ei(i,"MultiTrack")!==null)return Wv(ei(i,"MultiTrack"));if(ei(i,"gx:MultiTrack")!==null)return Wv(ei(i,"gx:MultiTrack"));for(d=0;d<e.length;d++)if(o=wo(i,e[d]),o){for(g=0;g<o.length;g++)if(n=o[g],e[d]==="Point")c.push({type:"Point",coordinates:QM(Sr(ei(n,"coordinates"))??"")});else if(e[d]==="LineString")c.push({type:"LineString",coordinates:US(Sr(ei(n,"coordinates"))??"")});else if(e[d]==="Polygon"){const k=wo(n,"LinearRing"),j=[];for(_=0;_<k.length;_++)j.push(US(Sr(ei(k[_],"coordinates"))??""));c.push({type:"Polygon",coordinates:j})}else if(e[d]==="Track"||e[d]==="gx:Track"){const k=zB(n);c.push({type:"LineString",coordinates:k.coords}),k.times.length&&M.push(k.times)}}return{geoms:c,coordTimes:M}}function OB(i,e,n,o){const d=Wv(i),g={},_=Sr(ei(i,"name")),c=Sr(ei(i,"address")),M=Sr(ei(i,"description")),k=ei(i,"TimeSpan"),j=ei(i,"TimeStamp"),G=ei(i,"ExtendedData"),ee=ei(i,"visibility");let Y,xe=Sr(ei(i,"styleUrl")),be=ei(i,"LineStyle"),Ne=ei(i,"PolyStyle");if(!d.geoms.length)return[];if(_&&(g.name=_),c&&(g.address=c),xe){xe.startsWith("#")||(xe=`#${xe}`),g.styleUrl=xe,e[xe]&&(g.styleHash=e[xe]),o[xe]&&(g.styleMapHash=o[xe],g.styleHash=e[o[xe].normal??""]);const Je=n[g.styleHash??""];if(Je){be||(be=ei(Je,"LineStyle")),Ne||(Ne=ei(Je,"PolyStyle"));const qe=ei(Je,"IconStyle");if(qe){const He=ei(qe,"Icon");if(He){const Ue=Sr(ei(He,"href"));Ue&&(g.icon=Ue)}}}}if(M&&(g.description=M),k){const Je=Sr(ei(k,"begin")),qe=Sr(ei(k,"end"));Je&&qe&&(g.timespan={begin:Je,end:qe})}if(j!==null&&(g.timestamp=Sr(ei(j,"when"))??new Date().toISOString()),be!==null){const Je=FS(Sr(ei(be,"color"))),qe=Je[0],He=Je[1],Ue=Number.parseFloat(Sr(ei(be,"width"))??"");qe&&(g.stroke=qe),Number.isNaN(He)||(g["stroke-opacity"]=He),Number.isNaN(Ue)||(g["stroke-width"]=Ue)}if(Ne){const Je=FS(Sr(ei(Ne,"color"))),qe=Je[0],He=Je[1],Ue=Sr(ei(Ne,"fill")),Be=Sr(ei(Ne,"outline"));qe&&(g.fill=qe),Number.isNaN(He)||(g["fill-opacity"]=He),Ue&&(g["fill-opacity"]=Ue==="1"?g["fill-opacity"]||1:0),Be&&(g["stroke-opacity"]=Be==="1"?g["stroke-opacity"]||1:0)}if(G){const Je=wo(G,"Data"),qe=wo(G,"SimpleData");for(Y=0;Y<Je.length;Y++)g[Je[Y].getAttribute("name")??""]=Sr(ei(Je[Y],"value"))??"";for(Y=0;Y<qe.length;Y++)g[qe[Y].getAttribute("name")??""]=Sr(qe[Y])??""}ee!==null&&(g.visibility=Sr(ee)??""),d.coordTimes.length!==0&&(g.coordTimes=d.coordTimes.length===1?d.coordTimes[0]:d.coordTimes);const tt={type:"Feature",geometry:d.geoms.length===1?d.geoms[0]:{type:"GeometryCollection",geometries:d.geoms},properties:g};return Lp(i,"id")&&(tt.id=Lp(i,"id")??void 0),[tt]}function WM(i,e){const n=wo(i,e),o=[],d=[];let g=[];const _=n.length;if(!(_<2)){for(let c=0;c<_;c++){const M=JM(n[c]);o.push(M.coordinates),M.time&&d.push(M.time),(M.heartRate||g.length)&&(g.length===0&&(g=new Array(c).fill(null)),g.push(M.heartRate))}return{line:o,times:d,heartRates:g}}}function NB(i){const e=wo(i,"trkseg"),n=[],o=[],d=[];let g;for(let c=0;c<e.length;c++)if(g=WM(e[c],"trkpt"),g!==void 0&&(g.line&&n.push(g.line),g.times&&g.times.length&&o.push(g.times),d.length||g.heartRates&&g.heartRates.length)){if(!d.length)for(let M=0;M<c;M++)d.push(new Array(n[M].length).fill(null));g.heartRates&&g.heartRates.length?d.push(g.heartRates):d.push(new Array(g.line.length).fill(null))}if(n.length===0)return;const _={...Nw(i),...KM(ei(i,"extensions"))};return o.length!==0&&(_.coordTimes=n.length===1?o[0]:o),d.length!==0&&(_.heartRates=n.length===1?d[0]:d),n.length===1?{type:"Feature",properties:_,geometry:{type:"LineString",coordinates:n[0]}}:{type:"Feature",properties:_,geometry:{type:"MultiLineString",coordinates:n}}}function BB(i){const e=WM(i,"rtept");return e===void 0?void 0:{type:"Feature",properties:{...Nw(i),...KM(ei(i,"extensions"))},geometry:{type:"LineString",coordinates:e.line}}}function FB(i){return{type:"Feature",properties:{...Nw(i),...e1(i,["sym"])},geometry:{type:"Point",coordinates:JM(i).coordinates}}}function KM(i){const e={};if(i){const n=ei(i,"line");if(n){const o=Sr(ei(n,"color")),d=Number.parseFloat(Sr(ei(n,"opacity"))??"0"),g=Number.parseFloat(Sr(ei(n,"width"))??"0");o&&(e.stroke=o),Number.isNaN(d)||(e["stroke-opacity"]=d),Number.isNaN(g)||(e["stroke-width"]=g*96/25.4)}}return e}function Nw(i){const e=e1(i,["name","cmt","desc","type","time","keywords"]),n=wo(i,"link");if(n.length!==0){e.links=[];for(const o of Array.from(n)){const d={href:Lp(o,"href"),...e1(o,["text","type"])};e.links.push(d)}}return e}function VS(i){let e=0;if(!i||!i.length)return e;for(let n=0;n<i.length;n++)e=(e<<5)-e+i.charCodeAt(n)|0;return e}function wo(i,e){return i.getElementsByTagName(e)}function Lp(i,e){return i.getAttribute(e)}function jS(i,e){return Number.parseFloat(Lp(i,e)??"0")}function ei(i,e){const n=wo(i,e);return n.length?n[0]:null}function VB(i){return i.normalize&&i.normalize(),i}function YM(i){return i.map(Number.parseFloat).map(e=>Number.isNaN(e)?null:e)}function Sr(i){return i&&VB(i),i&&i.textContent}function e1(i,e){const n={};let o,d;for(d=0;d<e.length;d++)o=ei(i,e[d]),o&&(n[e[d]]=Sr(o)??"");return n}function QM(i){return YM(i.replace(/\s*/g,"").split(","))}function US(i){const e=i.replace(/^\s*|\s*$/g,"").split(/\s+/),n=[];for(const o of e)n.push(QM(o));return n}function JM(i){const e=[jS(i,"lon"),jS(i,"lat")],n=ei(i,"ele"),o=ei(i,"gpxtpx:hr")||ei(i,"hr"),d=ei(i,"time");let g;return n&&(g=Number.parseFloat(Sr(n)??"0"),Number.isNaN(g)||e.push(g)),{coordinates:e,time:d?Sr(d):null,heartRate:o!==null?Number.parseFloat(Sr(o)??"0"):null}}function jB(i){let e=i;try{typeof e=="string"&&(e=Ow(e))}catch{return null}try{return HM(e)}catch{}try{return XM(e)}catch{}return null}async function UB(i,e={}){const n=e.download??!1,o=await $B(i);if(n){const d=e.filename??"maptiler_screenshot.png",g=document.createElement("a");g.style.display="none",document.body.appendChild(g),g.href=URL.createObjectURL(o),g.download=d,g.click(),setTimeout(()=>{document.body.removeChild(g),URL.revokeObjectURL(g.href)},0)}return o}function $B(i){return new Promise((e,n)=>{i.redraw(),i.once("idle",()=>{i.getCanvas().toBlob(o=>{if(!o){n(Error("Screenshot could not be created."));return}e(o)},"image/png")})})}const t1=[["#1D5B79","#468B97","#EF6262","#F3AA60"],["#614BC3","#33BBC5","#85E6C5","#C8FFE0"],["#461959","#7A316F","#CD6688","#AED8CC"],["#0079FF","#00DFA2","#F6FA70","#FF0060"],["#39B5E0","#A31ACB","#FF78F0","#F5EA5A"],["#37E2D5","#590696","#C70A80","#FBCB0A"],["#FFD36E","#FFF56D","#99FFCD","#9FB4FF"],["#00EAD3","#FFF5B7","#FF449F","#005F99"],["#10A19D","#540375","#FF7000","#FFBF00"]];function sb(){return t1[~~(Math.random()*t1.length)][~~(Math.random()*4)]}function yy(){return`maptiler_source_${QC()}`}function vy(){return`maptiler_layer_${QC()}`}function n1(i,e){if(e<=i[0].zoom)return i[0].value;if(e>=i[i.length-1].zoom)return i[i.length-1].value;for(let n=0;n<i.length-1;n+=1)if(e>=i[n].zoom&&e<i[n+1].zoom){const o=i[n+1].zoom-i[n].zoom,d=(e-i[n].zoom)/o;return d*i[n+1].value+(1-d)*i[n].value}return 0}function Af(i){return["interpolate",["linear"],["zoom"],...i.flatMap(e=>[e.zoom,e.value])]}function yr(i){return["interpolate",["linear"],["zoom"],...i.flatMap(e=>[e.zoom,e.value])]}function eI(i,e){if(typeof e=="number"&&typeof i=="number")return 2*e+i;if(typeof e=="number"&&Array.isArray(i))return["interpolate",["linear"],["zoom"],...i.flatMap(n=>[n.zoom,2*e+n.value])];if(typeof i=="number"&&Array.isArray(e))return["interpolate",["linear"],["zoom"],...e.flatMap(n=>[n.zoom,2*n.value+i])];if(Array.isArray(i)&&Array.isArray(e)){const n=Array.from(new Set([...i.map(o=>o.zoom),...e.map(o=>o.zoom)])).sort((o,d)=>o<d?-1:1);return["interpolate",["linear"],["zoom"],...n.flatMap(o=>[o,2*n1(e,o)+n1(i,o)])]}return 0}function tI(i,e){return["interpolate",["linear"],["get",e],...i.flatMap(n=>[n.propertyValue,n.value])]}function Bw(i){const e=i.trimStart(),n=`${e}${" ".repeat(i.length-e.length)}`,o=Array.from(n);if(!o.every(g=>g===" "||g==="_"))throw new Error("A dash pattern must be composed only of whitespace and underscore characters.");if(!(o.some(g=>g==="_")&&o.some(g=>g===" ")))throw new Error("A dash pattern must contain at least one underscore and one whitespace character");const d=[1];for(let g=1;g<o.length;g+=1){const _=o[g-1],c=o[g];_===c?d[d.length-1]+=1:d.push(1)}return d}function i1(i,e){return["interpolate",["linear"],["get",e],...i.flatMap(n=>[n.value,n.color])]}function r1(i,e,n=!0){return n?["interpolate",["linear"],["zoom"],0,["interpolate",["linear"],["get",e],...i.flatMap(o=>[o.value,o.pointRadius*.025])],2,["interpolate",["linear"],["get",e],...i.flatMap(o=>[o.value,o.pointRadius*.05])],4,["interpolate",["linear"],["get",e],...i.flatMap(o=>[o.value,o.pointRadius*.1])],8,["interpolate",["linear"],["get",e],...i.flatMap(o=>[o.value,o.pointRadius*.25])],16,["interpolate",["linear"],["get",e],...i.flatMap(o=>[o.value,o.pointRadius])]]:["interpolate",["linear"],["get",e],...i.flatMap(o=>[o.value,o.pointRadius])]}function nI(i,e,n=!0){return n?["interpolate",["linear"],["zoom"],0,["interpolate",["linear"],["get",e],...i.flatMap(o=>[o.propertyValue,o.value*.025])],2,["interpolate",["linear"],["get",e],...i.flatMap(o=>[o.propertyValue,o.value*.05])],4,["interpolate",["linear"],["get",e],...i.flatMap(o=>[o.propertyValue,o.value*.1])],8,["interpolate",["linear"],["get",e],...i.flatMap(o=>[o.propertyValue,o.value*.25])],16,["interpolate",["linear"],["get",e],...i.flatMap(o=>[o.propertyValue,o.value])]]:["interpolate",["linear"],["get",e],...i.flatMap(o=>[o.propertyValue,o.value])]}function a1(i,e){return i.every(n=>n.color[3]===i[0].color[3])?i[0].color[3]?i[0].color[3]/255:1:["interpolate",["linear"],["get",e],...i.getRawColorStops().flatMap(n=>{const o=n.value,d=n.color;return[o,d.length===4?d[3]/255:1]})]}function iI(i,e=10){return["interpolate",["linear"],["heatmap-density"],...Array.from({length:e+1},(n,o)=>{const d=o/e;return[d,i.getColorHex(d)]}).flat()]}function Sv(i){const e=i.toString(16);return e.length===1?`0${e}`:e}function qB(i){return`#${Sv(i[0])}${Sv(i[1])}${Sv(i[2])}${i.length===4?Sv(i[3]):""}`}class zn extends Array{constructor(e={}){super(),rn(this,"min",0),rn(this,"max",1),"min"in e&&(this.min=e.min),"max"in e&&(this.max=e.max),"stops"in e&&this.setStops(e.stops,{clone:!1})}static fromArrayDefinition(e){return new zn({stops:e.map(n=>({value:n[0],color:n[1]}))})}setStops(e,n={clone:!0}){const o=n.clone?this.clone():this;o.length=0;let d=Number.POSITIVE_INFINITY,g=Number.NEGATIVE_INFINITY;for(let _=0;_<e.length;_+=1)d=Math.min(d,e[_].value),g=Math.max(g,e[_].value),o.push({value:e[_].value,color:e[_].color.slice()});return o.sort((_,c)=>_.value<c.value?-1:1),this.min=d,this.max=g,o}scale(e,n,o={clone:!0}){const d=o.clone,g=this[0].value,_=this.at(-1).value-g,c=n-e,M=[];for(let k=0;k<this.length;k+=1){const j=(this[k].value-g)/_*c+e;d?M.push({value:j,color:this[k].color.slice()}):this[k].value=j}return d?new zn({stops:M}):this}at(e){return e<0?this[this.length+e]:this[e]}clone(){return new zn({stops:this.getRawColorStops()})}getRawColorStops(){const e=[];for(let n=0;n<this.length;n+=1)e.push({value:this[n].value,color:this[n].color});return e}reverse(e={clone:!0}){const n=e.clone?this.clone():this;for(let o=0;o<~~(n.length/2);o+=1){const d=n[o].color;n[o].color=n.at(-(o+1)).color,n.at(-(o+1)).color=d}return n}getBounds(){return{min:this.min,max:this.max}}getColor(e,n={smooth:!0}){if(e<=this[0].value)return this[0].color;if(e>=this.at(-1).value)return this.at(-1).color;for(let o=0;o<this.length-1;o+=1){if(e>this[o+1].value)continue;const d=this[o].color;if(!n.smooth)return d.slice();const g=this[o].value,_=this[o+1].value,c=this[o+1].color,M=(_-e)/(_-g);return d.map((k,j)=>Math.round(k*M+c[j]*(1-M)))}return[0,0,0]}getColorHex(e,n={smooth:!0,withAlpha:!1}){return qB(this.getColor(e,n))}getColorRelative(e,n={smooth:!0}){const o=this.getBounds();return this.getColor(o.min+e*(o.max-o.min),n)}getCanvasStrip(e={horizontal:!0,size:512,smooth:!0}){const n=document.createElement("canvas");n.width=e.horizontal?e.size:1,n.height=e.horizontal?1:e.size;const o=n.getContext("2d");if(!o)throw new Error("Canvs context is missing");const d=o.getImageData(0,0,n.width,n.height),g=d.data,_=e.size,c=this[0].value,M=(this.at(-1).value-c)/_;for(let k=0;k<_;k+=1){const j=this.getColor(c+k*M,{smooth:e.smooth});g[k*4]=j[0],g[k*4+1]=j[1],g[k*4+2]=j[2],g[k*4+3]=j.length>3?j[3]:255}return o.putImageData(d,0,0),n}resample(e,n=15){const o=this.getBounds(),d=this.scale(0,1),g=1/(n-1);let _;if(e==="ease-in-square")_=Array.from({length:n},(c,M)=>{const k=M*g,j=k**2,G=d.getColor(j);return{value:k,color:G}});else if(e==="ease-out-square")_=Array.from({length:n},(c,M)=>{const k=M*g,j=1-(1-k)**2,G=d.getColor(j);return{value:k,color:G}});else if(e==="ease-out-sqrt")_=Array.from({length:n},(c,M)=>{const k=M*g,j=k**.5,G=d.getColor(j);return{value:k,color:G}});else if(e==="ease-in-sqrt")_=Array.from({length:n},(c,M)=>{const k=M*g,j=1-(1-k)**.5,G=d.getColor(j);return{value:k,color:G}});else if(e==="ease-out-exp")_=Array.from({length:n},(c,M)=>{const k=M*g,j=1-2**(-10*k),G=d.getColor(j);return{value:k,color:G}});else if(e==="ease-in-exp")_=Array.from({length:n},(c,M)=>{const k=M*g,j=2**(10*k-10),G=d.getColor(j);return{value:k,color:G}});else throw new Error("Invalid ressampling method.");return new zn({stops:_}).scale(o.min,o.max)}transparentStart(){const e=this.getRawColorStops();e.unshift({value:e[0].value,color:e[0].color.slice()}),e[1].value+=.001;for(const n of e)n.color.length===3&&n.color.push(255);return e[0].color[3]=0,new zn({stops:e})}hasTransparentStart(){return this[0].color.length===4&&this[0].color[3]===0}}const rI={NULL:new zn({stops:[{value:0,color:[0,0,0,0]},{value:1,color:[0,0,0,0]}]}),GRAY:new zn({stops:[{value:0,color:[0,0,0]},{value:1,color:[255,255,255]}]}),JET:new zn({stops:[{value:0,color:[0,0,131]},{value:.125,color:[0,60,170]},{value:.375,color:[5,255,255]},{value:.625,color:[255,255,0]},{value:.875,color:[250,0,0]},{value:1,color:[128,0,0]}]}),HSV:new zn({stops:[{value:0,color:[255,0,0]},{value:.169,color:[253,255,2]},{value:.173,color:[247,255,2]},{value:.337,color:[0,252,4]},{value:.341,color:[0,252,10]},{value:.506,color:[1,249,255]},{value:.671,color:[2,0,253]},{value:.675,color:[8,0,253]},{value:.839,color:[255,0,251]},{value:.843,color:[255,0,245]},{value:1,color:[255,0,6]}]}),HOT:new zn({stops:[{value:0,color:[0,0,0]},{value:.3,color:[230,0,0]},{value:.6,color:[255,210,0]},{value:1,color:[255,255,255]}]}),SPRING:new zn({stops:[{value:0,color:[255,0,255]},{value:1,color:[255,255,0]}]}),SUMMER:new zn({stops:[{value:0,color:[0,128,102]},{value:1,color:[255,255,102]}]}),AUTOMN:new zn({stops:[{value:0,color:[255,0,0]},{value:1,color:[255,255,0]}]}),WINTER:new zn({stops:[{value:0,color:[0,0,255]},{value:1,color:[0,255,128]}]}),BONE:new zn({stops:[{value:0,color:[0,0,0]},{value:.376,color:[84,84,116]},{value:.753,color:[169,200,200]},{value:1,color:[255,255,255]}]}),COPPER:new zn({stops:[{value:0,color:[0,0,0]},{value:.804,color:[255,160,102]},{value:1,color:[255,199,127]}]}),GREYS:new zn({stops:[{value:0,color:[0,0,0]},{value:1,color:[255,255,255]}]}),YIGNBU:new zn({stops:[{value:0,color:[8,29,88]},{value:.125,color:[37,52,148]},{value:.25,color:[34,94,168]},{value:.375,color:[29,145,192]},{value:.5,color:[65,182,196]},{value:.625,color:[127,205,187]},{value:.75,color:[199,233,180]},{value:.875,color:[237,248,217]},{value:1,color:[255,255,217]}]}),GREENS:new zn({stops:[{value:0,color:[0,68,27]},{value:.125,color:[0,109,44]},{value:.25,color:[35,139,69]},{value:.375,color:[65,171,93]},{value:.5,color:[116,196,118]},{value:.625,color:[161,217,155]},{value:.75,color:[199,233,192]},{value:.875,color:[229,245,224]},{value:1,color:[247,252,245]}]}),YIORRD:new zn({stops:[{value:0,color:[128,0,38]},{value:.125,color:[189,0,38]},{value:.25,color:[227,26,28]},{value:.375,color:[252,78,42]},{value:.5,color:[253,141,60]},{value:.625,color:[254,178,76]},{value:.75,color:[254,217,118]},{value:.875,color:[255,237,160]},{value:1,color:[255,255,204]}]}),BLUERED:new zn({stops:[{value:0,color:[0,0,255]},{value:1,color:[255,0,0]}]}),RDBU:new zn({stops:[{value:0,color:[5,10,172]},{value:.35,color:[106,137,247]},{value:.5,color:[190,190,190]},{value:.6,color:[220,170,132]},{value:.7,color:[230,145,90]},{value:1,color:[178,10,28]}]}),PICNIC:new zn({stops:[{value:0,color:[0,0,255]},{value:.1,color:[51,153,255]},{value:.2,color:[102,204,255]},{value:.3,color:[153,204,255]},{value:.4,color:[204,204,255]},{value:.5,color:[255,255,255]},{value:.6,color:[255,204,255]},{value:.7,color:[255,153,255]},{value:.8,color:[255,102,204]},{value:.9,color:[255,102,102]},{value:1,color:[255,0,0]}]}),RAINBOW:new zn({stops:[{value:0,color:[150,0,90]},{value:.125,color:[0,0,200]},{value:.25,color:[0,25,255]},{value:.375,color:[0,152,255]},{value:.5,color:[44,255,150]},{value:.625,color:[151,255,0]},{value:.75,color:[255,234,0]},{value:.875,color:[255,111,0]},{value:1,color:[255,0,0]}]}),PORTLAND:new zn({stops:[{value:0,color:[12,51,131]},{value:.25,color:[10,136,186]},{value:.5,color:[242,211,56]},{value:.75,color:[242,143,56]},{value:1,color:[217,30,30]}]}),BLACKBODY:new zn({stops:[{value:0,color:[0,0,0]},{value:.2,color:[230,0,0]},{value:.4,color:[230,210,0]},{value:.7,color:[255,255,255]},{value:1,color:[160,200,255]}]}),EARTH:new zn({stops:[{value:0,color:[0,0,130]},{value:.1,color:[0,180,180]},{value:.2,color:[40,210,40]},{value:.4,color:[230,230,50]},{value:.6,color:[120,70,20]},{value:1,color:[255,255,255]}]}),ELECTRIC:new zn({stops:[{value:0,color:[0,0,0]},{value:.15,color:[30,0,100]},{value:.4,color:[120,0,100]},{value:.6,color:[160,90,0]},{value:.8,color:[230,200,0]},{value:1,color:[255,250,220]}]}),VIRIDIS:new zn({stops:[{value:0,color:[68,1,84]},{value:.13,color:[71,44,122]},{value:.25,color:[59,81,139]},{value:.38,color:[44,113,142]},{value:.5,color:[33,144,141]},{value:.63,color:[39,173,129]},{value:.75,color:[92,200,99]},{value:.88,color:[170,220,50]},{value:1,color:[253,231,37]}]}),INFERNO:new zn({stops:[{value:0,color:[0,0,4]},{value:.13,color:[31,12,72]},{value:.25,color:[85,15,109]},{value:.38,color:[136,34,106]},{value:.5,color:[186,54,85]},{value:.63,color:[227,89,51]},{value:.75,color:[249,140,10]},{value:.88,color:[249,201,50]},{value:1,color:[252,255,164]}]}),MAGMA:new zn({stops:[{value:0,color:[0,0,4]},{value:.13,color:[28,16,68]},{value:.25,color:[79,18,123]},{value:.38,color:[129,37,129]},{value:.5,color:[181,54,122]},{value:.63,color:[229,80,100]},{value:.75,color:[251,135,97]},{value:.88,color:[254,194,135]},{value:1,color:[252,253,191]}]}),PLASMA:new zn({stops:[{value:0,color:[13,8,135]},{value:.13,color:[75,3,161]},{value:.25,color:[125,3,168]},{value:.38,color:[168,34,150]},{value:.5,color:[203,70,121]},{value:.63,color:[229,107,93]},{value:.75,color:[248,148,65]},{value:.88,color:[253,195,40]},{value:1,color:[240,249,33]}]}),WARM:new zn({stops:[{value:0,color:[125,0,179]},{value:.13,color:[172,0,187]},{value:.25,color:[219,0,170]},{value:.38,color:[255,0,130]},{value:.5,color:[255,63,74]},{value:.63,color:[255,123,0]},{value:.75,color:[234,176,0]},{value:.88,color:[190,228,0]},{value:1,color:[147,255,0]}]}),COOL:new zn({stops:[{value:0,color:[125,0,179]},{value:.13,color:[116,0,218]},{value:.25,color:[98,74,237]},{value:.38,color:[68,146,231]},{value:.5,color:[0,204,197]},{value:.63,color:[0,247,146]},{value:.75,color:[0,255,88]},{value:.88,color:[40,255,8]},{value:1,color:[147,255,0]}]}),RAINBOW_SOFT:new zn({stops:[{value:0,color:[125,0,179]},{value:.1,color:[199,0,180]},{value:.2,color:[255,0,121]},{value:.3,color:[255,108,0]},{value:.4,color:[222,194,0]},{value:.5,color:[150,255,0]},{value:.6,color:[0,255,55]},{value:.7,color:[0,246,150]},{value:.8,color:[50,167,222]},{value:.9,color:[103,51,235]},{value:1,color:[124,0,186]}]}),BATHYMETRY:new zn({stops:[{value:0,color:[40,26,44]},{value:.13,color:[59,49,90]},{value:.25,color:[64,76,139]},{value:.38,color:[63,110,151]},{value:.5,color:[72,142,158]},{value:.63,color:[85,174,163]},{value:.75,color:[120,206,163]},{value:.88,color:[187,230,172]},{value:1,color:[253,254,204]}]}),CDOM:new zn({stops:[{value:0,color:[47,15,62]},{value:.13,color:[87,23,86]},{value:.25,color:[130,28,99]},{value:.38,color:[171,41,96]},{value:.5,color:[206,67,86]},{value:.63,color:[230,106,84]},{value:.75,color:[242,149,103]},{value:.88,color:[249,193,135]},{value:1,color:[254,237,176]}]}),CHLOROPHYLL:new zn({stops:[{value:0,color:[18,36,20]},{value:.13,color:[25,63,41]},{value:.25,color:[24,91,59]},{value:.38,color:[13,119,72]},{value:.5,color:[18,148,80]},{value:.63,color:[80,173,89]},{value:.75,color:[132,196,122]},{value:.88,color:[175,221,162]},{value:1,color:[215,249,208]}]}),DENSITY:new zn({stops:[{value:0,color:[54,14,36]},{value:.13,color:[89,23,80]},{value:.25,color:[110,45,132]},{value:.38,color:[120,77,178]},{value:.5,color:[120,113,213]},{value:.63,color:[115,151,228]},{value:.75,color:[134,185,227]},{value:.88,color:[177,214,227]},{value:1,color:[230,241,241]}]}),FREESURFACE_BLUE:new zn({stops:[{value:0,color:[30,4,110]},{value:.13,color:[47,14,176]},{value:.25,color:[41,45,236]},{value:.38,color:[25,99,212]},{value:.5,color:[68,131,200]},{value:.63,color:[114,156,197]},{value:.75,color:[157,181,203]},{value:.88,color:[200,208,216]},{value:1,color:[241,237,236]}]}),FREESURFACE_RED:new zn({stops:[{value:0,color:[60,9,18]},{value:.13,color:[100,17,27]},{value:.25,color:[142,20,29]},{value:.38,color:[177,43,27]},{value:.5,color:[192,87,63]},{value:.63,color:[205,125,105]},{value:.75,color:[216,162,148]},{value:.88,color:[227,199,193]},{value:1,color:[241,237,236]}]}),OXYGEN:new zn({stops:[{value:0,color:[64,5,5]},{value:.13,color:[106,6,15]},{value:.25,color:[144,26,7]},{value:.38,color:[168,64,3]},{value:.5,color:[188,100,4]},{value:.63,color:[206,136,11]},{value:.75,color:[220,174,25]},{value:.88,color:[231,215,44]},{value:1,color:[248,254,105]}]}),PAR:new zn({stops:[{value:0,color:[51,20,24]},{value:.13,color:[90,32,35]},{value:.25,color:[129,44,34]},{value:.38,color:[159,68,25]},{value:.5,color:[182,99,19]},{value:.63,color:[199,134,22]},{value:.75,color:[212,171,35]},{value:.88,color:[221,210,54]},{value:1,color:[225,253,75]}]}),PHASE:new zn({stops:[{value:0,color:[145,105,18]},{value:.13,color:[184,71,38]},{value:.25,color:[186,58,115]},{value:.38,color:[160,71,185]},{value:.5,color:[110,97,218]},{value:.63,color:[50,123,164]},{value:.75,color:[31,131,110]},{value:.88,color:[77,129,34]},{value:1,color:[145,105,18]}]}),SALINITY:new zn({stops:[{value:0,color:[42,24,108]},{value:.13,color:[33,50,162]},{value:.25,color:[15,90,145]},{value:.38,color:[40,118,137]},{value:.5,color:[59,146,135]},{value:.63,color:[79,175,126]},{value:.75,color:[120,203,104]},{value:.88,color:[193,221,100]},{value:1,color:[253,239,154]}]}),TEMPERATURE:new zn({stops:[{value:0,color:[4,35,51]},{value:.13,color:[23,51,122]},{value:.25,color:[85,59,157]},{value:.38,color:[129,79,143]},{value:.5,color:[175,95,130]},{value:.63,color:[222,112,101]},{value:.75,color:[249,146,66]},{value:.88,color:[249,196,65]},{value:1,color:[232,250,91]}]}),TURBIDITY:new zn({stops:[{value:0,color:[34,31,27]},{value:.13,color:[65,50,41]},{value:.25,color:[98,69,52]},{value:.38,color:[131,89,57]},{value:.5,color:[161,112,59]},{value:.63,color:[185,140,66]},{value:.75,color:[202,174,88]},{value:.88,color:[216,209,126]},{value:1,color:[233,246,171]}]}),VELOCITY_BLUE:new zn({stops:[{value:0,color:[17,32,64]},{value:.13,color:[35,52,116]},{value:.25,color:[29,81,156]},{value:.38,color:[31,113,162]},{value:.5,color:[50,144,169]},{value:.63,color:[87,173,176]},{value:.75,color:[149,196,189]},{value:.88,color:[203,221,211]},{value:1,color:[254,251,230]}]}),VELOCITY_GREEN:new zn({stops:[{value:0,color:[23,35,19]},{value:.13,color:[24,64,38]},{value:.25,color:[11,95,45]},{value:.38,color:[39,123,35]},{value:.5,color:[95,146,12]},{value:.63,color:[152,165,18]},{value:.75,color:[201,186,69]},{value:.88,color:[233,216,137]},{value:1,color:[255,253,205]}]}),CUBEHELIX:new zn({stops:[{value:0,color:[0,0,0]},{value:.07,color:[22,5,59]},{value:.13,color:[60,4,105]},{value:.2,color:[109,1,135]},{value:.27,color:[161,0,147]},{value:.33,color:[210,2,142]},{value:.4,color:[251,11,123]},{value:.47,color:[255,29,97]},{value:.53,color:[255,54,69]},{value:.6,color:[255,85,46]},{value:.67,color:[255,120,34]},{value:.73,color:[255,157,37]},{value:.8,color:[241,191,57]},{value:.87,color:[224,220,93]},{value:.93,color:[218,241,142]},{value:1,color:[227,253,198]}]}),CIVIDIS:new zn({stops:[{value:0,color:[0,32,77,255]},{value:.125,color:[5,54,110,255]},{value:.25,color:[65,77,108,255]},{value:.375,color:[97,100,111,255]},{value:.5,color:[125,124,121,255]},{value:.625,color:[156,149,120,255]},{value:.75,color:[190,175,111,255]},{value:.875,color:[225,204,94,255]},{value:1,color:[255,235,70,255]}]}),TURBO:new zn({stops:[{value:0,color:[48,18,59,255]},{value:.125,color:[70,107,227,255]},{value:.25,color:[40,187,236,255]},{value:.375,color:[49,242,153,255]},{value:.5,color:[162,252,60,255]},{value:.625,color:[237,208,58,255]},{value:.75,color:[251,128,34,255]},{value:.875,color:[210,49,5,255]},{value:1,color:[122,4,3,255]}]}),ROCKET:new zn({stops:[{value:0,color:[250,235,221,0]},{value:.133,color:[250,235,221,255]},{value:.266,color:[246,170,130,255]},{value:.4,color:[240,96,67,255]},{value:.533,color:[203,27,79,255]},{value:.666,color:[132,30,90,255]},{value:.8,color:[63,27,68,255]},{value:1,color:[3,5,26,255]}]}),MAKO:new zn({stops:[{value:0,color:[11,4,5,255]},{value:.125,color:[43,28,53,255]},{value:.25,color:[62,53,107,255]},{value:.375,color:[59,86,152,255]},{value:.5,color:[53,123,162,255]},{value:.625,color:[53,158,170,255]},{value:.75,color:[73,193,173,255]},{value:.875,color:[150,221,181,255]},{value:1,color:[222,245,229,255]}]})};async function GB(i,e,n={}){var o,d;if(!e.sourceId&&!e.data)throw new Error("Creating a polyline layer requires an existing .sourceId or a valid .data property");let g=e.data;if(typeof g=="string"){if($0(g))g=`https://api.maptiler.com/data/${e.data}/features.json?key=${Ka.apiKey}`;else if(((o=g.split(".").pop())==null?void 0:o.toLowerCase().trim())==="gpx"){const _=await(await fetch(g,n)).text();g=HM(_)}else if(((d=g.split(".").pop())==null?void 0:d.toLowerCase().trim())==="kml"){const _=await(await fetch(g,n)).text();g=XM(_)}else{const _=dO(g)??jB(g);_&&(g=_)}if(!g)throw new Error("Polyline data was provided as string but is incompatible with valid formats.")}return ZB(i,{...e,data:g})}function ZB(i,e){if(e.layerId&&i.getLayer(e.layerId))throw new Error(`A layer already exists with the layer id: ${e.layerId}`);const n=e.sourceId??yy(),o=e.layerId??vy(),d={polylineLayerId:o,polylineOutlineLayerId:"",polylineSourceId:n};e.data&&!i.getSource(n)&&i.addSource(n,{type:"geojson",data:e.data});const g=e.lineWidth??3,_=e.lineColor??sb(),c=e.lineOpacity??1,M=e.lineBlur??0,k=e.lineGapWidth??0;let j=e.lineDashArray??null;const G=e.outlineWidth??1,ee=e.outlineColor??"#FFFFFF",Y=e.outlineOpacity??1,xe=e.outlineBlur??0;if(typeof j=="string"&&(j=Bw(j)),e.outline===!0){const be=`${o}_outline`;d.polylineOutlineLayerId=be,i.addLayer({id:be,type:"line",source:n,layout:{"line-join":e.lineJoin??"round","line-cap":e.lineCap??"round"},minzoom:e.minzoom??0,maxzoom:e.maxzoom??23,paint:{"line-opacity":typeof Y=="number"?Y:yr(Y),"line-color":typeof ee=="string"?ee:Af(ee),"line-width":eI(g,G),"line-blur":typeof xe=="number"?xe:yr(xe)}},e.beforeId)}return i.addLayer({id:o,type:"line",source:n,layout:{"line-join":e.lineJoin??"round","line-cap":e.lineCap??"round"},minzoom:e.minzoom??0,maxzoom:e.maxzoom??23,paint:{"line-opacity":typeof c=="number"?c:yr(c),"line-color":typeof _=="string"?_:Af(_),"line-width":typeof g=="number"?g:yr(g),"line-blur":typeof M=="number"?M:yr(M),"line-gap-width":typeof k=="number"?k:yr(k),...j&&{"line-dasharray":j}}},e.beforeId),d}function HB(i,e){if(e.layerId&&i.getLayer(e.layerId))throw new Error(`A layer already exists with the layer id: ${e.layerId}`);const n=e.sourceId??yy(),o=e.layerId??vy(),d={polygonLayerId:o,polygonOutlineLayerId:e.outline?`${o}_outline`:"",polygonSourceId:n};if(e.data&&!i.getSource(n)){let be=e.data;typeof be=="string"&&$0(be)&&(be=`https://api.maptiler.com/data/${be}/features.json?key=${Ka.apiKey}`),i.addSource(n,{type:"geojson",data:be})}let g=e.outlineDashArray??null;const _=e.outlineWidth??1,c=e.outlineColor??"#FFFFFF",M=e.outlineOpacity??1,k=e.outlineBlur??0,j=e.fillColor??sb(),G=e.fillOpacity??1,ee=e.outlinePosition??"center",Y=e.pattern??null;typeof g=="string"&&(g=Bw(g));const xe=(be=null)=>{if(i.addLayer({id:o,type:"fill",source:n,minzoom:e.minzoom??0,maxzoom:e.maxzoom??23,paint:{"fill-color":typeof j=="string"?j:Af(j),"fill-opacity":typeof G=="number"?G:yr(G),...be&&{"fill-pattern":be}}},e.beforeId),e.outline===!0){let Ne;ee==="inside"?typeof _=="number"?Ne=.5*_:Ne=yr(_.map(({zoom:tt,value:Je})=>({zoom:tt,value:.5*Je}))):ee==="outside"?typeof _=="number"?Ne=-.5*_:Ne=yr(_.map(tt=>({zoom:tt.zoom,value:-.5*tt.value}))):Ne=0,i.addLayer({id:d.polygonOutlineLayerId,type:"line",source:n,layout:{"line-join":e.outlineJoin??"round","line-cap":e.outlineCap??"butt"},minzoom:e.minzoom??0,maxzoom:e.maxzoom??23,paint:{"line-opacity":typeof M=="number"?M:yr(M),"line-color":typeof c=="string"?c:Af(c),"line-width":typeof _=="number"?_:yr(_),"line-blur":typeof k=="number"?k:yr(k),"line-offset":Ne,...g&&{"line-dasharray":g}}},e.beforeId)}};return Y?i.hasImage(Y)?xe(Y):i.loadImage(Y).then(be=>{i.addImage(Y,be.data),xe(Y)}).catch(be=>{console.error("Could not load the pattern image.",be.message),xe()}):xe(),d}function XB(i,e){if(e.layerId&&i.getLayer(e.layerId))throw new Error(`A layer already exists with the layer id: ${e.layerId}`);const n=e.minPointRadius??10,o=e.maxPointRadius??50,d=e.cluster??!1,g=20,_=Array.isArray(e.pointColor)?e.pointColor:rI.TURBO.scale(10,e.cluster?1e4:1e3).resample("ease-out-square"),c=_.getBounds(),M=e.sourceId??yy(),k=e.layerId??vy(),j=e.showLabel??d,G=e.alignOnViewport??!0,ee=e.outline??!1,Y=e.outlineOpacity??1,xe=e.outlineWidth??1,be=e.outlineColor??"#FFFFFF";let Ne;const tt=e.zoomCompensation??!0,Je=e.minzoom??0,qe=e.maxzoom??23;typeof e.pointOpacity=="number"?Ne=e.pointOpacity:Array.isArray(e.pointOpacity)?Ne=yr(e.pointOpacity):e.cluster?Ne=a1(_,"point_count"):e.property?Ne=a1(_,e.property):Ne=yr([{zoom:Je,value:0},{zoom:Je+.25,value:1},{zoom:qe-.25,value:1},{zoom:qe,value:0}]);const He={pointLayerId:k,clusterLayerId:"",labelLayerId:"",pointSourceId:M};if(e.data&&!i.getSource(M)){let Ue=e.data;typeof Ue=="string"&&$0(Ue)&&(Ue=`https://api.maptiler.com/data/${Ue}/features.json?key=${Ka.apiKey}`),i.addSource(M,{type:"geojson",data:Ue,cluster:d})}if(d){He.clusterLayerId=`${k}_cluster`;const Ue=Array.from({length:g},(Be,de)=>{const ce=c.min+de*(c.max-c.min)/(g-1);return{value:ce,pointRadius:n+(o-n)*(de/(g-1))**.5,color:_.getColorHex(ce)}});i.addLayer({id:He.clusterLayerId,type:"circle",source:M,filter:["has","point_count"],paint:{"circle-color":typeof e.pointColor=="string"?e.pointColor:i1(Ue,"point_count"),"circle-radius":typeof e.pointRadius=="number"?e.pointRadius:Array.isArray(e.pointRadius)?yr(e.pointRadius):r1(Ue,"point_count",!1),"circle-pitch-alignment":G?"viewport":"map","circle-pitch-scale":"map","circle-opacity":Ne,...ee&&{"circle-stroke-opacity":typeof Y=="number"?Y:yr(Y),"circle-stroke-width":typeof xe=="number"?xe:yr(xe),"circle-stroke-color":typeof be=="string"?be:Af(be)}},minzoom:Je,maxzoom:qe},e.beforeId),i.addLayer({id:He.pointLayerId,type:"circle",source:M,filter:["!",["has","point_count"]],paint:{"circle-pitch-alignment":G?"viewport":"map","circle-pitch-scale":"map","circle-color":typeof e.pointColor=="string"?e.pointColor:_.getColorHex(_.getBounds().min),"circle-radius":typeof e.pointRadius=="number"?e.pointRadius:Array.isArray(e.pointRadius)?yr(e.pointRadius):Ue[0].pointRadius*.75,"circle-opacity":Ne,...ee&&{"circle-stroke-opacity":typeof Y=="number"?Y:yr(Y),"circle-stroke-width":typeof xe=="number"?xe:yr(xe),"circle-stroke-color":typeof be=="string"?be:Af(be)}},minzoom:Je,maxzoom:qe},e.beforeId)}else{let Ue=typeof e.pointColor=="string"?e.pointColor:Array.isArray(e.pointColor)?e.pointColor.getColorHex(e.pointColor.getBounds().min):sb(),Be=typeof e.pointRadius=="number"?tt?yr([{zoom:0,value:e.pointRadius*.025},{zoom:2,value:e.pointRadius*.05},{zoom:4,value:e.pointRadius*.1},{zoom:8,value:e.pointRadius*.25},{zoom:16,value:e.pointRadius*1}]):e.pointRadius:Array.isArray(e.pointRadius)?yr(e.pointRadius):tt?yr([{zoom:0,value:n*.05},{zoom:2,value:n*.1},{zoom:4,value:n*.2},{zoom:8,value:n*.5},{zoom:16,value:n*1}]):n;if(e.property&&Array.isArray(e.pointColor)){const de=Array.from({length:g},(ce,_e)=>{const Ae=c.min+_e*(c.max-c.min)/(g-1);return{value:Ae,pointRadius:typeof e.pointRadius=="number"?e.pointRadius:n+(o-n)*(_e/(g-1))**.5,color:typeof e.pointColor=="string"?e.pointColor:_.getColorHex(Ae)}});Ue=i1(de,e.property),Be=r1(de,e.property,tt)}i.addLayer({id:He.pointLayerId,type:"circle",source:M,layout:{"circle-sort-key":e.property?["/",1,["get",e.property]]:0},paint:{"circle-pitch-alignment":G?"viewport":"map","circle-pitch-scale":"map","circle-color":Ue,"circle-opacity":Ne,"circle-radius":Be,...ee&&{"circle-stroke-opacity":typeof Y=="number"?Y:yr(Y),"circle-stroke-width":typeof xe=="number"?xe:yr(xe),"circle-stroke-color":typeof be=="string"?be:Af(be)}},minzoom:Je,maxzoom:qe},e.beforeId)}if(j!==!1&&(e.cluster||e.property)){He.labelLayerId=`${k}_label`;const Ue=e.labelColor??"#fff",Be=e.labelSize??12;i.addLayer({id:He.labelLayerId,type:"symbol",source:M,filter:["has",e.cluster?"point_count":e.property],layout:{"text-field":e.cluster?"{point_count_abbreviated}":`{${e.property}}`,"text-font":["Noto Sans Regular"],"text-size":Be,"text-pitch-alignment":G?"viewport":"map","symbol-sort-key":["/",1,["get",e.cluster?"point_count":e.property]]},paint:{"text-color":Ue,"text-opacity":Ne},minzoom:Je,maxzoom:qe},e.beforeId)}return He}function WB(i,e){if(e.layerId&&i.getLayer(e.layerId))throw new Error(`A layer already exists with the layer id: ${e.layerId}`);const n=e.sourceId??yy(),o=e.layerId??vy(),d=e.minzoom??0,g=e.maxzoom??23,_=e.zoomCompensation??!0,c=e.opacity??[{zoom:d,value:0},{zoom:d+.25,value:1},{zoom:g-.25,value:1},{zoom:g,value:0}];let M=Array.isArray(e.colorRamp)?e.colorRamp:rI.TURBO.transparentStart();const k=M.getBounds();(k.min!==0||k.max!==1)&&(M=M.scale(0,1)),M.hasTransparentStart()||(M=M.transparentStart());const j=e.intensity??[{zoom:0,value:.01},{zoom:4,value:.2},{zoom:16,value:1}],G=e.property??null,ee=e.weight??1;let Y=1;G?typeof ee=="number"?(Y=ee,typeof e.weight=="number"&&console.warn("The option `.property` is ignored when `.propertyValueWeights` is not of type `PropertyValueWeights`")):Array.isArray(ee)?Y=tI(ee,G):console.warn("The option `.property` is ignored when `.propertyValueWeights` is not of type `PropertyValueWeights`"):typeof ee=="number"?Y=ee:Array.isArray(ee)&&console.warn("The options `.propertyValueWeights` can only be used when `.property` is provided.");const xe=[{zoom:0,value:50*.025},{zoom:2,value:50*.05},{zoom:4,value:50*.1},{zoom:8,value:50*.25},{zoom:16,value:50}],be=e.radius??(_?xe:10);let Ne=1;typeof be=="number"?Ne=be:Array.isArray(be)&&"zoom"in be[0]?Ne=yr(be):G&&Array.isArray(be)&&"propertyValue"in be[0]?Ne=nI(be,G,_):!G&&Array.isArray(be)&&"propertyValue"in be[0]?(Ne=yr(xe),console.warn("The option `.radius` can only be property-driven if the option `.property` is provided.")):Ne=yr(xe);const tt={heatmapLayerId:o,heatmapSourceId:n};if(e.data&&!i.getSource(n)){let Je=e.data;typeof Je=="string"&&$0(Je)&&(Je=`https://api.maptiler.com/data/${Je}/features.json?key=${Ka.apiKey}`),i.addSource(n,{type:"geojson",data:Je})}return i.addLayer({id:o,type:"heatmap",source:n,minzoom:d,maxzoom:g,paint:{"heatmap-weight":Y,"heatmap-intensity":typeof j=="number"?j:yr(j),"heatmap-color":iI(M),"heatmap-radius":Ne,"heatmap-opacity":typeof c=="number"?c:yr(c)}},e.beforeId),tt}const m_=Object.freeze(Object.defineProperty({__proto__:null,addHeatmap:WB,addPoint:XB,addPolygon:HB,addPolyline:GB,colorDrivenByProperty:i1,colorPalettes:t1,computeRampedOutlineWidth:eI,dashArrayMaker:Bw,generateRandomLayerName:vy,generateRandomSourceName:yy,getRandomColor:sb,heatmapIntensityFromColorRamp:iI,lerpZoomNumberValues:n1,opacityDrivenByProperty:a1,paintColorOptionsToPaintSpec:Af,radiusDrivenByProperty:r1,radiusDrivenByPropertyHeatmap:nI,rampedOptionsToLayerPaintSpec:yr,rampedPropertyValueWeight:tI,takeScreenshot:UB},Symbol.toStringTag,{value:"Module"}));cO();function KB(){return"3.8.0"}wn.Map;wn.Marker;wn.Popup;wn.Style;wn.CanvasSource;wn.GeoJSONSource;wn.ImageSource;wn.RasterTileSource;wn.RasterDEMTileSource;wn.VectorTileSource;wn.VideoSource;wn.NavigationControl;wn.GeolocateControl;wn.AttributionControl;wn.LogoControl;wn.ScaleControl;wn.FullscreenControl;wn.TerrainControl;wn.BoxZoomHandler;wn.ScrollZoomHandler;wn.CooperativeGesturesHandler;wn.KeyboardHandler;wn.TwoFingersTouchPitchHandler;wn.MapWheelEvent;wn.MapTouchEvent;wn.MapMouseEvent;wn.config;wn.getVersion;const{setRTLTextPlugin:SF,getRTLTextPluginStatus:EF,LngLat:AF,LngLatBounds:CF,MercatorCoordinate:MF,Evented:IF,AJAXError:PF,prewarm:RF,clearPrewarmedResources:LF,Hash:kF,Point:DF,EdgeInsets:zF,DragRotateHandler:OF,DragPanHandler:NF,TwoFingersTouchZoomRotateHandler:BF,DoubleClickZoomHandler:FF,TwoFingersTouchZoomHandler:VF,TwoFingersTouchRotateHandler:jF,getWorkerCount:UF,setWorkerCount:$F,getMaxParallelImageRequests:qF,setMaxParallelImageRequests:GF,getWorkerUrl:ZF,setWorkerUrl:HF,addSourceType:XF,importScriptInWorkers:WF,addProtocol:KF,removeProtocol:YF}=wn,YB="@maptiler/leaflet-maptilersdk",QB="4.1.1",JB=Lr.Layer.extend({options:{updateInterval:32,padding:.1,interactive:!1,pane:"tilePane"},map:null,initialize:function(i){Lr.setOptions(this,i),this._throttledUpdate=Lr.Util.throttle(this._update,this.options.updateInterval,this)},onAdd:function(i){var e;this._container||this._initContainer();const n=this.getPaneName();(e=i.getPane(n))==null||e.appendChild(this._container),this._initMaptilerSDK(),this._offset=this._map.containerPointToLayerPoint([0,0]),i.options.zoomAnimation&&Lr.DomEvent.on(i._proxy,Lr.DomUtil.TRANSITION_END,this._transitionEnd,this),i.attributionControl.addAttribution('<a href="https://www.maptiler.com/copyright/" target="_blank">&copy; MapTiler</a> <a href="https://www.openstreetmap.org/copyright" target="_blank">&copy; OpenStreetMap contributors</a>')},onRemove:function(i){var e;this._map._proxy&&this._map.options.zoomAnimation&&Lr.DomEvent.off(this._map._proxy,Lr.DomUtil.TRANSITION_END,this._transitionEnd,this);const n=this.getPaneName();(e=i.getPane(n))==null||e.removeChild(this._container),this._maptilerMap.remove(),this._maptilerMap=null},getEvents:function(){return{move:this._throttledUpdate,zoomanim:this._animateZoom,zoom:this._pinchZoom,zoomstart:this._zoomStart,zoomend:this._zoomEnd,resize:this._resize}},getMaptilerSDKMap:function(){return this._maptilerMap},getCanvas:function(){return this._maptilerMap.getCanvas()},getSize:function(){return this._map.getSize().multiplyBy(1+this.options.padding*2)},getBounds:function(){const i=this.getSize().multiplyBy(.5),e=this._map.latLngToContainerPoint(this._map.getCenter());return Lr.latLngBounds(this._map.containerPointToLatLng(e.subtract(i)),this._map.containerPointToLatLng(e.add(i)))},getContainer:function(){return this._container},getPaneName:function(){return this._map.getPane(this.options.pane)?this.options.pane:"tilePane"},setStyle:function(i){this._maptilerMap.setStyle(i)},setLanguage:function(i){this._maptilerMap.setLanguage(i)},_roundPoint:i=>({x:Math.round(i.x),y:Math.round(i.y)}),_initContainer:function(){this._container=Lr.DomUtil.create("div","leaflet-gl-layer");const i=this.getSize(),e=this._map.getSize().multiplyBy(this.options.padding);this._container.style.width=`${i.x}px`,this._container.style.height=`${i.y}px`;const n=this._map.containerPointToLayerPoint([0,0]).subtract(e);Lr.DomUtil.setPosition(this._container,this._roundPoint(n))},_initMaptilerSDK:function(){const i=this._map.getCenter(),e=this.options.maxBounds?this.options.maxBounds:[[Number.NEGATIVE_INFINITY,-90],[Number.POSITIVE_INFINITY,90]];this._map.setMaxBounds(Lr.latLngBounds(Lr.latLng(e[0][1],e[0][0]),Lr.latLng(e[1][1],e[1][0])));const n={maxBounds:e,...this.options,projection:"mercator",container:this._container,center:[i.lng,i.lat],zoom:this._map.getZoom()-1,attributionControl:!1};this.options.geolocate&&(n.center=void 0,n.zoom=void 0),this._maptilerMap=new qM(n),this._maptilerMap.telemetry.registerModule(YB,QB),this._maptilerMap.once("load",()=>{this.fire("ready")}),this._maptilerMap.once("load",async()=>{let d={logo:null};try{const g=Object.keys(this._maptilerMap.style.sourceCaches).map(c=>this._maptilerMap.getSource(c)).filter(c=>c&&"url"in c&&typeof c.url=="string"&&(c==null?void 0:c.url.includes("tiles.json"))),_=new URL(g[0].url);_.searchParams.has("key")||_.searchParams.append("key",n.apiKey),d=await(await fetch(_.href)).json()}catch{}if(d.logo||n.maptilerLogo){const g=d.logo??"https://api.maptiler.com/resources/logo.svg",_=document.createElement("a");_.href="https://www.maptiler.com",_.style.setProperty("position","absolute"),_.style.setProperty("left","10px"),_.style.setProperty("bottom","2px"),_.style.setProperty("z-index","999");const c=document.createElement("img");c.src=g,c.alt="MapTiler logo",c.width=100,c.height=30,_.appendChild(c),this._map.getContainer().appendChild(_)}}),this._maptilerMap.transform.freezeElevation=!0,this.options.geolocate&&this._maptilerMap.on("load",()=>{this._map.setView(this._maptilerMap.getCenter(),this._maptilerMap.getZoom()+1)}),this._transformGL(),this._maptilerMap._actualCanvas=this._maptilerMap._canvas;const o=this._maptilerMap._actualCanvas;Lr.DomUtil.addClass(o,"leaflet-image-layer"),Lr.DomUtil.addClass(o,"leaflet-zoom-animated"),this.options.interactive&&Lr.DomUtil.addClass(o,"leaflet-interactive"),this.options.className&&Lr.DomUtil.addClass(o,this.options.className),this.addHeatmap=d=>m_.addHeatmap(this._maptilerMap,d),this.addPolygon=d=>m_.addPolygon(this._maptilerMap,d),this.addPoint=d=>m_.addPoint(this._maptilerMap,d),this.addPolyline=d=>m_.addPolyline(this._maptilerMap,d),this.takeScreenshot=d=>m_.takeScreenshot(this._maptilerMap,d)},_update:function(){if(this._offset=this._map.containerPointToLayerPoint([0,0]),this._zooming)return;const i=this.getSize(),e=this._map.getSize().multiplyBy(this.options.padding),n=this._map.containerPointToLayerPoint([0,0]).subtract(e);Lr.DomUtil.setPosition(this._container,this._roundPoint(n)),this._transformGL(),this._maptilerMap.transform.width!==i.x||this._maptilerMap.transform.height!==i.y?(this._container.style.width=`${i.x}px`,this._container.style.height=`${i.y}px`,this._maptilerMap._resize!==null&&this._maptilerMap._resize!==void 0?this._maptilerMap._resize():this._maptilerMap.resize()):this._maptilerMap._update!==null&&this._maptilerMap._update!==void 0?this._maptilerMap._update():this._maptilerMap.update()},_transformGL:function(){this._maptilerMap.setCenter(this._map.getCenter()),this._maptilerMap.setZoom(this._map.getZoom()-1)},_pinchZoom:function(){this._maptilerMap.jumpTo({zoom:this._map.getZoom()-1,center:this._map.getCenter()})},_animateZoom:function(i){const e=this._map.getZoomScale(i.zoom),n=this._map.getSize().multiplyBy(this.options.padding*e),o=this.getSize()._divideBy(2),d=this._map.project(i.center,i.zoom)._subtract(o)._add(this._map._getMapPanePos().add(n))._round(),g=this._map.project(this._map.getBounds().getNorthWest(),i.zoom)._subtract(d);Lr.DomUtil.setTransform(this._maptilerMap.getCanvas(),g.subtract(this._offset),e)},_zoomStart:function(){this._zooming=!0},_zoomEnd:function(){const i=this._map.getZoomScale(this._map.getZoom());Lr.DomUtil.setTransform(this._maptilerMap.getCanvas(),new Lr.Point(0,0),i),this._zooming=!1,this._update()},_transitionEnd:function(){Lr.Util.requestAnimFrame(()=>{const i=this._map.getZoom(),e=this._map.getCenter(),n=this._map.latLngToContainerPoint(this._map.getBounds().getNorthWest());Lr.DomUtil.setTransform(this._maptilerMap._actualCanvas,n,1),this._maptilerMap.once("moveend",Lr.Util.bind(()=>{this._zoomEnd()},this)),this._maptilerMap.jumpTo({center:e,zoom:i-1})},this)},_resize:function(i){this._transitionEnd(i)}}),$S=[{id:0,name:"uncomfortable-situation",color:"#de9e36"},{id:1,name:"sexual-misconduct",color:"#ca3c25"},{id:2,name:"physical-aggression",color:"#701d52"},{id:3,name:"verbal-aggression",color:"#212475"},{id:4,name:"discrimination",color:"#1d1a05"}];function qS(){const[i,e]=wt.useState([]),[n,o]=wt.useState({}),[d,g]=wt.useState(!0),[_,c]=wt.useState(null),[M,k]=wt.useState({selectedCampus:"All",selectedMonth:"All",selectedTypes:[],showMenu:!1}),j=wt.useRef(null),G=wt.useRef(null);wt.useEffect(()=>{(async()=>{try{const de=VA(PC,"reports"),ce=UD(de),_e=await HD(ce);console.log("Firebase Points: ",_e.docs.map(Ae=>Ae.data())),e(_e.docs.map(Ae=>Ae.data())),g(!1)}catch(de){console.error("Error fetching incidents:",de),c("Failed to fetch incident data"),g(!1)}})(),j.current||(j.current=Lr.map("map",{maxZoom:19}).setView([41.7002,-86.2379],15).setMinZoom(15).setMaxBounds([[41.7852,-86.1779],[41.5852,-86.2879]]),new JB({style:"streets-v2",apiKey:"0UGrg19TXtYRROinsJ9a"}).addTo(j.current),G.current=Lr.layerGroup().addTo(j.current))},[]),wt.useEffect(()=>{Y()},[i,M]);const ee=()=>{const Be={};return tt(i).forEach(ce=>{var In;const _e=MT.find(Jn=>Jn.name===ce.specificLocation);(In=Be[ce.specificLocation])!=null&&In.totalIncidents&&Be[ce.specificLocation].totalIncidents+1;const Ae=ce.specificLocation||(_e==null?void 0:_e.name)||"Unknown Location",Pe=_e&&typeof _e.latitude=="number"&&typeof _e.longitude=="number"?[_e.latitude,_e.longitude]:[0,0],Ge=ce.campus||(_e==null?void 0:_e.campus)||"Unknown Campus",Re=(_e==null?void 0:_e.type)||(_e==null?void 0:_e.buildingType)||"Unknown Type";Be[Ae]?(Be[Ae].totalIncidents++,Be[Ae].recentIncidents.push(ce)):Be[Ae]={buildingName:Ae,coordinates:Pe,totalIncidents:1,incidentCounts:{"uncomfortable-situation":0,"sexual-misconduct":0,"physical-aggression":0,"verbal-aggression":0,discrimination:0},campus:Ge,buildingType:Re,recentIncidents:[ce]},ce.offenseTypes&&ce.offenseTypes.forEach(Jn=>{Be[Ae].incidentCounts[Jn]!==void 0&&Be[Ae].incidentCounts[Jn]++})}),o(Be),Be},Y=()=>{var de;const Be=ee();G.current&&((de=G.current)==null||de.clearLayers()),Object.values(Be).forEach(ce=>{if(ce.totalIncidents>0){const _e=Math.min(ce.totalIncidents*10+15,100),Ae=Object.entries(ce.incidentCounts).sort(([,Jn],[,mt])=>mt-Jn)[0][0],Ge={"uncomfortable-situation":"#de9e36","sexual-misconduct":"#ca3c25","physical-aggression":"#701d52","verbal-aggression":"#212475",discrimination:"#1d1a05"}[Ae]||"#666666";Lr.circle(ce.coordinates,{color:Ge,fillColor:Ge,fillOpacity:.7,radius:_e,weight:2}).addTo(G.current);const Re=Ue(ce);let In="black";ce.campus=="Notre-Dame"?In="#FFD700":ce.campus=="Holy-Cross"?In="#fff":ce.campus=="Saint-Marys"&&(In="#87CEEB"),Lr.circle(ce.coordinates,{fillColor:In,fillOpacity:.5,color:In,stroke:!1,radius:15}).addTo(G.current).bindPopup(Re,{maxWidth:400,className:"enhanced-popup"})}})},xe=()=>{const Be=new Set;return i.forEach(de=>{const ce=new Date(de.createdAt.toMillis()),_e=`${ce.getFullYear()}-${String(ce.getMonth()+1).padStart(2,"0")}`;Be.add(_e)}),["All",...Array.from(Be).sort().reverse()]};function be(Be){const de=Be.createdAt.toMillis(),ce=Date.now(),_e=1440*60*1e3;let Ae=0,Pe=ce-de;switch(Be.time){case"within-24-hours":Ae=(Pe+_e/2)/_e;break;case"within-week":Ae=(Pe+_e*3.5)/_e;break;case"within-month":Ae=(Pe+_e*15)/_e;break;case"longer-ago":Ae=(Pe+_e*45)/_e;break}return Ae}function Ne(Be){let de=0,ce=0;const _e=12;for(const Pe of Be){const Ge=be(Pe);Ge<7&&ce++;const Re=Math.min(3/Ge*2,2);de+=Re}if(de===0)return[1,0];let Ae=10+de/_e*40;return Ae=Math.min(Ae,50),[Math.round(Ae)/10,ce]}const tt=Be=>Be.filter(de=>{if(M.selectedCampus!=="All"){const ce=AT.find(_e=>_e===de.campus);if(!ce||ce!==M.selectedCampus)return!1}if(M.selectedMonth!=="All"){const ce=new Date(de.createdAt.toMillis());if(`${ce.getFullYear()}-${String(ce.getMonth()+1).padStart(2,"0")}`!==M.selectedMonth)return!1}return!(M.selectedTypes.length>0&&!M.selectedTypes.some(ce=>de.offenseTypes.includes(ce)))}),Je=(Be,de)=>{k(ce=>({...ce,[Be]:de}))},qe=Be=>{k(de=>({...de,selectedTypes:de.selectedTypes.includes(Be)?de.selectedTypes.filter(ce=>ce!==Be):[...de.selectedTypes,Be]}))},He=Be=>{if(j.current)if(Be==="All")j.current.setView([41.7002,-86.2379],15);else{const de=MT.filter(ce=>ce.location===Be);if(de.length>0){const ce=Lr.latLngBounds(de.map(_e=>[_e.latitude,_e.longitude]));j.current.fitBounds(ce,{padding:[50,50]})}}},Ue=Be=>{const[de,ce]=Ne(Be.recentIncidents),_e=de>=4?"#ca3c25":de>=3?"#de9e36":de>=2?"#212475":"#28a745",Ae=[{name:"uncomfortable-situation",color:"#de9e36"},{name:"sexual-misconduct",color:"#ca3c25"},{name:"physical-aggression",color:"#701d52"},{name:"verbal-aggression",color:"#212475"},{name:"discrimination",color:"#1d1a05"}];return`
      <div class="enhanced-popup-content">
        <h3 style="margin: 0 0 10px 0; color: #333;">${Be.buildingName}</h3>
        
        <div style="margin-bottom: 10px;">
          <span style="font-weight: bold; color: #666;">Campus:</span> ${Be.campus}<br>
          <span style="font-weight: bold; color: #666;">Building Type:</span> ${Be.buildingType}
        </div>
        
        <div style="margin-bottom: 10px;">
          <span style="font-weight: bold; color: #666;">Total Cases:</span> ${Be.totalIncidents}
        </div>
        
        <div style="margin-bottom: 10px;">
          <span style="font-weight: bold; color: #666;">Types of Aggressions:</span><br>
          ${Object.entries(Be.incidentCounts).filter(([,Pe])=>Pe>0).map(([Pe,Ge])=>{const Re=Ae.find(Jn=>Jn.name===Pe);if(!Re)return"";const In=Re.name.replace(/-/g," ").replace(/\b\w/g,Jn=>Jn.toUpperCase());return`<div style="margin: 2px 0; font-size: 12px;">
                <span style="color: ${Re.color}; font-weight: bold;"></span>
                ${In}: ${Ge}
              </div>`}).join("")}
        </div>
        
        <div style="margin-bottom: 10px;">
          <span style="font-weight: bold; color: #666;">Risk Score:</span> 
          <span style="color: ${_e}; font-weight: bold; font-size: 16px;">
            ${de}/5
          </span>
          ${ce>0?`<br><span style="font-size: 12px; color: #666;">
              (${ce} recent case${ce>1?"s":""} in last 7 days)
            </span>`:'<br><span style="font-size: 12px; color: #28a745;">(No recent activity)</span>'}
        </div>
      </div>
    `};return Ee.jsxs("div",{className:"fullscreen-map-container",children:[Ee.jsxs("div",{className:"map-filter z-front",children:[Ee.jsx("div",{className:`map-filter-menu m-1${M.showMenu?" open":""}`,style:{zIndex:M.showMenu?1001:-1,opacity:M.showMenu?1:0},children:Ee.jsxs("div",{className:"filter-content",children:[Ee.jsx("h3",{children:"Map Filters"}),Ee.jsxs("div",{className:"filter-section",children:[Ee.jsx("label",{children:"Campus:"}),Ee.jsx("select",{value:M.selectedCampus,onChange:Be=>{Je("selectedCampus",Be.target.value),He(Be.target.value)},className:"form-select",children:AT.map(Be=>Ee.jsx("option",{value:Be.toString(),children:Be.toString()},Be.toString()))})]}),Ee.jsxs("div",{className:"filter-section",children:[Ee.jsx("label",{children:"Month:"}),Ee.jsx("select",{value:M.selectedMonth,onChange:Be=>Je("selectedMonth",Be.target.value),className:"form-select",children:xe().map(Be=>Ee.jsx("option",{value:Be,children:Be==="All"?"All Time":Be},Be))})]}),Ee.jsxs("div",{className:"filter-section",children:[Ee.jsx("label",{children:"Incident Types:"}),Ee.jsx("div",{className:"type-filters",children:$S.map(Be=>Ee.jsxs("label",{className:"type-checkbox custom-circle-checkbox",style:{cursor:"pointer"},children:[Ee.jsx("input",{type:"checkbox",checked:M.selectedTypes.includes(Be.name),onChange:()=>qe(Be.name),style:{display:"none"}}),Ee.jsx("span",{className:`type-color-dot-circle ${M.selectedTypes.includes(Be.name)?"selected":""}`,style:{backgroundColor:Be.color,borderColor:Be.color},children:M.selectedTypes.includes(Be.name)&&Ee.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",style:{display:"block",margin:"auto"},children:Ee.jsx("circle",{cx:"13",cy:"13",r:"10",fill:"#fff",opacity:"0.8"})})}),Ee.jsx("span",{style:{marginLeft:8},children:Be.name})]},Be.name))})]}),Ee.jsx("button",{className:"clear-filters-btn",onClick:()=>k({selectedCampus:"All",selectedMonth:"All",selectedTypes:[],showMenu:M.showMenu}),children:"Clear All Filters"}),Ee.jsxs("div",{className:"results-summary",children:[Ee.jsxs("p",{children:["Showing ",Object.values(n).length," incidents"]}),M.selectedCampus!=="All"&&Ee.jsxs("p",{children:["Campus: ",M.selectedCampus]}),M.selectedMonth!=="All"&&Ee.jsxs("p",{children:["Period: ",M.selectedMonth]}),M.selectedTypes.length>0&&Ee.jsxs("p",{children:["Types:"," ",M.selectedTypes.map(Be=>{var de;return(de=$S.find(ce=>ce.name===Be))==null?void 0:de.name}).join(", ")]})]})]})}),Ee.jsx("button",{className:"menu-toggle-btn",onClick:()=>Je("showMenu",!M.showMenu),children:M.showMenu?"":""})]}),Ee.jsxs("div",{className:"form-group abs right ",children:[Ee.jsx("a",{href:"../",className:"back-button form-btn",children:Ee.jsx("button",{className:" small",children:"Back"})}),Ee.jsx("a",{"data-az-l":"1e9e1abc-2335-4838-949d-8ab8af0dd8c9",className:"back-button form-btn mt-4",children:Ee.jsx("button",{className:" small",children:"Leave Feedback"})})]}),d&&Ee.jsx("div",{className:"loading-overlay",children:Ee.jsx("div",{className:"loading-content",children:"Loading incident data..."})}),_&&Ee.jsx("div",{className:"error-overlay",children:_}),Ee.jsx("div",{id:"map",className:"fullscreen-map"})]})}function eF(i){try{(function(e,n,o,d,g,_,c){n.getElementById("clarity-script")||(e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},_=n.createElement(d),_.async=1,_.src="https://www.clarity.ms/tag/"+g+"?ref=npm",_.id="clarity-script",c=n.getElementsByTagName(d)[0],c.parentNode.insertBefore(_,c))})(window,document,"clarity","script",i);return}catch{return}}const tF={init(i){eF(i)},setTag(i,e){window.clarity("set",i,e)},identify(i,e,n,o){window.clarity("identify",i,e,n,o)},consent(i=!0){window.clarity("consent",i)},upgrade(i){window.clarity("upgrade",i)},event(i){window.clarity("event",i)}},nF="tyjad302qq",iF="6LeMDQssAAAAAC3prYanNGr6ItRklzJicu190qUc";tF.init(nF);gI.createRoot(document.getElementById("root")).render(Ee.jsx(GS.StrictMode,{children:Ee.jsx(c4,{reCaptchaKey:iF,children:Ee.jsx(RP,{children:Ee.jsxs(lP,{children:[Ee.jsx(mp,{path:"/",element:Ee.jsx(t2,{})}),Ee.jsx(mp,{path:"/client/",element:Ee.jsx(t2,{})}),Ee.jsx(mp,{path:"/report",element:Ee.jsx(kT,{})}),Ee.jsx(mp,{path:"/client/report",element:Ee.jsx(kT,{})}),Ee.jsx(mp,{path:"/map",element:Ee.jsx(qS,{})}),Ee.jsx(mp,{path:"/client/map",element:Ee.jsx(qS,{})})]})})})}));
