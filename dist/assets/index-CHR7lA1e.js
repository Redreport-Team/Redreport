(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const h of document.querySelectorAll('link[rel="modulepreload"]'))a(h);new MutationObserver(h=>{for(const m of h)if(m.type==="childList")for(const g of m.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&a(g)}).observe(document,{childList:!0,subtree:!0});function t(h){const m={};return h.integrity&&(m.integrity=h.integrity),h.referrerPolicy&&(m.referrerPolicy=h.referrerPolicy),h.crossOrigin==="use-credentials"?m.credentials="include":h.crossOrigin==="anonymous"?m.credentials="omit":m.credentials="same-origin",m}function a(h){if(h.ep)return;h.ep=!0;const m=t(h);fetch(h.href,m)}})();function uy(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Rb={exports:{}},__={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Zw;function jP(){if(Zw)return __;Zw=1;var i=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(a,h,m){var g=null;if(m!==void 0&&(g=""+m),h.key!==void 0&&(g=""+h.key),"key"in h){m={};for(var c in h)c!=="key"&&(m[c]=h[c])}else m=h;return h=m.ref,{$$typeof:i,type:a,key:g,ref:h!==void 0?h:null,props:m}}return __.Fragment=e,__.jsx=t,__.jsxs=t,__}var Hw;function qP(){return Hw||(Hw=1,Rb.exports=jP()),Rb.exports}var Pe=qP(),kb={exports:{}},di={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ww;function $P(){if(Ww)return di;Ww=1;var i=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),h=Symbol.for("react.profiler"),m=Symbol.for("react.consumer"),g=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),C=Symbol.for("react.suspense"),k=Symbol.for("react.memo"),V=Symbol.for("react.lazy"),Z=Symbol.iterator;function Y(Ie){return Ie===null||typeof Ie!="object"?null:(Ie=Z&&Ie[Z]||Ie["@@iterator"],typeof Ie=="function"?Ie:null)}var Q={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},be=Object.assign,xe={};function ze(Ie,lt,Dt){this.props=Ie,this.context=lt,this.refs=xe,this.updater=Dt||Q}ze.prototype.isReactComponent={},ze.prototype.setState=function(Ie,lt){if(typeof Ie!="object"&&typeof Ie!="function"&&Ie!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,Ie,lt,"setState")},ze.prototype.forceUpdate=function(Ie){this.updater.enqueueForceUpdate(this,Ie,"forceUpdate")};function et(){}et.prototype=ze.prototype;function Qe(Ie,lt,Dt){this.props=Ie,this.context=lt,this.refs=xe,this.updater=Dt||Q}var Xe=Qe.prototype=new et;Xe.constructor=Qe,be(Xe,ze.prototype),Xe.isPureReactComponent=!0;var Ke=Array.isArray,Ve={H:null,A:null,T:null,S:null,V:null},it=Object.prototype.hasOwnProperty;function de(Ie,lt,Dt,zt,Xt,an){return Dt=an.ref,{$$typeof:i,type:Ie,key:lt,ref:Dt!==void 0?Dt:null,props:an}}function ce(Ie,lt){return de(Ie.type,lt,void 0,void 0,void 0,Ie.props)}function me(Ie){return typeof Ie=="object"&&Ie!==null&&Ie.$$typeof===i}function Ee(Ie){var lt={"=":"=0",":":"=2"};return"$"+Ie.replace(/[=:]/g,function(Dt){return lt[Dt]})}var De=/\/+/g;function $e(Ie,lt){return typeof Ie=="object"&&Ie!==null&&Ie.key!=null?Ee(""+Ie.key):lt.toString(36)}function ke(){}function Bn(Ie){switch(Ie.status){case"fulfilled":return Ie.value;case"rejected":throw Ie.reason;default:switch(typeof Ie.status=="string"?Ie.then(ke,ke):(Ie.status="pending",Ie.then(function(lt){Ie.status==="pending"&&(Ie.status="fulfilled",Ie.value=lt)},function(lt){Ie.status==="pending"&&(Ie.status="rejected",Ie.reason=lt)})),Ie.status){case"fulfilled":return Ie.value;case"rejected":throw Ie.reason}}throw Ie}function ti(Ie,lt,Dt,zt,Xt){var an=typeof Ie;(an==="undefined"||an==="boolean")&&(Ie=null);var Ft=!1;if(Ie===null)Ft=!0;else switch(an){case"bigint":case"string":case"number":Ft=!0;break;case"object":switch(Ie.$$typeof){case i:case e:Ft=!0;break;case V:return Ft=Ie._init,ti(Ft(Ie._payload),lt,Dt,zt,Xt)}}if(Ft)return Xt=Xt(Ie),Ft=zt===""?"."+$e(Ie,0):zt,Ke(Xt)?(Dt="",Ft!=null&&(Dt=Ft.replace(De,"$&/")+"/"),ti(Xt,lt,Dt,"",function(zr){return zr})):Xt!=null&&(me(Xt)&&(Xt=ce(Xt,Dt+(Xt.key==null||Ie&&Ie.key===Xt.key?"":(""+Xt.key).replace(De,"$&/")+"/")+Ft)),lt.push(Xt)),1;Ft=0;var Ci=zt===""?".":zt+":";if(Ke(Ie))for(var qn=0;qn<Ie.length;qn++)zt=Ie[qn],an=Ci+$e(zt,qn),Ft+=ti(zt,lt,Dt,an,Xt);else if(qn=Y(Ie),typeof qn=="function")for(Ie=qn.call(Ie),qn=0;!(zt=Ie.next()).done;)zt=zt.value,an=Ci+$e(zt,qn++),Ft+=ti(zt,lt,Dt,an,Xt);else if(an==="object"){if(typeof Ie.then=="function")return ti(Bn(Ie),lt,Dt,zt,Xt);throw lt=String(Ie),Error("Objects are not valid as a React child (found: "+(lt==="[object Object]"?"object with keys {"+Object.keys(Ie).join(", ")+"}":lt)+"). If you meant to render a collection of children, use an array instead.")}return Ft}function gt(Ie,lt,Dt){if(Ie==null)return Ie;var zt=[],Xt=0;return ti(Ie,zt,"","",function(an){return lt.call(Dt,an,Xt++)}),zt}function Zt(Ie){if(Ie._status===-1){var lt=Ie._result;lt=lt(),lt.then(function(Dt){(Ie._status===0||Ie._status===-1)&&(Ie._status=1,Ie._result=Dt)},function(Dt){(Ie._status===0||Ie._status===-1)&&(Ie._status=2,Ie._result=Dt)}),Ie._status===-1&&(Ie._status=0,Ie._result=lt)}if(Ie._status===1)return Ie._result.default;throw Ie._result}var xt=typeof reportError=="function"?reportError:function(Ie){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var lt=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof Ie=="object"&&Ie!==null&&typeof Ie.message=="string"?String(Ie.message):String(Ie),error:Ie});if(!window.dispatchEvent(lt))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",Ie);return}console.error(Ie)};function jt(){}return di.Children={map:gt,forEach:function(Ie,lt,Dt){gt(Ie,function(){lt.apply(this,arguments)},Dt)},count:function(Ie){var lt=0;return gt(Ie,function(){lt++}),lt},toArray:function(Ie){return gt(Ie,function(lt){return lt})||[]},only:function(Ie){if(!me(Ie))throw Error("React.Children.only expected to receive a single React element child.");return Ie}},di.Component=ze,di.Fragment=t,di.Profiler=h,di.PureComponent=Qe,di.StrictMode=a,di.Suspense=C,di.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=Ve,di.__COMPILER_RUNTIME={__proto__:null,c:function(Ie){return Ve.H.useMemoCache(Ie)}},di.cache=function(Ie){return function(){return Ie.apply(null,arguments)}},di.cloneElement=function(Ie,lt,Dt){if(Ie==null)throw Error("The argument must be a React element, but you passed "+Ie+".");var zt=be({},Ie.props),Xt=Ie.key,an=void 0;if(lt!=null)for(Ft in lt.ref!==void 0&&(an=void 0),lt.key!==void 0&&(Xt=""+lt.key),lt)!it.call(lt,Ft)||Ft==="key"||Ft==="__self"||Ft==="__source"||Ft==="ref"&&lt.ref===void 0||(zt[Ft]=lt[Ft]);var Ft=arguments.length-2;if(Ft===1)zt.children=Dt;else if(1<Ft){for(var Ci=Array(Ft),qn=0;qn<Ft;qn++)Ci[qn]=arguments[qn+2];zt.children=Ci}return de(Ie.type,Xt,void 0,void 0,an,zt)},di.createContext=function(Ie){return Ie={$$typeof:g,_currentValue:Ie,_currentValue2:Ie,_threadCount:0,Provider:null,Consumer:null},Ie.Provider=Ie,Ie.Consumer={$$typeof:m,_context:Ie},Ie},di.createElement=function(Ie,lt,Dt){var zt,Xt={},an=null;if(lt!=null)for(zt in lt.key!==void 0&&(an=""+lt.key),lt)it.call(lt,zt)&&zt!=="key"&&zt!=="__self"&&zt!=="__source"&&(Xt[zt]=lt[zt]);var Ft=arguments.length-2;if(Ft===1)Xt.children=Dt;else if(1<Ft){for(var Ci=Array(Ft),qn=0;qn<Ft;qn++)Ci[qn]=arguments[qn+2];Xt.children=Ci}if(Ie&&Ie.defaultProps)for(zt in Ft=Ie.defaultProps,Ft)Xt[zt]===void 0&&(Xt[zt]=Ft[zt]);return de(Ie,an,void 0,void 0,null,Xt)},di.createRef=function(){return{current:null}},di.forwardRef=function(Ie){return{$$typeof:c,render:Ie}},di.isValidElement=me,di.lazy=function(Ie){return{$$typeof:V,_payload:{_status:-1,_result:Ie},_init:Zt}},di.memo=function(Ie,lt){return{$$typeof:k,type:Ie,compare:lt===void 0?null:lt}},di.startTransition=function(Ie){var lt=Ve.T,Dt={};Ve.T=Dt;try{var zt=Ie(),Xt=Ve.S;Xt!==null&&Xt(Dt,zt),typeof zt=="object"&&zt!==null&&typeof zt.then=="function"&&zt.then(jt,xt)}catch(an){xt(an)}finally{Ve.T=lt}},di.unstable_useCacheRefresh=function(){return Ve.H.useCacheRefresh()},di.use=function(Ie){return Ve.H.use(Ie)},di.useActionState=function(Ie,lt,Dt){return Ve.H.useActionState(Ie,lt,Dt)},di.useCallback=function(Ie,lt){return Ve.H.useCallback(Ie,lt)},di.useContext=function(Ie){return Ve.H.useContext(Ie)},di.useDebugValue=function(){},di.useDeferredValue=function(Ie,lt){return Ve.H.useDeferredValue(Ie,lt)},di.useEffect=function(Ie,lt,Dt){var zt=Ve.H;if(typeof Dt=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return zt.useEffect(Ie,lt)},di.useId=function(){return Ve.H.useId()},di.useImperativeHandle=function(Ie,lt,Dt){return Ve.H.useImperativeHandle(Ie,lt,Dt)},di.useInsertionEffect=function(Ie,lt){return Ve.H.useInsertionEffect(Ie,lt)},di.useLayoutEffect=function(Ie,lt){return Ve.H.useLayoutEffect(Ie,lt)},di.useMemo=function(Ie,lt){return Ve.H.useMemo(Ie,lt)},di.useOptimistic=function(Ie,lt){return Ve.H.useOptimistic(Ie,lt)},di.useReducer=function(Ie,lt,Dt){return Ve.H.useReducer(Ie,lt,Dt)},di.useRef=function(Ie){return Ve.H.useRef(Ie)},di.useState=function(Ie){return Ve.H.useState(Ie)},di.useSyncExternalStore=function(Ie,lt,Dt){return Ve.H.useSyncExternalStore(Ie,lt,Dt)},di.useTransition=function(){return Ve.H.useTransition()},di.version="19.1.1",di}var Xw;function m1(){return Xw||(Xw=1,kb.exports=$P()),kb.exports}var Tt=m1();const GP=uy(Tt);var Lb={exports:{}},y_={},Db={exports:{}},zb={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Kw;function ZP(){return Kw||(Kw=1,(function(i){function e(gt,Zt){var xt=gt.length;gt.push(Zt);e:for(;0<xt;){var jt=xt-1>>>1,Ie=gt[jt];if(0<h(Ie,Zt))gt[jt]=Zt,gt[xt]=Ie,xt=jt;else break e}}function t(gt){return gt.length===0?null:gt[0]}function a(gt){if(gt.length===0)return null;var Zt=gt[0],xt=gt.pop();if(xt!==Zt){gt[0]=xt;e:for(var jt=0,Ie=gt.length,lt=Ie>>>1;jt<lt;){var Dt=2*(jt+1)-1,zt=gt[Dt],Xt=Dt+1,an=gt[Xt];if(0>h(zt,xt))Xt<Ie&&0>h(an,zt)?(gt[jt]=an,gt[Xt]=xt,jt=Xt):(gt[jt]=zt,gt[Dt]=xt,jt=Dt);else if(Xt<Ie&&0>h(an,xt))gt[jt]=an,gt[Xt]=xt,jt=Xt;else break e}}return Zt}function h(gt,Zt){var xt=gt.sortIndex-Zt.sortIndex;return xt!==0?xt:gt.id-Zt.id}if(i.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var m=performance;i.unstable_now=function(){return m.now()}}else{var g=Date,c=g.now();i.unstable_now=function(){return g.now()-c}}var C=[],k=[],V=1,Z=null,Y=3,Q=!1,be=!1,xe=!1,ze=!1,et=typeof setTimeout=="function"?setTimeout:null,Qe=typeof clearTimeout=="function"?clearTimeout:null,Xe=typeof setImmediate<"u"?setImmediate:null;function Ke(gt){for(var Zt=t(k);Zt!==null;){if(Zt.callback===null)a(k);else if(Zt.startTime<=gt)a(k),Zt.sortIndex=Zt.expirationTime,e(C,Zt);else break;Zt=t(k)}}function Ve(gt){if(xe=!1,Ke(gt),!be)if(t(C)!==null)be=!0,it||(it=!0,$e());else{var Zt=t(k);Zt!==null&&ti(Ve,Zt.startTime-gt)}}var it=!1,de=-1,ce=5,me=-1;function Ee(){return ze?!0:!(i.unstable_now()-me<ce)}function De(){if(ze=!1,it){var gt=i.unstable_now();me=gt;var Zt=!0;try{e:{be=!1,xe&&(xe=!1,Qe(de),de=-1),Q=!0;var xt=Y;try{t:{for(Ke(gt),Z=t(C);Z!==null&&!(Z.expirationTime>gt&&Ee());){var jt=Z.callback;if(typeof jt=="function"){Z.callback=null,Y=Z.priorityLevel;var Ie=jt(Z.expirationTime<=gt);if(gt=i.unstable_now(),typeof Ie=="function"){Z.callback=Ie,Ke(gt),Zt=!0;break t}Z===t(C)&&a(C),Ke(gt)}else a(C);Z=t(C)}if(Z!==null)Zt=!0;else{var lt=t(k);lt!==null&&ti(Ve,lt.startTime-gt),Zt=!1}}break e}finally{Z=null,Y=xt,Q=!1}Zt=void 0}}finally{Zt?$e():it=!1}}}var $e;if(typeof Xe=="function")$e=function(){Xe(De)};else if(typeof MessageChannel<"u"){var ke=new MessageChannel,Bn=ke.port2;ke.port1.onmessage=De,$e=function(){Bn.postMessage(null)}}else $e=function(){et(De,0)};function ti(gt,Zt){de=et(function(){gt(i.unstable_now())},Zt)}i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function(gt){gt.callback=null},i.unstable_forceFrameRate=function(gt){0>gt||125<gt?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ce=0<gt?Math.floor(1e3/gt):5},i.unstable_getCurrentPriorityLevel=function(){return Y},i.unstable_next=function(gt){switch(Y){case 1:case 2:case 3:var Zt=3;break;default:Zt=Y}var xt=Y;Y=Zt;try{return gt()}finally{Y=xt}},i.unstable_requestPaint=function(){ze=!0},i.unstable_runWithPriority=function(gt,Zt){switch(gt){case 1:case 2:case 3:case 4:case 5:break;default:gt=3}var xt=Y;Y=gt;try{return Zt()}finally{Y=xt}},i.unstable_scheduleCallback=function(gt,Zt,xt){var jt=i.unstable_now();switch(typeof xt=="object"&&xt!==null?(xt=xt.delay,xt=typeof xt=="number"&&0<xt?jt+xt:jt):xt=jt,gt){case 1:var Ie=-1;break;case 2:Ie=250;break;case 5:Ie=1073741823;break;case 4:Ie=1e4;break;default:Ie=5e3}return Ie=xt+Ie,gt={id:V++,callback:Zt,priorityLevel:gt,startTime:xt,expirationTime:Ie,sortIndex:-1},xt>jt?(gt.sortIndex=xt,e(k,gt),t(C)===null&&gt===t(k)&&(xe?(Qe(de),de=-1):xe=!0,ti(Ve,xt-jt))):(gt.sortIndex=Ie,e(C,gt),be||Q||(be=!0,it||(it=!0,$e()))),gt},i.unstable_shouldYield=Ee,i.unstable_wrapCallback=function(gt){var Zt=Y;return function(){var xt=Y;Y=Zt;try{return gt.apply(this,arguments)}finally{Y=xt}}}})(zb)),zb}var Yw;function HP(){return Yw||(Yw=1,Db.exports=ZP()),Db.exports}var Ob={exports:{}},yl={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Qw;function WP(){if(Qw)return yl;Qw=1;var i=m1();function e(C){var k="https://react.dev/errors/"+C;if(1<arguments.length){k+="?args[]="+encodeURIComponent(arguments[1]);for(var V=2;V<arguments.length;V++)k+="&args[]="+encodeURIComponent(arguments[V])}return"Minified React error #"+C+"; visit "+k+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var a={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},h=Symbol.for("react.portal");function m(C,k,V){var Z=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:h,key:Z==null?null:""+Z,children:C,containerInfo:k,implementation:V}}var g=i.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function c(C,k){if(C==="font")return"";if(typeof k=="string")return k==="use-credentials"?k:""}return yl.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=a,yl.createPortal=function(C,k){var V=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!k||k.nodeType!==1&&k.nodeType!==9&&k.nodeType!==11)throw Error(e(299));return m(C,k,null,V)},yl.flushSync=function(C){var k=g.T,V=a.p;try{if(g.T=null,a.p=2,C)return C()}finally{g.T=k,a.p=V,a.d.f()}},yl.preconnect=function(C,k){typeof C=="string"&&(k?(k=k.crossOrigin,k=typeof k=="string"?k==="use-credentials"?k:"":void 0):k=null,a.d.C(C,k))},yl.prefetchDNS=function(C){typeof C=="string"&&a.d.D(C)},yl.preinit=function(C,k){if(typeof C=="string"&&k&&typeof k.as=="string"){var V=k.as,Z=c(V,k.crossOrigin),Y=typeof k.integrity=="string"?k.integrity:void 0,Q=typeof k.fetchPriority=="string"?k.fetchPriority:void 0;V==="style"?a.d.S(C,typeof k.precedence=="string"?k.precedence:void 0,{crossOrigin:Z,integrity:Y,fetchPriority:Q}):V==="script"&&a.d.X(C,{crossOrigin:Z,integrity:Y,fetchPriority:Q,nonce:typeof k.nonce=="string"?k.nonce:void 0})}},yl.preinitModule=function(C,k){if(typeof C=="string")if(typeof k=="object"&&k!==null){if(k.as==null||k.as==="script"){var V=c(k.as,k.crossOrigin);a.d.M(C,{crossOrigin:V,integrity:typeof k.integrity=="string"?k.integrity:void 0,nonce:typeof k.nonce=="string"?k.nonce:void 0})}}else k==null&&a.d.M(C)},yl.preload=function(C,k){if(typeof C=="string"&&typeof k=="object"&&k!==null&&typeof k.as=="string"){var V=k.as,Z=c(V,k.crossOrigin);a.d.L(C,V,{crossOrigin:Z,integrity:typeof k.integrity=="string"?k.integrity:void 0,nonce:typeof k.nonce=="string"?k.nonce:void 0,type:typeof k.type=="string"?k.type:void 0,fetchPriority:typeof k.fetchPriority=="string"?k.fetchPriority:void 0,referrerPolicy:typeof k.referrerPolicy=="string"?k.referrerPolicy:void 0,imageSrcSet:typeof k.imageSrcSet=="string"?k.imageSrcSet:void 0,imageSizes:typeof k.imageSizes=="string"?k.imageSizes:void 0,media:typeof k.media=="string"?k.media:void 0})}},yl.preloadModule=function(C,k){if(typeof C=="string")if(k){var V=c(k.as,k.crossOrigin);a.d.m(C,{as:typeof k.as=="string"&&k.as!=="script"?k.as:void 0,crossOrigin:V,integrity:typeof k.integrity=="string"?k.integrity:void 0})}else a.d.m(C)},yl.requestFormReset=function(C){a.d.r(C)},yl.unstable_batchedUpdates=function(C,k){return C(k)},yl.useFormState=function(C,k,V){return g.H.useFormState(C,k,V)},yl.useFormStatus=function(){return g.H.useHostTransitionStatus()},yl.version="19.1.1",yl}var Jw;function XP(){if(Jw)return Ob.exports;Jw=1;function i(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(i)}catch(e){console.error(e)}}return i(),Ob.exports=WP(),Ob.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var e2;function KP(){if(e2)return y_;e2=1;var i=HP(),e=m1(),t=XP();function a(s){var d="https://react.dev/errors/"+s;if(1<arguments.length){d+="?args[]="+encodeURIComponent(arguments[1]);for(var y=2;y<arguments.length;y++)d+="&args[]="+encodeURIComponent(arguments[y])}return"Minified React error #"+s+"; visit "+d+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function h(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11)}function m(s){var d=s,y=s;if(s.alternate)for(;d.return;)d=d.return;else{s=d;do d=s,(d.flags&4098)!==0&&(y=d.return),s=d.return;while(s)}return d.tag===3?y:null}function g(s){if(s.tag===13){var d=s.memoizedState;if(d===null&&(s=s.alternate,s!==null&&(d=s.memoizedState)),d!==null)return d.dehydrated}return null}function c(s){if(m(s)!==s)throw Error(a(188))}function C(s){var d=s.alternate;if(!d){if(d=m(s),d===null)throw Error(a(188));return d!==s?null:s}for(var y=s,S=d;;){var D=y.return;if(D===null)break;var B=D.alternate;if(B===null){if(S=D.return,S!==null){y=S;continue}break}if(D.child===B.child){for(B=D.child;B;){if(B===y)return c(D),s;if(B===S)return c(D),d;B=B.sibling}throw Error(a(188))}if(y.return!==S.return)y=D,S=B;else{for(var ne=!1,he=D.child;he;){if(he===y){ne=!0,y=D,S=B;break}if(he===S){ne=!0,S=D,y=B;break}he=he.sibling}if(!ne){for(he=B.child;he;){if(he===y){ne=!0,y=B,S=D;break}if(he===S){ne=!0,S=B,y=D;break}he=he.sibling}if(!ne)throw Error(a(189))}}if(y.alternate!==S)throw Error(a(190))}if(y.tag!==3)throw Error(a(188));return y.stateNode.current===y?s:d}function k(s){var d=s.tag;if(d===5||d===26||d===27||d===6)return s;for(s=s.child;s!==null;){if(d=k(s),d!==null)return d;s=s.sibling}return null}var V=Object.assign,Z=Symbol.for("react.element"),Y=Symbol.for("react.transitional.element"),Q=Symbol.for("react.portal"),be=Symbol.for("react.fragment"),xe=Symbol.for("react.strict_mode"),ze=Symbol.for("react.profiler"),et=Symbol.for("react.provider"),Qe=Symbol.for("react.consumer"),Xe=Symbol.for("react.context"),Ke=Symbol.for("react.forward_ref"),Ve=Symbol.for("react.suspense"),it=Symbol.for("react.suspense_list"),de=Symbol.for("react.memo"),ce=Symbol.for("react.lazy"),me=Symbol.for("react.activity"),Ee=Symbol.for("react.memo_cache_sentinel"),De=Symbol.iterator;function $e(s){return s===null||typeof s!="object"?null:(s=De&&s[De]||s["@@iterator"],typeof s=="function"?s:null)}var ke=Symbol.for("react.client.reference");function Bn(s){if(s==null)return null;if(typeof s=="function")return s.$$typeof===ke?null:s.displayName||s.name||null;if(typeof s=="string")return s;switch(s){case be:return"Fragment";case ze:return"Profiler";case xe:return"StrictMode";case Ve:return"Suspense";case it:return"SuspenseList";case me:return"Activity"}if(typeof s=="object")switch(s.$$typeof){case Q:return"Portal";case Xe:return(s.displayName||"Context")+".Provider";case Qe:return(s._context.displayName||"Context")+".Consumer";case Ke:var d=s.render;return s=s.displayName,s||(s=d.displayName||d.name||"",s=s!==""?"ForwardRef("+s+")":"ForwardRef"),s;case de:return d=s.displayName||null,d!==null?d:Bn(s.type)||"Memo";case ce:d=s._payload,s=s._init;try{return Bn(s(d))}catch{}}return null}var ti=Array.isArray,gt=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Zt=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,xt={pending:!1,data:null,method:null,action:null},jt=[],Ie=-1;function lt(s){return{current:s}}function Dt(s){0>Ie||(s.current=jt[Ie],jt[Ie]=null,Ie--)}function zt(s,d){Ie++,jt[Ie]=s.current,s.current=d}var Xt=lt(null),an=lt(null),Ft=lt(null),Ci=lt(null);function qn(s,d){switch(zt(Ft,d),zt(an,s),zt(Xt,null),d.nodeType){case 9:case 11:s=(s=d.documentElement)&&(s=s.namespaceURI)?dv(s):0;break;default:if(s=d.tagName,d=d.namespaceURI)d=dv(d),s=o_(d,s);else switch(s){case"svg":s=1;break;case"math":s=2;break;default:s=0}}Dt(Xt),zt(Xt,s)}function zr(){Dt(Xt),Dt(an),Dt(Ft)}function co(s){s.memoizedState!==null&&zt(Ci,s);var d=Xt.current,y=o_(d,s.type);d!==y&&(zt(an,s),zt(Xt,y))}function Us(s){an.current===s&&(Dt(Xt),Dt(an)),Ci.current===s&&(Dt(Ci),He._currentValue=xt)}var Or=Object.prototype.hasOwnProperty,Pi=i.unstable_scheduleCallback,er=i.unstable_cancelCallback,ds=i.unstable_shouldYield,Xa=i.unstable_requestPaint,Nr=i.unstable_now,Ba=i.unstable_getCurrentPriorityLevel,Fi=i.unstable_ImmediatePriority,fr=i.unstable_UserBlockingPriority,fa=i.unstable_NormalPriority,Po=i.unstable_LowPriority,js=i.unstable_IdlePriority,Tl=i.log,fs=i.unstable_setDisableYieldValue,Ta=null,pr=null;function pa(s){if(typeof Tl=="function"&&fs(s),pr&&typeof pr.setStrictMode=="function")try{pr.setStrictMode(Ta,s)}catch{}}var je=Math.clz32?Math.clz32:fe,se=Math.log,le=Math.LN2;function fe(s){return s>>>=0,s===0?32:31-(se(s)/le|0)|0}var Se=256,Ne=4194304;function Ge(s){var d=s&42;if(d!==0)return d;switch(s&-s){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return s&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return s}}function Je(s,d,y){var S=s.pendingLanes;if(S===0)return 0;var D=0,B=s.suspendedLanes,ne=s.pingedLanes;s=s.warmLanes;var he=S&134217727;return he!==0?(S=he&~B,S!==0?D=Ge(S):(ne&=he,ne!==0?D=Ge(ne):y||(y=he&~s,y!==0&&(D=Ge(y))))):(he=S&~B,he!==0?D=Ge(he):ne!==0?D=Ge(ne):y||(y=S&~s,y!==0&&(D=Ge(y)))),D===0?0:d!==0&&d!==D&&(d&B)===0&&(B=D&-D,y=d&-d,B>=y||B===32&&(y&4194048)!==0)?d:D}function Ze(s,d){return(s.pendingLanes&~(s.suspendedLanes&~s.pingedLanes)&d)===0}function yt(s,d){switch(s){case 1:case 2:case 4:case 8:case 64:return d+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return d+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function At(){var s=Se;return Se<<=1,(Se&4194048)===0&&(Se=256),s}function bt(){var s=Ne;return Ne<<=1,(Ne&62914560)===0&&(Ne=4194304),s}function en(s){for(var d=[],y=0;31>y;y++)d.push(s);return d}function qe(s,d){s.pendingLanes|=d,d!==268435456&&(s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0)}function Cn(s,d,y,S,D,B){var ne=s.pendingLanes;s.pendingLanes=y,s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0,s.expiredLanes&=y,s.entangledLanes&=y,s.errorRecoveryDisabledLanes&=y,s.shellSuspendCounter=0;var he=s.entanglements,Be=s.expirationTimes,ht=s.hiddenUpdates;for(y=ne&~y;0<y;){var St=31-je(y),Mt=1<<St;he[St]=0,Be[St]=-1;var ft=ht[St];if(ft!==null)for(ht[St]=null,St=0;St<ft.length;St++){var vt=ft[St];vt!==null&&(vt.lane&=-536870913)}y&=~Mt}S!==0&&Fn(s,S,0),B!==0&&D===0&&s.tag!==0&&(s.suspendedLanes|=B&~(ne&~d))}function Fn(s,d,y){s.pendingLanes|=d,s.suspendedLanes&=~d;var S=31-je(d);s.entangledLanes|=d,s.entanglements[S]=s.entanglements[S]|1073741824|y&4194090}function rn(s,d){var y=s.entangledLanes|=d;for(s=s.entanglements;y;){var S=31-je(y),D=1<<S;D&d|s[S]&d&&(s[S]|=d),y&=~D}}function Dn(s){switch(s){case 2:s=1;break;case 8:s=4;break;case 32:s=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:s=128;break;case 268435456:s=134217728;break;default:s=0}return s}function wi(s){return s&=-s,2<s?8<s?(s&134217727)!==0?32:268435456:8:2}function Xi(){var s=Zt.p;return s!==0?s:(s=window.event,s===void 0?32:xn(s.type))}function Er(s,d){var y=Zt.p;try{return Zt.p=s,d()}finally{Zt.p=y}}var Mi=Math.random().toString(36).slice(2),vn="__reactFiber$"+Mi,Pn="__reactProps$"+Mi,Vi="__reactContainer$"+Mi,Ct="__reactEvents$"+Mi,Qt="__reactListeners$"+Mi,tr="__reactHandles$"+Mi,la="__reactResources$"+Mi,ps="__reactMarker$"+Mi;function Vt(s){delete s[vn],delete s[Pn],delete s[Ct],delete s[Qt],delete s[tr]}function Rn(s){var d=s[vn];if(d)return d;for(var y=s.parentNode;y;){if(d=y[Vi]||y[vn]){if(y=d.alternate,d.child!==null||y!==null&&y.child!==null)for(s=Cd(s);s!==null;){if(y=s[vn])return y;s=Cd(s)}return d}s=y,y=s.parentNode}return null}function In(s){if(s=s[vn]||s[Vi]){var d=s.tag;if(d===5||d===6||d===13||d===26||d===27||d===3)return s}return null}function zi(s){var d=s.tag;if(d===5||d===26||d===27||d===6)return s.stateNode;throw Error(a(33))}function Ka(s){var d=s[la];return d||(d=s[la]={hoistableStyles:new Map,hoistableScripts:new Map}),d}function Ui(s){s[ps]=!0}var Vn=new Set,$o={};function Sa(s,d){ms(s,d),ms(s+"Capture",d)}function ms(s,d){for($o[s]=d,s=0;s<d.length;s++)Vn.add(d[s])}var Fa=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),ma={},Ki={};function Vu(s){return Or.call(Ki,s)?!0:Or.call(ma,s)?!1:Fa.test(s)?Ki[s]=!0:(ma[s]=!0,!1)}function Wr(s,d,y){if(Vu(d))if(y===null)s.removeAttribute(d);else{switch(typeof y){case"undefined":case"function":case"symbol":s.removeAttribute(d);return;case"boolean":var S=d.toLowerCase().slice(0,5);if(S!=="data-"&&S!=="aria-"){s.removeAttribute(d);return}}s.setAttribute(d,""+y)}}function fi(s,d,y){if(y===null)s.removeAttribute(d);else{switch(typeof y){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(d);return}s.setAttribute(d,""+y)}}function qs(s,d,y,S){if(S===null)s.removeAttribute(y);else{switch(typeof S){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(y);return}s.setAttributeNS(d,y,""+S)}}var $s,ho;function Ea(s){if($s===void 0)try{throw Error()}catch(y){var d=y.stack.trim().match(/\n( *(at )?)/);$s=d&&d[1]||"",ho=-1<y.stack.indexOf(`
    at`)?" (<anonymous>)":-1<y.stack.indexOf("@")?"@unknown:0:0":""}return`
`+$s+s+ho}var gs=!1;function fo(s,d){if(!s||gs)return"";gs=!0;var y=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var S={DetermineComponentFrameRoot:function(){try{if(d){var Mt=function(){throw Error()};if(Object.defineProperty(Mt.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Mt,[])}catch(vt){var ft=vt}Reflect.construct(s,[],Mt)}else{try{Mt.call()}catch(vt){ft=vt}s.call(Mt.prototype)}}else{try{throw Error()}catch(vt){ft=vt}(Mt=s())&&typeof Mt.catch=="function"&&Mt.catch(function(){})}}catch(vt){if(vt&&ft&&typeof vt.stack=="string")return[vt.stack,ft.stack]}return[null,null]}};S.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var D=Object.getOwnPropertyDescriptor(S.DetermineComponentFrameRoot,"name");D&&D.configurable&&Object.defineProperty(S.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var B=S.DetermineComponentFrameRoot(),ne=B[0],he=B[1];if(ne&&he){var Be=ne.split(`
`),ht=he.split(`
`);for(D=S=0;S<Be.length&&!Be[S].includes("DetermineComponentFrameRoot");)S++;for(;D<ht.length&&!ht[D].includes("DetermineComponentFrameRoot");)D++;if(S===Be.length||D===ht.length)for(S=Be.length-1,D=ht.length-1;1<=S&&0<=D&&Be[S]!==ht[D];)D--;for(;1<=S&&0<=D;S--,D--)if(Be[S]!==ht[D]){if(S!==1||D!==1)do if(S--,D--,0>D||Be[S]!==ht[D]){var St=`
`+Be[S].replace(" at new "," at ");return s.displayName&&St.includes("<anonymous>")&&(St=St.replace("<anonymous>",s.displayName)),St}while(1<=S&&0<=D);break}}}finally{gs=!1,Error.prepareStackTrace=y}return(y=s?s.displayName||s.name:"")?Ea(y):""}function ci(s){switch(s.tag){case 26:case 27:case 5:return Ea(s.type);case 16:return Ea("Lazy");case 13:return Ea("Suspense");case 19:return Ea("SuspenseList");case 0:case 15:return fo(s.type,!1);case 11:return fo(s.type.render,!1);case 1:return fo(s.type,!0);case 31:return Ea("Activity");default:return""}}function pi(s){try{var d="";do d+=ci(s),s=s.return;while(s);return d}catch(y){return`
Error generating stack: `+y.message+`
`+y.stack}}function Ti(s){switch(typeof s){case"bigint":case"boolean":case"number":case"string":case"undefined":return s;case"object":return s;default:return""}}function _s(s){var d=s.type;return(s=s.nodeName)&&s.toLowerCase()==="input"&&(d==="checkbox"||d==="radio")}function po(s){var d=_s(s)?"checked":"value",y=Object.getOwnPropertyDescriptor(s.constructor.prototype,d),S=""+s[d];if(!s.hasOwnProperty(d)&&typeof y<"u"&&typeof y.get=="function"&&typeof y.set=="function"){var D=y.get,B=y.set;return Object.defineProperty(s,d,{configurable:!0,get:function(){return D.call(this)},set:function(ne){S=""+ne,B.call(this,ne)}}),Object.defineProperty(s,d,{enumerable:y.enumerable}),{getValue:function(){return S},setValue:function(ne){S=""+ne},stopTracking:function(){s._valueTracker=null,delete s[d]}}}}function Go(s){s._valueTracker||(s._valueTracker=po(s))}function cn(s){if(!s)return!1;var d=s._valueTracker;if(!d)return!0;var y=d.getValue(),S="";return s&&(S=_s(s)?s.checked?"true":"false":s.value),s=S,s!==y?(d.setValue(s),!0):!1}function Si(s){if(s=s||(typeof document<"u"?document:void 0),typeof s>"u")return null;try{return s.activeElement||s.body}catch{return s.body}}var ys=/[\n"\\]/g;function Ar(s){return s.replace(ys,function(d){return"\\"+d.charCodeAt(0).toString(16)+" "})}function ga(s,d,y,S,D,B,ne,he){s.name="",ne!=null&&typeof ne!="function"&&typeof ne!="symbol"&&typeof ne!="boolean"?s.type=ne:s.removeAttribute("type"),d!=null?ne==="number"?(d===0&&s.value===""||s.value!=d)&&(s.value=""+Ti(d)):s.value!==""+Ti(d)&&(s.value=""+Ti(d)):ne!=="submit"&&ne!=="reset"||s.removeAttribute("value"),d!=null?Ho(s,ne,Ti(d)):y!=null?Ho(s,ne,Ti(y)):S!=null&&s.removeAttribute("value"),D==null&&B!=null&&(s.defaultChecked=!!B),D!=null&&(s.checked=D&&typeof D!="function"&&typeof D!="symbol"),he!=null&&typeof he!="function"&&typeof he!="symbol"&&typeof he!="boolean"?s.name=""+Ti(he):s.removeAttribute("name")}function Zo(s,d,y,S,D,B,ne,he){if(B!=null&&typeof B!="function"&&typeof B!="symbol"&&typeof B!="boolean"&&(s.type=B),d!=null||y!=null){if(!(B!=="submit"&&B!=="reset"||d!=null))return;y=y!=null?""+Ti(y):"",d=d!=null?""+Ti(d):y,he||d===s.value||(s.value=d),s.defaultValue=d}S=S??D,S=typeof S!="function"&&typeof S!="symbol"&&!!S,s.checked=he?s.checked:!!S,s.defaultChecked=!!S,ne!=null&&typeof ne!="function"&&typeof ne!="symbol"&&typeof ne!="boolean"&&(s.name=ne)}function Ho(s,d,y){d==="number"&&Si(s.ownerDocument)===s||s.defaultValue===""+y||(s.defaultValue=""+y)}function Va(s,d,y,S){if(s=s.options,d){d={};for(var D=0;D<y.length;D++)d["$"+y[D]]=!0;for(y=0;y<s.length;y++)D=d.hasOwnProperty("$"+s[y].value),s[y].selected!==D&&(s[y].selected=D),D&&S&&(s[y].defaultSelected=!0)}else{for(y=""+Ti(y),d=null,D=0;D<s.length;D++){if(s[D].value===y){s[D].selected=!0,S&&(s[D].defaultSelected=!0);return}d!==null||s[D].disabled||(d=s[D])}d!==null&&(d.selected=!0)}}function Ir(s,d,y){if(d!=null&&(d=""+Ti(d),d!==s.value&&(s.value=d),y==null)){s.defaultValue!==d&&(s.defaultValue=d);return}s.defaultValue=y!=null?""+Ti(y):""}function Ya(s,d,y,S){if(d==null){if(S!=null){if(y!=null)throw Error(a(92));if(ti(S)){if(1<S.length)throw Error(a(93));S=S[0]}y=S}y==null&&(y=""),d=y}y=Ti(d),s.defaultValue=y,S=s.textContent,S===y&&S!==""&&S!==null&&(s.value=S)}function Xr(s,d){if(d){var y=s.firstChild;if(y&&y===s.lastChild&&y.nodeType===3){y.nodeValue=d;return}}s.textContent=d}var Cr=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Un(s,d,y){var S=d.indexOf("--")===0;y==null||typeof y=="boolean"||y===""?S?s.setProperty(d,""):d==="float"?s.cssFloat="":s[d]="":S?s.setProperty(d,y):typeof y!="number"||y===0||Cr.has(d)?d==="float"?s.cssFloat=y:s[d]=(""+y).trim():s[d]=y+"px"}function Qa(s,d,y){if(d!=null&&typeof d!="object")throw Error(a(62));if(s=s.style,y!=null){for(var S in y)!y.hasOwnProperty(S)||d!=null&&d.hasOwnProperty(S)||(S.indexOf("--")===0?s.setProperty(S,""):S==="float"?s.cssFloat="":s[S]="");for(var D in d)S=d[D],d.hasOwnProperty(D)&&y[D]!==S&&Un(s,D,S)}else for(var B in d)d.hasOwnProperty(B)&&Un(s,B,d[B])}function Ja(s){if(s.indexOf("-")===-1)return!1;switch(s){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var vs=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Gs=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Mn(s){return Gs.test(""+s)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":s}var Zs=null;function Mo(s){return s=s.target||s.srcElement||window,s.correspondingUseElement&&(s=s.correspondingUseElement),s.nodeType===3?s.parentNode:s}var mo=null,Ei=null;function qr(s){var d=In(s);if(d&&(s=d.stateNode)){var y=s[Pn]||null;e:switch(s=d.stateNode,d.type){case"input":if(ga(s,y.value,y.defaultValue,y.defaultValue,y.checked,y.defaultChecked,y.type,y.name),d=y.name,y.type==="radio"&&d!=null){for(y=s;y.parentNode;)y=y.parentNode;for(y=y.querySelectorAll('input[name="'+Ar(""+d)+'"][type="radio"]'),d=0;d<y.length;d++){var S=y[d];if(S!==s&&S.form===s.form){var D=S[Pn]||null;if(!D)throw Error(a(90));ga(S,D.value,D.defaultValue,D.defaultValue,D.checked,D.defaultChecked,D.type,D.name)}}for(d=0;d<y.length;d++)S=y[d],S.form===s.form&&cn(S)}break e;case"textarea":Ir(s,y.value,y.defaultValue);break e;case"select":d=y.value,d!=null&&Va(s,!!y.multiple,d,!1)}}}var fn=!1;function hi(s,d,y){if(fn)return s(d,y);fn=!0;try{var S=s(d);return S}finally{if(fn=!1,(mo!==null||Ei!==null)&&(Im(),mo&&(d=mo,s=Ei,Ei=mo=null,qr(d),s)))for(d=0;d<s.length;d++)qr(s[d])}}function bn(s,d){var y=s.stateNode;if(y===null)return null;var S=y[Pn]||null;if(S===null)return null;y=S[d];e:switch(d){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(S=!S.disabled)||(s=s.type,S=!(s==="button"||s==="input"||s==="select"||s==="textarea")),s=!S;break e;default:s=!1}if(s)return null;if(y&&typeof y!="function")throw Error(a(231,d,typeof y));return y}var Aa=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),or=!1;if(Aa)try{var Br={};Object.defineProperty(Br,"passive",{get:function(){or=!0}}),window.addEventListener("test",Br,Br),window.removeEventListener("test",Br,Br)}catch{or=!1}var Oi=null,Tn=null,bs=null;function pn(){if(bs)return bs;var s,d=Tn,y=d.length,S,D="value"in Oi?Oi.value:Oi.textContent,B=D.length;for(s=0;s<y&&d[s]===D[s];s++);var ne=y-s;for(S=1;S<=ne&&d[y-S]===D[B-S];S++);return bs=D.slice(s,1<S?1-S:void 0)}function sn(s){var d=s.keyCode;return"charCode"in s?(s=s.charCode,s===0&&d===13&&(s=13)):s=d,s===10&&(s=13),32<=s||s===13?s:0}function $r(){return!0}function Jn(){return!1}function xi(s){function d(y,S,D,B,ne){this._reactName=y,this._targetInst=D,this.type=S,this.nativeEvent=B,this.target=ne,this.currentTarget=null;for(var he in s)s.hasOwnProperty(he)&&(y=s[he],this[he]=y?y(B):B[he]);return this.isDefaultPrevented=(B.defaultPrevented!=null?B.defaultPrevented:B.returnValue===!1)?$r:Jn,this.isPropagationStopped=Jn,this}return V(d.prototype,{preventDefault:function(){this.defaultPrevented=!0;var y=this.nativeEvent;y&&(y.preventDefault?y.preventDefault():typeof y.returnValue!="unknown"&&(y.returnValue=!1),this.isDefaultPrevented=$r)},stopPropagation:function(){var y=this.nativeEvent;y&&(y.stopPropagation?y.stopPropagation():typeof y.cancelBubble!="unknown"&&(y.cancelBubble=!0),this.isPropagationStopped=$r)},persist:function(){},isPersistent:$r}),d}var lr={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(s){return s.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Ia=xi(lr),go=V({},lr,{view:0,detail:0}),Sl=xi(go),_o,Xn,Hs,Kr=V({},go,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ko,button:0,buttons:0,relatedTarget:function(s){return s.relatedTarget===void 0?s.fromElement===s.srcElement?s.toElement:s.fromElement:s.relatedTarget},movementX:function(s){return"movementX"in s?s.movementX:(s!==Hs&&(Hs&&s.type==="mousemove"?(_o=s.screenX-Hs.screenX,Xn=s.screenY-Hs.screenY):Xn=_o=0,Hs=s),_o)},movementY:function(s){return"movementY"in s?s.movementY:Xn}}),xs=xi(Kr),ws=V({},Kr,{dataTransfer:0}),Gr=xi(ws),Ts=V({},go,{relatedTarget:0}),Wo=xi(Ts),Ro=V({},lr,{animationName:0,elapsedTime:0,pseudoElement:0}),nr=xi(Ro),Uu=V({},lr,{clipboardData:function(s){return"clipboardData"in s?s.clipboardData:window.clipboardData}}),Xo=xi(Uu),Hl=V({},lr,{data:0}),Ss=xi(Hl),El={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},ir={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},es={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Es(s){var d=this.nativeEvent;return d.getModifierState?d.getModifierState(s):(s=es[s])?!!d[s]:!1}function ko(){return Es}var Ko=V({},go,{key:function(s){if(s.key){var d=El[s.key]||s.key;if(d!=="Unidentified")return d}return s.type==="keypress"?(s=sn(s),s===13?"Enter":String.fromCharCode(s)):s.type==="keydown"||s.type==="keyup"?ir[s.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ko,charCode:function(s){return s.type==="keypress"?sn(s):0},keyCode:function(s){return s.type==="keydown"||s.type==="keyup"?s.keyCode:0},which:function(s){return s.type==="keypress"?sn(s):s.type==="keydown"||s.type==="keyup"?s.keyCode:0}}),Yo=xi(Ko),Ai=V({},Kr,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),hu=xi(Ai),du=V({},go,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ko}),Wl=xi(du),M=V({},lr,{propertyName:0,elapsedTime:0,pseudoElement:0}),G=xi(M),te=V({},Kr,{deltaX:function(s){return"deltaX"in s?s.deltaX:"wheelDeltaX"in s?-s.wheelDeltaX:0},deltaY:function(s){return"deltaY"in s?s.deltaY:"wheelDeltaY"in s?-s.wheelDeltaY:"wheelDelta"in s?-s.wheelDelta:0},deltaZ:0,deltaMode:0}),ye=xi(te),at=V({},lr,{newState:0,oldState:0}),pt=xi(at),Wt=[9,13,27,32],kn=Aa&&"CompositionEvent"in window,$n=null;Aa&&"documentMode"in document&&($n=document.documentMode);var Ri=Aa&&"TextEvent"in window&&!$n,ur=Aa&&(!kn||$n&&8<$n&&11>=$n),Ca=" ",Ua=!1;function Ws(s,d){switch(s){case"keyup":return Wt.indexOf(d.keyCode)!==-1;case"keydown":return d.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function As(s){return s=s.detail,typeof s=="object"&&"data"in s?s.data:null}var Lo=!1;function yo(s,d){switch(s){case"compositionend":return As(d);case"keypress":return d.which!==32?null:(Ua=!0,Ca);case"textInput":return s=d.data,s===Ca&&Ua?null:s;default:return null}}function Gd(s,d){if(Lo)return s==="compositionend"||!kn&&Ws(s,d)?(s=pn(),bs=Tn=Oi=null,Lo=!1,s):null;switch(s){case"paste":return null;case"keypress":if(!(d.ctrlKey||d.altKey||d.metaKey)||d.ctrlKey&&d.altKey){if(d.char&&1<d.char.length)return d.char;if(d.which)return String.fromCharCode(d.which)}return null;case"compositionend":return ur&&d.locale!=="ko"?null:d.data;default:return null}}var Xs={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function fu(s){var d=s&&s.nodeName&&s.nodeName.toLowerCase();return d==="input"?!!Xs[s.type]:d==="textarea"}function nd(s,d,y,S){mo?Ei?Ei.push(S):Ei=[S]:mo=S,d=vp(d,"onChange"),0<d.length&&(y=new Ia("onChange","change",null,y,S),s.push({event:y,listeners:d}))}var ts=null,ju=null;function Al(s){uv(s,0)}function Sc(s){var d=zi(s);if(cn(d))return s}function pu(s,d){if(s==="change")return d}var Il=!1;if(Aa){var Xl;if(Aa){var Ec="oninput"in document;if(!Ec){var Ks=document.createElement("div");Ks.setAttribute("oninput","return;"),Ec=typeof Ks.oninput=="function"}Xl=Ec}else Xl=!1;Il=Xl&&(!document.documentMode||9<document.documentMode)}function Ac(){ts&&(ts.detachEvent("onpropertychange",qu),ju=ts=null)}function qu(s){if(s.propertyName==="value"&&Sc(ju)){var d=[];nd(d,ju,s,Mo(s)),hi(Al,d)}}function hh(s,d,y){s==="focusin"?(Ac(),ts=d,ju=y,ts.attachEvent("onpropertychange",qu)):s==="focusout"&&Ac()}function Zf(s){if(s==="selectionchange"||s==="keyup"||s==="keydown")return Sc(ju)}function Qo(s,d){if(s==="click")return Sc(d)}function Zd(s,d){if(s==="input"||s==="change")return Sc(d)}function Kl(s,d){return s===d&&(s!==0||1/s===1/d)||s!==s&&d!==d}var ns=typeof Object.is=="function"?Object.is:Kl;function Is(s,d){if(ns(s,d))return!0;if(typeof s!="object"||s===null||typeof d!="object"||d===null)return!1;var y=Object.keys(s),S=Object.keys(d);if(y.length!==S.length)return!1;for(S=0;S<y.length;S++){var D=y[S];if(!Or.call(d,D)||!ns(s[D],d[D]))return!1}return!0}function Yl(s){for(;s&&s.firstChild;)s=s.firstChild;return s}function Do(s,d){var y=Yl(s);s=0;for(var S;y;){if(y.nodeType===3){if(S=s+y.textContent.length,s<=d&&S>=d)return{node:y,offset:d-s};s=S}e:{for(;y;){if(y.nextSibling){y=y.nextSibling;break e}y=y.parentNode}y=void 0}y=Yl(y)}}function oi(s,d){return s&&d?s===d?!0:s&&s.nodeType===3?!1:d&&d.nodeType===3?oi(s,d.parentNode):"contains"in s?s.contains(d):s.compareDocumentPosition?!!(s.compareDocumentPosition(d)&16):!1:!1}function mu(s){s=s!=null&&s.ownerDocument!=null&&s.ownerDocument.defaultView!=null?s.ownerDocument.defaultView:window;for(var d=Si(s.document);d instanceof s.HTMLIFrameElement;){try{var y=typeof d.contentWindow.location.href=="string"}catch{y=!1}if(y)s=d.contentWindow;else break;d=Si(s.document)}return d}function gu(s){var d=s&&s.nodeName&&s.nodeName.toLowerCase();return d&&(d==="input"&&(s.type==="text"||s.type==="search"||s.type==="tel"||s.type==="url"||s.type==="password")||d==="textarea"||s.contentEditable==="true")}var Ic=Aa&&"documentMode"in document&&11>=document.documentMode,Ys=null,vo=null,Cl=null,dh=!1;function Hd(s,d,y){var S=y.window===y?y.document:y.nodeType===9?y:y.ownerDocument;dh||Ys==null||Ys!==Si(S)||(S=Ys,"selectionStart"in S&&gu(S)?S={start:S.selectionStart,end:S.selectionEnd}:(S=(S.ownerDocument&&S.ownerDocument.defaultView||window).getSelection(),S={anchorNode:S.anchorNode,anchorOffset:S.anchorOffset,focusNode:S.focusNode,focusOffset:S.focusOffset}),Cl&&Is(Cl,S)||(Cl=S,S=vp(vo,"onSelect"),0<S.length&&(d=new Ia("onSelect","select",null,d,y),s.push({event:d,listeners:S}),d.target=Ys)))}function Jo(s,d){var y={};return y[s.toLowerCase()]=d.toLowerCase(),y["Webkit"+s]="webkit"+d,y["Moz"+s]="moz"+d,y}var $u={animationend:Jo("Animation","AnimationEnd"),animationiteration:Jo("Animation","AnimationIteration"),animationstart:Jo("Animation","AnimationStart"),transitionrun:Jo("Transition","TransitionRun"),transitionstart:Jo("Transition","TransitionStart"),transitioncancel:Jo("Transition","TransitionCancel"),transitionend:Jo("Transition","TransitionEnd")},Cc={},Wd={};Aa&&(Wd=document.createElement("div").style,"AnimationEvent"in window||(delete $u.animationend.animation,delete $u.animationiteration.animation,delete $u.animationstart.animation),"TransitionEvent"in window||delete $u.transitionend.transition);function Pl(s){if(Cc[s])return Cc[s];if(!$u[s])return s;var d=$u[s],y;for(y in d)if(d.hasOwnProperty(y)&&y in Wd)return Cc[s]=d[y];return s}var Pc=Pl("animationend"),Cs=Pl("animationiteration"),Ql=Pl("animationstart"),id=Pl("transitionrun"),el=Pl("transitionstart"),Mc=Pl("transitioncancel"),Jl=Pl("transitionend"),Qs=new Map,eu="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");eu.push("scrollEnd");function bo(s,d){Qs.set(s,d),Sa(d,[s])}var Ml=new WeakMap;function ua(s,d){if(typeof s=="object"&&s!==null){var y=Ml.get(s);return y!==void 0?y:(d={value:s,source:d,stack:pi(d)},Ml.set(s,d),d)}return{value:s,source:d,stack:pi(d)}}var ja=[],Rl=0,is=0;function tu(){for(var s=Rl,d=is=Rl=0;d<s;){var y=ja[d];ja[d++]=null;var S=ja[d];ja[d++]=null;var D=ja[d];ja[d++]=null;var B=ja[d];if(ja[d++]=null,S!==null&&D!==null){var ne=S.pending;ne===null?D.next=D:(D.next=ne.next,ne.next=D),S.pending=D}B!==0&&Zu(y,D,B)}}function Gu(s,d,y,S){ja[Rl++]=s,ja[Rl++]=d,ja[Rl++]=y,ja[Rl++]=S,is|=S,s.lanes|=S,s=s.alternate,s!==null&&(s.lanes|=S)}function xo(s,d,y,S){return Gu(s,d,y,S),tl(s)}function Js(s,d){return Gu(s,null,null,d),tl(s)}function Zu(s,d,y){s.lanes|=y;var S=s.alternate;S!==null&&(S.lanes|=y);for(var D=!1,B=s.return;B!==null;)B.childLanes|=y,S=B.alternate,S!==null&&(S.childLanes|=y),B.tag===22&&(s=B.stateNode,s===null||s._visibility&1||(D=!0)),s=B,B=B.return;return s.tag===3?(B=s.stateNode,D&&d!==null&&(D=31-je(y),s=B.hiddenUpdates,S=s[D],S===null?s[D]=[d]:S.push(d),d.lane=y|536870912),B):null}function tl(s){if(50<wd)throw wd=0,kh=null,Error(a(185));for(var d=s.return;d!==null;)s=d,d=s.return;return s.tag===3?s.stateNode:null}var Gn={};function Hu(s,d,y,S){this.tag=s,this.key=y,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=d,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=S,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function eo(s,d,y,S){return new Hu(s,d,y,S)}function Rc(s){return s=s.prototype,!(!s||!s.isReactComponent)}function Pa(s,d){var y=s.alternate;return y===null?(y=eo(s.tag,d,s.key,s.mode),y.elementType=s.elementType,y.type=s.type,y.stateNode=s.stateNode,y.alternate=s,s.alternate=y):(y.pendingProps=d,y.type=s.type,y.flags=0,y.subtreeFlags=0,y.deletions=null),y.flags=s.flags&65011712,y.childLanes=s.childLanes,y.lanes=s.lanes,y.child=s.child,y.memoizedProps=s.memoizedProps,y.memoizedState=s.memoizedState,y.updateQueue=s.updateQueue,d=s.dependencies,y.dependencies=d===null?null:{lanes:d.lanes,firstContext:d.firstContext},y.sibling=s.sibling,y.index=s.index,y.ref=s.ref,y.refCleanup=s.refCleanup,y}function fh(s,d){s.flags&=65011714;var y=s.alternate;return y===null?(s.childLanes=0,s.lanes=d,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=y.childLanes,s.lanes=y.lanes,s.child=y.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=y.memoizedProps,s.memoizedState=y.memoizedState,s.updateQueue=y.updateQueue,s.type=y.type,d=y.dependencies,s.dependencies=d===null?null:{lanes:d.lanes,firstContext:d.firstContext}),s}function kc(s,d,y,S,D,B){var ne=0;if(S=s,typeof s=="function")Rc(s)&&(ne=1);else if(typeof s=="string")ne=z(s,y,Xt.current)?26:s==="html"||s==="head"||s==="body"?27:5;else e:switch(s){case me:return s=eo(31,y,d,D),s.elementType=me,s.lanes=B,s;case be:return kl(y.children,D,B,d);case xe:ne=8,D|=24;break;case ze:return s=eo(12,y,d,D|2),s.elementType=ze,s.lanes=B,s;case Ve:return s=eo(13,y,d,D),s.elementType=Ve,s.lanes=B,s;case it:return s=eo(19,y,d,D),s.elementType=it,s.lanes=B,s;default:if(typeof s=="object"&&s!==null)switch(s.$$typeof){case et:case Xe:ne=10;break e;case Qe:ne=9;break e;case Ke:ne=11;break e;case de:ne=14;break e;case ce:ne=16,S=null;break e}ne=29,y=Error(a(130,s===null?"null":typeof s,"")),S=null}return d=eo(ne,y,d,D),d.elementType=s,d.type=S,d.lanes=B,d}function kl(s,d,y,S){return s=eo(7,s,S,d),s.lanes=y,s}function rd(s,d,y){return s=eo(6,s,null,d),s.lanes=y,s}function Wu(s,d,y){return d=eo(4,s.children!==null?s.children:[],s.key,d),d.lanes=y,d.stateNode={containerInfo:s.containerInfo,pendingChildren:null,implementation:s.implementation},d}var nl=[],il=0,f=null,x=0,R=[],U=0,K=null,ue=1,Oe="";function nt(s,d){nl[il++]=x,nl[il++]=f,f=s,x=d}function mt(s,d,y){R[U++]=ue,R[U++]=Oe,R[U++]=K,K=s;var S=ue;s=Oe;var D=32-je(S)-1;S&=~(1<<D),y+=1;var B=32-je(d)+D;if(30<B){var ne=D-D%5;B=(S&(1<<ne)-1).toString(32),S>>=ne,D-=ne,ue=1<<32-je(d)+D|y<<D|S,Oe=B+s}else ue=1<<B|y<<D|S,Oe=s}function Rt(s){s.return!==null&&(nt(s,1),mt(s,1,0))}function Jt(s){for(;s===f;)f=nl[--il],nl[il]=null,x=nl[--il],nl[il]=null;for(;s===K;)K=R[--U],R[U]=null,Oe=R[--U],R[U]=null,ue=R[--U],R[U]=null}var on=null,_n=null,Zn=!1,cr=null,mr=!1,_a=Error(a(519));function wo(s){var d=Error(a(418,""));throw rl(ua(d,s)),_a}function ph(s){var d=s.stateNode,y=s.type,S=s.memoizedProps;switch(d[vn]=s,d[Pn]=S,y){case"dialog":bi("cancel",d),bi("close",d);break;case"iframe":case"object":case"embed":bi("load",d);break;case"video":case"audio":for(y=0;y<_p.length;y++)bi(_p[y],d);break;case"source":bi("error",d);break;case"img":case"image":case"link":bi("error",d),bi("load",d);break;case"details":bi("toggle",d);break;case"input":bi("invalid",d),Zo(d,S.value,S.defaultValue,S.checked,S.defaultChecked,S.type,S.name,!0),Go(d);break;case"select":bi("invalid",d);break;case"textarea":bi("invalid",d),Ya(d,S.value,S.defaultValue,S.children),Go(d)}y=S.children,typeof y!="string"&&typeof y!="number"&&typeof y!="bigint"||d.textContent===""+y||S.suppressHydrationWarning===!0||s_(d.textContent,y)?(S.popover!=null&&(bi("beforetoggle",d),bi("toggle",d)),S.onScroll!=null&&bi("scroll",d),S.onScrollEnd!=null&&bi("scrollend",d),S.onClick!=null&&(d.onclick=Eo),d=!0):d=!1,d||wo(s)}function gr(s){for(on=s.return;on;)switch(on.tag){case 5:case 13:mr=!1;return;case 27:case 3:mr=!0;return;default:on=on.return}}function Ps(s){if(s!==on)return!1;if(!Zn)return gr(s),Zn=!0,!1;var d=s.tag,y;if((y=d!==3&&d!==27)&&((y=d===5)&&(y=s.type,y=!(y!=="form"&&y!=="button")||fc(s.type,s.memoizedProps)),y=!y),y&&_n&&wo(s),gr(s),d===13){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(a(317));e:{for(s=s.nextSibling,d=0;s;){if(s.nodeType===8)if(y=s.data,y==="/$"){if(d===0){_n=Mu(s.nextSibling);break e}d--}else y!=="$"&&y!=="$!"&&y!=="$?"||d++;s=s.nextSibling}_n=null}}else d===27?(d=_n,Kc(s.type)?(s=u_,u_=null,_n=s):_n=d):_n=on?Mu(s.stateNode.nextSibling):null;return!0}function Ma(){_n=on=null,Zn=!1}function Lc(){var s=cr;return s!==null&&(fl===null?fl=s:fl.push.apply(fl,s),cr=null),s}function rl(s){cr===null?cr=[s]:cr.push(s)}var Pr=lt(null),qa=null,To=null;function $a(s,d,y){zt(Pr,d._currentValue),d._currentValue=y}function zo(s){s._currentValue=Pr.current,Dt(Pr)}function Xu(s,d,y){for(;s!==null;){var S=s.alternate;if((s.childLanes&d)!==d?(s.childLanes|=d,S!==null&&(S.childLanes|=d)):S!==null&&(S.childLanes&d)!==d&&(S.childLanes|=d),s===y)break;s=s.return}}function Dc(s,d,y,S){var D=s.child;for(D!==null&&(D.return=s);D!==null;){var B=D.dependencies;if(B!==null){var ne=D.child;B=B.firstContext;e:for(;B!==null;){var he=B;B=D;for(var Be=0;Be<d.length;Be++)if(he.context===d[Be]){B.lanes|=y,he=B.alternate,he!==null&&(he.lanes|=y),Xu(B.return,y,s),S||(ne=null);break e}B=he.next}}else if(D.tag===18){if(ne=D.return,ne===null)throw Error(a(341));ne.lanes|=y,B=ne.alternate,B!==null&&(B.lanes|=y),Xu(ne,y,s),ne=null}else ne=D.child;if(ne!==null)ne.return=D;else for(ne=D;ne!==null;){if(ne===s){ne=null;break}if(D=ne.sibling,D!==null){D.return=ne.return,ne=D;break}ne=ne.return}D=ne}}function Ku(s,d,y,S){s=null;for(var D=d,B=!1;D!==null;){if(!B){if((D.flags&524288)!==0)B=!0;else if((D.flags&262144)!==0)break}if(D.tag===10){var ne=D.alternate;if(ne===null)throw Error(a(387));if(ne=ne.memoizedProps,ne!==null){var he=D.type;ns(D.pendingProps.value,ne.value)||(s!==null?s.push(he):s=[he])}}else if(D===Ci.current){if(ne=D.alternate,ne===null)throw Error(a(387));ne.memoizedState.memoizedState!==D.memoizedState.memoizedState&&(s!==null?s.push(He):s=[He])}D=D.return}s!==null&&Dc(d,s,y,S),d.flags|=262144}function ad(s){for(s=s.firstContext;s!==null;){if(!ns(s.context._currentValue,s.memoizedValue))return!0;s=s.next}return!1}function Yu(s){qa=s,To=null,s=s.dependencies,s!==null&&(s.firstContext=null)}function _r(s){return to(qa,s)}function _u(s,d){return qa===null&&Yu(s),to(s,d)}function to(s,d){var y=d._currentValue;if(d={context:d,memoizedValue:y,next:null},To===null){if(s===null)throw Error(a(308));To=d,s.dependencies={lanes:0,firstContext:d},s.flags|=524288}else To=To.next=d;return y}var mh=typeof AbortController<"u"?AbortController:function(){var s=[],d=this.signal={aborted:!1,addEventListener:function(y,S){s.push(S)}};this.abort=function(){d.aborted=!0,s.forEach(function(y){return y()})}},Hf=i.unstable_scheduleCallback,lm=i.unstable_NormalPriority,ya={$$typeof:Xe,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Qu(){return{controller:new mh,data:new Map,refCount:0}}function zc(s){s.refCount--,s.refCount===0&&Hf(lm,function(){s.controller.abort()})}var nu=null,Xd=0,Ra=0,Ms=null;function gh(s,d){if(nu===null){var y=nu=[];Xd=0,Ra=mp(),Ms={status:"pending",value:void 0,then:function(S){y.push(S)}}}return Xd++,d.then(al,al),d}function al(){if(--Xd===0&&nu!==null){Ms!==null&&(Ms.status="fulfilled");var s=nu;nu=null,Ra=0,Ms=null;for(var d=0;d<s.length;d++)(0,s[d])()}}function _h(s,d){var y=[],S={status:"pending",value:null,reason:null,then:function(D){y.push(D)}};return s.then(function(){S.status="fulfilled",S.value=d;for(var D=0;D<y.length;D++)(0,y[D])(d)},function(D){for(S.status="rejected",S.reason=D,D=0;D<y.length;D++)(0,y[D])(void 0)}),S}var um=gt.S;gt.S=function(s,d){typeof d=="object"&&d!==null&&typeof d.then=="function"&&gh(s,d),um!==null&&um(s,d)};var Ll=lt(null);function Wf(){var s=Ll.current;return s!==null?s:jr.pooledCache}function Kd(s,d){d===null?zt(Ll,Ll.current):zt(Ll,d.pool)}function yh(){var s=Wf();return s===null?null:{parent:ya._currentValue,pool:s}}var yu=Error(a(460)),sl=Error(a(474)),Kt=Error(a(542)),sd={then:function(){}};function od(s){return s=s.status,s==="fulfilled"||s==="rejected"}function vh(){}function Oc(s,d,y){switch(y=s[y],y===void 0?s.push(d):y!==d&&(d.then(vh,vh),d=y),d.status){case"fulfilled":return d.value;case"rejected":throw s=d.reason,ai(s),s;default:if(typeof d.status=="string")d.then(vh,vh);else{if(s=jr,s!==null&&100<s.shellSuspendCounter)throw Error(a(482));s=d,s.status="pending",s.then(function(S){if(d.status==="pending"){var D=d;D.status="fulfilled",D.value=S}},function(S){if(d.status==="pending"){var D=d;D.status="rejected",D.reason=S}})}switch(d.status){case"fulfilled":return d.value;case"rejected":throw s=d.reason,ai(s),s}throw Dl=d,yu}}var Dl=null;function ld(){if(Dl===null)throw Error(a(459));var s=Dl;return Dl=null,s}function ai(s){if(s===yu||s===Kt)throw Error(a(483))}var zl=!1;function Xf(s){s.updateQueue={baseState:s.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function bh(s,d){s=s.updateQueue,d.updateQueue===s&&(d.updateQueue={baseState:s.baseState,firstBaseUpdate:s.firstBaseUpdate,lastBaseUpdate:s.lastBaseUpdate,shared:s.shared,callbacks:null})}function Ju(s){return{lane:s,tag:0,payload:null,callback:null,next:null}}function vu(s,d,y){var S=s.updateQueue;if(S===null)return null;if(S=S.shared,(ar&2)!==0){var D=S.pending;return D===null?d.next=d:(d.next=D.next,D.next=d),S.pending=d,d=tl(s),Zu(s,null,y),d}return Gu(s,S,d,y),tl(s)}function Nc(s,d,y){if(d=d.updateQueue,d!==null&&(d=d.shared,(y&4194048)!==0)){var S=d.lanes;S&=s.pendingLanes,y|=S,d.lanes=y,rn(s,y)}}function ud(s,d){var y=s.updateQueue,S=s.alternate;if(S!==null&&(S=S.updateQueue,y===S)){var D=null,B=null;if(y=y.firstBaseUpdate,y!==null){do{var ne={lane:y.lane,tag:y.tag,payload:y.payload,callback:null,next:null};B===null?D=B=ne:B=B.next=ne,y=y.next}while(y!==null);B===null?D=B=d:B=B.next=d}else D=B=d;y={baseState:S.baseState,firstBaseUpdate:D,lastBaseUpdate:B,shared:S.shared,callbacks:S.callbacks},s.updateQueue=y;return}s=y.lastBaseUpdate,s===null?y.firstBaseUpdate=d:s.next=d,y.lastBaseUpdate=d}var Yd=!1;function xh(){if(Yd){var s=Ms;if(s!==null)throw s}}function Bc(s,d,y,S){Yd=!1;var D=s.updateQueue;zl=!1;var B=D.firstBaseUpdate,ne=D.lastBaseUpdate,he=D.shared.pending;if(he!==null){D.shared.pending=null;var Be=he,ht=Be.next;Be.next=null,ne===null?B=ht:ne.next=ht,ne=Be;var St=s.alternate;St!==null&&(St=St.updateQueue,he=St.lastBaseUpdate,he!==ne&&(he===null?St.firstBaseUpdate=ht:he.next=ht,St.lastBaseUpdate=Be))}if(B!==null){var Mt=D.baseState;ne=0,St=ht=Be=null,he=B;do{var ft=he.lane&-536870913,vt=ft!==he.lane;if(vt?(mi&ft)===ft:(S&ft)===ft){ft!==0&&ft===Ra&&(Yd=!0),St!==null&&(St=St.next={lane:0,tag:he.tag,payload:he.payload,callback:null,next:null});e:{var Wn=s,jn=he;ft=d;var xr=y;switch(jn.tag){case 1:if(Wn=jn.payload,typeof Wn=="function"){Mt=Wn.call(xr,Mt,ft);break e}Mt=Wn;break e;case 3:Wn.flags=Wn.flags&-65537|128;case 0:if(Wn=jn.payload,ft=typeof Wn=="function"?Wn.call(xr,Mt,ft):Wn,ft==null)break e;Mt=V({},Mt,ft);break e;case 2:zl=!0}}ft=he.callback,ft!==null&&(s.flags|=64,vt&&(s.flags|=8192),vt=D.callbacks,vt===null?D.callbacks=[ft]:vt.push(ft))}else vt={lane:ft,tag:he.tag,payload:he.payload,callback:he.callback,next:null},St===null?(ht=St=vt,Be=Mt):St=St.next=vt,ne|=ft;if(he=he.next,he===null){if(he=D.shared.pending,he===null)break;vt=he,he=vt.next,vt.next=null,D.lastBaseUpdate=vt,D.shared.pending=null}}while(!0);St===null&&(Be=Mt),D.baseState=Be,D.firstBaseUpdate=ht,D.lastBaseUpdate=St,B===null&&(D.shared.lanes=0),cc|=ne,s.lanes=ne,s.memoizedState=Mt}}function Kf(s,d){if(typeof s!="function")throw Error(a(191,s));s.call(d)}function Yf(s,d){var y=s.callbacks;if(y!==null)for(s.callbacks=null,s=0;s<y.length;s++)Kf(y[s],d)}var Rs=lt(null),rr=lt(0);function Fc(s,d){s=Hc,zt(rr,s),zt(Rs,d),Hc=s|d.baseLanes}function cd(){zt(rr,Hc),zt(Rs,Rs.current)}function Qd(){Hc=rr.current,Dt(Rs),Dt(rr)}var iu=0,ii=null,Yi=null,Qi=null,Vc=!1,tn=!1,yn=!1,Uc=0,ol=0,bu=null,no=0;function Yr(){throw Error(a(321))}function So(s,d){if(d===null)return!1;for(var y=0;y<d.length&&y<s.length;y++)if(!ns(s[y],d[y]))return!1;return!0}function Qf(s,d,y,S,D,B){return iu=B,ii=d,d.memoizedState=null,d.updateQueue=null,d.lanes=0,gt.H=s===null||s.memoizedState===null?ul:Ls,yn=!1,B=y(S,D),yn=!1,tn&&(B=ji(d,y,S,D)),wh(s),B}function wh(s){gt.H=rs;var d=Yi!==null&&Yi.next!==null;if(iu=0,Qi=Yi=ii=null,Vc=!1,ol=0,bu=null,d)throw Error(a(300));s===null||La||(s=s.dependencies,s!==null&&ad(s)&&(La=!0))}function ji(s,d,y,S){ii=s;var D=0;do{if(tn&&(bu=null),ol=0,tn=!1,25<=D)throw Error(a(301));if(D+=1,Qi=Yi=null,s.updateQueue!=null){var B=s.updateQueue;B.lastEffect=null,B.events=null,B.stores=null,B.memoCache!=null&&(B.memoCache.index=0)}gt.H=ac,B=d(y,S)}while(tn);return B}function Qr(){var s=gt.H,d=s.useState()[0];return d=typeof d.then=="function"?wu(d):d,s=s.useState()[0],(Yi!==null?Yi.memoizedState:null)!==s&&(ii.flags|=1024),d}function Th(){var s=Uc!==0;return Uc=0,s}function ec(s,d,y){d.updateQueue=s.updateQueue,d.flags&=-2053,s.lanes&=~y}function tc(s){if(Vc){for(s=s.memoizedState;s!==null;){var d=s.queue;d!==null&&(d.pending=null),s=s.next}Vc=!1}iu=0,Qi=Yi=ii=null,tn=!1,ol=Uc=0,bu=null}function ks(){var s={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Qi===null?ii.memoizedState=Qi=s:Qi=Qi.next=s,Qi}function Mr(){if(Yi===null){var s=ii.alternate;s=s!==null?s.memoizedState:null}else s=Yi.next;var d=Qi===null?ii.memoizedState:Qi.next;if(d!==null)Qi=d,Yi=s;else{if(s===null)throw ii.alternate===null?Error(a(467)):Error(a(310));Yi=s,s={memoizedState:Yi.memoizedState,baseState:Yi.baseState,baseQueue:Yi.baseQueue,queue:Yi.queue,next:null},Qi===null?ii.memoizedState=Qi=s:Qi=Qi.next=s}return Qi}function xu(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function wu(s){var d=ol;return ol+=1,bu===null&&(bu=[]),s=Oc(bu,s,d),d=ii,(Qi===null?d.memoizedState:Qi.next)===null&&(d=d.alternate,gt.H=d===null||d.memoizedState===null?ul:Ls),s}function jc(s){if(s!==null&&typeof s=="object"){if(typeof s.then=="function")return wu(s);if(s.$$typeof===Xe)return _r(s)}throw Error(a(438,String(s)))}function Tu(s){var d=null,y=ii.updateQueue;if(y!==null&&(d=y.memoCache),d==null){var S=ii.alternate;S!==null&&(S=S.updateQueue,S!==null&&(S=S.memoCache,S!=null&&(d={data:S.data.map(function(D){return D.slice()}),index:0})))}if(d==null&&(d={data:[],index:0}),y===null&&(y=xu(),ii.updateQueue=y),y.memoCache=d,y=d.data[d.index],y===void 0)for(y=d.data[d.index]=Array(s),S=0;S<s;S++)y[S]=Ee;return d.index++,y}function Ol(s,d){return typeof d=="function"?d(s):d}function Sh(s){var d=Mr();return Eh(d,Yi,s)}function Eh(s,d,y){var S=s.queue;if(S===null)throw Error(a(311));S.lastRenderedReducer=y;var D=s.baseQueue,B=S.pending;if(B!==null){if(D!==null){var ne=D.next;D.next=B.next,B.next=ne}d.baseQueue=D=B,S.pending=null}if(B=s.baseState,D===null)s.memoizedState=B;else{d=D.next;var he=ne=null,Be=null,ht=d,St=!1;do{var Mt=ht.lane&-536870913;if(Mt!==ht.lane?(mi&Mt)===Mt:(iu&Mt)===Mt){var ft=ht.revertLane;if(ft===0)Be!==null&&(Be=Be.next={lane:0,revertLane:0,action:ht.action,hasEagerState:ht.hasEagerState,eagerState:ht.eagerState,next:null}),Mt===Ra&&(St=!0);else if((iu&ft)===ft){ht=ht.next,ft===Ra&&(St=!0);continue}else Mt={lane:0,revertLane:ht.revertLane,action:ht.action,hasEagerState:ht.hasEagerState,eagerState:ht.eagerState,next:null},Be===null?(he=Be=Mt,ne=B):Be=Be.next=Mt,ii.lanes|=ft,cc|=ft;Mt=ht.action,yn&&y(B,Mt),B=ht.hasEagerState?ht.eagerState:y(B,Mt)}else ft={lane:Mt,revertLane:ht.revertLane,action:ht.action,hasEagerState:ht.hasEagerState,eagerState:ht.eagerState,next:null},Be===null?(he=Be=ft,ne=B):Be=Be.next=ft,ii.lanes|=Mt,cc|=Mt;ht=ht.next}while(ht!==null&&ht!==d);if(Be===null?ne=B:Be.next=he,!ns(B,s.memoizedState)&&(La=!0,St&&(y=Ms,y!==null)))throw y;s.memoizedState=B,s.baseState=ne,s.baseQueue=Be,S.lastRenderedState=B}return D===null&&(S.lanes=0),[s.memoizedState,S.dispatch]}function hd(s){var d=Mr(),y=d.queue;if(y===null)throw Error(a(311));y.lastRenderedReducer=s;var S=y.dispatch,D=y.pending,B=d.memoizedState;if(D!==null){y.pending=null;var ne=D=D.next;do B=s(B,ne.action),ne=ne.next;while(ne!==D);ns(B,d.memoizedState)||(La=!0),d.memoizedState=B,d.baseQueue===null&&(d.baseState=B),y.lastRenderedState=B}return[B,S]}function w(s,d,y){var S=ii,D=Mr(),B=Zn;if(B){if(y===void 0)throw Error(a(407));y=y()}else y=d();var ne=!ns((Yi||D).memoizedState,y);ne&&(D.memoizedState=y,La=!0),D=D.queue;var he=_.bind(null,S,D,s);if(We(2048,8,he,[s]),D.getSnapshot!==d||ne||Qi!==null&&Qi.memoizedState.tag&1){if(S.flags|=2048,Ae(9,Le(),u.bind(null,S,D,y,d),null),jr===null)throw Error(a(349));B||(iu&124)!==0||n(S,d,y)}return y}function n(s,d,y){s.flags|=16384,s={getSnapshot:d,value:y},d=ii.updateQueue,d===null?(d=xu(),ii.updateQueue=d,d.stores=[s]):(y=d.stores,y===null?d.stores=[s]:y.push(s))}function u(s,d,y,S){d.value=y,d.getSnapshot=S,b(d)&&T(s)}function _(s,d,y){return y(function(){b(d)&&T(s)})}function b(s){var d=s.getSnapshot;s=s.value;try{var y=d();return!ns(s,y)}catch{return!0}}function T(s){var d=Js(s,2);d!==null&&jl(d,s,2)}function I(s){var d=ks();if(typeof s=="function"){var y=s;if(s=y(),yn){pa(!0);try{y()}finally{pa(!1)}}}return d.memoizedState=d.baseState=s,d.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ol,lastRenderedState:s},d}function O(s,d,y,S){return s.baseState=y,Eh(s,Yi,typeof S=="function"?S:Ol)}function N(s,d,y,S,D){if(Eu(s))throw Error(a(485));if(s=d.action,s!==null){var B={payload:D,action:s,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(ne){B.listeners.push(ne)}};gt.T!==null?y(!0):B.isTransition=!1,S(B),y=d.pending,y===null?(B.next=d.pending=B,j(d,B)):(B.next=y.next,d.pending=y.next=B)}}function j(s,d){var y=d.action,S=d.payload,D=s.state;if(d.isTransition){var B=gt.T,ne={};gt.T=ne;try{var he=y(D,S),Be=gt.S;Be!==null&&Be(ne,he),$(s,d,he)}catch(ht){W(s,d,ht)}finally{gt.T=B}}else try{B=y(D,S),$(s,d,B)}catch(ht){W(s,d,ht)}}function $(s,d,y){y!==null&&typeof y=="object"&&typeof y.then=="function"?y.then(function(S){X(s,d,S)},function(S){return W(s,d,S)}):X(s,d,y)}function X(s,d,y){d.status="fulfilled",d.value=y,ee(d),s.state=y,d=s.pending,d!==null&&(y=d.next,y===d?s.pending=null:(y=y.next,d.next=y,j(s,y)))}function W(s,d,y){var S=s.pending;if(s.pending=null,S!==null){S=S.next;do d.status="rejected",d.reason=y,ee(d),d=d.next;while(d!==S)}s.action=null}function ee(s){s=s.listeners;for(var d=0;d<s.length;d++)(0,s[d])()}function ae(s,d){return d}function _e(s,d){if(Zn){var y=jr.formState;if(y!==null){e:{var S=ii;if(Zn){if(_n){t:{for(var D=_n,B=mr;D.nodeType!==8;){if(!B){D=null;break t}if(D=Mu(D.nextSibling),D===null){D=null;break t}}B=D.data,D=B==="F!"||B==="F"?D:null}if(D){_n=Mu(D.nextSibling),S=D.data==="F!";break e}}wo(S)}S=!1}S&&(d=y[0])}}return y=ks(),y.memoizedState=y.baseState=d,S={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ae,lastRenderedState:d},y.queue=S,y=Su.bind(null,ii,S),S.dispatch=y,S=I(!1),B=nc.bind(null,ii,!1,S.queue),S=ks(),D={state:d,dispatch:null,action:s,pending:null},S.queue=D,y=N.bind(null,ii,D,B,y),D.dispatch=y,S.memoizedState=s,[d,y,!1]}function ge(s){var d=Mr();return ve(d,Yi,s)}function ve(s,d,y){if(d=Eh(s,d,ae)[0],s=Sh(Ol)[0],typeof d=="object"&&d!==null&&typeof d.then=="function")try{var S=wu(d)}catch(ne){throw ne===yu?Kt:ne}else S=d;d=Mr();var D=d.queue,B=D.dispatch;return y!==d.memoizedState&&(ii.flags|=2048,Ae(9,Le(),Te.bind(null,D,y),null)),[S,B,s]}function Te(s,d){s.action=d}function Me(s){var d=Mr(),y=Yi;if(y!==null)return ve(d,y,s);Mr(),d=d.memoizedState,y=Mr();var S=y.queue.dispatch;return y.memoizedState=s,[d,S,!1]}function Ae(s,d,y,S){return s={tag:s,create:y,deps:S,inst:d,next:null},d=ii.updateQueue,d===null&&(d=xu(),ii.updateQueue=d),y=d.lastEffect,y===null?d.lastEffect=s.next=s:(S=y.next,y.next=s,s.next=S,d.lastEffect=s),s}function Le(){return{destroy:void 0,resource:void 0}}function Ue(){return Mr().memoizedState}function Ce(s,d,y,S){var D=ks();S=S===void 0?null:S,ii.flags|=s,D.memoizedState=Ae(1|d,Le(),y,S)}function We(s,d,y,S){var D=Mr();S=S===void 0?null:S;var B=D.memoizedState.inst;Yi!==null&&S!==null&&So(S,Yi.memoizedState.deps)?D.memoizedState=Ae(d,B,y,S):(ii.flags|=s,D.memoizedState=Ae(1|d,B,y,S))}function dt(s,d){Ce(8390656,8,s,d)}function rt(s,d){We(2048,8,s,d)}function st(s,d){return We(4,2,s,d)}function ct(s,d){return We(4,4,s,d)}function Ot(s,d){if(typeof d=="function"){s=s();var y=d(s);return function(){typeof y=="function"?y():d(null)}}if(d!=null)return s=s(),d.current=s,function(){d.current=null}}function Bt(s,d,y){y=y!=null?y.concat([s]):null,We(4,4,Ot.bind(null,d,s),y)}function Et(){}function un(s,d){var y=Mr();d=d===void 0?null:d;var S=y.memoizedState;return d!==null&&So(d,S[1])?S[0]:(y.memoizedState=[s,d],s)}function Kn(s,d){var y=Mr();d=d===void 0?null:d;var S=y.memoizedState;if(d!==null&&So(d,S[1]))return S[0];if(S=s(),yn){pa(!0);try{s()}finally{pa(!1)}}return y.memoizedState=[S,d],S}function yi(s,d,y){return y===void 0||(iu&1073741824)!==0?s.memoizedState=d:(s.memoizedState=y,s=Wy(),ii.lanes|=s,cc|=s,y)}function qi(s,d,y,S){return ns(y,d)?y:Rs.current!==null?(s=yi(s,y,S),ns(s,d)||(La=!0),s):(iu&42)===0?(La=!0,s.memoizedState=y):(s=Wy(),ii.lanes|=s,cc|=s,d)}function Ni(s,d,y,S,D){var B=Zt.p;Zt.p=B!==0&&8>B?B:8;var ne=gt.T,he={};gt.T=he,nc(s,!1,d,y);try{var Be=D(),ht=gt.S;if(ht!==null&&ht(he,Be),Be!==null&&typeof Be=="object"&&typeof Be.then=="function"){var St=_h(Be,S);ll(s,d,St,pl(s))}else ll(s,d,S,pl(s))}catch(Mt){ll(s,d,{then:function(){},status:"rejected",reason:Mt},pl())}finally{Zt.p=B,gt.T=ne}}function Fr(){}function Rr(s,d,y,S){if(s.tag!==5)throw Error(a(476));var D=Hn(s).queue;Ni(s,D,d,xt,y===null?Fr:function(){return $i(s),y(S)})}function Hn(s){var d=s.memoizedState;if(d!==null)return d;d={memoizedState:xt,baseState:xt,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ol,lastRenderedState:xt},next:null};var y={};return d.next={memoizedState:y,baseState:y,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ol,lastRenderedState:y},next:null},s.memoizedState=d,s=s.alternate,s!==null&&(s.memoizedState=d),d}function $i(s){var d=Hn(s).next.queue;ll(s,d,{},pl())}function Jr(){return _r(He)}function va(){return Mr().memoizedState}function ka(){return Mr().memoizedState}function io(s){for(var d=s.return;d!==null;){switch(d.tag){case 24:case 3:var y=pl();s=Ju(y);var S=vu(d,s,y);S!==null&&(jl(S,d,y),Nc(S,d,y)),d={cache:Qu()},s.payload=d;return}d=d.return}}function Nl(s,d,y){var S=pl();y={lane:S,revertLane:0,action:y,hasEagerState:!1,eagerState:null,next:null},Eu(s)?ic(d,y):(y=xo(s,d,y,S),y!==null&&(jl(y,s,S),rc(y,d,S)))}function Su(s,d,y){var S=pl();ll(s,d,y,S)}function ll(s,d,y,S){var D={lane:S,revertLane:0,action:y,hasEagerState:!1,eagerState:null,next:null};if(Eu(s))ic(d,D);else{var B=s.alternate;if(s.lanes===0&&(B===null||B.lanes===0)&&(B=d.lastRenderedReducer,B!==null))try{var ne=d.lastRenderedState,he=B(ne,y);if(D.hasEagerState=!0,D.eagerState=he,ns(he,ne))return Gu(s,d,D,0),jr===null&&tu(),!1}catch{}finally{}if(y=xo(s,d,D,S),y!==null)return jl(y,s,S),rc(y,d,S),!0}return!1}function nc(s,d,y,S){if(S={lane:2,revertLane:mp(),action:S,hasEagerState:!1,eagerState:null,next:null},Eu(s)){if(d)throw Error(a(479))}else d=xo(s,y,S,2),d!==null&&jl(d,s,2)}function Eu(s){var d=s.alternate;return s===ii||d!==null&&d===ii}function ic(s,d){tn=Vc=!0;var y=s.pending;y===null?d.next=d:(d.next=y.next,y.next=d),s.pending=d}function rc(s,d,y){if((y&4194048)!==0){var S=d.lanes;S&=s.pendingLanes,y|=S,d.lanes=y,rn(s,y)}}var rs={readContext:_r,use:jc,useCallback:Yr,useContext:Yr,useEffect:Yr,useImperativeHandle:Yr,useLayoutEffect:Yr,useInsertionEffect:Yr,useMemo:Yr,useReducer:Yr,useRef:Yr,useState:Yr,useDebugValue:Yr,useDeferredValue:Yr,useTransition:Yr,useSyncExternalStore:Yr,useId:Yr,useHostTransitionStatus:Yr,useFormState:Yr,useActionState:Yr,useOptimistic:Yr,useMemoCache:Yr,useCacheRefresh:Yr},ul={readContext:_r,use:jc,useCallback:function(s,d){return ks().memoizedState=[s,d===void 0?null:d],s},useContext:_r,useEffect:dt,useImperativeHandle:function(s,d,y){y=y!=null?y.concat([s]):null,Ce(4194308,4,Ot.bind(null,d,s),y)},useLayoutEffect:function(s,d){return Ce(4194308,4,s,d)},useInsertionEffect:function(s,d){Ce(4,2,s,d)},useMemo:function(s,d){var y=ks();d=d===void 0?null:d;var S=s();if(yn){pa(!0);try{s()}finally{pa(!1)}}return y.memoizedState=[S,d],S},useReducer:function(s,d,y){var S=ks();if(y!==void 0){var D=y(d);if(yn){pa(!0);try{y(d)}finally{pa(!1)}}}else D=d;return S.memoizedState=S.baseState=D,s={pending:null,lanes:0,dispatch:null,lastRenderedReducer:s,lastRenderedState:D},S.queue=s,s=s.dispatch=Nl.bind(null,ii,s),[S.memoizedState,s]},useRef:function(s){var d=ks();return s={current:s},d.memoizedState=s},useState:function(s){s=I(s);var d=s.queue,y=Su.bind(null,ii,d);return d.dispatch=y,[s.memoizedState,y]},useDebugValue:Et,useDeferredValue:function(s,d){var y=ks();return yi(y,s,d)},useTransition:function(){var s=I(!1);return s=Ni.bind(null,ii,s.queue,!0,!1),ks().memoizedState=s,[!1,s]},useSyncExternalStore:function(s,d,y){var S=ii,D=ks();if(Zn){if(y===void 0)throw Error(a(407));y=y()}else{if(y=d(),jr===null)throw Error(a(349));(mi&124)!==0||n(S,d,y)}D.memoizedState=y;var B={value:y,getSnapshot:d};return D.queue=B,dt(_.bind(null,S,B,s),[s]),S.flags|=2048,Ae(9,Le(),u.bind(null,S,B,y,d),null),y},useId:function(){var s=ks(),d=jr.identifierPrefix;if(Zn){var y=Oe,S=ue;y=(S&~(1<<32-je(S)-1)).toString(32)+y,d=""+d+"R"+y,y=Uc++,0<y&&(d+="H"+y.toString(32)),d+=""}else y=no++,d=""+d+"r"+y.toString(32)+"";return s.memoizedState=d},useHostTransitionStatus:Jr,useFormState:_e,useActionState:_e,useOptimistic:function(s){var d=ks();d.memoizedState=d.baseState=s;var y={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return d.queue=y,d=nc.bind(null,ii,!0,y),y.dispatch=d,[s,d]},useMemoCache:Tu,useCacheRefresh:function(){return ks().memoizedState=io.bind(null,ii)}},Ls={readContext:_r,use:jc,useCallback:un,useContext:_r,useEffect:rt,useImperativeHandle:Bt,useInsertionEffect:st,useLayoutEffect:ct,useMemo:Kn,useReducer:Sh,useRef:Ue,useState:function(){return Sh(Ol)},useDebugValue:Et,useDeferredValue:function(s,d){var y=Mr();return qi(y,Yi.memoizedState,s,d)},useTransition:function(){var s=Sh(Ol)[0],d=Mr().memoizedState;return[typeof s=="boolean"?s:wu(s),d]},useSyncExternalStore:w,useId:va,useHostTransitionStatus:Jr,useFormState:ge,useActionState:ge,useOptimistic:function(s,d){var y=Mr();return O(y,Yi,s,d)},useMemoCache:Tu,useCacheRefresh:ka},ac={readContext:_r,use:jc,useCallback:un,useContext:_r,useEffect:rt,useImperativeHandle:Bt,useInsertionEffect:st,useLayoutEffect:ct,useMemo:Kn,useReducer:hd,useRef:Ue,useState:function(){return hd(Ol)},useDebugValue:Et,useDeferredValue:function(s,d){var y=Mr();return Yi===null?yi(y,s,d):qi(y,Yi.memoizedState,s,d)},useTransition:function(){var s=hd(Ol)[0],d=Mr().memoizedState;return[typeof s=="boolean"?s:wu(s),d]},useSyncExternalStore:w,useId:va,useHostTransitionStatus:Jr,useFormState:Me,useActionState:Me,useOptimistic:function(s,d){var y=Mr();return Yi!==null?O(y,Yi,s,d):(y.baseState=s,[s,y.queue.dispatch])},useMemoCache:Tu,useCacheRefresh:ka},kr=null,Zr=0;function ro(s){var d=Zr;return Zr+=1,kr===null&&(kr=[]),Oc(kr,s,d)}function Vr(s,d){d=d.props.ref,s.ref=d!==void 0?d:null}function sc(s,d){throw d.$$typeof===Z?Error(a(525)):(s=Object.prototype.toString.call(d),Error(a(31,s==="[object Object]"?"object with keys {"+Object.keys(d).join(", ")+"}":s)))}function qc(s){var d=s._init;return d(s._payload)}function ru(s){function d(tt,Ye){if(s){var ut=tt.deletions;ut===null?(tt.deletions=[Ye],tt.flags|=16):ut.push(Ye)}}function y(tt,Ye){if(!s)return null;for(;Ye!==null;)d(tt,Ye),Ye=Ye.sibling;return null}function S(tt){for(var Ye=new Map;tt!==null;)tt.key!==null?Ye.set(tt.key,tt):Ye.set(tt.index,tt),tt=tt.sibling;return Ye}function D(tt,Ye){return tt=Pa(tt,Ye),tt.index=0,tt.sibling=null,tt}function B(tt,Ye,ut){return tt.index=ut,s?(ut=tt.alternate,ut!==null?(ut=ut.index,ut<Ye?(tt.flags|=67108866,Ye):ut):(tt.flags|=67108866,Ye)):(tt.flags|=1048576,Ye)}function ne(tt){return s&&tt.alternate===null&&(tt.flags|=67108866),tt}function he(tt,Ye,ut,Pt){return Ye===null||Ye.tag!==6?(Ye=rd(ut,tt.mode,Pt),Ye.return=tt,Ye):(Ye=D(Ye,ut),Ye.return=tt,Ye)}function Be(tt,Ye,ut,Pt){var wn=ut.type;return wn===be?St(tt,Ye,ut.props.children,Pt,ut.key):Ye!==null&&(Ye.elementType===wn||typeof wn=="object"&&wn!==null&&wn.$$typeof===ce&&qc(wn)===Ye.type)?(Ye=D(Ye,ut.props),Vr(Ye,ut),Ye.return=tt,Ye):(Ye=kc(ut.type,ut.key,ut.props,null,tt.mode,Pt),Vr(Ye,ut),Ye.return=tt,Ye)}function ht(tt,Ye,ut,Pt){return Ye===null||Ye.tag!==4||Ye.stateNode.containerInfo!==ut.containerInfo||Ye.stateNode.implementation!==ut.implementation?(Ye=Wu(ut,tt.mode,Pt),Ye.return=tt,Ye):(Ye=D(Ye,ut.children||[]),Ye.return=tt,Ye)}function St(tt,Ye,ut,Pt,wn){return Ye===null||Ye.tag!==7?(Ye=kl(ut,tt.mode,Pt,wn),Ye.return=tt,Ye):(Ye=D(Ye,ut),Ye.return=tt,Ye)}function Mt(tt,Ye,ut){if(typeof Ye=="string"&&Ye!==""||typeof Ye=="number"||typeof Ye=="bigint")return Ye=rd(""+Ye,tt.mode,ut),Ye.return=tt,Ye;if(typeof Ye=="object"&&Ye!==null){switch(Ye.$$typeof){case Y:return ut=kc(Ye.type,Ye.key,Ye.props,null,tt.mode,ut),Vr(ut,Ye),ut.return=tt,ut;case Q:return Ye=Wu(Ye,tt.mode,ut),Ye.return=tt,Ye;case ce:var Pt=Ye._init;return Ye=Pt(Ye._payload),Mt(tt,Ye,ut)}if(ti(Ye)||$e(Ye))return Ye=kl(Ye,tt.mode,ut,null),Ye.return=tt,Ye;if(typeof Ye.then=="function")return Mt(tt,ro(Ye),ut);if(Ye.$$typeof===Xe)return Mt(tt,_u(tt,Ye),ut);sc(tt,Ye)}return null}function ft(tt,Ye,ut,Pt){var wn=Ye!==null?Ye.key:null;if(typeof ut=="string"&&ut!==""||typeof ut=="number"||typeof ut=="bigint")return wn!==null?null:he(tt,Ye,""+ut,Pt);if(typeof ut=="object"&&ut!==null){switch(ut.$$typeof){case Y:return ut.key===wn?Be(tt,Ye,ut,Pt):null;case Q:return ut.key===wn?ht(tt,Ye,ut,Pt):null;case ce:return wn=ut._init,ut=wn(ut._payload),ft(tt,Ye,ut,Pt)}if(ti(ut)||$e(ut))return wn!==null?null:St(tt,Ye,ut,Pt,null);if(typeof ut.then=="function")return ft(tt,Ye,ro(ut),Pt);if(ut.$$typeof===Xe)return ft(tt,Ye,_u(tt,ut),Pt);sc(tt,ut)}return null}function vt(tt,Ye,ut,Pt,wn){if(typeof Pt=="string"&&Pt!==""||typeof Pt=="number"||typeof Pt=="bigint")return tt=tt.get(ut)||null,he(Ye,tt,""+Pt,wn);if(typeof Pt=="object"&&Pt!==null){switch(Pt.$$typeof){case Y:return tt=tt.get(Pt.key===null?ut:Pt.key)||null,Be(Ye,tt,Pt,wn);case Q:return tt=tt.get(Pt.key===null?ut:Pt.key)||null,ht(Ye,tt,Pt,wn);case ce:var gi=Pt._init;return Pt=gi(Pt._payload),vt(tt,Ye,ut,Pt,wn)}if(ti(Pt)||$e(Pt))return tt=tt.get(ut)||null,St(Ye,tt,Pt,wn,null);if(typeof Pt.then=="function")return vt(tt,Ye,ut,ro(Pt),wn);if(Pt.$$typeof===Xe)return vt(tt,Ye,ut,_u(Ye,Pt),wn);sc(Ye,Pt)}return null}function Wn(tt,Ye,ut,Pt){for(var wn=null,gi=null,dn=Ye,zn=Ye=0,cs=null;dn!==null&&zn<ut.length;zn++){dn.index>zn?(cs=dn,dn=null):cs=dn.sibling;var Zi=ft(tt,dn,ut[zn],Pt);if(Zi===null){dn===null&&(dn=cs);break}s&&dn&&Zi.alternate===null&&d(tt,dn),Ye=B(Zi,Ye,zn),gi===null?wn=Zi:gi.sibling=Zi,gi=Zi,dn=cs}if(zn===ut.length)return y(tt,dn),Zn&&nt(tt,zn),wn;if(dn===null){for(;zn<ut.length;zn++)dn=Mt(tt,ut[zn],Pt),dn!==null&&(Ye=B(dn,Ye,zn),gi===null?wn=dn:gi.sibling=dn,gi=dn);return Zn&&nt(tt,zn),wn}for(dn=S(dn);zn<ut.length;zn++)cs=vt(dn,tt,zn,ut[zn],Pt),cs!==null&&(s&&cs.alternate!==null&&dn.delete(cs.key===null?zn:cs.key),Ye=B(cs,Ye,zn),gi===null?wn=cs:gi.sibling=cs,gi=cs);return s&&dn.forEach(function(Oh){return d(tt,Oh)}),Zn&&nt(tt,zn),wn}function jn(tt,Ye,ut,Pt){if(ut==null)throw Error(a(151));for(var wn=null,gi=null,dn=Ye,zn=Ye=0,cs=null,Zi=ut.next();dn!==null&&!Zi.done;zn++,Zi=ut.next()){dn.index>zn?(cs=dn,dn=null):cs=dn.sibling;var Oh=ft(tt,dn,Zi.value,Pt);if(Oh===null){dn===null&&(dn=cs);break}s&&dn&&Oh.alternate===null&&d(tt,dn),Ye=B(Oh,Ye,zn),gi===null?wn=Oh:gi.sibling=Oh,gi=Oh,dn=cs}if(Zi.done)return y(tt,dn),Zn&&nt(tt,zn),wn;if(dn===null){for(;!Zi.done;zn++,Zi=ut.next())Zi=Mt(tt,Zi.value,Pt),Zi!==null&&(Ye=B(Zi,Ye,zn),gi===null?wn=Zi:gi.sibling=Zi,gi=Zi);return Zn&&nt(tt,zn),wn}for(dn=S(dn);!Zi.done;zn++,Zi=ut.next())Zi=vt(dn,tt,zn,Zi.value,Pt),Zi!==null&&(s&&Zi.alternate!==null&&dn.delete(Zi.key===null?zn:Zi.key),Ye=B(Zi,Ye,zn),gi===null?wn=Zi:gi.sibling=Zi,gi=Zi);return s&&dn.forEach(function(Mb){return d(tt,Mb)}),Zn&&nt(tt,zn),wn}function xr(tt,Ye,ut,Pt){if(typeof ut=="object"&&ut!==null&&ut.type===be&&ut.key===null&&(ut=ut.props.children),typeof ut=="object"&&ut!==null){switch(ut.$$typeof){case Y:e:{for(var wn=ut.key;Ye!==null;){if(Ye.key===wn){if(wn=ut.type,wn===be){if(Ye.tag===7){y(tt,Ye.sibling),Pt=D(Ye,ut.props.children),Pt.return=tt,tt=Pt;break e}}else if(Ye.elementType===wn||typeof wn=="object"&&wn!==null&&wn.$$typeof===ce&&qc(wn)===Ye.type){y(tt,Ye.sibling),Pt=D(Ye,ut.props),Vr(Pt,ut),Pt.return=tt,tt=Pt;break e}y(tt,Ye);break}else d(tt,Ye);Ye=Ye.sibling}ut.type===be?(Pt=kl(ut.props.children,tt.mode,Pt,ut.key),Pt.return=tt,tt=Pt):(Pt=kc(ut.type,ut.key,ut.props,null,tt.mode,Pt),Vr(Pt,ut),Pt.return=tt,tt=Pt)}return ne(tt);case Q:e:{for(wn=ut.key;Ye!==null;){if(Ye.key===wn)if(Ye.tag===4&&Ye.stateNode.containerInfo===ut.containerInfo&&Ye.stateNode.implementation===ut.implementation){y(tt,Ye.sibling),Pt=D(Ye,ut.children||[]),Pt.return=tt,tt=Pt;break e}else{y(tt,Ye);break}else d(tt,Ye);Ye=Ye.sibling}Pt=Wu(ut,tt.mode,Pt),Pt.return=tt,tt=Pt}return ne(tt);case ce:return wn=ut._init,ut=wn(ut._payload),xr(tt,Ye,ut,Pt)}if(ti(ut))return Wn(tt,Ye,ut,Pt);if($e(ut)){if(wn=$e(ut),typeof wn!="function")throw Error(a(150));return ut=wn.call(ut),jn(tt,Ye,ut,Pt)}if(typeof ut.then=="function")return xr(tt,Ye,ro(ut),Pt);if(ut.$$typeof===Xe)return xr(tt,Ye,_u(tt,ut),Pt);sc(tt,ut)}return typeof ut=="string"&&ut!==""||typeof ut=="number"||typeof ut=="bigint"?(ut=""+ut,Ye!==null&&Ye.tag===6?(y(tt,Ye.sibling),Pt=D(Ye,ut),Pt.return=tt,tt=Pt):(y(tt,Ye),Pt=rd(ut,tt.mode,Pt),Pt.return=tt,tt=Pt),ne(tt)):y(tt,Ye)}return function(tt,Ye,ut,Pt){try{Zr=0;var wn=xr(tt,Ye,ut,Pt);return kr=null,wn}catch(dn){if(dn===yu||dn===Kt)throw dn;var gi=eo(29,dn,null,tt.mode);return gi.lanes=Pt,gi.return=tt,gi}finally{}}}var Ds=ru(!0),Au=ru(!1),Oo=lt(null),ea=null;function Iu(s){var d=s.alternate;zt(yr,yr.current&1),zt(Oo,s),ea===null&&(d===null||Rs.current!==null||d.memoizedState!==null)&&(ea=s)}function Jd(s){if(s.tag===22){if(zt(yr,yr.current),zt(Oo,s),ea===null){var d=s.alternate;d!==null&&d.memoizedState!==null&&(ea=s)}}else Bl()}function Bl(){zt(yr,yr.current),zt(Oo,Oo.current)}function cl(s){Dt(Oo),ea===s&&(ea=null),Dt(yr)}var yr=lt(0);function hl(s){for(var d=s;d!==null;){if(d.tag===13){var y=d.memoizedState;if(y!==null&&(y=y.dehydrated,y===null||y.data==="$?"||yf(y)))return d}else if(d.tag===19&&d.memoizedProps.revealOrder!==void 0){if((d.flags&128)!==0)return d}else if(d.child!==null){d.child.return=d,d=d.child;continue}if(d===s)break;for(;d.sibling===null;){if(d.return===null||d.return===s)return null;d=d.return}d.sibling.return=d.return,d=d.sibling}return null}function cm(s,d,y,S){d=s.memoizedState,y=y(S,d),y=y==null?d:V({},d,y),s.memoizedState=y,s.lanes===0&&(s.updateQueue.baseState=y)}var Cg={enqueueSetState:function(s,d,y){s=s._reactInternals;var S=pl(),D=Ju(S);D.payload=d,y!=null&&(D.callback=y),d=vu(s,D,S),d!==null&&(jl(d,s,S),Nc(d,s,S))},enqueueReplaceState:function(s,d,y){s=s._reactInternals;var S=pl(),D=Ju(S);D.tag=1,D.payload=d,y!=null&&(D.callback=y),d=vu(s,D,S),d!==null&&(jl(d,s,S),Nc(d,s,S))},enqueueForceUpdate:function(s,d){s=s._reactInternals;var y=pl(),S=Ju(y);S.tag=2,d!=null&&(S.callback=d),d=vu(s,S,y),d!==null&&(jl(d,s,y),Nc(d,s,y))}};function hm(s,d,y,S,D,B,ne){return s=s.stateNode,typeof s.shouldComponentUpdate=="function"?s.shouldComponentUpdate(S,B,ne):d.prototype&&d.prototype.isPureReactComponent?!Is(y,S)||!Is(D,B):!0}function Pg(s,d,y,S){s=d.state,typeof d.componentWillReceiveProps=="function"&&d.componentWillReceiveProps(y,S),typeof d.UNSAFE_componentWillReceiveProps=="function"&&d.UNSAFE_componentWillReceiveProps(y,S),d.state!==s&&Cg.enqueueReplaceState(d,d.state,null)}function dd(s,d){var y=d;if("ref"in d){y={};for(var S in d)S!=="ref"&&(y[S]=d[S])}if(s=s.defaultProps){y===d&&(y=V({},y));for(var D in s)y[D]===void 0&&(y[D]=s[D])}return y}var Jf=typeof reportError=="function"?reportError:function(s){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var d=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof s=="object"&&s!==null&&typeof s.message=="string"?String(s.message):String(s),error:s});if(!window.dispatchEvent(d))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",s);return}console.error(s)};function Py(s){Jf(s)}function dm(s){console.error(s)}function My(s){Jf(s)}function ef(s,d){try{var y=s.onUncaughtError;y(d.value,{componentStack:d.stack})}catch(S){setTimeout(function(){throw S})}}function Mg(s,d,y){try{var S=s.onCaughtError;S(y.value,{componentStack:y.stack,errorBoundary:d.tag===1?d.stateNode:null})}catch(D){setTimeout(function(){throw D})}}function fm(s,d,y){return y=Ju(y),y.tag=3,y.payload={element:null},y.callback=function(){ef(s,d)},y}function fd(s){return s=Ju(s),s.tag=3,s}function Ry(s,d,y,S){var D=y.type.getDerivedStateFromError;if(typeof D=="function"){var B=S.value;s.payload=function(){return D(B)},s.callback=function(){Mg(d,y,S)}}var ne=y.stateNode;ne!==null&&typeof ne.componentDidCatch=="function"&&(s.callback=function(){Mg(d,y,S),typeof D!="function"&&(Wc===null?Wc=new Set([this]):Wc.add(this));var he=S.stack;this.componentDidCatch(S.value,{componentStack:he!==null?he:""})})}function ep(s,d,y,S,D){if(y.flags|=32768,S!==null&&typeof S=="object"&&typeof S.then=="function"){if(d=y.alternate,d!==null&&Ku(d,y,D,!0),y=Oo.current,y!==null){switch(y.tag){case 13:return ea===null?Cm():y.alternate===null&&ca===0&&(ca=3),y.flags&=-257,y.flags|=65536,y.lanes=D,S===sd?y.flags|=16384:(d=y.updateQueue,d===null?y.updateQueue=new Set([S]):d.add(S),Jg(s,S,D)),!1;case 22:return y.flags|=65536,S===sd?y.flags|=16384:(d=y.updateQueue,d===null?(d={transitions:null,markerInstances:null,retryQueue:new Set([S])},y.updateQueue=d):(y=d.retryQueue,y===null?d.retryQueue=new Set([S]):y.add(S)),Jg(s,S,D)),!1}throw Error(a(435,y.tag))}return Jg(s,S,D),Cm(),!1}if(Zn)return d=Oo.current,d!==null?((d.flags&65536)===0&&(d.flags|=256),d.flags|=65536,d.lanes=D,S!==_a&&(s=Error(a(422),{cause:S}),rl(ua(s,y)))):(S!==_a&&(d=Error(a(423),{cause:S}),rl(ua(d,y))),s=s.current.alternate,s.flags|=65536,D&=-D,s.lanes|=D,S=ua(S,y),D=fm(s.stateNode,S,D),ud(s,D),ca!==4&&(ca=2)),!1;var B=Error(a(520),{cause:S});if(B=ua(B,y),Mh===null?Mh=[B]:Mh.push(B),ca!==4&&(ca=2),d===null)return!0;S=ua(S,y),y=d;do{switch(y.tag){case 3:return y.flags|=65536,s=D&-D,y.lanes|=s,s=fm(y.stateNode,S,s),ud(y,s),!1;case 1:if(d=y.type,B=y.stateNode,(y.flags&128)===0&&(typeof d.getDerivedStateFromError=="function"||B!==null&&typeof B.componentDidCatch=="function"&&(Wc===null||!Wc.has(B))))return y.flags|=65536,D&=-D,y.lanes|=D,D=fd(D),Ry(D,s,y,S),ud(y,D),!1}y=y.return}while(y!==null);return!1}var tp=Error(a(461)),La=!1;function zs(s,d,y,S){d.child=s===null?Au(d,null,y,S):Ds(d,s.child,y,S)}function Rg(s,d,y,S,D){y=y.render;var B=d.ref;if("ref"in S){var ne={};for(var he in S)he!=="ref"&&(ne[he]=S[he])}else ne=S;return Yu(d),S=Qf(s,d,y,ne,B,D),he=Th(),s!==null&&!La?(ec(s,d,D),Cu(s,d,D)):(Zn&&he&&Rt(d),d.flags|=1,zs(s,d,S,D),d.child)}function ky(s,d,y,S,D){if(s===null){var B=y.type;return typeof B=="function"&&!Rc(B)&&B.defaultProps===void 0&&y.compare===null?(d.tag=15,d.type=B,Ly(s,d,B,S,D)):(s=kc(y.type,null,S,d,d.mode,D),s.ref=d.ref,s.return=d,d.child=s)}if(B=s.child,!vm(s,D)){var ne=B.memoizedProps;if(y=y.compare,y=y!==null?y:Is,y(ne,S)&&s.ref===d.ref)return Cu(s,d,D)}return d.flags|=1,s=Pa(B,S),s.ref=d.ref,s.return=d,d.child=s}function Ly(s,d,y,S,D){if(s!==null){var B=s.memoizedProps;if(Is(B,S)&&s.ref===d.ref)if(La=!1,d.pendingProps=S=B,vm(s,D))(s.flags&131072)!==0&&(La=!0);else return d.lanes=s.lanes,Cu(s,d,D)}return Dg(s,d,y,S,D)}function kg(s,d,y){var S=d.pendingProps,D=S.children,B=s!==null?s.memoizedState:null;if(S.mode==="hidden"){if((d.flags&128)!==0){if(S=B!==null?B.baseLanes|y:y,s!==null){for(D=d.child=s.child,B=0;D!==null;)B=B|D.lanes|D.childLanes,D=D.sibling;d.childLanes=B&~S}else d.childLanes=0,d.child=null;return Lg(s,d,S,y)}if((y&536870912)!==0)d.memoizedState={baseLanes:0,cachePool:null},s!==null&&Kd(d,B!==null?B.cachePool:null),B!==null?Fc(d,B):cd(),Jd(d);else return d.lanes=d.childLanes=536870912,Lg(s,d,B!==null?B.baseLanes|y:y,y)}else B!==null?(Kd(d,B.cachePool),Fc(d,B),Bl(),d.memoizedState=null):(s!==null&&Kd(d,null),cd(),Bl());return zs(s,d,D,y),d.child}function Lg(s,d,y,S){var D=Wf();return D=D===null?null:{parent:ya._currentValue,pool:D},d.memoizedState={baseLanes:y,cachePool:D},s!==null&&Kd(d,null),cd(),Jd(d),s!==null&&Ku(s,d,S,!0),null}function np(s,d){var y=d.ref;if(y===null)s!==null&&s.ref!==null&&(d.flags|=4194816);else{if(typeof y!="function"&&typeof y!="object")throw Error(a(284));(s===null||s.ref!==y)&&(d.flags|=4194816)}}function Dg(s,d,y,S,D){return Yu(d),y=Qf(s,d,y,S,void 0,D),S=Th(),s!==null&&!La?(ec(s,d,D),Cu(s,d,D)):(Zn&&S&&Rt(d),d.flags|=1,zs(s,d,y,D),d.child)}function pm(s,d,y,S,D,B){return Yu(d),d.updateQueue=null,y=ji(d,S,y,D),wh(s),S=Th(),s!==null&&!La?(ec(s,d,B),Cu(s,d,B)):(Zn&&S&&Rt(d),d.flags|=1,zs(s,d,y,B),d.child)}function zg(s,d,y,S,D){if(Yu(d),d.stateNode===null){var B=Gn,ne=y.contextType;typeof ne=="object"&&ne!==null&&(B=_r(ne)),B=new y(S,B),d.memoizedState=B.state!==null&&B.state!==void 0?B.state:null,B.updater=Cg,d.stateNode=B,B._reactInternals=d,B=d.stateNode,B.props=S,B.state=d.memoizedState,B.refs={},Xf(d),ne=y.contextType,B.context=typeof ne=="object"&&ne!==null?_r(ne):Gn,B.state=d.memoizedState,ne=y.getDerivedStateFromProps,typeof ne=="function"&&(cm(d,y,ne,S),B.state=d.memoizedState),typeof y.getDerivedStateFromProps=="function"||typeof B.getSnapshotBeforeUpdate=="function"||typeof B.UNSAFE_componentWillMount!="function"&&typeof B.componentWillMount!="function"||(ne=B.state,typeof B.componentWillMount=="function"&&B.componentWillMount(),typeof B.UNSAFE_componentWillMount=="function"&&B.UNSAFE_componentWillMount(),ne!==B.state&&Cg.enqueueReplaceState(B,B.state,null),Bc(d,S,B,D),xh(),B.state=d.memoizedState),typeof B.componentDidMount=="function"&&(d.flags|=4194308),S=!0}else if(s===null){B=d.stateNode;var he=d.memoizedProps,Be=dd(y,he);B.props=Be;var ht=B.context,St=y.contextType;ne=Gn,typeof St=="object"&&St!==null&&(ne=_r(St));var Mt=y.getDerivedStateFromProps;St=typeof Mt=="function"||typeof B.getSnapshotBeforeUpdate=="function",he=d.pendingProps!==he,St||typeof B.UNSAFE_componentWillReceiveProps!="function"&&typeof B.componentWillReceiveProps!="function"||(he||ht!==ne)&&Pg(d,B,S,ne),zl=!1;var ft=d.memoizedState;B.state=ft,Bc(d,S,B,D),xh(),ht=d.memoizedState,he||ft!==ht||zl?(typeof Mt=="function"&&(cm(d,y,Mt,S),ht=d.memoizedState),(Be=zl||hm(d,y,Be,S,ft,ht,ne))?(St||typeof B.UNSAFE_componentWillMount!="function"&&typeof B.componentWillMount!="function"||(typeof B.componentWillMount=="function"&&B.componentWillMount(),typeof B.UNSAFE_componentWillMount=="function"&&B.UNSAFE_componentWillMount()),typeof B.componentDidMount=="function"&&(d.flags|=4194308)):(typeof B.componentDidMount=="function"&&(d.flags|=4194308),d.memoizedProps=S,d.memoizedState=ht),B.props=S,B.state=ht,B.context=ne,S=Be):(typeof B.componentDidMount=="function"&&(d.flags|=4194308),S=!1)}else{B=d.stateNode,bh(s,d),ne=d.memoizedProps,St=dd(y,ne),B.props=St,Mt=d.pendingProps,ft=B.context,ht=y.contextType,Be=Gn,typeof ht=="object"&&ht!==null&&(Be=_r(ht)),he=y.getDerivedStateFromProps,(ht=typeof he=="function"||typeof B.getSnapshotBeforeUpdate=="function")||typeof B.UNSAFE_componentWillReceiveProps!="function"&&typeof B.componentWillReceiveProps!="function"||(ne!==Mt||ft!==Be)&&Pg(d,B,S,Be),zl=!1,ft=d.memoizedState,B.state=ft,Bc(d,S,B,D),xh();var vt=d.memoizedState;ne!==Mt||ft!==vt||zl||s!==null&&s.dependencies!==null&&ad(s.dependencies)?(typeof he=="function"&&(cm(d,y,he,S),vt=d.memoizedState),(St=zl||hm(d,y,St,S,ft,vt,Be)||s!==null&&s.dependencies!==null&&ad(s.dependencies))?(ht||typeof B.UNSAFE_componentWillUpdate!="function"&&typeof B.componentWillUpdate!="function"||(typeof B.componentWillUpdate=="function"&&B.componentWillUpdate(S,vt,Be),typeof B.UNSAFE_componentWillUpdate=="function"&&B.UNSAFE_componentWillUpdate(S,vt,Be)),typeof B.componentDidUpdate=="function"&&(d.flags|=4),typeof B.getSnapshotBeforeUpdate=="function"&&(d.flags|=1024)):(typeof B.componentDidUpdate!="function"||ne===s.memoizedProps&&ft===s.memoizedState||(d.flags|=4),typeof B.getSnapshotBeforeUpdate!="function"||ne===s.memoizedProps&&ft===s.memoizedState||(d.flags|=1024),d.memoizedProps=S,d.memoizedState=vt),B.props=S,B.state=vt,B.context=Be,S=St):(typeof B.componentDidUpdate!="function"||ne===s.memoizedProps&&ft===s.memoizedState||(d.flags|=4),typeof B.getSnapshotBeforeUpdate!="function"||ne===s.memoizedProps&&ft===s.memoizedState||(d.flags|=1024),S=!1)}return B=S,np(s,d),S=(d.flags&128)!==0,B||S?(B=d.stateNode,y=S&&typeof y.getDerivedStateFromError!="function"?null:B.render(),d.flags|=1,s!==null&&S?(d.child=Ds(d,s.child,null,D),d.child=Ds(d,null,y,D)):zs(s,d,y,D),d.memoizedState=B.state,s=d.child):s=Cu(s,d,D),s}function mm(s,d,y,S){return Ma(),d.flags|=256,zs(s,d,y,S),d.child}var pd={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function ao(s){return{baseLanes:s,cachePool:yh()}}function gm(s,d,y){return s=s!==null?s.childLanes&~y:0,d&&(s|=Ul),s}function _m(s,d,y){var S=d.pendingProps,D=!1,B=(d.flags&128)!==0,ne;if((ne=B)||(ne=s!==null&&s.memoizedState===null?!1:(yr.current&2)!==0),ne&&(D=!0,d.flags&=-129),ne=(d.flags&32)!==0,d.flags&=-33,s===null){if(Zn){if(D?Iu(d):Bl(),Zn){var he=_n,Be;if(Be=he){e:{for(Be=he,he=mr;Be.nodeType!==8;){if(!he){he=null;break e}if(Be=Mu(Be.nextSibling),Be===null){he=null;break e}}he=Be}he!==null?(d.memoizedState={dehydrated:he,treeContext:K!==null?{id:ue,overflow:Oe}:null,retryLane:536870912,hydrationErrors:null},Be=eo(18,null,null,0),Be.stateNode=he,Be.return=d,d.child=Be,on=d,_n=null,Be=!0):Be=!1}Be||wo(d)}if(he=d.memoizedState,he!==null&&(he=he.dehydrated,he!==null))return yf(he)?d.lanes=32:d.lanes=536870912,null;cl(d)}return he=S.children,S=S.fallback,D?(Bl(),D=d.mode,he=ip({mode:"hidden",children:he},D),S=kl(S,D,y,null),he.return=d,S.return=d,he.sibling=S,d.child=he,D=d.child,D.memoizedState=ao(y),D.childLanes=gm(s,ne,y),d.memoizedState=pd,S):(Iu(d),Og(d,he))}if(Be=s.memoizedState,Be!==null&&(he=Be.dehydrated,he!==null)){if(B)d.flags&256?(Iu(d),d.flags&=-257,d=Ng(s,d,y)):d.memoizedState!==null?(Bl(),d.child=s.child,d.flags|=128,d=null):(Bl(),D=S.fallback,he=d.mode,S=ip({mode:"visible",children:S.children},he),D=kl(D,he,y,null),D.flags|=2,S.return=d,D.return=d,S.sibling=D,d.child=S,Ds(d,s.child,null,y),S=d.child,S.memoizedState=ao(y),S.childLanes=gm(s,ne,y),d.memoizedState=pd,d=D);else if(Iu(d),yf(he)){if(ne=he.nextSibling&&he.nextSibling.dataset,ne)var ht=ne.dgst;ne=ht,S=Error(a(419)),S.stack="",S.digest=ne,rl({value:S,source:null,stack:null}),d=Ng(s,d,y)}else if(La||Ku(s,d,y,!1),ne=(y&s.childLanes)!==0,La||ne){if(ne=jr,ne!==null&&(S=y&-y,S=(S&42)!==0?1:Dn(S),S=(S&(ne.suspendedLanes|y))!==0?0:S,S!==0&&S!==Be.retryLane))throw Be.retryLane=S,Js(s,S),jl(ne,s,S),tp;he.data==="$?"||Cm(),d=Ng(s,d,y)}else he.data==="$?"?(d.flags|=192,d.child=s.child,d=null):(s=Be.treeContext,_n=Mu(he.nextSibling),on=d,Zn=!0,cr=null,mr=!1,s!==null&&(R[U++]=ue,R[U++]=Oe,R[U++]=K,ue=s.id,Oe=s.overflow,K=d),d=Og(d,S.children),d.flags|=4096);return d}return D?(Bl(),D=S.fallback,he=d.mode,Be=s.child,ht=Be.sibling,S=Pa(Be,{mode:"hidden",children:S.children}),S.subtreeFlags=Be.subtreeFlags&65011712,ht!==null?D=Pa(ht,D):(D=kl(D,he,y,null),D.flags|=2),D.return=d,S.return=d,S.sibling=D,d.child=S,S=D,D=d.child,he=s.child.memoizedState,he===null?he=ao(y):(Be=he.cachePool,Be!==null?(ht=ya._currentValue,Be=Be.parent!==ht?{parent:ht,pool:ht}:Be):Be=yh(),he={baseLanes:he.baseLanes|y,cachePool:Be}),D.memoizedState=he,D.childLanes=gm(s,ne,y),d.memoizedState=pd,S):(Iu(d),y=s.child,s=y.sibling,y=Pa(y,{mode:"visible",children:S.children}),y.return=d,y.sibling=null,s!==null&&(ne=d.deletions,ne===null?(d.deletions=[s],d.flags|=16):ne.push(s)),d.child=y,d.memoizedState=null,y)}function Og(s,d){return d=ip({mode:"visible",children:d},s.mode),d.return=s,s.child=d}function ip(s,d){return s=eo(22,s,null,d),s.lanes=0,s.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},s}function Ng(s,d,y){return Ds(d,s.child,null,y),s=Og(d,d.pendingProps.children),s.flags|=2,d.memoizedState=null,s}function Dy(s,d,y){s.lanes|=d;var S=s.alternate;S!==null&&(S.lanes|=d),Xu(s.return,d,y)}function ym(s,d,y,S,D){var B=s.memoizedState;B===null?s.memoizedState={isBackwards:d,rendering:null,renderingStartTime:0,last:S,tail:y,tailMode:D}:(B.isBackwards=d,B.rendering=null,B.renderingStartTime=0,B.last=S,B.tail=y,B.tailMode=D)}function zy(s,d,y){var S=d.pendingProps,D=S.revealOrder,B=S.tail;if(zs(s,d,S.children,y),S=yr.current,(S&2)!==0)S=S&1|2,d.flags|=128;else{if(s!==null&&(s.flags&128)!==0)e:for(s=d.child;s!==null;){if(s.tag===13)s.memoizedState!==null&&Dy(s,y,d);else if(s.tag===19)Dy(s,y,d);else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===d)break e;for(;s.sibling===null;){if(s.return===null||s.return===d)break e;s=s.return}s.sibling.return=s.return,s=s.sibling}S&=1}switch(zt(yr,S),D){case"forwards":for(y=d.child,D=null;y!==null;)s=y.alternate,s!==null&&hl(s)===null&&(D=y),y=y.sibling;y=D,y===null?(D=d.child,d.child=null):(D=y.sibling,y.sibling=null),ym(d,!1,D,y,B);break;case"backwards":for(y=null,D=d.child,d.child=null;D!==null;){if(s=D.alternate,s!==null&&hl(s)===null){d.child=D;break}s=D.sibling,D.sibling=y,y=D,D=s}ym(d,!0,y,null,B);break;case"together":ym(d,!1,null,null,void 0);break;default:d.memoizedState=null}return d.child}function Cu(s,d,y){if(s!==null&&(d.dependencies=s.dependencies),cc|=d.lanes,(y&d.childLanes)===0)if(s!==null){if(Ku(s,d,y,!1),(y&d.childLanes)===0)return null}else return null;if(s!==null&&d.child!==s.child)throw Error(a(153));if(d.child!==null){for(s=d.child,y=Pa(s,s.pendingProps),d.child=y,y.return=d;s.sibling!==null;)s=s.sibling,y=y.sibling=Pa(s,s.pendingProps),y.return=d;y.sibling=null}return d.child}function vm(s,d){return(s.lanes&d)!==0?!0:(s=s.dependencies,!!(s!==null&&ad(s)))}function Oy(s,d,y){switch(d.tag){case 3:qn(d,d.stateNode.containerInfo),$a(d,ya,s.memoizedState.cache),Ma();break;case 27:case 5:co(d);break;case 4:qn(d,d.stateNode.containerInfo);break;case 10:$a(d,d.type,d.memoizedProps.value);break;case 13:var S=d.memoizedState;if(S!==null)return S.dehydrated!==null?(Iu(d),d.flags|=128,null):(y&d.child.childLanes)!==0?_m(s,d,y):(Iu(d),s=Cu(s,d,y),s!==null?s.sibling:null);Iu(d);break;case 19:var D=(s.flags&128)!==0;if(S=(y&d.childLanes)!==0,S||(Ku(s,d,y,!1),S=(y&d.childLanes)!==0),D){if(S)return zy(s,d,y);d.flags|=128}if(D=d.memoizedState,D!==null&&(D.rendering=null,D.tail=null,D.lastEffect=null),zt(yr,yr.current),S)break;return null;case 22:case 23:return d.lanes=0,kg(s,d,y);case 24:$a(d,ya,s.memoizedState.cache)}return Cu(s,d,y)}function Ny(s,d,y){if(s!==null)if(s.memoizedProps!==d.pendingProps)La=!0;else{if(!vm(s,y)&&(d.flags&128)===0)return La=!1,Oy(s,d,y);La=(s.flags&131072)!==0}else La=!1,Zn&&(d.flags&1048576)!==0&&mt(d,x,d.index);switch(d.lanes=0,d.tag){case 16:e:{s=d.pendingProps;var S=d.elementType,D=S._init;if(S=D(S._payload),d.type=S,typeof S=="function")Rc(S)?(s=dd(S,s),d.tag=1,d=zg(null,d,S,s,y)):(d.tag=0,d=Dg(null,d,S,s,y));else{if(S!=null){if(D=S.$$typeof,D===Ke){d.tag=11,d=Rg(null,d,S,s,y);break e}else if(D===de){d.tag=14,d=ky(null,d,S,s,y);break e}}throw d=Bn(S)||S,Error(a(306,d,""))}}return d;case 0:return Dg(s,d,d.type,d.pendingProps,y);case 1:return S=d.type,D=dd(S,d.pendingProps),zg(s,d,S,D,y);case 3:e:{if(qn(d,d.stateNode.containerInfo),s===null)throw Error(a(387));S=d.pendingProps;var B=d.memoizedState;D=B.element,bh(s,d),Bc(d,S,null,y);var ne=d.memoizedState;if(S=ne.cache,$a(d,ya,S),S!==B.cache&&Dc(d,[ya],y,!0),xh(),S=ne.element,B.isDehydrated)if(B={element:S,isDehydrated:!1,cache:ne.cache},d.updateQueue.baseState=B,d.memoizedState=B,d.flags&256){d=mm(s,d,S,y);break e}else if(S!==D){D=ua(Error(a(424)),d),rl(D),d=mm(s,d,S,y);break e}else{switch(s=d.stateNode.containerInfo,s.nodeType){case 9:s=s.body;break;default:s=s.nodeName==="HTML"?s.ownerDocument.body:s}for(_n=Mu(s.firstChild),on=d,Zn=!0,cr=null,mr=!0,y=Au(d,null,S,y),d.child=y;y;)y.flags=y.flags&-3|4096,y=y.sibling}else{if(Ma(),S===D){d=Cu(s,d,y);break e}zs(s,d,S,y)}d=d.child}return d;case 26:return np(s,d),s===null?(y=Sp(d.type,null,d.pendingProps,null))?d.memoizedState=y:Zn||(y=d.type,s=d.pendingProps,S=xp(Ft.current).createElement(y),S[vn]=d,S[Pn]=s,ha(S,y,s),Ui(S),d.stateNode=S):d.memoizedState=Sp(d.type,s.memoizedProps,d.pendingProps,s.memoizedState),null;case 27:return co(d),s===null&&Zn&&(S=d.stateNode=ss(d.type,d.pendingProps,Ft.current),on=d,mr=!0,D=_n,Kc(d.type)?(u_=D,_n=Mu(S.firstChild)):_n=D),zs(s,d,d.pendingProps.children,y),np(s,d),s===null&&(d.flags|=4194304),d.child;case 5:return s===null&&Zn&&((D=S=_n)&&(S=Vm(S,d.type,d.pendingProps,mr),S!==null?(d.stateNode=S,on=d,_n=Mu(S.firstChild),mr=!1,D=!0):D=!1),D||wo(d)),co(d),D=d.type,B=d.pendingProps,ne=s!==null?s.memoizedProps:null,S=B.children,fc(D,B)?S=null:ne!==null&&fc(D,ne)&&(d.flags|=32),d.memoizedState!==null&&(D=Qf(s,d,Qr,null,null,y),He._currentValue=D),np(s,d),zs(s,d,S,y),d.child;case 6:return s===null&&Zn&&((s=y=_n)&&(y=Um(y,d.pendingProps,mr),y!==null?(d.stateNode=y,on=d,_n=null,s=!0):s=!1),s||wo(d)),null;case 13:return _m(s,d,y);case 4:return qn(d,d.stateNode.containerInfo),S=d.pendingProps,s===null?d.child=Ds(d,null,S,y):zs(s,d,S,y),d.child;case 11:return Rg(s,d,d.type,d.pendingProps,y);case 7:return zs(s,d,d.pendingProps,y),d.child;case 8:return zs(s,d,d.pendingProps.children,y),d.child;case 12:return zs(s,d,d.pendingProps.children,y),d.child;case 10:return S=d.pendingProps,$a(d,d.type,S.value),zs(s,d,S.children,y),d.child;case 9:return D=d.type._context,S=d.pendingProps.children,Yu(d),D=_r(D),S=S(D),d.flags|=1,zs(s,d,S,y),d.child;case 14:return ky(s,d,d.type,d.pendingProps,y);case 15:return Ly(s,d,d.type,d.pendingProps,y);case 19:return zy(s,d,y);case 31:return S=d.pendingProps,y=d.mode,S={mode:S.mode,children:S.children},s===null?(y=ip(S,y),y.ref=d.ref,d.child=y,y.return=d,d=y):(y=Pa(s.child,S),y.ref=d.ref,d.child=y,y.return=d,d=y),d;case 22:return kg(s,d,y);case 24:return Yu(d),S=_r(ya),s===null?(D=Wf(),D===null&&(D=jr,B=Qu(),D.pooledCache=B,B.refCount++,B!==null&&(D.pooledCacheLanes|=y),D=B),d.memoizedState={parent:S,cache:D},Xf(d),$a(d,ya,D)):((s.lanes&y)!==0&&(bh(s,d),Bc(d,null,null,y),xh()),D=s.memoizedState,B=d.memoizedState,D.parent!==S?(D={parent:S,cache:S},d.memoizedState=D,d.lanes===0&&(d.memoizedState=d.updateQueue.baseState=D),$a(d,ya,S)):(S=B.cache,$a(d,ya,S),S!==D.cache&&Dc(d,[ya],y,!0))),zs(s,d,d.pendingProps.children,y),d.child;case 29:throw d.pendingProps}throw Error(a(156,d.tag))}function $c(s){s.flags|=4}function By(s,d){if(d.type!=="stylesheet"||(d.state.loading&4)!==0)s.flags&=-16777217;else if(s.flags|=16777216,!F(d)){if(d=Oo.current,d!==null&&((mi&4194048)===mi?ea!==null:(mi&62914560)!==mi&&(mi&536870912)===0||d!==ea))throw Dl=sd,sl;s.flags|=8192}}function tf(s,d){d!==null&&(s.flags|=4),s.flags&16384&&(d=s.tag!==22?bt():536870912,s.lanes|=d,pf|=d)}function md(s,d){if(!Zn)switch(s.tailMode){case"hidden":d=s.tail;for(var y=null;d!==null;)d.alternate!==null&&(y=d),d=d.sibling;y===null?s.tail=null:y.sibling=null;break;case"collapsed":y=s.tail;for(var S=null;y!==null;)y.alternate!==null&&(S=y),y=y.sibling;S===null?d||s.tail===null?s.tail=null:s.tail.sibling=null:S.sibling=null}}function ta(s){var d=s.alternate!==null&&s.alternate.child===s.child,y=0,S=0;if(d)for(var D=s.child;D!==null;)y|=D.lanes|D.childLanes,S|=D.subtreeFlags&65011712,S|=D.flags&65011712,D.return=s,D=D.sibling;else for(D=s.child;D!==null;)y|=D.lanes|D.childLanes,S|=D.subtreeFlags,S|=D.flags,D.return=s,D=D.sibling;return s.subtreeFlags|=S,s.childLanes=y,d}function gd(s,d,y){var S=d.pendingProps;switch(Jt(d),d.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ta(d),null;case 1:return ta(d),null;case 3:return y=d.stateNode,S=null,s!==null&&(S=s.memoizedState.cache),d.memoizedState.cache!==S&&(d.flags|=2048),zo(ya),zr(),y.pendingContext&&(y.context=y.pendingContext,y.pendingContext=null),(s===null||s.child===null)&&(Ps(d)?$c(d):s===null||s.memoizedState.isDehydrated&&(d.flags&256)===0||(d.flags|=1024,Lc())),ta(d),null;case 26:return y=d.memoizedState,s===null?($c(d),y!==null?(ta(d),By(d,y)):(ta(d),d.flags&=-16777217)):y?y!==s.memoizedState?($c(d),ta(d),By(d,y)):(ta(d),d.flags&=-16777217):(s.memoizedProps!==S&&$c(d),ta(d),d.flags&=-16777217),null;case 27:Us(d),y=Ft.current;var D=d.type;if(s!==null&&d.stateNode!=null)s.memoizedProps!==S&&$c(d);else{if(!S){if(d.stateNode===null)throw Error(a(166));return ta(d),null}s=Xt.current,Ps(d)?ph(d):(s=ss(D,S,y),d.stateNode=s,$c(d))}return ta(d),null;case 5:if(Us(d),y=d.type,s!==null&&d.stateNode!=null)s.memoizedProps!==S&&$c(d);else{if(!S){if(d.stateNode===null)throw Error(a(166));return ta(d),null}if(s=Xt.current,Ps(d))ph(d);else{switch(D=xp(Ft.current),s){case 1:s=D.createElementNS("http://www.w3.org/2000/svg",y);break;case 2:s=D.createElementNS("http://www.w3.org/1998/Math/MathML",y);break;default:switch(y){case"svg":s=D.createElementNS("http://www.w3.org/2000/svg",y);break;case"math":s=D.createElementNS("http://www.w3.org/1998/Math/MathML",y);break;case"script":s=D.createElement("div"),s.innerHTML="<script><\/script>",s=s.removeChild(s.firstChild);break;case"select":s=typeof S.is=="string"?D.createElement("select",{is:S.is}):D.createElement("select"),S.multiple?s.multiple=!0:S.size&&(s.size=S.size);break;default:s=typeof S.is=="string"?D.createElement(y,{is:S.is}):D.createElement(y)}}s[vn]=d,s[Pn]=S;e:for(D=d.child;D!==null;){if(D.tag===5||D.tag===6)s.appendChild(D.stateNode);else if(D.tag!==4&&D.tag!==27&&D.child!==null){D.child.return=D,D=D.child;continue}if(D===d)break e;for(;D.sibling===null;){if(D.return===null||D.return===d)break e;D=D.return}D.sibling.return=D.return,D=D.sibling}d.stateNode=s;e:switch(ha(s,y,S),y){case"button":case"input":case"select":case"textarea":s=!!S.autoFocus;break e;case"img":s=!0;break e;default:s=!1}s&&$c(d)}}return ta(d),d.flags&=-16777217,null;case 6:if(s&&d.stateNode!=null)s.memoizedProps!==S&&$c(d);else{if(typeof S!="string"&&d.stateNode===null)throw Error(a(166));if(s=Ft.current,Ps(d)){if(s=d.stateNode,y=d.memoizedProps,S=null,D=on,D!==null)switch(D.tag){case 27:case 5:S=D.memoizedProps}s[vn]=d,s=!!(s.nodeValue===y||S!==null&&S.suppressHydrationWarning===!0||s_(s.nodeValue,y)),s||wo(d)}else s=xp(s).createTextNode(S),s[vn]=d,d.stateNode=s}return ta(d),null;case 13:if(S=d.memoizedState,s===null||s.memoizedState!==null&&s.memoizedState.dehydrated!==null){if(D=Ps(d),S!==null&&S.dehydrated!==null){if(s===null){if(!D)throw Error(a(318));if(D=d.memoizedState,D=D!==null?D.dehydrated:null,!D)throw Error(a(317));D[vn]=d}else Ma(),(d.flags&128)===0&&(d.memoizedState=null),d.flags|=4;ta(d),D=!1}else D=Lc(),s!==null&&s.memoizedState!==null&&(s.memoizedState.hydrationErrors=D),D=!0;if(!D)return d.flags&256?(cl(d),d):(cl(d),null)}if(cl(d),(d.flags&128)!==0)return d.lanes=y,d;if(y=S!==null,s=s!==null&&s.memoizedState!==null,y){S=d.child,D=null,S.alternate!==null&&S.alternate.memoizedState!==null&&S.alternate.memoizedState.cachePool!==null&&(D=S.alternate.memoizedState.cachePool.pool);var B=null;S.memoizedState!==null&&S.memoizedState.cachePool!==null&&(B=S.memoizedState.cachePool.pool),B!==D&&(S.flags|=2048)}return y!==s&&y&&(d.child.flags|=8192),tf(d,d.updateQueue),ta(d),null;case 4:return zr(),s===null&&Lm(d.stateNode.containerInfo),ta(d),null;case 10:return zo(d.type),ta(d),null;case 19:if(Dt(yr),D=d.memoizedState,D===null)return ta(d),null;if(S=(d.flags&128)!==0,B=D.rendering,B===null)if(S)md(D,!1);else{if(ca!==0||s!==null&&(s.flags&128)!==0)for(s=d.child;s!==null;){if(B=hl(s),B!==null){for(d.flags|=128,md(D,!1),s=B.updateQueue,d.updateQueue=s,tf(d,s),d.subtreeFlags=0,s=y,y=d.child;y!==null;)fh(y,s),y=y.sibling;return zt(yr,yr.current&1|2),d.child}s=s.sibling}D.tail!==null&&Nr()>Sm&&(d.flags|=128,S=!0,md(D,!1),d.lanes=4194304)}else{if(!S)if(s=hl(B),s!==null){if(d.flags|=128,S=!0,s=s.updateQueue,d.updateQueue=s,tf(d,s),md(D,!0),D.tail===null&&D.tailMode==="hidden"&&!B.alternate&&!Zn)return ta(d),null}else 2*Nr()-D.renderingStartTime>Sm&&y!==536870912&&(d.flags|=128,S=!0,md(D,!1),d.lanes=4194304);D.isBackwards?(B.sibling=d.child,d.child=B):(s=D.last,s!==null?s.sibling=B:d.child=B,D.last=B)}return D.tail!==null?(d=D.tail,D.rendering=d,D.tail=d.sibling,D.renderingStartTime=Nr(),d.sibling=null,s=yr.current,zt(yr,S?s&1|2:s&1),d):(ta(d),null);case 22:case 23:return cl(d),Qd(),S=d.memoizedState!==null,s!==null?s.memoizedState!==null!==S&&(d.flags|=8192):S&&(d.flags|=8192),S?(y&536870912)!==0&&(d.flags&128)===0&&(ta(d),d.subtreeFlags&6&&(d.flags|=8192)):ta(d),y=d.updateQueue,y!==null&&tf(d,y.retryQueue),y=null,s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(y=s.memoizedState.cachePool.pool),S=null,d.memoizedState!==null&&d.memoizedState.cachePool!==null&&(S=d.memoizedState.cachePool.pool),S!==y&&(d.flags|=2048),s!==null&&Dt(Ll),null;case 24:return y=null,s!==null&&(y=s.memoizedState.cache),d.memoizedState.cache!==y&&(d.flags|=2048),zo(ya),ta(d),null;case 25:return null;case 30:return null}throw Error(a(156,d.tag))}function rp(s,d){switch(Jt(d),d.tag){case 1:return s=d.flags,s&65536?(d.flags=s&-65537|128,d):null;case 3:return zo(ya),zr(),s=d.flags,(s&65536)!==0&&(s&128)===0?(d.flags=s&-65537|128,d):null;case 26:case 27:case 5:return Us(d),null;case 13:if(cl(d),s=d.memoizedState,s!==null&&s.dehydrated!==null){if(d.alternate===null)throw Error(a(340));Ma()}return s=d.flags,s&65536?(d.flags=s&-65537|128,d):null;case 19:return Dt(yr),null;case 4:return zr(),null;case 10:return zo(d.type),null;case 22:case 23:return cl(d),Qd(),s!==null&&Dt(Ll),s=d.flags,s&65536?(d.flags=s&-65537|128,d):null;case 24:return zo(ya),null;case 25:return null;default:return null}}function Fy(s,d){switch(Jt(d),d.tag){case 3:zo(ya),zr();break;case 26:case 27:case 5:Us(d);break;case 4:zr();break;case 13:cl(d);break;case 19:Dt(yr);break;case 10:zo(d.type);break;case 22:case 23:cl(d),Qd(),s!==null&&Dt(Ll);break;case 24:zo(ya)}}function ap(s,d){try{var y=d.updateQueue,S=y!==null?y.lastEffect:null;if(S!==null){var D=S.next;y=D;do{if((y.tag&s)===s){S=void 0;var B=y.create,ne=y.inst;S=B(),ne.destroy=S}y=y.next}while(y!==D)}}catch(he){vr(d,d.return,he)}}function Ah(s,d,y){try{var S=d.updateQueue,D=S!==null?S.lastEffect:null;if(D!==null){var B=D.next;S=B;do{if((S.tag&s)===s){var ne=S.inst,he=ne.destroy;if(he!==void 0){ne.destroy=void 0,D=d;var Be=y,ht=he;try{ht()}catch(St){vr(D,Be,St)}}}S=S.next}while(S!==B)}}catch(St){vr(d,d.return,St)}}function Vy(s){var d=s.updateQueue;if(d!==null){var y=s.stateNode;try{Yf(d,y)}catch(S){vr(s,s.return,S)}}}function Uy(s,d,y){y.props=dd(s.type,s.memoizedProps),y.state=s.memoizedState;try{y.componentWillUnmount()}catch(S){vr(s,d,S)}}function sp(s,d){try{var y=s.ref;if(y!==null){switch(s.tag){case 26:case 27:case 5:var S=s.stateNode;break;case 30:S=s.stateNode;break;default:S=s.stateNode}typeof y=="function"?s.refCleanup=y(S):y.current=S}}catch(D){vr(s,d,D)}}function oc(s,d){var y=s.ref,S=s.refCleanup;if(y!==null)if(typeof S=="function")try{S()}catch(D){vr(s,d,D)}finally{s.refCleanup=null,s=s.alternate,s!=null&&(s.refCleanup=null)}else if(typeof y=="function")try{y(null)}catch(D){vr(s,d,D)}else y.current=null}function bm(s){var d=s.type,y=s.memoizedProps,S=s.stateNode;try{e:switch(d){case"button":case"input":case"select":case"textarea":y.autoFocus&&S.focus();break e;case"img":y.src?S.src=y.src:y.srcSet&&(S.srcset=y.srcSet)}}catch(D){vr(s,s.return,D)}}function Bg(s,d,y){try{var S=s.stateNode;hv(S,s.type,y,d),S[Pn]=d}catch(D){vr(s,s.return,D)}}function Fg(s){return s.tag===5||s.tag===3||s.tag===26||s.tag===27&&Kc(s.type)||s.tag===4}function _d(s){e:for(;;){for(;s.sibling===null;){if(s.return===null||Fg(s.return))return null;s=s.return}for(s.sibling.return=s.return,s=s.sibling;s.tag!==5&&s.tag!==6&&s.tag!==18;){if(s.tag===27&&Kc(s.type)||s.flags&2||s.child===null||s.tag===4)continue e;s.child.return=s,s=s.child}if(!(s.flags&2))return s.stateNode}}function Vg(s,d,y){var S=s.tag;if(S===5||S===6)s=s.stateNode,d?(y.nodeType===9?y.body:y.nodeName==="HTML"?y.ownerDocument.body:y).insertBefore(s,d):(d=y.nodeType===9?y.body:y.nodeName==="HTML"?y.ownerDocument.body:y,d.appendChild(s),y=y._reactRootContainer,y!=null||d.onclick!==null||(d.onclick=Eo));else if(S!==4&&(S===27&&Kc(s.type)&&(y=s.stateNode,d=null),s=s.child,s!==null))for(Vg(s,d,y),s=s.sibling;s!==null;)Vg(s,d,y),s=s.sibling}function Ur(s,d,y){var S=s.tag;if(S===5||S===6)s=s.stateNode,d?y.insertBefore(s,d):y.appendChild(s);else if(S!==4&&(S===27&&Kc(s.type)&&(y=s.stateNode),s=s.child,s!==null))for(Ur(s,d,y),s=s.sibling;s!==null;)Ur(s,d,y),s=s.sibling}function yd(s){var d=s.stateNode,y=s.memoizedProps;try{for(var S=s.type,D=d.attributes;D.length;)d.removeAttributeNode(D[0]);ha(d,S,y),d[vn]=s,d[Pn]=y}catch(B){vr(s,s.return,B)}}var lc=!1,na=!1,nf=!1,rf=typeof WeakSet=="function"?WeakSet:Set,as=null;function jy(s,d){if(s=s.containerInfo,Om=Ut,s=mu(s),gu(s)){if("selectionStart"in s)var y={start:s.selectionStart,end:s.selectionEnd};else e:{y=(y=s.ownerDocument)&&y.defaultView||window;var S=y.getSelection&&y.getSelection();if(S&&S.rangeCount!==0){y=S.anchorNode;var D=S.anchorOffset,B=S.focusNode;S=S.focusOffset;try{y.nodeType,B.nodeType}catch{y=null;break e}var ne=0,he=-1,Be=-1,ht=0,St=0,Mt=s,ft=null;t:for(;;){for(var vt;Mt!==y||D!==0&&Mt.nodeType!==3||(he=ne+D),Mt!==B||S!==0&&Mt.nodeType!==3||(Be=ne+S),Mt.nodeType===3&&(ne+=Mt.nodeValue.length),(vt=Mt.firstChild)!==null;)ft=Mt,Mt=vt;for(;;){if(Mt===s)break t;if(ft===y&&++ht===D&&(he=ne),ft===B&&++St===S&&(Be=ne),(vt=Mt.nextSibling)!==null)break;Mt=ft,ft=Mt.parentNode}Mt=vt}y=he===-1||Be===-1?null:{start:he,end:Be}}else y=null}y=y||{start:0,end:0}}else y=null;for(Nm={focusedElem:s,selectionRange:y},Ut=!1,as=d;as!==null;)if(d=as,s=d.child,(d.subtreeFlags&1024)!==0&&s!==null)s.return=d,as=s;else for(;as!==null;){switch(d=as,B=d.alternate,s=d.flags,d.tag){case 0:break;case 11:case 15:break;case 1:if((s&1024)!==0&&B!==null){s=void 0,y=d,D=B.memoizedProps,B=B.memoizedState,S=y.stateNode;try{var Wn=dd(y.type,D,y.elementType===y.type);s=S.getSnapshotBeforeUpdate(Wn,B),S.__reactInternalSnapshotBeforeUpdate=s}catch(jn){vr(y,y.return,jn)}}break;case 3:if((s&1024)!==0){if(s=d.stateNode.containerInfo,y=s.nodeType,y===9)Fm(s);else if(y===1)switch(s.nodeName){case"HEAD":case"HTML":case"BODY":Fm(s);break;default:s.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((s&1024)!==0)throw Error(a(163))}if(s=d.sibling,s!==null){s.return=d.return,as=s;break}as=d.return}}function af(s,d,y){var S=y.flags;switch(y.tag){case 0:case 11:case 15:Zc(s,y),S&4&&ap(5,y);break;case 1:if(Zc(s,y),S&4)if(s=y.stateNode,d===null)try{s.componentDidMount()}catch(ne){vr(y,y.return,ne)}else{var D=dd(y.type,d.memoizedProps);d=d.memoizedState;try{s.componentDidUpdate(D,d,s.__reactInternalSnapshotBeforeUpdate)}catch(ne){vr(y,y.return,ne)}}S&64&&Vy(y),S&512&&sp(y,y.return);break;case 3:if(Zc(s,y),S&64&&(s=y.updateQueue,s!==null)){if(d=null,y.child!==null)switch(y.child.tag){case 27:case 5:d=y.child.stateNode;break;case 1:d=y.child.stateNode}try{Yf(s,d)}catch(ne){vr(y,y.return,ne)}}break;case 27:d===null&&S&4&&yd(y);case 26:case 5:Zc(s,y),d===null&&S&4&&bm(y),S&512&&sp(y,y.return);break;case 12:Zc(s,y);break;case 13:Zc(s,y),S&4&&qy(s,y),S&64&&(s=y.memoizedState,s!==null&&(s=s.dehydrated,s!==null&&(y=Tb.bind(null,y),Pb(s,y))));break;case 22:if(S=y.memoizedState!==null||lc,!S){d=d!==null&&d.memoizedState!==null||na,D=lc;var B=na;lc=S,(na=d)&&!B?Ih(s,y,(y.subtreeFlags&8772)!==0):Zc(s,y),lc=D,na=B}break;case 30:break;default:Zc(s,y)}}function xm(s){var d=s.alternate;d!==null&&(s.alternate=null,xm(d)),s.child=null,s.deletions=null,s.sibling=null,s.tag===5&&(d=s.stateNode,d!==null&&Vt(d)),s.stateNode=null,s.return=null,s.dependencies=null,s.memoizedProps=null,s.memoizedState=null,s.pendingProps=null,s.stateNode=null,s.updateQueue=null}var hr=null,so=!1;function dl(s,d,y){for(y=y.child;y!==null;)sf(s,d,y),y=y.sibling}function sf(s,d,y){if(pr&&typeof pr.onCommitFiberUnmount=="function")try{pr.onCommitFiberUnmount(Ta,y)}catch{}switch(y.tag){case 26:na||oc(y,d),dl(s,d,y),y.memoizedState?y.memoizedState.count--:y.stateNode&&(y=y.stateNode,y.parentNode.removeChild(y));break;case 27:na||oc(y,d);var S=hr,D=so;Kc(y.type)&&(hr=y.stateNode,so=!1),dl(s,d,y),Pd(y.stateNode),hr=S,so=D;break;case 5:na||oc(y,d);case 6:if(S=hr,D=so,hr=null,dl(s,d,y),hr=S,so=D,hr!==null)if(so)try{(hr.nodeType===9?hr.body:hr.nodeName==="HTML"?hr.ownerDocument.body:hr).removeChild(y.stateNode)}catch(B){vr(y,d,B)}else try{hr.removeChild(y.stateNode)}catch(B){vr(y,d,B)}break;case 18:hr!==null&&(so?(s=hr,wp(s.nodeType===9?s.body:s.nodeName==="HTML"?s.ownerDocument.body:s,y.stateNode),aa(s)):wp(hr,y.stateNode));break;case 4:S=hr,D=so,hr=y.stateNode.containerInfo,so=!0,dl(s,d,y),hr=S,so=D;break;case 0:case 11:case 14:case 15:na||Ah(2,y,d),na||Ah(4,y,d),dl(s,d,y);break;case 1:na||(oc(y,d),S=y.stateNode,typeof S.componentWillUnmount=="function"&&Uy(y,d,S)),dl(s,d,y);break;case 21:dl(s,d,y);break;case 22:na=(S=na)||y.memoizedState!==null,dl(s,d,y),na=S;break;default:dl(s,d,y)}}function qy(s,d){if(d.memoizedState===null&&(s=d.alternate,s!==null&&(s=s.memoizedState,s!==null&&(s=s.dehydrated,s!==null))))try{aa(s)}catch(y){vr(d,d.return,y)}}function $y(s){switch(s.tag){case 13:case 19:var d=s.stateNode;return d===null&&(d=s.stateNode=new rf),d;case 22:return s=s.stateNode,d=s._retryCache,d===null&&(d=s._retryCache=new rf),d;default:throw Error(a(435,s.tag))}}function Gc(s,d){var y=$y(s);d.forEach(function(S){var D=Sb.bind(null,s,S);y.has(S)||(y.add(S),S.then(D,D))})}function Fl(s,d){var y=d.deletions;if(y!==null)for(var S=0;S<y.length;S++){var D=y[S],B=s,ne=d,he=ne;e:for(;he!==null;){switch(he.tag){case 27:if(Kc(he.type)){hr=he.stateNode,so=!1;break e}break;case 5:hr=he.stateNode,so=!1;break e;case 3:case 4:hr=he.stateNode.containerInfo,so=!0;break e}he=he.return}if(hr===null)throw Error(a(160));sf(B,ne,D),hr=null,so=!1,B=D.alternate,B!==null&&(B.return=null),D.return=null}if(d.subtreeFlags&13878)for(d=d.child;d!==null;)of(d,s),d=d.sibling}var au=null;function of(s,d){var y=s.alternate,S=s.flags;switch(s.tag){case 0:case 11:case 14:case 15:Fl(d,s),No(s),S&4&&(Ah(3,s,s.return),ap(3,s),Ah(5,s,s.return));break;case 1:Fl(d,s),No(s),S&512&&(na||y===null||oc(y,y.return)),S&64&&lc&&(s=s.updateQueue,s!==null&&(S=s.callbacks,S!==null&&(y=s.shared.hiddenCallbacks,s.shared.hiddenCallbacks=y===null?S:y.concat(S))));break;case 26:var D=au;if(Fl(d,s),No(s),S&512&&(na||y===null||oc(y,y.return)),S&4){var B=y!==null?y.memoizedState:null;if(S=s.memoizedState,y===null)if(S===null)if(s.stateNode===null){e:{S=s.type,y=s.memoizedProps,D=D.ownerDocument||D;t:switch(S){case"title":B=D.getElementsByTagName("title")[0],(!B||B[ps]||B[vn]||B.namespaceURI==="http://www.w3.org/2000/svg"||B.hasAttribute("itemprop"))&&(B=D.createElement(S),D.head.insertBefore(B,D.querySelector("head > title"))),ha(B,S,y),B[vn]=s,Ui(B),S=B;break e;case"link":var ne=A("link","href",D).get(S+(y.href||""));if(ne){for(var he=0;he<ne.length;he++)if(B=ne[he],B.getAttribute("href")===(y.href==null||y.href===""?null:y.href)&&B.getAttribute("rel")===(y.rel==null?null:y.rel)&&B.getAttribute("title")===(y.title==null?null:y.title)&&B.getAttribute("crossorigin")===(y.crossOrigin==null?null:y.crossOrigin)){ne.splice(he,1);break t}}B=D.createElement(S),ha(B,S,y),D.head.appendChild(B);break;case"meta":if(ne=A("meta","content",D).get(S+(y.content||""))){for(he=0;he<ne.length;he++)if(B=ne[he],B.getAttribute("content")===(y.content==null?null:""+y.content)&&B.getAttribute("name")===(y.name==null?null:y.name)&&B.getAttribute("property")===(y.property==null?null:y.property)&&B.getAttribute("http-equiv")===(y.httpEquiv==null?null:y.httpEquiv)&&B.getAttribute("charset")===(y.charSet==null?null:y.charSet)){ne.splice(he,1);break t}}B=D.createElement(S),ha(B,S,y),D.head.appendChild(B);break;default:throw Error(a(468,S))}B[vn]=s,Ui(B),S=B}s.stateNode=S}else P(D,s.type,s.stateNode);else s.stateNode=r(D,S,s.memoizedProps);else B!==S?(B===null?y.stateNode!==null&&(y=y.stateNode,y.parentNode.removeChild(y)):B.count--,S===null?P(D,s.type,s.stateNode):r(D,S,s.memoizedProps)):S===null&&s.stateNode!==null&&Bg(s,s.memoizedProps,y.memoizedProps)}break;case 27:Fl(d,s),No(s),S&512&&(na||y===null||oc(y,y.return)),y!==null&&S&4&&Bg(s,s.memoizedProps,y.memoizedProps);break;case 5:if(Fl(d,s),No(s),S&512&&(na||y===null||oc(y,y.return)),s.flags&32){D=s.stateNode;try{Xr(D,"")}catch(vt){vr(s,s.return,vt)}}S&4&&s.stateNode!=null&&(D=s.memoizedProps,Bg(s,D,y!==null?y.memoizedProps:D)),S&1024&&(nf=!0);break;case 6:if(Fl(d,s),No(s),S&4){if(s.stateNode===null)throw Error(a(162));S=s.memoizedProps,y=s.stateNode;try{y.nodeValue=S}catch(vt){vr(s,s.return,vt)}}break;case 3:if(E=null,D=au,au=vf(d.containerInfo),Fl(d,s),au=D,No(s),S&4&&y!==null&&y.memoizedState.isDehydrated)try{aa(d.containerInfo)}catch(vt){vr(s,s.return,vt)}nf&&(nf=!1,Ug(s));break;case 4:S=au,au=vf(s.stateNode.containerInfo),Fl(d,s),No(s),au=S;break;case 12:Fl(d,s),No(s);break;case 13:Fl(d,s),No(s),s.child.flags&8192&&s.memoizedState!==null!=(y!==null&&y.memoizedState!==null)&&(Zg=Nr()),S&4&&(S=s.updateQueue,S!==null&&(s.updateQueue=null,Gc(s,S)));break;case 22:D=s.memoizedState!==null;var Be=y!==null&&y.memoizedState!==null,ht=lc,St=na;if(lc=ht||D,na=St||Be,Fl(d,s),na=St,lc=ht,No(s),S&8192)e:for(d=s.stateNode,d._visibility=D?d._visibility&-2:d._visibility|1,D&&(y===null||Be||lc||na||vd(s)),y=null,d=s;;){if(d.tag===5||d.tag===26){if(y===null){Be=y=d;try{if(B=Be.stateNode,D)ne=B.style,typeof ne.setProperty=="function"?ne.setProperty("display","none","important"):ne.display="none";else{he=Be.stateNode;var Mt=Be.memoizedProps.style,ft=Mt!=null&&Mt.hasOwnProperty("display")?Mt.display:null;he.style.display=ft==null||typeof ft=="boolean"?"":(""+ft).trim()}}catch(vt){vr(Be,Be.return,vt)}}}else if(d.tag===6){if(y===null){Be=d;try{Be.stateNode.nodeValue=D?"":Be.memoizedProps}catch(vt){vr(Be,Be.return,vt)}}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===s)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===s)break e;for(;d.sibling===null;){if(d.return===null||d.return===s)break e;y===d&&(y=null),d=d.return}y===d&&(y=null),d.sibling.return=d.return,d=d.sibling}S&4&&(S=s.updateQueue,S!==null&&(y=S.retryQueue,y!==null&&(S.retryQueue=null,Gc(s,y))));break;case 19:Fl(d,s),No(s),S&4&&(S=s.updateQueue,S!==null&&(s.updateQueue=null,Gc(s,S)));break;case 30:break;case 21:break;default:Fl(d,s),No(s)}}function No(s){var d=s.flags;if(d&2){try{for(var y,S=s.return;S!==null;){if(Fg(S)){y=S;break}S=S.return}if(y==null)throw Error(a(160));switch(y.tag){case 27:var D=y.stateNode,B=_d(s);Ur(s,B,D);break;case 5:var ne=y.stateNode;y.flags&32&&(Xr(ne,""),y.flags&=-33);var he=_d(s);Ur(s,he,ne);break;case 3:case 4:var Be=y.stateNode.containerInfo,ht=_d(s);Vg(s,ht,Be);break;default:throw Error(a(161))}}catch(St){vr(s,s.return,St)}s.flags&=-3}d&4096&&(s.flags&=-4097)}function Ug(s){if(s.subtreeFlags&1024)for(s=s.child;s!==null;){var d=s;Ug(d),d.tag===5&&d.flags&1024&&d.stateNode.reset(),s=s.sibling}}function Zc(s,d){if(d.subtreeFlags&8772)for(d=d.child;d!==null;)af(s,d.alternate,d),d=d.sibling}function vd(s){for(s=s.child;s!==null;){var d=s;switch(d.tag){case 0:case 11:case 14:case 15:Ah(4,d,d.return),vd(d);break;case 1:oc(d,d.return);var y=d.stateNode;typeof y.componentWillUnmount=="function"&&Uy(d,d.return,y),vd(d);break;case 27:Pd(d.stateNode);case 26:case 5:oc(d,d.return),vd(d);break;case 22:d.memoizedState===null&&vd(d);break;case 30:vd(d);break;default:vd(d)}s=s.sibling}}function Ih(s,d,y){for(y=y&&(d.subtreeFlags&8772)!==0,d=d.child;d!==null;){var S=d.alternate,D=s,B=d,ne=B.flags;switch(B.tag){case 0:case 11:case 15:Ih(D,B,y),ap(4,B);break;case 1:if(Ih(D,B,y),S=B,D=S.stateNode,typeof D.componentDidMount=="function")try{D.componentDidMount()}catch(ht){vr(S,S.return,ht)}if(S=B,D=S.updateQueue,D!==null){var he=S.stateNode;try{var Be=D.shared.hiddenCallbacks;if(Be!==null)for(D.shared.hiddenCallbacks=null,D=0;D<Be.length;D++)Kf(Be[D],he)}catch(ht){vr(S,S.return,ht)}}y&&ne&64&&Vy(B),sp(B,B.return);break;case 27:yd(B);case 26:case 5:Ih(D,B,y),y&&S===null&&ne&4&&bm(B),sp(B,B.return);break;case 12:Ih(D,B,y);break;case 13:Ih(D,B,y),y&&ne&4&&qy(D,B);break;case 22:B.memoizedState===null&&Ih(D,B,y),sp(B,B.return);break;case 30:break;default:Ih(D,B,y)}d=d.sibling}}function jg(s,d){var y=null;s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(y=s.memoizedState.cachePool.pool),s=null,d.memoizedState!==null&&d.memoizedState.cachePool!==null&&(s=d.memoizedState.cachePool.pool),s!==y&&(s!=null&&s.refCount++,y!=null&&zc(y))}function qg(s,d){s=null,d.alternate!==null&&(s=d.alternate.memoizedState.cache),d=d.memoizedState.cache,d!==s&&(d.refCount++,s!=null&&zc(s))}function uc(s,d,y,S){if(d.subtreeFlags&10256)for(d=d.child;d!==null;)bd(s,d,y,S),d=d.sibling}function bd(s,d,y,S){var D=d.flags;switch(d.tag){case 0:case 11:case 15:uc(s,d,y,S),D&2048&&ap(9,d);break;case 1:uc(s,d,y,S);break;case 3:uc(s,d,y,S),D&2048&&(s=null,d.alternate!==null&&(s=d.alternate.memoizedState.cache),d=d.memoizedState.cache,d!==s&&(d.refCount++,s!=null&&zc(s)));break;case 12:if(D&2048){uc(s,d,y,S),s=d.stateNode;try{var B=d.memoizedProps,ne=B.id,he=B.onPostCommit;typeof he=="function"&&he(ne,d.alternate===null?"mount":"update",s.passiveEffectDuration,-0)}catch(Be){vr(d,d.return,Be)}}else uc(s,d,y,S);break;case 13:uc(s,d,y,S);break;case 23:break;case 22:B=d.stateNode,ne=d.alternate,d.memoizedState!==null?B._visibility&2?uc(s,d,y,S):op(s,d):B._visibility&2?uc(s,d,y,S):(B._visibility|=2,lf(s,d,y,S,(d.subtreeFlags&10256)!==0)),D&2048&&jg(ne,d);break;case 24:uc(s,d,y,S),D&2048&&qg(d.alternate,d);break;default:uc(s,d,y,S)}}function lf(s,d,y,S,D){for(D=D&&(d.subtreeFlags&10256)!==0,d=d.child;d!==null;){var B=s,ne=d,he=y,Be=S,ht=ne.flags;switch(ne.tag){case 0:case 11:case 15:lf(B,ne,he,Be,D),ap(8,ne);break;case 23:break;case 22:var St=ne.stateNode;ne.memoizedState!==null?St._visibility&2?lf(B,ne,he,Be,D):op(B,ne):(St._visibility|=2,lf(B,ne,he,Be,D)),D&&ht&2048&&jg(ne.alternate,ne);break;case 24:lf(B,ne,he,Be,D),D&&ht&2048&&qg(ne.alternate,ne);break;default:lf(B,ne,he,Be,D)}d=d.sibling}}function op(s,d){if(d.subtreeFlags&10256)for(d=d.child;d!==null;){var y=s,S=d,D=S.flags;switch(S.tag){case 22:op(y,S),D&2048&&jg(S.alternate,S);break;case 24:op(y,S),D&2048&&qg(S.alternate,S);break;default:op(y,S)}d=d.sibling}}var uf=8192;function cf(s){if(s.subtreeFlags&uf)for(s=s.child;s!==null;)$g(s),s=s.sibling}function $g(s){switch(s.tag){case 26:cf(s),s.flags&uf&&s.memoizedState!==null&&J(au,s.memoizedState,s.memoizedProps);break;case 5:cf(s);break;case 3:case 4:var d=au;au=vf(s.stateNode.containerInfo),cf(s),au=d;break;case 22:s.memoizedState===null&&(d=s.alternate,d!==null&&d.memoizedState!==null?(d=uf,uf=16777216,cf(s),uf=d):cf(s));break;default:cf(s)}}function Gy(s){var d=s.alternate;if(d!==null&&(s=d.child,s!==null)){d.child=null;do d=s.sibling,s.sibling=null,s=d;while(s!==null)}}function xd(s){var d=s.deletions;if((s.flags&16)!==0){if(d!==null)for(var y=0;y<d.length;y++){var S=d[y];as=S,Zy(S,s)}Gy(s)}if(s.subtreeFlags&10256)for(s=s.child;s!==null;)hf(s),s=s.sibling}function hf(s){switch(s.tag){case 0:case 11:case 15:xd(s),s.flags&2048&&Ah(9,s,s.return);break;case 3:xd(s);break;case 12:xd(s);break;case 22:var d=s.stateNode;s.memoizedState!==null&&d._visibility&2&&(s.return===null||s.return.tag!==13)?(d._visibility&=-3,df(s)):xd(s);break;default:xd(s)}}function df(s){var d=s.deletions;if((s.flags&16)!==0){if(d!==null)for(var y=0;y<d.length;y++){var S=d[y];as=S,Zy(S,s)}Gy(s)}for(s=s.child;s!==null;){switch(d=s,d.tag){case 0:case 11:case 15:Ah(8,d,d.return),df(d);break;case 22:y=d.stateNode,y._visibility&2&&(y._visibility&=-3,df(d));break;default:df(d)}s=s.sibling}}function Zy(s,d){for(;as!==null;){var y=as;switch(y.tag){case 0:case 11:case 15:Ah(8,y,d);break;case 23:case 22:if(y.memoizedState!==null&&y.memoizedState.cachePool!==null){var S=y.memoizedState.cachePool.pool;S!=null&&S.refCount++}break;case 24:zc(y.memoizedState.cache)}if(S=y.child,S!==null)S.return=y,as=S;else e:for(y=s;as!==null;){S=as;var D=S.sibling,B=S.return;if(xm(S),S===y){as=null;break e}if(D!==null){D.return=B,as=D;break e}as=B}}}var bb={getCacheForType:function(s){var d=_r(ya),y=d.data.get(s);return y===void 0&&(y=s(),d.data.set(s,y)),y}},Hy=typeof WeakMap=="function"?WeakMap:Map,ar=0,jr=null,vi=null,mi=0,sr=0,Vl=null,Ch=!1,ff=!1,Gg=!1,Hc=0,ca=0,cc=0,Ph=0,wm=0,Ul=0,pf=0,Mh=null,fl=null,Tm=!1,Zg=0,Sm=1/0,Em=null,Wc=null,oo=0,Rh=null,hc=null,Hr=0,lp=0,Am=null,Hg=null,wd=0,kh=null;function pl(){if((ar&2)!==0&&mi!==0)return mi&-mi;if(gt.T!==null){var s=Ra;return s!==0?s:mp()}return Xi()}function Wy(){Ul===0&&(Ul=(mi&536870912)===0||Zn?At():536870912);var s=Oo.current;return s!==null&&(s.flags|=32),Ul}function jl(s,d,y){(s===jr&&(sr===2||sr===9)||s.cancelPendingCommit!==null)&&(mf(s,0),Lh(s,mi,Ul,!1)),qe(s,y),((ar&2)===0||s!==jr)&&(s===jr&&((ar&2)===0&&(Ph|=y),ca===4&&Lh(s,mi,Ul,!1)),ql(s))}function Xy(s,d,y){if((ar&6)!==0)throw Error(a(327));var S=!y&&(d&124)===0&&(d&s.expiredLanes)===0||Ze(s,d),D=S?Dh(s,d):up(s,d,!0),B=S;do{if(D===0){ff&&!S&&Lh(s,d,0,!1);break}else{if(y=s.current.alternate,B&&!xb(y)){D=up(s,d,!1),B=!1;continue}if(D===2){if(B=d,s.errorRecoveryDisabledLanes&B)var ne=0;else ne=s.pendingLanes&-536870913,ne=ne!==0?ne:ne&536870912?536870912:0;if(ne!==0){d=ne;e:{var he=s;D=Mh;var Be=he.current.memoizedState.isDehydrated;if(Be&&(mf(he,ne).flags|=256),ne=up(he,ne,!1),ne!==2){if(Gg&&!Be){he.errorRecoveryDisabledLanes|=B,Ph|=B,D=4;break e}B=fl,fl=D,B!==null&&(fl===null?fl=B:fl.push.apply(fl,B))}D=ne}if(B=!1,D!==2)continue}}if(D===1){mf(s,0),Lh(s,d,0,!0);break}e:{switch(S=s,B=D,B){case 0:case 1:throw Error(a(345));case 4:if((d&4194048)!==d)break;case 6:Lh(S,d,Ul,!Ch);break e;case 2:fl=null;break;case 3:case 5:break;default:throw Error(a(329))}if((d&62914560)===d&&(D=Zg+300-Nr(),10<D)){if(Lh(S,d,Ul,!Ch),Je(S,0,!0)!==0)break e;S.timeoutHandle=l_(Ky.bind(null,S,y,fl,Em,Tm,d,Ul,Ph,pf,Ch,B,2,-0,0),D);break e}Ky(S,y,fl,Em,Tm,d,Ul,Ph,pf,Ch,B,0,-0,0)}}break}while(!0);ql(s)}function Ky(s,d,y,S,D,B,ne,he,Be,ht,St,Mt,ft,vt){if(s.timeoutHandle=-1,Mt=d.subtreeFlags,(Mt&8192||(Mt&16785408)===16785408)&&(q={stylesheets:null,count:0,unsuspend:H},$g(d),Mt=ie(),Mt!==null)){s.cancelPendingCommit=Mt(Xg.bind(null,s,d,B,y,S,D,ne,he,Be,St,1,ft,vt)),Lh(s,B,ne,!ht);return}Xg(s,d,B,y,S,D,ne,he,Be)}function xb(s){for(var d=s;;){var y=d.tag;if((y===0||y===11||y===15)&&d.flags&16384&&(y=d.updateQueue,y!==null&&(y=y.stores,y!==null)))for(var S=0;S<y.length;S++){var D=y[S],B=D.getSnapshot;D=D.value;try{if(!ns(B(),D))return!1}catch{return!1}}if(y=d.child,d.subtreeFlags&16384&&y!==null)y.return=d,d=y;else{if(d===s)break;for(;d.sibling===null;){if(d.return===null||d.return===s)return!0;d=d.return}d.sibling.return=d.return,d=d.sibling}}return!0}function Lh(s,d,y,S){d&=~wm,d&=~Ph,s.suspendedLanes|=d,s.pingedLanes&=~d,S&&(s.warmLanes|=d),S=s.expirationTimes;for(var D=d;0<D;){var B=31-je(D),ne=1<<B;S[B]=-1,D&=~ne}y!==0&&Fn(s,y,d)}function Im(){return(ar&6)===0?(Ed(0),!1):!0}function Wg(){if(vi!==null){if(sr===0)var s=vi.return;else s=vi,To=qa=null,tc(s),kr=null,Zr=0,s=vi;for(;s!==null;)Fy(s.alternate,s),s=s.return;vi=null}}function mf(s,d){var y=s.timeoutHandle;y!==-1&&(s.timeoutHandle=-1,pv(y)),y=s.cancelPendingCommit,y!==null&&(s.cancelPendingCommit=null,y()),Wg(),jr=s,vi=y=Pa(s.current,null),mi=d,sr=0,Vl=null,Ch=!1,ff=Ze(s,d),Gg=!1,pf=Ul=wm=Ph=cc=ca=0,fl=Mh=null,Tm=!1,(d&8)!==0&&(d|=d&32);var S=s.entangledLanes;if(S!==0)for(s=s.entanglements,S&=d;0<S;){var D=31-je(S),B=1<<D;d|=s[D],S&=~B}return Hc=d,tu(),y}function Yy(s,d){ii=null,gt.H=rs,d===yu||d===Kt?(d=ld(),sr=3):d===sl?(d=ld(),sr=4):sr=d===tp?8:d!==null&&typeof d=="object"&&typeof d.then=="function"?6:1,Vl=d,vi===null&&(ca=1,ef(s,ua(d,s.current)))}function Qy(){var s=gt.H;return gt.H=rs,s===null?rs:s}function Jy(){var s=gt.A;return gt.A=bb,s}function Cm(){ca=4,Ch||(mi&4194048)!==mi&&Oo.current!==null||(ff=!0),(cc&134217727)===0&&(Ph&134217727)===0||jr===null||Lh(jr,mi,Ul,!1)}function up(s,d,y){var S=ar;ar|=2;var D=Qy(),B=Jy();(jr!==s||mi!==d)&&(Em=null,mf(s,d)),d=!1;var ne=ca;e:do try{if(sr!==0&&vi!==null){var he=vi,Be=Vl;switch(sr){case 8:Wg(),ne=6;break e;case 3:case 2:case 9:case 6:Oo.current===null&&(d=!0);var ht=sr;if(sr=0,Vl=null,Xc(s,he,Be,ht),y&&ff){ne=0;break e}break;default:ht=sr,sr=0,Vl=null,Xc(s,he,Be,ht)}}ev(),ne=ca;break}catch(St){Yy(s,St)}while(!0);return d&&s.shellSuspendCounter++,To=qa=null,ar=S,gt.H=D,gt.A=B,vi===null&&(jr=null,mi=0,tu()),ne}function ev(){for(;vi!==null;)Td(vi)}function Dh(s,d){var y=ar;ar|=2;var S=Qy(),D=Jy();jr!==s||mi!==d?(Em=null,Sm=Nr()+500,mf(s,d)):ff=Ze(s,d);e:do try{if(sr!==0&&vi!==null){d=vi;var B=Vl;t:switch(sr){case 1:sr=0,Vl=null,Xc(s,d,B,1);break;case 2:case 9:if(od(B)){sr=0,Vl=null,hp(d);break}d=function(){sr!==2&&sr!==9||jr!==s||(sr=7),ql(s)},B.then(d,d);break e;case 3:sr=7;break e;case 4:sr=5;break e;case 7:od(B)?(sr=0,Vl=null,hp(d)):(sr=0,Vl=null,Xc(s,d,B,7));break;case 5:var ne=null;switch(vi.tag){case 26:ne=vi.memoizedState;case 5:case 27:var he=vi;if(!ne||F(ne)){sr=0,Vl=null;var Be=he.sibling;if(Be!==null)vi=Be;else{var ht=he.return;ht!==null?(vi=ht,Pm(ht)):vi=null}break t}}sr=0,Vl=null,Xc(s,d,B,5);break;case 6:sr=0,Vl=null,Xc(s,d,B,6);break;case 8:Wg(),ca=6;break e;default:throw Error(a(462))}}cp();break}catch(St){Yy(s,St)}while(!0);return To=qa=null,gt.H=S,gt.A=D,ar=y,vi!==null?0:(jr=null,mi=0,tu(),ca)}function cp(){for(;vi!==null&&!ds();)Td(vi)}function Td(s){var d=Ny(s.alternate,s,Hc);s.memoizedProps=s.pendingProps,d===null?Pm(s):vi=d}function hp(s){var d=s,y=d.alternate;switch(d.tag){case 15:case 0:d=pm(y,d,d.pendingProps,d.type,void 0,mi);break;case 11:d=pm(y,d,d.pendingProps,d.type.render,d.ref,mi);break;case 5:tc(d);default:Fy(y,d),d=vi=fh(d,Hc),d=Ny(y,d,Hc)}s.memoizedProps=s.pendingProps,d===null?Pm(s):vi=d}function Xc(s,d,y,S){To=qa=null,tc(d),kr=null,Zr=0;var D=d.return;try{if(ep(s,D,d,y,mi)){ca=1,ef(s,ua(y,s.current)),vi=null;return}}catch(B){if(D!==null)throw vi=D,B;ca=1,ef(s,ua(y,s.current)),vi=null;return}d.flags&32768?(Zn||S===1?s=!0:ff||(mi&536870912)!==0?s=!1:(Ch=s=!0,(S===2||S===9||S===3||S===6)&&(S=Oo.current,S!==null&&S.tag===13&&(S.flags|=16384))),tv(d,s)):Pm(d)}function Pm(s){var d=s;do{if((d.flags&32768)!==0){tv(d,Ch);return}s=d.return;var y=gd(d.alternate,d,Hc);if(y!==null){vi=y;return}if(d=d.sibling,d!==null){vi=d;return}vi=d=s}while(d!==null);ca===0&&(ca=5)}function tv(s,d){do{var y=rp(s.alternate,s);if(y!==null){y.flags&=32767,vi=y;return}if(y=s.return,y!==null&&(y.flags|=32768,y.subtreeFlags=0,y.deletions=null),!d&&(s=s.sibling,s!==null)){vi=s;return}vi=s=y}while(s!==null);ca=6,vi=null}function Xg(s,d,y,S,D,B,ne,he,Be){s.cancelPendingCommit=null;do gf();while(oo!==0);if((ar&6)!==0)throw Error(a(327));if(d!==null){if(d===s.current)throw Error(a(177));if(B=d.lanes|d.childLanes,B|=is,Cn(s,y,B,ne,he,Be),s===jr&&(vi=jr=null,mi=0),hc=d,Rh=s,Hr=y,lp=B,Am=D,Hg=S,(d.subtreeFlags&10256)!==0||(d.flags&10256)!==0?(s.callbackNode=null,s.callbackPriority=0,av(fa,function(){return Mm(),null})):(s.callbackNode=null,s.callbackPriority=0),S=(d.flags&13878)!==0,(d.subtreeFlags&13878)!==0||S){S=gt.T,gt.T=null,D=Zt.p,Zt.p=2,ne=ar,ar|=4;try{jy(s,d,y)}finally{ar=ne,Zt.p=D,gt.T=S}}oo=1,Kg(),nv(),Yg()}}function Kg(){if(oo===1){oo=0;var s=Rh,d=hc,y=(d.flags&13878)!==0;if((d.subtreeFlags&13878)!==0||y){y=gt.T,gt.T=null;var S=Zt.p;Zt.p=2;var D=ar;ar|=4;try{of(d,s);var B=Nm,ne=mu(s.containerInfo),he=B.focusedElem,Be=B.selectionRange;if(ne!==he&&he&&he.ownerDocument&&oi(he.ownerDocument.documentElement,he)){if(Be!==null&&gu(he)){var ht=Be.start,St=Be.end;if(St===void 0&&(St=ht),"selectionStart"in he)he.selectionStart=ht,he.selectionEnd=Math.min(St,he.value.length);else{var Mt=he.ownerDocument||document,ft=Mt&&Mt.defaultView||window;if(ft.getSelection){var vt=ft.getSelection(),Wn=he.textContent.length,jn=Math.min(Be.start,Wn),xr=Be.end===void 0?jn:Math.min(Be.end,Wn);!vt.extend&&jn>xr&&(ne=xr,xr=jn,jn=ne);var tt=Do(he,jn),Ye=Do(he,xr);if(tt&&Ye&&(vt.rangeCount!==1||vt.anchorNode!==tt.node||vt.anchorOffset!==tt.offset||vt.focusNode!==Ye.node||vt.focusOffset!==Ye.offset)){var ut=Mt.createRange();ut.setStart(tt.node,tt.offset),vt.removeAllRanges(),jn>xr?(vt.addRange(ut),vt.extend(Ye.node,Ye.offset)):(ut.setEnd(Ye.node,Ye.offset),vt.addRange(ut))}}}}for(Mt=[],vt=he;vt=vt.parentNode;)vt.nodeType===1&&Mt.push({element:vt,left:vt.scrollLeft,top:vt.scrollTop});for(typeof he.focus=="function"&&he.focus(),he=0;he<Mt.length;he++){var Pt=Mt[he];Pt.element.scrollLeft=Pt.left,Pt.element.scrollTop=Pt.top}}Ut=!!Om,Nm=Om=null}finally{ar=D,Zt.p=S,gt.T=y}}s.current=d,oo=2}}function nv(){if(oo===2){oo=0;var s=Rh,d=hc,y=(d.flags&8772)!==0;if((d.subtreeFlags&8772)!==0||y){y=gt.T,gt.T=null;var S=Zt.p;Zt.p=2;var D=ar;ar|=4;try{af(s,d.alternate,d)}finally{ar=D,Zt.p=S,gt.T=y}}oo=3}}function Yg(){if(oo===4||oo===3){oo=0,Xa();var s=Rh,d=hc,y=Hr,S=Hg;(d.subtreeFlags&10256)!==0||(d.flags&10256)!==0?oo=5:(oo=0,hc=Rh=null,Qg(s,s.pendingLanes));var D=s.pendingLanes;if(D===0&&(Wc=null),wi(y),d=d.stateNode,pr&&typeof pr.onCommitFiberRoot=="function")try{pr.onCommitFiberRoot(Ta,d,void 0,(d.current.flags&128)===128)}catch{}if(S!==null){d=gt.T,D=Zt.p,Zt.p=2,gt.T=null;try{for(var B=s.onRecoverableError,ne=0;ne<S.length;ne++){var he=S[ne];B(he.value,{componentStack:he.stack})}}finally{gt.T=d,Zt.p=D}}(Hr&3)!==0&&gf(),ql(s),D=s.pendingLanes,(y&4194090)!==0&&(D&42)!==0?s===kh?wd++:(wd=0,kh=s):wd=0,Ed(0)}}function Qg(s,d){(s.pooledCacheLanes&=d)===0&&(d=s.pooledCache,d!=null&&(s.pooledCache=null,zc(d)))}function gf(s){return Kg(),nv(),Yg(),Mm()}function Mm(){if(oo!==5)return!1;var s=Rh,d=lp;lp=0;var y=wi(Hr),S=gt.T,D=Zt.p;try{Zt.p=32>y?32:y,gt.T=null,y=Am,Am=null;var B=Rh,ne=Hr;if(oo=0,hc=Rh=null,Hr=0,(ar&6)!==0)throw Error(a(331));var he=ar;if(ar|=4,hf(B.current),bd(B,B.current,ne,y),ar=he,Ed(0,!1),pr&&typeof pr.onPostCommitFiberRoot=="function")try{pr.onPostCommitFiberRoot(Ta,B)}catch{}return!0}finally{Zt.p=D,gt.T=S,Qg(s,d)}}function iv(s,d,y){d=ua(y,d),d=fm(s.stateNode,d,2),s=vu(s,d,2),s!==null&&(qe(s,2),ql(s))}function vr(s,d,y){if(s.tag===3)iv(s,s,y);else for(;d!==null;){if(d.tag===3){iv(d,s,y);break}else if(d.tag===1){var S=d.stateNode;if(typeof d.type.getDerivedStateFromError=="function"||typeof S.componentDidCatch=="function"&&(Wc===null||!Wc.has(S))){s=ua(y,s),y=fd(2),S=vu(d,y,2),S!==null&&(Ry(y,S,d,s),qe(S,2),ql(S));break}}d=d.return}}function Jg(s,d,y){var S=s.pingCache;if(S===null){S=s.pingCache=new Hy;var D=new Set;S.set(d,D)}else D=S.get(d),D===void 0&&(D=new Set,S.set(d,D));D.has(y)||(Gg=!0,D.add(y),s=wb.bind(null,s,d,y),d.then(s,s))}function wb(s,d,y){var S=s.pingCache;S!==null&&S.delete(d),s.pingedLanes|=s.suspendedLanes&y,s.warmLanes&=~y,jr===s&&(mi&y)===y&&(ca===4||ca===3&&(mi&62914560)===mi&&300>Nr()-Zg?(ar&2)===0&&mf(s,0):wm|=y,pf===mi&&(pf=0)),ql(s)}function rv(s,d){d===0&&(d=bt()),s=Js(s,d),s!==null&&(qe(s,d),ql(s))}function Tb(s){var d=s.memoizedState,y=0;d!==null&&(y=d.retryLane),rv(s,y)}function Sb(s,d){var y=0;switch(s.tag){case 13:var S=s.stateNode,D=s.memoizedState;D!==null&&(y=D.retryLane);break;case 19:S=s.stateNode;break;case 22:S=s.stateNode._retryCache;break;default:throw Error(a(314))}S!==null&&S.delete(d),rv(s,y)}function av(s,d){return Pi(s,d)}var dp=null,ml=null,dc=!1,fp=!1,pp=!1,Sd=0;function ql(s){s!==ml&&s.next===null&&(ml===null?dp=ml=s:ml=ml.next=s),fp=!0,dc||(dc=!0,sv())}function Ed(s,d){if(!pp&&fp){pp=!0;do for(var y=!1,S=dp;S!==null;){if(s!==0){var D=S.pendingLanes;if(D===0)var B=0;else{var ne=S.suspendedLanes,he=S.pingedLanes;B=(1<<31-je(42|s)+1)-1,B&=D&~(ne&~he),B=B&201326741?B&201326741|1:B?B|2:0}B!==0&&(y=!0,e_(S,B))}else B=mi,B=Je(S,S===jr?B:0,S.cancelPendingCommit!==null||S.timeoutHandle!==-1),(B&3)===0||Ze(S,B)||(y=!0,e_(S,B));S=S.next}while(y);pp=!1}}function Eb(){Rm()}function Rm(){fp=dc=!1;var s=0;Sd!==0&&(fv()&&(s=Sd),Sd=0);for(var d=Nr(),y=null,S=dp;S!==null;){var D=S.next,B=km(S,d);B===0?(S.next=null,y===null?dp=D:y.next=D,D===null&&(ml=y)):(y=S,(s!==0||(B&3)!==0)&&(fp=!0)),S=D}Ed(s)}function km(s,d){for(var y=s.suspendedLanes,S=s.pingedLanes,D=s.expirationTimes,B=s.pendingLanes&-62914561;0<B;){var ne=31-je(B),he=1<<ne,Be=D[ne];Be===-1?((he&y)===0||(he&S)!==0)&&(D[ne]=yt(he,d)):Be<=d&&(s.expiredLanes|=he),B&=~he}if(d=jr,y=mi,y=Je(s,s===d?y:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),S=s.callbackNode,y===0||s===d&&(sr===2||sr===9)||s.cancelPendingCommit!==null)return S!==null&&S!==null&&er(S),s.callbackNode=null,s.callbackPriority=0;if((y&3)===0||Ze(s,y)){if(d=y&-y,d===s.callbackPriority)return d;switch(S!==null&&er(S),wi(y)){case 2:case 8:y=fr;break;case 32:y=fa;break;case 268435456:y=js;break;default:y=fa}return S=Ad.bind(null,s),y=Pi(y,S),s.callbackPriority=d,s.callbackNode=y,d}return S!==null&&S!==null&&er(S),s.callbackPriority=2,s.callbackNode=null,2}function Ad(s,d){if(oo!==0&&oo!==5)return s.callbackNode=null,s.callbackPriority=0,null;var y=s.callbackNode;if(gf()&&s.callbackNode!==y)return null;var S=mi;return S=Je(s,s===jr?S:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),S===0?null:(Xy(s,S,d),km(s,Nr()),s.callbackNode!=null&&s.callbackNode===y?Ad.bind(null,s):null)}function e_(s,d){if(gf())return null;Xy(s,d,!0)}function sv(){Cb(function(){(ar&6)!==0?Pi(Fi,Eb):Rm()})}function mp(){return Sd===0&&(Sd=At()),Sd}function t_(s){return s==null||typeof s=="symbol"||typeof s=="boolean"?null:typeof s=="function"?s:Mn(""+s)}function gp(s,d){var y=d.ownerDocument.createElement("input");return y.name=d.name,y.value=d.value,s.id&&y.setAttribute("form",s.id),d.parentNode.insertBefore(y,d),s=new FormData(s),y.parentNode.removeChild(y),s}function ov(s,d,y,S,D){if(d==="submit"&&y&&y.stateNode===D){var B=t_((D[Pn]||null).action),ne=S.submitter;ne&&(d=(d=ne[Pn]||null)?t_(d.formAction):ne.getAttribute("formAction"),d!==null&&(B=d,ne=null));var he=new Ia("action","action",null,S,D);s.push({event:he,listeners:[{instance:null,listener:function(){if(S.defaultPrevented){if(Sd!==0){var Be=ne?gp(D,ne):new FormData(D);Rr(y,{pending:!0,data:Be,method:D.method,action:B},null,Be)}}else typeof B=="function"&&(he.preventDefault(),Be=ne?gp(D,ne):new FormData(D),Rr(y,{pending:!0,data:Be,method:D.method,action:B},B,Be))},currentTarget:D}]})}}for(var n_=0;n_<eu.length;n_++){var i_=eu[n_],lv=i_.toLowerCase(),Ab=i_[0].toUpperCase()+i_.slice(1);bo(lv,"on"+Ab)}bo(Pc,"onAnimationEnd"),bo(Cs,"onAnimationIteration"),bo(Ql,"onAnimationStart"),bo("dblclick","onDoubleClick"),bo("focusin","onFocus"),bo("focusout","onBlur"),bo(id,"onTransitionRun"),bo(el,"onTransitionStart"),bo(Mc,"onTransitionCancel"),bo(Jl,"onTransitionEnd"),ms("onMouseEnter",["mouseout","mouseover"]),ms("onMouseLeave",["mouseout","mouseover"]),ms("onPointerEnter",["pointerout","pointerover"]),ms("onPointerLeave",["pointerout","pointerover"]),Sa("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Sa("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Sa("onBeforeInput",["compositionend","keypress","textInput","paste"]),Sa("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Sa("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Sa("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var _p="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Ib=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(_p));function uv(s,d){d=(d&4)!==0;for(var y=0;y<s.length;y++){var S=s[y],D=S.event;S=S.listeners;e:{var B=void 0;if(d)for(var ne=S.length-1;0<=ne;ne--){var he=S[ne],Be=he.instance,ht=he.currentTarget;if(he=he.listener,Be!==B&&D.isPropagationStopped())break e;B=he,D.currentTarget=ht;try{B(D)}catch(St){Jf(St)}D.currentTarget=null,B=Be}else for(ne=0;ne<S.length;ne++){if(he=S[ne],Be=he.instance,ht=he.currentTarget,he=he.listener,Be!==B&&D.isPropagationStopped())break e;B=he,D.currentTarget=ht;try{B(D)}catch(St){Jf(St)}D.currentTarget=null,B=Be}}}}function bi(s,d){var y=d[Ct];y===void 0&&(y=d[Ct]=new Set);var S=s+"__bubble";y.has(S)||(r_(d,s,2,!1),y.add(S))}function yp(s,d,y){var S=0;d&&(S|=4),r_(y,s,S,d)}var Pu="_reactListening"+Math.random().toString(36).slice(2);function Lm(s){if(!s[Pu]){s[Pu]=!0,Vn.forEach(function(y){y!=="selectionchange"&&(Ib.has(y)||yp(y,!1,s),yp(y,!0,s))});var d=s.nodeType===9?s:s.ownerDocument;d===null||d[Pu]||(d[Pu]=!0,yp("selectionchange",!1,d))}}function r_(s,d,y,S){switch(xn(d)){case 2:var D=hn;break;case 8:D=Gt;break;default:D=qt}y=D.bind(null,d,y,s),D=void 0,!or||d!=="touchstart"&&d!=="touchmove"&&d!=="wheel"||(D=!0),S?D!==void 0?s.addEventListener(d,y,{capture:!0,passive:D}):s.addEventListener(d,y,!0):D!==void 0?s.addEventListener(d,y,{passive:D}):s.addEventListener(d,y,!1)}function Dm(s,d,y,S,D){var B=S;if((d&1)===0&&(d&2)===0&&S!==null)e:for(;;){if(S===null)return;var ne=S.tag;if(ne===3||ne===4){var he=S.stateNode.containerInfo;if(he===D)break;if(ne===4)for(ne=S.return;ne!==null;){var Be=ne.tag;if((Be===3||Be===4)&&ne.stateNode.containerInfo===D)return;ne=ne.return}for(;he!==null;){if(ne=Rn(he),ne===null)return;if(Be=ne.tag,Be===5||Be===6||Be===26||Be===27){S=B=ne;continue e}he=he.parentNode}}S=S.return}hi(function(){var ht=B,St=Mo(y),Mt=[];e:{var ft=Qs.get(s);if(ft!==void 0){var vt=Ia,Wn=s;switch(s){case"keypress":if(sn(y)===0)break e;case"keydown":case"keyup":vt=Yo;break;case"focusin":Wn="focus",vt=Wo;break;case"focusout":Wn="blur",vt=Wo;break;case"beforeblur":case"afterblur":vt=Wo;break;case"click":if(y.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":vt=xs;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":vt=Gr;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":vt=Wl;break;case Pc:case Cs:case Ql:vt=nr;break;case Jl:vt=G;break;case"scroll":case"scrollend":vt=Sl;break;case"wheel":vt=ye;break;case"copy":case"cut":case"paste":vt=Xo;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":vt=hu;break;case"toggle":case"beforetoggle":vt=pt}var jn=(d&4)!==0,xr=!jn&&(s==="scroll"||s==="scrollend"),tt=jn?ft!==null?ft+"Capture":null:ft;jn=[];for(var Ye=ht,ut;Ye!==null;){var Pt=Ye;if(ut=Pt.stateNode,Pt=Pt.tag,Pt!==5&&Pt!==26&&Pt!==27||ut===null||tt===null||(Pt=bn(Ye,tt),Pt!=null&&jn.push(_f(Ye,Pt,ut))),xr)break;Ye=Ye.return}0<jn.length&&(ft=new vt(ft,Wn,null,y,St),Mt.push({event:ft,listeners:jn}))}}if((d&7)===0){e:{if(ft=s==="mouseover"||s==="pointerover",vt=s==="mouseout"||s==="pointerout",ft&&y!==Zs&&(Wn=y.relatedTarget||y.fromElement)&&(Rn(Wn)||Wn[Vi]))break e;if((vt||ft)&&(ft=St.window===St?St:(ft=St.ownerDocument)?ft.defaultView||ft.parentWindow:window,vt?(Wn=y.relatedTarget||y.toElement,vt=ht,Wn=Wn?Rn(Wn):null,Wn!==null&&(xr=m(Wn),jn=Wn.tag,Wn!==xr||jn!==5&&jn!==27&&jn!==6)&&(Wn=null)):(vt=null,Wn=ht),vt!==Wn)){if(jn=xs,Pt="onMouseLeave",tt="onMouseEnter",Ye="mouse",(s==="pointerout"||s==="pointerover")&&(jn=hu,Pt="onPointerLeave",tt="onPointerEnter",Ye="pointer"),xr=vt==null?ft:zi(vt),ut=Wn==null?ft:zi(Wn),ft=new jn(Pt,Ye+"leave",vt,y,St),ft.target=xr,ft.relatedTarget=ut,Pt=null,Rn(St)===ht&&(jn=new jn(tt,Ye+"enter",Wn,y,St),jn.target=ut,jn.relatedTarget=xr,Pt=jn),xr=Pt,vt&&Wn)t:{for(jn=vt,tt=Wn,Ye=0,ut=jn;ut;ut=zh(ut))Ye++;for(ut=0,Pt=tt;Pt;Pt=zh(Pt))ut++;for(;0<Ye-ut;)jn=zh(jn),Ye--;for(;0<ut-Ye;)tt=zh(tt),ut--;for(;Ye--;){if(jn===tt||tt!==null&&jn===tt.alternate)break t;jn=zh(jn),tt=zh(tt)}jn=null}else jn=null;vt!==null&&a_(Mt,ft,vt,jn,!1),Wn!==null&&xr!==null&&a_(Mt,xr,Wn,jn,!0)}}e:{if(ft=ht?zi(ht):window,vt=ft.nodeName&&ft.nodeName.toLowerCase(),vt==="select"||vt==="input"&&ft.type==="file")var wn=pu;else if(fu(ft))if(Il)wn=Zd;else{wn=Zf;var gi=hh}else vt=ft.nodeName,!vt||vt.toLowerCase()!=="input"||ft.type!=="checkbox"&&ft.type!=="radio"?ht&&Ja(ht.elementType)&&(wn=pu):wn=Qo;if(wn&&(wn=wn(s,ht))){nd(Mt,wn,y,St);break e}gi&&gi(s,ft,ht),s==="focusout"&&ht&&ft.type==="number"&&ht.memoizedProps.value!=null&&Ho(ft,"number",ft.value)}switch(gi=ht?zi(ht):window,s){case"focusin":(fu(gi)||gi.contentEditable==="true")&&(Ys=gi,vo=ht,Cl=null);break;case"focusout":Cl=vo=Ys=null;break;case"mousedown":dh=!0;break;case"contextmenu":case"mouseup":case"dragend":dh=!1,Hd(Mt,y,St);break;case"selectionchange":if(Ic)break;case"keydown":case"keyup":Hd(Mt,y,St)}var dn;if(kn)e:{switch(s){case"compositionstart":var zn="onCompositionStart";break e;case"compositionend":zn="onCompositionEnd";break e;case"compositionupdate":zn="onCompositionUpdate";break e}zn=void 0}else Lo?Ws(s,y)&&(zn="onCompositionEnd"):s==="keydown"&&y.keyCode===229&&(zn="onCompositionStart");zn&&(ur&&y.locale!=="ko"&&(Lo||zn!=="onCompositionStart"?zn==="onCompositionEnd"&&Lo&&(dn=pn()):(Oi=St,Tn="value"in Oi?Oi.value:Oi.textContent,Lo=!0)),gi=vp(ht,zn),0<gi.length&&(zn=new Ss(zn,s,null,y,St),Mt.push({event:zn,listeners:gi}),dn?zn.data=dn:(dn=As(y),dn!==null&&(zn.data=dn)))),(dn=Ri?yo(s,y):Gd(s,y))&&(zn=vp(ht,"onBeforeInput"),0<zn.length&&(gi=new Ss("onBeforeInput","beforeinput",null,y,St),Mt.push({event:gi,listeners:zn}),gi.data=dn)),ov(Mt,s,ht,y,St)}uv(Mt,d)})}function _f(s,d,y){return{instance:s,listener:d,currentTarget:y}}function vp(s,d){for(var y=d+"Capture",S=[];s!==null;){var D=s,B=D.stateNode;if(D=D.tag,D!==5&&D!==26&&D!==27||B===null||(D=bn(s,y),D!=null&&S.unshift(_f(s,D,B)),D=bn(s,d),D!=null&&S.push(_f(s,D,B))),s.tag===3)return S;s=s.return}return[]}function zh(s){if(s===null)return null;do s=s.return;while(s&&s.tag!==5&&s.tag!==27);return s||null}function a_(s,d,y,S,D){for(var B=d._reactName,ne=[];y!==null&&y!==S;){var he=y,Be=he.alternate,ht=he.stateNode;if(he=he.tag,Be!==null&&Be===S)break;he!==5&&he!==26&&he!==27||ht===null||(Be=ht,D?(ht=bn(y,B),ht!=null&&ne.unshift(_f(y,ht,Be))):D||(ht=bn(y,B),ht!=null&&ne.push(_f(y,ht,Be)))),y=y.return}ne.length!==0&&s.push({event:d,listeners:ne})}var bp=/\r\n?/g,cv=/\u0000|\uFFFD/g;function zm(s){return(typeof s=="string"?s:""+s).replace(bp,`
`).replace(cv,"")}function s_(s,d){return d=zm(d),zm(s)===d}function Eo(){}function Bi(s,d,y,S,D,B){switch(y){case"children":typeof S=="string"?d==="body"||d==="textarea"&&S===""||Xr(s,S):(typeof S=="number"||typeof S=="bigint")&&d!=="body"&&Xr(s,""+S);break;case"className":fi(s,"class",S);break;case"tabIndex":fi(s,"tabindex",S);break;case"dir":case"role":case"viewBox":case"width":case"height":fi(s,y,S);break;case"style":Qa(s,S,B);break;case"data":if(d!=="object"){fi(s,"data",S);break}case"src":case"href":if(S===""&&(d!=="a"||y!=="href")){s.removeAttribute(y);break}if(S==null||typeof S=="function"||typeof S=="symbol"||typeof S=="boolean"){s.removeAttribute(y);break}S=Mn(""+S),s.setAttribute(y,S);break;case"action":case"formAction":if(typeof S=="function"){s.setAttribute(y,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof B=="function"&&(y==="formAction"?(d!=="input"&&Bi(s,d,"name",D.name,D,null),Bi(s,d,"formEncType",D.formEncType,D,null),Bi(s,d,"formMethod",D.formMethod,D,null),Bi(s,d,"formTarget",D.formTarget,D,null)):(Bi(s,d,"encType",D.encType,D,null),Bi(s,d,"method",D.method,D,null),Bi(s,d,"target",D.target,D,null)));if(S==null||typeof S=="symbol"||typeof S=="boolean"){s.removeAttribute(y);break}S=Mn(""+S),s.setAttribute(y,S);break;case"onClick":S!=null&&(s.onclick=Eo);break;case"onScroll":S!=null&&bi("scroll",s);break;case"onScrollEnd":S!=null&&bi("scrollend",s);break;case"dangerouslySetInnerHTML":if(S!=null){if(typeof S!="object"||!("__html"in S))throw Error(a(61));if(y=S.__html,y!=null){if(D.children!=null)throw Error(a(60));s.innerHTML=y}}break;case"multiple":s.multiple=S&&typeof S!="function"&&typeof S!="symbol";break;case"muted":s.muted=S&&typeof S!="function"&&typeof S!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(S==null||typeof S=="function"||typeof S=="boolean"||typeof S=="symbol"){s.removeAttribute("xlink:href");break}y=Mn(""+S),s.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",y);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":S!=null&&typeof S!="function"&&typeof S!="symbol"?s.setAttribute(y,""+S):s.removeAttribute(y);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":S&&typeof S!="function"&&typeof S!="symbol"?s.setAttribute(y,""):s.removeAttribute(y);break;case"capture":case"download":S===!0?s.setAttribute(y,""):S!==!1&&S!=null&&typeof S!="function"&&typeof S!="symbol"?s.setAttribute(y,S):s.removeAttribute(y);break;case"cols":case"rows":case"size":case"span":S!=null&&typeof S!="function"&&typeof S!="symbol"&&!isNaN(S)&&1<=S?s.setAttribute(y,S):s.removeAttribute(y);break;case"rowSpan":case"start":S==null||typeof S=="function"||typeof S=="symbol"||isNaN(S)?s.removeAttribute(y):s.setAttribute(y,S);break;case"popover":bi("beforetoggle",s),bi("toggle",s),Wr(s,"popover",S);break;case"xlinkActuate":qs(s,"http://www.w3.org/1999/xlink","xlink:actuate",S);break;case"xlinkArcrole":qs(s,"http://www.w3.org/1999/xlink","xlink:arcrole",S);break;case"xlinkRole":qs(s,"http://www.w3.org/1999/xlink","xlink:role",S);break;case"xlinkShow":qs(s,"http://www.w3.org/1999/xlink","xlink:show",S);break;case"xlinkTitle":qs(s,"http://www.w3.org/1999/xlink","xlink:title",S);break;case"xlinkType":qs(s,"http://www.w3.org/1999/xlink","xlink:type",S);break;case"xmlBase":qs(s,"http://www.w3.org/XML/1998/namespace","xml:base",S);break;case"xmlLang":qs(s,"http://www.w3.org/XML/1998/namespace","xml:lang",S);break;case"xmlSpace":qs(s,"http://www.w3.org/XML/1998/namespace","xml:space",S);break;case"is":Wr(s,"is",S);break;case"innerText":case"textContent":break;default:(!(2<y.length)||y[0]!=="o"&&y[0]!=="O"||y[1]!=="n"&&y[1]!=="N")&&(y=vs.get(y)||y,Wr(s,y,S))}}function Id(s,d,y,S,D,B){switch(y){case"style":Qa(s,S,B);break;case"dangerouslySetInnerHTML":if(S!=null){if(typeof S!="object"||!("__html"in S))throw Error(a(61));if(y=S.__html,y!=null){if(D.children!=null)throw Error(a(60));s.innerHTML=y}}break;case"children":typeof S=="string"?Xr(s,S):(typeof S=="number"||typeof S=="bigint")&&Xr(s,""+S);break;case"onScroll":S!=null&&bi("scroll",s);break;case"onScrollEnd":S!=null&&bi("scrollend",s);break;case"onClick":S!=null&&(s.onclick=Eo);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!$o.hasOwnProperty(y))e:{if(y[0]==="o"&&y[1]==="n"&&(D=y.endsWith("Capture"),d=y.slice(2,D?y.length-7:void 0),B=s[Pn]||null,B=B!=null?B[y]:null,typeof B=="function"&&s.removeEventListener(d,B,D),typeof S=="function")){typeof B!="function"&&B!==null&&(y in s?s[y]=null:s.hasAttribute(y)&&s.removeAttribute(y)),s.addEventListener(d,S,D);break e}y in s?s[y]=S:S===!0?s.setAttribute(y,""):Wr(s,y,S)}}}function ha(s,d,y){switch(d){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":bi("error",s),bi("load",s);var S=!1,D=!1,B;for(B in y)if(y.hasOwnProperty(B)){var ne=y[B];if(ne!=null)switch(B){case"src":S=!0;break;case"srcSet":D=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(a(137,d));default:Bi(s,d,B,ne,y,null)}}D&&Bi(s,d,"srcSet",y.srcSet,y,null),S&&Bi(s,d,"src",y.src,y,null);return;case"input":bi("invalid",s);var he=B=ne=D=null,Be=null,ht=null;for(S in y)if(y.hasOwnProperty(S)){var St=y[S];if(St!=null)switch(S){case"name":D=St;break;case"type":ne=St;break;case"checked":Be=St;break;case"defaultChecked":ht=St;break;case"value":B=St;break;case"defaultValue":he=St;break;case"children":case"dangerouslySetInnerHTML":if(St!=null)throw Error(a(137,d));break;default:Bi(s,d,S,St,y,null)}}Zo(s,B,he,Be,ht,ne,D,!1),Go(s);return;case"select":bi("invalid",s),S=ne=B=null;for(D in y)if(y.hasOwnProperty(D)&&(he=y[D],he!=null))switch(D){case"value":B=he;break;case"defaultValue":ne=he;break;case"multiple":S=he;default:Bi(s,d,D,he,y,null)}d=B,y=ne,s.multiple=!!S,d!=null?Va(s,!!S,d,!1):y!=null&&Va(s,!!S,y,!0);return;case"textarea":bi("invalid",s),B=D=S=null;for(ne in y)if(y.hasOwnProperty(ne)&&(he=y[ne],he!=null))switch(ne){case"value":S=he;break;case"defaultValue":D=he;break;case"children":B=he;break;case"dangerouslySetInnerHTML":if(he!=null)throw Error(a(91));break;default:Bi(s,d,ne,he,y,null)}Ya(s,S,D,B),Go(s);return;case"option":for(Be in y)if(y.hasOwnProperty(Be)&&(S=y[Be],S!=null))switch(Be){case"selected":s.selected=S&&typeof S!="function"&&typeof S!="symbol";break;default:Bi(s,d,Be,S,y,null)}return;case"dialog":bi("beforetoggle",s),bi("toggle",s),bi("cancel",s),bi("close",s);break;case"iframe":case"object":bi("load",s);break;case"video":case"audio":for(S=0;S<_p.length;S++)bi(_p[S],s);break;case"image":bi("error",s),bi("load",s);break;case"details":bi("toggle",s);break;case"embed":case"source":case"link":bi("error",s),bi("load",s);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(ht in y)if(y.hasOwnProperty(ht)&&(S=y[ht],S!=null))switch(ht){case"children":case"dangerouslySetInnerHTML":throw Error(a(137,d));default:Bi(s,d,ht,S,y,null)}return;default:if(Ja(d)){for(St in y)y.hasOwnProperty(St)&&(S=y[St],S!==void 0&&Id(s,d,St,S,y,void 0));return}}for(he in y)y.hasOwnProperty(he)&&(S=y[he],S!=null&&Bi(s,d,he,S,y,null))}function hv(s,d,y,S){switch(d){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var D=null,B=null,ne=null,he=null,Be=null,ht=null,St=null;for(vt in y){var Mt=y[vt];if(y.hasOwnProperty(vt)&&Mt!=null)switch(vt){case"checked":break;case"value":break;case"defaultValue":Be=Mt;default:S.hasOwnProperty(vt)||Bi(s,d,vt,null,S,Mt)}}for(var ft in S){var vt=S[ft];if(Mt=y[ft],S.hasOwnProperty(ft)&&(vt!=null||Mt!=null))switch(ft){case"type":B=vt;break;case"name":D=vt;break;case"checked":ht=vt;break;case"defaultChecked":St=vt;break;case"value":ne=vt;break;case"defaultValue":he=vt;break;case"children":case"dangerouslySetInnerHTML":if(vt!=null)throw Error(a(137,d));break;default:vt!==Mt&&Bi(s,d,ft,vt,S,Mt)}}ga(s,ne,he,Be,ht,St,B,D);return;case"select":vt=ne=he=ft=null;for(B in y)if(Be=y[B],y.hasOwnProperty(B)&&Be!=null)switch(B){case"value":break;case"multiple":vt=Be;default:S.hasOwnProperty(B)||Bi(s,d,B,null,S,Be)}for(D in S)if(B=S[D],Be=y[D],S.hasOwnProperty(D)&&(B!=null||Be!=null))switch(D){case"value":ft=B;break;case"defaultValue":he=B;break;case"multiple":ne=B;default:B!==Be&&Bi(s,d,D,B,S,Be)}d=he,y=ne,S=vt,ft!=null?Va(s,!!y,ft,!1):!!S!=!!y&&(d!=null?Va(s,!!y,d,!0):Va(s,!!y,y?[]:"",!1));return;case"textarea":vt=ft=null;for(he in y)if(D=y[he],y.hasOwnProperty(he)&&D!=null&&!S.hasOwnProperty(he))switch(he){case"value":break;case"children":break;default:Bi(s,d,he,null,S,D)}for(ne in S)if(D=S[ne],B=y[ne],S.hasOwnProperty(ne)&&(D!=null||B!=null))switch(ne){case"value":ft=D;break;case"defaultValue":vt=D;break;case"children":break;case"dangerouslySetInnerHTML":if(D!=null)throw Error(a(91));break;default:D!==B&&Bi(s,d,ne,D,S,B)}Ir(s,ft,vt);return;case"option":for(var Wn in y)if(ft=y[Wn],y.hasOwnProperty(Wn)&&ft!=null&&!S.hasOwnProperty(Wn))switch(Wn){case"selected":s.selected=!1;break;default:Bi(s,d,Wn,null,S,ft)}for(Be in S)if(ft=S[Be],vt=y[Be],S.hasOwnProperty(Be)&&ft!==vt&&(ft!=null||vt!=null))switch(Be){case"selected":s.selected=ft&&typeof ft!="function"&&typeof ft!="symbol";break;default:Bi(s,d,Be,ft,S,vt)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var jn in y)ft=y[jn],y.hasOwnProperty(jn)&&ft!=null&&!S.hasOwnProperty(jn)&&Bi(s,d,jn,null,S,ft);for(ht in S)if(ft=S[ht],vt=y[ht],S.hasOwnProperty(ht)&&ft!==vt&&(ft!=null||vt!=null))switch(ht){case"children":case"dangerouslySetInnerHTML":if(ft!=null)throw Error(a(137,d));break;default:Bi(s,d,ht,ft,S,vt)}return;default:if(Ja(d)){for(var xr in y)ft=y[xr],y.hasOwnProperty(xr)&&ft!==void 0&&!S.hasOwnProperty(xr)&&Id(s,d,xr,void 0,S,ft);for(St in S)ft=S[St],vt=y[St],!S.hasOwnProperty(St)||ft===vt||ft===void 0&&vt===void 0||Id(s,d,St,ft,S,vt);return}}for(var tt in y)ft=y[tt],y.hasOwnProperty(tt)&&ft!=null&&!S.hasOwnProperty(tt)&&Bi(s,d,tt,null,S,ft);for(Mt in S)ft=S[Mt],vt=y[Mt],!S.hasOwnProperty(Mt)||ft===vt||ft==null&&vt==null||Bi(s,d,Mt,ft,S,vt)}var Om=null,Nm=null;function xp(s){return s.nodeType===9?s:s.ownerDocument}function dv(s){switch(s){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function o_(s,d){if(s===0)switch(d){case"svg":return 1;case"math":return 2;default:return 0}return s===1&&d==="foreignObject"?0:s}function fc(s,d){return s==="textarea"||s==="noscript"||typeof d.children=="string"||typeof d.children=="number"||typeof d.children=="bigint"||typeof d.dangerouslySetInnerHTML=="object"&&d.dangerouslySetInnerHTML!==null&&d.dangerouslySetInnerHTML.__html!=null}var Bm=null;function fv(){var s=window.event;return s&&s.type==="popstate"?s===Bm?!1:(Bm=s,!0):(Bm=null,!1)}var l_=typeof setTimeout=="function"?setTimeout:void 0,pv=typeof clearTimeout=="function"?clearTimeout:void 0,mv=typeof Promise=="function"?Promise:void 0,Cb=typeof queueMicrotask=="function"?queueMicrotask:typeof mv<"u"?function(s){return mv.resolve(null).then(s).catch(gv)}:l_;function gv(s){setTimeout(function(){throw s})}function Kc(s){return s==="head"}function wp(s,d){var y=d,S=0,D=0;do{var B=y.nextSibling;if(s.removeChild(y),B&&B.nodeType===8)if(y=B.data,y==="/$"){if(0<S&&8>S){y=S;var ne=s.ownerDocument;if(y&1&&Pd(ne.documentElement),y&2&&Pd(ne.body),y&4)for(y=ne.head,Pd(y),ne=y.firstChild;ne;){var he=ne.nextSibling,Be=ne.nodeName;ne[ps]||Be==="SCRIPT"||Be==="STYLE"||Be==="LINK"&&ne.rel.toLowerCase()==="stylesheet"||y.removeChild(ne),ne=he}}if(D===0){s.removeChild(B),aa(d);return}D--}else y==="$"||y==="$?"||y==="$!"?D++:S=y.charCodeAt(0)-48;else S=0;y=B}while(y);aa(d)}function Fm(s){var d=s.firstChild;for(d&&d.nodeType===10&&(d=d.nextSibling);d;){var y=d;switch(d=d.nextSibling,y.nodeName){case"HTML":case"HEAD":case"BODY":Fm(y),Vt(y);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(y.rel.toLowerCase()==="stylesheet")continue}s.removeChild(y)}}function Vm(s,d,y,S){for(;s.nodeType===1;){var D=y;if(s.nodeName.toLowerCase()!==d.toLowerCase()){if(!S&&(s.nodeName!=="INPUT"||s.type!=="hidden"))break}else if(S){if(!s[ps])switch(d){case"meta":if(!s.hasAttribute("itemprop"))break;return s;case"link":if(B=s.getAttribute("rel"),B==="stylesheet"&&s.hasAttribute("data-precedence"))break;if(B!==D.rel||s.getAttribute("href")!==(D.href==null||D.href===""?null:D.href)||s.getAttribute("crossorigin")!==(D.crossOrigin==null?null:D.crossOrigin)||s.getAttribute("title")!==(D.title==null?null:D.title))break;return s;case"style":if(s.hasAttribute("data-precedence"))break;return s;case"script":if(B=s.getAttribute("src"),(B!==(D.src==null?null:D.src)||s.getAttribute("type")!==(D.type==null?null:D.type)||s.getAttribute("crossorigin")!==(D.crossOrigin==null?null:D.crossOrigin))&&B&&s.hasAttribute("async")&&!s.hasAttribute("itemprop"))break;return s;default:return s}}else if(d==="input"&&s.type==="hidden"){var B=D.name==null?null:""+D.name;if(D.type==="hidden"&&s.getAttribute("name")===B)return s}else return s;if(s=Mu(s.nextSibling),s===null)break}return null}function Um(s,d,y){if(d==="")return null;for(;s.nodeType!==3;)if((s.nodeType!==1||s.nodeName!=="INPUT"||s.type!=="hidden")&&!y||(s=Mu(s.nextSibling),s===null))return null;return s}function yf(s){return s.data==="$!"||s.data==="$?"&&s.ownerDocument.readyState==="complete"}function Pb(s,d){var y=s.ownerDocument;if(s.data!=="$?"||y.readyState==="complete")d();else{var S=function(){d(),y.removeEventListener("DOMContentLoaded",S)};y.addEventListener("DOMContentLoaded",S),s._reactRetry=S}}function Mu(s){for(;s!=null;s=s.nextSibling){var d=s.nodeType;if(d===1||d===3)break;if(d===8){if(d=s.data,d==="$"||d==="$!"||d==="$?"||d==="F!"||d==="F")break;if(d==="/$")return null}}return s}var u_=null;function Cd(s){s=s.previousSibling;for(var d=0;s;){if(s.nodeType===8){var y=s.data;if(y==="$"||y==="$!"||y==="$?"){if(d===0)return s;d--}else y==="/$"&&d++}s=s.previousSibling}return null}function ss(s,d,y){switch(d=xp(y),s){case"html":if(s=d.documentElement,!s)throw Error(a(452));return s;case"head":if(s=d.head,!s)throw Error(a(453));return s;case"body":if(s=d.body,!s)throw Error(a(454));return s;default:throw Error(a(451))}}function Pd(s){for(var d=s.attributes;d.length;)s.removeAttributeNode(d[0]);Vt(s)}var $l=new Map,c_=new Set;function vf(s){return typeof s.getRootNode=="function"?s.getRootNode():s.nodeType===9?s:s.ownerDocument}var Yc=Zt.d;Zt.d={f:_v,r:yv,D:d_,C:f_,L:vv,m:Tp,X:bv,S:p_,M:m_};function _v(){var s=Yc.f(),d=Im();return s||d}function yv(s){var d=In(s);d!==null&&d.tag===5&&d.type==="form"?$i(d):Yc.r(s)}var bf=typeof document>"u"?null:document;function h_(s,d,y){var S=bf;if(S&&typeof d=="string"&&d){var D=Ar(d);D='link[rel="'+s+'"][href="'+D+'"]',typeof y=="string"&&(D+='[crossorigin="'+y+'"]'),c_.has(D)||(c_.add(D),s={rel:s,crossOrigin:y,href:d},S.querySelector(D)===null&&(d=S.createElement("link"),ha(d,"link",s),Ui(d),S.head.appendChild(d)))}}function d_(s){Yc.D(s),h_("dns-prefetch",s,null)}function f_(s,d){Yc.C(s,d),h_("preconnect",s,d)}function vv(s,d,y){Yc.L(s,d,y);var S=bf;if(S&&s&&d){var D='link[rel="preload"][as="'+Ar(d)+'"]';d==="image"&&y&&y.imageSrcSet?(D+='[imagesrcset="'+Ar(y.imageSrcSet)+'"]',typeof y.imageSizes=="string"&&(D+='[imagesizes="'+Ar(y.imageSizes)+'"]')):D+='[href="'+Ar(s)+'"]';var B=D;switch(d){case"style":B=pc(s);break;case"script":B=xf(s)}$l.has(B)||(s=V({rel:"preload",href:d==="image"&&y&&y.imageSrcSet?void 0:s,as:d},y),$l.set(B,s),S.querySelector(D)!==null||d==="style"&&S.querySelector(Md(B))||d==="script"&&S.querySelector(l(B))||(d=S.createElement("link"),ha(d,"link",s),Ui(d),S.head.appendChild(d)))}}function Tp(s,d){Yc.m(s,d);var y=bf;if(y&&s){var S=d&&typeof d.as=="string"?d.as:"script",D='link[rel="modulepreload"][as="'+Ar(S)+'"][href="'+Ar(s)+'"]',B=D;switch(S){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":B=xf(s)}if(!$l.has(B)&&(s=V({rel:"modulepreload",href:s},d),$l.set(B,s),y.querySelector(D)===null)){switch(S){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(y.querySelector(l(B)))return}S=y.createElement("link"),ha(S,"link",s),Ui(S),y.head.appendChild(S)}}}function p_(s,d,y){Yc.S(s,d,y);var S=bf;if(S&&s){var D=Ka(S).hoistableStyles,B=pc(s);d=d||"default";var ne=D.get(B);if(!ne){var he={loading:0,preload:null};if(ne=S.querySelector(Md(B)))he.loading=5;else{s=V({rel:"stylesheet",href:s,"data-precedence":d},y),(y=$l.get(B))&&p(s,y);var Be=ne=S.createElement("link");Ui(Be),ha(Be,"link",s),Be._p=new Promise(function(ht,St){Be.onload=ht,Be.onerror=St}),Be.addEventListener("load",function(){he.loading|=1}),Be.addEventListener("error",function(){he.loading|=2}),he.loading|=4,o(ne,d,S)}ne={type:"stylesheet",instance:ne,count:1,state:he},D.set(B,ne)}}}function bv(s,d){Yc.X(s,d);var y=bf;if(y&&s){var S=Ka(y).hoistableScripts,D=xf(s),B=S.get(D);B||(B=y.querySelector(l(D)),B||(s=V({src:s,async:!0},d),(d=$l.get(D))&&v(s,d),B=y.createElement("script"),Ui(B),ha(B,"link",s),y.head.appendChild(B)),B={type:"script",instance:B,count:1,state:null},S.set(D,B))}}function m_(s,d){Yc.M(s,d);var y=bf;if(y&&s){var S=Ka(y).hoistableScripts,D=xf(s),B=S.get(D);B||(B=y.querySelector(l(D)),B||(s=V({src:s,async:!0,type:"module"},d),(d=$l.get(D))&&v(s,d),B=y.createElement("script"),Ui(B),ha(B,"link",s),y.head.appendChild(B)),B={type:"script",instance:B,count:1,state:null},S.set(D,B))}}function Sp(s,d,y,S){var D=(D=Ft.current)?vf(D):null;if(!D)throw Error(a(446));switch(s){case"meta":case"title":return null;case"style":return typeof y.precedence=="string"&&typeof y.href=="string"?(d=pc(y.href),y=Ka(D).hoistableStyles,S=y.get(d),S||(S={type:"style",instance:null,count:0,state:null},y.set(d,S)),S):{type:"void",instance:null,count:0,state:null};case"link":if(y.rel==="stylesheet"&&typeof y.href=="string"&&typeof y.precedence=="string"){s=pc(y.href);var B=Ka(D).hoistableStyles,ne=B.get(s);if(ne||(D=D.ownerDocument||D,ne={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},B.set(s,ne),(B=D.querySelector(Md(s)))&&!B._p&&(ne.instance=B,ne.state.loading=5),$l.has(s)||(y={rel:"preload",as:"style",href:y.href,crossOrigin:y.crossOrigin,integrity:y.integrity,media:y.media,hrefLang:y.hrefLang,referrerPolicy:y.referrerPolicy},$l.set(s,y),B||g_(D,s,y,ne.state))),d&&S===null)throw Error(a(528,""));return ne}if(d&&S!==null)throw Error(a(529,""));return null;case"script":return d=y.async,y=y.src,typeof y=="string"&&d&&typeof d!="function"&&typeof d!="symbol"?(d=xf(y),y=Ka(D).hoistableScripts,S=y.get(d),S||(S={type:"script",instance:null,count:0,state:null},y.set(d,S)),S):{type:"void",instance:null,count:0,state:null};default:throw Error(a(444,s))}}function pc(s){return'href="'+Ar(s)+'"'}function Md(s){return'link[rel="stylesheet"]['+s+"]"}function jm(s){return V({},s,{"data-precedence":s.precedence,precedence:null})}function g_(s,d,y,S){s.querySelector('link[rel="preload"][as="style"]['+d+"]")?S.loading=1:(d=s.createElement("link"),S.preload=d,d.addEventListener("load",function(){return S.loading|=1}),d.addEventListener("error",function(){return S.loading|=2}),ha(d,"link",y),Ui(d),s.head.appendChild(d))}function xf(s){return'[src="'+Ar(s)+'"]'}function l(s){return"script[async]"+s}function r(s,d,y){if(d.count++,d.instance===null)switch(d.type){case"style":var S=s.querySelector('style[data-href~="'+Ar(y.href)+'"]');if(S)return d.instance=S,Ui(S),S;var D=V({},y,{"data-href":y.href,"data-precedence":y.precedence,href:null,precedence:null});return S=(s.ownerDocument||s).createElement("style"),Ui(S),ha(S,"style",D),o(S,y.precedence,s),d.instance=S;case"stylesheet":D=pc(y.href);var B=s.querySelector(Md(D));if(B)return d.state.loading|=4,d.instance=B,Ui(B),B;S=jm(y),(D=$l.get(D))&&p(S,D),B=(s.ownerDocument||s).createElement("link"),Ui(B);var ne=B;return ne._p=new Promise(function(he,Be){ne.onload=he,ne.onerror=Be}),ha(B,"link",S),d.state.loading|=4,o(B,y.precedence,s),d.instance=B;case"script":return B=xf(y.src),(D=s.querySelector(l(B)))?(d.instance=D,Ui(D),D):(S=y,(D=$l.get(B))&&(S=V({},y),v(S,D)),s=s.ownerDocument||s,D=s.createElement("script"),Ui(D),ha(D,"link",S),s.head.appendChild(D),d.instance=D);case"void":return null;default:throw Error(a(443,d.type))}else d.type==="stylesheet"&&(d.state.loading&4)===0&&(S=d.instance,d.state.loading|=4,o(S,y.precedence,s));return d.instance}function o(s,d,y){for(var S=y.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),D=S.length?S[S.length-1]:null,B=D,ne=0;ne<S.length;ne++){var he=S[ne];if(he.dataset.precedence===d)B=he;else if(B!==D)break}B?B.parentNode.insertBefore(s,B.nextSibling):(d=y.nodeType===9?y.head:y,d.insertBefore(s,d.firstChild))}function p(s,d){s.crossOrigin==null&&(s.crossOrigin=d.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=d.referrerPolicy),s.title==null&&(s.title=d.title)}function v(s,d){s.crossOrigin==null&&(s.crossOrigin=d.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=d.referrerPolicy),s.integrity==null&&(s.integrity=d.integrity)}var E=null;function A(s,d,y){if(E===null){var S=new Map,D=E=new Map;D.set(y,S)}else D=E,S=D.get(y),S||(S=new Map,D.set(y,S));if(S.has(s))return S;for(S.set(s,null),y=y.getElementsByTagName(s),D=0;D<y.length;D++){var B=y[D];if(!(B[ps]||B[vn]||s==="link"&&B.getAttribute("rel")==="stylesheet")&&B.namespaceURI!=="http://www.w3.org/2000/svg"){var ne=B.getAttribute(d)||"";ne=s+ne;var he=S.get(ne);he?he.push(B):S.set(ne,[B])}}return S}function P(s,d,y){s=s.ownerDocument||s,s.head.insertBefore(y,d==="title"?s.querySelector("head > title"):null)}function z(s,d,y){if(y===1||d.itemProp!=null)return!1;switch(s){case"meta":case"title":return!0;case"style":if(typeof d.precedence!="string"||typeof d.href!="string"||d.href==="")break;return!0;case"link":if(typeof d.rel!="string"||typeof d.href!="string"||d.href===""||d.onLoad||d.onError)break;switch(d.rel){case"stylesheet":return s=d.disabled,typeof d.precedence=="string"&&s==null;default:return!0}case"script":if(d.async&&typeof d.async!="function"&&typeof d.async!="symbol"&&!d.onLoad&&!d.onError&&d.src&&typeof d.src=="string")return!0}return!1}function F(s){return!(s.type==="stylesheet"&&(s.state.loading&3)===0)}var q=null;function H(){}function J(s,d,y){if(q===null)throw Error(a(475));var S=q;if(d.type==="stylesheet"&&(typeof y.media!="string"||matchMedia(y.media).matches!==!1)&&(d.state.loading&4)===0){if(d.instance===null){var D=pc(y.href),B=s.querySelector(Md(D));if(B){s=B._p,s!==null&&typeof s=="object"&&typeof s.then=="function"&&(S.count++,S=re.bind(S),s.then(S,S)),d.state.loading|=4,d.instance=B,Ui(B);return}B=s.ownerDocument||s,y=jm(y),(D=$l.get(D))&&p(y,D),B=B.createElement("link"),Ui(B);var ne=B;ne._p=new Promise(function(he,Be){ne.onload=he,ne.onerror=Be}),ha(B,"link",y),d.instance=B}S.stylesheets===null&&(S.stylesheets=new Map),S.stylesheets.set(d,s),(s=d.state.preload)&&(d.state.loading&3)===0&&(S.count++,d=re.bind(S),s.addEventListener("load",d),s.addEventListener("error",d))}}function ie(){if(q===null)throw Error(a(475));var s=q;return s.stylesheets&&s.count===0&&pe(s,s.stylesheets),0<s.count?function(d){var y=setTimeout(function(){if(s.stylesheets&&pe(s,s.stylesheets),s.unsuspend){var S=s.unsuspend;s.unsuspend=null,S()}},6e4);return s.unsuspend=d,function(){s.unsuspend=null,clearTimeout(y)}}:null}function re(){if(this.count--,this.count===0){if(this.stylesheets)pe(this,this.stylesheets);else if(this.unsuspend){var s=this.unsuspend;this.unsuspend=null,s()}}}var oe=null;function pe(s,d){s.stylesheets=null,s.unsuspend!==null&&(s.count++,oe=new Map,d.forEach(we,s),oe=null,re.call(s))}function we(s,d){if(!(d.state.loading&4)){var y=oe.get(s);if(y)var S=y.get(null);else{y=new Map,oe.set(s,y);for(var D=s.querySelectorAll("link[data-precedence],style[data-precedence]"),B=0;B<D.length;B++){var ne=D[B];(ne.nodeName==="LINK"||ne.getAttribute("media")!=="not all")&&(y.set(ne.dataset.precedence,ne),S=ne)}S&&y.set(null,S)}D=d.instance,ne=D.getAttribute("data-precedence"),B=y.get(ne)||S,B===S&&y.set(null,D),y.set(ne,D),this.count++,S=re.bind(this),D.addEventListener("load",S),D.addEventListener("error",S),B?B.parentNode.insertBefore(D,B.nextSibling):(s=s.nodeType===9?s.head:s,s.insertBefore(D,s.firstChild)),d.state.loading|=4}}var He={$$typeof:Xe,Provider:null,Consumer:null,_currentValue:xt,_currentValue2:xt,_threadCount:0};function Re(s,d,y,S,D,B,ne,he){this.tag=1,this.containerInfo=s,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=en(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=en(0),this.hiddenUpdates=en(null),this.identifierPrefix=S,this.onUncaughtError=D,this.onCaughtError=B,this.onRecoverableError=ne,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=he,this.incompleteTransitions=new Map}function Fe(s,d,y,S,D,B,ne,he,Be,ht,St,Mt){return s=new Re(s,d,y,ne,he,Be,ht,Mt),d=1,B===!0&&(d|=24),B=eo(3,null,null,d),s.current=B,B.stateNode=s,d=Qu(),d.refCount++,s.pooledCache=d,d.refCount++,B.memoizedState={element:S,isDehydrated:y,cache:d},Xf(B),s}function ot(s){return s?(s=Gn,s):Gn}function _t(s,d,y,S,D,B){D=ot(D),S.context===null?S.context=D:S.pendingContext=D,S=Ju(d),S.payload={element:y},B=B===void 0?null:B,B!==null&&(S.callback=B),y=vu(s,S,d),y!==null&&(jl(y,s,d),Nc(y,s,d))}function It(s,d){if(s=s.memoizedState,s!==null&&s.dehydrated!==null){var y=s.retryLane;s.retryLane=y!==0&&y<d?y:d}}function $t(s,d){It(s,d),(s=s.alternate)&&It(s,d)}function Nt(s){if(s.tag===13){var d=Js(s,67108864);d!==null&&jl(d,s,67108864),$t(s,67108864)}}var Ut=!0;function hn(s,d,y,S){var D=gt.T;gt.T=null;var B=Zt.p;try{Zt.p=2,qt(s,d,y,S)}finally{Zt.p=B,gt.T=D}}function Gt(s,d,y,S){var D=gt.T;gt.T=null;var B=Zt.p;try{Zt.p=8,qt(s,d,y,S)}finally{Zt.p=B,gt.T=D}}function qt(s,d,y,S){if(Ut){var D=wt(S);if(D===null)Dm(s,d,S,En,y),Lr(s,S);else if(ls(D,s,d,y,S))S.stopPropagation();else if(Lr(s,S),d&4&&-1<os.indexOf(s)){for(;D!==null;){var B=In(D);if(B!==null)switch(B.tag){case 3:if(B=B.stateNode,B.current.memoizedState.isDehydrated){var ne=Ge(B.pendingLanes);if(ne!==0){var he=B;for(he.pendingLanes|=2,he.entangledLanes|=2;ne;){var Be=1<<31-je(ne);he.entanglements[1]|=Be,ne&=~Be}ql(B),(ar&6)===0&&(Sm=Nr()+500,Ed(0))}}break;case 13:he=Js(B,2),he!==null&&jl(he,B,2),Im(),$t(B,2)}if(B=wt(S),B===null&&Dm(s,d,S,En,y),B===D)break;D=B}D!==null&&S.stopPropagation()}else Dm(s,d,S,null,y)}}function wt(s){return s=Mo(s),Ln(s)}var En=null;function Ln(s){if(En=null,s=Rn(s),s!==null){var d=m(s);if(d===null)s=null;else{var y=d.tag;if(y===13){if(s=g(d),s!==null)return s;s=null}else if(y===3){if(d.stateNode.current.memoizedState.isDehydrated)return d.tag===3?d.stateNode.containerInfo:null;s=null}else d!==s&&(s=null)}}return En=s,null}function xn(s){switch(s){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Ba()){case Fi:return 2;case fr:return 8;case fa:case Po:return 32;case js:return 268435456;default:return 32}default:return 32}}var ln=!1,Yn=null,Gi=null,br=null,ba=new Map,lo=new Map,xa=[],os="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Lr(s,d){switch(s){case"focusin":case"focusout":Yn=null;break;case"dragenter":case"dragleave":Gi=null;break;case"mouseover":case"mouseout":br=null;break;case"pointerover":case"pointerout":ba.delete(d.pointerId);break;case"gotpointercapture":case"lostpointercapture":lo.delete(d.pointerId)}}function ia(s,d,y,S,D,B){return s===null||s.nativeEvent!==B?(s={blockedOn:d,domEventName:y,eventSystemFlags:S,nativeEvent:B,targetContainers:[D]},d!==null&&(d=In(d),d!==null&&Nt(d)),s):(s.eventSystemFlags|=S,d=s.targetContainers,D!==null&&d.indexOf(D)===-1&&d.push(D),s)}function ls(s,d,y,S,D){switch(d){case"focusin":return Yn=ia(Yn,s,d,y,S,D),!0;case"dragenter":return Gi=ia(Gi,s,d,y,S,D),!0;case"mouseover":return br=ia(br,s,d,y,S,D),!0;case"pointerover":var B=D.pointerId;return ba.set(B,ia(ba.get(B)||null,s,d,y,S,D)),!0;case"gotpointercapture":return B=D.pointerId,lo.set(B,ia(lo.get(B)||null,s,d,y,S,D)),!0}return!1}function Ga(s){var d=Rn(s.target);if(d!==null){var y=m(d);if(y!==null){if(d=y.tag,d===13){if(d=g(y),d!==null){s.blockedOn=d,Er(s.priority,function(){if(y.tag===13){var S=pl();S=Dn(S);var D=Js(y,S);D!==null&&jl(D,y,S),$t(y,S)}});return}}else if(d===3&&y.stateNode.current.memoizedState.isDehydrated){s.blockedOn=y.tag===3?y.stateNode.containerInfo:null;return}}}s.blockedOn=null}function us(s){if(s.blockedOn!==null)return!1;for(var d=s.targetContainers;0<d.length;){var y=wt(s.nativeEvent);if(y===null){y=s.nativeEvent;var S=new y.constructor(y.type,y);Zs=S,y.target.dispatchEvent(S),Zs=null}else return d=In(y),d!==null&&Nt(d),s.blockedOn=y,!1;d.shift()}return!0}function gl(s,d,y){us(s)&&y.delete(d)}function Za(){ln=!1,Yn!==null&&us(Yn)&&(Yn=null),Gi!==null&&us(Gi)&&(Gi=null),br!==null&&us(br)&&(br=null),ba.forEach(gl),lo.forEach(gl)}function Os(s,d){s.blockedOn===d&&(s.blockedOn=null,ln||(ln=!0,i.unstable_scheduleCallback(i.unstable_NormalPriority,Za)))}var ra=null;function Da(s){ra!==s&&(ra=s,i.unstable_scheduleCallback(i.unstable_NormalPriority,function(){ra===s&&(ra=null);for(var d=0;d<s.length;d+=3){var y=s[d],S=s[d+1],D=s[d+2];if(typeof S!="function"){if(Ln(S||y)===null)continue;break}var B=In(y);B!==null&&(s.splice(d,3),d-=3,Rr(B,{pending:!0,data:D,method:y.method,action:S},S,D))}}))}function aa(s){function d(Be){return Os(Be,s)}Yn!==null&&Os(Yn,s),Gi!==null&&Os(Gi,s),br!==null&&Os(br,s),ba.forEach(d),lo.forEach(d);for(var y=0;y<xa.length;y++){var S=xa[y];S.blockedOn===s&&(S.blockedOn=null)}for(;0<xa.length&&(y=xa[0],y.blockedOn===null);)Ga(y),y.blockedOn===null&&xa.shift();if(y=(s.ownerDocument||s).$$reactFormReplay,y!=null)for(S=0;S<y.length;S+=3){var D=y[S],B=y[S+1],ne=D[Pn]||null;if(typeof B=="function")ne||Da(y);else if(ne){var he=null;if(B&&B.hasAttribute("formAction")){if(D=B,ne=B[Pn]||null)he=ne.formAction;else if(Ln(D)!==null)continue}else he=ne.action;typeof he=="function"?y[S+1]=he:(y.splice(S,3),S-=3),Da(y)}}}function sa(s){this._internalRoot=s}Ji.prototype.render=sa.prototype.render=function(s){var d=this._internalRoot;if(d===null)throw Error(a(409));var y=d.current,S=pl();_t(y,S,s,d,null,null)},Ji.prototype.unmount=sa.prototype.unmount=function(){var s=this._internalRoot;if(s!==null){this._internalRoot=null;var d=s.containerInfo;_t(s.current,2,null,s,null,null),Im(),d[Vi]=null}};function Ji(s){this._internalRoot=s}Ji.prototype.unstable_scheduleHydration=function(s){if(s){var d=Xi();s={blockedOn:null,target:s,priority:d};for(var y=0;y<xa.length&&d!==0&&d<xa[y].priority;y++);xa.splice(y,0,s),y===0&&Ga(s)}};var su=e.version;if(su!=="19.1.1")throw Error(a(527,su,"19.1.1"));Zt.findDOMNode=function(s){var d=s._reactInternals;if(d===void 0)throw typeof s.render=="function"?Error(a(188)):(s=Object.keys(s).join(","),Error(a(268,s)));return s=C(d),s=s!==null?k(s):null,s=s===null?null:s.stateNode,s};var wf={bundleType:0,version:"19.1.1",rendererPackageName:"react-dom",currentDispatcherRef:gt,reconcilerVersion:"19.1.1"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var _l=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!_l.isDisabled&&_l.supportsFiber)try{Ta=_l.inject(wf),pr=_l}catch{}}return y_.createRoot=function(s,d){if(!h(s))throw Error(a(299));var y=!1,S="",D=Py,B=dm,ne=My,he=null;return d!=null&&(d.unstable_strictMode===!0&&(y=!0),d.identifierPrefix!==void 0&&(S=d.identifierPrefix),d.onUncaughtError!==void 0&&(D=d.onUncaughtError),d.onCaughtError!==void 0&&(B=d.onCaughtError),d.onRecoverableError!==void 0&&(ne=d.onRecoverableError),d.unstable_transitionCallbacks!==void 0&&(he=d.unstable_transitionCallbacks)),d=Fe(s,1,!1,null,null,y,S,D,B,ne,he,null),s[Vi]=d.current,Lm(s),new sa(d)},y_.hydrateRoot=function(s,d,y){if(!h(s))throw Error(a(299));var S=!1,D="",B=Py,ne=dm,he=My,Be=null,ht=null;return y!=null&&(y.unstable_strictMode===!0&&(S=!0),y.identifierPrefix!==void 0&&(D=y.identifierPrefix),y.onUncaughtError!==void 0&&(B=y.onUncaughtError),y.onCaughtError!==void 0&&(ne=y.onCaughtError),y.onRecoverableError!==void 0&&(he=y.onRecoverableError),y.unstable_transitionCallbacks!==void 0&&(Be=y.unstable_transitionCallbacks),y.formState!==void 0&&(ht=y.formState)),d=Fe(s,1,!0,d,y??null,S,D,B,ne,he,Be,ht),d.context=ot(null),y=d.current,S=pl(),S=Dn(S),D=Ju(S),D.callback=null,vu(y,D,S),y=S,d.current.lanes=y,qe(d,y),ql(d),s[Vi]=d.current,Lm(s),new Ji(d)},y_.version="19.1.1",y_}var t2;function YP(){if(t2)return Lb.exports;t2=1;function i(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(i)}catch(e){console.error(e)}}return i(),Lb.exports=KP(),Lb.exports}var QP=YP();const JP=uy(QP);/**
 * react-router v7.9.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var n2="popstate";function eM(i={}){function e(a,h){let{pathname:m,search:g,hash:c}=a.location;return vx("",{pathname:m,search:g,hash:c},h.state&&h.state.usr||null,h.state&&h.state.key||"default")}function t(a,h){return typeof h=="string"?h:q_(h)}return nM(e,t,null,i)}function Oa(i,e){if(i===!1||i===null||typeof i>"u")throw new Error(e)}function Qh(i,e){if(!i){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function tM(){return Math.random().toString(36).substring(2,10)}function i2(i,e){return{usr:i.state,key:i.key,idx:e}}function vx(i,e,t=null,a){return{pathname:typeof i=="string"?i:i.pathname,search:"",hash:"",...typeof e=="string"?mg(e):e,state:t,key:e&&e.key||a||tM()}}function q_({pathname:i="/",search:e="",hash:t=""}){return e&&e!=="?"&&(i+=e.charAt(0)==="?"?e:"?"+e),t&&t!=="#"&&(i+=t.charAt(0)==="#"?t:"#"+t),i}function mg(i){let e={};if(i){let t=i.indexOf("#");t>=0&&(e.hash=i.substring(t),i=i.substring(0,t));let a=i.indexOf("?");a>=0&&(e.search=i.substring(a),i=i.substring(0,a)),i&&(e.pathname=i)}return e}function nM(i,e,t,a={}){let{window:h=document.defaultView,v5Compat:m=!1}=a,g=h.history,c="POP",C=null,k=V();k==null&&(k=0,g.replaceState({...g.state,idx:k},""));function V(){return(g.state||{idx:null}).idx}function Z(){c="POP";let ze=V(),et=ze==null?null:ze-k;k=ze,C&&C({action:c,location:xe.location,delta:et})}function Y(ze,et){c="PUSH";let Qe=vx(xe.location,ze,et);k=V()+1;let Xe=i2(Qe,k),Ke=xe.createHref(Qe);try{g.pushState(Xe,"",Ke)}catch(Ve){if(Ve instanceof DOMException&&Ve.name==="DataCloneError")throw Ve;h.location.assign(Ke)}m&&C&&C({action:c,location:xe.location,delta:1})}function Q(ze,et){c="REPLACE";let Qe=vx(xe.location,ze,et);k=V();let Xe=i2(Qe,k),Ke=xe.createHref(Qe);g.replaceState(Xe,"",Ke),m&&C&&C({action:c,location:xe.location,delta:0})}function be(ze){return iM(ze)}let xe={get action(){return c},get location(){return i(h,g)},listen(ze){if(C)throw new Error("A history only accepts one active listener");return h.addEventListener(n2,Z),C=ze,()=>{h.removeEventListener(n2,Z),C=null}},createHref(ze){return e(h,ze)},createURL:be,encodeLocation(ze){let et=be(ze);return{pathname:et.pathname,search:et.search,hash:et.hash}},push:Y,replace:Q,go(ze){return g.go(ze)}};return xe}function iM(i,e=!1){let t="http://localhost";typeof window<"u"&&(t=window.location.origin!=="null"?window.location.origin:window.location.href),Oa(t,"No window.location.(origin|href) available to create URL");let a=typeof i=="string"?i:q_(i);return a=a.replace(/ $/,"%20"),!e&&a.startsWith("//")&&(a=t+a),new URL(a,t)}function nE(i,e,t="/"){return rM(i,e,t,!1)}function rM(i,e,t,a){let h=typeof e=="string"?mg(e):e,m=Nd(h.pathname||"/",t);if(m==null)return null;let g=iE(i);aM(g);let c=null;for(let C=0;c==null&&C<g.length;++C){let k=gM(m);c=pM(g[C],k,a)}return c}function iE(i,e=[],t=[],a="",h=!1){let m=(g,c,C=h,k)=>{let V={relativePath:k===void 0?g.path||"":k,caseSensitive:g.caseSensitive===!0,childrenIndex:c,route:g};if(V.relativePath.startsWith("/")){if(!V.relativePath.startsWith(a)&&C)return;Oa(V.relativePath.startsWith(a),`Absolute route path "${V.relativePath}" nested under path "${a}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),V.relativePath=V.relativePath.slice(a.length)}let Z=Ld([a,V.relativePath]),Y=t.concat(V);g.children&&g.children.length>0&&(Oa(g.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${Z}".`),iE(g.children,e,Y,Z,C)),!(g.path==null&&!g.index)&&e.push({path:Z,score:dM(Z,g.index),routesMeta:Y})};return i.forEach((g,c)=>{var C;if(g.path===""||!((C=g.path)!=null&&C.includes("?")))m(g,c);else for(let k of rE(g.path))m(g,c,!0,k)}),e}function rE(i){let e=i.split("/");if(e.length===0)return[];let[t,...a]=e,h=t.endsWith("?"),m=t.replace(/\?$/,"");if(a.length===0)return h?[m,""]:[m];let g=rE(a.join("/")),c=[];return c.push(...g.map(C=>C===""?m:[m,C].join("/"))),h&&c.push(...g),c.map(C=>i.startsWith("/")&&C===""?"/":C)}function aM(i){i.sort((e,t)=>e.score!==t.score?t.score-e.score:fM(e.routesMeta.map(a=>a.childrenIndex),t.routesMeta.map(a=>a.childrenIndex)))}var sM=/^:[\w-]+$/,oM=3,lM=2,uM=1,cM=10,hM=-2,r2=i=>i==="*";function dM(i,e){let t=i.split("/"),a=t.length;return t.some(r2)&&(a+=hM),e&&(a+=lM),t.filter(h=>!r2(h)).reduce((h,m)=>h+(sM.test(m)?oM:m===""?uM:cM),a)}function fM(i,e){return i.length===e.length&&i.slice(0,-1).every((a,h)=>a===e[h])?i[i.length-1]-e[e.length-1]:0}function pM(i,e,t=!1){let{routesMeta:a}=i,h={},m="/",g=[];for(let c=0;c<a.length;++c){let C=a[c],k=c===a.length-1,V=m==="/"?e:e.slice(m.length)||"/",Z=n0({path:C.relativePath,caseSensitive:C.caseSensitive,end:k},V),Y=C.route;if(!Z&&k&&t&&!a[a.length-1].route.index&&(Z=n0({path:C.relativePath,caseSensitive:C.caseSensitive,end:!1},V)),!Z)return null;Object.assign(h,Z.params),g.push({params:h,pathname:Ld([m,Z.pathname]),pathnameBase:bM(Ld([m,Z.pathnameBase])),route:Y}),Z.pathnameBase!=="/"&&(m=Ld([m,Z.pathnameBase]))}return g}function n0(i,e){typeof i=="string"&&(i={path:i,caseSensitive:!1,end:!0});let[t,a]=mM(i.path,i.caseSensitive,i.end),h=e.match(t);if(!h)return null;let m=h[0],g=m.replace(/(.)\/+$/,"$1"),c=h.slice(1);return{params:a.reduce((k,{paramName:V,isOptional:Z},Y)=>{if(V==="*"){let be=c[Y]||"";g=m.slice(0,m.length-be.length).replace(/(.)\/+$/,"$1")}const Q=c[Y];return Z&&!Q?k[V]=void 0:k[V]=(Q||"").replace(/%2F/g,"/"),k},{}),pathname:m,pathnameBase:g,pattern:i}}function mM(i,e=!1,t=!0){Qh(i==="*"||!i.endsWith("*")||i.endsWith("/*"),`Route path "${i}" will be treated as if it were "${i.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${i.replace(/\*$/,"/*")}".`);let a=[],h="^"+i.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(g,c,C)=>(a.push({paramName:c,isOptional:C!=null}),C?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return i.endsWith("*")?(a.push({paramName:"*"}),h+=i==="*"||i==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?h+="\\/*$":i!==""&&i!=="/"&&(h+="(?:(?=\\/|$))"),[new RegExp(h,e?void 0:"i"),a]}function gM(i){try{return i.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Qh(!1,`The URL path "${i}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),i}}function Nd(i,e){if(e==="/")return i;if(!i.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,a=i.charAt(t);return a&&a!=="/"?null:i.slice(t)||"/"}function _M(i,e="/"){let{pathname:t,search:a="",hash:h=""}=typeof i=="string"?mg(i):i;return{pathname:t?t.startsWith("/")?t:yM(t,e):e,search:xM(a),hash:wM(h)}}function yM(i,e){let t=e.replace(/\/+$/,"").split("/");return i.split("/").forEach(h=>{h===".."?t.length>1&&t.pop():h!=="."&&t.push(h)}),t.length>1?t.join("/"):"/"}function Nb(i,e,t,a){return`Cannot include a '${i}' character in a manually specified \`to.${e}\` field [${JSON.stringify(a)}].  Please separate it out to the \`to.${t}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function vM(i){return i.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function aE(i){let e=vM(i);return e.map((t,a)=>a===e.length-1?t.pathname:t.pathnameBase)}function sE(i,e,t,a=!1){let h;typeof i=="string"?h=mg(i):(h={...i},Oa(!h.pathname||!h.pathname.includes("?"),Nb("?","pathname","search",h)),Oa(!h.pathname||!h.pathname.includes("#"),Nb("#","pathname","hash",h)),Oa(!h.search||!h.search.includes("#"),Nb("#","search","hash",h)));let m=i===""||h.pathname==="",g=m?"/":h.pathname,c;if(g==null)c=t;else{let Z=e.length-1;if(!a&&g.startsWith("..")){let Y=g.split("/");for(;Y[0]==="..";)Y.shift(),Z-=1;h.pathname=Y.join("/")}c=Z>=0?e[Z]:"/"}let C=_M(h,c),k=g&&g!=="/"&&g.endsWith("/"),V=(m||g===".")&&t.endsWith("/");return!C.pathname.endsWith("/")&&(k||V)&&(C.pathname+="/"),C}var Ld=i=>i.join("/").replace(/\/\/+/g,"/"),bM=i=>i.replace(/\/+$/,"").replace(/^\/*/,"/"),xM=i=>!i||i==="?"?"":i.startsWith("?")?i:"?"+i,wM=i=>!i||i==="#"?"":i.startsWith("#")?i:"#"+i;function TM(i){return i!=null&&typeof i.status=="number"&&typeof i.statusText=="string"&&typeof i.internal=="boolean"&&"data"in i}var oE=["POST","PUT","PATCH","DELETE"];new Set(oE);var SM=["GET",...oE];new Set(SM);var gg=Tt.createContext(null);gg.displayName="DataRouter";var D0=Tt.createContext(null);D0.displayName="DataRouterState";Tt.createContext(!1);var lE=Tt.createContext({isTransitioning:!1});lE.displayName="ViewTransition";var EM=Tt.createContext(new Map);EM.displayName="Fetchers";var AM=Tt.createContext(null);AM.displayName="Await";var td=Tt.createContext(null);td.displayName="Navigation";var cy=Tt.createContext(null);cy.displayName="Location";var $d=Tt.createContext({outlet:null,matches:[],isDataRoute:!1});$d.displayName="Route";var g1=Tt.createContext(null);g1.displayName="RouteError";function IM(i,{relative:e}={}){Oa(hy(),"useHref() may be used only in the context of a <Router> component.");let{basename:t,navigator:a}=Tt.useContext(td),{hash:h,pathname:m,search:g}=dy(i,{relative:e}),c=m;return t!=="/"&&(c=m==="/"?t:Ld([t,m])),a.createHref({pathname:c,search:g,hash:h})}function hy(){return Tt.useContext(cy)!=null}function tm(){return Oa(hy(),"useLocation() may be used only in the context of a <Router> component."),Tt.useContext(cy).location}var uE="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function cE(i){Tt.useContext(td).static||Tt.useLayoutEffect(i)}function CM(){let{isDataRoute:i}=Tt.useContext($d);return i?UM():PM()}function PM(){Oa(hy(),"useNavigate() may be used only in the context of a <Router> component.");let i=Tt.useContext(gg),{basename:e,navigator:t}=Tt.useContext(td),{matches:a}=Tt.useContext($d),{pathname:h}=tm(),m=JSON.stringify(aE(a)),g=Tt.useRef(!1);return cE(()=>{g.current=!0}),Tt.useCallback((C,k={})=>{if(Qh(g.current,uE),!g.current)return;if(typeof C=="number"){t.go(C);return}let V=sE(C,JSON.parse(m),h,k.relative==="path");i==null&&e!=="/"&&(V.pathname=V.pathname==="/"?e:Ld([e,V.pathname])),(k.replace?t.replace:t.push)(V,k.state,k)},[e,t,m,h,i])}Tt.createContext(null);function dy(i,{relative:e}={}){let{matches:t}=Tt.useContext($d),{pathname:a}=tm(),h=JSON.stringify(aE(t));return Tt.useMemo(()=>sE(i,JSON.parse(h),a,e==="path"),[i,h,a,e])}function MM(i,e){return hE(i,e)}function hE(i,e,t,a,h){var Qe;Oa(hy(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:m}=Tt.useContext(td),{matches:g}=Tt.useContext($d),c=g[g.length-1],C=c?c.params:{},k=c?c.pathname:"/",V=c?c.pathnameBase:"/",Z=c&&c.route;{let Xe=Z&&Z.path||"";dE(k,!Z||Xe.endsWith("*")||Xe.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${k}" (under <Route path="${Xe}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${Xe}"> to <Route path="${Xe==="/"?"*":`${Xe}/*`}">.`)}let Y=tm(),Q;if(e){let Xe=typeof e=="string"?mg(e):e;Oa(V==="/"||((Qe=Xe.pathname)==null?void 0:Qe.startsWith(V)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${V}" but pathname "${Xe.pathname}" was given in the \`location\` prop.`),Q=Xe}else Q=Y;let be=Q.pathname||"/",xe=be;if(V!=="/"){let Xe=V.replace(/^\//,"").split("/");xe="/"+be.replace(/^\//,"").split("/").slice(Xe.length).join("/")}let ze=nE(i,{pathname:xe});Qh(Z||ze!=null,`No routes matched location "${Q.pathname}${Q.search}${Q.hash}" `),Qh(ze==null||ze[ze.length-1].route.element!==void 0||ze[ze.length-1].route.Component!==void 0||ze[ze.length-1].route.lazy!==void 0,`Matched leaf route at location "${Q.pathname}${Q.search}${Q.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let et=zM(ze&&ze.map(Xe=>Object.assign({},Xe,{params:Object.assign({},C,Xe.params),pathname:Ld([V,m.encodeLocation?m.encodeLocation(Xe.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:Xe.pathname]),pathnameBase:Xe.pathnameBase==="/"?V:Ld([V,m.encodeLocation?m.encodeLocation(Xe.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:Xe.pathnameBase])})),g,t,a,h);return e&&et?Tt.createElement(cy.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...Q},navigationType:"POP"}},et):et}function RM(){let i=VM(),e=TM(i)?`${i.status} ${i.statusText}`:i instanceof Error?i.message:JSON.stringify(i),t=i instanceof Error?i.stack:null,a="rgba(200,200,200, 0.5)",h={padding:"0.5rem",backgroundColor:a},m={padding:"2px 4px",backgroundColor:a},g=null;return console.error("Error handled by React Router default ErrorBoundary:",i),g=Tt.createElement(Tt.Fragment,null,Tt.createElement("p",null," Hey developer "),Tt.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",Tt.createElement("code",{style:m},"ErrorBoundary")," or"," ",Tt.createElement("code",{style:m},"errorElement")," prop on your route.")),Tt.createElement(Tt.Fragment,null,Tt.createElement("h2",null,"Unexpected Application Error!"),Tt.createElement("h3",{style:{fontStyle:"italic"}},e),t?Tt.createElement("pre",{style:h},t):null,g)}var kM=Tt.createElement(RM,null),LM=class extends Tt.Component{constructor(i){super(i),this.state={location:i.location,revalidation:i.revalidation,error:i.error}}static getDerivedStateFromError(i){return{error:i}}static getDerivedStateFromProps(i,e){return e.location!==i.location||e.revalidation!=="idle"&&i.revalidation==="idle"?{error:i.error,location:i.location,revalidation:i.revalidation}:{error:i.error!==void 0?i.error:e.error,location:e.location,revalidation:i.revalidation||e.revalidation}}componentDidCatch(i,e){this.props.unstable_onError?this.props.unstable_onError(i,e):console.error("React Router caught the following error during render",i)}render(){return this.state.error!==void 0?Tt.createElement($d.Provider,{value:this.props.routeContext},Tt.createElement(g1.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function DM({routeContext:i,match:e,children:t}){let a=Tt.useContext(gg);return a&&a.static&&a.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(a.staticContext._deepestRenderedBoundaryId=e.route.id),Tt.createElement($d.Provider,{value:i},t)}function zM(i,e=[],t=null,a=null,h=null){if(i==null){if(!t)return null;if(t.errors)i=t.matches;else if(e.length===0&&!t.initialized&&t.matches.length>0)i=t.matches;else return null}let m=i,g=t==null?void 0:t.errors;if(g!=null){let k=m.findIndex(V=>V.route.id&&(g==null?void 0:g[V.route.id])!==void 0);Oa(k>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(g).join(",")}`),m=m.slice(0,Math.min(m.length,k+1))}let c=!1,C=-1;if(t)for(let k=0;k<m.length;k++){let V=m[k];if((V.route.HydrateFallback||V.route.hydrateFallbackElement)&&(C=k),V.route.id){let{loaderData:Z,errors:Y}=t,Q=V.route.loader&&!Z.hasOwnProperty(V.route.id)&&(!Y||Y[V.route.id]===void 0);if(V.route.lazy||Q){c=!0,C>=0?m=m.slice(0,C+1):m=[m[0]];break}}}return m.reduceRight((k,V,Z)=>{let Y,Q=!1,be=null,xe=null;t&&(Y=g&&V.route.id?g[V.route.id]:void 0,be=V.route.errorElement||kM,c&&(C<0&&Z===0?(dE("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),Q=!0,xe=null):C===Z&&(Q=!0,xe=V.route.hydrateFallbackElement||null)));let ze=e.concat(m.slice(0,Z+1)),et=()=>{let Qe;return Y?Qe=be:Q?Qe=xe:V.route.Component?Qe=Tt.createElement(V.route.Component,null):V.route.element?Qe=V.route.element:Qe=k,Tt.createElement(DM,{match:V,routeContext:{outlet:k,matches:ze,isDataRoute:t!=null},children:Qe})};return t&&(V.route.ErrorBoundary||V.route.errorElement||Z===0)?Tt.createElement(LM,{location:t.location,revalidation:t.revalidation,component:be,error:Y,children:et(),routeContext:{outlet:null,matches:ze,isDataRoute:!0},unstable_onError:a}):et()},null)}function _1(i){return`${i} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function OM(i){let e=Tt.useContext(gg);return Oa(e,_1(i)),e}function NM(i){let e=Tt.useContext(D0);return Oa(e,_1(i)),e}function BM(i){let e=Tt.useContext($d);return Oa(e,_1(i)),e}function y1(i){let e=BM(i),t=e.matches[e.matches.length-1];return Oa(t.route.id,`${i} can only be used on routes that contain a unique "id"`),t.route.id}function FM(){return y1("useRouteId")}function VM(){var a;let i=Tt.useContext(g1),e=NM("useRouteError"),t=y1("useRouteError");return i!==void 0?i:(a=e.errors)==null?void 0:a[t]}function UM(){let{router:i}=OM("useNavigate"),e=y1("useNavigate"),t=Tt.useRef(!1);return cE(()=>{t.current=!0}),Tt.useCallback(async(h,m={})=>{Qh(t.current,uE),t.current&&(typeof h=="number"?i.navigate(h):await i.navigate(h,{fromRouteId:e,...m}))},[i,e])}var a2={};function dE(i,e,t){!e&&!a2[i]&&(a2[i]=!0,Qh(!1,t))}Tt.memo(jM);function jM({routes:i,future:e,state:t,unstable_onError:a}){return hE(i,void 0,t,a,e)}function Pp(i){Oa(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function qM({basename:i="/",children:e=null,location:t,navigationType:a="POP",navigator:h,static:m=!1}){Oa(!hy(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let g=i.replace(/^\/*/,"/"),c=Tt.useMemo(()=>({basename:g,navigator:h,static:m,future:{}}),[g,h,m]);typeof t=="string"&&(t=mg(t));let{pathname:C="/",search:k="",hash:V="",state:Z=null,key:Y="default"}=t,Q=Tt.useMemo(()=>{let be=Nd(C,g);return be==null?null:{location:{pathname:be,search:k,hash:V,state:Z,key:Y},navigationType:a}},[g,C,k,V,Z,Y,a]);return Qh(Q!=null,`<Router basename="${g}"> is not able to match the URL "${C}${k}${V}" because it does not start with the basename, so the <Router> won't render anything.`),Q==null?null:Tt.createElement(td.Provider,{value:c},Tt.createElement(cy.Provider,{children:e,value:Q}))}function $M({children:i,location:e}){return MM(bx(i),e)}function bx(i,e=[]){let t=[];return Tt.Children.forEach(i,(a,h)=>{if(!Tt.isValidElement(a))return;let m=[...e,h];if(a.type===Tt.Fragment){t.push.apply(t,bx(a.props.children,m));return}Oa(a.type===Pp,`[${typeof a.type=="string"?a.type:a.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),Oa(!a.props.index||!a.props.children,"An index route cannot have child routes.");let g={id:a.props.id||m.join("-"),caseSensitive:a.props.caseSensitive,element:a.props.element,Component:a.props.Component,index:a.props.index,path:a.props.path,middleware:a.props.middleware,loader:a.props.loader,action:a.props.action,hydrateFallbackElement:a.props.hydrateFallbackElement,HydrateFallback:a.props.HydrateFallback,errorElement:a.props.errorElement,ErrorBoundary:a.props.ErrorBoundary,hasErrorBoundary:a.props.hasErrorBoundary===!0||a.props.ErrorBoundary!=null||a.props.errorElement!=null,shouldRevalidate:a.props.shouldRevalidate,handle:a.props.handle,lazy:a.props.lazy};a.props.children&&(g.children=bx(a.props.children,m)),t.push(g)}),t}var Ov="get",Nv="application/x-www-form-urlencoded";function z0(i){return i!=null&&typeof i.tagName=="string"}function GM(i){return z0(i)&&i.tagName.toLowerCase()==="button"}function ZM(i){return z0(i)&&i.tagName.toLowerCase()==="form"}function HM(i){return z0(i)&&i.tagName.toLowerCase()==="input"}function WM(i){return!!(i.metaKey||i.altKey||i.ctrlKey||i.shiftKey)}function XM(i,e){return i.button===0&&(!e||e==="_self")&&!WM(i)}var xv=null;function KM(){if(xv===null)try{new FormData(document.createElement("form"),0),xv=!1}catch{xv=!0}return xv}var YM=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function Bb(i){return i!=null&&!YM.has(i)?(Qh(!1,`"${i}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${Nv}"`),null):i}function QM(i,e){let t,a,h,m,g;if(ZM(i)){let c=i.getAttribute("action");a=c?Nd(c,e):null,t=i.getAttribute("method")||Ov,h=Bb(i.getAttribute("enctype"))||Nv,m=new FormData(i)}else if(GM(i)||HM(i)&&(i.type==="submit"||i.type==="image")){let c=i.form;if(c==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let C=i.getAttribute("formaction")||c.getAttribute("action");if(a=C?Nd(C,e):null,t=i.getAttribute("formmethod")||c.getAttribute("method")||Ov,h=Bb(i.getAttribute("formenctype"))||Bb(c.getAttribute("enctype"))||Nv,m=new FormData(c,i),!KM()){let{name:k,type:V,value:Z}=i;if(V==="image"){let Y=k?`${k}.`:"";m.append(`${Y}x`,"0"),m.append(`${Y}y`,"0")}else k&&m.append(k,Z)}}else{if(z0(i))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');t=Ov,a=null,h=Nv,g=i}return m&&h==="text/plain"&&(g=m,m=void 0),{action:a,method:t.toLowerCase(),encType:h,formData:m,body:g}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function v1(i,e){if(i===!1||i===null||typeof i>"u")throw new Error(e)}function JM(i,e,t){let a=typeof i=="string"?new URL(i,typeof window>"u"?"server://singlefetch/":window.location.origin):i;return a.pathname==="/"?a.pathname=`_root.${t}`:e&&Nd(a.pathname,e)==="/"?a.pathname=`${e.replace(/\/$/,"")}/_root.${t}`:a.pathname=`${a.pathname.replace(/\/$/,"")}.${t}`,a}async function eR(i,e){if(i.id in e)return e[i.id];try{let t=await import(i.module);return e[i.id]=t,t}catch(t){return console.error(`Error loading route module \`${i.module}\`, reloading page...`),console.error(t),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function tR(i){return i==null?!1:i.href==null?i.rel==="preload"&&typeof i.imageSrcSet=="string"&&typeof i.imageSizes=="string":typeof i.rel=="string"&&typeof i.href=="string"}async function nR(i,e,t){let a=await Promise.all(i.map(async h=>{let m=e.routes[h.route.id];if(m){let g=await eR(m,t);return g.links?g.links():[]}return[]}));return sR(a.flat(1).filter(tR).filter(h=>h.rel==="stylesheet"||h.rel==="preload").map(h=>h.rel==="stylesheet"?{...h,rel:"prefetch",as:"style"}:{...h,rel:"prefetch"}))}function s2(i,e,t,a,h,m){let g=(C,k)=>t[k]?C.route.id!==t[k].route.id:!0,c=(C,k)=>{var V;return t[k].pathname!==C.pathname||((V=t[k].route.path)==null?void 0:V.endsWith("*"))&&t[k].params["*"]!==C.params["*"]};return m==="assets"?e.filter((C,k)=>g(C,k)||c(C,k)):m==="data"?e.filter((C,k)=>{var Z;let V=a.routes[C.route.id];if(!V||!V.hasLoader)return!1;if(g(C,k)||c(C,k))return!0;if(C.route.shouldRevalidate){let Y=C.route.shouldRevalidate({currentUrl:new URL(h.pathname+h.search+h.hash,window.origin),currentParams:((Z=t[0])==null?void 0:Z.params)||{},nextUrl:new URL(i,window.origin),nextParams:C.params,defaultShouldRevalidate:!0});if(typeof Y=="boolean")return Y}return!0}):[]}function iR(i,e,{includeHydrateFallback:t}={}){return rR(i.map(a=>{let h=e.routes[a.route.id];if(!h)return[];let m=[h.module];return h.clientActionModule&&(m=m.concat(h.clientActionModule)),h.clientLoaderModule&&(m=m.concat(h.clientLoaderModule)),t&&h.hydrateFallbackModule&&(m=m.concat(h.hydrateFallbackModule)),h.imports&&(m=m.concat(h.imports)),m}).flat(1))}function rR(i){return[...new Set(i)]}function aR(i){let e={},t=Object.keys(i).sort();for(let a of t)e[a]=i[a];return e}function sR(i,e){let t=new Set;return new Set(e),i.reduce((a,h)=>{let m=JSON.stringify(aR(h));return t.has(m)||(t.add(m),a.push({key:m,link:h})),a},[])}function fE(){let i=Tt.useContext(gg);return v1(i,"You must render this element inside a <DataRouterContext.Provider> element"),i}function oR(){let i=Tt.useContext(D0);return v1(i,"You must render this element inside a <DataRouterStateContext.Provider> element"),i}var b1=Tt.createContext(void 0);b1.displayName="FrameworkContext";function pE(){let i=Tt.useContext(b1);return v1(i,"You must render this element inside a <HydratedRouter> element"),i}function lR(i,e){let t=Tt.useContext(b1),[a,h]=Tt.useState(!1),[m,g]=Tt.useState(!1),{onFocus:c,onBlur:C,onMouseEnter:k,onMouseLeave:V,onTouchStart:Z}=e,Y=Tt.useRef(null);Tt.useEffect(()=>{if(i==="render"&&g(!0),i==="viewport"){let xe=et=>{et.forEach(Qe=>{g(Qe.isIntersecting)})},ze=new IntersectionObserver(xe,{threshold:.5});return Y.current&&ze.observe(Y.current),()=>{ze.disconnect()}}},[i]),Tt.useEffect(()=>{if(a){let xe=setTimeout(()=>{g(!0)},100);return()=>{clearTimeout(xe)}}},[a]);let Q=()=>{h(!0)},be=()=>{h(!1),g(!1)};return t?i!=="intent"?[m,Y,{}]:[m,Y,{onFocus:v_(c,Q),onBlur:v_(C,be),onMouseEnter:v_(k,Q),onMouseLeave:v_(V,be),onTouchStart:v_(Z,Q)}]:[!1,Y,{}]}function v_(i,e){return t=>{i&&i(t),t.defaultPrevented||e(t)}}function uR({page:i,...e}){let{router:t}=fE(),a=Tt.useMemo(()=>nE(t.routes,i,t.basename),[t.routes,i,t.basename]);return a?Tt.createElement(hR,{page:i,matches:a,...e}):null}function cR(i){let{manifest:e,routeModules:t}=pE(),[a,h]=Tt.useState([]);return Tt.useEffect(()=>{let m=!1;return nR(i,e,t).then(g=>{m||h(g)}),()=>{m=!0}},[i,e,t]),a}function hR({page:i,matches:e,...t}){let a=tm(),{manifest:h,routeModules:m}=pE(),{basename:g}=fE(),{loaderData:c,matches:C}=oR(),k=Tt.useMemo(()=>s2(i,e,C,h,a,"data"),[i,e,C,h,a]),V=Tt.useMemo(()=>s2(i,e,C,h,a,"assets"),[i,e,C,h,a]),Z=Tt.useMemo(()=>{if(i===a.pathname+a.search+a.hash)return[];let be=new Set,xe=!1;if(e.forEach(et=>{var Xe;let Qe=h.routes[et.route.id];!Qe||!Qe.hasLoader||(!k.some(Ke=>Ke.route.id===et.route.id)&&et.route.id in c&&((Xe=m[et.route.id])!=null&&Xe.shouldRevalidate)||Qe.hasClientLoader?xe=!0:be.add(et.route.id))}),be.size===0)return[];let ze=JM(i,g,"data");return xe&&be.size>0&&ze.searchParams.set("_routes",e.filter(et=>be.has(et.route.id)).map(et=>et.route.id).join(",")),[ze.pathname+ze.search]},[g,c,a,h,k,e,i,m]),Y=Tt.useMemo(()=>iR(V,h),[V,h]),Q=cR(V);return Tt.createElement(Tt.Fragment,null,Z.map(be=>Tt.createElement("link",{key:be,rel:"prefetch",as:"fetch",href:be,...t})),Y.map(be=>Tt.createElement("link",{key:be,rel:"modulepreload",href:be,...t})),Q.map(({key:be,link:xe})=>Tt.createElement("link",{key:be,nonce:t.nonce,...xe})))}function dR(...i){return e=>{i.forEach(t=>{typeof t=="function"?t(e):t!=null&&(t.current=e)})}}var mE=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{mE&&(window.__reactRouterVersion="7.9.3")}catch{}function fR({basename:i,children:e,window:t}){let a=Tt.useRef();a.current==null&&(a.current=eM({window:t,v5Compat:!0}));let h=a.current,[m,g]=Tt.useState({action:h.action,location:h.location}),c=Tt.useCallback(C=>{Tt.startTransition(()=>g(C))},[g]);return Tt.useLayoutEffect(()=>h.listen(c),[h,c]),Tt.createElement(qM,{basename:i,children:e,location:m.location,navigationType:m.action,navigator:h})}var gE=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,_E=Tt.forwardRef(function({onClick:e,discover:t="render",prefetch:a="none",relative:h,reloadDocument:m,replace:g,state:c,target:C,to:k,preventScrollReset:V,viewTransition:Z,...Y},Q){let{basename:be}=Tt.useContext(td),xe=typeof k=="string"&&gE.test(k),ze,et=!1;if(typeof k=="string"&&xe&&(ze=k,mE))try{let me=new URL(window.location.href),Ee=k.startsWith("//")?new URL(me.protocol+k):new URL(k),De=Nd(Ee.pathname,be);Ee.origin===me.origin&&De!=null?k=De+Ee.search+Ee.hash:et=!0}catch{Qh(!1,`<Link to="${k}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let Qe=IM(k,{relative:h}),[Xe,Ke,Ve]=lR(a,Y),it=_R(k,{replace:g,state:c,target:C,preventScrollReset:V,relative:h,viewTransition:Z});function de(me){e&&e(me),me.defaultPrevented||it(me)}let ce=Tt.createElement("a",{...Y,...Ve,href:ze||Qe,onClick:et||m?e:de,ref:dR(Q,Ke),target:C,"data-discover":!xe&&t==="render"?"true":void 0});return Xe&&!xe?Tt.createElement(Tt.Fragment,null,ce,Tt.createElement(uR,{page:Qe})):ce});_E.displayName="Link";var pR=Tt.forwardRef(function({"aria-current":e="page",caseSensitive:t=!1,className:a="",end:h=!1,style:m,to:g,viewTransition:c,children:C,...k},V){let Z=dy(g,{relative:k.relative}),Y=tm(),Q=Tt.useContext(D0),{navigator:be,basename:xe}=Tt.useContext(td),ze=Q!=null&&wR(Z)&&c===!0,et=be.encodeLocation?be.encodeLocation(Z).pathname:Z.pathname,Qe=Y.pathname,Xe=Q&&Q.navigation&&Q.navigation.location?Q.navigation.location.pathname:null;t||(Qe=Qe.toLowerCase(),Xe=Xe?Xe.toLowerCase():null,et=et.toLowerCase()),Xe&&xe&&(Xe=Nd(Xe,xe)||Xe);const Ke=et!=="/"&&et.endsWith("/")?et.length-1:et.length;let Ve=Qe===et||!h&&Qe.startsWith(et)&&Qe.charAt(Ke)==="/",it=Xe!=null&&(Xe===et||!h&&Xe.startsWith(et)&&Xe.charAt(et.length)==="/"),de={isActive:Ve,isPending:it,isTransitioning:ze},ce=Ve?e:void 0,me;typeof a=="function"?me=a(de):me=[a,Ve?"active":null,it?"pending":null,ze?"transitioning":null].filter(Boolean).join(" ");let Ee=typeof m=="function"?m(de):m;return Tt.createElement(_E,{...k,"aria-current":ce,className:me,ref:V,style:Ee,to:g,viewTransition:c},typeof C=="function"?C(de):C)});pR.displayName="NavLink";var mR=Tt.forwardRef(({discover:i="render",fetcherKey:e,navigate:t,reloadDocument:a,replace:h,state:m,method:g=Ov,action:c,onSubmit:C,relative:k,preventScrollReset:V,viewTransition:Z,...Y},Q)=>{let be=bR(),xe=xR(c,{relative:k}),ze=g.toLowerCase()==="get"?"get":"post",et=typeof c=="string"&&gE.test(c),Qe=Xe=>{if(C&&C(Xe),Xe.defaultPrevented)return;Xe.preventDefault();let Ke=Xe.nativeEvent.submitter,Ve=(Ke==null?void 0:Ke.getAttribute("formmethod"))||g;be(Ke||Xe.currentTarget,{fetcherKey:e,method:Ve,navigate:t,replace:h,state:m,relative:k,preventScrollReset:V,viewTransition:Z})};return Tt.createElement("form",{ref:Q,method:ze,action:xe,onSubmit:a?C:Qe,...Y,"data-discover":!et&&i==="render"?"true":void 0})});mR.displayName="Form";function gR(i){return`${i} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function yE(i){let e=Tt.useContext(gg);return Oa(e,gR(i)),e}function _R(i,{target:e,replace:t,state:a,preventScrollReset:h,relative:m,viewTransition:g}={}){let c=CM(),C=tm(),k=dy(i,{relative:m});return Tt.useCallback(V=>{if(XM(V,e)){V.preventDefault();let Z=t!==void 0?t:q_(C)===q_(k);c(i,{replace:Z,state:a,preventScrollReset:h,relative:m,viewTransition:g})}},[C,c,k,t,a,e,i,h,m,g])}var yR=0,vR=()=>`__${String(++yR)}__`;function bR(){let{router:i}=yE("useSubmit"),{basename:e}=Tt.useContext(td),t=FM();return Tt.useCallback(async(a,h={})=>{let{action:m,method:g,encType:c,formData:C,body:k}=QM(a,e);if(h.navigate===!1){let V=h.fetcherKey||vR();await i.fetch(V,t,h.action||m,{preventScrollReset:h.preventScrollReset,formData:C,body:k,formMethod:h.method||g,formEncType:h.encType||c,flushSync:h.flushSync})}else await i.navigate(h.action||m,{preventScrollReset:h.preventScrollReset,formData:C,body:k,formMethod:h.method||g,formEncType:h.encType||c,replace:h.replace,state:h.state,fromRouteId:t,flushSync:h.flushSync,viewTransition:h.viewTransition})},[i,e,t])}function xR(i,{relative:e}={}){let{basename:t}=Tt.useContext(td),a=Tt.useContext($d);Oa(a,"useFormAction must be used inside a RouteContext");let[h]=a.matches.slice(-1),m={...dy(i||".",{relative:e})},g=tm();if(i==null){m.search=g.search;let c=new URLSearchParams(m.search),C=c.getAll("index");if(C.some(V=>V==="")){c.delete("index"),C.filter(Z=>Z).forEach(Z=>c.append("index",Z));let V=c.toString();m.search=V?`?${V}`:""}}return(!i||i===".")&&h.route.index&&(m.search=m.search?m.search.replace(/^\?/,"?index&"):"?index"),t!=="/"&&(m.pathname=m.pathname==="/"?t:Ld([t,m.pathname])),q_(m)}function wR(i,{relative:e}={}){let t=Tt.useContext(lE);Oa(t!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:a}=yE("useViewTransitionState"),h=dy(i,{relative:e});if(!t.isTransitioning)return!1;let m=Nd(t.currentLocation.pathname,a)||t.currentLocation.pathname,g=Nd(t.nextLocation.pathname,a)||t.nextLocation.pathname;return n0(h.pathname,g)!=null||n0(h.pathname,m)!=null}const vE=()=>Pe.jsxs(Pe.Fragment,{children:[Pe.jsx("div",{className:"scroll-indicator"}),Pe.jsx("nav",{children:Pe.jsxs("div",{className:"nav-container",children:[Pe.jsxs("a",{href:"./#home",className:"logo",children:["Red",Pe.jsx("span",{className:"highlight",children:"Report "})]}),Pe.jsxs("ul",{className:"nav-links",children:[Pe.jsx("li",{children:Pe.jsx("a",{href:"./#home",children:"Home"})}),Pe.jsx("li",{children:Pe.jsx("a",{href:"./#mission",children:"Mission"})}),Pe.jsx("li",{children:Pe.jsx("a",{href:"./#timeline",children:"Timeline"})}),Pe.jsx("li",{children:Pe.jsx("a",{href:"/report",className:"report-btn",children:"REPORT"})})]})]})})]}),TR=()=>Pe.jsxs("section",{id:"home",className:"hero",children:[Pe.jsxs("div",{className:"floating-elements",children:[Pe.jsx("div",{className:"floating-dot"}),Pe.jsx("div",{className:"floating-dot"}),Pe.jsx("div",{className:"floating-dot"}),Pe.jsx("div",{className:"floating-dot"})]}),Pe.jsxs("div",{className:"hero-container",children:[Pe.jsxs("div",{className:"hero-content",children:[Pe.jsxs("h1",{children:[Pe.jsx("span",{className:"highlight",children:"Student voices"}),Pe.jsx("br",{}),"SAFER CAMPUS"]}),Pe.jsx("p",{children:"Anonymous reporting tool built by and for students in the Notre Dame Tricampus community. Empowering students to share experiences without fear while creating meaningful change."}),Pe.jsx("a",{href:"#mission",className:"cta-button",children:"Learn more"})]}),Pe.jsx("div",{className:"hero-visual",children:Pe.jsx("div",{className:"campus-circle",children:Pe.jsx("img",{src:"/abstract.svg",alt:"Logo",className:"campus-image"})})})]})]}),SR=()=>Pe.jsxs("section",{id:"mission",className:"content-section",children:[Pe.jsxs("div",{className:"section-header",children:[Pe.jsxs("h2",{children:["Our ",Pe.jsx("span",{className:"highlight",children:"Mission"})]}),Pe.jsxs("p",{children:["Existing reporting systems are intimidating to the point nothing ever gets reported. ",Pe.jsx("span",{className:"highlight",children:"RedReport"})," makes everything entirely anonymous focusing on your safety."]})]}),Pe.jsxs("div",{className:"mission-grid",children:[Pe.jsxs("div",{className:"mission-card",children:[Pe.jsx("h3",{children:"Anonymous & Safe"}),Pe.jsx("p",{children:"Report experiences without fear of retaliation. We never collect any personal identifiers, our goal is to assist you when you are still not comfortable with a full report."})]}),Pe.jsxs("div",{className:"mission-card",children:[Pe.jsx("h3",{children:"Campus Wide Access to Data"}),Pe.jsx("p",{children:"We allow anyone on campus see current campus trends. No filter, we show the reality; the good, the bad, and the ugly."})]}),Pe.jsxs("div",{className:"mission-card",children:[Pe.jsx("h3",{children:"Working to prevent"}),Pe.jsx("p",{children:"We use our data to take action and prevent future cases. We wish our product didn't need to exist, so that's the goal we are working towards."})]})]}),Pe.jsxs("div",{className:"stats-grid",children:[Pe.jsxs("div",{className:"stat-card",children:[Pe.jsx("span",{className:"stat-number",children:"100%"}),Pe.jsx("span",{className:"stat-label",children:"Anonymous"})]}),Pe.jsxs("div",{className:"stat-card",children:[Pe.jsx("span",{className:"stat-number",children:"24/7"}),Pe.jsx("span",{className:"stat-label",children:"Available"})]}),Pe.jsxs("div",{className:"stat-card",children:[Pe.jsx("span",{className:"stat-number",children:"3"}),Pe.jsx("span",{className:"stat-label",children:"Campuses"})]}),Pe.jsxs("div",{className:"stat-card",children:[Pe.jsx("span",{className:"stat-number",children:""}),Pe.jsx("span",{className:"stat-label",children:"Impact"})]})]})]}),ER=()=>Pe.jsxs("section",{id:"timeline",className:"content-section",children:[Pe.jsxs("div",{className:"section-header",children:[Pe.jsxs("h2",{children:["Our ",Pe.jsx("span",{className:"highlight",children:"Timeline"})]}),Pe.jsx("p",{children:"See how RedReport is evolving to better serve the Notre Dame Tricampus community"})]}),Pe.jsxs("div",{className:"timeline",children:[Pe.jsxs("div",{className:"timeline-item",children:[Pe.jsx("div",{className:"timeline-dot"}),Pe.jsxs("div",{className:"timeline-content",children:[Pe.jsx("h3",{children:"Phase 1: Idea phase"}),Pe.jsx("p",{children:"Redreport started coming to life in notes rough prototypes and small user tests."})]})]}),Pe.jsxs("div",{className:"timeline-item",children:[Pe.jsx("div",{className:"timeline-dot"}),Pe.jsxs("div",{className:"timeline-content",children:[Pe.jsx("h3",{children:"Phase 2: Research and Proposal"}),Pe.jsxs("p",{children:["Wrote several reports backed by in depth research receiving recognition"," ",Pe.jsx("a",{href:"https://library-research-award.library.nd.edu/2025.html",children:"Hesburgh Libraries"}),"."]})]})]}),Pe.jsxs("div",{className:"timeline-item",children:[Pe.jsx("div",{className:"timeline-dot"}),Pe.jsxs("div",{className:"timeline-content current",children:[Pe.jsx("h3",{className:"highlight",children:"Phase 3: Launch"}),Pe.jsx("p",{className:"highlight",children:"Forming a small team to start making actual change across campus. Continously updating our system to get stuff done."})]})]}),Pe.jsxs("div",{className:"timeline-item",children:[Pe.jsx("div",{className:"timeline-dot"}),Pe.jsxs("div",{className:"timeline-content",children:[Pe.jsx("h3",{children:"Phase 4: Expansion"}),Pe.jsx("p",{children:"Grow team, and develop ties with campus administration to amplify Redreport's impact."})]})]})]})]}),o2=()=>(Tt.useEffect(()=>{const i=()=>{const m=window.pageYOffset,g=document.body.scrollHeight-window.innerHeight,c=m/g*100,C=document.querySelector(".scroll-indicator");C&&(C.style.width=c+"%")},e=()=>{document.querySelectorAll('a[href^="#"]').forEach(m=>{m.addEventListener("click",function(g){g.preventDefault();const c=document.querySelector(this.getAttribute("href"));c&&c.scrollIntoView({behavior:"smooth",block:"start"})})})},t=()=>{const m=new IntersectionObserver(g=>{g.forEach(c=>{c.isIntersecting&&c.target.classList.add("visible")})},{threshold:.1});document.querySelectorAll(".content-section").forEach(g=>{m.observe(g)})},a=()=>{const m=document.querySelector("nav");m&&window.addEventListener("scroll",()=>{window.scrollY>100?(m.style.background="rgba(254, 248, 243, 0.98)",m.style.boxShadow="0 2px 20px rgba(216, 47, 37, 0.1)"):(m.style.background="rgba(254, 248, 243, 0.95)",m.style.boxShadow="none")})};return e(),t(),a(),window.addEventListener("scroll",i),i(),(()=>{document.querySelectorAll(".stat-card").forEach(m=>{m.addEventListener("mouseenter",()=>{m.style.transform="scale(1.05) rotate(2deg)"}),m.addEventListener("mouseleave",()=>{m.style.transform="scale(1) rotate(0deg)"})}),document.querySelectorAll(".mission-card").forEach((m,g)=>{m.style.animationDelay=`${g*.2}s`,m.addEventListener("mouseenter",()=>{m.style.borderLeft="8px solid #D82F25"}),m.addEventListener("mouseleave",()=>{m.style.borderLeft="4px solid #D82F25"})})})(),()=>{window.removeEventListener("scroll",i)}},[]),Pe.jsxs("div",{className:"landing-page",children:[Pe.jsx(vE,{}),Pe.jsx(TR,{}),Pe.jsx(SR,{}),Pe.jsx(ER,{})]})),AR=()=>{};var l2={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bE=function(i){const e=[];let t=0;for(let a=0;a<i.length;a++){let h=i.charCodeAt(a);h<128?e[t++]=h:h<2048?(e[t++]=h>>6|192,e[t++]=h&63|128):(h&64512)===55296&&a+1<i.length&&(i.charCodeAt(a+1)&64512)===56320?(h=65536+((h&1023)<<10)+(i.charCodeAt(++a)&1023),e[t++]=h>>18|240,e[t++]=h>>12&63|128,e[t++]=h>>6&63|128,e[t++]=h&63|128):(e[t++]=h>>12|224,e[t++]=h>>6&63|128,e[t++]=h&63|128)}return e},IR=function(i){const e=[];let t=0,a=0;for(;t<i.length;){const h=i[t++];if(h<128)e[a++]=String.fromCharCode(h);else if(h>191&&h<224){const m=i[t++];e[a++]=String.fromCharCode((h&31)<<6|m&63)}else if(h>239&&h<365){const m=i[t++],g=i[t++],c=i[t++],C=((h&7)<<18|(m&63)<<12|(g&63)<<6|c&63)-65536;e[a++]=String.fromCharCode(55296+(C>>10)),e[a++]=String.fromCharCode(56320+(C&1023))}else{const m=i[t++],g=i[t++];e[a++]=String.fromCharCode((h&15)<<12|(m&63)<<6|g&63)}}return e.join("")},xE={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(i,e){if(!Array.isArray(i))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,a=[];for(let h=0;h<i.length;h+=3){const m=i[h],g=h+1<i.length,c=g?i[h+1]:0,C=h+2<i.length,k=C?i[h+2]:0,V=m>>2,Z=(m&3)<<4|c>>4;let Y=(c&15)<<2|k>>6,Q=k&63;C||(Q=64,g||(Y=64)),a.push(t[V],t[Z],t[Y],t[Q])}return a.join("")},encodeString(i,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(i):this.encodeByteArray(bE(i),e)},decodeString(i,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(i):IR(this.decodeStringToByteArray(i,e))},decodeStringToByteArray(i,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,a=[];for(let h=0;h<i.length;){const m=t[i.charAt(h++)],c=h<i.length?t[i.charAt(h)]:0;++h;const k=h<i.length?t[i.charAt(h)]:64;++h;const Z=h<i.length?t[i.charAt(h)]:64;if(++h,m==null||c==null||k==null||Z==null)throw new CR;const Y=m<<2|c>>4;if(a.push(Y),k!==64){const Q=c<<4&240|k>>2;if(a.push(Q),Z!==64){const be=k<<6&192|Z;a.push(be)}}}return a},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let i=0;i<this.ENCODED_VALS.length;i++)this.byteToCharMap_[i]=this.ENCODED_VALS.charAt(i),this.charToByteMap_[this.byteToCharMap_[i]]=i,this.byteToCharMapWebSafe_[i]=this.ENCODED_VALS_WEBSAFE.charAt(i),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[i]]=i,i>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(i)]=i,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(i)]=i)}}};class CR extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const PR=function(i){const e=bE(i);return xE.encodeByteArray(e,!0)},i0=function(i){return PR(i).replace(/\./g,"")},wE=function(i){try{return xE.decodeString(i,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function MR(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RR=()=>MR().__FIREBASE_DEFAULTS__,kR=()=>{if(typeof process>"u"||typeof l2>"u")return;const i=l2.__FIREBASE_DEFAULTS__;if(i)return JSON.parse(i)},LR=()=>{if(typeof document>"u")return;let i;try{i=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=i&&wE(i[1]);return e&&JSON.parse(e)},O0=()=>{try{return AR()||RR()||kR()||LR()}catch(i){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${i}`);return}},TE=i=>{var e,t;return(t=(e=O0())==null?void 0:e.emulatorHosts)==null?void 0:t[i]},DR=i=>{const e=TE(i);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const a=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),a]:[e.substring(0,t),a]},SE=()=>{var i;return(i=O0())==null?void 0:i.config},EE=i=>{var e;return(e=O0())==null?void 0:e[`_${i}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zR{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,a)=>{t?this.reject(t):this.resolve(a),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,a))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _g(i){try{return(i.startsWith("http://")||i.startsWith("https://")?new URL(i).hostname:i).endsWith(".cloudworkstations.dev")}catch{return!1}}async function AE(i){return(await fetch(i,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function OR(i,e){if(i.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},a=e||"demo-project",h=i.iat||0,m=i.sub||i.user_id;if(!m)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const g={iss:`https://securetoken.google.com/${a}`,aud:a,iat:h,exp:h+3600,auth_time:h,sub:m,user_id:m,firebase:{sign_in_provider:"custom",identities:{}},...i};return[i0(JSON.stringify(t)),i0(JSON.stringify(g)),""].join(".")}const R_={};function NR(){const i={prod:[],emulator:[]};for(const e of Object.keys(R_))R_[e]?i.emulator.push(e):i.prod.push(e);return i}function BR(i){let e=document.getElementById(i),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",i),t=!0),{created:t,element:e}}let u2=!1;function IE(i,e){if(typeof window>"u"||typeof document>"u"||!_g(window.location.host)||R_[i]===e||R_[i]||u2)return;R_[i]=e;function t(Y){return`__firebase__banner__${Y}`}const a="__firebase__banner",m=NR().prod.length>0;function g(){const Y=document.getElementById(a);Y&&Y.remove()}function c(Y){Y.style.display="flex",Y.style.background="#7faaf0",Y.style.position="fixed",Y.style.bottom="5px",Y.style.left="5px",Y.style.padding=".5em",Y.style.borderRadius="5px",Y.style.alignItems="center"}function C(Y,Q){Y.setAttribute("width","24"),Y.setAttribute("id",Q),Y.setAttribute("height","24"),Y.setAttribute("viewBox","0 0 24 24"),Y.setAttribute("fill","none"),Y.style.marginLeft="-6px"}function k(){const Y=document.createElement("span");return Y.style.cursor="pointer",Y.style.marginLeft="16px",Y.style.fontSize="24px",Y.innerHTML=" &times;",Y.onclick=()=>{u2=!0,g()},Y}function V(Y,Q){Y.setAttribute("id",Q),Y.innerText="Learn more",Y.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",Y.setAttribute("target","__blank"),Y.style.paddingLeft="5px",Y.style.textDecoration="underline"}function Z(){const Y=BR(a),Q=t("text"),be=document.getElementById(Q)||document.createElement("span"),xe=t("learnmore"),ze=document.getElementById(xe)||document.createElement("a"),et=t("preprendIcon"),Qe=document.getElementById(et)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(Y.created){const Xe=Y.element;c(Xe),V(ze,xe);const Ke=k();C(Qe,et),Xe.append(Qe,be,ze,Ke),document.body.appendChild(Xe)}m?(be.innerText="Preview backend disconnected.",Qe.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(Qe.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,be.innerText="Preview backend running in this workspace."),be.setAttribute("id",Q)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",Z):Z()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wl(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function FR(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(wl())}function VR(){var e;const i=(e=O0())==null?void 0:e.forceEnvironment;if(i==="node")return!0;if(i==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function UR(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function CE(){const i=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof i=="object"&&i.id!==void 0}function jR(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function qR(){const i=wl();return i.indexOf("MSIE ")>=0||i.indexOf("Trident/")>=0}function $R(){return!VR()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function PE(){try{return typeof indexedDB=="object"}catch{return!1}}function ME(){return new Promise((i,e)=>{try{let t=!0;const a="validate-browser-context-for-indexeddb-analytics-module",h=self.indexedDB.open(a);h.onsuccess=()=>{h.result.close(),t||self.indexedDB.deleteDatabase(a),i(!0)},h.onupgradeneeded=()=>{t=!1},h.onerror=()=>{var m;e(((m=h.error)==null?void 0:m.message)||"")}}catch(t){e(t)}})}function GR(){return!(typeof navigator>"u"||!navigator.cookieEnabled)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZR="FirebaseError";class lh extends Error{constructor(e,t,a){super(t),this.code=e,this.customData=a,this.name=ZR,Object.setPrototypeOf(this,lh.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,nm.prototype.create)}}class nm{constructor(e,t,a){this.service=e,this.serviceName=t,this.errors=a}create(e,...t){const a=t[0]||{},h=`${this.service}/${e}`,m=this.errors[e],g=m?HR(m,a):"Error",c=`${this.serviceName}: ${g} (${h}).`;return new lh(h,c,a)}}function HR(i,e){return i.replace(WR,(t,a)=>{const h=e[a];return h!=null?String(h):`<${a}?>`})}const WR=/\{\$([^}]+)}/g;function XR(i){for(const e in i)if(Object.prototype.hasOwnProperty.call(i,e))return!1;return!0}function Bf(i,e){if(i===e)return!0;const t=Object.keys(i),a=Object.keys(e);for(const h of t){if(!a.includes(h))return!1;const m=i[h],g=e[h];if(c2(m)&&c2(g)){if(!Bf(m,g))return!1}else if(m!==g)return!1}for(const h of a)if(!t.includes(h))return!1;return!0}function c2(i){return i!==null&&typeof i=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fy(i){const e=[];for(const[t,a]of Object.entries(i))Array.isArray(a)?a.forEach(h=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(h))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(a));return e.length?"&"+e.join("&"):""}function KR(i,e){const t=new YR(i,e);return t.subscribe.bind(t)}class YR{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(a=>{this.error(a)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,a){let h;if(e===void 0&&t===void 0&&a===void 0)throw new Error("Missing Observer.");QR(e,["next","error","complete"])?h=e:h={next:e,error:t,complete:a},h.next===void 0&&(h.next=Fb),h.error===void 0&&(h.error=Fb),h.complete===void 0&&(h.complete=Fb);const m=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?h.error(this.finalError):h.complete()}catch{}}),this.observers.push(h),m}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(a){typeof console<"u"&&console.error&&console.error(a)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function QR(i,e){if(typeof i!="object"||i===null)return!1;for(const t of e)if(t in i&&typeof i[t]=="function")return!0;return!1}function Fb(){}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JR=1e3,ek=2,tk=14400*1e3,nk=.5;function h2(i,e=JR,t=ek){const a=e*Math.pow(t,i),h=Math.round(nk*a*(Math.random()-.5)*2);return Math.min(tk,a+h)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cu(i){return i&&i._delegate?i._delegate:i}class sh{constructor(e,t,a){this.name=e,this.instanceFactory=t,this.type=a,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mp="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ik{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const a=new zR;if(this.instancesDeferred.set(t,a),this.isInitialized(t)||this.shouldAutoInitialize())try{const h=this.getOrInitializeService({instanceIdentifier:t});h&&a.resolve(h)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),a=(e==null?void 0:e.optional)??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(h){if(a)return null;throw h}else{if(a)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(ak(e))try{this.getOrInitializeService({instanceIdentifier:Mp})}catch{}for(const[t,a]of this.instancesDeferred.entries()){const h=this.normalizeInstanceIdentifier(t);try{const m=this.getOrInitializeService({instanceIdentifier:h});a.resolve(m)}catch{}}}}clearInstance(e=Mp){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Mp){return this.instances.has(e)}getOptions(e=Mp){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,a=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(a))throw Error(`${this.name}(${a}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const h=this.getOrInitializeService({instanceIdentifier:a,options:t});for(const[m,g]of this.instancesDeferred.entries()){const c=this.normalizeInstanceIdentifier(m);a===c&&g.resolve(h)}return h}onInit(e,t){const a=this.normalizeInstanceIdentifier(t),h=this.onInitCallbacks.get(a)??new Set;h.add(e),this.onInitCallbacks.set(a,h);const m=this.instances.get(a);return m&&e(m,a),()=>{h.delete(e)}}invokeOnInitCallbacks(e,t){const a=this.onInitCallbacks.get(t);if(a)for(const h of a)try{h(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let a=this.instances.get(e);if(!a&&this.component&&(a=this.component.instanceFactory(this.container,{instanceIdentifier:rk(e),options:t}),this.instances.set(e,a),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(a,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,a)}catch{}return a||null}normalizeInstanceIdentifier(e=Mp){return this.component?this.component.multipleInstances?e:Mp:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function rk(i){return i===Mp?void 0:i}function ak(i){return i.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sk{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new ik(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ki;(function(i){i[i.DEBUG=0]="DEBUG",i[i.VERBOSE=1]="VERBOSE",i[i.INFO=2]="INFO",i[i.WARN=3]="WARN",i[i.ERROR=4]="ERROR",i[i.SILENT=5]="SILENT"})(ki||(ki={}));const ok={debug:ki.DEBUG,verbose:ki.VERBOSE,info:ki.INFO,warn:ki.WARN,error:ki.ERROR,silent:ki.SILENT},lk=ki.INFO,uk={[ki.DEBUG]:"log",[ki.VERBOSE]:"log",[ki.INFO]:"info",[ki.WARN]:"warn",[ki.ERROR]:"error"},ck=(i,e,...t)=>{if(e<i.logLevel)return;const a=new Date().toISOString(),h=uk[e];if(h)console[h](`[${a}]  ${i.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class N0{constructor(e){this.name=e,this._logLevel=lk,this._logHandler=ck,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in ki))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?ok[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,ki.DEBUG,...e),this._logHandler(this,ki.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,ki.VERBOSE,...e),this._logHandler(this,ki.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,ki.INFO,...e),this._logHandler(this,ki.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,ki.WARN,...e),this._logHandler(this,ki.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,ki.ERROR,...e),this._logHandler(this,ki.ERROR,...e)}}const hk=(i,e)=>e.some(t=>i instanceof t);let d2,f2;function dk(){return d2||(d2=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function fk(){return f2||(f2=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const RE=new WeakMap,xx=new WeakMap,kE=new WeakMap,Vb=new WeakMap,x1=new WeakMap;function pk(i){const e=new Promise((t,a)=>{const h=()=>{i.removeEventListener("success",m),i.removeEventListener("error",g)},m=()=>{t(kf(i.result)),h()},g=()=>{a(i.error),h()};i.addEventListener("success",m),i.addEventListener("error",g)});return e.then(t=>{t instanceof IDBCursor&&RE.set(t,i)}).catch(()=>{}),x1.set(e,i),e}function mk(i){if(xx.has(i))return;const e=new Promise((t,a)=>{const h=()=>{i.removeEventListener("complete",m),i.removeEventListener("error",g),i.removeEventListener("abort",g)},m=()=>{t(),h()},g=()=>{a(i.error||new DOMException("AbortError","AbortError")),h()};i.addEventListener("complete",m),i.addEventListener("error",g),i.addEventListener("abort",g)});xx.set(i,e)}let wx={get(i,e,t){if(i instanceof IDBTransaction){if(e==="done")return xx.get(i);if(e==="objectStoreNames")return i.objectStoreNames||kE.get(i);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return kf(i[e])},set(i,e,t){return i[e]=t,!0},has(i,e){return i instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in i}};function gk(i){wx=i(wx)}function _k(i){return i===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const a=i.call(Ub(this),e,...t);return kE.set(a,e.sort?e.sort():[e]),kf(a)}:fk().includes(i)?function(...e){return i.apply(Ub(this),e),kf(RE.get(this))}:function(...e){return kf(i.apply(Ub(this),e))}}function yk(i){return typeof i=="function"?_k(i):(i instanceof IDBTransaction&&mk(i),hk(i,dk())?new Proxy(i,wx):i)}function kf(i){if(i instanceof IDBRequest)return pk(i);if(Vb.has(i))return Vb.get(i);const e=yk(i);return e!==i&&(Vb.set(i,e),x1.set(e,i)),e}const Ub=i=>x1.get(i);function LE(i,e,{blocked:t,upgrade:a,blocking:h,terminated:m}={}){const g=indexedDB.open(i,e),c=kf(g);return a&&g.addEventListener("upgradeneeded",C=>{a(kf(g.result),C.oldVersion,C.newVersion,kf(g.transaction),C)}),t&&g.addEventListener("blocked",C=>t(C.oldVersion,C.newVersion,C)),c.then(C=>{m&&C.addEventListener("close",()=>m()),h&&C.addEventListener("versionchange",k=>h(k.oldVersion,k.newVersion,k))}).catch(()=>{}),c}const vk=["get","getKey","getAll","getAllKeys","count"],bk=["put","add","delete","clear"],jb=new Map;function p2(i,e){if(!(i instanceof IDBDatabase&&!(e in i)&&typeof e=="string"))return;if(jb.get(e))return jb.get(e);const t=e.replace(/FromIndex$/,""),a=e!==t,h=bk.includes(t);if(!(t in(a?IDBIndex:IDBObjectStore).prototype)||!(h||vk.includes(t)))return;const m=async function(g,...c){const C=this.transaction(g,h?"readwrite":"readonly");let k=C.store;return a&&(k=k.index(c.shift())),(await Promise.all([k[t](...c),h&&C.done]))[0]};return jb.set(e,m),m}gk(i=>({...i,get:(e,t,a)=>p2(e,t)||i.get(e,t,a),has:(e,t)=>!!p2(e,t)||i.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xk{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(wk(t)){const a=t.getImmediate();return`${a.library}/${a.version}`}else return null}).filter(t=>t).join(" ")}}function wk(i){const e=i.getComponent();return(e==null?void 0:e.type)==="VERSION"}const Tx="@firebase/app",m2="0.14.3";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bd=new N0("@firebase/app"),Tk="@firebase/app-compat",Sk="@firebase/analytics-compat",Ek="@firebase/analytics",Ak="@firebase/app-check-compat",Ik="@firebase/app-check",Ck="@firebase/auth",Pk="@firebase/auth-compat",Mk="@firebase/database",Rk="@firebase/data-connect",kk="@firebase/database-compat",Lk="@firebase/functions",Dk="@firebase/functions-compat",zk="@firebase/installations",Ok="@firebase/installations-compat",Nk="@firebase/messaging",Bk="@firebase/messaging-compat",Fk="@firebase/performance",Vk="@firebase/performance-compat",Uk="@firebase/remote-config",jk="@firebase/remote-config-compat",qk="@firebase/storage",$k="@firebase/storage-compat",Gk="@firebase/firestore",Zk="@firebase/ai",Hk="@firebase/firestore-compat",Wk="firebase",Xk="12.3.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sx="[DEFAULT]",Kk={[Tx]:"fire-core",[Tk]:"fire-core-compat",[Ek]:"fire-analytics",[Sk]:"fire-analytics-compat",[Ik]:"fire-app-check",[Ak]:"fire-app-check-compat",[Ck]:"fire-auth",[Pk]:"fire-auth-compat",[Mk]:"fire-rtdb",[Rk]:"fire-data-connect",[kk]:"fire-rtdb-compat",[Lk]:"fire-fn",[Dk]:"fire-fn-compat",[zk]:"fire-iid",[Ok]:"fire-iid-compat",[Nk]:"fire-fcm",[Bk]:"fire-fcm-compat",[Fk]:"fire-perf",[Vk]:"fire-perf-compat",[Uk]:"fire-rc",[jk]:"fire-rc-compat",[qk]:"fire-gcs",[$k]:"fire-gcs-compat",[Gk]:"fire-fst",[Hk]:"fire-fst-compat",[Zk]:"fire-vertex","fire-js":"fire-js",[Wk]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const r0=new Map,Yk=new Map,Ex=new Map;function g2(i,e){try{i.container.addComponent(e)}catch(t){Bd.debug(`Component ${e.name} failed to register with FirebaseApp ${i.name}`,t)}}function Jh(i){const e=i.name;if(Ex.has(e))return Bd.debug(`There were multiple attempts to register component ${e}.`),!1;Ex.set(e,i);for(const t of r0.values())g2(t,i);for(const t of Yk.values())g2(t,i);return!0}function im(i,e){const t=i.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),i.container.getProvider(e)}function Vh(i){return i==null?!1:i.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qk={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Lf=new nm("app","Firebase",Qk);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jk{constructor(e,t,a){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=a,this.container.addComponent(new sh("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Lf.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yg=Xk;function DE(i,e={}){let t=i;typeof e!="object"&&(e={name:e});const a={name:Sx,automaticDataCollectionEnabled:!0,...e},h=a.name;if(typeof h!="string"||!h)throw Lf.create("bad-app-name",{appName:String(h)});if(t||(t=SE()),!t)throw Lf.create("no-options");const m=r0.get(h);if(m){if(Bf(t,m.options)&&Bf(a,m.config))return m;throw Lf.create("duplicate-app",{appName:h})}const g=new sk(h);for(const C of Ex.values())g.addComponent(C);const c=new Jk(t,a,g);return r0.set(h,c),c}function w1(i=Sx){const e=r0.get(i);if(!e&&i===Sx&&SE())return DE();if(!e)throw Lf.create("no-app",{appName:i});return e}function Tc(i,e,t){let a=Kk[i]??i;t&&(a+=`-${t}`);const h=a.match(/\s|\//),m=e.match(/\s|\//);if(h||m){const g=[`Unable to register library "${a}" with version "${e}":`];h&&g.push(`library name "${a}" contains illegal characters (whitespace or "/")`),h&&m&&g.push("and"),m&&g.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Bd.warn(g.join(" "));return}Jh(new sh(`${a}-version`,()=>({library:a,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eL="firebase-heartbeat-database",tL=1,$_="firebase-heartbeat-store";let qb=null;function zE(){return qb||(qb=LE(eL,tL,{upgrade:(i,e)=>{switch(e){case 0:try{i.createObjectStore($_)}catch(t){console.warn(t)}}}}).catch(i=>{throw Lf.create("idb-open",{originalErrorMessage:i.message})})),qb}async function nL(i){try{const t=(await zE()).transaction($_),a=await t.objectStore($_).get(OE(i));return await t.done,a}catch(e){if(e instanceof lh)Bd.warn(e.message);else{const t=Lf.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Bd.warn(t.message)}}}async function _2(i,e){try{const a=(await zE()).transaction($_,"readwrite");await a.objectStore($_).put(e,OE(i)),await a.done}catch(t){if(t instanceof lh)Bd.warn(t.message);else{const a=Lf.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});Bd.warn(a.message)}}}function OE(i){return`${i.name}!${i.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iL=1024,rL=30;class aL{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new oL(t),this._heartbeatsCachePromise=this._storage.read().then(a=>(this._heartbeatsCache=a,a))}async triggerHeartbeat(){var e,t;try{const h=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),m=y2();if(((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)==null?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===m||this._heartbeatsCache.heartbeats.some(g=>g.date===m))return;if(this._heartbeatsCache.heartbeats.push({date:m,agent:h}),this._heartbeatsCache.heartbeats.length>rL){const g=lL(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(g,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(a){Bd.warn(a)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=y2(),{heartbeatsToSend:a,unsentEntries:h}=sL(this._heartbeatsCache.heartbeats),m=i0(JSON.stringify({version:2,heartbeats:a}));return this._heartbeatsCache.lastSentHeartbeatDate=t,h.length>0?(this._heartbeatsCache.heartbeats=h,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),m}catch(t){return Bd.warn(t),""}}}function y2(){return new Date().toISOString().substring(0,10)}function sL(i,e=iL){const t=[];let a=i.slice();for(const h of i){const m=t.find(g=>g.agent===h.agent);if(m){if(m.dates.push(h.date),v2(t)>e){m.dates.pop();break}}else if(t.push({agent:h.agent,dates:[h.date]}),v2(t)>e){t.pop();break}a=a.slice(1)}return{heartbeatsToSend:t,unsentEntries:a}}class oL{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return PE()?ME().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await nL(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const a=await this.read();return _2(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??a.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const a=await this.read();return _2(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??a.lastSentHeartbeatDate,heartbeats:[...a.heartbeats,...e.heartbeats]})}else return}}function v2(i){return i0(JSON.stringify({version:2,heartbeats:i})).length}function lL(i){if(i.length===0)return-1;let e=0,t=i[0].date;for(let a=1;a<i.length;a++)i[a].date<t&&(t=i[a].date,e=a);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uL(i){Jh(new sh("platform-logger",e=>new xk(e),"PRIVATE")),Jh(new sh("heartbeat",e=>new aL(e),"PRIVATE")),Tc(Tx,m2,i),Tc(Tx,m2,"esm2020"),Tc("fire-js","")}uL("");var b2=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Df,NE;(function(){var i;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(de,ce){function me(){}me.prototype=ce.prototype,de.F=ce.prototype,de.prototype=new me,de.prototype.constructor=de,de.D=function(Ee,De,$e){for(var ke=Array(arguments.length-2),Bn=2;Bn<arguments.length;Bn++)ke[Bn-2]=arguments[Bn];return ce.prototype[De].apply(Ee,ke)}}function t(){this.blockSize=-1}function a(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(a,t),a.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function h(de,ce,me){me||(me=0);const Ee=Array(16);if(typeof ce=="string")for(var De=0;De<16;++De)Ee[De]=ce.charCodeAt(me++)|ce.charCodeAt(me++)<<8|ce.charCodeAt(me++)<<16|ce.charCodeAt(me++)<<24;else for(De=0;De<16;++De)Ee[De]=ce[me++]|ce[me++]<<8|ce[me++]<<16|ce[me++]<<24;ce=de.g[0],me=de.g[1],De=de.g[2];let $e=de.g[3],ke;ke=ce+($e^me&(De^$e))+Ee[0]+3614090360&4294967295,ce=me+(ke<<7&4294967295|ke>>>25),ke=$e+(De^ce&(me^De))+Ee[1]+3905402710&4294967295,$e=ce+(ke<<12&4294967295|ke>>>20),ke=De+(me^$e&(ce^me))+Ee[2]+606105819&4294967295,De=$e+(ke<<17&4294967295|ke>>>15),ke=me+(ce^De&($e^ce))+Ee[3]+3250441966&4294967295,me=De+(ke<<22&4294967295|ke>>>10),ke=ce+($e^me&(De^$e))+Ee[4]+4118548399&4294967295,ce=me+(ke<<7&4294967295|ke>>>25),ke=$e+(De^ce&(me^De))+Ee[5]+1200080426&4294967295,$e=ce+(ke<<12&4294967295|ke>>>20),ke=De+(me^$e&(ce^me))+Ee[6]+2821735955&4294967295,De=$e+(ke<<17&4294967295|ke>>>15),ke=me+(ce^De&($e^ce))+Ee[7]+4249261313&4294967295,me=De+(ke<<22&4294967295|ke>>>10),ke=ce+($e^me&(De^$e))+Ee[8]+1770035416&4294967295,ce=me+(ke<<7&4294967295|ke>>>25),ke=$e+(De^ce&(me^De))+Ee[9]+2336552879&4294967295,$e=ce+(ke<<12&4294967295|ke>>>20),ke=De+(me^$e&(ce^me))+Ee[10]+4294925233&4294967295,De=$e+(ke<<17&4294967295|ke>>>15),ke=me+(ce^De&($e^ce))+Ee[11]+2304563134&4294967295,me=De+(ke<<22&4294967295|ke>>>10),ke=ce+($e^me&(De^$e))+Ee[12]+1804603682&4294967295,ce=me+(ke<<7&4294967295|ke>>>25),ke=$e+(De^ce&(me^De))+Ee[13]+4254626195&4294967295,$e=ce+(ke<<12&4294967295|ke>>>20),ke=De+(me^$e&(ce^me))+Ee[14]+2792965006&4294967295,De=$e+(ke<<17&4294967295|ke>>>15),ke=me+(ce^De&($e^ce))+Ee[15]+1236535329&4294967295,me=De+(ke<<22&4294967295|ke>>>10),ke=ce+(De^$e&(me^De))+Ee[1]+4129170786&4294967295,ce=me+(ke<<5&4294967295|ke>>>27),ke=$e+(me^De&(ce^me))+Ee[6]+3225465664&4294967295,$e=ce+(ke<<9&4294967295|ke>>>23),ke=De+(ce^me&($e^ce))+Ee[11]+643717713&4294967295,De=$e+(ke<<14&4294967295|ke>>>18),ke=me+($e^ce&(De^$e))+Ee[0]+3921069994&4294967295,me=De+(ke<<20&4294967295|ke>>>12),ke=ce+(De^$e&(me^De))+Ee[5]+3593408605&4294967295,ce=me+(ke<<5&4294967295|ke>>>27),ke=$e+(me^De&(ce^me))+Ee[10]+38016083&4294967295,$e=ce+(ke<<9&4294967295|ke>>>23),ke=De+(ce^me&($e^ce))+Ee[15]+3634488961&4294967295,De=$e+(ke<<14&4294967295|ke>>>18),ke=me+($e^ce&(De^$e))+Ee[4]+3889429448&4294967295,me=De+(ke<<20&4294967295|ke>>>12),ke=ce+(De^$e&(me^De))+Ee[9]+568446438&4294967295,ce=me+(ke<<5&4294967295|ke>>>27),ke=$e+(me^De&(ce^me))+Ee[14]+3275163606&4294967295,$e=ce+(ke<<9&4294967295|ke>>>23),ke=De+(ce^me&($e^ce))+Ee[3]+4107603335&4294967295,De=$e+(ke<<14&4294967295|ke>>>18),ke=me+($e^ce&(De^$e))+Ee[8]+1163531501&4294967295,me=De+(ke<<20&4294967295|ke>>>12),ke=ce+(De^$e&(me^De))+Ee[13]+2850285829&4294967295,ce=me+(ke<<5&4294967295|ke>>>27),ke=$e+(me^De&(ce^me))+Ee[2]+4243563512&4294967295,$e=ce+(ke<<9&4294967295|ke>>>23),ke=De+(ce^me&($e^ce))+Ee[7]+1735328473&4294967295,De=$e+(ke<<14&4294967295|ke>>>18),ke=me+($e^ce&(De^$e))+Ee[12]+2368359562&4294967295,me=De+(ke<<20&4294967295|ke>>>12),ke=ce+(me^De^$e)+Ee[5]+4294588738&4294967295,ce=me+(ke<<4&4294967295|ke>>>28),ke=$e+(ce^me^De)+Ee[8]+2272392833&4294967295,$e=ce+(ke<<11&4294967295|ke>>>21),ke=De+($e^ce^me)+Ee[11]+1839030562&4294967295,De=$e+(ke<<16&4294967295|ke>>>16),ke=me+(De^$e^ce)+Ee[14]+4259657740&4294967295,me=De+(ke<<23&4294967295|ke>>>9),ke=ce+(me^De^$e)+Ee[1]+2763975236&4294967295,ce=me+(ke<<4&4294967295|ke>>>28),ke=$e+(ce^me^De)+Ee[4]+1272893353&4294967295,$e=ce+(ke<<11&4294967295|ke>>>21),ke=De+($e^ce^me)+Ee[7]+4139469664&4294967295,De=$e+(ke<<16&4294967295|ke>>>16),ke=me+(De^$e^ce)+Ee[10]+3200236656&4294967295,me=De+(ke<<23&4294967295|ke>>>9),ke=ce+(me^De^$e)+Ee[13]+681279174&4294967295,ce=me+(ke<<4&4294967295|ke>>>28),ke=$e+(ce^me^De)+Ee[0]+3936430074&4294967295,$e=ce+(ke<<11&4294967295|ke>>>21),ke=De+($e^ce^me)+Ee[3]+3572445317&4294967295,De=$e+(ke<<16&4294967295|ke>>>16),ke=me+(De^$e^ce)+Ee[6]+76029189&4294967295,me=De+(ke<<23&4294967295|ke>>>9),ke=ce+(me^De^$e)+Ee[9]+3654602809&4294967295,ce=me+(ke<<4&4294967295|ke>>>28),ke=$e+(ce^me^De)+Ee[12]+3873151461&4294967295,$e=ce+(ke<<11&4294967295|ke>>>21),ke=De+($e^ce^me)+Ee[15]+530742520&4294967295,De=$e+(ke<<16&4294967295|ke>>>16),ke=me+(De^$e^ce)+Ee[2]+3299628645&4294967295,me=De+(ke<<23&4294967295|ke>>>9),ke=ce+(De^(me|~$e))+Ee[0]+4096336452&4294967295,ce=me+(ke<<6&4294967295|ke>>>26),ke=$e+(me^(ce|~De))+Ee[7]+1126891415&4294967295,$e=ce+(ke<<10&4294967295|ke>>>22),ke=De+(ce^($e|~me))+Ee[14]+2878612391&4294967295,De=$e+(ke<<15&4294967295|ke>>>17),ke=me+($e^(De|~ce))+Ee[5]+4237533241&4294967295,me=De+(ke<<21&4294967295|ke>>>11),ke=ce+(De^(me|~$e))+Ee[12]+1700485571&4294967295,ce=me+(ke<<6&4294967295|ke>>>26),ke=$e+(me^(ce|~De))+Ee[3]+2399980690&4294967295,$e=ce+(ke<<10&4294967295|ke>>>22),ke=De+(ce^($e|~me))+Ee[10]+4293915773&4294967295,De=$e+(ke<<15&4294967295|ke>>>17),ke=me+($e^(De|~ce))+Ee[1]+2240044497&4294967295,me=De+(ke<<21&4294967295|ke>>>11),ke=ce+(De^(me|~$e))+Ee[8]+1873313359&4294967295,ce=me+(ke<<6&4294967295|ke>>>26),ke=$e+(me^(ce|~De))+Ee[15]+4264355552&4294967295,$e=ce+(ke<<10&4294967295|ke>>>22),ke=De+(ce^($e|~me))+Ee[6]+2734768916&4294967295,De=$e+(ke<<15&4294967295|ke>>>17),ke=me+($e^(De|~ce))+Ee[13]+1309151649&4294967295,me=De+(ke<<21&4294967295|ke>>>11),ke=ce+(De^(me|~$e))+Ee[4]+4149444226&4294967295,ce=me+(ke<<6&4294967295|ke>>>26),ke=$e+(me^(ce|~De))+Ee[11]+3174756917&4294967295,$e=ce+(ke<<10&4294967295|ke>>>22),ke=De+(ce^($e|~me))+Ee[2]+718787259&4294967295,De=$e+(ke<<15&4294967295|ke>>>17),ke=me+($e^(De|~ce))+Ee[9]+3951481745&4294967295,de.g[0]=de.g[0]+ce&4294967295,de.g[1]=de.g[1]+(De+(ke<<21&4294967295|ke>>>11))&4294967295,de.g[2]=de.g[2]+De&4294967295,de.g[3]=de.g[3]+$e&4294967295}a.prototype.v=function(de,ce){ce===void 0&&(ce=de.length);const me=ce-this.blockSize,Ee=this.C;let De=this.h,$e=0;for(;$e<ce;){if(De==0)for(;$e<=me;)h(this,de,$e),$e+=this.blockSize;if(typeof de=="string"){for(;$e<ce;)if(Ee[De++]=de.charCodeAt($e++),De==this.blockSize){h(this,Ee),De=0;break}}else for(;$e<ce;)if(Ee[De++]=de[$e++],De==this.blockSize){h(this,Ee),De=0;break}}this.h=De,this.o+=ce},a.prototype.A=function(){var de=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);de[0]=128;for(var ce=1;ce<de.length-8;++ce)de[ce]=0;ce=this.o*8;for(var me=de.length-8;me<de.length;++me)de[me]=ce&255,ce/=256;for(this.v(de),de=Array(16),ce=0,me=0;me<4;++me)for(let Ee=0;Ee<32;Ee+=8)de[ce++]=this.g[me]>>>Ee&255;return de};function m(de,ce){var me=c;return Object.prototype.hasOwnProperty.call(me,de)?me[de]:me[de]=ce(de)}function g(de,ce){this.h=ce;const me=[];let Ee=!0;for(let De=de.length-1;De>=0;De--){const $e=de[De]|0;Ee&&$e==ce||(me[De]=$e,Ee=!1)}this.g=me}var c={};function C(de){return-128<=de&&de<128?m(de,function(ce){return new g([ce|0],ce<0?-1:0)}):new g([de|0],de<0?-1:0)}function k(de){if(isNaN(de)||!isFinite(de))return Z;if(de<0)return ze(k(-de));const ce=[];let me=1;for(let Ee=0;de>=me;Ee++)ce[Ee]=de/me|0,me*=4294967296;return new g(ce,0)}function V(de,ce){if(de.length==0)throw Error("number format error: empty string");if(ce=ce||10,ce<2||36<ce)throw Error("radix out of range: "+ce);if(de.charAt(0)=="-")return ze(V(de.substring(1),ce));if(de.indexOf("-")>=0)throw Error('number format error: interior "-" character');const me=k(Math.pow(ce,8));let Ee=Z;for(let $e=0;$e<de.length;$e+=8){var De=Math.min(8,de.length-$e);const ke=parseInt(de.substring($e,$e+De),ce);De<8?(De=k(Math.pow(ce,De)),Ee=Ee.j(De).add(k(ke))):(Ee=Ee.j(me),Ee=Ee.add(k(ke)))}return Ee}var Z=C(0),Y=C(1),Q=C(16777216);i=g.prototype,i.m=function(){if(xe(this))return-ze(this).m();let de=0,ce=1;for(let me=0;me<this.g.length;me++){const Ee=this.i(me);de+=(Ee>=0?Ee:4294967296+Ee)*ce,ce*=4294967296}return de},i.toString=function(de){if(de=de||10,de<2||36<de)throw Error("radix out of range: "+de);if(be(this))return"0";if(xe(this))return"-"+ze(this).toString(de);const ce=k(Math.pow(de,6));var me=this;let Ee="";for(;;){const De=Ke(me,ce).g;me=et(me,De.j(ce));let $e=((me.g.length>0?me.g[0]:me.h)>>>0).toString(de);if(me=De,be(me))return $e+Ee;for(;$e.length<6;)$e="0"+$e;Ee=$e+Ee}},i.i=function(de){return de<0?0:de<this.g.length?this.g[de]:this.h};function be(de){if(de.h!=0)return!1;for(let ce=0;ce<de.g.length;ce++)if(de.g[ce]!=0)return!1;return!0}function xe(de){return de.h==-1}i.l=function(de){return de=et(this,de),xe(de)?-1:be(de)?0:1};function ze(de){const ce=de.g.length,me=[];for(let Ee=0;Ee<ce;Ee++)me[Ee]=~de.g[Ee];return new g(me,~de.h).add(Y)}i.abs=function(){return xe(this)?ze(this):this},i.add=function(de){const ce=Math.max(this.g.length,de.g.length),me=[];let Ee=0;for(let De=0;De<=ce;De++){let $e=Ee+(this.i(De)&65535)+(de.i(De)&65535),ke=($e>>>16)+(this.i(De)>>>16)+(de.i(De)>>>16);Ee=ke>>>16,$e&=65535,ke&=65535,me[De]=ke<<16|$e}return new g(me,me[me.length-1]&-2147483648?-1:0)};function et(de,ce){return de.add(ze(ce))}i.j=function(de){if(be(this)||be(de))return Z;if(xe(this))return xe(de)?ze(this).j(ze(de)):ze(ze(this).j(de));if(xe(de))return ze(this.j(ze(de)));if(this.l(Q)<0&&de.l(Q)<0)return k(this.m()*de.m());const ce=this.g.length+de.g.length,me=[];for(var Ee=0;Ee<2*ce;Ee++)me[Ee]=0;for(Ee=0;Ee<this.g.length;Ee++)for(let De=0;De<de.g.length;De++){const $e=this.i(Ee)>>>16,ke=this.i(Ee)&65535,Bn=de.i(De)>>>16,ti=de.i(De)&65535;me[2*Ee+2*De]+=ke*ti,Qe(me,2*Ee+2*De),me[2*Ee+2*De+1]+=$e*ti,Qe(me,2*Ee+2*De+1),me[2*Ee+2*De+1]+=ke*Bn,Qe(me,2*Ee+2*De+1),me[2*Ee+2*De+2]+=$e*Bn,Qe(me,2*Ee+2*De+2)}for(de=0;de<ce;de++)me[de]=me[2*de+1]<<16|me[2*de];for(de=ce;de<2*ce;de++)me[de]=0;return new g(me,0)};function Qe(de,ce){for(;(de[ce]&65535)!=de[ce];)de[ce+1]+=de[ce]>>>16,de[ce]&=65535,ce++}function Xe(de,ce){this.g=de,this.h=ce}function Ke(de,ce){if(be(ce))throw Error("division by zero");if(be(de))return new Xe(Z,Z);if(xe(de))return ce=Ke(ze(de),ce),new Xe(ze(ce.g),ze(ce.h));if(xe(ce))return ce=Ke(de,ze(ce)),new Xe(ze(ce.g),ce.h);if(de.g.length>30){if(xe(de)||xe(ce))throw Error("slowDivide_ only works with positive integers.");for(var me=Y,Ee=ce;Ee.l(de)<=0;)me=Ve(me),Ee=Ve(Ee);var De=it(me,1),$e=it(Ee,1);for(Ee=it(Ee,2),me=it(me,2);!be(Ee);){var ke=$e.add(Ee);ke.l(de)<=0&&(De=De.add(me),$e=ke),Ee=it(Ee,1),me=it(me,1)}return ce=et(de,De.j(ce)),new Xe(De,ce)}for(De=Z;de.l(ce)>=0;){for(me=Math.max(1,Math.floor(de.m()/ce.m())),Ee=Math.ceil(Math.log(me)/Math.LN2),Ee=Ee<=48?1:Math.pow(2,Ee-48),$e=k(me),ke=$e.j(ce);xe(ke)||ke.l(de)>0;)me-=Ee,$e=k(me),ke=$e.j(ce);be($e)&&($e=Y),De=De.add($e),de=et(de,ke)}return new Xe(De,de)}i.B=function(de){return Ke(this,de).h},i.and=function(de){const ce=Math.max(this.g.length,de.g.length),me=[];for(let Ee=0;Ee<ce;Ee++)me[Ee]=this.i(Ee)&de.i(Ee);return new g(me,this.h&de.h)},i.or=function(de){const ce=Math.max(this.g.length,de.g.length),me=[];for(let Ee=0;Ee<ce;Ee++)me[Ee]=this.i(Ee)|de.i(Ee);return new g(me,this.h|de.h)},i.xor=function(de){const ce=Math.max(this.g.length,de.g.length),me=[];for(let Ee=0;Ee<ce;Ee++)me[Ee]=this.i(Ee)^de.i(Ee);return new g(me,this.h^de.h)};function Ve(de){const ce=de.g.length+1,me=[];for(let Ee=0;Ee<ce;Ee++)me[Ee]=de.i(Ee)<<1|de.i(Ee-1)>>>31;return new g(me,de.h)}function it(de,ce){const me=ce>>5;ce%=32;const Ee=de.g.length-me,De=[];for(let $e=0;$e<Ee;$e++)De[$e]=ce>0?de.i($e+me)>>>ce|de.i($e+me+1)<<32-ce:de.i($e+me);return new g(De,de.h)}a.prototype.digest=a.prototype.A,a.prototype.reset=a.prototype.u,a.prototype.update=a.prototype.v,NE=a,g.prototype.add=g.prototype.add,g.prototype.multiply=g.prototype.j,g.prototype.modulo=g.prototype.B,g.prototype.compare=g.prototype.l,g.prototype.toNumber=g.prototype.m,g.prototype.toString=g.prototype.toString,g.prototype.getBits=g.prototype.i,g.fromNumber=k,g.fromString=V,Df=g}).apply(typeof b2<"u"?b2:typeof self<"u"?self:typeof window<"u"?window:{});var wv=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var BE,w_,FE,Bv,Ax,VE,UE,jE;(function(){var i,e=Object.defineProperty;function t(M){M=[typeof globalThis=="object"&&globalThis,M,typeof window=="object"&&window,typeof self=="object"&&self,typeof wv=="object"&&wv];for(var G=0;G<M.length;++G){var te=M[G];if(te&&te.Math==Math)return te}throw Error("Cannot find global object")}var a=t(this);function h(M,G){if(G)e:{var te=a;M=M.split(".");for(var ye=0;ye<M.length-1;ye++){var at=M[ye];if(!(at in te))break e;te=te[at]}M=M[M.length-1],ye=te[M],G=G(ye),G!=ye&&G!=null&&e(te,M,{configurable:!0,writable:!0,value:G})}}h("Symbol.dispose",function(M){return M||Symbol("Symbol.dispose")}),h("Array.prototype.values",function(M){return M||function(){return this[Symbol.iterator]()}}),h("Object.entries",function(M){return M||function(G){var te=[],ye;for(ye in G)Object.prototype.hasOwnProperty.call(G,ye)&&te.push([ye,G[ye]]);return te}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var m=m||{},g=this||self;function c(M){var G=typeof M;return G=="object"&&M!=null||G=="function"}function C(M,G,te){return M.call.apply(M.bind,arguments)}function k(M,G,te){return k=C,k.apply(null,arguments)}function V(M,G){var te=Array.prototype.slice.call(arguments,1);return function(){var ye=te.slice();return ye.push.apply(ye,arguments),M.apply(this,ye)}}function Z(M,G){function te(){}te.prototype=G.prototype,M.Z=G.prototype,M.prototype=new te,M.prototype.constructor=M,M.Ob=function(ye,at,pt){for(var Wt=Array(arguments.length-2),kn=2;kn<arguments.length;kn++)Wt[kn-2]=arguments[kn];return G.prototype[at].apply(ye,Wt)}}var Y=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?M=>M&&AsyncContext.Snapshot.wrap(M):M=>M;function Q(M){const G=M.length;if(G>0){const te=Array(G);for(let ye=0;ye<G;ye++)te[ye]=M[ye];return te}return[]}function be(M,G){for(let ye=1;ye<arguments.length;ye++){const at=arguments[ye];var te=typeof at;if(te=te!="object"?te:at?Array.isArray(at)?"array":te:"null",te=="array"||te=="object"&&typeof at.length=="number"){te=M.length||0;const pt=at.length||0;M.length=te+pt;for(let Wt=0;Wt<pt;Wt++)M[te+Wt]=at[Wt]}else M.push(at)}}class xe{constructor(G,te){this.i=G,this.j=te,this.h=0,this.g=null}get(){let G;return this.h>0?(this.h--,G=this.g,this.g=G.next,G.next=null):G=this.i(),G}}function ze(M){g.setTimeout(()=>{throw M},0)}function et(){var M=de;let G=null;return M.g&&(G=M.g,M.g=M.g.next,M.g||(M.h=null),G.next=null),G}class Qe{constructor(){this.h=this.g=null}add(G,te){const ye=Xe.get();ye.set(G,te),this.h?this.h.next=ye:this.g=ye,this.h=ye}}var Xe=new xe(()=>new Ke,M=>M.reset());class Ke{constructor(){this.next=this.g=this.h=null}set(G,te){this.h=G,this.g=te,this.next=null}reset(){this.next=this.g=this.h=null}}let Ve,it=!1,de=new Qe,ce=()=>{const M=Promise.resolve(void 0);Ve=()=>{M.then(me)}};function me(){for(var M;M=et();){try{M.h.call(M.g)}catch(te){ze(te)}var G=Xe;G.j(M),G.h<100&&(G.h++,M.next=G.g,G.g=M)}it=!1}function Ee(){this.u=this.u,this.C=this.C}Ee.prototype.u=!1,Ee.prototype.dispose=function(){this.u||(this.u=!0,this.N())},Ee.prototype[Symbol.dispose]=function(){this.dispose()},Ee.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function De(M,G){this.type=M,this.g=this.target=G,this.defaultPrevented=!1}De.prototype.h=function(){this.defaultPrevented=!0};var $e=(function(){if(!g.addEventListener||!Object.defineProperty)return!1;var M=!1,G=Object.defineProperty({},"passive",{get:function(){M=!0}});try{const te=()=>{};g.addEventListener("test",te,G),g.removeEventListener("test",te,G)}catch{}return M})();function ke(M){return/^[\s\xa0]*$/.test(M)}function Bn(M,G){De.call(this,M?M.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,M&&this.init(M,G)}Z(Bn,De),Bn.prototype.init=function(M,G){const te=this.type=M.type,ye=M.changedTouches&&M.changedTouches.length?M.changedTouches[0]:null;this.target=M.target||M.srcElement,this.g=G,G=M.relatedTarget,G||(te=="mouseover"?G=M.fromElement:te=="mouseout"&&(G=M.toElement)),this.relatedTarget=G,ye?(this.clientX=ye.clientX!==void 0?ye.clientX:ye.pageX,this.clientY=ye.clientY!==void 0?ye.clientY:ye.pageY,this.screenX=ye.screenX||0,this.screenY=ye.screenY||0):(this.clientX=M.clientX!==void 0?M.clientX:M.pageX,this.clientY=M.clientY!==void 0?M.clientY:M.pageY,this.screenX=M.screenX||0,this.screenY=M.screenY||0),this.button=M.button,this.key=M.key||"",this.ctrlKey=M.ctrlKey,this.altKey=M.altKey,this.shiftKey=M.shiftKey,this.metaKey=M.metaKey,this.pointerId=M.pointerId||0,this.pointerType=M.pointerType,this.state=M.state,this.i=M,M.defaultPrevented&&Bn.Z.h.call(this)},Bn.prototype.h=function(){Bn.Z.h.call(this);const M=this.i;M.preventDefault?M.preventDefault():M.returnValue=!1};var ti="closure_listenable_"+(Math.random()*1e6|0),gt=0;function Zt(M,G,te,ye,at){this.listener=M,this.proxy=null,this.src=G,this.type=te,this.capture=!!ye,this.ha=at,this.key=++gt,this.da=this.fa=!1}function xt(M){M.da=!0,M.listener=null,M.proxy=null,M.src=null,M.ha=null}function jt(M,G,te){for(const ye in M)G.call(te,M[ye],ye,M)}function Ie(M,G){for(const te in M)G.call(void 0,M[te],te,M)}function lt(M){const G={};for(const te in M)G[te]=M[te];return G}const Dt="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function zt(M,G){let te,ye;for(let at=1;at<arguments.length;at++){ye=arguments[at];for(te in ye)M[te]=ye[te];for(let pt=0;pt<Dt.length;pt++)te=Dt[pt],Object.prototype.hasOwnProperty.call(ye,te)&&(M[te]=ye[te])}}function Xt(M){this.src=M,this.g={},this.h=0}Xt.prototype.add=function(M,G,te,ye,at){const pt=M.toString();M=this.g[pt],M||(M=this.g[pt]=[],this.h++);const Wt=Ft(M,G,ye,at);return Wt>-1?(G=M[Wt],te||(G.fa=!1)):(G=new Zt(G,this.src,pt,!!ye,at),G.fa=te,M.push(G)),G};function an(M,G){const te=G.type;if(te in M.g){var ye=M.g[te],at=Array.prototype.indexOf.call(ye,G,void 0),pt;(pt=at>=0)&&Array.prototype.splice.call(ye,at,1),pt&&(xt(G),M.g[te].length==0&&(delete M.g[te],M.h--))}}function Ft(M,G,te,ye){for(let at=0;at<M.length;++at){const pt=M[at];if(!pt.da&&pt.listener==G&&pt.capture==!!te&&pt.ha==ye)return at}return-1}var Ci="closure_lm_"+(Math.random()*1e6|0),qn={};function zr(M,G,te,ye,at){if(Array.isArray(G)){for(let pt=0;pt<G.length;pt++)zr(M,G[pt],te,ye,at);return null}return te=Ba(te),M&&M[ti]?M.J(G,te,c(ye)?!!ye.capture:!1,at):co(M,G,te,!1,ye,at)}function co(M,G,te,ye,at,pt){if(!G)throw Error("Invalid event type");const Wt=c(at)?!!at.capture:!!at;let kn=Xa(M);if(kn||(M[Ci]=kn=new Xt(M)),te=kn.add(G,te,ye,Wt,pt),te.proxy)return te;if(ye=Us(),te.proxy=ye,ye.src=M,ye.listener=te,M.addEventListener)$e||(at=Wt),at===void 0&&(at=!1),M.addEventListener(G.toString(),ye,at);else if(M.attachEvent)M.attachEvent(er(G.toString()),ye);else if(M.addListener&&M.removeListener)M.addListener(ye);else throw Error("addEventListener and attachEvent are unavailable.");return te}function Us(){function M(te){return G.call(M.src,M.listener,te)}const G=ds;return M}function Or(M,G,te,ye,at){if(Array.isArray(G))for(var pt=0;pt<G.length;pt++)Or(M,G[pt],te,ye,at);else ye=c(ye)?!!ye.capture:!!ye,te=Ba(te),M&&M[ti]?(M=M.i,pt=String(G).toString(),pt in M.g&&(G=M.g[pt],te=Ft(G,te,ye,at),te>-1&&(xt(G[te]),Array.prototype.splice.call(G,te,1),G.length==0&&(delete M.g[pt],M.h--)))):M&&(M=Xa(M))&&(G=M.g[G.toString()],M=-1,G&&(M=Ft(G,te,ye,at)),(te=M>-1?G[M]:null)&&Pi(te))}function Pi(M){if(typeof M!="number"&&M&&!M.da){var G=M.src;if(G&&G[ti])an(G.i,M);else{var te=M.type,ye=M.proxy;G.removeEventListener?G.removeEventListener(te,ye,M.capture):G.detachEvent?G.detachEvent(er(te),ye):G.addListener&&G.removeListener&&G.removeListener(ye),(te=Xa(G))?(an(te,M),te.h==0&&(te.src=null,G[Ci]=null)):xt(M)}}}function er(M){return M in qn?qn[M]:qn[M]="on"+M}function ds(M,G){if(M.da)M=!0;else{G=new Bn(G,this);const te=M.listener,ye=M.ha||M.src;M.fa&&Pi(M),M=te.call(ye,G)}return M}function Xa(M){return M=M[Ci],M instanceof Xt?M:null}var Nr="__closure_events_fn_"+(Math.random()*1e9>>>0);function Ba(M){return typeof M=="function"?M:(M[Nr]||(M[Nr]=function(G){return M.handleEvent(G)}),M[Nr])}function Fi(){Ee.call(this),this.i=new Xt(this),this.M=this,this.G=null}Z(Fi,Ee),Fi.prototype[ti]=!0,Fi.prototype.removeEventListener=function(M,G,te,ye){Or(this,M,G,te,ye)};function fr(M,G){var te,ye=M.G;if(ye)for(te=[];ye;ye=ye.G)te.push(ye);if(M=M.M,ye=G.type||G,typeof G=="string")G=new De(G,M);else if(G instanceof De)G.target=G.target||M;else{var at=G;G=new De(ye,M),zt(G,at)}at=!0;let pt,Wt;if(te)for(Wt=te.length-1;Wt>=0;Wt--)pt=G.g=te[Wt],at=fa(pt,ye,!0,G)&&at;if(pt=G.g=M,at=fa(pt,ye,!0,G)&&at,at=fa(pt,ye,!1,G)&&at,te)for(Wt=0;Wt<te.length;Wt++)pt=G.g=te[Wt],at=fa(pt,ye,!1,G)&&at}Fi.prototype.N=function(){if(Fi.Z.N.call(this),this.i){var M=this.i;for(const G in M.g){const te=M.g[G];for(let ye=0;ye<te.length;ye++)xt(te[ye]);delete M.g[G],M.h--}}this.G=null},Fi.prototype.J=function(M,G,te,ye){return this.i.add(String(M),G,!1,te,ye)},Fi.prototype.K=function(M,G,te,ye){return this.i.add(String(M),G,!0,te,ye)};function fa(M,G,te,ye){if(G=M.i.g[String(G)],!G)return!0;G=G.concat();let at=!0;for(let pt=0;pt<G.length;++pt){const Wt=G[pt];if(Wt&&!Wt.da&&Wt.capture==te){const kn=Wt.listener,$n=Wt.ha||Wt.src;Wt.fa&&an(M.i,Wt),at=kn.call($n,ye)!==!1&&at}}return at&&!ye.defaultPrevented}function Po(M,G){if(typeof M!="function")if(M&&typeof M.handleEvent=="function")M=k(M.handleEvent,M);else throw Error("Invalid listener argument");return Number(G)>2147483647?-1:g.setTimeout(M,G||0)}function js(M){M.g=Po(()=>{M.g=null,M.i&&(M.i=!1,js(M))},M.l);const G=M.h;M.h=null,M.m.apply(null,G)}class Tl extends Ee{constructor(G,te){super(),this.m=G,this.l=te,this.h=null,this.i=!1,this.g=null}j(G){this.h=arguments,this.g?this.i=!0:js(this)}N(){super.N(),this.g&&(g.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function fs(M){Ee.call(this),this.h=M,this.g={}}Z(fs,Ee);var Ta=[];function pr(M){jt(M.g,function(G,te){this.g.hasOwnProperty(te)&&Pi(G)},M),M.g={}}fs.prototype.N=function(){fs.Z.N.call(this),pr(this)},fs.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var pa=g.JSON.stringify,je=g.JSON.parse,se=class{stringify(M){return g.JSON.stringify(M,void 0)}parse(M){return g.JSON.parse(M,void 0)}};function le(){}function fe(){}var Se={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function Ne(){De.call(this,"d")}Z(Ne,De);function Ge(){De.call(this,"c")}Z(Ge,De);var Je={},Ze=null;function yt(){return Ze=Ze||new Fi}Je.Ia="serverreachability";function At(M){De.call(this,Je.Ia,M)}Z(At,De);function bt(M){const G=yt();fr(G,new At(G))}Je.STAT_EVENT="statevent";function en(M,G){De.call(this,Je.STAT_EVENT,M),this.stat=G}Z(en,De);function qe(M){const G=yt();fr(G,new en(G,M))}Je.Ja="timingevent";function Cn(M,G){De.call(this,Je.Ja,M),this.size=G}Z(Cn,De);function Fn(M,G){if(typeof M!="function")throw Error("Fn must not be null and must be a function");return g.setTimeout(function(){M()},G)}function rn(){this.g=!0}rn.prototype.ua=function(){this.g=!1};function Dn(M,G,te,ye,at,pt){M.info(function(){if(M.g)if(pt){var Wt="",kn=pt.split("&");for(let Ri=0;Ri<kn.length;Ri++){var $n=kn[Ri].split("=");if($n.length>1){const ur=$n[0];$n=$n[1];const Ca=ur.split("_");Wt=Ca.length>=2&&Ca[1]=="type"?Wt+(ur+"="+$n+"&"):Wt+(ur+"=redacted&")}}}else Wt=null;else Wt=pt;return"XMLHTTP REQ ("+ye+") [attempt "+at+"]: "+G+`
`+te+`
`+Wt})}function wi(M,G,te,ye,at,pt,Wt){M.info(function(){return"XMLHTTP RESP ("+ye+") [ attempt "+at+"]: "+G+`
`+te+`
`+pt+" "+Wt})}function Xi(M,G,te,ye){M.info(function(){return"XMLHTTP TEXT ("+G+"): "+Mi(M,te)+(ye?" "+ye:"")})}function Er(M,G){M.info(function(){return"TIMEOUT: "+G})}rn.prototype.info=function(){};function Mi(M,G){if(!M.g)return G;if(!G)return null;try{const pt=JSON.parse(G);if(pt){for(M=0;M<pt.length;M++)if(Array.isArray(pt[M])){var te=pt[M];if(!(te.length<2)){var ye=te[1];if(Array.isArray(ye)&&!(ye.length<1)){var at=ye[0];if(at!="noop"&&at!="stop"&&at!="close")for(let Wt=1;Wt<ye.length;Wt++)ye[Wt]=""}}}}return pa(pt)}catch{return G}}var vn={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},Pn={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},Vi;function Ct(){}Z(Ct,le),Ct.prototype.g=function(){return new XMLHttpRequest},Vi=new Ct;function Qt(M){return encodeURIComponent(String(M))}function tr(M){var G=1;M=M.split(":");const te=[];for(;G>0&&M.length;)te.push(M.shift()),G--;return M.length&&te.push(M.join(":")),te}function la(M,G,te,ye){this.j=M,this.i=G,this.l=te,this.S=ye||1,this.V=new fs(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new ps}function ps(){this.i=null,this.g="",this.h=!1}var Vt={},Rn={};function In(M,G,te){M.M=1,M.A=Si(Ti(G)),M.u=te,M.R=!0,zi(M,null)}function zi(M,G){M.F=Date.now(),$o(M),M.B=Ti(M.A);var te=M.B,ye=M.S;Array.isArray(ye)||(ye=[String(ye)]),vs(te.i,"t",ye),M.C=0,te=M.j.L,M.h=new ps,M.g=ko(M.j,te?G:null,!M.u),M.P>0&&(M.O=new Tl(k(M.Y,M,M.g),M.P)),G=M.V,te=M.g,ye=M.ba;var at="readystatechange";Array.isArray(at)||(at&&(Ta[0]=at.toString()),at=Ta);for(let pt=0;pt<at.length;pt++){const Wt=zr(te,at[pt],ye||G.handleEvent,!1,G.h||G);if(!Wt)break;G.g[Wt.key]=Wt}G=M.J?lt(M.J):{},M.u?(M.v||(M.v="POST"),G["Content-Type"]="application/x-www-form-urlencoded",M.g.ea(M.B,M.v,M.u,G)):(M.v="GET",M.g.ea(M.B,M.v,null,G)),bt(),Dn(M.i,M.v,M.B,M.l,M.S,M.u)}la.prototype.ba=function(M){M=M.target;const G=this.O;G&&lr(M)==3?G.j():this.Y(M)},la.prototype.Y=function(M){try{if(M==this.g)e:{const kn=lr(this.g),$n=this.g.ya(),Ri=this.g.ca();if(!(kn<3)&&(kn!=3||this.g&&(this.h.h||this.g.la()||Ia(this.g)))){this.K||kn!=4||$n==7||($n==8||Ri<=0?bt(3):bt(2)),ms(this);var G=this.g.ca();this.X=G;var te=Ka(this);if(this.o=G==200,wi(this.i,this.v,this.B,this.l,this.S,kn,G),this.o){if(this.U&&!this.L){t:{if(this.g){var ye,at=this.g;if((ye=at.g?at.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!ke(ye)){var pt=ye;break t}}pt=null}if(M=pt)Xi(this.i,this.l,M,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Ki(this,M);else{this.o=!1,this.m=3,qe(12),ma(this),Fa(this);break e}}if(this.R){M=!0;let ur;for(;!this.K&&this.C<te.length;)if(ur=Vn(this,te),ur==Rn){kn==4&&(this.m=4,qe(14),M=!1),Xi(this.i,this.l,null,"[Incomplete Response]");break}else if(ur==Vt){this.m=4,qe(15),Xi(this.i,this.l,te,"[Invalid Chunk]"),M=!1;break}else Xi(this.i,this.l,ur,null),Ki(this,ur);if(Ui(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),kn!=4||te.length!=0||this.h.h||(this.m=1,qe(16),M=!1),this.o=this.o&&M,!M)Xi(this.i,this.l,te,"[Invalid Chunked Response]"),ma(this),Fa(this);else if(te.length>0&&!this.W){this.W=!0;var Wt=this.j;Wt.g==this&&Wt.aa&&!Wt.P&&(Wt.j.info("Great, no buffering proxy detected. Bytes received: "+te.length),Uu(Wt),Wt.P=!0,qe(11))}}else Xi(this.i,this.l,te,null),Ki(this,te);kn==4&&ma(this),this.o&&!this.K&&(kn==4?Ss(this.j,this):(this.o=!1,$o(this)))}else go(this.g),G==400&&te.indexOf("Unknown SID")>0?(this.m=3,qe(12)):(this.m=0,qe(13)),ma(this),Fa(this)}}}catch{}finally{}};function Ka(M){if(!Ui(M))return M.g.la();const G=Ia(M.g);if(G==="")return"";let te="";const ye=G.length,at=lr(M.g)==4;if(!M.h.i){if(typeof TextDecoder>"u")return ma(M),Fa(M),"";M.h.i=new g.TextDecoder}for(let pt=0;pt<ye;pt++)M.h.h=!0,te+=M.h.i.decode(G[pt],{stream:!(at&&pt==ye-1)});return G.length=0,M.h.g+=te,M.C=0,M.h.g}function Ui(M){return M.g?M.v=="GET"&&M.M!=2&&M.j.Aa:!1}function Vn(M,G){var te=M.C,ye=G.indexOf(`
`,te);return ye==-1?Rn:(te=Number(G.substring(te,ye)),isNaN(te)?Vt:(ye+=1,ye+te>G.length?Rn:(G=G.slice(ye,ye+te),M.C=ye+te,G)))}la.prototype.cancel=function(){this.K=!0,ma(this)};function $o(M){M.T=Date.now()+M.H,Sa(M,M.H)}function Sa(M,G){if(M.D!=null)throw Error("WatchDog timer not null");M.D=Fn(k(M.aa,M),G)}function ms(M){M.D&&(g.clearTimeout(M.D),M.D=null)}la.prototype.aa=function(){this.D=null;const M=Date.now();M-this.T>=0?(Er(this.i,this.B),this.M!=2&&(bt(),qe(17)),ma(this),this.m=2,Fa(this)):Sa(this,this.T-M)};function Fa(M){M.j.I==0||M.K||Ss(M.j,M)}function ma(M){ms(M);var G=M.O;G&&typeof G.dispose=="function"&&G.dispose(),M.O=null,pr(M.V),M.g&&(G=M.g,M.g=null,G.abort(),G.dispose())}function Ki(M,G){try{var te=M.j;if(te.I!=0&&(te.g==M||$s(te.h,M))){if(!M.L&&$s(te.h,M)&&te.I==3){try{var ye=te.Ba.g.parse(G)}catch{ye=null}if(Array.isArray(ye)&&ye.length==3){var at=ye;if(at[0]==0){e:if(!te.v){if(te.g)if(te.g.F+3e3<M.F)Hl(te),Hs(te);else break e;nr(te),qe(18)}}else te.xa=at[1],0<te.xa-te.K&&at[2]<37500&&te.F&&te.A==0&&!te.C&&(te.C=Fn(k(te.Va,te),6e3));qs(te.h)<=1&&te.ta&&(te.ta=void 0)}else ir(te,11)}else if((M.L||te.g==M)&&Hl(te),!ke(G))for(at=te.Ba.g.parse(G),G=0;G<at.length;G++){let Ri=at[G];const ur=Ri[0];if(!(ur<=te.K))if(te.K=ur,Ri=Ri[1],te.I==2)if(Ri[0]=="c"){te.M=Ri[1],te.ba=Ri[2];const Ca=Ri[3];Ca!=null&&(te.ka=Ca,te.j.info("VER="+te.ka));const Ua=Ri[4];Ua!=null&&(te.za=Ua,te.j.info("SVER="+te.za));const Ws=Ri[5];Ws!=null&&typeof Ws=="number"&&Ws>0&&(ye=1.5*Ws,te.O=ye,te.j.info("backChannelRequestTimeoutMs_="+ye)),ye=te;const As=M.g;if(As){const Lo=As.g?As.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Lo){var pt=ye.h;pt.g||Lo.indexOf("spdy")==-1&&Lo.indexOf("quic")==-1&&Lo.indexOf("h2")==-1||(pt.j=pt.l,pt.g=new Set,pt.h&&(ho(pt,pt.h),pt.h=null))}if(ye.G){const yo=As.g?As.g.getResponseHeader("X-HTTP-Session-Id"):null;yo&&(ye.wa=yo,cn(ye.J,ye.G,yo))}}te.I=3,te.l&&te.l.ra(),te.aa&&(te.T=Date.now()-M.F,te.j.info("Handshake RTT: "+te.T+"ms")),ye=te;var Wt=M;if(ye.na=Es(ye,ye.L?ye.ba:null,ye.W),Wt.L){Ea(ye.h,Wt);var kn=Wt,$n=ye.O;$n&&(kn.H=$n),kn.D&&(ms(kn),$o(kn)),ye.g=Wt}else Ro(ye);te.i.length>0&&xs(te)}else Ri[0]!="stop"&&Ri[0]!="close"||ir(te,7);else te.I==3&&(Ri[0]=="stop"||Ri[0]=="close"?Ri[0]=="stop"?ir(te,7):Xn(te):Ri[0]!="noop"&&te.l&&te.l.qa(Ri),te.A=0)}}bt(4)}catch{}}var Vu=class{constructor(M,G){this.g=M,this.map=G}};function Wr(M){this.l=M||10,g.PerformanceNavigationTiming?(M=g.performance.getEntriesByType("navigation"),M=M.length>0&&(M[0].nextHopProtocol=="hq"||M[0].nextHopProtocol=="h2")):M=!!(g.chrome&&g.chrome.loadTimes&&g.chrome.loadTimes()&&g.chrome.loadTimes().wasFetchedViaSpdy),this.j=M?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function fi(M){return M.h?!0:M.g?M.g.size>=M.j:!1}function qs(M){return M.h?1:M.g?M.g.size:0}function $s(M,G){return M.h?M.h==G:M.g?M.g.has(G):!1}function ho(M,G){M.g?M.g.add(G):M.h=G}function Ea(M,G){M.h&&M.h==G?M.h=null:M.g&&M.g.has(G)&&M.g.delete(G)}Wr.prototype.cancel=function(){if(this.i=gs(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const M of this.g.values())M.cancel();this.g.clear()}};function gs(M){if(M.h!=null)return M.i.concat(M.h.G);if(M.g!=null&&M.g.size!==0){let G=M.i;for(const te of M.g.values())G=G.concat(te.G);return G}return Q(M.i)}var fo=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function ci(M,G){if(M){M=M.split("&");for(let te=0;te<M.length;te++){const ye=M[te].indexOf("=");let at,pt=null;ye>=0?(at=M[te].substring(0,ye),pt=M[te].substring(ye+1)):at=M[te],G(at,pt?decodeURIComponent(pt.replace(/\+/g," ")):"")}}}function pi(M){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let G;M instanceof pi?(this.l=M.l,_s(this,M.j),this.o=M.o,this.g=M.g,po(this,M.u),this.h=M.h,Go(this,Gs(M.i)),this.m=M.m):M&&(G=String(M).match(fo))?(this.l=!1,_s(this,G[1]||"",!0),this.o=ys(G[2]||""),this.g=ys(G[3]||"",!0),po(this,G[4]),this.h=ys(G[5]||"",!0),Go(this,G[6]||"",!0),this.m=ys(G[7]||"")):(this.l=!1,this.i=new Xr(null,this.l))}pi.prototype.toString=function(){const M=[];var G=this.j;G&&M.push(Ar(G,Zo,!0),":");var te=this.g;return(te||G=="file")&&(M.push("//"),(G=this.o)&&M.push(Ar(G,Zo,!0),"@"),M.push(Qt(te).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),te=this.u,te!=null&&M.push(":",String(te))),(te=this.h)&&(this.g&&te.charAt(0)!="/"&&M.push("/"),M.push(Ar(te,te.charAt(0)=="/"?Va:Ho,!0))),(te=this.i.toString())&&M.push("?",te),(te=this.m)&&M.push("#",Ar(te,Ya)),M.join("")},pi.prototype.resolve=function(M){const G=Ti(this);let te=!!M.j;te?_s(G,M.j):te=!!M.o,te?G.o=M.o:te=!!M.g,te?G.g=M.g:te=M.u!=null;var ye=M.h;if(te)po(G,M.u);else if(te=!!M.h){if(ye.charAt(0)!="/")if(this.g&&!this.h)ye="/"+ye;else{var at=G.h.lastIndexOf("/");at!=-1&&(ye=G.h.slice(0,at+1)+ye)}if(at=ye,at==".."||at==".")ye="";else if(at.indexOf("./")!=-1||at.indexOf("/.")!=-1){ye=at.lastIndexOf("/",0)==0,at=at.split("/");const pt=[];for(let Wt=0;Wt<at.length;){const kn=at[Wt++];kn=="."?ye&&Wt==at.length&&pt.push(""):kn==".."?((pt.length>1||pt.length==1&&pt[0]!="")&&pt.pop(),ye&&Wt==at.length&&pt.push("")):(pt.push(kn),ye=!0)}ye=pt.join("/")}else ye=at}return te?G.h=ye:te=M.i.toString()!=="",te?Go(G,Gs(M.i)):te=!!M.m,te&&(G.m=M.m),G};function Ti(M){return new pi(M)}function _s(M,G,te){M.j=te?ys(G,!0):G,M.j&&(M.j=M.j.replace(/:$/,""))}function po(M,G){if(G){if(G=Number(G),isNaN(G)||G<0)throw Error("Bad port number "+G);M.u=G}else M.u=null}function Go(M,G,te){G instanceof Xr?(M.i=G,Zs(M.i,M.l)):(te||(G=Ar(G,Ir)),M.i=new Xr(G,M.l))}function cn(M,G,te){M.i.set(G,te)}function Si(M){return cn(M,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),M}function ys(M,G){return M?G?decodeURI(M.replace(/%25/g,"%2525")):decodeURIComponent(M):""}function Ar(M,G,te){return typeof M=="string"?(M=encodeURI(M).replace(G,ga),te&&(M=M.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),M):null}function ga(M){return M=M.charCodeAt(0),"%"+(M>>4&15).toString(16)+(M&15).toString(16)}var Zo=/[#\/\?@]/g,Ho=/[#\?:]/g,Va=/[#\?]/g,Ir=/[#\?@]/g,Ya=/#/g;function Xr(M,G){this.h=this.g=null,this.i=M||null,this.j=!!G}function Cr(M){M.g||(M.g=new Map,M.h=0,M.i&&ci(M.i,function(G,te){M.add(decodeURIComponent(G.replace(/\+/g," ")),te)}))}i=Xr.prototype,i.add=function(M,G){Cr(this),this.i=null,M=Mn(this,M);let te=this.g.get(M);return te||this.g.set(M,te=[]),te.push(G),this.h+=1,this};function Un(M,G){Cr(M),G=Mn(M,G),M.g.has(G)&&(M.i=null,M.h-=M.g.get(G).length,M.g.delete(G))}function Qa(M,G){return Cr(M),G=Mn(M,G),M.g.has(G)}i.forEach=function(M,G){Cr(this),this.g.forEach(function(te,ye){te.forEach(function(at){M.call(G,at,ye,this)},this)},this)};function Ja(M,G){Cr(M);let te=[];if(typeof G=="string")Qa(M,G)&&(te=te.concat(M.g.get(Mn(M,G))));else for(M=Array.from(M.g.values()),G=0;G<M.length;G++)te=te.concat(M[G]);return te}i.set=function(M,G){return Cr(this),this.i=null,M=Mn(this,M),Qa(this,M)&&(this.h-=this.g.get(M).length),this.g.set(M,[G]),this.h+=1,this},i.get=function(M,G){return M?(M=Ja(this,M),M.length>0?String(M[0]):G):G};function vs(M,G,te){Un(M,G),te.length>0&&(M.i=null,M.g.set(Mn(M,G),Q(te)),M.h+=te.length)}i.toString=function(){if(this.i)return this.i;if(!this.g)return"";const M=[],G=Array.from(this.g.keys());for(let ye=0;ye<G.length;ye++){var te=G[ye];const at=Qt(te);te=Ja(this,te);for(let pt=0;pt<te.length;pt++){let Wt=at;te[pt]!==""&&(Wt+="="+Qt(te[pt])),M.push(Wt)}}return this.i=M.join("&")};function Gs(M){const G=new Xr;return G.i=M.i,M.g&&(G.g=new Map(M.g),G.h=M.h),G}function Mn(M,G){return G=String(G),M.j&&(G=G.toLowerCase()),G}function Zs(M,G){G&&!M.j&&(Cr(M),M.i=null,M.g.forEach(function(te,ye){const at=ye.toLowerCase();ye!=at&&(Un(this,ye),vs(this,at,te))},M)),M.j=G}function Mo(M,G){const te=new rn;if(g.Image){const ye=new Image;ye.onload=V(Ei,te,"TestLoadImage: loaded",!0,G,ye),ye.onerror=V(Ei,te,"TestLoadImage: error",!1,G,ye),ye.onabort=V(Ei,te,"TestLoadImage: abort",!1,G,ye),ye.ontimeout=V(Ei,te,"TestLoadImage: timeout",!1,G,ye),g.setTimeout(function(){ye.ontimeout&&ye.ontimeout()},1e4),ye.src=M}else G(!1)}function mo(M,G){const te=new rn,ye=new AbortController,at=setTimeout(()=>{ye.abort(),Ei(te,"TestPingServer: timeout",!1,G)},1e4);fetch(M,{signal:ye.signal}).then(pt=>{clearTimeout(at),pt.ok?Ei(te,"TestPingServer: ok",!0,G):Ei(te,"TestPingServer: server error",!1,G)}).catch(()=>{clearTimeout(at),Ei(te,"TestPingServer: error",!1,G)})}function Ei(M,G,te,ye,at){try{at&&(at.onload=null,at.onerror=null,at.onabort=null,at.ontimeout=null),ye(te)}catch{}}function qr(){this.g=new se}function fn(M){this.i=M.Sb||null,this.h=M.ab||!1}Z(fn,le),fn.prototype.g=function(){return new hi(this.i,this.h)};function hi(M,G){Fi.call(this),this.H=M,this.o=G,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}Z(hi,Fi),i=hi.prototype,i.open=function(M,G){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=M,this.D=G,this.readyState=1,or(this)},i.send=function(M){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const G={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};M&&(G.body=M),(this.H||g).fetch(new Request(this.D,G)).then(this.Pa.bind(this),this.ga.bind(this))},i.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,Aa(this)),this.readyState=0},i.Pa=function(M){if(this.g&&(this.l=M,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=M.headers,this.readyState=2,or(this)),this.g&&(this.readyState=3,or(this),this.g)))if(this.responseType==="arraybuffer")M.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof g.ReadableStream<"u"&&"body"in M){if(this.j=M.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;bn(this)}else M.text().then(this.Oa.bind(this),this.ga.bind(this))};function bn(M){M.j.read().then(M.Ma.bind(M)).catch(M.ga.bind(M))}i.Ma=function(M){if(this.g){if(this.o&&M.value)this.response.push(M.value);else if(!this.o){var G=M.value?M.value:new Uint8Array(0);(G=this.B.decode(G,{stream:!M.done}))&&(this.response=this.responseText+=G)}M.done?Aa(this):or(this),this.readyState==3&&bn(this)}},i.Oa=function(M){this.g&&(this.response=this.responseText=M,Aa(this))},i.Na=function(M){this.g&&(this.response=M,Aa(this))},i.ga=function(){this.g&&Aa(this)};function Aa(M){M.readyState=4,M.l=null,M.j=null,M.B=null,or(M)}i.setRequestHeader=function(M,G){this.A.append(M,G)},i.getResponseHeader=function(M){return this.h&&this.h.get(M.toLowerCase())||""},i.getAllResponseHeaders=function(){if(!this.h)return"";const M=[],G=this.h.entries();for(var te=G.next();!te.done;)te=te.value,M.push(te[0]+": "+te[1]),te=G.next();return M.join(`\r
`)};function or(M){M.onreadystatechange&&M.onreadystatechange.call(M)}Object.defineProperty(hi.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(M){this.m=M?"include":"same-origin"}});function Br(M){let G="";return jt(M,function(te,ye){G+=ye,G+=":",G+=te,G+=`\r
`}),G}function Oi(M,G,te){e:{for(ye in te){var ye=!1;break e}ye=!0}ye||(te=Br(te),typeof M=="string"?te!=null&&Qt(te):cn(M,G,te))}function Tn(M){Fi.call(this),this.headers=new Map,this.L=M||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}Z(Tn,Fi);var bs=/^https?$/i,pn=["POST","PUT"];i=Tn.prototype,i.Fa=function(M){this.H=M},i.ea=function(M,G,te,ye){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+M);G=G?G.toUpperCase():"GET",this.D=M,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():Vi.g(),this.g.onreadystatechange=Y(k(this.Ca,this));try{this.B=!0,this.g.open(G,String(M),!0),this.B=!1}catch(pt){sn(this,pt);return}if(M=te||"",te=new Map(this.headers),ye)if(Object.getPrototypeOf(ye)===Object.prototype)for(var at in ye)te.set(at,ye[at]);else if(typeof ye.keys=="function"&&typeof ye.get=="function")for(const pt of ye.keys())te.set(pt,ye.get(pt));else throw Error("Unknown input type for opt_headers: "+String(ye));ye=Array.from(te.keys()).find(pt=>pt.toLowerCase()=="content-type"),at=g.FormData&&M instanceof g.FormData,!(Array.prototype.indexOf.call(pn,G,void 0)>=0)||ye||at||te.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[pt,Wt]of te)this.g.setRequestHeader(pt,Wt);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(M),this.v=!1}catch(pt){sn(this,pt)}};function sn(M,G){M.h=!1,M.g&&(M.j=!0,M.g.abort(),M.j=!1),M.l=G,M.o=5,$r(M),xi(M)}function $r(M){M.A||(M.A=!0,fr(M,"complete"),fr(M,"error"))}i.abort=function(M){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=M||7,fr(this,"complete"),fr(this,"abort"),xi(this))},i.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),xi(this,!0)),Tn.Z.N.call(this)},i.Ca=function(){this.u||(this.B||this.v||this.j?Jn(this):this.Xa())},i.Xa=function(){Jn(this)};function Jn(M){if(M.h&&typeof m<"u"){if(M.v&&lr(M)==4)setTimeout(M.Ca.bind(M),0);else if(fr(M,"readystatechange"),lr(M)==4){M.h=!1;try{const pt=M.ca();e:switch(pt){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var G=!0;break e;default:G=!1}var te;if(!(te=G)){var ye;if(ye=pt===0){let Wt=String(M.D).match(fo)[1]||null;!Wt&&g.self&&g.self.location&&(Wt=g.self.location.protocol.slice(0,-1)),ye=!bs.test(Wt?Wt.toLowerCase():"")}te=ye}if(te)fr(M,"complete"),fr(M,"success");else{M.o=6;try{var at=lr(M)>2?M.g.statusText:""}catch{at=""}M.l=at+" ["+M.ca()+"]",$r(M)}}finally{xi(M)}}}}function xi(M,G){if(M.g){M.m&&(clearTimeout(M.m),M.m=null);const te=M.g;M.g=null,G||fr(M,"ready");try{te.onreadystatechange=null}catch{}}}i.isActive=function(){return!!this.g};function lr(M){return M.g?M.g.readyState:0}i.ca=function(){try{return lr(this)>2?this.g.status:-1}catch{return-1}},i.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},i.La=function(M){if(this.g){var G=this.g.responseText;return M&&G.indexOf(M)==0&&(G=G.substring(M.length)),je(G)}};function Ia(M){try{if(!M.g)return null;if("response"in M.g)return M.g.response;switch(M.F){case"":case"text":return M.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in M.g)return M.g.mozResponseArrayBuffer}return null}catch{return null}}function go(M){const G={};M=(M.g&&lr(M)>=2&&M.g.getAllResponseHeaders()||"").split(`\r
`);for(let ye=0;ye<M.length;ye++){if(ke(M[ye]))continue;var te=tr(M[ye]);const at=te[0];if(te=te[1],typeof te!="string")continue;te=te.trim();const pt=G[at]||[];G[at]=pt,pt.push(te)}Ie(G,function(ye){return ye.join(", ")})}i.ya=function(){return this.o},i.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function Sl(M,G,te){return te&&te.internalChannelParams&&te.internalChannelParams[M]||G}function _o(M){this.za=0,this.i=[],this.j=new rn,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Sl("failFast",!1,M),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Sl("baseRetryDelayMs",5e3,M),this.Za=Sl("retryDelaySeedMs",1e4,M),this.Ta=Sl("forwardChannelMaxRetries",2,M),this.va=Sl("forwardChannelRequestTimeoutMs",2e4,M),this.ma=M&&M.xmlHttpFactory||void 0,this.Ua=M&&M.Rb||void 0,this.Aa=M&&M.useFetchStreams||!1,this.O=void 0,this.L=M&&M.supportsCrossDomainXhr||!1,this.M="",this.h=new Wr(M&&M.concurrentRequestLimit),this.Ba=new qr,this.S=M&&M.fastHandshake||!1,this.R=M&&M.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=M&&M.Pb||!1,M&&M.ua&&this.j.ua(),M&&M.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&M&&M.detectBufferingProxy||!1,this.ia=void 0,M&&M.longPollingTimeout&&M.longPollingTimeout>0&&(this.ia=M.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}i=_o.prototype,i.ka=8,i.I=1,i.connect=function(M,G,te,ye){qe(0),this.W=M,this.H=G||{},te&&ye!==void 0&&(this.H.OSID=te,this.H.OAID=ye),this.F=this.X,this.J=Es(this,null,this.W),xs(this)};function Xn(M){if(Kr(M),M.I==3){var G=M.V++,te=Ti(M.J);if(cn(te,"SID",M.M),cn(te,"RID",G),cn(te,"TYPE","terminate"),Ts(M,te),G=new la(M,M.j,G),G.M=2,G.A=Si(Ti(te)),te=!1,g.navigator&&g.navigator.sendBeacon)try{te=g.navigator.sendBeacon(G.A.toString(),"")}catch{}!te&&g.Image&&(new Image().src=G.A,te=!0),te||(G.g=ko(G.j,null),G.g.ea(G.A)),G.F=Date.now(),$o(G)}es(M)}function Hs(M){M.g&&(Uu(M),M.g.cancel(),M.g=null)}function Kr(M){Hs(M),M.v&&(g.clearTimeout(M.v),M.v=null),Hl(M),M.h.cancel(),M.m&&(typeof M.m=="number"&&g.clearTimeout(M.m),M.m=null)}function xs(M){if(!fi(M.h)&&!M.m){M.m=!0;var G=M.Ea;Ve||ce(),it||(Ve(),it=!0),de.add(G,M),M.D=0}}function ws(M,G){return qs(M.h)>=M.h.j-(M.m?1:0)?!1:M.m?(M.i=G.G.concat(M.i),!0):M.I==1||M.I==2||M.D>=(M.Sa?0:M.Ta)?!1:(M.m=Fn(k(M.Ea,M,G),El(M,M.D)),M.D++,!0)}i.Ea=function(M){if(this.m)if(this.m=null,this.I==1){if(!M){this.V=Math.floor(Math.random()*1e5),M=this.V++;const at=new la(this,this.j,M);let pt=this.o;if(this.U&&(pt?(pt=lt(pt),zt(pt,this.U)):pt=this.U),this.u!==null||this.R||(at.J=pt,pt=null),this.S)e:{for(var G=0,te=0;te<this.i.length;te++){t:{var ye=this.i[te];if("__data__"in ye.map&&(ye=ye.map.__data__,typeof ye=="string")){ye=ye.length;break t}ye=void 0}if(ye===void 0)break;if(G+=ye,G>4096){G=te;break e}if(G===4096||te===this.i.length-1){G=te+1;break e}}G=1e3}else G=1e3;G=Wo(this,at,G),te=Ti(this.J),cn(te,"RID",M),cn(te,"CVER",22),this.G&&cn(te,"X-HTTP-Session-Id",this.G),Ts(this,te),pt&&(this.R?G="headers="+Qt(Br(pt))+"&"+G:this.u&&Oi(te,this.u,pt)),ho(this.h,at),this.Ra&&cn(te,"TYPE","init"),this.S?(cn(te,"$req",G),cn(te,"SID","null"),at.U=!0,In(at,te,null)):In(at,te,G),this.I=2}}else this.I==3&&(M?Gr(this,M):this.i.length==0||fi(this.h)||Gr(this))};function Gr(M,G){var te;G?te=G.l:te=M.V++;const ye=Ti(M.J);cn(ye,"SID",M.M),cn(ye,"RID",te),cn(ye,"AID",M.K),Ts(M,ye),M.u&&M.o&&Oi(ye,M.u,M.o),te=new la(M,M.j,te,M.D+1),M.u===null&&(te.J=M.o),G&&(M.i=G.G.concat(M.i)),G=Wo(M,te,1e3),te.H=Math.round(M.va*.5)+Math.round(M.va*.5*Math.random()),ho(M.h,te),In(te,ye,G)}function Ts(M,G){M.H&&jt(M.H,function(te,ye){cn(G,ye,te)}),M.l&&jt({},function(te,ye){cn(G,ye,te)})}function Wo(M,G,te){te=Math.min(M.i.length,te);const ye=M.l?k(M.l.Ka,M.l,M):null;e:{var at=M.i;let kn=-1;for(;;){const $n=["count="+te];kn==-1?te>0?(kn=at[0].g,$n.push("ofs="+kn)):kn=0:$n.push("ofs="+kn);let Ri=!0;for(let ur=0;ur<te;ur++){var pt=at[ur].g;const Ca=at[ur].map;if(pt-=kn,pt<0)kn=Math.max(0,at[ur].g-100),Ri=!1;else try{pt="req"+pt+"_"||"";try{var Wt=Ca instanceof Map?Ca:Object.entries(Ca);for(const[Ua,Ws]of Wt){let As=Ws;c(Ws)&&(As=pa(Ws)),$n.push(pt+Ua+"="+encodeURIComponent(As))}}catch(Ua){throw $n.push(pt+"type="+encodeURIComponent("_badmap")),Ua}}catch{ye&&ye(Ca)}}if(Ri){Wt=$n.join("&");break e}}Wt=void 0}return M=M.i.splice(0,te),G.G=M,Wt}function Ro(M){if(!M.g&&!M.v){M.Y=1;var G=M.Da;Ve||ce(),it||(Ve(),it=!0),de.add(G,M),M.A=0}}function nr(M){return M.g||M.v||M.A>=3?!1:(M.Y++,M.v=Fn(k(M.Da,M),El(M,M.A)),M.A++,!0)}i.Da=function(){if(this.v=null,Xo(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var M=4*this.T;this.j.info("BP detection timer enabled: "+M),this.B=Fn(k(this.Wa,this),M)}},i.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,qe(10),Hs(this),Xo(this))};function Uu(M){M.B!=null&&(g.clearTimeout(M.B),M.B=null)}function Xo(M){M.g=new la(M,M.j,"rpc",M.Y),M.u===null&&(M.g.J=M.o),M.g.P=0;var G=Ti(M.na);cn(G,"RID","rpc"),cn(G,"SID",M.M),cn(G,"AID",M.K),cn(G,"CI",M.F?"0":"1"),!M.F&&M.ia&&cn(G,"TO",M.ia),cn(G,"TYPE","xmlhttp"),Ts(M,G),M.u&&M.o&&Oi(G,M.u,M.o),M.O&&(M.g.H=M.O);var te=M.g;M=M.ba,te.M=1,te.A=Si(Ti(G)),te.u=null,te.R=!0,zi(te,M)}i.Va=function(){this.C!=null&&(this.C=null,Hs(this),nr(this),qe(19))};function Hl(M){M.C!=null&&(g.clearTimeout(M.C),M.C=null)}function Ss(M,G){var te=null;if(M.g==G){Hl(M),Uu(M),M.g=null;var ye=2}else if($s(M.h,G))te=G.G,Ea(M.h,G),ye=1;else return;if(M.I!=0){if(G.o)if(ye==1){te=G.u?G.u.length:0,G=Date.now()-G.F;var at=M.D;ye=yt(),fr(ye,new Cn(ye,te)),xs(M)}else Ro(M);else if(at=G.m,at==3||at==0&&G.X>0||!(ye==1&&ws(M,G)||ye==2&&nr(M)))switch(te&&te.length>0&&(G=M.h,G.i=G.i.concat(te)),at){case 1:ir(M,5);break;case 4:ir(M,10);break;case 3:ir(M,6);break;default:ir(M,2)}}}function El(M,G){let te=M.Qa+Math.floor(Math.random()*M.Za);return M.isActive()||(te*=2),te*G}function ir(M,G){if(M.j.info("Error code "+G),G==2){var te=k(M.bb,M),ye=M.Ua;const at=!ye;ye=new pi(ye||"//www.google.com/images/cleardot.gif"),g.location&&g.location.protocol=="http"||_s(ye,"https"),Si(ye),at?Mo(ye.toString(),te):mo(ye.toString(),te)}else qe(2);M.I=0,M.l&&M.l.pa(G),es(M),Kr(M)}i.bb=function(M){M?(this.j.info("Successfully pinged google.com"),qe(2)):(this.j.info("Failed to ping google.com"),qe(1))};function es(M){if(M.I=0,M.ja=[],M.l){const G=gs(M.h);(G.length!=0||M.i.length!=0)&&(be(M.ja,G),be(M.ja,M.i),M.h.i.length=0,Q(M.i),M.i.length=0),M.l.oa()}}function Es(M,G,te){var ye=te instanceof pi?Ti(te):new pi(te);if(ye.g!="")G&&(ye.g=G+"."+ye.g),po(ye,ye.u);else{var at=g.location;ye=at.protocol,G=G?G+"."+at.hostname:at.hostname,at=+at.port;const pt=new pi(null);ye&&_s(pt,ye),G&&(pt.g=G),at&&po(pt,at),te&&(pt.h=te),ye=pt}return te=M.G,G=M.wa,te&&G&&cn(ye,te,G),cn(ye,"VER",M.ka),Ts(M,ye),ye}function ko(M,G,te){if(G&&!M.L)throw Error("Can't create secondary domain capable XhrIo object.");return G=M.Aa&&!M.ma?new Tn(new fn({ab:te})):new Tn(M.ma),G.Fa(M.L),G}i.isActive=function(){return!!this.l&&this.l.isActive(this)};function Ko(){}i=Ko.prototype,i.ra=function(){},i.qa=function(){},i.pa=function(){},i.oa=function(){},i.isActive=function(){return!0},i.Ka=function(){};function Yo(){}Yo.prototype.g=function(M,G){return new Ai(M,G)};function Ai(M,G){Fi.call(this),this.g=new _o(G),this.l=M,this.h=G&&G.messageUrlParams||null,M=G&&G.messageHeaders||null,G&&G.clientProtocolHeaderRequired&&(M?M["X-Client-Protocol"]="webchannel":M={"X-Client-Protocol":"webchannel"}),this.g.o=M,M=G&&G.initMessageHeaders||null,G&&G.messageContentType&&(M?M["X-WebChannel-Content-Type"]=G.messageContentType:M={"X-WebChannel-Content-Type":G.messageContentType}),G&&G.sa&&(M?M["X-WebChannel-Client-Profile"]=G.sa:M={"X-WebChannel-Client-Profile":G.sa}),this.g.U=M,(M=G&&G.Qb)&&!ke(M)&&(this.g.u=M),this.A=G&&G.supportsCrossDomainXhr||!1,this.v=G&&G.sendRawJson||!1,(G=G&&G.httpSessionIdParam)&&!ke(G)&&(this.g.G=G,M=this.h,M!==null&&G in M&&(M=this.h,G in M&&delete M[G])),this.j=new Wl(this)}Z(Ai,Fi),Ai.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},Ai.prototype.close=function(){Xn(this.g)},Ai.prototype.o=function(M){var G=this.g;if(typeof M=="string"){var te={};te.__data__=M,M=te}else this.v&&(te={},te.__data__=pa(M),M=te);G.i.push(new Vu(G.Ya++,M)),G.I==3&&xs(G)},Ai.prototype.N=function(){this.g.l=null,delete this.j,Xn(this.g),delete this.g,Ai.Z.N.call(this)};function hu(M){Ne.call(this),M.__headers__&&(this.headers=M.__headers__,this.statusCode=M.__status__,delete M.__headers__,delete M.__status__);var G=M.__sm__;if(G){e:{for(const te in G){M=te;break e}M=void 0}(this.i=M)&&(M=this.i,G=G!==null&&M in G?G[M]:void 0),this.data=G}else this.data=M}Z(hu,Ne);function du(){Ge.call(this),this.status=1}Z(du,Ge);function Wl(M){this.g=M}Z(Wl,Ko),Wl.prototype.ra=function(){fr(this.g,"a")},Wl.prototype.qa=function(M){fr(this.g,new hu(M))},Wl.prototype.pa=function(M){fr(this.g,new du)},Wl.prototype.oa=function(){fr(this.g,"b")},Yo.prototype.createWebChannel=Yo.prototype.g,Ai.prototype.send=Ai.prototype.o,Ai.prototype.open=Ai.prototype.m,Ai.prototype.close=Ai.prototype.close,jE=function(){return new Yo},UE=function(){return yt()},VE=Je,Ax={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},vn.NO_ERROR=0,vn.TIMEOUT=8,vn.HTTP_ERROR=6,Bv=vn,Pn.COMPLETE="complete",FE=Pn,fe.EventType=Se,Se.OPEN="a",Se.CLOSE="b",Se.ERROR="c",Se.MESSAGE="d",Fi.prototype.listen=Fi.prototype.J,w_=fe,Tn.prototype.listenOnce=Tn.prototype.K,Tn.prototype.getLastError=Tn.prototype.Ha,Tn.prototype.getLastErrorCode=Tn.prototype.ya,Tn.prototype.getStatus=Tn.prototype.ca,Tn.prototype.getResponseJson=Tn.prototype.La,Tn.prototype.getResponseText=Tn.prototype.la,Tn.prototype.send=Tn.prototype.ea,Tn.prototype.setWithCredentials=Tn.prototype.Fa,BE=Tn}).apply(typeof wv<"u"?wv:typeof self<"u"?self:typeof window<"u"?window:{});const x2="@firebase/firestore",w2="4.9.2";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bl{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}bl.UNAUTHENTICATED=new bl(null),bl.GOOGLE_CREDENTIALS=new bl("google-credentials-uid"),bl.FIRST_PARTY=new bl("first-party-uid"),bl.MOCK_USER=new bl("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let vg="12.3.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wp=new N0("@firebase/firestore");function $m(){return Wp.logLevel}function mn(i,...e){if(Wp.logLevel<=ki.DEBUG){const t=e.map(T1);Wp.debug(`Firestore (${vg}): ${i}`,...t)}}function Fd(i,...e){if(Wp.logLevel<=ki.ERROR){const t=e.map(T1);Wp.error(`Firestore (${vg}): ${i}`,...t)}}function sg(i,...e){if(Wp.logLevel<=ki.WARN){const t=e.map(T1);Wp.warn(`Firestore (${vg}): ${i}`,...t)}}function T1(i){if(typeof i=="string")return i;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return(function(t){return JSON.stringify(t)})(i)}catch{return i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qn(i,e,t){let a="Unexpected state";typeof e=="string"?a=e:t=e,qE(i,a,t)}function qE(i,e,t){let a=`FIRESTORE (${vg}) INTERNAL ASSERTION FAILED: ${e} (ID: ${i.toString(16)})`;if(t!==void 0)try{a+=" CONTEXT: "+JSON.stringify(t)}catch{a+=" CONTEXT: "+t}throw Fd(a),new Error(a)}function Sr(i,e,t,a){let h="Unexpected state";typeof t=="string"?h=t:a=t,i||qE(e,h,a)}function si(i,e){return i}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kt={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class gn extends lh{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zf{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $E{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class cL{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(bl.UNAUTHENTICATED)))}shutdown(){}}class hL{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class dL{constructor(e){this.t=e,this.currentUser=bl.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){Sr(this.o===void 0,42304);let a=this.i;const h=C=>this.i!==a?(a=this.i,t(C)):Promise.resolve();let m=new zf;this.o=()=>{this.i++,this.currentUser=this.u(),m.resolve(),m=new zf,e.enqueueRetryable((()=>h(this.currentUser)))};const g=()=>{const C=m;e.enqueueRetryable((async()=>{await C.promise,await h(this.currentUser)}))},c=C=>{mn("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=C,this.o&&(this.auth.addAuthTokenListener(this.o),g())};this.t.onInit((C=>c(C))),setTimeout((()=>{if(!this.auth){const C=this.t.getImmediate({optional:!0});C?c(C):(mn("FirebaseAuthCredentialsProvider","Auth not yet detected"),m.resolve(),m=new zf)}}),0),g()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((a=>this.i!==e?(mn("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):a?(Sr(typeof a.accessToken=="string",31837,{l:a}),new $E(a.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Sr(e===null||typeof e=="string",2055,{h:e}),new bl(e)}}class fL{constructor(e,t,a){this.P=e,this.T=t,this.I=a,this.type="FirstParty",this.user=bl.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class pL{constructor(e,t,a){this.P=e,this.T=t,this.I=a}getToken(){return Promise.resolve(new fL(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable((()=>t(bl.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class T2{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class mL{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Vh(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){Sr(this.o===void 0,3512);const a=m=>{m.error!=null&&mn("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${m.error.message}`);const g=m.token!==this.m;return this.m=m.token,mn("FirebaseAppCheckTokenProvider",`Received ${g?"new":"existing"} token.`),g?t(m.token):Promise.resolve()};this.o=m=>{e.enqueueRetryable((()=>a(m)))};const h=m=>{mn("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=m,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((m=>h(m))),setTimeout((()=>{if(!this.appCheck){const m=this.V.getImmediate({optional:!0});m?h(m):mn("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new T2(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((t=>t?(Sr(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new T2(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gL(i){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(i);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let a=0;a<i;a++)t[a]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class S1{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let a="";for(;a.length<20;){const h=gL(40);for(let m=0;m<h.length;++m)a.length<20&&h[m]<t&&(a+=e.charAt(h[m]%62))}return a}}function Li(i,e){return i<e?-1:i>e?1:0}function Ix(i,e){const t=Math.min(i.length,e.length);for(let a=0;a<t;a++){const h=i.charAt(a),m=e.charAt(a);if(h!==m)return $b(h)===$b(m)?Li(h,m):$b(h)?1:-1}return Li(i.length,e.length)}const _L=55296,yL=57343;function $b(i){const e=i.charCodeAt(0);return e>=_L&&e<=yL}function og(i,e,t){return i.length===e.length&&i.every(((a,h)=>t(a,e[h])))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const S2="__name__";class Fh{constructor(e,t,a){t===void 0?t=0:t>e.length&&Qn(637,{offset:t,range:e.length}),a===void 0?a=e.length-t:a>e.length-t&&Qn(1746,{length:a,range:e.length-t}),this.segments=e,this.offset=t,this.len=a}get length(){return this.len}isEqual(e){return Fh.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Fh?e.forEach((a=>{t.push(a)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,a=this.limit();t<a;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const a=Math.min(e.length,t.length);for(let h=0;h<a;h++){const m=Fh.compareSegments(e.get(h),t.get(h));if(m!==0)return m}return Li(e.length,t.length)}static compareSegments(e,t){const a=Fh.isNumericId(e),h=Fh.isNumericId(t);return a&&!h?-1:!a&&h?1:a&&h?Fh.extractNumericId(e).compare(Fh.extractNumericId(t)):Ix(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Df.fromString(e.substring(4,e.length-2))}}class oa extends Fh{construct(e,t,a){return new oa(e,t,a)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const a of e){if(a.indexOf("//")>=0)throw new gn(kt.INVALID_ARGUMENT,`Invalid segment (${a}). Paths must not contain // in them.`);t.push(...a.split("/").filter((h=>h.length>0)))}return new oa(t)}static emptyPath(){return new oa([])}}const vL=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class jo extends Fh{construct(e,t,a){return new jo(e,t,a)}static isValidIdentifier(e){return vL.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),jo.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===S2}static keyField(){return new jo([S2])}static fromServerFormat(e){const t=[];let a="",h=0;const m=()=>{if(a.length===0)throw new gn(kt.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(a),a=""};let g=!1;for(;h<e.length;){const c=e[h];if(c==="\\"){if(h+1===e.length)throw new gn(kt.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const C=e[h+1];if(C!=="\\"&&C!=="."&&C!=="`")throw new gn(kt.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);a+=C,h+=2}else c==="`"?(g=!g,h++):c!=="."||g?(a+=c,h++):(m(),h++)}if(m(),g)throw new gn(kt.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new jo(t)}static emptyPath(){return new jo([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nn{constructor(e){this.path=e}static fromPath(e){return new Nn(oa.fromString(e))}static fromName(e){return new Nn(oa.fromString(e).popFirst(5))}static empty(){return new Nn(oa.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&oa.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return oa.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Nn(new oa(e.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function GE(i,e,t){if(!t)throw new gn(kt.INVALID_ARGUMENT,`Function ${i}() cannot be called with an empty ${e}.`)}function bL(i,e,t,a){if(e===!0&&a===!0)throw new gn(kt.INVALID_ARGUMENT,`${i} and ${t} cannot be used together.`)}function E2(i){if(!Nn.isDocumentKey(i))throw new gn(kt.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${i} has ${i.length}.`)}function A2(i){if(Nn.isDocumentKey(i))throw new gn(kt.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${i} has ${i.length}.`)}function ZE(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}function B0(i){if(i===void 0)return"undefined";if(i===null)return"null";if(typeof i=="string")return i.length>20&&(i=`${i.substring(0,20)}...`),JSON.stringify(i);if(typeof i=="number"||typeof i=="boolean")return""+i;if(typeof i=="object"){if(i instanceof Array)return"an array";{const e=(function(a){return a.constructor?a.constructor.name:null})(i);return e?`a custom ${e} object`:"an object"}}return typeof i=="function"?"a function":Qn(12329,{type:typeof i})}function a0(i,e){if("_delegate"in i&&(i=i._delegate),!(i instanceof e)){if(e.name===i.constructor.name)throw new gn(kt.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=B0(i);throw new gn(kt.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return i}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fs(i,e){const t={typeString:i};return e&&(t.value=e),t}function py(i,e){if(!ZE(i))throw new gn(kt.INVALID_ARGUMENT,"JSON must be an object");let t;for(const a in e)if(e[a]){const h=e[a].typeString,m="value"in e[a]?{value:e[a].value}:void 0;if(!(a in i)){t=`JSON missing required field: '${a}'`;break}const g=i[a];if(h&&typeof g!==h){t=`JSON field '${a}' must be a ${h}.`;break}if(m!==void 0&&g!==m.value){t=`Expected '${a}' field to equal '${m.value}'`;break}}if(t)throw new gn(kt.INVALID_ARGUMENT,t);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const I2=-62135596800,C2=1e6;class da{static now(){return da.fromMillis(Date.now())}static fromDate(e){return da.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),a=Math.floor((e-1e3*t)*C2);return new da(t,a)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new gn(kt.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new gn(kt.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<I2)throw new gn(kt.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new gn(kt.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/C2}_compareTo(e){return this.seconds===e.seconds?Li(this.nanoseconds,e.nanoseconds):Li(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:da._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(py(e,da._jsonSchema))return new da(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-I2;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}da._jsonSchemaVersion="firestore/timestamp/1.0",da._jsonSchema={type:Fs("string",da._jsonSchemaVersion),seconds:Fs("number"),nanoseconds:Fs("number")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ri{static fromTimestamp(e){return new ri(e)}static min(){return new ri(new da(0,0))}static max(){return new ri(new da(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const G_=-1;function xL(i,e){const t=i.toTimestamp().seconds,a=i.toTimestamp().nanoseconds+1,h=ri.fromTimestamp(a===1e9?new da(t+1,0):new da(t,a));return new Ff(h,Nn.empty(),e)}function wL(i){return new Ff(i.readTime,i.key,G_)}class Ff{constructor(e,t,a){this.readTime=e,this.documentKey=t,this.largestBatchId=a}static min(){return new Ff(ri.min(),Nn.empty(),G_)}static max(){return new Ff(ri.max(),Nn.empty(),G_)}}function TL(i,e){let t=i.readTime.compareTo(e.readTime);return t!==0?t:(t=Nn.comparator(i.documentKey,e.documentKey),t!==0?t:Li(i.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SL="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class EL{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function bg(i){if(i.code!==kt.FAILED_PRECONDITION||i.message!==SL)throw i;mn("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lt{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Qn(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new Lt(((a,h)=>{this.nextCallback=m=>{this.wrapSuccess(e,m).next(a,h)},this.catchCallback=m=>{this.wrapFailure(t,m).next(a,h)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof Lt?t:Lt.resolve(t)}catch(t){return Lt.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):Lt.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):Lt.reject(t)}static resolve(e){return new Lt(((t,a)=>{t(e)}))}static reject(e){return new Lt(((t,a)=>{a(e)}))}static waitFor(e){return new Lt(((t,a)=>{let h=0,m=0,g=!1;e.forEach((c=>{++h,c.next((()=>{++m,g&&m===h&&t()}),(C=>a(C)))})),g=!0,m===h&&t()}))}static or(e){let t=Lt.resolve(!1);for(const a of e)t=t.next((h=>h?Lt.resolve(h):a()));return t}static forEach(e,t){const a=[];return e.forEach(((h,m)=>{a.push(t.call(this,h,m))})),this.waitFor(a)}static mapArray(e,t){return new Lt(((a,h)=>{const m=e.length,g=new Array(m);let c=0;for(let C=0;C<m;C++){const k=C;t(e[k]).next((V=>{g[k]=V,++c,c===m&&a(g)}),(V=>h(V)))}}))}static doWhile(e,t){return new Lt(((a,h)=>{const m=()=>{e()===!0?t().next((()=>{m()}),h):a()};m()}))}}function AL(i){const e=i.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function xg(i){return i.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class F0{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=a=>this.ae(a),this.ue=a=>t.writeSequenceNumber(a))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}F0.ce=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const E1=-1;function V0(i){return i==null}function s0(i){return i===0&&1/i==-1/0}function IL(i){return typeof i=="number"&&Number.isInteger(i)&&!s0(i)&&i<=Number.MAX_SAFE_INTEGER&&i>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HE="";function CL(i){let e="";for(let t=0;t<i.length;t++)e.length>0&&(e=P2(e)),e=PL(i.get(t),e);return P2(e)}function PL(i,e){let t=e;const a=i.length;for(let h=0;h<a;h++){const m=i.charAt(h);switch(m){case"\0":t+="";break;case HE:t+="";break;default:t+=m}}return t}function P2(i){return i+HE+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function M2(i){let e=0;for(const t in i)Object.prototype.hasOwnProperty.call(i,t)&&e++;return e}function rm(i,e){for(const t in i)Object.prototype.hasOwnProperty.call(i,t)&&e(t,i[t])}function WE(i){for(const e in i)if(Object.prototype.hasOwnProperty.call(i,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Na{constructor(e,t){this.comparator=e,this.root=t||Uo.EMPTY}insert(e,t){return new Na(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Uo.BLACK,null,null))}remove(e){return new Na(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Uo.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const a=this.comparator(e,t.key);if(a===0)return t.value;a<0?t=t.left:a>0&&(t=t.right)}return null}indexOf(e){let t=0,a=this.root;for(;!a.isEmpty();){const h=this.comparator(e,a.key);if(h===0)return t+a.left.size;h<0?a=a.left:(t+=a.left.size+1,a=a.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,a)=>(e(t,a),!1)))}toString(){const e=[];return this.inorderTraversal(((t,a)=>(e.push(`${t}:${a}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Tv(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Tv(this.root,e,this.comparator,!1)}getReverseIterator(){return new Tv(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Tv(this.root,e,this.comparator,!0)}}class Tv{constructor(e,t,a,h){this.isReverse=h,this.nodeStack=[];let m=1;for(;!e.isEmpty();)if(m=t?a(e.key,t):1,t&&h&&(m*=-1),m<0)e=this.isReverse?e.left:e.right;else{if(m===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Uo{constructor(e,t,a,h,m){this.key=e,this.value=t,this.color=a??Uo.RED,this.left=h??Uo.EMPTY,this.right=m??Uo.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,a,h,m){return new Uo(e??this.key,t??this.value,a??this.color,h??this.left,m??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,a){let h=this;const m=a(e,h.key);return h=m<0?h.copy(null,null,null,h.left.insert(e,t,a),null):m===0?h.copy(null,t,null,null,null):h.copy(null,null,null,null,h.right.insert(e,t,a)),h.fixUp()}removeMin(){if(this.left.isEmpty())return Uo.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let a,h=this;if(t(e,h.key)<0)h.left.isEmpty()||h.left.isRed()||h.left.left.isRed()||(h=h.moveRedLeft()),h=h.copy(null,null,null,h.left.remove(e,t),null);else{if(h.left.isRed()&&(h=h.rotateRight()),h.right.isEmpty()||h.right.isRed()||h.right.left.isRed()||(h=h.moveRedRight()),t(e,h.key)===0){if(h.right.isEmpty())return Uo.EMPTY;a=h.right.min(),h=h.copy(a.key,a.value,null,null,h.right.removeMin())}h=h.copy(null,null,null,null,h.right.remove(e,t))}return h.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Uo.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Uo.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Qn(43730,{key:this.key,value:this.value});if(this.right.isRed())throw Qn(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw Qn(27949);return e+(this.isRed()?0:1)}}Uo.EMPTY=null,Uo.RED=!0,Uo.BLACK=!1;Uo.EMPTY=new class{constructor(){this.size=0}get key(){throw Qn(57766)}get value(){throw Qn(16141)}get color(){throw Qn(16727)}get left(){throw Qn(29726)}get right(){throw Qn(36894)}copy(e,t,a,h,m){return this}insert(e,t,a){return new Uo(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uo{constructor(e){this.comparator=e,this.data=new Na(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,a)=>(e(t),!1)))}forEachInRange(e,t){const a=this.data.getIteratorFrom(e[0]);for(;a.hasNext();){const h=a.getNext();if(this.comparator(h.key,e[1])>=0)return;t(h.key)}}forEachWhile(e,t){let a;for(a=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();a.hasNext();)if(!e(a.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new R2(this.data.getIterator())}getIteratorFrom(e){return new R2(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((a=>{t=t.add(a)})),t}isEqual(e){if(!(e instanceof uo)||this.size!==e.size)return!1;const t=this.data.getIterator(),a=e.data.getIterator();for(;t.hasNext();){const h=t.getNext().key,m=a.getNext().key;if(this.comparator(h,m)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new uo(this.comparator);return t.data=e,t}}class R2{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class th{constructor(e){this.fields=e,e.sort(jo.comparator)}static empty(){return new th([])}unionWith(e){let t=new uo(jo.comparator);for(const a of this.fields)t=t.add(a);for(const a of e)t=t.add(a);return new th(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return og(this.fields,e.fields,((t,a)=>t.isEqual(a)))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XE extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qo{constructor(e){this.binaryString=e}static fromBase64String(e){const t=(function(h){try{return atob(h)}catch(m){throw typeof DOMException<"u"&&m instanceof DOMException?new XE("Invalid base64 string: "+m):m}})(e);return new qo(t)}static fromUint8Array(e){const t=(function(h){let m="";for(let g=0;g<h.length;++g)m+=String.fromCharCode(h[g]);return m})(e);return new qo(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(t){return btoa(t)})(this.binaryString)}toUint8Array(){return(function(t){const a=new Uint8Array(t.length);for(let h=0;h<t.length;h++)a[h]=t.charCodeAt(h);return a})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Li(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}qo.EMPTY_BYTE_STRING=new qo("");const ML=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Vf(i){if(Sr(!!i,39018),typeof i=="string"){let e=0;const t=ML.exec(i);if(Sr(!!t,46558,{timestamp:i}),t[1]){let h=t[1];h=(h+"000000000").substr(0,9),e=Number(h)}const a=new Date(i);return{seconds:Math.floor(a.getTime()/1e3),nanos:e}}return{seconds:hs(i.seconds),nanos:hs(i.nanos)}}function hs(i){return typeof i=="number"?i:typeof i=="string"?Number(i):0}function Uf(i){return typeof i=="string"?qo.fromBase64String(i):qo.fromUint8Array(i)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KE="server_timestamp",YE="__type__",QE="__previous_value__",JE="__local_write_time__";function A1(i){var t,a;return((a=(((t=i==null?void 0:i.mapValue)==null?void 0:t.fields)||{})[YE])==null?void 0:a.stringValue)===KE}function U0(i){const e=i.mapValue.fields[QE];return A1(e)?U0(e):e}function Z_(i){const e=Vf(i.mapValue.fields[JE].timestampValue);return new da(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RL{constructor(e,t,a,h,m,g,c,C,k,V){this.databaseId=e,this.appId=t,this.persistenceKey=a,this.host=h,this.ssl=m,this.forceLongPolling=g,this.autoDetectLongPolling=c,this.longPollingOptions=C,this.useFetchStreams=k,this.isUsingEmulator=V}}const o0="(default)";class H_{constructor(e,t){this.projectId=e,this.database=t||o0}static empty(){return new H_("","")}get isDefaultDatabase(){return this.database===o0}isEqual(e){return e instanceof H_&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eA="__type__",kL="__max__",Sv={mapValue:{}},tA="__vector__",l0="value";function jf(i){return"nullValue"in i?0:"booleanValue"in i?1:"integerValue"in i||"doubleValue"in i?2:"timestampValue"in i?3:"stringValue"in i?5:"bytesValue"in i?6:"referenceValue"in i?7:"geoPointValue"in i?8:"arrayValue"in i?9:"mapValue"in i?A1(i)?4:DL(i)?9007199254740991:LL(i)?10:11:Qn(28295,{value:i})}function ed(i,e){if(i===e)return!0;const t=jf(i);if(t!==jf(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return i.booleanValue===e.booleanValue;case 4:return Z_(i).isEqual(Z_(e));case 3:return(function(h,m){if(typeof h.timestampValue=="string"&&typeof m.timestampValue=="string"&&h.timestampValue.length===m.timestampValue.length)return h.timestampValue===m.timestampValue;const g=Vf(h.timestampValue),c=Vf(m.timestampValue);return g.seconds===c.seconds&&g.nanos===c.nanos})(i,e);case 5:return i.stringValue===e.stringValue;case 6:return(function(h,m){return Uf(h.bytesValue).isEqual(Uf(m.bytesValue))})(i,e);case 7:return i.referenceValue===e.referenceValue;case 8:return(function(h,m){return hs(h.geoPointValue.latitude)===hs(m.geoPointValue.latitude)&&hs(h.geoPointValue.longitude)===hs(m.geoPointValue.longitude)})(i,e);case 2:return(function(h,m){if("integerValue"in h&&"integerValue"in m)return hs(h.integerValue)===hs(m.integerValue);if("doubleValue"in h&&"doubleValue"in m){const g=hs(h.doubleValue),c=hs(m.doubleValue);return g===c?s0(g)===s0(c):isNaN(g)&&isNaN(c)}return!1})(i,e);case 9:return og(i.arrayValue.values||[],e.arrayValue.values||[],ed);case 10:case 11:return(function(h,m){const g=h.mapValue.fields||{},c=m.mapValue.fields||{};if(M2(g)!==M2(c))return!1;for(const C in g)if(g.hasOwnProperty(C)&&(c[C]===void 0||!ed(g[C],c[C])))return!1;return!0})(i,e);default:return Qn(52216,{left:i})}}function W_(i,e){return(i.values||[]).find((t=>ed(t,e)))!==void 0}function lg(i,e){if(i===e)return 0;const t=jf(i),a=jf(e);if(t!==a)return Li(t,a);switch(t){case 0:case 9007199254740991:return 0;case 1:return Li(i.booleanValue,e.booleanValue);case 2:return(function(m,g){const c=hs(m.integerValue||m.doubleValue),C=hs(g.integerValue||g.doubleValue);return c<C?-1:c>C?1:c===C?0:isNaN(c)?isNaN(C)?0:-1:1})(i,e);case 3:return k2(i.timestampValue,e.timestampValue);case 4:return k2(Z_(i),Z_(e));case 5:return Ix(i.stringValue,e.stringValue);case 6:return(function(m,g){const c=Uf(m),C=Uf(g);return c.compareTo(C)})(i.bytesValue,e.bytesValue);case 7:return(function(m,g){const c=m.split("/"),C=g.split("/");for(let k=0;k<c.length&&k<C.length;k++){const V=Li(c[k],C[k]);if(V!==0)return V}return Li(c.length,C.length)})(i.referenceValue,e.referenceValue);case 8:return(function(m,g){const c=Li(hs(m.latitude),hs(g.latitude));return c!==0?c:Li(hs(m.longitude),hs(g.longitude))})(i.geoPointValue,e.geoPointValue);case 9:return L2(i.arrayValue,e.arrayValue);case 10:return(function(m,g){var Y,Q,be,xe;const c=m.fields||{},C=g.fields||{},k=(Y=c[l0])==null?void 0:Y.arrayValue,V=(Q=C[l0])==null?void 0:Q.arrayValue,Z=Li(((be=k==null?void 0:k.values)==null?void 0:be.length)||0,((xe=V==null?void 0:V.values)==null?void 0:xe.length)||0);return Z!==0?Z:L2(k,V)})(i.mapValue,e.mapValue);case 11:return(function(m,g){if(m===Sv.mapValue&&g===Sv.mapValue)return 0;if(m===Sv.mapValue)return 1;if(g===Sv.mapValue)return-1;const c=m.fields||{},C=Object.keys(c),k=g.fields||{},V=Object.keys(k);C.sort(),V.sort();for(let Z=0;Z<C.length&&Z<V.length;++Z){const Y=Ix(C[Z],V[Z]);if(Y!==0)return Y;const Q=lg(c[C[Z]],k[V[Z]]);if(Q!==0)return Q}return Li(C.length,V.length)})(i.mapValue,e.mapValue);default:throw Qn(23264,{he:t})}}function k2(i,e){if(typeof i=="string"&&typeof e=="string"&&i.length===e.length)return Li(i,e);const t=Vf(i),a=Vf(e),h=Li(t.seconds,a.seconds);return h!==0?h:Li(t.nanos,a.nanos)}function L2(i,e){const t=i.values||[],a=e.values||[];for(let h=0;h<t.length&&h<a.length;++h){const m=lg(t[h],a[h]);if(m)return m}return Li(t.length,a.length)}function ug(i){return Cx(i)}function Cx(i){return"nullValue"in i?"null":"booleanValue"in i?""+i.booleanValue:"integerValue"in i?""+i.integerValue:"doubleValue"in i?""+i.doubleValue:"timestampValue"in i?(function(t){const a=Vf(t);return`time(${a.seconds},${a.nanos})`})(i.timestampValue):"stringValue"in i?i.stringValue:"bytesValue"in i?(function(t){return Uf(t).toBase64()})(i.bytesValue):"referenceValue"in i?(function(t){return Nn.fromName(t).toString()})(i.referenceValue):"geoPointValue"in i?(function(t){return`geo(${t.latitude},${t.longitude})`})(i.geoPointValue):"arrayValue"in i?(function(t){let a="[",h=!0;for(const m of t.values||[])h?h=!1:a+=",",a+=Cx(m);return a+"]"})(i.arrayValue):"mapValue"in i?(function(t){const a=Object.keys(t.fields||{}).sort();let h="{",m=!0;for(const g of a)m?m=!1:h+=",",h+=`${g}:${Cx(t.fields[g])}`;return h+"}"})(i.mapValue):Qn(61005,{value:i})}function Fv(i){switch(jf(i)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=U0(i);return e?16+Fv(e):16;case 5:return 2*i.stringValue.length;case 6:return Uf(i.bytesValue).approximateByteSize();case 7:return i.referenceValue.length;case 9:return(function(a){return(a.values||[]).reduce(((h,m)=>h+Fv(m)),0)})(i.arrayValue);case 10:case 11:return(function(a){let h=0;return rm(a.fields,((m,g)=>{h+=m.length+Fv(g)})),h})(i.mapValue);default:throw Qn(13486,{value:i})}}function D2(i,e){return{referenceValue:`projects/${i.projectId}/databases/${i.database}/documents/${e.path.canonicalString()}`}}function Px(i){return!!i&&"integerValue"in i}function I1(i){return!!i&&"arrayValue"in i}function z2(i){return!!i&&"nullValue"in i}function O2(i){return!!i&&"doubleValue"in i&&isNaN(Number(i.doubleValue))}function Vv(i){return!!i&&"mapValue"in i}function LL(i){var t,a;return((a=(((t=i==null?void 0:i.mapValue)==null?void 0:t.fields)||{})[eA])==null?void 0:a.stringValue)===tA}function k_(i){if(i.geoPointValue)return{geoPointValue:{...i.geoPointValue}};if(i.timestampValue&&typeof i.timestampValue=="object")return{timestampValue:{...i.timestampValue}};if(i.mapValue){const e={mapValue:{fields:{}}};return rm(i.mapValue.fields,((t,a)=>e.mapValue.fields[t]=k_(a))),e}if(i.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(i.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=k_(i.arrayValue.values[t]);return e}return{...i}}function DL(i){return(((i.mapValue||{}).fields||{}).__type__||{}).stringValue===kL}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _c{constructor(e){this.value=e}static empty(){return new _c({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let a=0;a<e.length-1;++a)if(t=(t.mapValue.fields||{})[e.get(a)],!Vv(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=k_(t)}setAll(e){let t=jo.emptyPath(),a={},h=[];e.forEach(((g,c)=>{if(!t.isImmediateParentOf(c)){const C=this.getFieldsMap(t);this.applyChanges(C,a,h),a={},h=[],t=c.popLast()}g?a[c.lastSegment()]=k_(g):h.push(c.lastSegment())}));const m=this.getFieldsMap(t);this.applyChanges(m,a,h)}delete(e){const t=this.field(e.popLast());Vv(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return ed(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let a=0;a<e.length;++a){let h=t.mapValue.fields[e.get(a)];Vv(h)&&h.mapValue.fields||(h={mapValue:{fields:{}}},t.mapValue.fields[e.get(a)]=h),t=h}return t.mapValue.fields}applyChanges(e,t,a){rm(t,((h,m)=>e[h]=m));for(const h of a)delete e[h]}clone(){return new _c(k_(this.value))}}function nA(i){const e=[];return rm(i.fields,((t,a)=>{const h=new jo([t]);if(Vv(a)){const m=nA(a.mapValue).fields;if(m.length===0)e.push(h);else for(const g of m)e.push(h.child(g))}else e.push(h)})),new th(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xl{constructor(e,t,a,h,m,g,c){this.key=e,this.documentType=t,this.version=a,this.readTime=h,this.createTime=m,this.data=g,this.documentState=c}static newInvalidDocument(e){return new xl(e,0,ri.min(),ri.min(),ri.min(),_c.empty(),0)}static newFoundDocument(e,t,a,h){return new xl(e,1,t,ri.min(),a,h,0)}static newNoDocument(e,t){return new xl(e,2,t,ri.min(),ri.min(),_c.empty(),0)}static newUnknownDocument(e,t){return new xl(e,3,t,ri.min(),ri.min(),_c.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(ri.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=_c.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=_c.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ri.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof xl&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new xl(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class u0{constructor(e,t){this.position=e,this.inclusive=t}}function N2(i,e,t){let a=0;for(let h=0;h<i.position.length;h++){const m=e[h],g=i.position[h];if(m.field.isKeyField()?a=Nn.comparator(Nn.fromName(g.referenceValue),t.key):a=lg(g,t.data.field(m.field)),m.dir==="desc"&&(a*=-1),a!==0)break}return a}function B2(i,e){if(i===null)return e===null;if(e===null||i.inclusive!==e.inclusive||i.position.length!==e.position.length)return!1;for(let t=0;t<i.position.length;t++)if(!ed(i.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c0{constructor(e,t="asc"){this.field=e,this.dir=t}}function zL(i,e){return i.dir===e.dir&&i.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iA{}class Bs extends iA{constructor(e,t,a){super(),this.field=e,this.op=t,this.value=a}static create(e,t,a){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,a):new NL(e,t,a):t==="array-contains"?new VL(e,a):t==="in"?new UL(e,a):t==="not-in"?new jL(e,a):t==="array-contains-any"?new qL(e,a):new Bs(e,t,a)}static createKeyFieldInFilter(e,t,a){return t==="in"?new BL(e,a):new FL(e,a)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(lg(t,this.value)):t!==null&&jf(this.value)===jf(t)&&this.matchesComparison(lg(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Qn(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class oh extends iA{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new oh(e,t)}matches(e){return rA(this)?this.filters.find((t=>!t.matches(e)))===void 0:this.filters.find((t=>t.matches(e)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function rA(i){return i.op==="and"}function aA(i){return OL(i)&&rA(i)}function OL(i){for(const e of i.filters)if(e instanceof oh)return!1;return!0}function Mx(i){if(i instanceof Bs)return i.field.canonicalString()+i.op.toString()+ug(i.value);if(aA(i))return i.filters.map((e=>Mx(e))).join(",");{const e=i.filters.map((t=>Mx(t))).join(",");return`${i.op}(${e})`}}function sA(i,e){return i instanceof Bs?(function(a,h){return h instanceof Bs&&a.op===h.op&&a.field.isEqual(h.field)&&ed(a.value,h.value)})(i,e):i instanceof oh?(function(a,h){return h instanceof oh&&a.op===h.op&&a.filters.length===h.filters.length?a.filters.reduce(((m,g,c)=>m&&sA(g,h.filters[c])),!0):!1})(i,e):void Qn(19439)}function oA(i){return i instanceof Bs?(function(t){return`${t.field.canonicalString()} ${t.op} ${ug(t.value)}`})(i):i instanceof oh?(function(t){return t.op.toString()+" {"+t.getFilters().map(oA).join(" ,")+"}"})(i):"Filter"}class NL extends Bs{constructor(e,t,a){super(e,t,a),this.key=Nn.fromName(a.referenceValue)}matches(e){const t=Nn.comparator(e.key,this.key);return this.matchesComparison(t)}}class BL extends Bs{constructor(e,t){super(e,"in",t),this.keys=lA("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class FL extends Bs{constructor(e,t){super(e,"not-in",t),this.keys=lA("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function lA(i,e){var t;return(((t=e.arrayValue)==null?void 0:t.values)||[]).map((a=>Nn.fromName(a.referenceValue)))}class VL extends Bs{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return I1(t)&&W_(t.arrayValue,this.value)}}class UL extends Bs{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&W_(this.value.arrayValue,t)}}class jL extends Bs{constructor(e,t){super(e,"not-in",t)}matches(e){if(W_(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!W_(this.value.arrayValue,t)}}class qL extends Bs{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!I1(t)||!t.arrayValue.values)&&t.arrayValue.values.some((a=>W_(this.value.arrayValue,a)))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $L{constructor(e,t=null,a=[],h=[],m=null,g=null,c=null){this.path=e,this.collectionGroup=t,this.orderBy=a,this.filters=h,this.limit=m,this.startAt=g,this.endAt=c,this.Te=null}}function F2(i,e=null,t=[],a=[],h=null,m=null,g=null){return new $L(i,e,t,a,h,m,g)}function C1(i){const e=si(i);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((a=>Mx(a))).join(","),t+="|ob:",t+=e.orderBy.map((a=>(function(m){return m.field.canonicalString()+m.dir})(a))).join(","),V0(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((a=>ug(a))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((a=>ug(a))).join(",")),e.Te=t}return e.Te}function P1(i,e){if(i.limit!==e.limit||i.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<i.orderBy.length;t++)if(!zL(i.orderBy[t],e.orderBy[t]))return!1;if(i.filters.length!==e.filters.length)return!1;for(let t=0;t<i.filters.length;t++)if(!sA(i.filters[t],e.filters[t]))return!1;return i.collectionGroup===e.collectionGroup&&!!i.path.isEqual(e.path)&&!!B2(i.startAt,e.startAt)&&B2(i.endAt,e.endAt)}function Rx(i){return Nn.isDocumentKey(i.path)&&i.collectionGroup===null&&i.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class my{constructor(e,t=null,a=[],h=[],m=null,g="F",c=null,C=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=a,this.filters=h,this.limit=m,this.limitType=g,this.startAt=c,this.endAt=C,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function GL(i,e,t,a,h,m,g,c){return new my(i,e,t,a,h,m,g,c)}function uA(i){return new my(i)}function V2(i){return i.filters.length===0&&i.limit===null&&i.startAt==null&&i.endAt==null&&(i.explicitOrderBy.length===0||i.explicitOrderBy.length===1&&i.explicitOrderBy[0].field.isKeyField())}function cA(i){return i.collectionGroup!==null}function L_(i){const e=si(i);if(e.Ie===null){e.Ie=[];const t=new Set;for(const m of e.explicitOrderBy)e.Ie.push(m),t.add(m.field.canonicalString());const a=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(g){let c=new uo(jo.comparator);return g.filters.forEach((C=>{C.getFlattenedFilters().forEach((k=>{k.isInequality()&&(c=c.add(k.field))}))})),c})(e).forEach((m=>{t.has(m.canonicalString())||m.isKeyField()||e.Ie.push(new c0(m,a))})),t.has(jo.keyField().canonicalString())||e.Ie.push(new c0(jo.keyField(),a))}return e.Ie}function jh(i){const e=si(i);return e.Ee||(e.Ee=ZL(e,L_(i))),e.Ee}function ZL(i,e){if(i.limitType==="F")return F2(i.path,i.collectionGroup,e,i.filters,i.limit,i.startAt,i.endAt);{e=e.map((h=>{const m=h.dir==="desc"?"asc":"desc";return new c0(h.field,m)}));const t=i.endAt?new u0(i.endAt.position,i.endAt.inclusive):null,a=i.startAt?new u0(i.startAt.position,i.startAt.inclusive):null;return F2(i.path,i.collectionGroup,e,i.filters,i.limit,t,a)}}function kx(i,e){const t=i.filters.concat([e]);return new my(i.path,i.collectionGroup,i.explicitOrderBy.slice(),t,i.limit,i.limitType,i.startAt,i.endAt)}function Lx(i,e,t){return new my(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),e,t,i.startAt,i.endAt)}function j0(i,e){return P1(jh(i),jh(e))&&i.limitType===e.limitType}function hA(i){return`${C1(jh(i))}|lt:${i.limitType}`}function Gm(i){return`Query(target=${(function(t){let a=t.path.canonicalString();return t.collectionGroup!==null&&(a+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(a+=`, filters: [${t.filters.map((h=>oA(h))).join(", ")}]`),V0(t.limit)||(a+=", limit: "+t.limit),t.orderBy.length>0&&(a+=`, orderBy: [${t.orderBy.map((h=>(function(g){return`${g.field.canonicalString()} (${g.dir})`})(h))).join(", ")}]`),t.startAt&&(a+=", startAt: ",a+=t.startAt.inclusive?"b:":"a:",a+=t.startAt.position.map((h=>ug(h))).join(",")),t.endAt&&(a+=", endAt: ",a+=t.endAt.inclusive?"a:":"b:",a+=t.endAt.position.map((h=>ug(h))).join(",")),`Target(${a})`})(jh(i))}; limitType=${i.limitType})`}function q0(i,e){return e.isFoundDocument()&&(function(a,h){const m=h.key.path;return a.collectionGroup!==null?h.key.hasCollectionId(a.collectionGroup)&&a.path.isPrefixOf(m):Nn.isDocumentKey(a.path)?a.path.isEqual(m):a.path.isImmediateParentOf(m)})(i,e)&&(function(a,h){for(const m of L_(a))if(!m.field.isKeyField()&&h.data.field(m.field)===null)return!1;return!0})(i,e)&&(function(a,h){for(const m of a.filters)if(!m.matches(h))return!1;return!0})(i,e)&&(function(a,h){return!(a.startAt&&!(function(g,c,C){const k=N2(g,c,C);return g.inclusive?k<=0:k<0})(a.startAt,L_(a),h)||a.endAt&&!(function(g,c,C){const k=N2(g,c,C);return g.inclusive?k>=0:k>0})(a.endAt,L_(a),h))})(i,e)}function HL(i){return i.collectionGroup||(i.path.length%2==1?i.path.lastSegment():i.path.get(i.path.length-2))}function dA(i){return(e,t)=>{let a=!1;for(const h of L_(i)){const m=WL(h,e,t);if(m!==0)return m;a=a||h.field.isKeyField()}return 0}}function WL(i,e,t){const a=i.field.isKeyField()?Nn.comparator(e.key,t.key):(function(m,g,c){const C=g.data.field(m),k=c.data.field(m);return C!==null&&k!==null?lg(C,k):Qn(42886)})(i.field,e,t);switch(i.dir){case"asc":return a;case"desc":return-1*a;default:return Qn(19790,{direction:i.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class am{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),a=this.inner[t];if(a!==void 0){for(const[h,m]of a)if(this.equalsFn(h,e))return m}}has(e){return this.get(e)!==void 0}set(e,t){const a=this.mapKeyFn(e),h=this.inner[a];if(h===void 0)return this.inner[a]=[[e,t]],void this.innerSize++;for(let m=0;m<h.length;m++)if(this.equalsFn(h[m][0],e))return void(h[m]=[e,t]);h.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),a=this.inner[t];if(a===void 0)return!1;for(let h=0;h<a.length;h++)if(this.equalsFn(a[h][0],e))return a.length===1?delete this.inner[t]:a.splice(h,1),this.innerSize--,!0;return!1}forEach(e){rm(this.inner,((t,a)=>{for(const[h,m]of a)e(h,m)}))}isEmpty(){return WE(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XL=new Na(Nn.comparator);function Vd(){return XL}const fA=new Na(Nn.comparator);function T_(...i){let e=fA;for(const t of i)e=e.insert(t.key,t);return e}function pA(i){let e=fA;return i.forEach(((t,a)=>e=e.insert(t,a.overlayedDocument))),e}function Np(){return D_()}function mA(){return D_()}function D_(){return new am((i=>i.toString()),((i,e)=>i.isEqual(e)))}const KL=new Na(Nn.comparator),YL=new uo(Nn.comparator);function Di(...i){let e=YL;for(const t of i)e=e.add(t);return e}const QL=new uo(Li);function JL(){return QL}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function M1(i,e){if(i.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:s0(e)?"-0":e}}function gA(i){return{integerValue:""+i}}function eD(i,e){return IL(e)?gA(e):M1(i,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $0{constructor(){this._=void 0}}function tD(i,e,t){return i instanceof X_?(function(h,m){const g={fields:{[YE]:{stringValue:KE},[JE]:{timestampValue:{seconds:h.seconds,nanos:h.nanoseconds}}}};return m&&A1(m)&&(m=U0(m)),m&&(g.fields[QE]=m),{mapValue:g}})(t,e):i instanceof K_?yA(i,e):i instanceof Y_?vA(i,e):(function(h,m){const g=_A(h,m),c=U2(g)+U2(h.Ae);return Px(g)&&Px(h.Ae)?gA(c):M1(h.serializer,c)})(i,e)}function nD(i,e,t){return i instanceof K_?yA(i,e):i instanceof Y_?vA(i,e):t}function _A(i,e){return i instanceof h0?(function(a){return Px(a)||(function(m){return!!m&&"doubleValue"in m})(a)})(e)?e:{integerValue:0}:null}class X_ extends $0{}class K_ extends $0{constructor(e){super(),this.elements=e}}function yA(i,e){const t=bA(e);for(const a of i.elements)t.some((h=>ed(h,a)))||t.push(a);return{arrayValue:{values:t}}}class Y_ extends $0{constructor(e){super(),this.elements=e}}function vA(i,e){let t=bA(e);for(const a of i.elements)t=t.filter((h=>!ed(h,a)));return{arrayValue:{values:t}}}class h0 extends $0{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function U2(i){return hs(i.integerValue||i.doubleValue)}function bA(i){return I1(i)&&i.arrayValue.values?i.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iD{constructor(e,t){this.field=e,this.transform=t}}function rD(i,e){return i.field.isEqual(e.field)&&(function(a,h){return a instanceof K_&&h instanceof K_||a instanceof Y_&&h instanceof Y_?og(a.elements,h.elements,ed):a instanceof h0&&h instanceof h0?ed(a.Ae,h.Ae):a instanceof X_&&h instanceof X_})(i.transform,e.transform)}class aD{constructor(e,t){this.version=e,this.transformResults=t}}class Dd{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Dd}static exists(e){return new Dd(void 0,e)}static updateTime(e){return new Dd(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Uv(i,e){return i.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(i.updateTime):i.exists===void 0||i.exists===e.isFoundDocument()}class G0{}function xA(i,e){if(!i.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return i.isNoDocument()?new TA(i.key,Dd.none()):new gy(i.key,i.data,Dd.none());{const t=i.data,a=_c.empty();let h=new uo(jo.comparator);for(let m of e.fields)if(!h.has(m)){let g=t.field(m);g===null&&m.length>1&&(m=m.popLast(),g=t.field(m)),g===null?a.delete(m):a.set(m,g),h=h.add(m)}return new sm(i.key,a,new th(h.toArray()),Dd.none())}}function sD(i,e,t){i instanceof gy?(function(h,m,g){const c=h.value.clone(),C=q2(h.fieldTransforms,m,g.transformResults);c.setAll(C),m.convertToFoundDocument(g.version,c).setHasCommittedMutations()})(i,e,t):i instanceof sm?(function(h,m,g){if(!Uv(h.precondition,m))return void m.convertToUnknownDocument(g.version);const c=q2(h.fieldTransforms,m,g.transformResults),C=m.data;C.setAll(wA(h)),C.setAll(c),m.convertToFoundDocument(g.version,C).setHasCommittedMutations()})(i,e,t):(function(h,m,g){m.convertToNoDocument(g.version).setHasCommittedMutations()})(0,e,t)}function z_(i,e,t,a){return i instanceof gy?(function(m,g,c,C){if(!Uv(m.precondition,g))return c;const k=m.value.clone(),V=$2(m.fieldTransforms,C,g);return k.setAll(V),g.convertToFoundDocument(g.version,k).setHasLocalMutations(),null})(i,e,t,a):i instanceof sm?(function(m,g,c,C){if(!Uv(m.precondition,g))return c;const k=$2(m.fieldTransforms,C,g),V=g.data;return V.setAll(wA(m)),V.setAll(k),g.convertToFoundDocument(g.version,V).setHasLocalMutations(),c===null?null:c.unionWith(m.fieldMask.fields).unionWith(m.fieldTransforms.map((Z=>Z.field)))})(i,e,t,a):(function(m,g,c){return Uv(m.precondition,g)?(g.convertToNoDocument(g.version).setHasLocalMutations(),null):c})(i,e,t)}function oD(i,e){let t=null;for(const a of i.fieldTransforms){const h=e.data.field(a.field),m=_A(a.transform,h||null);m!=null&&(t===null&&(t=_c.empty()),t.set(a.field,m))}return t||null}function j2(i,e){return i.type===e.type&&!!i.key.isEqual(e.key)&&!!i.precondition.isEqual(e.precondition)&&!!(function(a,h){return a===void 0&&h===void 0||!(!a||!h)&&og(a,h,((m,g)=>rD(m,g)))})(i.fieldTransforms,e.fieldTransforms)&&(i.type===0?i.value.isEqual(e.value):i.type!==1||i.data.isEqual(e.data)&&i.fieldMask.isEqual(e.fieldMask))}class gy extends G0{constructor(e,t,a,h=[]){super(),this.key=e,this.value=t,this.precondition=a,this.fieldTransforms=h,this.type=0}getFieldMask(){return null}}class sm extends G0{constructor(e,t,a,h,m=[]){super(),this.key=e,this.data=t,this.fieldMask=a,this.precondition=h,this.fieldTransforms=m,this.type=1}getFieldMask(){return this.fieldMask}}function wA(i){const e=new Map;return i.fieldMask.fields.forEach((t=>{if(!t.isEmpty()){const a=i.data.field(t);e.set(t,a)}})),e}function q2(i,e,t){const a=new Map;Sr(i.length===t.length,32656,{Re:t.length,Ve:i.length});for(let h=0;h<t.length;h++){const m=i[h],g=m.transform,c=e.data.field(m.field);a.set(m.field,nD(g,c,t[h]))}return a}function $2(i,e,t){const a=new Map;for(const h of i){const m=h.transform,g=t.data.field(h.field);a.set(h.field,tD(m,g,e))}return a}class TA extends G0{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class lD extends G0{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uD{constructor(e,t,a,h){this.batchId=e,this.localWriteTime=t,this.baseMutations=a,this.mutations=h}applyToRemoteDocument(e,t){const a=t.mutationResults;for(let h=0;h<this.mutations.length;h++){const m=this.mutations[h];m.key.isEqual(e.key)&&sD(m,e,a[h])}}applyToLocalView(e,t){for(const a of this.baseMutations)a.key.isEqual(e.key)&&(t=z_(a,e,t,this.localWriteTime));for(const a of this.mutations)a.key.isEqual(e.key)&&(t=z_(a,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const a=mA();return this.mutations.forEach((h=>{const m=e.get(h.key),g=m.overlayedDocument;let c=this.applyToLocalView(g,m.mutatedFields);c=t.has(h.key)?null:c;const C=xA(g,c);C!==null&&a.set(h.key,C),g.isValidDocument()||g.convertToNoDocument(ri.min())})),a}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),Di())}isEqual(e){return this.batchId===e.batchId&&og(this.mutations,e.mutations,((t,a)=>j2(t,a)))&&og(this.baseMutations,e.baseMutations,((t,a)=>j2(t,a)))}}class R1{constructor(e,t,a,h){this.batch=e,this.commitVersion=t,this.mutationResults=a,this.docVersions=h}static from(e,t,a){Sr(e.mutations.length===a.length,58842,{me:e.mutations.length,fe:a.length});let h=(function(){return KL})();const m=e.mutations;for(let g=0;g<m.length;g++)h=h.insert(m[g].key,a[g].version);return new R1(e,t,a,h)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cD{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hD{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ns,Hi;function dD(i){switch(i){case kt.OK:return Qn(64938);case kt.CANCELLED:case kt.UNKNOWN:case kt.DEADLINE_EXCEEDED:case kt.RESOURCE_EXHAUSTED:case kt.INTERNAL:case kt.UNAVAILABLE:case kt.UNAUTHENTICATED:return!1;case kt.INVALID_ARGUMENT:case kt.NOT_FOUND:case kt.ALREADY_EXISTS:case kt.PERMISSION_DENIED:case kt.FAILED_PRECONDITION:case kt.ABORTED:case kt.OUT_OF_RANGE:case kt.UNIMPLEMENTED:case kt.DATA_LOSS:return!0;default:return Qn(15467,{code:i})}}function SA(i){if(i===void 0)return Fd("GRPC error has no .code"),kt.UNKNOWN;switch(i){case Ns.OK:return kt.OK;case Ns.CANCELLED:return kt.CANCELLED;case Ns.UNKNOWN:return kt.UNKNOWN;case Ns.DEADLINE_EXCEEDED:return kt.DEADLINE_EXCEEDED;case Ns.RESOURCE_EXHAUSTED:return kt.RESOURCE_EXHAUSTED;case Ns.INTERNAL:return kt.INTERNAL;case Ns.UNAVAILABLE:return kt.UNAVAILABLE;case Ns.UNAUTHENTICATED:return kt.UNAUTHENTICATED;case Ns.INVALID_ARGUMENT:return kt.INVALID_ARGUMENT;case Ns.NOT_FOUND:return kt.NOT_FOUND;case Ns.ALREADY_EXISTS:return kt.ALREADY_EXISTS;case Ns.PERMISSION_DENIED:return kt.PERMISSION_DENIED;case Ns.FAILED_PRECONDITION:return kt.FAILED_PRECONDITION;case Ns.ABORTED:return kt.ABORTED;case Ns.OUT_OF_RANGE:return kt.OUT_OF_RANGE;case Ns.UNIMPLEMENTED:return kt.UNIMPLEMENTED;case Ns.DATA_LOSS:return kt.DATA_LOSS;default:return Qn(39323,{code:i})}}(Hi=Ns||(Ns={}))[Hi.OK=0]="OK",Hi[Hi.CANCELLED=1]="CANCELLED",Hi[Hi.UNKNOWN=2]="UNKNOWN",Hi[Hi.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Hi[Hi.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Hi[Hi.NOT_FOUND=5]="NOT_FOUND",Hi[Hi.ALREADY_EXISTS=6]="ALREADY_EXISTS",Hi[Hi.PERMISSION_DENIED=7]="PERMISSION_DENIED",Hi[Hi.UNAUTHENTICATED=16]="UNAUTHENTICATED",Hi[Hi.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Hi[Hi.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Hi[Hi.ABORTED=10]="ABORTED",Hi[Hi.OUT_OF_RANGE=11]="OUT_OF_RANGE",Hi[Hi.UNIMPLEMENTED=12]="UNIMPLEMENTED",Hi[Hi.INTERNAL=13]="INTERNAL",Hi[Hi.UNAVAILABLE=14]="UNAVAILABLE",Hi[Hi.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fD(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pD=new Df([4294967295,4294967295],0);function G2(i){const e=fD().encode(i),t=new NE;return t.update(e),new Uint8Array(t.digest())}function Z2(i){const e=new DataView(i.buffer),t=e.getUint32(0,!0),a=e.getUint32(4,!0),h=e.getUint32(8,!0),m=e.getUint32(12,!0);return[new Df([t,a],0),new Df([h,m],0)]}class k1{constructor(e,t,a){if(this.bitmap=e,this.padding=t,this.hashCount=a,t<0||t>=8)throw new S_(`Invalid padding: ${t}`);if(a<0)throw new S_(`Invalid hash count: ${a}`);if(e.length>0&&this.hashCount===0)throw new S_(`Invalid hash count: ${a}`);if(e.length===0&&t!==0)throw new S_(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=Df.fromNumber(this.ge)}ye(e,t,a){let h=e.add(t.multiply(Df.fromNumber(a)));return h.compare(pD)===1&&(h=new Df([h.getBits(0),h.getBits(1)],0)),h.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const t=G2(e),[a,h]=Z2(t);for(let m=0;m<this.hashCount;m++){const g=this.ye(a,h,m);if(!this.we(g))return!1}return!0}static create(e,t,a){const h=e%8==0?0:8-e%8,m=new Uint8Array(Math.ceil(e/8)),g=new k1(m,h,t);return a.forEach((c=>g.insert(c))),g}insert(e){if(this.ge===0)return;const t=G2(e),[a,h]=Z2(t);for(let m=0;m<this.hashCount;m++){const g=this.ye(a,h,m);this.Se(g)}}Se(e){const t=Math.floor(e/8),a=e%8;this.bitmap[t]|=1<<a}}class S_ extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Z0{constructor(e,t,a,h,m){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=a,this.documentUpdates=h,this.resolvedLimboDocuments=m}static createSynthesizedRemoteEventForCurrentChange(e,t,a){const h=new Map;return h.set(e,_y.createSynthesizedTargetChangeForCurrentChange(e,t,a)),new Z0(ri.min(),h,new Na(Li),Vd(),Di())}}class _y{constructor(e,t,a,h,m){this.resumeToken=e,this.current=t,this.addedDocuments=a,this.modifiedDocuments=h,this.removedDocuments=m}static createSynthesizedTargetChangeForCurrentChange(e,t,a){return new _y(a,t,Di(),Di(),Di())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jv{constructor(e,t,a,h){this.be=e,this.removedTargetIds=t,this.key=a,this.De=h}}class EA{constructor(e,t){this.targetId=e,this.Ce=t}}class AA{constructor(e,t,a=qo.EMPTY_BYTE_STRING,h=null){this.state=e,this.targetIds=t,this.resumeToken=a,this.cause=h}}class H2{constructor(){this.ve=0,this.Fe=W2(),this.Me=qo.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=Di(),t=Di(),a=Di();return this.Fe.forEach(((h,m)=>{switch(m){case 0:e=e.add(h);break;case 2:t=t.add(h);break;case 1:a=a.add(h);break;default:Qn(38017,{changeType:m})}})),new _y(this.Me,this.xe,e,t,a)}qe(){this.Oe=!1,this.Fe=W2()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,Sr(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class mD{constructor(e){this.Ge=e,this.ze=new Map,this.je=Vd(),this.Je=Ev(),this.He=Ev(),this.Ye=new Na(Li)}Ze(e){for(const t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,(t=>{const a=this.nt(t);switch(e.state){case 0:this.rt(t)&&a.Le(e.resumeToken);break;case 1:a.Ke(),a.Ne||a.qe(),a.Le(e.resumeToken);break;case 2:a.Ke(),a.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(a.We(),a.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),a.Le(e.resumeToken));break;default:Qn(56790,{state:e.state})}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach(((a,h)=>{this.rt(h)&&t(h)}))}st(e){const t=e.targetId,a=e.Ce.count,h=this.ot(t);if(h){const m=h.target;if(Rx(m))if(a===0){const g=new Nn(m.path);this.et(t,g,xl.newNoDocument(g,ri.min()))}else Sr(a===1,20013,{expectedCount:a});else{const g=this._t(t);if(g!==a){const c=this.ut(e),C=c?this.ct(c,e,g):1;if(C!==0){this.it(t);const k=C===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(t,k)}}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:a="",padding:h=0},hashCount:m=0}=t;let g,c;try{g=Uf(a).toUint8Array()}catch(C){if(C instanceof XE)return sg("Decoding the base64 bloom filter in existence filter failed ("+C.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw C}try{c=new k1(g,h,m)}catch(C){return sg(C instanceof S_?"BloomFilter error: ":"Applying bloom filter failed: ",C),null}return c.ge===0?null:c}ct(e,t,a){return t.Ce.count===a-this.Pt(e,t.targetId)?0:2}Pt(e,t){const a=this.Ge.getRemoteKeysForTarget(t);let h=0;return a.forEach((m=>{const g=this.Ge.ht(),c=`projects/${g.projectId}/databases/${g.database}/documents/${m.path.canonicalString()}`;e.mightContain(c)||(this.et(t,m,null),h++)})),h}Tt(e){const t=new Map;this.ze.forEach(((m,g)=>{const c=this.ot(g);if(c){if(m.current&&Rx(c.target)){const C=new Nn(c.target.path);this.It(C).has(g)||this.Et(g,C)||this.et(g,C,xl.newNoDocument(C,e))}m.Be&&(t.set(g,m.ke()),m.qe())}}));let a=Di();this.He.forEach(((m,g)=>{let c=!0;g.forEachWhile((C=>{const k=this.ot(C);return!k||k.purpose==="TargetPurposeLimboResolution"||(c=!1,!1)})),c&&(a=a.add(m))})),this.je.forEach(((m,g)=>g.setReadTime(e)));const h=new Z0(e,t,this.Ye,this.je,a);return this.je=Vd(),this.Je=Ev(),this.He=Ev(),this.Ye=new Na(Li),h}Xe(e,t){if(!this.rt(e))return;const a=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,a),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,a){if(!this.rt(e))return;const h=this.nt(e);this.Et(e,t)?h.Qe(t,1):h.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),a&&(this.je=this.je.insert(t,a))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new H2,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new uo(Li),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new uo(Li),this.Je=this.Je.insert(e,t)),t}rt(e){const t=this.ot(e)!==null;return t||mn("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new H2),this.Ge.getRemoteKeysForTarget(e).forEach((t=>{this.et(e,t,null)}))}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function Ev(){return new Na(Nn.comparator)}function W2(){return new Na(Nn.comparator)}const gD={asc:"ASCENDING",desc:"DESCENDING"},_D={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},yD={and:"AND",or:"OR"};class vD{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Dx(i,e){return i.useProto3Json||V0(e)?e:{value:e}}function d0(i,e){return i.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function IA(i,e){return i.useProto3Json?e.toBase64():e.toUint8Array()}function bD(i,e){return d0(i,e.toTimestamp())}function qh(i){return Sr(!!i,49232),ri.fromTimestamp((function(t){const a=Vf(t);return new da(a.seconds,a.nanos)})(i))}function L1(i,e){return zx(i,e).canonicalString()}function zx(i,e){const t=(function(h){return new oa(["projects",h.projectId,"databases",h.database])})(i).child("documents");return e===void 0?t:t.child(e)}function CA(i){const e=oa.fromString(i);return Sr(LA(e),10190,{key:e.toString()}),e}function Ox(i,e){return L1(i.databaseId,e.path)}function Gb(i,e){const t=CA(e);if(t.get(1)!==i.databaseId.projectId)throw new gn(kt.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+i.databaseId.projectId);if(t.get(3)!==i.databaseId.database)throw new gn(kt.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+i.databaseId.database);return new Nn(MA(t))}function PA(i,e){return L1(i.databaseId,e)}function xD(i){const e=CA(i);return e.length===4?oa.emptyPath():MA(e)}function Nx(i){return new oa(["projects",i.databaseId.projectId,"databases",i.databaseId.database]).canonicalString()}function MA(i){return Sr(i.length>4&&i.get(4)==="documents",29091,{key:i.toString()}),i.popFirst(5)}function X2(i,e,t){return{name:Ox(i,e),fields:t.value.mapValue.fields}}function wD(i,e){let t;if("targetChange"in e){e.targetChange;const a=(function(k){return k==="NO_CHANGE"?0:k==="ADD"?1:k==="REMOVE"?2:k==="CURRENT"?3:k==="RESET"?4:Qn(39313,{state:k})})(e.targetChange.targetChangeType||"NO_CHANGE"),h=e.targetChange.targetIds||[],m=(function(k,V){return k.useProto3Json?(Sr(V===void 0||typeof V=="string",58123),qo.fromBase64String(V||"")):(Sr(V===void 0||V instanceof Buffer||V instanceof Uint8Array,16193),qo.fromUint8Array(V||new Uint8Array))})(i,e.targetChange.resumeToken),g=e.targetChange.cause,c=g&&(function(k){const V=k.code===void 0?kt.UNKNOWN:SA(k.code);return new gn(V,k.message||"")})(g);t=new AA(a,h,m,c||null)}else if("documentChange"in e){e.documentChange;const a=e.documentChange;a.document,a.document.name,a.document.updateTime;const h=Gb(i,a.document.name),m=qh(a.document.updateTime),g=a.document.createTime?qh(a.document.createTime):ri.min(),c=new _c({mapValue:{fields:a.document.fields}}),C=xl.newFoundDocument(h,m,g,c),k=a.targetIds||[],V=a.removedTargetIds||[];t=new jv(k,V,C.key,C)}else if("documentDelete"in e){e.documentDelete;const a=e.documentDelete;a.document;const h=Gb(i,a.document),m=a.readTime?qh(a.readTime):ri.min(),g=xl.newNoDocument(h,m),c=a.removedTargetIds||[];t=new jv([],c,g.key,g)}else if("documentRemove"in e){e.documentRemove;const a=e.documentRemove;a.document;const h=Gb(i,a.document),m=a.removedTargetIds||[];t=new jv([],m,h,null)}else{if(!("filter"in e))return Qn(11601,{Rt:e});{e.filter;const a=e.filter;a.targetId;const{count:h=0,unchangedNames:m}=a,g=new hD(h,m),c=a.targetId;t=new EA(c,g)}}return t}function TD(i,e){let t;if(e instanceof gy)t={update:X2(i,e.key,e.value)};else if(e instanceof TA)t={delete:Ox(i,e.key)};else if(e instanceof sm)t={update:X2(i,e.key,e.data),updateMask:kD(e.fieldMask)};else{if(!(e instanceof lD))return Qn(16599,{Vt:e.type});t={verify:Ox(i,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map((a=>(function(m,g){const c=g.transform;if(c instanceof X_)return{fieldPath:g.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(c instanceof K_)return{fieldPath:g.field.canonicalString(),appendMissingElements:{values:c.elements}};if(c instanceof Y_)return{fieldPath:g.field.canonicalString(),removeAllFromArray:{values:c.elements}};if(c instanceof h0)return{fieldPath:g.field.canonicalString(),increment:c.Ae};throw Qn(20930,{transform:g.transform})})(0,a)))),e.precondition.isNone||(t.currentDocument=(function(h,m){return m.updateTime!==void 0?{updateTime:bD(h,m.updateTime)}:m.exists!==void 0?{exists:m.exists}:Qn(27497)})(i,e.precondition)),t}function SD(i,e){return i&&i.length>0?(Sr(e!==void 0,14353),i.map((t=>(function(h,m){let g=h.updateTime?qh(h.updateTime):qh(m);return g.isEqual(ri.min())&&(g=qh(m)),new aD(g,h.transformResults||[])})(t,e)))):[]}function ED(i,e){return{documents:[PA(i,e.path)]}}function AD(i,e){const t={structuredQuery:{}},a=e.path;let h;e.collectionGroup!==null?(h=a,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(h=a.popLast(),t.structuredQuery.from=[{collectionId:a.lastSegment()}]),t.parent=PA(i,h);const m=(function(k){if(k.length!==0)return kA(oh.create(k,"and"))})(e.filters);m&&(t.structuredQuery.where=m);const g=(function(k){if(k.length!==0)return k.map((V=>(function(Y){return{field:Zm(Y.field),direction:PD(Y.dir)}})(V)))})(e.orderBy);g&&(t.structuredQuery.orderBy=g);const c=Dx(i,e.limit);return c!==null&&(t.structuredQuery.limit=c),e.startAt&&(t.structuredQuery.startAt=(function(k){return{before:k.inclusive,values:k.position}})(e.startAt)),e.endAt&&(t.structuredQuery.endAt=(function(k){return{before:!k.inclusive,values:k.position}})(e.endAt)),{ft:t,parent:h}}function ID(i){let e=xD(i.parent);const t=i.structuredQuery,a=t.from?t.from.length:0;let h=null;if(a>0){Sr(a===1,65062);const V=t.from[0];V.allDescendants?h=V.collectionId:e=e.child(V.collectionId)}let m=[];t.where&&(m=(function(Z){const Y=RA(Z);return Y instanceof oh&&aA(Y)?Y.getFilters():[Y]})(t.where));let g=[];t.orderBy&&(g=(function(Z){return Z.map((Y=>(function(be){return new c0(Hm(be.field),(function(ze){switch(ze){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(be.direction))})(Y)))})(t.orderBy));let c=null;t.limit&&(c=(function(Z){let Y;return Y=typeof Z=="object"?Z.value:Z,V0(Y)?null:Y})(t.limit));let C=null;t.startAt&&(C=(function(Z){const Y=!!Z.before,Q=Z.values||[];return new u0(Q,Y)})(t.startAt));let k=null;return t.endAt&&(k=(function(Z){const Y=!Z.before,Q=Z.values||[];return new u0(Q,Y)})(t.endAt)),GL(e,h,g,m,c,"F",C,k)}function CD(i,e){const t=(function(h){switch(h){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Qn(28987,{purpose:h})}})(e.purpose);return t==null?null:{"goog-listen-tags":t}}function RA(i){return i.unaryFilter!==void 0?(function(t){switch(t.unaryFilter.op){case"IS_NAN":const a=Hm(t.unaryFilter.field);return Bs.create(a,"==",{doubleValue:NaN});case"IS_NULL":const h=Hm(t.unaryFilter.field);return Bs.create(h,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const m=Hm(t.unaryFilter.field);return Bs.create(m,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const g=Hm(t.unaryFilter.field);return Bs.create(g,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return Qn(61313);default:return Qn(60726)}})(i):i.fieldFilter!==void 0?(function(t){return Bs.create(Hm(t.fieldFilter.field),(function(h){switch(h){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return Qn(58110);default:return Qn(50506)}})(t.fieldFilter.op),t.fieldFilter.value)})(i):i.compositeFilter!==void 0?(function(t){return oh.create(t.compositeFilter.filters.map((a=>RA(a))),(function(h){switch(h){case"AND":return"and";case"OR":return"or";default:return Qn(1026)}})(t.compositeFilter.op))})(i):Qn(30097,{filter:i})}function PD(i){return gD[i]}function MD(i){return _D[i]}function RD(i){return yD[i]}function Zm(i){return{fieldPath:i.canonicalString()}}function Hm(i){return jo.fromServerFormat(i.fieldPath)}function kA(i){return i instanceof Bs?(function(t){if(t.op==="=="){if(O2(t.value))return{unaryFilter:{field:Zm(t.field),op:"IS_NAN"}};if(z2(t.value))return{unaryFilter:{field:Zm(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(O2(t.value))return{unaryFilter:{field:Zm(t.field),op:"IS_NOT_NAN"}};if(z2(t.value))return{unaryFilter:{field:Zm(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Zm(t.field),op:MD(t.op),value:t.value}}})(i):i instanceof oh?(function(t){const a=t.getFilters().map((h=>kA(h)));return a.length===1?a[0]:{compositeFilter:{op:RD(t.op),filters:a}}})(i):Qn(54877,{filter:i})}function kD(i){const e=[];return i.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function LA(i){return i.length>=4&&i.get(0)==="projects"&&i.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pf{constructor(e,t,a,h,m=ri.min(),g=ri.min(),c=qo.EMPTY_BYTE_STRING,C=null){this.target=e,this.targetId=t,this.purpose=a,this.sequenceNumber=h,this.snapshotVersion=m,this.lastLimboFreeSnapshotVersion=g,this.resumeToken=c,this.expectedCount=C}withSequenceNumber(e){return new Pf(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Pf(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Pf(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Pf(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LD{constructor(e){this.yt=e}}function DD(i){const e=ID({parent:i.parent,structuredQuery:i.structuredQuery});return i.limitType==="LAST"?Lx(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zD{constructor(){this.Cn=new OD}addToCollectionParentIndex(e,t){return this.Cn.add(t),Lt.resolve()}getCollectionParents(e,t){return Lt.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return Lt.resolve()}deleteFieldIndex(e,t){return Lt.resolve()}deleteAllFieldIndexes(e){return Lt.resolve()}createTargetIndexes(e,t){return Lt.resolve()}getDocumentsMatchingTarget(e,t){return Lt.resolve(null)}getIndexType(e,t){return Lt.resolve(0)}getFieldIndexes(e,t){return Lt.resolve([])}getNextCollectionGroupToUpdate(e){return Lt.resolve(null)}getMinOffset(e,t){return Lt.resolve(Ff.min())}getMinOffsetFromCollectionGroup(e,t){return Lt.resolve(Ff.min())}updateCollectionGroup(e,t,a){return Lt.resolve()}updateIndexEntries(e,t){return Lt.resolve()}}class OD{constructor(){this.index={}}add(e){const t=e.lastSegment(),a=e.popLast(),h=this.index[t]||new uo(oa.comparator),m=!h.has(a);return this.index[t]=h.add(a),m}has(e){const t=e.lastSegment(),a=e.popLast(),h=this.index[t];return h&&h.has(a)}getEntries(e){return(this.index[e]||new uo(oa.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const K2={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},DA=41943040;class ou{static withCacheSize(e){return new ou(e,ou.DEFAULT_COLLECTION_PERCENTILE,ou.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,a){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=a}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */ou.DEFAULT_COLLECTION_PERCENTILE=10,ou.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,ou.DEFAULT=new ou(DA,ou.DEFAULT_COLLECTION_PERCENTILE,ou.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),ou.DISABLED=new ou(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cg{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new cg(0)}static cr(){return new cg(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Y2="LruGarbageCollector",ND=1048576;function Q2([i,e],[t,a]){const h=Li(i,t);return h===0?Li(e,a):h}class BD{constructor(e){this.Ir=e,this.buffer=new uo(Q2),this.Er=0}dr(){return++this.Er}Ar(e){const t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{const a=this.buffer.last();Q2(t,a)<0&&(this.buffer=this.buffer.delete(a).add(t))}}get maxValue(){return this.buffer.last()[0]}}class FD{constructor(e,t,a){this.garbageCollector=e,this.asyncQueue=t,this.localStore=a,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){mn(Y2,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){xg(t)?mn(Y2,"Ignoring IndexedDB error during garbage collection: ",t):await bg(t)}await this.Vr(3e5)}))}}class VD{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next((a=>Math.floor(t/100*a)))}nthSequenceNumber(e,t){if(t===0)return Lt.resolve(F0.ce);const a=new BD(t);return this.mr.forEachTarget(e,(h=>a.Ar(h.sequenceNumber))).next((()=>this.mr.pr(e,(h=>a.Ar(h))))).next((()=>a.maxValue))}removeTargets(e,t,a){return this.mr.removeTargets(e,t,a)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(mn("LruGarbageCollector","Garbage collection skipped; disabled"),Lt.resolve(K2)):this.getCacheSize(e).next((a=>a<this.params.cacheSizeCollectionThreshold?(mn("LruGarbageCollector",`Garbage collection skipped; Cache size ${a} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),K2):this.yr(e,t)))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let a,h,m,g,c,C,k;const V=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((Z=>(Z>this.params.maximumSequenceNumbersToCollect?(mn("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${Z}`),h=this.params.maximumSequenceNumbersToCollect):h=Z,g=Date.now(),this.nthSequenceNumber(e,h)))).next((Z=>(a=Z,c=Date.now(),this.removeTargets(e,a,t)))).next((Z=>(m=Z,C=Date.now(),this.removeOrphanedDocuments(e,a)))).next((Z=>(k=Date.now(),$m()<=ki.DEBUG&&mn("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${g-V}ms
	Determined least recently used ${h} in `+(c-g)+`ms
	Removed ${m} targets in `+(C-c)+`ms
	Removed ${Z} documents in `+(k-C)+`ms
Total Duration: ${k-V}ms`),Lt.resolve({didRun:!0,sequenceNumbersCollected:h,targetsRemoved:m,documentsRemoved:Z}))))}}function UD(i,e){return new VD(i,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jD{constructor(){this.changes=new am((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,xl.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const a=this.changes.get(t);return a!==void 0?Lt.resolve(a):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qD{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $D{constructor(e,t,a,h){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=a,this.indexManager=h}getDocument(e,t){let a=null;return this.documentOverlayCache.getOverlay(e,t).next((h=>(a=h,this.remoteDocumentCache.getEntry(e,t)))).next((h=>(a!==null&&z_(a.mutation,h,th.empty(),da.now()),h)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((a=>this.getLocalViewOfDocuments(e,a,Di()).next((()=>a))))}getLocalViewOfDocuments(e,t,a=Di()){const h=Np();return this.populateOverlays(e,h,t).next((()=>this.computeViews(e,t,h,a).next((m=>{let g=T_();return m.forEach(((c,C)=>{g=g.insert(c,C.overlayedDocument)})),g}))))}getOverlayedDocuments(e,t){const a=Np();return this.populateOverlays(e,a,t).next((()=>this.computeViews(e,t,a,Di())))}populateOverlays(e,t,a){const h=[];return a.forEach((m=>{t.has(m)||h.push(m)})),this.documentOverlayCache.getOverlays(e,h).next((m=>{m.forEach(((g,c)=>{t.set(g,c)}))}))}computeViews(e,t,a,h){let m=Vd();const g=D_(),c=(function(){return D_()})();return t.forEach(((C,k)=>{const V=a.get(k.key);h.has(k.key)&&(V===void 0||V.mutation instanceof sm)?m=m.insert(k.key,k):V!==void 0?(g.set(k.key,V.mutation.getFieldMask()),z_(V.mutation,k,V.mutation.getFieldMask(),da.now())):g.set(k.key,th.empty())})),this.recalculateAndSaveOverlays(e,m).next((C=>(C.forEach(((k,V)=>g.set(k,V))),t.forEach(((k,V)=>c.set(k,new qD(V,g.get(k)??null)))),c)))}recalculateAndSaveOverlays(e,t){const a=D_();let h=new Na(((g,c)=>g-c)),m=Di();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((g=>{for(const c of g)c.keys().forEach((C=>{const k=t.get(C);if(k===null)return;let V=a.get(C)||th.empty();V=c.applyToLocalView(k,V),a.set(C,V);const Z=(h.get(c.batchId)||Di()).add(C);h=h.insert(c.batchId,Z)}))})).next((()=>{const g=[],c=h.getReverseIterator();for(;c.hasNext();){const C=c.getNext(),k=C.key,V=C.value,Z=mA();V.forEach((Y=>{if(!m.has(Y)){const Q=xA(t.get(Y),a.get(Y));Q!==null&&Z.set(Y,Q),m=m.add(Y)}})),g.push(this.documentOverlayCache.saveOverlays(e,k,Z))}return Lt.waitFor(g)})).next((()=>a))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((a=>this.recalculateAndSaveOverlays(e,a)))}getDocumentsMatchingQuery(e,t,a,h){return(function(g){return Nn.isDocumentKey(g.path)&&g.collectionGroup===null&&g.filters.length===0})(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):cA(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,a,h):this.getDocumentsMatchingCollectionQuery(e,t,a,h)}getNextDocuments(e,t,a,h){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,a,h).next((m=>{const g=h-m.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,a.largestBatchId,h-m.size):Lt.resolve(Np());let c=G_,C=m;return g.next((k=>Lt.forEach(k,((V,Z)=>(c<Z.largestBatchId&&(c=Z.largestBatchId),m.get(V)?Lt.resolve():this.remoteDocumentCache.getEntry(e,V).next((Y=>{C=C.insert(V,Y)}))))).next((()=>this.populateOverlays(e,k,m))).next((()=>this.computeViews(e,C,k,Di()))).next((V=>({batchId:c,changes:pA(V)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new Nn(t)).next((a=>{let h=T_();return a.isFoundDocument()&&(h=h.insert(a.key,a)),h}))}getDocumentsMatchingCollectionGroupQuery(e,t,a,h){const m=t.collectionGroup;let g=T_();return this.indexManager.getCollectionParents(e,m).next((c=>Lt.forEach(c,(C=>{const k=(function(Z,Y){return new my(Y,null,Z.explicitOrderBy.slice(),Z.filters.slice(),Z.limit,Z.limitType,Z.startAt,Z.endAt)})(t,C.child(m));return this.getDocumentsMatchingCollectionQuery(e,k,a,h).next((V=>{V.forEach(((Z,Y)=>{g=g.insert(Z,Y)}))}))})).next((()=>g))))}getDocumentsMatchingCollectionQuery(e,t,a,h){let m;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,a.largestBatchId).next((g=>(m=g,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,a,m,h)))).next((g=>{m.forEach(((C,k)=>{const V=k.getKey();g.get(V)===null&&(g=g.insert(V,xl.newInvalidDocument(V)))}));let c=T_();return g.forEach(((C,k)=>{const V=m.get(C);V!==void 0&&z_(V.mutation,k,th.empty(),da.now()),q0(t,k)&&(c=c.insert(C,k))})),c}))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GD{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return Lt.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,(function(h){return{id:h.id,version:h.version,createTime:qh(h.createTime)}})(t)),Lt.resolve()}getNamedQuery(e,t){return Lt.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,(function(h){return{name:h.name,query:DD(h.bundledQuery),readTime:qh(h.readTime)}})(t)),Lt.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZD{constructor(){this.overlays=new Na(Nn.comparator),this.qr=new Map}getOverlay(e,t){return Lt.resolve(this.overlays.get(t))}getOverlays(e,t){const a=Np();return Lt.forEach(t,(h=>this.getOverlay(e,h).next((m=>{m!==null&&a.set(h,m)})))).next((()=>a))}saveOverlays(e,t,a){return a.forEach(((h,m)=>{this.St(e,t,m)})),Lt.resolve()}removeOverlaysForBatchId(e,t,a){const h=this.qr.get(a);return h!==void 0&&(h.forEach((m=>this.overlays=this.overlays.remove(m))),this.qr.delete(a)),Lt.resolve()}getOverlaysForCollection(e,t,a){const h=Np(),m=t.length+1,g=new Nn(t.child("")),c=this.overlays.getIteratorFrom(g);for(;c.hasNext();){const C=c.getNext().value,k=C.getKey();if(!t.isPrefixOf(k.path))break;k.path.length===m&&C.largestBatchId>a&&h.set(C.getKey(),C)}return Lt.resolve(h)}getOverlaysForCollectionGroup(e,t,a,h){let m=new Na(((k,V)=>k-V));const g=this.overlays.getIterator();for(;g.hasNext();){const k=g.getNext().value;if(k.getKey().getCollectionGroup()===t&&k.largestBatchId>a){let V=m.get(k.largestBatchId);V===null&&(V=Np(),m=m.insert(k.largestBatchId,V)),V.set(k.getKey(),k)}}const c=Np(),C=m.getIterator();for(;C.hasNext()&&(C.getNext().value.forEach(((k,V)=>c.set(k,V))),!(c.size()>=h)););return Lt.resolve(c)}St(e,t,a){const h=this.overlays.get(a.key);if(h!==null){const g=this.qr.get(h.largestBatchId).delete(a.key);this.qr.set(h.largestBatchId,g)}this.overlays=this.overlays.insert(a.key,new cD(t,a));let m=this.qr.get(t);m===void 0&&(m=Di(),this.qr.set(t,m)),this.qr.set(t,m.add(a.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HD{constructor(){this.sessionToken=qo.EMPTY_BYTE_STRING}getSessionToken(e){return Lt.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,Lt.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D1{constructor(){this.Qr=new uo(Ao.$r),this.Ur=new uo(Ao.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){const a=new Ao(e,t);this.Qr=this.Qr.add(a),this.Ur=this.Ur.add(a)}Wr(e,t){e.forEach((a=>this.addReference(a,t)))}removeReference(e,t){this.Gr(new Ao(e,t))}zr(e,t){e.forEach((a=>this.removeReference(a,t)))}jr(e){const t=new Nn(new oa([])),a=new Ao(t,e),h=new Ao(t,e+1),m=[];return this.Ur.forEachInRange([a,h],(g=>{this.Gr(g),m.push(g.key)})),m}Jr(){this.Qr.forEach((e=>this.Gr(e)))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const t=new Nn(new oa([])),a=new Ao(t,e),h=new Ao(t,e+1);let m=Di();return this.Ur.forEachInRange([a,h],(g=>{m=m.add(g.key)})),m}containsKey(e){const t=new Ao(e,0),a=this.Qr.firstAfterOrEqual(t);return a!==null&&e.isEqual(a.key)}}class Ao{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return Nn.comparator(e.key,t.key)||Li(e.Yr,t.Yr)}static Kr(e,t){return Li(e.Yr,t.Yr)||Nn.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WD{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new uo(Ao.$r)}checkEmpty(e){return Lt.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,a,h){const m=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const g=new uD(m,t,a,h);this.mutationQueue.push(g);for(const c of h)this.Zr=this.Zr.add(new Ao(c.key,m)),this.indexManager.addToCollectionParentIndex(e,c.key.path.popLast());return Lt.resolve(g)}lookupMutationBatch(e,t){return Lt.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){const a=t+1,h=this.ei(a),m=h<0?0:h;return Lt.resolve(this.mutationQueue.length>m?this.mutationQueue[m]:null)}getHighestUnacknowledgedBatchId(){return Lt.resolve(this.mutationQueue.length===0?E1:this.tr-1)}getAllMutationBatches(e){return Lt.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const a=new Ao(t,0),h=new Ao(t,Number.POSITIVE_INFINITY),m=[];return this.Zr.forEachInRange([a,h],(g=>{const c=this.Xr(g.Yr);m.push(c)})),Lt.resolve(m)}getAllMutationBatchesAffectingDocumentKeys(e,t){let a=new uo(Li);return t.forEach((h=>{const m=new Ao(h,0),g=new Ao(h,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([m,g],(c=>{a=a.add(c.Yr)}))})),Lt.resolve(this.ti(a))}getAllMutationBatchesAffectingQuery(e,t){const a=t.path,h=a.length+1;let m=a;Nn.isDocumentKey(m)||(m=m.child(""));const g=new Ao(new Nn(m),0);let c=new uo(Li);return this.Zr.forEachWhile((C=>{const k=C.key.path;return!!a.isPrefixOf(k)&&(k.length===h&&(c=c.add(C.Yr)),!0)}),g),Lt.resolve(this.ti(c))}ti(e){const t=[];return e.forEach((a=>{const h=this.Xr(a);h!==null&&t.push(h)})),t}removeMutationBatch(e,t){Sr(this.ni(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let a=this.Zr;return Lt.forEach(t.mutations,(h=>{const m=new Ao(h.key,t.batchId);return a=a.delete(m),this.referenceDelegate.markPotentiallyOrphaned(e,h.key)})).next((()=>{this.Zr=a}))}ir(e){}containsKey(e,t){const a=new Ao(t,0),h=this.Zr.firstAfterOrEqual(a);return Lt.resolve(t.isEqual(h&&h.key))}performConsistencyCheck(e){return this.mutationQueue.length,Lt.resolve()}ni(e,t){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XD{constructor(e){this.ri=e,this.docs=(function(){return new Na(Nn.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const a=t.key,h=this.docs.get(a),m=h?h.size:0,g=this.ri(t);return this.docs=this.docs.insert(a,{document:t.mutableCopy(),size:g}),this.size+=g-m,this.indexManager.addToCollectionParentIndex(e,a.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const a=this.docs.get(t);return Lt.resolve(a?a.document.mutableCopy():xl.newInvalidDocument(t))}getEntries(e,t){let a=Vd();return t.forEach((h=>{const m=this.docs.get(h);a=a.insert(h,m?m.document.mutableCopy():xl.newInvalidDocument(h))})),Lt.resolve(a)}getDocumentsMatchingQuery(e,t,a,h){let m=Vd();const g=t.path,c=new Nn(g.child("__id-9223372036854775808__")),C=this.docs.getIteratorFrom(c);for(;C.hasNext();){const{key:k,value:{document:V}}=C.getNext();if(!g.isPrefixOf(k.path))break;k.path.length>g.length+1||TL(wL(V),a)<=0||(h.has(V.key)||q0(t,V))&&(m=m.insert(V.key,V.mutableCopy()))}return Lt.resolve(m)}getAllFromCollectionGroup(e,t,a,h){Qn(9500)}ii(e,t){return Lt.forEach(this.docs,(a=>t(a)))}newChangeBuffer(e){return new KD(this)}getSize(e){return Lt.resolve(this.size)}}class KD extends jD{constructor(e){super(),this.Nr=e}applyChanges(e){const t=[];return this.changes.forEach(((a,h)=>{h.isValidDocument()?t.push(this.Nr.addEntry(e,h)):this.Nr.removeEntry(a)})),Lt.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YD{constructor(e){this.persistence=e,this.si=new am((t=>C1(t)),P1),this.lastRemoteSnapshotVersion=ri.min(),this.highestTargetId=0,this.oi=0,this._i=new D1,this.targetCount=0,this.ai=cg.ur()}forEachTarget(e,t){return this.si.forEach(((a,h)=>t(h))),Lt.resolve()}getLastRemoteSnapshotVersion(e){return Lt.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return Lt.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),Lt.resolve(this.highestTargetId)}setTargetsMetadata(e,t,a){return a&&(this.lastRemoteSnapshotVersion=a),t>this.oi&&(this.oi=t),Lt.resolve()}Pr(e){this.si.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ai=new cg(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,Lt.resolve()}updateTargetData(e,t){return this.Pr(t),Lt.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,Lt.resolve()}removeTargets(e,t,a){let h=0;const m=[];return this.si.forEach(((g,c)=>{c.sequenceNumber<=t&&a.get(c.targetId)===null&&(this.si.delete(g),m.push(this.removeMatchingKeysForTargetId(e,c.targetId)),h++)})),Lt.waitFor(m).next((()=>h))}getTargetCount(e){return Lt.resolve(this.targetCount)}getTargetData(e,t){const a=this.si.get(t)||null;return Lt.resolve(a)}addMatchingKeys(e,t,a){return this._i.Wr(t,a),Lt.resolve()}removeMatchingKeys(e,t,a){this._i.zr(t,a);const h=this.persistence.referenceDelegate,m=[];return h&&t.forEach((g=>{m.push(h.markPotentiallyOrphaned(e,g))})),Lt.waitFor(m)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),Lt.resolve()}getMatchingKeysForTargetId(e,t){const a=this._i.Hr(t);return Lt.resolve(a)}containsKey(e,t){return Lt.resolve(this._i.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zA{constructor(e,t){this.ui={},this.overlays={},this.ci=new F0(0),this.li=!1,this.li=!0,this.hi=new HD,this.referenceDelegate=e(this),this.Pi=new YD(this),this.indexManager=new zD,this.remoteDocumentCache=(function(h){return new XD(h)})((a=>this.referenceDelegate.Ti(a))),this.serializer=new LD(t),this.Ii=new GD(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new ZD,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let a=this.ui[e.toKey()];return a||(a=new WD(t,this.referenceDelegate),this.ui[e.toKey()]=a),a}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,a){mn("MemoryPersistence","Starting transaction:",e);const h=new QD(this.ci.next());return this.referenceDelegate.Ei(),a(h).next((m=>this.referenceDelegate.di(h).next((()=>m)))).toPromise().then((m=>(h.raiseOnCommittedEvent(),m)))}Ai(e,t){return Lt.or(Object.values(this.ui).map((a=>()=>a.containsKey(e,t))))}}class QD extends EL{constructor(e){super(),this.currentSequenceNumber=e}}class z1{constructor(e){this.persistence=e,this.Ri=new D1,this.Vi=null}static mi(e){return new z1(e)}get fi(){if(this.Vi)return this.Vi;throw Qn(60996)}addReference(e,t,a){return this.Ri.addReference(a,t),this.fi.delete(a.toString()),Lt.resolve()}removeReference(e,t,a){return this.Ri.removeReference(a,t),this.fi.add(a.toString()),Lt.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),Lt.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach((h=>this.fi.add(h.toString())));const a=this.persistence.getTargetCache();return a.getMatchingKeysForTargetId(e,t.targetId).next((h=>{h.forEach((m=>this.fi.add(m.toString())))})).next((()=>a.removeTargetData(e,t)))}Ei(){this.Vi=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Lt.forEach(this.fi,(a=>{const h=Nn.fromPath(a);return this.gi(e,h).next((m=>{m||t.removeEntry(h,ri.min())}))})).next((()=>(this.Vi=null,t.apply(e))))}updateLimboDocument(e,t){return this.gi(e,t).next((a=>{a?this.fi.delete(t.toString()):this.fi.add(t.toString())}))}Ti(e){return 0}gi(e,t){return Lt.or([()=>Lt.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class f0{constructor(e,t){this.persistence=e,this.pi=new am((a=>CL(a.path)),((a,h)=>a.isEqual(h))),this.garbageCollector=UD(this,t)}static mi(e,t){return new f0(e,t)}Ei(){}di(e){return Lt.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){const t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next((a=>t.next((h=>a+h))))}wr(e){let t=0;return this.pr(e,(a=>{t++})).next((()=>t))}pr(e,t){return Lt.forEach(this.pi,((a,h)=>this.br(e,a,h).next((m=>m?Lt.resolve():t(h)))))}removeTargets(e,t,a){return this.persistence.getTargetCache().removeTargets(e,t,a)}removeOrphanedDocuments(e,t){let a=0;const h=this.persistence.getRemoteDocumentCache(),m=h.newChangeBuffer();return h.ii(e,(g=>this.br(e,g,t).next((c=>{c||(a++,m.removeEntry(g,ri.min()))})))).next((()=>m.apply(e))).next((()=>a))}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),Lt.resolve()}removeTarget(e,t){const a=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,a)}addReference(e,t,a){return this.pi.set(a,e.currentSequenceNumber),Lt.resolve()}removeReference(e,t,a){return this.pi.set(a,e.currentSequenceNumber),Lt.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),Lt.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Fv(e.data.value)),t}br(e,t,a){return Lt.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const h=this.pi.get(t);return Lt.resolve(h!==void 0&&h>a)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class O1{constructor(e,t,a,h){this.targetId=e,this.fromCache=t,this.Es=a,this.ds=h}static As(e,t){let a=Di(),h=Di();for(const m of t.docChanges)switch(m.type){case 0:a=a.add(m.doc.key);break;case 1:h=h.add(m.doc.key)}return new O1(e,t.fromCache,a,h)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JD{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class e5{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(function(){return $R()?8:AL(wl())>0?6:4})()}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,a,h){const m={result:null};return this.ys(e,t).next((g=>{m.result=g})).next((()=>{if(!m.result)return this.ws(e,t,h,a).next((g=>{m.result=g}))})).next((()=>{if(m.result)return;const g=new JD;return this.Ss(e,t,g).next((c=>{if(m.result=c,this.Vs)return this.bs(e,t,g,c.size)}))})).next((()=>m.result))}bs(e,t,a,h){return a.documentReadCount<this.fs?($m()<=ki.DEBUG&&mn("QueryEngine","SDK will not create cache indexes for query:",Gm(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),Lt.resolve()):($m()<=ki.DEBUG&&mn("QueryEngine","Query:",Gm(t),"scans",a.documentReadCount,"local documents and returns",h,"documents as results."),a.documentReadCount>this.gs*h?($m()<=ki.DEBUG&&mn("QueryEngine","The SDK decides to create cache indexes for query:",Gm(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,jh(t))):Lt.resolve())}ys(e,t){if(V2(t))return Lt.resolve(null);let a=jh(t);return this.indexManager.getIndexType(e,a).next((h=>h===0?null:(t.limit!==null&&h===1&&(t=Lx(t,null,"F"),a=jh(t)),this.indexManager.getDocumentsMatchingTarget(e,a).next((m=>{const g=Di(...m);return this.ps.getDocuments(e,g).next((c=>this.indexManager.getMinOffset(e,a).next((C=>{const k=this.Ds(t,c);return this.Cs(t,k,g,C.readTime)?this.ys(e,Lx(t,null,"F")):this.vs(e,k,t,C)}))))})))))}ws(e,t,a,h){return V2(t)||h.isEqual(ri.min())?Lt.resolve(null):this.ps.getDocuments(e,a).next((m=>{const g=this.Ds(t,m);return this.Cs(t,g,a,h)?Lt.resolve(null):($m()<=ki.DEBUG&&mn("QueryEngine","Re-using previous result from %s to execute query: %s",h.toString(),Gm(t)),this.vs(e,g,t,xL(h,G_)).next((c=>c)))}))}Ds(e,t){let a=new uo(dA(e));return t.forEach(((h,m)=>{q0(e,m)&&(a=a.add(m))})),a}Cs(e,t,a,h){if(e.limit===null)return!1;if(a.size!==t.size)return!0;const m=e.limitType==="F"?t.last():t.first();return!!m&&(m.hasPendingWrites||m.version.compareTo(h)>0)}Ss(e,t,a){return $m()<=ki.DEBUG&&mn("QueryEngine","Using full collection scan to execute query:",Gm(t)),this.ps.getDocumentsMatchingQuery(e,t,Ff.min(),a)}vs(e,t,a,h){return this.ps.getDocumentsMatchingQuery(e,a,h).next((m=>(t.forEach((g=>{m=m.insert(g.key,g)})),m)))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const N1="LocalStore",t5=3e8;class n5{constructor(e,t,a,h){this.persistence=e,this.Fs=t,this.serializer=h,this.Ms=new Na(Li),this.xs=new am((m=>C1(m)),P1),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(a)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new $D(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.Ms)))}}function i5(i,e,t,a){return new n5(i,e,t,a)}async function OA(i,e){const t=si(i);return await t.persistence.runTransaction("Handle user change","readonly",(a=>{let h;return t.mutationQueue.getAllMutationBatches(a).next((m=>(h=m,t.Bs(e),t.mutationQueue.getAllMutationBatches(a)))).next((m=>{const g=[],c=[];let C=Di();for(const k of h){g.push(k.batchId);for(const V of k.mutations)C=C.add(V.key)}for(const k of m){c.push(k.batchId);for(const V of k.mutations)C=C.add(V.key)}return t.localDocuments.getDocuments(a,C).next((k=>({Ls:k,removedBatchIds:g,addedBatchIds:c})))}))}))}function r5(i,e){const t=si(i);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",(a=>{const h=e.batch.keys(),m=t.Ns.newChangeBuffer({trackRemovals:!0});return(function(c,C,k,V){const Z=k.batch,Y=Z.keys();let Q=Lt.resolve();return Y.forEach((be=>{Q=Q.next((()=>V.getEntry(C,be))).next((xe=>{const ze=k.docVersions.get(be);Sr(ze!==null,48541),xe.version.compareTo(ze)<0&&(Z.applyToRemoteDocument(xe,k),xe.isValidDocument()&&(xe.setReadTime(k.commitVersion),V.addEntry(xe)))}))})),Q.next((()=>c.mutationQueue.removeMutationBatch(C,Z)))})(t,a,e,m).next((()=>m.apply(a))).next((()=>t.mutationQueue.performConsistencyCheck(a))).next((()=>t.documentOverlayCache.removeOverlaysForBatchId(a,h,e.batch.batchId))).next((()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(a,(function(c){let C=Di();for(let k=0;k<c.mutationResults.length;++k)c.mutationResults[k].transformResults.length>0&&(C=C.add(c.batch.mutations[k].key));return C})(e)))).next((()=>t.localDocuments.getDocuments(a,h)))}))}function NA(i){const e=si(i);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Pi.getLastRemoteSnapshotVersion(t)))}function a5(i,e){const t=si(i),a=e.snapshotVersion;let h=t.Ms;return t.persistence.runTransaction("Apply remote event","readwrite-primary",(m=>{const g=t.Ns.newChangeBuffer({trackRemovals:!0});h=t.Ms;const c=[];e.targetChanges.forEach(((V,Z)=>{const Y=h.get(Z);if(!Y)return;c.push(t.Pi.removeMatchingKeys(m,V.removedDocuments,Z).next((()=>t.Pi.addMatchingKeys(m,V.addedDocuments,Z))));let Q=Y.withSequenceNumber(m.currentSequenceNumber);e.targetMismatches.get(Z)!==null?Q=Q.withResumeToken(qo.EMPTY_BYTE_STRING,ri.min()).withLastLimboFreeSnapshotVersion(ri.min()):V.resumeToken.approximateByteSize()>0&&(Q=Q.withResumeToken(V.resumeToken,a)),h=h.insert(Z,Q),(function(xe,ze,et){return xe.resumeToken.approximateByteSize()===0||ze.snapshotVersion.toMicroseconds()-xe.snapshotVersion.toMicroseconds()>=t5?!0:et.addedDocuments.size+et.modifiedDocuments.size+et.removedDocuments.size>0})(Y,Q,V)&&c.push(t.Pi.updateTargetData(m,Q))}));let C=Vd(),k=Di();if(e.documentUpdates.forEach((V=>{e.resolvedLimboDocuments.has(V)&&c.push(t.persistence.referenceDelegate.updateLimboDocument(m,V))})),c.push(s5(m,g,e.documentUpdates).next((V=>{C=V.ks,k=V.qs}))),!a.isEqual(ri.min())){const V=t.Pi.getLastRemoteSnapshotVersion(m).next((Z=>t.Pi.setTargetsMetadata(m,m.currentSequenceNumber,a)));c.push(V)}return Lt.waitFor(c).next((()=>g.apply(m))).next((()=>t.localDocuments.getLocalViewOfDocuments(m,C,k))).next((()=>C))})).then((m=>(t.Ms=h,m)))}function s5(i,e,t){let a=Di(),h=Di();return t.forEach((m=>a=a.add(m))),e.getEntries(i,a).next((m=>{let g=Vd();return t.forEach(((c,C)=>{const k=m.get(c);C.isFoundDocument()!==k.isFoundDocument()&&(h=h.add(c)),C.isNoDocument()&&C.version.isEqual(ri.min())?(e.removeEntry(c,C.readTime),g=g.insert(c,C)):!k.isValidDocument()||C.version.compareTo(k.version)>0||C.version.compareTo(k.version)===0&&k.hasPendingWrites?(e.addEntry(C),g=g.insert(c,C)):mn(N1,"Ignoring outdated watch update for ",c,". Current version:",k.version," Watch version:",C.version)})),{ks:g,qs:h}}))}function o5(i,e){const t=si(i);return t.persistence.runTransaction("Get next mutation batch","readonly",(a=>(e===void 0&&(e=E1),t.mutationQueue.getNextMutationBatchAfterBatchId(a,e))))}function l5(i,e){const t=si(i);return t.persistence.runTransaction("Allocate target","readwrite",(a=>{let h;return t.Pi.getTargetData(a,e).next((m=>m?(h=m,Lt.resolve(h)):t.Pi.allocateTargetId(a).next((g=>(h=new Pf(e,g,"TargetPurposeListen",a.currentSequenceNumber),t.Pi.addTargetData(a,h).next((()=>h)))))))})).then((a=>{const h=t.Ms.get(a.targetId);return(h===null||a.snapshotVersion.compareTo(h.snapshotVersion)>0)&&(t.Ms=t.Ms.insert(a.targetId,a),t.xs.set(e,a.targetId)),a}))}async function Bx(i,e,t){const a=si(i),h=a.Ms.get(e),m=t?"readwrite":"readwrite-primary";try{t||await a.persistence.runTransaction("Release target",m,(g=>a.persistence.referenceDelegate.removeTarget(g,h)))}catch(g){if(!xg(g))throw g;mn(N1,`Failed to update sequence numbers for target ${e}: ${g}`)}a.Ms=a.Ms.remove(e),a.xs.delete(h.target)}function J2(i,e,t){const a=si(i);let h=ri.min(),m=Di();return a.persistence.runTransaction("Execute query","readwrite",(g=>(function(C,k,V){const Z=si(C),Y=Z.xs.get(V);return Y!==void 0?Lt.resolve(Z.Ms.get(Y)):Z.Pi.getTargetData(k,V)})(a,g,jh(e)).next((c=>{if(c)return h=c.lastLimboFreeSnapshotVersion,a.Pi.getMatchingKeysForTargetId(g,c.targetId).next((C=>{m=C}))})).next((()=>a.Fs.getDocumentsMatchingQuery(g,e,t?h:ri.min(),t?m:Di()))).next((c=>(u5(a,HL(e),c),{documents:c,Qs:m})))))}function u5(i,e,t){let a=i.Os.get(e)||ri.min();t.forEach(((h,m)=>{m.readTime.compareTo(a)>0&&(a=m.readTime)})),i.Os.set(e,a)}class eT{constructor(){this.activeTargetIds=JL()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class c5{constructor(){this.Mo=new eT,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,a){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,a){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new eT,Promise.resolve()}handleUserChange(e,t,a){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h5{Oo(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tT="ConnectivityMonitor";class nT{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){mn(tT,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){mn(tT,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Av=null;function Fx(){return Av===null?Av=(function(){return 268435456+Math.round(2147483648*Math.random())})():Av++,"0x"+Av.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zb="RestConnection",d5={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class f5{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",a=encodeURIComponent(this.databaseId.projectId),h=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${a}/databases/${h}`,this.Wo=this.databaseId.database===o0?`project_id=${a}`:`project_id=${a}&database_id=${h}`}Go(e,t,a,h,m){const g=Fx(),c=this.zo(e,t.toUriEncodedString());mn(Zb,`Sending RPC '${e}' ${g}:`,c,a);const C={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(C,h,m);const{host:k}=new URL(c),V=_g(k);return this.Jo(e,c,C,a,V).then((Z=>(mn(Zb,`Received RPC '${e}' ${g}: `,Z),Z)),(Z=>{throw sg(Zb,`RPC '${e}' ${g} failed with error: `,Z,"url: ",c,"request:",a),Z}))}Ho(e,t,a,h,m,g){return this.Go(e,t,a,h,m)}jo(e,t,a){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+vg})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((h,m)=>e[m]=h)),a&&a.headers.forEach(((h,m)=>e[m]=h))}zo(e,t){const a=d5[e];return`${this.Uo}/v1/${t}:${a}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class p5{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vl="WebChannelConnection";class m5 extends f5{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,a,h,m){const g=Fx();return new Promise(((c,C)=>{const k=new BE;k.setWithCredentials(!0),k.listenOnce(FE.COMPLETE,(()=>{try{switch(k.getLastErrorCode()){case Bv.NO_ERROR:const Z=k.getResponseJson();mn(vl,`XHR for RPC '${e}' ${g} received:`,JSON.stringify(Z)),c(Z);break;case Bv.TIMEOUT:mn(vl,`RPC '${e}' ${g} timed out`),C(new gn(kt.DEADLINE_EXCEEDED,"Request time out"));break;case Bv.HTTP_ERROR:const Y=k.getStatus();if(mn(vl,`RPC '${e}' ${g} failed with status:`,Y,"response text:",k.getResponseText()),Y>0){let Q=k.getResponseJson();Array.isArray(Q)&&(Q=Q[0]);const be=Q==null?void 0:Q.error;if(be&&be.status&&be.message){const xe=(function(et){const Qe=et.toLowerCase().replace(/_/g,"-");return Object.values(kt).indexOf(Qe)>=0?Qe:kt.UNKNOWN})(be.status);C(new gn(xe,be.message))}else C(new gn(kt.UNKNOWN,"Server responded with status "+k.getStatus()))}else C(new gn(kt.UNAVAILABLE,"Connection failed."));break;default:Qn(9055,{l_:e,streamId:g,h_:k.getLastErrorCode(),P_:k.getLastError()})}}finally{mn(vl,`RPC '${e}' ${g} completed.`)}}));const V=JSON.stringify(h);mn(vl,`RPC '${e}' ${g} sending request:`,h),k.send(t,"POST",V,a,15)}))}T_(e,t,a){const h=Fx(),m=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],g=jE(),c=UE(),C={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},k=this.longPollingOptions.timeoutSeconds;k!==void 0&&(C.longPollingTimeout=Math.round(1e3*k)),this.useFetchStreams&&(C.useFetchStreams=!0),this.jo(C.initMessageHeaders,t,a),C.encodeInitMessageHeaders=!0;const V=m.join("");mn(vl,`Creating RPC '${e}' stream ${h}: ${V}`,C);const Z=g.createWebChannel(V,C);this.I_(Z);let Y=!1,Q=!1;const be=new p5({Yo:ze=>{Q?mn(vl,`Not sending because RPC '${e}' stream ${h} is closed:`,ze):(Y||(mn(vl,`Opening RPC '${e}' stream ${h} transport.`),Z.open(),Y=!0),mn(vl,`RPC '${e}' stream ${h} sending:`,ze),Z.send(ze))},Zo:()=>Z.close()}),xe=(ze,et,Qe)=>{ze.listen(et,(Xe=>{try{Qe(Xe)}catch(Ke){setTimeout((()=>{throw Ke}),0)}}))};return xe(Z,w_.EventType.OPEN,(()=>{Q||(mn(vl,`RPC '${e}' stream ${h} transport opened.`),be.o_())})),xe(Z,w_.EventType.CLOSE,(()=>{Q||(Q=!0,mn(vl,`RPC '${e}' stream ${h} transport closed`),be.a_(),this.E_(Z))})),xe(Z,w_.EventType.ERROR,(ze=>{Q||(Q=!0,sg(vl,`RPC '${e}' stream ${h} transport errored. Name:`,ze.name,"Message:",ze.message),be.a_(new gn(kt.UNAVAILABLE,"The operation could not be completed")))})),xe(Z,w_.EventType.MESSAGE,(ze=>{var et;if(!Q){const Qe=ze.data[0];Sr(!!Qe,16349);const Xe=Qe,Ke=(Xe==null?void 0:Xe.error)||((et=Xe[0])==null?void 0:et.error);if(Ke){mn(vl,`RPC '${e}' stream ${h} received error:`,Ke);const Ve=Ke.status;let it=(function(me){const Ee=Ns[me];if(Ee!==void 0)return SA(Ee)})(Ve),de=Ke.message;it===void 0&&(it=kt.INTERNAL,de="Unknown error status: "+Ve+" with message "+Ke.message),Q=!0,be.a_(new gn(it,de)),Z.close()}else mn(vl,`RPC '${e}' stream ${h} received:`,Qe),be.u_(Qe)}})),xe(c,VE.STAT_EVENT,(ze=>{ze.stat===Ax.PROXY?mn(vl,`RPC '${e}' stream ${h} detected buffering proxy`):ze.stat===Ax.NOPROXY&&mn(vl,`RPC '${e}' stream ${h} detected no buffering proxy`)})),setTimeout((()=>{be.__()}),0),be}terminate(){this.c_.forEach((e=>e.close())),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter((t=>t===e))}}function Hb(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function H0(i){return new vD(i,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BA{constructor(e,t,a=1e3,h=1.5,m=6e4){this.Mi=e,this.timerId=t,this.d_=a,this.A_=h,this.R_=m,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),a=Math.max(0,Date.now()-this.f_),h=Math.max(0,t-a);h>0&&mn("ExponentialBackoff",`Backing off for ${h} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${a} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,h,(()=>(this.f_=Date.now(),e()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iT="PersistentStream";class FA{constructor(e,t,a,h,m,g,c,C){this.Mi=e,this.S_=a,this.b_=h,this.connection=m,this.authCredentialsProvider=g,this.appCheckCredentialsProvider=c,this.listener=C,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new BA(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===kt.RESOURCE_EXHAUSTED?(Fd(t.toString()),Fd("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===kt.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([a,h])=>{this.D_===t&&this.G_(a,h)}),(a=>{e((()=>{const h=new gn(kt.UNKNOWN,"Fetching auth token failed: "+a.message);return this.z_(h)}))}))}G_(e,t){const a=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo((()=>{a((()=>this.listener.Xo()))})),this.stream.t_((()=>{a((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((h=>{a((()=>this.z_(h)))})),this.stream.onMessage((h=>{a((()=>++this.F_==1?this.J_(h):this.onNext(h)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(e){return mn(iT,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget((()=>this.D_===e?t():(mn(iT,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class g5 extends FA{constructor(e,t,a,h,m,g){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,a,h,g),this.serializer=m}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=wD(this.serializer,e),a=(function(m){if(!("targetChange"in m))return ri.min();const g=m.targetChange;return g.targetIds&&g.targetIds.length?ri.min():g.readTime?qh(g.readTime):ri.min()})(e);return this.listener.H_(t,a)}Y_(e){const t={};t.database=Nx(this.serializer),t.addTarget=(function(m,g){let c;const C=g.target;if(c=Rx(C)?{documents:ED(m,C)}:{query:AD(m,C).ft},c.targetId=g.targetId,g.resumeToken.approximateByteSize()>0){c.resumeToken=IA(m,g.resumeToken);const k=Dx(m,g.expectedCount);k!==null&&(c.expectedCount=k)}else if(g.snapshotVersion.compareTo(ri.min())>0){c.readTime=d0(m,g.snapshotVersion.toTimestamp());const k=Dx(m,g.expectedCount);k!==null&&(c.expectedCount=k)}return c})(this.serializer,e);const a=CD(this.serializer,e);a&&(t.labels=a),this.q_(t)}Z_(e){const t={};t.database=Nx(this.serializer),t.removeTarget=e,this.q_(t)}}class _5 extends FA{constructor(e,t,a,h,m,g){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,a,h,g),this.serializer=m}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return Sr(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,Sr(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){Sr(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=SD(e.writeResults,e.commitTime),a=qh(e.commitTime);return this.listener.na(a,t)}ra(){const e={};e.database=Nx(this.serializer),this.q_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map((a=>TD(this.serializer,a)))};this.q_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class y5{}class v5 extends y5{constructor(e,t,a,h){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=a,this.serializer=h,this.ia=!1}sa(){if(this.ia)throw new gn(kt.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,a,h){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([m,g])=>this.connection.Go(e,zx(t,a),h,m,g))).catch((m=>{throw m.name==="FirebaseError"?(m.code===kt.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),m):new gn(kt.UNKNOWN,m.toString())}))}Ho(e,t,a,h,m){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([g,c])=>this.connection.Ho(e,zx(t,a),h,g,c,m))).catch((g=>{throw g.name==="FirebaseError"?(g.code===kt.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),g):new gn(kt.UNKNOWN,g.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}class b5{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(Fd(t),this.aa=!1):mn("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xp="RemoteStore";class x5{constructor(e,t,a,h,m){this.localStore=e,this.datastore=t,this.asyncQueue=a,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=m,this.Aa.Oo((g=>{a.enqueueAndForget((async()=>{om(this)&&(mn(Xp,"Restarting streams for network reachability change."),await(async function(C){const k=si(C);k.Ea.add(4),await yy(k),k.Ra.set("Unknown"),k.Ea.delete(4),await W0(k)})(this))}))})),this.Ra=new b5(a,h)}}async function W0(i){if(om(i))for(const e of i.da)await e(!0)}async function yy(i){for(const e of i.da)await e(!1)}function VA(i,e){const t=si(i);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),U1(t)?V1(t):wg(t).O_()&&F1(t,e))}function B1(i,e){const t=si(i),a=wg(t);t.Ia.delete(e),a.O_()&&UA(t,e),t.Ia.size===0&&(a.O_()?a.L_():om(t)&&t.Ra.set("Unknown"))}function F1(i,e){if(i.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(ri.min())>0){const t=i.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}wg(i).Y_(e)}function UA(i,e){i.Va.Ue(e),wg(i).Z_(e)}function V1(i){i.Va=new mD({getRemoteKeysForTarget:e=>i.remoteSyncer.getRemoteKeysForTarget(e),At:e=>i.Ia.get(e)||null,ht:()=>i.datastore.serializer.databaseId}),wg(i).start(),i.Ra.ua()}function U1(i){return om(i)&&!wg(i).x_()&&i.Ia.size>0}function om(i){return si(i).Ea.size===0}function jA(i){i.Va=void 0}async function w5(i){i.Ra.set("Online")}async function T5(i){i.Ia.forEach(((e,t)=>{F1(i,e)}))}async function S5(i,e){jA(i),U1(i)?(i.Ra.ha(e),V1(i)):i.Ra.set("Unknown")}async function E5(i,e,t){if(i.Ra.set("Online"),e instanceof AA&&e.state===2&&e.cause)try{await(async function(h,m){const g=m.cause;for(const c of m.targetIds)h.Ia.has(c)&&(await h.remoteSyncer.rejectListen(c,g),h.Ia.delete(c),h.Va.removeTarget(c))})(i,e)}catch(a){mn(Xp,"Failed to remove targets %s: %s ",e.targetIds.join(","),a),await p0(i,a)}else if(e instanceof jv?i.Va.Ze(e):e instanceof EA?i.Va.st(e):i.Va.tt(e),!t.isEqual(ri.min()))try{const a=await NA(i.localStore);t.compareTo(a)>=0&&await(function(m,g){const c=m.Va.Tt(g);return c.targetChanges.forEach(((C,k)=>{if(C.resumeToken.approximateByteSize()>0){const V=m.Ia.get(k);V&&m.Ia.set(k,V.withResumeToken(C.resumeToken,g))}})),c.targetMismatches.forEach(((C,k)=>{const V=m.Ia.get(C);if(!V)return;m.Ia.set(C,V.withResumeToken(qo.EMPTY_BYTE_STRING,V.snapshotVersion)),UA(m,C);const Z=new Pf(V.target,C,k,V.sequenceNumber);F1(m,Z)})),m.remoteSyncer.applyRemoteEvent(c)})(i,t)}catch(a){mn(Xp,"Failed to raise snapshot:",a),await p0(i,a)}}async function p0(i,e,t){if(!xg(e))throw e;i.Ea.add(1),await yy(i),i.Ra.set("Offline"),t||(t=()=>NA(i.localStore)),i.asyncQueue.enqueueRetryable((async()=>{mn(Xp,"Retrying IndexedDB access"),await t(),i.Ea.delete(1),await W0(i)}))}function qA(i,e){return e().catch((t=>p0(i,t,e)))}async function X0(i){const e=si(i),t=qf(e);let a=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:E1;for(;A5(e);)try{const h=await o5(e.localStore,a);if(h===null){e.Ta.length===0&&t.L_();break}a=h.batchId,I5(e,h)}catch(h){await p0(e,h)}$A(e)&&GA(e)}function A5(i){return om(i)&&i.Ta.length<10}function I5(i,e){i.Ta.push(e);const t=qf(i);t.O_()&&t.X_&&t.ea(e.mutations)}function $A(i){return om(i)&&!qf(i).x_()&&i.Ta.length>0}function GA(i){qf(i).start()}async function C5(i){qf(i).ra()}async function P5(i){const e=qf(i);for(const t of i.Ta)e.ea(t.mutations)}async function M5(i,e,t){const a=i.Ta.shift(),h=R1.from(a,e,t);await qA(i,(()=>i.remoteSyncer.applySuccessfulWrite(h))),await X0(i)}async function R5(i,e){e&&qf(i).X_&&await(async function(a,h){if((function(g){return dD(g)&&g!==kt.ABORTED})(h.code)){const m=a.Ta.shift();qf(a).B_(),await qA(a,(()=>a.remoteSyncer.rejectFailedWrite(m.batchId,h))),await X0(a)}})(i,e),$A(i)&&GA(i)}async function rT(i,e){const t=si(i);t.asyncQueue.verifyOperationInProgress(),mn(Xp,"RemoteStore received new credentials");const a=om(t);t.Ea.add(3),await yy(t),a&&t.Ra.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await W0(t)}async function k5(i,e){const t=si(i);e?(t.Ea.delete(2),await W0(t)):e||(t.Ea.add(2),await yy(t),t.Ra.set("Unknown"))}function wg(i){return i.ma||(i.ma=(function(t,a,h){const m=si(t);return m.sa(),new g5(a,m.connection,m.authCredentials,m.appCheckCredentials,m.serializer,h)})(i.datastore,i.asyncQueue,{Xo:w5.bind(null,i),t_:T5.bind(null,i),r_:S5.bind(null,i),H_:E5.bind(null,i)}),i.da.push((async e=>{e?(i.ma.B_(),U1(i)?V1(i):i.Ra.set("Unknown")):(await i.ma.stop(),jA(i))}))),i.ma}function qf(i){return i.fa||(i.fa=(function(t,a,h){const m=si(t);return m.sa(),new _5(a,m.connection,m.authCredentials,m.appCheckCredentials,m.serializer,h)})(i.datastore,i.asyncQueue,{Xo:()=>Promise.resolve(),t_:C5.bind(null,i),r_:R5.bind(null,i),ta:P5.bind(null,i),na:M5.bind(null,i)}),i.da.push((async e=>{e?(i.fa.B_(),await X0(i)):(await i.fa.stop(),i.Ta.length>0&&(mn(Xp,`Stopping write stream with ${i.Ta.length} pending writes`),i.Ta=[]))}))),i.fa}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class j1{constructor(e,t,a,h,m){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=a,this.op=h,this.removalCallback=m,this.deferred=new zf,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((g=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,a,h,m){const g=Date.now()+a,c=new j1(e,t,g,h,m);return c.start(a),c}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new gn(kt.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function q1(i,e){if(Fd("AsyncQueue",`${e}: ${i}`),xg(i))return new gn(kt.UNAVAILABLE,`${e}: ${i}`);throw i}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ym{static emptySet(e){return new Ym(e.comparator)}constructor(e){this.comparator=e?(t,a)=>e(t,a)||Nn.comparator(t.key,a.key):(t,a)=>Nn.comparator(t.key,a.key),this.keyedMap=T_(),this.sortedSet=new Na(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,a)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Ym)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),a=e.sortedSet.getIterator();for(;t.hasNext();){const h=t.getNext().key,m=a.getNext().key;if(!h.isEqual(m))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const a=new Ym;return a.comparator=this.comparator,a.keyedMap=e,a.sortedSet=t,a}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aT{constructor(){this.ga=new Na(Nn.comparator)}track(e){const t=e.doc.key,a=this.ga.get(t);a?e.type!==0&&a.type===3?this.ga=this.ga.insert(t,e):e.type===3&&a.type!==1?this.ga=this.ga.insert(t,{type:a.type,doc:e.doc}):e.type===2&&a.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&a.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&a.type===0?this.ga=this.ga.remove(t):e.type===1&&a.type===2?this.ga=this.ga.insert(t,{type:1,doc:a.doc}):e.type===0&&a.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):Qn(63341,{Rt:e,pa:a}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal(((t,a)=>{e.push(a)})),e}}class hg{constructor(e,t,a,h,m,g,c,C,k){this.query=e,this.docs=t,this.oldDocs=a,this.docChanges=h,this.mutatedKeys=m,this.fromCache=g,this.syncStateChanged=c,this.excludesMetadataChanges=C,this.hasCachedResults=k}static fromInitialDocuments(e,t,a,h,m){const g=[];return t.forEach((c=>{g.push({type:0,doc:c})})),new hg(e,t,Ym.emptySet(t),g,a,h,!0,!1,m)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&j0(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,a=e.docChanges;if(t.length!==a.length)return!1;for(let h=0;h<t.length;h++)if(t[h].type!==a[h].type||!t[h].doc.isEqual(a[h].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class L5{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((e=>e.Da()))}}class D5{constructor(){this.queries=sT(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,a){const h=si(t),m=h.queries;h.queries=sT(),m.forEach(((g,c)=>{for(const C of c.Sa)C.onError(a)}))})(this,new gn(kt.ABORTED,"Firestore shutting down"))}}function sT(){return new am((i=>hA(i)),j0)}async function z5(i,e){const t=si(i);let a=3;const h=e.query;let m=t.queries.get(h);m?!m.ba()&&e.Da()&&(a=2):(m=new L5,a=e.Da()?0:1);try{switch(a){case 0:m.wa=await t.onListen(h,!0);break;case 1:m.wa=await t.onListen(h,!1);break;case 2:await t.onFirstRemoteStoreListen(h)}}catch(g){const c=q1(g,`Initialization of query '${Gm(e.query)}' failed`);return void e.onError(c)}t.queries.set(h,m),m.Sa.push(e),e.va(t.onlineState),m.wa&&e.Fa(m.wa)&&$1(t)}async function O5(i,e){const t=si(i),a=e.query;let h=3;const m=t.queries.get(a);if(m){const g=m.Sa.indexOf(e);g>=0&&(m.Sa.splice(g,1),m.Sa.length===0?h=e.Da()?0:1:!m.ba()&&e.Da()&&(h=2))}switch(h){case 0:return t.queries.delete(a),t.onUnlisten(a,!0);case 1:return t.queries.delete(a),t.onUnlisten(a,!1);case 2:return t.onLastRemoteStoreUnlisten(a);default:return}}function N5(i,e){const t=si(i);let a=!1;for(const h of e){const m=h.query,g=t.queries.get(m);if(g){for(const c of g.Sa)c.Fa(h)&&(a=!0);g.wa=h}}a&&$1(t)}function B5(i,e,t){const a=si(i),h=a.queries.get(e);if(h)for(const m of h.Sa)m.onError(t);a.queries.delete(e)}function $1(i){i.Ca.forEach((e=>{e.next()}))}var Vx,oT;(oT=Vx||(Vx={})).Ma="default",oT.Cache="cache";class F5{constructor(e,t,a){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=a||{}}Fa(e){if(!this.options.includeMetadataChanges){const a=[];for(const h of e.docChanges)h.type!==3&&a.push(h);e=new hg(e.query,e.docs,e.oldDocs,a,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;const a=t!=="Offline";return(!this.options.qa||!a)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=hg.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==Vx.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZA{constructor(e){this.key=e}}class HA{constructor(e){this.key=e}}class V5{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=Di(),this.mutatedKeys=Di(),this.eu=dA(e),this.tu=new Ym(this.eu)}get nu(){return this.Ya}ru(e,t){const a=t?t.iu:new aT,h=t?t.tu:this.tu;let m=t?t.mutatedKeys:this.mutatedKeys,g=h,c=!1;const C=this.query.limitType==="F"&&h.size===this.query.limit?h.last():null,k=this.query.limitType==="L"&&h.size===this.query.limit?h.first():null;if(e.inorderTraversal(((V,Z)=>{const Y=h.get(V),Q=q0(this.query,Z)?Z:null,be=!!Y&&this.mutatedKeys.has(Y.key),xe=!!Q&&(Q.hasLocalMutations||this.mutatedKeys.has(Q.key)&&Q.hasCommittedMutations);let ze=!1;Y&&Q?Y.data.isEqual(Q.data)?be!==xe&&(a.track({type:3,doc:Q}),ze=!0):this.su(Y,Q)||(a.track({type:2,doc:Q}),ze=!0,(C&&this.eu(Q,C)>0||k&&this.eu(Q,k)<0)&&(c=!0)):!Y&&Q?(a.track({type:0,doc:Q}),ze=!0):Y&&!Q&&(a.track({type:1,doc:Y}),ze=!0,(C||k)&&(c=!0)),ze&&(Q?(g=g.add(Q),m=xe?m.add(V):m.delete(V)):(g=g.delete(V),m=m.delete(V)))})),this.query.limit!==null)for(;g.size>this.query.limit;){const V=this.query.limitType==="F"?g.last():g.first();g=g.delete(V.key),m=m.delete(V.key),a.track({type:1,doc:V})}return{tu:g,iu:a,Cs:c,mutatedKeys:m}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,a,h){const m=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const g=e.iu.ya();g.sort(((V,Z)=>(function(Q,be){const xe=ze=>{switch(ze){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Qn(20277,{Rt:ze})}};return xe(Q)-xe(be)})(V.type,Z.type)||this.eu(V.doc,Z.doc))),this.ou(a),h=h??!1;const c=t&&!h?this._u():[],C=this.Xa.size===0&&this.current&&!h?1:0,k=C!==this.Za;return this.Za=C,g.length!==0||k?{snapshot:new hg(this.query,e.tu,m,g,e.mutatedKeys,C===0,k,!1,!!a&&a.resumeToken.approximateByteSize()>0),au:c}:{au:c}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new aT,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach((t=>this.Ya=this.Ya.add(t))),e.modifiedDocuments.forEach((t=>{})),e.removedDocuments.forEach((t=>this.Ya=this.Ya.delete(t))),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=Di(),this.tu.forEach((a=>{this.uu(a.key)&&(this.Xa=this.Xa.add(a.key))}));const t=[];return e.forEach((a=>{this.Xa.has(a)||t.push(new HA(a))})),this.Xa.forEach((a=>{e.has(a)||t.push(new ZA(a))})),t}cu(e){this.Ya=e.Qs,this.Xa=Di();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return hg.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const G1="SyncEngine";class U5{constructor(e,t,a){this.query=e,this.targetId=t,this.view=a}}class j5{constructor(e){this.key=e,this.hu=!1}}class q5{constructor(e,t,a,h,m,g){this.localStore=e,this.remoteStore=t,this.eventManager=a,this.sharedClientState=h,this.currentUser=m,this.maxConcurrentLimboResolutions=g,this.Pu={},this.Tu=new am((c=>hA(c)),j0),this.Iu=new Map,this.Eu=new Set,this.du=new Na(Nn.comparator),this.Au=new Map,this.Ru=new D1,this.Vu={},this.mu=new Map,this.fu=cg.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function $5(i,e,t=!0){const a=JA(i);let h;const m=a.Tu.get(e);return m?(a.sharedClientState.addLocalQueryTarget(m.targetId),h=m.view.lu()):h=await WA(a,e,t,!0),h}async function G5(i,e){const t=JA(i);await WA(t,e,!0,!1)}async function WA(i,e,t,a){const h=await l5(i.localStore,jh(e)),m=h.targetId,g=i.sharedClientState.addLocalQueryTarget(m,t);let c;return a&&(c=await Z5(i,e,m,g==="current",h.resumeToken)),i.isPrimaryClient&&t&&VA(i.remoteStore,h),c}async function Z5(i,e,t,a,h){i.pu=(Z,Y,Q)=>(async function(xe,ze,et,Qe){let Xe=ze.view.ru(et);Xe.Cs&&(Xe=await J2(xe.localStore,ze.query,!1).then((({documents:de})=>ze.view.ru(de,Xe))));const Ke=Qe&&Qe.targetChanges.get(ze.targetId),Ve=Qe&&Qe.targetMismatches.get(ze.targetId)!=null,it=ze.view.applyChanges(Xe,xe.isPrimaryClient,Ke,Ve);return uT(xe,ze.targetId,it.au),it.snapshot})(i,Z,Y,Q);const m=await J2(i.localStore,e,!0),g=new V5(e,m.Qs),c=g.ru(m.documents),C=_y.createSynthesizedTargetChangeForCurrentChange(t,a&&i.onlineState!=="Offline",h),k=g.applyChanges(c,i.isPrimaryClient,C);uT(i,t,k.au);const V=new U5(e,t,g);return i.Tu.set(e,V),i.Iu.has(t)?i.Iu.get(t).push(e):i.Iu.set(t,[e]),k.snapshot}async function H5(i,e,t){const a=si(i),h=a.Tu.get(e),m=a.Iu.get(h.targetId);if(m.length>1)return a.Iu.set(h.targetId,m.filter((g=>!j0(g,e)))),void a.Tu.delete(e);a.isPrimaryClient?(a.sharedClientState.removeLocalQueryTarget(h.targetId),a.sharedClientState.isActiveQueryTarget(h.targetId)||await Bx(a.localStore,h.targetId,!1).then((()=>{a.sharedClientState.clearQueryState(h.targetId),t&&B1(a.remoteStore,h.targetId),Ux(a,h.targetId)})).catch(bg)):(Ux(a,h.targetId),await Bx(a.localStore,h.targetId,!0))}async function W5(i,e){const t=si(i),a=t.Tu.get(e),h=t.Iu.get(a.targetId);t.isPrimaryClient&&h.length===1&&(t.sharedClientState.removeLocalQueryTarget(a.targetId),B1(t.remoteStore,a.targetId))}async function X5(i,e,t){const a=nz(i);try{const h=await(function(g,c){const C=si(g),k=da.now(),V=c.reduce(((Q,be)=>Q.add(be.key)),Di());let Z,Y;return C.persistence.runTransaction("Locally write mutations","readwrite",(Q=>{let be=Vd(),xe=Di();return C.Ns.getEntries(Q,V).next((ze=>{be=ze,be.forEach(((et,Qe)=>{Qe.isValidDocument()||(xe=xe.add(et))}))})).next((()=>C.localDocuments.getOverlayedDocuments(Q,be))).next((ze=>{Z=ze;const et=[];for(const Qe of c){const Xe=oD(Qe,Z.get(Qe.key).overlayedDocument);Xe!=null&&et.push(new sm(Qe.key,Xe,nA(Xe.value.mapValue),Dd.exists(!0)))}return C.mutationQueue.addMutationBatch(Q,k,et,c)})).next((ze=>{Y=ze;const et=ze.applyToLocalDocumentSet(Z,xe);return C.documentOverlayCache.saveOverlays(Q,ze.batchId,et)}))})).then((()=>({batchId:Y.batchId,changes:pA(Z)})))})(a.localStore,e);a.sharedClientState.addPendingMutation(h.batchId),(function(g,c,C){let k=g.Vu[g.currentUser.toKey()];k||(k=new Na(Li)),k=k.insert(c,C),g.Vu[g.currentUser.toKey()]=k})(a,h.batchId,t),await vy(a,h.changes),await X0(a.remoteStore)}catch(h){const m=q1(h,"Failed to persist write");t.reject(m)}}async function XA(i,e){const t=si(i);try{const a=await a5(t.localStore,e);e.targetChanges.forEach(((h,m)=>{const g=t.Au.get(m);g&&(Sr(h.addedDocuments.size+h.modifiedDocuments.size+h.removedDocuments.size<=1,22616),h.addedDocuments.size>0?g.hu=!0:h.modifiedDocuments.size>0?Sr(g.hu,14607):h.removedDocuments.size>0&&(Sr(g.hu,42227),g.hu=!1))})),await vy(t,a,e)}catch(a){await bg(a)}}function lT(i,e,t){const a=si(i);if(a.isPrimaryClient&&t===0||!a.isPrimaryClient&&t===1){const h=[];a.Tu.forEach(((m,g)=>{const c=g.view.va(e);c.snapshot&&h.push(c.snapshot)})),(function(g,c){const C=si(g);C.onlineState=c;let k=!1;C.queries.forEach(((V,Z)=>{for(const Y of Z.Sa)Y.va(c)&&(k=!0)})),k&&$1(C)})(a.eventManager,e),h.length&&a.Pu.H_(h),a.onlineState=e,a.isPrimaryClient&&a.sharedClientState.setOnlineState(e)}}async function K5(i,e,t){const a=si(i);a.sharedClientState.updateQueryState(e,"rejected",t);const h=a.Au.get(e),m=h&&h.key;if(m){let g=new Na(Nn.comparator);g=g.insert(m,xl.newNoDocument(m,ri.min()));const c=Di().add(m),C=new Z0(ri.min(),new Map,new Na(Li),g,c);await XA(a,C),a.du=a.du.remove(m),a.Au.delete(e),Z1(a)}else await Bx(a.localStore,e,!1).then((()=>Ux(a,e,t))).catch(bg)}async function Y5(i,e){const t=si(i),a=e.batch.batchId;try{const h=await r5(t.localStore,e);YA(t,a,null),KA(t,a),t.sharedClientState.updateMutationState(a,"acknowledged"),await vy(t,h)}catch(h){await bg(h)}}async function Q5(i,e,t){const a=si(i);try{const h=await(function(g,c){const C=si(g);return C.persistence.runTransaction("Reject batch","readwrite-primary",(k=>{let V;return C.mutationQueue.lookupMutationBatch(k,c).next((Z=>(Sr(Z!==null,37113),V=Z.keys(),C.mutationQueue.removeMutationBatch(k,Z)))).next((()=>C.mutationQueue.performConsistencyCheck(k))).next((()=>C.documentOverlayCache.removeOverlaysForBatchId(k,V,c))).next((()=>C.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(k,V))).next((()=>C.localDocuments.getDocuments(k,V)))}))})(a.localStore,e);YA(a,e,t),KA(a,e),a.sharedClientState.updateMutationState(e,"rejected",t),await vy(a,h)}catch(h){await bg(h)}}function KA(i,e){(i.mu.get(e)||[]).forEach((t=>{t.resolve()})),i.mu.delete(e)}function YA(i,e,t){const a=si(i);let h=a.Vu[a.currentUser.toKey()];if(h){const m=h.get(e);m&&(t?m.reject(t):m.resolve(),h=h.remove(e)),a.Vu[a.currentUser.toKey()]=h}}function Ux(i,e,t=null){i.sharedClientState.removeLocalQueryTarget(e);for(const a of i.Iu.get(e))i.Tu.delete(a),t&&i.Pu.yu(a,t);i.Iu.delete(e),i.isPrimaryClient&&i.Ru.jr(e).forEach((a=>{i.Ru.containsKey(a)||QA(i,a)}))}function QA(i,e){i.Eu.delete(e.path.canonicalString());const t=i.du.get(e);t!==null&&(B1(i.remoteStore,t),i.du=i.du.remove(e),i.Au.delete(t),Z1(i))}function uT(i,e,t){for(const a of t)a instanceof ZA?(i.Ru.addReference(a.key,e),J5(i,a)):a instanceof HA?(mn(G1,"Document no longer in limbo: "+a.key),i.Ru.removeReference(a.key,e),i.Ru.containsKey(a.key)||QA(i,a.key)):Qn(19791,{wu:a})}function J5(i,e){const t=e.key,a=t.path.canonicalString();i.du.get(t)||i.Eu.has(a)||(mn(G1,"New document in limbo: "+t),i.Eu.add(a),Z1(i))}function Z1(i){for(;i.Eu.size>0&&i.du.size<i.maxConcurrentLimboResolutions;){const e=i.Eu.values().next().value;i.Eu.delete(e);const t=new Nn(oa.fromString(e)),a=i.fu.next();i.Au.set(a,new j5(t)),i.du=i.du.insert(t,a),VA(i.remoteStore,new Pf(jh(uA(t.path)),a,"TargetPurposeLimboResolution",F0.ce))}}async function vy(i,e,t){const a=si(i),h=[],m=[],g=[];a.Tu.isEmpty()||(a.Tu.forEach(((c,C)=>{g.push(a.pu(C,e,t).then((k=>{var V;if((k||t)&&a.isPrimaryClient){const Z=k?!k.fromCache:(V=t==null?void 0:t.targetChanges.get(C.targetId))==null?void 0:V.current;a.sharedClientState.updateQueryState(C.targetId,Z?"current":"not-current")}if(k){h.push(k);const Z=O1.As(C.targetId,k);m.push(Z)}})))})),await Promise.all(g),a.Pu.H_(h),await(async function(C,k){const V=si(C);try{await V.persistence.runTransaction("notifyLocalViewChanges","readwrite",(Z=>Lt.forEach(k,(Y=>Lt.forEach(Y.Es,(Q=>V.persistence.referenceDelegate.addReference(Z,Y.targetId,Q))).next((()=>Lt.forEach(Y.ds,(Q=>V.persistence.referenceDelegate.removeReference(Z,Y.targetId,Q)))))))))}catch(Z){if(!xg(Z))throw Z;mn(N1,"Failed to update sequence numbers: "+Z)}for(const Z of k){const Y=Z.targetId;if(!Z.fromCache){const Q=V.Ms.get(Y),be=Q.snapshotVersion,xe=Q.withLastLimboFreeSnapshotVersion(be);V.Ms=V.Ms.insert(Y,xe)}}})(a.localStore,m))}async function ez(i,e){const t=si(i);if(!t.currentUser.isEqual(e)){mn(G1,"User change. New user:",e.toKey());const a=await OA(t.localStore,e);t.currentUser=e,(function(m,g){m.mu.forEach((c=>{c.forEach((C=>{C.reject(new gn(kt.CANCELLED,g))}))})),m.mu.clear()})(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,a.removedBatchIds,a.addedBatchIds),await vy(t,a.Ls)}}function tz(i,e){const t=si(i),a=t.Au.get(e);if(a&&a.hu)return Di().add(a.key);{let h=Di();const m=t.Iu.get(e);if(!m)return h;for(const g of m){const c=t.Tu.get(g);h=h.unionWith(c.view.nu)}return h}}function JA(i){const e=si(i);return e.remoteStore.remoteSyncer.applyRemoteEvent=XA.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=tz.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=K5.bind(null,e),e.Pu.H_=N5.bind(null,e.eventManager),e.Pu.yu=B5.bind(null,e.eventManager),e}function nz(i){const e=si(i);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Y5.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Q5.bind(null,e),e}class m0{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=H0(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return i5(this.persistence,new e5,e.initialUser,this.serializer)}Cu(e){return new zA(z1.mi,this.serializer)}Du(e){return new c5}async terminate(){var e,t;(e=this.gcScheduler)==null||e.stop(),(t=this.indexBackfillerScheduler)==null||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}m0.provider={build:()=>new m0};class iz extends m0{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){Sr(this.persistence.referenceDelegate instanceof f0,46915);const a=this.persistence.referenceDelegate.garbageCollector;return new FD(a,e.asyncQueue,t)}Cu(e){const t=this.cacheSizeBytes!==void 0?ou.withCacheSize(this.cacheSizeBytes):ou.DEFAULT;return new zA((a=>f0.mi(a,t)),this.serializer)}}class jx{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=a=>lT(this.syncEngine,a,1),this.remoteStore.remoteSyncer.handleCredentialChange=ez.bind(null,this.syncEngine),await k5(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new D5})()}createDatastore(e){const t=H0(e.databaseInfo.databaseId),a=(function(m){return new m5(m)})(e.databaseInfo);return(function(m,g,c,C){return new v5(m,g,c,C)})(e.authCredentials,e.appCheckCredentials,a,t)}createRemoteStore(e){return(function(a,h,m,g,c){return new x5(a,h,m,g,c)})(this.localStore,this.datastore,e.asyncQueue,(t=>lT(this.syncEngine,t,0)),(function(){return nT.v()?new nT:new h5})())}createSyncEngine(e,t){return(function(h,m,g,c,C,k,V){const Z=new q5(h,m,g,c,C,k);return V&&(Z.gu=!0),Z})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await(async function(h){const m=si(h);mn(Xp,"RemoteStore shutting down."),m.Ea.add(5),await yy(m),m.Aa.shutdown(),m.Ra.set("Unknown")})(this.remoteStore),(e=this.datastore)==null||e.terminate(),(t=this.eventManager)==null||t.terminate()}}jx.provider={build:()=>new jx};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rz{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):Fd("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout((()=>{this.muted||e(t)}),0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $f="FirestoreClient";class az{constructor(e,t,a,h,m){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=a,this.databaseInfo=h,this.user=bl.UNAUTHENTICATED,this.clientId=S1.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=m,this.authCredentials.start(a,(async g=>{mn($f,"Received user=",g.uid),await this.authCredentialListener(g),this.user=g})),this.appCheckCredentials.start(a,(g=>(mn($f,"Received new app check token=",g),this.appCheckCredentialListener(g,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new zf;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const a=q1(t,"Failed to shutdown persistence");e.reject(a)}})),e.promise}}async function Wb(i,e){i.asyncQueue.verifyOperationInProgress(),mn($f,"Initializing OfflineComponentProvider");const t=i.configuration;await e.initialize(t);let a=t.initialUser;i.setCredentialChangeListener((async h=>{a.isEqual(h)||(await OA(e.localStore,h),a=h)})),e.persistence.setDatabaseDeletedListener((()=>i.terminate())),i._offlineComponents=e}async function cT(i,e){i.asyncQueue.verifyOperationInProgress();const t=await sz(i);mn($f,"Initializing OnlineComponentProvider"),await e.initialize(t,i.configuration),i.setCredentialChangeListener((a=>rT(e.remoteStore,a))),i.setAppCheckTokenChangeListener(((a,h)=>rT(e.remoteStore,h))),i._onlineComponents=e}async function sz(i){if(!i._offlineComponents)if(i._uninitializedComponentsProvider){mn($f,"Using user provided OfflineComponentProvider");try{await Wb(i,i._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!(function(h){return h.name==="FirebaseError"?h.code===kt.FAILED_PRECONDITION||h.code===kt.UNIMPLEMENTED:!(typeof DOMException<"u"&&h instanceof DOMException)||h.code===22||h.code===20||h.code===11})(t))throw t;sg("Error using user provided cache. Falling back to memory cache: "+t),await Wb(i,new m0)}}else mn($f,"Using default OfflineComponentProvider"),await Wb(i,new iz(void 0));return i._offlineComponents}async function eI(i){return i._onlineComponents||(i._uninitializedComponentsProvider?(mn($f,"Using user provided OnlineComponentProvider"),await cT(i,i._uninitializedComponentsProvider._online)):(mn($f,"Using default OnlineComponentProvider"),await cT(i,new jx))),i._onlineComponents}function oz(i){return eI(i).then((e=>e.syncEngine))}async function lz(i){const e=await eI(i),t=e.eventManager;return t.onListen=$5.bind(null,e.syncEngine),t.onUnlisten=H5.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=G5.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=W5.bind(null,e.syncEngine),t}function uz(i,e,t={}){const a=new zf;return i.asyncQueue.enqueueAndForget((async()=>(function(m,g,c,C,k){const V=new rz({next:Y=>{V.Nu(),g.enqueueAndForget((()=>O5(m,Z))),Y.fromCache&&C.source==="server"?k.reject(new gn(kt.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):k.resolve(Y)},error:Y=>k.reject(Y)}),Z=new F5(c,V,{includeMetadataChanges:!0,qa:!0});return z5(m,Z)})(await lz(i),i.asyncQueue,e,t,a))),a.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tI(i){const e={};return i.timeoutSeconds!==void 0&&(e.timeoutSeconds=i.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hT=new Map;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nI="firestore.googleapis.com",dT=!0;class fT{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new gn(kt.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=nI,this.ssl=dT}else this.host=e.host,this.ssl=e.ssl??dT;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=DA;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<ND)throw new gn(kt.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}bL("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=tI(e.experimentalLongPollingOptions??{}),(function(a){if(a.timeoutSeconds!==void 0){if(isNaN(a.timeoutSeconds))throw new gn(kt.INVALID_ARGUMENT,`invalid long polling timeout: ${a.timeoutSeconds} (must not be NaN)`);if(a.timeoutSeconds<5)throw new gn(kt.INVALID_ARGUMENT,`invalid long polling timeout: ${a.timeoutSeconds} (minimum allowed value is 5)`);if(a.timeoutSeconds>30)throw new gn(kt.INVALID_ARGUMENT,`invalid long polling timeout: ${a.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(a,h){return a.timeoutSeconds===h.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class K0{constructor(e,t,a,h){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=a,this._app=h,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new fT({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new gn(kt.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new gn(kt.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new fT(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(a){if(!a)return new cL;switch(a.type){case"firstParty":return new pL(a.sessionIndex||"0",a.iamToken||null,a.authTokenFactory||null);case"provider":return a.client;default:throw new gn(kt.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(t){const a=hT.get(t);a&&(mn("ComponentProvider","Removing Datastore"),hT.delete(t),a.terminate())})(this),Promise.resolve()}}function cz(i,e,t,a={}){var k;i=a0(i,K0);const h=_g(e),m=i._getSettings(),g={...m,emulatorOptions:i._getEmulatorOptions()},c=`${e}:${t}`;h&&(AE(`https://${c}`),IE("Firestore",!0)),m.host!==nI&&m.host!==c&&sg("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const C={...m,host:c,ssl:h,emulatorOptions:a};if(!Bf(C,g)&&(i._setSettings(C),a.mockUserToken)){let V,Z;if(typeof a.mockUserToken=="string")V=a.mockUserToken,Z=bl.MOCK_USER;else{V=OR(a.mockUserToken,(k=i._app)==null?void 0:k.options.projectId);const Y=a.mockUserToken.sub||a.mockUserToken.user_id;if(!Y)throw new gn(kt.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");Z=new bl(Y)}i._authCredentials=new hL(new $E(V,Z))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tg{constructor(e,t,a){this.converter=t,this._query=a,this.type="query",this.firestore=e}withConverter(e){return new Tg(this.firestore,e,this._query)}}class Io{constructor(e,t,a){this.converter=t,this._key=a,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Of(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Io(this.firestore,e,this._key)}toJSON(){return{type:Io._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,a){if(py(t,Io._jsonSchema))return new Io(e,a||null,new Nn(oa.fromString(t.referencePath)))}}Io._jsonSchemaVersion="firestore/documentReference/1.0",Io._jsonSchema={type:Fs("string",Io._jsonSchemaVersion),referencePath:Fs("string")};class Of extends Tg{constructor(e,t,a){super(e,t,uA(a)),this._path=a,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Io(this.firestore,null,new Nn(e))}withConverter(e){return new Of(this.firestore,e,this._path)}}function iI(i,e,...t){if(i=cu(i),GE("collection","path",e),i instanceof K0){const a=oa.fromString(e,...t);return A2(a),new Of(i,null,a)}{if(!(i instanceof Io||i instanceof Of))throw new gn(kt.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const a=i._path.child(oa.fromString(e,...t));return A2(a),new Of(i.firestore,null,a)}}function hz(i,e,...t){if(i=cu(i),arguments.length===1&&(e=S1.newId()),GE("doc","path",e),i instanceof K0){const a=oa.fromString(e,...t);return E2(a),new Io(i,null,new Nn(a))}{if(!(i instanceof Io||i instanceof Of))throw new gn(kt.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const a=i._path.child(oa.fromString(e,...t));return E2(a),new Io(i.firestore,i instanceof Of?i.converter:null,new Nn(a))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pT="AsyncQueue";class mT{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new BA(this,"async_queue_retry"),this._c=()=>{const a=Hb();a&&mn(pT,"Visibility state changed to "+a.visibilityState),this.M_.w_()},this.ac=e;const t=Hb();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=Hb();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise((()=>{}));const t=new zf;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Xu.push(e),this.lc())))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!xg(e))throw e;mn(pT,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(e){const t=this.ac.then((()=>(this.rc=!0,e().catch((a=>{throw this.nc=a,this.rc=!1,Fd("INTERNAL UNHANDLED ERROR: ",gT(a)),a})).then((a=>(this.rc=!1,a))))));return this.ac=t,t}enqueueAfterDelay(e,t,a){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const h=j1.createAndSchedule(this,e,t,a,(m=>this.hc(m)));return this.tc.push(h),h}uc(){this.nc&&Qn(47125,{Pc:gT(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then((()=>{this.tc.sort(((t,a)=>t.targetTimeMs-a.targetTimeMs));for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()}))}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function gT(i){let e=i.message||"";return i.stack&&(e=i.stack.includes(i.message)?i.stack:i.message+`
`+i.stack),e}class H1 extends K0{constructor(e,t,a,h){super(e,t,a,h),this.type="firestore",this._queue=new mT,this._persistenceKey=(h==null?void 0:h.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new mT(e),this._firestoreClient=void 0,await e}}}function dz(i,e){const t=typeof i=="object"?i:w1(),a=typeof i=="string"?i:o0,h=im(t,"firestore").getImmediate({identifier:a});if(!h._initialized){const m=DR("firestore");m&&cz(h,...m)}return h}function rI(i){if(i._terminated)throw new gn(kt.FAILED_PRECONDITION,"The client has already been terminated.");return i._firestoreClient||fz(i),i._firestoreClient}function fz(i){var a,h,m;const e=i._freezeSettings(),t=(function(c,C,k,V){return new RL(c,C,k,V.host,V.ssl,V.experimentalForceLongPolling,V.experimentalAutoDetectLongPolling,tI(V.experimentalLongPollingOptions),V.useFetchStreams,V.isUsingEmulator)})(i._databaseId,((a=i._app)==null?void 0:a.options.appId)||"",i._persistenceKey,e);i._componentsProvider||(h=e.localCache)!=null&&h._offlineComponentProvider&&((m=e.localCache)!=null&&m._onlineComponentProvider)&&(i._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),i._firestoreClient=new az(i._authCredentials,i._appCheckCredentials,i._queue,t,i._componentsProvider&&(function(c){const C=c==null?void 0:c._online.build();return{_offline:c==null?void 0:c._offline.build(C),_online:C}})(i._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yc{constructor(e){this._byteString=e}static fromBase64String(e){try{return new yc(qo.fromBase64String(e))}catch(t){throw new gn(kt.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new yc(qo.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:yc._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(py(e,yc._jsonSchema))return yc.fromBase64String(e.bytes)}}yc._jsonSchemaVersion="firestore/bytes/1.0",yc._jsonSchema={type:Fs("string",yc._jsonSchemaVersion),bytes:Fs("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class W1{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new gn(kt.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new jo(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class X1{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $h{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new gn(kt.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new gn(kt.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return Li(this._lat,e._lat)||Li(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:$h._jsonSchemaVersion}}static fromJSON(e){if(py(e,$h._jsonSchema))return new $h(e.latitude,e.longitude)}}$h._jsonSchemaVersion="firestore/geoPoint/1.0",$h._jsonSchema={type:Fs("string",$h._jsonSchemaVersion),latitude:Fs("number"),longitude:Fs("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gh{constructor(e){this._values=(e||[]).map((t=>t))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(a,h){if(a.length!==h.length)return!1;for(let m=0;m<a.length;++m)if(a[m]!==h[m])return!1;return!0})(this._values,e._values)}toJSON(){return{type:Gh._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(py(e,Gh._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((t=>typeof t=="number")))return new Gh(e.vectorValues);throw new gn(kt.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Gh._jsonSchemaVersion="firestore/vectorValue/1.0",Gh._jsonSchema={type:Fs("string",Gh._jsonSchemaVersion),vectorValues:Fs("object")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pz=/^__.*__$/;class mz{constructor(e,t,a){this.data=e,this.fieldMask=t,this.fieldTransforms=a}toMutation(e,t){return this.fieldMask!==null?new sm(e,this.data,this.fieldMask,t,this.fieldTransforms):new gy(e,this.data,t,this.fieldTransforms)}}function aI(i){switch(i){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Qn(40011,{Ac:i})}}class K1{constructor(e,t,a,h,m,g){this.settings=e,this.databaseId=t,this.serializer=a,this.ignoreUndefinedProperties=h,m===void 0&&this.Rc(),this.fieldTransforms=m||[],this.fieldMask=g||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new K1({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){var h;const t=(h=this.path)==null?void 0:h.child(e),a=this.Vc({path:t,fc:!1});return a.gc(e),a}yc(e){var h;const t=(h=this.path)==null?void 0:h.child(e),a=this.Vc({path:t,fc:!1});return a.Rc(),a}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return g0(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find((t=>e.isPrefixOf(t)))!==void 0||this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(aI(this.Ac)&&pz.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class gz{constructor(e,t,a){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=a||H0(e)}Cc(e,t,a,h=!1){return new K1({Ac:e,methodName:t,Dc:a,path:jo.emptyPath(),fc:!1,bc:h},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function sI(i){const e=i._freezeSettings(),t=H0(i._databaseId);return new gz(i._databaseId,!!e.ignoreUndefinedProperties,t)}function _z(i,e,t,a,h,m={}){const g=i.Cc(m.merge||m.mergeFields?2:0,e,t,h);uI("Data must be an object, but it was:",g,a);const c=oI(a,g);let C,k;if(m.merge)C=new th(g.fieldMask),k=g.fieldTransforms;else if(m.mergeFields){const V=[];for(const Z of m.mergeFields){const Y=vz(e,Z,t);if(!g.contains(Y))throw new gn(kt.INVALID_ARGUMENT,`Field '${Y}' is specified in your field mask but missing from your input data.`);xz(V,Y)||V.push(Y)}C=new th(V),k=g.fieldTransforms.filter((Z=>C.covers(Z.field)))}else C=null,k=g.fieldTransforms;return new mz(new _c(c),C,k)}class Y1 extends X1{_toFieldTransform(e){return new iD(e.path,new X_)}isEqual(e){return e instanceof Y1}}function yz(i,e,t,a=!1){return Q1(t,i.Cc(a?4:3,e))}function Q1(i,e){if(lI(i=cu(i)))return uI("Unsupported field value:",e,i),oI(i,e);if(i instanceof X1)return(function(a,h){if(!aI(h.Ac))throw h.Sc(`${a._methodName}() can only be used with update() and set()`);if(!h.path)throw h.Sc(`${a._methodName}() is not currently supported inside arrays`);const m=a._toFieldTransform(h);m&&h.fieldTransforms.push(m)})(i,e),null;if(i===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),i instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return(function(a,h){const m=[];let g=0;for(const c of a){let C=Q1(c,h.wc(g));C==null&&(C={nullValue:"NULL_VALUE"}),m.push(C),g++}return{arrayValue:{values:m}}})(i,e)}return(function(a,h){if((a=cu(a))===null)return{nullValue:"NULL_VALUE"};if(typeof a=="number")return eD(h.serializer,a);if(typeof a=="boolean")return{booleanValue:a};if(typeof a=="string")return{stringValue:a};if(a instanceof Date){const m=da.fromDate(a);return{timestampValue:d0(h.serializer,m)}}if(a instanceof da){const m=new da(a.seconds,1e3*Math.floor(a.nanoseconds/1e3));return{timestampValue:d0(h.serializer,m)}}if(a instanceof $h)return{geoPointValue:{latitude:a.latitude,longitude:a.longitude}};if(a instanceof yc)return{bytesValue:IA(h.serializer,a._byteString)};if(a instanceof Io){const m=h.databaseId,g=a.firestore._databaseId;if(!g.isEqual(m))throw h.Sc(`Document reference is for database ${g.projectId}/${g.database} but should be for database ${m.projectId}/${m.database}`);return{referenceValue:L1(a.firestore._databaseId||h.databaseId,a._key.path)}}if(a instanceof Gh)return(function(g,c){return{mapValue:{fields:{[eA]:{stringValue:tA},[l0]:{arrayValue:{values:g.toArray().map((k=>{if(typeof k!="number")throw c.Sc("VectorValues must only contain numeric values.");return M1(c.serializer,k)}))}}}}}})(a,h);throw h.Sc(`Unsupported field value: ${B0(a)}`)})(i,e)}function oI(i,e){const t={};return WE(i)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):rm(i,((a,h)=>{const m=Q1(h,e.mc(a));m!=null&&(t[a]=m)})),{mapValue:{fields:t}}}function lI(i){return!(typeof i!="object"||i===null||i instanceof Array||i instanceof Date||i instanceof da||i instanceof $h||i instanceof yc||i instanceof Io||i instanceof X1||i instanceof Gh)}function uI(i,e,t){if(!lI(t)||!ZE(t)){const a=B0(t);throw a==="an object"?e.Sc(i+" a custom object"):e.Sc(i+" "+a)}}function vz(i,e,t){if((e=cu(e))instanceof W1)return e._internalPath;if(typeof e=="string")return cI(i,e);throw g0("Field path arguments must be of type string or ",i,!1,void 0,t)}const bz=new RegExp("[~\\*/\\[\\]]");function cI(i,e,t){if(e.search(bz)>=0)throw g0(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,i,!1,void 0,t);try{return new W1(...e.split("."))._internalPath}catch{throw g0(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,i,!1,void 0,t)}}function g0(i,e,t,a,h){const m=a&&!a.isEmpty(),g=h!==void 0;let c=`Function ${e}() called with invalid data`;t&&(c+=" (via `toFirestore()`)"),c+=". ";let C="";return(m||g)&&(C+=" (found",m&&(C+=` in field ${a}`),g&&(C+=` in document ${h}`),C+=")"),new gn(kt.INVALID_ARGUMENT,c+i+C)}function xz(i,e){return i.some((t=>t.isEqual(e)))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hI{constructor(e,t,a,h,m){this._firestore=e,this._userDataWriter=t,this._key=a,this._document=h,this._converter=m}get id(){return this._key.path.lastSegment()}get ref(){return new Io(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new wz(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(J1("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class wz extends hI{data(){return super.data()}}function J1(i,e){return typeof e=="string"?cI(i,e):e instanceof W1?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tz(i){if(i.limitType==="L"&&i.explicitOrderBy.length===0)throw new gn(kt.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class ew{}class Sz extends ew{}function Ez(i,e,...t){let a=[];e instanceof ew&&a.push(e),a=a.concat(t),(function(m){const g=m.filter((C=>C instanceof tw)).length,c=m.filter((C=>C instanceof Y0)).length;if(g>1||g>0&&c>0)throw new gn(kt.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(a);for(const h of a)i=h._apply(i);return i}class Y0 extends Sz{constructor(e,t,a){super(),this._field=e,this._op=t,this._value=a,this.type="where"}static _create(e,t,a){return new Y0(e,t,a)}_apply(e){const t=this._parse(e);return dI(e._query,t),new Tg(e.firestore,e.converter,kx(e._query,t))}_parse(e){const t=sI(e.firestore);return(function(m,g,c,C,k,V,Z){let Y;if(k.isKeyField()){if(V==="array-contains"||V==="array-contains-any")throw new gn(kt.INVALID_ARGUMENT,`Invalid Query. You can't perform '${V}' queries on documentId().`);if(V==="in"||V==="not-in"){yT(Z,V);const be=[];for(const xe of Z)be.push(_T(C,m,xe));Y={arrayValue:{values:be}}}else Y=_T(C,m,Z)}else V!=="in"&&V!=="not-in"&&V!=="array-contains-any"||yT(Z,V),Y=yz(c,g,Z,V==="in"||V==="not-in");return Bs.create(k,V,Y)})(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function Xb(i,e,t){const a=e,h=J1("where",i);return Y0._create(h,a,t)}class tw extends ew{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new tw(e,t)}_parse(e){const t=this._queryConstraints.map((a=>a._parse(e))).filter((a=>a.getFilters().length>0));return t.length===1?t[0]:oh.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:((function(h,m){let g=h;const c=m.getFlattenedFilters();for(const C of c)dI(g,C),g=kx(g,C)})(e._query,t),new Tg(e.firestore,e.converter,kx(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function _T(i,e,t){if(typeof(t=cu(t))=="string"){if(t==="")throw new gn(kt.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!cA(e)&&t.indexOf("/")!==-1)throw new gn(kt.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const a=e.path.child(oa.fromString(t));if(!Nn.isDocumentKey(a))throw new gn(kt.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${a}' is not because it has an odd number of segments (${a.length}).`);return D2(i,new Nn(a))}if(t instanceof Io)return D2(i,t._key);throw new gn(kt.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${B0(t)}.`)}function yT(i,e){if(!Array.isArray(i)||i.length===0)throw new gn(kt.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function dI(i,e){const t=(function(h,m){for(const g of h)for(const c of g.getFlattenedFilters())if(m.indexOf(c.op)>=0)return c.op;return null})(i.filters,(function(h){switch(h){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(e.op));if(t!==null)throw t===e.op?new gn(kt.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new gn(kt.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class Az{convertValue(e,t="none"){switch(jf(e)){case 0:return null;case 1:return e.booleanValue;case 2:return hs(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Uf(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw Qn(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const a={};return rm(e,((h,m)=>{a[h]=this.convertValue(m,t)})),a}convertVectorValue(e){var a,h,m;const t=(m=(h=(a=e.fields)==null?void 0:a[l0].arrayValue)==null?void 0:h.values)==null?void 0:m.map((g=>hs(g.doubleValue)));return new Gh(t)}convertGeoPoint(e){return new $h(hs(e.latitude),hs(e.longitude))}convertArray(e,t){return(e.values||[]).map((a=>this.convertValue(a,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const a=U0(e);return a==null?null:this.convertValue(a,t);case"estimate":return this.convertTimestamp(Z_(e));default:return null}}convertTimestamp(e){const t=Vf(e);return new da(t.seconds,t.nanos)}convertDocumentKey(e,t){const a=oa.fromString(e);Sr(LA(a),9688,{name:e});const h=new H_(a.get(1),a.get(3)),m=new Nn(a.popFirst(5));return h.isEqual(t)||Fd(`Document ${m} contains a document reference within a different database (${h.projectId}/${h.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),m}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Iz(i,e,t){let a;return a=i?i.toFirestore(e):e,a}class Iv{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Qm extends hI{constructor(e,t,a,h,m,g){super(e,t,a,h,g),this._firestore=e,this._firestoreImpl=e,this.metadata=m}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new qv(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const a=this._document.data.field(J1("DocumentSnapshot.get",e));if(a!==null)return this._userDataWriter.convertValue(a,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new gn(kt.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=Qm._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}Qm._jsonSchemaVersion="firestore/documentSnapshot/1.0",Qm._jsonSchema={type:Fs("string",Qm._jsonSchemaVersion),bundleSource:Fs("string","DocumentSnapshot"),bundleName:Fs("string"),bundle:Fs("string")};class qv extends Qm{data(e={}){return super.data(e)}}class Jm{constructor(e,t,a,h){this._firestore=e,this._userDataWriter=t,this._snapshot=h,this.metadata=new Iv(h.hasPendingWrites,h.fromCache),this.query=a}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach((a=>{e.call(t,new qv(this._firestore,this._userDataWriter,a.key,a,new Iv(this._snapshot.mutatedKeys.has(a.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new gn(kt.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=(function(h,m){if(h._snapshot.oldDocs.isEmpty()){let g=0;return h._snapshot.docChanges.map((c=>{const C=new qv(h._firestore,h._userDataWriter,c.doc.key,c.doc,new Iv(h._snapshot.mutatedKeys.has(c.doc.key),h._snapshot.fromCache),h.query.converter);return c.doc,{type:"added",doc:C,oldIndex:-1,newIndex:g++}}))}{let g=h._snapshot.oldDocs;return h._snapshot.docChanges.filter((c=>m||c.type!==3)).map((c=>{const C=new qv(h._firestore,h._userDataWriter,c.doc.key,c.doc,new Iv(h._snapshot.mutatedKeys.has(c.doc.key),h._snapshot.fromCache),h.query.converter);let k=-1,V=-1;return c.type!==0&&(k=g.indexOf(c.doc.key),g=g.delete(c.doc.key)),c.type!==1&&(g=g.add(c.doc),V=g.indexOf(c.doc.key)),{type:Cz(c.type),doc:C,oldIndex:k,newIndex:V}}))}})(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new gn(kt.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=Jm._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=S1.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],a=[],h=[];return this.docs.forEach((m=>{m._document!==null&&(t.push(m._document),a.push(this._userDataWriter.convertObjectMap(m._document.data.value.mapValue.fields,"previous")),h.push(m.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function Cz(i){switch(i){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Qn(61501,{type:i})}}Jm._jsonSchemaVersion="firestore/querySnapshot/1.0",Jm._jsonSchema={type:Fs("string",Jm._jsonSchemaVersion),bundleSource:Fs("string","QuerySnapshot"),bundleName:Fs("string"),bundle:Fs("string")};class Pz extends Az{constructor(e){super(),this.firestore=e}convertBytes(e){return new yc(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Io(this.firestore,null,t)}}function Mz(i){i=a0(i,Tg);const e=a0(i.firestore,H1),t=rI(e),a=new Pz(e);return Tz(i._query),uz(t,i._query).then((h=>new Jm(e,a,i,h)))}function Rz(i,e){const t=a0(i.firestore,H1),a=hz(i),h=Iz(i.converter,e);return kz(t,[_z(sI(i.firestore),"addDoc",a._key,h,i.converter!==null,{}).toMutation(a._key,Dd.exists(!1))]).then((()=>a))}function kz(i,e){return(function(a,h){const m=new zf;return a.asyncQueue.enqueueAndForget((async()=>X5(await oz(a),h,m))),m.promise})(rI(i),e)}function vT(){return new Y1("serverTimestamp")}(function(e,t=!0){(function(h){vg=h})(yg),Jh(new sh("firestore",((a,{instanceIdentifier:h,options:m})=>{const g=a.getProvider("app").getImmediate(),c=new H1(new dL(a.getProvider("auth-internal")),new mL(g,a.getProvider("app-check-internal")),(function(k,V){if(!Object.prototype.hasOwnProperty.apply(k.options,["projectId"]))throw new gn(kt.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new H_(k.options.projectId,V)})(g,h),g);return m={useFetchStreams:t,...m},c._setSettings(m),c}),"PUBLIC").setMultipleInstances(!0)),Tc(x2,w2,e),Tc(x2,w2,"esm2020")})();var Lz="firebase",Dz="12.3.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Tc(Lz,Dz,"app");function fI(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const zz=fI,pI=new nm("auth","Firebase",fI());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _0=new N0("@firebase/auth");function Oz(i,...e){_0.logLevel<=ki.WARN&&_0.warn(`Auth (${yg}): ${i}`,...e)}function $v(i,...e){_0.logLevel<=ki.ERROR&&_0.error(`Auth (${yg}): ${i}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ud(i,...e){throw nw(i,...e)}function Zh(i,...e){return nw(i,...e)}function mI(i,e,t){const a={...zz(),[e]:t};return new nm("auth","Firebase",a).create(e,{appName:i.name})}function Vp(i){return mI(i,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function nw(i,...e){if(typeof i!="string"){const t=e[0],a=[...e.slice(1)];return a[0]&&(a[0].appName=i.name),i._errorFactory.create(t,...a)}return pI.create(i,...e)}function ei(i,e,...t){if(!i)throw nw(e,...t)}function Rd(i){const e="INTERNAL ASSERTION FAILED: "+i;throw $v(e),new Error(e)}function jd(i,e){i||Rd(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qx(){var i;return typeof self<"u"&&((i=self.location)==null?void 0:i.href)||""}function Nz(){return bT()==="http:"||bT()==="https:"}function bT(){var i;return typeof self<"u"&&((i=self.location)==null?void 0:i.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bz(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Nz()||CE()||"connection"in navigator)?navigator.onLine:!0}function Fz(){if(typeof navigator>"u")return null;const i=navigator;return i.languages&&i.languages[0]||i.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class by{constructor(e,t){this.shortDelay=e,this.longDelay=t,jd(t>e,"Short delay should be less than long delay!"),this.isMobile=FR()||jR()}get(){return Bz()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iw(i,e){jd(i.emulator,"Emulator should always be set here");const{url:t}=i.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gI{static initialize(e,t,a){this.fetchImpl=e,t&&(this.headersImpl=t),a&&(this.responseImpl=a)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Rd("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Rd("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Rd("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vz={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Uz=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],jz=new by(3e4,6e4);function rw(i,e){return i.tenantId&&!e.tenantId?{...e,tenantId:i.tenantId}:e}async function Sg(i,e,t,a,h={}){return _I(i,h,async()=>{let m={},g={};a&&(e==="GET"?g=a:m={body:JSON.stringify(a)});const c=fy({key:i.config.apiKey,...g}).slice(1),C=await i._getAdditionalHeaders();C["Content-Type"]="application/json",i.languageCode&&(C["X-Firebase-Locale"]=i.languageCode);const k={method:e,headers:C,...m};return UR()||(k.referrerPolicy="no-referrer"),i.emulatorConfig&&_g(i.emulatorConfig.host)&&(k.credentials="include"),gI.fetch()(await yI(i,i.config.apiHost,t,c),k)})}async function _I(i,e,t){i._canInitEmulator=!1;const a={...Vz,...e};try{const h=new $z(i),m=await Promise.race([t(),h.promise]);h.clearNetworkTimeout();const g=await m.json();if("needConfirmation"in g)throw Cv(i,"account-exists-with-different-credential",g);if(m.ok&&!("errorMessage"in g))return g;{const c=m.ok?g.errorMessage:g.error.message,[C,k]=c.split(" : ");if(C==="FEDERATED_USER_ID_ALREADY_LINKED")throw Cv(i,"credential-already-in-use",g);if(C==="EMAIL_EXISTS")throw Cv(i,"email-already-in-use",g);if(C==="USER_DISABLED")throw Cv(i,"user-disabled",g);const V=a[C]||C.toLowerCase().replace(/[_\s]+/g,"-");if(k)throw mI(i,V,k);Ud(i,V)}}catch(h){if(h instanceof lh)throw h;Ud(i,"network-request-failed",{message:String(h)})}}async function qz(i,e,t,a,h={}){const m=await Sg(i,e,t,a,h);return"mfaPendingCredential"in m&&Ud(i,"multi-factor-auth-required",{_serverResponse:m}),m}async function yI(i,e,t,a){const h=`${e}${t}?${a}`,m=i,g=m.config.emulator?iw(i.config,h):`${i.config.apiScheme}://${h}`;return Uz.includes(t)&&(await m._persistenceManagerAvailable,m._getPersistenceType()==="COOKIE")?m._getPersistence()._getFinalTarget(g).toString():g}class $z{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,a)=>{this.timer=setTimeout(()=>a(Zh(this.auth,"network-request-failed")),jz.get())})}}function Cv(i,e,t){const a={appName:i.name};t.email&&(a.email=t.email),t.phoneNumber&&(a.phoneNumber=t.phoneNumber);const h=Zh(i,e,a);return h.customData._tokenResponse=t,h}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Gz(i,e){return Sg(i,"POST","/v1/accounts:delete",e)}async function y0(i,e){return Sg(i,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function O_(i){if(i)try{const e=new Date(Number(i));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function Zz(i,e=!1){const t=cu(i),a=await t.getIdToken(e),h=aw(a);ei(h&&h.exp&&h.auth_time&&h.iat,t.auth,"internal-error");const m=typeof h.firebase=="object"?h.firebase:void 0,g=m==null?void 0:m.sign_in_provider;return{claims:h,token:a,authTime:O_(Kb(h.auth_time)),issuedAtTime:O_(Kb(h.iat)),expirationTime:O_(Kb(h.exp)),signInProvider:g||null,signInSecondFactor:(m==null?void 0:m.sign_in_second_factor)||null}}function Kb(i){return Number(i)*1e3}function aw(i){const[e,t,a]=i.split(".");if(e===void 0||t===void 0||a===void 0)return $v("JWT malformed, contained fewer than 3 sections"),null;try{const h=wE(t);return h?JSON.parse(h):($v("Failed to decode base64 JWT payload"),null)}catch(h){return $v("Caught error parsing JWT payload as JSON",h==null?void 0:h.toString()),null}}function xT(i){const e=aw(i);return ei(e,"internal-error"),ei(typeof e.exp<"u","internal-error"),ei(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Q_(i,e,t=!1){if(t)return e;try{return await e}catch(a){throw a instanceof lh&&Hz(a)&&i.auth.currentUser===i&&await i.auth.signOut(),a}}function Hz({code:i}){return i==="auth/user-disabled"||i==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wz{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const t=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),t}else{this.errorBackoff=3e4;const a=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,a)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $x{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=O_(this.lastLoginAt),this.creationTime=O_(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function v0(i){var Z;const e=i.auth,t=await i.getIdToken(),a=await Q_(i,y0(e,{idToken:t}));ei(a==null?void 0:a.users.length,e,"internal-error");const h=a.users[0];i._notifyReloadListener(h);const m=(Z=h.providerUserInfo)!=null&&Z.length?vI(h.providerUserInfo):[],g=Kz(i.providerData,m),c=i.isAnonymous,C=!(i.email&&h.passwordHash)&&!(g!=null&&g.length),k=c?C:!1,V={uid:h.localId,displayName:h.displayName||null,photoURL:h.photoUrl||null,email:h.email||null,emailVerified:h.emailVerified||!1,phoneNumber:h.phoneNumber||null,tenantId:h.tenantId||null,providerData:g,metadata:new $x(h.createdAt,h.lastLoginAt),isAnonymous:k};Object.assign(i,V)}async function Xz(i){const e=cu(i);await v0(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function Kz(i,e){return[...i.filter(a=>!e.some(h=>h.providerId===a.providerId)),...e]}function vI(i){return i.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Yz(i,e){const t=await _I(i,{},async()=>{const a=fy({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:h,apiKey:m}=i.config,g=await yI(i,h,"/v1/token",`key=${m}`),c=await i._getAdditionalHeaders();c["Content-Type"]="application/x-www-form-urlencoded";const C={method:"POST",headers:c,body:a};return i.emulatorConfig&&_g(i.emulatorConfig.host)&&(C.credentials="include"),gI.fetch()(g,C)});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function Qz(i,e){return Sg(i,"POST","/v2/accounts:revokeToken",rw(i,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eg{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){ei(e.idToken,"internal-error"),ei(typeof e.idToken<"u","internal-error"),ei(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):xT(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){ei(e.length!==0,"internal-error");const t=xT(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(ei(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:a,refreshToken:h,expiresIn:m}=await Yz(e,t);this.updateTokensAndExpiration(a,h,Number(m))}updateTokensAndExpiration(e,t,a){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+a*1e3}static fromJSON(e,t){const{refreshToken:a,accessToken:h,expirationTime:m}=t,g=new eg;return a&&(ei(typeof a=="string","internal-error",{appName:e}),g.refreshToken=a),h&&(ei(typeof h=="string","internal-error",{appName:e}),g.accessToken=h),m&&(ei(typeof m=="number","internal-error",{appName:e}),g.expirationTime=m),g}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new eg,this.toJSON())}_performRefresh(){return Rd("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tf(i,e){ei(typeof i=="string"||typeof i>"u","internal-error",{appName:e})}class nh{constructor({uid:e,auth:t,stsTokenManager:a,...h}){this.providerId="firebase",this.proactiveRefresh=new Wz(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=a,this.accessToken=a.accessToken,this.displayName=h.displayName||null,this.email=h.email||null,this.emailVerified=h.emailVerified||!1,this.phoneNumber=h.phoneNumber||null,this.photoURL=h.photoURL||null,this.isAnonymous=h.isAnonymous||!1,this.tenantId=h.tenantId||null,this.providerData=h.providerData?[...h.providerData]:[],this.metadata=new $x(h.createdAt||void 0,h.lastLoginAt||void 0)}async getIdToken(e){const t=await Q_(this,this.stsTokenManager.getToken(this.auth,e));return ei(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return Zz(this,e)}reload(){return Xz(this)}_assign(e){this!==e&&(ei(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>({...t})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new nh({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){ei(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let a=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),a=!0),t&&await v0(this),await this.auth._persistUserIfCurrent(this),a&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Vh(this.auth.app))return Promise.reject(Vp(this.auth));const e=await this.getIdToken();return await Q_(this,Gz(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){const a=t.displayName??void 0,h=t.email??void 0,m=t.phoneNumber??void 0,g=t.photoURL??void 0,c=t.tenantId??void 0,C=t._redirectEventId??void 0,k=t.createdAt??void 0,V=t.lastLoginAt??void 0,{uid:Z,emailVerified:Y,isAnonymous:Q,providerData:be,stsTokenManager:xe}=t;ei(Z&&xe,e,"internal-error");const ze=eg.fromJSON(this.name,xe);ei(typeof Z=="string",e,"internal-error"),Tf(a,e.name),Tf(h,e.name),ei(typeof Y=="boolean",e,"internal-error"),ei(typeof Q=="boolean",e,"internal-error"),Tf(m,e.name),Tf(g,e.name),Tf(c,e.name),Tf(C,e.name),Tf(k,e.name),Tf(V,e.name);const et=new nh({uid:Z,auth:e,email:h,emailVerified:Y,displayName:a,isAnonymous:Q,photoURL:g,phoneNumber:m,tenantId:c,stsTokenManager:ze,createdAt:k,lastLoginAt:V});return be&&Array.isArray(be)&&(et.providerData=be.map(Qe=>({...Qe}))),C&&(et._redirectEventId=C),et}static async _fromIdTokenResponse(e,t,a=!1){const h=new eg;h.updateFromServerResponse(t);const m=new nh({uid:t.localId,auth:e,stsTokenManager:h,isAnonymous:a});return await v0(m),m}static async _fromGetAccountInfoResponse(e,t,a){const h=t.users[0];ei(h.localId!==void 0,"internal-error");const m=h.providerUserInfo!==void 0?vI(h.providerUserInfo):[],g=!(h.email&&h.passwordHash)&&!(m!=null&&m.length),c=new eg;c.updateFromIdToken(a);const C=new nh({uid:h.localId,auth:e,stsTokenManager:c,isAnonymous:g}),k={uid:h.localId,displayName:h.displayName||null,photoURL:h.photoUrl||null,email:h.email||null,emailVerified:h.emailVerified||!1,phoneNumber:h.phoneNumber||null,tenantId:h.tenantId||null,providerData:m,metadata:new $x(h.createdAt,h.lastLoginAt),isAnonymous:!(h.email&&h.passwordHash)&&!(m!=null&&m.length)};return Object.assign(C,k),C}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wT=new Map;function kd(i){jd(i instanceof Function,"Expected a class definition");let e=wT.get(i);return e?(jd(e instanceof i,"Instance stored in cache mismatched with class"),e):(e=new i,wT.set(i,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bI{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}bI.type="NONE";const TT=bI;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gv(i,e,t){return`firebase:${i}:${e}:${t}`}class tg{constructor(e,t,a){this.persistence=e,this.auth=t,this.userKey=a;const{config:h,name:m}=this.auth;this.fullUserKey=Gv(this.userKey,h.apiKey,m),this.fullPersistenceKey=Gv("persistence",h.apiKey,m),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const t=await y0(this.auth,{idToken:e}).catch(()=>{});return t?nh._fromGetAccountInfoResponse(this.auth,t,e):null}return nh._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,a="authUser"){if(!t.length)return new tg(kd(TT),e,a);const h=(await Promise.all(t.map(async k=>{if(await k._isAvailable())return k}))).filter(k=>k);let m=h[0]||kd(TT);const g=Gv(a,e.config.apiKey,e.name);let c=null;for(const k of t)try{const V=await k._get(g);if(V){let Z;if(typeof V=="string"){const Y=await y0(e,{idToken:V}).catch(()=>{});if(!Y)break;Z=await nh._fromGetAccountInfoResponse(e,Y,V)}else Z=nh._fromJSON(e,V);k!==m&&(c=Z),m=k;break}}catch{}const C=h.filter(k=>k._shouldAllowMigration);return!m._shouldAllowMigration||!C.length?new tg(m,e,a):(m=C[0],c&&await m._set(g,c.toJSON()),await Promise.all(t.map(async k=>{if(k!==m)try{await k._remove(g)}catch{}})),new tg(m,e,a))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ST(i){const e=i.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(SI(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(xI(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(AI(e))return"Blackberry";if(II(e))return"Webos";if(wI(e))return"Safari";if((e.includes("chrome/")||TI(e))&&!e.includes("edge/"))return"Chrome";if(EI(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,a=i.match(t);if((a==null?void 0:a.length)===2)return a[1]}return"Other"}function xI(i=wl()){return/firefox\//i.test(i)}function wI(i=wl()){const e=i.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function TI(i=wl()){return/crios\//i.test(i)}function SI(i=wl()){return/iemobile/i.test(i)}function EI(i=wl()){return/android/i.test(i)}function AI(i=wl()){return/blackberry/i.test(i)}function II(i=wl()){return/webos/i.test(i)}function sw(i=wl()){return/iphone|ipad|ipod/i.test(i)||/macintosh/i.test(i)&&/mobile/i.test(i)}function Jz(i=wl()){var e;return sw(i)&&!!((e=window.navigator)!=null&&e.standalone)}function e3(){return qR()&&document.documentMode===10}function CI(i=wl()){return sw(i)||EI(i)||II(i)||AI(i)||/windows phone/i.test(i)||SI(i)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function PI(i,e=[]){let t;switch(i){case"Browser":t=ST(wl());break;case"Worker":t=`${ST(wl())}-${i}`;break;default:t=i}const a=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${yg}/${a}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class t3{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const a=m=>new Promise((g,c)=>{try{const C=e(m);g(C)}catch(C){c(C)}});a.onAbort=t,this.queue.push(a);const h=this.queue.length-1;return()=>{this.queue[h]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const a of this.queue)await a(e),a.onAbort&&t.push(a.onAbort)}catch(a){t.reverse();for(const h of t)try{h()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:a==null?void 0:a.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function n3(i,e={}){return Sg(i,"GET","/v2/passwordPolicy",rw(i,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const i3=6;class r3{constructor(e){var a;const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??i3,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),t.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),t.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),t.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),t.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=((a=e.allowedNonAlphanumericCharacters)==null?void 0:a.join(""))??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){const a=this.customStrengthOptions.minPasswordLength,h=this.customStrengthOptions.maxPasswordLength;a&&(t.meetsMinPasswordLength=e.length>=a),h&&(t.meetsMaxPasswordLength=e.length<=h)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let a;for(let h=0;h<e.length;h++)a=e.charAt(h),this.updatePasswordCharacterOptionsStatuses(t,a>="a"&&a<="z",a>="A"&&a<="Z",a>="0"&&a<="9",this.allowedNonAlphanumericCharacters.includes(a))}updatePasswordCharacterOptionsStatuses(e,t,a,h,m){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=a)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=h)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=m))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class a3{constructor(e,t,a,h){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=a,this.config=h,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new ET(this),this.idTokenSubscription=new ET(this),this.beforeStateQueue=new t3(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=pI,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=h.sdkClientVersion,this._persistenceManagerAvailable=new Promise(m=>this._resolvePersistenceManagerAvailable=m)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=kd(t)),this._initializationPromise=this.queue(async()=>{var a,h,m;if(!this._deleted&&(this.persistenceManager=await tg.create(this,e),(a=this._resolvePersistenceManagerAvailable)==null||a.call(this),!this._deleted)){if((h=this._popupRedirectResolver)!=null&&h._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((m=this.currentUser)==null?void 0:m.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await y0(this,{idToken:e}),a=await nh._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(a)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var m;if(Vh(this.app)){const g=this.app.settings.authIdToken;return g?new Promise(c=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(g).then(c,c))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let a=t,h=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const g=(m=this.redirectUser)==null?void 0:m._redirectEventId,c=a==null?void 0:a._redirectEventId,C=await this.tryRedirectSignIn(e);(!g||g===c)&&(C!=null&&C.user)&&(a=C.user,h=!0)}if(!a)return this.directlySetCurrentUser(null);if(!a._redirectEventId){if(h)try{await this.beforeStateQueue.runMiddleware(a)}catch(g){a=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(g))}return a?this.reloadAndSetCurrentUserOrClear(a):this.directlySetCurrentUser(null)}return ei(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===a._redirectEventId?this.directlySetCurrentUser(a):this.reloadAndSetCurrentUserOrClear(a)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await v0(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=Fz()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Vh(this.app))return Promise.reject(Vp(this));const t=e?cu(e):null;return t&&ei(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&ei(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Vh(this.app)?Promise.reject(Vp(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Vh(this.app)?Promise.reject(Vp(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(kd(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await n3(this),t=new r3(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new nm("auth","Firebase",e())}onAuthStateChanged(e,t,a){return this.registerStateListener(this.authStateSubscription,e,t,a)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,a){return this.registerStateListener(this.idTokenSubscription,e,t,a)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const a=this.onAuthStateChanged(()=>{a(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),a={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(a.tenantId=this.tenantId),await Qz(this,a)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)==null?void 0:e.toJSON()}}async _setRedirectUser(e,t){const a=await this.getOrInitRedirectPersistenceManager(t);return e===null?a.removeCurrentUser():a.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&kd(e)||this._popupRedirectResolver;ei(t,this,"argument-error"),this.redirectPersistenceManager=await tg.create(this,[kd(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,a;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)==null?void 0:t._redirectEventId)===e?this._currentUser:((a=this.redirectUser)==null?void 0:a._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=((t=this.currentUser)==null?void 0:t.uid)??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,a,h){if(this._deleted)return()=>{};const m=typeof t=="function"?t:t.next.bind(t);let g=!1;const c=this._isInitialized?Promise.resolve():this._initializationPromise;if(ei(c,this,"internal-error"),c.then(()=>{g||m(this.currentUser)}),typeof t=="function"){const C=e.addObserver(t,a,h);return()=>{g=!0,C()}}else{const C=e.addObserver(t);return()=>{g=!0,C()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return ei(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=PI(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var h;const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const t=await((h=this.heartbeatServiceProvider.getImmediate({optional:!0}))==null?void 0:h.getHeartbeatsHeader());t&&(e["X-Firebase-Client"]=t);const a=await this._getAppCheckToken();return a&&(e["X-Firebase-AppCheck"]=a),e}async _getAppCheckToken(){var t;if(Vh(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await((t=this.appCheckServiceProvider.getImmediate({optional:!0}))==null?void 0:t.getToken());return e!=null&&e.error&&Oz(`Error while retrieving App Check token: ${e.error}`),e==null?void 0:e.token}}function ow(i){return cu(i)}class ET{constructor(e){this.auth=e,this.observer=null,this.addObserver=KR(t=>this.observer=t)}get next(){return ei(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let lw={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function s3(i){lw=i}function o3(i){return lw.loadJS(i)}function l3(){return lw.gapiScript}function u3(i){return`__${i}${Math.floor(Math.random()*1e6)}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function c3(i,e){const t=im(i,"auth");if(t.isInitialized()){const h=t.getImmediate(),m=t.getOptions();if(Bf(m,e??{}))return h;Ud(h,"already-initialized")}return t.initialize({options:e})}function h3(i,e){const t=(e==null?void 0:e.persistence)||[],a=(Array.isArray(t)?t:[t]).map(kd);e!=null&&e.errorMap&&i._updateErrorMap(e.errorMap),i._initializeWithPersistence(a,e==null?void 0:e.popupRedirectResolver)}function d3(i,e,t){const a=ow(i);ei(/^https?:\/\//.test(e),a,"invalid-emulator-scheme");const h=!1,m=MI(e),{host:g,port:c}=f3(e),C=c===null?"":`:${c}`,k={url:`${m}//${g}${C}/`},V=Object.freeze({host:g,port:c,protocol:m.replace(":",""),options:Object.freeze({disableWarnings:h})});if(!a._canInitEmulator){ei(a.config.emulator&&a.emulatorConfig,a,"emulator-config-failed"),ei(Bf(k,a.config.emulator)&&Bf(V,a.emulatorConfig),a,"emulator-config-failed");return}a.config.emulator=k,a.emulatorConfig=V,a.settings.appVerificationDisabledForTesting=!0,_g(g)?(AE(`${m}//${g}${C}`),IE("Auth",!0)):p3()}function MI(i){const e=i.indexOf(":");return e<0?"":i.substr(0,e+1)}function f3(i){const e=MI(i),t=/(\/\/)?([^?#/]+)/.exec(i.substr(e.length));if(!t)return{host:"",port:null};const a=t[2].split("@").pop()||"",h=/^(\[[^\]]+\])(:|$)/.exec(a);if(h){const m=h[1];return{host:m,port:AT(a.substr(m.length+1))}}else{const[m,g]=a.split(":");return{host:m,port:AT(g)}}}function AT(i){if(!i)return null;const e=Number(i);return isNaN(e)?null:e}function p3(){function i(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",i):i())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RI{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Rd("not implemented")}_getIdTokenResponse(e){return Rd("not implemented")}_linkToIdToken(e,t){return Rd("not implemented")}_getReauthenticationResolver(e){return Rd("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ng(i,e){return qz(i,"POST","/v1/accounts:signInWithIdp",rw(i,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const m3="http://localhost";class Kp extends RI{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Kp(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Ud("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:a,signInMethod:h,...m}=t;if(!a||!h)return null;const g=new Kp(a,h);return g.idToken=m.idToken||void 0,g.accessToken=m.accessToken||void 0,g.secret=m.secret,g.nonce=m.nonce,g.pendingToken=m.pendingToken||null,g}_getIdTokenResponse(e){const t=this.buildRequest();return ng(e,t)}_linkToIdToken(e,t){const a=this.buildRequest();return a.idToken=t,ng(e,a)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,ng(e,t)}buildRequest(){const e={requestUri:m3,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=fy(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kI{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xy extends kI{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ef extends xy{constructor(){super("facebook.com")}static credential(e){return Kp._fromParams({providerId:Ef.PROVIDER_ID,signInMethod:Ef.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Ef.credentialFromTaggedObject(e)}static credentialFromError(e){return Ef.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Ef.credential(e.oauthAccessToken)}catch{return null}}}Ef.FACEBOOK_SIGN_IN_METHOD="facebook.com";Ef.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Af extends xy{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Kp._fromParams({providerId:Af.PROVIDER_ID,signInMethod:Af.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Af.credentialFromTaggedObject(e)}static credentialFromError(e){return Af.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:a}=e;if(!t&&!a)return null;try{return Af.credential(t,a)}catch{return null}}}Af.GOOGLE_SIGN_IN_METHOD="google.com";Af.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class If extends xy{constructor(){super("github.com")}static credential(e){return Kp._fromParams({providerId:If.PROVIDER_ID,signInMethod:If.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return If.credentialFromTaggedObject(e)}static credentialFromError(e){return If.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return If.credential(e.oauthAccessToken)}catch{return null}}}If.GITHUB_SIGN_IN_METHOD="github.com";If.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cf extends xy{constructor(){super("twitter.com")}static credential(e,t){return Kp._fromParams({providerId:Cf.PROVIDER_ID,signInMethod:Cf.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Cf.credentialFromTaggedObject(e)}static credentialFromError(e){return Cf.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:a}=e;if(!t||!a)return null;try{return Cf.credential(t,a)}catch{return null}}}Cf.TWITTER_SIGN_IN_METHOD="twitter.com";Cf.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dg{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,a,h=!1){const m=await nh._fromIdTokenResponse(e,a,h),g=IT(a);return new dg({user:m,providerId:g,_tokenResponse:a,operationType:t})}static async _forOperation(e,t,a){await e._updateTokensIfNecessary(a,!0);const h=IT(a);return new dg({user:e,providerId:h,_tokenResponse:a,operationType:t})}}function IT(i){return i.providerId?i.providerId:"phoneNumber"in i?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class b0 extends lh{constructor(e,t,a,h){super(t.code,t.message),this.operationType=a,this.user=h,Object.setPrototypeOf(this,b0.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:a}}static _fromErrorAndOperation(e,t,a,h){return new b0(e,t,a,h)}}function LI(i,e,t,a){return(e==="reauthenticate"?t._getReauthenticationResolver(i):t._getIdTokenResponse(i)).catch(m=>{throw m.code==="auth/multi-factor-auth-required"?b0._fromErrorAndOperation(i,m,e,a):m})}async function g3(i,e,t=!1){const a=await Q_(i,e._linkToIdToken(i.auth,await i.getIdToken()),t);return dg._forOperation(i,"link",a)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _3(i,e,t=!1){const{auth:a}=i;if(Vh(a.app))return Promise.reject(Vp(a));const h="reauthenticate";try{const m=await Q_(i,LI(a,h,e,i),t);ei(m.idToken,a,"internal-error");const g=aw(m.idToken);ei(g,a,"internal-error");const{sub:c}=g;return ei(i.uid===c,a,"user-mismatch"),dg._forOperation(i,h,m)}catch(m){throw(m==null?void 0:m.code)==="auth/user-not-found"&&Ud(a,"user-mismatch"),m}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function y3(i,e,t=!1){if(Vh(i.app))return Promise.reject(Vp(i));const a="signIn",h=await LI(i,a,e),m=await dg._fromIdTokenResponse(i,a,h);return t||await i._updateCurrentUser(m.user),m}function v3(i,e,t,a){return cu(i).onIdTokenChanged(e,t,a)}function b3(i,e,t){return cu(i).beforeAuthStateChanged(e,t)}const x0="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DI{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(x0,"1"),this.storage.removeItem(x0),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const x3=1e3,w3=10;class zI extends DI{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=CI(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const a=this.storage.getItem(t),h=this.localCache[t];a!==h&&e(t,h,a)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((g,c,C)=>{this.notifyListeners(g,C)});return}const a=e.key;t?this.detachListener():this.stopPolling();const h=()=>{const g=this.storage.getItem(a);!t&&this.localCache[a]===g||this.notifyListeners(a,g)},m=this.storage.getItem(a);e3()&&m!==e.newValue&&e.newValue!==e.oldValue?setTimeout(h,w3):h()}notifyListeners(e,t){this.localCache[e]=t;const a=this.listeners[e];if(a)for(const h of Array.from(a))h(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,a)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:a}),!0)})},x3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}zI.type="LOCAL";const T3=zI;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OI extends DI{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}OI.type="SESSION";const NI=OI;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function S3(i){return Promise.all(i.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Q0{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(h=>h.isListeningto(e));if(t)return t;const a=new Q0(e);return this.receivers.push(a),a}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:a,eventType:h,data:m}=t.data,g=this.handlersMap[h];if(!(g!=null&&g.size))return;t.ports[0].postMessage({status:"ack",eventId:a,eventType:h});const c=Array.from(g).map(async k=>k(t.origin,m)),C=await S3(c);t.ports[0].postMessage({status:"done",eventId:a,eventType:h,response:C})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Q0.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uw(i="",e=10){let t="";for(let a=0;a<e;a++)t+=Math.floor(Math.random()*10);return i+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class E3{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,a=50){const h=typeof MessageChannel<"u"?new MessageChannel:null;if(!h)throw new Error("connection_unavailable");let m,g;return new Promise((c,C)=>{const k=uw("",20);h.port1.start();const V=setTimeout(()=>{C(new Error("unsupported_event"))},a);g={messageChannel:h,onMessage(Z){const Y=Z;if(Y.data.eventId===k)switch(Y.data.status){case"ack":clearTimeout(V),m=setTimeout(()=>{C(new Error("timeout"))},3e3);break;case"done":clearTimeout(m),c(Y.data.response);break;default:clearTimeout(V),clearTimeout(m),C(new Error("invalid_response"));break}}},this.handlers.add(g),h.port1.addEventListener("message",g.onMessage),this.target.postMessage({eventType:e,eventId:k,data:t},[h.port2])}).finally(()=>{g&&this.removeMessageHandler(g)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hh(){return window}function A3(i){Hh().location.href=i}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function BI(){return typeof Hh().WorkerGlobalScope<"u"&&typeof Hh().importScripts=="function"}async function I3(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function C3(){var i;return((i=navigator==null?void 0:navigator.serviceWorker)==null?void 0:i.controller)||null}function P3(){return BI()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FI="firebaseLocalStorageDb",M3=1,w0="firebaseLocalStorage",VI="fbase_key";class wy{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function J0(i,e){return i.transaction([w0],e?"readwrite":"readonly").objectStore(w0)}function R3(){const i=indexedDB.deleteDatabase(FI);return new wy(i).toPromise()}function Gx(){const i=indexedDB.open(FI,M3);return new Promise((e,t)=>{i.addEventListener("error",()=>{t(i.error)}),i.addEventListener("upgradeneeded",()=>{const a=i.result;try{a.createObjectStore(w0,{keyPath:VI})}catch(h){t(h)}}),i.addEventListener("success",async()=>{const a=i.result;a.objectStoreNames.contains(w0)?e(a):(a.close(),await R3(),e(await Gx()))})})}async function CT(i,e,t){const a=J0(i,!0).put({[VI]:e,value:t});return new wy(a).toPromise()}async function k3(i,e){const t=J0(i,!1).get(e),a=await new wy(t).toPromise();return a===void 0?null:a.value}function PT(i,e){const t=J0(i,!0).delete(e);return new wy(t).toPromise()}const L3=800,D3=3;class UI{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Gx(),this.db)}async _withRetries(e){let t=0;for(;;)try{const a=await this._openDb();return await e(a)}catch(a){if(t++>D3)throw a;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return BI()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Q0._getInstance(P3()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var t,a;if(this.activeServiceWorker=await I3(),!this.activeServiceWorker)return;this.sender=new E3(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&(t=e[0])!=null&&t.fulfilled&&(a=e[0])!=null&&a.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||C3()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Gx();return await CT(e,x0,"1"),await PT(e,x0),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(a=>CT(a,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(a=>k3(a,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>PT(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(h=>{const m=J0(h,!1).getAll();return new wy(m).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],a=new Set;if(e.length!==0)for(const{fbase_key:h,value:m}of e)a.add(h),JSON.stringify(this.localCache[h])!==JSON.stringify(m)&&(this.notifyListeners(h,m),t.push(h));for(const h of Object.keys(this.localCache))this.localCache[h]&&!a.has(h)&&(this.notifyListeners(h,null),t.push(h));return t}notifyListeners(e,t){this.localCache[e]=t;const a=this.listeners[e];if(a)for(const h of Array.from(a))h(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),L3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}UI.type="LOCAL";const z3=UI;new by(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function O3(i,e){return e?kd(e):(ei(i._popupRedirectResolver,i,"argument-error"),i._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cw extends RI{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return ng(e,this._buildIdpRequest())}_linkToIdToken(e,t){return ng(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return ng(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function N3(i){return y3(i.auth,new cw(i),i.bypassAuthState)}function B3(i){const{auth:e,user:t}=i;return ei(t,e,"internal-error"),_3(t,new cw(i),i.bypassAuthState)}async function F3(i){const{auth:e,user:t}=i;return ei(t,e,"internal-error"),g3(t,new cw(i),i.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jI{constructor(e,t,a,h,m=!1){this.auth=e,this.resolver=a,this.user=h,this.bypassAuthState=m,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(a){this.reject(a)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:a,postBody:h,tenantId:m,error:g,type:c}=e;if(g){this.reject(g);return}const C={auth:this.auth,requestUri:t,sessionId:a,tenantId:m||void 0,postBody:h||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(c)(C))}catch(k){this.reject(k)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return N3;case"linkViaPopup":case"linkViaRedirect":return F3;case"reauthViaPopup":case"reauthViaRedirect":return B3;default:Ud(this.auth,"internal-error")}}resolve(e){jd(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){jd(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const V3=new by(2e3,1e4);class Km extends jI{constructor(e,t,a,h,m){super(e,t,h,m),this.provider=a,this.authWindow=null,this.pollId=null,Km.currentPopupAction&&Km.currentPopupAction.cancel(),Km.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return ei(e,this.auth,"internal-error"),e}async onExecution(){jd(this.filter.length===1,"Popup operations only handle one event");const e=uw();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(Zh(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)==null?void 0:e.associatedEvent)||null}cancel(){this.reject(Zh(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Km.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,a;if((a=(t=this.authWindow)==null?void 0:t.window)!=null&&a.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Zh(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,V3.get())};e()}}Km.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const U3="pendingRedirect",Zv=new Map;class j3 extends jI{constructor(e,t,a=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,a),this.eventId=null}async execute(){let e=Zv.get(this.auth._key());if(!e){try{const a=await q3(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(a)}catch(t){e=()=>Promise.reject(t)}Zv.set(this.auth._key(),e)}return this.bypassAuthState||Zv.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function q3(i,e){const t=Z3(e),a=G3(i);if(!await a._isAvailable())return!1;const h=await a._get(t)==="true";return await a._remove(t),h}function $3(i,e){Zv.set(i._key(),e)}function G3(i){return kd(i._redirectPersistence)}function Z3(i){return Gv(U3,i.config.apiKey,i.name)}async function H3(i,e,t=!1){if(Vh(i.app))return Promise.reject(Vp(i));const a=ow(i),h=O3(a,e),g=await new j3(a,h,t).execute();return g&&!t&&(delete g.user._redirectEventId,await a._persistUserIfCurrent(g.user),await a._setRedirectUser(null,e)),g}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const W3=600*1e3;class X3{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(a=>{this.isEventForConsumer(e,a)&&(t=!0,this.sendToConsumer(e,a),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!K3(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var a;if(e.error&&!qI(e)){const h=((a=e.error.code)==null?void 0:a.split("auth/")[1])||"internal-error";t.onError(Zh(this.auth,h))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const a=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&a}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=W3&&this.cachedEventUids.clear(),this.cachedEventUids.has(MT(e))}saveEventToCache(e){this.cachedEventUids.add(MT(e)),this.lastProcessedEventTime=Date.now()}}function MT(i){return[i.type,i.eventId,i.sessionId,i.tenantId].filter(e=>e).join("-")}function qI({type:i,error:e}){return i==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function K3(i){switch(i.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return qI(i);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Y3(i,e={}){return Sg(i,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Q3=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,J3=/^https?/;async function eO(i){if(i.config.emulator)return;const{authorizedDomains:e}=await Y3(i);for(const t of e)try{if(tO(t))return}catch{}Ud(i,"unauthorized-domain")}function tO(i){const e=qx(),{protocol:t,hostname:a}=new URL(e);if(i.startsWith("chrome-extension://")){const g=new URL(i);return g.hostname===""&&a===""?t==="chrome-extension:"&&i.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&g.hostname===a}if(!J3.test(t))return!1;if(Q3.test(i))return a===i;const h=i.replace(/\./g,"\\.");return new RegExp("^(.+\\."+h+"|"+h+")$","i").test(a)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nO=new by(3e4,6e4);function RT(){const i=Hh().___jsl;if(i!=null&&i.H){for(const e of Object.keys(i.H))if(i.H[e].r=i.H[e].r||[],i.H[e].L=i.H[e].L||[],i.H[e].r=[...i.H[e].L],i.CP)for(let t=0;t<i.CP.length;t++)i.CP[t]=null}}function iO(i){return new Promise((e,t)=>{var h,m,g;function a(){RT(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{RT(),t(Zh(i,"network-request-failed"))},timeout:nO.get()})}if((m=(h=Hh().gapi)==null?void 0:h.iframes)!=null&&m.Iframe)e(gapi.iframes.getContext());else if((g=Hh().gapi)!=null&&g.load)a();else{const c=u3("iframefcb");return Hh()[c]=()=>{gapi.load?a():t(Zh(i,"network-request-failed"))},o3(`${l3()}?onload=${c}`).catch(C=>t(C))}}).catch(e=>{throw Hv=null,e})}let Hv=null;function rO(i){return Hv=Hv||iO(i),Hv}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aO=new by(5e3,15e3),sO="__/auth/iframe",oO="emulator/auth/iframe",lO={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},uO=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function cO(i){const e=i.config;ei(e.authDomain,i,"auth-domain-config-required");const t=e.emulator?iw(e,oO):`https://${i.config.authDomain}/${sO}`,a={apiKey:e.apiKey,appName:i.name,v:yg},h=uO.get(i.config.apiHost);h&&(a.eid=h);const m=i._getFrameworks();return m.length&&(a.fw=m.join(",")),`${t}?${fy(a).slice(1)}`}async function hO(i){const e=await rO(i),t=Hh().gapi;return ei(t,i,"internal-error"),e.open({where:document.body,url:cO(i),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:lO,dontclear:!0},a=>new Promise(async(h,m)=>{await a.restyle({setHideOnLeave:!1});const g=Zh(i,"network-request-failed"),c=Hh().setTimeout(()=>{m(g)},aO.get());function C(){Hh().clearTimeout(c),h(a)}a.ping(C).then(C,()=>{m(g)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dO={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},fO=500,pO=600,mO="_blank",gO="http://localhost";class kT{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function _O(i,e,t,a=fO,h=pO){const m=Math.max((window.screen.availHeight-h)/2,0).toString(),g=Math.max((window.screen.availWidth-a)/2,0).toString();let c="";const C={...dO,width:a.toString(),height:h.toString(),top:m,left:g},k=wl().toLowerCase();t&&(c=TI(k)?mO:t),xI(k)&&(e=e||gO,C.scrollbars="yes");const V=Object.entries(C).reduce((Y,[Q,be])=>`${Y}${Q}=${be},`,"");if(Jz(k)&&c!=="_self")return yO(e||"",c),new kT(null);const Z=window.open(e||"",c,V);ei(Z,i,"popup-blocked");try{Z.focus()}catch{}return new kT(Z)}function yO(i,e){const t=document.createElement("a");t.href=i,t.target=e;const a=document.createEvent("MouseEvent");a.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(a)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vO="__/auth/handler",bO="emulator/auth/handler",xO=encodeURIComponent("fac");async function LT(i,e,t,a,h,m){ei(i.config.authDomain,i,"auth-domain-config-required"),ei(i.config.apiKey,i,"invalid-api-key");const g={apiKey:i.config.apiKey,appName:i.name,authType:t,redirectUrl:a,v:yg,eventId:h};if(e instanceof kI){e.setDefaultLanguage(i.languageCode),g.providerId=e.providerId||"",XR(e.getCustomParameters())||(g.customParameters=JSON.stringify(e.getCustomParameters()));for(const[V,Z]of Object.entries({}))g[V]=Z}if(e instanceof xy){const V=e.getScopes().filter(Z=>Z!=="");V.length>0&&(g.scopes=V.join(","))}i.tenantId&&(g.tid=i.tenantId);const c=g;for(const V of Object.keys(c))c[V]===void 0&&delete c[V];const C=await i._getAppCheckToken(),k=C?`#${xO}=${encodeURIComponent(C)}`:"";return`${wO(i)}?${fy(c).slice(1)}${k}`}function wO({config:i}){return i.emulator?iw(i,bO):`https://${i.authDomain}/${vO}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yb="webStorageSupport";class TO{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=NI,this._completeRedirectFn=H3,this._overrideRedirectResult=$3}async _openPopup(e,t,a,h){var g;jd((g=this.eventManagers[e._key()])==null?void 0:g.manager,"_initialize() not called before _openPopup()");const m=await LT(e,t,a,qx(),h);return _O(e,m,uw())}async _openRedirect(e,t,a,h){await this._originValidation(e);const m=await LT(e,t,a,qx(),h);return A3(m),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:h,promise:m}=this.eventManagers[t];return h?Promise.resolve(h):(jd(m,"If manager is not set, promise should be"),m)}const a=this.initAndGetManager(e);return this.eventManagers[t]={promise:a},a.catch(()=>{delete this.eventManagers[t]}),a}async initAndGetManager(e){const t=await hO(e),a=new X3(e);return t.register("authEvent",h=>(ei(h==null?void 0:h.authEvent,e,"invalid-auth-event"),{status:a.onEvent(h.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:a},this.iframes[e._key()]=t,a}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Yb,{type:Yb},h=>{var g;const m=(g=h==null?void 0:h[0])==null?void 0:g[Yb];m!==void 0&&t(!!m),Ud(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=eO(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return CI()||wI()||sw()}}const SO=TO;var DT="@firebase/auth",zT="1.11.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EO{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)==null?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(a=>{e((a==null?void 0:a.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){ei(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function AO(i){switch(i){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function IO(i){Jh(new sh("auth",(e,{options:t})=>{const a=e.getProvider("app").getImmediate(),h=e.getProvider("heartbeat"),m=e.getProvider("app-check-internal"),{apiKey:g,authDomain:c}=a.options;ei(g&&!g.includes(":"),"invalid-api-key",{appName:a.name});const C={apiKey:g,authDomain:c,clientPlatform:i,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:PI(i)},k=new a3(a,h,m,C);return h3(k,t),k},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,a)=>{e.getProvider("auth-internal").initialize()})),Jh(new sh("auth-internal",e=>{const t=ow(e.getProvider("auth").getImmediate());return(a=>new EO(a))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Tc(DT,zT,AO(i)),Tc(DT,zT,"esm2020")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CO=300,PO=EE("authIdTokenMaxAge")||CO;let OT=null;const MO=i=>async e=>{const t=e&&await e.getIdTokenResult(),a=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(a&&a>PO)return;const h=t==null?void 0:t.token;OT!==h&&(OT=h,await fetch(i,{method:h?"POST":"DELETE",headers:h?{Authorization:`Bearer ${h}`}:{}}))};function RO(i=w1()){const e=im(i,"auth");if(e.isInitialized())return e.getImmediate();const t=c3(i,{popupRedirectResolver:SO,persistence:[z3,T3,NI]}),a=EE("authTokenSyncURL");if(a&&typeof isSecureContext=="boolean"&&isSecureContext){const m=new URL(a,location.origin);if(location.origin===m.origin){const g=MO(m.toString());b3(t,g,()=>g(t.currentUser)),v3(t,c=>g(c))}}const h=TE("auth");return h&&d3(t,`http://${h}`),t}function kO(){var i;return((i=document.getElementsByTagName("head"))==null?void 0:i[0])??document}s3({loadJS(i){return new Promise((e,t)=>{const a=document.createElement("script");a.setAttribute("src",i),a.onload=e,a.onerror=h=>{const m=Zh("internal-error");m.customData=h,t(m)},a.type="text/javascript",a.charset="UTF-8",kO().appendChild(a)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});IO("Browser");const $I="@firebase/installations",hw="0.6.19";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GI=1e4,ZI=`w:${hw}`,HI="FIS_v2",LO="https://firebaseinstallations.googleapis.com/v1",DO=3600*1e3,zO="installations",OO="Installations";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const NO={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},Yp=new nm(zO,OO,NO);function WI(i){return i instanceof lh&&i.code.includes("request-failed")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function XI({projectId:i}){return`${LO}/projects/${i}/installations`}function KI(i){return{token:i.token,requestStatus:2,expiresIn:FO(i.expiresIn),creationTime:Date.now()}}async function YI(i,e){const a=(await e.json()).error;return Yp.create("request-failed",{requestName:i,serverCode:a.code,serverMessage:a.message,serverStatus:a.status})}function QI({apiKey:i}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":i})}function BO(i,{refreshToken:e}){const t=QI(i);return t.append("Authorization",VO(e)),t}async function JI(i){const e=await i();return e.status>=500&&e.status<600?i():e}function FO(i){return Number(i.replace("s","000"))}function VO(i){return`${HI} ${i}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function UO({appConfig:i,heartbeatServiceProvider:e},{fid:t}){const a=XI(i),h=QI(i),m=e.getImmediate({optional:!0});if(m){const k=await m.getHeartbeatsHeader();k&&h.append("x-firebase-client",k)}const g={fid:t,authVersion:HI,appId:i.appId,sdkVersion:ZI},c={method:"POST",headers:h,body:JSON.stringify(g)},C=await JI(()=>fetch(a,c));if(C.ok){const k=await C.json();return{fid:k.fid||t,registrationStatus:2,refreshToken:k.refreshToken,authToken:KI(k.authToken)}}else throw await YI("Create Installation",C)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eC(i){return new Promise(e=>{setTimeout(e,i)})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jO(i){return btoa(String.fromCharCode(...i)).replace(/\+/g,"-").replace(/\//g,"_")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qO=/^[cdef][\w-]{21}$/,Zx="";function $O(){try{const i=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(i),i[0]=112+i[0]%16;const t=GO(i);return qO.test(t)?t:Zx}catch{return Zx}}function GO(i){return jO(i).substr(0,22)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eb(i){return`${i.appName}!${i.appId}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tC=new Map;function nC(i,e){const t=eb(i);iC(t,e),ZO(t,e)}function iC(i,e){const t=tC.get(i);if(t)for(const a of t)a(e)}function ZO(i,e){const t=HO();t&&t.postMessage({key:i,fid:e}),WO()}let Bp=null;function HO(){return!Bp&&"BroadcastChannel"in self&&(Bp=new BroadcastChannel("[Firebase] FID Change"),Bp.onmessage=i=>{iC(i.data.key,i.data.fid)}),Bp}function WO(){tC.size===0&&Bp&&(Bp.close(),Bp=null)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XO="firebase-installations-database",KO=1,Qp="firebase-installations-store";let Qb=null;function dw(){return Qb||(Qb=LE(XO,KO,{upgrade:(i,e)=>{switch(e){case 0:i.createObjectStore(Qp)}}})),Qb}async function T0(i,e){const t=eb(i),h=(await dw()).transaction(Qp,"readwrite"),m=h.objectStore(Qp),g=await m.get(t);return await m.put(e,t),await h.done,(!g||g.fid!==e.fid)&&nC(i,e.fid),e}async function rC(i){const e=eb(i),a=(await dw()).transaction(Qp,"readwrite");await a.objectStore(Qp).delete(e),await a.done}async function tb(i,e){const t=eb(i),h=(await dw()).transaction(Qp,"readwrite"),m=h.objectStore(Qp),g=await m.get(t),c=e(g);return c===void 0?await m.delete(t):await m.put(c,t),await h.done,c&&(!g||g.fid!==c.fid)&&nC(i,c.fid),c}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function fw(i){let e;const t=await tb(i.appConfig,a=>{const h=YO(a),m=QO(i,h);return e=m.registrationPromise,m.installationEntry});return t.fid===Zx?{installationEntry:await e}:{installationEntry:t,registrationPromise:e}}function YO(i){const e=i||{fid:$O(),registrationStatus:0};return aC(e)}function QO(i,e){if(e.registrationStatus===0){if(!navigator.onLine){const h=Promise.reject(Yp.create("app-offline"));return{installationEntry:e,registrationPromise:h}}const t={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},a=JO(i,t);return{installationEntry:t,registrationPromise:a}}else return e.registrationStatus===1?{installationEntry:e,registrationPromise:e4(i)}:{installationEntry:e}}async function JO(i,e){try{const t=await UO(i,e);return T0(i.appConfig,t)}catch(t){throw WI(t)&&t.customData.serverCode===409?await rC(i.appConfig):await T0(i.appConfig,{fid:e.fid,registrationStatus:0}),t}}async function e4(i){let e=await NT(i.appConfig);for(;e.registrationStatus===1;)await eC(100),e=await NT(i.appConfig);if(e.registrationStatus===0){const{installationEntry:t,registrationPromise:a}=await fw(i);return a||t}return e}function NT(i){return tb(i,e=>{if(!e)throw Yp.create("installation-not-found");return aC(e)})}function aC(i){return t4(i)?{fid:i.fid,registrationStatus:0}:i}function t4(i){return i.registrationStatus===1&&i.registrationTime+GI<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function n4({appConfig:i,heartbeatServiceProvider:e},t){const a=i4(i,t),h=BO(i,t),m=e.getImmediate({optional:!0});if(m){const k=await m.getHeartbeatsHeader();k&&h.append("x-firebase-client",k)}const g={installation:{sdkVersion:ZI,appId:i.appId}},c={method:"POST",headers:h,body:JSON.stringify(g)},C=await JI(()=>fetch(a,c));if(C.ok){const k=await C.json();return KI(k)}else throw await YI("Generate Auth Token",C)}function i4(i,{fid:e}){return`${XI(i)}/${e}/authTokens:generate`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function pw(i,e=!1){let t;const a=await tb(i.appConfig,m=>{if(!sC(m))throw Yp.create("not-registered");const g=m.authToken;if(!e&&s4(g))return m;if(g.requestStatus===1)return t=r4(i,e),m;{if(!navigator.onLine)throw Yp.create("app-offline");const c=l4(m);return t=a4(i,c),c}});return t?await t:a.authToken}async function r4(i,e){let t=await BT(i.appConfig);for(;t.authToken.requestStatus===1;)await eC(100),t=await BT(i.appConfig);const a=t.authToken;return a.requestStatus===0?pw(i,e):a}function BT(i){return tb(i,e=>{if(!sC(e))throw Yp.create("not-registered");const t=e.authToken;return u4(t)?{...e,authToken:{requestStatus:0}}:e})}async function a4(i,e){try{const t=await n4(i,e),a={...e,authToken:t};return await T0(i.appConfig,a),t}catch(t){if(WI(t)&&(t.customData.serverCode===401||t.customData.serverCode===404))await rC(i.appConfig);else{const a={...e,authToken:{requestStatus:0}};await T0(i.appConfig,a)}throw t}}function sC(i){return i!==void 0&&i.registrationStatus===2}function s4(i){return i.requestStatus===2&&!o4(i)}function o4(i){const e=Date.now();return e<i.creationTime||i.creationTime+i.expiresIn<e+DO}function l4(i){const e={requestStatus:1,requestTime:Date.now()};return{...i,authToken:e}}function u4(i){return i.requestStatus===1&&i.requestTime+GI<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function c4(i){const e=i,{installationEntry:t,registrationPromise:a}=await fw(e);return a?a.catch(console.error):pw(e).catch(console.error),t.fid}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function h4(i,e=!1){const t=i;return await d4(t),(await pw(t,e)).token}async function d4(i){const{registrationPromise:e}=await fw(i);e&&await e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function f4(i){if(!i||!i.options)throw Jb("App Configuration");if(!i.name)throw Jb("App Name");const e=["projectId","apiKey","appId"];for(const t of e)if(!i.options[t])throw Jb(t);return{appName:i.name,projectId:i.options.projectId,apiKey:i.options.apiKey,appId:i.options.appId}}function Jb(i){return Yp.create("missing-app-config-values",{valueName:i})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oC="installations",p4="installations-internal",m4=i=>{const e=i.getProvider("app").getImmediate(),t=f4(e),a=im(e,"heartbeat");return{app:e,appConfig:t,heartbeatServiceProvider:a,_delete:()=>Promise.resolve()}},g4=i=>{const e=i.getProvider("app").getImmediate(),t=im(e,oC).getImmediate();return{getId:()=>c4(t),getToken:h=>h4(t,h)}};function _4(){Jh(new sh(oC,m4,"PUBLIC")),Jh(new sh(p4,g4,"PRIVATE"))}_4();Tc($I,hw);Tc($I,hw,"esm2020");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const S0="analytics",y4="firebase_id",v4="origin",b4=60*1e3,x4="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",mw="https://www.googletagmanager.com/gtag/js";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uu=new N0("@firebase/analytics");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const w4={"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-initialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."},Bu=new nm("analytics","Analytics",w4);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function T4(i){if(!i.startsWith(mw)){const e=Bu.create("invalid-gtag-resource",{gtagURL:i});return uu.warn(e.message),""}return i}function lC(i){return Promise.all(i.map(e=>e.catch(t=>t)))}function S4(i,e){let t;return window.trustedTypes&&(t=window.trustedTypes.createPolicy(i,e)),t}function E4(i,e){const t=S4("firebase-js-sdk-policy",{createScriptURL:T4}),a=document.createElement("script"),h=`${mw}?l=${i}&id=${e}`;a.src=t?t==null?void 0:t.createScriptURL(h):h,a.async=!0,document.head.appendChild(a)}function A4(i){let e=[];return Array.isArray(window[i])?e=window[i]:window[i]=e,e}async function I4(i,e,t,a,h,m){const g=a[h];try{if(g)await e[g];else{const C=(await lC(t)).find(k=>k.measurementId===h);C&&await e[C.appId]}}catch(c){uu.error(c)}i("config",h,m)}async function C4(i,e,t,a,h){try{let m=[];if(h&&h.send_to){let g=h.send_to;Array.isArray(g)||(g=[g]);const c=await lC(t);for(const C of g){const k=c.find(Z=>Z.measurementId===C),V=k&&e[k.appId];if(V)m.push(V);else{m=[];break}}}m.length===0&&(m=Object.values(e)),await Promise.all(m),i("event",a,h||{})}catch(m){uu.error(m)}}function P4(i,e,t,a){async function h(m,...g){try{if(m==="event"){const[c,C]=g;await C4(i,e,t,c,C)}else if(m==="config"){const[c,C]=g;await I4(i,e,t,a,c,C)}else if(m==="consent"){const[c,C]=g;i("consent",c,C)}else if(m==="get"){const[c,C,k]=g;i("get",c,C,k)}else if(m==="set"){const[c]=g;i("set",c)}else i(m,...g)}catch(c){uu.error(c)}}return h}function M4(i,e,t,a,h){let m=function(...g){window[a].push(arguments)};return window[h]&&typeof window[h]=="function"&&(m=window[h]),window[h]=P4(m,i,e,t),{gtagCore:m,wrappedGtag:window[h]}}function R4(i){const e=window.document.getElementsByTagName("script");for(const t of Object.values(e))if(t.src&&t.src.includes(mw)&&t.src.includes(i))return t;return null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const k4=30,L4=1e3;class D4{constructor(e={},t=L4){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}}const uC=new D4;function z4(i){return new Headers({Accept:"application/json","x-goog-api-key":i})}async function O4(i){var g;const{appId:e,apiKey:t}=i,a={method:"GET",headers:z4(t)},h=x4.replace("{app-id}",e),m=await fetch(h,a);if(m.status!==200&&m.status!==304){let c="";try{const C=await m.json();(g=C.error)!=null&&g.message&&(c=C.error.message)}catch{}throw Bu.create("config-fetch-failed",{httpStatus:m.status,responseMessage:c})}return m.json()}async function N4(i,e=uC,t){const{appId:a,apiKey:h,measurementId:m}=i.options;if(!a)throw Bu.create("no-app-id");if(!h){if(m)return{measurementId:m,appId:a};throw Bu.create("no-api-key")}const g=e.getThrottleMetadata(a)||{backoffCount:0,throttleEndTimeMillis:Date.now()},c=new V4;return setTimeout(async()=>{c.abort()},b4),cC({appId:a,apiKey:h,measurementId:m},g,c,e)}async function cC(i,{throttleEndTimeMillis:e,backoffCount:t},a,h=uC){var c;const{appId:m,measurementId:g}=i;try{await B4(a,e)}catch(C){if(g)return uu.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${g} provided in the "measurementId" field in the local Firebase config. [${C==null?void 0:C.message}]`),{appId:m,measurementId:g};throw C}try{const C=await O4(i);return h.deleteThrottleMetadata(m),C}catch(C){const k=C;if(!F4(k)){if(h.deleteThrottleMetadata(m),g)return uu.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${g} provided in the "measurementId" field in the local Firebase config. [${k==null?void 0:k.message}]`),{appId:m,measurementId:g};throw C}const V=Number((c=k==null?void 0:k.customData)==null?void 0:c.httpStatus)===503?h2(t,h.intervalMillis,k4):h2(t,h.intervalMillis),Z={throttleEndTimeMillis:Date.now()+V,backoffCount:t+1};return h.setThrottleMetadata(m,Z),uu.debug(`Calling attemptFetch again in ${V} millis`),cC(i,Z,a,h)}}function B4(i,e){return new Promise((t,a)=>{const h=Math.max(e-Date.now(),0),m=setTimeout(t,h);i.addEventListener(()=>{clearTimeout(m),a(Bu.create("fetch-throttle",{throttleEndTimeMillis:e}))})})}function F4(i){if(!(i instanceof lh)||!i.customData)return!1;const e=Number(i.customData.httpStatus);return e===429||e===500||e===503||e===504}class V4{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}async function U4(i,e,t,a,h){if(h&&h.global){i("event",t,a);return}else{const m=await e,g={...a,send_to:m};i("event",t,g)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function j4(){if(PE())try{await ME()}catch(i){return uu.warn(Bu.create("indexeddb-unavailable",{errorInfo:i==null?void 0:i.toString()}).message),!1}else return uu.warn(Bu.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;return!0}async function q4(i,e,t,a,h,m,g){const c=N4(i);c.then(Y=>{t[Y.measurementId]=Y.appId,i.options.measurementId&&Y.measurementId!==i.options.measurementId&&uu.warn(`The measurement ID in the local Firebase config (${i.options.measurementId}) does not match the measurement ID fetched from the server (${Y.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(Y=>uu.error(Y)),e.push(c);const C=j4().then(Y=>{if(Y)return a.getId()}),[k,V]=await Promise.all([c,C]);R4(m)||E4(m,k.measurementId),h("js",new Date);const Z=(g==null?void 0:g.config)??{};return Z[v4]="firebase",Z.update=!0,V!=null&&(Z[y4]=V),h("config",k.measurementId,Z),k.measurementId}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $4{constructor(e){this.app=e}_delete(){return delete N_[this.app.options.appId],Promise.resolve()}}let N_={},FT=[];const VT={};let ex="dataLayer",G4="gtag",UT,hC,jT=!1;function Z4(){const i=[];if(CE()&&i.push("This is a browser extension environment."),GR()||i.push("Cookies are not available."),i.length>0){const e=i.map((a,h)=>`(${h+1}) ${a}`).join(" "),t=Bu.create("invalid-analytics-context",{errorInfo:e});uu.warn(t.message)}}function H4(i,e,t){Z4();const a=i.options.appId;if(!a)throw Bu.create("no-app-id");if(!i.options.apiKey)if(i.options.measurementId)uu.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${i.options.measurementId} provided in the "measurementId" field in the local Firebase config.`);else throw Bu.create("no-api-key");if(N_[a]!=null)throw Bu.create("already-exists",{id:a});if(!jT){A4(ex);const{wrappedGtag:m,gtagCore:g}=M4(N_,FT,VT,ex,G4);hC=m,UT=g,jT=!0}return N_[a]=q4(i,FT,VT,e,UT,ex,t),new $4(i)}function W4(i=w1()){i=cu(i);const e=im(i,S0);return e.isInitialized()?e.getImmediate():X4(i)}function X4(i,e={}){const t=im(i,S0);if(t.isInitialized()){const h=t.getImmediate();if(Bf(e,t.getOptions()))return h;throw Bu.create("already-initialized")}return t.initialize({options:e})}function K4(i,e,t,a){i=cu(i),U4(hC,N_[i.app.options.appId],e,t,a).catch(h=>uu.error(h))}const qT="@firebase/analytics",$T="0.10.18";function Y4(){Jh(new sh(S0,(e,{options:t})=>{const a=e.getProvider("app").getImmediate(),h=e.getProvider("installations-internal").getImmediate();return H4(a,h,t)},"PUBLIC")),Jh(new sh("analytics-internal",i,"PRIVATE")),Tc(qT,$T),Tc(qT,$T,"esm2020");function i(e){try{const t=e.getProvider(S0).getImmediate();return{logEvent:(a,h,m)=>K4(t,a,h,m)}}catch(t){throw Bu.create("interop-component-reg-failed",{reason:t})}}}Y4();const Q4={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_FIREBASE_API_KEY:"AIzaSyC5EgMfrRpFh8_ZFyQ_ieF-YYD9xPrOaVU",VITE_FIREBASE_APP_ID:"1:1016256516850:web:5b902e0616dfc3c926766b",VITE_FIREBASE_AUTH_DOMAIN:"redreport-29023.firebaseapp.com",VITE_FIREBASE_MEASUREMENT_ID:"G-S4C6LSBB9G",VITE_FIREBASE_MESSAGING_SENDER_ID:"1016256516850",VITE_FIREBASE_PROJECT_ID:"redreport-29023",VITE_FIREBASE_STORAGE_BUCKET:"redreport-29023.firebasestorage.app",VITE_MAP_KEY:"0UGrg19TXtYRROinsJ9a"},J4={apiKey:"AIzaSyC5EgMfrRpFh8_ZFyQ_ieF-YYD9xPrOaVU",authDomain:"redreport-29023.firebaseapp.com",projectId:"redreport-29023",storageBucket:"redreport-29023.firebasestorage.app",messagingSenderId:"1016256516850",appId:"1:1016256516850:web:5b902e0616dfc3c926766b",measurementId:"G-S4C6LSBB9G"},eN=["VITE_FIREBASE_API_KEY","VITE_FIREBASE_AUTH_DOMAIN","VITE_FIREBASE_PROJECT_ID"];eN.forEach(i=>{if(!Q4[i])throw new Error(`Missing required environment variable: ${i}`)});const gw=DE(J4),dC=dz(gw);RO(gw);typeof window<"u"&&W4(gw);const fC=[{"Notre-Dame":{"Residence Halls":[{name:"Alumni Hall",latitude:41.6984,longitude:-86.2339,id:"alumni-hall",type:"Residence Halls",location:"Notre Dame"},{name:"Badin Hall",latitude:41.7006,longitude:-86.2412,id:"badin-hall",type:"Residence Halls",location:"Notre Dame"},{name:"Breen-Phillips Hall",latitude:41.70278,longitude:-86.24,id:"breen-phillips-hall",type:"Residence Halls",location:"Notre Dame"},{name:"Carroll Hall",latitude:41.70194,longitude:-86.24778,id:"carroll-hall",type:"Residence Halls",location:"Notre Dame"},{name:"Cavanaugh Hall",latitude:41.702807,longitude:-86.237164,id:"cavanaugh-hall",type:"Residence Halls",location:"Notre Dame"},{name:"Dillon Hall",latitude:41.6984,longitude:-86.2339,id:"dillon-hall",type:"Residence Halls",location:"Notre Dame"},{name:"Duncan Hall",latitude:41.6984,longitude:-86.2339,id:"duncan-hall",type:"Residence Halls",location:"Notre Dame"},{name:"Dunne Hall",latitude:41.6984,longitude:-86.2339,id:"dunne-hall",type:"Residence Halls",location:"Notre Dame"},{name:"Farley Hall",latitude:41.6984,longitude:-86.2339,id:"farley-hall",type:"Residence Halls",location:"Notre Dame"},{name:"Fisher Hall",latitude:41.6984,longitude:-86.2339,id:"fisher-hall",type:"Residence Halls",location:"Notre Dame"},{name:"Keenan Hall",latitude:41.703917,longitude:-86.237477,id:"keenan-hall",type:"Residence Halls",location:"Notre Dame"},{name:"Sacred Heart Parish Center",latitude:41.7068221,longitude:-86.2450146,id:"sacred-heart-parish-center",type:"Residence Halls",location:"Notre Dame"},{name:"Baumer Hall",latitude:41.697,longitude:-86.2414,id:"baumer-hall",type:"Residence Halls",location:"Notre Dame"},{name:"Fischer Graduate Residences",latitude:41.7051,longitude:-86.229,id:"fischer-graduate-residences",type:"Residence Halls",location:"Notre Dame"},{name:"Harper Hall",latitude:41.69928,longitude:-86.238899,id:"harper-hall",type:"Residence Halls",location:"Notre Dame"},{name:"Flaherty Hall",latitude:41.7035,longitude:-86.2328,id:"flaherty-hall",type:"Residence Halls",location:"Notre Dame"},{name:"Howard Hall",latitude:41.700833,longitude:-86.241667,id:"howard-hall",type:"Residence Halls",location:"Notre Dame"}],"Academic Buildings":[{name:"Hesburgh Library",latitude:41.702358,longitude:-86.234192,id:"hesburgh-library",type:"Academic Buildings",location:"Notre Dame"},{name:"Walsh Family Hall of Architecture",latitude:41.695,longitude:-86.235,id:"walsh-family-hall-of-architecture",type:"Academic Buildings",location:"Notre Dame"},{name:"Jordan Hall of Science",latitude:41.700278,longitude:-86.231667,id:"jordan-hall-of-science",type:"Academic Buildings",location:"Notre Dame"},{name:"DeBartolo Hall",latitude:41.69837393,longitude:-86.23622896,id:"debartolo-hall",type:"Academic Buildings",location:"Notre Dame"},{name:"Stayer Center for Executive Education",latitude:41.71048456,longitude:-86.2360535,id:"stayer-center-for-executive-education",type:"Academic Buildings",location:"Notre Dame"},{name:"O'Shaughnessy Hall",latitude:41.7003185,longitude:-86.2356855,id:"oshaughnessy-hall",type:"Academic Buildings",location:"Notre Dame"},{name:"Mendoza College of Business",latitude:41.6970083,longitude:-86.2346583,id:"mendoza-college-of-business",type:"Academic Buildings",location:"Notre Dame"},{name:"Raclin Murphy Museum of Art",latitude:41.693889,longitude:-86.235,id:"raclin-murphy-museum-of-art",type:"Academic Buildings",location:"Notre Dame"},{name:"Riley Hall of Art & Design",latitude:41.70083425,longitude:-86.23722792,id:"riley-hall-of-art-design",type:"Academic Buildings",location:"Notre Dame"},{name:"Spes Unica Hall",latitude:41.70632,longitude:-86.2570306,id:"spes-unica-hall",type:"Academic Buildings",location:"Notre Dame"},{name:"O'Neill Hall",latitude:41.69822114,longitude:-86.2319385,id:"oneill-hall",type:"Academic Buildings",location:"Notre Dame"},{name:"DeBartolo Performing Arts Center",latitude:41.696328,longitude:-86.23512,id:"debartolo-performing-arts-center",type:"Academic Buildings",location:"Notre Dame"},{name:"Nieuwland Science Hall",latitude:41.70153583,longitude:-86.2366288,id:"nieuwland-science-hall",type:"Academic Buildings",location:"Notre Dame"}],"Student Buildings":[{name:"LaFortune Student Center",latitude:41.7002,longitude:-86.2379,id:"lafortune-student-center",type:"Student Buildings",location:"Notre Dame"},{name:"LaFortune Food Court",latitude:41.7002,longitude:-86.2379,id:"lafortune-food-court",type:"Student Buildings",location:"Notre Dame"},{name:"Haggar Parlor",latitude:41.7002,longitude:-86.2379,id:"haggar-parlor",type:"Student Buildings",location:"Notre Dame"},{name:"Joyce Center",latitude:41.7002,longitude:-86.2379,id:"joyce-center",type:"Student Buildings",location:"Notre Dame"},{name:"Compton Family Ice Arena",latitude:41.7002,longitude:-86.2379,id:"compton-ice-arena",type:"Student Buildings",location:"Notre Dame"},{name:"Notre Dame Stadium",latitude:41.7002,longitude:-86.2379,id:"notre-dame-stadium",type:"Student Buildings",location:"Notre Dame"},{name:"Wellness Center",latitude:41.7002,longitude:-86.2379,id:"wellness-center",type:"Student Buildings",location:"Notre Dame"},{name:"Grotto of Our Lady of Lourdes",latitude:41.7002,longitude:-86.2379,id:"grotto",type:"Student Buildings",location:"Notre Dame"},{name:"Basilica of the Sacred Heart",latitude:41.7023,longitude:-86.239,id:"basilica-of-the-sacred-heart",type:"Student Buildings",location:"Notre Dame"}]},"Holy-Cross":{},"Saint-Marys":{}}],pC=["All",...Object.keys(fC[0])],tx=Object.values(fC[0]).flatMap(i=>Object.values(i)).flat(),GT=()=>{var Zt;const[i,e]=Tt.useState(1),[t,a]=Tt.useState({campus:"",location:"",specificLocation:"",offenseTypes:[],time:"",additionalInfo:""}),h=pC,[m,g]=Tt.useState(!1),[c,C]=Tt.useState(""),[k,V]=Tt.useState([]),[Z,Y]=Tt.useState(""),[Q,be]=Tt.useState([]),xe=Tt.useRef(null),ze=Tt.useRef(null),et=4;var[Qe,Xe]=Tt.useState(h["Notre-Dame"]);const Ke=xt=>{const{name:jt,value:Ie}=xt.target;if(console.log("Input Change ",jt,Ie),jt==="campus")Xe(h[Ie]),a(lt=>({...lt,[jt]:Ie,location:"",specificLocation:""})),be([]);else if(jt==="location"&&Qe){const lt=Qe[Ie];Array.isArray(lt)?be(lt.map(Dt=>Dt.name)):be((lt==null?void 0:lt.suggestions)||[]),a(Dt=>({...Dt,[jt]:Ie,specificLocation:""}))}else a(lt=>({...lt,[jt]:Ie}))},Ve=xt=>{const{value:jt,checked:Ie}=xt.target;a(lt=>({...lt,offenseTypes:Ie?[...lt.offenseTypes,jt]:lt.offenseTypes.filter(Dt=>Dt!==jt)}))},it=()=>{if(i===1){if(!t.location)return alert("Please select where you felt unsafe."),!1}else if(i===2){if(t.offenseTypes.length===0)return alert("Please select at least one type of offense."),!1}else if(i===3&&!t.time)return alert("Please select when this occurred."),!1;return!0},de=xt=>{if(xt>0&&!it())return;const jt=i+xt;jt>=1&&jt<=et&&e(jt)},ce=xt=>{xt.preventDefault(),it()&&(g(!0),setTimeout(()=>{const jt=gt();C(jt.toString()),e(5),g(!1)},2e3))},me=xt=>xt.replace(/-/g," ").replace(/\b\w/g,jt=>jt.toUpperCase()),Ee=xt=>xt.replace(/-/g," ").replace(/\b\w/g,jt=>jt.toUpperCase()),De=xt=>{const jt=xt.replace(/[^a-zA-Z0-9 ]/g,"").trim();if(!jt||!Q||Q.length===0)return[];const Ie=jt.toLowerCase();return Q.filter(Dt=>Dt.toLowerCase().replace(/[^a-z0-9]/g,"").includes(Ie.replace(/[^a-z0-9]/g,"")))},$e={"uncomfortable-situation":"Uncomfortable Situation","Sexual Misconduct":"Sexual Misconduct","physical-aggression":"Physical Aggression","verbal-aggression":"Verbal Aggression",discrimination:"Discrimination"},ke=()=>Pe.jsxs("div",{id:"report-summary",style:{background:"rgba(216, 47, 37, 0.05)",padding:"1.5rem",borderRadius:"10px",marginBottom:"2rem"},children:[Pe.jsxs("div",{style:{marginBottom:"1rem"},children:[Pe.jsx("strong",{children:"Campus:"})," ",me(t.campus),t.campus&&` (${t.campus})`]}),Pe.jsxs("div",{style:{marginBottom:"1rem"},children:[Pe.jsx("strong",{children:"Location:"})," ",me(t.location),t.specificLocation&&` (${t.specificLocation})`]}),Pe.jsxs("div",{style:{marginBottom:"1rem"},children:[Pe.jsx("strong",{children:"Incident Types:"})," ",t.offenseTypes.map(xt=>$e[xt]).join(", ")]}),Pe.jsxs("div",{style:{marginBottom:"1rem"},children:[Pe.jsx("strong",{children:"When:"})," ",Ee(t.time)]}),t.additionalInfo.trim()&&Pe.jsxs("div",{children:[Pe.jsx("strong",{children:"Additional Information:"})," ",t.additionalInfo.substring(0,200),t.additionalInfo.length>200?"...":""]})]}),Bn=xt=>{Ke(xt);const jt=xt.target.value.trim(),Ie=De(jt);if(V(Ie),Ie.length>0){const lt=Ie[0],Dt=jt.toLowerCase();lt.toLowerCase().startsWith(Dt)&&Dt.length>0?Y(lt.substring(jt.length)):Y("")}else Y("")},ti=xt=>{if(xt.key==="Enter"&&Z){xt.preventDefault();const Ie={target:{name:"specificLocation",value:t.specificLocation+Z}};Ke(Ie),Y(""),V([])}};async function gt(){return(await Rz(iI(dC,"reports"),{...t,Time:vT(),createdAt:vT()})).id}return Pe.jsxs(Pe.Fragment,{children:[Pe.jsx(vE,{}),Pe.jsx("div",{children:Pe.jsxs("div",{className:"report-container",children:[Pe.jsxs("div",{className:"report-header",children:[Pe.jsxs("h1",{children:["Anonymous ",Pe.jsx("span",{className:"highlight",children:"Report"})]}),Pe.jsx("p",{children:"Your voice matters. Share your experience in a safe, secure environment where your identity remains completely protected."})]}),Pe.jsxs("div",{className:"security-notice",children:[Pe.jsx("h3",{children:"Your Privacy is Protected"}),Pe.jsx("p",{children:"This form uses advanced encryption and anonymization techniques. No identifying information is collected or stored."})]}),Pe.jsxs("div",{className:"report-form",children:[Pe.jsxs("div",{className:"form-progress",children:[Pe.jsxs("div",{className:`progress-step ${i===1?"active":""}`,children:[Pe.jsx("div",{className:"step-circle",children:"1"}),Pe.jsx("span",{children:"Location"})]}),Pe.jsxs("div",{className:`progress-step ${i===2?"active":""}`,children:[Pe.jsx("div",{className:"step-circle",children:"2"}),Pe.jsx("span",{children:"Incident"})]}),Pe.jsxs("div",{className:`progress-step ${i===3?"active":""}`,children:[Pe.jsx("div",{className:"step-circle",children:"3"}),Pe.jsx("span",{children:"Details"})]}),Pe.jsxs("div",{className:`progress-step ${i===4?"active":""}`,children:[Pe.jsx("div",{className:"step-circle",children:"4"}),Pe.jsx("span",{children:"Submit"})]})]}),Pe.jsxs("form",{onSubmit:ce,children:[Pe.jsxs("div",{className:`form-section ${i===1?"active":""}`,children:[Pe.jsxs("div",{className:"form-group",children:[Pe.jsx("label",{htmlFor:"campus",children:"Where did you feel unsafe? *"}),Pe.jsx("div",{className:"label-description",children:"Select the location where the incident occurred"}),Pe.jsxs("select",{id:"campus",name:"campus",value:t.campus,onChange:Ke,required:!0,children:[Pe.jsx("option",{value:"",children:"Choose a campus"}),Pe.jsx("option",{value:"Notre-Dame",children:"Notre Dame"}),Pe.jsx("option",{value:"Saint-Marys",children:"Saint Mary's College"}),Pe.jsx("option",{value:"Holy-Cross",children:"Holy Cross College"})]})]}),Pe.jsxs("div",{className:"form-group",children:[Pe.jsx("label",{htmlFor:"location",children:"Where did you feel unsafe? *"}),Pe.jsx("div",{className:"label-description",children:"Select the location where the incident occurred"}),Pe.jsxs("select",{id:"location",name:"location",value:t.location,onChange:Ke,required:!0,children:[Pe.jsx("option",{value:"",children:"Choose a location"}),Qe&&Object.keys(Qe).length>0?Object.keys(Qe).map(xt=>Pe.jsx("option",{value:xt,children:xt.replace(/-/g," ").replace(/\b\w/g,jt=>jt.toUpperCase())},xt)):null]})]}),Pe.jsxs("div",{className:"form-group",children:[Pe.jsx("label",{htmlFor:"specificLocation",children:"Specific Location (Optional)"}),Pe.jsx("div",{className:"label-description",children:"Provide more details if comfortable (building name, room, etc.)"}),Pe.jsxs("div",{style:{position:"relative"},children:[Pe.jsx("span",{ref:xe,"aria-hidden":"true",style:{position:"absolute",visibility:"hidden",whiteSpace:"pre",fontSize:"inherit",fontFamily:"inherit",letterSpacing:"inherit",padding:"8px",border:"0"},children:t.specificLocation}),Pe.jsx("input",{ref:ze,type:"text",id:"specificLocation",name:"specificLocation",value:t.specificLocation,onChange:Bn,onKeyDown:ti,placeholder:"e.g., Main Library, 2nd floor",style:{background:"transparent",width:"100%",padding:"8px"},autoComplete:"off"}),Z&&Pe.jsx("div",{style:{position:"absolute",left:`${(((Zt=xe.current)==null?void 0:Zt.offsetWidth)||0)+8}px`,top:"50%",transform:"translateY(-50%)",opacity:.45,color:"#666",pointerEvents:"none",whiteSpace:"pre",fontFamily:"inherit",fontSize:"inherit",letterSpacing:"inherit"},children:Z})]})]})]}),Pe.jsx("div",{className:`form-section ${i===2?"active":""}`,children:Pe.jsxs("div",{className:"form-group",children:[Pe.jsx("label",{children:"What type of offense would you group it as? *"}),Pe.jsx("div",{className:"label-description",children:"Select all that apply to your experience"}),Pe.jsxs("div",{className:"checkbox-group",children:[Pe.jsxs("label",{className:"checkbox-item",children:[Pe.jsx("input",{type:"checkbox",name:"offense-type",value:"uncomfortable-situation",checked:t.offenseTypes.includes("uncomfortable-situation"),onChange:Ve}),Pe.jsxs("div",{className:"checkbox-content",children:[Pe.jsx("strong",{children:"Uncomfortable Situation"}),Pe.jsx("small",{children:"Situations that made you feel uneasy or uncomfortable"})]})]}),Pe.jsxs("label",{className:"checkbox-item",children:[Pe.jsx("input",{type:"checkbox",name:"offense-type",value:"Sexual Misconduct",checked:t.offenseTypes.includes("Sexual Misconduct"),onChange:Ve}),Pe.jsxs("div",{className:"checkbox-content",children:[Pe.jsx("strong",{children:"Unconsented Contact"}),Pe.jsx("small",{children:"Physical contact without permission"})]})]}),Pe.jsxs("label",{className:"checkbox-item",children:[Pe.jsx("input",{type:"checkbox",name:"offense-type",value:"physical-aggression",checked:t.offenseTypes.includes("physical-aggression"),onChange:Ve}),Pe.jsxs("div",{className:"checkbox-content",children:[Pe.jsx("strong",{children:"Physical Aggression"}),Pe.jsx("small",{children:"Physical violence or threat of violence"})]})]}),Pe.jsxs("label",{className:"checkbox-item",children:[Pe.jsx("input",{type:"checkbox",name:"offense-type",value:"verbal-aggression",checked:t.offenseTypes.includes("verbal-aggression"),onChange:Ve}),Pe.jsxs("div",{className:"checkbox-content",children:[Pe.jsx("strong",{children:"Verbal Aggression"}),Pe.jsx("small",{children:"Threatening, hostile, or abusive language"})]})]}),Pe.jsxs("label",{className:"checkbox-item",children:[Pe.jsx("input",{type:"checkbox",name:"offense-type",value:"discrimination",checked:t.offenseTypes.includes("discrimination"),onChange:Ve}),Pe.jsxs("div",{className:"checkbox-content",children:[Pe.jsx("strong",{children:"Discrimination"}),Pe.jsx("small",{children:"Treatment based on identity, race, gender, religion, etc."})]})]})]})]})}),Pe.jsxs("div",{className:`form-section ${i===3?"active":""}`,children:[Pe.jsxs("div",{className:"form-group",children:[Pe.jsx("label",{htmlFor:"time",children:"When did this occur? *"}),Pe.jsxs("select",{id:"time",name:"time",value:t.time,onChange:Ke,required:!0,children:[Pe.jsx("option",{value:"",children:"Select timeframe"}),Pe.jsx("option",{value:"within-24-hours",children:"Within the last 24 hours"}),Pe.jsx("option",{value:"within-week",children:"Within the last week"}),Pe.jsx("option",{value:"within-month",children:"Within the last month"}),Pe.jsx("option",{value:"within-semester",children:"Within this semester"}),Pe.jsx("option",{value:"longer-ago",children:"Longer ago"})]})]}),Pe.jsxs("div",{className:"form-group",children:[Pe.jsx("label",{htmlFor:"additionalInfo",children:"Additional Information (Optional)"}),Pe.jsx("div",{className:"label-description",children:"Anything else you'd like to share"}),Pe.jsx("textarea",{id:"additionalInfo",name:"additionalInfo",value:t.additionalInfo,onChange:Ke,placeholder:"Any additional context, concerns, or information you'd like to provide"})]})]}),Pe.jsx("div",{className:`form-section ${i===4?"active":""}`,children:Pe.jsxs("div",{id:"review-content",children:[Pe.jsx("h3",{style:{color:"#113052",marginBottom:"1rem"},children:"Review Your Report"}),Pe.jsx("p",{style:{marginBottom:"2rem",opacity:.8},children:"Please review the information below before submitting your anonymous report."}),ke(),Pe.jsxs("div",{className:"security-notice",style:{marginBottom:0},children:[Pe.jsx("h3",{children:"Final Privacy Reminder"}),Pe.jsx("p",{children:"Once submitted, this report cannot be traced back to you. Your anonymity is guaranteed."})]})]})}),i===5&&Pe.jsxs("div",{className:"success-message",children:[Pe.jsx("div",{className:"success-icon",children:""}),Pe.jsx("h2",{children:"Report Submitted Successfully"}),Pe.jsx("p",{children:"Thank you for sharing your experience. Your voice contributes to making our campus community safer for everyone."}),Pe.jsxs("p",{children:[Pe.jsx("strong",{children:"Report ID:"})," ",c]}),Pe.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>window.close(),children:"Return to Home"})]}),i<5&&Pe.jsxs("div",{className:"form-navigation",children:[Pe.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>de(-1),style:{display:i>1?"block":"none"},children:"Previous"}),i<4&&Pe.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>de(1),children:"Next"}),i===4&&Pe.jsxs("button",{type:"submit",className:"btn btn-primary",disabled:m,children:[!m&&Pe.jsx("span",{children:"Submit Anonymous Report"}),m&&Pe.jsxs("span",{children:[Pe.jsx("span",{className:"loading"}),"Submitting..."]})]})]})]})]})]})})]})};var E_={exports:{}};/* @preserve
 * Leaflet 1.9.4, a JS library for interactive maps. https://leafletjs.com
 * (c) 2010-2023 Vladimir Agafonkin, (c) 2010-2011 CloudMade
 */var tN=E_.exports,ZT;function nN(){return ZT||(ZT=1,(function(i,e){(function(t,a){a(e)})(tN,(function(t){var a="1.9.4";function h(f){var x,R,U,K;for(R=1,U=arguments.length;R<U;R++){K=arguments[R];for(x in K)f[x]=K[x]}return f}var m=Object.create||(function(){function f(){}return function(x){return f.prototype=x,new f}})();function g(f,x){var R=Array.prototype.slice;if(f.bind)return f.bind.apply(f,R.call(arguments,1));var U=R.call(arguments,2);return function(){return f.apply(x,U.length?U.concat(R.call(arguments)):arguments)}}var c=0;function C(f){return"_leaflet_id"in f||(f._leaflet_id=++c),f._leaflet_id}function k(f,x,R){var U,K,ue,Oe;return Oe=function(){U=!1,K&&(ue.apply(R,K),K=!1)},ue=function(){U?K=arguments:(f.apply(R,arguments),setTimeout(Oe,x),U=!0)},ue}function V(f,x,R){var U=x[1],K=x[0],ue=U-K;return f===U&&R?f:((f-K)%ue+ue)%ue+K}function Z(){return!1}function Y(f,x){if(x===!1)return f;var R=Math.pow(10,x===void 0?6:x);return Math.round(f*R)/R}function Q(f){return f.trim?f.trim():f.replace(/^\s+|\s+$/g,"")}function be(f){return Q(f).split(/\s+/)}function xe(f,x){Object.prototype.hasOwnProperty.call(f,"options")||(f.options=f.options?m(f.options):{});for(var R in x)f.options[R]=x[R];return f.options}function ze(f,x,R){var U=[];for(var K in f)U.push(encodeURIComponent(R?K.toUpperCase():K)+"="+encodeURIComponent(f[K]));return(!x||x.indexOf("?")===-1?"?":"&")+U.join("&")}var et=/\{ *([\w_ -]+) *\}/g;function Qe(f,x){return f.replace(et,function(R,U){var K=x[U];if(K===void 0)throw new Error("No value provided for variable "+R);return typeof K=="function"&&(K=K(x)),K})}var Xe=Array.isArray||function(f){return Object.prototype.toString.call(f)==="[object Array]"};function Ke(f,x){for(var R=0;R<f.length;R++)if(f[R]===x)return R;return-1}var Ve="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function it(f){return window["webkit"+f]||window["moz"+f]||window["ms"+f]}var de=0;function ce(f){var x=+new Date,R=Math.max(0,16-(x-de));return de=x+R,window.setTimeout(f,R)}var me=window.requestAnimationFrame||it("RequestAnimationFrame")||ce,Ee=window.cancelAnimationFrame||it("CancelAnimationFrame")||it("CancelRequestAnimationFrame")||function(f){window.clearTimeout(f)};function De(f,x,R){if(R&&me===ce)f.call(x);else return me.call(window,g(f,x))}function $e(f){f&&Ee.call(window,f)}var ke={__proto__:null,extend:h,create:m,bind:g,get lastId(){return c},stamp:C,throttle:k,wrapNum:V,falseFn:Z,formatNum:Y,trim:Q,splitWords:be,setOptions:xe,getParamString:ze,template:Qe,isArray:Xe,indexOf:Ke,emptyImageUrl:Ve,requestFn:me,cancelFn:Ee,requestAnimFrame:De,cancelAnimFrame:$e};function Bn(){}Bn.extend=function(f){var x=function(){xe(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},R=x.__super__=this.prototype,U=m(R);U.constructor=x,x.prototype=U;for(var K in this)Object.prototype.hasOwnProperty.call(this,K)&&K!=="prototype"&&K!=="__super__"&&(x[K]=this[K]);return f.statics&&h(x,f.statics),f.includes&&(ti(f.includes),h.apply(null,[U].concat(f.includes))),h(U,f),delete U.statics,delete U.includes,U.options&&(U.options=R.options?m(R.options):{},h(U.options,f.options)),U._initHooks=[],U.callInitHooks=function(){if(!this._initHooksCalled){R.callInitHooks&&R.callInitHooks.call(this),this._initHooksCalled=!0;for(var ue=0,Oe=U._initHooks.length;ue<Oe;ue++)U._initHooks[ue].call(this)}},x},Bn.include=function(f){var x=this.prototype.options;return h(this.prototype,f),f.options&&(this.prototype.options=x,this.mergeOptions(f.options)),this},Bn.mergeOptions=function(f){return h(this.prototype.options,f),this},Bn.addInitHook=function(f){var x=Array.prototype.slice.call(arguments,1),R=typeof f=="function"?f:function(){this[f].apply(this,x)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(R),this};function ti(f){if(!(typeof L>"u"||!L||!L.Mixin)){f=Xe(f)?f:[f];for(var x=0;x<f.length;x++)f[x]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",new Error().stack)}}var gt={on:function(f,x,R){if(typeof f=="object")for(var U in f)this._on(U,f[U],x);else{f=be(f);for(var K=0,ue=f.length;K<ue;K++)this._on(f[K],x,R)}return this},off:function(f,x,R){if(!arguments.length)delete this._events;else if(typeof f=="object")for(var U in f)this._off(U,f[U],x);else{f=be(f);for(var K=arguments.length===1,ue=0,Oe=f.length;ue<Oe;ue++)K?this._off(f[ue]):this._off(f[ue],x,R)}return this},_on:function(f,x,R,U){if(typeof x!="function"){console.warn("wrong listener type: "+typeof x);return}if(this._listens(f,x,R)===!1){R===this&&(R=void 0);var K={fn:x,ctx:R};U&&(K.once=!0),this._events=this._events||{},this._events[f]=this._events[f]||[],this._events[f].push(K)}},_off:function(f,x,R){var U,K,ue;if(this._events&&(U=this._events[f],!!U)){if(arguments.length===1){if(this._firingCount)for(K=0,ue=U.length;K<ue;K++)U[K].fn=Z;delete this._events[f];return}if(typeof x!="function"){console.warn("wrong listener type: "+typeof x);return}var Oe=this._listens(f,x,R);if(Oe!==!1){var nt=U[Oe];this._firingCount&&(nt.fn=Z,this._events[f]=U=U.slice()),U.splice(Oe,1)}}},fire:function(f,x,R){if(!this.listens(f,R))return this;var U=h({},x,{type:f,target:this,sourceTarget:x&&x.sourceTarget||this});if(this._events){var K=this._events[f];if(K){this._firingCount=this._firingCount+1||1;for(var ue=0,Oe=K.length;ue<Oe;ue++){var nt=K[ue],mt=nt.fn;nt.once&&this.off(f,mt,nt.ctx),mt.call(nt.ctx||this,U)}this._firingCount--}}return R&&this._propagateEvent(U),this},listens:function(f,x,R,U){typeof f!="string"&&console.warn('"string" type argument expected');var K=x;typeof x!="function"&&(U=!!x,K=void 0,R=void 0);var ue=this._events&&this._events[f];if(ue&&ue.length&&this._listens(f,K,R)!==!1)return!0;if(U){for(var Oe in this._eventParents)if(this._eventParents[Oe].listens(f,x,R,U))return!0}return!1},_listens:function(f,x,R){if(!this._events)return!1;var U=this._events[f]||[];if(!x)return!!U.length;R===this&&(R=void 0);for(var K=0,ue=U.length;K<ue;K++)if(U[K].fn===x&&U[K].ctx===R)return K;return!1},once:function(f,x,R){if(typeof f=="object")for(var U in f)this._on(U,f[U],x,!0);else{f=be(f);for(var K=0,ue=f.length;K<ue;K++)this._on(f[K],x,R,!0)}return this},addEventParent:function(f){return this._eventParents=this._eventParents||{},this._eventParents[C(f)]=f,this},removeEventParent:function(f){return this._eventParents&&delete this._eventParents[C(f)],this},_propagateEvent:function(f){for(var x in this._eventParents)this._eventParents[x].fire(f.type,h({layer:f.target,propagatedFrom:f.target},f),!0)}};gt.addEventListener=gt.on,gt.removeEventListener=gt.clearAllEventListeners=gt.off,gt.addOneTimeEventListener=gt.once,gt.fireEvent=gt.fire,gt.hasEventListeners=gt.listens;var Zt=Bn.extend(gt);function xt(f,x,R){this.x=R?Math.round(f):f,this.y=R?Math.round(x):x}var jt=Math.trunc||function(f){return f>0?Math.floor(f):Math.ceil(f)};xt.prototype={clone:function(){return new xt(this.x,this.y)},add:function(f){return this.clone()._add(Ie(f))},_add:function(f){return this.x+=f.x,this.y+=f.y,this},subtract:function(f){return this.clone()._subtract(Ie(f))},_subtract:function(f){return this.x-=f.x,this.y-=f.y,this},divideBy:function(f){return this.clone()._divideBy(f)},_divideBy:function(f){return this.x/=f,this.y/=f,this},multiplyBy:function(f){return this.clone()._multiplyBy(f)},_multiplyBy:function(f){return this.x*=f,this.y*=f,this},scaleBy:function(f){return new xt(this.x*f.x,this.y*f.y)},unscaleBy:function(f){return new xt(this.x/f.x,this.y/f.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=jt(this.x),this.y=jt(this.y),this},distanceTo:function(f){f=Ie(f);var x=f.x-this.x,R=f.y-this.y;return Math.sqrt(x*x+R*R)},equals:function(f){return f=Ie(f),f.x===this.x&&f.y===this.y},contains:function(f){return f=Ie(f),Math.abs(f.x)<=Math.abs(this.x)&&Math.abs(f.y)<=Math.abs(this.y)},toString:function(){return"Point("+Y(this.x)+", "+Y(this.y)+")"}};function Ie(f,x,R){return f instanceof xt?f:Xe(f)?new xt(f[0],f[1]):f==null?f:typeof f=="object"&&"x"in f&&"y"in f?new xt(f.x,f.y):new xt(f,x,R)}function lt(f,x){if(f)for(var R=x?[f,x]:f,U=0,K=R.length;U<K;U++)this.extend(R[U])}lt.prototype={extend:function(f){var x,R;if(!f)return this;if(f instanceof xt||typeof f[0]=="number"||"x"in f)x=R=Ie(f);else if(f=Dt(f),x=f.min,R=f.max,!x||!R)return this;return!this.min&&!this.max?(this.min=x.clone(),this.max=R.clone()):(this.min.x=Math.min(x.x,this.min.x),this.max.x=Math.max(R.x,this.max.x),this.min.y=Math.min(x.y,this.min.y),this.max.y=Math.max(R.y,this.max.y)),this},getCenter:function(f){return Ie((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,f)},getBottomLeft:function(){return Ie(this.min.x,this.max.y)},getTopRight:function(){return Ie(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(f){var x,R;return typeof f[0]=="number"||f instanceof xt?f=Ie(f):f=Dt(f),f instanceof lt?(x=f.min,R=f.max):x=R=f,x.x>=this.min.x&&R.x<=this.max.x&&x.y>=this.min.y&&R.y<=this.max.y},intersects:function(f){f=Dt(f);var x=this.min,R=this.max,U=f.min,K=f.max,ue=K.x>=x.x&&U.x<=R.x,Oe=K.y>=x.y&&U.y<=R.y;return ue&&Oe},overlaps:function(f){f=Dt(f);var x=this.min,R=this.max,U=f.min,K=f.max,ue=K.x>x.x&&U.x<R.x,Oe=K.y>x.y&&U.y<R.y;return ue&&Oe},isValid:function(){return!!(this.min&&this.max)},pad:function(f){var x=this.min,R=this.max,U=Math.abs(x.x-R.x)*f,K=Math.abs(x.y-R.y)*f;return Dt(Ie(x.x-U,x.y-K),Ie(R.x+U,R.y+K))},equals:function(f){return f?(f=Dt(f),this.min.equals(f.getTopLeft())&&this.max.equals(f.getBottomRight())):!1}};function Dt(f,x){return!f||f instanceof lt?f:new lt(f,x)}function zt(f,x){if(f)for(var R=x?[f,x]:f,U=0,K=R.length;U<K;U++)this.extend(R[U])}zt.prototype={extend:function(f){var x=this._southWest,R=this._northEast,U,K;if(f instanceof an)U=f,K=f;else if(f instanceof zt){if(U=f._southWest,K=f._northEast,!U||!K)return this}else return f?this.extend(Ft(f)||Xt(f)):this;return!x&&!R?(this._southWest=new an(U.lat,U.lng),this._northEast=new an(K.lat,K.lng)):(x.lat=Math.min(U.lat,x.lat),x.lng=Math.min(U.lng,x.lng),R.lat=Math.max(K.lat,R.lat),R.lng=Math.max(K.lng,R.lng)),this},pad:function(f){var x=this._southWest,R=this._northEast,U=Math.abs(x.lat-R.lat)*f,K=Math.abs(x.lng-R.lng)*f;return new zt(new an(x.lat-U,x.lng-K),new an(R.lat+U,R.lng+K))},getCenter:function(){return new an((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new an(this.getNorth(),this.getWest())},getSouthEast:function(){return new an(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(f){typeof f[0]=="number"||f instanceof an||"lat"in f?f=Ft(f):f=Xt(f);var x=this._southWest,R=this._northEast,U,K;return f instanceof zt?(U=f.getSouthWest(),K=f.getNorthEast()):U=K=f,U.lat>=x.lat&&K.lat<=R.lat&&U.lng>=x.lng&&K.lng<=R.lng},intersects:function(f){f=Xt(f);var x=this._southWest,R=this._northEast,U=f.getSouthWest(),K=f.getNorthEast(),ue=K.lat>=x.lat&&U.lat<=R.lat,Oe=K.lng>=x.lng&&U.lng<=R.lng;return ue&&Oe},overlaps:function(f){f=Xt(f);var x=this._southWest,R=this._northEast,U=f.getSouthWest(),K=f.getNorthEast(),ue=K.lat>x.lat&&U.lat<R.lat,Oe=K.lng>x.lng&&U.lng<R.lng;return ue&&Oe},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(f,x){return f?(f=Xt(f),this._southWest.equals(f.getSouthWest(),x)&&this._northEast.equals(f.getNorthEast(),x)):!1},isValid:function(){return!!(this._southWest&&this._northEast)}};function Xt(f,x){return f instanceof zt?f:new zt(f,x)}function an(f,x,R){if(isNaN(f)||isNaN(x))throw new Error("Invalid LatLng object: ("+f+", "+x+")");this.lat=+f,this.lng=+x,R!==void 0&&(this.alt=+R)}an.prototype={equals:function(f,x){if(!f)return!1;f=Ft(f);var R=Math.max(Math.abs(this.lat-f.lat),Math.abs(this.lng-f.lng));return R<=(x===void 0?1e-9:x)},toString:function(f){return"LatLng("+Y(this.lat,f)+", "+Y(this.lng,f)+")"},distanceTo:function(f){return qn.distance(this,Ft(f))},wrap:function(){return qn.wrapLatLng(this)},toBounds:function(f){var x=180*f/40075017,R=x/Math.cos(Math.PI/180*this.lat);return Xt([this.lat-x,this.lng-R],[this.lat+x,this.lng+R])},clone:function(){return new an(this.lat,this.lng,this.alt)}};function Ft(f,x,R){return f instanceof an?f:Xe(f)&&typeof f[0]!="object"?f.length===3?new an(f[0],f[1],f[2]):f.length===2?new an(f[0],f[1]):null:f==null?f:typeof f=="object"&&"lat"in f?new an(f.lat,"lng"in f?f.lng:f.lon,f.alt):x===void 0?null:new an(f,x,R)}var Ci={latLngToPoint:function(f,x){var R=this.projection.project(f),U=this.scale(x);return this.transformation._transform(R,U)},pointToLatLng:function(f,x){var R=this.scale(x),U=this.transformation.untransform(f,R);return this.projection.unproject(U)},project:function(f){return this.projection.project(f)},unproject:function(f){return this.projection.unproject(f)},scale:function(f){return 256*Math.pow(2,f)},zoom:function(f){return Math.log(f/256)/Math.LN2},getProjectedBounds:function(f){if(this.infinite)return null;var x=this.projection.bounds,R=this.scale(f),U=this.transformation.transform(x.min,R),K=this.transformation.transform(x.max,R);return new lt(U,K)},infinite:!1,wrapLatLng:function(f){var x=this.wrapLng?V(f.lng,this.wrapLng,!0):f.lng,R=this.wrapLat?V(f.lat,this.wrapLat,!0):f.lat,U=f.alt;return new an(R,x,U)},wrapLatLngBounds:function(f){var x=f.getCenter(),R=this.wrapLatLng(x),U=x.lat-R.lat,K=x.lng-R.lng;if(U===0&&K===0)return f;var ue=f.getSouthWest(),Oe=f.getNorthEast(),nt=new an(ue.lat-U,ue.lng-K),mt=new an(Oe.lat-U,Oe.lng-K);return new zt(nt,mt)}},qn=h({},Ci,{wrapLng:[-180,180],R:6371e3,distance:function(f,x){var R=Math.PI/180,U=f.lat*R,K=x.lat*R,ue=Math.sin((x.lat-f.lat)*R/2),Oe=Math.sin((x.lng-f.lng)*R/2),nt=ue*ue+Math.cos(U)*Math.cos(K)*Oe*Oe,mt=2*Math.atan2(Math.sqrt(nt),Math.sqrt(1-nt));return this.R*mt}}),zr=6378137,co={R:zr,MAX_LATITUDE:85.0511287798,project:function(f){var x=Math.PI/180,R=this.MAX_LATITUDE,U=Math.max(Math.min(R,f.lat),-R),K=Math.sin(U*x);return new xt(this.R*f.lng*x,this.R*Math.log((1+K)/(1-K))/2)},unproject:function(f){var x=180/Math.PI;return new an((2*Math.atan(Math.exp(f.y/this.R))-Math.PI/2)*x,f.x*x/this.R)},bounds:(function(){var f=zr*Math.PI;return new lt([-f,-f],[f,f])})()};function Us(f,x,R,U){if(Xe(f)){this._a=f[0],this._b=f[1],this._c=f[2],this._d=f[3];return}this._a=f,this._b=x,this._c=R,this._d=U}Us.prototype={transform:function(f,x){return this._transform(f.clone(),x)},_transform:function(f,x){return x=x||1,f.x=x*(this._a*f.x+this._b),f.y=x*(this._c*f.y+this._d),f},untransform:function(f,x){return x=x||1,new xt((f.x/x-this._b)/this._a,(f.y/x-this._d)/this._c)}};function Or(f,x,R,U){return new Us(f,x,R,U)}var Pi=h({},qn,{code:"EPSG:3857",projection:co,transformation:(function(){var f=.5/(Math.PI*co.R);return Or(f,.5,-f,.5)})()}),er=h({},Pi,{code:"EPSG:900913"});function ds(f){return document.createElementNS("http://www.w3.org/2000/svg",f)}function Xa(f,x){var R="",U,K,ue,Oe,nt,mt;for(U=0,ue=f.length;U<ue;U++){for(nt=f[U],K=0,Oe=nt.length;K<Oe;K++)mt=nt[K],R+=(K?"L":"M")+mt.x+" "+mt.y;R+=x?Qt.svg?"z":"x":""}return R||"M0 0"}var Nr=document.documentElement.style,Ba="ActiveXObject"in window,Fi=Ba&&!document.addEventListener,fr="msLaunchUri"in navigator&&!("documentMode"in document),fa=Ct("webkit"),Po=Ct("android"),js=Ct("android 2")||Ct("android 3"),Tl=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),fs=Po&&Ct("Google")&&Tl<537&&!("AudioNode"in window),Ta=!!window.opera,pr=!fr&&Ct("chrome"),pa=Ct("gecko")&&!fa&&!Ta&&!Ba,je=!pr&&Ct("safari"),se=Ct("phantom"),le="OTransition"in Nr,fe=navigator.platform.indexOf("Win")===0,Se=Ba&&"transition"in Nr,Ne="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!js,Ge="MozPerspective"in Nr,Je=!window.L_DISABLE_3D&&(Se||Ne||Ge)&&!le&&!se,Ze=typeof orientation<"u"||Ct("mobile"),yt=Ze&&fa,At=Ze&&Ne,bt=!window.PointerEvent&&window.MSPointerEvent,en=!!(window.PointerEvent||bt),qe="ontouchstart"in window||!!window.TouchEvent,Cn=!window.L_NO_TOUCH&&(qe||en),Fn=Ze&&Ta,rn=Ze&&pa,Dn=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,wi=(function(){var f=!1;try{var x=Object.defineProperty({},"passive",{get:function(){f=!0}});window.addEventListener("testPassiveEventSupport",Z,x),window.removeEventListener("testPassiveEventSupport",Z,x)}catch{}return f})(),Xi=(function(){return!!document.createElement("canvas").getContext})(),Er=!!(document.createElementNS&&ds("svg").createSVGRect),Mi=!!Er&&(function(){var f=document.createElement("div");return f.innerHTML="<svg/>",(f.firstChild&&f.firstChild.namespaceURI)==="http://www.w3.org/2000/svg"})(),vn=!Er&&(function(){try{var f=document.createElement("div");f.innerHTML='<v:shape adj="1"/>';var x=f.firstChild;return x.style.behavior="url(#default#VML)",x&&typeof x.adj=="object"}catch{return!1}})(),Pn=navigator.platform.indexOf("Mac")===0,Vi=navigator.platform.indexOf("Linux")===0;function Ct(f){return navigator.userAgent.toLowerCase().indexOf(f)>=0}var Qt={ie:Ba,ielt9:Fi,edge:fr,webkit:fa,android:Po,android23:js,androidStock:fs,opera:Ta,chrome:pr,gecko:pa,safari:je,phantom:se,opera12:le,win:fe,ie3d:Se,webkit3d:Ne,gecko3d:Ge,any3d:Je,mobile:Ze,mobileWebkit:yt,mobileWebkit3d:At,msPointer:bt,pointer:en,touch:Cn,touchNative:qe,mobileOpera:Fn,mobileGecko:rn,retina:Dn,passiveEvents:wi,canvas:Xi,svg:Er,vml:vn,inlineSvg:Mi,mac:Pn,linux:Vi},tr=Qt.msPointer?"MSPointerDown":"pointerdown",la=Qt.msPointer?"MSPointerMove":"pointermove",ps=Qt.msPointer?"MSPointerUp":"pointerup",Vt=Qt.msPointer?"MSPointerCancel":"pointercancel",Rn={touchstart:tr,touchmove:la,touchend:ps,touchcancel:Vt},In={touchstart:Ki,touchmove:ma,touchend:ma,touchcancel:ma},zi={},Ka=!1;function Ui(f,x,R){return x==="touchstart"&&Fa(),In[x]?(R=In[x].bind(this,R),f.addEventListener(Rn[x],R,!1),R):(console.warn("wrong event specified:",x),Z)}function Vn(f,x,R){if(!Rn[x]){console.warn("wrong event specified:",x);return}f.removeEventListener(Rn[x],R,!1)}function $o(f){zi[f.pointerId]=f}function Sa(f){zi[f.pointerId]&&(zi[f.pointerId]=f)}function ms(f){delete zi[f.pointerId]}function Fa(){Ka||(document.addEventListener(tr,$o,!0),document.addEventListener(la,Sa,!0),document.addEventListener(ps,ms,!0),document.addEventListener(Vt,ms,!0),Ka=!0)}function ma(f,x){if(x.pointerType!==(x.MSPOINTER_TYPE_MOUSE||"mouse")){x.touches=[];for(var R in zi)x.touches.push(zi[R]);x.changedTouches=[x],f(x)}}function Ki(f,x){x.MSPOINTER_TYPE_TOUCH&&x.pointerType===x.MSPOINTER_TYPE_TOUCH&&sn(x),ma(f,x)}function Vu(f){var x={},R,U;for(U in f)R=f[U],x[U]=R&&R.bind?R.bind(f):R;return f=x,x.type="dblclick",x.detail=2,x.isTrusted=!1,x._simulated=!0,x}var Wr=200;function fi(f,x){f.addEventListener("dblclick",x);var R=0,U;function K(ue){if(ue.detail!==1){U=ue.detail;return}if(!(ue.pointerType==="mouse"||ue.sourceCapabilities&&!ue.sourceCapabilities.firesTouchEvents)){var Oe=Jn(ue);if(!(Oe.some(function(mt){return mt instanceof HTMLLabelElement&&mt.attributes.for})&&!Oe.some(function(mt){return mt instanceof HTMLInputElement||mt instanceof HTMLSelectElement}))){var nt=Date.now();nt-R<=Wr?(U++,U===2&&x(Vu(ue))):U=1,R=nt}}}return f.addEventListener("click",K),{dblclick:x,simDblclick:K}}function qs(f,x){f.removeEventListener("dblclick",x.dblclick),f.removeEventListener("click",x.simDblclick)}var $s=Ho(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),ho=Ho(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),Ea=ho==="webkitTransition"||ho==="OTransition"?ho+"End":"transitionend";function gs(f){return typeof f=="string"?document.getElementById(f):f}function fo(f,x){var R=f.style[x]||f.currentStyle&&f.currentStyle[x];if((!R||R==="auto")&&document.defaultView){var U=document.defaultView.getComputedStyle(f,null);R=U?U[x]:null}return R==="auto"?null:R}function ci(f,x,R){var U=document.createElement(f);return U.className=x||"",R&&R.appendChild(U),U}function pi(f){var x=f.parentNode;x&&x.removeChild(f)}function Ti(f){for(;f.firstChild;)f.removeChild(f.firstChild)}function _s(f){var x=f.parentNode;x&&x.lastChild!==f&&x.appendChild(f)}function po(f){var x=f.parentNode;x&&x.firstChild!==f&&x.insertBefore(f,x.firstChild)}function Go(f,x){if(f.classList!==void 0)return f.classList.contains(x);var R=Ar(f);return R.length>0&&new RegExp("(^|\\s)"+x+"(\\s|$)").test(R)}function cn(f,x){if(f.classList!==void 0)for(var R=be(x),U=0,K=R.length;U<K;U++)f.classList.add(R[U]);else if(!Go(f,x)){var ue=Ar(f);ys(f,(ue?ue+" ":"")+x)}}function Si(f,x){f.classList!==void 0?f.classList.remove(x):ys(f,Q((" "+Ar(f)+" ").replace(" "+x+" "," ")))}function ys(f,x){f.className.baseVal===void 0?f.className=x:f.className.baseVal=x}function Ar(f){return f.correspondingElement&&(f=f.correspondingElement),f.className.baseVal===void 0?f.className:f.className.baseVal}function ga(f,x){"opacity"in f.style?f.style.opacity=x:"filter"in f.style&&Zo(f,x)}function Zo(f,x){var R=!1,U="DXImageTransform.Microsoft.Alpha";try{R=f.filters.item(U)}catch{if(x===1)return}x=Math.round(x*100),R?(R.Enabled=x!==100,R.Opacity=x):f.style.filter+=" progid:"+U+"(opacity="+x+")"}function Ho(f){for(var x=document.documentElement.style,R=0;R<f.length;R++)if(f[R]in x)return f[R];return!1}function Va(f,x,R){var U=x||new xt(0,0);f.style[$s]=(Qt.ie3d?"translate("+U.x+"px,"+U.y+"px)":"translate3d("+U.x+"px,"+U.y+"px,0)")+(R?" scale("+R+")":"")}function Ir(f,x){f._leaflet_pos=x,Qt.any3d?Va(f,x):(f.style.left=x.x+"px",f.style.top=x.y+"px")}function Ya(f){return f._leaflet_pos||new xt(0,0)}var Xr,Cr,Un;if("onselectstart"in document)Xr=function(){fn(window,"selectstart",sn)},Cr=function(){bn(window,"selectstart",sn)};else{var Qa=Ho(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);Xr=function(){if(Qa){var f=document.documentElement.style;Un=f[Qa],f[Qa]="none"}},Cr=function(){Qa&&(document.documentElement.style[Qa]=Un,Un=void 0)}}function Ja(){fn(window,"dragstart",sn)}function vs(){bn(window,"dragstart",sn)}var Gs,Mn;function Zs(f){for(;f.tabIndex===-1;)f=f.parentNode;f.style&&(Mo(),Gs=f,Mn=f.style.outlineStyle,f.style.outlineStyle="none",fn(window,"keydown",Mo))}function Mo(){Gs&&(Gs.style.outlineStyle=Mn,Gs=void 0,Mn=void 0,bn(window,"keydown",Mo))}function mo(f){do f=f.parentNode;while((!f.offsetWidth||!f.offsetHeight)&&f!==document.body);return f}function Ei(f){var x=f.getBoundingClientRect();return{x:x.width/f.offsetWidth||1,y:x.height/f.offsetHeight||1,boundingClientRect:x}}var qr={__proto__:null,TRANSFORM:$s,TRANSITION:ho,TRANSITION_END:Ea,get:gs,getStyle:fo,create:ci,remove:pi,empty:Ti,toFront:_s,toBack:po,hasClass:Go,addClass:cn,removeClass:Si,setClass:ys,getClass:Ar,setOpacity:ga,testProp:Ho,setTransform:Va,setPosition:Ir,getPosition:Ya,get disableTextSelection(){return Xr},get enableTextSelection(){return Cr},disableImageDrag:Ja,enableImageDrag:vs,preventOutline:Zs,restoreOutline:Mo,getSizedParentNode:mo,getScale:Ei};function fn(f,x,R,U){if(x&&typeof x=="object")for(var K in x)Br(f,K,x[K],R);else{x=be(x);for(var ue=0,Oe=x.length;ue<Oe;ue++)Br(f,x[ue],R,U)}return this}var hi="_leaflet_events";function bn(f,x,R,U){if(arguments.length===1)Aa(f),delete f[hi];else if(x&&typeof x=="object")for(var K in x)Oi(f,K,x[K],R);else if(x=be(x),arguments.length===2)Aa(f,function(nt){return Ke(x,nt)!==-1});else for(var ue=0,Oe=x.length;ue<Oe;ue++)Oi(f,x[ue],R,U);return this}function Aa(f,x){for(var R in f[hi]){var U=R.split(/\d/)[0];(!x||x(U))&&Oi(f,U,null,null,R)}}var or={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function Br(f,x,R,U){var K=x+C(R)+(U?"_"+C(U):"");if(f[hi]&&f[hi][K])return this;var ue=function(nt){return R.call(U||f,nt||window.event)},Oe=ue;!Qt.touchNative&&Qt.pointer&&x.indexOf("touch")===0?ue=Ui(f,x,ue):Qt.touch&&x==="dblclick"?ue=fi(f,ue):"addEventListener"in f?x==="touchstart"||x==="touchmove"||x==="wheel"||x==="mousewheel"?f.addEventListener(or[x]||x,ue,Qt.passiveEvents?{passive:!1}:!1):x==="mouseenter"||x==="mouseleave"?(ue=function(nt){nt=nt||window.event,go(f,nt)&&Oe(nt)},f.addEventListener(or[x],ue,!1)):f.addEventListener(x,Oe,!1):f.attachEvent("on"+x,ue),f[hi]=f[hi]||{},f[hi][K]=ue}function Oi(f,x,R,U,K){K=K||x+C(R)+(U?"_"+C(U):"");var ue=f[hi]&&f[hi][K];if(!ue)return this;!Qt.touchNative&&Qt.pointer&&x.indexOf("touch")===0?Vn(f,x,ue):Qt.touch&&x==="dblclick"?qs(f,ue):"removeEventListener"in f?f.removeEventListener(or[x]||x,ue,!1):f.detachEvent("on"+x,ue),f[hi][K]=null}function Tn(f){return f.stopPropagation?f.stopPropagation():f.originalEvent?f.originalEvent._stopped=!0:f.cancelBubble=!0,this}function bs(f){return Br(f,"wheel",Tn),this}function pn(f){return fn(f,"mousedown touchstart dblclick contextmenu",Tn),f._leaflet_disable_click=!0,this}function sn(f){return f.preventDefault?f.preventDefault():f.returnValue=!1,this}function $r(f){return sn(f),Tn(f),this}function Jn(f){if(f.composedPath)return f.composedPath();for(var x=[],R=f.target;R;)x.push(R),R=R.parentNode;return x}function xi(f,x){if(!x)return new xt(f.clientX,f.clientY);var R=Ei(x),U=R.boundingClientRect;return new xt((f.clientX-U.left)/R.x-x.clientLeft,(f.clientY-U.top)/R.y-x.clientTop)}var lr=Qt.linux&&Qt.chrome?window.devicePixelRatio:Qt.mac?window.devicePixelRatio*3:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function Ia(f){return Qt.edge?f.wheelDeltaY/2:f.deltaY&&f.deltaMode===0?-f.deltaY/lr:f.deltaY&&f.deltaMode===1?-f.deltaY*20:f.deltaY&&f.deltaMode===2?-f.deltaY*60:f.deltaX||f.deltaZ?0:f.wheelDelta?(f.wheelDeltaY||f.wheelDelta)/2:f.detail&&Math.abs(f.detail)<32765?-f.detail*20:f.detail?f.detail/-32765*60:0}function go(f,x){var R=x.relatedTarget;if(!R)return!0;try{for(;R&&R!==f;)R=R.parentNode}catch{return!1}return R!==f}var Sl={__proto__:null,on:fn,off:bn,stopPropagation:Tn,disableScrollPropagation:bs,disableClickPropagation:pn,preventDefault:sn,stop:$r,getPropagationPath:Jn,getMousePosition:xi,getWheelDelta:Ia,isExternalTarget:go,addListener:fn,removeListener:bn},_o=Zt.extend({run:function(f,x,R,U){this.stop(),this._el=f,this._inProgress=!0,this._duration=R||.25,this._easeOutPower=1/Math.max(U||.5,.2),this._startPos=Ya(f),this._offset=x.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=De(this._animate,this),this._step()},_step:function(f){var x=+new Date-this._startTime,R=this._duration*1e3;x<R?this._runFrame(this._easeOut(x/R),f):(this._runFrame(1),this._complete())},_runFrame:function(f,x){var R=this._startPos.add(this._offset.multiplyBy(f));x&&R._round(),Ir(this._el,R),this.fire("step")},_complete:function(){$e(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(f){return 1-Math.pow(1-f,this._easeOutPower)}}),Xn=Zt.extend({options:{crs:Pi,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(f,x){x=xe(this,x),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(f),this._initLayout(),this._onResize=g(this._onResize,this),this._initEvents(),x.maxBounds&&this.setMaxBounds(x.maxBounds),x.zoom!==void 0&&(this._zoom=this._limitZoom(x.zoom)),x.center&&x.zoom!==void 0&&this.setView(Ft(x.center),x.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=ho&&Qt.any3d&&!Qt.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),fn(this._proxy,Ea,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(f,x,R){if(x=x===void 0?this._zoom:this._limitZoom(x),f=this._limitCenter(Ft(f),x,this.options.maxBounds),R=R||{},this._stop(),this._loaded&&!R.reset&&R!==!0){R.animate!==void 0&&(R.zoom=h({animate:R.animate},R.zoom),R.pan=h({animate:R.animate,duration:R.duration},R.pan));var U=this._zoom!==x?this._tryAnimatedZoom&&this._tryAnimatedZoom(f,x,R.zoom):this._tryAnimatedPan(f,R.pan);if(U)return clearTimeout(this._sizeTimer),this}return this._resetView(f,x,R.pan&&R.pan.noMoveStart),this},setZoom:function(f,x){return this._loaded?this.setView(this.getCenter(),f,{zoom:x}):(this._zoom=f,this)},zoomIn:function(f,x){return f=f||(Qt.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+f,x)},zoomOut:function(f,x){return f=f||(Qt.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-f,x)},setZoomAround:function(f,x,R){var U=this.getZoomScale(x),K=this.getSize().divideBy(2),ue=f instanceof xt?f:this.latLngToContainerPoint(f),Oe=ue.subtract(K).multiplyBy(1-1/U),nt=this.containerPointToLatLng(K.add(Oe));return this.setView(nt,x,{zoom:R})},_getBoundsCenterZoom:function(f,x){x=x||{},f=f.getBounds?f.getBounds():Xt(f);var R=Ie(x.paddingTopLeft||x.padding||[0,0]),U=Ie(x.paddingBottomRight||x.padding||[0,0]),K=this.getBoundsZoom(f,!1,R.add(U));if(K=typeof x.maxZoom=="number"?Math.min(x.maxZoom,K):K,K===1/0)return{center:f.getCenter(),zoom:K};var ue=U.subtract(R).divideBy(2),Oe=this.project(f.getSouthWest(),K),nt=this.project(f.getNorthEast(),K),mt=this.unproject(Oe.add(nt).divideBy(2).add(ue),K);return{center:mt,zoom:K}},fitBounds:function(f,x){if(f=Xt(f),!f.isValid())throw new Error("Bounds are not valid.");var R=this._getBoundsCenterZoom(f,x);return this.setView(R.center,R.zoom,x)},fitWorld:function(f){return this.fitBounds([[-90,-180],[90,180]],f)},panTo:function(f,x){return this.setView(f,this._zoom,{pan:x})},panBy:function(f,x){if(f=Ie(f).round(),x=x||{},!f.x&&!f.y)return this.fire("moveend");if(x.animate!==!0&&!this.getSize().contains(f))return this._resetView(this.unproject(this.project(this.getCenter()).add(f)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new _o,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),x.noMoveStart||this.fire("movestart"),x.animate!==!1){cn(this._mapPane,"leaflet-pan-anim");var R=this._getMapPanePos().subtract(f).round();this._panAnim.run(this._mapPane,R,x.duration||.25,x.easeLinearity)}else this._rawPanBy(f),this.fire("move").fire("moveend");return this},flyTo:function(f,x,R){if(R=R||{},R.animate===!1||!Qt.any3d)return this.setView(f,x,R);this._stop();var U=this.project(this.getCenter()),K=this.project(f),ue=this.getSize(),Oe=this._zoom;f=Ft(f),x=x===void 0?Oe:x;var nt=Math.max(ue.x,ue.y),mt=nt*this.getZoomScale(Oe,x),Rt=K.distanceTo(U)||1,Jt=1.42,on=Jt*Jt;function _n(Pr){var qa=Pr?-1:1,To=Pr?mt:nt,$a=mt*mt-nt*nt+qa*on*on*Rt*Rt,zo=2*To*on*Rt,Xu=$a/zo,Dc=Math.sqrt(Xu*Xu+1)-Xu,Ku=Dc<1e-9?-18:Math.log(Dc);return Ku}function Zn(Pr){return(Math.exp(Pr)-Math.exp(-Pr))/2}function cr(Pr){return(Math.exp(Pr)+Math.exp(-Pr))/2}function mr(Pr){return Zn(Pr)/cr(Pr)}var _a=_n(0);function wo(Pr){return nt*(cr(_a)/cr(_a+Jt*Pr))}function ph(Pr){return nt*(cr(_a)*mr(_a+Jt*Pr)-Zn(_a))/on}function gr(Pr){return 1-Math.pow(1-Pr,1.5)}var Ps=Date.now(),Ma=(_n(1)-_a)/Jt,Lc=R.duration?1e3*R.duration:1e3*Ma*.8;function rl(){var Pr=(Date.now()-Ps)/Lc,qa=gr(Pr)*Ma;Pr<=1?(this._flyToFrame=De(rl,this),this._move(this.unproject(U.add(K.subtract(U).multiplyBy(ph(qa)/Rt)),Oe),this.getScaleZoom(nt/wo(qa),Oe),{flyTo:!0})):this._move(f,x)._moveEnd(!0)}return this._moveStart(!0,R.noMoveStart),rl.call(this),this},flyToBounds:function(f,x){var R=this._getBoundsCenterZoom(f,x);return this.flyTo(R.center,R.zoom,x)},setMaxBounds:function(f){return f=Xt(f),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),f.isValid()?(this.options.maxBounds=f,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(f){var x=this.options.minZoom;return this.options.minZoom=f,this._loaded&&x!==f&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(f):this},setMaxZoom:function(f){var x=this.options.maxZoom;return this.options.maxZoom=f,this._loaded&&x!==f&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(f):this},panInsideBounds:function(f,x){this._enforcingBounds=!0;var R=this.getCenter(),U=this._limitCenter(R,this._zoom,Xt(f));return R.equals(U)||this.panTo(U,x),this._enforcingBounds=!1,this},panInside:function(f,x){x=x||{};var R=Ie(x.paddingTopLeft||x.padding||[0,0]),U=Ie(x.paddingBottomRight||x.padding||[0,0]),K=this.project(this.getCenter()),ue=this.project(f),Oe=this.getPixelBounds(),nt=Dt([Oe.min.add(R),Oe.max.subtract(U)]),mt=nt.getSize();if(!nt.contains(ue)){this._enforcingBounds=!0;var Rt=ue.subtract(nt.getCenter()),Jt=nt.extend(ue).getSize().subtract(mt);K.x+=Rt.x<0?-Jt.x:Jt.x,K.y+=Rt.y<0?-Jt.y:Jt.y,this.panTo(this.unproject(K),x),this._enforcingBounds=!1}return this},invalidateSize:function(f){if(!this._loaded)return this;f=h({animate:!1,pan:!0},f===!0?{animate:!0}:f);var x=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var R=this.getSize(),U=x.divideBy(2).round(),K=R.divideBy(2).round(),ue=U.subtract(K);return!ue.x&&!ue.y?this:(f.animate&&f.pan?this.panBy(ue):(f.pan&&this._rawPanBy(ue),this.fire("move"),f.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(g(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:x,newSize:R}))},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(f){if(f=this._locateOptions=h({timeout:1e4,watch:!1},f),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var x=g(this._handleGeolocationResponse,this),R=g(this._handleGeolocationError,this);return f.watch?this._locationWatchId=navigator.geolocation.watchPosition(x,R,f):navigator.geolocation.getCurrentPosition(x,R,f),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(f){if(this._container._leaflet_id){var x=f.code,R=f.message||(x===1?"permission denied":x===2?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:x,message:"Geolocation error: "+R+"."})}},_handleGeolocationResponse:function(f){if(this._container._leaflet_id){var x=f.coords.latitude,R=f.coords.longitude,U=new an(x,R),K=U.toBounds(f.coords.accuracy*2),ue=this._locateOptions;if(ue.setView){var Oe=this.getBoundsZoom(K);this.setView(U,ue.maxZoom?Math.min(Oe,ue.maxZoom):Oe)}var nt={latlng:U,bounds:K,timestamp:f.timestamp};for(var mt in f.coords)typeof f.coords[mt]=="number"&&(nt[mt]=f.coords[mt]);this.fire("locationfound",nt)}},addHandler:function(f,x){if(!x)return this;var R=this[f]=new x(this);return this._handlers.push(R),this.options[f]&&R.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch{this._container._leaflet_id=void 0,this._containerId=void 0}this._locationWatchId!==void 0&&this.stopLocate(),this._stop(),pi(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&($e(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload");var f;for(f in this._layers)this._layers[f].remove();for(f in this._panes)pi(this._panes[f]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(f,x){var R="leaflet-pane"+(f?" leaflet-"+f.replace("Pane","")+"-pane":""),U=ci("div",R,x||this._mapPane);return f&&(this._panes[f]=U),U},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var f=this.getPixelBounds(),x=this.unproject(f.getBottomLeft()),R=this.unproject(f.getTopRight());return new zt(x,R)},getMinZoom:function(){return this.options.minZoom===void 0?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===void 0?this._layersMaxZoom===void 0?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(f,x,R){f=Xt(f),R=Ie(R||[0,0]);var U=this.getZoom()||0,K=this.getMinZoom(),ue=this.getMaxZoom(),Oe=f.getNorthWest(),nt=f.getSouthEast(),mt=this.getSize().subtract(R),Rt=Dt(this.project(nt,U),this.project(Oe,U)).getSize(),Jt=Qt.any3d?this.options.zoomSnap:1,on=mt.x/Rt.x,_n=mt.y/Rt.y,Zn=x?Math.max(on,_n):Math.min(on,_n);return U=this.getScaleZoom(Zn,U),Jt&&(U=Math.round(U/(Jt/100))*(Jt/100),U=x?Math.ceil(U/Jt)*Jt:Math.floor(U/Jt)*Jt),Math.max(K,Math.min(ue,U))},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new xt(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(f,x){var R=this._getTopLeftPoint(f,x);return new lt(R,R.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(f){return this.options.crs.getProjectedBounds(f===void 0?this.getZoom():f)},getPane:function(f){return typeof f=="string"?this._panes[f]:f},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(f,x){var R=this.options.crs;return x=x===void 0?this._zoom:x,R.scale(f)/R.scale(x)},getScaleZoom:function(f,x){var R=this.options.crs;x=x===void 0?this._zoom:x;var U=R.zoom(f*R.scale(x));return isNaN(U)?1/0:U},project:function(f,x){return x=x===void 0?this._zoom:x,this.options.crs.latLngToPoint(Ft(f),x)},unproject:function(f,x){return x=x===void 0?this._zoom:x,this.options.crs.pointToLatLng(Ie(f),x)},layerPointToLatLng:function(f){var x=Ie(f).add(this.getPixelOrigin());return this.unproject(x)},latLngToLayerPoint:function(f){var x=this.project(Ft(f))._round();return x._subtract(this.getPixelOrigin())},wrapLatLng:function(f){return this.options.crs.wrapLatLng(Ft(f))},wrapLatLngBounds:function(f){return this.options.crs.wrapLatLngBounds(Xt(f))},distance:function(f,x){return this.options.crs.distance(Ft(f),Ft(x))},containerPointToLayerPoint:function(f){return Ie(f).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(f){return Ie(f).add(this._getMapPanePos())},containerPointToLatLng:function(f){var x=this.containerPointToLayerPoint(Ie(f));return this.layerPointToLatLng(x)},latLngToContainerPoint:function(f){return this.layerPointToContainerPoint(this.latLngToLayerPoint(Ft(f)))},mouseEventToContainerPoint:function(f){return xi(f,this._container)},mouseEventToLayerPoint:function(f){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(f))},mouseEventToLatLng:function(f){return this.layerPointToLatLng(this.mouseEventToLayerPoint(f))},_initContainer:function(f){var x=this._container=gs(f);if(x){if(x._leaflet_id)throw new Error("Map container is already initialized.")}else throw new Error("Map container not found.");fn(x,"scroll",this._onScroll,this),this._containerId=C(x)},_initLayout:function(){var f=this._container;this._fadeAnimated=this.options.fadeAnimation&&Qt.any3d,cn(f,"leaflet-container"+(Qt.touch?" leaflet-touch":"")+(Qt.retina?" leaflet-retina":"")+(Qt.ielt9?" leaflet-oldie":"")+(Qt.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var x=fo(f,"position");x!=="absolute"&&x!=="relative"&&x!=="fixed"&&x!=="sticky"&&(f.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var f=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),Ir(this._mapPane,new xt(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(cn(f.markerPane,"leaflet-zoom-hide"),cn(f.shadowPane,"leaflet-zoom-hide"))},_resetView:function(f,x,R){Ir(this._mapPane,new xt(0,0));var U=!this._loaded;this._loaded=!0,x=this._limitZoom(x),this.fire("viewprereset");var K=this._zoom!==x;this._moveStart(K,R)._move(f,x)._moveEnd(K),this.fire("viewreset"),U&&this.fire("load")},_moveStart:function(f,x){return f&&this.fire("zoomstart"),x||this.fire("movestart"),this},_move:function(f,x,R,U){x===void 0&&(x=this._zoom);var K=this._zoom!==x;return this._zoom=x,this._lastCenter=f,this._pixelOrigin=this._getNewPixelOrigin(f),U?R&&R.pinch&&this.fire("zoom",R):((K||R&&R.pinch)&&this.fire("zoom",R),this.fire("move",R)),this},_moveEnd:function(f){return f&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return $e(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(f){Ir(this._mapPane,this._getMapPanePos().subtract(f))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(f){this._targets={},this._targets[C(this._container)]=this;var x=f?bn:fn;x(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&x(window,"resize",this._onResize,this),Qt.any3d&&this.options.transform3DLimit&&(f?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){$e(this._resizeRequest),this._resizeRequest=De(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var f=this._getMapPanePos();Math.max(Math.abs(f.x),Math.abs(f.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(f,x){for(var R=[],U,K=x==="mouseout"||x==="mouseover",ue=f.target||f.srcElement,Oe=!1;ue;){if(U=this._targets[C(ue)],U&&(x==="click"||x==="preclick")&&this._draggableMoved(U)){Oe=!0;break}if(U&&U.listens(x,!0)&&(K&&!go(ue,f)||(R.push(U),K))||ue===this._container)break;ue=ue.parentNode}return!R.length&&!Oe&&!K&&this.listens(x,!0)&&(R=[this]),R},_isClickDisabled:function(f){for(;f&&f!==this._container;){if(f._leaflet_disable_click)return!0;f=f.parentNode}},_handleDOMEvent:function(f){var x=f.target||f.srcElement;if(!(!this._loaded||x._leaflet_disable_events||f.type==="click"&&this._isClickDisabled(x))){var R=f.type;R==="mousedown"&&Zs(x),this._fireDOMEvent(f,R)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(f,x,R){if(f.type==="click"){var U=h({},f);U.type="preclick",this._fireDOMEvent(U,U.type,R)}var K=this._findEventTargets(f,x);if(R){for(var ue=[],Oe=0;Oe<R.length;Oe++)R[Oe].listens(x,!0)&&ue.push(R[Oe]);K=ue.concat(K)}if(K.length){x==="contextmenu"&&sn(f);var nt=K[0],mt={originalEvent:f};if(f.type!=="keypress"&&f.type!=="keydown"&&f.type!=="keyup"){var Rt=nt.getLatLng&&(!nt._radius||nt._radius<=10);mt.containerPoint=Rt?this.latLngToContainerPoint(nt.getLatLng()):this.mouseEventToContainerPoint(f),mt.layerPoint=this.containerPointToLayerPoint(mt.containerPoint),mt.latlng=Rt?nt.getLatLng():this.layerPointToLatLng(mt.layerPoint)}for(Oe=0;Oe<K.length;Oe++)if(K[Oe].fire(x,mt,!0),mt.originalEvent._stopped||K[Oe].options.bubblingMouseEvents===!1&&Ke(this._mouseEvents,x)!==-1)return}},_draggableMoved:function(f){return f=f.dragging&&f.dragging.enabled()?f:this,f.dragging&&f.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var f=0,x=this._handlers.length;f<x;f++)this._handlers[f].disable()},whenReady:function(f,x){return this._loaded?f.call(x||this,{target:this}):this.on("load",f,x),this},_getMapPanePos:function(){return Ya(this._mapPane)||new xt(0,0)},_moved:function(){var f=this._getMapPanePos();return f&&!f.equals([0,0])},_getTopLeftPoint:function(f,x){var R=f&&x!==void 0?this._getNewPixelOrigin(f,x):this.getPixelOrigin();return R.subtract(this._getMapPanePos())},_getNewPixelOrigin:function(f,x){var R=this.getSize()._divideBy(2);return this.project(f,x)._subtract(R)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(f,x,R){var U=this._getNewPixelOrigin(R,x);return this.project(f,x)._subtract(U)},_latLngBoundsToNewLayerBounds:function(f,x,R){var U=this._getNewPixelOrigin(R,x);return Dt([this.project(f.getSouthWest(),x)._subtract(U),this.project(f.getNorthWest(),x)._subtract(U),this.project(f.getSouthEast(),x)._subtract(U),this.project(f.getNorthEast(),x)._subtract(U)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(f){return this.latLngToLayerPoint(f).subtract(this._getCenterLayerPoint())},_limitCenter:function(f,x,R){if(!R)return f;var U=this.project(f,x),K=this.getSize().divideBy(2),ue=new lt(U.subtract(K),U.add(K)),Oe=this._getBoundsOffset(ue,R,x);return Math.abs(Oe.x)<=1&&Math.abs(Oe.y)<=1?f:this.unproject(U.add(Oe),x)},_limitOffset:function(f,x){if(!x)return f;var R=this.getPixelBounds(),U=new lt(R.min.add(f),R.max.add(f));return f.add(this._getBoundsOffset(U,x))},_getBoundsOffset:function(f,x,R){var U=Dt(this.project(x.getNorthEast(),R),this.project(x.getSouthWest(),R)),K=U.min.subtract(f.min),ue=U.max.subtract(f.max),Oe=this._rebound(K.x,-ue.x),nt=this._rebound(K.y,-ue.y);return new xt(Oe,nt)},_rebound:function(f,x){return f+x>0?Math.round(f-x)/2:Math.max(0,Math.ceil(f))-Math.max(0,Math.floor(x))},_limitZoom:function(f){var x=this.getMinZoom(),R=this.getMaxZoom(),U=Qt.any3d?this.options.zoomSnap:1;return U&&(f=Math.round(f/U)*U),Math.max(x,Math.min(R,f))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){Si(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(f,x){var R=this._getCenterOffset(f)._trunc();return(x&&x.animate)!==!0&&!this.getSize().contains(R)?!1:(this.panBy(R,x),!0)},_createAnimProxy:function(){var f=this._proxy=ci("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(f),this.on("zoomanim",function(x){var R=$s,U=this._proxy.style[R];Va(this._proxy,this.project(x.center,x.zoom),this.getZoomScale(x.zoom,1)),U===this._proxy.style[R]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){pi(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var f=this.getCenter(),x=this.getZoom();Va(this._proxy,this.project(f,x),this.getZoomScale(x,1))},_catchTransitionEnd:function(f){this._animatingZoom&&f.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(f,x,R){if(this._animatingZoom)return!0;if(R=R||{},!this._zoomAnimated||R.animate===!1||this._nothingToAnimate()||Math.abs(x-this._zoom)>this.options.zoomAnimationThreshold)return!1;var U=this.getZoomScale(x),K=this._getCenterOffset(f)._divideBy(1-1/U);return R.animate!==!0&&!this.getSize().contains(K)?!1:(De(function(){this._moveStart(!0,R.noMoveStart||!1)._animateZoom(f,x,!0)},this),!0)},_animateZoom:function(f,x,R,U){this._mapPane&&(R&&(this._animatingZoom=!0,this._animateToCenter=f,this._animateToZoom=x,cn(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:f,zoom:x,noUpdate:U}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(g(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&Si(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});function Hs(f,x){return new Xn(f,x)}var Kr=Bn.extend({options:{position:"topright"},initialize:function(f){xe(this,f)},getPosition:function(){return this.options.position},setPosition:function(f){var x=this._map;return x&&x.removeControl(this),this.options.position=f,x&&x.addControl(this),this},getContainer:function(){return this._container},addTo:function(f){this.remove(),this._map=f;var x=this._container=this.onAdd(f),R=this.getPosition(),U=f._controlCorners[R];return cn(x,"leaflet-control"),R.indexOf("bottom")!==-1?U.insertBefore(x,U.firstChild):U.appendChild(x),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(pi(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(f){this._map&&f&&f.screenX>0&&f.screenY>0&&this._map.getContainer().focus()}}),xs=function(f){return new Kr(f)};Xn.include({addControl:function(f){return f.addTo(this),this},removeControl:function(f){return f.remove(),this},_initControlPos:function(){var f=this._controlCorners={},x="leaflet-",R=this._controlContainer=ci("div",x+"control-container",this._container);function U(K,ue){var Oe=x+K+" "+x+ue;f[K+ue]=ci("div",Oe,R)}U("top","left"),U("top","right"),U("bottom","left"),U("bottom","right")},_clearControlPos:function(){for(var f in this._controlCorners)pi(this._controlCorners[f]);pi(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var ws=Kr.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(f,x,R,U){return R<U?-1:U<R?1:0}},initialize:function(f,x,R){xe(this,R),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1;for(var U in f)this._addLayer(f[U],U);for(U in x)this._addLayer(x[U],U,!0)},onAdd:function(f){this._initLayout(),this._update(),this._map=f,f.on("zoomend",this._checkDisabledLayers,this);for(var x=0;x<this._layers.length;x++)this._layers[x].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(f){return Kr.prototype.addTo.call(this,f),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var f=0;f<this._layers.length;f++)this._layers[f].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(f,x){return this._addLayer(f,x),this._map?this._update():this},addOverlay:function(f,x){return this._addLayer(f,x,!0),this._map?this._update():this},removeLayer:function(f){f.off("add remove",this._onLayerChange,this);var x=this._getLayer(C(f));return x&&this._layers.splice(this._layers.indexOf(x),1),this._map?this._update():this},expand:function(){cn(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var f=this._map.getSize().y-(this._container.offsetTop+50);return f<this._section.clientHeight?(cn(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=f+"px"):Si(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return Si(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var f="leaflet-control-layers",x=this._container=ci("div",f),R=this.options.collapsed;x.setAttribute("aria-haspopup",!0),pn(x),bs(x);var U=this._section=ci("section",f+"-list");R&&(this._map.on("click",this.collapse,this),fn(x,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var K=this._layersLink=ci("a",f+"-toggle",x);K.href="#",K.title="Layers",K.setAttribute("role","button"),fn(K,{keydown:function(ue){ue.keyCode===13&&this._expandSafely()},click:function(ue){sn(ue),this._expandSafely()}},this),R||this.expand(),this._baseLayersList=ci("div",f+"-base",U),this._separator=ci("div",f+"-separator",U),this._overlaysList=ci("div",f+"-overlays",U),x.appendChild(U)},_getLayer:function(f){for(var x=0;x<this._layers.length;x++)if(this._layers[x]&&C(this._layers[x].layer)===f)return this._layers[x]},_addLayer:function(f,x,R){this._map&&f.on("add remove",this._onLayerChange,this),this._layers.push({layer:f,name:x,overlay:R}),this.options.sortLayers&&this._layers.sort(g(function(U,K){return this.options.sortFunction(U.layer,K.layer,U.name,K.name)},this)),this.options.autoZIndex&&f.setZIndex&&(this._lastZIndex++,f.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;Ti(this._baseLayersList),Ti(this._overlaysList),this._layerControlInputs=[];var f,x,R,U,K=0;for(R=0;R<this._layers.length;R++)U=this._layers[R],this._addItem(U),x=x||U.overlay,f=f||!U.overlay,K+=U.overlay?0:1;return this.options.hideSingleBase&&(f=f&&K>1,this._baseLayersList.style.display=f?"":"none"),this._separator.style.display=x&&f?"":"none",this},_onLayerChange:function(f){this._handlingClick||this._update();var x=this._getLayer(C(f.target)),R=x.overlay?f.type==="add"?"overlayadd":"overlayremove":f.type==="add"?"baselayerchange":null;R&&this._map.fire(R,x)},_createRadioElement:function(f,x){var R='<input type="radio" class="leaflet-control-layers-selector" name="'+f+'"'+(x?' checked="checked"':"")+"/>",U=document.createElement("div");return U.innerHTML=R,U.firstChild},_addItem:function(f){var x=document.createElement("label"),R=this._map.hasLayer(f.layer),U;f.overlay?(U=document.createElement("input"),U.type="checkbox",U.className="leaflet-control-layers-selector",U.defaultChecked=R):U=this._createRadioElement("leaflet-base-layers_"+C(this),R),this._layerControlInputs.push(U),U.layerId=C(f.layer),fn(U,"click",this._onInputClick,this);var K=document.createElement("span");K.innerHTML=" "+f.name;var ue=document.createElement("span");x.appendChild(ue),ue.appendChild(U),ue.appendChild(K);var Oe=f.overlay?this._overlaysList:this._baseLayersList;return Oe.appendChild(x),this._checkDisabledLayers(),x},_onInputClick:function(){if(!this._preventClick){var f=this._layerControlInputs,x,R,U=[],K=[];this._handlingClick=!0;for(var ue=f.length-1;ue>=0;ue--)x=f[ue],R=this._getLayer(x.layerId).layer,x.checked?U.push(R):x.checked||K.push(R);for(ue=0;ue<K.length;ue++)this._map.hasLayer(K[ue])&&this._map.removeLayer(K[ue]);for(ue=0;ue<U.length;ue++)this._map.hasLayer(U[ue])||this._map.addLayer(U[ue]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var f=this._layerControlInputs,x,R,U=this._map.getZoom(),K=f.length-1;K>=0;K--)x=f[K],R=this._getLayer(x.layerId).layer,x.disabled=R.options.minZoom!==void 0&&U<R.options.minZoom||R.options.maxZoom!==void 0&&U>R.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var f=this._section;this._preventClick=!0,fn(f,"click",sn),this.expand();var x=this;setTimeout(function(){bn(f,"click",sn),x._preventClick=!1})}}),Gr=function(f,x,R){return new ws(f,x,R)},Ts=Kr.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(f){var x="leaflet-control-zoom",R=ci("div",x+" leaflet-bar"),U=this.options;return this._zoomInButton=this._createButton(U.zoomInText,U.zoomInTitle,x+"-in",R,this._zoomIn),this._zoomOutButton=this._createButton(U.zoomOutText,U.zoomOutTitle,x+"-out",R,this._zoomOut),this._updateDisabled(),f.on("zoomend zoomlevelschange",this._updateDisabled,this),R},onRemove:function(f){f.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(f){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(f.shiftKey?3:1))},_zoomOut:function(f){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(f.shiftKey?3:1))},_createButton:function(f,x,R,U,K){var ue=ci("a",R,U);return ue.innerHTML=f,ue.href="#",ue.title=x,ue.setAttribute("role","button"),ue.setAttribute("aria-label",x),pn(ue),fn(ue,"click",$r),fn(ue,"click",K,this),fn(ue,"click",this._refocusOnMap,this),ue},_updateDisabled:function(){var f=this._map,x="leaflet-disabled";Si(this._zoomInButton,x),Si(this._zoomOutButton,x),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||f._zoom===f.getMinZoom())&&(cn(this._zoomOutButton,x),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||f._zoom===f.getMaxZoom())&&(cn(this._zoomInButton,x),this._zoomInButton.setAttribute("aria-disabled","true"))}});Xn.mergeOptions({zoomControl:!0}),Xn.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new Ts,this.addControl(this.zoomControl))});var Wo=function(f){return new Ts(f)},Ro=Kr.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(f){var x="leaflet-control-scale",R=ci("div",x),U=this.options;return this._addScales(U,x+"-line",R),f.on(U.updateWhenIdle?"moveend":"move",this._update,this),f.whenReady(this._update,this),R},onRemove:function(f){f.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(f,x,R){f.metric&&(this._mScale=ci("div",x,R)),f.imperial&&(this._iScale=ci("div",x,R))},_update:function(){var f=this._map,x=f.getSize().y/2,R=f.distance(f.containerPointToLatLng([0,x]),f.containerPointToLatLng([this.options.maxWidth,x]));this._updateScales(R)},_updateScales:function(f){this.options.metric&&f&&this._updateMetric(f),this.options.imperial&&f&&this._updateImperial(f)},_updateMetric:function(f){var x=this._getRoundNum(f),R=x<1e3?x+" m":x/1e3+" km";this._updateScale(this._mScale,R,x/f)},_updateImperial:function(f){var x=f*3.2808399,R,U,K;x>5280?(R=x/5280,U=this._getRoundNum(R),this._updateScale(this._iScale,U+" mi",U/R)):(K=this._getRoundNum(x),this._updateScale(this._iScale,K+" ft",K/x))},_updateScale:function(f,x,R){f.style.width=Math.round(this.options.maxWidth*R)+"px",f.innerHTML=x},_getRoundNum:function(f){var x=Math.pow(10,(Math.floor(f)+"").length-1),R=f/x;return R=R>=10?10:R>=5?5:R>=3?3:R>=2?2:1,x*R}}),nr=function(f){return new Ro(f)},Uu='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg>',Xo=Kr.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(Qt.inlineSvg?Uu+" ":"")+"Leaflet</a>"},initialize:function(f){xe(this,f),this._attributions={}},onAdd:function(f){f.attributionControl=this,this._container=ci("div","leaflet-control-attribution"),pn(this._container);for(var x in f._layers)f._layers[x].getAttribution&&this.addAttribution(f._layers[x].getAttribution());return this._update(),f.on("layeradd",this._addAttribution,this),this._container},onRemove:function(f){f.off("layeradd",this._addAttribution,this)},_addAttribution:function(f){f.layer.getAttribution&&(this.addAttribution(f.layer.getAttribution()),f.layer.once("remove",function(){this.removeAttribution(f.layer.getAttribution())},this))},setPrefix:function(f){return this.options.prefix=f,this._update(),this},addAttribution:function(f){return f?(this._attributions[f]||(this._attributions[f]=0),this._attributions[f]++,this._update(),this):this},removeAttribution:function(f){return f?(this._attributions[f]&&(this._attributions[f]--,this._update()),this):this},_update:function(){if(this._map){var f=[];for(var x in this._attributions)this._attributions[x]&&f.push(x);var R=[];this.options.prefix&&R.push(this.options.prefix),f.length&&R.push(f.join(", ")),this._container.innerHTML=R.join(' <span aria-hidden="true">|</span> ')}}});Xn.mergeOptions({attributionControl:!0}),Xn.addInitHook(function(){this.options.attributionControl&&new Xo().addTo(this)});var Hl=function(f){return new Xo(f)};Kr.Layers=ws,Kr.Zoom=Ts,Kr.Scale=Ro,Kr.Attribution=Xo,xs.layers=Gr,xs.zoom=Wo,xs.scale=nr,xs.attribution=Hl;var Ss=Bn.extend({initialize:function(f){this._map=f},enable:function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});Ss.addTo=function(f,x){return f.addHandler(x,this),this};var El={Events:gt},ir=Qt.touch?"touchstart mousedown":"mousedown",es=Zt.extend({options:{clickTolerance:3},initialize:function(f,x,R,U){xe(this,U),this._element=f,this._dragStartTarget=x||f,this._preventOutline=R},enable:function(){this._enabled||(fn(this._dragStartTarget,ir,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(es._dragging===this&&this.finishDrag(!0),bn(this._dragStartTarget,ir,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(f){if(this._enabled&&(this._moved=!1,!Go(this._element,"leaflet-zoom-anim"))){if(f.touches&&f.touches.length!==1){es._dragging===this&&this.finishDrag();return}if(!(es._dragging||f.shiftKey||f.which!==1&&f.button!==1&&!f.touches)&&(es._dragging=this,this._preventOutline&&Zs(this._element),Ja(),Xr(),!this._moving)){this.fire("down");var x=f.touches?f.touches[0]:f,R=mo(this._element);this._startPoint=new xt(x.clientX,x.clientY),this._startPos=Ya(this._element),this._parentScale=Ei(R);var U=f.type==="mousedown";fn(document,U?"mousemove":"touchmove",this._onMove,this),fn(document,U?"mouseup":"touchend touchcancel",this._onUp,this)}}},_onMove:function(f){if(this._enabled){if(f.touches&&f.touches.length>1){this._moved=!0;return}var x=f.touches&&f.touches.length===1?f.touches[0]:f,R=new xt(x.clientX,x.clientY)._subtract(this._startPoint);!R.x&&!R.y||Math.abs(R.x)+Math.abs(R.y)<this.options.clickTolerance||(R.x/=this._parentScale.x,R.y/=this._parentScale.y,sn(f),this._moved||(this.fire("dragstart"),this._moved=!0,cn(document.body,"leaflet-dragging"),this._lastTarget=f.target||f.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),cn(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(R),this._moving=!0,this._lastEvent=f,this._updatePosition())}},_updatePosition:function(){var f={originalEvent:this._lastEvent};this.fire("predrag",f),Ir(this._element,this._newPos),this.fire("drag",f)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(f){Si(document.body,"leaflet-dragging"),this._lastTarget&&(Si(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),bn(document,"mousemove touchmove",this._onMove,this),bn(document,"mouseup touchend touchcancel",this._onUp,this),vs(),Cr();var x=this._moved&&this._moving;this._moving=!1,es._dragging=!1,x&&this.fire("dragend",{noInertia:f,distance:this._newPos.distanceTo(this._startPos)})}});function Es(f,x,R){var U,K=[1,4,2,8],ue,Oe,nt,mt,Rt,Jt,on,_n;for(ue=0,Jt=f.length;ue<Jt;ue++)f[ue]._code=pt(f[ue],x);for(nt=0;nt<4;nt++){for(on=K[nt],U=[],ue=0,Jt=f.length,Oe=Jt-1;ue<Jt;Oe=ue++)mt=f[ue],Rt=f[Oe],mt._code&on?Rt._code&on||(_n=at(Rt,mt,on,x,R),_n._code=pt(_n,x),U.push(_n)):(Rt._code&on&&(_n=at(Rt,mt,on,x,R),_n._code=pt(_n,x),U.push(_n)),U.push(mt));f=U}return f}function ko(f,x){var R,U,K,ue,Oe,nt,mt,Rt,Jt;if(!f||f.length===0)throw new Error("latlngs not passed");$n(f)||(console.warn("latlngs are not flat! Only the first ring will be used"),f=f[0]);var on=Ft([0,0]),_n=Xt(f),Zn=_n.getNorthWest().distanceTo(_n.getSouthWest())*_n.getNorthEast().distanceTo(_n.getNorthWest());Zn<1700&&(on=Ko(f));var cr=f.length,mr=[];for(R=0;R<cr;R++){var _a=Ft(f[R]);mr.push(x.project(Ft([_a.lat-on.lat,_a.lng-on.lng])))}for(nt=mt=Rt=0,R=0,U=cr-1;R<cr;U=R++)K=mr[R],ue=mr[U],Oe=K.y*ue.x-ue.y*K.x,mt+=(K.x+ue.x)*Oe,Rt+=(K.y+ue.y)*Oe,nt+=Oe*3;nt===0?Jt=mr[0]:Jt=[mt/nt,Rt/nt];var wo=x.unproject(Ie(Jt));return Ft([wo.lat+on.lat,wo.lng+on.lng])}function Ko(f){for(var x=0,R=0,U=0,K=0;K<f.length;K++){var ue=Ft(f[K]);x+=ue.lat,R+=ue.lng,U++}return Ft([x/U,R/U])}var Yo={__proto__:null,clipPolygon:Es,polygonCenter:ko,centroid:Ko};function Ai(f,x){if(!x||!f.length)return f.slice();var R=x*x;return f=G(f,R),f=Wl(f,R),f}function hu(f,x,R){return Math.sqrt(kn(f,x,R,!0))}function du(f,x,R){return kn(f,x,R)}function Wl(f,x){var R=f.length,U=typeof Uint8Array<"u"?Uint8Array:Array,K=new U(R);K[0]=K[R-1]=1,M(f,K,x,0,R-1);var ue,Oe=[];for(ue=0;ue<R;ue++)K[ue]&&Oe.push(f[ue]);return Oe}function M(f,x,R,U,K){var ue=0,Oe,nt,mt;for(nt=U+1;nt<=K-1;nt++)mt=kn(f[nt],f[U],f[K],!0),mt>ue&&(Oe=nt,ue=mt);ue>R&&(x[Oe]=1,M(f,x,R,U,Oe),M(f,x,R,Oe,K))}function G(f,x){for(var R=[f[0]],U=1,K=0,ue=f.length;U<ue;U++)Wt(f[U],f[K])>x&&(R.push(f[U]),K=U);return K<ue-1&&R.push(f[ue-1]),R}var te;function ye(f,x,R,U,K){var ue=U?te:pt(f,R),Oe=pt(x,R),nt,mt,Rt;for(te=Oe;;){if(!(ue|Oe))return[f,x];if(ue&Oe)return!1;nt=ue||Oe,mt=at(f,x,nt,R,K),Rt=pt(mt,R),nt===ue?(f=mt,ue=Rt):(x=mt,Oe=Rt)}}function at(f,x,R,U,K){var ue=x.x-f.x,Oe=x.y-f.y,nt=U.min,mt=U.max,Rt,Jt;return R&8?(Rt=f.x+ue*(mt.y-f.y)/Oe,Jt=mt.y):R&4?(Rt=f.x+ue*(nt.y-f.y)/Oe,Jt=nt.y):R&2?(Rt=mt.x,Jt=f.y+Oe*(mt.x-f.x)/ue):R&1&&(Rt=nt.x,Jt=f.y+Oe*(nt.x-f.x)/ue),new xt(Rt,Jt,K)}function pt(f,x){var R=0;return f.x<x.min.x?R|=1:f.x>x.max.x&&(R|=2),f.y<x.min.y?R|=4:f.y>x.max.y&&(R|=8),R}function Wt(f,x){var R=x.x-f.x,U=x.y-f.y;return R*R+U*U}function kn(f,x,R,U){var K=x.x,ue=x.y,Oe=R.x-K,nt=R.y-ue,mt=Oe*Oe+nt*nt,Rt;return mt>0&&(Rt=((f.x-K)*Oe+(f.y-ue)*nt)/mt,Rt>1?(K=R.x,ue=R.y):Rt>0&&(K+=Oe*Rt,ue+=nt*Rt)),Oe=f.x-K,nt=f.y-ue,U?Oe*Oe+nt*nt:new xt(K,ue)}function $n(f){return!Xe(f[0])||typeof f[0][0]!="object"&&typeof f[0][0]<"u"}function Ri(f){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),$n(f)}function ur(f,x){var R,U,K,ue,Oe,nt,mt,Rt;if(!f||f.length===0)throw new Error("latlngs not passed");$n(f)||(console.warn("latlngs are not flat! Only the first ring will be used"),f=f[0]);var Jt=Ft([0,0]),on=Xt(f),_n=on.getNorthWest().distanceTo(on.getSouthWest())*on.getNorthEast().distanceTo(on.getNorthWest());_n<1700&&(Jt=Ko(f));var Zn=f.length,cr=[];for(R=0;R<Zn;R++){var mr=Ft(f[R]);cr.push(x.project(Ft([mr.lat-Jt.lat,mr.lng-Jt.lng])))}for(R=0,U=0;R<Zn-1;R++)U+=cr[R].distanceTo(cr[R+1])/2;if(U===0)Rt=cr[0];else for(R=0,ue=0;R<Zn-1;R++)if(Oe=cr[R],nt=cr[R+1],K=Oe.distanceTo(nt),ue+=K,ue>U){mt=(ue-U)/K,Rt=[nt.x-mt*(nt.x-Oe.x),nt.y-mt*(nt.y-Oe.y)];break}var _a=x.unproject(Ie(Rt));return Ft([_a.lat+Jt.lat,_a.lng+Jt.lng])}var Ca={__proto__:null,simplify:Ai,pointToSegmentDistance:hu,closestPointOnSegment:du,clipSegment:ye,_getEdgeIntersection:at,_getBitCode:pt,_sqClosestPointOnSegment:kn,isFlat:$n,_flat:Ri,polylineCenter:ur},Ua={project:function(f){return new xt(f.lng,f.lat)},unproject:function(f){return new an(f.y,f.x)},bounds:new lt([-180,-90],[180,90])},Ws={R:6378137,R_MINOR:6356752314245179e-9,bounds:new lt([-2003750834279e-5,-1549657073972e-5],[2003750834279e-5,1876465623138e-5]),project:function(f){var x=Math.PI/180,R=this.R,U=f.lat*x,K=this.R_MINOR/R,ue=Math.sqrt(1-K*K),Oe=ue*Math.sin(U),nt=Math.tan(Math.PI/4-U/2)/Math.pow((1-Oe)/(1+Oe),ue/2);return U=-R*Math.log(Math.max(nt,1e-10)),new xt(f.lng*x*R,U)},unproject:function(f){for(var x=180/Math.PI,R=this.R,U=this.R_MINOR/R,K=Math.sqrt(1-U*U),ue=Math.exp(-f.y/R),Oe=Math.PI/2-2*Math.atan(ue),nt=0,mt=.1,Rt;nt<15&&Math.abs(mt)>1e-7;nt++)Rt=K*Math.sin(Oe),Rt=Math.pow((1-Rt)/(1+Rt),K/2),mt=Math.PI/2-2*Math.atan(ue*Rt)-Oe,Oe+=mt;return new an(Oe*x,f.x*x/R)}},As={__proto__:null,LonLat:Ua,Mercator:Ws,SphericalMercator:co},Lo=h({},qn,{code:"EPSG:3395",projection:Ws,transformation:(function(){var f=.5/(Math.PI*Ws.R);return Or(f,.5,-f,.5)})()}),yo=h({},qn,{code:"EPSG:4326",projection:Ua,transformation:Or(1/180,1,-1/180,.5)}),Gd=h({},Ci,{projection:Ua,transformation:Or(1,0,-1,0),scale:function(f){return Math.pow(2,f)},zoom:function(f){return Math.log(f)/Math.LN2},distance:function(f,x){var R=x.lng-f.lng,U=x.lat-f.lat;return Math.sqrt(R*R+U*U)},infinite:!0});Ci.Earth=qn,Ci.EPSG3395=Lo,Ci.EPSG3857=Pi,Ci.EPSG900913=er,Ci.EPSG4326=yo,Ci.Simple=Gd;var Xs=Zt.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(f){return f.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(f){return f&&f.removeLayer(this),this},getPane:function(f){return this._map.getPane(f?this.options[f]||f:this.options.pane)},addInteractiveTarget:function(f){return this._map._targets[C(f)]=this,this},removeInteractiveTarget:function(f){return delete this._map._targets[C(f)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(f){var x=f.target;if(x.hasLayer(this)){if(this._map=x,this._zoomAnimated=x._zoomAnimated,this.getEvents){var R=this.getEvents();x.on(R,this),this.once("remove",function(){x.off(R,this)},this)}this.onAdd(x),this.fire("add"),x.fire("layeradd",{layer:this})}}});Xn.include({addLayer:function(f){if(!f._layerAdd)throw new Error("The provided object is not a Layer.");var x=C(f);return this._layers[x]?this:(this._layers[x]=f,f._mapToAdd=this,f.beforeAdd&&f.beforeAdd(this),this.whenReady(f._layerAdd,f),this)},removeLayer:function(f){var x=C(f);return this._layers[x]?(this._loaded&&f.onRemove(this),delete this._layers[x],this._loaded&&(this.fire("layerremove",{layer:f}),f.fire("remove")),f._map=f._mapToAdd=null,this):this},hasLayer:function(f){return C(f)in this._layers},eachLayer:function(f,x){for(var R in this._layers)f.call(x,this._layers[R]);return this},_addLayers:function(f){f=f?Xe(f)?f:[f]:[];for(var x=0,R=f.length;x<R;x++)this.addLayer(f[x])},_addZoomLimit:function(f){(!isNaN(f.options.maxZoom)||!isNaN(f.options.minZoom))&&(this._zoomBoundLayers[C(f)]=f,this._updateZoomLevels())},_removeZoomLimit:function(f){var x=C(f);this._zoomBoundLayers[x]&&(delete this._zoomBoundLayers[x],this._updateZoomLevels())},_updateZoomLevels:function(){var f=1/0,x=-1/0,R=this._getZoomSpan();for(var U in this._zoomBoundLayers){var K=this._zoomBoundLayers[U].options;f=K.minZoom===void 0?f:Math.min(f,K.minZoom),x=K.maxZoom===void 0?x:Math.max(x,K.maxZoom)}this._layersMaxZoom=x===-1/0?void 0:x,this._layersMinZoom=f===1/0?void 0:f,R!==this._getZoomSpan()&&this.fire("zoomlevelschange"),this.options.maxZoom===void 0&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),this.options.minZoom===void 0&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var fu=Xs.extend({initialize:function(f,x){xe(this,x),this._layers={};var R,U;if(f)for(R=0,U=f.length;R<U;R++)this.addLayer(f[R])},addLayer:function(f){var x=this.getLayerId(f);return this._layers[x]=f,this._map&&this._map.addLayer(f),this},removeLayer:function(f){var x=f in this._layers?f:this.getLayerId(f);return this._map&&this._layers[x]&&this._map.removeLayer(this._layers[x]),delete this._layers[x],this},hasLayer:function(f){var x=typeof f=="number"?f:this.getLayerId(f);return x in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(f){var x=Array.prototype.slice.call(arguments,1),R,U;for(R in this._layers)U=this._layers[R],U[f]&&U[f].apply(U,x);return this},onAdd:function(f){this.eachLayer(f.addLayer,f)},onRemove:function(f){this.eachLayer(f.removeLayer,f)},eachLayer:function(f,x){for(var R in this._layers)f.call(x,this._layers[R]);return this},getLayer:function(f){return this._layers[f]},getLayers:function(){var f=[];return this.eachLayer(f.push,f),f},setZIndex:function(f){return this.invoke("setZIndex",f)},getLayerId:function(f){return C(f)}}),nd=function(f,x){return new fu(f,x)},ts=fu.extend({addLayer:function(f){return this.hasLayer(f)?this:(f.addEventParent(this),fu.prototype.addLayer.call(this,f),this.fire("layeradd",{layer:f}))},removeLayer:function(f){return this.hasLayer(f)?(f in this._layers&&(f=this._layers[f]),f.removeEventParent(this),fu.prototype.removeLayer.call(this,f),this.fire("layerremove",{layer:f})):this},setStyle:function(f){return this.invoke("setStyle",f)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var f=new zt;for(var x in this._layers){var R=this._layers[x];f.extend(R.getBounds?R.getBounds():R.getLatLng())}return f}}),ju=function(f,x){return new ts(f,x)},Al=Bn.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(f){xe(this,f)},createIcon:function(f){return this._createIcon("icon",f)},createShadow:function(f){return this._createIcon("shadow",f)},_createIcon:function(f,x){var R=this._getIconUrl(f);if(!R){if(f==="icon")throw new Error("iconUrl not set in Icon options (see the docs).");return null}var U=this._createImg(R,x&&x.tagName==="IMG"?x:null);return this._setIconStyles(U,f),(this.options.crossOrigin||this.options.crossOrigin==="")&&(U.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),U},_setIconStyles:function(f,x){var R=this.options,U=R[x+"Size"];typeof U=="number"&&(U=[U,U]);var K=Ie(U),ue=Ie(x==="shadow"&&R.shadowAnchor||R.iconAnchor||K&&K.divideBy(2,!0));f.className="leaflet-marker-"+x+" "+(R.className||""),ue&&(f.style.marginLeft=-ue.x+"px",f.style.marginTop=-ue.y+"px"),K&&(f.style.width=K.x+"px",f.style.height=K.y+"px")},_createImg:function(f,x){return x=x||document.createElement("img"),x.src=f,x},_getIconUrl:function(f){return Qt.retina&&this.options[f+"RetinaUrl"]||this.options[f+"Url"]}});function Sc(f){return new Al(f)}var pu=Al.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(f){return typeof pu.imagePath!="string"&&(pu.imagePath=this._detectIconPath()),(this.options.imagePath||pu.imagePath)+Al.prototype._getIconUrl.call(this,f)},_stripUrl:function(f){var x=function(R,U,K){var ue=U.exec(R);return ue&&ue[K]};return f=x(f,/^url\((['"])?(.+)\1\)$/,2),f&&x(f,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var f=ci("div","leaflet-default-icon-path",document.body),x=fo(f,"background-image")||fo(f,"backgroundImage");if(document.body.removeChild(f),x=this._stripUrl(x),x)return x;var R=document.querySelector('link[href$="leaflet.css"]');return R?R.href.substring(0,R.href.length-11-1):""}}),Il=Ss.extend({initialize:function(f){this._marker=f},addHooks:function(){var f=this._marker._icon;this._draggable||(this._draggable=new es(f,f,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),cn(f,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&Si(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(f){var x=this._marker,R=x._map,U=this._marker.options.autoPanSpeed,K=this._marker.options.autoPanPadding,ue=Ya(x._icon),Oe=R.getPixelBounds(),nt=R.getPixelOrigin(),mt=Dt(Oe.min._subtract(nt).add(K),Oe.max._subtract(nt).subtract(K));if(!mt.contains(ue)){var Rt=Ie((Math.max(mt.max.x,ue.x)-mt.max.x)/(Oe.max.x-mt.max.x)-(Math.min(mt.min.x,ue.x)-mt.min.x)/(Oe.min.x-mt.min.x),(Math.max(mt.max.y,ue.y)-mt.max.y)/(Oe.max.y-mt.max.y)-(Math.min(mt.min.y,ue.y)-mt.min.y)/(Oe.min.y-mt.min.y)).multiplyBy(U);R.panBy(Rt,{animate:!1}),this._draggable._newPos._add(Rt),this._draggable._startPos._add(Rt),Ir(x._icon,this._draggable._newPos),this._onDrag(f),this._panRequest=De(this._adjustPan.bind(this,f))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(f){this._marker.options.autoPan&&($e(this._panRequest),this._panRequest=De(this._adjustPan.bind(this,f)))},_onDrag:function(f){var x=this._marker,R=x._shadow,U=Ya(x._icon),K=x._map.layerPointToLatLng(U);R&&Ir(R,U),x._latlng=K,f.latlng=K,f.oldLatLng=this._oldLatLng,x.fire("move",f).fire("drag",f)},_onDragEnd:function(f){$e(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",f)}}),Xl=Xs.extend({options:{icon:new pu,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(f,x){xe(this,x),this._latlng=Ft(f)},onAdd:function(f){this._zoomAnimated=this._zoomAnimated&&f.options.markerZoomAnimation,this._zoomAnimated&&f.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(f){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&f.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(f){var x=this._latlng;return this._latlng=Ft(f),this.update(),this.fire("move",{oldLatLng:x,latlng:this._latlng})},setZIndexOffset:function(f){return this.options.zIndexOffset=f,this.update()},getIcon:function(){return this.options.icon},setIcon:function(f){return this.options.icon=f,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var f=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(f)}return this},_initIcon:function(){var f=this.options,x="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),R=f.icon.createIcon(this._icon),U=!1;R!==this._icon&&(this._icon&&this._removeIcon(),U=!0,f.title&&(R.title=f.title),R.tagName==="IMG"&&(R.alt=f.alt||"")),cn(R,x),f.keyboard&&(R.tabIndex="0",R.setAttribute("role","button")),this._icon=R,f.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&fn(R,"focus",this._panOnFocus,this);var K=f.icon.createShadow(this._shadow),ue=!1;K!==this._shadow&&(this._removeShadow(),ue=!0),K&&(cn(K,x),K.alt=""),this._shadow=K,f.opacity<1&&this._updateOpacity(),U&&this.getPane().appendChild(this._icon),this._initInteraction(),K&&ue&&this.getPane(f.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&bn(this._icon,"focus",this._panOnFocus,this),pi(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&pi(this._shadow),this._shadow=null},_setPos:function(f){this._icon&&Ir(this._icon,f),this._shadow&&Ir(this._shadow,f),this._zIndex=f.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(f){this._icon&&(this._icon.style.zIndex=this._zIndex+f)},_animateZoom:function(f){var x=this._map._latLngToNewLayerPoint(this._latlng,f.zoom,f.center).round();this._setPos(x)},_initInteraction:function(){if(this.options.interactive&&(cn(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),Il)){var f=this.options.draggable;this.dragging&&(f=this.dragging.enabled(),this.dragging.disable()),this.dragging=new Il(this),f&&this.dragging.enable()}},setOpacity:function(f){return this.options.opacity=f,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var f=this.options.opacity;this._icon&&ga(this._icon,f),this._shadow&&ga(this._shadow,f)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var f=this._map;if(f){var x=this.options.icon.options,R=x.iconSize?Ie(x.iconSize):Ie(0,0),U=x.iconAnchor?Ie(x.iconAnchor):Ie(0,0);f.panInside(this._latlng,{paddingTopLeft:U,paddingBottomRight:R.subtract(U)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});function Ec(f,x){return new Xl(f,x)}var Ks=Xs.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(f){this._renderer=f.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(f){return xe(this,f),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&f&&Object.prototype.hasOwnProperty.call(f,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),Ac=Ks.extend({options:{fill:!0,radius:10},initialize:function(f,x){xe(this,x),this._latlng=Ft(f),this._radius=this.options.radius},setLatLng:function(f){var x=this._latlng;return this._latlng=Ft(f),this.redraw(),this.fire("move",{oldLatLng:x,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(f){return this.options.radius=this._radius=f,this.redraw()},getRadius:function(){return this._radius},setStyle:function(f){var x=f&&f.radius||this._radius;return Ks.prototype.setStyle.call(this,f),this.setRadius(x),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var f=this._radius,x=this._radiusY||f,R=this._clickTolerance(),U=[f+R,x+R];this._pxBounds=new lt(this._point.subtract(U),this._point.add(U))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(f){return f.distanceTo(this._point)<=this._radius+this._clickTolerance()}});function qu(f,x){return new Ac(f,x)}var hh=Ac.extend({initialize:function(f,x,R){if(typeof x=="number"&&(x=h({},R,{radius:x})),xe(this,x),this._latlng=Ft(f),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(f){return this._mRadius=f,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var f=[this._radius,this._radiusY||this._radius];return new zt(this._map.layerPointToLatLng(this._point.subtract(f)),this._map.layerPointToLatLng(this._point.add(f)))},setStyle:Ks.prototype.setStyle,_project:function(){var f=this._latlng.lng,x=this._latlng.lat,R=this._map,U=R.options.crs;if(U.distance===qn.distance){var K=Math.PI/180,ue=this._mRadius/qn.R/K,Oe=R.project([x+ue,f]),nt=R.project([x-ue,f]),mt=Oe.add(nt).divideBy(2),Rt=R.unproject(mt).lat,Jt=Math.acos((Math.cos(ue*K)-Math.sin(x*K)*Math.sin(Rt*K))/(Math.cos(x*K)*Math.cos(Rt*K)))/K;(isNaN(Jt)||Jt===0)&&(Jt=ue/Math.cos(Math.PI/180*x)),this._point=mt.subtract(R.getPixelOrigin()),this._radius=isNaN(Jt)?0:mt.x-R.project([Rt,f-Jt]).x,this._radiusY=mt.y-Oe.y}else{var on=U.unproject(U.project(this._latlng).subtract([this._mRadius,0]));this._point=R.latLngToLayerPoint(this._latlng),this._radius=this._point.x-R.latLngToLayerPoint(on).x}this._updateBounds()}});function Zf(f,x,R){return new hh(f,x,R)}var Qo=Ks.extend({options:{smoothFactor:1,noClip:!1},initialize:function(f,x){xe(this,x),this._setLatLngs(f)},getLatLngs:function(){return this._latlngs},setLatLngs:function(f){return this._setLatLngs(f),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(f){for(var x=1/0,R=null,U=kn,K,ue,Oe=0,nt=this._parts.length;Oe<nt;Oe++)for(var mt=this._parts[Oe],Rt=1,Jt=mt.length;Rt<Jt;Rt++){K=mt[Rt-1],ue=mt[Rt];var on=U(f,K,ue,!0);on<x&&(x=on,R=U(f,K,ue))}return R&&(R.distance=Math.sqrt(x)),R},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return ur(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(f,x){return x=x||this._defaultShape(),f=Ft(f),x.push(f),this._bounds.extend(f),this.redraw()},_setLatLngs:function(f){this._bounds=new zt,this._latlngs=this._convertLatLngs(f)},_defaultShape:function(){return $n(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(f){for(var x=[],R=$n(f),U=0,K=f.length;U<K;U++)R?(x[U]=Ft(f[U]),this._bounds.extend(x[U])):x[U]=this._convertLatLngs(f[U]);return x},_project:function(){var f=new lt;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,f),this._bounds.isValid()&&f.isValid()&&(this._rawPxBounds=f,this._updateBounds())},_updateBounds:function(){var f=this._clickTolerance(),x=new xt(f,f);this._rawPxBounds&&(this._pxBounds=new lt([this._rawPxBounds.min.subtract(x),this._rawPxBounds.max.add(x)]))},_projectLatlngs:function(f,x,R){var U=f[0]instanceof an,K=f.length,ue,Oe;if(U){for(Oe=[],ue=0;ue<K;ue++)Oe[ue]=this._map.latLngToLayerPoint(f[ue]),R.extend(Oe[ue]);x.push(Oe)}else for(ue=0;ue<K;ue++)this._projectLatlngs(f[ue],x,R)},_clipPoints:function(){var f=this._renderer._bounds;if(this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(f))){if(this.options.noClip){this._parts=this._rings;return}var x=this._parts,R,U,K,ue,Oe,nt,mt;for(R=0,K=0,ue=this._rings.length;R<ue;R++)for(mt=this._rings[R],U=0,Oe=mt.length;U<Oe-1;U++)nt=ye(mt[U],mt[U+1],f,U,!0),nt&&(x[K]=x[K]||[],x[K].push(nt[0]),(nt[1]!==mt[U+1]||U===Oe-2)&&(x[K].push(nt[1]),K++))}},_simplifyPoints:function(){for(var f=this._parts,x=this.options.smoothFactor,R=0,U=f.length;R<U;R++)f[R]=Ai(f[R],x)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(f,x){var R,U,K,ue,Oe,nt,mt=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(f))return!1;for(R=0,ue=this._parts.length;R<ue;R++)for(nt=this._parts[R],U=0,Oe=nt.length,K=Oe-1;U<Oe;K=U++)if(!(!x&&U===0)&&hu(f,nt[K],nt[U])<=mt)return!0;return!1}});function Zd(f,x){return new Qo(f,x)}Qo._flat=Ri;var Kl=Qo.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return ko(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(f){var x=Qo.prototype._convertLatLngs.call(this,f),R=x.length;return R>=2&&x[0]instanceof an&&x[0].equals(x[R-1])&&x.pop(),x},_setLatLngs:function(f){Qo.prototype._setLatLngs.call(this,f),$n(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return $n(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var f=this._renderer._bounds,x=this.options.weight,R=new xt(x,x);if(f=new lt(f.min.subtract(R),f.max.add(R)),this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(f))){if(this.options.noClip){this._parts=this._rings;return}for(var U=0,K=this._rings.length,ue;U<K;U++)ue=Es(this._rings[U],f,!0),ue.length&&this._parts.push(ue)}},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(f){var x=!1,R,U,K,ue,Oe,nt,mt,Rt;if(!this._pxBounds||!this._pxBounds.contains(f))return!1;for(ue=0,mt=this._parts.length;ue<mt;ue++)for(R=this._parts[ue],Oe=0,Rt=R.length,nt=Rt-1;Oe<Rt;nt=Oe++)U=R[Oe],K=R[nt],U.y>f.y!=K.y>f.y&&f.x<(K.x-U.x)*(f.y-U.y)/(K.y-U.y)+U.x&&(x=!x);return x||Qo.prototype._containsPoint.call(this,f,!0)}});function ns(f,x){return new Kl(f,x)}var Is=ts.extend({initialize:function(f,x){xe(this,x),this._layers={},f&&this.addData(f)},addData:function(f){var x=Xe(f)?f:f.features,R,U,K;if(x){for(R=0,U=x.length;R<U;R++)K=x[R],(K.geometries||K.geometry||K.features||K.coordinates)&&this.addData(K);return this}var ue=this.options;if(ue.filter&&!ue.filter(f))return this;var Oe=Yl(f,ue);return Oe?(Oe.feature=vo(f),Oe.defaultOptions=Oe.options,this.resetStyle(Oe),ue.onEachFeature&&ue.onEachFeature(f,Oe),this.addLayer(Oe)):this},resetStyle:function(f){return f===void 0?this.eachLayer(this.resetStyle,this):(f.options=h({},f.defaultOptions),this._setLayerStyle(f,this.options.style),this)},setStyle:function(f){return this.eachLayer(function(x){this._setLayerStyle(x,f)},this)},_setLayerStyle:function(f,x){f.setStyle&&(typeof x=="function"&&(x=x(f.feature)),f.setStyle(x))}});function Yl(f,x){var R=f.type==="Feature"?f.geometry:f,U=R?R.coordinates:null,K=[],ue=x&&x.pointToLayer,Oe=x&&x.coordsToLatLng||oi,nt,mt,Rt,Jt;if(!U&&!R)return null;switch(R.type){case"Point":return nt=Oe(U),Do(ue,f,nt,x);case"MultiPoint":for(Rt=0,Jt=U.length;Rt<Jt;Rt++)nt=Oe(U[Rt]),K.push(Do(ue,f,nt,x));return new ts(K);case"LineString":case"MultiLineString":return mt=mu(U,R.type==="LineString"?0:1,Oe),new Qo(mt,x);case"Polygon":case"MultiPolygon":return mt=mu(U,R.type==="Polygon"?1:2,Oe),new Kl(mt,x);case"GeometryCollection":for(Rt=0,Jt=R.geometries.length;Rt<Jt;Rt++){var on=Yl({geometry:R.geometries[Rt],type:"Feature",properties:f.properties},x);on&&K.push(on)}return new ts(K);case"FeatureCollection":for(Rt=0,Jt=R.features.length;Rt<Jt;Rt++){var _n=Yl(R.features[Rt],x);_n&&K.push(_n)}return new ts(K);default:throw new Error("Invalid GeoJSON object.")}}function Do(f,x,R,U){return f?f(x,R):new Xl(R,U&&U.markersInheritOptions&&U)}function oi(f){return new an(f[1],f[0],f[2])}function mu(f,x,R){for(var U=[],K=0,ue=f.length,Oe;K<ue;K++)Oe=x?mu(f[K],x-1,R):(R||oi)(f[K]),U.push(Oe);return U}function gu(f,x){return f=Ft(f),f.alt!==void 0?[Y(f.lng,x),Y(f.lat,x),Y(f.alt,x)]:[Y(f.lng,x),Y(f.lat,x)]}function Ic(f,x,R,U){for(var K=[],ue=0,Oe=f.length;ue<Oe;ue++)K.push(x?Ic(f[ue],$n(f[ue])?0:x-1,R,U):gu(f[ue],U));return!x&&R&&K.length>0&&K.push(K[0].slice()),K}function Ys(f,x){return f.feature?h({},f.feature,{geometry:x}):vo(x)}function vo(f){return f.type==="Feature"||f.type==="FeatureCollection"?f:{type:"Feature",properties:{},geometry:f}}var Cl={toGeoJSON:function(f){return Ys(this,{type:"Point",coordinates:gu(this.getLatLng(),f)})}};Xl.include(Cl),hh.include(Cl),Ac.include(Cl),Qo.include({toGeoJSON:function(f){var x=!$n(this._latlngs),R=Ic(this._latlngs,x?1:0,!1,f);return Ys(this,{type:(x?"Multi":"")+"LineString",coordinates:R})}}),Kl.include({toGeoJSON:function(f){var x=!$n(this._latlngs),R=x&&!$n(this._latlngs[0]),U=Ic(this._latlngs,R?2:x?1:0,!0,f);return x||(U=[U]),Ys(this,{type:(R?"Multi":"")+"Polygon",coordinates:U})}}),fu.include({toMultiPoint:function(f){var x=[];return this.eachLayer(function(R){x.push(R.toGeoJSON(f).geometry.coordinates)}),Ys(this,{type:"MultiPoint",coordinates:x})},toGeoJSON:function(f){var x=this.feature&&this.feature.geometry&&this.feature.geometry.type;if(x==="MultiPoint")return this.toMultiPoint(f);var R=x==="GeometryCollection",U=[];return this.eachLayer(function(K){if(K.toGeoJSON){var ue=K.toGeoJSON(f);if(R)U.push(ue.geometry);else{var Oe=vo(ue);Oe.type==="FeatureCollection"?U.push.apply(U,Oe.features):U.push(Oe)}}}),R?Ys(this,{geometries:U,type:"GeometryCollection"}):{type:"FeatureCollection",features:U}}});function dh(f,x){return new Is(f,x)}var Hd=dh,Jo=Xs.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(f,x,R){this._url=f,this._bounds=Xt(x),xe(this,R)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(cn(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){pi(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(f){return this.options.opacity=f,this._image&&this._updateOpacity(),this},setStyle:function(f){return f.opacity&&this.setOpacity(f.opacity),this},bringToFront:function(){return this._map&&_s(this._image),this},bringToBack:function(){return this._map&&po(this._image),this},setUrl:function(f){return this._url=f,this._image&&(this._image.src=f),this},setBounds:function(f){return this._bounds=Xt(f),this._map&&this._reset(),this},getEvents:function(){var f={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(f.zoomanim=this._animateZoom),f},setZIndex:function(f){return this.options.zIndex=f,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var f=this._url.tagName==="IMG",x=this._image=f?this._url:ci("img");if(cn(x,"leaflet-image-layer"),this._zoomAnimated&&cn(x,"leaflet-zoom-animated"),this.options.className&&cn(x,this.options.className),x.onselectstart=Z,x.onmousemove=Z,x.onload=g(this.fire,this,"load"),x.onerror=g(this._overlayOnError,this,"error"),(this.options.crossOrigin||this.options.crossOrigin==="")&&(x.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),f){this._url=x.src;return}x.src=this._url,x.alt=this.options.alt},_animateZoom:function(f){var x=this._map.getZoomScale(f.zoom),R=this._map._latLngBoundsToNewLayerBounds(this._bounds,f.zoom,f.center).min;Va(this._image,R,x)},_reset:function(){var f=this._image,x=new lt(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),R=x.getSize();Ir(f,x.min),f.style.width=R.x+"px",f.style.height=R.y+"px"},_updateOpacity:function(){ga(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var f=this.options.errorOverlayUrl;f&&this._url!==f&&(this._url=f,this._image.src=f)},getCenter:function(){return this._bounds.getCenter()}}),$u=function(f,x,R){return new Jo(f,x,R)},Cc=Jo.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var f=this._url.tagName==="VIDEO",x=this._image=f?this._url:ci("video");if(cn(x,"leaflet-image-layer"),this._zoomAnimated&&cn(x,"leaflet-zoom-animated"),this.options.className&&cn(x,this.options.className),x.onselectstart=Z,x.onmousemove=Z,x.onloadeddata=g(this.fire,this,"load"),f){for(var R=x.getElementsByTagName("source"),U=[],K=0;K<R.length;K++)U.push(R[K].src);this._url=R.length>0?U:[x.src];return}Xe(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(x.style,"objectFit")&&(x.style.objectFit="fill"),x.autoplay=!!this.options.autoplay,x.loop=!!this.options.loop,x.muted=!!this.options.muted,x.playsInline=!!this.options.playsInline;for(var ue=0;ue<this._url.length;ue++){var Oe=ci("source");Oe.src=this._url[ue],x.appendChild(Oe)}}});function Wd(f,x,R){return new Cc(f,x,R)}var Pl=Jo.extend({_initImage:function(){var f=this._image=this._url;cn(f,"leaflet-image-layer"),this._zoomAnimated&&cn(f,"leaflet-zoom-animated"),this.options.className&&cn(f,this.options.className),f.onselectstart=Z,f.onmousemove=Z}});function Pc(f,x,R){return new Pl(f,x,R)}var Cs=Xs.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(f,x){f&&(f instanceof an||Xe(f))?(this._latlng=Ft(f),xe(this,x)):(xe(this,f),this._source=x),this.options.content&&(this._content=this.options.content)},openOn:function(f){return f=arguments.length?f:this._source._map,f.hasLayer(this)||f.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(f){return this._map?this.close():(arguments.length?this._source=f:f=this._source,this._prepareOpen(),this.openOn(f._map)),this},onAdd:function(f){this._zoomAnimated=f._zoomAnimated,this._container||this._initLayout(),f._fadeAnimated&&ga(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),f._fadeAnimated&&ga(this._container,1),this.bringToFront(),this.options.interactive&&(cn(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(f){f._fadeAnimated?(ga(this._container,0),this._removeTimeout=setTimeout(g(pi,void 0,this._container),200)):pi(this._container),this.options.interactive&&(Si(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(f){return this._latlng=Ft(f),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(f){return this._content=f,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var f={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(f.zoomanim=this._animateZoom),f},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&_s(this._container),this},bringToBack:function(){return this._map&&po(this._container),this},_prepareOpen:function(f){var x=this._source;if(!x._map)return!1;if(x instanceof ts){x=null;var R=this._source._layers;for(var U in R)if(R[U]._map){x=R[U];break}if(!x)return!1;this._source=x}if(!f)if(x.getCenter)f=x.getCenter();else if(x.getLatLng)f=x.getLatLng();else if(x.getBounds)f=x.getBounds().getCenter();else throw new Error("Unable to get source layer LatLng.");return this.setLatLng(f),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var f=this._contentNode,x=typeof this._content=="function"?this._content(this._source||this):this._content;if(typeof x=="string")f.innerHTML=x;else{for(;f.hasChildNodes();)f.removeChild(f.firstChild);f.appendChild(x)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var f=this._map.latLngToLayerPoint(this._latlng),x=Ie(this.options.offset),R=this._getAnchor();this._zoomAnimated?Ir(this._container,f.add(R)):x=x.add(f).add(R);var U=this._containerBottom=-x.y,K=this._containerLeft=-Math.round(this._containerWidth/2)+x.x;this._container.style.bottom=U+"px",this._container.style.left=K+"px"}},_getAnchor:function(){return[0,0]}});Xn.include({_initOverlay:function(f,x,R,U){var K=x;return K instanceof f||(K=new f(U).setContent(x)),R&&K.setLatLng(R),K}}),Xs.include({_initOverlay:function(f,x,R,U){var K=R;return K instanceof f?(xe(K,U),K._source=this):(K=x&&!U?x:new f(U,this),K.setContent(R)),K}});var Ql=Cs.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(f){return f=arguments.length?f:this._source._map,!f.hasLayer(this)&&f._popup&&f._popup.options.autoClose&&f.removeLayer(f._popup),f._popup=this,Cs.prototype.openOn.call(this,f)},onAdd:function(f){Cs.prototype.onAdd.call(this,f),f.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof Ks||this._source.on("preclick",Tn))},onRemove:function(f){Cs.prototype.onRemove.call(this,f),f.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof Ks||this._source.off("preclick",Tn))},getEvents:function(){var f=Cs.prototype.getEvents.call(this);return(this.options.closeOnClick!==void 0?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(f.preclick=this.close),this.options.keepInView&&(f.moveend=this._adjustPan),f},_initLayout:function(){var f="leaflet-popup",x=this._container=ci("div",f+" "+(this.options.className||"")+" leaflet-zoom-animated"),R=this._wrapper=ci("div",f+"-content-wrapper",x);if(this._contentNode=ci("div",f+"-content",R),pn(x),bs(this._contentNode),fn(x,"contextmenu",Tn),this._tipContainer=ci("div",f+"-tip-container",x),this._tip=ci("div",f+"-tip",this._tipContainer),this.options.closeButton){var U=this._closeButton=ci("a",f+"-close-button",x);U.setAttribute("role","button"),U.setAttribute("aria-label","Close popup"),U.href="#close",U.innerHTML='<span aria-hidden="true">&#215;</span>',fn(U,"click",function(K){sn(K),this.close()},this)}},_updateLayout:function(){var f=this._contentNode,x=f.style;x.width="",x.whiteSpace="nowrap";var R=f.offsetWidth;R=Math.min(R,this.options.maxWidth),R=Math.max(R,this.options.minWidth),x.width=R+1+"px",x.whiteSpace="",x.height="";var U=f.offsetHeight,K=this.options.maxHeight,ue="leaflet-popup-scrolled";K&&U>K?(x.height=K+"px",cn(f,ue)):Si(f,ue),this._containerWidth=this._container.offsetWidth},_animateZoom:function(f){var x=this._map._latLngToNewLayerPoint(this._latlng,f.zoom,f.center),R=this._getAnchor();Ir(this._container,x.add(R))},_adjustPan:function(){if(this.options.autoPan){if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning){this._autopanning=!1;return}var f=this._map,x=parseInt(fo(this._container,"marginBottom"),10)||0,R=this._container.offsetHeight+x,U=this._containerWidth,K=new xt(this._containerLeft,-R-this._containerBottom);K._add(Ya(this._container));var ue=f.layerPointToContainerPoint(K),Oe=Ie(this.options.autoPanPadding),nt=Ie(this.options.autoPanPaddingTopLeft||Oe),mt=Ie(this.options.autoPanPaddingBottomRight||Oe),Rt=f.getSize(),Jt=0,on=0;ue.x+U+mt.x>Rt.x&&(Jt=ue.x+U-Rt.x+mt.x),ue.x-Jt-nt.x<0&&(Jt=ue.x-nt.x),ue.y+R+mt.y>Rt.y&&(on=ue.y+R-Rt.y+mt.y),ue.y-on-nt.y<0&&(on=ue.y-nt.y),(Jt||on)&&(this.options.keepInView&&(this._autopanning=!0),f.fire("autopanstart").panBy([Jt,on]))}},_getAnchor:function(){return Ie(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),id=function(f,x){return new Ql(f,x)};Xn.mergeOptions({closePopupOnClick:!0}),Xn.include({openPopup:function(f,x,R){return this._initOverlay(Ql,f,x,R).openOn(this),this},closePopup:function(f){return f=arguments.length?f:this._popup,f&&f.close(),this}}),Xs.include({bindPopup:function(f,x){return this._popup=this._initOverlay(Ql,this._popup,f,x),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(f){return this._popup&&(this instanceof ts||(this._popup._source=this),this._popup._prepareOpen(f||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return this._popup?this._popup.isOpen():!1},setPopupContent:function(f){return this._popup&&this._popup.setContent(f),this},getPopup:function(){return this._popup},_openPopup:function(f){if(!(!this._popup||!this._map)){$r(f);var x=f.layer||f.target;if(this._popup._source===x&&!(x instanceof Ks)){this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(f.latlng);return}this._popup._source=x,this.openPopup(f.latlng)}},_movePopup:function(f){this._popup.setLatLng(f.latlng)},_onKeyPress:function(f){f.originalEvent.keyCode===13&&this._openPopup(f)}});var el=Cs.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(f){Cs.prototype.onAdd.call(this,f),this.setOpacity(this.options.opacity),f.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(f){Cs.prototype.onRemove.call(this,f),f.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var f=Cs.prototype.getEvents.call(this);return this.options.permanent||(f.preclick=this.close),f},_initLayout:function(){var f="leaflet-tooltip",x=f+" "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=ci("div",x),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+C(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(f){var x,R,U=this._map,K=this._container,ue=U.latLngToContainerPoint(U.getCenter()),Oe=U.layerPointToContainerPoint(f),nt=this.options.direction,mt=K.offsetWidth,Rt=K.offsetHeight,Jt=Ie(this.options.offset),on=this._getAnchor();nt==="top"?(x=mt/2,R=Rt):nt==="bottom"?(x=mt/2,R=0):nt==="center"?(x=mt/2,R=Rt/2):nt==="right"?(x=0,R=Rt/2):nt==="left"?(x=mt,R=Rt/2):Oe.x<ue.x?(nt="right",x=0,R=Rt/2):(nt="left",x=mt+(Jt.x+on.x)*2,R=Rt/2),f=f.subtract(Ie(x,R,!0)).add(Jt).add(on),Si(K,"leaflet-tooltip-right"),Si(K,"leaflet-tooltip-left"),Si(K,"leaflet-tooltip-top"),Si(K,"leaflet-tooltip-bottom"),cn(K,"leaflet-tooltip-"+nt),Ir(K,f)},_updatePosition:function(){var f=this._map.latLngToLayerPoint(this._latlng);this._setPosition(f)},setOpacity:function(f){this.options.opacity=f,this._container&&ga(this._container,f)},_animateZoom:function(f){var x=this._map._latLngToNewLayerPoint(this._latlng,f.zoom,f.center);this._setPosition(x)},_getAnchor:function(){return Ie(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),Mc=function(f,x){return new el(f,x)};Xn.include({openTooltip:function(f,x,R){return this._initOverlay(el,f,x,R).openOn(this),this},closeTooltip:function(f){return f.close(),this}}),Xs.include({bindTooltip:function(f,x){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(el,this._tooltip,f,x),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(f){if(!(!f&&this._tooltipHandlersAdded)){var x=f?"off":"on",R={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?R.add=this._openTooltip:(R.mouseover=this._openTooltip,R.mouseout=this.closeTooltip,R.click=this._openTooltip,this._map?this._addFocusListeners():R.add=this._addFocusListeners),this._tooltip.options.sticky&&(R.mousemove=this._moveTooltip),this[x](R),this._tooltipHandlersAdded=!f}},openTooltip:function(f){return this._tooltip&&(this instanceof ts||(this._tooltip._source=this),this._tooltip._prepareOpen(f)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(f){return this._tooltip&&this._tooltip.setContent(f),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(f){var x=typeof f.getElement=="function"&&f.getElement();x&&(fn(x,"focus",function(){this._tooltip._source=f,this.openTooltip()},this),fn(x,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(f){var x=typeof f.getElement=="function"&&f.getElement();x&&x.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(f){if(!(!this._tooltip||!this._map)){if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var x=this;this._map.once("moveend",function(){x._openOnceFlag=!1,x._openTooltip(f)});return}this._tooltip._source=f.layer||f.target,this.openTooltip(this._tooltip.options.sticky?f.latlng:void 0)}},_moveTooltip:function(f){var x=f.latlng,R,U;this._tooltip.options.sticky&&f.originalEvent&&(R=this._map.mouseEventToContainerPoint(f.originalEvent),U=this._map.containerPointToLayerPoint(R),x=this._map.layerPointToLatLng(U)),this._tooltip.setLatLng(x)}});var Jl=Al.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(f){var x=f&&f.tagName==="DIV"?f:document.createElement("div"),R=this.options;if(R.html instanceof Element?(Ti(x),x.appendChild(R.html)):x.innerHTML=R.html!==!1?R.html:"",R.bgPos){var U=Ie(R.bgPos);x.style.backgroundPosition=-U.x+"px "+-U.y+"px"}return this._setIconStyles(x,"icon"),x},createShadow:function(){return null}});function Qs(f){return new Jl(f)}Al.Default=pu;var eu=Xs.extend({options:{tileSize:256,opacity:1,updateWhenIdle:Qt.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(f){xe(this,f)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(f){f._addZoomLimit(this)},onRemove:function(f){this._removeAllTiles(),pi(this._container),f._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(_s(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(po(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(f){return this.options.opacity=f,this._updateOpacity(),this},setZIndex:function(f){return this.options.zIndex=f,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var f=this._clampZoom(this._map.getZoom());f!==this._tileZoom&&(this._tileZoom=f,this._updateLevels()),this._update()}return this},getEvents:function(){var f={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=k(this._onMoveEnd,this.options.updateInterval,this)),f.move=this._onMove),this._zoomAnimated&&(f.zoomanim=this._animateZoom),f},createTile:function(){return document.createElement("div")},getTileSize:function(){var f=this.options.tileSize;return f instanceof xt?f:new xt(f,f)},_updateZIndex:function(){this._container&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(f){for(var x=this.getPane().children,R=-f(-1/0,1/0),U=0,K=x.length,ue;U<K;U++)ue=x[U].style.zIndex,x[U]!==this._container&&ue&&(R=f(R,+ue));isFinite(R)&&(this.options.zIndex=R+f(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!Qt.ielt9){ga(this._container,this.options.opacity);var f=+new Date,x=!1,R=!1;for(var U in this._tiles){var K=this._tiles[U];if(!(!K.current||!K.loaded)){var ue=Math.min(1,(f-K.loaded)/200);ga(K.el,ue),ue<1?x=!0:(K.active?R=!0:this._onOpaqueTile(K),K.active=!0)}}R&&!this._noPrune&&this._pruneTiles(),x&&($e(this._fadeFrame),this._fadeFrame=De(this._updateOpacity,this))}},_onOpaqueTile:Z,_initContainer:function(){this._container||(this._container=ci("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var f=this._tileZoom,x=this.options.maxZoom;if(f!==void 0){for(var R in this._levels)R=Number(R),this._levels[R].el.children.length||R===f?(this._levels[R].el.style.zIndex=x-Math.abs(f-R),this._onUpdateLevel(R)):(pi(this._levels[R].el),this._removeTilesAtZoom(R),this._onRemoveLevel(R),delete this._levels[R]);var U=this._levels[f],K=this._map;return U||(U=this._levels[f]={},U.el=ci("div","leaflet-tile-container leaflet-zoom-animated",this._container),U.el.style.zIndex=x,U.origin=K.project(K.unproject(K.getPixelOrigin()),f).round(),U.zoom=f,this._setZoomTransform(U,K.getCenter(),K.getZoom()),Z(U.el.offsetWidth),this._onCreateLevel(U)),this._level=U,U}},_onUpdateLevel:Z,_onRemoveLevel:Z,_onCreateLevel:Z,_pruneTiles:function(){if(this._map){var f,x,R=this._map.getZoom();if(R>this.options.maxZoom||R<this.options.minZoom){this._removeAllTiles();return}for(f in this._tiles)x=this._tiles[f],x.retain=x.current;for(f in this._tiles)if(x=this._tiles[f],x.current&&!x.active){var U=x.coords;this._retainParent(U.x,U.y,U.z,U.z-5)||this._retainChildren(U.x,U.y,U.z,U.z+2)}for(f in this._tiles)this._tiles[f].retain||this._removeTile(f)}},_removeTilesAtZoom:function(f){for(var x in this._tiles)this._tiles[x].coords.z===f&&this._removeTile(x)},_removeAllTiles:function(){for(var f in this._tiles)this._removeTile(f)},_invalidateAll:function(){for(var f in this._levels)pi(this._levels[f].el),this._onRemoveLevel(Number(f)),delete this._levels[f];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(f,x,R,U){var K=Math.floor(f/2),ue=Math.floor(x/2),Oe=R-1,nt=new xt(+K,+ue);nt.z=+Oe;var mt=this._tileCoordsToKey(nt),Rt=this._tiles[mt];return Rt&&Rt.active?(Rt.retain=!0,!0):(Rt&&Rt.loaded&&(Rt.retain=!0),Oe>U?this._retainParent(K,ue,Oe,U):!1)},_retainChildren:function(f,x,R,U){for(var K=2*f;K<2*f+2;K++)for(var ue=2*x;ue<2*x+2;ue++){var Oe=new xt(K,ue);Oe.z=R+1;var nt=this._tileCoordsToKey(Oe),mt=this._tiles[nt];if(mt&&mt.active){mt.retain=!0;continue}else mt&&mt.loaded&&(mt.retain=!0);R+1<U&&this._retainChildren(K,ue,R+1,U)}},_resetView:function(f){var x=f&&(f.pinch||f.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),x,x)},_animateZoom:function(f){this._setView(f.center,f.zoom,!0,f.noUpdate)},_clampZoom:function(f){var x=this.options;return x.minNativeZoom!==void 0&&f<x.minNativeZoom?x.minNativeZoom:x.maxNativeZoom!==void 0&&x.maxNativeZoom<f?x.maxNativeZoom:f},_setView:function(f,x,R,U){var K=Math.round(x);this.options.maxZoom!==void 0&&K>this.options.maxZoom||this.options.minZoom!==void 0&&K<this.options.minZoom?K=void 0:K=this._clampZoom(K);var ue=this.options.updateWhenZooming&&K!==this._tileZoom;(!U||ue)&&(this._tileZoom=K,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),K!==void 0&&this._update(f),R||this._pruneTiles(),this._noPrune=!!R),this._setZoomTransforms(f,x)},_setZoomTransforms:function(f,x){for(var R in this._levels)this._setZoomTransform(this._levels[R],f,x)},_setZoomTransform:function(f,x,R){var U=this._map.getZoomScale(R,f.zoom),K=f.origin.multiplyBy(U).subtract(this._map._getNewPixelOrigin(x,R)).round();Qt.any3d?Va(f.el,K,U):Ir(f.el,K)},_resetGrid:function(){var f=this._map,x=f.options.crs,R=this._tileSize=this.getTileSize(),U=this._tileZoom,K=this._map.getPixelWorldBounds(this._tileZoom);K&&(this._globalTileRange=this._pxBoundsToTileRange(K)),this._wrapX=x.wrapLng&&!this.options.noWrap&&[Math.floor(f.project([0,x.wrapLng[0]],U).x/R.x),Math.ceil(f.project([0,x.wrapLng[1]],U).x/R.y)],this._wrapY=x.wrapLat&&!this.options.noWrap&&[Math.floor(f.project([x.wrapLat[0],0],U).y/R.x),Math.ceil(f.project([x.wrapLat[1],0],U).y/R.y)]},_onMoveEnd:function(){!this._map||this._map._animatingZoom||this._update()},_getTiledPixelBounds:function(f){var x=this._map,R=x._animatingZoom?Math.max(x._animateToZoom,x.getZoom()):x.getZoom(),U=x.getZoomScale(R,this._tileZoom),K=x.project(f,this._tileZoom).floor(),ue=x.getSize().divideBy(U*2);return new lt(K.subtract(ue),K.add(ue))},_update:function(f){var x=this._map;if(x){var R=this._clampZoom(x.getZoom());if(f===void 0&&(f=x.getCenter()),this._tileZoom!==void 0){var U=this._getTiledPixelBounds(f),K=this._pxBoundsToTileRange(U),ue=K.getCenter(),Oe=[],nt=this.options.keepBuffer,mt=new lt(K.getBottomLeft().subtract([nt,-nt]),K.getTopRight().add([nt,-nt]));if(!(isFinite(K.min.x)&&isFinite(K.min.y)&&isFinite(K.max.x)&&isFinite(K.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var Rt in this._tiles){var Jt=this._tiles[Rt].coords;(Jt.z!==this._tileZoom||!mt.contains(new xt(Jt.x,Jt.y)))&&(this._tiles[Rt].current=!1)}if(Math.abs(R-this._tileZoom)>1){this._setView(f,R);return}for(var on=K.min.y;on<=K.max.y;on++)for(var _n=K.min.x;_n<=K.max.x;_n++){var Zn=new xt(_n,on);if(Zn.z=this._tileZoom,!!this._isValidTile(Zn)){var cr=this._tiles[this._tileCoordsToKey(Zn)];cr?cr.current=!0:Oe.push(Zn)}}if(Oe.sort(function(_a,wo){return _a.distanceTo(ue)-wo.distanceTo(ue)}),Oe.length!==0){this._loading||(this._loading=!0,this.fire("loading"));var mr=document.createDocumentFragment();for(_n=0;_n<Oe.length;_n++)this._addTile(Oe[_n],mr);this._level.el.appendChild(mr)}}}},_isValidTile:function(f){var x=this._map.options.crs;if(!x.infinite){var R=this._globalTileRange;if(!x.wrapLng&&(f.x<R.min.x||f.x>R.max.x)||!x.wrapLat&&(f.y<R.min.y||f.y>R.max.y))return!1}if(!this.options.bounds)return!0;var U=this._tileCoordsToBounds(f);return Xt(this.options.bounds).overlaps(U)},_keyToBounds:function(f){return this._tileCoordsToBounds(this._keyToTileCoords(f))},_tileCoordsToNwSe:function(f){var x=this._map,R=this.getTileSize(),U=f.scaleBy(R),K=U.add(R),ue=x.unproject(U,f.z),Oe=x.unproject(K,f.z);return[ue,Oe]},_tileCoordsToBounds:function(f){var x=this._tileCoordsToNwSe(f),R=new zt(x[0],x[1]);return this.options.noWrap||(R=this._map.wrapLatLngBounds(R)),R},_tileCoordsToKey:function(f){return f.x+":"+f.y+":"+f.z},_keyToTileCoords:function(f){var x=f.split(":"),R=new xt(+x[0],+x[1]);return R.z=+x[2],R},_removeTile:function(f){var x=this._tiles[f];x&&(pi(x.el),delete this._tiles[f],this.fire("tileunload",{tile:x.el,coords:this._keyToTileCoords(f)}))},_initTile:function(f){cn(f,"leaflet-tile");var x=this.getTileSize();f.style.width=x.x+"px",f.style.height=x.y+"px",f.onselectstart=Z,f.onmousemove=Z,Qt.ielt9&&this.options.opacity<1&&ga(f,this.options.opacity)},_addTile:function(f,x){var R=this._getTilePos(f),U=this._tileCoordsToKey(f),K=this.createTile(this._wrapCoords(f),g(this._tileReady,this,f));this._initTile(K),this.createTile.length<2&&De(g(this._tileReady,this,f,null,K)),Ir(K,R),this._tiles[U]={el:K,coords:f,current:!0},x.appendChild(K),this.fire("tileloadstart",{tile:K,coords:f})},_tileReady:function(f,x,R){x&&this.fire("tileerror",{error:x,tile:R,coords:f});var U=this._tileCoordsToKey(f);R=this._tiles[U],R&&(R.loaded=+new Date,this._map._fadeAnimated?(ga(R.el,0),$e(this._fadeFrame),this._fadeFrame=De(this._updateOpacity,this)):(R.active=!0,this._pruneTiles()),x||(cn(R.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:R.el,coords:f})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),Qt.ielt9||!this._map._fadeAnimated?De(this._pruneTiles,this):setTimeout(g(this._pruneTiles,this),250)))},_getTilePos:function(f){return f.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(f){var x=new xt(this._wrapX?V(f.x,this._wrapX):f.x,this._wrapY?V(f.y,this._wrapY):f.y);return x.z=f.z,x},_pxBoundsToTileRange:function(f){var x=this.getTileSize();return new lt(f.min.unscaleBy(x).floor(),f.max.unscaleBy(x).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var f in this._tiles)if(!this._tiles[f].loaded)return!1;return!0}});function bo(f){return new eu(f)}var Ml=eu.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(f,x){this._url=f,x=xe(this,x),x.detectRetina&&Qt.retina&&x.maxZoom>0?(x.tileSize=Math.floor(x.tileSize/2),x.zoomReverse?(x.zoomOffset--,x.minZoom=Math.min(x.maxZoom,x.minZoom+1)):(x.zoomOffset++,x.maxZoom=Math.max(x.minZoom,x.maxZoom-1)),x.minZoom=Math.max(0,x.minZoom)):x.zoomReverse?x.minZoom=Math.min(x.maxZoom,x.minZoom):x.maxZoom=Math.max(x.minZoom,x.maxZoom),typeof x.subdomains=="string"&&(x.subdomains=x.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(f,x){return this._url===f&&x===void 0&&(x=!0),this._url=f,x||this.redraw(),this},createTile:function(f,x){var R=document.createElement("img");return fn(R,"load",g(this._tileOnLoad,this,x,R)),fn(R,"error",g(this._tileOnError,this,x,R)),(this.options.crossOrigin||this.options.crossOrigin==="")&&(R.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),typeof this.options.referrerPolicy=="string"&&(R.referrerPolicy=this.options.referrerPolicy),R.alt="",R.src=this.getTileUrl(f),R},getTileUrl:function(f){var x={r:Qt.retina?"@2x":"",s:this._getSubdomain(f),x:f.x,y:f.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var R=this._globalTileRange.max.y-f.y;this.options.tms&&(x.y=R),x["-y"]=R}return Qe(this._url,h(x,this.options))},_tileOnLoad:function(f,x){Qt.ielt9?setTimeout(g(f,this,null,x),0):f(null,x)},_tileOnError:function(f,x,R){var U=this.options.errorTileUrl;U&&x.getAttribute("src")!==U&&(x.src=U),f(R,x)},_onTileRemove:function(f){f.tile.onload=null},_getZoomForUrl:function(){var f=this._tileZoom,x=this.options.maxZoom,R=this.options.zoomReverse,U=this.options.zoomOffset;return R&&(f=x-f),f+U},_getSubdomain:function(f){var x=Math.abs(f.x+f.y)%this.options.subdomains.length;return this.options.subdomains[x]},_abortLoading:function(){var f,x;for(f in this._tiles)if(this._tiles[f].coords.z!==this._tileZoom&&(x=this._tiles[f].el,x.onload=Z,x.onerror=Z,!x.complete)){x.src=Ve;var R=this._tiles[f].coords;pi(x),delete this._tiles[f],this.fire("tileabort",{tile:x,coords:R})}},_removeTile:function(f){var x=this._tiles[f];if(x)return x.el.setAttribute("src",Ve),eu.prototype._removeTile.call(this,f)},_tileReady:function(f,x,R){if(!(!this._map||R&&R.getAttribute("src")===Ve))return eu.prototype._tileReady.call(this,f,x,R)}});function ua(f,x){return new Ml(f,x)}var ja=Ml.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(f,x){this._url=f;var R=h({},this.defaultWmsParams);for(var U in x)U in this.options||(R[U]=x[U]);x=xe(this,x);var K=x.detectRetina&&Qt.retina?2:1,ue=this.getTileSize();R.width=ue.x*K,R.height=ue.y*K,this.wmsParams=R},onAdd:function(f){this._crs=this.options.crs||f.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var x=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[x]=this._crs.code,Ml.prototype.onAdd.call(this,f)},getTileUrl:function(f){var x=this._tileCoordsToNwSe(f),R=this._crs,U=Dt(R.project(x[0]),R.project(x[1])),K=U.min,ue=U.max,Oe=(this._wmsVersion>=1.3&&this._crs===yo?[K.y,K.x,ue.y,ue.x]:[K.x,K.y,ue.x,ue.y]).join(","),nt=Ml.prototype.getTileUrl.call(this,f);return nt+ze(this.wmsParams,nt,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+Oe},setParams:function(f,x){return h(this.wmsParams,f),x||this.redraw(),this}});function Rl(f,x){return new ja(f,x)}Ml.WMS=ja,ua.wms=Rl;var is=Xs.extend({options:{padding:.1},initialize:function(f){xe(this,f),C(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),cn(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var f={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(f.zoomanim=this._onAnimZoom),f},_onAnimZoom:function(f){this._updateTransform(f.center,f.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(f,x){var R=this._map.getZoomScale(x,this._zoom),U=this._map.getSize().multiplyBy(.5+this.options.padding),K=this._map.project(this._center,x),ue=U.multiplyBy(-R).add(K).subtract(this._map._getNewPixelOrigin(f,x));Qt.any3d?Va(this._container,ue,R):Ir(this._container,ue)},_reset:function(){this._update(),this._updateTransform(this._center,this._zoom);for(var f in this._layers)this._layers[f]._reset()},_onZoomEnd:function(){for(var f in this._layers)this._layers[f]._project()},_updatePaths:function(){for(var f in this._layers)this._layers[f]._update()},_update:function(){var f=this.options.padding,x=this._map.getSize(),R=this._map.containerPointToLayerPoint(x.multiplyBy(-f)).round();this._bounds=new lt(R,R.add(x.multiplyBy(1+f*2)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),tu=is.extend({options:{tolerance:0},getEvents:function(){var f=is.prototype.getEvents.call(this);return f.viewprereset=this._onViewPreReset,f},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){is.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var f=this._container=document.createElement("canvas");fn(f,"mousemove",this._onMouseMove,this),fn(f,"click dblclick mousedown mouseup contextmenu",this._onClick,this),fn(f,"mouseout",this._handleMouseOut,this),f._leaflet_disable_events=!0,this._ctx=f.getContext("2d")},_destroyContainer:function(){$e(this._redrawRequest),delete this._ctx,pi(this._container),bn(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){var f;this._redrawBounds=null;for(var x in this._layers)f=this._layers[x],f._update();this._redraw()}},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){is.prototype._update.call(this);var f=this._bounds,x=this._container,R=f.getSize(),U=Qt.retina?2:1;Ir(x,f.min),x.width=U*R.x,x.height=U*R.y,x.style.width=R.x+"px",x.style.height=R.y+"px",Qt.retina&&this._ctx.scale(2,2),this._ctx.translate(-f.min.x,-f.min.y),this.fire("update")}},_reset:function(){is.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(f){this._updateDashArray(f),this._layers[C(f)]=f;var x=f._order={layer:f,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=x),this._drawLast=x,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(f){this._requestRedraw(f)},_removePath:function(f){var x=f._order,R=x.next,U=x.prev;R?R.prev=U:this._drawLast=U,U?U.next=R:this._drawFirst=R,delete f._order,delete this._layers[C(f)],this._requestRedraw(f)},_updatePath:function(f){this._extendRedrawBounds(f),f._project(),f._update(),this._requestRedraw(f)},_updateStyle:function(f){this._updateDashArray(f),this._requestRedraw(f)},_updateDashArray:function(f){if(typeof f.options.dashArray=="string"){var x=f.options.dashArray.split(/[, ]+/),R=[],U,K;for(K=0;K<x.length;K++){if(U=Number(x[K]),isNaN(U))return;R.push(U)}f.options._dashArray=R}else f.options._dashArray=f.options.dashArray},_requestRedraw:function(f){this._map&&(this._extendRedrawBounds(f),this._redrawRequest=this._redrawRequest||De(this._redraw,this))},_extendRedrawBounds:function(f){if(f._pxBounds){var x=(f.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new lt,this._redrawBounds.extend(f._pxBounds.min.subtract([x,x])),this._redrawBounds.extend(f._pxBounds.max.add([x,x]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var f=this._redrawBounds;if(f){var x=f.getSize();this._ctx.clearRect(f.min.x,f.min.y,x.x,x.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var f,x=this._redrawBounds;if(this._ctx.save(),x){var R=x.getSize();this._ctx.beginPath(),this._ctx.rect(x.min.x,x.min.y,R.x,R.y),this._ctx.clip()}this._drawing=!0;for(var U=this._drawFirst;U;U=U.next)f=U.layer,(!x||f._pxBounds&&f._pxBounds.intersects(x))&&f._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(f,x){if(this._drawing){var R,U,K,ue,Oe=f._parts,nt=Oe.length,mt=this._ctx;if(nt){for(mt.beginPath(),R=0;R<nt;R++){for(U=0,K=Oe[R].length;U<K;U++)ue=Oe[R][U],mt[U?"lineTo":"moveTo"](ue.x,ue.y);x&&mt.closePath()}this._fillStroke(mt,f)}}},_updateCircle:function(f){if(!(!this._drawing||f._empty())){var x=f._point,R=this._ctx,U=Math.max(Math.round(f._radius),1),K=(Math.max(Math.round(f._radiusY),1)||U)/U;K!==1&&(R.save(),R.scale(1,K)),R.beginPath(),R.arc(x.x,x.y/K,U,0,Math.PI*2,!1),K!==1&&R.restore(),this._fillStroke(R,f)}},_fillStroke:function(f,x){var R=x.options;R.fill&&(f.globalAlpha=R.fillOpacity,f.fillStyle=R.fillColor||R.color,f.fill(R.fillRule||"evenodd")),R.stroke&&R.weight!==0&&(f.setLineDash&&f.setLineDash(x.options&&x.options._dashArray||[]),f.globalAlpha=R.opacity,f.lineWidth=R.weight,f.strokeStyle=R.color,f.lineCap=R.lineCap,f.lineJoin=R.lineJoin,f.stroke())},_onClick:function(f){for(var x=this._map.mouseEventToLayerPoint(f),R,U,K=this._drawFirst;K;K=K.next)R=K.layer,R.options.interactive&&R._containsPoint(x)&&(!(f.type==="click"||f.type==="preclick")||!this._map._draggableMoved(R))&&(U=R);this._fireEvent(U?[U]:!1,f)},_onMouseMove:function(f){if(!(!this._map||this._map.dragging.moving()||this._map._animatingZoom)){var x=this._map.mouseEventToLayerPoint(f);this._handleMouseHover(f,x)}},_handleMouseOut:function(f){var x=this._hoveredLayer;x&&(Si(this._container,"leaflet-interactive"),this._fireEvent([x],f,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(f,x){if(!this._mouseHoverThrottled){for(var R,U,K=this._drawFirst;K;K=K.next)R=K.layer,R.options.interactive&&R._containsPoint(x)&&(U=R);U!==this._hoveredLayer&&(this._handleMouseOut(f),U&&(cn(this._container,"leaflet-interactive"),this._fireEvent([U],f,"mouseover"),this._hoveredLayer=U)),this._fireEvent(this._hoveredLayer?[this._hoveredLayer]:!1,f),this._mouseHoverThrottled=!0,setTimeout(g(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(f,x,R){this._map._fireDOMEvent(x,R||x.type,f)},_bringToFront:function(f){var x=f._order;if(x){var R=x.next,U=x.prev;if(R)R.prev=U;else return;U?U.next=R:R&&(this._drawFirst=R),x.prev=this._drawLast,this._drawLast.next=x,x.next=null,this._drawLast=x,this._requestRedraw(f)}},_bringToBack:function(f){var x=f._order;if(x){var R=x.next,U=x.prev;if(U)U.next=R;else return;R?R.prev=U:U&&(this._drawLast=U),x.prev=null,x.next=this._drawFirst,this._drawFirst.prev=x,this._drawFirst=x,this._requestRedraw(f)}}});function Gu(f){return Qt.canvas?new tu(f):null}var xo=(function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(f){return document.createElement("<lvml:"+f+' class="lvml">')}}catch{}return function(f){return document.createElement("<"+f+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}})(),Js={_initContainer:function(){this._container=ci("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(is.prototype._update.call(this),this.fire("update"))},_initPath:function(f){var x=f._container=xo("shape");cn(x,"leaflet-vml-shape "+(this.options.className||"")),x.coordsize="1 1",f._path=xo("path"),x.appendChild(f._path),this._updateStyle(f),this._layers[C(f)]=f},_addPath:function(f){var x=f._container;this._container.appendChild(x),f.options.interactive&&f.addInteractiveTarget(x)},_removePath:function(f){var x=f._container;pi(x),f.removeInteractiveTarget(x),delete this._layers[C(f)]},_updateStyle:function(f){var x=f._stroke,R=f._fill,U=f.options,K=f._container;K.stroked=!!U.stroke,K.filled=!!U.fill,U.stroke?(x||(x=f._stroke=xo("stroke")),K.appendChild(x),x.weight=U.weight+"px",x.color=U.color,x.opacity=U.opacity,U.dashArray?x.dashStyle=Xe(U.dashArray)?U.dashArray.join(" "):U.dashArray.replace(/( *, *)/g," "):x.dashStyle="",x.endcap=U.lineCap.replace("butt","flat"),x.joinstyle=U.lineJoin):x&&(K.removeChild(x),f._stroke=null),U.fill?(R||(R=f._fill=xo("fill")),K.appendChild(R),R.color=U.fillColor||U.color,R.opacity=U.fillOpacity):R&&(K.removeChild(R),f._fill=null)},_updateCircle:function(f){var x=f._point.round(),R=Math.round(f._radius),U=Math.round(f._radiusY||R);this._setPath(f,f._empty()?"M0 0":"AL "+x.x+","+x.y+" "+R+","+U+" 0,"+65535*360)},_setPath:function(f,x){f._path.v=x},_bringToFront:function(f){_s(f._container)},_bringToBack:function(f){po(f._container)}},Zu=Qt.vml?xo:ds,tl=is.extend({_initContainer:function(){this._container=Zu("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=Zu("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){pi(this._container),bn(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){is.prototype._update.call(this);var f=this._bounds,x=f.getSize(),R=this._container;(!this._svgSize||!this._svgSize.equals(x))&&(this._svgSize=x,R.setAttribute("width",x.x),R.setAttribute("height",x.y)),Ir(R,f.min),R.setAttribute("viewBox",[f.min.x,f.min.y,x.x,x.y].join(" ")),this.fire("update")}},_initPath:function(f){var x=f._path=Zu("path");f.options.className&&cn(x,f.options.className),f.options.interactive&&cn(x,"leaflet-interactive"),this._updateStyle(f),this._layers[C(f)]=f},_addPath:function(f){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(f._path),f.addInteractiveTarget(f._path)},_removePath:function(f){pi(f._path),f.removeInteractiveTarget(f._path),delete this._layers[C(f)]},_updatePath:function(f){f._project(),f._update()},_updateStyle:function(f){var x=f._path,R=f.options;x&&(R.stroke?(x.setAttribute("stroke",R.color),x.setAttribute("stroke-opacity",R.opacity),x.setAttribute("stroke-width",R.weight),x.setAttribute("stroke-linecap",R.lineCap),x.setAttribute("stroke-linejoin",R.lineJoin),R.dashArray?x.setAttribute("stroke-dasharray",R.dashArray):x.removeAttribute("stroke-dasharray"),R.dashOffset?x.setAttribute("stroke-dashoffset",R.dashOffset):x.removeAttribute("stroke-dashoffset")):x.setAttribute("stroke","none"),R.fill?(x.setAttribute("fill",R.fillColor||R.color),x.setAttribute("fill-opacity",R.fillOpacity),x.setAttribute("fill-rule",R.fillRule||"evenodd")):x.setAttribute("fill","none"))},_updatePoly:function(f,x){this._setPath(f,Xa(f._parts,x))},_updateCircle:function(f){var x=f._point,R=Math.max(Math.round(f._radius),1),U=Math.max(Math.round(f._radiusY),1)||R,K="a"+R+","+U+" 0 1,0 ",ue=f._empty()?"M0 0":"M"+(x.x-R)+","+x.y+K+R*2+",0 "+K+-R*2+",0 ";this._setPath(f,ue)},_setPath:function(f,x){f._path.setAttribute("d",x)},_bringToFront:function(f){_s(f._path)},_bringToBack:function(f){po(f._path)}});Qt.vml&&tl.include(Js);function Gn(f){return Qt.svg||Qt.vml?new tl(f):null}Xn.include({getRenderer:function(f){var x=f.options.renderer||this._getPaneRenderer(f.options.pane)||this.options.renderer||this._renderer;return x||(x=this._renderer=this._createRenderer()),this.hasLayer(x)||this.addLayer(x),x},_getPaneRenderer:function(f){if(f==="overlayPane"||f===void 0)return!1;var x=this._paneRenderers[f];return x===void 0&&(x=this._createRenderer({pane:f}),this._paneRenderers[f]=x),x},_createRenderer:function(f){return this.options.preferCanvas&&Gu(f)||Gn(f)}});var Hu=Kl.extend({initialize:function(f,x){Kl.prototype.initialize.call(this,this._boundsToLatLngs(f),x)},setBounds:function(f){return this.setLatLngs(this._boundsToLatLngs(f))},_boundsToLatLngs:function(f){return f=Xt(f),[f.getSouthWest(),f.getNorthWest(),f.getNorthEast(),f.getSouthEast()]}});function eo(f,x){return new Hu(f,x)}tl.create=Zu,tl.pointsToPath=Xa,Is.geometryToLayer=Yl,Is.coordsToLatLng=oi,Is.coordsToLatLngs=mu,Is.latLngToCoords=gu,Is.latLngsToCoords=Ic,Is.getFeature=Ys,Is.asFeature=vo,Xn.mergeOptions({boxZoom:!0});var Rc=Ss.extend({initialize:function(f){this._map=f,this._container=f._container,this._pane=f._panes.overlayPane,this._resetStateTimeout=0,f.on("unload",this._destroy,this)},addHooks:function(){fn(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){bn(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){pi(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){this._resetStateTimeout!==0&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(f){if(!f.shiftKey||f.which!==1&&f.button!==1)return!1;this._clearDeferredResetState(),this._resetState(),Xr(),Ja(),this._startPoint=this._map.mouseEventToContainerPoint(f),fn(document,{contextmenu:$r,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(f){this._moved||(this._moved=!0,this._box=ci("div","leaflet-zoom-box",this._container),cn(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(f);var x=new lt(this._point,this._startPoint),R=x.getSize();Ir(this._box,x.min),this._box.style.width=R.x+"px",this._box.style.height=R.y+"px"},_finish:function(){this._moved&&(pi(this._box),Si(this._container,"leaflet-crosshair")),Cr(),vs(),bn(document,{contextmenu:$r,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(f){if(!(f.which!==1&&f.button!==1)&&(this._finish(),!!this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(g(this._resetState,this),0);var x=new zt(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(x).fire("boxzoomend",{boxZoomBounds:x})}},_onKeyDown:function(f){f.keyCode===27&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});Xn.addInitHook("addHandler","boxZoom",Rc),Xn.mergeOptions({doubleClickZoom:!0});var Pa=Ss.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(f){var x=this._map,R=x.getZoom(),U=x.options.zoomDelta,K=f.originalEvent.shiftKey?R-U:R+U;x.options.doubleClickZoom==="center"?x.setZoom(K):x.setZoomAround(f.containerPoint,K)}});Xn.addInitHook("addHandler","doubleClickZoom",Pa),Xn.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var fh=Ss.extend({addHooks:function(){if(!this._draggable){var f=this._map;this._draggable=new es(f._mapPane,f._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),f.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),f.on("zoomend",this._onZoomEnd,this),f.whenReady(this._onZoomEnd,this))}cn(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){Si(this._map._container,"leaflet-grab"),Si(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var f=this._map;if(f._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var x=Xt(this._map.options.maxBounds);this._offsetLimit=Dt(this._map.latLngToContainerPoint(x.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(x.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;f.fire("movestart").fire("dragstart"),f.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(f){if(this._map.options.inertia){var x=this._lastTime=+new Date,R=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(R),this._times.push(x),this._prunePositions(x)}this._map.fire("move",f).fire("drag",f)},_prunePositions:function(f){for(;this._positions.length>1&&f-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var f=this._map.getSize().divideBy(2),x=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=x.subtract(f).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(f,x){return f-(f-x)*this._viscosity},_onPreDragLimit:function(){if(!(!this._viscosity||!this._offsetLimit)){var f=this._draggable._newPos.subtract(this._draggable._startPos),x=this._offsetLimit;f.x<x.min.x&&(f.x=this._viscousLimit(f.x,x.min.x)),f.y<x.min.y&&(f.y=this._viscousLimit(f.y,x.min.y)),f.x>x.max.x&&(f.x=this._viscousLimit(f.x,x.max.x)),f.y>x.max.y&&(f.y=this._viscousLimit(f.y,x.max.y)),this._draggable._newPos=this._draggable._startPos.add(f)}},_onPreDragWrap:function(){var f=this._worldWidth,x=Math.round(f/2),R=this._initialWorldOffset,U=this._draggable._newPos.x,K=(U-x+R)%f+x-R,ue=(U+x+R)%f-x-R,Oe=Math.abs(K+R)<Math.abs(ue+R)?K:ue;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=Oe},_onDragEnd:function(f){var x=this._map,R=x.options,U=!R.inertia||f.noInertia||this._times.length<2;if(x.fire("dragend",f),U)x.fire("moveend");else{this._prunePositions(+new Date);var K=this._lastPos.subtract(this._positions[0]),ue=(this._lastTime-this._times[0])/1e3,Oe=R.easeLinearity,nt=K.multiplyBy(Oe/ue),mt=nt.distanceTo([0,0]),Rt=Math.min(R.inertiaMaxSpeed,mt),Jt=nt.multiplyBy(Rt/mt),on=Rt/(R.inertiaDeceleration*Oe),_n=Jt.multiplyBy(-on/2).round();!_n.x&&!_n.y?x.fire("moveend"):(_n=x._limitOffset(_n,x.options.maxBounds),De(function(){x.panBy(_n,{duration:on,easeLinearity:Oe,noMoveStart:!0,animate:!0})}))}}});Xn.addInitHook("addHandler","dragging",fh),Xn.mergeOptions({keyboard:!0,keyboardPanDelta:80});var kc=Ss.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(f){this._map=f,this._setPanDelta(f.options.keyboardPanDelta),this._setZoomDelta(f.options.zoomDelta)},addHooks:function(){var f=this._map._container;f.tabIndex<=0&&(f.tabIndex="0"),fn(f,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),bn(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var f=document.body,x=document.documentElement,R=f.scrollTop||x.scrollTop,U=f.scrollLeft||x.scrollLeft;this._map._container.focus(),window.scrollTo(U,R)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(f){var x=this._panKeys={},R=this.keyCodes,U,K;for(U=0,K=R.left.length;U<K;U++)x[R.left[U]]=[-1*f,0];for(U=0,K=R.right.length;U<K;U++)x[R.right[U]]=[f,0];for(U=0,K=R.down.length;U<K;U++)x[R.down[U]]=[0,f];for(U=0,K=R.up.length;U<K;U++)x[R.up[U]]=[0,-1*f]},_setZoomDelta:function(f){var x=this._zoomKeys={},R=this.keyCodes,U,K;for(U=0,K=R.zoomIn.length;U<K;U++)x[R.zoomIn[U]]=f;for(U=0,K=R.zoomOut.length;U<K;U++)x[R.zoomOut[U]]=-f},_addHooks:function(){fn(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){bn(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(f){if(!(f.altKey||f.ctrlKey||f.metaKey)){var x=f.keyCode,R=this._map,U;if(x in this._panKeys){if(!R._panAnim||!R._panAnim._inProgress)if(U=this._panKeys[x],f.shiftKey&&(U=Ie(U).multiplyBy(3)),R.options.maxBounds&&(U=R._limitOffset(Ie(U),R.options.maxBounds)),R.options.worldCopyJump){var K=R.wrapLatLng(R.unproject(R.project(R.getCenter()).add(U)));R.panTo(K)}else R.panBy(U)}else if(x in this._zoomKeys)R.setZoom(R.getZoom()+(f.shiftKey?3:1)*this._zoomKeys[x]);else if(x===27&&R._popup&&R._popup.options.closeOnEscapeKey)R.closePopup();else return;$r(f)}}});Xn.addInitHook("addHandler","keyboard",kc),Xn.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var kl=Ss.extend({addHooks:function(){fn(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){bn(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(f){var x=Ia(f),R=this._map.options.wheelDebounceTime;this._delta+=x,this._lastMousePos=this._map.mouseEventToContainerPoint(f),this._startTime||(this._startTime=+new Date);var U=Math.max(R-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(g(this._performZoom,this),U),$r(f)},_performZoom:function(){var f=this._map,x=f.getZoom(),R=this._map.options.zoomSnap||0;f._stop();var U=this._delta/(this._map.options.wheelPxPerZoomLevel*4),K=4*Math.log(2/(1+Math.exp(-Math.abs(U))))/Math.LN2,ue=R?Math.ceil(K/R)*R:K,Oe=f._limitZoom(x+(this._delta>0?ue:-ue))-x;this._delta=0,this._startTime=null,Oe&&(f.options.scrollWheelZoom==="center"?f.setZoom(x+Oe):f.setZoomAround(this._lastMousePos,x+Oe))}});Xn.addInitHook("addHandler","scrollWheelZoom",kl);var rd=600;Xn.mergeOptions({tapHold:Qt.touchNative&&Qt.safari&&Qt.mobile,tapTolerance:15});var Wu=Ss.extend({addHooks:function(){fn(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){bn(this._map._container,"touchstart",this._onDown,this)},_onDown:function(f){if(clearTimeout(this._holdTimeout),f.touches.length===1){var x=f.touches[0];this._startPos=this._newPos=new xt(x.clientX,x.clientY),this._holdTimeout=setTimeout(g(function(){this._cancel(),this._isTapValid()&&(fn(document,"touchend",sn),fn(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",x))},this),rd),fn(document,"touchend touchcancel contextmenu",this._cancel,this),fn(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function f(){bn(document,"touchend",sn),bn(document,"touchend touchcancel",f)},_cancel:function(){clearTimeout(this._holdTimeout),bn(document,"touchend touchcancel contextmenu",this._cancel,this),bn(document,"touchmove",this._onMove,this)},_onMove:function(f){var x=f.touches[0];this._newPos=new xt(x.clientX,x.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(f,x){var R=new MouseEvent(f,{bubbles:!0,cancelable:!0,view:window,screenX:x.screenX,screenY:x.screenY,clientX:x.clientX,clientY:x.clientY});R._simulated=!0,x.target.dispatchEvent(R)}});Xn.addInitHook("addHandler","tapHold",Wu),Xn.mergeOptions({touchZoom:Qt.touch,bounceAtZoomLimits:!0});var nl=Ss.extend({addHooks:function(){cn(this._map._container,"leaflet-touch-zoom"),fn(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){Si(this._map._container,"leaflet-touch-zoom"),bn(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(f){var x=this._map;if(!(!f.touches||f.touches.length!==2||x._animatingZoom||this._zooming)){var R=x.mouseEventToContainerPoint(f.touches[0]),U=x.mouseEventToContainerPoint(f.touches[1]);this._centerPoint=x.getSize()._divideBy(2),this._startLatLng=x.containerPointToLatLng(this._centerPoint),x.options.touchZoom!=="center"&&(this._pinchStartLatLng=x.containerPointToLatLng(R.add(U)._divideBy(2))),this._startDist=R.distanceTo(U),this._startZoom=x.getZoom(),this._moved=!1,this._zooming=!0,x._stop(),fn(document,"touchmove",this._onTouchMove,this),fn(document,"touchend touchcancel",this._onTouchEnd,this),sn(f)}},_onTouchMove:function(f){if(!(!f.touches||f.touches.length!==2||!this._zooming)){var x=this._map,R=x.mouseEventToContainerPoint(f.touches[0]),U=x.mouseEventToContainerPoint(f.touches[1]),K=R.distanceTo(U)/this._startDist;if(this._zoom=x.getScaleZoom(K,this._startZoom),!x.options.bounceAtZoomLimits&&(this._zoom<x.getMinZoom()&&K<1||this._zoom>x.getMaxZoom()&&K>1)&&(this._zoom=x._limitZoom(this._zoom)),x.options.touchZoom==="center"){if(this._center=this._startLatLng,K===1)return}else{var ue=R._add(U)._divideBy(2)._subtract(this._centerPoint);if(K===1&&ue.x===0&&ue.y===0)return;this._center=x.unproject(x.project(this._pinchStartLatLng,this._zoom).subtract(ue),this._zoom)}this._moved||(x._moveStart(!0,!1),this._moved=!0),$e(this._animRequest);var Oe=g(x._move,x,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=De(Oe,this,!0),sn(f)}},_onTouchEnd:function(){if(!this._moved||!this._zooming){this._zooming=!1;return}this._zooming=!1,$e(this._animRequest),bn(document,"touchmove",this._onTouchMove,this),bn(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))}});Xn.addInitHook("addHandler","touchZoom",nl),Xn.BoxZoom=Rc,Xn.DoubleClickZoom=Pa,Xn.Drag=fh,Xn.Keyboard=kc,Xn.ScrollWheelZoom=kl,Xn.TapHold=Wu,Xn.TouchZoom=nl,t.Bounds=lt,t.Browser=Qt,t.CRS=Ci,t.Canvas=tu,t.Circle=hh,t.CircleMarker=Ac,t.Class=Bn,t.Control=Kr,t.DivIcon=Jl,t.DivOverlay=Cs,t.DomEvent=Sl,t.DomUtil=qr,t.Draggable=es,t.Evented=Zt,t.FeatureGroup=ts,t.GeoJSON=Is,t.GridLayer=eu,t.Handler=Ss,t.Icon=Al,t.ImageOverlay=Jo,t.LatLng=an,t.LatLngBounds=zt,t.Layer=Xs,t.LayerGroup=fu,t.LineUtil=Ca,t.Map=Xn,t.Marker=Xl,t.Mixin=El,t.Path=Ks,t.Point=xt,t.PolyUtil=Yo,t.Polygon=Kl,t.Polyline=Qo,t.Popup=Ql,t.PosAnimation=_o,t.Projection=As,t.Rectangle=Hu,t.Renderer=is,t.SVG=tl,t.SVGOverlay=Pl,t.TileLayer=Ml,t.Tooltip=el,t.Transformation=Us,t.Util=ke,t.VideoOverlay=Cc,t.bind=g,t.bounds=Dt,t.canvas=Gu,t.circle=Zf,t.circleMarker=qu,t.control=xs,t.divIcon=Qs,t.extend=h,t.featureGroup=ju,t.geoJSON=dh,t.geoJson=Hd,t.gridLayer=bo,t.icon=Sc,t.imageOverlay=$u,t.latLng=Ft,t.latLngBounds=Xt,t.layerGroup=nd,t.map=Hs,t.marker=Ec,t.point=Ie,t.polygon=ns,t.polyline=Zd,t.popup=id,t.rectangle=eo,t.setOptions=xe,t.stamp=C,t.svg=Gn,t.svgOverlay=Pc,t.tileLayer=ua,t.tooltip=Mc,t.transformation=Or,t.version=a,t.videoOverlay=Wd;var il=window.L;t.noConflict=function(){return window.L=il,this},window.L=t}))})(E_,E_.exports)),E_.exports}var iN=nN();const Dr=uy(iN);var Wv={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v5.6.2/LICENSE.txt
 */var rN=Wv.exports,HT;function aN(){return HT||(HT=1,(function(i,e){(function(t,a){i.exports=a()})(rN,(function(){var t={},a={};function h(g,c,C){if(a[g]=C,g==="index"){var k="var sharedModule = {}; ("+a.shared+")(sharedModule); ("+a.worker+")(sharedModule);",V={};return a.shared(V),a.index(t,V),typeof window<"u"&&t.setWorkerUrl(window.URL.createObjectURL(new Blob([k],{type:"text/javascript"}))),t}}h("shared",["exports"],(function(g){function c(l,r,o,p){return new(o||(o=Promise))((function(v,E){function A(F){try{z(p.next(F))}catch(q){E(q)}}function P(F){try{z(p.throw(F))}catch(q){E(q)}}function z(F){var q;F.done?v(F.value):(q=F.value,q instanceof o?q:new o((function(H){H(q)}))).then(A,P)}z((p=p.apply(l,r||[])).next())}))}function C(l,r){this.x=l,this.y=r}function k(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}var V,Z;typeof SuppressedError=="function"&&SuppressedError,C.prototype={clone(){return new C(this.x,this.y)},add(l){return this.clone()._add(l)},sub(l){return this.clone()._sub(l)},multByPoint(l){return this.clone()._multByPoint(l)},divByPoint(l){return this.clone()._divByPoint(l)},mult(l){return this.clone()._mult(l)},div(l){return this.clone()._div(l)},rotate(l){return this.clone()._rotate(l)},rotateAround(l,r){return this.clone()._rotateAround(l,r)},matMult(l){return this.clone()._matMult(l)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(l){return this.x===l.x&&this.y===l.y},dist(l){return Math.sqrt(this.distSqr(l))},distSqr(l){const r=l.x-this.x,o=l.y-this.y;return r*r+o*o},angle(){return Math.atan2(this.y,this.x)},angleTo(l){return Math.atan2(this.y-l.y,this.x-l.x)},angleWith(l){return this.angleWithSep(l.x,l.y)},angleWithSep(l,r){return Math.atan2(this.x*r-this.y*l,this.x*l+this.y*r)},_matMult(l){const r=l[2]*this.x+l[3]*this.y;return this.x=l[0]*this.x+l[1]*this.y,this.y=r,this},_add(l){return this.x+=l.x,this.y+=l.y,this},_sub(l){return this.x-=l.x,this.y-=l.y,this},_mult(l){return this.x*=l,this.y*=l,this},_div(l){return this.x/=l,this.y/=l,this},_multByPoint(l){return this.x*=l.x,this.y*=l.y,this},_divByPoint(l){return this.x/=l.x,this.y/=l.y,this},_unit(){return this._div(this.mag()),this},_perp(){const l=this.y;return this.y=this.x,this.x=-l,this},_rotate(l){const r=Math.cos(l),o=Math.sin(l),p=o*this.x+r*this.y;return this.x=r*this.x-o*this.y,this.y=p,this},_rotateAround(l,r){const o=Math.cos(l),p=Math.sin(l),v=r.y+p*(this.x-r.x)+o*(this.y-r.y);return this.x=r.x+o*(this.x-r.x)-p*(this.y-r.y),this.y=v,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:C},C.convert=function(l){if(l instanceof C)return l;if(Array.isArray(l))return new C(+l[0],+l[1]);if(l.x!==void 0&&l.y!==void 0)return new C(+l.x,+l.y);throw new Error("Expected [x, y] or {x, y} point format")};var Y=(function(){if(Z)return V;function l(r,o,p,v){this.cx=3*r,this.bx=3*(p-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*o,this.by=3*(v-o)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=o,this.p2x=p,this.p2y=v}return Z=1,V=l,l.prototype={sampleCurveX:function(r){return((this.ax*r+this.bx)*r+this.cx)*r},sampleCurveY:function(r){return((this.ay*r+this.by)*r+this.cy)*r},sampleCurveDerivativeX:function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},solveCurveX:function(r,o){if(o===void 0&&(o=1e-6),r<0)return 0;if(r>1)return 1;for(var p=r,v=0;v<8;v++){var E=this.sampleCurveX(p)-r;if(Math.abs(E)<o)return p;var A=this.sampleCurveDerivativeX(p);if(Math.abs(A)<1e-6)break;p-=E/A}var P=0,z=1;for(p=r,v=0;v<20&&(E=this.sampleCurveX(p),!(Math.abs(E-r)<o));v++)r>E?P=p:z=p,p=.5*(z-P)+P;return p},solve:function(r,o){return this.sampleCurveY(this.solveCurveX(r,o))}},V})(),Q=k(Y);let be,xe;function ze(){return be==null&&(be=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),be}function et(){if(xe==null&&(xe=!1,ze())){const r=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(r){for(let p=0;p<25;p++){const v=4*p;r.fillStyle=`rgb(${v},${v+1},${v+2})`,r.fillRect(p%5,Math.floor(p/5),1,1)}const o=r.getImageData(0,0,5,5).data;for(let p=0;p<100;p++)if(p%4!=3&&o[p]!==p){xe=!0;break}}}return xe||!1}var Qe=1e-6,Xe=typeof Float32Array<"u"?Float32Array:Array;function Ke(){var l=new Xe(9);return Xe!=Float32Array&&(l[1]=0,l[2]=0,l[3]=0,l[5]=0,l[6]=0,l[7]=0),l[0]=1,l[4]=1,l[8]=1,l}function Ve(l){return l[0]=1,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=1,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=1,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l}function it(){var l=new Xe(3);return Xe!=Float32Array&&(l[0]=0,l[1]=0,l[2]=0),l}function de(l){return Math.hypot(l[0],l[1],l[2])}function ce(l,r,o){var p=new Xe(3);return p[0]=l,p[1]=r,p[2]=o,p}function me(l,r,o){return l[0]=r[0]+o[0],l[1]=r[1]+o[1],l[2]=r[2]+o[2],l}function Ee(l,r,o){return l[0]=r[0]*o,l[1]=r[1]*o,l[2]=r[2]*o,l}function De(l,r,o){var p=r[0],v=r[1],E=r[2],A=o[0],P=o[1],z=o[2];return l[0]=v*z-E*P,l[1]=E*A-p*z,l[2]=p*P-v*A,l}Math.hypot||(Math.hypot=function(){for(var l=0,r=arguments.length;r--;)l+=arguments[r]*arguments[r];return Math.sqrt(l)});var $e,ke=de;function Bn(l,r,o){var p=r[0],v=r[1],E=r[2],A=r[3];return l[0]=o[0]*p+o[4]*v+o[8]*E+o[12]*A,l[1]=o[1]*p+o[5]*v+o[9]*E+o[13]*A,l[2]=o[2]*p+o[6]*v+o[10]*E+o[14]*A,l[3]=o[3]*p+o[7]*v+o[11]*E+o[15]*A,l}function ti(){var l=new Xe(4);return Xe!=Float32Array&&(l[0]=0,l[1]=0,l[2]=0),l[3]=1,l}function gt(l,r,o,p){var v=.5*Math.PI/180;r*=v,o*=v,p*=v;var E=Math.sin(r),A=Math.cos(r),P=Math.sin(o),z=Math.cos(o),F=Math.sin(p),q=Math.cos(p);return l[0]=E*z*q-A*P*F,l[1]=A*P*q+E*z*F,l[2]=A*z*F-E*P*q,l[3]=A*z*q+E*P*F,l}function Zt(){var l=new Xe(2);return Xe!=Float32Array&&(l[0]=0,l[1]=0),l}function xt(l,r){var o=new Xe(2);return o[0]=l,o[1]=r,o}it(),$e=new Xe(4),Xe!=Float32Array&&($e[0]=0,$e[1]=0,$e[2]=0,$e[3]=0),it(),ce(1,0,0),ce(0,1,0),ti(),ti(),Ke(),Zt();const jt=8192;function Ie(l,r,o){return r*(jt/(l.tileSize*Math.pow(2,o-l.tileID.overscaledZ)))}function lt(l,r){return(l%r+r)%r}function Dt(l,r,o){return l*(1-o)+r*o}function zt(l){if(l<=0)return 0;if(l>=1)return 1;const r=l*l,o=r*l;return 4*(l<.5?o:3*(l-r)+o-.75)}function Xt(l,r,o,p){const v=new Q(l,r,o,p);return E=>v.solve(E)}const an=Xt(.25,.1,.25,1);function Ft(l,r,o){return Math.min(o,Math.max(r,l))}function Ci(l,r,o){const p=o-r,v=((l-r)%p+p)%p+r;return v===r?o:v}function qn(l,...r){for(const o of r)for(const p in o)l[p]=o[p];return l}let zr=1;function co(l,r,o){const p={};for(const v in l)p[v]=r.call(this,l[v],v,l);return p}function Us(l,r,o){const p={};for(const v in l)r.call(this,l[v],v,l)&&(p[v]=l[v]);return p}function Or(l){return Array.isArray(l)?l.map(Or):typeof l=="object"&&l?co(l,Or):l}const Pi={};function er(l){Pi[l]||(typeof console<"u"&&console.warn(l),Pi[l]=!0)}function ds(l,r,o){return(o.y-l.y)*(r.x-l.x)>(r.y-l.y)*(o.x-l.x)}function Xa(l){return typeof WorkerGlobalScope<"u"&&l!==void 0&&l instanceof WorkerGlobalScope}let Nr=null;function Ba(l){return typeof ImageBitmap<"u"&&l instanceof ImageBitmap}const Fi="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function fr(l,r,o,p,v){return c(this,void 0,void 0,(function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const E=new VideoFrame(l,{timestamp:0});try{const A=E==null?void 0:E.format;if(!A||!A.startsWith("BGR")&&!A.startsWith("RGB"))throw new Error(`Unrecognized format ${A}`);const P=A.startsWith("BGR"),z=new Uint8ClampedArray(p*v*4);if(yield E.copyTo(z,(function(F,q,H,J,ie){const re=4*Math.max(-q,0),oe=(Math.max(0,H)-H)*J*4+re,pe=4*J,we=Math.max(0,q),He=Math.max(0,H);return{rect:{x:we,y:He,width:Math.min(F.width,q+J)-we,height:Math.min(F.height,H+ie)-He},layout:[{offset:oe,stride:pe}]}})(l,r,o,p,v)),P)for(let F=0;F<z.length;F+=4){const q=z[F];z[F]=z[F+2],z[F+2]=q}return z}finally{E.close()}}))}let fa,Po;function js(l,r,o,p){return l.addEventListener(r,o,p),{unsubscribe:()=>{l.removeEventListener(r,o,p)}}}function Tl(l){return l*Math.PI/180}function fs(l){return l/Math.PI*180}const Ta={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},pr={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},pa="AbortError";function je(){return new Error(pa)}const se={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function le(l){return se.REGISTERED_PROTOCOLS[l.substring(0,l.indexOf("://"))]}const fe="global-dispatcher";class Se extends Error{constructor(r,o,p,v){super(`AJAXError: ${o} (${r}): ${p}`),this.status=r,this.statusText=o,this.url=p,this.body=v}}const Ne=()=>Xa(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Ge=function(l,r){if(/:\/\//.test(l.url)&&!/^https?:|^file:/.test(l.url)){const p=le(l.url);if(p)return p(l,r);if(Xa(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:l,targetMapId:fe},r)}if(!(/^file:/.test(o=l.url)||/^file:/.test(Ne())&&!/^\w+:/.test(o))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return(function(p,v){return c(this,void 0,void 0,(function*(){const E=new Request(p.url,{method:p.method||"GET",body:p.body,credentials:p.credentials,headers:p.headers,cache:p.cache,referrer:Ne(),signal:v.signal});let A,P;p.type!=="json"||E.headers.has("Accept")||E.headers.set("Accept","application/json");try{A=yield fetch(E)}catch(F){throw new Se(0,F.message,p.url,new Blob)}if(!A.ok){const F=yield A.blob();throw new Se(A.status,A.statusText,p.url,F)}P=p.type==="arrayBuffer"||p.type==="image"?A.arrayBuffer():p.type==="json"?A.json():A.text();const z=yield P;if(v.signal.aborted)throw je();return{data:z,cacheControl:A.headers.get("Cache-Control"),expires:A.headers.get("Expires")}}))})(l,r);if(Xa(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:l,mustQueue:!0,targetMapId:fe},r)}var o;return(function(p,v){return new Promise(((E,A)=>{var P;const z=new XMLHttpRequest;z.open(p.method||"GET",p.url,!0),p.type!=="arrayBuffer"&&p.type!=="image"||(z.responseType="arraybuffer");for(const F in p.headers)z.setRequestHeader(F,p.headers[F]);p.type==="json"&&(z.responseType="text",!((P=p.headers)===null||P===void 0)&&P.Accept||z.setRequestHeader("Accept","application/json")),z.withCredentials=p.credentials==="include",z.onerror=()=>{A(new Error(z.statusText))},z.onload=()=>{if(!v.signal.aborted)if((z.status>=200&&z.status<300||z.status===0)&&z.response!==null){let F=z.response;if(p.type==="json")try{F=JSON.parse(z.response)}catch(q){return void A(q)}E({data:F,cacheControl:z.getResponseHeader("Cache-Control"),expires:z.getResponseHeader("Expires")})}else{const F=new Blob([z.response],{type:z.getResponseHeader("Content-Type")});A(new Se(z.status,z.statusText,p.url,F))}},v.signal.addEventListener("abort",(()=>{z.abort(),A(je())})),z.send(p.body)}))})(l,r)};function Je(l){if(!l||l.indexOf("://")<=0||l.indexOf("data:image/")===0||l.indexOf("blob:")===0)return!0;const r=new URL(l),o=window.location;return r.protocol===o.protocol&&r.host===o.host}function Ze(l,r,o){o[l]&&o[l].indexOf(r)!==-1||(o[l]=o[l]||[],o[l].push(r))}function yt(l,r,o){if(o&&o[l]){const p=o[l].indexOf(r);p!==-1&&o[l].splice(p,1)}}class At{constructor(r,o={}){qn(this,o),this.type=r}}class bt extends At{constructor(r,o={}){super("error",qn({error:r},o))}}class en{on(r,o){return this._listeners=this._listeners||{},Ze(r,o,this._listeners),{unsubscribe:()=>{this.off(r,o)}}}off(r,o){return yt(r,o,this._listeners),yt(r,o,this._oneTimeListeners),this}once(r,o){return o?(this._oneTimeListeners=this._oneTimeListeners||{},Ze(r,o,this._oneTimeListeners),this):new Promise((p=>this.once(r,p)))}fire(r,o){typeof r=="string"&&(r=new At(r,o||{}));const p=r.type;if(this.listens(p)){r.target=this;const v=this._listeners&&this._listeners[p]?this._listeners[p].slice():[];for(const P of v)P.call(this,r);const E=this._oneTimeListeners&&this._oneTimeListeners[p]?this._oneTimeListeners[p].slice():[];for(const P of E)yt(p,P,this._oneTimeListeners),P.call(this,r);const A=this._eventedParent;A&&(qn(r,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),A.fire(r))}else r instanceof bt&&console.error(r.error);return this}listens(r){return this._listeners&&this._listeners[r]&&this._listeners[r].length>0||this._oneTimeListeners&&this._oneTimeListeners[r]&&this._oneTimeListeners[r].length>0||this._eventedParent&&this._eventedParent.listens(r)}setEventedParent(r,o){return this._eventedParent=r,this._eventedParentData=o,this}}var qe={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Cn=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Fn(l,r){const o={};for(const p in l)p!=="ref"&&(o[p]=l[p]);return Cn.forEach((p=>{p in r&&(o[p]=r[p])})),o}function rn(l,r){if(Array.isArray(l)){if(!Array.isArray(r)||l.length!==r.length)return!1;for(let o=0;o<l.length;o++)if(!rn(l[o],r[o]))return!1;return!0}if(typeof l=="object"&&l!==null&&r!==null){if(typeof r!="object"||Object.keys(l).length!==Object.keys(r).length)return!1;for(const o in l)if(!rn(l[o],r[o]))return!1;return!0}return l===r}function Dn(l,r){l.push(r)}function wi(l,r,o){Dn(o,{command:"addSource",args:[l,r[l]]})}function Xi(l,r,o){Dn(r,{command:"removeSource",args:[l]}),o[l]=!0}function Er(l,r,o,p){Xi(l,o,p),wi(l,r,o)}function Mi(l,r,o){let p;for(p in l[o])if(Object.prototype.hasOwnProperty.call(l[o],p)&&p!=="data"&&!rn(l[o][p],r[o][p]))return!1;for(p in r[o])if(Object.prototype.hasOwnProperty.call(r[o],p)&&p!=="data"&&!rn(l[o][p],r[o][p]))return!1;return!0}function vn(l,r,o,p,v,E){l=l||{},r=r||{};for(const A in l)Object.prototype.hasOwnProperty.call(l,A)&&(rn(l[A],r[A])||o.push({command:E,args:[p,A,r[A],v]}));for(const A in r)Object.prototype.hasOwnProperty.call(r,A)&&!Object.prototype.hasOwnProperty.call(l,A)&&(rn(l[A],r[A])||o.push({command:E,args:[p,A,r[A],v]}))}function Pn(l){return l.id}function Vi(l,r){return l[r.id]=r,l}class Ct{constructor(r,o,p,v){this.message=(r?`${r}: `:"")+p,v&&(this.identifier=v),o!=null&&o.__line__&&(this.line=o.__line__)}}function Qt(l,...r){for(const o of r)for(const p in o)l[p]=o[p];return l}class tr extends Error{constructor(r,o){super(o),this.message=o,this.key=r}}class la{constructor(r,o=[]){this.parent=r,this.bindings={};for(const[p,v]of o)this.bindings[p]=v}concat(r){return new la(this,r)}get(r){if(this.bindings[r])return this.bindings[r];if(this.parent)return this.parent.get(r);throw new Error(`${r} not found in scope.`)}has(r){return!!this.bindings[r]||!!this.parent&&this.parent.has(r)}}const ps={kind:"null"},Vt={kind:"number"},Rn={kind:"string"},In={kind:"boolean"},zi={kind:"color"},Ka={kind:"projectionDefinition"},Ui={kind:"object"},Vn={kind:"value"},$o={kind:"collator"},Sa={kind:"formatted"},ms={kind:"padding"},Fa={kind:"colorArray"},ma={kind:"numberArray"},Ki={kind:"resolvedImage"},Vu={kind:"variableAnchorOffsetCollection"};function Wr(l,r){return{kind:"array",itemType:l,N:r}}function fi(l){if(l.kind==="array"){const r=fi(l.itemType);return typeof l.N=="number"?`array<${r}, ${l.N}>`:l.itemType.kind==="value"?"array":`array<${r}>`}return l.kind}const qs=[ps,Vt,Rn,In,zi,Ka,Sa,Ui,Wr(Vn),ms,ma,Fa,Ki,Vu];function $s(l,r){if(r.kind==="error")return null;if(l.kind==="array"){if(r.kind==="array"&&(r.N===0&&r.itemType.kind==="value"||!$s(l.itemType,r.itemType))&&(typeof l.N!="number"||l.N===r.N))return null}else{if(l.kind===r.kind)return null;if(l.kind==="value"){for(const o of qs)if(!$s(o,r))return null}}return`Expected ${fi(l)} but found ${fi(r)} instead.`}function ho(l,r){return r.some((o=>o.kind===l.kind))}function Ea(l,r){return r.some((o=>o==="null"?l===null:o==="array"?Array.isArray(l):o==="object"?l&&!Array.isArray(l)&&typeof l=="object":o===typeof l))}function gs(l,r){return l.kind==="array"&&r.kind==="array"?l.itemType.kind===r.itemType.kind&&typeof l.N=="number":l.kind===r.kind}const fo=.96422,ci=.82521,pi=4/29,Ti=6/29,_s=3*Ti*Ti,po=Ti*Ti*Ti,Go=Math.PI/180,cn=180/Math.PI;function Si(l){return(l%=360)<0&&(l+=360),l}function ys([l,r,o,p]){let v,E;const A=ga((.2225045*(l=Ar(l))+.7168786*(r=Ar(r))+.0606169*(o=Ar(o)))/1);l===r&&r===o?v=E=A:(v=ga((.4360747*l+.3850649*r+.1430804*o)/fo),E=ga((.0139322*l+.0971045*r+.7141733*o)/ci));const P=116*A-16;return[P<0?0:P,500*(v-A),200*(A-E),p]}function Ar(l){return l<=.04045?l/12.92:Math.pow((l+.055)/1.055,2.4)}function ga(l){return l>po?Math.pow(l,1/3):l/_s+pi}function Zo([l,r,o,p]){let v=(l+16)/116,E=isNaN(r)?v:v+r/500,A=isNaN(o)?v:v-o/200;return v=1*Va(v),E=fo*Va(E),A=ci*Va(A),[Ho(3.1338561*E-1.6168667*v-.4906146*A),Ho(-.9787684*E+1.9161415*v+.033454*A),Ho(.0719453*E-.2289914*v+1.4052427*A),p]}function Ho(l){return(l=l<=.00304?12.92*l:1.055*Math.pow(l,1/2.4)-.055)<0?0:l>1?1:l}function Va(l){return l>Ti?l*l*l:_s*(l-pi)}const Ir=Object.hasOwn||function(l,r){return Object.prototype.hasOwnProperty.call(l,r)};function Ya(l,r){return Ir(l,r)?l[r]:void 0}function Xr(l){return parseInt(l.padEnd(2,l),16)/255}function Cr(l,r){return Un(r?l/100:l,0,1)}function Un(l,r,o){return Math.min(Math.max(r,l),o)}function Qa(l){return!l.some(Number.isNaN)}const Ja={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function vs(l,r,o){return l+o*(r-l)}function Gs(l,r,o){return l.map(((p,v)=>vs(p,r[v],o)))}class Mn{constructor(r,o,p,v=1,E=!0){this.r=r,this.g=o,this.b=p,this.a=v,E||(this.r*=v,this.g*=v,this.b*=v,v||this.overwriteGetter("rgb",[r,o,p,v]))}static parse(r){if(r instanceof Mn)return r;if(typeof r!="string")return;const o=(function(p){if((p=p.toLowerCase().trim())==="transparent")return[0,0,0,0];const v=Ya(Ja,p);if(v){const[A,P,z]=v;return[A/255,P/255,z/255,1]}if(p.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(p)){const A=p.length<6?1:2;let P=1;return[Xr(p.slice(P,P+=A)),Xr(p.slice(P,P+=A)),Xr(p.slice(P,P+=A)),Xr(p.slice(P,P+A)||"ff")]}if(p.startsWith("rgb")){const A=p.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(A){const[P,z,F,q,H,J,ie,re,oe,pe,we,He]=A,Re=[q||" ",ie||" ",pe].join("");if(Re==="  "||Re==="  /"||Re===",,"||Re===",,,"){const Fe=[F,J,oe].join(""),ot=Fe==="%%%"?100:Fe===""?255:0;if(ot){const _t=[Un(+z/ot,0,1),Un(+H/ot,0,1),Un(+re/ot,0,1),we?Cr(+we,He):1];if(Qa(_t))return _t}}return}}const E=p.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(E){const[A,P,z,F,q,H,J,ie,re]=E,oe=[z||" ",q||" ",J].join("");if(oe==="  "||oe==="  /"||oe===",,"||oe===",,,"){const pe=[+P,Un(+F,0,100),Un(+H,0,100),ie?Cr(+ie,re):1];if(Qa(pe))return(function([we,He,Re,Fe]){function ot(_t){const It=(_t+we/30)%12,$t=He*Math.min(Re,1-Re);return Re-$t*Math.max(-1,Math.min(It-3,9-It,1))}return we=Si(we),He/=100,Re/=100,[ot(0),ot(8),ot(4),Fe]})(pe)}}})(r);return o?new Mn(...o,!1):void 0}get rgb(){const{r,g:o,b:p,a:v}=this,E=v||1/0;return this.overwriteGetter("rgb",[r/E,o/E,p/E,v])}get hcl(){return this.overwriteGetter("hcl",(function(r){const[o,p,v,E]=ys(r),A=Math.sqrt(p*p+v*v);return[Math.round(1e4*A)?Si(Math.atan2(v,p)*cn):NaN,A,o,E]})(this.rgb))}get lab(){return this.overwriteGetter("lab",ys(this.rgb))}overwriteGetter(r,o){return Object.defineProperty(this,r,{value:o}),o}toString(){const[r,o,p,v]=this.rgb;return`rgba(${[r,o,p].map((E=>Math.round(255*E))).join(",")},${v})`}static interpolate(r,o,p,v="rgb"){switch(v){case"rgb":{const[E,A,P,z]=Gs(r.rgb,o.rgb,p);return new Mn(E,A,P,z,!1)}case"hcl":{const[E,A,P,z]=r.hcl,[F,q,H,J]=o.hcl;let ie,re;if(isNaN(E)||isNaN(F))isNaN(E)?isNaN(F)?ie=NaN:(ie=F,P!==1&&P!==0||(re=q)):(ie=E,H!==1&&H!==0||(re=A));else{let Re=F-E;F>E&&Re>180?Re-=360:F<E&&E-F>180&&(Re+=360),ie=E+p*Re}const[oe,pe,we,He]=(function([Re,Fe,ot,_t]){return Re=isNaN(Re)?0:Re*Go,Zo([ot,Math.cos(Re)*Fe,Math.sin(Re)*Fe,_t])})([ie,re??vs(A,q,p),vs(P,H,p),vs(z,J,p)]);return new Mn(oe,pe,we,He,!1)}case"lab":{const[E,A,P,z]=Zo(Gs(r.lab,o.lab,p));return new Mn(E,A,P,z,!1)}}}}Mn.black=new Mn(0,0,0,1),Mn.white=new Mn(1,1,1,1),Mn.transparent=new Mn(0,0,0,0),Mn.red=new Mn(1,0,0,1);class Zs{constructor(r,o,p){this.sensitivity=r?o?"variant":"case":o?"accent":"base",this.locale=p,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(r,o){return this.collator.compare(r,o)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const Mo=["bottom","center","top"];class mo{constructor(r,o,p,v,E,A){this.text=r,this.image=o,this.scale=p,this.fontStack=v,this.textColor=E,this.verticalAlign=A}}class Ei{constructor(r){this.sections=r}static fromString(r){return new Ei([new mo(r,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((r=>r.text.length!==0||r.image&&r.image.name.length!==0))}static factory(r){return r instanceof Ei?r:Ei.fromString(r)}toString(){return this.sections.length===0?"":this.sections.map((r=>r.text)).join("")}}class qr{constructor(r){this.values=r.slice()}static parse(r){if(r instanceof qr)return r;if(typeof r=="number")return new qr([r,r,r,r]);if(Array.isArray(r)&&!(r.length<1||r.length>4)){for(const o of r)if(typeof o!="number")return;switch(r.length){case 1:r=[r[0],r[0],r[0],r[0]];break;case 2:r=[r[0],r[1],r[0],r[1]];break;case 3:r=[r[0],r[1],r[2],r[1]]}return new qr(r)}}toString(){return JSON.stringify(this.values)}static interpolate(r,o,p){return new qr(Gs(r.values,o.values,p))}}class fn{constructor(r){this.values=r.slice()}static parse(r){if(r instanceof fn)return r;if(typeof r=="number")return new fn([r]);if(Array.isArray(r)){for(const o of r)if(typeof o!="number")return;return new fn(r)}}toString(){return JSON.stringify(this.values)}static interpolate(r,o,p){return new fn(Gs(r.values,o.values,p))}}class hi{constructor(r){this.values=r.slice()}static parse(r){if(r instanceof hi)return r;if(typeof r=="string"){const p=Mn.parse(r);return p?new hi([p]):void 0}if(!Array.isArray(r))return;const o=[];for(const p of r){if(typeof p!="string")return;const v=Mn.parse(p);if(!v)return;o.push(v)}return new hi(o)}toString(){return JSON.stringify(this.values)}static interpolate(r,o,p,v="rgb"){const E=[];if(r.values.length!=o.values.length)throw new Error(`colorArray: Arrays have mismatched length (${r.values.length} vs. ${o.values.length}), cannot interpolate.`);for(let A=0;A<r.values.length;A++)E.push(Mn.interpolate(r.values[A],o.values[A],p,v));return new hi(E)}}class bn extends Error{constructor(r){super(r),this.name="RuntimeError"}toJSON(){return this.message}}const Aa=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class or{constructor(r){this.values=r.slice()}static parse(r){if(r instanceof or)return r;if(Array.isArray(r)&&!(r.length<1)&&r.length%2==0){for(let o=0;o<r.length;o+=2){const p=r[o],v=r[o+1];if(typeof p!="string"||!Aa.has(p)||!Array.isArray(v)||v.length!==2||typeof v[0]!="number"||typeof v[1]!="number")return}return new or(r)}}toString(){return JSON.stringify(this.values)}static interpolate(r,o,p){const v=r.values,E=o.values;if(v.length!==E.length)throw new bn(`Cannot interpolate values of different length. from: ${r.toString()}, to: ${o.toString()}`);const A=[];for(let P=0;P<v.length;P+=2){if(v[P]!==E[P])throw new bn(`Cannot interpolate values containing mismatched anchors. from[${P}]: ${v[P]}, to[${P}]: ${E[P]}`);A.push(v[P]);const[z,F]=v[P+1],[q,H]=E[P+1];A.push([vs(z,q,p),vs(F,H,p)])}return new or(A)}}class Br{constructor(r){this.name=r.name,this.available=r.available}toString(){return this.name}static fromString(r){return r?new Br({name:r,available:!1}):null}}class Oi{constructor(r,o,p){this.from=r,this.to=o,this.transition=p}static interpolate(r,o,p){return new Oi(r,o,p)}static parse(r){return r instanceof Oi?r:Array.isArray(r)&&r.length===3&&typeof r[0]=="string"&&typeof r[1]=="string"&&typeof r[2]=="number"?new Oi(r[0],r[1],r[2]):typeof r=="object"&&typeof r.from=="string"&&typeof r.to=="string"&&typeof r.transition=="number"?new Oi(r.from,r.to,r.transition):typeof r=="string"?new Oi(r,r,1):void 0}}function Tn(l,r,o,p){return typeof l=="number"&&l>=0&&l<=255&&typeof r=="number"&&r>=0&&r<=255&&typeof o=="number"&&o>=0&&o<=255?p===void 0||typeof p=="number"&&p>=0&&p<=1?null:`Invalid rgba value [${[l,r,o,p].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof p=="number"?[l,r,o,p]:[l,r,o]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function bs(l){if(l===null||typeof l=="string"||typeof l=="boolean"||typeof l=="number"||l instanceof Oi||l instanceof Mn||l instanceof Zs||l instanceof Ei||l instanceof qr||l instanceof fn||l instanceof hi||l instanceof or||l instanceof Br)return!0;if(Array.isArray(l)){for(const r of l)if(!bs(r))return!1;return!0}if(typeof l=="object"){for(const r in l)if(!bs(l[r]))return!1;return!0}return!1}function pn(l){if(l===null)return ps;if(typeof l=="string")return Rn;if(typeof l=="boolean")return In;if(typeof l=="number")return Vt;if(l instanceof Mn)return zi;if(l instanceof Oi)return Ka;if(l instanceof Zs)return $o;if(l instanceof Ei)return Sa;if(l instanceof qr)return ms;if(l instanceof fn)return ma;if(l instanceof hi)return Fa;if(l instanceof or)return Vu;if(l instanceof Br)return Ki;if(Array.isArray(l)){const r=l.length;let o;for(const p of l){const v=pn(p);if(o){if(o===v)continue;o=Vn;break}o=v}return Wr(o||Vn,r)}return Ui}function sn(l){const r=typeof l;return l===null?"":r==="string"||r==="number"||r==="boolean"?String(l):l instanceof Mn||l instanceof Oi||l instanceof Ei||l instanceof qr||l instanceof fn||l instanceof hi||l instanceof or||l instanceof Br?l.toString():JSON.stringify(l)}class $r{constructor(r,o){this.type=r,this.value=o}static parse(r,o){if(r.length!==2)return o.error(`'literal' expression requires exactly one argument, but found ${r.length-1} instead.`);if(!bs(r[1]))return o.error("invalid value");const p=r[1];let v=pn(p);const E=o.expectedType;return v.kind!=="array"||v.N!==0||!E||E.kind!=="array"||typeof E.N=="number"&&E.N!==0||(v=E),new $r(v,p)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const Jn={string:Rn,number:Vt,boolean:In,object:Ui};class xi{constructor(r,o){this.type=r,this.args=o}static parse(r,o){if(r.length<2)return o.error("Expected at least one argument.");let p,v=1;const E=r[0];if(E==="array"){let P,z;if(r.length>2){const F=r[1];if(typeof F!="string"||!(F in Jn)||F==="object")return o.error('The item type argument of "array" must be one of string, number, boolean',1);P=Jn[F],v++}else P=Vn;if(r.length>3){if(r[2]!==null&&(typeof r[2]!="number"||r[2]<0||r[2]!==Math.floor(r[2])))return o.error('The length argument to "array" must be a positive integer literal',2);z=r[2],v++}p=Wr(P,z)}else{if(!Jn[E])throw new Error(`Types doesn't contain name = ${E}`);p=Jn[E]}const A=[];for(;v<r.length;v++){const P=o.parse(r[v],v,Vn);if(!P)return null;A.push(P)}return new xi(p,A)}evaluate(r){for(let o=0;o<this.args.length;o++){const p=this.args[o].evaluate(r);if(!$s(this.type,pn(p)))return p;if(o===this.args.length-1)throw new bn(`Expected value to be of type ${fi(this.type)}, but found ${fi(pn(p))} instead.`)}throw new Error}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every((r=>r.outputDefined()))}}const lr={"to-boolean":In,"to-color":zi,"to-number":Vt,"to-string":Rn};class Ia{constructor(r,o){this.type=r,this.args=o}static parse(r,o){if(r.length<2)return o.error("Expected at least one argument.");const p=r[0];if(!lr[p])throw new Error(`Can't parse ${p} as it is not part of the known types`);if((p==="to-boolean"||p==="to-string")&&r.length!==2)return o.error("Expected one argument.");const v=lr[p],E=[];for(let A=1;A<r.length;A++){const P=o.parse(r[A],A,Vn);if(!P)return null;E.push(P)}return new Ia(v,E)}evaluate(r){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(r);case"color":{let o,p;for(const v of this.args){if(o=v.evaluate(r),p=null,o instanceof Mn)return o;if(typeof o=="string"){const E=r.parseColor(o);if(E)return E}else if(Array.isArray(o)&&(p=o.length<3||o.length>4?`Invalid rgba value ${JSON.stringify(o)}: expected an array containing either three or four numeric values.`:Tn(o[0],o[1],o[2],o[3]),!p))return new Mn(o[0]/255,o[1]/255,o[2]/255,o[3])}throw new bn(p||`Could not parse color from value '${typeof o=="string"?o:JSON.stringify(o)}'`)}case"padding":{let o;for(const p of this.args){o=p.evaluate(r);const v=qr.parse(o);if(v)return v}throw new bn(`Could not parse padding from value '${typeof o=="string"?o:JSON.stringify(o)}'`)}case"numberArray":{let o;for(const p of this.args){o=p.evaluate(r);const v=fn.parse(o);if(v)return v}throw new bn(`Could not parse numberArray from value '${typeof o=="string"?o:JSON.stringify(o)}'`)}case"colorArray":{let o;for(const p of this.args){o=p.evaluate(r);const v=hi.parse(o);if(v)return v}throw new bn(`Could not parse colorArray from value '${typeof o=="string"?o:JSON.stringify(o)}'`)}case"variableAnchorOffsetCollection":{let o;for(const p of this.args){o=p.evaluate(r);const v=or.parse(o);if(v)return v}throw new bn(`Could not parse variableAnchorOffsetCollection from value '${typeof o=="string"?o:JSON.stringify(o)}'`)}case"number":{let o=null;for(const p of this.args){if(o=p.evaluate(r),o===null)return 0;const v=Number(o);if(!isNaN(v))return v}throw new bn(`Could not convert ${JSON.stringify(o)} to number.`)}case"formatted":return Ei.fromString(sn(this.args[0].evaluate(r)));case"resolvedImage":return Br.fromString(sn(this.args[0].evaluate(r)));case"projectionDefinition":return this.args[0].evaluate(r);default:return sn(this.args[0].evaluate(r))}}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every((r=>r.outputDefined()))}}const go=["Unknown","Point","LineString","Polygon"];class Sl{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?go[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(r){let o=this._parseColorCache.get(r);return o||(o=Mn.parse(r),this._parseColorCache.set(r,o)),o}}class _o{constructor(r,o,p=[],v,E=new la,A=[]){this.registry=r,this.path=p,this.key=p.map((P=>`[${P}]`)).join(""),this.scope=E,this.errors=A,this.expectedType=v,this._isConstant=o}parse(r,o,p,v,E={}){return o?this.concat(o,p,v)._parse(r,E):this._parse(r,E)}_parse(r,o){function p(v,E,A){return A==="assert"?new xi(E,[v]):A==="coerce"?new Ia(E,[v]):v}if(r!==null&&typeof r!="string"&&typeof r!="boolean"&&typeof r!="number"||(r=["literal",r]),Array.isArray(r)){if(r.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const v=r[0];if(typeof v!="string")return this.error(`Expression name must be a string, but found ${typeof v} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const E=this.registry[v];if(E){let A=E.parse(r,this);if(!A)return null;if(this.expectedType){const P=this.expectedType,z=A.type;if(P.kind!=="string"&&P.kind!=="number"&&P.kind!=="boolean"&&P.kind!=="object"&&P.kind!=="array"||z.kind!=="value"){if(P.kind==="projectionDefinition"&&["string","array"].includes(z.kind)||["color","formatted","resolvedImage"].includes(P.kind)&&["value","string"].includes(z.kind)||["padding","numberArray"].includes(P.kind)&&["value","number","array"].includes(z.kind)||P.kind==="colorArray"&&["value","string","array"].includes(z.kind)||P.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(z.kind))A=p(A,P,o.typeAnnotation||"coerce");else if(this.checkSubtype(P,z))return null}else A=p(A,P,o.typeAnnotation||"assert")}if(!(A instanceof $r)&&A.type.kind!=="resolvedImage"&&this._isConstant(A)){const P=new Sl;try{A=new $r(A.type,A.evaluate(P))}catch(z){return this.error(z.message),null}}return A}return this.error(`Unknown expression "${v}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(r===void 0?"'undefined' value invalid. Use null instead.":typeof r=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof r} instead.`)}concat(r,o,p){const v=typeof r=="number"?this.path.concat(r):this.path,E=p?this.scope.concat(p):this.scope;return new _o(this.registry,this._isConstant,v,o||null,E,this.errors)}error(r,...o){const p=`${this.key}${o.map((v=>`[${v}]`)).join("")}`;this.errors.push(new tr(p,r))}checkSubtype(r,o){const p=$s(r,o);return p&&this.error(p),p}}class Xn{constructor(r,o){this.type=o.type,this.bindings=[].concat(r),this.result=o}evaluate(r){return this.result.evaluate(r)}eachChild(r){for(const o of this.bindings)r(o[1]);r(this.result)}static parse(r,o){if(r.length<4)return o.error(`Expected at least 3 arguments, but found ${r.length-1} instead.`);const p=[];for(let E=1;E<r.length-1;E+=2){const A=r[E];if(typeof A!="string")return o.error(`Expected string, but found ${typeof A} instead.`,E);if(/[^a-zA-Z0-9_]/.test(A))return o.error("Variable names must contain only alphanumeric characters or '_'.",E);const P=o.parse(r[E+1],E+1);if(!P)return null;p.push([A,P])}const v=o.parse(r[r.length-1],r.length-1,o.expectedType,p);return v?new Xn(p,v):null}outputDefined(){return this.result.outputDefined()}}class Hs{constructor(r,o){this.type=o.type,this.name=r,this.boundExpression=o}static parse(r,o){if(r.length!==2||typeof r[1]!="string")return o.error("'var' expression requires exactly one string literal argument.");const p=r[1];return o.scope.has(p)?new Hs(p,o.scope.get(p)):o.error(`Unknown variable "${p}". Make sure "${p}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(r){return this.boundExpression.evaluate(r)}eachChild(){}outputDefined(){return!1}}class Kr{constructor(r,o,p){this.type=r,this.index=o,this.input=p}static parse(r,o){if(r.length!==3)return o.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const p=o.parse(r[1],1,Vt),v=o.parse(r[2],2,Wr(o.expectedType||Vn));return p&&v?new Kr(v.type.itemType,p,v):null}evaluate(r){const o=this.index.evaluate(r),p=this.input.evaluate(r);if(o<0)throw new bn(`Array index out of bounds: ${o} < 0.`);if(o>=p.length)throw new bn(`Array index out of bounds: ${o} > ${p.length-1}.`);if(o!==Math.floor(o))throw new bn(`Array index must be an integer, but found ${o} instead.`);return p[o]}eachChild(r){r(this.index),r(this.input)}outputDefined(){return!1}}class xs{constructor(r,o){this.type=In,this.needle=r,this.haystack=o}static parse(r,o){if(r.length!==3)return o.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const p=o.parse(r[1],1,Vn),v=o.parse(r[2],2,Vn);return p&&v?ho(p.type,[In,Rn,Vt,ps,Vn])?new xs(p,v):o.error(`Expected first argument to be of type boolean, string, number or null, but found ${fi(p.type)} instead`):null}evaluate(r){const o=this.needle.evaluate(r),p=this.haystack.evaluate(r);if(!p)return!1;if(!Ea(o,["boolean","string","number","null"]))throw new bn(`Expected first argument to be of type boolean, string, number or null, but found ${fi(pn(o))} instead.`);if(!Ea(p,["string","array"]))throw new bn(`Expected second argument to be of type array or string, but found ${fi(pn(p))} instead.`);return p.indexOf(o)>=0}eachChild(r){r(this.needle),r(this.haystack)}outputDefined(){return!0}}class ws{constructor(r,o,p){this.type=Vt,this.needle=r,this.haystack=o,this.fromIndex=p}static parse(r,o){if(r.length<=2||r.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const p=o.parse(r[1],1,Vn),v=o.parse(r[2],2,Vn);if(!p||!v)return null;if(!ho(p.type,[In,Rn,Vt,ps,Vn]))return o.error(`Expected first argument to be of type boolean, string, number or null, but found ${fi(p.type)} instead`);if(r.length===4){const E=o.parse(r[3],3,Vt);return E?new ws(p,v,E):null}return new ws(p,v)}evaluate(r){const o=this.needle.evaluate(r),p=this.haystack.evaluate(r);if(!Ea(o,["boolean","string","number","null"]))throw new bn(`Expected first argument to be of type boolean, string, number or null, but found ${fi(pn(o))} instead.`);let v;if(this.fromIndex&&(v=this.fromIndex.evaluate(r)),Ea(p,["string"])){const E=p.indexOf(o,v);return E===-1?-1:[...p.slice(0,E)].length}if(Ea(p,["array"]))return p.indexOf(o,v);throw new bn(`Expected second argument to be of type array or string, but found ${fi(pn(p))} instead.`)}eachChild(r){r(this.needle),r(this.haystack),this.fromIndex&&r(this.fromIndex)}outputDefined(){return!1}}class Gr{constructor(r,o,p,v,E,A){this.inputType=r,this.type=o,this.input=p,this.cases=v,this.outputs=E,this.otherwise=A}static parse(r,o){if(r.length<5)return o.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if(r.length%2!=1)return o.error("Expected an even number of arguments.");let p,v;o.expectedType&&o.expectedType.kind!=="value"&&(v=o.expectedType);const E={},A=[];for(let F=2;F<r.length-1;F+=2){let q=r[F];const H=r[F+1];Array.isArray(q)||(q=[q]);const J=o.concat(F);if(q.length===0)return J.error("Expected at least one branch label.");for(const re of q){if(typeof re!="number"&&typeof re!="string")return J.error("Branch labels must be numbers or strings.");if(typeof re=="number"&&Math.abs(re)>Number.MAX_SAFE_INTEGER)return J.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof re=="number"&&Math.floor(re)!==re)return J.error("Numeric branch labels must be integer values.");if(p){if(J.checkSubtype(p,pn(re)))return null}else p=pn(re);if(E[String(re)]!==void 0)return J.error("Branch labels must be unique.");E[String(re)]=A.length}const ie=o.parse(H,F,v);if(!ie)return null;v=v||ie.type,A.push(ie)}const P=o.parse(r[1],1,Vn);if(!P)return null;const z=o.parse(r[r.length-1],r.length-1,v);return z?P.type.kind!=="value"&&o.concat(1).checkSubtype(p,P.type)?null:new Gr(p,v,P,E,A,z):null}evaluate(r){const o=this.input.evaluate(r);return(pn(o)===this.inputType&&this.outputs[this.cases[o]]||this.otherwise).evaluate(r)}eachChild(r){r(this.input),this.outputs.forEach(r),r(this.otherwise)}outputDefined(){return this.outputs.every((r=>r.outputDefined()))&&this.otherwise.outputDefined()}}class Ts{constructor(r,o,p){this.type=r,this.branches=o,this.otherwise=p}static parse(r,o){if(r.length<4)return o.error(`Expected at least 3 arguments, but found only ${r.length-1}.`);if(r.length%2!=0)return o.error("Expected an odd number of arguments.");let p;o.expectedType&&o.expectedType.kind!=="value"&&(p=o.expectedType);const v=[];for(let A=1;A<r.length-1;A+=2){const P=o.parse(r[A],A,In);if(!P)return null;const z=o.parse(r[A+1],A+1,p);if(!z)return null;v.push([P,z]),p=p||z.type}const E=o.parse(r[r.length-1],r.length-1,p);if(!E)return null;if(!p)throw new Error("Can't infer output type");return new Ts(p,v,E)}evaluate(r){for(const[o,p]of this.branches)if(o.evaluate(r))return p.evaluate(r);return this.otherwise.evaluate(r)}eachChild(r){for(const[o,p]of this.branches)r(o),r(p);r(this.otherwise)}outputDefined(){return this.branches.every((([r,o])=>o.outputDefined()))&&this.otherwise.outputDefined()}}class Wo{constructor(r,o,p,v){this.type=r,this.input=o,this.beginIndex=p,this.endIndex=v}static parse(r,o){if(r.length<=2||r.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const p=o.parse(r[1],1,Vn),v=o.parse(r[2],2,Vt);if(!p||!v)return null;if(!ho(p.type,[Wr(Vn),Rn,Vn]))return o.error(`Expected first argument to be of type array or string, but found ${fi(p.type)} instead`);if(r.length===4){const E=o.parse(r[3],3,Vt);return E?new Wo(p.type,p,v,E):null}return new Wo(p.type,p,v)}evaluate(r){const o=this.input.evaluate(r),p=this.beginIndex.evaluate(r);let v;if(this.endIndex&&(v=this.endIndex.evaluate(r)),Ea(o,["string"]))return[...o].slice(p,v).join("");if(Ea(o,["array"]))return o.slice(p,v);throw new bn(`Expected first argument to be of type array or string, but found ${fi(pn(o))} instead.`)}eachChild(r){r(this.input),r(this.beginIndex),this.endIndex&&r(this.endIndex)}outputDefined(){return!1}}function Ro(l,r){const o=l.length-1;let p,v,E=0,A=o,P=0;for(;E<=A;)if(P=Math.floor((E+A)/2),p=l[P],v=l[P+1],p<=r){if(P===o||r<v)return P;E=P+1}else{if(!(p>r))throw new bn("Input is not a number.");A=P-1}return 0}class nr{constructor(r,o,p){this.type=r,this.input=o,this.labels=[],this.outputs=[];for(const[v,E]of p)this.labels.push(v),this.outputs.push(E)}static parse(r,o){if(r.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return o.error("Expected an even number of arguments.");const p=o.parse(r[1],1,Vt);if(!p)return null;const v=[];let E=null;o.expectedType&&o.expectedType.kind!=="value"&&(E=o.expectedType);for(let A=1;A<r.length;A+=2){const P=A===1?-1/0:r[A],z=r[A+1],F=A,q=A+1;if(typeof P!="number")return o.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',F);if(v.length&&v[v.length-1][0]>=P)return o.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',F);const H=o.parse(z,q,E);if(!H)return null;E=E||H.type,v.push([P,H])}return new nr(E,p,v)}evaluate(r){const o=this.labels,p=this.outputs;if(o.length===1)return p[0].evaluate(r);const v=this.input.evaluate(r);if(v<=o[0])return p[0].evaluate(r);const E=o.length;return v>=o[E-1]?p[E-1].evaluate(r):p[Ro(o,v)].evaluate(r)}eachChild(r){r(this.input);for(const o of this.outputs)r(o)}outputDefined(){return this.outputs.every((r=>r.outputDefined()))}}function Uu(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}var Xo,Hl,Ss=(function(){if(Hl)return Xo;function l(r,o,p,v){this.cx=3*r,this.bx=3*(p-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*o,this.by=3*(v-o)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=o,this.p2x=p,this.p2y=v}return Hl=1,Xo=l,l.prototype={sampleCurveX:function(r){return((this.ax*r+this.bx)*r+this.cx)*r},sampleCurveY:function(r){return((this.ay*r+this.by)*r+this.cy)*r},sampleCurveDerivativeX:function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},solveCurveX:function(r,o){if(o===void 0&&(o=1e-6),r<0)return 0;if(r>1)return 1;for(var p=r,v=0;v<8;v++){var E=this.sampleCurveX(p)-r;if(Math.abs(E)<o)return p;var A=this.sampleCurveDerivativeX(p);if(Math.abs(A)<1e-6)break;p-=E/A}var P=0,z=1;for(p=r,v=0;v<20&&(E=this.sampleCurveX(p),!(Math.abs(E-r)<o));v++)r>E?P=p:z=p,p=.5*(z-P)+P;return p},solve:function(r,o){return this.sampleCurveY(this.solveCurveX(r,o))}},Xo})(),El=Uu(Ss);class ir{constructor(r,o,p,v,E){this.type=r,this.operator=o,this.interpolation=p,this.input=v,this.labels=[],this.outputs=[];for(const[A,P]of E)this.labels.push(A),this.outputs.push(P)}static interpolationFactor(r,o,p,v){let E=0;if(r.name==="exponential")E=es(o,r.base,p,v);else if(r.name==="linear")E=es(o,1,p,v);else if(r.name==="cubic-bezier"){const A=r.controlPoints;E=new El(A[0],A[1],A[2],A[3]).solve(es(o,1,p,v))}return E}static parse(r,o){let[p,v,E,...A]=r;if(!Array.isArray(v)||v.length===0)return o.error("Expected an interpolation type expression.",1);if(v[0]==="linear")v={name:"linear"};else if(v[0]==="exponential"){const F=v[1];if(typeof F!="number")return o.error("Exponential interpolation requires a numeric base.",1,1);v={name:"exponential",base:F}}else{if(v[0]!=="cubic-bezier")return o.error(`Unknown interpolation type ${String(v[0])}`,1,0);{const F=v.slice(1);if(F.length!==4||F.some((q=>typeof q!="number"||q<0||q>1)))return o.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);v={name:"cubic-bezier",controlPoints:F}}}if(r.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return o.error("Expected an even number of arguments.");if(E=o.parse(E,2,Vt),!E)return null;const P=[];let z=null;p!=="interpolate-hcl"&&p!=="interpolate-lab"||o.expectedType==Fa?o.expectedType&&o.expectedType.kind!=="value"&&(z=o.expectedType):z=zi;for(let F=0;F<A.length;F+=2){const q=A[F],H=A[F+1],J=F+3,ie=F+4;if(typeof q!="number")return o.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',J);if(P.length&&P[P.length-1][0]>=q)return o.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',J);const re=o.parse(H,ie,z);if(!re)return null;z=z||re.type,P.push([q,re])}return gs(z,Vt)||gs(z,Ka)||gs(z,zi)||gs(z,ms)||gs(z,ma)||gs(z,Fa)||gs(z,Vu)||gs(z,Wr(Vt))?new ir(z,p,v,E,P):o.error(`Type ${fi(z)} is not interpolatable.`)}evaluate(r){const o=this.labels,p=this.outputs;if(o.length===1)return p[0].evaluate(r);const v=this.input.evaluate(r);if(v<=o[0])return p[0].evaluate(r);const E=o.length;if(v>=o[E-1])return p[E-1].evaluate(r);const A=Ro(o,v),P=ir.interpolationFactor(this.interpolation,v,o[A],o[A+1]),z=p[A].evaluate(r),F=p[A+1].evaluate(r);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return vs(z,F,P);case"color":return Mn.interpolate(z,F,P);case"padding":return qr.interpolate(z,F,P);case"colorArray":return hi.interpolate(z,F,P);case"numberArray":return fn.interpolate(z,F,P);case"variableAnchorOffsetCollection":return or.interpolate(z,F,P);case"array":return Gs(z,F,P);case"projectionDefinition":return Oi.interpolate(z,F,P)}case"interpolate-hcl":switch(this.type.kind){case"color":return Mn.interpolate(z,F,P,"hcl");case"colorArray":return hi.interpolate(z,F,P,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return Mn.interpolate(z,F,P,"lab");case"colorArray":return hi.interpolate(z,F,P,"lab")}}}eachChild(r){r(this.input);for(const o of this.outputs)r(o)}outputDefined(){return this.outputs.every((r=>r.outputDefined()))}}function es(l,r,o,p){const v=p-o,E=l-o;return v===0?0:r===1?E/v:(Math.pow(r,E)-1)/(Math.pow(r,v)-1)}const Es={color:Mn.interpolate,number:vs,padding:qr.interpolate,numberArray:fn.interpolate,colorArray:hi.interpolate,variableAnchorOffsetCollection:or.interpolate,array:Gs};class ko{constructor(r,o){this.type=r,this.args=o}static parse(r,o){if(r.length<2)return o.error("Expected at least one argument.");let p=null;const v=o.expectedType;v&&v.kind!=="value"&&(p=v);const E=[];for(const P of r.slice(1)){const z=o.parse(P,1+E.length,p,void 0,{typeAnnotation:"omit"});if(!z)return null;p=p||z.type,E.push(z)}if(!p)throw new Error("No output type");const A=v&&E.some((P=>$s(v,P.type)));return new ko(A?Vn:p,E)}evaluate(r){let o,p=null,v=0;for(const E of this.args)if(v++,p=E.evaluate(r),p&&p instanceof Br&&!p.available&&(o||(o=p.name),p=null,v===this.args.length&&(p=o)),p!==null)break;return p}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every((r=>r.outputDefined()))}}function Ko(l,r){return l==="=="||l==="!="?r.kind==="boolean"||r.kind==="string"||r.kind==="number"||r.kind==="null"||r.kind==="value":r.kind==="string"||r.kind==="number"||r.kind==="value"}function Yo(l,r,o,p){return p.compare(r,o)===0}function Ai(l,r,o){const p=l!=="=="&&l!=="!=";return class mC{constructor(E,A,P){this.type=In,this.lhs=E,this.rhs=A,this.collator=P,this.hasUntypedArgument=E.type.kind==="value"||A.type.kind==="value"}static parse(E,A){if(E.length!==3&&E.length!==4)return A.error("Expected two or three arguments.");const P=E[0];let z=A.parse(E[1],1,Vn);if(!z)return null;if(!Ko(P,z.type))return A.concat(1).error(`"${P}" comparisons are not supported for type '${fi(z.type)}'.`);let F=A.parse(E[2],2,Vn);if(!F)return null;if(!Ko(P,F.type))return A.concat(2).error(`"${P}" comparisons are not supported for type '${fi(F.type)}'.`);if(z.type.kind!==F.type.kind&&z.type.kind!=="value"&&F.type.kind!=="value")return A.error(`Cannot compare types '${fi(z.type)}' and '${fi(F.type)}'.`);p&&(z.type.kind==="value"&&F.type.kind!=="value"?z=new xi(F.type,[z]):z.type.kind!=="value"&&F.type.kind==="value"&&(F=new xi(z.type,[F])));let q=null;if(E.length===4){if(z.type.kind!=="string"&&F.type.kind!=="string"&&z.type.kind!=="value"&&F.type.kind!=="value")return A.error("Cannot use collator to compare non-string types.");if(q=A.parse(E[3],3,$o),!q)return null}return new mC(z,F,q)}evaluate(E){const A=this.lhs.evaluate(E),P=this.rhs.evaluate(E);if(p&&this.hasUntypedArgument){const z=pn(A),F=pn(P);if(z.kind!==F.kind||z.kind!=="string"&&z.kind!=="number")throw new bn(`Expected arguments for "${l}" to be (string, string) or (number, number), but found (${z.kind}, ${F.kind}) instead.`)}if(this.collator&&!p&&this.hasUntypedArgument){const z=pn(A),F=pn(P);if(z.kind!=="string"||F.kind!=="string")return r(E,A,P)}return this.collator?o(E,A,P,this.collator.evaluate(E)):r(E,A,P)}eachChild(E){E(this.lhs),E(this.rhs),this.collator&&E(this.collator)}outputDefined(){return!0}}}const hu=Ai("==",(function(l,r,o){return r===o}),Yo),du=Ai("!=",(function(l,r,o){return r!==o}),(function(l,r,o,p){return!Yo(0,r,o,p)})),Wl=Ai("<",(function(l,r,o){return r<o}),(function(l,r,o,p){return p.compare(r,o)<0})),M=Ai(">",(function(l,r,o){return r>o}),(function(l,r,o,p){return p.compare(r,o)>0})),G=Ai("<=",(function(l,r,o){return r<=o}),(function(l,r,o,p){return p.compare(r,o)<=0})),te=Ai(">=",(function(l,r,o){return r>=o}),(function(l,r,o,p){return p.compare(r,o)>=0}));class ye{constructor(r,o,p){this.type=$o,this.locale=p,this.caseSensitive=r,this.diacriticSensitive=o}static parse(r,o){if(r.length!==2)return o.error("Expected one argument.");const p=r[1];if(typeof p!="object"||Array.isArray(p))return o.error("Collator options argument must be an object.");const v=o.parse(p["case-sensitive"]!==void 0&&p["case-sensitive"],1,In);if(!v)return null;const E=o.parse(p["diacritic-sensitive"]!==void 0&&p["diacritic-sensitive"],1,In);if(!E)return null;let A=null;return p.locale&&(A=o.parse(p.locale,1,Rn),!A)?null:new ye(v,E,A)}evaluate(r){return new Zs(this.caseSensitive.evaluate(r),this.diacriticSensitive.evaluate(r),this.locale?this.locale.evaluate(r):null)}eachChild(r){r(this.caseSensitive),r(this.diacriticSensitive),this.locale&&r(this.locale)}outputDefined(){return!1}}class at{constructor(r,o,p,v,E){this.type=Rn,this.number=r,this.locale=o,this.currency=p,this.minFractionDigits=v,this.maxFractionDigits=E}static parse(r,o){if(r.length!==3)return o.error("Expected two arguments.");const p=o.parse(r[1],1,Vt);if(!p)return null;const v=r[2];if(typeof v!="object"||Array.isArray(v))return o.error("NumberFormat options argument must be an object.");let E=null;if(v.locale&&(E=o.parse(v.locale,1,Rn),!E))return null;let A=null;if(v.currency&&(A=o.parse(v.currency,1,Rn),!A))return null;let P=null;if(v["min-fraction-digits"]&&(P=o.parse(v["min-fraction-digits"],1,Vt),!P))return null;let z=null;return v["max-fraction-digits"]&&(z=o.parse(v["max-fraction-digits"],1,Vt),!z)?null:new at(p,E,A,P,z)}evaluate(r){return new Intl.NumberFormat(this.locale?this.locale.evaluate(r):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(r):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(r):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(r):void 0}).format(this.number.evaluate(r))}eachChild(r){r(this.number),this.locale&&r(this.locale),this.currency&&r(this.currency),this.minFractionDigits&&r(this.minFractionDigits),this.maxFractionDigits&&r(this.maxFractionDigits)}outputDefined(){return!1}}class pt{constructor(r){this.type=Sa,this.sections=r}static parse(r,o){if(r.length<2)return o.error("Expected at least one argument.");const p=r[1];if(!Array.isArray(p)&&typeof p=="object")return o.error("First argument must be an image or text section.");const v=[];let E=!1;for(let A=1;A<=r.length-1;++A){const P=r[A];if(E&&typeof P=="object"&&!Array.isArray(P)){E=!1;let z=null;if(P["font-scale"]&&(z=o.parse(P["font-scale"],1,Vt),!z))return null;let F=null;if(P["text-font"]&&(F=o.parse(P["text-font"],1,Wr(Rn)),!F))return null;let q=null;if(P["text-color"]&&(q=o.parse(P["text-color"],1,zi),!q))return null;let H=null;if(P["vertical-align"]){if(typeof P["vertical-align"]=="string"&&!Mo.includes(P["vertical-align"]))return o.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${P["vertical-align"]}' instead.`);if(H=o.parse(P["vertical-align"],1,Rn),!H)return null}const J=v[v.length-1];J.scale=z,J.font=F,J.textColor=q,J.verticalAlign=H}else{const z=o.parse(r[A],1,Vn);if(!z)return null;const F=z.type.kind;if(F!=="string"&&F!=="value"&&F!=="null"&&F!=="resolvedImage")return o.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");E=!0,v.push({content:z,scale:null,font:null,textColor:null,verticalAlign:null})}}return new pt(v)}evaluate(r){return new Ei(this.sections.map((o=>{const p=o.content.evaluate(r);return pn(p)===Ki?new mo("",p,null,null,null,o.verticalAlign?o.verticalAlign.evaluate(r):null):new mo(sn(p),null,o.scale?o.scale.evaluate(r):null,o.font?o.font.evaluate(r).join(","):null,o.textColor?o.textColor.evaluate(r):null,o.verticalAlign?o.verticalAlign.evaluate(r):null)})))}eachChild(r){for(const o of this.sections)r(o.content),o.scale&&r(o.scale),o.font&&r(o.font),o.textColor&&r(o.textColor),o.verticalAlign&&r(o.verticalAlign)}outputDefined(){return!1}}class Wt{constructor(r){this.type=Ki,this.input=r}static parse(r,o){if(r.length!==2)return o.error("Expected two arguments.");const p=o.parse(r[1],1,Rn);return p?new Wt(p):o.error("No image name provided.")}evaluate(r){const o=this.input.evaluate(r),p=Br.fromString(o);return p&&r.availableImages&&(p.available=r.availableImages.indexOf(o)>-1),p}eachChild(r){r(this.input)}outputDefined(){return!1}}class kn{constructor(r){this.type=Vt,this.input=r}static parse(r,o){if(r.length!==2)return o.error(`Expected 1 argument, but found ${r.length-1} instead.`);const p=o.parse(r[1],1);return p?p.type.kind!=="array"&&p.type.kind!=="string"&&p.type.kind!=="value"?o.error(`Expected argument of type string or array, but found ${fi(p.type)} instead.`):new kn(p):null}evaluate(r){const o=this.input.evaluate(r);if(typeof o=="string")return[...o].length;if(Array.isArray(o))return o.length;throw new bn(`Expected value to be of type string or array, but found ${fi(pn(o))} instead.`)}eachChild(r){r(this.input)}outputDefined(){return!1}}const $n=8192;function Ri(l,r){const o=(180+l[0])/360,p=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+l[1]*Math.PI/360)))/360,v=Math.pow(2,r.z);return[Math.round(o*v*$n),Math.round(p*v*$n)]}function ur(l,r){const o=Math.pow(2,r.z);return[(v=(l[0]/$n+r.x)/o,360*v-180),(p=(l[1]/$n+r.y)/o,360/Math.PI*Math.atan(Math.exp((180-360*p)*Math.PI/180))-90)];var p,v}function Ca(l,r){l[0]=Math.min(l[0],r[0]),l[1]=Math.min(l[1],r[1]),l[2]=Math.max(l[2],r[0]),l[3]=Math.max(l[3],r[1])}function Ua(l,r){return!(l[0]<=r[0]||l[2]>=r[2]||l[1]<=r[1]||l[3]>=r[3])}function Ws(l,r,o){const p=l[0]-r[0],v=l[1]-r[1],E=l[0]-o[0],A=l[1]-o[1];return p*A-E*v==0&&p*E<=0&&v*A<=0}function As(l,r,o,p){return(v=[p[0]-o[0],p[1]-o[1]])[0]*(E=[r[0]-l[0],r[1]-l[1]])[1]-v[1]*E[0]!=0&&!(!nd(l,r,o,p)||!nd(o,p,l,r));var v,E}function Lo(l,r,o){for(const p of o)for(let v=0;v<p.length-1;++v)if(As(l,r,p[v],p[v+1]))return!0;return!1}function yo(l,r,o=!1){let p=!1;for(const P of r)for(let z=0;z<P.length-1;z++){if(Ws(l,P[z],P[z+1]))return o;(E=P[z])[1]>(v=l)[1]!=(A=P[z+1])[1]>v[1]&&v[0]<(A[0]-E[0])*(v[1]-E[1])/(A[1]-E[1])+E[0]&&(p=!p)}var v,E,A;return p}function Gd(l,r){for(const o of r)if(yo(l,o))return!0;return!1}function Xs(l,r){for(const o of l)if(!yo(o,r))return!1;for(let o=0;o<l.length-1;++o)if(Lo(l[o],l[o+1],r))return!1;return!0}function fu(l,r){for(const o of r)if(Xs(l,o))return!0;return!1}function nd(l,r,o,p){const v=p[0]-o[0],E=p[1]-o[1],A=(l[0]-o[0])*E-v*(l[1]-o[1]),P=(r[0]-o[0])*E-v*(r[1]-o[1]);return A>0&&P<0||A<0&&P>0}function ts(l,r,o){const p=[];for(let v=0;v<l.length;v++){const E=[];for(let A=0;A<l[v].length;A++){const P=Ri(l[v][A],o);Ca(r,P),E.push(P)}p.push(E)}return p}function ju(l,r,o){const p=[];for(let v=0;v<l.length;v++){const E=ts(l[v],r,o);p.push(E)}return p}function Al(l,r,o,p){if(l[0]<o[0]||l[0]>o[2]){const v=.5*p;let E=l[0]-o[0]>v?-p:o[0]-l[0]>v?p:0;E===0&&(E=l[0]-o[2]>v?-p:o[2]-l[0]>v?p:0),l[0]+=E}Ca(r,l)}function Sc(l,r,o,p){const v=Math.pow(2,p.z)*$n,E=[p.x*$n,p.y*$n],A=[];for(const P of l)for(const z of P){const F=[z.x+E[0],z.y+E[1]];Al(F,r,o,v),A.push(F)}return A}function pu(l,r,o,p){const v=Math.pow(2,p.z)*$n,E=[p.x*$n,p.y*$n],A=[];for(const z of l){const F=[];for(const q of z){const H=[q.x+E[0],q.y+E[1]];Ca(r,H),F.push(H)}A.push(F)}if(r[2]-r[0]<=v/2){(P=r)[0]=P[1]=1/0,P[2]=P[3]=-1/0;for(const z of A)for(const F of z)Al(F,r,o,v)}var P;return A}class Il{constructor(r,o){this.type=In,this.geojson=r,this.geometries=o}static parse(r,o){if(r.length!==2)return o.error(`'within' expression requires exactly one argument, but found ${r.length-1} instead.`);if(bs(r[1])){const p=r[1];if(p.type==="FeatureCollection"){const v=[];for(const E of p.features){const{type:A,coordinates:P}=E.geometry;A==="Polygon"&&v.push(P),A==="MultiPolygon"&&v.push(...P)}if(v.length)return new Il(p,{type:"MultiPolygon",coordinates:v})}else if(p.type==="Feature"){const v=p.geometry.type;if(v==="Polygon"||v==="MultiPolygon")return new Il(p,p.geometry)}else if(p.type==="Polygon"||p.type==="MultiPolygon")return new Il(p,p)}return o.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(r){if(r.geometry()!=null&&r.canonicalID()!=null){if(r.geometryType()==="Point")return(function(o,p){const v=[1/0,1/0,-1/0,-1/0],E=[1/0,1/0,-1/0,-1/0],A=o.canonicalID();if(p.type==="Polygon"){const P=ts(p.coordinates,E,A),z=Sc(o.geometry(),v,E,A);if(!Ua(v,E))return!1;for(const F of z)if(!yo(F,P))return!1}if(p.type==="MultiPolygon"){const P=ju(p.coordinates,E,A),z=Sc(o.geometry(),v,E,A);if(!Ua(v,E))return!1;for(const F of z)if(!Gd(F,P))return!1}return!0})(r,this.geometries);if(r.geometryType()==="LineString")return(function(o,p){const v=[1/0,1/0,-1/0,-1/0],E=[1/0,1/0,-1/0,-1/0],A=o.canonicalID();if(p.type==="Polygon"){const P=ts(p.coordinates,E,A),z=pu(o.geometry(),v,E,A);if(!Ua(v,E))return!1;for(const F of z)if(!Xs(F,P))return!1}if(p.type==="MultiPolygon"){const P=ju(p.coordinates,E,A),z=pu(o.geometry(),v,E,A);if(!Ua(v,E))return!1;for(const F of z)if(!fu(F,P))return!1}return!0})(r,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Xl=class{constructor(l=[],r=(o,p)=>o<p?-1:o>p?1:0){if(this.data=l,this.length=this.data.length,this.compare=r,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(l){this.data.push(l),this._up(this.length++)}pop(){if(this.length===0)return;const l=this.data[0],r=this.data.pop();return--this.length>0&&(this.data[0]=r,this._down(0)),l}peek(){return this.data[0]}_up(l){const{data:r,compare:o}=this,p=r[l];for(;l>0;){const v=l-1>>1,E=r[v];if(o(p,E)>=0)break;r[l]=E,l=v}r[l]=p}_down(l){const{data:r,compare:o}=this,p=this.length>>1,v=r[l];for(;l<p;){let E=1+(l<<1);const A=E+1;if(A<this.length&&o(r[A],r[E])<0&&(E=A),o(r[E],v)>=0)break;r[l]=r[E],l=E}r[l]=v}};function Ec(l,r,o=0,p=l.length-1,v=Ac){for(;p>o;){if(p-o>600){const z=p-o+1,F=r-o+1,q=Math.log(z),H=.5*Math.exp(2*q/3),J=.5*Math.sqrt(q*H*(z-H)/z)*(F-z/2<0?-1:1);Ec(l,r,Math.max(o,Math.floor(r-F*H/z+J)),Math.min(p,Math.floor(r+(z-F)*H/z+J)),v)}const E=l[r];let A=o,P=p;for(Ks(l,o,r),v(l[p],E)>0&&Ks(l,o,p);A<P;){for(Ks(l,A,P),A++,P--;v(l[A],E)<0;)A++;for(;v(l[P],E)>0;)P--}v(l[o],E)===0?Ks(l,o,P):(P++,Ks(l,P,p)),P<=r&&(o=P+1),r<=P&&(p=P-1)}}function Ks(l,r,o){const p=l[r];l[r]=l[o],l[o]=p}function Ac(l,r){return l<r?-1:l>r?1:0}function qu(l,r){if(l.length<=1)return[l];const o=[];let p,v;for(const E of l){const A=Zf(E);A!==0&&(E.area=Math.abs(A),v===void 0&&(v=A<0),v===A<0?(p&&o.push(p),p=[E]):p.push(E))}if(p&&o.push(p),r>1)for(let E=0;E<o.length;E++)o[E].length<=r||(Ec(o[E],r,1,o[E].length-1,hh),o[E]=o[E].slice(0,r));return o}function hh(l,r){return r.area-l.area}function Zf(l){let r=0;for(let o,p,v=0,E=l.length,A=E-1;v<E;A=v++)o=l[v],p=l[A],r+=(p.x-o.x)*(o.y+p.y);return r}const Qo=1/298.257223563,Zd=Qo*(2-Qo),Kl=Math.PI/180;class ns{constructor(r){const o=6378.137*Kl*1e3,p=Math.cos(r*Kl),v=1/(1-Zd*(1-p*p)),E=Math.sqrt(v);this.kx=o*E*p,this.ky=o*E*v*(1-Zd)}distance(r,o){const p=this.wrap(r[0]-o[0])*this.kx,v=(r[1]-o[1])*this.ky;return Math.sqrt(p*p+v*v)}pointOnLine(r,o){let p,v,E,A,P=1/0;for(let z=0;z<r.length-1;z++){let F=r[z][0],q=r[z][1],H=this.wrap(r[z+1][0]-F)*this.kx,J=(r[z+1][1]-q)*this.ky,ie=0;H===0&&J===0||(ie=(this.wrap(o[0]-F)*this.kx*H+(o[1]-q)*this.ky*J)/(H*H+J*J),ie>1?(F=r[z+1][0],q=r[z+1][1]):ie>0&&(F+=H/this.kx*ie,q+=J/this.ky*ie)),H=this.wrap(o[0]-F)*this.kx,J=(o[1]-q)*this.ky;const re=H*H+J*J;re<P&&(P=re,p=F,v=q,E=z,A=ie)}return{point:[p,v],index:E,t:Math.max(0,Math.min(1,A))}}wrap(r){for(;r<-180;)r+=360;for(;r>180;)r-=360;return r}}function Is(l,r){return r[0]-l[0]}function Yl(l){return l[1]-l[0]+1}function Do(l,r){return l[1]>=l[0]&&l[1]<r}function oi(l,r){if(l[0]>l[1])return[null,null];const o=Yl(l);if(r){if(o===2)return[l,null];const v=Math.floor(o/2);return[[l[0],l[0]+v],[l[0]+v,l[1]]]}if(o===1)return[l,null];const p=Math.floor(o/2)-1;return[[l[0],l[0]+p],[l[0]+p+1,l[1]]]}function mu(l,r){if(!Do(r,l.length))return[1/0,1/0,-1/0,-1/0];const o=[1/0,1/0,-1/0,-1/0];for(let p=r[0];p<=r[1];++p)Ca(o,l[p]);return o}function gu(l){const r=[1/0,1/0,-1/0,-1/0];for(const o of l)for(const p of o)Ca(r,p);return r}function Ic(l){return l[0]!==-1/0&&l[1]!==-1/0&&l[2]!==1/0&&l[3]!==1/0}function Ys(l,r,o){if(!Ic(l)||!Ic(r))return NaN;let p=0,v=0;return l[2]<r[0]&&(p=r[0]-l[2]),l[0]>r[2]&&(p=l[0]-r[2]),l[1]>r[3]&&(v=l[1]-r[3]),l[3]<r[1]&&(v=r[1]-l[3]),o.distance([0,0],[p,v])}function vo(l,r,o){const p=o.pointOnLine(r,l);return o.distance(l,p.point)}function Cl(l,r,o,p,v){const E=Math.min(vo(l,[o,p],v),vo(r,[o,p],v)),A=Math.min(vo(o,[l,r],v),vo(p,[l,r],v));return Math.min(E,A)}function dh(l,r,o,p,v){if(!Do(r,l.length)||!Do(p,o.length))return 1/0;let E=1/0;for(let A=r[0];A<r[1];++A){const P=l[A],z=l[A+1];for(let F=p[0];F<p[1];++F){const q=o[F],H=o[F+1];if(As(P,z,q,H))return 0;E=Math.min(E,Cl(P,z,q,H,v))}}return E}function Hd(l,r,o,p,v){if(!Do(r,l.length)||!Do(p,o.length))return NaN;let E=1/0;for(let A=r[0];A<=r[1];++A)for(let P=p[0];P<=p[1];++P)if(E=Math.min(E,v.distance(l[A],o[P])),E===0)return E;return E}function Jo(l,r,o){if(yo(l,r,!0))return 0;let p=1/0;for(const v of r){const E=v[0],A=v[v.length-1];if(E!==A&&(p=Math.min(p,vo(l,[A,E],o)),p===0))return p;const P=o.pointOnLine(v,l);if(p=Math.min(p,o.distance(l,P.point)),p===0)return p}return p}function $u(l,r,o,p){if(!Do(r,l.length))return NaN;for(let E=r[0];E<=r[1];++E)if(yo(l[E],o,!0))return 0;let v=1/0;for(let E=r[0];E<r[1];++E){const A=l[E],P=l[E+1];for(const z of o)for(let F=0,q=z.length,H=q-1;F<q;H=F++){const J=z[H],ie=z[F];if(As(A,P,J,ie))return 0;v=Math.min(v,Cl(A,P,J,ie,p))}}return v}function Cc(l,r){for(const o of l)for(const p of o)if(yo(p,r,!0))return!0;return!1}function Wd(l,r,o,p=1/0){const v=gu(l),E=gu(r);if(p!==1/0&&Ys(v,E,o)>=p)return p;if(Ua(v,E)){if(Cc(l,r))return 0}else if(Cc(r,l))return 0;let A=1/0;for(const P of l)for(let z=0,F=P.length,q=F-1;z<F;q=z++){const H=P[q],J=P[z];for(const ie of r)for(let re=0,oe=ie.length,pe=oe-1;re<oe;pe=re++){const we=ie[pe],He=ie[re];if(As(H,J,we,He))return 0;A=Math.min(A,Cl(H,J,we,He,o))}}return A}function Pl(l,r,o,p,v,E){if(!E)return;const A=Ys(mu(p,E),v,o);A<r&&l.push([A,E,[0,0]])}function Pc(l,r,o,p,v,E,A){if(!E||!A)return;const P=Ys(mu(p,E),mu(v,A),o);P<r&&l.push([P,E,A])}function Cs(l,r,o,p,v=1/0){let E=Math.min(p.distance(l[0],o[0][0]),v);if(E===0)return E;const A=new Xl([[0,[0,l.length-1],[0,0]]],Is),P=gu(o);for(;A.length>0;){const z=A.pop();if(z[0]>=E)continue;const F=z[1],q=r?50:100;if(Yl(F)<=q){if(!Do(F,l.length))return NaN;if(r){const H=$u(l,F,o,p);if(isNaN(H)||H===0)return H;E=Math.min(E,H)}else for(let H=F[0];H<=F[1];++H){const J=Jo(l[H],o,p);if(E=Math.min(E,J),E===0)return 0}}else{const H=oi(F,r);Pl(A,E,p,l,P,H[0]),Pl(A,E,p,l,P,H[1])}}return E}function Ql(l,r,o,p,v,E=1/0){let A=Math.min(E,v.distance(l[0],o[0]));if(A===0)return A;const P=new Xl([[0,[0,l.length-1],[0,o.length-1]]],Is);for(;P.length>0;){const z=P.pop();if(z[0]>=A)continue;const F=z[1],q=z[2],H=r?50:100,J=p?50:100;if(Yl(F)<=H&&Yl(q)<=J){if(!Do(F,l.length)&&Do(q,o.length))return NaN;let ie;if(r&&p)ie=dh(l,F,o,q,v),A=Math.min(A,ie);else if(r&&!p){const re=l.slice(F[0],F[1]+1);for(let oe=q[0];oe<=q[1];++oe)if(ie=vo(o[oe],re,v),A=Math.min(A,ie),A===0)return A}else if(!r&&p){const re=o.slice(q[0],q[1]+1);for(let oe=F[0];oe<=F[1];++oe)if(ie=vo(l[oe],re,v),A=Math.min(A,ie),A===0)return A}else ie=Hd(l,F,o,q,v),A=Math.min(A,ie)}else{const ie=oi(F,r),re=oi(q,p);Pc(P,A,v,l,o,ie[0],re[0]),Pc(P,A,v,l,o,ie[0],re[1]),Pc(P,A,v,l,o,ie[1],re[0]),Pc(P,A,v,l,o,ie[1],re[1])}}return A}function id(l){return l.type==="MultiPolygon"?l.coordinates.map((r=>({type:"Polygon",coordinates:r}))):l.type==="MultiLineString"?l.coordinates.map((r=>({type:"LineString",coordinates:r}))):l.type==="MultiPoint"?l.coordinates.map((r=>({type:"Point",coordinates:r}))):[l]}class el{constructor(r,o){this.type=Vt,this.geojson=r,this.geometries=o}static parse(r,o){if(r.length!==2)return o.error(`'distance' expression requires exactly one argument, but found ${r.length-1} instead.`);if(bs(r[1])){const p=r[1];if(p.type==="FeatureCollection")return new el(p,p.features.map((v=>id(v.geometry))).flat());if(p.type==="Feature")return new el(p,id(p.geometry));if("type"in p&&"coordinates"in p)return new el(p,id(p))}return o.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(r){if(r.geometry()!=null&&r.canonicalID()!=null){if(r.geometryType()==="Point")return(function(o,p){const v=o.geometry(),E=v.flat().map((z=>ur([z.x,z.y],o.canonical)));if(v.length===0)return NaN;const A=new ns(E[0][1]);let P=1/0;for(const z of p){switch(z.type){case"Point":P=Math.min(P,Ql(E,!1,[z.coordinates],!1,A,P));break;case"LineString":P=Math.min(P,Ql(E,!1,z.coordinates,!0,A,P));break;case"Polygon":P=Math.min(P,Cs(E,!1,z.coordinates,A,P))}if(P===0)return P}return P})(r,this.geometries);if(r.geometryType()==="LineString")return(function(o,p){const v=o.geometry(),E=v.flat().map((z=>ur([z.x,z.y],o.canonical)));if(v.length===0)return NaN;const A=new ns(E[0][1]);let P=1/0;for(const z of p){switch(z.type){case"Point":P=Math.min(P,Ql(E,!0,[z.coordinates],!1,A,P));break;case"LineString":P=Math.min(P,Ql(E,!0,z.coordinates,!0,A,P));break;case"Polygon":P=Math.min(P,Cs(E,!0,z.coordinates,A,P))}if(P===0)return P}return P})(r,this.geometries);if(r.geometryType()==="Polygon")return(function(o,p){const v=o.geometry();if(v.length===0||v[0].length===0)return NaN;const E=qu(v,0).map((z=>z.map((F=>F.map((q=>ur([q.x,q.y],o.canonical))))))),A=new ns(E[0][0][0][1]);let P=1/0;for(const z of p)for(const F of E){switch(z.type){case"Point":P=Math.min(P,Cs([z.coordinates],!1,F,A,P));break;case"LineString":P=Math.min(P,Cs(z.coordinates,!0,F,A,P));break;case"Polygon":P=Math.min(P,Wd(F,z.coordinates,A,P))}if(P===0)return P}return P})(r,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class Mc{constructor(r){this.type=Vn,this.key=r}static parse(r,o){if(r.length!==2)return o.error(`Expected 1 argument, but found ${r.length-1} instead.`);const p=r[1];return p==null?o.error("Global state property must be defined."):typeof p!="string"?o.error(`Global state property must be string, but found ${typeof r[1]} instead.`):new Mc(p)}evaluate(r){var o;const p=(o=r.globals)===null||o===void 0?void 0:o.globalState;return p&&Object.keys(p).length!==0?Ya(p,this.key):null}eachChild(){}outputDefined(){return!1}}const Jl={"==":hu,"!=":du,">":M,"<":Wl,">=":te,"<=":G,array:xi,at:Kr,boolean:xi,case:Ts,coalesce:ko,collator:ye,format:pt,image:Wt,in:xs,"index-of":ws,interpolate:ir,"interpolate-hcl":ir,"interpolate-lab":ir,length:kn,let:Xn,literal:$r,match:Gr,number:xi,"number-format":at,object:xi,slice:Wo,step:nr,string:xi,"to-boolean":Ia,"to-color":Ia,"to-number":Ia,"to-string":Ia,var:Hs,within:Il,distance:el,"global-state":Mc};class Qs{constructor(r,o,p,v){this.name=r,this.type=o,this._evaluate=p,this.args=v}evaluate(r){return this._evaluate(r,this.args)}eachChild(r){this.args.forEach(r)}outputDefined(){return!1}static parse(r,o){const p=r[0],v=Qs.definitions[p];if(!v)return o.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0);const E=Array.isArray(v)?v[0]:v.type,A=Array.isArray(v)?[[v[1],v[2]]]:v.overloads,P=A.filter((([F])=>!Array.isArray(F)||F.length===r.length-1));let z=null;for(const[F,q]of P){z=new _o(o.registry,ja,o.path,null,o.scope);const H=[];let J=!1;for(let ie=1;ie<r.length;ie++){const re=r[ie],oe=Array.isArray(F)?F[ie-1]:F.type,pe=z.parse(re,1+H.length,oe);if(!pe){J=!0;break}H.push(pe)}if(!J)if(Array.isArray(F)&&F.length!==H.length)z.error(`Expected ${F.length} arguments, but found ${H.length} instead.`);else{for(let ie=0;ie<H.length;ie++){const re=Array.isArray(F)?F[ie]:F.type,oe=H[ie];z.concat(ie+1).checkSubtype(re,oe.type)}if(z.errors.length===0)return new Qs(p,E,q,H)}}if(P.length===1)o.errors.push(...z.errors);else{const F=(P.length?P:A).map((([H])=>{return J=H,Array.isArray(J)?`(${J.map(fi).join(", ")})`:`(${fi(J.type)}...)`;var J})).join(" | "),q=[];for(let H=1;H<r.length;H++){const J=o.parse(r[H],1+q.length);if(!J)return null;q.push(fi(J.type))}o.error(`Expected arguments of type ${F}, but found (${q.join(", ")}) instead.`)}return null}static register(r,o){Qs.definitions=o;for(const p in o)r[p]=Qs}}function eu(l,[r,o,p,v]){r=r.evaluate(l),o=o.evaluate(l),p=p.evaluate(l);const E=v?v.evaluate(l):1,A=Tn(r,o,p,E);if(A)throw new bn(A);return new Mn(r/255,o/255,p/255,E,!1)}function bo(l,r){return l in r}function Ml(l,r){const o=r[l];return o===void 0?null:o}function ua(l){return{type:l}}function ja(l){if(l instanceof Hs)return ja(l.boundExpression);if(l instanceof Qs&&l.name==="error"||l instanceof ye||l instanceof Il||l instanceof el||l instanceof Mc)return!1;const r=l instanceof Ia||l instanceof xi;let o=!0;return l.eachChild((p=>{o=r?o&&ja(p):o&&p instanceof $r})),!!o&&Rl(l)&&tu(l,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function Rl(l){if(l instanceof Qs&&(l.name==="get"&&l.args.length===1||l.name==="feature-state"||l.name==="has"&&l.args.length===1||l.name==="properties"||l.name==="geometry-type"||l.name==="id"||/^filter-/.test(l.name))||l instanceof Il||l instanceof el)return!1;let r=!0;return l.eachChild((o=>{r&&!Rl(o)&&(r=!1)})),r}function is(l){if(l instanceof Qs&&l.name==="feature-state")return!1;let r=!0;return l.eachChild((o=>{r&&!is(o)&&(r=!1)})),r}function tu(l,r){if(l instanceof Qs&&r.indexOf(l.name)>=0)return!1;let o=!0;return l.eachChild((p=>{o&&!tu(p,r)&&(o=!1)})),o}function Gu(l){return{result:"success",value:l}}function xo(l){return{result:"error",value:l}}function Js(l){return l["property-type"]==="data-driven"||l["property-type"]==="cross-faded-data-driven"}function Zu(l){return!!l.expression&&l.expression.parameters.indexOf("zoom")>-1}function tl(l){return!!l.expression&&l.expression.interpolated}function Gn(l){return l instanceof Number?"number":l instanceof String?"string":l instanceof Boolean?"boolean":Array.isArray(l)?"array":l===null?"null":typeof l}function Hu(l){return typeof l=="object"&&l!==null&&!Array.isArray(l)&&pn(l)===Ui}function eo(l){return l}function Rc(l,r){const o=l.stops&&typeof l.stops[0][0]=="object",p=o||!(o||l.property!==void 0),v=l.type||(tl(r)?"exponential":"interval"),E=(function(q){switch(q.type){case"color":return Mn.parse;case"padding":return qr.parse;case"numberArray":return fn.parse;case"colorArray":return hi.parse;default:return null}})(r);if(E&&((l=Qt({},l)).stops&&(l.stops=l.stops.map((q=>[q[0],E(q[1])]))),l.default=E(l.default?l.default:r.default)),l.colorSpace&&(A=l.colorSpace)!=="rgb"&&A!=="hcl"&&A!=="lab")throw new Error(`Unknown color space: "${l.colorSpace}"`);var A;const P=(function(q){switch(q){case"exponential":return kl;case"interval":return kc;case"categorical":return fh;case"identity":return rd;default:throw new Error(`Unknown function type "${q}"`)}})(v);let z,F;if(v==="categorical"){z=Object.create(null);for(const q of l.stops)z[q[0]]=q[1];F=typeof l.stops[0][0]}if(o){const q={},H=[];for(let re=0;re<l.stops.length;re++){const oe=l.stops[re],pe=oe[0].zoom;q[pe]===void 0&&(q[pe]={zoom:pe,type:l.type,property:l.property,default:l.default,stops:[]},H.push(pe)),q[pe].stops.push([oe[0].value,oe[1]])}const J=[];for(const re of H)J.push([q[re].zoom,Rc(q[re],r)]);const ie={name:"linear"};return{kind:"composite",interpolationType:ie,interpolationFactor:ir.interpolationFactor.bind(void 0,ie),zoomStops:J.map((re=>re[0])),evaluate:({zoom:re},oe)=>kl({stops:J,base:l.base},r,re).evaluate(re,oe)}}if(p){const q=v==="exponential"?{name:"exponential",base:l.base!==void 0?l.base:1}:null;return{kind:"camera",interpolationType:q,interpolationFactor:ir.interpolationFactor.bind(void 0,q),zoomStops:l.stops.map((H=>H[0])),evaluate:({zoom:H})=>P(l,r,H,z,F)}}return{kind:"source",evaluate(q,H){const J=H&&H.properties?H.properties[l.property]:void 0;return J===void 0?Pa(l.default,r.default):P(l,r,J,z,F)}}}function Pa(l,r,o){return l!==void 0?l:r!==void 0?r:o!==void 0?o:void 0}function fh(l,r,o,p,v){return Pa(typeof o===v?p[o]:void 0,l.default,r.default)}function kc(l,r,o){if(Gn(o)!=="number")return Pa(l.default,r.default);const p=l.stops.length;if(p===1||o<=l.stops[0][0])return l.stops[0][1];if(o>=l.stops[p-1][0])return l.stops[p-1][1];const v=Ro(l.stops.map((E=>E[0])),o);return l.stops[v][1]}function kl(l,r,o){const p=l.base!==void 0?l.base:1;if(Gn(o)!=="number")return Pa(l.default,r.default);const v=l.stops.length;if(v===1||o<=l.stops[0][0])return l.stops[0][1];if(o>=l.stops[v-1][0])return l.stops[v-1][1];const E=Ro(l.stops.map((q=>q[0])),o),A=(function(q,H,J,ie){const re=ie-J,oe=q-J;return re===0?0:H===1?oe/re:(Math.pow(H,oe)-1)/(Math.pow(H,re)-1)})(o,p,l.stops[E][0],l.stops[E+1][0]),P=l.stops[E][1],z=l.stops[E+1][1],F=Es[r.type]||eo;return typeof P.evaluate=="function"?{evaluate(...q){const H=P.evaluate.apply(void 0,q),J=z.evaluate.apply(void 0,q);if(H!==void 0&&J!==void 0)return F(H,J,A,l.colorSpace)}}:F(P,z,A,l.colorSpace)}function rd(l,r,o){switch(r.type){case"color":o=Mn.parse(o);break;case"formatted":o=Ei.fromString(o.toString());break;case"resolvedImage":o=Br.fromString(o.toString());break;case"padding":o=qr.parse(o);break;case"colorArray":o=hi.parse(o);break;case"numberArray":o=fn.parse(o);break;default:Gn(o)===r.type||r.type==="enum"&&r.values[o]||(o=void 0)}return Pa(o,l.default,r.default)}Qs.register(Jl,{error:[{kind:"error"},[Rn],(l,[r])=>{throw new bn(r.evaluate(l))}],typeof:[Rn,[Vn],(l,[r])=>fi(pn(r.evaluate(l)))],"to-rgba":[Wr(Vt,4),[zi],(l,[r])=>{const[o,p,v,E]=r.evaluate(l).rgb;return[255*o,255*p,255*v,E]}],rgb:[zi,[Vt,Vt,Vt],eu],rgba:[zi,[Vt,Vt,Vt,Vt],eu],has:{type:In,overloads:[[[Rn],(l,[r])=>bo(r.evaluate(l),l.properties())],[[Rn,Ui],(l,[r,o])=>bo(r.evaluate(l),o.evaluate(l))]]},get:{type:Vn,overloads:[[[Rn],(l,[r])=>Ml(r.evaluate(l),l.properties())],[[Rn,Ui],(l,[r,o])=>Ml(r.evaluate(l),o.evaluate(l))]]},"feature-state":[Vn,[Rn],(l,[r])=>Ml(r.evaluate(l),l.featureState||{})],properties:[Ui,[],l=>l.properties()],"geometry-type":[Rn,[],l=>l.geometryType()],id:[Vn,[],l=>l.id()],zoom:[Vt,[],l=>l.globals.zoom],"heatmap-density":[Vt,[],l=>l.globals.heatmapDensity||0],elevation:[Vt,[],l=>l.globals.elevation||0],"line-progress":[Vt,[],l=>l.globals.lineProgress||0],accumulated:[Vn,[],l=>l.globals.accumulated===void 0?null:l.globals.accumulated],"+":[Vt,ua(Vt),(l,r)=>{let o=0;for(const p of r)o+=p.evaluate(l);return o}],"*":[Vt,ua(Vt),(l,r)=>{let o=1;for(const p of r)o*=p.evaluate(l);return o}],"-":{type:Vt,overloads:[[[Vt,Vt],(l,[r,o])=>r.evaluate(l)-o.evaluate(l)],[[Vt],(l,[r])=>-r.evaluate(l)]]},"/":[Vt,[Vt,Vt],(l,[r,o])=>r.evaluate(l)/o.evaluate(l)],"%":[Vt,[Vt,Vt],(l,[r,o])=>r.evaluate(l)%o.evaluate(l)],ln2:[Vt,[],()=>Math.LN2],pi:[Vt,[],()=>Math.PI],e:[Vt,[],()=>Math.E],"^":[Vt,[Vt,Vt],(l,[r,o])=>Math.pow(r.evaluate(l),o.evaluate(l))],sqrt:[Vt,[Vt],(l,[r])=>Math.sqrt(r.evaluate(l))],log10:[Vt,[Vt],(l,[r])=>Math.log(r.evaluate(l))/Math.LN10],ln:[Vt,[Vt],(l,[r])=>Math.log(r.evaluate(l))],log2:[Vt,[Vt],(l,[r])=>Math.log(r.evaluate(l))/Math.LN2],sin:[Vt,[Vt],(l,[r])=>Math.sin(r.evaluate(l))],cos:[Vt,[Vt],(l,[r])=>Math.cos(r.evaluate(l))],tan:[Vt,[Vt],(l,[r])=>Math.tan(r.evaluate(l))],asin:[Vt,[Vt],(l,[r])=>Math.asin(r.evaluate(l))],acos:[Vt,[Vt],(l,[r])=>Math.acos(r.evaluate(l))],atan:[Vt,[Vt],(l,[r])=>Math.atan(r.evaluate(l))],min:[Vt,ua(Vt),(l,r)=>Math.min(...r.map((o=>o.evaluate(l))))],max:[Vt,ua(Vt),(l,r)=>Math.max(...r.map((o=>o.evaluate(l))))],abs:[Vt,[Vt],(l,[r])=>Math.abs(r.evaluate(l))],round:[Vt,[Vt],(l,[r])=>{const o=r.evaluate(l);return o<0?-Math.round(-o):Math.round(o)}],floor:[Vt,[Vt],(l,[r])=>Math.floor(r.evaluate(l))],ceil:[Vt,[Vt],(l,[r])=>Math.ceil(r.evaluate(l))],"filter-==":[In,[Rn,Vn],(l,[r,o])=>l.properties()[r.value]===o.value],"filter-id-==":[In,[Vn],(l,[r])=>l.id()===r.value],"filter-type-==":[In,[Rn],(l,[r])=>l.geometryType()===r.value],"filter-<":[In,[Rn,Vn],(l,[r,o])=>{const p=l.properties()[r.value],v=o.value;return typeof p==typeof v&&p<v}],"filter-id-<":[In,[Vn],(l,[r])=>{const o=l.id(),p=r.value;return typeof o==typeof p&&o<p}],"filter->":[In,[Rn,Vn],(l,[r,o])=>{const p=l.properties()[r.value],v=o.value;return typeof p==typeof v&&p>v}],"filter-id->":[In,[Vn],(l,[r])=>{const o=l.id(),p=r.value;return typeof o==typeof p&&o>p}],"filter-<=":[In,[Rn,Vn],(l,[r,o])=>{const p=l.properties()[r.value],v=o.value;return typeof p==typeof v&&p<=v}],"filter-id-<=":[In,[Vn],(l,[r])=>{const o=l.id(),p=r.value;return typeof o==typeof p&&o<=p}],"filter->=":[In,[Rn,Vn],(l,[r,o])=>{const p=l.properties()[r.value],v=o.value;return typeof p==typeof v&&p>=v}],"filter-id->=":[In,[Vn],(l,[r])=>{const o=l.id(),p=r.value;return typeof o==typeof p&&o>=p}],"filter-has":[In,[Vn],(l,[r])=>r.value in l.properties()],"filter-has-id":[In,[],l=>l.id()!==null&&l.id()!==void 0],"filter-type-in":[In,[Wr(Rn)],(l,[r])=>r.value.indexOf(l.geometryType())>=0],"filter-id-in":[In,[Wr(Vn)],(l,[r])=>r.value.indexOf(l.id())>=0],"filter-in-small":[In,[Rn,Wr(Vn)],(l,[r,o])=>o.value.indexOf(l.properties()[r.value])>=0],"filter-in-large":[In,[Rn,Wr(Vn)],(l,[r,o])=>(function(p,v,E,A){for(;E<=A;){const P=E+A>>1;if(v[P]===p)return!0;v[P]>p?A=P-1:E=P+1}return!1})(l.properties()[r.value],o.value,0,o.value.length-1)],all:{type:In,overloads:[[[In,In],(l,[r,o])=>r.evaluate(l)&&o.evaluate(l)],[ua(In),(l,r)=>{for(const o of r)if(!o.evaluate(l))return!1;return!0}]]},any:{type:In,overloads:[[[In,In],(l,[r,o])=>r.evaluate(l)||o.evaluate(l)],[ua(In),(l,r)=>{for(const o of r)if(o.evaluate(l))return!0;return!1}]]},"!":[In,[In],(l,[r])=>!r.evaluate(l)],"is-supported-script":[In,[Rn],(l,[r])=>{const o=l.globals&&l.globals.isSupportedScript;return!o||o(r.evaluate(l))}],upcase:[Rn,[Rn],(l,[r])=>r.evaluate(l).toUpperCase()],downcase:[Rn,[Rn],(l,[r])=>r.evaluate(l).toLowerCase()],concat:[Rn,ua(Vn),(l,r)=>r.map((o=>sn(o.evaluate(l)))).join("")],"resolved-locale":[Rn,[$o],(l,[r])=>r.evaluate(l).resolvedLocale()]});class Wu{constructor(r,o){this.expression=r,this._warningHistory={},this._evaluator=new Sl,this._defaultValue=o?(function(p){if(p.type==="color"&&Hu(p.default))return new Mn(0,0,0,0);switch(p.type){case"color":return Mn.parse(p.default)||null;case"padding":return qr.parse(p.default)||null;case"numberArray":return fn.parse(p.default)||null;case"colorArray":return hi.parse(p.default)||null;case"variableAnchorOffsetCollection":return or.parse(p.default)||null;case"projectionDefinition":return Oi.parse(p.default)||null;default:return p.default===void 0?null:p.default}})(o):null,this._enumValues=o&&o.type==="enum"?o.values:null}evaluateWithoutErrorHandling(r,o,p,v,E,A){return this._evaluator.globals=r,this._evaluator.feature=o,this._evaluator.featureState=p,this._evaluator.canonical=v,this._evaluator.availableImages=E||null,this._evaluator.formattedSection=A,this.expression.evaluate(this._evaluator)}evaluate(r,o,p,v,E,A){this._evaluator.globals=r,this._evaluator.feature=o||null,this._evaluator.featureState=p||null,this._evaluator.canonical=v,this._evaluator.availableImages=E||null,this._evaluator.formattedSection=A||null;try{const P=this.expression.evaluate(this._evaluator);if(P==null||typeof P=="number"&&P!=P)return this._defaultValue;if(this._enumValues&&!(P in this._enumValues))throw new bn(`Expected value to be one of ${Object.keys(this._enumValues).map((z=>JSON.stringify(z))).join(", ")}, but found ${JSON.stringify(P)} instead.`);return P}catch(P){return this._warningHistory[P.message]||(this._warningHistory[P.message]=!0,typeof console<"u"&&console.warn(P.message)),this._defaultValue}}}function nl(l){return Array.isArray(l)&&l.length>0&&typeof l[0]=="string"&&l[0]in Jl}function il(l,r){const o=new _o(Jl,ja,[],r?(function(v){const E={color:zi,string:Rn,number:Vt,enum:Rn,boolean:In,formatted:Sa,padding:ms,numberArray:ma,colorArray:Fa,projectionDefinition:Ka,resolvedImage:Ki,variableAnchorOffsetCollection:Vu};return v.type==="array"?Wr(E[v.value]||Vn,v.length):E[v.type]})(r):void 0),p=o.parse(l,void 0,void 0,void 0,r&&r.type==="string"?{typeAnnotation:"coerce"}:void 0);return p?Gu(new Wu(p,r)):xo(o.errors)}class f{constructor(r,o){this.kind=r,this._styleExpression=o,this.isStateDependent=r!=="constant"&&!is(o.expression),this.globalStateRefs=ue(o.expression)}evaluateWithoutErrorHandling(r,o,p,v,E,A){return this._styleExpression.evaluateWithoutErrorHandling(r,o,p,v,E,A)}evaluate(r,o,p,v,E,A){return this._styleExpression.evaluate(r,o,p,v,E,A)}}class x{constructor(r,o,p,v){this.kind=r,this.zoomStops=p,this._styleExpression=o,this.isStateDependent=r!=="camera"&&!is(o.expression),this.globalStateRefs=ue(o.expression),this.interpolationType=v}evaluateWithoutErrorHandling(r,o,p,v,E,A){return this._styleExpression.evaluateWithoutErrorHandling(r,o,p,v,E,A)}evaluate(r,o,p,v,E,A){return this._styleExpression.evaluate(r,o,p,v,E,A)}interpolationFactor(r,o,p){return this.interpolationType?ir.interpolationFactor(this.interpolationType,r,o,p):0}}function R(l,r){const o=il(l,r);if(o.result==="error")return o;const p=o.value.expression,v=Rl(p);if(!v&&!Js(r))return xo([new tr("","data expressions not supported")]);const E=tu(p,["zoom"]);if(!E&&!Zu(r))return xo([new tr("","zoom expressions not supported")]);const A=K(p);return A||E?A instanceof tr?xo([A]):A instanceof ir&&!tl(r)?xo([new tr("",'"interpolate" expressions cannot be used with this property')]):Gu(A?new x(v?"camera":"composite",o.value,A.labels,A instanceof ir?A.interpolation:void 0):new f(v?"constant":"source",o.value)):xo([new tr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class U{constructor(r,o){this._parameters=r,this._specification=o,Qt(this,Rc(this._parameters,this._specification))}static deserialize(r){return new U(r._parameters,r._specification)}static serialize(r){return{_parameters:r._parameters,_specification:r._specification}}}function K(l){let r=null;if(l instanceof Xn)r=K(l.result);else if(l instanceof ko){for(const o of l.args)if(r=K(o),r)break}else(l instanceof nr||l instanceof ir)&&l.input instanceof Qs&&l.input.name==="zoom"&&(r=l);return r instanceof tr||l.eachChild((o=>{const p=K(o);p instanceof tr?r=p:!r&&p?r=new tr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):r&&p&&r!==p&&(r=new tr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),r}function ue(l,r=new Set){return l instanceof Mc&&r.add(l.key),l.eachChild((o=>{ue(o,r)})),r}function Oe(l){if(l===!0||l===!1)return!0;if(!Array.isArray(l)||l.length===0)return!1;switch(l[0]){case"has":return l.length>=2&&l[1]!=="$id"&&l[1]!=="$type";case"in":return l.length>=3&&(typeof l[1]!="string"||Array.isArray(l[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return l.length!==3||Array.isArray(l[1])||Array.isArray(l[2]);case"any":case"all":for(const r of l.slice(1))if(!Oe(r)&&typeof r!="boolean")return!1;return!0;default:return!0}}const nt={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function mt(l){if(l==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};Oe(l)||(l=on(l));const r=il(l,nt);if(r.result==="error")throw new Error(r.value.map((o=>`${o.key}: ${o.message}`)).join(", "));return{filter:(o,p,v)=>r.value.evaluate(o,p,{},v),needGeometry:Jt(l),getGlobalStateRefs:()=>ue(r.value.expression)}}function Rt(l,r){return l<r?-1:l>r?1:0}function Jt(l){if(!Array.isArray(l))return!1;if(l[0]==="within"||l[0]==="distance")return!0;for(let r=1;r<l.length;r++)if(Jt(l[r]))return!0;return!1}function on(l){if(!l)return!0;const r=l[0];return l.length<=1?r!=="any":r==="=="?_n(l[1],l[2],"=="):r==="!="?mr(_n(l[1],l[2],"==")):r==="<"||r===">"||r==="<="||r===">="?_n(l[1],l[2],r):r==="any"?(o=l.slice(1),["any"].concat(o.map(on))):r==="all"?["all"].concat(l.slice(1).map(on)):r==="none"?["all"].concat(l.slice(1).map(on).map(mr)):r==="in"?Zn(l[1],l.slice(2)):r==="!in"?mr(Zn(l[1],l.slice(2))):r==="has"?cr(l[1]):r!=="!has"||mr(cr(l[1]));var o}function _n(l,r,o){switch(l){case"$type":return[`filter-type-${o}`,r];case"$id":return[`filter-id-${o}`,r];default:return[`filter-${o}`,l,r]}}function Zn(l,r){if(r.length===0)return!1;switch(l){case"$type":return["filter-type-in",["literal",r]];case"$id":return["filter-id-in",["literal",r]];default:return r.length>200&&!r.some((o=>typeof o!=typeof r[0]))?["filter-in-large",l,["literal",r.sort(Rt)]]:["filter-in-small",l,["literal",r]]}}function cr(l){switch(l){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",l]}}function mr(l){return["!",l]}function _a(l){const r=typeof l;if(r==="number"||r==="boolean"||r==="string"||l==null)return JSON.stringify(l);if(Array.isArray(l)){let v="[";for(const E of l)v+=`${_a(E)},`;return`${v}]`}const o=Object.keys(l).sort();let p="{";for(let v=0;v<o.length;v++)p+=`${JSON.stringify(o[v])}:${_a(l[o[v]])},`;return`${p}}`}function wo(l){let r="";for(const o of Cn)r+=`/${_a(l[o])}`;return r}function ph(l){const r=l.value;return r?[new Ct(l.key,r,"constants have been deprecated as of v8")]:[]}function gr(l){return l instanceof Number||l instanceof String||l instanceof Boolean?l.valueOf():l}function Ps(l){if(Array.isArray(l))return l.map(Ps);if(l instanceof Object&&!(l instanceof Number||l instanceof String||l instanceof Boolean)){const r={};for(const o in l)r[o]=Ps(l[o]);return r}return gr(l)}function Ma(l){const r=l.key,o=l.value,p=l.valueSpec||{},v=l.objectElementValidators||{},E=l.style,A=l.styleSpec,P=l.validateSpec;let z=[];const F=Gn(o);if(F!=="object")return[new Ct(r,o,`object expected, ${F} found`)];for(const q in o){const H=q.split(".")[0],J=Ya(p,H)||p["*"];let ie;if(Ya(v,H))ie=v[H];else if(Ya(p,H))ie=P;else if(v["*"])ie=v["*"];else{if(!p["*"]){z.push(new Ct(r,o[q],`unknown property "${q}"`));continue}ie=P}z=z.concat(ie({key:(r&&`${r}.`)+q,value:o[q],valueSpec:J,style:E,styleSpec:A,object:o,objectKey:q,validateSpec:P},o))}for(const q in p)v[q]||p[q].required&&p[q].default===void 0&&o[q]===void 0&&z.push(new Ct(r,o,`missing required property "${q}"`));return z}function Lc(l){const r=l.value,o=l.valueSpec,p=l.style,v=l.styleSpec,E=l.key,A=l.arrayElementValidator||l.validateSpec;if(Gn(r)!=="array")return[new Ct(E,r,`array expected, ${Gn(r)} found`)];if(o.length&&r.length!==o.length)return[new Ct(E,r,`array length ${o.length} expected, length ${r.length} found`)];if(o["min-length"]&&r.length<o["min-length"])return[new Ct(E,r,`array length at least ${o["min-length"]} expected, length ${r.length} found`)];let P={type:o.value,values:o.values};v.$version<7&&(P.function=o.function),Gn(o.value)==="object"&&(P=o.value);let z=[];for(let F=0;F<r.length;F++)z=z.concat(A({array:r,arrayIndex:F,value:r[F],valueSpec:P,validateSpec:l.validateSpec,style:p,styleSpec:v,key:`${E}[${F}]`}));return z}function rl(l){const r=l.key,o=l.value,p=l.valueSpec;let v=Gn(o);return v==="number"&&o!=o&&(v="NaN"),v!=="number"?[new Ct(r,o,`number expected, ${v} found`)]:"minimum"in p&&o<p.minimum?[new Ct(r,o,`${o} is less than the minimum value ${p.minimum}`)]:"maximum"in p&&o>p.maximum?[new Ct(r,o,`${o} is greater than the maximum value ${p.maximum}`)]:[]}function Pr(l){const r=l.valueSpec,o=gr(l.value.type);let p,v,E,A={};const P=o!=="categorical"&&l.value.property===void 0,z=!P,F=Gn(l.value.stops)==="array"&&Gn(l.value.stops[0])==="array"&&Gn(l.value.stops[0][0])==="object",q=Ma({key:l.key,value:l.value,valueSpec:l.styleSpec.function,validateSpec:l.validateSpec,style:l.style,styleSpec:l.styleSpec,objectElementValidators:{stops:function(ie){if(o==="identity")return[new Ct(ie.key,ie.value,'identity function may not have a "stops" property')];let re=[];const oe=ie.value;return re=re.concat(Lc({key:ie.key,value:oe,valueSpec:ie.valueSpec,validateSpec:ie.validateSpec,style:ie.style,styleSpec:ie.styleSpec,arrayElementValidator:H})),Gn(oe)==="array"&&oe.length===0&&re.push(new Ct(ie.key,oe,"array must have at least one stop")),re},default:function(ie){return ie.validateSpec({key:ie.key,value:ie.value,valueSpec:r,validateSpec:ie.validateSpec,style:ie.style,styleSpec:ie.styleSpec})}}});return o==="identity"&&P&&q.push(new Ct(l.key,l.value,'missing required property "property"')),o==="identity"||l.value.stops||q.push(new Ct(l.key,l.value,'missing required property "stops"')),o==="exponential"&&l.valueSpec.expression&&!tl(l.valueSpec)&&q.push(new Ct(l.key,l.value,"exponential functions not supported")),l.styleSpec.$version>=8&&(z&&!Js(l.valueSpec)?q.push(new Ct(l.key,l.value,"property functions not supported")):P&&!Zu(l.valueSpec)&&q.push(new Ct(l.key,l.value,"zoom functions not supported"))),o!=="categorical"&&!F||l.value.property!==void 0||q.push(new Ct(l.key,l.value,'"property" property is required')),q;function H(ie){let re=[];const oe=ie.value,pe=ie.key;if(Gn(oe)!=="array")return[new Ct(pe,oe,`array expected, ${Gn(oe)} found`)];if(oe.length!==2)return[new Ct(pe,oe,`array length 2 expected, length ${oe.length} found`)];if(F){if(Gn(oe[0])!=="object")return[new Ct(pe,oe,`object expected, ${Gn(oe[0])} found`)];if(oe[0].zoom===void 0)return[new Ct(pe,oe,"object stop key must have zoom")];if(oe[0].value===void 0)return[new Ct(pe,oe,"object stop key must have value")];if(E&&E>gr(oe[0].zoom))return[new Ct(pe,oe[0].zoom,"stop zoom values must appear in ascending order")];gr(oe[0].zoom)!==E&&(E=gr(oe[0].zoom),v=void 0,A={}),re=re.concat(Ma({key:`${pe}[0]`,value:oe[0],valueSpec:{zoom:{}},validateSpec:ie.validateSpec,style:ie.style,styleSpec:ie.styleSpec,objectElementValidators:{zoom:rl,value:J}}))}else re=re.concat(J({key:`${pe}[0]`,value:oe[0],validateSpec:ie.validateSpec,style:ie.style,styleSpec:ie.styleSpec},oe));return nl(Ps(oe[1]))?re.concat([new Ct(`${pe}[1]`,oe[1],"expressions are not allowed in function stops.")]):re.concat(ie.validateSpec({key:`${pe}[1]`,value:oe[1],valueSpec:r,validateSpec:ie.validateSpec,style:ie.style,styleSpec:ie.styleSpec}))}function J(ie,re){const oe=Gn(ie.value),pe=gr(ie.value),we=ie.value!==null?ie.value:re;if(p){if(oe!==p)return[new Ct(ie.key,we,`${oe} stop domain type must match previous stop domain type ${p}`)]}else p=oe;if(oe!=="number"&&oe!=="string"&&oe!=="boolean")return[new Ct(ie.key,we,"stop domain value must be a number, string, or boolean")];if(oe!=="number"&&o!=="categorical"){let He=`number expected, ${oe} found`;return Js(r)&&o===void 0&&(He+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ct(ie.key,we,He)]}return o!=="categorical"||oe!=="number"||isFinite(pe)&&Math.floor(pe)===pe?o!=="categorical"&&oe==="number"&&v!==void 0&&pe<v?[new Ct(ie.key,we,"stop domain values must appear in ascending order")]:(v=pe,o==="categorical"&&pe in A?[new Ct(ie.key,we,"stop domain values must be unique")]:(A[pe]=!0,[])):[new Ct(ie.key,we,`integer expected, found ${pe}`)]}}function qa(l){const r=(l.expressionContext==="property"?R:il)(Ps(l.value),l.valueSpec);if(r.result==="error")return r.value.map((p=>new Ct(`${l.key}${p.key}`,l.value,p.message)));const o=r.value.expression||r.value._styleExpression.expression;if(l.expressionContext==="property"&&l.propertyKey==="text-font"&&!o.outputDefined())return[new Ct(l.key,l.value,`Invalid data expression for "${l.propertyKey}". Output values must be contained as literals within the expression.`)];if(l.expressionContext==="property"&&l.propertyType==="layout"&&!is(o))return[new Ct(l.key,l.value,'"feature-state" data expressions are not supported with layout properties.')];if(l.expressionContext==="filter"&&!is(o))return[new Ct(l.key,l.value,'"feature-state" data expressions are not supported with filters.')];if(l.expressionContext&&l.expressionContext.indexOf("cluster")===0){if(!tu(o,["zoom","feature-state"]))return[new Ct(l.key,l.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(l.expressionContext==="cluster-initial"&&!Rl(o))return[new Ct(l.key,l.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function To(l){const r=l.key,o=l.value,p=Gn(o);return p!=="string"?[new Ct(r,o,`color expected, ${p} found`)]:Mn.parse(String(o))?[]:[new Ct(r,o,`color expected, "${o}" found`)]}function $a(l){const r=l.key,o=l.value,p=l.valueSpec,v=[];return Array.isArray(p.values)?p.values.indexOf(gr(o))===-1&&v.push(new Ct(r,o,`expected one of [${p.values.join(", ")}], ${JSON.stringify(o)} found`)):Object.keys(p.values).indexOf(gr(o))===-1&&v.push(new Ct(r,o,`expected one of [${Object.keys(p.values).join(", ")}], ${JSON.stringify(o)} found`)),v}function zo(l){return Oe(Ps(l.value))?qa(Qt({},l,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Xu(l)}function Xu(l){const r=l.value,o=l.key;if(Gn(r)!=="array")return[new Ct(o,r,`array expected, ${Gn(r)} found`)];const p=l.styleSpec;let v,E=[];if(r.length<1)return[new Ct(o,r,"filter array must have at least 1 element")];switch(E=E.concat($a({key:`${o}[0]`,value:r[0],valueSpec:p.filter_operator,style:l.style,styleSpec:l.styleSpec})),gr(r[0])){case"<":case"<=":case">":case">=":r.length>=2&&gr(r[1])==="$type"&&E.push(new Ct(o,r,`"$type" cannot be use with operator "${r[0]}"`));case"==":case"!=":r.length!==3&&E.push(new Ct(o,r,`filter array for operator "${r[0]}" must have 3 elements`));case"in":case"!in":r.length>=2&&(v=Gn(r[1]),v!=="string"&&E.push(new Ct(`${o}[1]`,r[1],`string expected, ${v} found`)));for(let A=2;A<r.length;A++)v=Gn(r[A]),gr(r[1])==="$type"?E=E.concat($a({key:`${o}[${A}]`,value:r[A],valueSpec:p.geometry_type,style:l.style,styleSpec:l.styleSpec})):v!=="string"&&v!=="number"&&v!=="boolean"&&E.push(new Ct(`${o}[${A}]`,r[A],`string, number, or boolean expected, ${v} found`));break;case"any":case"all":case"none":for(let A=1;A<r.length;A++)E=E.concat(Xu({key:`${o}[${A}]`,value:r[A],style:l.style,styleSpec:l.styleSpec}));break;case"has":case"!has":v=Gn(r[1]),r.length!==2?E.push(new Ct(o,r,`filter array for "${r[0]}" operator must have 2 elements`)):v!=="string"&&E.push(new Ct(`${o}[1]`,r[1],`string expected, ${v} found`))}return E}function Dc(l,r){const o=l.key,p=l.validateSpec,v=l.style,E=l.styleSpec,A=l.value,P=l.objectKey,z=E[`${r}_${l.layerType}`];if(!z)return[];const F=P.match(/^(.*)-transition$/);if(r==="paint"&&F&&z[F[1]]&&z[F[1]].transition)return p({key:o,value:A,valueSpec:E.transition,style:v,styleSpec:E});const q=l.valueSpec||z[P];if(!q)return[new Ct(o,A,`unknown property "${P}"`)];let H;if(Gn(A)==="string"&&Js(q)&&!q.tokens&&(H=/^{([^}]+)}$/.exec(A)))return[new Ct(o,A,`"${P}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(H[1])} }\`.`)];const J=[];return l.layerType==="symbol"&&(P==="text-field"&&v&&!v.glyphs&&J.push(new Ct(o,A,'use of "text-field" requires a style "glyphs" property')),P==="text-font"&&Hu(Ps(A))&&gr(A.type)==="identity"&&J.push(new Ct(o,A,'"text-font" does not support identity functions'))),J.concat(p({key:l.key,value:A,valueSpec:q,style:v,styleSpec:E,expressionContext:"property",propertyType:r,propertyKey:P}))}function Ku(l){return Dc(l,"paint")}function ad(l){return Dc(l,"layout")}function Yu(l){let r=[];const o=l.value,p=l.key,v=l.style,E=l.styleSpec;if(Gn(o)!=="object")return[new Ct(p,o,`object expected, ${Gn(o)} found`)];o.type||o.ref||r.push(new Ct(p,o,'either "type" or "ref" is required'));let A=gr(o.type);const P=gr(o.ref);if(o.id){const z=gr(o.id);for(let F=0;F<l.arrayIndex;F++){const q=v.layers[F];gr(q.id)===z&&r.push(new Ct(p,o.id,`duplicate layer id "${o.id}", previously used at line ${q.id.__line__}`))}}if("ref"in o){let z;["type","source","source-layer","filter","layout"].forEach((F=>{F in o&&r.push(new Ct(p,o[F],`"${F}" is prohibited for ref layers`))})),v.layers.forEach((F=>{gr(F.id)===P&&(z=F)})),z?z.ref?r.push(new Ct(p,o.ref,"ref cannot reference another ref layer")):A=gr(z.type):r.push(new Ct(p,o.ref,`ref layer "${P}" not found`))}else if(A!=="background")if(o.source){const z=v.sources&&v.sources[o.source],F=z&&gr(z.type);z?F==="vector"&&A==="raster"?r.push(new Ct(p,o.source,`layer "${o.id}" requires a raster source`)):F!=="raster-dem"&&A==="hillshade"||F!=="raster-dem"&&A==="color-relief"?r.push(new Ct(p,o.source,`layer "${o.id}" requires a raster-dem source`)):F==="raster"&&A!=="raster"?r.push(new Ct(p,o.source,`layer "${o.id}" requires a vector source`)):F!=="vector"||o["source-layer"]?F==="raster-dem"&&A!=="hillshade"&&A!=="color-relief"?r.push(new Ct(p,o.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):A!=="line"||!o.paint||!o.paint["line-gradient"]||F==="geojson"&&z.lineMetrics||r.push(new Ct(p,o,`layer "${o.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):r.push(new Ct(p,o,`layer "${o.id}" must specify a "source-layer"`)):r.push(new Ct(p,o.source,`source "${o.source}" not found`))}else r.push(new Ct(p,o,'missing required property "source"'));return r=r.concat(Ma({key:p,value:o,valueSpec:E.layer,style:l.style,styleSpec:l.styleSpec,validateSpec:l.validateSpec,objectElementValidators:{"*":()=>[],type:()=>l.validateSpec({key:`${p}.type`,value:o.type,valueSpec:E.layer.type,style:l.style,styleSpec:l.styleSpec,validateSpec:l.validateSpec,object:o,objectKey:"type"}),filter:zo,layout:z=>Ma({layer:o,key:z.key,value:z.value,style:z.style,styleSpec:z.styleSpec,validateSpec:z.validateSpec,objectElementValidators:{"*":F=>ad(Qt({layerType:A},F))}}),paint:z=>Ma({layer:o,key:z.key,value:z.value,style:z.style,styleSpec:z.styleSpec,validateSpec:z.validateSpec,objectElementValidators:{"*":F=>Ku(Qt({layerType:A},F))}})}})),r}function _r(l){const r=l.value,o=l.key,p=Gn(r);return p!=="string"?[new Ct(o,r,`string expected, ${p} found`)]:[]}const _u={promoteId:function({key:l,value:r}){if(Gn(r)==="string")return _r({key:l,value:r});{const o=[];for(const p in r)o.push(..._r({key:`${l}.${p}`,value:r[p]}));return o}}};function to(l){const r=l.value,o=l.key,p=l.styleSpec,v=l.style,E=l.validateSpec;if(!r.type)return[new Ct(o,r,'"type" is required')];const A=gr(r.type);let P;switch(A){case"vector":case"raster":return P=Ma({key:o,value:r,valueSpec:p[`source_${A.replace("-","_")}`],style:l.style,styleSpec:p,objectElementValidators:_u,validateSpec:E}),P;case"raster-dem":return P=(function(z){var F;const q=(F=z.sourceName)!==null&&F!==void 0?F:"",H=z.value,J=z.styleSpec,ie=J.source_raster_dem,re=z.style;let oe=[];const pe=Gn(H);if(H===void 0)return oe;if(pe!=="object")return oe.push(new Ct("source_raster_dem",H,`object expected, ${pe} found`)),oe;const we=gr(H.encoding)==="custom",He=["redFactor","greenFactor","blueFactor","baseShift"],Re=z.value.encoding?`"${z.value.encoding}"`:"Default";for(const Fe in H)!we&&He.includes(Fe)?oe.push(new Ct(Fe,H[Fe],`In "${q}": "${Fe}" is only valid when "encoding" is set to "custom". ${Re} encoding found`)):ie[Fe]?oe=oe.concat(z.validateSpec({key:Fe,value:H[Fe],valueSpec:ie[Fe],validateSpec:z.validateSpec,style:re,styleSpec:J})):oe.push(new Ct(Fe,H[Fe],`unknown property "${Fe}"`));return oe})({sourceName:o,value:r,style:l.style,styleSpec:p,validateSpec:E}),P;case"geojson":if(P=Ma({key:o,value:r,valueSpec:p.source_geojson,style:v,styleSpec:p,validateSpec:E,objectElementValidators:_u}),r.cluster)for(const z in r.clusterProperties){const[F,q]=r.clusterProperties[z],H=typeof F=="string"?[F,["accumulated"],["get",z]]:F;P.push(...qa({key:`${o}.${z}.map`,value:q,expressionContext:"cluster-map"})),P.push(...qa({key:`${o}.${z}.reduce`,value:H,expressionContext:"cluster-reduce"}))}return P;case"video":return Ma({key:o,value:r,valueSpec:p.source_video,style:v,validateSpec:E,styleSpec:p});case"image":return Ma({key:o,value:r,valueSpec:p.source_image,style:v,validateSpec:E,styleSpec:p});case"canvas":return[new Ct(o,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return $a({key:`${o}.type`,value:r.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function mh(l){const r=l.value,o=l.styleSpec,p=o.light,v=l.style;let E=[];const A=Gn(r);if(r===void 0)return E;if(A!=="object")return E=E.concat([new Ct("light",r,`object expected, ${A} found`)]),E;for(const P in r){const z=P.match(/^(.*)-transition$/);E=E.concat(z&&p[z[1]]&&p[z[1]].transition?l.validateSpec({key:P,value:r[P],valueSpec:o.transition,validateSpec:l.validateSpec,style:v,styleSpec:o}):p[P]?l.validateSpec({key:P,value:r[P],valueSpec:p[P],validateSpec:l.validateSpec,style:v,styleSpec:o}):[new Ct(P,r[P],`unknown property "${P}"`)])}return E}function Hf(l){const r=l.value,o=l.styleSpec,p=o.sky,v=l.style,E=Gn(r);if(r===void 0)return[];if(E!=="object")return[new Ct("sky",r,`object expected, ${E} found`)];let A=[];for(const P in r)A=A.concat(p[P]?l.validateSpec({key:P,value:r[P],valueSpec:p[P],style:v,styleSpec:o}):[new Ct(P,r[P],`unknown property "${P}"`)]);return A}function lm(l){const r=l.value,o=l.styleSpec,p=o.terrain,v=l.style;let E=[];const A=Gn(r);if(r===void 0)return E;if(A!=="object")return E=E.concat([new Ct("terrain",r,`object expected, ${A} found`)]),E;for(const P in r)E=E.concat(p[P]?l.validateSpec({key:P,value:r[P],valueSpec:p[P],validateSpec:l.validateSpec,style:v,styleSpec:o}):[new Ct(P,r[P],`unknown property "${P}"`)]);return E}function ya(l){let r=[];const o=l.value,p=l.key;if(Array.isArray(o)){const v=[],E=[];for(const A in o)o[A].id&&v.includes(o[A].id)&&r.push(new Ct(p,o,`all the sprites' ids must be unique, but ${o[A].id} is duplicated`)),v.push(o[A].id),o[A].url&&E.includes(o[A].url)&&r.push(new Ct(p,o,`all the sprites' URLs must be unique, but ${o[A].url} is duplicated`)),E.push(o[A].url),r=r.concat(Ma({key:`${p}[${A}]`,value:o[A],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:l.validateSpec}));return r}return _r({key:p,value:o})}function Qu(l){return r=l.value,r&&r.constructor===Object?[]:[new Ct(l.key,l.value,`object expected, ${Gn(l.value)} found`)];var r}const zc={"*":()=>[],array:Lc,boolean:function(l){const r=l.value,o=l.key,p=Gn(r);return p!=="boolean"?[new Ct(o,r,`boolean expected, ${p} found`)]:[]},number:rl,color:To,constants:ph,enum:$a,filter:zo,function:Pr,layer:Yu,object:Ma,source:to,light:mh,sky:Hf,terrain:lm,projection:function(l){const r=l.value,o=l.styleSpec,p=o.projection,v=l.style,E=Gn(r);if(r===void 0)return[];if(E!=="object")return[new Ct("projection",r,`object expected, ${E} found`)];let A=[];for(const P in r)A=A.concat(p[P]?l.validateSpec({key:P,value:r[P],valueSpec:p[P],style:v,styleSpec:o}):[new Ct(P,r[P],`unknown property "${P}"`)]);return A},projectionDefinition:function(l){const r=l.key;let o=l.value;o=o instanceof String?o.valueOf():o;const p=Gn(o);return p!=="array"||(function(v){return Array.isArray(v)&&v.length===3&&typeof v[0]=="string"&&typeof v[1]=="string"&&typeof v[2]=="number"})(o)||(function(v){return!!["interpolate","step","literal"].includes(v[0])})(o)?["array","string"].includes(p)?[]:[new Ct(r,o,`projection expected, invalid type "${p}" found`)]:[new Ct(r,o,`projection expected, invalid array ${JSON.stringify(o)} found`)]},string:_r,formatted:function(l){return _r(l).length===0?[]:qa(l)},resolvedImage:function(l){return _r(l).length===0?[]:qa(l)},padding:function(l){const r=l.key,o=l.value;if(Gn(o)==="array"){if(o.length<1||o.length>4)return[new Ct(r,o,`padding requires 1 to 4 values; ${o.length} values found`)];const p={type:"number"};let v=[];for(let E=0;E<o.length;E++)v=v.concat(l.validateSpec({key:`${r}[${E}]`,value:o[E],validateSpec:l.validateSpec,valueSpec:p}));return v}return rl({key:r,value:o,valueSpec:{}})},numberArray:function(l){const r=l.key,o=l.value;if(Gn(o)==="array"){const p={type:"number"};if(o.length<1)return[new Ct(r,o,"array length at least 1 expected, length 0 found")];let v=[];for(let E=0;E<o.length;E++)v=v.concat(l.validateSpec({key:`${r}[${E}]`,value:o[E],validateSpec:l.validateSpec,valueSpec:p}));return v}return rl({key:r,value:o,valueSpec:{}})},colorArray:function(l){const r=l.key,o=l.value;if(Gn(o)==="array"){if(o.length<1)return[new Ct(r,o,"array length at least 1 expected, length 0 found")];let p=[];for(let v=0;v<o.length;v++)p=p.concat(To({key:`${r}[${v}]`,value:o[v]}));return p}return To({key:r,value:o})},variableAnchorOffsetCollection:function(l){const r=l.key,o=l.value,p=Gn(o),v=l.styleSpec;if(p!=="array"||o.length<1||o.length%2!=0)return[new Ct(r,o,"variableAnchorOffsetCollection requires a non-empty array of even length")];let E=[];for(let A=0;A<o.length;A+=2)E=E.concat($a({key:`${r}[${A}]`,value:o[A],valueSpec:v.layout_symbol["text-anchor"]})),E=E.concat(Lc({key:`${r}[${A+1}]`,value:o[A+1],valueSpec:{length:2,value:"number"},validateSpec:l.validateSpec,style:l.style,styleSpec:v}));return E},sprite:ya,state:Qu};function nu(l){const r=l.value,o=l.valueSpec,p=l.styleSpec;return l.validateSpec=nu,o.expression&&Hu(gr(r))?Pr(l):o.expression&&nl(Ps(r))?qa(l):o.type&&zc[o.type]?zc[o.type](l):Ma(Qt({},l,{valueSpec:o.type?p[o.type]:o}))}function Xd(l){const r=l.value,o=l.key,p=_r(l);return p.length||(r.indexOf("{fontstack}")===-1&&p.push(new Ct(o,r,'"glyphs" url must include a "{fontstack}" token')),r.indexOf("{range}")===-1&&p.push(new Ct(o,r,'"glyphs" url must include a "{range}" token'))),p}function Ra(l,r=qe){let o=[];return o=o.concat(nu({key:"",value:l,valueSpec:r.$root,styleSpec:r,style:l,validateSpec:nu,objectElementValidators:{glyphs:Xd,"*":()=>[]}})),l.constants&&(o=o.concat(ph({key:"constants",value:l.constants}))),gh(o)}function Ms(l){return function(r){return l({...r,validateSpec:nu})}}function gh(l){return[].concat(l).sort(((r,o)=>r.line-o.line))}function al(l){return function(...r){return gh(l.apply(this,r))}}Ra.source=al(Ms(to)),Ra.sprite=al(Ms(ya)),Ra.glyphs=al(Ms(Xd)),Ra.light=al(Ms(mh)),Ra.sky=al(Ms(Hf)),Ra.terrain=al(Ms(lm)),Ra.state=al(Ms(Qu)),Ra.layer=al(Ms(Yu)),Ra.filter=al(Ms(zo)),Ra.paintProperty=al(Ms(Ku)),Ra.layoutProperty=al(Ms(ad));const _h=Ra,um=_h.light,Ll=_h.sky,Wf=_h.paintProperty,Kd=_h.layoutProperty;function yh(l,r){let o=!1;if(r&&r.length)for(const p of r)l.fire(new bt(new Error(p.message))),o=!0;return o}class yu{constructor(r,o,p){const v=this.cells=[];if(r instanceof ArrayBuffer){this.arrayBuffer=r;const A=new Int32Array(this.arrayBuffer);r=A[0],this.d=(o=A[1])+2*(p=A[2]);for(let z=0;z<this.d*this.d;z++){const F=A[3+z],q=A[3+z+1];v.push(F===q?null:A.subarray(F,q))}const P=A[3+v.length+1];this.keys=A.subarray(A[3+v.length],P),this.bboxes=A.subarray(P),this.insert=this._insertReadonly}else{this.d=o+2*p;for(let A=0;A<this.d*this.d;A++)v.push([]);this.keys=[],this.bboxes=[]}this.n=o,this.extent=r,this.padding=p,this.scale=o/r,this.uid=0;const E=p/o*r;this.min=-E,this.max=r+E}insert(r,o,p,v,E){this._forEachCell(o,p,v,E,this._insertCell,this.uid++,void 0,void 0),this.keys.push(r),this.bboxes.push(o),this.bboxes.push(p),this.bboxes.push(v),this.bboxes.push(E)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(r,o,p,v,E,A){this.cells[E].push(A)}query(r,o,p,v,E){const A=this.min,P=this.max;if(r<=A&&o<=A&&P<=p&&P<=v&&!E)return Array.prototype.slice.call(this.keys);{const z=[];return this._forEachCell(r,o,p,v,this._queryCell,z,{},E),z}}_queryCell(r,o,p,v,E,A,P,z){const F=this.cells[E];if(F!==null){const q=this.keys,H=this.bboxes;for(let J=0;J<F.length;J++){const ie=F[J];if(P[ie]===void 0){const re=4*ie;(z?z(H[re+0],H[re+1],H[re+2],H[re+3]):r<=H[re+2]&&o<=H[re+3]&&p>=H[re+0]&&v>=H[re+1])?(P[ie]=!0,A.push(q[ie])):P[ie]=!1}}}}_forEachCell(r,o,p,v,E,A,P,z){const F=this._convertToCellCoord(r),q=this._convertToCellCoord(o),H=this._convertToCellCoord(p),J=this._convertToCellCoord(v);for(let ie=F;ie<=H;ie++)for(let re=q;re<=J;re++){const oe=this.d*re+ie;if((!z||z(this._convertFromCellCoord(ie),this._convertFromCellCoord(re),this._convertFromCellCoord(ie+1),this._convertFromCellCoord(re+1)))&&E.call(this,r,o,p,v,oe,A,P,z))return}}_convertFromCellCoord(r){return(r-this.padding)/this.scale}_convertToCellCoord(r){return Math.max(0,Math.min(this.d-1,Math.floor(r*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const r=this.cells,o=3+this.cells.length+1+1;let p=0;for(let A=0;A<this.cells.length;A++)p+=this.cells[A].length;const v=new Int32Array(o+p+this.keys.length+this.bboxes.length);v[0]=this.extent,v[1]=this.n,v[2]=this.padding;let E=o;for(let A=0;A<r.length;A++){const P=r[A];v[3+A]=E,v.set(P,E),E+=P.length}return v[3+r.length]=E,v.set(this.keys,E),E+=this.keys.length,v[3+r.length+1]=E,v.set(this.bboxes,E),E+=this.bboxes.length,v.buffer}static serialize(r,o){const p=r.toArrayBuffer();return o&&o.push(p),{buffer:p}}static deserialize(r){return new yu(r.buffer)}}const sl={};function Kt(l,r,o={}){if(sl[l])throw new Error(`${l} is already registered.`);Object.defineProperty(r,"_classRegistryKey",{value:l,writeable:!1}),sl[l]={klass:r,omit:o.omit||[],shallow:o.shallow||[]}}Kt("Object",Object),Kt("Set",Set),Kt("TransferableGridIndex",yu),Kt("Color",Mn),Kt("Error",Error),Kt("AJAXError",Se),Kt("ResolvedImage",Br),Kt("StylePropertyFunction",U),Kt("StyleExpression",Wu,{omit:["_evaluator"]}),Kt("ZoomDependentExpression",x),Kt("ZoomConstantExpression",f),Kt("CompoundExpression",Qs,{omit:["_evaluate"]});for(const l in Jl)Jl[l]._classRegistryKey||Kt(`Expression_${l}`,Jl[l]);function sd(l){return l&&typeof ArrayBuffer<"u"&&(l instanceof ArrayBuffer||l.constructor&&l.constructor.name==="ArrayBuffer")}function od(l){return l.$name||l.constructor._classRegistryKey}function vh(l){return!(function(r){if(r===null||typeof r!="object")return!1;const o=od(r);return!(!o||o==="Object")})(l)&&(l==null||typeof l=="boolean"||typeof l=="number"||typeof l=="string"||l instanceof Boolean||l instanceof Number||l instanceof String||l instanceof Date||l instanceof RegExp||l instanceof Blob||l instanceof Error||sd(l)||Ba(l)||ArrayBuffer.isView(l)||l instanceof ImageData)}function Oc(l,r){if(vh(l))return(sd(l)||Ba(l))&&r&&r.push(l),ArrayBuffer.isView(l)&&r&&r.push(l.buffer),l instanceof ImageData&&r&&r.push(l.data.buffer),l;if(Array.isArray(l)){const E=[];for(const A of l)E.push(Oc(A,r));return E}if(typeof l!="object")throw new Error("can't serialize object of type "+typeof l);const o=od(l);if(!o)throw new Error(`can't serialize object of unregistered class ${l.constructor.name}`);if(!sl[o])throw new Error(`${o} is not registered.`);const{klass:p}=sl[o],v=p.serialize?p.serialize(l,r):{};if(p.serialize){if(r&&v===r[r.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const E in l){if(!l.hasOwnProperty(E)||sl[o].omit.indexOf(E)>=0)continue;const A=l[E];v[E]=sl[o].shallow.indexOf(E)>=0?A:Oc(A,r)}l instanceof Error&&(v.message=l.message)}if(v.$name)throw new Error("$name property is reserved for worker serialization logic.");return o!=="Object"&&(v.$name=o),v}function Dl(l){if(vh(l))return l;if(Array.isArray(l))return l.map(Dl);if(typeof l!="object")throw new Error("can't deserialize object of type "+typeof l);const r=od(l)||"Object";if(!sl[r])throw new Error(`can't deserialize unregistered class ${r}`);const{klass:o}=sl[r];if(!o)throw new Error(`can't deserialize unregistered class ${r}`);if(o.deserialize)return o.deserialize(l);const p=Object.create(o.prototype);for(const v of Object.keys(l)){if(v==="$name")continue;const E=l[v];p[v]=sl[r].shallow.indexOf(v)>=0?E:Dl(E)}return p}class ld{constructor(){this.first=!0}update(r,o){const p=Math.floor(r);return this.first?(this.first=!1,this.lastIntegerZoom=p,this.lastIntegerZoomTime=0,this.lastZoom=r,this.lastFloorZoom=p,!0):(this.lastFloorZoom>p?(this.lastIntegerZoom=p+1,this.lastIntegerZoomTime=o):this.lastFloorZoom<p&&(this.lastIntegerZoom=p,this.lastIntegerZoomTime=o),r!==this.lastZoom&&(this.lastZoom=r,this.lastFloorZoom=p,!0))}}const ai={"Latin-1 Supplement":l=>l>=128&&l<=255,"Hangul Jamo":l=>l>=4352&&l<=4607,Khmer:l=>l>=6016&&l<=6143,"General Punctuation":l=>l>=8192&&l<=8303,"Letterlike Symbols":l=>l>=8448&&l<=8527,"Number Forms":l=>l>=8528&&l<=8591,"Miscellaneous Technical":l=>l>=8960&&l<=9215,"Control Pictures":l=>l>=9216&&l<=9279,"Optical Character Recognition":l=>l>=9280&&l<=9311,"Enclosed Alphanumerics":l=>l>=9312&&l<=9471,"Geometric Shapes":l=>l>=9632&&l<=9727,"Miscellaneous Symbols":l=>l>=9728&&l<=9983,"Miscellaneous Symbols and Arrows":l=>l>=11008&&l<=11263,"Ideographic Description Characters":l=>l>=12272&&l<=12287,"CJK Symbols and Punctuation":l=>l>=12288&&l<=12351,Hiragana:l=>l>=12352&&l<=12447,Katakana:l=>l>=12448&&l<=12543,Kanbun:l=>l>=12688&&l<=12703,"CJK Strokes":l=>l>=12736&&l<=12783,"Enclosed CJK Letters and Months":l=>l>=12800&&l<=13055,"CJK Compatibility":l=>l>=13056&&l<=13311,"Yijing Hexagram Symbols":l=>l>=19904&&l<=19967,"CJK Unified Ideographs":l=>l>=19968&&l<=40959,"Hangul Syllables":l=>l>=44032&&l<=55215,"Private Use Area":l=>l>=57344&&l<=63743,"Vertical Forms":l=>l>=65040&&l<=65055,"CJK Compatibility Forms":l=>l>=65072&&l<=65103,"Small Form Variants":l=>l>=65104&&l<=65135,"Halfwidth and Fullwidth Forms":l=>l>=65280&&l<=65519};function zl(l){for(const r of l)if(ud(r.charCodeAt(0)))return!0;return!1}function Xf(l){for(const r of l)if(!vu(r.charCodeAt(0)))return!1;return!0}function bh(l){const r=l.map((o=>{try{return new RegExp(`\\p{sc=${o}}`,"u").source}catch{return null}})).filter((o=>o));return new RegExp(r.join("|"),"u")}const Ju=bh(["Arab","Dupl","Mong","Ougr","Syrc"]);function vu(l){return!Ju.test(String.fromCodePoint(l))}const Nc=bh(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function ud(l){return!(l!==746&&l!==747&&(l<4352||!(ai["CJK Compatibility Forms"](l)&&!(l>=65097&&l<=65103)||ai["CJK Compatibility"](l)||ai["CJK Strokes"](l)||!(!ai["CJK Symbols and Punctuation"](l)||l>=12296&&l<=12305||l>=12308&&l<=12319||l===12336)||ai["Enclosed CJK Letters and Months"](l)||ai["Ideographic Description Characters"](l)||ai.Kanbun(l)||ai.Katakana(l)&&l!==12540||!(!ai["Halfwidth and Fullwidth Forms"](l)||l===65288||l===65289||l===65293||l>=65306&&l<=65310||l===65339||l===65341||l===65343||l>=65371&&l<=65503||l===65507||l>=65512&&l<=65519)||!(!ai["Small Form Variants"](l)||l>=65112&&l<=65118||l>=65123&&l<=65126)||ai["Vertical Forms"](l)||ai["Yijing Hexagram Symbols"](l)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(l))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(l))||Nc.test(String.fromCodePoint(l)))))}function Yd(l){return!(ud(l)||(function(r){return!!(ai["Latin-1 Supplement"](r)&&(r===167||r===169||r===174||r===177||r===188||r===189||r===190||r===215||r===247)||ai["General Punctuation"](r)&&(r===8214||r===8224||r===8225||r===8240||r===8241||r===8251||r===8252||r===8258||r===8263||r===8264||r===8265||r===8273)||ai["Letterlike Symbols"](r)||ai["Number Forms"](r)||ai["Miscellaneous Technical"](r)&&(r>=8960&&r<=8967||r>=8972&&r<=8991||r>=8996&&r<=9e3||r===9003||r>=9085&&r<=9114||r>=9150&&r<=9165||r===9167||r>=9169&&r<=9179||r>=9186&&r<=9215)||ai["Control Pictures"](r)&&r!==9251||ai["Optical Character Recognition"](r)||ai["Enclosed Alphanumerics"](r)||ai["Geometric Shapes"](r)||ai["Miscellaneous Symbols"](r)&&!(r>=9754&&r<=9759)||ai["Miscellaneous Symbols and Arrows"](r)&&(r>=11026&&r<=11055||r>=11088&&r<=11097||r>=11192&&r<=11243)||ai["CJK Symbols and Punctuation"](r)||ai.Katakana(r)||ai["Private Use Area"](r)||ai["CJK Compatibility Forms"](r)||ai["Small Form Variants"](r)||ai["Halfwidth and Fullwidth Forms"](r)||r===8734||r===8756||r===8757||r>=9984&&r<=10087||r>=10102&&r<=10131||r===65532||r===65533)})(l))}const xh=bh(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Bc(l){return xh.test(String.fromCodePoint(l))}function Kf(l,r){return!(!r&&Bc(l)||l>=2304&&l<=3583||l>=3840&&l<=4255||ai.Khmer(l))}function Yf(l){for(const r of l)if(Bc(r.charCodeAt(0)))return!0;return!1}const Rs=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(l){this.pluginStatus=l.pluginStatus,this.pluginURL=l.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(l){if(Rs.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=l.applyArabicShaping,this.processBidirectionalText=l.processBidirectionalText,this.processStyledBidirectionalText=l.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(l,r){return c(this,void 0,void 0,(function*(){if(this.isParsed())return this.getState();if(l.pluginStatus!=="loading")return this.setState(l),l;const o=l.pluginURL,p=new Promise((E=>{this.loadScriptResolve=E}));r(o);const v=new Promise((E=>setTimeout((()=>E()),this.TIMEOUT)));if(yield Promise.race([p,v]),this.isParsed()){const E={pluginStatus:"loaded",pluginURL:o};return this.setState(E),E}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${o}`)}))}};class rr{constructor(r,o){this.zoom=r,o?(this.now=o.now||0,this.fadeDuration=o.fadeDuration||0,this.zoomHistory=o.zoomHistory||new ld,this.transition=o.transition||{},this.globalState=o.globalState||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new ld,this.transition={},this.globalState={})}isSupportedScript(r){return(function(o,p){for(const v of o)if(!Kf(v.charCodeAt(0),p))return!1;return!0})(r,Rs.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const r=this.zoom,o=r-Math.floor(r),p=this.crossFadingFactor();return r>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:o+(1-o)*p}:{fromScale:.5,toScale:1,t:1-(1-p)*o}}}class Fc{constructor(r,o){this.property=r,this.value=o,this.expression=(function(p,v){if(Hu(p))return new U(p,v);if(nl(p)){const E=R(p,v);if(E.result==="error")throw new Error(E.value.map((A=>`${A.key}: ${A.message}`)).join(", "));return E.value}{let E=p;return v.type==="color"&&typeof p=="string"?E=Mn.parse(p):v.type!=="padding"||typeof p!="number"&&!Array.isArray(p)?v.type!=="numberArray"||typeof p!="number"&&!Array.isArray(p)?v.type!=="colorArray"||typeof p!="string"&&!Array.isArray(p)?v.type==="variableAnchorOffsetCollection"&&Array.isArray(p)?E=or.parse(p):v.type==="projectionDefinition"&&typeof p=="string"&&(E=Oi.parse(p)):E=hi.parse(p):E=fn.parse(p):E=qr.parse(p),{globalStateRefs:new Set,kind:"constant",evaluate:()=>E}}})(o===void 0?r.specification.default:o,r.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(r,o,p){return this.property.possiblyEvaluate(this,r,o,p)}}class cd{constructor(r){this.property=r,this.value=new Fc(r,void 0)}transitioned(r,o){return new iu(this.property,this.value,o,qn({},r.transition,this.transition),r.now)}untransitioned(){return new iu(this.property,this.value,null,{},0)}}class Qd{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitionablePropertyValues)}getValue(r){return Or(this._values[r].value.value)}setValue(r,o){Object.prototype.hasOwnProperty.call(this._values,r)||(this._values[r]=new cd(this._values[r].property)),this._values[r].value=new Fc(this._values[r].property,o===null?void 0:Or(o))}getTransition(r){return Or(this._values[r].transition)}setTransition(r,o){Object.prototype.hasOwnProperty.call(this._values,r)||(this._values[r]=new cd(this._values[r].property)),this._values[r].transition=Or(o)||void 0}serialize(){const r={};for(const o of Object.keys(this._values)){const p=this.getValue(o);p!==void 0&&(r[o]=p);const v=this.getTransition(o);v!==void 0&&(r[`${o}-transition`]=v)}return r}transitioned(r,o){const p=new ii(this._properties);for(const v of Object.keys(this._values))p._values[v]=this._values[v].transitioned(r,o._values[v]);return p}untransitioned(){const r=new ii(this._properties);for(const o of Object.keys(this._values))r._values[o]=this._values[o].untransitioned();return r}}class iu{constructor(r,o,p,v,E){this.property=r,this.value=o,this.begin=E+v.delay||0,this.end=this.begin+v.duration||0,r.specification.transition&&(v.delay||v.duration)&&(this.prior=p)}possiblyEvaluate(r,o,p){const v=r.now||0,E=this.value.possiblyEvaluate(r,o,p),A=this.prior;if(A){if(v>this.end)return this.prior=null,E;if(this.value.isDataDriven())return this.prior=null,E;if(v<this.begin)return A.possiblyEvaluate(r,o,p);{const P=(v-this.begin)/(this.end-this.begin);return this.property.interpolate(A.possiblyEvaluate(r,o,p),E,zt(P))}}return E}}class ii{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitioningPropertyValues)}possiblyEvaluate(r,o,p){const v=new Vc(this._properties);for(const E of Object.keys(this._values))v._values[E]=this._values[E].possiblyEvaluate(r,o,p);return v}hasTransition(){for(const r of Object.keys(this._values))if(this._values[r].prior)return!0;return!1}}class Yi{constructor(r){this._properties=r,this._values=Object.create(r.defaultPropertyValues)}hasValue(r){return this._values[r].value!==void 0}getValue(r){return Or(this._values[r].value)}setValue(r,o){this._values[r]=new Fc(this._values[r].property,o===null?void 0:Or(o))}serialize(){const r={};for(const o of Object.keys(this._values)){const p=this.getValue(o);p!==void 0&&(r[o]=p)}return r}possiblyEvaluate(r,o,p){const v=new Vc(this._properties);for(const E of Object.keys(this._values))v._values[E]=this._values[E].possiblyEvaluate(r,o,p);return v}}class Qi{constructor(r,o,p){this.property=r,this.value=o,this.parameters=p}isConstant(){return this.value.kind==="constant"}constantOr(r){return this.value.kind==="constant"?this.value.value:r}evaluate(r,o,p,v){return this.property.evaluate(this.value,this.parameters,r,o,p,v)}}class Vc{constructor(r){this._properties=r,this._values=Object.create(r.defaultPossiblyEvaluatedValues)}get(r){return this._values[r]}}class tn{constructor(r){this.specification=r}possiblyEvaluate(r,o){if(r.isDataDriven())throw new Error("Value should not be data driven");return r.expression.evaluate(o)}interpolate(r,o,p){const v=Es[this.specification.type];return v?v(r,o,p):r}}class yn{constructor(r,o){this.specification=r,this.overrides=o}possiblyEvaluate(r,o,p,v){return new Qi(this,r.expression.kind==="constant"||r.expression.kind==="camera"?{kind:"constant",value:r.expression.evaluate(o,null,{},p,v)}:r.expression,o)}interpolate(r,o,p){if(r.value.kind!=="constant"||o.value.kind!=="constant")return r;if(r.value.value===void 0||o.value.value===void 0)return new Qi(this,{kind:"constant",value:void 0},r.parameters);const v=Es[this.specification.type];if(v){const E=v(r.value.value,o.value.value,p);return new Qi(this,{kind:"constant",value:E},r.parameters)}return r}evaluate(r,o,p,v,E,A){return r.kind==="constant"?r.value:r.evaluate(o,p,v,E,A)}}class Uc extends yn{possiblyEvaluate(r,o,p,v){if(r.value===void 0)return new Qi(this,{kind:"constant",value:void 0},o);if(r.expression.kind==="constant"){const E=r.expression.evaluate(o,null,{},p,v),A=r.property.specification.type==="resolvedImage"&&typeof E!="string"?E.name:E,P=this._calculate(A,A,A,o);return new Qi(this,{kind:"constant",value:P},o)}if(r.expression.kind==="camera"){const E=this._calculate(r.expression.evaluate({zoom:o.zoom-1}),r.expression.evaluate({zoom:o.zoom}),r.expression.evaluate({zoom:o.zoom+1}),o);return new Qi(this,{kind:"constant",value:E},o)}return new Qi(this,r.expression,o)}evaluate(r,o,p,v,E,A){if(r.kind==="source"){const P=r.evaluate(o,p,v,E,A);return this._calculate(P,P,P,o)}return r.kind==="composite"?this._calculate(r.evaluate({zoom:Math.floor(o.zoom)-1},p,v),r.evaluate({zoom:Math.floor(o.zoom)},p,v),r.evaluate({zoom:Math.floor(o.zoom)+1},p,v),o):r.value}_calculate(r,o,p,v){return v.zoom>v.zoomHistory.lastIntegerZoom?{from:r,to:o}:{from:p,to:o}}interpolate(r){return r}}class ol{constructor(r){this.specification=r}possiblyEvaluate(r,o,p,v){if(r.value!==void 0){if(r.expression.kind==="constant"){const E=r.expression.evaluate(o,null,{},p,v);return this._calculate(E,E,E,o)}return this._calculate(r.expression.evaluate(new rr(Math.floor(o.zoom-1),o)),r.expression.evaluate(new rr(Math.floor(o.zoom),o)),r.expression.evaluate(new rr(Math.floor(o.zoom+1),o)),o)}}_calculate(r,o,p,v){return v.zoom>v.zoomHistory.lastIntegerZoom?{from:r,to:o}:{from:p,to:o}}interpolate(r){return r}}class bu{constructor(r){this.specification=r}possiblyEvaluate(r,o,p,v){return!!r.expression.evaluate(o,null,{},p,v)}interpolate(){return!1}}class no{constructor(r){this.properties=r,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const o in r){const p=r[o];p.specification.overridable&&this.overridableProperties.push(o);const v=this.defaultPropertyValues[o]=new Fc(p,void 0),E=this.defaultTransitionablePropertyValues[o]=new cd(p);this.defaultTransitioningPropertyValues[o]=E.untransitioned(),this.defaultPossiblyEvaluatedValues[o]=v.possiblyEvaluate({})}}}Kt("DataDrivenProperty",yn),Kt("DataConstantProperty",tn),Kt("CrossFadedDataDrivenProperty",Uc),Kt("CrossFadedProperty",ol),Kt("ColorRampProperty",bu);const Yr="-transition";class So extends en{constructor(r,o){if(super(),this.id=r.id,this.type=r.type,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},r.type!=="custom"&&(this.metadata=r.metadata,this.minzoom=r.minzoom,this.maxzoom=r.maxzoom,r.type!=="background"&&(this.source=r.source,this.sourceLayer=r["source-layer"],this.filter=r.filter,this._featureFilter=mt(r.filter)),o.layout&&(this._unevaluatedLayout=new Yi(o.layout)),o.paint)){this._transitionablePaint=new Qd(o.paint);for(const p in r.paint)this.setPaintProperty(p,r.paint[p],{validate:!1});for(const p in r.layout)this.setLayoutProperty(p,r.layout[p],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Vc(o.paint)}}setFilter(r){this.filter=r,this._featureFilter=mt(r)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(r){return r==="visibility"?this.visibility:this._unevaluatedLayout.getValue(r)}getLayoutAffectingGlobalStateRefs(){const r=new Set;if(this._unevaluatedLayout)for(const o in this._unevaluatedLayout._values){const p=this._unevaluatedLayout._values[o];for(const v of p.getGlobalStateRefs())r.add(v)}for(const o of this._featureFilter.getGlobalStateRefs())r.add(o);return r}setLayoutProperty(r,o,p={}){o!=null&&this._validate(Kd,`layers.${this.id}.layout.${r}`,r,o,p)||(r!=="visibility"?this._unevaluatedLayout.setValue(r,o):this.visibility=o)}getPaintProperty(r){return r.endsWith(Yr)?this._transitionablePaint.getTransition(r.slice(0,-11)):this._transitionablePaint.getValue(r)}setPaintProperty(r,o,p={}){if(o!=null&&this._validate(Wf,`layers.${this.id}.paint.${r}`,r,o,p))return!1;if(r.endsWith(Yr))return this._transitionablePaint.setTransition(r.slice(0,-11),o||void 0),!1;{const v=this._transitionablePaint._values[r],E=v.property.specification["property-type"]==="cross-faded-data-driven",A=v.value.isDataDriven(),P=v.value;this._transitionablePaint.setValue(r,o),this._handleSpecialPaintPropertyUpdate(r);const z=this._transitionablePaint._values[r].value;return z.isDataDriven()||A||E||this._handleOverridablePaintPropertyUpdate(r,P,z)}}_handleSpecialPaintPropertyUpdate(r){}_handleOverridablePaintPropertyUpdate(r,o,p){return!1}isHidden(r){return!!(this.minzoom&&r<this.minzoom)||!!(this.maxzoom&&r>=this.maxzoom)||this.visibility==="none"}updateTransitions(r){this._transitioningPaint=this._transitionablePaint.transitioned(r,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(r,o){r.getCrossfadeParameters&&(this._crossfadeParameters=r.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(r,void 0,o)),this.paint=this._transitioningPaint.possiblyEvaluate(r,void 0,o)}serialize(){const r={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(r.layout=r.layout||{},r.layout.visibility=this.visibility),Us(r,((o,p)=>!(o===void 0||p==="layout"&&!Object.keys(o).length||p==="paint"&&!Object.keys(o).length)))}_validate(r,o,p,v,E={}){return(!E||E.validate!==!1)&&yh(this,r.call(_h,{key:o,layerType:this.type,objectKey:p,value:v,styleSpec:qe,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const r in this.paint._values){const o=this.paint.get(r);if(o instanceof Qi&&Js(o.property.specification)&&(o.value.kind==="source"||o.value.kind==="composite")&&o.value.isStateDependent)return!0}return!1}}const Qf={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class wh{constructor(r,o){this._structArray=r,this._pos1=o*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class ji{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(r,o){return r._trim(),o&&(r.isTransferred=!0,o.push(r.arrayBuffer)),{length:r.length,arrayBuffer:r.arrayBuffer}}static deserialize(r){const o=Object.create(this.prototype);return o.arrayBuffer=r.arrayBuffer,o.length=r.length,o.capacity=r.arrayBuffer.byteLength/o.bytesPerElement,o._refreshViews(),o}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(r){this.reserve(r),this.length=r}reserve(r){if(r>this.capacity){this.capacity=Math.max(r,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const o=this.uint8;this._refreshViews(),o&&this.uint8.set(o)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Qr(l,r=1){let o=0,p=0;return{members:l.map((v=>{const E=Qf[v.type].BYTES_PER_ELEMENT,A=o=Th(o,Math.max(r,E)),P=v.components||1;return p=Math.max(p,E),o+=E*P,{name:v.name,type:v.type,components:P,offset:A}})),size:Th(o,Math.max(p,r)),alignment:r}}function Th(l,r){return Math.ceil(l/r)*r}class ec extends ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,o){const p=this.length;return this.resize(p+1),this.emplace(p,r,o)}emplace(r,o,p){const v=2*r;return this.int16[v+0]=o,this.int16[v+1]=p,r}}ec.prototype.bytesPerElement=4,Kt("StructArrayLayout2i4",ec);class tc extends ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,o,p){const v=this.length;return this.resize(v+1),this.emplace(v,r,o,p)}emplace(r,o,p,v){const E=3*r;return this.int16[E+0]=o,this.int16[E+1]=p,this.int16[E+2]=v,r}}tc.prototype.bytesPerElement=6,Kt("StructArrayLayout3i6",tc);class ks extends ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,o,p,v){const E=this.length;return this.resize(E+1),this.emplace(E,r,o,p,v)}emplace(r,o,p,v,E){const A=4*r;return this.int16[A+0]=o,this.int16[A+1]=p,this.int16[A+2]=v,this.int16[A+3]=E,r}}ks.prototype.bytesPerElement=8,Kt("StructArrayLayout4i8",ks);class Mr extends ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,o,p,v,E,A){const P=this.length;return this.resize(P+1),this.emplace(P,r,o,p,v,E,A)}emplace(r,o,p,v,E,A,P){const z=6*r;return this.int16[z+0]=o,this.int16[z+1]=p,this.int16[z+2]=v,this.int16[z+3]=E,this.int16[z+4]=A,this.int16[z+5]=P,r}}Mr.prototype.bytesPerElement=12,Kt("StructArrayLayout2i4i12",Mr);class xu extends ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,o,p,v,E,A){const P=this.length;return this.resize(P+1),this.emplace(P,r,o,p,v,E,A)}emplace(r,o,p,v,E,A,P){const z=4*r,F=8*r;return this.int16[z+0]=o,this.int16[z+1]=p,this.uint8[F+4]=v,this.uint8[F+5]=E,this.uint8[F+6]=A,this.uint8[F+7]=P,r}}xu.prototype.bytesPerElement=8,Kt("StructArrayLayout2i4ub8",xu);class wu extends ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,o){const p=this.length;return this.resize(p+1),this.emplace(p,r,o)}emplace(r,o,p){const v=2*r;return this.float32[v+0]=o,this.float32[v+1]=p,r}}wu.prototype.bytesPerElement=8,Kt("StructArrayLayout2f8",wu);class jc extends ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,o,p,v,E,A,P,z,F,q){const H=this.length;return this.resize(H+1),this.emplace(H,r,o,p,v,E,A,P,z,F,q)}emplace(r,o,p,v,E,A,P,z,F,q,H){const J=10*r;return this.uint16[J+0]=o,this.uint16[J+1]=p,this.uint16[J+2]=v,this.uint16[J+3]=E,this.uint16[J+4]=A,this.uint16[J+5]=P,this.uint16[J+6]=z,this.uint16[J+7]=F,this.uint16[J+8]=q,this.uint16[J+9]=H,r}}jc.prototype.bytesPerElement=20,Kt("StructArrayLayout10ui20",jc);class Tu extends ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,o,p,v,E,A,P,z,F,q,H,J){const ie=this.length;return this.resize(ie+1),this.emplace(ie,r,o,p,v,E,A,P,z,F,q,H,J)}emplace(r,o,p,v,E,A,P,z,F,q,H,J,ie){const re=12*r;return this.int16[re+0]=o,this.int16[re+1]=p,this.int16[re+2]=v,this.int16[re+3]=E,this.uint16[re+4]=A,this.uint16[re+5]=P,this.uint16[re+6]=z,this.uint16[re+7]=F,this.int16[re+8]=q,this.int16[re+9]=H,this.int16[re+10]=J,this.int16[re+11]=ie,r}}Tu.prototype.bytesPerElement=24,Kt("StructArrayLayout4i4ui4i24",Tu);class Ol extends ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,o,p){const v=this.length;return this.resize(v+1),this.emplace(v,r,o,p)}emplace(r,o,p,v){const E=3*r;return this.float32[E+0]=o,this.float32[E+1]=p,this.float32[E+2]=v,r}}Ol.prototype.bytesPerElement=12,Kt("StructArrayLayout3f12",Ol);class Sh extends ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r){const o=this.length;return this.resize(o+1),this.emplace(o,r)}emplace(r,o){return this.uint32[1*r+0]=o,r}}Sh.prototype.bytesPerElement=4,Kt("StructArrayLayout1ul4",Sh);class Eh extends ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,o,p,v,E,A,P,z,F){const q=this.length;return this.resize(q+1),this.emplace(q,r,o,p,v,E,A,P,z,F)}emplace(r,o,p,v,E,A,P,z,F,q){const H=10*r,J=5*r;return this.int16[H+0]=o,this.int16[H+1]=p,this.int16[H+2]=v,this.int16[H+3]=E,this.int16[H+4]=A,this.int16[H+5]=P,this.uint32[J+3]=z,this.uint16[H+8]=F,this.uint16[H+9]=q,r}}Eh.prototype.bytesPerElement=20,Kt("StructArrayLayout6i1ul2ui20",Eh);class hd extends ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,o,p,v,E,A){const P=this.length;return this.resize(P+1),this.emplace(P,r,o,p,v,E,A)}emplace(r,o,p,v,E,A,P){const z=6*r;return this.int16[z+0]=o,this.int16[z+1]=p,this.int16[z+2]=v,this.int16[z+3]=E,this.int16[z+4]=A,this.int16[z+5]=P,r}}hd.prototype.bytesPerElement=12,Kt("StructArrayLayout2i2i2i12",hd);class w extends ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,o,p,v,E){const A=this.length;return this.resize(A+1),this.emplace(A,r,o,p,v,E)}emplace(r,o,p,v,E,A){const P=4*r,z=8*r;return this.float32[P+0]=o,this.float32[P+1]=p,this.float32[P+2]=v,this.int16[z+6]=E,this.int16[z+7]=A,r}}w.prototype.bytesPerElement=16,Kt("StructArrayLayout2f1f2i16",w);class n extends ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,o,p,v,E,A){const P=this.length;return this.resize(P+1),this.emplace(P,r,o,p,v,E,A)}emplace(r,o,p,v,E,A,P){const z=16*r,F=4*r,q=8*r;return this.uint8[z+0]=o,this.uint8[z+1]=p,this.float32[F+1]=v,this.float32[F+2]=E,this.int16[q+6]=A,this.int16[q+7]=P,r}}n.prototype.bytesPerElement=16,Kt("StructArrayLayout2ub2f2i16",n);class u extends ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,o,p){const v=this.length;return this.resize(v+1),this.emplace(v,r,o,p)}emplace(r,o,p,v){const E=3*r;return this.uint16[E+0]=o,this.uint16[E+1]=p,this.uint16[E+2]=v,r}}u.prototype.bytesPerElement=6,Kt("StructArrayLayout3ui6",u);class _ extends ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,o,p,v,E,A,P,z,F,q,H,J,ie,re,oe,pe,we){const He=this.length;return this.resize(He+1),this.emplace(He,r,o,p,v,E,A,P,z,F,q,H,J,ie,re,oe,pe,we)}emplace(r,o,p,v,E,A,P,z,F,q,H,J,ie,re,oe,pe,we,He){const Re=24*r,Fe=12*r,ot=48*r;return this.int16[Re+0]=o,this.int16[Re+1]=p,this.uint16[Re+2]=v,this.uint16[Re+3]=E,this.uint32[Fe+2]=A,this.uint32[Fe+3]=P,this.uint32[Fe+4]=z,this.uint16[Re+10]=F,this.uint16[Re+11]=q,this.uint16[Re+12]=H,this.float32[Fe+7]=J,this.float32[Fe+8]=ie,this.uint8[ot+36]=re,this.uint8[ot+37]=oe,this.uint8[ot+38]=pe,this.uint32[Fe+10]=we,this.int16[Re+22]=He,r}}_.prototype.bytesPerElement=48,Kt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",_);class b extends ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,o,p,v,E,A,P,z,F,q,H,J,ie,re,oe,pe,we,He,Re,Fe,ot,_t,It,$t,Nt,Ut,hn,Gt){const qt=this.length;return this.resize(qt+1),this.emplace(qt,r,o,p,v,E,A,P,z,F,q,H,J,ie,re,oe,pe,we,He,Re,Fe,ot,_t,It,$t,Nt,Ut,hn,Gt)}emplace(r,o,p,v,E,A,P,z,F,q,H,J,ie,re,oe,pe,we,He,Re,Fe,ot,_t,It,$t,Nt,Ut,hn,Gt,qt){const wt=32*r,En=16*r;return this.int16[wt+0]=o,this.int16[wt+1]=p,this.int16[wt+2]=v,this.int16[wt+3]=E,this.int16[wt+4]=A,this.int16[wt+5]=P,this.int16[wt+6]=z,this.int16[wt+7]=F,this.uint16[wt+8]=q,this.uint16[wt+9]=H,this.uint16[wt+10]=J,this.uint16[wt+11]=ie,this.uint16[wt+12]=re,this.uint16[wt+13]=oe,this.uint16[wt+14]=pe,this.uint16[wt+15]=we,this.uint16[wt+16]=He,this.uint16[wt+17]=Re,this.uint16[wt+18]=Fe,this.uint16[wt+19]=ot,this.uint16[wt+20]=_t,this.uint16[wt+21]=It,this.uint16[wt+22]=$t,this.uint32[En+12]=Nt,this.float32[En+13]=Ut,this.float32[En+14]=hn,this.uint16[wt+30]=Gt,this.uint16[wt+31]=qt,r}}b.prototype.bytesPerElement=64,Kt("StructArrayLayout8i15ui1ul2f2ui64",b);class T extends ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r){const o=this.length;return this.resize(o+1),this.emplace(o,r)}emplace(r,o){return this.float32[1*r+0]=o,r}}T.prototype.bytesPerElement=4,Kt("StructArrayLayout1f4",T);class I extends ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,o,p){const v=this.length;return this.resize(v+1),this.emplace(v,r,o,p)}emplace(r,o,p,v){const E=3*r;return this.uint16[6*r+0]=o,this.float32[E+1]=p,this.float32[E+2]=v,r}}I.prototype.bytesPerElement=12,Kt("StructArrayLayout1ui2f12",I);class O extends ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,o,p){const v=this.length;return this.resize(v+1),this.emplace(v,r,o,p)}emplace(r,o,p,v){const E=4*r;return this.uint32[2*r+0]=o,this.uint16[E+2]=p,this.uint16[E+3]=v,r}}O.prototype.bytesPerElement=8,Kt("StructArrayLayout1ul2ui8",O);class N extends ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,o){const p=this.length;return this.resize(p+1),this.emplace(p,r,o)}emplace(r,o,p){const v=2*r;return this.uint16[v+0]=o,this.uint16[v+1]=p,r}}N.prototype.bytesPerElement=4,Kt("StructArrayLayout2ui4",N);class j extends ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r){const o=this.length;return this.resize(o+1),this.emplace(o,r)}emplace(r,o){return this.uint16[1*r+0]=o,r}}j.prototype.bytesPerElement=2,Kt("StructArrayLayout1ui2",j);class $ extends ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,o,p,v){const E=this.length;return this.resize(E+1),this.emplace(E,r,o,p,v)}emplace(r,o,p,v,E){const A=4*r;return this.float32[A+0]=o,this.float32[A+1]=p,this.float32[A+2]=v,this.float32[A+3]=E,r}}$.prototype.bytesPerElement=16,Kt("StructArrayLayout4f16",$);class X extends wh{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new C(this.anchorPointX,this.anchorPointY)}}X.prototype.size=20;class W extends Eh{get(r){return new X(this,r)}}Kt("CollisionBoxArray",W);class ee extends wh{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(r){this._structArray.uint8[this._pos1+37]=r}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(r){this._structArray.uint8[this._pos1+38]=r}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(r){this._structArray.uint32[this._pos4+10]=r}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}ee.prototype.size=48;class ae extends _{get(r){return new ee(this,r)}}Kt("PlacedSymbolArray",ae);class _e extends wh{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(r){this._structArray.uint32[this._pos4+12]=r}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}_e.prototype.size=64;class ge extends b{get(r){return new _e(this,r)}}Kt("SymbolInstanceArray",ge);class ve extends T{getoffsetX(r){return this.float32[1*r+0]}}Kt("GlyphOffsetArray",ve);class Te extends tc{getx(r){return this.int16[3*r+0]}gety(r){return this.int16[3*r+1]}gettileUnitDistanceFromAnchor(r){return this.int16[3*r+2]}}Kt("SymbolLineVertexArray",Te);class Me extends wh{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}Me.prototype.size=12;class Ae extends I{get(r){return new Me(this,r)}}Kt("TextAnchorOffsetArray",Ae);class Le extends wh{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Le.prototype.size=8;class Ue extends O{get(r){return new Le(this,r)}}Kt("FeatureIndexArray",Ue);class Ce extends ec{}class We extends ec{}class dt extends ec{}class rt extends Mr{}class st extends xu{}class ct extends wu{}class Ot extends jc{}class Bt extends Tu{}class Et extends Ol{}class un extends Sh{}class Kn extends hd{}class yi extends n{}class qi extends u{}class Ni extends N{}const Fr=Qr([{name:"a_pos",components:2,type:"Int16"}],4),{members:Rr}=Fr;class Hn{constructor(r=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=r}prepareSegment(r,o,p,v){const E=this.segments[this.segments.length-1];return r>Hn.MAX_VERTEX_ARRAY_LENGTH&&er(`Max vertices per segment is ${Hn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${r}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${Hn.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!E||E.vertexLength+r>Hn.MAX_VERTEX_ARRAY_LENGTH||E.sortKey!==v?this.createNewSegment(o,p,v):E}createNewSegment(r,o,p){const v={vertexOffset:r.length,primitiveOffset:o.length,vertexLength:0,primitiveLength:0,vaos:{}};return p!==void 0&&(v.sortKey=p),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(v),v}getOrCreateLatestSegment(r,o,p){return this.prepareSegment(0,r,o,p)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const r of this.segments)for(const o in r.vaos)r.vaos[o].destroy()}static simpleSegment(r,o,p,v){return new Hn([{vertexOffset:r,primitiveOffset:o,vertexLength:p,primitiveLength:v,vaos:{},sortKey:0}])}}function $i(l,r){return 256*(l=Ft(Math.floor(l),0,255))+Ft(Math.floor(r),0,255)}Hn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Kt("SegmentVector",Hn);const Jr=Qr([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var va,ka,io,Nl={exports:{}},Su={exports:{}},ll={exports:{}},nc=(function(){if(io)return Nl.exports;io=1;var l=(va||(va=1,Su.exports=function(o,p){var v,E,A,P,z,F,q,H;for(E=o.length-(v=3&o.length),A=p,z=3432918353,F=461845907,H=0;H<E;)q=255&o.charCodeAt(H)|(255&o.charCodeAt(++H))<<8|(255&o.charCodeAt(++H))<<16|(255&o.charCodeAt(++H))<<24,++H,A=27492+(65535&(P=5*(65535&(A=(A^=q=(65535&(q=(q=(65535&q)*z+(((q>>>16)*z&65535)<<16)&4294967295)<<15|q>>>17))*F+(((q>>>16)*F&65535)<<16)&4294967295)<<13|A>>>19))+((5*(A>>>16)&65535)<<16)&4294967295))+((58964+(P>>>16)&65535)<<16);switch(q=0,v){case 3:q^=(255&o.charCodeAt(H+2))<<16;case 2:q^=(255&o.charCodeAt(H+1))<<8;case 1:A^=q=(65535&(q=(q=(65535&(q^=255&o.charCodeAt(H)))*z+(((q>>>16)*z&65535)<<16)&4294967295)<<15|q>>>17))*F+(((q>>>16)*F&65535)<<16)&4294967295}return A^=o.length,A=2246822507*(65535&(A^=A>>>16))+((2246822507*(A>>>16)&65535)<<16)&4294967295,A=3266489909*(65535&(A^=A>>>13))+((3266489909*(A>>>16)&65535)<<16)&4294967295,(A^=A>>>16)>>>0}),Su.exports),r=(ka||(ka=1,ll.exports=function(o,p){for(var v,E=o.length,A=p^E,P=0;E>=4;)v=1540483477*(65535&(v=255&o.charCodeAt(P)|(255&o.charCodeAt(++P))<<8|(255&o.charCodeAt(++P))<<16|(255&o.charCodeAt(++P))<<24))+((1540483477*(v>>>16)&65535)<<16),A=1540483477*(65535&A)+((1540483477*(A>>>16)&65535)<<16)^(v=1540483477*(65535&(v^=v>>>24))+((1540483477*(v>>>16)&65535)<<16)),E-=4,++P;switch(E){case 3:A^=(255&o.charCodeAt(P+2))<<16;case 2:A^=(255&o.charCodeAt(P+1))<<8;case 1:A=1540483477*(65535&(A^=255&o.charCodeAt(P)))+((1540483477*(A>>>16)&65535)<<16)}return A=1540483477*(65535&(A^=A>>>13))+((1540483477*(A>>>16)&65535)<<16),(A^=A>>>15)>>>0}),ll.exports);return Nl.exports=l,Nl.exports.murmur3=l,Nl.exports.murmur2=r,Nl.exports})(),Eu=k(nc);class ic{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(r,o,p,v){this.ids.push(rc(r)),this.positions.push(o,p,v)}getPositions(r){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const o=rc(r);let p=0,v=this.ids.length-1;for(;p<v;){const A=p+v>>1;this.ids[A]>=o?v=A:p=A+1}const E=[];for(;this.ids[p]===o;)E.push({index:this.positions[3*p],start:this.positions[3*p+1],end:this.positions[3*p+2]}),p++;return E}static serialize(r,o){const p=new Float64Array(r.ids),v=new Uint32Array(r.positions);return rs(p,v,0,p.length-1),o&&o.push(p.buffer,v.buffer),{ids:p,positions:v}}static deserialize(r){const o=new ic;return o.ids=r.ids,o.positions=r.positions,o.indexed=!0,o}}function rc(l){const r=+l;return!isNaN(r)&&r<=Number.MAX_SAFE_INTEGER?r:Eu(String(l))}function rs(l,r,o,p){for(;o<p;){const v=l[o+p>>1];let E=o-1,A=p+1;for(;;){do E++;while(l[E]<v);do A--;while(l[A]>v);if(E>=A)break;ul(l,E,A),ul(r,3*E,3*A),ul(r,3*E+1,3*A+1),ul(r,3*E+2,3*A+2)}A-o<p-A?(rs(l,r,o,A),o=A+1):(rs(l,r,A+1,p),p=A)}}function ul(l,r,o){const p=l[r];l[r]=l[o],l[o]=p}Kt("FeaturePositionMap",ic);class Ls{constructor(r,o){this.gl=r.gl,this.location=o}}class ac extends Ls{constructor(r,o){super(r,o),this.current=0}set(r){this.current!==r&&(this.current=r,this.gl.uniform1f(this.location,r))}}class kr extends Ls{constructor(r,o){super(r,o),this.current=[0,0,0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]&&r[3]===this.current[3]||(this.current=r,this.gl.uniform4f(this.location,r[0],r[1],r[2],r[3]))}}class Zr extends Ls{constructor(r,o){super(r,o),this.current=Mn.transparent}set(r){r.r===this.current.r&&r.g===this.current.g&&r.b===this.current.b&&r.a===this.current.a||(this.current=r,this.gl.uniform4f(this.location,r.r,r.g,r.b,r.a))}}const ro=new Float32Array(16);function Vr(l){return[$i(255*l.r,255*l.g),$i(255*l.b,255*l.a)]}class sc{constructor(r,o,p){this.value=r,this.uniformNames=o.map((v=>`u_${v}`)),this.type=p}setUniform(r,o,p){r.set(p.constantOr(this.value))}getBinding(r,o,p){return this.type==="color"?new Zr(r,o):new ac(r,o)}}class qc{constructor(r,o){this.uniformNames=o.map((p=>`u_${p}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(r,o){this.pixelRatioFrom=o.pixelRatio,this.pixelRatioTo=r.pixelRatio,this.patternFrom=o.tlbr,this.patternTo=r.tlbr}setUniform(r,o,p,v){const E=v==="u_pattern_to"?this.patternTo:v==="u_pattern_from"?this.patternFrom:v==="u_pixel_ratio_to"?this.pixelRatioTo:v==="u_pixel_ratio_from"?this.pixelRatioFrom:null;E&&r.set(E)}getBinding(r,o,p){return p.substr(0,9)==="u_pattern"?new kr(r,o):new ac(r,o)}}class ru{constructor(r,o,p,v){this.expression=r,this.type=p,this.maxValue=0,this.paintVertexAttributes=o.map((E=>({name:`a_${E}`,type:"Float32",components:p==="color"?2:1,offset:0}))),this.paintVertexArray=new v}populatePaintArray(r,o,p,v,E){const A=this.paintVertexArray.length,P=this.expression.evaluate(new rr(0),o,{},v,[],E);this.paintVertexArray.resize(r),this._setPaintValue(A,r,P)}updatePaintArray(r,o,p,v){const E=this.expression.evaluate({zoom:0},p,v);this._setPaintValue(r,o,E)}_setPaintValue(r,o,p){if(this.type==="color"){const v=Vr(p);for(let E=r;E<o;E++)this.paintVertexArray.emplace(E,v[0],v[1])}else{for(let v=r;v<o;v++)this.paintVertexArray.emplace(v,p);this.maxValue=Math.max(this.maxValue,Math.abs(p))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ds{constructor(r,o,p,v,E,A){this.expression=r,this.uniformNames=o.map((P=>`u_${P}_t`)),this.type=p,this.useIntegerZoom=v,this.zoom=E,this.maxValue=0,this.paintVertexAttributes=o.map((P=>({name:`a_${P}`,type:"Float32",components:p==="color"?4:2,offset:0}))),this.paintVertexArray=new A}populatePaintArray(r,o,p,v,E){const A=this.expression.evaluate(new rr(this.zoom),o,{},v,[],E),P=this.expression.evaluate(new rr(this.zoom+1),o,{},v,[],E),z=this.paintVertexArray.length;this.paintVertexArray.resize(r),this._setPaintValue(z,r,A,P)}updatePaintArray(r,o,p,v){const E=this.expression.evaluate({zoom:this.zoom},p,v),A=this.expression.evaluate({zoom:this.zoom+1},p,v);this._setPaintValue(r,o,E,A)}_setPaintValue(r,o,p,v){if(this.type==="color"){const E=Vr(p),A=Vr(v);for(let P=r;P<o;P++)this.paintVertexArray.emplace(P,E[0],E[1],A[0],A[1])}else{for(let E=r;E<o;E++)this.paintVertexArray.emplace(E,p,v);this.maxValue=Math.max(this.maxValue,Math.abs(p),Math.abs(v))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(r,o){const p=this.useIntegerZoom?Math.floor(o.zoom):o.zoom,v=Ft(this.expression.interpolationFactor(p,this.zoom,this.zoom+1),0,1);r.set(v)}getBinding(r,o,p){return new ac(r,o)}}class Au{constructor(r,o,p,v,E,A){this.expression=r,this.type=o,this.useIntegerZoom=p,this.zoom=v,this.layerId=A,this.zoomInPaintVertexArray=new E,this.zoomOutPaintVertexArray=new E}populatePaintArray(r,o,p){const v=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(r),this.zoomOutPaintVertexArray.resize(r),this._setPaintValues(v,r,o.patterns&&o.patterns[this.layerId],p)}updatePaintArray(r,o,p,v,E){this._setPaintValues(r,o,p.patterns&&p.patterns[this.layerId],E)}_setPaintValues(r,o,p,v){if(!v||!p)return;const{min:E,mid:A,max:P}=p,z=v[E],F=v[A],q=v[P];if(z&&F&&q)for(let H=r;H<o;H++)this.zoomInPaintVertexArray.emplace(H,F.tl[0],F.tl[1],F.br[0],F.br[1],z.tl[0],z.tl[1],z.br[0],z.br[1],F.pixelRatio,z.pixelRatio),this.zoomOutPaintVertexArray.emplace(H,F.tl[0],F.tl[1],F.br[0],F.br[1],q.tl[0],q.tl[1],q.br[0],q.br[1],F.pixelRatio,q.pixelRatio)}upload(r){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=r.createVertexBuffer(this.zoomInPaintVertexArray,Jr.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=r.createVertexBuffer(this.zoomOutPaintVertexArray,Jr.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Oo{constructor(r,o,p){this.binders={},this._buffers=[];const v=[];for(const E in r.paint._values){if(!p(E))continue;const A=r.paint.get(E);if(!(A instanceof Qi&&Js(A.property.specification)))continue;const P=Iu(E,r.type),z=A.value,F=A.property.specification.type,q=A.property.useIntegerZoom,H=A.property.specification["property-type"],J=H==="cross-faded"||H==="cross-faded-data-driven";if(z.kind==="constant")this.binders[E]=J?new qc(z.value,P):new sc(z.value,P,F),v.push(`/u_${E}`);else if(z.kind==="source"||J){const ie=Jd(E,F,"source");this.binders[E]=J?new Au(z,F,q,o,ie,r.id):new ru(z,P,F,ie),v.push(`/a_${E}`)}else{const ie=Jd(E,F,"composite");this.binders[E]=new Ds(z,P,F,q,o,ie),v.push(`/z_${E}`)}}this.cacheKey=v.sort().join("")}getMaxValue(r){const o=this.binders[r];return o instanceof ru||o instanceof Ds?o.maxValue:0}populatePaintArrays(r,o,p,v,E){for(const A in this.binders){const P=this.binders[A];(P instanceof ru||P instanceof Ds||P instanceof Au)&&P.populatePaintArray(r,o,p,v,E)}}setConstantPatternPositions(r,o){for(const p in this.binders){const v=this.binders[p];v instanceof qc&&v.setConstantPatternPositions(r,o)}}updatePaintArrays(r,o,p,v,E){let A=!1;for(const P in r){const z=o.getPositions(P);for(const F of z){const q=p.feature(F.index);for(const H in this.binders){const J=this.binders[H];if((J instanceof ru||J instanceof Ds||J instanceof Au)&&J.expression.isStateDependent===!0){const ie=v.paint.get(H);J.expression=ie.value,J.updatePaintArray(F.start,F.end,q,r[P],E),A=!0}}}}return A}defines(){const r=[];for(const o in this.binders){const p=this.binders[o];(p instanceof sc||p instanceof qc)&&r.push(...p.uniformNames.map((v=>`#define HAS_UNIFORM_${v}`)))}return r}getBinderAttributes(){const r=[];for(const o in this.binders){const p=this.binders[o];if(p instanceof ru||p instanceof Ds)for(let v=0;v<p.paintVertexAttributes.length;v++)r.push(p.paintVertexAttributes[v].name);else if(p instanceof Au)for(let v=0;v<Jr.members.length;v++)r.push(Jr.members[v].name)}return r}getBinderUniforms(){const r=[];for(const o in this.binders){const p=this.binders[o];if(p instanceof sc||p instanceof qc||p instanceof Ds)for(const v of p.uniformNames)r.push(v)}return r}getPaintVertexBuffers(){return this._buffers}getUniforms(r,o){const p=[];for(const v in this.binders){const E=this.binders[v];if(E instanceof sc||E instanceof qc||E instanceof Ds){for(const A of E.uniformNames)if(o[A]){const P=E.getBinding(r,o[A],A);p.push({name:A,property:v,binding:P})}}}return p}setUniforms(r,o,p,v){for(const{name:E,property:A,binding:P}of o)this.binders[A].setUniform(P,v,p.get(A),E)}updatePaintBuffers(r){this._buffers=[];for(const o in this.binders){const p=this.binders[o];if(r&&p instanceof Au){const v=r.fromScale===2?p.zoomInPaintVertexBuffer:p.zoomOutPaintVertexBuffer;v&&this._buffers.push(v)}else(p instanceof ru||p instanceof Ds)&&p.paintVertexBuffer&&this._buffers.push(p.paintVertexBuffer)}}upload(r){for(const o in this.binders){const p=this.binders[o];(p instanceof ru||p instanceof Ds||p instanceof Au)&&p.upload(r)}this.updatePaintBuffers()}destroy(){for(const r in this.binders){const o=this.binders[r];(o instanceof ru||o instanceof Ds||o instanceof Au)&&o.destroy()}}}class ea{constructor(r,o,p=()=>!0){this.programConfigurations={};for(const v of r)this.programConfigurations[v.id]=new Oo(v,o,p);this.needsUpload=!1,this._featureMap=new ic,this._bufferOffset=0}populatePaintArrays(r,o,p,v,E,A){for(const P in this.programConfigurations)this.programConfigurations[P].populatePaintArrays(r,o,v,E,A);o.id!==void 0&&this._featureMap.add(o.id,p,this._bufferOffset,r),this._bufferOffset=r,this.needsUpload=!0}updatePaintArrays(r,o,p,v){for(const E of p)this.needsUpload=this.programConfigurations[E.id].updatePaintArrays(r,this._featureMap,o,E,v)||this.needsUpload}get(r){return this.programConfigurations[r]}upload(r){if(this.needsUpload){for(const o in this.programConfigurations)this.programConfigurations[o].upload(r);this.needsUpload=!1}}destroy(){for(const r in this.programConfigurations)this.programConfigurations[r].destroy()}}function Iu(l,r){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[l]||[l.replace(`${r}-`,"").replace(/-/g,"_")]}function Jd(l,r,o){const p={color:{source:wu,composite:$},number:{source:T,composite:wu}},v=(function(E){return{"line-pattern":{source:Ot,composite:Ot},"fill-pattern":{source:Ot,composite:Ot},"fill-extrusion-pattern":{source:Ot,composite:Ot}}[E]})(l);return v&&v[o]||p[r][o]}Kt("ConstantBinder",sc),Kt("CrossFadedConstantBinder",qc),Kt("SourceExpressionBinder",ru),Kt("CrossFadedCompositeBinder",Au),Kt("CompositeExpressionBinder",Ds),Kt("ProgramConfiguration",Oo,{omit:["_buffers"]}),Kt("ProgramConfigurationSet",ea);const Bl=Math.pow(2,14)-1,cl=-Bl-1;function yr(l){const r=jt/l.extent,o=l.loadGeometry();for(let p=0;p<o.length;p++){const v=o[p];for(let E=0;E<v.length;E++){const A=v[E],P=Math.round(A.x*r),z=Math.round(A.y*r);A.x=Ft(P,cl,Bl),A.y=Ft(z,cl,Bl),(P<A.x||P>A.x+1||z<A.y||z>A.y+1)&&er("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return o}function hl(l,r){return{type:l.type,id:l.id,properties:l.properties,geometry:r?yr(l):[]}}const cm=-32768;function Cg(l,r,o,p,v){l.emplaceBack(cm+8*r+p,cm+8*o+v)}class hm{constructor(r){this.zoom=r.zoom,this.globalState=r.globalState,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map((o=>o.id)),this.index=r.index,this.hasPattern=!1,this.layoutVertexArray=new We,this.indexArray=new qi,this.segments=new Hn,this.programConfigurations=new ea(r.layers,r.zoom),this.stateDependentLayerIds=this.layers.filter((o=>o.isStateDependent())).map((o=>o.id))}populate(r,o,p){const v=this.layers[0],E=[];let A=null,P=!1,z=v.type==="heatmap";if(v.type==="circle"){const q=v;A=q.layout.get("circle-sort-key"),P=!A.isConstant(),z=z||q.paint.get("circle-pitch-alignment")==="map"}const F=z?o.subdivisionGranularity.circle:1;for(const{feature:q,id:H,index:J,sourceLayerIndex:ie}of r){const re=this.layers[0]._featureFilter.needGeometry,oe=hl(q,re);if(!this.layers[0]._featureFilter.filter(new rr(this.zoom,{globalState:this.globalState}),oe,p))continue;const pe=P?A.evaluate(oe,{},p):void 0,we={id:H,properties:q.properties,type:q.type,sourceLayerIndex:ie,index:J,geometry:re?oe.geometry:yr(q),patterns:{},sortKey:pe};E.push(we)}P&&E.sort(((q,H)=>q.sortKey-H.sortKey));for(const q of E){const{geometry:H,index:J,sourceLayerIndex:ie}=q,re=r[J].feature;this.addFeature(q,H,J,p,F),o.featureIndex.insert(re,H,J,ie,this.index)}}update(r,o,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,o,this.stateDependentLayers,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,Rr),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(r,o,p,v,E=1){let A;switch(E){case 1:A=[0,7];break;case 3:A=[0,2,5,7];break;case 5:A=[0,1,3,4,6,7];break;case 7:A=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${E}; valid values are 1, 3, 5, 7.`)}const P=A.length;for(const z of o)for(const F of z){const q=F.x,H=F.y;if(q<0||q>=jt||H<0||H>=jt)continue;const J=this.segments.prepareSegment(P*P,this.layoutVertexArray,this.indexArray,r.sortKey),ie=J.vertexLength;for(let re=0;re<P;re++)for(let oe=0;oe<P;oe++)Cg(this.layoutVertexArray,q,H,A[oe],A[re]);for(let re=0;re<P-1;re++)for(let oe=0;oe<P-1;oe++){const pe=ie+re*P+oe,we=ie+(re+1)*P+oe;this.indexArray.emplaceBack(pe,we+1,pe+1),this.indexArray.emplaceBack(pe,we,we+1)}J.vertexLength+=P*P,J.primitiveLength+=(P-1)*(P-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,p,{},v)}}function Pg(l,r){for(let o=0;o<l.length;o++)if(fd(r,l[o]))return!0;for(let o=0;o<r.length;o++)if(fd(l,r[o]))return!0;return!!dm(l,r)}function dd(l,r,o){return!!fd(l,r)||!!ef(r,l,o)}function Jf(l,r){if(l.length===1)return fm(r,l[0]);for(let o=0;o<r.length;o++){const p=r[o];for(let v=0;v<p.length;v++)if(fd(l,p[v]))return!0}for(let o=0;o<l.length;o++)if(fm(r,l[o]))return!0;for(let o=0;o<r.length;o++)if(dm(l,r[o]))return!0;return!1}function Py(l,r,o){if(l.length>1){if(dm(l,r))return!0;for(let p=0;p<r.length;p++)if(ef(r[p],l,o))return!0}for(let p=0;p<l.length;p++)if(ef(l[p],r,o))return!0;return!1}function dm(l,r){if(l.length===0||r.length===0)return!1;for(let o=0;o<l.length-1;o++){const p=l[o],v=l[o+1];for(let E=0;E<r.length-1;E++)if(My(p,v,r[E],r[E+1]))return!0}return!1}function My(l,r,o,p){return ds(l,o,p)!==ds(r,o,p)&&ds(l,r,o)!==ds(l,r,p)}function ef(l,r,o){const p=o*o;if(r.length===1)return l.distSqr(r[0])<p;for(let v=1;v<r.length;v++)if(Mg(l,r[v-1],r[v])<p)return!0;return!1}function Mg(l,r,o){const p=r.distSqr(o);if(p===0)return l.distSqr(r);const v=((l.x-r.x)*(o.x-r.x)+(l.y-r.y)*(o.y-r.y))/p;return l.distSqr(v<0?r:v>1?o:o.sub(r)._mult(v)._add(r))}function fm(l,r){let o,p,v,E=!1;for(let A=0;A<l.length;A++){o=l[A];for(let P=0,z=o.length-1;P<o.length;z=P++)p=o[P],v=o[z],p.y>r.y!=v.y>r.y&&r.x<(v.x-p.x)*(r.y-p.y)/(v.y-p.y)+p.x&&(E=!E)}return E}function fd(l,r){let o=!1;for(let p=0,v=l.length-1;p<l.length;v=p++){const E=l[p],A=l[v];E.y>r.y!=A.y>r.y&&r.x<(A.x-E.x)*(r.y-E.y)/(A.y-E.y)+E.x&&(o=!o)}return o}function Ry(l,r,o){const p=o[0],v=o[2];if(l.x<p.x&&r.x<p.x||l.x>v.x&&r.x>v.x||l.y<p.y&&r.y<p.y||l.y>v.y&&r.y>v.y)return!1;const E=ds(l,r,o[0]);return E!==ds(l,r,o[1])||E!==ds(l,r,o[2])||E!==ds(l,r,o[3])}function ep(l,r,o){const p=r.paint.get(l).value;return p.kind==="constant"?p.value:o.programConfigurations.get(r.id).getMaxValue(l)}function tp(l){return Math.sqrt(l[0]*l[0]+l[1]*l[1])}function La(l,r,o,p,v){if(!r[0]&&!r[1])return l;const E=C.convert(r)._mult(v);o==="viewport"&&E._rotate(-p);const A=[];for(let P=0;P<l.length;P++)A.push(l[P].sub(E));return A}let zs,Rg;Kt("CircleBucket",hm,{omit:["layers"]});var ky={get paint(){return Rg=Rg||new no({"circle-radius":new yn(qe.paint_circle["circle-radius"]),"circle-color":new yn(qe.paint_circle["circle-color"]),"circle-blur":new yn(qe.paint_circle["circle-blur"]),"circle-opacity":new yn(qe.paint_circle["circle-opacity"]),"circle-translate":new tn(qe.paint_circle["circle-translate"]),"circle-translate-anchor":new tn(qe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new tn(qe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new tn(qe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new yn(qe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new yn(qe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new yn(qe.paint_circle["circle-stroke-opacity"])})},get layout(){return zs=zs||new no({"circle-sort-key":new yn(qe.layout_circle["circle-sort-key"])})}};class Ly extends So{constructor(r){super(r,ky)}createBucket(r){return new hm(r)}queryRadius(r){const o=r;return ep("circle-radius",this,o)+ep("circle-stroke-width",this,o)+tp(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:r,feature:o,featureState:p,geometry:v,transform:E,pixelsToTileUnits:A,unwrappedTileID:P,getElevation:z}){const F=La(r,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-E.bearingInRadians,A),q=this.paint.get("circle-radius").evaluate(o,p)+this.paint.get("circle-stroke-width").evaluate(o,p),H=this.paint.get("circle-pitch-alignment")==="map",J=H?F:(function(re,oe,pe,we){return re.map((He=>kg(He,oe,pe,we)))})(F,E,P,z),ie=H?q*A:q;for(const re of v)for(const oe of re){const pe=H?oe:kg(oe,E,P,z);let we=ie;const He=E.projectTileCoordinates(oe.x,oe.y,P,z).signedDistanceFromCamera;if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?we*=He/E.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(we*=E.cameraToCenterDistance/He),dd(J,pe,we))return!0}return!1}}function kg(l,r,o,p){const v=r.projectTileCoordinates(l.x,l.y,o,p).point;return new C((.5*v.x+.5)*r.width,(.5*-v.y+.5)*r.height)}class Lg extends hm{}let np;Kt("HeatmapBucket",Lg,{omit:["layers"]});var Dg={get paint(){return np=np||new no({"heatmap-radius":new yn(qe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new yn(qe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new tn(qe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new bu(qe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new tn(qe.paint_heatmap["heatmap-opacity"])})}};function pm(l,{width:r,height:o},p,v){if(v){if(v instanceof Uint8ClampedArray)v=new Uint8Array(v.buffer);else if(v.length!==r*o*p)throw new RangeError(`mismatched image size. expected: ${v.length} but got: ${r*o*p}`)}else v=new Uint8Array(r*o*p);return l.width=r,l.height=o,l.data=v,l}function zg(l,{width:r,height:o},p){if(r===l.width&&o===l.height)return;const v=pm({},{width:r,height:o},p);mm(l,v,{x:0,y:0},{x:0,y:0},{width:Math.min(l.width,r),height:Math.min(l.height,o)},p),l.width=r,l.height=o,l.data=v.data}function mm(l,r,o,p,v,E){if(v.width===0||v.height===0)return r;if(v.width>l.width||v.height>l.height||o.x>l.width-v.width||o.y>l.height-v.height)throw new RangeError("out of range source coordinates for image copy");if(v.width>r.width||v.height>r.height||p.x>r.width-v.width||p.y>r.height-v.height)throw new RangeError("out of range destination coordinates for image copy");const A=l.data,P=r.data;if(A===P)throw new Error("srcData equals dstData, so image is already copied");for(let z=0;z<v.height;z++){const F=((o.y+z)*l.width+o.x)*E,q=((p.y+z)*r.width+p.x)*E;for(let H=0;H<v.width*E;H++)P[q+H]=A[F+H]}return r}class pd{constructor(r,o){pm(this,r,1,o)}resize(r){zg(this,r,1)}clone(){return new pd({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,o,p,v,E){mm(r,o,p,v,E,1)}}class ao{constructor(r,o){pm(this,r,4,o)}resize(r){zg(this,r,4)}replace(r,o){o?this.data.set(r):this.data=r instanceof Uint8ClampedArray?new Uint8Array(r.buffer):r}clone(){return new ao({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,o,p,v,E){mm(r,o,p,v,E,4)}setPixel(r,o,p){const v=4*(r*this.width+o);this.data[v+0]=Math.round(255*p.r/p.a),this.data[v+1]=Math.round(255*p.g/p.a),this.data[v+2]=Math.round(255*p.b/p.a),this.data[v+3]=Math.round(255*p.a)}}function gm(l){const r={},o=l.resolution||256,p=l.clips?l.clips.length:1,v=l.image||new ao({width:o,height:p});if(Math.log(o)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${o}`);const E=(A,P,z)=>{r[l.evaluationKey]=z;const F=l.expression.evaluate(r);v.setPixel(A/4/o,P/4,F)};if(l.clips)for(let A=0,P=0;A<p;++A,P+=4*o)for(let z=0,F=0;z<o;z++,F+=4){const q=z/(o-1),{start:H,end:J}=l.clips[A];E(P,F,H*(1-q)+J*q)}else for(let A=0,P=0;A<o;A++,P+=4)E(0,P,A/(o-1));return v}Kt("AlphaImage",pd),Kt("RGBAImage",ao);const _m="big-fb";class Og extends So{createBucket(r){return new Lg(r)}constructor(r){super(r,Dg),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(r){r==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=gm({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(_m)&&this.heatmapFbos.delete(_m)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let ip;var Ng={get paint(){return ip=ip||new no({"hillshade-illumination-direction":new tn(qe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new tn(qe.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new tn(qe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new tn(qe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new tn(qe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new tn(qe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new tn(qe.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new tn(qe.paint_hillshade["hillshade-method"])})}};class Dy extends So{constructor(r){super(r,Ng),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let r=this.paint.get("hillshade-illumination-direction").values,o=this.paint.get("hillshade-illumination-altitude").values,p=this.paint.get("hillshade-highlight-color").values,v=this.paint.get("hillshade-shadow-color").values;const E=Math.max(r.length,o.length,p.length,v.length);r=r.concat(Array(E-r.length).fill(r.at(-1))),o=o.concat(Array(E-o.length).fill(o.at(-1))),p=p.concat(Array(E-p.length).fill(p.at(-1))),v=v.concat(Array(E-v.length).fill(v.at(-1)));const A=o.map(Tl);return{directionRadians:r.map(Tl),altitudeRadians:A,shadowColor:v,highlightColor:p}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}let ym;var zy={get paint(){return ym=ym||new no({"color-relief-opacity":new tn(qe["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new bu(qe["paint_color-relief"]["color-relief-color"])})}};class Cu{constructor(r,o,p,v){this.context=r,this.format=p,this.texture=r.gl.createTexture(),this.update(o,v)}update(r,o,p){const{width:v,height:E}=r,A=!(this.size&&this.size[0]===v&&this.size[1]===E||p),{context:P}=this,{gl:z}=P;if(this.useMipmap=!!(o&&o.useMipmap),z.bindTexture(z.TEXTURE_2D,this.texture),P.pixelStoreUnpackFlipY.set(!1),P.pixelStoreUnpack.set(1),P.pixelStoreUnpackPremultiplyAlpha.set(this.format===z.RGBA&&(!o||o.premultiply!==!1)),A)this.size=[v,E],r instanceof HTMLImageElement||r instanceof HTMLCanvasElement||r instanceof HTMLVideoElement||r instanceof ImageData||Ba(r)?z.texImage2D(z.TEXTURE_2D,0,this.format,this.format,z.UNSIGNED_BYTE,r):z.texImage2D(z.TEXTURE_2D,0,this.format,v,E,0,this.format,z.UNSIGNED_BYTE,r.data);else{const{x:F,y:q}=p||{x:0,y:0};r instanceof HTMLImageElement||r instanceof HTMLCanvasElement||r instanceof HTMLVideoElement||r instanceof ImageData||Ba(r)?z.texSubImage2D(z.TEXTURE_2D,0,F,q,z.RGBA,z.UNSIGNED_BYTE,r):z.texSubImage2D(z.TEXTURE_2D,0,F,q,v,E,z.RGBA,z.UNSIGNED_BYTE,r.data)}this.useMipmap&&this.isSizePowerOfTwo()&&z.generateMipmap(z.TEXTURE_2D),P.pixelStoreUnpackFlipY.setDefault(),P.pixelStoreUnpack.setDefault(),P.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(r,o,p){const{context:v}=this,{gl:E}=v;E.bindTexture(E.TEXTURE_2D,this.texture),p!==E.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(p=E.LINEAR),r!==this.filter&&(E.texParameteri(E.TEXTURE_2D,E.TEXTURE_MAG_FILTER,r),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_MIN_FILTER,p||r),this.filter=r),o!==this.wrap&&(E.texParameteri(E.TEXTURE_2D,E.TEXTURE_WRAP_S,o),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_WRAP_T,o),this.wrap=o)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:r}=this.context;r.deleteTexture(this.texture),this.texture=null}}class vm{constructor(r,o,p,v=1,E=1,A=1,P=0){if(this.uid=r,o.height!==o.width)throw new RangeError("DEM tiles must be square");if(p&&!["mapbox","terrarium","custom"].includes(p))return void er(`"${p}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=o.height;const z=this.dim=o.height-2;switch(this.data=new Uint32Array(o.data.buffer),p){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=v,this.greenFactor=E,this.blueFactor=A,this.baseShift=P;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let F=0;F<z;F++)this.data[this._idx(-1,F)]=this.data[this._idx(0,F)],this.data[this._idx(z,F)]=this.data[this._idx(z-1,F)],this.data[this._idx(F,-1)]=this.data[this._idx(F,0)],this.data[this._idx(F,z)]=this.data[this._idx(F,z-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(z,-1)]=this.data[this._idx(z-1,0)],this.data[this._idx(-1,z)]=this.data[this._idx(0,z-1)],this.data[this._idx(z,z)]=this.data[this._idx(z-1,z-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let F=0;F<z;F++)for(let q=0;q<z;q++){const H=this.get(F,q);H>this.max&&(this.max=H),H<this.min&&(this.min=H)}}get(r,o){const p=new Uint8Array(this.data.buffer),v=4*this._idx(r,o);return this.unpack(p[v],p[v+1],p[v+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(r,o){if(r<-1||r>=this.dim+1||o<-1||o>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(o+1)*this.stride+(r+1)}unpack(r,o,p){return r*this.redFactor+o*this.greenFactor+p*this.blueFactor-this.baseShift}pack(r){return Oy(r,this.getUnpackVector())}getPixels(){return new ao({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(r,o,p){if(this.dim!==r.dim)throw new Error("dem dimension mismatch");let v=o*this.dim,E=o*this.dim+this.dim,A=p*this.dim,P=p*this.dim+this.dim;switch(o){case-1:v=E-1;break;case 1:E=v+1}switch(p){case-1:A=P-1;break;case 1:P=A+1}const z=-o*this.dim,F=-p*this.dim;for(let q=A;q<P;q++)for(let H=v;H<E;H++)this.data[this._idx(H,q)]=r.data[this._idx(H+z,q+F)]}}function Oy(l,r){const o=r[0],p=r[1],v=r[2],E=r[3],A=Math.min(o,p,v),P=Math.round((l+E)/A);return{r:Math.floor(P*A/o)%256,g:Math.floor(P*A/p)%256,b:Math.floor(P*A/v)%256}}Kt("DEMData",vm);class Ny extends So{constructor(r){super(r,zy)}_createColorRamp(r){const o={elevationStops:[],colorStops:[]},p=this._transitionablePaint._values["color-relief-color"].value.expression;if(p instanceof f&&p._styleExpression.expression instanceof ir){this.colorRampExpression=p;const A=p._styleExpression.expression;o.elevationStops=A.labels,o.colorStops=[];for(const P of o.elevationStops)o.colorStops.push(A.evaluate({globals:{elevation:P}}))}if(o.elevationStops.length<1&&(o.elevationStops=[0],o.colorStops=[Mn.transparent]),o.elevationStops.length<2&&(o.elevationStops.push(o.elevationStops[0]+1),o.colorStops.push(o.colorStops[0])),o.elevationStops.length<=r)return o;const v={elevationStops:[],colorStops:[]},E=(o.elevationStops.length-1)/(r-1);for(let A=0;A<o.elevationStops.length-.5;A+=E)v.elevationStops.push(o.elevationStops[Math.round(A)]),v.colorStops.push(o.colorStops[Math.round(A)]);return er(`Too many colors in specification of ${this.id} color-relief layer, may not render properly.`),v}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(r,o,p){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const v=this._createColorRamp(o),E=new ao({width:v.colorStops.length,height:1}),A=new ao({width:v.colorStops.length,height:1});for(let P=0;P<v.elevationStops.length;P++){const z=Oy(v.elevationStops[P],p);A.setPixel(0,P,new Mn(z.r/255,z.g/255,z.b/255,1)),E.setPixel(0,P,v.colorStops[P])}return this.colorRampTextures={elevationTexture:new Cu(r,A,r.gl.RGBA),colorTexture:new Cu(r,E,r.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return this.visibility!=="none"&&!!this.colorRampTextures}}const $c=Qr([{name:"a_pos",components:2,type:"Int16"}],4),{members:By}=$c;function tf(l,r,o){const p=o.patternDependencies;let v=!1;for(const E of r){const A=E.paint.get(`${l}-pattern`);A.isConstant()||(v=!0);const P=A.constantOr(null);P&&(v=!0,p[P.to]=!0,p[P.from]=!0)}return v}function md(l,r,o,p,v){const E=v.patternDependencies;for(const A of r){const P=A.paint.get(`${l}-pattern`).value;if(P.kind!=="constant"){let z=P.evaluate({zoom:p-1},o,{},v.availableImages),F=P.evaluate({zoom:p},o,{},v.availableImages),q=P.evaluate({zoom:p+1},o,{},v.availableImages);z=z&&z.name?z.name:z,F=F&&F.name?F.name:F,q=q&&q.name?q.name:q,E[z]=!0,E[F]=!0,E[q]=!0,o.patterns[A.id]={min:z,mid:F,max:q}}}return o}function ta(l,r,o,p,v){let E;if(v===(function(A,P,z,F){let q=0;for(let H=P,J=z-F;H<z;H+=F)q+=(A[J]-A[H])*(A[H+1]+A[J+1]),J=H;return q})(l,r,o,p)>0)for(let A=r;A<o;A+=p)E=jy(A/p|0,l[A],l[A+1],E);else for(let A=o-p;A>=r;A-=p)E=jy(A/p|0,l[A],l[A+1],E);return E&&yd(E,E.next)&&(af(E),E=E.next),E}function gd(l,r){if(!l)return l;r||(r=l);let o,p=l;do if(o=!1,p.steiner||!yd(p,p.next)&&Ur(p.prev,p,p.next)!==0)p=p.next;else{if(af(p),p=r=p.prev,p===p.next)break;o=!0}while(o||p!==r);return r}function rp(l,r,o,p,v,E,A){if(!l)return;!A&&E&&(function(z,F,q,H){let J=z;do J.z===0&&(J.z=bm(J.x,J.y,F,q,H)),J.prevZ=J.prev,J.nextZ=J.next,J=J.next;while(J!==z);J.prevZ.nextZ=null,J.prevZ=null,(function(ie){let re,oe=1;do{let pe,we=ie;ie=null;let He=null;for(re=0;we;){re++;let Re=we,Fe=0;for(let _t=0;_t<oe&&(Fe++,Re=Re.nextZ,Re);_t++);let ot=oe;for(;Fe>0||ot>0&&Re;)Fe!==0&&(ot===0||!Re||we.z<=Re.z)?(pe=we,we=we.nextZ,Fe--):(pe=Re,Re=Re.nextZ,ot--),He?He.nextZ=pe:ie=pe,pe.prevZ=He,He=pe;we=Re}He.nextZ=null,oe*=2}while(re>1)})(J)})(l,p,v,E);let P=l;for(;l.prev!==l.next;){const z=l.prev,F=l.next;if(E?ap(l,p,v,E):Fy(l))r.push(z.i,l.i,F.i),af(l),l=F.next,P=F.next;else if((l=F)===P){A?A===1?rp(l=Ah(gd(l),r),r,o,p,v,E,2):A===2&&Vy(l,r,o,p,v,E):rp(gd(l),r,o,p,v,E,1);break}}}function Fy(l){const r=l.prev,o=l,p=l.next;if(Ur(r,o,p)>=0)return!1;const v=r.x,E=o.x,A=p.x,P=r.y,z=o.y,F=p.y,q=Math.min(v,E,A),H=Math.min(P,z,F),J=Math.max(v,E,A),ie=Math.max(P,z,F);let re=p.next;for(;re!==r;){if(re.x>=q&&re.x<=J&&re.y>=H&&re.y<=ie&&_d(v,P,E,z,A,F,re.x,re.y)&&Ur(re.prev,re,re.next)>=0)return!1;re=re.next}return!0}function ap(l,r,o,p){const v=l.prev,E=l,A=l.next;if(Ur(v,E,A)>=0)return!1;const P=v.x,z=E.x,F=A.x,q=v.y,H=E.y,J=A.y,ie=Math.min(P,z,F),re=Math.min(q,H,J),oe=Math.max(P,z,F),pe=Math.max(q,H,J),we=bm(ie,re,r,o,p),He=bm(oe,pe,r,o,p);let Re=l.prevZ,Fe=l.nextZ;for(;Re&&Re.z>=we&&Fe&&Fe.z<=He;){if(Re.x>=ie&&Re.x<=oe&&Re.y>=re&&Re.y<=pe&&Re!==v&&Re!==A&&_d(P,q,z,H,F,J,Re.x,Re.y)&&Ur(Re.prev,Re,Re.next)>=0||(Re=Re.prevZ,Fe.x>=ie&&Fe.x<=oe&&Fe.y>=re&&Fe.y<=pe&&Fe!==v&&Fe!==A&&_d(P,q,z,H,F,J,Fe.x,Fe.y)&&Ur(Fe.prev,Fe,Fe.next)>=0))return!1;Fe=Fe.nextZ}for(;Re&&Re.z>=we;){if(Re.x>=ie&&Re.x<=oe&&Re.y>=re&&Re.y<=pe&&Re!==v&&Re!==A&&_d(P,q,z,H,F,J,Re.x,Re.y)&&Ur(Re.prev,Re,Re.next)>=0)return!1;Re=Re.prevZ}for(;Fe&&Fe.z<=He;){if(Fe.x>=ie&&Fe.x<=oe&&Fe.y>=re&&Fe.y<=pe&&Fe!==v&&Fe!==A&&_d(P,q,z,H,F,J,Fe.x,Fe.y)&&Ur(Fe.prev,Fe,Fe.next)>=0)return!1;Fe=Fe.nextZ}return!0}function Ah(l,r){let o=l;do{const p=o.prev,v=o.next.next;!yd(p,v)&&lc(p,o,o.next,v)&&rf(p,v)&&rf(v,p)&&(r.push(p.i,o.i,v.i),af(o),af(o.next),o=l=v),o=o.next}while(o!==l);return gd(o)}function Vy(l,r,o,p,v,E){let A=l;do{let P=A.next.next;for(;P!==A.prev;){if(A.i!==P.i&&Vg(A,P)){let z=as(A,P);return A=gd(A,A.next),z=gd(z,z.next),rp(A,r,o,p,v,E,0),void rp(z,r,o,p,v,E,0)}P=P.next}A=A.next}while(A!==l)}function Uy(l,r){let o=l.x-r.x;return o===0&&(o=l.y-r.y,o===0)&&(o=(l.next.y-l.y)/(l.next.x-l.x)-(r.next.y-r.y)/(r.next.x-r.x)),o}function sp(l,r){const o=(function(v,E){let A=E;const P=v.x,z=v.y;let F,q=-1/0;if(yd(v,A))return A;do{if(yd(v,A.next))return A.next;if(z<=A.y&&z>=A.next.y&&A.next.y!==A.y){const oe=A.x+(z-A.y)*(A.next.x-A.x)/(A.next.y-A.y);if(oe<=P&&oe>q&&(q=oe,F=A.x<A.next.x?A:A.next,oe===P))return F}A=A.next}while(A!==E);if(!F)return null;const H=F,J=F.x,ie=F.y;let re=1/0;A=F;do{if(P>=A.x&&A.x>=J&&P!==A.x&&Fg(z<ie?P:q,z,J,ie,z<ie?q:P,z,A.x,A.y)){const oe=Math.abs(z-A.y)/(P-A.x);rf(A,v)&&(oe<re||oe===re&&(A.x>F.x||A.x===F.x&&oc(F,A)))&&(F=A,re=oe)}A=A.next}while(A!==H);return F})(l,r);if(!o)return r;const p=as(o,l);return gd(p,p.next),gd(o,o.next)}function oc(l,r){return Ur(l.prev,l,r.prev)<0&&Ur(r.next,l,l.next)<0}function bm(l,r,o,p,v){return(l=1431655765&((l=858993459&((l=252645135&((l=16711935&((l=(l-o)*v|0)|l<<8))|l<<4))|l<<2))|l<<1))|(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-p)*v|0)|r<<8))|r<<4))|r<<2))|r<<1))<<1}function Bg(l){let r=l,o=l;do(r.x<o.x||r.x===o.x&&r.y<o.y)&&(o=r),r=r.next;while(r!==l);return o}function Fg(l,r,o,p,v,E,A,P){return(v-A)*(r-P)>=(l-A)*(E-P)&&(l-A)*(p-P)>=(o-A)*(r-P)&&(o-A)*(E-P)>=(v-A)*(p-P)}function _d(l,r,o,p,v,E,A,P){return!(l===A&&r===P)&&Fg(l,r,o,p,v,E,A,P)}function Vg(l,r){return l.next.i!==r.i&&l.prev.i!==r.i&&!(function(o,p){let v=o;do{if(v.i!==o.i&&v.next.i!==o.i&&v.i!==p.i&&v.next.i!==p.i&&lc(v,v.next,o,p))return!0;v=v.next}while(v!==o);return!1})(l,r)&&(rf(l,r)&&rf(r,l)&&(function(o,p){let v=o,E=!1;const A=(o.x+p.x)/2,P=(o.y+p.y)/2;do v.y>P!=v.next.y>P&&v.next.y!==v.y&&A<(v.next.x-v.x)*(P-v.y)/(v.next.y-v.y)+v.x&&(E=!E),v=v.next;while(v!==o);return E})(l,r)&&(Ur(l.prev,l,r.prev)||Ur(l,r.prev,r))||yd(l,r)&&Ur(l.prev,l,l.next)>0&&Ur(r.prev,r,r.next)>0)}function Ur(l,r,o){return(r.y-l.y)*(o.x-r.x)-(r.x-l.x)*(o.y-r.y)}function yd(l,r){return l.x===r.x&&l.y===r.y}function lc(l,r,o,p){const v=nf(Ur(l,r,o)),E=nf(Ur(l,r,p)),A=nf(Ur(o,p,l)),P=nf(Ur(o,p,r));return v!==E&&A!==P||!(v!==0||!na(l,o,r))||!(E!==0||!na(l,p,r))||!(A!==0||!na(o,l,p))||!(P!==0||!na(o,r,p))}function na(l,r,o){return r.x<=Math.max(l.x,o.x)&&r.x>=Math.min(l.x,o.x)&&r.y<=Math.max(l.y,o.y)&&r.y>=Math.min(l.y,o.y)}function nf(l){return l>0?1:l<0?-1:0}function rf(l,r){return Ur(l.prev,l,l.next)<0?Ur(l,r,l.next)>=0&&Ur(l,l.prev,r)>=0:Ur(l,r,l.prev)<0||Ur(l,l.next,r)<0}function as(l,r){const o=xm(l.i,l.x,l.y),p=xm(r.i,r.x,r.y),v=l.next,E=r.prev;return l.next=r,r.prev=l,o.next=v,v.prev=o,p.next=o,o.prev=p,E.next=p,p.prev=E,p}function jy(l,r,o,p){const v=xm(l,r,o);return p?(v.next=p.next,v.prev=p,p.next.prev=v,p.next=v):(v.prev=v,v.next=v),v}function af(l){l.next.prev=l.prev,l.prev.next=l.next,l.prevZ&&(l.prevZ.nextZ=l.nextZ),l.nextZ&&(l.nextZ.prevZ=l.prevZ)}function xm(l,r,o){return{i:l,x:r,y:o,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class hr{constructor(r,o){if(o>r)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=r,this._minGranularity=o}getGranularityForZoomLevel(r){return Math.max(Math.floor(this._baseZoomGranularity/(1<<r)),this._minGranularity,1)}}class so{constructor(r){this.fill=r.fill,this.line=r.line,this.tile=r.tile,this.stencil=r.stencil,this.circle=r.circle}}so.noSubdivision=new so({fill:new hr(0,0),line:new hr(0,0),tile:new hr(0,0),stencil:new hr(0,0),circle:1}),Kt("SubdivisionGranularityExpression",hr),Kt("SubdivisionGranularitySetting",so);const dl=-32768,sf=32767;class qy{constructor(r,o){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=r,this._granularityCellSize=jt/r,this._canonical=o}_getKey(r,o){return(r+=32768)<<16|o+32768}_vertexToIndex(r,o){if(r<-32768||o<-32768||r>32767||o>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const p=0|Math.round(r),v=0|Math.round(o),E=this._getKey(p,v);if(this._vertexDictionary.has(E))return this._vertexDictionary.get(E);const A=this._vertexBuffer.length/2;return this._vertexDictionary.set(E,A),this._vertexBuffer.push(p,v),A}_subdivideTrianglesScanline(r){if(this._granularity<2)return(function(v,E){const A=[];for(let P=0;P<E.length;P+=3){const z=E[P],F=E[P+1],q=E[P+2],H=v[2*z],J=v[2*z+1];(v[2*F]-H)*(v[2*q+1]-J)-(v[2*F+1]-J)*(v[2*q]-H)>0?(A.push(z),A.push(q),A.push(F)):(A.push(z),A.push(F),A.push(q))}return A})(this._vertexBuffer,r);const o=[],p=r.length;for(let v=0;v<p;v+=3){const E=[r[v+0],r[v+1],r[v+2]],A=[this._vertexBuffer[2*r[v+0]+0],this._vertexBuffer[2*r[v+0]+1],this._vertexBuffer[2*r[v+1]+0],this._vertexBuffer[2*r[v+1]+1],this._vertexBuffer[2*r[v+2]+0],this._vertexBuffer[2*r[v+2]+1]];let P=1/0,z=1/0,F=-1/0,q=-1/0;for(let oe=0;oe<3;oe++){const pe=A[2*oe],we=A[2*oe+1];P=Math.min(P,pe),F=Math.max(F,pe),z=Math.min(z,we),q=Math.max(q,we)}if(P===F||z===q)continue;const H=Math.floor(P/this._granularityCellSize),J=Math.ceil(F/this._granularityCellSize),ie=Math.floor(z/this._granularityCellSize),re=Math.ceil(q/this._granularityCellSize);if(H!==J||ie!==re)for(let oe=ie;oe<re;oe++){const pe=this._scanlineGenerateVertexRingForCellRow(oe,A,E);Fl(this._vertexBuffer,pe,o)}else o.push(...E)}return o}_scanlineGenerateVertexRingForCellRow(r,o,p){const v=r*this._granularityCellSize,E=v+this._granularityCellSize,A=[];for(let P=0;P<3;P++){const z=o[2*P],F=o[2*P+1],q=o[2*(P+1)%6],H=o[(2*(P+1)+1)%6],J=o[2*(P+2)%6],ie=o[(2*(P+2)+1)%6],re=q-z,oe=H-F,pe=re===0,we=oe===0,He=(v-F)/oe,Re=(E-F)/oe,Fe=Math.min(He,Re),ot=Math.max(He,Re);if(!we&&(Fe>=1||ot<=0)||we&&(F<v||F>E)){H>=v&&H<=E&&A.push(p[(P+1)%3]);continue}!we&&Fe>0&&A.push(this._vertexToIndex(z+re*Fe,F+oe*Fe));const _t=z+re*Math.max(Fe,0),It=z+re*Math.min(ot,1);pe||this._generateIntraEdgeVertices(A,z,F,q,H,_t,It),!we&&ot<1&&A.push(this._vertexToIndex(z+re*ot,F+oe*ot)),(we||H>=v&&H<=E)&&A.push(p[(P+1)%3]),!we&&(H<=v||H>=E)&&this._generateInterEdgeVertices(A,z,F,q,H,J,ie,It,v,E)}return A}_generateIntraEdgeVertices(r,o,p,v,E,A,P){const z=v-o,F=E-p,q=F===0,H=q?Math.min(o,v):Math.min(A,P),J=q?Math.max(o,v):Math.max(A,P),ie=Math.floor(H/this._granularityCellSize)+1,re=Math.ceil(J/this._granularityCellSize)-1;if(q?o<v:A<P)for(let oe=ie;oe<=re;oe++){const pe=oe*this._granularityCellSize;r.push(this._vertexToIndex(pe,p+F*(pe-o)/z))}else for(let oe=re;oe>=ie;oe--){const pe=oe*this._granularityCellSize;r.push(this._vertexToIndex(pe,p+F*(pe-o)/z))}}_generateInterEdgeVertices(r,o,p,v,E,A,P,z,F,q){const H=E-p,J=A-v,ie=P-E,re=(F-E)/ie,oe=(q-E)/ie,pe=Math.min(re,oe),we=Math.max(re,oe),He=v+J*pe;let Re=Math.floor(Math.min(He,z)/this._granularityCellSize)+1,Fe=Math.ceil(Math.max(He,z)/this._granularityCellSize)-1,ot=z<He;const _t=ie===0;if(_t&&(P===F||P===q))return;if(_t||pe>=1||we<=0){const $t=p-P,Nt=A+(o-A)*Math.min((F-P)/$t,(q-P)/$t);Re=Math.floor(Math.min(Nt,z)/this._granularityCellSize)+1,Fe=Math.ceil(Math.max(Nt,z)/this._granularityCellSize)-1,ot=z<Nt}const It=H>0?q:F;if(ot)for(let $t=Re;$t<=Fe;$t++)r.push(this._vertexToIndex($t*this._granularityCellSize,It));else for(let $t=Fe;$t>=Re;$t--)r.push(this._vertexToIndex($t*this._granularityCellSize,It))}_generateOutline(r){const o=[];for(const p of r){const v=Gc(p,this._granularity,!0),E=this._pointArrayToIndices(v),A=[];for(let P=1;P<E.length;P++)A.push(E[P-1]),A.push(E[P]);o.push(A)}return o}_handlePoles(r){let o=!1,p=!1;this._canonical&&(this._canonical.y===0&&(o=!0),this._canonical.y===(1<<this._canonical.z)-1&&(p=!0)),(o||p)&&this._fillPoles(r,o,p)}_ensureNoPoleVertices(){const r=this._vertexBuffer;for(let o=0;o<r.length;o+=2){const p=r[o+1];p===dl&&(r[o+1]=-32767),p===sf&&(r[o+1]=32766)}}_generatePoleQuad(r,o,p,v,E,A){v>E!=(A===dl)?(r.push(o),r.push(p),r.push(this._vertexToIndex(v,A)),r.push(p),r.push(this._vertexToIndex(E,A)),r.push(this._vertexToIndex(v,A))):(r.push(p),r.push(o),r.push(this._vertexToIndex(v,A)),r.push(this._vertexToIndex(E,A)),r.push(p),r.push(this._vertexToIndex(v,A)))}_fillPoles(r,o,p){const v=this._vertexBuffer,E=jt,A=r.length;for(let P=2;P<A;P+=3){const z=r[P-2],F=r[P-1],q=r[P],H=v[2*z],J=v[2*z+1],ie=v[2*F],re=v[2*F+1],oe=v[2*q],pe=v[2*q+1];o&&(J===0&&re===0&&this._generatePoleQuad(r,z,F,H,ie,dl),re===0&&pe===0&&this._generatePoleQuad(r,F,q,ie,oe,dl),pe===0&&J===0&&this._generatePoleQuad(r,q,z,oe,H,dl)),p&&(J===E&&re===E&&this._generatePoleQuad(r,z,F,H,ie,sf),re===E&&pe===E&&this._generatePoleQuad(r,F,q,ie,oe,sf),pe===E&&J===E&&this._generatePoleQuad(r,q,z,oe,H,sf))}}_initializeVertices(r){for(let o=0;o<r.length;o+=2)this._vertexToIndex(r[o],r[o+1])}subdividePolygonInternal(r,o){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:p,holeIndices:v}=(function(P){const z=[],F=[];for(const q of P)if(q.length!==0){q!==P[0]&&z.push(F.length/2);for(let H=0;H<q.length;H++)F.push(q[H].x),F.push(q[H].y)}return{flattened:F,holeIndices:z}})(r);let E;this._initializeVertices(p);try{const P=(function(F,q,H=2){const J=q&&q.length,ie=J?q[0]*H:F.length;let re=ta(F,0,ie,H,!0);const oe=[];if(!re||re.next===re.prev)return oe;let pe,we,He;if(J&&(re=(function(Re,Fe,ot,_t){const It=[];for(let $t=0,Nt=Fe.length;$t<Nt;$t++){const Ut=ta(Re,Fe[$t]*_t,$t<Nt-1?Fe[$t+1]*_t:Re.length,_t,!1);Ut===Ut.next&&(Ut.steiner=!0),It.push(Bg(Ut))}It.sort(Uy);for(let $t=0;$t<It.length;$t++)ot=sp(It[$t],ot);return ot})(F,q,re,H)),F.length>80*H){pe=F[0],we=F[1];let Re=pe,Fe=we;for(let ot=H;ot<ie;ot+=H){const _t=F[ot],It=F[ot+1];_t<pe&&(pe=_t),It<we&&(we=It),_t>Re&&(Re=_t),It>Fe&&(Fe=It)}He=Math.max(Re-pe,Fe-we),He=He!==0?32767/He:0}return rp(re,oe,H,pe,we,He,0),oe})(p,v),z=this._convertIndices(p,P);E=this._subdivideTrianglesScanline(z)}catch(P){console.error(P)}let A=[];return o&&(A=this._generateOutline(r)),this._ensureNoPoleVertices(),this._handlePoles(E),{verticesFlattened:this._vertexBuffer,indicesTriangles:E,indicesLineList:A}}_convertIndices(r,o){const p=[];for(let v=0;v<o.length;v++)p.push(this._vertexToIndex(r[2*o[v]],r[2*o[v]+1]));return p}_pointArrayToIndices(r){const o=[];for(let p=0;p<r.length;p++){const v=r[p];o.push(this._vertexToIndex(v.x,v.y))}return o}}function $y(l,r,o,p=!0){return new qy(o,r).subdividePolygonInternal(l,p)}function Gc(l,r,o=!1){if(!l||l.length<1)return[];if(l.length<2)return[];const p=l[0],v=l[l.length-1],E=o&&(p.x!==v.x||p.y!==v.y);if(r<2)return E?[...l,l[0]]:[...l];const A=Math.floor(jt/r),P=[];P.push(new C(l[0].x,l[0].y));const z=l.length,F=E?z:z-1;for(let q=0;q<F;q++){const H=l[q],J=q<z-1?l[q+1]:l[0],ie=H.x,re=H.y,oe=J.x,pe=J.y,we=ie!==oe,He=re!==pe;if(!we&&!He)continue;const Re=oe-ie,Fe=pe-re,ot=Math.abs(Re),_t=Math.abs(Fe);let It=ie,$t=re;for(;;){const Ut=Re>0?(Math.floor(It/A)+1)*A:(Math.ceil(It/A)-1)*A,hn=Fe>0?(Math.floor($t/A)+1)*A:(Math.ceil($t/A)-1)*A,Gt=Math.abs(It-Ut),qt=Math.abs($t-hn),wt=Math.abs(It-oe),En=Math.abs($t-pe),Ln=we?Gt/ot:Number.POSITIVE_INFINITY,xn=He?qt/_t:Number.POSITIVE_INFINITY;if((wt<=Gt||!we)&&(En<=qt||!He))break;if(Ln<xn&&we||!He){It=Ut,$t+=Fe*Ln;const ln=new C(It,Math.round($t));P[P.length-1].x===ln.x&&P[P.length-1].y===ln.y||P.push(ln)}else{It+=Re*xn,$t=hn;const ln=new C(Math.round(It),$t);P[P.length-1].x===ln.x&&P[P.length-1].y===ln.y||P.push(ln)}}const Nt=new C(oe,pe);P[P.length-1].x===Nt.x&&P[P.length-1].y===Nt.y||P.push(Nt)}return P}function Fl(l,r,o){if(r.length===0)throw new Error("Subdivision vertex ring is empty.");let p=0,v=l[2*r[0]];for(let z=1;z<r.length;z++){const F=l[2*r[z]];F<v&&(v=F,p=z)}const E=r.length;let A=p,P=(A+1)%E;for(;;){const z=A-1>=0?A-1:E-1,F=(P+1)%E,q=l[2*r[z]],H=l[2*r[F]],J=l[2*r[A]],ie=l[2*r[A]+1],re=l[2*r[P]+1];let oe=!1;if(q<H)oe=!0;else if(q>H)oe=!1;else{const pe=re-ie,we=-(l[2*r[P]]-J),He=ie<re?1:-1;((q-J)*pe+(l[2*r[z]+1]-ie)*we)*He>((H-J)*pe+(l[2*r[F]+1]-ie)*we)*He&&(oe=!0)}if(oe){const pe=r[z],we=r[A],He=r[P];pe!==we&&pe!==He&&we!==He&&o.push(He,we,pe),A--,A<0&&(A=E-1)}else{const pe=r[F],we=r[A],He=r[P];pe!==we&&pe!==He&&we!==He&&o.push(He,we,pe),P++,P>=E&&(P=0)}if(z===F)break}}function au(l,r,o,p,v,E,A,P,z){const F=v.length/2,q=A&&P&&z;if(F<Hn.MAX_VERTEX_ARRAY_LENGTH){const H=r.prepareSegment(F,o,p),J=H.vertexLength;for(let oe=0;oe<E.length;oe+=3)p.emplaceBack(J+E[oe],J+E[oe+1],J+E[oe+2]);let ie,re;H.vertexLength+=F,H.primitiveLength+=E.length/3,q&&(re=A.prepareSegment(F,o,P),ie=re.vertexLength,re.vertexLength+=F);for(let oe=0;oe<v.length;oe+=2)l(v[oe],v[oe+1]);if(q)for(let oe=0;oe<z.length;oe++){const pe=z[oe];for(let we=1;we<pe.length;we+=2)P.emplaceBack(ie+pe[we-1],ie+pe[we]);re.primitiveLength+=pe.length/2}}else(function(H,J,ie,re,oe,pe){const we=[];for(let _t=0;_t<re.length/2;_t++)we.push(-1);const He={count:0};let Re=0,Fe=H.getOrCreateLatestSegment(J,ie),ot=Fe.vertexLength;for(let _t=2;_t<oe.length;_t+=3){const It=oe[_t-2],$t=oe[_t-1],Nt=oe[_t];let Ut=we[It]<Re,hn=we[$t]<Re,Gt=we[Nt]<Re;Fe.vertexLength+((Ut?1:0)+(hn?1:0)+(Gt?1:0))>Hn.MAX_VERTEX_ARRAY_LENGTH&&(Fe=H.createNewSegment(J,ie),Re=He.count,Ut=!0,hn=!0,Gt=!0,ot=0);const qt=of(we,re,pe,He,It,Ut,Fe),wt=of(we,re,pe,He,$t,hn,Fe),En=of(we,re,pe,He,Nt,Gt,Fe);ie.emplaceBack(ot+qt-Re,ot+wt-Re,ot+En-Re),Fe.primitiveLength++}})(r,o,p,v,E,l),q&&(function(H,J,ie,re,oe,pe){const we=[];for(let _t=0;_t<re.length/2;_t++)we.push(-1);const He={count:0};let Re=0,Fe=H.getOrCreateLatestSegment(J,ie),ot=Fe.vertexLength;for(let _t=0;_t<oe.length;_t++){const It=oe[_t];for(let $t=1;$t<oe[_t].length;$t+=2){const Nt=It[$t-1],Ut=It[$t];let hn=we[Nt]<Re,Gt=we[Ut]<Re;Fe.vertexLength+((hn?1:0)+(Gt?1:0))>Hn.MAX_VERTEX_ARRAY_LENGTH&&(Fe=H.createNewSegment(J,ie),Re=He.count,hn=!0,Gt=!0,ot=0);const qt=of(we,re,pe,He,Nt,hn,Fe),wt=of(we,re,pe,He,Ut,Gt,Fe);ie.emplaceBack(ot+qt-Re,ot+wt-Re),Fe.primitiveLength++}}})(A,o,P,v,z,l),r.forceNewSegmentOnNextPrepare(),A==null||A.forceNewSegmentOnNextPrepare()}function of(l,r,o,p,v,E,A){if(E){const P=p.count;return o(r[2*v],r[2*v+1]),l[v]=p.count,p.count++,A.vertexLength++,P}return l[v]}class No{constructor(r){this.zoom=r.zoom,this.globalState=r.globalState,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map((o=>o.id)),this.index=r.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new dt,this.indexArray=new qi,this.indexArray2=new Ni,this.programConfigurations=new ea(r.layers,r.zoom),this.segments=new Hn,this.segments2=new Hn,this.stateDependentLayerIds=this.layers.filter((o=>o.isStateDependent())).map((o=>o.id))}populate(r,o,p){this.hasPattern=tf("fill",this.layers,o);const v=this.layers[0].layout.get("fill-sort-key"),E=!v.isConstant(),A=[];for(const{feature:P,id:z,index:F,sourceLayerIndex:q}of r){const H=this.layers[0]._featureFilter.needGeometry,J=hl(P,H);if(!this.layers[0]._featureFilter.filter(new rr(this.zoom,{globalState:this.globalState}),J,p))continue;const ie=E?v.evaluate(J,{},p,o.availableImages):void 0,re={id:z,properties:P.properties,type:P.type,sourceLayerIndex:q,index:F,geometry:H?J.geometry:yr(P),patterns:{},sortKey:ie};A.push(re)}E&&A.sort(((P,z)=>P.sortKey-z.sortKey));for(const P of A){const{geometry:z,index:F,sourceLayerIndex:q}=P;if(this.hasPattern){const H=md("fill",this.layers,P,this.zoom,o);this.patternFeatures.push(H)}else this.addFeature(P,z,F,p,{},o.subdivisionGranularity);o.featureIndex.insert(r[F].feature,z,F,q,this.index)}}update(r,o,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,o,this.stateDependentLayers,p)}addFeatures(r,o,p){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,o,p,r.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,By),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.indexBuffer2=r.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(r,o,p,v,E,A){for(const P of qu(o,500)){const z=$y(P,v,A.fill.getGranularityForZoomLevel(v.z)),F=this.layoutVertexArray;au(((q,H)=>{F.emplaceBack(q,H)}),this.segments,this.layoutVertexArray,this.indexArray,z.verticesFlattened,z.indicesTriangles,this.segments2,this.indexArray2,z.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,p,E,v)}}let Ug,Zc;Kt("FillBucket",No,{omit:["layers","patternFeatures"]});var vd={get paint(){return Zc=Zc||new no({"fill-antialias":new tn(qe.paint_fill["fill-antialias"]),"fill-opacity":new yn(qe.paint_fill["fill-opacity"]),"fill-color":new yn(qe.paint_fill["fill-color"]),"fill-outline-color":new yn(qe.paint_fill["fill-outline-color"]),"fill-translate":new tn(qe.paint_fill["fill-translate"]),"fill-translate-anchor":new tn(qe.paint_fill["fill-translate-anchor"]),"fill-pattern":new Uc(qe.paint_fill["fill-pattern"])})},get layout(){return Ug=Ug||new no({"fill-sort-key":new yn(qe.layout_fill["fill-sort-key"])})}};class Ih extends So{constructor(r){super(r,vd)}recalculate(r,o){super.recalculate(r,o);const p=this.paint._values["fill-outline-color"];p.value.kind==="constant"&&p.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(r){return new No(r)}queryRadius(){return tp(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:r,geometry:o,transform:p,pixelsToTileUnits:v}){return Jf(La(r,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-p.bearingInRadians,v),o)}isTileClipped(){return!0}}const jg=Qr([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),qg=Qr([{name:"a_centroid",components:2,type:"Int16"}],4),{members:uc}=jg;class bd{constructor(r,o,p,v,E){this.properties={},this.extent=p,this.type=0,this.id=void 0,this._pbf=r,this._geometry=-1,this._keys=v,this._values=E,r.readFields(lf,this,o)}loadGeometry(){const r=this._pbf;r.pos=this._geometry;const o=r.readVarint()+r.pos,p=[];let v,E=1,A=0,P=0,z=0;for(;r.pos<o;){if(A<=0){const F=r.readVarint();E=7&F,A=F>>3}if(A--,E===1||E===2)P+=r.readSVarint(),z+=r.readSVarint(),E===1&&(v&&p.push(v),v=[]),v&&v.push(new C(P,z));else{if(E!==7)throw new Error(`unknown command ${E}`);v&&v.push(v[0].clone())}}return v&&p.push(v),p}bbox(){const r=this._pbf;r.pos=this._geometry;const o=r.readVarint()+r.pos;let p=1,v=0,E=0,A=0,P=1/0,z=-1/0,F=1/0,q=-1/0;for(;r.pos<o;){if(v<=0){const H=r.readVarint();p=7&H,v=H>>3}if(v--,p===1||p===2)E+=r.readSVarint(),A+=r.readSVarint(),E<P&&(P=E),E>z&&(z=E),A<F&&(F=A),A>q&&(q=A);else if(p!==7)throw new Error(`unknown command ${p}`)}return[P,F,z,q]}toGeoJSON(r,o,p){const v=this.extent*Math.pow(2,p),E=this.extent*r,A=this.extent*o,P=this.loadGeometry();function z(J){return[360*(J.x+E)/v-180,360/Math.PI*Math.atan(Math.exp((1-2*(J.y+A)/v)*Math.PI))-90]}function F(J){return J.map(z)}let q;if(this.type===1){const J=[];for(const re of P)J.push(re[0]);const ie=F(J);q=J.length===1?{type:"Point",coordinates:ie[0]}:{type:"MultiPoint",coordinates:ie}}else if(this.type===2){const J=P.map(F);q=J.length===1?{type:"LineString",coordinates:J[0]}:{type:"MultiLineString",coordinates:J}}else{if(this.type!==3)throw new Error("unknown feature type");{const J=(function(re){const oe=re.length;if(oe<=1)return[re];const pe=[];let we,He;for(let Re=0;Re<oe;Re++){const Fe=op(re[Re]);Fe!==0&&(He===void 0&&(He=Fe<0),He===Fe<0?(we&&pe.push(we),we=[re[Re]]):we&&we.push(re[Re]))}return we&&pe.push(we),pe})(P),ie=[];for(const re of J)ie.push(re.map(F));q=ie.length===1?{type:"Polygon",coordinates:ie[0]}:{type:"MultiPolygon",coordinates:ie}}}const H={type:"Feature",geometry:q,properties:this.properties};return this.id!=null&&(H.id=this.id),H}}function lf(l,r,o){l===1?r.id=o.readVarint():l===2?(function(p,v){const E=p.readVarint()+p.pos;for(;p.pos<E;){const A=v._keys[p.readVarint()],P=v._values[p.readVarint()];v.properties[A]=P}})(o,r):l===3?r.type=o.readVarint():l===4&&(r._geometry=o.pos)}function op(l){let r=0;for(let o,p,v=0,E=l.length,A=E-1;v<E;A=v++)o=l[v],p=l[A],r+=(p.x-o.x)*(o.y+p.y);return r}bd.types=["Unknown","Point","LineString","Polygon"];class uf{constructor(r,o){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=r,this._keys=[],this._values=[],this._features=[],r.readFields(cf,this,o),this.length=this._features.length}feature(r){if(r<0||r>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[r];const o=this._pbf.readVarint()+this._pbf.pos;return new bd(this._pbf,o,this.extent,this._keys,this._values)}}function cf(l,r,o){l===15?r.version=o.readVarint():l===1?r.name=o.readString():l===5?r.extent=o.readVarint():l===2?r._features.push(o.pos):l===3?r._keys.push(o.readString()):l===4&&r._values.push((function(p){let v=null;const E=p.readVarint()+p.pos;for(;p.pos<E;){const A=p.readVarint()>>3;v=A===1?p.readString():A===2?p.readFloat():A===3?p.readDouble():A===4?p.readVarint64():A===5?p.readVarint():A===6?p.readSVarint():A===7?p.readBoolean():null}if(v==null)throw new Error("unknown feature value");return v})(o))}class $g{constructor(r,o){this.layers=r.readFields(Gy,{},o)}}function Gy(l,r,o){if(l===3){const p=new uf(o,o.readVarint()+o.pos);p.length&&(r[p.name]=p)}}const xd=Math.pow(2,13);function hf(l,r,o,p,v,E,A,P){l.emplaceBack(r,o,2*Math.floor(p*xd)+A,v*xd*2,E*xd*2,Math.round(P))}class df{constructor(r){this.zoom=r.zoom,this.globalState=r.globalState,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map((o=>o.id)),this.index=r.index,this.hasPattern=!1,this.layoutVertexArray=new rt,this.centroidVertexArray=new Ce,this.indexArray=new qi,this.programConfigurations=new ea(r.layers,r.zoom),this.segments=new Hn,this.stateDependentLayerIds=this.layers.filter((o=>o.isStateDependent())).map((o=>o.id))}populate(r,o,p){this.features=[],this.hasPattern=tf("fill-extrusion",this.layers,o);for(const{feature:v,id:E,index:A,sourceLayerIndex:P}of r){const z=this.layers[0]._featureFilter.needGeometry,F=hl(v,z);if(!this.layers[0]._featureFilter.filter(new rr(this.zoom,{globalState:this.globalState}),F,p))continue;const q={id:E,sourceLayerIndex:P,index:A,geometry:z?F.geometry:yr(v),properties:v.properties,type:v.type,patterns:{}};this.hasPattern?this.features.push(md("fill-extrusion",this.layers,q,this.zoom,o)):this.addFeature(q,q.geometry,A,p,{},o.subdivisionGranularity),o.featureIndex.insert(v,q.geometry,A,P,this.index,!0)}}addFeatures(r,o,p){for(const v of this.features){const{geometry:E}=v;this.addFeature(v,E,v.index,o,p,r.subdivisionGranularity)}}update(r,o,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,o,this.stateDependentLayers,p)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,uc),this.centroidVertexBuffer=r.createVertexBuffer(this.centroidVertexArray,qg.members,!0),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(r,o,p,v,E,A){for(const P of qu(o,500)){const z={x:0,y:0,sampleCount:0},F=this.layoutVertexArray.length;this.processPolygon(z,v,r,P,A);const q=this.layoutVertexArray.length-F,H=Math.floor(z.x/z.sampleCount),J=Math.floor(z.y/z.sampleCount);for(let ie=0;ie<q;ie++)this.centroidVertexArray.emplaceBack(H,J)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,p,E,v)}processPolygon(r,o,p,v,E){if(v.length<1||Hy(v[0]))return;for(const H of v)H.length!==0&&Zy(r,H);const A={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},P=E.fill.getGranularityForZoomLevel(o.z),z=bd.types[p.type]==="Polygon";for(const H of v){if(H.length===0||Hy(H))continue;const J=Gc(H,P,z);this._generateSideFaces(J,A)}if(!z)return;const F=$y(v,o,P,!1),q=this.layoutVertexArray;au(((H,J)=>{hf(q,H,J,0,0,1,1,0)}),this.segments,this.layoutVertexArray,this.indexArray,F.verticesFlattened,F.indicesTriangles)}_generateSideFaces(r,o){let p=0;for(let v=1;v<r.length;v++){const E=r[v],A=r[v-1];if(bb(E,A))continue;o.segment.vertexLength+4>Hn.MAX_VERTEX_ARRAY_LENGTH&&(o.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const P=E.sub(A)._perp()._unit(),z=A.dist(E);p+z>32768&&(p=0),hf(this.layoutVertexArray,E.x,E.y,P.x,P.y,0,0,p),hf(this.layoutVertexArray,E.x,E.y,P.x,P.y,0,1,p),p+=z,hf(this.layoutVertexArray,A.x,A.y,P.x,P.y,0,0,p),hf(this.layoutVertexArray,A.x,A.y,P.x,P.y,0,1,p);const F=o.segment.vertexLength;this.indexArray.emplaceBack(F,F+2,F+1),this.indexArray.emplaceBack(F+1,F+2,F+3),o.segment.vertexLength+=4,o.segment.primitiveLength+=2}}}function Zy(l,r){for(let o=0;o<r.length;o++){const p=r[o];o===r.length-1&&r[0].x===p.x&&r[0].y===p.y||(l.x+=p.x,l.y+=p.y,l.sampleCount++)}}function bb(l,r){return l.x===r.x&&(l.x<0||l.x>jt)||l.y===r.y&&(l.y<0||l.y>jt)}function Hy(l){return l.every((r=>r.x<0))||l.every((r=>r.x>jt))||l.every((r=>r.y<0))||l.every((r=>r.y>jt))}let ar;Kt("FillExtrusionBucket",df,{omit:["layers","features"]});var jr={get paint(){return ar=ar||new no({"fill-extrusion-opacity":new tn(qe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new yn(qe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new tn(qe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new tn(qe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Uc(qe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new yn(qe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new yn(qe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new tn(qe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class vi extends So{constructor(r){super(r,jr)}createBucket(r){return new df(r)}queryRadius(){return tp(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:r,feature:o,featureState:p,geometry:v,transform:E,pixelsToTileUnits:A,pixelPosMatrix:P}){const z=La(r,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-E.bearingInRadians,A),F=this.paint.get("fill-extrusion-height").evaluate(o,p),q=this.paint.get("fill-extrusion-base").evaluate(o,p),H=(function(ie,re){const oe=[];for(const pe of ie){const we=[pe.x,pe.y,0,1];Bn(we,we,re),oe.push(new C(we[0]/we[3],we[1]/we[3]))}return oe})(z,P),J=(function(ie,re,oe,pe){const we=[],He=[],Re=pe[8]*re,Fe=pe[9]*re,ot=pe[10]*re,_t=pe[11]*re,It=pe[8]*oe,$t=pe[9]*oe,Nt=pe[10]*oe,Ut=pe[11]*oe;for(const hn of ie){const Gt=[],qt=[];for(const wt of hn){const En=wt.x,Ln=wt.y,xn=pe[0]*En+pe[4]*Ln+pe[12],ln=pe[1]*En+pe[5]*Ln+pe[13],Yn=pe[2]*En+pe[6]*Ln+pe[14],Gi=pe[3]*En+pe[7]*Ln+pe[15],br=Yn+ot,ba=Gi+_t,lo=xn+It,xa=ln+$t,os=Yn+Nt,Lr=Gi+Ut,ia=new C((xn+Re)/ba,(ln+Fe)/ba);ia.z=br/ba,Gt.push(ia);const ls=new C(lo/Lr,xa/Lr);ls.z=os/Lr,qt.push(ls)}we.push(Gt),He.push(qt)}return[we,He]})(v,q,F,P);return(function(ie,re,oe){let pe=1/0;Jf(oe,re)&&(pe=sr(oe,re[0]));for(let we=0;we<re.length;we++){const He=re[we],Re=ie[we];for(let Fe=0;Fe<He.length-1;Fe++){const ot=He[Fe],_t=[ot,He[Fe+1],Re[Fe+1],Re[Fe],ot];Pg(oe,_t)&&(pe=Math.min(pe,sr(oe,_t)))}}return pe!==1/0&&pe})(J[0],J[1],H)}}function mi(l,r){return l.x*r.x+l.y*r.y}function sr(l,r){if(l.length===1){let o=0;const p=r[o++];let v;for(;!v||p.equals(v);)if(v=r[o++],!v)return 1/0;for(;o<r.length;o++){const E=r[o],A=l[0],P=v.sub(p),z=E.sub(p),F=A.sub(p),q=mi(P,P),H=mi(P,z),J=mi(z,z),ie=mi(F,P),re=mi(F,z),oe=q*J-H*H,pe=(J*ie-H*re)/oe,we=(q*re-H*ie)/oe,He=p.z*(1-pe-we)+v.z*pe+E.z*we;if(isFinite(He))return He}return 1/0}{let o=1/0;for(const p of r)o=Math.min(o,p.z);return o}}const Vl=Qr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Ch}=Vl,ff=Qr([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Gg}=ff,Hc=Math.cos(Math.PI/180*37.5),ca=Math.pow(2,14)/.5;class cc{constructor(r){this.zoom=r.zoom,this.globalState=r.globalState,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map((o=>o.id)),this.index=r.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((o=>{this.gradients[o.id]={}})),this.layoutVertexArray=new st,this.layoutVertexArray2=new ct,this.indexArray=new qi,this.programConfigurations=new ea(r.layers,r.zoom),this.segments=new Hn,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((o=>o.isStateDependent())).map((o=>o.id))}populate(r,o,p){this.hasPattern=tf("line",this.layers,o);const v=this.layers[0].layout.get("line-sort-key"),E=!v.isConstant(),A=[];for(const{feature:P,id:z,index:F,sourceLayerIndex:q}of r){const H=this.layers[0]._featureFilter.needGeometry,J=hl(P,H);if(!this.layers[0]._featureFilter.filter(new rr(this.zoom,{globalState:this.globalState}),J,p))continue;const ie=E?v.evaluate(J,{},p):void 0,re={id:z,properties:P.properties,type:P.type,sourceLayerIndex:q,index:F,geometry:H?J.geometry:yr(P),patterns:{},sortKey:ie};A.push(re)}E&&A.sort(((P,z)=>P.sortKey-z.sortKey));for(const P of A){const{geometry:z,index:F,sourceLayerIndex:q}=P;if(this.hasPattern){const H=md("line",this.layers,P,this.zoom,o);this.patternFeatures.push(H)}else this.addFeature(P,z,F,p,{},o.subdivisionGranularity);o.featureIndex.insert(r[F].feature,z,F,q,this.index)}}update(r,o,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,o,this.stateDependentLayers,p)}addFeatures(r,o,p){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,o,p,r.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=r.createVertexBuffer(this.layoutVertexArray2,Gg)),this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,Ch),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(r){if(r.properties&&Object.prototype.hasOwnProperty.call(r.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(r.properties,"mapbox_clip_end"))return{start:+r.properties.mapbox_clip_start,end:+r.properties.mapbox_clip_end}}addFeature(r,o,p,v,E,A){const P=this.layers[0].layout,z=P.get("line-join").evaluate(r,{}),F=P.get("line-cap"),q=P.get("line-miter-limit"),H=P.get("line-round-limit");this.lineClips=this.lineFeatureClips(r);for(const J of o)this.addLine(J,r,z,F,q,H,v,A);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,p,E,v)}addLine(r,o,p,v,E,A,P,z){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,r=Gc(r,P?z.line.getGranularityForZoomLevel(P.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Re=0;Re<r.length-1;Re++)this.totalDistance+=r[Re].dist(r[Re+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const F=bd.types[o.type]==="Polygon";let q=r.length;for(;q>=2&&r[q-1].equals(r[q-2]);)q--;let H=0;for(;H<q-1&&r[H].equals(r[H+1]);)H++;if(q<(F?3:2))return;p==="bevel"&&(E=1.05);const J=this.overscaling<=16?122880/(512*this.overscaling):0,ie=this.segments.prepareSegment(10*q,this.layoutVertexArray,this.indexArray);let re,oe,pe,we,He;this.e1=this.e2=-1,F&&(re=r[q-2],He=r[H].sub(re)._unit()._perp());for(let Re=H;Re<q;Re++){if(pe=Re===q-1?F?r[H+1]:void 0:r[Re+1],pe&&r[Re].equals(pe))continue;He&&(we=He),re&&(oe=re),re=r[Re],He=pe?pe.sub(re)._unit()._perp():we,we=we||He;let Fe=we.add(He);Fe.x===0&&Fe.y===0||Fe._unit();const ot=we.x*He.x+we.y*He.y,_t=Fe.x*He.x+Fe.y*He.y,It=_t!==0?1/_t:1/0,$t=2*Math.sqrt(2-2*_t),Nt=_t<Hc&&oe&&pe,Ut=we.x*He.y-we.y*He.x>0;if(Nt&&Re>H){const qt=re.dist(oe);if(qt>2*J){const wt=re.sub(re.sub(oe)._mult(J/qt)._round());this.updateDistance(oe,wt),this.addCurrentVertex(wt,we,0,0,ie),oe=wt}}const hn=oe&&pe;let Gt=hn?p:F?"butt":v;if(hn&&Gt==="round"&&(It<A?Gt="miter":It<=2&&(Gt="fakeround")),Gt==="miter"&&It>E&&(Gt="bevel"),Gt==="bevel"&&(It>2&&(Gt="flipbevel"),It<E&&(Gt="miter")),oe&&this.updateDistance(oe,re),Gt==="miter")Fe._mult(It),this.addCurrentVertex(re,Fe,0,0,ie);else if(Gt==="flipbevel"){if(It>100)Fe=He.mult(-1);else{const qt=It*we.add(He).mag()/we.sub(He).mag();Fe._perp()._mult(qt*(Ut?-1:1))}this.addCurrentVertex(re,Fe,0,0,ie),this.addCurrentVertex(re,Fe.mult(-1),0,0,ie)}else if(Gt==="bevel"||Gt==="fakeround"){const qt=-Math.sqrt(It*It-1),wt=Ut?qt:0,En=Ut?0:qt;if(oe&&this.addCurrentVertex(re,we,wt,En,ie),Gt==="fakeround"){const Ln=Math.round(180*$t/Math.PI/20);for(let xn=1;xn<Ln;xn++){let ln=xn/Ln;if(ln!==.5){const Gi=ln-.5;ln+=ln*Gi*(ln-1)*((1.0904+ot*(ot*(3.55645-1.43519*ot)-3.2452))*Gi*Gi+(.848013+ot*(.215638*ot-1.06021)))}const Yn=He.sub(we)._mult(ln)._add(we)._unit()._mult(Ut?-1:1);this.addHalfVertex(re,Yn.x,Yn.y,!1,Ut,0,ie)}}pe&&this.addCurrentVertex(re,He,-wt,-En,ie)}else if(Gt==="butt")this.addCurrentVertex(re,Fe,0,0,ie);else if(Gt==="square"){const qt=oe?1:-1;this.addCurrentVertex(re,Fe,qt,qt,ie)}else Gt==="round"&&(oe&&(this.addCurrentVertex(re,we,0,0,ie),this.addCurrentVertex(re,we,1,1,ie,!0)),pe&&(this.addCurrentVertex(re,He,-1,-1,ie,!0),this.addCurrentVertex(re,He,0,0,ie)));if(Nt&&Re<q-1){const qt=re.dist(pe);if(qt>2*J){const wt=re.add(pe.sub(re)._mult(J/qt)._round());this.updateDistance(re,wt),this.addCurrentVertex(wt,He,0,0,ie),re=wt}}}}addCurrentVertex(r,o,p,v,E,A=!1){const P=o.y*v-o.x,z=-o.y-o.x*v;this.addHalfVertex(r,o.x+o.y*p,o.y-o.x*p,A,!1,p,E),this.addHalfVertex(r,P,z,A,!0,-v,E),this.distance>ca/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(r,o,p,v,E,A))}addHalfVertex({x:r,y:o},p,v,E,A,P,z){const F=.5*(this.lineClips?this.scaledDistance*(ca-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((r<<1)+(E?1:0),(o<<1)+(A?1:0),Math.round(63*p)+128,Math.round(63*v)+128,1+(P===0?0:P<0?-1:1)|(63&F)<<2,F>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const q=z.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,q,this.e2),z.primitiveLength++),A?this.e2=q:this.e1=q}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(r,o){this.distance+=r.dist(o),this.updateScaledDistance()}}let Ph,wm;Kt("LineBucket",cc,{omit:["layers","patternFeatures"]});var Ul={get paint(){return wm=wm||new no({"line-opacity":new yn(qe.paint_line["line-opacity"]),"line-color":new yn(qe.paint_line["line-color"]),"line-translate":new tn(qe.paint_line["line-translate"]),"line-translate-anchor":new tn(qe.paint_line["line-translate-anchor"]),"line-width":new yn(qe.paint_line["line-width"]),"line-gap-width":new yn(qe.paint_line["line-gap-width"]),"line-offset":new yn(qe.paint_line["line-offset"]),"line-blur":new yn(qe.paint_line["line-blur"]),"line-dasharray":new ol(qe.paint_line["line-dasharray"]),"line-pattern":new Uc(qe.paint_line["line-pattern"]),"line-gradient":new bu(qe.paint_line["line-gradient"])})},get layout(){return Ph=Ph||new no({"line-cap":new tn(qe.layout_line["line-cap"]),"line-join":new yn(qe.layout_line["line-join"]),"line-miter-limit":new tn(qe.layout_line["line-miter-limit"]),"line-round-limit":new tn(qe.layout_line["line-round-limit"]),"line-sort-key":new yn(qe.layout_line["line-sort-key"])})}};class pf extends yn{possiblyEvaluate(r,o){return o=new rr(Math.floor(o.zoom),{now:o.now,fadeDuration:o.fadeDuration,zoomHistory:o.zoomHistory,transition:o.transition}),super.possiblyEvaluate(r,o)}evaluate(r,o,p,v){return o=qn({},o,{zoom:Math.floor(o.zoom)}),super.evaluate(r,o,p,v)}}let Mh;class fl extends So{constructor(r){super(r,Ul),this.gradientVersion=0,Mh||(Mh=new pf(Ul.paint.properties["line-width"].specification),Mh.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(r){if(r==="line-gradient"){const o=this.gradientExpression();this.stepInterpolant=!!(function(p){return p._styleExpression!==void 0})(o)&&o._styleExpression.expression instanceof nr,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(r,o){super.recalculate(r,o),this.paint._values["line-floorwidth"]=Mh.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,r)}createBucket(r){return new cc(r)}queryRadius(r){const o=r,p=Tm(ep("line-width",this,o),ep("line-gap-width",this,o)),v=ep("line-offset",this,o);return p/2+Math.abs(v)+tp(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:r,feature:o,featureState:p,geometry:v,transform:E,pixelsToTileUnits:A}){const P=La(r,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-E.bearingInRadians,A),z=A/2*Tm(this.paint.get("line-width").evaluate(o,p),this.paint.get("line-gap-width").evaluate(o,p)),F=this.paint.get("line-offset").evaluate(o,p);return F&&(v=(function(q,H){const J=[];for(let ie=0;ie<q.length;ie++){const re=q[ie],oe=[];for(let pe=0;pe<re.length;pe++){const we=re[pe-1],He=re[pe],Re=re[pe+1],Fe=pe===0?new C(0,0):He.sub(we)._unit()._perp(),ot=pe===re.length-1?new C(0,0):Re.sub(He)._unit()._perp(),_t=Fe._add(ot)._unit(),It=_t.x*ot.x+_t.y*ot.y;It!==0&&_t._mult(1/It),oe.push(_t._mult(H)._add(He))}J.push(oe)}return J})(v,F*A)),(function(q,H,J){for(let ie=0;ie<H.length;ie++){const re=H[ie];if(q.length>=3){for(let oe=0;oe<re.length;oe++)if(fd(q,re[oe]))return!0}if(Py(q,re,J))return!0}return!1})(P,v,z)}isTileClipped(){return!0}}function Tm(l,r){return r>0?r+2*l:l}const Zg=Qr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Sm=Qr([{name:"a_projected_pos",components:3,type:"Float32"}],4);Qr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Em=Qr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);Qr([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Wc=Qr([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),oo=Qr([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Rh(l,r,o){return l.sections.forEach((p=>{p.text=(function(v,E,A){const P=E.layout.get("text-transform").evaluate(A,{});return P==="uppercase"?v=v.toLocaleUpperCase():P==="lowercase"&&(v=v.toLocaleLowerCase()),Rs.applyArabicShaping&&(v=Rs.applyArabicShaping(v)),v})(p.text,r,o)})),l}Qr([{name:"triangle",components:3,type:"Uint16"}]),Qr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Qr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Qr([{type:"Float32",name:"offsetX"}]),Qr([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Qr([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const hc={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var Hr=24;const lp=4294967296,Am=1/lp,Hg=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");class wd{constructor(r=new Uint8Array(16)){this.buf=ArrayBuffer.isView(r)?r:new Uint8Array(r),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(r,o,p=this.length){for(;this.pos<p;){const v=this.readVarint(),E=v>>3,A=this.pos;this.type=7&v,r(E,o,this),this.pos===A&&this.skip(v)}return o}readMessage(r,o){return this.readFields(r,o,this.readVarint()+this.pos)}readFixed32(){const r=this.dataView.getUint32(this.pos,!0);return this.pos+=4,r}readSFixed32(){const r=this.dataView.getInt32(this.pos,!0);return this.pos+=4,r}readFixed64(){const r=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*lp;return this.pos+=8,r}readSFixed64(){const r=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*lp;return this.pos+=8,r}readFloat(){const r=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,r}readDouble(){const r=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,r}readVarint(r){const o=this.buf;let p,v;return v=o[this.pos++],p=127&v,v<128?p:(v=o[this.pos++],p|=(127&v)<<7,v<128?p:(v=o[this.pos++],p|=(127&v)<<14,v<128?p:(v=o[this.pos++],p|=(127&v)<<21,v<128?p:(v=o[this.pos],p|=(15&v)<<28,(function(E,A,P){const z=P.buf;let F,q;if(q=z[P.pos++],F=(112&q)>>4,q<128||(q=z[P.pos++],F|=(127&q)<<3,q<128)||(q=z[P.pos++],F|=(127&q)<<10,q<128)||(q=z[P.pos++],F|=(127&q)<<17,q<128)||(q=z[P.pos++],F|=(127&q)<<24,q<128)||(q=z[P.pos++],F|=(1&q)<<31,q<128))return kh(E,F,A);throw new Error("Expected varint not more than 10 bytes")})(p,r,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const r=this.readVarint();return r%2==1?(r+1)/-2:r/2}readBoolean(){return!!this.readVarint()}readString(){const r=this.readVarint()+this.pos,o=this.pos;return this.pos=r,r-o>=12&&Hg?Hg.decode(this.buf.subarray(o,r)):(function(p,v,E){let A="",P=v;for(;P<E;){const z=p[P];let F,q,H,J=null,ie=z>239?4:z>223?3:z>191?2:1;if(P+ie>E)break;ie===1?z<128&&(J=z):ie===2?(F=p[P+1],(192&F)==128&&(J=(31&z)<<6|63&F,J<=127&&(J=null))):ie===3?(F=p[P+1],q=p[P+2],(192&F)==128&&(192&q)==128&&(J=(15&z)<<12|(63&F)<<6|63&q,(J<=2047||J>=55296&&J<=57343)&&(J=null))):ie===4&&(F=p[P+1],q=p[P+2],H=p[P+3],(192&F)==128&&(192&q)==128&&(192&H)==128&&(J=(15&z)<<18|(63&F)<<12|(63&q)<<6|63&H,(J<=65535||J>=1114112)&&(J=null))),J===null?(J=65533,ie=1):J>65535&&(J-=65536,A+=String.fromCharCode(J>>>10&1023|55296),J=56320|1023&J),A+=String.fromCharCode(J),P+=ie}return A})(this.buf,o,r)}readBytes(){const r=this.readVarint()+this.pos,o=this.buf.subarray(this.pos,r);return this.pos=r,o}readPackedVarint(r=[],o){const p=this.readPackedEnd();for(;this.pos<p;)r.push(this.readVarint(o));return r}readPackedSVarint(r=[]){const o=this.readPackedEnd();for(;this.pos<o;)r.push(this.readSVarint());return r}readPackedBoolean(r=[]){const o=this.readPackedEnd();for(;this.pos<o;)r.push(this.readBoolean());return r}readPackedFloat(r=[]){const o=this.readPackedEnd();for(;this.pos<o;)r.push(this.readFloat());return r}readPackedDouble(r=[]){const o=this.readPackedEnd();for(;this.pos<o;)r.push(this.readDouble());return r}readPackedFixed32(r=[]){const o=this.readPackedEnd();for(;this.pos<o;)r.push(this.readFixed32());return r}readPackedSFixed32(r=[]){const o=this.readPackedEnd();for(;this.pos<o;)r.push(this.readSFixed32());return r}readPackedFixed64(r=[]){const o=this.readPackedEnd();for(;this.pos<o;)r.push(this.readFixed64());return r}readPackedSFixed64(r=[]){const o=this.readPackedEnd();for(;this.pos<o;)r.push(this.readSFixed64());return r}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(r){const o=7&r;if(o===0)for(;this.buf[this.pos++]>127;);else if(o===2)this.pos=this.readVarint()+this.pos;else if(o===5)this.pos+=4;else{if(o!==1)throw new Error(`Unimplemented type: ${o}`);this.pos+=8}}writeTag(r,o){this.writeVarint(r<<3|o)}realloc(r){let o=this.length||16;for(;o<this.pos+r;)o*=2;if(o!==this.length){const p=new Uint8Array(o);p.set(this.buf),this.buf=p,this.dataView=new DataView(p.buffer),this.length=o}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(r){this.realloc(4),this.dataView.setInt32(this.pos,r,!0),this.pos+=4}writeSFixed32(r){this.realloc(4),this.dataView.setInt32(this.pos,r,!0),this.pos+=4}writeFixed64(r){this.realloc(8),this.dataView.setInt32(this.pos,-1&r,!0),this.dataView.setInt32(this.pos+4,Math.floor(r*Am),!0),this.pos+=8}writeSFixed64(r){this.realloc(8),this.dataView.setInt32(this.pos,-1&r,!0),this.dataView.setInt32(this.pos+4,Math.floor(r*Am),!0),this.pos+=8}writeVarint(r){(r=+r||0)>268435455||r<0?(function(o,p){let v,E;if(o>=0?(v=o%4294967296|0,E=o/4294967296|0):(v=~(-o%4294967296),E=~(-o/4294967296),4294967295^v?v=v+1|0:(v=0,E=E+1|0)),o>=18446744073709552e3||o<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");p.realloc(10),(function(A,P,z){z.buf[z.pos++]=127&A|128,A>>>=7,z.buf[z.pos++]=127&A|128,A>>>=7,z.buf[z.pos++]=127&A|128,A>>>=7,z.buf[z.pos++]=127&A|128,z.buf[z.pos]=127&(A>>>=7)})(v,0,p),(function(A,P){const z=(7&A)<<4;P.buf[P.pos++]|=z|((A>>>=3)?128:0),A&&(P.buf[P.pos++]=127&A|((A>>>=7)?128:0),A&&(P.buf[P.pos++]=127&A|((A>>>=7)?128:0),A&&(P.buf[P.pos++]=127&A|((A>>>=7)?128:0),A&&(P.buf[P.pos++]=127&A|((A>>>=7)?128:0),A&&(P.buf[P.pos++]=127&A)))))})(E,p)})(r,this):(this.realloc(4),this.buf[this.pos++]=127&r|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=r>>>7&127))))}writeSVarint(r){this.writeVarint(r<0?2*-r-1:2*r)}writeBoolean(r){this.writeVarint(+r)}writeString(r){r=String(r),this.realloc(4*r.length),this.pos++;const o=this.pos;this.pos=(function(v,E,A){for(let P,z,F=0;F<E.length;F++){if(P=E.charCodeAt(F),P>55295&&P<57344){if(!z){P>56319||F+1===E.length?(v[A++]=239,v[A++]=191,v[A++]=189):z=P;continue}if(P<56320){v[A++]=239,v[A++]=191,v[A++]=189,z=P;continue}P=z-55296<<10|P-56320|65536,z=null}else z&&(v[A++]=239,v[A++]=191,v[A++]=189,z=null);P<128?v[A++]=P:(P<2048?v[A++]=P>>6|192:(P<65536?v[A++]=P>>12|224:(v[A++]=P>>18|240,v[A++]=P>>12&63|128),v[A++]=P>>6&63|128),v[A++]=63&P|128)}return A})(this.buf,r,this.pos);const p=this.pos-o;p>=128&&pl(o,p,this),this.pos=o-1,this.writeVarint(p),this.pos+=p}writeFloat(r){this.realloc(4),this.dataView.setFloat32(this.pos,r,!0),this.pos+=4}writeDouble(r){this.realloc(8),this.dataView.setFloat64(this.pos,r,!0),this.pos+=8}writeBytes(r){const o=r.length;this.writeVarint(o),this.realloc(o);for(let p=0;p<o;p++)this.buf[this.pos++]=r[p]}writeRawMessage(r,o){this.pos++;const p=this.pos;r(o,this);const v=this.pos-p;v>=128&&pl(p,v,this),this.pos=p-1,this.writeVarint(v),this.pos+=v}writeMessage(r,o,p){this.writeTag(r,2),this.writeRawMessage(o,p)}writePackedVarint(r,o){o.length&&this.writeMessage(r,Wy,o)}writePackedSVarint(r,o){o.length&&this.writeMessage(r,jl,o)}writePackedBoolean(r,o){o.length&&this.writeMessage(r,xb,o)}writePackedFloat(r,o){o.length&&this.writeMessage(r,Xy,o)}writePackedDouble(r,o){o.length&&this.writeMessage(r,Ky,o)}writePackedFixed32(r,o){o.length&&this.writeMessage(r,Lh,o)}writePackedSFixed32(r,o){o.length&&this.writeMessage(r,Im,o)}writePackedFixed64(r,o){o.length&&this.writeMessage(r,Wg,o)}writePackedSFixed64(r,o){o.length&&this.writeMessage(r,mf,o)}writeBytesField(r,o){this.writeTag(r,2),this.writeBytes(o)}writeFixed32Field(r,o){this.writeTag(r,5),this.writeFixed32(o)}writeSFixed32Field(r,o){this.writeTag(r,5),this.writeSFixed32(o)}writeFixed64Field(r,o){this.writeTag(r,1),this.writeFixed64(o)}writeSFixed64Field(r,o){this.writeTag(r,1),this.writeSFixed64(o)}writeVarintField(r,o){this.writeTag(r,0),this.writeVarint(o)}writeSVarintField(r,o){this.writeTag(r,0),this.writeSVarint(o)}writeStringField(r,o){this.writeTag(r,2),this.writeString(o)}writeFloatField(r,o){this.writeTag(r,5),this.writeFloat(o)}writeDoubleField(r,o){this.writeTag(r,1),this.writeDouble(o)}writeBooleanField(r,o){this.writeVarintField(r,+o)}}function kh(l,r,o){return o?4294967296*r+(l>>>0):4294967296*(r>>>0)+(l>>>0)}function pl(l,r,o){const p=r<=16383?1:r<=2097151?2:r<=268435455?3:Math.floor(Math.log(r)/(7*Math.LN2));o.realloc(p);for(let v=o.pos-1;v>=l;v--)o.buf[v+p]=o.buf[v]}function Wy(l,r){for(let o=0;o<l.length;o++)r.writeVarint(l[o])}function jl(l,r){for(let o=0;o<l.length;o++)r.writeSVarint(l[o])}function Xy(l,r){for(let o=0;o<l.length;o++)r.writeFloat(l[o])}function Ky(l,r){for(let o=0;o<l.length;o++)r.writeDouble(l[o])}function xb(l,r){for(let o=0;o<l.length;o++)r.writeBoolean(l[o])}function Lh(l,r){for(let o=0;o<l.length;o++)r.writeFixed32(l[o])}function Im(l,r){for(let o=0;o<l.length;o++)r.writeSFixed32(l[o])}function Wg(l,r){for(let o=0;o<l.length;o++)r.writeFixed64(l[o])}function mf(l,r){for(let o=0;o<l.length;o++)r.writeSFixed64(l[o])}function Yy(l,r,o){l===1&&o.readMessage(Qy,r)}function Qy(l,r,o){if(l===3){const{id:p,bitmap:v,width:E,height:A,left:P,top:z,advance:F}=o.readMessage(Jy,{});r.push({id:p,bitmap:new pd({width:E+6,height:A+6},v),metrics:{width:E,height:A,left:P,top:z,advance:F}})}}function Jy(l,r,o){l===1?r.id=o.readVarint():l===2?r.bitmap=o.readBytes():l===3?r.width=o.readVarint():l===4?r.height=o.readVarint():l===5?r.left=o.readSVarint():l===6?r.top=o.readSVarint():l===7&&(r.advance=o.readVarint())}function Cm(l){let r=0,o=0;for(const A of l)r+=A.w*A.h,o=Math.max(o,A.w);l.sort(((A,P)=>P.h-A.h));const p=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(r/.95)),o),h:1/0}];let v=0,E=0;for(const A of l)for(let P=p.length-1;P>=0;P--){const z=p[P];if(!(A.w>z.w||A.h>z.h)){if(A.x=z.x,A.y=z.y,E=Math.max(E,A.y+A.h),v=Math.max(v,A.x+A.w),A.w===z.w&&A.h===z.h){const F=p.pop();F&&P<p.length&&(p[P]=F)}else A.h===z.h?(z.x+=A.w,z.w-=A.w):A.w===z.w?(z.y+=A.h,z.h-=A.h):(p.push({x:z.x+A.w,y:z.y,w:z.w-A.w,h:A.h}),z.y+=A.h,z.h-=A.h);break}}return{w:v,h:E,fill:r/(v*E)||0}}class up{constructor(r,{pixelRatio:o,version:p,stretchX:v,stretchY:E,content:A,textFitWidth:P,textFitHeight:z}){this.paddedRect=r,this.pixelRatio=o,this.stretchX=v,this.stretchY=E,this.content=A,this.version=p,this.textFitWidth=P,this.textFitHeight=z}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class ev{constructor(r,o){const p={},v={};this.haveRenderCallbacks=[];const E=[];this.addImages(r,p,E),this.addImages(o,v,E);const{w:A,h:P}=Cm(E),z=new ao({width:A||1,height:P||1});for(const F in r){const q=r[F],H=p[F].paddedRect;ao.copy(q.data,z,{x:0,y:0},{x:H.x+1,y:H.y+1},q.data)}for(const F in o){const q=o[F],H=v[F].paddedRect,J=H.x+1,ie=H.y+1,re=q.data.width,oe=q.data.height;ao.copy(q.data,z,{x:0,y:0},{x:J,y:ie},q.data),ao.copy(q.data,z,{x:0,y:oe-1},{x:J,y:ie-1},{width:re,height:1}),ao.copy(q.data,z,{x:0,y:0},{x:J,y:ie+oe},{width:re,height:1}),ao.copy(q.data,z,{x:re-1,y:0},{x:J-1,y:ie},{width:1,height:oe}),ao.copy(q.data,z,{x:0,y:0},{x:J+re,y:ie},{width:1,height:oe})}this.image=z,this.iconPositions=p,this.patternPositions=v}addImages(r,o,p){for(const v in r){const E=r[v],A={x:0,y:0,w:E.data.width+2,h:E.data.height+2};p.push(A),o[v]=new up(A,E),E.hasRenderCallback&&this.haveRenderCallbacks.push(v)}}patchUpdatedImages(r,o){r.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const p in r.updatedImages)this.patchUpdatedImage(this.iconPositions[p],r.getImage(p),o),this.patchUpdatedImage(this.patternPositions[p],r.getImage(p),o)}patchUpdatedImage(r,o,p){if(!r||!o||r.version===o.version)return;r.version=o.version;const[v,E]=r.tl;p.update(o.data,void 0,{x:v,y:E})}}var Dh;Kt("ImagePosition",up),Kt("ImageAtlas",ev),g.ao=void 0,(Dh=g.ao||(g.ao={}))[Dh.none=0]="none",Dh[Dh.horizontal=1]="horizontal",Dh[Dh.vertical=2]="vertical",Dh[Dh.horizontalOnly=3]="horizontalOnly";class cp{constructor(){this.scale=1,this.fontStack="",this.imageName=null,this.verticalAlign="bottom"}static forText(r,o,p){const v=new cp;return v.scale=r||1,v.fontStack=o,v.verticalAlign=p||"bottom",v}static forImage(r,o){const p=new cp;return p.imageName=r,p.verticalAlign=o||"bottom",p}}class Td{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(r,o){const p=new Td;for(let v=0;v<r.sections.length;v++){const E=r.sections[v];E.image?p.addImageSection(E):p.addTextSection(E,o)}return p}length(){return this.text.length}getSection(r){return this.sections[this.sectionIndex[r]]}getSectionIndex(r){return this.sectionIndex[r]}getCharCode(r){return this.text.charCodeAt(r)}verticalizePunctuation(){this.text=(function(r){let o="";for(let p=0;p<r.length;p++){const v=r.charCodeAt(p+1)||null,E=r.charCodeAt(p-1)||null;o+=v&&Yd(v)&&!hc[r[p+1]]||E&&Yd(E)&&!hc[r[p-1]]||!hc[r[p]]?r[p]:hc[r[p]]}return o})(this.text)}trim(){let r=0;for(let p=0;p<this.text.length&&Xc[this.text.charCodeAt(p)];p++)r++;let o=this.text.length;for(let p=this.text.length-1;p>=0&&p>=r&&Xc[this.text.charCodeAt(p)];p--)o--;this.text=this.text.substring(r,o),this.sectionIndex=this.sectionIndex.slice(r,o)}substring(r,o){const p=new Td;return p.text=this.text.substring(r,o),p.sectionIndex=this.sectionIndex.slice(r,o),p.sections=this.sections,p}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((r,o)=>Math.max(r,this.sections[o].scale)),0)}getMaxImageSize(r){let o=0,p=0;for(let v=0;v<this.length();v++){const E=this.getSection(v);if(E.imageName){const A=r[E.imageName];if(!A)continue;const P=A.displaySize;o=Math.max(o,P[0]),p=Math.max(p,P[1])}}return{maxImageWidth:o,maxImageHeight:p}}addTextSection(r,o){this.text+=r.text,this.sections.push(cp.forText(r.scale,r.fontStack||o,r.verticalAlign));const p=this.sections.length-1;for(let v=0;v<r.text.length;++v)this.sectionIndex.push(p)}addImageSection(r){const o=r.image?r.image.name:"";if(o.length===0)return void er("Can't add FormattedSection with an empty image.");const p=this.getNextImageSectionCharCode();p?(this.text+=String.fromCharCode(p),this.sections.push(cp.forImage(o,r.verticalAlign)),this.sectionIndex.push(this.sections.length-1)):er("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function hp(l,r,o,p,v,E,A,P,z,F,q,H,J,ie,re){const oe=Td.fromFeature(l,v);let pe;H===g.ao.vertical&&oe.verticalizePunctuation();const{processBidirectionalText:we,processStyledBidirectionalText:He}=Rs;if(we&&oe.sections.length===1){pe=[];const ot=we(oe.toString(),gf(oe,F,E,r,p,ie));for(const _t of ot){const It=new Td;It.text=_t,It.sections=oe.sections;for(let $t=0;$t<_t.length;$t++)It.sectionIndex.push(0);pe.push(It)}}else if(He){pe=[];const ot=He(oe.text,oe.sectionIndex,gf(oe,F,E,r,p,ie));for(const _t of ot){const It=new Td;It.text=_t[0],It.sectionIndex=_t[1],It.sections=oe.sections,pe.push(It)}}else pe=(function(ot,_t){const It=[],$t=ot.text;let Nt=0;for(const Ut of _t)It.push(ot.substring(Nt,Ut)),Nt=Ut;return Nt<$t.length&&It.push(ot.substring(Nt,$t.length)),It})(oe,gf(oe,F,E,r,p,ie));const Re=[],Fe={positionedLines:Re,text:oe.toString(),top:q[1],bottom:q[1],left:q[0],right:q[0],writingMode:H,iconsInText:!1,verticalizable:!1};return(function(ot,_t,It,$t,Nt,Ut,hn,Gt,qt,wt,En,Ln){let xn=0,ln=0,Yn=0,Gi=0;const br=Gt==="right"?1:Gt==="left"?0:.5,ba=Hr/Ln;let lo=0;for(const Lr of Nt){Lr.trim();const ia=Lr.getMaxScale(),ls={positionedGlyphs:[],lineOffset:0};ot.positionedLines[lo]=ls;const Ga=ls.positionedGlyphs;let us=0;if(!Lr.length()){ln+=Ut,++lo;continue}const gl=iv($t,Lr,ba);for(let Os=0;Os<Lr.length();Os++){const ra=Lr.getSection(Os),Da=Lr.getSectionIndex(Os),aa=Lr.getCharCode(Os),sa=Jg(qt,En,aa);let Ji;if(ra.imageName){if(ot.iconsInText=!0,ra.scale=ra.scale*ba,Ji=rv(ra,sa,ia,gl,$t),!Ji)continue;us=Math.max(us,Ji.imageOffset)}else if(Ji=wb(ra,aa,sa,gl,_t,It),!Ji)continue;const{rect:su,metrics:wf,baselineOffset:_l}=Ji;Ga.push({glyph:aa,imageName:ra.imageName,x:xn,y:ln+_l+-17,vertical:sa,scale:ra.scale,fontStack:ra.fontStack,sectionIndex:Da,metrics:wf,rect:su}),sa?(ot.verticalizable=!0,xn+=(ra.imageName?wf.advance:Hr)*ra.scale+wt):xn+=wf.advance*ra.scale+wt}Ga.length!==0&&(Yn=Math.max(xn-wt,Yn),Tb(Ga,0,Ga.length-1,br)),xn=0,ls.lineOffset=Math.max(us,(ia-1)*Hr);const Za=Ut*ia+us;ln+=Za,Gi=Math.max(Za,Gi),++lo}const{horizontalAlign:xa,verticalAlign:os}=Mm(hn);(function(Lr,ia,ls,Ga,us,gl,Za,Os,ra){const Da=(ia-ls)*us;let aa=0;aa=gl!==Za?-Os*Ga- -17:-Ga*ra*Za+.5*Za;for(const sa of Lr)for(const Ji of sa.positionedGlyphs)Ji.x+=Da,Ji.y+=aa})(ot.positionedLines,br,xa,os,Yn,Gi,Ut,ln,Nt.length),ot.top+=-os*ln,ot.bottom=ot.top+ln,ot.left+=-xa*Yn,ot.right=ot.left+Yn})(Fe,r,o,p,pe,A,P,z,H,F,J,re),!(function(ot){for(const _t of ot)if(_t.positionedGlyphs.length!==0)return!1;return!0})(Re)&&Fe}const Xc={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Pm={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},tv={40:!0};function Xg(l,r,o,p,v,E){if(r.imageName){const A=p[r.imageName];return A?A.displaySize[0]*r.scale*Hr/E+v:0}{const A=o[r.fontStack],P=A&&A[l];return P?P.metrics.advance*r.scale+v:0}}function Kg(l,r,o,p){const v=Math.pow(l-r,2);return p?l<r?v/2:2*v:v+Math.abs(o)*o}function nv(l,r,o){let p=0;return l===10&&(p-=1e4),o&&(p+=150),l!==40&&l!==65288||(p+=50),r!==41&&r!==65289||(p+=50),p}function Yg(l,r,o,p,v,E){let A=null,P=Kg(r,o,v,E);for(const z of p){const F=Kg(r-z.x,o,v,E)+z.badness;F<=P&&(A=z,P=F)}return{index:l,x:r,priorBreak:A,badness:P}}function Qg(l){return l?Qg(l.priorBreak).concat(l.index):[]}function gf(l,r,o,p,v,E){if(!l)return[];const A=[],P=(function(H,J,ie,re,oe,pe){let we=0;for(let He=0;He<H.length();He++){const Re=H.getSection(He);we+=Xg(H.getCharCode(He),Re,re,oe,J,pe)}return we/Math.max(1,Math.ceil(we/ie))})(l,r,o,p,v,E),z=l.text.indexOf("")>=0;let F=0;for(let H=0;H<l.length();H++){const J=l.getSection(H),ie=l.getCharCode(H);if(Xc[ie]||(F+=Xg(ie,J,p,v,r,E)),H<l.length()-1){const re=!((q=ie)<11904)&&(!!ai["CJK Compatibility Forms"](q)||!!ai["CJK Compatibility"](q)||!!ai["CJK Strokes"](q)||!!ai["CJK Symbols and Punctuation"](q)||!!ai["Enclosed CJK Letters and Months"](q)||!!ai["Halfwidth and Fullwidth Forms"](q)||!!ai["Ideographic Description Characters"](q)||!!ai["Vertical Forms"](q)||Nc.test(String.fromCodePoint(q)));(Pm[ie]||re||J.imageName||H!==l.length()-2&&tv[l.getCharCode(H+1)])&&A.push(Yg(H+1,F,P,A,nv(ie,l.getCharCode(H+1),re&&z),!1))}}var q;return Qg(Yg(l.length(),F,P,A,0,!0))}function Mm(l){let r=.5,o=.5;switch(l){case"right":case"top-right":case"bottom-right":r=1;break;case"left":case"top-left":case"bottom-left":r=0}switch(l){case"bottom":case"bottom-right":case"bottom-left":o=1;break;case"top":case"top-right":case"top-left":o=0}return{horizontalAlign:r,verticalAlign:o}}function iv(l,r,o){const p=r.getMaxScale()*Hr,{maxImageWidth:v,maxImageHeight:E}=r.getMaxImageSize(l),A=Math.max(p,E*o);return{verticalLineContentWidth:Math.max(p,v*o),horizontalLineContentHeight:A}}function vr(l){switch(l){case"top":return 0;case"center":return .5;default:return 1}}function Jg(l,r,o){return!(l===g.ao.horizontal||!r&&!ud(o)||r&&(Xc[o]||(p=o,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(p)))));var p}function wb(l,r,o,p,v,E){const A=E[l.fontStack],P=(function(F,q,H,J){if(F&&F.rect)return F;const ie=q[H.fontStack],re=ie&&ie[J];return re?{rect:null,metrics:re.metrics}:null})(A&&A[r],v,l,r);if(P===null)return null;let z;if(o)z=p.verticalLineContentWidth-l.scale*Hr;else{const F=vr(l.verticalAlign);z=(p.horizontalLineContentHeight-l.scale*Hr)*F}return{rect:P.rect,metrics:P.metrics,baselineOffset:z}}function rv(l,r,o,p,v){const E=v[l.imageName];if(!E)return null;const A=E.paddedRect,P=E.displaySize,z={width:P[0],height:P[1],left:1,top:-3,advance:r?P[1]:P[0]};let F;if(r)F=p.verticalLineContentWidth-P[1]*l.scale;else{const q=vr(l.verticalAlign);F=(p.horizontalLineContentHeight-P[1]*l.scale)*q}return{rect:A,metrics:z,baselineOffset:F,imageOffset:(r?P[0]:P[1])*l.scale-Hr*o}}function Tb(l,r,o,p){if(p===0)return;const v=l[o],E=(l[o].x+v.metrics.advance*v.scale)*p;for(let A=r;A<=o;A++)l[A].x-=E}function Sb(l,r,o){const{horizontalAlign:p,verticalAlign:v}=Mm(o),E=r[0]-l.displaySize[0]*p,A=r[1]-l.displaySize[1]*v;return{image:l,top:A,bottom:A+l.displaySize[1],left:E,right:E+l.displaySize[0]}}function av(l){var r,o;let p=l.left,v=l.top,E=l.right-p,A=l.bottom-v;const P=(r=l.image.textFitWidth)!==null&&r!==void 0?r:"stretchOrShrink",z=(o=l.image.textFitHeight)!==null&&o!==void 0?o:"stretchOrShrink",F=(l.image.content[2]-l.image.content[0])/(l.image.content[3]-l.image.content[1]);if(z==="proportional"){if(P==="stretchOnly"&&E/A<F||P==="proportional"){const q=Math.ceil(A*F);p*=q/E,E=q}}else if(P==="proportional"&&z==="stretchOnly"&&F!==0&&E/A>F){const q=Math.ceil(E/F);v*=q/A,A=q}return{x1:p,y1:v,x2:p+E,y2:v+A}}function dp(l,r,o,p,v,E){const A=l.image;let P;if(A.content){const pe=A.content,we=A.pixelRatio||1;P=[pe[0]/we,pe[1]/we,A.displaySize[0]-pe[2]/we,A.displaySize[1]-pe[3]/we]}const z=r.left*E,F=r.right*E;let q,H,J,ie;o==="width"||o==="both"?(ie=v[0]+z-p[3],H=v[0]+F+p[1]):(ie=v[0]+(z+F-A.displaySize[0])/2,H=ie+A.displaySize[0]);const re=r.top*E,oe=r.bottom*E;return o==="height"||o==="both"?(q=v[1]+re-p[0],J=v[1]+oe+p[2]):(q=v[1]+(re+oe-A.displaySize[1])/2,J=q+A.displaySize[1]),{image:A,top:q,right:H,bottom:J,left:ie,collisionPadding:P}}const ml=128,dc=32640;function fp(l,r){const{expression:o}=r;if(o.kind==="constant")return{kind:"constant",layoutSize:o.evaluate(new rr(l+1))};if(o.kind==="source")return{kind:"source"};{const{zoomStops:p,interpolationType:v}=o;let E=0;for(;E<p.length&&p[E]<=l;)E++;E=Math.max(0,E-1);let A=E;for(;A<p.length&&p[A]<l+1;)A++;A=Math.min(p.length-1,A);const P=p[E],z=p[A];return o.kind==="composite"?{kind:"composite",minZoom:P,maxZoom:z,interpolationType:v}:{kind:"camera",minZoom:P,maxZoom:z,minSize:o.evaluate(new rr(P)),maxSize:o.evaluate(new rr(z)),interpolationType:v}}}function pp(l,r,o){let p="never";const v=l.get(r);return v?p=v:l.get(o)&&(p="always"),p}const Sd=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function ql(l,r,o,p,v,E,A,P,z,F,q,H,J){const ie=P?Math.min(dc,Math.round(P[0])):0,re=P?Math.min(dc,Math.round(P[1])):0;l.emplaceBack(r,o,Math.round(32*p),Math.round(32*v),E,A,(ie<<1)+(z?1:0),re,16*F,16*q,256*H,256*J)}function Ed(l,r,o){l.emplaceBack(r.x,r.y,o),l.emplaceBack(r.x,r.y,o),l.emplaceBack(r.x,r.y,o),l.emplaceBack(r.x,r.y,o)}function Eb(l){for(const r of l.sections)if(Yf(r.text))return!0;return!1}class Rm{constructor(r){this.layoutVertexArray=new Bt,this.indexArray=new qi,this.programConfigurations=r,this.segments=new Hn,this.dynamicLayoutVertexArray=new Et,this.opacityVertexArray=new un,this.hasVisibleVertices=!1,this.placedSymbolArray=new ae}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(r,o,p,v){this.isEmpty()||(p&&(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,Zg.members),this.indexBuffer=r.createIndexBuffer(this.indexArray,o),this.dynamicLayoutVertexBuffer=r.createVertexBuffer(this.dynamicLayoutVertexArray,Sm.members,!0),this.opacityVertexBuffer=r.createVertexBuffer(this.opacityVertexArray,Sd,!0),this.opacityVertexBuffer.itemSize=1),(p||v)&&this.programConfigurations.upload(r))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Kt("SymbolBuffers",Rm);class km{constructor(r,o,p){this.layoutVertexArray=new r,this.layoutAttributes=o,this.indexArray=new p,this.segments=new Hn,this.collisionVertexArray=new yi}upload(r){this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=r.createVertexBuffer(this.collisionVertexArray,Em.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Kt("CollisionBuffers",km);class Ad{constructor(r){this.collisionBoxArray=r.collisionBoxArray,this.zoom=r.zoom,this.globalState=r.globalState,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map((A=>A.id)),this.index=r.index,this.pixelRatio=r.pixelRatio,this.sourceLayerIndex=r.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const o=this.layers[0]._unevaluatedLayout._values;this.textSizeData=fp(this.zoom,o["text-size"]),this.iconSizeData=fp(this.zoom,o["icon-size"]);const p=this.layers[0].layout,v=p.get("symbol-sort-key"),E=p.get("symbol-z-order");this.canOverlap=pp(p,"text-overlap","text-allow-overlap")!=="never"||pp(p,"icon-overlap","icon-allow-overlap")!=="never"||p.get("text-ignore-placement")||p.get("icon-ignore-placement"),this.sortFeaturesByKey=E!=="viewport-y"&&!v.isConstant(),this.sortFeaturesByY=(E==="viewport-y"||E==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,p.get("symbol-placement")==="point"&&(this.writingModes=p.get("text-writing-mode").map((A=>g.ao[A]))),this.stateDependentLayerIds=this.layers.filter((A=>A.isStateDependent())).map((A=>A.id)),this.sourceID=r.sourceID}createArrays(){this.text=new Rm(new ea(this.layers,this.zoom,(r=>/^text/.test(r)))),this.icon=new Rm(new ea(this.layers,this.zoom,(r=>/^icon/.test(r)))),this.glyphOffsetArray=new ve,this.lineVertexArray=new Te,this.symbolInstances=new ge,this.textAnchorOffsets=new Ae}calculateGlyphDependencies(r,o,p,v,E){for(let A=0;A<r.length;A++)if(o[r.charCodeAt(A)]=!0,(p||v)&&E){const P=hc[r.charAt(A)];P&&(o[P.charCodeAt(0)]=!0)}}populate(r,o,p){const v=this.layers[0],E=v.layout,A=E.get("text-font"),P=E.get("text-field"),z=E.get("icon-image"),F=(P.value.kind!=="constant"||P.value.value instanceof Ei&&!P.value.value.isEmpty()||P.value.value.toString().length>0)&&(A.value.kind!=="constant"||A.value.value.length>0),q=z.value.kind!=="constant"||!!z.value.value||Object.keys(z.parameters).length>0,H=E.get("symbol-sort-key");if(this.features=[],!F&&!q)return;const J=o.iconDependencies,ie=o.glyphDependencies,re=o.availableImages,oe=new rr(this.zoom,{globalState:this.globalState});for(const{feature:pe,id:we,index:He,sourceLayerIndex:Re}of r){const Fe=v._featureFilter.needGeometry,ot=hl(pe,Fe);if(!v._featureFilter.filter(oe,ot,p))continue;let _t,It;if(Fe||(ot.geometry=yr(pe)),F){const Nt=v.getValueAndResolveTokens("text-field",ot,p,re),Ut=Ei.factory(Nt),hn=this.hasRTLText=this.hasRTLText||Eb(Ut);(!hn||Rs.getRTLTextPluginStatus()==="unavailable"||hn&&Rs.isParsed())&&(_t=Rh(Ut,v,ot))}if(q){const Nt=v.getValueAndResolveTokens("icon-image",ot,p,re);It=Nt instanceof Br?Nt:Br.fromString(Nt)}if(!_t&&!It)continue;const $t=this.sortFeaturesByKey?H.evaluate(ot,{},p):void 0;if(this.features.push({id:we,text:_t,icon:It,index:He,sourceLayerIndex:Re,geometry:ot.geometry,properties:pe.properties,type:bd.types[pe.type],sortKey:$t}),It&&(J[It.name]=!0),_t){const Nt=A.evaluate(ot,{},p).join(","),Ut=E.get("text-rotation-alignment")!=="viewport"&&E.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(g.ao.vertical)>=0;for(const hn of _t.sections)if(hn.image)J[hn.image.name]=!0;else{const Gt=zl(_t.toString()),qt=hn.fontStack||Nt,wt=ie[qt]=ie[qt]||{};this.calculateGlyphDependencies(hn.text,wt,Ut,this.allowVerticalPlacement,Gt)}}}E.get("symbol-placement")==="line"&&(this.features=(function(pe){const we={},He={},Re=[];let Fe=0;function ot(Nt){Re.push(pe[Nt]),Fe++}function _t(Nt,Ut,hn){const Gt=He[Nt];return delete He[Nt],He[Ut]=Gt,Re[Gt].geometry[0].pop(),Re[Gt].geometry[0]=Re[Gt].geometry[0].concat(hn[0]),Gt}function It(Nt,Ut,hn){const Gt=we[Ut];return delete we[Ut],we[Nt]=Gt,Re[Gt].geometry[0].shift(),Re[Gt].geometry[0]=hn[0].concat(Re[Gt].geometry[0]),Gt}function $t(Nt,Ut,hn){const Gt=hn?Ut[0][Ut[0].length-1]:Ut[0][0];return`${Nt}:${Gt.x}:${Gt.y}`}for(let Nt=0;Nt<pe.length;Nt++){const Ut=pe[Nt],hn=Ut.geometry,Gt=Ut.text?Ut.text.toString():null;if(!Gt){ot(Nt);continue}const qt=$t(Gt,hn),wt=$t(Gt,hn,!0);if(qt in He&&wt in we&&He[qt]!==we[wt]){const En=It(qt,wt,hn),Ln=_t(qt,wt,Re[En].geometry);delete we[qt],delete He[wt],He[$t(Gt,Re[Ln].geometry,!0)]=Ln,Re[En].geometry=null}else qt in He?_t(qt,wt,hn):wt in we?It(qt,wt,hn):(ot(Nt),we[qt]=Fe-1,He[wt]=Fe-1)}return Re.filter((Nt=>Nt.geometry))})(this.features)),this.sortFeaturesByKey&&this.features.sort(((pe,we)=>pe.sortKey-we.sortKey))}update(r,o,p){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(r,o,this.layers,p),this.icon.programConfigurations.updatePaintArrays(r,o,this.layers,p))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(r){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(r),this.iconCollisionBox.upload(r)),this.text.upload(r,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(r,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(r,o){const p=this.lineVertexArray.length;if(r.segment!==void 0){let v=r.dist(o[r.segment+1]),E=r.dist(o[r.segment]);const A={};for(let P=r.segment+1;P<o.length;P++)A[P]={x:o[P].x,y:o[P].y,tileUnitDistanceFromAnchor:v},P<o.length-1&&(v+=o[P+1].dist(o[P]));for(let P=r.segment||0;P>=0;P--)A[P]={x:o[P].x,y:o[P].y,tileUnitDistanceFromAnchor:E},P>0&&(E+=o[P-1].dist(o[P]));for(let P=0;P<o.length;P++){const z=A[P];this.lineVertexArray.emplaceBack(z.x,z.y,z.tileUnitDistanceFromAnchor)}}return{lineStartIndex:p,lineLength:this.lineVertexArray.length-p}}addSymbols(r,o,p,v,E,A,P,z,F,q,H,J){const ie=r.indexArray,re=r.layoutVertexArray,oe=r.segments.prepareSegment(4*o.length,re,ie,this.canOverlap?A.sortKey:void 0),pe=this.glyphOffsetArray.length,we=oe.vertexLength,He=this.allowVerticalPlacement&&P===g.ao.vertical?Math.PI/2:0,Re=A.text&&A.text.sections;for(let Fe=0;Fe<o.length;Fe++){const{tl:ot,tr:_t,bl:It,br:$t,tex:Nt,pixelOffsetTL:Ut,pixelOffsetBR:hn,minFontScaleX:Gt,minFontScaleY:qt,glyphOffset:wt,isSDF:En,sectionIndex:Ln}=o[Fe],xn=oe.vertexLength,ln=wt[1];ql(re,z.x,z.y,ot.x,ln+ot.y,Nt.x,Nt.y,p,En,Ut.x,Ut.y,Gt,qt),ql(re,z.x,z.y,_t.x,ln+_t.y,Nt.x+Nt.w,Nt.y,p,En,hn.x,Ut.y,Gt,qt),ql(re,z.x,z.y,It.x,ln+It.y,Nt.x,Nt.y+Nt.h,p,En,Ut.x,hn.y,Gt,qt),ql(re,z.x,z.y,$t.x,ln+$t.y,Nt.x+Nt.w,Nt.y+Nt.h,p,En,hn.x,hn.y,Gt,qt),Ed(r.dynamicLayoutVertexArray,z,He),ie.emplaceBack(xn,xn+2,xn+1),ie.emplaceBack(xn+1,xn+2,xn+3),oe.vertexLength+=4,oe.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(wt[0]),Fe!==o.length-1&&Ln===o[Fe+1].sectionIndex||r.programConfigurations.populatePaintArrays(re.length,A,A.index,{},J,Re&&Re[Ln])}r.placedSymbolArray.emplaceBack(z.x,z.y,pe,this.glyphOffsetArray.length-pe,we,F,q,z.segment,p?p[0]:0,p?p[1]:0,v[0],v[1],P,0,!1,0,H)}_addCollisionDebugVertex(r,o,p,v,E,A){return o.emplaceBack(0,0),r.emplaceBack(p.x,p.y,v,E,Math.round(A.x),Math.round(A.y))}addCollisionDebugVertices(r,o,p,v,E,A,P){const z=E.segments.prepareSegment(4,E.layoutVertexArray,E.indexArray),F=z.vertexLength,q=E.layoutVertexArray,H=E.collisionVertexArray,J=P.anchorX,ie=P.anchorY;this._addCollisionDebugVertex(q,H,A,J,ie,new C(r,o)),this._addCollisionDebugVertex(q,H,A,J,ie,new C(p,o)),this._addCollisionDebugVertex(q,H,A,J,ie,new C(p,v)),this._addCollisionDebugVertex(q,H,A,J,ie,new C(r,v)),z.vertexLength+=4;const re=E.indexArray;re.emplaceBack(F,F+1),re.emplaceBack(F+1,F+2),re.emplaceBack(F+2,F+3),re.emplaceBack(F+3,F),z.primitiveLength+=4}addDebugCollisionBoxes(r,o,p,v){for(let E=r;E<o;E++){const A=this.collisionBoxArray.get(E);this.addCollisionDebugVertices(A.x1,A.y1,A.x2,A.y2,v?this.textCollisionBox:this.iconCollisionBox,A.anchorPoint,p)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new km(Kn,Wc.members,Ni),this.iconCollisionBox=new km(Kn,Wc.members,Ni);for(let r=0;r<this.symbolInstances.length;r++){const o=this.symbolInstances.get(r);this.addDebugCollisionBoxes(o.textBoxStartIndex,o.textBoxEndIndex,o,!0),this.addDebugCollisionBoxes(o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o,!0),this.addDebugCollisionBoxes(o.iconBoxStartIndex,o.iconBoxEndIndex,o,!1),this.addDebugCollisionBoxes(o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex,o,!1)}}_deserializeCollisionBoxesForSymbol(r,o,p,v,E,A,P,z,F){const q={};for(let H=o;H<p;H++){const J=r.get(H);q.textBox={x1:J.x1,y1:J.y1,x2:J.x2,y2:J.y2,anchorPointX:J.anchorPointX,anchorPointY:J.anchorPointY},q.textFeatureIndex=J.featureIndex;break}for(let H=v;H<E;H++){const J=r.get(H);q.verticalTextBox={x1:J.x1,y1:J.y1,x2:J.x2,y2:J.y2,anchorPointX:J.anchorPointX,anchorPointY:J.anchorPointY},q.verticalTextFeatureIndex=J.featureIndex;break}for(let H=A;H<P;H++){const J=r.get(H);q.iconBox={x1:J.x1,y1:J.y1,x2:J.x2,y2:J.y2,anchorPointX:J.anchorPointX,anchorPointY:J.anchorPointY},q.iconFeatureIndex=J.featureIndex;break}for(let H=z;H<F;H++){const J=r.get(H);q.verticalIconBox={x1:J.x1,y1:J.y1,x2:J.x2,y2:J.y2,anchorPointX:J.anchorPointX,anchorPointY:J.anchorPointY},q.verticalIconFeatureIndex=J.featureIndex;break}return q}deserializeCollisionBoxes(r){this.collisionArrays=[];for(let o=0;o<this.symbolInstances.length;o++){const p=this.symbolInstances.get(o);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(r,p.textBoxStartIndex,p.textBoxEndIndex,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p.iconBoxStartIndex,p.iconBoxEndIndex,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(r,o){const p=r.placedSymbolArray.get(o),v=p.vertexStartIndex+4*p.numGlyphs;for(let E=p.vertexStartIndex;E<v;E+=4)r.indexArray.emplaceBack(E,E+2,E+1),r.indexArray.emplaceBack(E+1,E+2,E+3)}getSortedSymbolIndexes(r){if(this.sortedAngle===r&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const o=Math.sin(r),p=Math.cos(r),v=[],E=[],A=[];for(let P=0;P<this.symbolInstances.length;++P){A.push(P);const z=this.symbolInstances.get(P);v.push(0|Math.round(o*z.anchorX+p*z.anchorY)),E.push(z.featureIndex)}return A.sort(((P,z)=>v[P]-v[z]||E[z]-E[P])),A}addToSortKeyRanges(r,o){const p=this.sortKeyRanges[this.sortKeyRanges.length-1];p&&p.sortKey===o?p.symbolInstanceEnd=r+1:this.sortKeyRanges.push({sortKey:o,symbolInstanceStart:r,symbolInstanceEnd:r+1})}sortFeatures(r){if(this.sortFeaturesByY&&this.sortedAngle!==r&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(r),this.sortedAngle=r,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const o of this.symbolInstanceIndexes){const p=this.symbolInstances.get(o);this.featureSortOrder.push(p.featureIndex),[p.rightJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.leftJustifiedTextSymbolIndex].forEach(((v,E,A)=>{v>=0&&A.indexOf(v)===E&&this.addIndicesForPlacedSymbol(this.text,v)})),p.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,p.verticalPlacedTextSymbolIndex),p.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,p.placedIconSymbolIndex),p.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,p.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let e_,sv;Kt("SymbolBucket",Ad,{omit:["layers","collisionBoxArray","features","compareText"]}),Ad.MAX_GLYPHS=65535,Ad.addDynamicAttributes=Ed;var mp={get paint(){return sv=sv||new no({"icon-opacity":new yn(qe.paint_symbol["icon-opacity"]),"icon-color":new yn(qe.paint_symbol["icon-color"]),"icon-halo-color":new yn(qe.paint_symbol["icon-halo-color"]),"icon-halo-width":new yn(qe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new yn(qe.paint_symbol["icon-halo-blur"]),"icon-translate":new tn(qe.paint_symbol["icon-translate"]),"icon-translate-anchor":new tn(qe.paint_symbol["icon-translate-anchor"]),"text-opacity":new yn(qe.paint_symbol["text-opacity"]),"text-color":new yn(qe.paint_symbol["text-color"],{runtimeType:zi,getOverride:l=>l.textColor,hasOverride:l=>!!l.textColor}),"text-halo-color":new yn(qe.paint_symbol["text-halo-color"]),"text-halo-width":new yn(qe.paint_symbol["text-halo-width"]),"text-halo-blur":new yn(qe.paint_symbol["text-halo-blur"]),"text-translate":new tn(qe.paint_symbol["text-translate"]),"text-translate-anchor":new tn(qe.paint_symbol["text-translate-anchor"])})},get layout(){return e_=e_||new no({"symbol-placement":new tn(qe.layout_symbol["symbol-placement"]),"symbol-spacing":new tn(qe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new tn(qe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new yn(qe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new tn(qe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new tn(qe.layout_symbol["icon-allow-overlap"]),"icon-overlap":new tn(qe.layout_symbol["icon-overlap"]),"icon-ignore-placement":new tn(qe.layout_symbol["icon-ignore-placement"]),"icon-optional":new tn(qe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new tn(qe.layout_symbol["icon-rotation-alignment"]),"icon-size":new yn(qe.layout_symbol["icon-size"]),"icon-text-fit":new tn(qe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new tn(qe.layout_symbol["icon-text-fit-padding"]),"icon-image":new yn(qe.layout_symbol["icon-image"]),"icon-rotate":new yn(qe.layout_symbol["icon-rotate"]),"icon-padding":new yn(qe.layout_symbol["icon-padding"]),"icon-keep-upright":new tn(qe.layout_symbol["icon-keep-upright"]),"icon-offset":new yn(qe.layout_symbol["icon-offset"]),"icon-anchor":new yn(qe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new tn(qe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new tn(qe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new tn(qe.layout_symbol["text-rotation-alignment"]),"text-field":new yn(qe.layout_symbol["text-field"]),"text-font":new yn(qe.layout_symbol["text-font"]),"text-size":new yn(qe.layout_symbol["text-size"]),"text-max-width":new yn(qe.layout_symbol["text-max-width"]),"text-line-height":new tn(qe.layout_symbol["text-line-height"]),"text-letter-spacing":new yn(qe.layout_symbol["text-letter-spacing"]),"text-justify":new yn(qe.layout_symbol["text-justify"]),"text-radial-offset":new yn(qe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new tn(qe.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new yn(qe.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new yn(qe.layout_symbol["text-anchor"]),"text-max-angle":new tn(qe.layout_symbol["text-max-angle"]),"text-writing-mode":new tn(qe.layout_symbol["text-writing-mode"]),"text-rotate":new yn(qe.layout_symbol["text-rotate"]),"text-padding":new tn(qe.layout_symbol["text-padding"]),"text-keep-upright":new tn(qe.layout_symbol["text-keep-upright"]),"text-transform":new yn(qe.layout_symbol["text-transform"]),"text-offset":new yn(qe.layout_symbol["text-offset"]),"text-allow-overlap":new tn(qe.layout_symbol["text-allow-overlap"]),"text-overlap":new tn(qe.layout_symbol["text-overlap"]),"text-ignore-placement":new tn(qe.layout_symbol["text-ignore-placement"]),"text-optional":new tn(qe.layout_symbol["text-optional"])})}};class t_{constructor(r){if(r.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=r.property.overrides?r.property.overrides.runtimeType:ps,this.defaultValue=r}evaluate(r){if(r.formattedSection){const o=this.defaultValue.property.overrides;if(o&&o.hasOverride(r.formattedSection))return o.getOverride(r.formattedSection)}return r.feature&&r.featureState?this.defaultValue.evaluate(r.feature,r.featureState):this.defaultValue.property.specification.default}eachChild(r){this.defaultValue.isConstant()||r(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Kt("FormatSectionOverride",t_,{omit:["defaultValue"]});class gp extends So{constructor(r){super(r,mp)}recalculate(r,o){if(super.recalculate(r,o),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const p=this.layout.get("text-writing-mode");if(p){const v=[];for(const E of p)v.indexOf(E)<0&&v.push(E);this.layout._values["text-writing-mode"]=v}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(r,o,p,v){const E=this.layout.get(r).evaluate(o,{},p,v),A=this._unevaluatedLayout._values[r];return A.isDataDriven()||nl(A.value)||!E?E:(function(P,z){return z.replace(/{([^{}]+)}/g,((F,q)=>P&&q in P?String(P[q]):""))})(o.properties,E)}createBucket(r){return new Ad(r)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const r of mp.paint.overridableProperties){if(!gp.hasPaintOverride(this.layout,r))continue;const o=this.paint.get(r),p=new t_(o),v=new Wu(p,o.property.specification);let E=null;E=o.value.kind==="constant"||o.value.kind==="source"?new f("source",v):new x("composite",v,o.value.zoomStops),this.paint._values[r]=new Qi(o.property,E,o.parameters)}}_handleOverridablePaintPropertyUpdate(r,o,p){return!(!this.layout||o.isDataDriven()||p.isDataDriven())&&gp.hasPaintOverride(this.layout,r)}static hasPaintOverride(r,o){const p=r.get("text-field"),v=mp.paint.properties[o];let E=!1;const A=P=>{for(const z of P)if(v.overrides&&v.overrides.hasOverride(z))return void(E=!0)};if(p.value.kind==="constant"&&p.value.value instanceof Ei)A(p.value.value.sections);else if(p.value.kind==="source"){const P=F=>{E||(F instanceof $r&&pn(F.value)===Sa?A(F.value.sections):F instanceof pt?A(F.sections):F.eachChild(P))},z=p.value;z._styleExpression&&P(z._styleExpression.expression)}return E}}let ov;var n_={get paint(){return ov=ov||new no({"background-color":new tn(qe.paint_background["background-color"]),"background-pattern":new ol(qe.paint_background["background-pattern"]),"background-opacity":new tn(qe.paint_background["background-opacity"])})}};class i_ extends So{constructor(r){super(r,n_)}}let lv;var Ab={get paint(){return lv=lv||new no({"raster-opacity":new tn(qe.paint_raster["raster-opacity"]),"raster-hue-rotate":new tn(qe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new tn(qe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new tn(qe.paint_raster["raster-brightness-max"]),"raster-saturation":new tn(qe.paint_raster["raster-saturation"]),"raster-contrast":new tn(qe.paint_raster["raster-contrast"]),"raster-resampling":new tn(qe.paint_raster["raster-resampling"]),"raster-fade-duration":new tn(qe.paint_raster["raster-fade-duration"])})}};class _p extends So{constructor(r){super(r,Ab)}}class Ib extends So{constructor(r){super(r,{}),this.onAdd=o=>{this.implementation.onAdd&&this.implementation.onAdd(o,o.painter.context.gl)},this.onRemove=o=>{this.implementation.onRemove&&this.implementation.onRemove(o,o.painter.context.gl)},this.implementation=r}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class uv{constructor(r){this._methodToThrottle=r,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._methodToThrottle()}),0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const bi={once:!0},yp=63710088e-1;class Pu{constructor(r,o){if(isNaN(r)||isNaN(o))throw new Error(`Invalid LngLat object: (${r}, ${o})`);if(this.lng=+r,this.lat=+o,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Pu(Ci(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(r){const o=Math.PI/180,p=this.lat*o,v=r.lat*o,E=Math.sin(p)*Math.sin(v)+Math.cos(p)*Math.cos(v)*Math.cos((r.lng-this.lng)*o);return yp*Math.acos(Math.min(E,1))}static convert(r){if(r instanceof Pu)return r;if(Array.isArray(r)&&(r.length===2||r.length===3))return new Pu(Number(r[0]),Number(r[1]));if(!Array.isArray(r)&&typeof r=="object"&&r!==null)return new Pu(Number("lng"in r?r.lng:r.lon),Number(r.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Lm=2*Math.PI*yp;function r_(l){return Lm*Math.cos(l*Math.PI/180)}function Dm(l){return(180+l)/360}function _f(l){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+l*Math.PI/360)))/360}function vp(l,r){return l/r_(r)}function zh(l){return 360/Math.PI*Math.atan(Math.exp((180-360*l)*Math.PI/180))-90}function a_(l,r){return l*r_(zh(r))}class bp{constructor(r,o,p=0){this.x=+r,this.y=+o,this.z=+p}static fromLngLat(r,o=0){const p=Pu.convert(r);return new bp(Dm(p.lng),_f(p.lat),vp(o,p.lat))}toLngLat(){return new Pu(360*this.x-180,zh(this.y))}toAltitude(){return a_(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Lm*(r=zh(this.y),1/Math.cos(r*Math.PI/180));var r}}function cv(l,r,o){var p=2*Math.PI*6378137/256/Math.pow(2,o);return[l*p-2*Math.PI*6378137/2,r*p-2*Math.PI*6378137/2]}class zm{constructor(r,o,p){if(!(function(v,E,A){return!(v<0||v>25||A<0||A>=Math.pow(2,v)||E<0||E>=Math.pow(2,v))})(r,o,p))throw new Error(`x=${o}, y=${p}, z=${r} outside of bounds. 0<=x<${Math.pow(2,r)}, 0<=y<${Math.pow(2,r)} 0<=z<=25 `);this.z=r,this.x=o,this.y=p,this.key=Bi(0,r,r,o,p)}equals(r){return this.z===r.z&&this.x===r.x&&this.y===r.y}url(r,o,p){const v=(A=this.y,P=this.z,z=cv(256*(E=this.x),256*(A=Math.pow(2,P)-A-1),P),F=cv(256*(E+1),256*(A+1),P),z[0]+","+z[1]+","+F[0]+","+F[1]);var E,A,P,z,F;const q=(function(H,J,ie){let re,oe="";for(let pe=H;pe>0;pe--)re=1<<pe-1,oe+=(J&re?1:0)+(ie&re?2:0);return oe})(this.z,this.x,this.y);return r[(this.x+this.y)%r.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(p==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,o>1?"@2x":"").replace(/{quadkey}/g,q).replace(/{bbox-epsg-3857}/g,v)}isChildOf(r){const o=this.z-r.z;return o>0&&r.x===this.x>>o&&r.y===this.y>>o}getTilePoint(r){const o=Math.pow(2,this.z);return new C((r.x*o-this.x)*jt,(r.y*o-this.y)*jt)}toString(){return`${this.z}/${this.x}/${this.y}`}}class s_{constructor(r,o){this.wrap=r,this.canonical=o,this.key=Bi(r,o.z,o.z,o.x,o.y)}}class Eo{constructor(r,o,p,v,E){if(this.terrainRttPosMatrix32f=null,r<p)throw new Error(`overscaledZ should be >= z; overscaledZ = ${r}; z = ${p}`);this.overscaledZ=r,this.wrap=o,this.canonical=new zm(p,+v,+E),this.key=Bi(o,r,p,v,E)}clone(){return new Eo(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(r){return this.overscaledZ===r.overscaledZ&&this.wrap===r.wrap&&this.canonical.equals(r.canonical)}scaledTo(r){if(r>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${r}; overscaledZ = ${this.overscaledZ}`);const o=this.canonical.z-r;return r>this.canonical.z?new Eo(r,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Eo(r,this.wrap,r,this.canonical.x>>o,this.canonical.y>>o)}calculateScaledKey(r,o){if(r>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${r}; overscaledZ = ${this.overscaledZ}`);const p=this.canonical.z-r;return r>this.canonical.z?Bi(this.wrap*+o,r,this.canonical.z,this.canonical.x,this.canonical.y):Bi(this.wrap*+o,r,r,this.canonical.x>>p,this.canonical.y>>p)}isChildOf(r){if(r.wrap!==this.wrap)return!1;const o=this.canonical.z-r.canonical.z;return r.overscaledZ===0||r.overscaledZ<this.overscaledZ&&r.canonical.x===this.canonical.x>>o&&r.canonical.y===this.canonical.y>>o}children(r){if(this.overscaledZ>=r)return[new Eo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const o=this.canonical.z+1,p=2*this.canonical.x,v=2*this.canonical.y;return[new Eo(o,this.wrap,o,p,v),new Eo(o,this.wrap,o,p+1,v),new Eo(o,this.wrap,o,p,v+1),new Eo(o,this.wrap,o,p+1,v+1)]}isLessThan(r){return this.wrap<r.wrap||!(this.wrap>r.wrap)&&(this.overscaledZ<r.overscaledZ||!(this.overscaledZ>r.overscaledZ)&&(this.canonical.x<r.canonical.x||!(this.canonical.x>r.canonical.x)&&this.canonical.y<r.canonical.y))}wrapped(){return new Eo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(r){return new Eo(this.overscaledZ,r,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new s_(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(r){return this.canonical.getTilePoint(new bp(r.x-this.wrap,r.y))}}function Bi(l,r,o,p,v){(l*=2)<0&&(l=-1*l-1);const E=1<<o;return(E*E*l+E*v+p).toString(36)+o.toString(36)+r.toString(36)}function Id(l,r){return r?l.properties[r]:l.id}Kt("CanonicalTileID",zm),Kt("OverscaledTileID",Eo,{omit:["terrainRttPosMatrix32f"]});class ha{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(r){return this.minX=Math.min(this.minX,r.x),this.minY=Math.min(this.minY,r.y),this.maxX=Math.max(this.maxX,r.x),this.maxY=Math.max(this.maxY,r.y),this}expandBy(r){return this.minX-=r,this.minY-=r,this.maxX+=r,this.maxY+=r,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(r){return this.expandBy(-r)}map(r){const o=new ha;return o.extend(r(new C(this.minX,this.minY))),o.extend(r(new C(this.maxX,this.minY))),o.extend(r(new C(this.minX,this.maxY))),o.extend(r(new C(this.maxX,this.maxY))),o}static fromPoints(r){const o=new ha;for(const p of r)o.extend(p);return o}contains(r){return r.x>=this.minX&&r.x<=this.maxX&&r.y>=this.minY&&r.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(r){return!this.empty()&&!r.empty()&&r.minX>=this.minX&&r.maxX<=this.maxX&&r.minY>=this.minY&&r.maxY<=this.maxY}intersects(r){return!this.empty()&&!r.empty()&&r.minX<=this.maxX&&r.maxX>=this.minX&&r.minY<=this.maxY&&r.maxY>=this.minY}}class hv{constructor(r){this._stringToNumber={},this._numberToString=[];for(let o=0;o<r.length;o++){const p=r[o];this._stringToNumber[p]=o,this._numberToString[o]=p}}encode(r){return this._stringToNumber[r]}decode(r){if(r>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${r} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[r]}}class Om{constructor(r,o,p,v,E){this.type="Feature",this._vectorTileFeature=r,r._z=o,r._x=p,r._y=v,this.properties=r.properties,this.id=E}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(r){this._geometry=r}toJSON(){const r={geometry:this.geometry};for(const o in this)o!=="_geometry"&&o!=="_vectorTileFeature"&&(r[o]=this[o]);return r}}class Nm{constructor(r,o){this.tileID=r,this.x=r.canonical.x,this.y=r.canonical.y,this.z=r.canonical.z,this.grid=new yu(jt,16,0),this.grid3D=new yu(jt,16,0),this.featureIndexArray=new Ue,this.promoteId=o}insert(r,o,p,v,E,A){const P=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(p,v,E);const z=A?this.grid3D:this.grid;for(let F=0;F<o.length;F++){const q=o[F],H=[1/0,1/0,-1/0,-1/0];for(let J=0;J<q.length;J++){const ie=q[J];H[0]=Math.min(H[0],ie.x),H[1]=Math.min(H[1],ie.y),H[2]=Math.max(H[2],ie.x),H[3]=Math.max(H[3],ie.y)}H[0]<jt&&H[1]<jt&&H[2]>=0&&H[3]>=0&&z.insert(P,H[0],H[1],H[2],H[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new $g(new wd(this.rawTileData)).layers,this.sourceLayerCoder=new hv(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(r,o,p,v){this.loadVTLayers();const E=r.params,A=jt/r.tileSize/r.scale,P=mt(E.filter),z=r.queryGeometry,F=r.queryPadding*A,q=ha.fromPoints(z),H=this.grid.query(q.minX-F,q.minY-F,q.maxX+F,q.maxY+F),J=ha.fromPoints(r.cameraQueryGeometry).expandBy(F),ie=this.grid3D.query(J.minX,J.minY,J.maxX,J.maxY,((pe,we,He,Re)=>(function(Fe,ot,_t,It,$t){for(const Ut of Fe)if(ot<=Ut.x&&_t<=Ut.y&&It>=Ut.x&&$t>=Ut.y)return!0;const Nt=[new C(ot,_t),new C(ot,$t),new C(It,$t),new C(It,_t)];if(Fe.length>2){for(const Ut of Nt)if(fd(Fe,Ut))return!0}for(let Ut=0;Ut<Fe.length-1;Ut++)if(Ry(Fe[Ut],Fe[Ut+1],Nt))return!0;return!1})(r.cameraQueryGeometry,pe-F,we-F,He+F,Re+F)));for(const pe of ie)H.push(pe);H.sort(dv);const re={};let oe;for(let pe=0;pe<H.length;pe++){const we=H[pe];if(we===oe)continue;oe=we;const He=this.featureIndexArray.get(we);let Re=null;this.loadMatchingFeature(re,He.bucketIndex,He.sourceLayerIndex,He.featureIndex,P,E.layers,E.availableImages,o,p,v,((Fe,ot,_t)=>(Re||(Re=yr(Fe)),ot.queryIntersectsFeature({queryGeometry:z,feature:Fe,featureState:_t,geometry:Re,zoom:this.z,transform:r.transform,pixelsToTileUnits:A,pixelPosMatrix:r.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:r.getElevation}))))}return re}loadMatchingFeature(r,o,p,v,E,A,P,z,F,q,H){const J=this.bucketLayerIDs[o];if(A&&!J.some((pe=>A.has(pe))))return;const ie=this.sourceLayerCoder.decode(p),re=this.vtLayers[ie].feature(v);if(E.needGeometry){const pe=hl(re,!0);if(!E.filter(new rr(this.tileID.overscaledZ),pe,this.tileID.canonical))return}else if(!E.filter(new rr(this.tileID.overscaledZ),re))return;const oe=this.getId(re,ie);for(let pe=0;pe<J.length;pe++){const we=J[pe];if(A&&!A.has(we))continue;const He=z[we];if(!He)continue;let Re={};oe&&q&&(Re=q.getState(He.sourceLayer||"_geojsonTileLayer",oe));const Fe=qn({},F[we]);Fe.paint=xp(Fe.paint,He.paint,re,Re,P),Fe.layout=xp(Fe.layout,He.layout,re,Re,P);const ot=!H||H(re,He,Re);if(!ot)continue;const _t=new Om(re,this.z,this.x,this.y,oe);_t.layer=Fe;let It=r[we];It===void 0&&(It=r[we]=[]),It.push({featureIndex:v,feature:_t,intersectionZ:ot})}}lookupSymbolFeatures(r,o,p,v,E,A,P,z){const F={};this.loadVTLayers();const q=mt(E);for(const H of r)this.loadMatchingFeature(F,p,v,H,q,A,P,z,o);return F}hasLayer(r){for(const o of this.bucketLayerIDs)for(const p of o)if(r===p)return!0;return!1}getId(r,o){var p;let v=r.id;return this.promoteId&&(v=r.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[o]],typeof v=="boolean"&&(v=Number(v)),v===void 0&&(!((p=r.properties)===null||p===void 0)&&p.cluster)&&this.promoteId&&(v=Number(r.properties.cluster_id))),v}}function xp(l,r,o,p,v){return co(l,((E,A)=>{const P=r instanceof Vc?r.get(A):null;return P&&P.evaluate?P.evaluate(o,p,v):P}))}function dv(l,r){return r-l}function o_(l,r,o,p,v){const E=[];for(let A=0;A<l.length;A++){const P=l[A];let z;for(let F=0;F<P.length-1;F++){let q=P[F],H=P[F+1];q.x<r&&H.x<r||(q.x<r?q=new C(r,q.y+(r-q.x)/(H.x-q.x)*(H.y-q.y))._round():H.x<r&&(H=new C(r,q.y+(r-q.x)/(H.x-q.x)*(H.y-q.y))._round()),q.y<o&&H.y<o||(q.y<o?q=new C(q.x+(o-q.y)/(H.y-q.y)*(H.x-q.x),o)._round():H.y<o&&(H=new C(q.x+(o-q.y)/(H.y-q.y)*(H.x-q.x),o)._round()),q.x>=p&&H.x>=p||(q.x>=p?q=new C(p,q.y+(p-q.x)/(H.x-q.x)*(H.y-q.y))._round():H.x>=p&&(H=new C(p,q.y+(p-q.x)/(H.x-q.x)*(H.y-q.y))._round()),q.y>=v&&H.y>=v||(q.y>=v?q=new C(q.x+(v-q.y)/(H.y-q.y)*(H.x-q.x),v)._round():H.y>=v&&(H=new C(q.x+(v-q.y)/(H.y-q.y)*(H.x-q.x),v)._round()),z&&q.equals(z[z.length-1])||(z=[q],E.push(z)),z.push(H)))))}}return E}Kt("FeatureIndex",Nm,{omit:["rawTileData","sourceLayerCoder"]});class fc extends C{constructor(r,o,p,v){super(r,o),this.angle=p,v!==void 0&&(this.segment=v)}clone(){return new fc(this.x,this.y,this.angle,this.segment)}}function Bm(l,r,o,p,v){if(r.segment===void 0||o===0)return!0;let E=r,A=r.segment+1,P=0;for(;P>-o/2;){if(A--,A<0)return!1;P-=l[A].dist(E),E=l[A]}P+=l[A].dist(l[A+1]),A++;const z=[];let F=0;for(;P<o/2;){const q=l[A],H=l[A+1];if(!H)return!1;let J=l[A-1].angleTo(q)-q.angleTo(H);for(J=Math.abs((J+3*Math.PI)%(2*Math.PI)-Math.PI),z.push({distance:P,angleDelta:J}),F+=J;P-z[0].distance>p;)F-=z.shift().angleDelta;if(F>v)return!1;A++,P+=q.dist(H)}return!0}function fv(l){let r=0;for(let o=0;o<l.length-1;o++)r+=l[o].dist(l[o+1]);return r}function l_(l,r,o){return l?.6*r*o:0}function pv(l,r){return Math.max(l?l.right-l.left:0,r?r.right-r.left:0)}function mv(l,r,o,p,v,E){const A=l_(o,v,E),P=pv(o,p)*E;let z=0;const F=fv(l)/2;for(let q=0;q<l.length-1;q++){const H=l[q],J=l[q+1],ie=H.dist(J);if(z+ie>F){const re=(F-z)/ie,oe=Es.number(H.x,J.x,re),pe=Es.number(H.y,J.y,re),we=new fc(oe,pe,J.angleTo(H),q);return we._round(),!A||Bm(l,we,P,A,r)?we:void 0}z+=ie}}function Cb(l,r,o,p,v,E,A,P,z){const F=l_(p,E,A),q=pv(p,v),H=q*A,J=l[0].x===0||l[0].x===z||l[0].y===0||l[0].y===z;return r-H<r/4&&(r=H+r/4),gv(l,J?r/2*P%r:(q/2+2*E)*A*P%r,r,F,o,H,J,!1,z)}function gv(l,r,o,p,v,E,A,P,z){const F=E/2,q=fv(l);let H=0,J=r-o,ie=[];for(let re=0;re<l.length-1;re++){const oe=l[re],pe=l[re+1],we=oe.dist(pe),He=pe.angleTo(oe);for(;J+o<H+we;){J+=o;const Re=(J-H)/we,Fe=Es.number(oe.x,pe.x,Re),ot=Es.number(oe.y,pe.y,Re);if(Fe>=0&&Fe<z&&ot>=0&&ot<z&&J-F>=0&&J+F<=q){const _t=new fc(Fe,ot,He,re);_t._round(),p&&!Bm(l,_t,E,p,v)||ie.push(_t)}}H+=we}return P||ie.length||A||(ie=gv(l,H/2,o,p,v,E,A,!0,z)),ie}function Kc(l,r,o,p){const v=[],E=l.image,A=E.pixelRatio,P=E.paddedRect.w-2,z=E.paddedRect.h-2;let F={x1:l.left,y1:l.top,x2:l.right,y2:l.bottom};const q=E.stretchX||[[0,P]],H=E.stretchY||[[0,z]],J=(wt,En)=>wt+En[1]-En[0],ie=q.reduce(J,0),re=H.reduce(J,0),oe=P-ie,pe=z-re;let we=0,He=ie,Re=0,Fe=re,ot=0,_t=oe,It=0,$t=pe;if(E.content&&p){const wt=E.content,En=wt[2]-wt[0],Ln=wt[3]-wt[1];(E.textFitWidth||E.textFitHeight)&&(F=av(l)),we=wp(q,0,wt[0]),Re=wp(H,0,wt[1]),He=wp(q,wt[0],wt[2]),Fe=wp(H,wt[1],wt[3]),ot=wt[0]-we,It=wt[1]-Re,_t=En-He,$t=Ln-Fe}const Nt=F.x1,Ut=F.y1,hn=F.x2-Nt,Gt=F.y2-Ut,qt=(wt,En,Ln,xn)=>{const ln=Vm(wt.stretch-we,He,hn,Nt),Yn=Um(wt.fixed-ot,_t,wt.stretch,ie),Gi=Vm(En.stretch-Re,Fe,Gt,Ut),br=Um(En.fixed-It,$t,En.stretch,re),ba=Vm(Ln.stretch-we,He,hn,Nt),lo=Um(Ln.fixed-ot,_t,Ln.stretch,ie),xa=Vm(xn.stretch-Re,Fe,Gt,Ut),os=Um(xn.fixed-It,$t,xn.stretch,re),Lr=new C(ln,Gi),ia=new C(ba,Gi),ls=new C(ba,xa),Ga=new C(ln,xa),us=new C(Yn/A,br/A),gl=new C(lo/A,os/A),Za=r*Math.PI/180;if(Za){const Da=Math.sin(Za),aa=Math.cos(Za),sa=[aa,-Da,Da,aa];Lr._matMult(sa),ia._matMult(sa),Ga._matMult(sa),ls._matMult(sa)}const Os=wt.stretch+wt.fixed,ra=En.stretch+En.fixed;return{tl:Lr,tr:ia,bl:Ga,br:ls,tex:{x:E.paddedRect.x+1+Os,y:E.paddedRect.y+1+ra,w:Ln.stretch+Ln.fixed-Os,h:xn.stretch+xn.fixed-ra},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:us,pixelOffsetBR:gl,minFontScaleX:_t/A/hn,minFontScaleY:$t/A/Gt,isSDF:o}};if(p&&(E.stretchX||E.stretchY)){const wt=Fm(q,oe,ie),En=Fm(H,pe,re);for(let Ln=0;Ln<wt.length-1;Ln++){const xn=wt[Ln],ln=wt[Ln+1];for(let Yn=0;Yn<En.length-1;Yn++)v.push(qt(xn,En[Yn],ln,En[Yn+1]))}}else v.push(qt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:P+1},{fixed:0,stretch:z+1}));return v}function wp(l,r,o){let p=0;for(const v of l)p+=Math.max(r,Math.min(o,v[1]))-Math.max(r,Math.min(o,v[0]));return p}function Fm(l,r,o){const p=[{fixed:-1,stretch:0}];for(const[v,E]of l){const A=p[p.length-1];p.push({fixed:v-A.stretch,stretch:A.stretch}),p.push({fixed:v-A.stretch,stretch:A.stretch+(E-v)})}return p.push({fixed:r+1,stretch:o}),p}function Vm(l,r,o,p){return l/r*o+p}function Um(l,r,o,p){return l-r*o/p}Kt("Anchor",fc);class yf{constructor(r,o,p,v,E,A,P,z,F,q){var H;if(this.boxStartIndex=r.length,F){let J=A.top,ie=A.bottom;const re=A.collisionPadding;re&&(J-=re[1],ie+=re[3]);let oe=ie-J;oe>0&&(oe=Math.max(10,oe),this.circleDiameter=oe)}else{const J=!((H=A.image)===null||H===void 0)&&H.content&&(A.image.textFitWidth||A.image.textFitHeight)?av(A):{x1:A.left,y1:A.top,x2:A.right,y2:A.bottom};J.y1=J.y1*P-z[0],J.y2=J.y2*P+z[2],J.x1=J.x1*P-z[3],J.x2=J.x2*P+z[1];const ie=A.collisionPadding;if(ie&&(J.x1-=ie[0]*P,J.y1-=ie[1]*P,J.x2+=ie[2]*P,J.y2+=ie[3]*P),q){const re=new C(J.x1,J.y1),oe=new C(J.x2,J.y1),pe=new C(J.x1,J.y2),we=new C(J.x2,J.y2),He=q*Math.PI/180;re._rotate(He),oe._rotate(He),pe._rotate(He),we._rotate(He),J.x1=Math.min(re.x,oe.x,pe.x,we.x),J.x2=Math.max(re.x,oe.x,pe.x,we.x),J.y1=Math.min(re.y,oe.y,pe.y,we.y),J.y2=Math.max(re.y,oe.y,pe.y,we.y)}r.emplaceBack(o.x,o.y,J.x1,J.y1,J.x2,J.y2,p,v,E)}this.boxEndIndex=r.length}}class Pb{constructor(r=[],o=(p,v)=>p<v?-1:p>v?1:0){if(this.data=r,this.length=this.data.length,this.compare=o,this.length>0)for(let p=(this.length>>1)-1;p>=0;p--)this._down(p)}push(r){this.data.push(r),this._up(this.length++)}pop(){if(this.length===0)return;const r=this.data[0],o=this.data.pop();return--this.length>0&&(this.data[0]=o,this._down(0)),r}peek(){return this.data[0]}_up(r){const{data:o,compare:p}=this,v=o[r];for(;r>0;){const E=r-1>>1,A=o[E];if(p(v,A)>=0)break;o[r]=A,r=E}o[r]=v}_down(r){const{data:o,compare:p}=this,v=this.length>>1,E=o[r];for(;r<v;){let A=1+(r<<1);const P=A+1;if(P<this.length&&p(o[P],o[A])<0&&(A=P),p(o[A],E)>=0)break;o[r]=o[A],r=A}o[r]=E}}function Mu(l,r=1,o=!1){const p=ha.fromPoints(l[0]),v=Math.min(p.width(),p.height());let E=v/2;const A=new Pb([],u_),{minX:P,minY:z,maxX:F,maxY:q}=p;if(v===0)return new C(P,z);for(let ie=P;ie<F;ie+=v)for(let re=z;re<q;re+=v)A.push(new Cd(ie+E,re+E,E,l));let H=(function(ie){let re=0,oe=0,pe=0;const we=ie[0];for(let He=0,Re=we.length,Fe=Re-1;He<Re;Fe=He++){const ot=we[He],_t=we[Fe],It=ot.x*_t.y-_t.x*ot.y;oe+=(ot.x+_t.x)*It,pe+=(ot.y+_t.y)*It,re+=3*It}return new Cd(oe/re,pe/re,0,ie)})(l),J=A.length;for(;A.length;){const ie=A.pop();(ie.d>H.d||!H.d)&&(H=ie,o&&console.log("found best %d after %d probes",Math.round(1e4*ie.d)/1e4,J)),ie.max-H.d<=r||(E=ie.h/2,A.push(new Cd(ie.p.x-E,ie.p.y-E,E,l)),A.push(new Cd(ie.p.x+E,ie.p.y-E,E,l)),A.push(new Cd(ie.p.x-E,ie.p.y+E,E,l)),A.push(new Cd(ie.p.x+E,ie.p.y+E,E,l)),J+=4)}return o&&(console.log(`num probes: ${J}`),console.log(`best distance: ${H.d}`)),H.p}function u_(l,r){return r.max-l.max}function Cd(l,r,o,p){this.p=new C(l,r),this.h=o,this.d=(function(v,E){let A=!1,P=1/0;for(let z=0;z<E.length;z++){const F=E[z];for(let q=0,H=F.length,J=H-1;q<H;J=q++){const ie=F[q],re=F[J];ie.y>v.y!=re.y>v.y&&v.x<(re.x-ie.x)*(v.y-ie.y)/(re.y-ie.y)+ie.x&&(A=!A),P=Math.min(P,Mg(v,ie,re))}}return(A?1:-1)*Math.sqrt(P)})(this.p,p),this.max=this.d+this.h*Math.SQRT2}var ss;g.aE=void 0,(ss=g.aE||(g.aE={}))[ss.center=1]="center",ss[ss.left=2]="left",ss[ss.right=3]="right",ss[ss.top=4]="top",ss[ss.bottom=5]="bottom",ss[ss["top-left"]=6]="top-left",ss[ss["top-right"]=7]="top-right",ss[ss["bottom-left"]=8]="bottom-left",ss[ss["bottom-right"]=9]="bottom-right";const Pd=Number.POSITIVE_INFINITY;function $l(l,r){return r[1]!==Pd?(function(o,p,v){let E=0,A=0;switch(p=Math.abs(p),v=Math.abs(v),o){case"top-right":case"top-left":case"top":A=v-7;break;case"bottom-right":case"bottom-left":case"bottom":A=7-v}switch(o){case"top-right":case"bottom-right":case"right":E=-p;break;case"top-left":case"bottom-left":case"left":E=p}return[E,A]})(l,r[0],r[1]):(function(o,p){let v=0,E=0;p<0&&(p=0);const A=p/Math.SQRT2;switch(o){case"top-right":case"top-left":E=A-7;break;case"bottom-right":case"bottom-left":E=7-A;break;case"bottom":E=7-p;break;case"top":E=p-7}switch(o){case"top-right":case"bottom-right":v=-A;break;case"top-left":case"bottom-left":v=A;break;case"left":v=p;break;case"right":v=-p}return[v,E]})(l,r[0])}function c_(l,r,o){var p;const v=l.layout,E=(p=v.get("text-variable-anchor-offset"))===null||p===void 0?void 0:p.evaluate(r,{},o);if(E){const P=E.values,z=[];for(let F=0;F<P.length;F+=2){const q=z[F]=P[F],H=P[F+1].map((J=>J*Hr));q.startsWith("top")?H[1]-=7:q.startsWith("bottom")&&(H[1]+=7),z[F+1]=H}return new or(z)}const A=v.get("text-variable-anchor");if(A){let P;P=l._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[v.get("text-radial-offset").evaluate(r,{},o)*Hr,Pd]:v.get("text-offset").evaluate(r,{},o).map((F=>F*Hr));const z=[];for(const F of A)z.push(F,$l(F,P));return new or(z)}return null}function vf(l){switch(l){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Yc(l,r,o,p,v,E,A,P,z,F,q,H){let J=E.textMaxSize.evaluate(r,{});J===void 0&&(J=A);const ie=l.layers[0].layout,re=ie.get("icon-offset").evaluate(r,{},q),oe=yv(o.horizontal),pe=A/24,we=l.tilePixelRatio*pe,He=l.tilePixelRatio*J/24,Re=l.tilePixelRatio*P,Fe=l.tilePixelRatio*ie.get("symbol-spacing"),ot=ie.get("text-padding")*l.tilePixelRatio,_t=(function(Ln,xn,ln,Yn=1){const Gi=Ln.get("icon-padding").evaluate(xn,{},ln),br=Gi&&Gi.values;return[br[0]*Yn,br[1]*Yn,br[2]*Yn,br[3]*Yn]})(ie,r,q,l.tilePixelRatio),It=ie.get("text-max-angle")/180*Math.PI,$t=ie.get("text-rotation-alignment")!=="viewport"&&ie.get("symbol-placement")!=="point",Nt=ie.get("icon-rotation-alignment")==="map"&&ie.get("symbol-placement")!=="point",Ut=ie.get("symbol-placement"),hn=Fe/2,Gt=ie.get("icon-text-fit");let qt;p&&Gt!=="none"&&(l.allowVerticalPlacement&&o.vertical&&(qt=dp(p,o.vertical,Gt,ie.get("icon-text-fit-padding"),re,pe)),oe&&(p=dp(p,oe,Gt,ie.get("icon-text-fit-padding"),re,pe)));const wt=q?H.line.getGranularityForZoomLevel(q.z):1,En=(Ln,xn)=>{xn.x<0||xn.x>=jt||xn.y<0||xn.y>=jt||(function(ln,Yn,Gi,br,ba,lo,xa,os,Lr,ia,ls,Ga,us,gl,Za,Os,ra,Da,aa,sa,Ji,su,wf,_l,s){const d=ln.addToLineVertexArray(Yn,Gi);let y,S,D,B,ne=0,he=0,Be=0,ht=0,St=-1,Mt=-1;const ft={};let vt=Eu("");if(ln.allowVerticalPlacement&&br.vertical){const Bo=os.layout.get("text-rotate").evaluate(Ji,{},_l)+90;D=new yf(Lr,Yn,ia,ls,Ga,br.vertical,us,gl,Za,Bo),xa&&(B=new yf(Lr,Yn,ia,ls,Ga,xa,ra,Da,Za,Bo))}if(ba){const Bo=os.layout.get("icon-rotate").evaluate(Ji,{}),Ru=os.layout.get("icon-text-fit")!=="none",Ep=Kc(ba,Bo,wf,Ru),Qc=xa?Kc(xa,Bo,wf,Ru):void 0;S=new yf(Lr,Yn,ia,ls,Ga,ba,ra,Da,!1,Bo),ne=4*Ep.length;const Ap=ln.iconSizeData;let Nh=null;Ap.kind==="source"?(Nh=[ml*os.layout.get("icon-size").evaluate(Ji,{})],Nh[0]>dc&&er(`${ln.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):Ap.kind==="composite"&&(Nh=[ml*su.compositeIconSizes[0].evaluate(Ji,{},_l),ml*su.compositeIconSizes[1].evaluate(Ji,{},_l)],(Nh[0]>dc||Nh[1]>dc)&&er(`${ln.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),ln.addSymbols(ln.icon,Ep,Nh,sa,aa,Ji,g.ao.none,Yn,d.lineStartIndex,d.lineLength,-1,_l),St=ln.icon.placedSymbolArray.length-1,Qc&&(he=4*Qc.length,ln.addSymbols(ln.icon,Qc,Nh,sa,aa,Ji,g.ao.vertical,Yn,d.lineStartIndex,d.lineLength,-1,_l),Mt=ln.icon.placedSymbolArray.length-1)}const Wn=Object.keys(br.horizontal);for(const Bo of Wn){const Ru=br.horizontal[Bo];if(!y){vt=Eu(Ru.text);const Qc=os.layout.get("text-rotate").evaluate(Ji,{},_l);y=new yf(Lr,Yn,ia,ls,Ga,Ru,us,gl,Za,Qc)}const Ep=Ru.positionedLines.length===1;if(Be+=_v(ln,Yn,Ru,lo,os,Za,Ji,Os,d,br.vertical?g.ao.horizontal:g.ao.horizontalOnly,Ep?Wn:[Bo],ft,St,su,_l),Ep)break}br.vertical&&(ht+=_v(ln,Yn,br.vertical,lo,os,Za,Ji,Os,d,g.ao.vertical,["vertical"],ft,Mt,su,_l));const jn=y?y.boxStartIndex:ln.collisionBoxArray.length,xr=y?y.boxEndIndex:ln.collisionBoxArray.length,tt=D?D.boxStartIndex:ln.collisionBoxArray.length,Ye=D?D.boxEndIndex:ln.collisionBoxArray.length,ut=S?S.boxStartIndex:ln.collisionBoxArray.length,Pt=S?S.boxEndIndex:ln.collisionBoxArray.length,wn=B?B.boxStartIndex:ln.collisionBoxArray.length,gi=B?B.boxEndIndex:ln.collisionBoxArray.length;let dn=-1;const zn=(Bo,Ru)=>Bo&&Bo.circleDiameter?Math.max(Bo.circleDiameter,Ru):Ru;dn=zn(y,dn),dn=zn(D,dn),dn=zn(S,dn),dn=zn(B,dn);const cs=dn>-1?1:0;cs&&(dn*=s/Hr),ln.glyphOffsetArray.length>=Ad.MAX_GLYPHS&&er("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Ji.sortKey!==void 0&&ln.addToSortKeyRanges(ln.symbolInstances.length,Ji.sortKey);const Zi=c_(os,Ji,_l),[Oh,Mb]=(function(Bo,Ru){const Ep=Bo.length,Qc=Ru==null?void 0:Ru.values;if((Qc==null?void 0:Qc.length)>0)for(let Ap=0;Ap<Qc.length;Ap+=2){const Nh=Qc[Ap+1];Bo.emplaceBack(g.aE[Qc[Ap]],Nh[0],Nh[1])}return[Ep,Bo.length]})(ln.textAnchorOffsets,Zi);ln.symbolInstances.emplaceBack(Yn.x,Yn.y,ft.right>=0?ft.right:-1,ft.center>=0?ft.center:-1,ft.left>=0?ft.left:-1,ft.vertical||-1,St,Mt,vt,jn,xr,tt,Ye,ut,Pt,wn,gi,ia,Be,ht,ne,he,cs,0,us,dn,Oh,Mb)})(l,xn,Ln,o,p,v,qt,l.layers[0],l.collisionBoxArray,r.index,r.sourceLayerIndex,l.index,we,[ot,ot,ot,ot],$t,z,Re,_t,Nt,re,r,E,F,q,A)};if(Ut==="line")for(const Ln of o_(r.geometry,0,0,jt,jt)){const xn=Gc(Ln,wt),ln=Cb(xn,Fe,It,o.vertical||oe,p,24,He,l.overscaling,jt);for(const Yn of ln)oe&&bf(l,oe.text,hn,Yn)||En(xn,Yn)}else if(Ut==="line-center"){for(const Ln of r.geometry)if(Ln.length>1){const xn=Gc(Ln,wt),ln=mv(xn,It,o.vertical||oe,p,24,He);ln&&En(xn,ln)}}else if(r.type==="Polygon")for(const Ln of qu(r.geometry,0)){const xn=Mu(Ln,16);En(Gc(Ln[0],wt,!0),new fc(xn.x,xn.y,0))}else if(r.type==="LineString")for(const Ln of r.geometry){const xn=Gc(Ln,wt);En(xn,new fc(xn[0].x,xn[0].y,0))}else if(r.type==="Point")for(const Ln of r.geometry)for(const xn of Ln)En([xn],new fc(xn.x,xn.y,0))}function _v(l,r,o,p,v,E,A,P,z,F,q,H,J,ie,re){const oe=(function(He,Re,Fe,ot,_t,It,$t,Nt){const Ut=ot.layout.get("text-rotate").evaluate(It,{})*Math.PI/180,hn=[];for(const Gt of Re.positionedLines)for(const qt of Gt.positionedGlyphs){if(!qt.rect)continue;const wt=qt.rect||{};let En=4,Ln=!0,xn=1,ln=0;const Yn=(_t||Nt)&&qt.vertical,Gi=qt.metrics.advance*qt.scale/2;if(Nt&&Re.verticalizable&&(ln=Gt.lineOffset/2-(qt.imageName?-(Hr-qt.metrics.width*qt.scale)/2:(qt.scale-1)*Hr)),qt.imageName){const Da=$t[qt.imageName];Ln=Da.sdf,xn=Da.pixelRatio,En=1/xn}const br=_t?[qt.x+Gi,qt.y]:[0,0];let ba=_t?[0,0]:[qt.x+Gi+Fe[0],qt.y+Fe[1]-ln],lo=[0,0];Yn&&(lo=ba,ba=[0,0]);const xa=qt.metrics.isDoubleResolution?2:1,os=(qt.metrics.left-En)*qt.scale-Gi+ba[0],Lr=(-qt.metrics.top-En)*qt.scale+ba[1],ia=os+wt.w/xa*qt.scale/xn,ls=Lr+wt.h/xa*qt.scale/xn,Ga=new C(os,Lr),us=new C(ia,Lr),gl=new C(os,ls),Za=new C(ia,ls);if(Yn){const Da=new C(-Gi,Gi- -17),aa=-Math.PI/2,sa=12-Gi,Ji=new C(22-sa,-(qt.imageName?sa:0)),su=new C(...lo);Ga._rotateAround(aa,Da)._add(Ji)._add(su),us._rotateAround(aa,Da)._add(Ji)._add(su),gl._rotateAround(aa,Da)._add(Ji)._add(su),Za._rotateAround(aa,Da)._add(Ji)._add(su)}if(Ut){const Da=Math.sin(Ut),aa=Math.cos(Ut),sa=[aa,-Da,Da,aa];Ga._matMult(sa),us._matMult(sa),gl._matMult(sa),Za._matMult(sa)}const Os=new C(0,0),ra=new C(0,0);hn.push({tl:Ga,tr:us,bl:gl,br:Za,tex:wt,writingMode:Re.writingMode,glyphOffset:br,sectionIndex:qt.sectionIndex,isSDF:Ln,pixelOffsetTL:Os,pixelOffsetBR:ra,minFontScaleX:0,minFontScaleY:0})}return hn})(0,o,P,v,E,A,p,l.allowVerticalPlacement),pe=l.textSizeData;let we=null;pe.kind==="source"?(we=[ml*v.layout.get("text-size").evaluate(A,{})],we[0]>dc&&er(`${l.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):pe.kind==="composite"&&(we=[ml*ie.compositeTextSizes[0].evaluate(A,{},re),ml*ie.compositeTextSizes[1].evaluate(A,{},re)],(we[0]>dc||we[1]>dc)&&er(`${l.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),l.addSymbols(l.text,oe,we,P,E,A,F,r,z.lineStartIndex,z.lineLength,J,re);for(const He of q)H[He]=l.text.placedSymbolArray.length-1;return 4*oe.length}function yv(l){for(const r in l)return l[r];return null}function bf(l,r,o,p){const v=l.compareText;if(r in v){const E=v[r];for(let A=E.length-1;A>=0;A--)if(p.dist(E[A])<o)return!0}else v[r]=[];return v[r].push(p),!1}const h_=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class d_{static from(r){if(!(r instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[o,p]=new Uint8Array(r,0,2);if(o!==219)throw new Error("Data does not appear to be in a KDBush format.");const v=p>>4;if(v!==1)throw new Error(`Got v${v} data when expected v1.`);const E=h_[15&p];if(!E)throw new Error("Unrecognized array type.");const[A]=new Uint16Array(r,2,1),[P]=new Uint32Array(r,4,1);return new d_(P,A,E,r)}constructor(r,o=64,p=Float64Array,v){if(isNaN(r)||r<0)throw new Error(`Unpexpected numItems value: ${r}.`);this.numItems=+r,this.nodeSize=Math.min(Math.max(+o,2),65535),this.ArrayType=p,this.IndexArrayType=r<65536?Uint16Array:Uint32Array;const E=h_.indexOf(this.ArrayType),A=2*r*this.ArrayType.BYTES_PER_ELEMENT,P=r*this.IndexArrayType.BYTES_PER_ELEMENT,z=(8-P%8)%8;if(E<0)throw new Error(`Unexpected typed array class: ${p}.`);v&&v instanceof ArrayBuffer?(this.data=v,this.ids=new this.IndexArrayType(this.data,8,r),this.coords=new this.ArrayType(this.data,8+P+z,2*r),this._pos=2*r,this._finished=!0):(this.data=new ArrayBuffer(8+A+P+z),this.ids=new this.IndexArrayType(this.data,8,r),this.coords=new this.ArrayType(this.data,8+P+z,2*r),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+E]),new Uint16Array(this.data,2,1)[0]=o,new Uint32Array(this.data,4,1)[0]=r)}add(r,o){const p=this._pos>>1;return this.ids[p]=p,this.coords[this._pos++]=r,this.coords[this._pos++]=o,p}finish(){const r=this._pos>>1;if(r!==this.numItems)throw new Error(`Added ${r} items when expected ${this.numItems}.`);return f_(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(r,o,p,v){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:E,coords:A,nodeSize:P}=this,z=[0,E.length-1,0],F=[];for(;z.length;){const q=z.pop()||0,H=z.pop()||0,J=z.pop()||0;if(H-J<=P){for(let pe=J;pe<=H;pe++){const we=A[2*pe],He=A[2*pe+1];we>=r&&we<=p&&He>=o&&He<=v&&F.push(E[pe])}continue}const ie=J+H>>1,re=A[2*ie],oe=A[2*ie+1];re>=r&&re<=p&&oe>=o&&oe<=v&&F.push(E[ie]),(q===0?r<=re:o<=oe)&&(z.push(J),z.push(ie-1),z.push(1-q)),(q===0?p>=re:v>=oe)&&(z.push(ie+1),z.push(H),z.push(1-q))}return F}within(r,o,p){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:v,coords:E,nodeSize:A}=this,P=[0,v.length-1,0],z=[],F=p*p;for(;P.length;){const q=P.pop()||0,H=P.pop()||0,J=P.pop()||0;if(H-J<=A){for(let pe=J;pe<=H;pe++)bv(E[2*pe],E[2*pe+1],r,o)<=F&&z.push(v[pe]);continue}const ie=J+H>>1,re=E[2*ie],oe=E[2*ie+1];bv(re,oe,r,o)<=F&&z.push(v[ie]),(q===0?r-p<=re:o-p<=oe)&&(P.push(J),P.push(ie-1),P.push(1-q)),(q===0?r+p>=re:o+p>=oe)&&(P.push(ie+1),P.push(H),P.push(1-q))}return z}}function f_(l,r,o,p,v,E){if(v-p<=o)return;const A=p+v>>1;vv(l,r,A,p,v,E),f_(l,r,o,p,A-1,1-E),f_(l,r,o,A+1,v,1-E)}function vv(l,r,o,p,v,E){for(;v>p;){if(v-p>600){const F=v-p+1,q=o-p+1,H=Math.log(F),J=.5*Math.exp(2*H/3),ie=.5*Math.sqrt(H*J*(F-J)/F)*(q-F/2<0?-1:1);vv(l,r,o,Math.max(p,Math.floor(o-q*J/F+ie)),Math.min(v,Math.floor(o+(F-q)*J/F+ie)),E)}const A=r[2*o+E];let P=p,z=v;for(Tp(l,r,p,o),r[2*v+E]>A&&Tp(l,r,p,v);P<z;){for(Tp(l,r,P,z),P++,z--;r[2*P+E]<A;)P++;for(;r[2*z+E]>A;)z--}r[2*p+E]===A?Tp(l,r,p,z):(z++,Tp(l,r,z,v)),z<=o&&(p=z+1),o<=z&&(v=z-1)}}function Tp(l,r,o,p){p_(l,o,p),p_(r,2*o,2*p),p_(r,2*o+1,2*p+1)}function p_(l,r,o){const p=l[r];l[r]=l[o],l[o]=p}function bv(l,r,o,p){const v=l-o,E=r-p;return v*v+E*E}var m_;g.cx=void 0,(m_=g.cx||(g.cx={})).create="create",m_.load="load",m_.fullLoad="fullLoad";let Sp=null,pc=[];const Md=1e3/60,jm="loadTime",g_="fullLoadTime",xf={mark(l){performance.mark(l)},frame(l){const r=l;Sp!=null&&pc.push(r-Sp),Sp=r},clearMetrics(){Sp=null,pc=[],performance.clearMeasures(jm),performance.clearMeasures(g_);for(const l in g.cx)performance.clearMarks(g.cx[l])},getPerformanceMetrics(){performance.measure(jm,g.cx.create,g.cx.load),performance.measure(g_,g.cx.create,g.cx.fullLoad);const l=performance.getEntriesByName(jm)[0].duration,r=performance.getEntriesByName(g_)[0].duration,o=pc.length,p=1/(pc.reduce(((E,A)=>E+A),0)/o/1e3),v=pc.filter((E=>E>Md)).reduce(((E,A)=>E+(A-Md)/Md),0);return{loadTime:l,fullLoadTime:r,fps:p,percentDroppedFrames:v/(o+v)*100,totalFrames:o}}};g.$=jt,g.A=Xe,g.B=function([l,r,o]){return r+=90,r*=Math.PI/180,o*=Math.PI/180,{x:l*Math.cos(r)*Math.sin(o),y:l*Math.sin(r)*Math.sin(o),z:l*Math.cos(o)}},g.C=Es,g.D=tn,g.E=en,g.F=rr,g.G=Ll,g.H=function(l){if(Nr==null){const r=l.navigator?l.navigator.userAgent:null;Nr=!!l.safari||!(!r||!(/\b(iPad|iPhone|iPod)\b/.test(r)||r.match("Safari")&&!r.match("Chrome")))}return Nr},g.I=up,g.J=class{constructor(l,r){this.target=l,this.mapId=r,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new uv((()=>this.process())),this.subscription=js(this.target,"message",(o=>this.receive(o)),!1),this.globalScope=Xa(self)?l:window}registerMessageHandler(l,r){this.messageHandlers[l]=r}sendAsync(l,r){return new Promise(((o,p)=>{const v=Math.round(1e18*Math.random()).toString(36).substring(0,10),E=r?js(r.signal,"abort",(()=>{E==null||E.unsubscribe(),delete this.resolveRejects[v];const z={id:v,type:"<cancel>",origin:location.origin,targetMapId:l.targetMapId,sourceMapId:this.mapId};this.target.postMessage(z)}),bi):null;this.resolveRejects[v]={resolve:z=>{E==null||E.unsubscribe(),o(z)},reject:z=>{E==null||E.unsubscribe(),p(z)}};const A=[],P=Object.assign(Object.assign({},l),{id:v,sourceMapId:this.mapId,origin:location.origin,data:Oc(l.data,A)});this.target.postMessage(P,{transfer:A})}))}receive(l){const r=l.data,o=r.id;if(!(r.origin!=="file://"&&location.origin!=="file://"&&r.origin!=="resource://android"&&location.origin!=="resource://android"&&r.origin!==location.origin||r.targetMapId&&this.mapId!==r.targetMapId)){if(r.type==="<cancel>"){delete this.tasks[o];const p=this.abortControllers[o];return delete this.abortControllers[o],void(p&&p.abort())}if(Xa(self)||r.mustQueue)return this.tasks[o]=r,this.taskQueue.push(o),void this.invoker.trigger();this.processTask(o,r)}}process(){if(this.taskQueue.length===0)return;const l=this.taskQueue.shift(),r=this.tasks[l];delete this.tasks[l],this.taskQueue.length>0&&this.invoker.trigger(),r&&this.processTask(l,r)}processTask(l,r){return c(this,void 0,void 0,(function*(){if(r.type==="<response>"){const v=this.resolveRejects[l];return delete this.resolveRejects[l],v?void(r.error?v.reject(Dl(r.error)):v.resolve(Dl(r.data))):void 0}if(!this.messageHandlers[r.type])return void this.completeTask(l,new Error(`Could not find a registered handler for ${r.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const o=Dl(r.data),p=new AbortController;this.abortControllers[l]=p;try{const v=yield this.messageHandlers[r.type](r.sourceMapId,o,p);this.completeTask(l,null,v)}catch(v){this.completeTask(l,v)}}))}completeTask(l,r,o){const p=[];delete this.abortControllers[l];const v={id:l,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:r?Oc(r):null,data:Oc(o,p)};this.target.postMessage(v,{transfer:p})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},g.K=fe,g.L=function(){var l=new Xe(16);return Xe!=Float32Array&&(l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[11]=0,l[12]=0,l[13]=0,l[14]=0),l[0]=1,l[5]=1,l[10]=1,l[15]=1,l},g.M=function(l,r,o){var p,v,E,A,P,z,F,q,H,J,ie,re,oe=o[0],pe=o[1],we=o[2];return r===l?(l[12]=r[0]*oe+r[4]*pe+r[8]*we+r[12],l[13]=r[1]*oe+r[5]*pe+r[9]*we+r[13],l[14]=r[2]*oe+r[6]*pe+r[10]*we+r[14],l[15]=r[3]*oe+r[7]*pe+r[11]*we+r[15]):(v=r[1],E=r[2],A=r[3],P=r[4],z=r[5],F=r[6],q=r[7],H=r[8],J=r[9],ie=r[10],re=r[11],l[0]=p=r[0],l[1]=v,l[2]=E,l[3]=A,l[4]=P,l[5]=z,l[6]=F,l[7]=q,l[8]=H,l[9]=J,l[10]=ie,l[11]=re,l[12]=p*oe+P*pe+H*we+r[12],l[13]=v*oe+z*pe+J*we+r[13],l[14]=E*oe+F*pe+ie*we+r[14],l[15]=A*oe+q*pe+re*we+r[15]),l},g.N=function(l,r,o){var p=o[0],v=o[1],E=o[2];return l[0]=r[0]*p,l[1]=r[1]*p,l[2]=r[2]*p,l[3]=r[3]*p,l[4]=r[4]*v,l[5]=r[5]*v,l[6]=r[6]*v,l[7]=r[7]*v,l[8]=r[8]*E,l[9]=r[9]*E,l[10]=r[10]*E,l[11]=r[11]*E,l[12]=r[12],l[13]=r[13],l[14]=r[14],l[15]=r[15],l},g.O=function(l,r,o){var p=r[0],v=r[1],E=r[2],A=r[3],P=r[4],z=r[5],F=r[6],q=r[7],H=r[8],J=r[9],ie=r[10],re=r[11],oe=r[12],pe=r[13],we=r[14],He=r[15],Re=o[0],Fe=o[1],ot=o[2],_t=o[3];return l[0]=Re*p+Fe*P+ot*H+_t*oe,l[1]=Re*v+Fe*z+ot*J+_t*pe,l[2]=Re*E+Fe*F+ot*ie+_t*we,l[3]=Re*A+Fe*q+ot*re+_t*He,l[4]=(Re=o[4])*p+(Fe=o[5])*P+(ot=o[6])*H+(_t=o[7])*oe,l[5]=Re*v+Fe*z+ot*J+_t*pe,l[6]=Re*E+Fe*F+ot*ie+_t*we,l[7]=Re*A+Fe*q+ot*re+_t*He,l[8]=(Re=o[8])*p+(Fe=o[9])*P+(ot=o[10])*H+(_t=o[11])*oe,l[9]=Re*v+Fe*z+ot*J+_t*pe,l[10]=Re*E+Fe*F+ot*ie+_t*we,l[11]=Re*A+Fe*q+ot*re+_t*He,l[12]=(Re=o[12])*p+(Fe=o[13])*P+(ot=o[14])*H+(_t=o[15])*oe,l[13]=Re*v+Fe*z+ot*J+_t*pe,l[14]=Re*E+Fe*F+ot*ie+_t*we,l[15]=Re*A+Fe*q+ot*re+_t*He,l},g.P=C,g.Q=function(l,r){const o={};for(let p=0;p<r.length;p++){const v=r[p];v in l&&(o[v]=l[v])}return o},g.R=ao,g.S=Pu,g.T=Cu,g.U=_f,g.V=Dm,g.W=ze,g.X=et,g.Y=fr,g.Z=Eo,g._=c,g.a=se,g.a$=ke,g.a0=function(l,r){var o,p,v,E;if(!l)return r??{};if(!r)return l;const A=Object.assign({},l);if(r.removeAll&&(A.removeAll=!0),r.remove){const P=new Set(A.remove?A.remove.concat(r.remove):r.remove);A.remove=Array.from(P.values())}if(r.add){const P=A.add?A.add.concat(r.add):r.add,z=new Map(P.map((F=>[F.id,F])));A.add=Array.from(z.values())}if(r.update){const P=new Map((o=A.update)===null||o===void 0?void 0:o.map((z=>[z.id,z])));for(const z of r.update){const F=(p=P.get(z.id))!==null&&p!==void 0?p:{id:z.id};z.newGeometry&&(F.newGeometry=z.newGeometry),z.addOrUpdateProperties&&(F.addOrUpdateProperties=((v=F.addOrUpdateProperties)!==null&&v!==void 0?v:[]).concat(z.addOrUpdateProperties)),z.removeProperties&&(F.removeProperties=((E=F.removeProperties)!==null&&E!==void 0?E:[]).concat(z.removeProperties)),z.removeAllProperties&&(F.removeAllProperties=!0),P.set(z.id,F)}A.update=Array.from(P.values())}return A},g.a1=bp,g.a2=ha,g.a3=25,g.a4=zm,g.a5=l=>{const r=window.document.createElement("video");return r.muted=!0,new Promise((o=>{r.onloadstart=()=>{o(r)};for(const p of l){const v=window.document.createElement("source");Je(p)||(r.crossOrigin="Anonymous"),v.src=p,r.appendChild(v)}}))},g.a6=Ct,g.a7=function(){return zr++},g.a8=W,g.a9=Ad,g.aA=function(l){let r=1/0,o=1/0,p=-1/0,v=-1/0;for(const E of l)r=Math.min(r,E.x),o=Math.min(o,E.y),p=Math.max(p,E.x),v=Math.max(v,E.y);return[r,o,p,v]},g.aB=Hr,g.aC=Ie,g.aD=function(l,r,o,p,v=!1){if(!o[0]&&!o[1])return[0,0];const E=v?p==="map"?-l.bearingInRadians:0:p==="viewport"?l.bearingInRadians:0;if(E){const A=Math.sin(E),P=Math.cos(E);o=[o[0]*P-o[1]*A,o[0]*A+o[1]*P]}return[v?o[0]:Ie(r,o[0],l.zoom),v?o[1]:Ie(r,o[1],l.zoom)]},g.aF=pp,g.aG=vf,g.aH=Mm,g.aI=d_,g.aJ=Qr,g.aK=so,g.aL=Ce,g.aM=Hn,g.aN=qi,g.aO=Ci,g.aP=fs,g.aQ=a_,g.aR=Ee,g.aS=me,g.aT=function(l){var r=new Xe(3);return r[0]=l[0],r[1]=l[1],r[2]=l[2],r},g.aU=function(l,r,o){return l[0]=r[0]-o[0],l[1]=r[1]-o[1],l[2]=r[2]-o[2],l},g.aV=function(l,r){var o=r[0],p=r[1],v=r[2],E=o*o+p*p+v*v;return E>0&&(E=1/Math.sqrt(E)),l[0]=r[0]*E,l[1]=r[1]*E,l[2]=r[2]*E,l},g.aW=De,g.aX=function(l,r){return l[0]*r[0]+l[1]*r[1]+l[2]*r[2]},g.aY=function(l,r,o){return l[0]=r[0]*o[0],l[1]=r[1]*o[1],l[2]=r[2]*o[2],l[3]=r[3]*o[3],l},g.aZ=de,g.a_=function(l,r,o){const p=r[0]*o[0]+r[1]*o[1]+r[2]*o[2];return p===0?null:(-(l[0]*o[0]+l[1]*o[1]+l[2]*o[2])-o[3])/p},g.aa=mt,g.ab=hl,g.ac=Om,g.ad=function(l){const r={};if(l.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((o,p,v,E)=>{const A=v||E;return r[p]=!A||A.toLowerCase(),""})),r["max-age"]){const o=parseInt(r["max-age"],10);isNaN(o)?delete r["max-age"]:r["max-age"]=o}return r},g.ae=Tl,g.af=function(l){return Math.pow(2,l)},g.ag=Ve,g.ah=Ft,g.ai=85.051129,g.aj=vp,g.ak=function(l){return Math.log(l)/Math.LN2},g.al=function(l){var r=l[0],o=l[1];return r*r+o*o},g.am=function(l,r){const o=[];for(const p in l)p in r||o.push(p);return o},g.an=function(l,r){let o=0,p=0;if(l.kind==="constant")p=l.layoutSize;else if(l.kind!=="source"){const{interpolationType:v,minZoom:E,maxZoom:A}=l,P=v?Ft(ir.interpolationFactor(v,r,E,A),0,1):0;l.kind==="camera"?p=Es.number(l.minSize,l.maxSize,P):o=P}return{uSizeT:o,uSize:p}},g.ap=function(l,{uSize:r,uSizeT:o},{lowerSize:p,upperSize:v}){return l.kind==="source"?p/ml:l.kind==="composite"?Es.number(p/ml,v/ml,o):r},g.aq=function(l,r){var o=r[0],p=r[1],v=r[2],E=r[3],A=r[4],P=r[5],z=r[6],F=r[7],q=r[8],H=r[9],J=r[10],ie=r[11],re=r[12],oe=r[13],pe=r[14],we=r[15],He=o*P-p*A,Re=o*z-v*A,Fe=o*F-E*A,ot=p*z-v*P,_t=p*F-E*P,It=v*F-E*z,$t=q*oe-H*re,Nt=q*pe-J*re,Ut=q*we-ie*re,hn=H*pe-J*oe,Gt=H*we-ie*oe,qt=J*we-ie*pe,wt=He*qt-Re*Gt+Fe*hn+ot*Ut-_t*Nt+It*$t;return wt?(l[0]=(P*qt-z*Gt+F*hn)*(wt=1/wt),l[1]=(v*Gt-p*qt-E*hn)*wt,l[2]=(oe*It-pe*_t+we*ot)*wt,l[3]=(J*_t-H*It-ie*ot)*wt,l[4]=(z*Ut-A*qt-F*Nt)*wt,l[5]=(o*qt-v*Ut+E*Nt)*wt,l[6]=(pe*Fe-re*It-we*Re)*wt,l[7]=(q*It-J*Fe+ie*Re)*wt,l[8]=(A*Gt-P*Ut+F*$t)*wt,l[9]=(p*Ut-o*Gt-E*$t)*wt,l[10]=(re*_t-oe*Fe+we*He)*wt,l[11]=(H*Fe-q*_t-ie*He)*wt,l[12]=(P*Nt-A*hn-z*$t)*wt,l[13]=(o*hn-p*Nt+v*$t)*wt,l[14]=(oe*Re-re*ot-pe*He)*wt,l[15]=(q*ot-H*Re+J*He)*wt,l):null},g.ar=Zt,g.as=function(l){return Math.hypot(l[0],l[1])},g.at=function(l){return l[0]=0,l[1]=0,l},g.au=function(l,r,o){return l[0]=r[0]*o,l[1]=r[1]*o,l},g.av=Ed,g.aw=Bn,g.ax=function(l,r,o,p){const v=r.y-l.y,E=r.x-l.x,A=p.y-o.y,P=p.x-o.x,z=A*E-P*v;if(z===0)return null;const F=(P*(l.y-o.y)-A*(l.x-o.x))/z;return new C(l.x+F*E,l.y+F*v)},g.ay=o_,g.az=Pg,g.b=Ba,g.b$=class extends w{},g.b0=function(l,r,o){return l[0]=r[0]*o,l[1]=r[1]*o,l[2]=r[2]*o,l[3]=r[3]*o,l},g.b1=function(l,r){return l[0]*r[0]+l[1]*r[1]+l[2]*r[2]+l[3]},g.b2=s_,g.b3=Bi,g.b4=function(l,r,o,p,v){var E,A=1/Math.tan(r/2);return l[0]=A/o,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=A,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[11]=-1,l[12]=0,l[13]=0,l[15]=0,v!=null&&v!==1/0?(l[10]=(v+p)*(E=1/(p-v)),l[14]=2*v*p*E):(l[10]=-1,l[14]=-2*p),l},g.b5=function(l){var r=new Xe(16);return r[0]=l[0],r[1]=l[1],r[2]=l[2],r[3]=l[3],r[4]=l[4],r[5]=l[5],r[6]=l[6],r[7]=l[7],r[8]=l[8],r[9]=l[9],r[10]=l[10],r[11]=l[11],r[12]=l[12],r[13]=l[13],r[14]=l[14],r[15]=l[15],r},g.b6=function(l,r,o){var p=Math.sin(o),v=Math.cos(o),E=r[0],A=r[1],P=r[2],z=r[3],F=r[4],q=r[5],H=r[6],J=r[7];return r!==l&&(l[8]=r[8],l[9]=r[9],l[10]=r[10],l[11]=r[11],l[12]=r[12],l[13]=r[13],l[14]=r[14],l[15]=r[15]),l[0]=E*v+F*p,l[1]=A*v+q*p,l[2]=P*v+H*p,l[3]=z*v+J*p,l[4]=F*v-E*p,l[5]=q*v-A*p,l[6]=H*v-P*p,l[7]=J*v-z*p,l},g.b7=function(l,r,o){var p=Math.sin(o),v=Math.cos(o),E=r[4],A=r[5],P=r[6],z=r[7],F=r[8],q=r[9],H=r[10],J=r[11];return r!==l&&(l[0]=r[0],l[1]=r[1],l[2]=r[2],l[3]=r[3],l[12]=r[12],l[13]=r[13],l[14]=r[14],l[15]=r[15]),l[4]=E*v+F*p,l[5]=A*v+q*p,l[6]=P*v+H*p,l[7]=z*v+J*p,l[8]=F*v-E*p,l[9]=q*v-A*p,l[10]=H*v-P*p,l[11]=J*v-z*p,l},g.b8=function(){const l=new Float32Array(16);return Ve(l),l},g.b9=function(){const l=new Float64Array(16);return Ve(l),l},g.bA=function(l,r){const o=lt(l,360),p=lt(r,360),v=p-o,E=p>o?v-360:v+360;return Math.abs(v)<Math.abs(E)?v:E},g.bB=function(l){return l[0]=0,l[1]=0,l[2]=0,l},g.bC=function(l,r,o,p){const v=Math.sqrt(l*l+r*r),E=Math.sqrt(o*o+p*p);l/=v,r/=v,o/=E,p/=E;const A=Math.acos(l*o+r*p);return-r*o+l*p>0?A:-A},g.bD=function(l,r){const o=lt(l,2*Math.PI),p=lt(r,2*Math.PI);return Math.min(Math.abs(o-p),Math.abs(o-p+2*Math.PI),Math.abs(o-p-2*Math.PI))},g.bE=function(){const l={},r=qe.$version;for(const o in qe.$root){const p=qe.$root[o];if(p.required){let v=null;v=o==="version"?r:p.type==="array"?[]:{},v!=null&&(l[o]=v)}}return l},g.bF=ld,g.bG=Ne,g.bH=function l(r,o){if(Array.isArray(r)){if(!Array.isArray(o)||r.length!==o.length)return!1;for(let p=0;p<r.length;p++)if(!l(r[p],o[p]))return!1;return!0}if(typeof r=="object"&&r!==null&&o!==null){if(typeof o!="object"||Object.keys(r).length!==Object.keys(o).length)return!1;for(const p in r)if(!l(r[p],o[p]))return!1;return!0}return r===o},g.bI=function(l){l=l.slice();const r=Object.create(null);for(let o=0;o<l.length;o++)r[l[o].id]=l[o];for(let o=0;o<l.length;o++)"ref"in l[o]&&(l[o]=Fn(l[o],r[l[o].ref]));return l},g.bJ=function(l){if(l.type==="custom")return new Ib(l);switch(l.type){case"background":return new i_(l);case"circle":return new Ly(l);case"color-relief":return new Ny(l);case"fill":return new Ih(l);case"fill-extrusion":return new vi(l);case"heatmap":return new Og(l);case"hillshade":return new Dy(l);case"line":return new fl(l);case"raster":return new _p(l);case"symbol":return new gp(l)}},g.bK=Or,g.bL=function(l,r){if(!l)return[{command:"setStyle",args:[r]}];let o=[];try{if(!rn(l.version,r.version))return[{command:"setStyle",args:[r]}];rn(l.center,r.center)||o.push({command:"setCenter",args:[r.center]}),rn(l.state,r.state)||o.push({command:"setGlobalState",args:[r.state]}),rn(l.centerAltitude,r.centerAltitude)||o.push({command:"setCenterAltitude",args:[r.centerAltitude]}),rn(l.zoom,r.zoom)||o.push({command:"setZoom",args:[r.zoom]}),rn(l.bearing,r.bearing)||o.push({command:"setBearing",args:[r.bearing]}),rn(l.pitch,r.pitch)||o.push({command:"setPitch",args:[r.pitch]}),rn(l.roll,r.roll)||o.push({command:"setRoll",args:[r.roll]}),rn(l.sprite,r.sprite)||o.push({command:"setSprite",args:[r.sprite]}),rn(l.glyphs,r.glyphs)||o.push({command:"setGlyphs",args:[r.glyphs]}),rn(l.transition,r.transition)||o.push({command:"setTransition",args:[r.transition]}),rn(l.light,r.light)||o.push({command:"setLight",args:[r.light]}),rn(l.terrain,r.terrain)||o.push({command:"setTerrain",args:[r.terrain]}),rn(l.sky,r.sky)||o.push({command:"setSky",args:[r.sky]}),rn(l.projection,r.projection)||o.push({command:"setProjection",args:[r.projection]});const p={},v=[];(function(A,P,z,F){let q;for(q in P=P||{},A=A||{})Object.prototype.hasOwnProperty.call(A,q)&&(Object.prototype.hasOwnProperty.call(P,q)||Xi(q,z,F));for(q in P)Object.prototype.hasOwnProperty.call(P,q)&&(Object.prototype.hasOwnProperty.call(A,q)?rn(A[q],P[q])||(A[q].type==="geojson"&&P[q].type==="geojson"&&Mi(A,P,q)?Dn(z,{command:"setGeoJSONSourceData",args:[q,P[q].data]}):Er(q,P,z,F)):wi(q,P,z))})(l.sources,r.sources,v,p);const E=[];l.layers&&l.layers.forEach((A=>{"source"in A&&p[A.source]?o.push({command:"removeLayer",args:[A.id]}):E.push(A)})),o=o.concat(v),(function(A,P,z){P=P||[];const F=(A=A||[]).map(Pn),q=P.map(Pn),H=A.reduce(Vi,{}),J=P.reduce(Vi,{}),ie=F.slice(),re=Object.create(null);let oe,pe,we,He,Re;for(let Fe=0,ot=0;Fe<F.length;Fe++)oe=F[Fe],Object.prototype.hasOwnProperty.call(J,oe)?ot++:(Dn(z,{command:"removeLayer",args:[oe]}),ie.splice(ie.indexOf(oe,ot),1));for(let Fe=0,ot=0;Fe<q.length;Fe++)oe=q[q.length-1-Fe],ie[ie.length-1-Fe]!==oe&&(Object.prototype.hasOwnProperty.call(H,oe)?(Dn(z,{command:"removeLayer",args:[oe]}),ie.splice(ie.lastIndexOf(oe,ie.length-ot),1)):ot++,He=ie[ie.length-Fe],Dn(z,{command:"addLayer",args:[J[oe],He]}),ie.splice(ie.length-Fe,0,oe),re[oe]=!0);for(let Fe=0;Fe<q.length;Fe++)if(oe=q[Fe],pe=H[oe],we=J[oe],!re[oe]&&!rn(pe,we))if(rn(pe.source,we.source)&&rn(pe["source-layer"],we["source-layer"])&&rn(pe.type,we.type)){for(Re in vn(pe.layout,we.layout,z,oe,null,"setLayoutProperty"),vn(pe.paint,we.paint,z,oe,null,"setPaintProperty"),rn(pe.filter,we.filter)||Dn(z,{command:"setFilter",args:[oe,we.filter]}),rn(pe.minzoom,we.minzoom)&&rn(pe.maxzoom,we.maxzoom)||Dn(z,{command:"setLayerZoomRange",args:[oe,we.minzoom,we.maxzoom]}),pe)Object.prototype.hasOwnProperty.call(pe,Re)&&Re!=="layout"&&Re!=="paint"&&Re!=="filter"&&Re!=="metadata"&&Re!=="minzoom"&&Re!=="maxzoom"&&(Re.indexOf("paint.")===0?vn(pe[Re],we[Re],z,oe,Re.slice(6),"setPaintProperty"):rn(pe[Re],we[Re])||Dn(z,{command:"setLayerProperty",args:[oe,Re,we[Re]]}));for(Re in we)Object.prototype.hasOwnProperty.call(we,Re)&&!Object.prototype.hasOwnProperty.call(pe,Re)&&Re!=="layout"&&Re!=="paint"&&Re!=="filter"&&Re!=="metadata"&&Re!=="minzoom"&&Re!=="maxzoom"&&(Re.indexOf("paint.")===0?vn(pe[Re],we[Re],z,oe,Re.slice(6),"setPaintProperty"):rn(pe[Re],we[Re])||Dn(z,{command:"setLayerProperty",args:[oe,Re,we[Re]]}))}else Dn(z,{command:"removeLayer",args:[oe]}),He=ie[ie.lastIndexOf(oe)+1],Dn(z,{command:"addLayer",args:[we,He]})})(E,r.layers,o)}catch(p){console.warn("Unable to compute style diff:",p),o=[{command:"setStyle",args:[r]}]}return o},g.bM=function(l){const r=[],o=l.id;return o===void 0&&r.push({message:`layers.${o}: missing required property "id"`}),l.render===void 0&&r.push({message:`layers.${o}: missing required method "render"`}),l.renderingMode&&l.renderingMode!=="2d"&&l.renderingMode!=="3d"&&r.push({message:`layers.${o}: property "renderingMode" must be either "2d" or "3d"`}),r},g.bN=co,g.bO=Us,g.bP=class extends Ls{constructor(l,r){super(l,r),this.current=0}set(l){this.current!==l&&(this.current=l,this.gl.uniform1i(this.location,l))}},g.bQ=Zr,g.bR=class extends Ls{constructor(l,r){super(l,r),this.current=ro}set(l){if(l[12]!==this.current[12]||l[0]!==this.current[0])return this.current=l,void this.gl.uniformMatrix4fv(this.location,!1,l);for(let r=1;r<16;r++)if(l[r]!==this.current[r]){this.current=l,this.gl.uniformMatrix4fv(this.location,!1,l);break}}},g.bS=kr,g.bT=class extends Ls{constructor(l,r){super(l,r),this.current=[0,0,0]}set(l){l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]||(this.current=l,this.gl.uniform3f(this.location,l[0],l[1],l[2]))}},g.bU=class extends Ls{constructor(l,r){super(l,r),this.current=[0,0]}set(l){l[0]===this.current[0]&&l[1]===this.current[1]||(this.current=l,this.gl.uniform2f(this.location,l[0],l[1]))}},g.bV=Ke,g.bW=function(l,r){var o=Math.sin(r),p=Math.cos(r);return l[0]=p,l[1]=o,l[2]=0,l[3]=-o,l[4]=p,l[5]=0,l[6]=0,l[7]=0,l[8]=1,l},g.bX=function(l,r,o){var p=r[0],v=r[1],E=r[2];return l[0]=p*o[0]+v*o[3]+E*o[6],l[1]=p*o[1]+v*o[4]+E*o[7],l[2]=p*o[2]+v*o[5]+E*o[8],l},g.bY=function(l,r,o,p,v,E,A){var P=1/(r-o),z=1/(p-v),F=1/(E-A);return l[0]=-2*P,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=-2*z,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=2*F,l[11]=0,l[12]=(r+o)*P,l[13]=(v+p)*z,l[14]=(A+E)*F,l[15]=1,l},g.bZ=class extends Ls{constructor(l,r){super(l,r),this.current=new Array}set(l){if(l!=this.current){this.current=l;const r=new Float32Array(4*l.length);for(let o=0;o<l.length;o++)r[4*o]=l[o].r,r[4*o+1]=l[o].g,r[4*o+2]=l[o].b,r[4*o+3]=l[o].a;this.gl.uniform4fv(this.location,r)}}},g.b_=class extends Ls{constructor(l,r){super(l,r),this.current=new Array}set(l){if(l!=this.current){this.current=l;const r=new Float32Array(l);this.gl.uniform1fv(this.location,r)}}},g.ba=function(){return new Float64Array(16)},g.bb=function(l,r,o){const p=new Float64Array(4);return gt(p,l,r-90,o),p},g.bc=function(l,r,o,p){var v,E,A,P,z,F=r[0],q=r[1],H=r[2],J=r[3],ie=o[0],re=o[1],oe=o[2],pe=o[3];return(E=F*ie+q*re+H*oe+J*pe)<0&&(E=-E,ie=-ie,re=-re,oe=-oe,pe=-pe),1-E>Qe?(v=Math.acos(E),A=Math.sin(v),P=Math.sin((1-p)*v)/A,z=Math.sin(p*v)/A):(P=1-p,z=p),l[0]=P*F+z*ie,l[1]=P*q+z*re,l[2]=P*H+z*oe,l[3]=P*J+z*pe,l},g.bd=function(l){const r=new Float64Array(9);var o,p,v,E,A,P,z,F,q,H,J,ie,re,oe,pe,we,He,Re;H=(v=(p=l)[0])*(z=v+v),J=(E=p[1])*z,re=(A=p[2])*z,oe=A*(F=E+E),we=(P=p[3])*z,He=P*F,Re=P*(q=A+A),(o=r)[0]=1-(ie=E*F)-(pe=A*q),o[3]=J-Re,o[6]=re+He,o[1]=J+Re,o[4]=1-H-pe,o[7]=oe-we,o[2]=re-He,o[5]=oe+we,o[8]=1-H-ie;const Fe=fs(-Math.asin(Ft(r[2],-1,1)));let ot,_t;return Math.hypot(r[5],r[8])<.001?(ot=0,_t=-fs(Math.atan2(r[3],r[4]))):(ot=fs(r[5]===0&&r[8]===0?0:Math.atan2(r[5],r[8])),_t=fs(r[1]===0&&r[0]===0?0:Math.atan2(r[1],r[0]))),{roll:ot,pitch:Fe+90,bearing:_t}},g.be=function(l,r){return l.roll==r.roll&&l.pitch==r.pitch&&l.bearing==r.bearing},g.bf=Mn,g.bg=ac,g.bh=dl,g.bi=sf,g.bj=hr,g.bk=Dt,g.bl=zt,g.bm=Oi,g.bn=function(l,r,o,p,v){return Dt(p,v,Ft((l-r)/(o-r),0,1))},g.bo=lt,g.bp=function(){return new Float64Array(3)},g.bq=function(l,r,o,p){return l[0]=r[0]+o[0]*p,l[1]=r[1]+o[1]*p,l[2]=r[2]+o[2]*p,l},g.br=gt,g.bs=function(l,r,o){var p=o[0],v=o[1],E=o[2],A=r[0],P=r[1],z=r[2],F=v*z-E*P,q=E*A-p*z,H=p*P-v*A,J=v*H-E*q,ie=E*F-p*H,re=p*q-v*F,oe=2*o[3];return q*=oe,H*=oe,ie*=2,re*=2,l[0]=A+(F*=oe)+(J*=2),l[1]=P+q+ie,l[2]=z+H+re,l},g.bt=function(l,r,o){const p=(v=[l[0],l[1],l[2],r[0],r[1],r[2],o[0],o[1],o[2]])[0]*((q=v[8])*(A=v[4])-(P=v[5])*(F=v[7]))+v[1]*(-q*(E=v[3])+P*(z=v[6]))+v[2]*(F*E-A*z);var v,E,A,P,z,F,q;if(p===0)return null;const H=De([],[r[0],r[1],r[2]],[o[0],o[1],o[2]]),J=De([],[o[0],o[1],o[2]],[l[0],l[1],l[2]]),ie=De([],[l[0],l[1],l[2]],[r[0],r[1],r[2]]),re=Ee([],H,-l[3]);return me(re,re,Ee([],J,-r[3])),me(re,re,Ee([],ie,-o[3])),Ee(re,re,1/p),re},g.bu=yp,g.bv=function(){return new Float64Array(4)},g.bw=function(l,r,o,p){var v=[],E=[];return v[0]=r[0]-o[0],v[1]=r[1]-o[1],v[2]=r[2]-o[2],E[0]=v[0]*Math.cos(p)-v[1]*Math.sin(p),E[1]=v[0]*Math.sin(p)+v[1]*Math.cos(p),E[2]=v[2],l[0]=E[0]+o[0],l[1]=E[1]+o[1],l[2]=E[2]+o[2],l},g.bx=function(l,r,o,p){var v=[],E=[];return v[0]=r[0]-o[0],v[1]=r[1]-o[1],v[2]=r[2]-o[2],E[0]=v[0],E[1]=v[1]*Math.cos(p)-v[2]*Math.sin(p),E[2]=v[1]*Math.sin(p)+v[2]*Math.cos(p),l[0]=E[0]+o[0],l[1]=E[1]+o[1],l[2]=E[2]+o[2],l},g.by=function(l,r,o,p){var v=[],E=[];return v[0]=r[0]-o[0],v[1]=r[1]-o[1],v[2]=r[2]-o[2],E[0]=v[2]*Math.sin(p)+v[0]*Math.cos(p),E[1]=v[1],E[2]=v[2]*Math.cos(p)-v[0]*Math.sin(p),l[0]=E[0]+o[0],l[1]=E[1]+o[1],l[2]=E[2]+o[2],l},g.bz=function(l,r,o){var p=Math.sin(o),v=Math.cos(o),E=r[0],A=r[1],P=r[2],z=r[3],F=r[8],q=r[9],H=r[10],J=r[11];return r!==l&&(l[4]=r[4],l[5]=r[5],l[6]=r[6],l[7]=r[7],l[12]=r[12],l[13]=r[13],l[14]=r[14],l[15]=r[15]),l[0]=E*v-F*p,l[1]=A*v-q*p,l[2]=P*v-H*p,l[3]=z*v-J*p,l[8]=E*p+F*v,l[9]=A*p+q*v,l[10]=P*p+H*v,l[11]=z*p+J*v,l},g.c=je,g.c0=oo,g.c1=class extends u{},g.c2=_m,g.c3=function(l){return l<=1?1:Math.pow(2,Math.ceil(Math.log(l)/Math.LN2))},g.c4=gm,g.c5=function(l,r,o){var p=r[0],v=r[1],E=r[2],A=o[3]*p+o[7]*v+o[11]*E+o[15];return l[0]=(o[0]*p+o[4]*v+o[8]*E+o[12])/(A=A||1),l[1]=(o[1]*p+o[5]*v+o[9]*E+o[13])/A,l[2]=(o[2]*p+o[6]*v+o[10]*E+o[14])/A,l},g.c6=class extends ks{},g.c7=class extends j{},g.c8=function(l,r){return l[0]===r[0]&&l[1]===r[1]&&l[2]===r[2]&&l[3]===r[3]&&l[4]===r[4]&&l[5]===r[5]&&l[6]===r[6]&&l[7]===r[7]&&l[8]===r[8]&&l[9]===r[9]&&l[10]===r[10]&&l[11]===r[11]&&l[12]===r[12]&&l[13]===r[13]&&l[14]===r[14]&&l[15]===r[15]},g.c9=function(l,r){var o=l[0],p=l[1],v=l[2],E=l[3],A=l[4],P=l[5],z=l[6],F=l[7],q=l[8],H=l[9],J=l[10],ie=l[11],re=l[12],oe=l[13],pe=l[14],we=l[15],He=r[0],Re=r[1],Fe=r[2],ot=r[3],_t=r[4],It=r[5],$t=r[6],Nt=r[7],Ut=r[8],hn=r[9],Gt=r[10],qt=r[11],wt=r[12],En=r[13],Ln=r[14],xn=r[15];return Math.abs(o-He)<=Qe*Math.max(1,Math.abs(o),Math.abs(He))&&Math.abs(p-Re)<=Qe*Math.max(1,Math.abs(p),Math.abs(Re))&&Math.abs(v-Fe)<=Qe*Math.max(1,Math.abs(v),Math.abs(Fe))&&Math.abs(E-ot)<=Qe*Math.max(1,Math.abs(E),Math.abs(ot))&&Math.abs(A-_t)<=Qe*Math.max(1,Math.abs(A),Math.abs(_t))&&Math.abs(P-It)<=Qe*Math.max(1,Math.abs(P),Math.abs(It))&&Math.abs(z-$t)<=Qe*Math.max(1,Math.abs(z),Math.abs($t))&&Math.abs(F-Nt)<=Qe*Math.max(1,Math.abs(F),Math.abs(Nt))&&Math.abs(q-Ut)<=Qe*Math.max(1,Math.abs(q),Math.abs(Ut))&&Math.abs(H-hn)<=Qe*Math.max(1,Math.abs(H),Math.abs(hn))&&Math.abs(J-Gt)<=Qe*Math.max(1,Math.abs(J),Math.abs(Gt))&&Math.abs(ie-qt)<=Qe*Math.max(1,Math.abs(ie),Math.abs(qt))&&Math.abs(re-wt)<=Qe*Math.max(1,Math.abs(re),Math.abs(wt))&&Math.abs(oe-En)<=Qe*Math.max(1,Math.abs(oe),Math.abs(En))&&Math.abs(pe-Ln)<=Qe*Math.max(1,Math.abs(pe),Math.abs(Ln))&&Math.abs(we-xn)<=Qe*Math.max(1,Math.abs(we),Math.abs(xn))},g.cA=function(l,r){se.REGISTERED_PROTOCOLS[l]=r},g.cB=function(l){delete se.REGISTERED_PROTOCOLS[l]},g.cC=function(l,r){const o={};for(let v=0;v<l.length;v++){const E=r&&r[l[v].id]||wo(l[v]);r&&(r[l[v].id]=E);let A=o[E];A||(A=o[E]=[]),A.push(l[v])}const p=[];for(const v in o)p.push(o[v]);return p},g.cD=Kt,g.cE=hv,g.cF=Nm,g.cG=ev,g.cH=function(l){l.bucket.createArrays(),l.bucket.tilePixelRatio=jt/(512*l.bucket.overscaling),l.bucket.compareText={},l.bucket.iconsNeedLinear=!1;const r=l.bucket.layers[0],o=r.layout,p=r._unevaluatedLayout._values,v={layoutIconSize:p["icon-size"].possiblyEvaluate(new rr(l.bucket.zoom+1),l.canonical),layoutTextSize:p["text-size"].possiblyEvaluate(new rr(l.bucket.zoom+1),l.canonical),textMaxSize:p["text-size"].possiblyEvaluate(new rr(18))};if(l.bucket.textSizeData.kind==="composite"){const{minZoom:F,maxZoom:q}=l.bucket.textSizeData;v.compositeTextSizes=[p["text-size"].possiblyEvaluate(new rr(F),l.canonical),p["text-size"].possiblyEvaluate(new rr(q),l.canonical)]}if(l.bucket.iconSizeData.kind==="composite"){const{minZoom:F,maxZoom:q}=l.bucket.iconSizeData;v.compositeIconSizes=[p["icon-size"].possiblyEvaluate(new rr(F),l.canonical),p["icon-size"].possiblyEvaluate(new rr(q),l.canonical)]}const E=o.get("text-line-height")*Hr,A=o.get("text-rotation-alignment")!=="viewport"&&o.get("symbol-placement")!=="point",P=o.get("text-keep-upright"),z=o.get("text-size");for(const F of l.bucket.features){const q=o.get("text-font").evaluate(F,{},l.canonical).join(","),H=z.evaluate(F,{},l.canonical),J=v.layoutTextSize.evaluate(F,{},l.canonical),ie=v.layoutIconSize.evaluate(F,{},l.canonical),re={horizontal:{},vertical:void 0},oe=F.text;let pe,we=[0,0];if(oe){const Fe=oe.toString(),ot=o.get("text-letter-spacing").evaluate(F,{},l.canonical)*Hr,_t=Xf(Fe)?ot:0,It=o.get("text-anchor").evaluate(F,{},l.canonical),$t=c_(r,F,l.canonical);if(!$t){const Gt=o.get("text-radial-offset").evaluate(F,{},l.canonical);we=Gt?$l(It,[Gt*Hr,Pd]):o.get("text-offset").evaluate(F,{},l.canonical).map((qt=>qt*Hr))}let Nt=A?"center":o.get("text-justify").evaluate(F,{},l.canonical);const Ut=o.get("symbol-placement")==="point"?o.get("text-max-width").evaluate(F,{},l.canonical)*Hr:1/0,hn=()=>{l.bucket.allowVerticalPlacement&&zl(Fe)&&(re.vertical=hp(oe,l.glyphMap,l.glyphPositions,l.imagePositions,q,Ut,E,It,"left",_t,we,g.ao.vertical,!0,J,H))};if(!A&&$t){const Gt=new Set;if(Nt==="auto")for(let wt=0;wt<$t.values.length;wt+=2)Gt.add(vf($t.values[wt]));else Gt.add(Nt);let qt=!1;for(const wt of Gt)if(!re.horizontal[wt])if(qt)re.horizontal[wt]=re.horizontal[0];else{const En=hp(oe,l.glyphMap,l.glyphPositions,l.imagePositions,q,Ut,E,"center",wt,_t,we,g.ao.horizontal,!1,J,H);En&&(re.horizontal[wt]=En,qt=En.positionedLines.length===1)}hn()}else{Nt==="auto"&&(Nt=vf(It));const Gt=hp(oe,l.glyphMap,l.glyphPositions,l.imagePositions,q,Ut,E,It,Nt,_t,we,g.ao.horizontal,!1,J,H);Gt&&(re.horizontal[Nt]=Gt),hn(),zl(Fe)&&A&&P&&(re.vertical=hp(oe,l.glyphMap,l.glyphPositions,l.imagePositions,q,Ut,E,It,Nt,_t,we,g.ao.vertical,!1,J,H))}}let He=!1;if(F.icon&&F.icon.name){const Fe=l.imageMap[F.icon.name];Fe&&(pe=Sb(l.imagePositions[F.icon.name],o.get("icon-offset").evaluate(F,{},l.canonical),o.get("icon-anchor").evaluate(F,{},l.canonical)),He=!!Fe.sdf,l.bucket.sdfIcons===void 0?l.bucket.sdfIcons=He:l.bucket.sdfIcons!==He&&er("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Fe.pixelRatio!==l.bucket.pixelRatio||o.get("icon-rotate").constantOr(1)!==0)&&(l.bucket.iconsNeedLinear=!0))}const Re=yv(re.horizontal)||re.vertical;l.bucket.iconsInText=!!Re&&Re.iconsInText,(Re||pe)&&Yc(l.bucket,F,re,pe,l.imageMap,v,J,ie,we,He,l.canonical,l.subdivisionGranularity)}l.showCollisionBoxes&&l.bucket.generateCollisionDebugBuffers()},g.cI=cc,g.cJ=No,g.cK=df,g.cL=$g,g.cM=wd,g.cN=class{constructor(l){this._marks={start:[l.url,"start"].join("#"),end:[l.url,"end"].join("#"),measure:l.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let l=performance.getEntriesByName(this._marks.measure);return l.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),l=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),l}},g.cO=function(l,r,o,p,v){return c(this,void 0,void 0,(function*(){if(et())try{return yield fr(l,r,o,p,v)}catch{}return(function(E,A,P,z,F){const q=E.width,H=E.height;fa&&Po||(fa=new OffscreenCanvas(q,H),Po=fa.getContext("2d",{willReadFrequently:!0})),fa.width=q,fa.height=H,Po.drawImage(E,0,0,q,H);const J=Po.getImageData(A,P,z,F);return Po.clearRect(0,0,q,H),J.data})(l,r,o,p,v)}))},g.cP=vm,g.cQ=k,g.cR=uf,g.cS=bd,g.cT=il,g.cU=function(l,r){const o=new Map;if(l!=null)if(l.type==="Feature")o.set(Id(l,r),l);else for(const p of l.features)o.set(Id(p,r),p);return o},g.cV=function(l,r){if(l==null)return!0;if(l.type==="Feature")return Id(l,r)!=null;if(l.type==="FeatureCollection"){const o=new Set;for(const p of l.features){const v=Id(p,r);if(v==null||o.has(v))return!1;o.add(v)}return!0}return!1},g.cW=function(l,r,o){var p,v,E,A;if(r.removeAll&&l.clear(),r.remove)for(const P of r.remove)l.delete(P);if(r.add)for(const P of r.add){const z=Id(P,o);z!=null&&l.set(z,P)}if(r.update)for(const P of r.update){let z=l.get(P.id);if(z==null)continue;const F=!P.removeAllProperties&&(((p=P.removeProperties)===null||p===void 0?void 0:p.length)>0||((v=P.addOrUpdateProperties)===null||v===void 0?void 0:v.length)>0);if((P.newGeometry||P.removeAllProperties||F)&&(z=Object.assign({},z),l.set(P.id,z),F&&(z.properties=Object.assign({},z.properties))),P.newGeometry&&(z.geometry=P.newGeometry),P.removeAllProperties)z.properties={};else if(((E=P.removeProperties)===null||E===void 0?void 0:E.length)>0)for(const q of P.removeProperties)Object.prototype.hasOwnProperty.call(z.properties,q)&&delete z.properties[q];if(((A=P.addOrUpdateProperties)===null||A===void 0?void 0:A.length)>0)for(const{key:q,value:H}of P.addOrUpdateProperties)z.properties[q]=H}},g.cX=Rs,g.ca=function(l,r){return l[0]=r[0],l[1]=r[1],l[2]=r[2],l[3]=r[3],l[4]=r[4],l[5]=r[5],l[6]=r[6],l[7]=r[7],l[8]=r[8],l[9]=r[9],l[10]=r[10],l[11]=r[11],l[12]=r[12],l[13]=r[13],l[14]=r[14],l[15]=r[15],l},g.cb=l=>l.type==="symbol",g.cc=l=>l.type==="circle",g.cd=l=>l.type==="heatmap",g.ce=l=>l.type==="line",g.cf=l=>l.type==="fill",g.cg=l=>l.type==="fill-extrusion",g.ch=l=>l.type==="hillshade",g.ci=l=>l.type==="color-relief",g.cj=l=>l.type==="raster",g.ck=l=>l.type==="background",g.cl=l=>l.type==="custom",g.cm=Xt,g.cn=function(l,r,o){const p=xt(r.x-o.x,r.y-o.y),v=xt(l.x-o.x,l.y-o.y);var E,A;return fs(Math.atan2(p[0]*v[1]-p[1]*v[0],(E=p)[0]*(A=v)[0]+E[1]*A[1]))},g.co=an,g.cp=function(l,r){return pr[r]&&(l instanceof MouseEvent||l instanceof WheelEvent)},g.cq=function(l,r){return Ta[r]&&"touches"in l},g.cr=function(l){return Ta[l]||pr[l]},g.cs=function(l,r,o){var p=r[0],v=r[1];return l[0]=o[0]*p+o[4]*v+o[12],l[1]=o[1]*p+o[5]*v+o[13],l},g.ct=function(l,r){const{x:o,y:p}=bp.fromLngLat(r);return!(l<0||l>25||p<0||p>=1||o<0||o>=1)},g.cu=function(l,r){return l[0]=r[0],l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=r[1],l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=r[2],l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l},g.cv=class extends tc{},g.cw=xf,g.cy=function(l){return l.message===pa},g.cz=Se,g.d=Je,g.e=qn,g.f=l=>c(void 0,void 0,void 0,(function*(){if(l.byteLength===0)return createImageBitmap(new ImageData(1,1));const r=new Blob([new Uint8Array(l)],{type:"image/png"});try{return createImageBitmap(r)}catch(o){throw new Error(`Could not load image because of ${o.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}})),g.g=le,g.h=l=>new Promise(((r,o)=>{const p=new Image;p.onload=()=>{r(p),URL.revokeObjectURL(p.src),p.onload=null,window.requestAnimationFrame((()=>{p.src=Fi}))},p.onerror=()=>o(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const v=new Blob([new Uint8Array(l)],{type:"image/png"});p.src=l.byteLength?URL.createObjectURL(v):Fi})),g.i=Xa,g.j=(l,r)=>Ge(qn(l,{type:"json"}),r),g.k=bt,g.l=At,g.m=Ge,g.n=(l,r)=>Ge(qn(l,{type:"arrayBuffer"}),r),g.o=function(l){return new wd(l).readFields(Yy,[])},g.p=Cm,g.q=pd,g.r=no,g.s=js,g.t=Qd,g.u=ai,g.v=qe,g.w=er,g.x=um,g.y=yh,g.z=_h})),h("worker",["./shared"],(function(g){class c{constructor(se){this.keyCache={},se&&this.replace(se)}replace(se){this._layerConfigs={},this._layers={},this.update(se,[])}update(se,le){for(const Se of se){this._layerConfigs[Se.id]=Se;const Ne=this._layers[Se.id]=g.bJ(Se);Ne._featureFilter=g.aa(Ne.filter),this.keyCache[Se.id]&&delete this.keyCache[Se.id]}for(const Se of le)delete this.keyCache[Se],delete this._layerConfigs[Se],delete this._layers[Se];this.familiesBySource={};const fe=g.cC(Object.values(this._layerConfigs),this.keyCache);for(const Se of fe){const Ne=Se.map((bt=>this._layers[bt.id])),Ge=Ne[0];if(Ge.visibility==="none")continue;const Je=Ge.source||"";let Ze=this.familiesBySource[Je];Ze||(Ze=this.familiesBySource[Je]={});const yt=Ge.sourceLayer||"_geojsonTileLayer";let At=Ze[yt];At||(At=Ze[yt]=[]),At.push(Ne)}}}class C{constructor(se){const le={},fe=[];for(const Je in se){const Ze=se[Je],yt=le[Je]={};for(const At in Ze){const bt=Ze[+At];if(!bt||bt.bitmap.width===0||bt.bitmap.height===0)continue;const en={x:0,y:0,w:bt.bitmap.width+2,h:bt.bitmap.height+2};fe.push(en),yt[At]={rect:en,metrics:bt.metrics}}}const{w:Se,h:Ne}=g.p(fe),Ge=new g.q({width:Se||1,height:Ne||1});for(const Je in se){const Ze=se[Je];for(const yt in Ze){const At=Ze[+yt];if(!At||At.bitmap.width===0||At.bitmap.height===0)continue;const bt=le[Je][yt].rect;g.q.copy(At.bitmap,Ge,{x:0,y:0},{x:bt.x+1,y:bt.y+1},At.bitmap)}}this.image=Ge,this.positions=le}}g.cD("GlyphAtlas",C);class k{constructor(se){this.tileID=new g.Z(se.tileID.overscaledZ,se.tileID.wrap,se.tileID.canonical.z,se.tileID.canonical.x,se.tileID.canonical.y),this.uid=se.uid,this.zoom=se.zoom,this.pixelRatio=se.pixelRatio,this.tileSize=se.tileSize,this.source=se.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=se.showCollisionBoxes,this.collectResourceTiming=!!se.collectResourceTiming,this.returnDependencies=!!se.returnDependencies,this.promoteId=se.promoteId,this.inFlightDependencies=[],this.globalState=se.globalState}parse(se,le,fe,Se,Ne){return g._(this,void 0,void 0,(function*(){this.status="parsing",this.data=se,this.collisionBoxArray=new g.a8;const Ge=new g.cE(Object.keys(se.layers).sort()),Je=new g.cF(this.tileID,this.promoteId);Je.bucketLayerIDs=[];const Ze={},yt={featureIndex:Je,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:fe,subdivisionGranularity:Ne},At=le.familiesBySource[this.source];for(const vn in At){const Pn=se.layers[vn];if(!Pn)continue;Pn.version===1&&g.w(`Vector tile source "${this.source}" layer "${vn}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Vi=Ge.encode(vn),Ct=[];for(let Qt=0;Qt<Pn.length;Qt++){const tr=Pn.feature(Qt),la=Je.getId(tr,vn);Ct.push({feature:tr,id:la,index:Qt,sourceLayerIndex:Vi})}for(const Qt of At[vn]){const tr=Qt[0];tr.source!==this.source&&g.w(`layer.source = ${tr.source} does not equal this.source = ${this.source}`),tr.minzoom&&this.zoom<Math.floor(tr.minzoom)||tr.maxzoom&&this.zoom>=tr.maxzoom||tr.visibility!=="none"&&(V(Qt,this.zoom,fe),(Ze[tr.id]=tr.createBucket({index:Je.bucketLayerIDs.length,layers:Qt,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Vi,sourceID:this.source,globalState:this.globalState})).populate(Ct,yt,this.tileID.canonical),Je.bucketLayerIDs.push(Qt.map((la=>la.id))))}}const bt=g.bN(yt.glyphDependencies,(vn=>Object.keys(vn).map(Number)));this.inFlightDependencies.forEach((vn=>vn==null?void 0:vn.abort())),this.inFlightDependencies=[];let en=Promise.resolve({});if(Object.keys(bt).length){const vn=new AbortController;this.inFlightDependencies.push(vn),en=Se.sendAsync({type:"GG",data:{stacks:bt,source:this.source,tileID:this.tileID,type:"glyphs"}},vn)}const qe=Object.keys(yt.iconDependencies);let Cn=Promise.resolve({});if(qe.length){const vn=new AbortController;this.inFlightDependencies.push(vn),Cn=Se.sendAsync({type:"GI",data:{icons:qe,source:this.source,tileID:this.tileID,type:"icons"}},vn)}const Fn=Object.keys(yt.patternDependencies);let rn=Promise.resolve({});if(Fn.length){const vn=new AbortController;this.inFlightDependencies.push(vn),rn=Se.sendAsync({type:"GI",data:{icons:Fn,source:this.source,tileID:this.tileID,type:"patterns"}},vn)}const[Dn,wi,Xi]=yield Promise.all([en,Cn,rn]),Er=new C(Dn),Mi=new g.cG(wi,Xi);for(const vn in Ze){const Pn=Ze[vn];Pn instanceof g.a9?(V(Pn.layers,this.zoom,fe),g.cH({bucket:Pn,glyphMap:Dn,glyphPositions:Er.positions,imageMap:wi,imagePositions:Mi.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:yt.subdivisionGranularity})):Pn.hasPattern&&(Pn instanceof g.cI||Pn instanceof g.cJ||Pn instanceof g.cK)&&(V(Pn.layers,this.zoom,fe),Pn.addFeatures(yt,this.tileID.canonical,Mi.patternPositions))}return this.status="done",{buckets:Object.values(Ze).filter((vn=>!vn.isEmpty())),featureIndex:Je,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Er.image,imageAtlas:Mi,glyphMap:this.returnDependencies?Dn:null,iconMap:this.returnDependencies?wi:null,glyphPositions:this.returnDependencies?Er.positions:null}}))}}function V(je,se,le){const fe=new g.F(se);for(const Se of je)Se.recalculate(fe,le)}class Z{constructor(se,le,fe){this.actor=se,this.layerIndex=le,this.availableImages=fe,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(se,le){return g._(this,void 0,void 0,(function*(){const fe=yield g.n(se.request,le);try{return{vectorTile:new g.cL(new g.cM(fe.data)),rawData:fe.data,cacheControl:fe.cacheControl,expires:fe.expires}}catch(Se){const Ne=new Uint8Array(fe.data);let Ge=`Unable to parse the tile at ${se.request.url}, `;throw Ge+=Ne[0]===31&&Ne[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${Se.message}`,new Error(Ge)}}))}loadTile(se){return g._(this,void 0,void 0,(function*(){const le=se.uid,fe=!!(se&&se.request&&se.request.collectResourceTiming)&&new g.cN(se.request),Se=new k(se);this.loading[le]=Se;const Ne=new AbortController;Se.abort=Ne;try{const Ge=yield this.loadVectorTile(se,Ne);if(delete this.loading[le],!Ge)return null;const Je=Ge.rawData,Ze={};Ge.expires&&(Ze.expires=Ge.expires),Ge.cacheControl&&(Ze.cacheControl=Ge.cacheControl);const yt={};if(fe){const bt=fe.finish();bt&&(yt.resourceTiming=JSON.parse(JSON.stringify(bt)))}Se.vectorTile=Ge.vectorTile;const At=Se.parse(Ge.vectorTile,this.layerIndex,this.availableImages,this.actor,se.subdivisionGranularity);this.loaded[le]=Se,this.fetching[le]={rawTileData:Je,cacheControl:Ze,resourceTiming:yt};try{const bt=yield At;return g.e({rawTileData:Je.slice(0)},bt,Ze,yt)}finally{delete this.fetching[le]}}catch(Ge){throw delete this.loading[le],Se.status="done",this.loaded[le]=Se,Ge}}))}reloadTile(se){return g._(this,void 0,void 0,(function*(){const le=se.uid;if(!this.loaded||!this.loaded[le])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const fe=this.loaded[le];if(fe.showCollisionBoxes=se.showCollisionBoxes,fe.globalState=se.globalState,fe.status==="parsing"){const Se=yield fe.parse(fe.vectorTile,this.layerIndex,this.availableImages,this.actor,se.subdivisionGranularity);let Ne;if(this.fetching[le]){const{rawTileData:Ge,cacheControl:Je,resourceTiming:Ze}=this.fetching[le];delete this.fetching[le],Ne=g.e({rawTileData:Ge.slice(0)},Se,Je,Ze)}else Ne=Se;return Ne}if(fe.status==="done"&&fe.vectorTile)return fe.parse(fe.vectorTile,this.layerIndex,this.availableImages,this.actor,se.subdivisionGranularity)}))}abortTile(se){return g._(this,void 0,void 0,(function*(){const le=this.loading,fe=se.uid;le&&le[fe]&&le[fe].abort&&(le[fe].abort.abort(),delete le[fe])}))}removeTile(se){return g._(this,void 0,void 0,(function*(){this.loaded&&this.loaded[se.uid]&&delete this.loaded[se.uid]}))}}class Y{constructor(){this.loaded={}}loadTile(se){return g._(this,void 0,void 0,(function*(){const{uid:le,encoding:fe,rawImageData:Se,redFactor:Ne,greenFactor:Ge,blueFactor:Je,baseShift:Ze}=se,yt=Se.width+2,At=Se.height+2,bt=g.b(Se)?new g.R({width:yt,height:At},yield g.cO(Se,-1,-1,yt,At)):Se,en=new g.cP(le,bt,fe,Ne,Ge,Je,Ze);return this.loaded=this.loaded||{},this.loaded[le]=en,en}))}removeTile(se){const le=this.loaded,fe=se.uid;le&&le[fe]&&delete le[fe]}}var Q,be,xe=(function(){if(be)return Q;function je(le,fe){if(le.length!==0){se(le[0],fe);for(var Se=1;Se<le.length;Se++)se(le[Se],!fe)}}function se(le,fe){for(var Se=0,Ne=0,Ge=0,Je=le.length,Ze=Je-1;Ge<Je;Ze=Ge++){var yt=(le[Ge][0]-le[Ze][0])*(le[Ze][1]+le[Ge][1]),At=Se+yt;Ne+=Math.abs(Se)>=Math.abs(yt)?Se-At+yt:yt-At+Se,Se=At}Se+Ne>=0!=!!fe&&le.reverse()}return be=1,Q=function le(fe,Se){var Ne,Ge=fe&&fe.type;if(Ge==="FeatureCollection")for(Ne=0;Ne<fe.features.length;Ne++)le(fe.features[Ne],Se);else if(Ge==="GeometryCollection")for(Ne=0;Ne<fe.geometries.length;Ne++)le(fe.geometries[Ne],Se);else if(Ge==="Feature")le(fe.geometry,Se);else if(Ge==="Polygon")je(fe.coordinates,Se);else if(Ge==="MultiPolygon")for(Ne=0;Ne<fe.coordinates.length;Ne++)je(fe.coordinates[Ne],Se);return fe}})(),ze=g.cQ(xe);class et extends g.cS{constructor(se,le){super(new g.cM,0,le,[],[]),this.feature=se,this.type=se.type,this.properties=se.tags?se.tags:{},"id"in se&&(typeof se.id=="string"?this.id=parseInt(se.id,10):typeof se.id!="number"||isNaN(se.id)||(this.id=se.id))}loadGeometry(){const se=[],le=this.feature.type===1?[this.feature.geometry]:this.feature.geometry;for(const fe of le){const Se=[];for(const Ne of fe)Se.push(new g.P(Ne[0],Ne[1]));se.push(Se)}return se}}class Qe extends g.cR{constructor(se,le){super(new g.cM),this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.version=le?le.version:1,this.extent=le?le.extent:4096,this.length=se.length,this.features=se}feature(se){return new et(this.features[se],this.extent)}}function Xe(je,se){se.writeVarintField(15,je.version||1),se.writeStringField(1,je.name||""),se.writeVarintField(5,je.extent||4096);const le={keys:[],values:[],keycache:{},valuecache:{}};for(let Ne=0;Ne<je.length;Ne++)le.feature=je.feature(Ne),se.writeMessage(2,Ke,le);const fe=le.keys;for(const Ne of fe)se.writeStringField(3,Ne);const Se=le.values;for(const Ne of Se)se.writeMessage(4,me,Ne)}function Ke(je,se){if(!je.feature)return;const le=je.feature;le.id!==void 0&&se.writeVarintField(1,le.id),se.writeMessage(2,Ve,je),se.writeVarintField(3,le.type),se.writeMessage(4,ce,le)}function Ve(je,se){var le;for(const fe in(le=je.feature)==null?void 0:le.properties){let Se=je.feature.properties[fe],Ne=je.keycache[fe];if(Se===null)continue;Ne===void 0&&(je.keys.push(fe),Ne=je.keys.length-1,je.keycache[fe]=Ne),se.writeVarint(Ne),typeof Se!="string"&&typeof Se!="boolean"&&typeof Se!="number"&&(Se=JSON.stringify(Se));const Ge=typeof Se+":"+Se;let Je=je.valuecache[Ge];Je===void 0&&(je.values.push(Se),Je=je.values.length-1,je.valuecache[Ge]=Je),se.writeVarint(Je)}}function it(je,se){return(se<<3)+(7&je)}function de(je){return je<<1^je>>31}function ce(je,se){const le=je.loadGeometry(),fe=je.type;let Se=0,Ne=0;for(const Ge of le){let Je=1;fe===1&&(Je=Ge.length),se.writeVarint(it(1,Je));const Ze=fe===3?Ge.length-1:Ge.length;for(let yt=0;yt<Ze;yt++){yt===1&&fe!==1&&se.writeVarint(it(2,Ze-1));const At=Ge[yt].x-Se,bt=Ge[yt].y-Ne;se.writeVarint(de(At)),se.writeVarint(de(bt)),Se+=At,Ne+=bt}je.type===3&&se.writeVarint(it(7,1))}}function me(je,se){const le=typeof je;le==="string"?se.writeStringField(1,je):le==="boolean"?se.writeBooleanField(7,je):le==="number"&&(je%1!=0?se.writeDoubleField(3,je):je<0?se.writeSVarintField(6,je):se.writeVarintField(5,je))}const Ee={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:je=>je},De=Math.fround||($e=new Float32Array(1),je=>($e[0]=+je,$e[0]));var $e;class ke{constructor(se){this.options=Object.assign(Object.create(Ee),se),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(se){const{log:le,minZoom:fe,maxZoom:Se}=this.options;le&&console.time("total time");const Ne=`prepare ${se.length} points`;le&&console.time(Ne),this.points=se;const Ge=[];for(let Ze=0;Ze<se.length;Ze++){const yt=se[Ze];if(!yt.geometry)continue;const[At,bt]=yt.geometry.coordinates,en=De(gt(At)),qe=De(Zt(bt));Ge.push(en,qe,1/0,Ze,-1,1),this.options.reduce&&Ge.push(0)}let Je=this.trees[Se+1]=this._createTree(Ge);le&&console.timeEnd(Ne);for(let Ze=Se;Ze>=fe;Ze--){const yt=+Date.now();Je=this.trees[Ze]=this._createTree(this._cluster(Je,Ze)),le&&console.log("z%d: %d clusters in %dms",Ze,Je.numItems,+Date.now()-yt)}return le&&console.timeEnd("total time"),this}getClusters(se,le){let fe=((se[0]+180)%360+360)%360-180;const Se=Math.max(-90,Math.min(90,se[1]));let Ne=se[2]===180?180:((se[2]+180)%360+360)%360-180;const Ge=Math.max(-90,Math.min(90,se[3]));if(se[2]-se[0]>=360)fe=-180,Ne=180;else if(fe>Ne){const bt=this.getClusters([fe,Se,180,Ge],le),en=this.getClusters([-180,Se,Ne,Ge],le);return bt.concat(en)}const Je=this.trees[this._limitZoom(le)],Ze=Je.range(gt(fe),Zt(Ge),gt(Ne),Zt(Se)),yt=Je.data,At=[];for(const bt of Ze){const en=this.stride*bt;At.push(yt[en+5]>1?Bn(yt,en,this.clusterProps):this.points[yt[en+3]])}return At}getChildren(se){const le=this._getOriginId(se),fe=this._getOriginZoom(se),Se="No cluster with the specified id.",Ne=this.trees[fe];if(!Ne)throw new Error(Se);const Ge=Ne.data;if(le*this.stride>=Ge.length)throw new Error(Se);const Je=this.options.radius/(this.options.extent*Math.pow(2,fe-1)),Ze=Ne.within(Ge[le*this.stride],Ge[le*this.stride+1],Je),yt=[];for(const At of Ze){const bt=At*this.stride;Ge[bt+4]===se&&yt.push(Ge[bt+5]>1?Bn(Ge,bt,this.clusterProps):this.points[Ge[bt+3]])}if(yt.length===0)throw new Error(Se);return yt}getLeaves(se,le,fe){const Se=[];return this._appendLeaves(Se,se,le=le||10,fe=fe||0,0),Se}getTile(se,le,fe){const Se=this.trees[this._limitZoom(se)],Ne=Math.pow(2,se),{extent:Ge,radius:Je}=this.options,Ze=Je/Ge,yt=(fe-Ze)/Ne,At=(fe+1+Ze)/Ne,bt={features:[]};return this._addTileFeatures(Se.range((le-Ze)/Ne,yt,(le+1+Ze)/Ne,At),Se.data,le,fe,Ne,bt),le===0&&this._addTileFeatures(Se.range(1-Ze/Ne,yt,1,At),Se.data,Ne,fe,Ne,bt),le===Ne-1&&this._addTileFeatures(Se.range(0,yt,Ze/Ne,At),Se.data,-1,fe,Ne,bt),bt.features.length?bt:null}getClusterExpansionZoom(se){let le=this._getOriginZoom(se)-1;for(;le<=this.options.maxZoom;){const fe=this.getChildren(se);if(le++,fe.length!==1)break;se=fe[0].properties.cluster_id}return le}_appendLeaves(se,le,fe,Se,Ne){const Ge=this.getChildren(le);for(const Je of Ge){const Ze=Je.properties;if(Ze&&Ze.cluster?Ne+Ze.point_count<=Se?Ne+=Ze.point_count:Ne=this._appendLeaves(se,Ze.cluster_id,fe,Se,Ne):Ne<Se?Ne++:se.push(Je),se.length===fe)break}return Ne}_createTree(se){const le=new g.aI(se.length/this.stride|0,this.options.nodeSize,Float32Array);for(let fe=0;fe<se.length;fe+=this.stride)le.add(se[fe],se[fe+1]);return le.finish(),le.data=se,le}_addTileFeatures(se,le,fe,Se,Ne,Ge){for(const Je of se){const Ze=Je*this.stride,yt=le[Ze+5]>1;let At,bt,en;if(yt)At=ti(le,Ze,this.clusterProps),bt=le[Ze],en=le[Ze+1];else{const Fn=this.points[le[Ze+3]];At=Fn.properties;const[rn,Dn]=Fn.geometry.coordinates;bt=gt(rn),en=Zt(Dn)}const qe={type:1,geometry:[[Math.round(this.options.extent*(bt*Ne-fe)),Math.round(this.options.extent*(en*Ne-Se))]],tags:At};let Cn;Cn=yt||this.options.generateId?le[Ze+3]:this.points[le[Ze+3]].id,Cn!==void 0&&(qe.id=Cn),Ge.features.push(qe)}}_limitZoom(se){return Math.max(this.options.minZoom,Math.min(Math.floor(+se),this.options.maxZoom+1))}_cluster(se,le){const{radius:fe,extent:Se,reduce:Ne,minPoints:Ge}=this.options,Je=fe/(Se*Math.pow(2,le)),Ze=se.data,yt=[],At=this.stride;for(let bt=0;bt<Ze.length;bt+=At){if(Ze[bt+2]<=le)continue;Ze[bt+2]=le;const en=Ze[bt],qe=Ze[bt+1],Cn=se.within(Ze[bt],Ze[bt+1],Je),Fn=Ze[bt+5];let rn=Fn;for(const Dn of Cn){const wi=Dn*At;Ze[wi+2]>le&&(rn+=Ze[wi+5])}if(rn>Fn&&rn>=Ge){let Dn,wi=en*Fn,Xi=qe*Fn,Er=-1;const Mi=(bt/At<<5)+(le+1)+this.points.length;for(const vn of Cn){const Pn=vn*At;if(Ze[Pn+2]<=le)continue;Ze[Pn+2]=le;const Vi=Ze[Pn+5];wi+=Ze[Pn]*Vi,Xi+=Ze[Pn+1]*Vi,Ze[Pn+4]=Mi,Ne&&(Dn||(Dn=this._map(Ze,bt,!0),Er=this.clusterProps.length,this.clusterProps.push(Dn)),Ne(Dn,this._map(Ze,Pn)))}Ze[bt+4]=Mi,yt.push(wi/rn,Xi/rn,1/0,Mi,-1,rn),Ne&&yt.push(Er)}else{for(let Dn=0;Dn<At;Dn++)yt.push(Ze[bt+Dn]);if(rn>1)for(const Dn of Cn){const wi=Dn*At;if(!(Ze[wi+2]<=le)){Ze[wi+2]=le;for(let Xi=0;Xi<At;Xi++)yt.push(Ze[wi+Xi])}}}}return yt}_getOriginId(se){return se-this.points.length>>5}_getOriginZoom(se){return(se-this.points.length)%32}_map(se,le,fe){if(se[le+5]>1){const Ge=this.clusterProps[se[le+6]];return fe?Object.assign({},Ge):Ge}const Se=this.points[se[le+3]].properties,Ne=this.options.map(Se);return fe&&Ne===Se?Object.assign({},Ne):Ne}}function Bn(je,se,le){return{type:"Feature",id:je[se+3],properties:ti(je,se,le),geometry:{type:"Point",coordinates:[(fe=je[se],360*(fe-.5)),xt(je[se+1])]}};var fe}function ti(je,se,le){const fe=je[se+5],Se=fe>=1e4?`${Math.round(fe/1e3)}k`:fe>=1e3?Math.round(fe/100)/10+"k":fe,Ne=je[se+6],Ge=Ne===-1?{}:Object.assign({},le[Ne]);return Object.assign(Ge,{cluster:!0,cluster_id:je[se+3],point_count:fe,point_count_abbreviated:Se})}function gt(je){return je/360+.5}function Zt(je){const se=Math.sin(je*Math.PI/180),le=.5-.25*Math.log((1+se)/(1-se))/Math.PI;return le<0?0:le>1?1:le}function xt(je){const se=(180-360*je)*Math.PI/180;return 360*Math.atan(Math.exp(se))/Math.PI-90}function jt(je,se,le,fe){let Se=fe;const Ne=se+(le-se>>1);let Ge,Je=le-se;const Ze=je[se],yt=je[se+1],At=je[le],bt=je[le+1];for(let en=se+3;en<le;en+=3){const qe=Ie(je[en],je[en+1],Ze,yt,At,bt);if(qe>Se)Ge=en,Se=qe;else if(qe===Se){const Cn=Math.abs(en-Ne);Cn<Je&&(Ge=en,Je=Cn)}}Se>fe&&(Ge-se>3&&jt(je,se,Ge,fe),je[Ge+2]=Se,le-Ge>3&&jt(je,Ge,le,fe))}function Ie(je,se,le,fe,Se,Ne){let Ge=Se-le,Je=Ne-fe;if(Ge!==0||Je!==0){const Ze=((je-le)*Ge+(se-fe)*Je)/(Ge*Ge+Je*Je);Ze>1?(le=Se,fe=Ne):Ze>0&&(le+=Ge*Ze,fe+=Je*Ze)}return Ge=je-le,Je=se-fe,Ge*Ge+Je*Je}function lt(je,se,le,fe){const Se={id:je??null,type:se,geometry:le,tags:fe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(se==="Point"||se==="MultiPoint"||se==="LineString")Dt(Se,le);else if(se==="Polygon")Dt(Se,le[0]);else if(se==="MultiLineString")for(const Ne of le)Dt(Se,Ne);else if(se==="MultiPolygon")for(const Ne of le)Dt(Se,Ne[0]);return Se}function Dt(je,se){for(let le=0;le<se.length;le+=3)je.minX=Math.min(je.minX,se[le]),je.minY=Math.min(je.minY,se[le+1]),je.maxX=Math.max(je.maxX,se[le]),je.maxY=Math.max(je.maxY,se[le+1])}function zt(je,se,le,fe){if(!se.geometry)return;const Se=se.geometry.coordinates;if(Se&&Se.length===0)return;const Ne=se.geometry.type,Ge=Math.pow(le.tolerance/((1<<le.maxZoom)*le.extent),2);let Je=[],Ze=se.id;if(le.promoteId?Ze=se.properties[le.promoteId]:le.generateId&&(Ze=fe||0),Ne==="Point")Xt(Se,Je);else if(Ne==="MultiPoint")for(const yt of Se)Xt(yt,Je);else if(Ne==="LineString")an(Se,Je,Ge,!1);else if(Ne==="MultiLineString"){if(le.lineMetrics){for(const yt of Se)Je=[],an(yt,Je,Ge,!1),je.push(lt(Ze,"LineString",Je,se.properties));return}Ft(Se,Je,Ge,!1)}else if(Ne==="Polygon")Ft(Se,Je,Ge,!0);else{if(Ne!=="MultiPolygon"){if(Ne==="GeometryCollection"){for(const yt of se.geometry.geometries)zt(je,{id:Ze,geometry:yt,properties:se.properties},le,fe);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const yt of Se){const At=[];Ft(yt,At,Ge,!0),Je.push(At)}}je.push(lt(Ze,Ne,Je,se.properties))}function Xt(je,se){se.push(Ci(je[0]),qn(je[1]),0)}function an(je,se,le,fe){let Se,Ne,Ge=0;for(let Ze=0;Ze<je.length;Ze++){const yt=Ci(je[Ze][0]),At=qn(je[Ze][1]);se.push(yt,At,0),Ze>0&&(Ge+=fe?(Se*At-yt*Ne)/2:Math.sqrt(Math.pow(yt-Se,2)+Math.pow(At-Ne,2))),Se=yt,Ne=At}const Je=se.length-3;se[2]=1,jt(se,0,Je,le),se[Je+2]=1,se.size=Math.abs(Ge),se.start=0,se.end=se.size}function Ft(je,se,le,fe){for(let Se=0;Se<je.length;Se++){const Ne=[];an(je[Se],Ne,le,fe),se.push(Ne)}}function Ci(je){return je/360+.5}function qn(je){const se=Math.sin(je*Math.PI/180),le=.5-.25*Math.log((1+se)/(1-se))/Math.PI;return le<0?0:le>1?1:le}function zr(je,se,le,fe,Se,Ne,Ge,Je){if(fe/=se,Ne>=(le/=se)&&Ge<fe)return je;if(Ge<le||Ne>=fe)return null;const Ze=[];for(const yt of je){const At=yt.geometry;let bt=yt.type;const en=Se===0?yt.minX:yt.minY,qe=Se===0?yt.maxX:yt.maxY;if(en>=le&&qe<fe){Ze.push(yt);continue}if(qe<le||en>=fe)continue;let Cn=[];if(bt==="Point"||bt==="MultiPoint")co(At,Cn,le,fe,Se);else if(bt==="LineString")Us(At,Cn,le,fe,Se,!1,Je.lineMetrics);else if(bt==="MultiLineString")Pi(At,Cn,le,fe,Se,!1);else if(bt==="Polygon")Pi(At,Cn,le,fe,Se,!0);else if(bt==="MultiPolygon")for(const Fn of At){const rn=[];Pi(Fn,rn,le,fe,Se,!0),rn.length&&Cn.push(rn)}if(Cn.length){if(Je.lineMetrics&&bt==="LineString"){for(const Fn of Cn)Ze.push(lt(yt.id,bt,Fn,yt.tags));continue}bt!=="LineString"&&bt!=="MultiLineString"||(Cn.length===1?(bt="LineString",Cn=Cn[0]):bt="MultiLineString"),bt!=="Point"&&bt!=="MultiPoint"||(bt=Cn.length===3?"Point":"MultiPoint"),Ze.push(lt(yt.id,bt,Cn,yt.tags))}}return Ze.length?Ze:null}function co(je,se,le,fe,Se){for(let Ne=0;Ne<je.length;Ne+=3){const Ge=je[Ne+Se];Ge>=le&&Ge<=fe&&er(se,je[Ne],je[Ne+1],je[Ne+2])}}function Us(je,se,le,fe,Se,Ne,Ge){let Je=Or(je);const Ze=Se===0?ds:Xa;let yt,At,bt=je.start;for(let rn=0;rn<je.length-3;rn+=3){const Dn=je[rn],wi=je[rn+1],Xi=je[rn+2],Er=je[rn+3],Mi=je[rn+4],vn=Se===0?Dn:wi,Pn=Se===0?Er:Mi;let Vi=!1;Ge&&(yt=Math.sqrt(Math.pow(Dn-Er,2)+Math.pow(wi-Mi,2))),vn<le?Pn>le&&(At=Ze(Je,Dn,wi,Er,Mi,le),Ge&&(Je.start=bt+yt*At)):vn>fe?Pn<fe&&(At=Ze(Je,Dn,wi,Er,Mi,fe),Ge&&(Je.start=bt+yt*At)):er(Je,Dn,wi,Xi),Pn<le&&vn>=le&&(At=Ze(Je,Dn,wi,Er,Mi,le),Vi=!0),Pn>fe&&vn<=fe&&(At=Ze(Je,Dn,wi,Er,Mi,fe),Vi=!0),!Ne&&Vi&&(Ge&&(Je.end=bt+yt*At),se.push(Je),Je=Or(je)),Ge&&(bt+=yt)}let en=je.length-3;const qe=je[en],Cn=je[en+1],Fn=Se===0?qe:Cn;Fn>=le&&Fn<=fe&&er(Je,qe,Cn,je[en+2]),en=Je.length-3,Ne&&en>=3&&(Je[en]!==Je[0]||Je[en+1]!==Je[1])&&er(Je,Je[0],Je[1],Je[2]),Je.length&&se.push(Je)}function Or(je){const se=[];return se.size=je.size,se.start=je.start,se.end=je.end,se}function Pi(je,se,le,fe,Se,Ne){for(const Ge of je)Us(Ge,se,le,fe,Se,Ne,!1)}function er(je,se,le,fe){je.push(se,le,fe)}function ds(je,se,le,fe,Se,Ne){const Ge=(Ne-se)/(fe-se);return er(je,Ne,le+(Se-le)*Ge,1),Ge}function Xa(je,se,le,fe,Se,Ne){const Ge=(Ne-le)/(Se-le);return er(je,se+(fe-se)*Ge,Ne,1),Ge}function Nr(je,se){const le=[];for(let fe=0;fe<je.length;fe++){const Se=je[fe],Ne=Se.type;let Ge;if(Ne==="Point"||Ne==="MultiPoint"||Ne==="LineString")Ge=Ba(Se.geometry,se);else if(Ne==="MultiLineString"||Ne==="Polygon"){Ge=[];for(const Je of Se.geometry)Ge.push(Ba(Je,se))}else if(Ne==="MultiPolygon"){Ge=[];for(const Je of Se.geometry){const Ze=[];for(const yt of Je)Ze.push(Ba(yt,se));Ge.push(Ze)}}le.push(lt(Se.id,Ne,Ge,Se.tags))}return le}function Ba(je,se){const le=[];le.size=je.size,je.start!==void 0&&(le.start=je.start,le.end=je.end);for(let fe=0;fe<je.length;fe+=3)le.push(je[fe]+se,je[fe+1],je[fe+2]);return le}function Fi(je,se){if(je.transformed)return je;const le=1<<je.z,fe=je.x,Se=je.y;for(const Ne of je.features){const Ge=Ne.geometry,Je=Ne.type;if(Ne.geometry=[],Je===1)for(let Ze=0;Ze<Ge.length;Ze+=2)Ne.geometry.push(fr(Ge[Ze],Ge[Ze+1],se,le,fe,Se));else for(let Ze=0;Ze<Ge.length;Ze++){const yt=[];for(let At=0;At<Ge[Ze].length;At+=2)yt.push(fr(Ge[Ze][At],Ge[Ze][At+1],se,le,fe,Se));Ne.geometry.push(yt)}}return je.transformed=!0,je}function fr(je,se,le,fe,Se,Ne){return[Math.round(le*(je*fe-Se)),Math.round(le*(se*fe-Ne))]}function fa(je,se,le,fe,Se){const Ne=se===Se.maxZoom?0:Se.tolerance/((1<<se)*Se.extent),Ge={features:[],numPoints:0,numSimplified:0,numFeatures:je.length,source:null,x:le,y:fe,z:se,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Je of je)Po(Ge,Je,Ne,Se);return Ge}function Po(je,se,le,fe){const Se=se.geometry,Ne=se.type,Ge=[];if(je.minX=Math.min(je.minX,se.minX),je.minY=Math.min(je.minY,se.minY),je.maxX=Math.max(je.maxX,se.maxX),je.maxY=Math.max(je.maxY,se.maxY),Ne==="Point"||Ne==="MultiPoint")for(let Je=0;Je<Se.length;Je+=3)Ge.push(Se[Je],Se[Je+1]),je.numPoints++,je.numSimplified++;else if(Ne==="LineString")js(Ge,Se,je,le,!1,!1);else if(Ne==="MultiLineString"||Ne==="Polygon")for(let Je=0;Je<Se.length;Je++)js(Ge,Se[Je],je,le,Ne==="Polygon",Je===0);else if(Ne==="MultiPolygon")for(let Je=0;Je<Se.length;Je++){const Ze=Se[Je];for(let yt=0;yt<Ze.length;yt++)js(Ge,Ze[yt],je,le,!0,yt===0)}if(Ge.length){let Je=se.tags||null;if(Ne==="LineString"&&fe.lineMetrics){Je={};for(const yt in se.tags)Je[yt]=se.tags[yt];Je.mapbox_clip_start=Se.start/Se.size,Je.mapbox_clip_end=Se.end/Se.size}const Ze={geometry:Ge,type:Ne==="Polygon"||Ne==="MultiPolygon"?3:Ne==="LineString"||Ne==="MultiLineString"?2:1,tags:Je};se.id!==null&&(Ze.id=se.id),je.features.push(Ze)}}function js(je,se,le,fe,Se,Ne){const Ge=fe*fe;if(fe>0&&se.size<(Se?Ge:fe))return void(le.numPoints+=se.length/3);const Je=[];for(let Ze=0;Ze<se.length;Ze+=3)(fe===0||se[Ze+2]>Ge)&&(le.numSimplified++,Je.push(se[Ze],se[Ze+1])),le.numPoints++;Se&&(function(Ze,yt){let At=0;for(let bt=0,en=Ze.length,qe=en-2;bt<en;qe=bt,bt+=2)At+=(Ze[bt]-Ze[qe])*(Ze[bt+1]+Ze[qe+1]);if(At>0===yt)for(let bt=0,en=Ze.length;bt<en/2;bt+=2){const qe=Ze[bt],Cn=Ze[bt+1];Ze[bt]=Ze[en-2-bt],Ze[bt+1]=Ze[en-1-bt],Ze[en-2-bt]=qe,Ze[en-1-bt]=Cn}})(Je,Ne),je.push(Je)}const Tl={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class fs{constructor(se,le){const fe=(le=this.options=(function(Ne,Ge){for(const Je in Ge)Ne[Je]=Ge[Je];return Ne})(Object.create(Tl),le)).debug;if(fe&&console.time("preprocess data"),le.maxZoom<0||le.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(le.promoteId&&le.generateId)throw new Error("promoteId and generateId cannot be used together.");let Se=(function(Ne,Ge){const Je=[];if(Ne.type==="FeatureCollection")for(let Ze=0;Ze<Ne.features.length;Ze++)zt(Je,Ne.features[Ze],Ge,Ze);else zt(Je,Ne.type==="Feature"?Ne:{geometry:Ne},Ge);return Je})(se,le);this.tiles={},this.tileCoords=[],fe&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",le.indexMaxZoom,le.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Se=(function(Ne,Ge){const Je=Ge.buffer/Ge.extent;let Ze=Ne;const yt=zr(Ne,1,-1-Je,Je,0,-1,2,Ge),At=zr(Ne,1,1-Je,2+Je,0,-1,2,Ge);return(yt||At)&&(Ze=zr(Ne,1,-Je,1+Je,0,-1,2,Ge)||[],yt&&(Ze=Nr(yt,1).concat(Ze)),At&&(Ze=Ze.concat(Nr(At,-1)))),Ze})(Se,le),Se.length&&this.splitTile(Se,0,0,0),fe&&(Se.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(se,le,fe,Se,Ne,Ge,Je){const Ze=[se,le,fe,Se],yt=this.options,At=yt.debug;for(;Ze.length;){Se=Ze.pop(),fe=Ze.pop(),le=Ze.pop(),se=Ze.pop();const bt=1<<le,en=Ta(le,fe,Se);let qe=this.tiles[en];if(!qe&&(At>1&&console.time("creation"),qe=this.tiles[en]=fa(se,le,fe,Se,yt),this.tileCoords.push({z:le,x:fe,y:Se}),At)){At>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",le,fe,Se,qe.numFeatures,qe.numPoints,qe.numSimplified),console.timeEnd("creation"));const Vi=`z${le}`;this.stats[Vi]=(this.stats[Vi]||0)+1,this.total++}if(qe.source=se,Ne==null){if(le===yt.indexMaxZoom||qe.numPoints<=yt.indexMaxPoints)continue}else{if(le===yt.maxZoom||le===Ne)continue;if(Ne!=null){const Vi=Ne-le;if(fe!==Ge>>Vi||Se!==Je>>Vi)continue}}if(qe.source=null,se.length===0)continue;At>1&&console.time("clipping");const Cn=.5*yt.buffer/yt.extent,Fn=.5-Cn,rn=.5+Cn,Dn=1+Cn;let wi=null,Xi=null,Er=null,Mi=null,vn=zr(se,bt,fe-Cn,fe+rn,0,qe.minX,qe.maxX,yt),Pn=zr(se,bt,fe+Fn,fe+Dn,0,qe.minX,qe.maxX,yt);se=null,vn&&(wi=zr(vn,bt,Se-Cn,Se+rn,1,qe.minY,qe.maxY,yt),Xi=zr(vn,bt,Se+Fn,Se+Dn,1,qe.minY,qe.maxY,yt),vn=null),Pn&&(Er=zr(Pn,bt,Se-Cn,Se+rn,1,qe.minY,qe.maxY,yt),Mi=zr(Pn,bt,Se+Fn,Se+Dn,1,qe.minY,qe.maxY,yt),Pn=null),At>1&&console.timeEnd("clipping"),Ze.push(wi||[],le+1,2*fe,2*Se),Ze.push(Xi||[],le+1,2*fe,2*Se+1),Ze.push(Er||[],le+1,2*fe+1,2*Se),Ze.push(Mi||[],le+1,2*fe+1,2*Se+1)}}getTile(se,le,fe){se=+se,le=+le,fe=+fe;const Se=this.options,{extent:Ne,debug:Ge}=Se;if(se<0||se>24)return null;const Je=1<<se,Ze=Ta(se,le=le+Je&Je-1,fe);if(this.tiles[Ze])return Fi(this.tiles[Ze],Ne);Ge>1&&console.log("drilling down to z%d-%d-%d",se,le,fe);let yt,At=se,bt=le,en=fe;for(;!yt&&At>0;)At--,bt>>=1,en>>=1,yt=this.tiles[Ta(At,bt,en)];return yt&&yt.source?(Ge>1&&(console.log("found parent tile z%d-%d-%d",At,bt,en),console.time("drilling down")),this.splitTile(yt.source,At,bt,en,se,le,fe),Ge>1&&console.timeEnd("drilling down"),this.tiles[Ze]?Fi(this.tiles[Ze],Ne):null):null}}function Ta(je,se,le){return 32*((1<<je)*le+se)+je}class pr extends Z{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(se,le){return g._(this,void 0,void 0,(function*(){const fe=se.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const Se=this._geoJSONIndex.getTile(fe.z,fe.x,fe.y);if(!Se)return null;const Ne=new Qe(Se.features,{version:2,extent:g.$});let Ge=(function(Je){const Ze=new g.cM;return(function(yt,At){for(const bt in yt.layers)At.writeMessage(3,Xe,yt.layers[bt])})(Je,Ze),Ze.finish()})(Ne);return Ge.byteOffset===0&&Ge.byteLength===Ge.buffer.byteLength||(Ge=new Uint8Array(Ge)),{vectorTile:Ne,rawData:Ge.buffer}}))}loadData(se){return g._(this,void 0,void 0,(function*(){var le;(le=this._pendingRequest)===null||le===void 0||le.abort();const fe=!!(se&&se.request&&se.request.collectResourceTiming)&&new g.cN(se.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(se,this._pendingRequest);const Se=yield this._pendingData;this._geoJSONIndex=se.cluster?new ke((function({superclusterOptions:Ge,clusterProperties:Je}){if(!Je||!Ge)return Ge;const Ze={},yt={},At={accumulated:null,zoom:0},bt={properties:null},en=Object.keys(Je);for(const qe of en){const[Cn,Fn]=Je[qe],rn=g.cT(Fn),Dn=g.cT(typeof Cn=="string"?[Cn,["accumulated"],["get",qe]]:Cn);Ze[qe]=rn.value,yt[qe]=Dn.value}return Ge.map=qe=>{bt.properties=qe;const Cn={};for(const Fn of en)Cn[Fn]=Ze[Fn].evaluate(At,bt);return Cn},Ge.reduce=(qe,Cn)=>{bt.properties=Cn;for(const Fn of en)At.accumulated=qe[Fn],qe[Fn]=yt[Fn].evaluate(At,bt)},Ge})(se)).load(Se.features):(function(Ge,Je){return new fs(Ge,Je)})(Se,se.geojsonVtOptions),this.loaded={};const Ne={data:Se};if(fe){const Ge=fe.finish();Ge&&(Ne.resourceTiming={},Ne.resourceTiming[se.source]=JSON.parse(JSON.stringify(Ge)))}return Ne}catch(Se){if(delete this._pendingRequest,g.cy(Se))return{abandoned:!0};throw Se}}))}getData(){return g._(this,void 0,void 0,(function*(){return this._pendingData}))}reloadTile(se){const le=this.loaded;return le&&le[se.uid]?super.reloadTile(se):this.loadTile(se)}loadAndProcessGeoJSON(se,le){return g._(this,void 0,void 0,(function*(){let fe=yield this.loadGeoJSON(se,le);if(delete this._pendingRequest,typeof fe!="object")throw new Error(`Input data given to '${se.source}' is not a valid GeoJSON object.`);if(ze(fe,!0),se.filter){const Se=g.cT(se.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Se.result==="error")throw new Error(Se.value.map((Ge=>`${Ge.key}: ${Ge.message}`)).join(", "));fe={type:"FeatureCollection",features:fe.features.filter((Ge=>Se.value.evaluate({zoom:0},Ge)))}}return fe}))}loadGeoJSON(se,le){return g._(this,void 0,void 0,(function*(){const{promoteId:fe}=se;if(se.request){const Se=yield g.j(se.request,le);return this._dataUpdateable=g.cV(Se.data,fe)?g.cU(Se.data,fe):void 0,Se.data}if(typeof se.data=="string")try{const Se=JSON.parse(se.data);return this._dataUpdateable=g.cV(Se,fe)?g.cU(Se,fe):void 0,Se}catch{throw new Error(`Input data given to '${se.source}' is not a valid GeoJSON object.`)}if(!se.dataDiff)throw new Error(`Input data given to '${se.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${se.source}`);return g.cW(this._dataUpdateable,se.dataDiff,fe),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}}))}removeSource(se){return g._(this,void 0,void 0,(function*(){this._pendingRequest&&this._pendingRequest.abort()}))}getClusterExpansionZoom(se){return this._geoJSONIndex.getClusterExpansionZoom(se.clusterId)}getClusterChildren(se){return this._geoJSONIndex.getChildren(se.clusterId)}getClusterLeaves(se){return this._geoJSONIndex.getLeaves(se.clusterId,se.limit,se.offset)}}class pa{constructor(se){this.self=se,this.actor=new g.J(se),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(le,fe)=>{if(this.externalWorkerSourceTypes[le])throw new Error(`Worker source with name "${le}" already registered.`);this.externalWorkerSourceTypes[le]=fe},this.self.addProtocol=g.cA,this.self.removeProtocol=g.cB,this.self.registerRTLTextPlugin=le=>{g.cX.setMethods(le)},this.actor.registerMessageHandler("LDT",((le,fe)=>this._getDEMWorkerSource(le,fe.source).loadTile(fe))),this.actor.registerMessageHandler("RDT",((le,fe)=>g._(this,void 0,void 0,(function*(){this._getDEMWorkerSource(le,fe.source).removeTile(fe)})))),this.actor.registerMessageHandler("GCEZ",((le,fe)=>g._(this,void 0,void 0,(function*(){return this._getWorkerSource(le,fe.type,fe.source).getClusterExpansionZoom(fe)})))),this.actor.registerMessageHandler("GCC",((le,fe)=>g._(this,void 0,void 0,(function*(){return this._getWorkerSource(le,fe.type,fe.source).getClusterChildren(fe)})))),this.actor.registerMessageHandler("GCL",((le,fe)=>g._(this,void 0,void 0,(function*(){return this._getWorkerSource(le,fe.type,fe.source).getClusterLeaves(fe)})))),this.actor.registerMessageHandler("LD",((le,fe)=>this._getWorkerSource(le,fe.type,fe.source).loadData(fe))),this.actor.registerMessageHandler("GD",((le,fe)=>this._getWorkerSource(le,fe.type,fe.source).getData())),this.actor.registerMessageHandler("LT",((le,fe)=>this._getWorkerSource(le,fe.type,fe.source).loadTile(fe))),this.actor.registerMessageHandler("RT",((le,fe)=>this._getWorkerSource(le,fe.type,fe.source).reloadTile(fe))),this.actor.registerMessageHandler("AT",((le,fe)=>this._getWorkerSource(le,fe.type,fe.source).abortTile(fe))),this.actor.registerMessageHandler("RMT",((le,fe)=>this._getWorkerSource(le,fe.type,fe.source).removeTile(fe))),this.actor.registerMessageHandler("RS",((le,fe)=>g._(this,void 0,void 0,(function*(){if(!this.workerSources[le]||!this.workerSources[le][fe.type]||!this.workerSources[le][fe.type][fe.source])return;const Se=this.workerSources[le][fe.type][fe.source];delete this.workerSources[le][fe.type][fe.source],Se.removeSource!==void 0&&Se.removeSource(fe)})))),this.actor.registerMessageHandler("RM",(le=>g._(this,void 0,void 0,(function*(){delete this.layerIndexes[le],delete this.availableImages[le],delete this.workerSources[le],delete this.demWorkerSources[le]})))),this.actor.registerMessageHandler("SR",((le,fe)=>g._(this,void 0,void 0,(function*(){this.referrer=fe})))),this.actor.registerMessageHandler("SRPS",((le,fe)=>this._syncRTLPluginState(le,fe))),this.actor.registerMessageHandler("IS",((le,fe)=>g._(this,void 0,void 0,(function*(){this.self.importScripts(fe)})))),this.actor.registerMessageHandler("SI",((le,fe)=>this._setImages(le,fe))),this.actor.registerMessageHandler("UL",((le,fe)=>g._(this,void 0,void 0,(function*(){this._getLayerIndex(le).update(fe.layers,fe.removedIds)})))),this.actor.registerMessageHandler("SL",((le,fe)=>g._(this,void 0,void 0,(function*(){this._getLayerIndex(le).replace(fe)}))))}_setImages(se,le){return g._(this,void 0,void 0,(function*(){this.availableImages[se]=le;for(const fe in this.workerSources[se]){const Se=this.workerSources[se][fe];for(const Ne in Se)Se[Ne].availableImages=le}}))}_syncRTLPluginState(se,le){return g._(this,void 0,void 0,(function*(){return yield g.cX.syncState(le,this.self.importScripts)}))}_getAvailableImages(se){let le=this.availableImages[se];return le||(le=[]),le}_getLayerIndex(se){let le=this.layerIndexes[se];return le||(le=this.layerIndexes[se]=new c),le}_getWorkerSource(se,le,fe){if(this.workerSources[se]||(this.workerSources[se]={}),this.workerSources[se][le]||(this.workerSources[se][le]={}),!this.workerSources[se][le][fe]){const Se={sendAsync:(Ne,Ge)=>(Ne.targetMapId=se,this.actor.sendAsync(Ne,Ge))};switch(le){case"vector":this.workerSources[se][le][fe]=new Z(Se,this._getLayerIndex(se),this._getAvailableImages(se));break;case"geojson":this.workerSources[se][le][fe]=new pr(Se,this._getLayerIndex(se),this._getAvailableImages(se));break;default:this.workerSources[se][le][fe]=new this.externalWorkerSourceTypes[le](Se,this._getLayerIndex(se),this._getAvailableImages(se))}}return this.workerSources[se][le][fe]}_getDEMWorkerSource(se,le){return this.demWorkerSources[se]||(this.demWorkerSources[se]={}),this.demWorkerSources[se][le]||(this.demWorkerSources[se][le]=new Y),this.demWorkerSources[se][le]}}return g.i(self)&&(self.worker=new pa(self)),pa})),h("index",["exports","./shared"],(function(g,c){var C="5.6.2";function k(){var w=new c.A(4);return c.A!=Float32Array&&(w[1]=0,w[2]=0),w[0]=1,w[3]=1,w}let V,Z;const Y={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(w,n,u){const _=requestAnimationFrame((T=>{b(),n(T)})),{unsubscribe:b}=c.s(w.signal,"abort",(()=>{b(),cancelAnimationFrame(_),u(c.c())}),!1)},frameAsync(w){return new Promise(((n,u)=>{this.frame(w,n,u)}))},getImageData(w,n=0){return this.getImageCanvasContext(w).getImageData(-n,-n,w.width+2*n,w.height+2*n)},getImageCanvasContext(w){const n=window.document.createElement("canvas"),u=n.getContext("2d",{willReadFrequently:!0});if(!u)throw new Error("failed to create canvas 2d context");return n.width=w.width,n.height=w.height,u.drawImage(w,0,0,w.width,w.height),u},resolveURL:w=>(V||(V=document.createElement("a")),V.href=w,V.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(Z==null&&(Z=matchMedia("(prefers-reduced-motion: reduce)")),Z.matches)}};class Q{static testProp(n){if(!Q.docStyle)return n[0];for(let u=0;u<n.length;u++)if(n[u]in Q.docStyle)return n[u];return n[0]}static create(n,u,_){const b=window.document.createElement(n);return u!==void 0&&(b.className=u),_&&_.appendChild(b),b}static createNS(n,u){return window.document.createElementNS(n,u)}static disableDrag(){Q.docStyle&&Q.selectProp&&(Q.userSelect=Q.docStyle[Q.selectProp],Q.docStyle[Q.selectProp]="none")}static enableDrag(){Q.docStyle&&Q.selectProp&&(Q.docStyle[Q.selectProp]=Q.userSelect)}static setTransform(n,u){n.style[Q.transformProp]=u}static addEventListener(n,u,_,b={}){n.addEventListener(u,_,"passive"in b?b:b.capture)}static removeEventListener(n,u,_,b={}){n.removeEventListener(u,_,"passive"in b?b:b.capture)}static suppressClickInternal(n){n.preventDefault(),n.stopPropagation(),window.removeEventListener("click",Q.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",Q.suppressClickInternal,!0),window.setTimeout((()=>{window.removeEventListener("click",Q.suppressClickInternal,!0)}),0)}static getScale(n){const u=n.getBoundingClientRect();return{x:u.width/n.offsetWidth||1,y:u.height/n.offsetHeight||1,boundingClientRect:u}}static getPoint(n,u,_){const b=u.boundingClientRect;return new c.P((_.clientX-b.left)/u.x-n.clientLeft,(_.clientY-b.top)/u.y-n.clientTop)}static mousePos(n,u){const _=Q.getScale(n);return Q.getPoint(n,_,u)}static touchPos(n,u){const _=[],b=Q.getScale(n);for(let T=0;T<u.length;T++)_.push(Q.getPoint(n,b,u[T]));return _}static mouseButton(n){return n.button}static remove(n){n.parentNode&&n.parentNode.removeChild(n)}static sanitize(n){const u=new DOMParser().parseFromString(n,"text/html").body||document.createElement("body"),_=u.querySelectorAll("script");for(const b of _)b.remove();return Q.clean(u),u.innerHTML}static isPossiblyDangerous(n,u){const _=u.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(n)||!_.includes("javascript:")&&!_.includes("data:"))||!!n.startsWith("on")||void 0}static clean(n){const u=n.children;for(const _ of u)Q.removeAttributes(_),Q.clean(_)}static removeAttributes(n){for(const{name:u,value:_}of n.attributes)Q.isPossiblyDangerous(u,_)&&n.removeAttribute(u)}}Q.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,Q.selectProp=Q.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),Q.transformProp=Q.testProp(["transform","WebkitTransform"]);const be={supported:!1,testSupport:function(w){!et&&ze&&(Qe?Xe(w):xe=w)}};let xe,ze,et=!1,Qe=!1;function Xe(w){const n=w.createTexture();w.bindTexture(w.TEXTURE_2D,n);try{if(w.texImage2D(w.TEXTURE_2D,0,w.RGBA,w.RGBA,w.UNSIGNED_BYTE,ze),w.isContextLost())return;be.supported=!0}catch{}w.deleteTexture(n),et=!0}var Ke;typeof document<"u"&&(ze=document.createElement("img"),ze.onload=()=>{xe&&Xe(xe),xe=null,Qe=!0},ze.onerror=()=>{et=!0,xe=null},ze.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),(function(w){let n,u,_,b;w.resetRequestQueue=()=>{n=[],u=0,_=0,b={}},w.addThrottleControl=N=>{const j=_++;return b[j]=N,j},w.removeThrottleControl=N=>{delete b[N],I()},w.getImage=(N,j,$=!0)=>new Promise(((X,W)=>{be.supported&&(N.headers||(N.headers={}),N.headers.accept="image/webp,*/*"),c.e(N,{type:"image"}),n.push({abortController:j,requestParameters:N,supportImageRefresh:$,state:"queued",onError:ee=>{W(ee)},onSuccess:ee=>{X(ee)}}),I()}));const T=N=>c._(this,void 0,void 0,(function*(){N.state="running";const{requestParameters:j,supportImageRefresh:$,onError:X,onSuccess:W,abortController:ee}=N,ae=$===!1&&!c.i(self)&&!c.g(j.url)&&(!j.headers||Object.keys(j.headers).reduce(((ve,Te)=>ve&&Te==="accept"),!0));u++;const _e=ae?O(j,ee):c.m(j,ee);try{const ve=yield _e;delete N.abortController,N.state="completed",ve.data instanceof HTMLImageElement||c.b(ve.data)?W(ve):ve.data&&W({data:yield(ge=ve.data,typeof createImageBitmap=="function"?c.f(ge):c.h(ge)),cacheControl:ve.cacheControl,expires:ve.expires})}catch(ve){delete N.abortController,X(ve)}finally{u--,I()}var ge})),I=()=>{const N=(()=>{for(const j of Object.keys(b))if(b[j]())return!0;return!1})()?c.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:c.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let j=u;j<N&&n.length>0;j++){const $=n.shift();$.abortController.signal.aborted?j--:T($)}},O=(N,j)=>new Promise((($,X)=>{const W=new Image,ee=N.url,ae=N.credentials;ae&&ae==="include"?W.crossOrigin="use-credentials":(ae&&ae==="same-origin"||!c.d(ee))&&(W.crossOrigin="anonymous"),j.signal.addEventListener("abort",(()=>{W.src="",X(c.c())})),W.fetchPriority="high",W.onload=()=>{W.onerror=W.onload=null,$({data:W})},W.onerror=()=>{W.onerror=W.onload=null,j.signal.aborted||X(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},W.src=ee}))})(Ke||(Ke={})),Ke.resetRequestQueue();class Ve{constructor(n){this._transformRequestFn=n??null}transformRequest(n,u){return this._transformRequestFn&&this._transformRequestFn(n,u)||{url:n}}setTransformRequest(n){this._transformRequestFn=n}}function it(w){const n=[];if(typeof w=="string")n.push({id:"default",url:w});else if(w&&w.length>0){const u=[];for(const{id:_,url:b}of w){const T=`${_}${b}`;u.indexOf(T)===-1&&(u.push(T),n.push({id:_,url:b}))}}return n}function de(w,n,u){try{const _=new URL(w);return _.pathname+=`${n}${u}`,_.toString()}catch{throw new Error(`Invalid sprite URL "${w}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function ce(w){const{userImage:n}=w;return!!(n&&n.render&&n.render())&&(w.data.replace(new Uint8Array(n.data.buffer)),!0)}class me extends c.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new c.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(n){if(this.loaded!==n&&(this.loaded=n,n)){for(const{ids:u,promiseResolve:_}of this.requestors)_(this._getImagesForIds(u));this.requestors=[]}}getImage(n){const u=this.images[n];if(u&&!u.data&&u.spriteData){const _=u.spriteData;u.data=new c.R({width:_.width,height:_.height},_.context.getImageData(_.x,_.y,_.width,_.height).data),u.spriteData=null}return u}addImage(n,u){if(this.images[n])throw new Error(`Image id ${n} already exist, use updateImage instead`);this._validate(n,u)&&(this.images[n]=u)}_validate(n,u){let _=!0;const b=u.data||u.spriteData;return this._validateStretch(u.stretchX,b&&b.width)||(this.fire(new c.k(new Error(`Image "${n}" has invalid "stretchX" value`))),_=!1),this._validateStretch(u.stretchY,b&&b.height)||(this.fire(new c.k(new Error(`Image "${n}" has invalid "stretchY" value`))),_=!1),this._validateContent(u.content,u)||(this.fire(new c.k(new Error(`Image "${n}" has invalid "content" value`))),_=!1),_}_validateStretch(n,u){if(!n)return!0;let _=0;for(const b of n){if(b[0]<_||b[1]<b[0]||u<b[1])return!1;_=b[1]}return!0}_validateContent(n,u){if(!n)return!0;if(n.length!==4)return!1;const _=u.spriteData,b=_&&_.width||u.data.width,T=_&&_.height||u.data.height;return!(n[0]<0||b<n[0]||n[1]<0||T<n[1]||n[2]<0||b<n[2]||n[3]<0||T<n[3]||n[2]<n[0]||n[3]<n[1])}updateImage(n,u,_=!0){const b=this.getImage(n);if(_&&(b.data.width!==u.data.width||b.data.height!==u.data.height))throw new Error(`size mismatch between old image (${b.data.width}x${b.data.height}) and new image (${u.data.width}x${u.data.height}).`);u.version=b.version+1,this.images[n]=u,this.updatedImages[n]=!0}removeImage(n){const u=this.images[n];delete this.images[n],delete this.patterns[n],u.userImage&&u.userImage.onRemove&&u.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(n){return new Promise(((u,_)=>{let b=!0;if(!this.isLoaded())for(const T of n)this.images[T]||(b=!1);this.isLoaded()||b?u(this._getImagesForIds(n)):this.requestors.push({ids:n,promiseResolve:u})}))}_getImagesForIds(n){const u={};for(const _ of n){let b=this.getImage(_);b||(this.fire(new c.l("styleimagemissing",{id:_})),b=this.getImage(_)),b?u[_]={data:b.data.clone(),pixelRatio:b.pixelRatio,sdf:b.sdf,version:b.version,stretchX:b.stretchX,stretchY:b.stretchY,content:b.content,textFitWidth:b.textFitWidth,textFitHeight:b.textFitHeight,hasRenderCallback:!!(b.userImage&&b.userImage.render)}:c.w(`Image "${_}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return u}getPixelSize(){const{width:n,height:u}=this.atlasImage;return{width:n,height:u}}getPattern(n){const u=this.patterns[n],_=this.getImage(n);if(!_)return null;if(u&&u.position.version===_.version)return u.position;if(u)u.position.version=_.version;else{const b={w:_.data.width+2,h:_.data.height+2,x:0,y:0},T=new c.I(b,_);this.patterns[n]={bin:b,position:T}}return this._updatePatternAtlas(),this.patterns[n].position}bind(n){const u=n.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new c.T(n,this.atlasImage,u.RGBA),this.atlasTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE)}_updatePatternAtlas(){const n=[];for(const T in this.patterns)n.push(this.patterns[T].bin);const{w:u,h:_}=c.p(n),b=this.atlasImage;b.resize({width:u||1,height:_||1});for(const T in this.patterns){const{bin:I}=this.patterns[T],O=I.x+1,N=I.y+1,j=this.getImage(T).data,$=j.width,X=j.height;c.R.copy(j,b,{x:0,y:0},{x:O,y:N},{width:$,height:X}),c.R.copy(j,b,{x:0,y:X-1},{x:O,y:N-1},{width:$,height:1}),c.R.copy(j,b,{x:0,y:0},{x:O,y:N+X},{width:$,height:1}),c.R.copy(j,b,{x:$-1,y:0},{x:O-1,y:N},{width:1,height:X}),c.R.copy(j,b,{x:0,y:0},{x:O+$,y:N},{width:1,height:X})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(n){for(const u of n){if(this.callbackDispatchedThisFrame[u])continue;this.callbackDispatchedThisFrame[u]=!0;const _=this.getImage(u);_||c.w(`Image with ID: "${u}" was not found`),ce(_)&&this.updateImage(u,_)}}}const Ee=1e20;function De(w,n,u,_,b,T,I,O,N){for(let j=n;j<n+_;j++)$e(w,u*T+j,T,b,I,O,N);for(let j=u;j<u+b;j++)$e(w,j*T+n,1,_,I,O,N)}function $e(w,n,u,_,b,T,I){T[0]=0,I[0]=-Ee,I[1]=Ee,b[0]=w[n];for(let O=1,N=0,j=0;O<_;O++){b[O]=w[n+O*u];const $=O*O;do{const X=T[N];j=(b[O]-b[X]+$-X*X)/(O-X)/2}while(j<=I[N]&&--N>-1);N++,T[N]=O,I[N]=j,I[N+1]=Ee}for(let O=0,N=0;O<_;O++){for(;I[N+1]<O;)N++;const j=T[N],$=O-j;w[n+O*u]=b[j]+$*$}}class ke{constructor(n,u){this.requestManager=n,this.localIdeographFontFamily=u,this.entries={}}setURL(n){this.url=n}getGlyphs(n){return c._(this,void 0,void 0,(function*(){const u=[];for(const T in n)for(const I of n[T])u.push(this._getAndCacheGlyphsPromise(T,I));const _=yield Promise.all(u),b={};for(const{stack:T,id:I,glyph:O}of _)b[T]||(b[T]={}),b[T][I]=O&&{id:O.id,bitmap:O.bitmap.clone(),metrics:O.metrics};return b}))}_getAndCacheGlyphsPromise(n,u){return c._(this,void 0,void 0,(function*(){let _=this.entries[n];_||(_=this.entries[n]={glyphs:{},requests:{},ranges:{}});let b=_.glyphs[u];if(b!==void 0)return{stack:n,id:u,glyph:b};if(b=this._tinySDF(_,n,u),b)return _.glyphs[u]=b,{stack:n,id:u,glyph:b};const T=Math.floor(u/256);if(256*T>65535)throw new Error("glyphs > 65535 not supported");if(_.ranges[T])return{stack:n,id:u,glyph:b};if(!this.url)throw new Error("glyphsUrl is not set");if(!_.requests[T]){const O=ke.loadGlyphRange(n,T,this.url,this.requestManager);_.requests[T]=O}const I=yield _.requests[T];for(const O in I)this._doesCharSupportLocalGlyph(+O)||(_.glyphs[+O]=I[+O]);return _.ranges[T]=!0,{stack:n,id:u,glyph:I[u]||null}}))}_doesCharSupportLocalGlyph(n){return!!this.localIdeographFontFamily&&(new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(n))||c.u["CJK Unified Ideographs"](n)||c.u["Hangul Syllables"](n)||c.u.Hiragana(n)||c.u.Katakana(n)||c.u["CJK Symbols and Punctuation"](n)||c.u["Halfwidth and Fullwidth Forms"](n))}_tinySDF(n,u,_){const b=this.localIdeographFontFamily;if(!b||!this._doesCharSupportLocalGlyph(_))return;let T=n.tinySDF;if(!T){let O="400";/bold/i.test(u)?O="900":/medium/i.test(u)?O="500":/light/i.test(u)&&(O="200"),T=n.tinySDF=new ke.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:b,fontWeight:O})}const I=T.draw(String.fromCharCode(_));return{id:_,bitmap:new c.q({width:I.width||60,height:I.height||60},I.data),metrics:{width:I.glyphWidth/2||24,height:I.glyphHeight/2||24,left:I.glyphLeft/2+.5||0,top:I.glyphTop/2-27.5||-8,advance:I.glyphAdvance/2||24,isDoubleResolution:!0}}}}ke.loadGlyphRange=function(w,n,u,_){return c._(this,void 0,void 0,(function*(){const b=256*n,T=b+255,I=_.transformRequest(u.replace("{fontstack}",w).replace("{range}",`${b}-${T}`),"Glyphs"),O=yield c.n(I,new AbortController);if(!O||!O.data)throw new Error(`Could not load glyph range. range: ${n}, ${b}-${T}`);const N={};for(const j of c.o(O.data))N[j.id]=j;return N}))},ke.TinySDF=class{constructor({fontSize:w=24,buffer:n=3,radius:u=8,cutoff:_=.25,fontFamily:b="sans-serif",fontWeight:T="normal",fontStyle:I="normal",lang:O=null}={}){this.buffer=n,this.cutoff=_,this.radius=u,this.lang=O;const N=this.size=w+4*n,j=this._createCanvas(N),$=this.ctx=j.getContext("2d",{willReadFrequently:!0});$.font=`${I} ${T} ${w}px ${b}`,$.textBaseline="alphabetic",$.textAlign="left",$.fillStyle="black",this.gridOuter=new Float64Array(N*N),this.gridInner=new Float64Array(N*N),this.f=new Float64Array(N),this.z=new Float64Array(N+1),this.v=new Uint16Array(N)}_createCanvas(w){const n=document.createElement("canvas");return n.width=n.height=w,n}draw(w){const{width:n,actualBoundingBoxAscent:u,actualBoundingBoxDescent:_,actualBoundingBoxLeft:b,actualBoundingBoxRight:T}=this.ctx.measureText(w),I=Math.ceil(u),O=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(T-b))),N=Math.min(this.size-this.buffer,I+Math.ceil(_)),j=O+2*this.buffer,$=N+2*this.buffer,X=Math.max(j*$,0),W=new Uint8ClampedArray(X),ee={data:W,width:j,height:$,glyphWidth:O,glyphHeight:N,glyphTop:I,glyphLeft:0,glyphAdvance:n};if(O===0||N===0)return ee;const{ctx:ae,buffer:_e,gridInner:ge,gridOuter:ve}=this;this.lang&&(ae.lang=this.lang),ae.clearRect(_e,_e,O,N),ae.fillText(w,_e,_e+I);const Te=ae.getImageData(_e,_e,O,N);ve.fill(Ee,0,X),ge.fill(0,0,X);for(let Me=0;Me<N;Me++)for(let Ae=0;Ae<O;Ae++){const Le=Te.data[4*(Me*O+Ae)+3]/255;if(Le===0)continue;const Ue=(Me+_e)*j+Ae+_e;if(Le===1)ve[Ue]=0,ge[Ue]=Ee;else{const Ce=.5-Le;ve[Ue]=Ce>0?Ce*Ce:0,ge[Ue]=Ce<0?Ce*Ce:0}}De(ve,0,0,j,$,j,this.f,this.v,this.z),De(ge,_e,_e,O,N,j,this.f,this.v,this.z);for(let Me=0;Me<X;Me++){const Ae=Math.sqrt(ve[Me])-Math.sqrt(ge[Me]);W[Me]=Math.round(255-255*(Ae/this.radius+this.cutoff))}return ee}};class Bn{constructor(){this.specification=c.v.light.position}possiblyEvaluate(n,u){return c.B(n.expression.evaluate(u))}interpolate(n,u,_){return{x:c.C.number(n.x,u.x,_),y:c.C.number(n.y,u.y,_),z:c.C.number(n.z,u.z,_)}}}let ti;class gt extends c.E{constructor(n){super(),ti=ti||new c.r({anchor:new c.D(c.v.light.anchor),position:new Bn,color:new c.D(c.v.light.color),intensity:new c.D(c.v.light.intensity)}),this._transitionable=new c.t(ti),this.setLight(n),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(n,u={}){if(!this._validate(c.x,n,u))for(const _ in n){const b=n[_];_.endsWith("-transition")?this._transitionable.setTransition(_.slice(0,-11),b):this._transitionable.setValue(_,b)}}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,u,_){return(!_||_.validate!==!1)&&c.y(this,n.call(c.z,{value:u,style:{glyphs:!0,sprite:!0},styleSpec:c.v}))}}const Zt=new c.r({"sky-color":new c.D(c.v.sky["sky-color"]),"horizon-color":new c.D(c.v.sky["horizon-color"]),"fog-color":new c.D(c.v.sky["fog-color"]),"fog-ground-blend":new c.D(c.v.sky["fog-ground-blend"]),"horizon-fog-blend":new c.D(c.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new c.D(c.v.sky["sky-horizon-blend"]),"atmosphere-blend":new c.D(c.v.sky["atmosphere-blend"])});class xt extends c.E{constructor(n){super(),this._transitionable=new c.t(Zt),this.setSky(n),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new c.F(0))}setSky(n,u={}){if(!this._validate(c.G,n,u)){n||(n={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const _ in n){const b=n[_];_.endsWith("-transition")?this._transitionable.setTransition(_.slice(0,-11),b):this._transitionable.setValue(_,b)}}}getSky(){return this._transitionable.serialize()}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,u,_={}){return(_==null?void 0:_.validate)!==!1&&c.y(this,n.call(c.z,c.e({value:u,style:{glyphs:!0,sprite:!0},styleSpec:c.v})))}calculateFogBlendOpacity(n){return n<60?0:n<70?(n-60)/10:1}}class jt{constructor(n,u){this.width=n,this.height=u,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(n,u){const _=n.join(",")+String(u);return this.dashEntry[_]||(this.dashEntry[_]=this.addDash(n,u)),this.dashEntry[_]}getDashRanges(n,u,_){const b=[];let T=n.length%2==1?-n[n.length-1]*_:0,I=n[0]*_,O=!0;b.push({left:T,right:I,isDash:O,zeroLength:n[0]===0});let N=n[0];for(let j=1;j<n.length;j++){O=!O;const $=n[j];T=N*_,N+=$,I=N*_,b.push({left:T,right:I,isDash:O,zeroLength:$===0})}return b}addRoundDash(n,u,_){const b=u/2;for(let T=-_;T<=_;T++){const I=this.width*(this.nextRow+_+T);let O=0,N=n[O];for(let j=0;j<this.width;j++){j/N.right>1&&(N=n[++O]);const $=Math.abs(j-N.left),X=Math.abs(j-N.right),W=Math.min($,X);let ee;const ae=T/_*(b+1);if(N.isDash){const _e=b-Math.abs(ae);ee=Math.sqrt(W*W+_e*_e)}else ee=b-Math.sqrt(W*W+ae*ae);this.data[I+j]=Math.max(0,Math.min(255,ee+128))}}}addRegularDash(n){for(let O=n.length-1;O>=0;--O){const N=n[O],j=n[O+1];N.zeroLength?n.splice(O,1):j&&j.isDash===N.isDash&&(j.left=N.left,n.splice(O,1))}const u=n[0],_=n[n.length-1];u.isDash===_.isDash&&(u.left=_.left-this.width,_.right=u.right+this.width);const b=this.width*this.nextRow;let T=0,I=n[T];for(let O=0;O<this.width;O++){O/I.right>1&&(I=n[++T]);const N=Math.abs(O-I.left),j=Math.abs(O-I.right),$=Math.min(N,j);this.data[b+O]=Math.max(0,Math.min(255,(I.isDash?$:-$)+128))}}addDash(n,u){const _=u?7:0,b=2*_+1;if(this.nextRow+b>this.height)return c.w("LineAtlas out of space"),null;let T=0;for(let O=0;O<n.length;O++)T+=n[O];if(T!==0){const O=this.width/T,N=this.getDashRanges(n,this.width,O);u?this.addRoundDash(N,O,_):this.addRegularDash(N)}const I={y:(this.nextRow+_+.5)/this.height,height:2*_/this.height,width:T};return this.nextRow+=b,this.dirty=!0,I}bind(n){const u=n.gl;this.texture?(u.bindTexture(u.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,u.texSubImage2D(u.TEXTURE_2D,0,0,0,this.width,this.height,u.ALPHA,u.UNSIGNED_BYTE,this.data))):(this.texture=u.createTexture(),u.bindTexture(u.TEXTURE_2D,this.texture),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.REPEAT),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.REPEAT),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.LINEAR),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,u.LINEAR),u.texImage2D(u.TEXTURE_2D,0,u.ALPHA,this.width,this.height,0,u.ALPHA,u.UNSIGNED_BYTE,this.data))}}const Ie="maplibre_preloaded_worker_pool";class lt{constructor(){this.active={}}acquire(n){if(!this.workers)for(this.workers=[];this.workers.length<lt.workerCount;)this.workers.push(new Worker(c.a.WORKER_URL));return this.active[n]=!0,this.workers.slice()}release(n){delete this.active[n],this.numActive()===0&&(this.workers.forEach((u=>{u.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[Ie]}numActive(){return Object.keys(this.active).length}}const Dt=Math.floor(Y.hardwareConcurrency/2);let zt,Xt;function an(){return zt||(zt=new lt),zt}lt.workerCount=c.H(globalThis)?Math.max(Math.min(Dt,3),1):1;class Ft{constructor(n,u){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=u;const _=this.workerPool.acquire(u);for(let b=0;b<_.length;b++){const T=new c.J(_[b],u);T.name=`Worker ${b}`,this.actors.push(T)}if(!this.actors.length)throw new Error("No actors found")}broadcast(n,u){const _=[];for(const b of this.actors)_.push(b.sendAsync({type:n,data:u}));return Promise.all(_)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(n=!0){this.actors.forEach((u=>{u.remove()})),this.actors=[],n&&this.workerPool.release(this.id)}registerMessageHandler(n,u){for(const _ of this.actors)_.registerMessageHandler(n,u)}}function Ci(){return Xt||(Xt=new Ft(an(),c.K),Xt.registerMessageHandler("GR",((w,n,u)=>c.m(n,u)))),Xt}function qn(w,n){const u=c.L();return c.M(u,u,[1,1,0]),c.N(u,u,[.5*w.width,.5*w.height,1]),w.calculatePosMatrix?c.O(u,u,w.calculatePosMatrix(n.toUnwrapped())):u}function zr(w,n,u,_,b,T,I){var O;const N=(function(W,ee,ae){if(W)for(const _e of W){const ge=ee[_e];if(ge&&ge.source===ae&&ge.type==="fill-extrusion")return!0}else for(const _e in ee){const ge=ee[_e];if(ge.source===ae&&ge.type==="fill-extrusion")return!0}return!1})((O=b==null?void 0:b.layers)!==null&&O!==void 0?O:null,n,w.id),j=T.maxPitchScaleFactor(),$=w.tilesIn(_,j,N);$.sort(co);const X=[];for(const W of $)X.push({wrappedTileID:W.tileID.wrapped().key,queryResults:W.tile.queryRenderedFeatures(n,u,w._state,W.queryGeometry,W.cameraQueryGeometry,W.scale,b,T,j,qn(w.transform,W.tileID),I?(ee,ae)=>I(W.tileID,ee,ae):void 0)});return(function(W,ee){for(const ae in W)for(const _e of W[ae])Us(_e,ee);return W})((function(W){const ee={},ae={};for(const _e of W){const ge=_e.queryResults,ve=_e.wrappedTileID,Te=ae[ve]=ae[ve]||{};for(const Me in ge){const Ae=ge[Me],Le=Te[Me]=Te[Me]||{},Ue=ee[Me]=ee[Me]||[];for(const Ce of Ae)Le[Ce.featureIndex]||(Le[Ce.featureIndex]=!0,Ue.push(Ce))}}return ee})(X),w)}function co(w,n){const u=w.tileID,_=n.tileID;return u.overscaledZ-_.overscaledZ||u.canonical.y-_.canonical.y||u.wrap-_.wrap||u.canonical.x-_.canonical.x}function Us(w,n){const u=w.feature,_=n.getFeatureState(u.layer["source-layer"],u.id);u.source=u.layer.source,u.layer["source-layer"]&&(u.sourceLayer=u.layer["source-layer"]),u.state=_}function Or(w,n,u){return c._(this,void 0,void 0,(function*(){let _=w;if(w.url?_=(yield c.j(n.transformRequest(w.url,"Source"),u)).data:yield Y.frameAsync(u),!_)return null;const b=c.Q(c.e(_,w),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in _&&_.vector_layers&&(b.vectorLayerIds=_.vector_layers.map((T=>T.id))),b}))}class Pi{constructor(n,u){n&&(u?this.setSouthWest(n).setNorthEast(u):Array.isArray(n)&&(n.length===4?this.setSouthWest([n[0],n[1]]).setNorthEast([n[2],n[3]]):this.setSouthWest(n[0]).setNorthEast(n[1])))}setNorthEast(n){return this._ne=n instanceof c.S?new c.S(n.lng,n.lat):c.S.convert(n),this}setSouthWest(n){return this._sw=n instanceof c.S?new c.S(n.lng,n.lat):c.S.convert(n),this}extend(n){const u=this._sw,_=this._ne;let b,T;if(n instanceof c.S)b=n,T=n;else{if(!(n instanceof Pi))return Array.isArray(n)?n.length===4||n.every(Array.isArray)?this.extend(Pi.convert(n)):this.extend(c.S.convert(n)):n&&("lng"in n||"lon"in n)&&"lat"in n?this.extend(c.S.convert(n)):this;if(b=n._sw,T=n._ne,!b||!T)return this}return u||_?(u.lng=Math.min(b.lng,u.lng),u.lat=Math.min(b.lat,u.lat),_.lng=Math.max(T.lng,_.lng),_.lat=Math.max(T.lat,_.lat)):(this._sw=new c.S(b.lng,b.lat),this._ne=new c.S(T.lng,T.lat)),this}getCenter(){return new c.S((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new c.S(this.getWest(),this.getNorth())}getSouthEast(){return new c.S(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(n){const{lng:u,lat:_}=c.S.convert(n);let b=this._sw.lng<=u&&u<=this._ne.lng;return this._sw.lng>this._ne.lng&&(b=this._sw.lng>=u&&u>=this._ne.lng),this._sw.lat<=_&&_<=this._ne.lat&&b}static convert(n){return n instanceof Pi?n:n&&new Pi(n)}static fromLngLat(n,u=0){const _=360*u/40075017,b=_/Math.cos(Math.PI/180*n.lat);return new Pi(new c.S(n.lng-b,n.lat-_),new c.S(n.lng+b,n.lat+_))}adjustAntiMeridian(){const n=new c.S(this._sw.lng,this._sw.lat),u=new c.S(this._ne.lng,this._ne.lat);return new Pi(n,n.lng>u.lng?new c.S(u.lng+360,u.lat):u)}}class er{constructor(n,u,_){this.bounds=Pi.convert(this.validateBounds(n)),this.minzoom=u||0,this.maxzoom=_||24}validateBounds(n){return Array.isArray(n)&&n.length===4?[Math.max(-180,n[0]),Math.max(-90,n[1]),Math.min(180,n[2]),Math.min(90,n[3])]:[-180,-90,180,90]}contains(n){const u=Math.pow(2,n.z),_=Math.floor(c.V(this.bounds.getWest())*u),b=Math.floor(c.U(this.bounds.getNorth())*u),T=Math.ceil(c.V(this.bounds.getEast())*u),I=Math.ceil(c.U(this.bounds.getSouth())*u);return n.x>=_&&n.x<T&&n.y>=b&&n.y<I}}class ds extends c.E{constructor(n,u,_,b){if(super(),this.id=n,this.dispatcher=_,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,c.e(this,c.Q(u,["url","scheme","tileSize","promoteId"])),this._options=c.e({type:"vector"},u),this._collectResourceTiming=u.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(b)}load(){return c._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new c.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const n=yield Or(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),n&&(c.e(this,n),n.bounds&&(this.tileBounds=new er(n.bounds,this.minzoom,this.maxzoom)),this.fire(new c.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.l("data",{dataType:"source",sourceDataType:"content"})))}catch(n){this._tileJSONRequest=null,this.fire(new c.k(n))}}))}loaded(){return this._loaded}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}onAdd(n){this.map=n,this.load()}setSourceProperty(n){this._tileJSONRequest&&this._tileJSONRequest.abort(),n(),this.load()}setTiles(n){return this.setSourceProperty((()=>{this._options.tiles=n})),this}setUrl(n){return this.setSourceProperty((()=>{this.url=n,this._options.url=n})),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return c.e({},this._options)}loadTile(n){return c._(this,void 0,void 0,(function*(){const u=n.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),_={request:this.map._requestManager.transformRequest(u,"Tile"),uid:n.uid,tileID:n.tileID,zoom:n.tileID.overscaledZ,tileSize:this.tileSize*n.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,globalState:this.map.getGlobalState()};_.request.collectResourceTiming=this._collectResourceTiming;let b="RT";if(n.actor&&n.state!=="expired"){if(n.state==="loading")return new Promise(((T,I)=>{n.reloadPromise={resolve:T,reject:I}}))}else n.actor=this.dispatcher.getActor(),b="LT";n.abortController=new AbortController;try{const T=yield n.actor.sendAsync({type:b,data:_},n.abortController);if(delete n.abortController,n.aborted)return;this._afterTileLoadWorkerResponse(n,T)}catch(T){if(delete n.abortController,n.aborted)return;if(T&&T.status!==404)throw T;this._afterTileLoadWorkerResponse(n,null)}}))}_afterTileLoadWorkerResponse(n,u){if(u&&u.resourceTiming&&(n.resourceTiming=u.resourceTiming),u&&this.map._refreshExpiredTiles&&n.setExpiryData(u),n.loadVectorData(u,this.map.painter),n.reloadPromise){const _=n.reloadPromise;n.reloadPromise=null,this.loadTile(n).then(_.resolve).catch(_.reject)}}abortTile(n){return c._(this,void 0,void 0,(function*(){n.abortController&&(n.abortController.abort(),delete n.abortController),n.actor&&(yield n.actor.sendAsync({type:"AT",data:{uid:n.uid,type:this.type,source:this.id}}))}))}unloadTile(n){return c._(this,void 0,void 0,(function*(){n.unloadVectorData(),n.actor&&(yield n.actor.sendAsync({type:"RMT",data:{uid:n.uid,type:this.type,source:this.id}}))}))}hasTransition(){return!1}}class Xa extends c.E{constructor(n,u,_,b){super(),this.id=n,this.dispatcher=_,this.setEventedParent(b),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=c.e({type:"raster"},u),c.e(this,c.Q(u,["url","scheme","tileSize"]))}load(){return c._(this,arguments,void 0,(function*(n=!1){this._loaded=!1,this.fire(new c.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const u=yield Or(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,u&&(c.e(this,u),u.bounds&&(this.tileBounds=new er(u.bounds,this.minzoom,this.maxzoom)),this.fire(new c.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:n})))}catch(u){this._tileJSONRequest=null,this.fire(new c.k(u))}}))}loaded(){return this._loaded}onAdd(n){this.map=n,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(n){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),n(),this.load(!0)}setTiles(n){return this.setSourceProperty((()=>{this._options.tiles=n})),this}setUrl(n){return this.setSourceProperty((()=>{this.url=n,this._options.url=n})),this}serialize(){return c.e({},this._options)}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}loadTile(n){return c._(this,void 0,void 0,(function*(){const u=n.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);n.abortController=new AbortController;try{const _=yield Ke.getImage(this.map._requestManager.transformRequest(u,"Tile"),n.abortController,this.map._refreshExpiredTiles);if(delete n.abortController,n.aborted)return void(n.state="unloaded");if(_&&_.data){this.map._refreshExpiredTiles&&(_.cacheControl||_.expires)&&n.setExpiryData({cacheControl:_.cacheControl,expires:_.expires});const b=this.map.painter.context,T=b.gl,I=_.data;n.texture=this.map.painter.getTileTexture(I.width),n.texture?n.texture.update(I,{useMipmap:!0}):(n.texture=new c.T(b,I,T.RGBA,{useMipmap:!0}),n.texture.bind(T.LINEAR,T.CLAMP_TO_EDGE,T.LINEAR_MIPMAP_NEAREST)),n.state="loaded"}}catch(_){if(delete n.abortController,n.aborted)n.state="unloaded";else if(_)throw n.state="errored",_}}))}abortTile(n){return c._(this,void 0,void 0,(function*(){n.abortController&&(n.abortController.abort(),delete n.abortController)}))}unloadTile(n){return c._(this,void 0,void 0,(function*(){n.texture&&this.map.painter.saveTileTexture(n.texture)}))}hasTransition(){return!1}}class Nr extends Xa{constructor(n,u,_,b){super(n,u,_,b),this.type="raster-dem",this.maxzoom=22,this._options=c.e({type:"raster-dem"},u),this.encoding=u.encoding||"mapbox",this.redFactor=u.redFactor,this.greenFactor=u.greenFactor,this.blueFactor=u.blueFactor,this.baseShift=u.baseShift}loadTile(n){return c._(this,void 0,void 0,(function*(){const u=n.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),_=this.map._requestManager.transformRequest(u,"Tile");n.neighboringTiles=this._getNeighboringTiles(n.tileID),n.abortController=new AbortController;try{const b=yield Ke.getImage(_,n.abortController,this.map._refreshExpiredTiles);if(delete n.abortController,n.aborted)return void(n.state="unloaded");if(b&&b.data){const T=b.data;this.map._refreshExpiredTiles&&(b.cacheControl||b.expires)&&n.setExpiryData({cacheControl:b.cacheControl,expires:b.expires});const I=c.b(T)&&c.W()?T:yield this.readImageNow(T),O={type:this.type,uid:n.uid,source:this.id,rawImageData:I,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!n.actor||n.state==="expired"){n.actor=this.dispatcher.getActor();const N=yield n.actor.sendAsync({type:"LDT",data:O});n.dem=N,n.needsHillshadePrepare=!0,n.needsTerrainPrepare=!0,n.state="loaded"}}}catch(b){if(delete n.abortController,n.aborted)n.state="unloaded";else if(b)throw n.state="errored",b}}))}readImageNow(n){return c._(this,void 0,void 0,(function*(){if(typeof VideoFrame<"u"&&c.X()){const u=n.width+2,_=n.height+2;try{return new c.R({width:u,height:_},yield c.Y(n,-1,-1,u,_))}catch{}}return Y.getImageData(n,1)}))}_getNeighboringTiles(n){const u=n.canonical,_=Math.pow(2,u.z),b=(u.x-1+_)%_,T=u.x===0?n.wrap-1:n.wrap,I=(u.x+1+_)%_,O=u.x+1===_?n.wrap+1:n.wrap,N={};return N[new c.Z(n.overscaledZ,T,u.z,b,u.y).key]={backfilled:!1},N[new c.Z(n.overscaledZ,O,u.z,I,u.y).key]={backfilled:!1},u.y>0&&(N[new c.Z(n.overscaledZ,T,u.z,b,u.y-1).key]={backfilled:!1},N[new c.Z(n.overscaledZ,n.wrap,u.z,u.x,u.y-1).key]={backfilled:!1},N[new c.Z(n.overscaledZ,O,u.z,I,u.y-1).key]={backfilled:!1}),u.y+1<_&&(N[new c.Z(n.overscaledZ,T,u.z,b,u.y+1).key]={backfilled:!1},N[new c.Z(n.overscaledZ,n.wrap,u.z,u.x,u.y+1).key]={backfilled:!1},N[new c.Z(n.overscaledZ,O,u.z,I,u.y+1).key]={backfilled:!1}),N}unloadTile(n){return c._(this,void 0,void 0,(function*(){n.demTexture&&this.map.painter.saveTileTexture(n.demTexture),n.fbo&&(n.fbo.destroy(),delete n.fbo),n.dem&&delete n.dem,delete n.neighboringTiles,n.state="unloaded",n.actor&&(yield n.actor.sendAsync({type:"RDT",data:{type:this.type,uid:n.uid,source:this.id}}))}))}}class Ba extends c.E{constructor(n,u,_,b){super(),this.id=n,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._isUpdatingWorker=!1,this._pendingWorkerUpdate={data:u.data},this.actor=_.getActor(),this.setEventedParent(b),this._data=u.data,this._options=c.e({},u),this._collectResourceTiming=u.collectResourceTiming,u.maxzoom!==void 0&&(this.maxzoom=u.maxzoom),u.type&&(this.type=u.type),u.attribution&&(this.attribution=u.attribution),this.promoteId=u.promoteId,u.clusterMaxZoom!==void 0&&this.maxzoom<=u.clusterMaxZoom&&c.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${u.clusterMaxZoom}".`),this.workerOptions=c.e({source:this.id,cluster:u.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(u.buffer!==void 0?u.buffer:128),tolerance:this._pixelsToTileUnits(u.tolerance!==void 0?u.tolerance:.375),extent:c.$,maxZoom:this.maxzoom,lineMetrics:u.lineMetrics||!1,generateId:u.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(u.clusterMaxZoom),minPoints:Math.max(2,u.clusterMinPoints||2),extent:c.$,radius:this._pixelsToTileUnits(u.clusterRadius||50),log:!1,generateId:u.generateId||!1},clusterProperties:u.clusterProperties,filter:u.filter},u.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_pixelsToTileUnits(n){return n*(c.$/this.tileSize)}_getClusterMaxZoom(n){const u=n?Math.round(n):this.maxzoom-1;return Number.isInteger(n)||n===void 0||c.w(`Integer expected for option 'clusterMaxZoom': provided value "${n}" rounded to "${u}"`),u}load(){return c._(this,void 0,void 0,(function*(){yield this._updateWorkerData()}))}onAdd(n){this.map=n,this.load()}setData(n){return this._data=n,this._pendingWorkerUpdate={data:n},this._updateWorkerData(),this}updateData(n){return this._pendingWorkerUpdate.diff=c.a0(this._pendingWorkerUpdate.diff,n),this._updateWorkerData(),this}getData(){return c._(this,void 0,void 0,(function*(){const n=c.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:n})}))}getCoordinatesFromGeometry(n){return n.type==="GeometryCollection"?n.geometries.map((u=>u.coordinates)).flat(1/0):n.coordinates.flat(1/0)}getBounds(){return c._(this,void 0,void 0,(function*(){const n=new Pi,u=yield this.getData();let _;switch(u.type){case"FeatureCollection":_=u.features.map((b=>this.getCoordinatesFromGeometry(b.geometry))).flat(1/0);break;case"Feature":_=this.getCoordinatesFromGeometry(u.geometry);break;default:_=this.getCoordinatesFromGeometry(u)}if(_.length==0)return n;for(let b=0;b<_.length-1;b+=2)n.extend([_[b],_[b+1]]);return n}))}setClusterOptions(n){return this.workerOptions.cluster=n.cluster,n&&(n.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(n.clusterRadius)),n.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(n.clusterMaxZoom))),this._updateWorkerData(),this}getClusterExpansionZoom(n){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:n,source:this.id}})}getClusterChildren(n){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:n,source:this.id}})}getClusterLeaves(n,u,_){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:n,limit:u,offset:_}})}_updateWorkerData(){return c._(this,void 0,void 0,(function*(){if(this._isUpdatingWorker)return;const{data:n,diff:u}=this._pendingWorkerUpdate;if(!n&&!u)return void c.w(`No data or diff provided to GeoJSONSource ${this.id}.`);const _=c.e({type:this.type},this.workerOptions);n?(typeof n=="string"?(_.request=this.map._requestManager.transformRequest(Y.resolveURL(n),"Source"),_.request.collectResourceTiming=this._collectResourceTiming):_.data=JSON.stringify(n),this._pendingWorkerUpdate.data=void 0):u&&(_.dataDiff=u,this._pendingWorkerUpdate.diff=void 0),this._isUpdatingWorker=!0,this.fire(new c.l("dataloading",{dataType:"source"}));try{const b=yield this.actor.sendAsync({type:"LD",data:_});if(this._isUpdatingWorker=!1,this._removed||b.abandoned)return void this.fire(new c.l("dataabort",{dataType:"source"}));this._data=b.data;let T=null;b.resourceTiming&&b.resourceTiming[this.id]&&(T=b.resourceTiming[this.id].slice(0));const I={dataType:"source"};this._collectResourceTiming&&T&&T.length>0&&c.e(I,{resourceTiming:T}),this.fire(new c.l("data",Object.assign(Object.assign({},I),{sourceDataType:"metadata"}))),this.fire(new c.l("data",Object.assign(Object.assign({},I),{sourceDataType:"content"})))}catch(b){if(this._isUpdatingWorker=!1,this._removed)return void this.fire(new c.l("dataabort",{dataType:"source"}));this.fire(new c.k(b))}finally{(this._pendingWorkerUpdate.data||this._pendingWorkerUpdate.diff)&&this._updateWorkerData()}}))}loaded(){return!this._isUpdatingWorker&&this._pendingWorkerUpdate.data===void 0&&this._pendingWorkerUpdate.diff===void 0}loadTile(n){return c._(this,void 0,void 0,(function*(){const u=n.actor?"RT":"LT";n.actor=this.actor;const _={type:this.type,uid:n.uid,tileID:n.tileID,zoom:n.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,globalState:this.map.getGlobalState()};n.abortController=new AbortController;const b=yield this.actor.sendAsync({type:u,data:_},n.abortController);delete n.abortController,n.unloadVectorData(),n.aborted||n.loadVectorData(b,this.map.painter,u==="RT")}))}abortTile(n){return c._(this,void 0,void 0,(function*(){n.abortController&&(n.abortController.abort(),delete n.abortController),n.aborted=!0}))}unloadTile(n){return c._(this,void 0,void 0,(function*(){n.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:n.uid,type:this.type,source:this.id}})}))}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return c.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}class Fi extends c.E{constructor(n,u,_,b){super(),this.flippedWindingOrder=!1,this.id=n,this.dispatcher=_,this.coordinates=u.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(b),this.options=u}load(n){return c._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new c.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const u=yield Ke.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,u&&u.data&&(this.image=u.data,n&&(this.coordinates=n),this._finishLoading())}catch(u){this._request=null,this._loaded=!0,this.fire(new c.k(u))}}))}loaded(){return this._loaded}updateImage(n){return n.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=n.url,this.load(n.coordinates).finally((()=>{this.texture=null})),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new c.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(n){this.map=n,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(n){this.coordinates=n;const u=n.map(c.a1.fromLngLat);var _;return this.tileID=(function(b){const T=c.a2.fromPoints(b),I=T.width(),O=T.height(),N=Math.max(I,O),j=Math.max(0,Math.floor(-Math.log(N)/Math.LN2)),$=Math.pow(2,j);return new c.a4(j,Math.floor((T.minX+T.maxX)/2*$),Math.floor((T.minY+T.maxY)/2*$))})(u),this.terrainTileRanges=this._getOverlappingTileRanges(u),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=u.map((b=>this.tileID.getTilePoint(b)._round())),this.flippedWindingOrder=((_=this.tileCoords)[1].x-_[0].x)*(_[2].y-_[0].y)-(_[1].y-_[0].y)*(_[2].x-_[0].x)<0,this.fire(new c.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const n=this.map.painter.context,u=n.gl;this.texture||(this.texture=new c.T(n,this.image,u.RGBA),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE));let _=!1;for(const b in this.tiles){const T=this.tiles[b];T.state!=="loaded"&&(T.state="loaded",T.texture=this.texture,_=!0)}_&&this.fire(new c.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(n){return c._(this,void 0,void 0,(function*(){this.tileID&&this.tileID.equals(n.tileID.canonical)?(this.tiles[String(n.tileID.wrap)]=n,n.buckets={}):n.state="errored"}))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(n){const{minX:u,minY:_,maxX:b,maxY:T}=c.a2.fromPoints(n),I={};for(let O=0;O<=c.a3;O++){const N=Math.pow(2,O),j=Math.floor(u*N),$=Math.floor(_*N),X=Math.floor(b*N),W=Math.floor(T*N);I[O]={minTileX:j,minTileY:$,maxTileX:X,maxTileY:W}}return I}}class fr extends Fi{constructor(n,u,_,b){super(n,u,_,b),this.roundZoom=!0,this.type="video",this.options=u}load(){return c._(this,void 0,void 0,(function*(){this._loaded=!1;const n=this.options;this.urls=[];for(const u of n.urls)this.urls.push(this.map._requestManager.transformRequest(u,"Source").url);try{const u=yield c.a5(this.urls);if(this._loaded=!0,!u)return;this.video=u,this.video.loop=!0,this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading()}catch(u){this.fire(new c.k(u))}}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(n){if(this.video){const u=this.video.seekable;n<u.start(0)||n>u.end(0)?this.fire(new c.k(new c.a6(`sources.${this.id}`,null,`Playback for this video can be set only between the ${u.start(0)} and ${u.end(0)}-second mark.`))):this.video.currentTime=n}}getVideo(){return this.video}onAdd(n){this.map||(this.map=n,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const n=this.map.painter.context,u=n.gl;this.texture?this.video.paused||(this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE),u.texSubImage2D(u.TEXTURE_2D,0,0,0,u.RGBA,u.UNSIGNED_BYTE,this.video)):(this.texture=new c.T(n,this.video,u.RGBA),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE));let _=!1;for(const b in this.tiles){const T=this.tiles[b];T.state!=="loaded"&&(T.state="loaded",T.texture=this.texture,_=!0)}_&&this.fire(new c.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class fa extends Fi{constructor(n,u,_,b){super(n,u,_,b),u.coordinates?Array.isArray(u.coordinates)&&u.coordinates.length===4&&!u.coordinates.some((T=>!Array.isArray(T)||T.length!==2||T.some((I=>typeof I!="number"))))||this.fire(new c.k(new c.a6(`sources.${n}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new c.k(new c.a6(`sources.${n}`,null,'missing required property "coordinates"'))),u.animate&&typeof u.animate!="boolean"&&this.fire(new c.k(new c.a6(`sources.${n}`,null,'optional "animate" property must be a boolean value'))),u.canvas?typeof u.canvas=="string"||u.canvas instanceof HTMLCanvasElement||this.fire(new c.k(new c.a6(`sources.${n}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new c.k(new c.a6(`sources.${n}`,null,'missing required property "canvas"'))),this.options=u,this.animate=u.animate===void 0||u.animate}load(){return c._(this,void 0,void 0,(function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new c.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}))}getCanvas(){return this.canvas}onAdd(n){this.map=n,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let n=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,n=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,n=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const u=this.map.painter.context,_=u.gl;this.texture?(n||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new c.T(u,this.canvas,_.RGBA,{premultiply:!0});let b=!1;for(const T in this.tiles){const I=this.tiles[T];I.state!=="loaded"&&(I.state="loaded",I.texture=this.texture,b=!0)}b&&this.fire(new c.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const n of[this.canvas.width,this.canvas.height])if(isNaN(n)||n<=0)return!0;return!1}}const Po={},js=w=>{switch(w){case"geojson":return Ba;case"image":return Fi;case"raster":return Xa;case"raster-dem":return Nr;case"vector":return ds;case"video":return fr;case"canvas":return fa}return Po[w]},Tl="RTLPluginLoaded";class fs extends c.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Ci()}_syncState(n){return this.status=n,this.dispatcher.broadcast("SRPS",{pluginStatus:n,pluginURL:this.url}).catch((u=>{throw this.status="error",u}))}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(n){return c._(this,arguments,void 0,(function*(u,_=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=Y.resolveURL(u),!this.url)throw new Error(`requested url ${u} is invalid`);if(this.status==="unavailable"){if(!_)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()}))}_requestImport(){return c._(this,void 0,void 0,(function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new c.l(Tl))}))}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Ta=null;function pr(){return Ta||(Ta=new fs),Ta}class pa{constructor(n,u){this.timeAdded=0,this.fadeEndTime=0,this.tileID=n,this.uid=c.a7(),this.uses=0,this.tileSize=u,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(n){const u=n+this.timeAdded;u<this.fadeEndTime||(this.fadeEndTime=u)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(n){this.demTexture&&n.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(n,u,_){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",n){n.featureIndex&&(this.latestFeatureIndex=n.featureIndex,n.rawTileData?(this.latestRawTileData=n.rawTileData,this.latestFeatureIndex.rawTileData=n.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=n.collisionBoxArray,this.buckets=(function(b,T){const I={};if(!T)return I;for(const O of b){const N=O.layerIds.map((j=>T.getLayer(j))).filter(Boolean);if(N.length!==0){O.layers=N,O.stateDependentLayerIds&&(O.stateDependentLayers=O.stateDependentLayerIds.map((j=>N.filter(($=>$.id===j))[0])));for(const j of N)I[j.id]=O}}return I})(n.buckets,u==null?void 0:u.style),this.hasSymbolBuckets=!1;for(const b in this.buckets){const T=this.buckets[b];if(T instanceof c.a9){if(this.hasSymbolBuckets=!0,!_)break;T.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const b in this.buckets){const T=this.buckets[b];if(T instanceof c.a9&&T.hasRTLText){this.hasRTLText=!0,pr().lazyLoad();break}}this.queryPadding=0;for(const b in this.buckets){const T=this.buckets[b];this.queryPadding=Math.max(this.queryPadding,u.style.getLayer(b).queryRadius(T))}n.imageAtlas&&(this.imageAtlas=n.imageAtlas),n.glyphAtlasImage&&(this.glyphAtlasImage=n.glyphAtlasImage)}else this.collisionBoxArray=new c.a8}unloadVectorData(){for(const n in this.buckets)this.buckets[n].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(n){return this.buckets[n.id]}upload(n){for(const _ in this.buckets){const b=this.buckets[_];b.uploadPending()&&b.upload(n)}const u=n.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new c.T(n,this.imageAtlas.image,u.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new c.T(n,this.glyphAtlasImage,u.ALPHA),this.glyphAtlasImage=null)}prepare(n){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(n,this.imageAtlasTexture)}queryRenderedFeatures(n,u,_,b,T,I,O,N,j,$,X){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:b,cameraQueryGeometry:T,scale:I,tileSize:this.tileSize,pixelPosMatrix:$,transform:N,params:O,queryPadding:this.queryPadding*j,getElevation:X},n,u,_):{}}querySourceFeatures(n,u){const _=this.latestFeatureIndex;if(!_||!_.rawTileData)return;const b=_.loadVTLayers(),T=u&&u.sourceLayer?u.sourceLayer:"",I=b._geojsonTileLayer||b[T];if(!I)return;const O=c.aa(u&&u.filter),{z:N,x:j,y:$}=this.tileID.canonical,X={z:N,x:j,y:$};for(let W=0;W<I.length;W++){const ee=I.feature(W);if(O.needGeometry){const ge=c.ab(ee,!0);if(!O.filter(new c.F(this.tileID.overscaledZ),ge,this.tileID.canonical))continue}else if(!O.filter(new c.F(this.tileID.overscaledZ),ee))continue;const ae=_.getId(ee,T),_e=new c.ac(ee,N,j,$,ae);_e.tile=X,n.push(_e)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(n){const u=this.expirationTime;if(n.cacheControl){const _=c.ad(n.cacheControl);_["max-age"]&&(this.expirationTime=Date.now()+1e3*_["max-age"])}else n.expires&&(this.expirationTime=new Date(n.expires).getTime());if(this.expirationTime){const _=Date.now();let b=!1;if(this.expirationTime>_)b=!1;else if(u)if(this.expirationTime<u)b=!0;else{const T=this.expirationTime-u;T?this.expirationTime=_+Math.max(T,3e4):b=!0}else b=!0;b?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(n,u){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(n).length===0)return;const _=this.latestFeatureIndex.loadVTLayers();for(const b in this.buckets){if(!u.style.hasLayer(b))continue;const T=this.buckets[b],I=T.layers[0].sourceLayer||"_geojsonTileLayer",O=_[I],N=n[I];if(!O||!N||Object.keys(N).length===0)continue;T.update(N,O,this.imageAtlas&&this.imageAtlas.patternPositions||{});const j=u&&u.style&&u.style.getLayer(b);j&&(this.queryPadding=Math.max(this.queryPadding,j.queryRadius(T)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Y.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(n){this.symbolFadeHoldUntil=Y.now()+n}setDependencies(n,u){const _={};for(const b of u)_[b]=!0;this.dependencies[n]=_}hasDependency(n,u){for(const _ of n){const b=this.dependencies[_];if(b){for(const T of u)if(b[T])return!0}}return!1}}class je{constructor(n,u){this.max=n,this.onRemove=u,this.reset()}reset(){for(const n in this.data)for(const u of this.data[n])u.timeout&&clearTimeout(u.timeout),this.onRemove(u.value);return this.data={},this.order=[],this}add(n,u,_){const b=n.wrapped().key;this.data[b]===void 0&&(this.data[b]=[]);const T={value:u,timeout:void 0};if(_!==void 0&&(T.timeout=setTimeout((()=>{this.remove(n,T)}),_)),this.data[b].push(T),this.order.push(b),this.order.length>this.max){const I=this._getAndRemoveByKey(this.order[0]);I&&this.onRemove(I)}return this}has(n){return n.wrapped().key in this.data}getAndRemove(n){return this.has(n)?this._getAndRemoveByKey(n.wrapped().key):null}_getAndRemoveByKey(n){const u=this.data[n].shift();return u.timeout&&clearTimeout(u.timeout),this.data[n].length===0&&delete this.data[n],this.order.splice(this.order.indexOf(n),1),u.value}getByKey(n){const u=this.data[n];return u?u[0].value:null}get(n){return this.has(n)?this.data[n.wrapped().key][0].value:null}remove(n,u){if(!this.has(n))return this;const _=n.wrapped().key,b=u===void 0?0:this.data[_].indexOf(u),T=this.data[_][b];return this.data[_].splice(b,1),T.timeout&&clearTimeout(T.timeout),this.data[_].length===0&&delete this.data[_],this.onRemove(T.value),this.order.splice(this.order.indexOf(_),1),this}setMaxSize(n){for(this.max=n;this.order.length>this.max;){const u=this._getAndRemoveByKey(this.order[0]);u&&this.onRemove(u)}return this}filter(n){const u=[];for(const _ in this.data)for(const b of this.data[_])n(b.value)||u.push(b);for(const _ of u)this.remove(_.value.tileID,_)}}class se{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(n,u,_){const b=String(u);if(this.stateChanges[n]=this.stateChanges[n]||{},this.stateChanges[n][b]=this.stateChanges[n][b]||{},c.e(this.stateChanges[n][b],_),this.deletedStates[n]===null){this.deletedStates[n]={};for(const T in this.state[n])T!==b&&(this.deletedStates[n][T]=null)}else if(this.deletedStates[n]&&this.deletedStates[n][b]===null){this.deletedStates[n][b]={};for(const T in this.state[n][b])_[T]||(this.deletedStates[n][b][T]=null)}else for(const T in _)this.deletedStates[n]&&this.deletedStates[n][b]&&this.deletedStates[n][b][T]===null&&delete this.deletedStates[n][b][T]}removeFeatureState(n,u,_){if(this.deletedStates[n]===null)return;const b=String(u);if(this.deletedStates[n]=this.deletedStates[n]||{},_&&u!==void 0)this.deletedStates[n][b]!==null&&(this.deletedStates[n][b]=this.deletedStates[n][b]||{},this.deletedStates[n][b][_]=null);else if(u!==void 0)if(this.stateChanges[n]&&this.stateChanges[n][b])for(_ in this.deletedStates[n][b]={},this.stateChanges[n][b])this.deletedStates[n][b][_]=null;else this.deletedStates[n][b]=null;else this.deletedStates[n]=null}getState(n,u){const _=String(u),b=c.e({},(this.state[n]||{})[_],(this.stateChanges[n]||{})[_]);if(this.deletedStates[n]===null)return{};if(this.deletedStates[n]){const T=this.deletedStates[n][u];if(T===null)return{};for(const I in T)delete b[I]}return b}initializeTileState(n,u){n.setFeatureState(this.state,u)}coalesceChanges(n,u){const _={};for(const b in this.stateChanges){this.state[b]=this.state[b]||{};const T={};for(const I in this.stateChanges[b])this.state[b][I]||(this.state[b][I]={}),c.e(this.state[b][I],this.stateChanges[b][I]),T[I]=this.state[b][I];_[b]=T}for(const b in this.deletedStates){this.state[b]=this.state[b]||{};const T={};if(this.deletedStates[b]===null)for(const I in this.state[b])T[I]={},this.state[b][I]={};else for(const I in this.deletedStates[b]){if(this.deletedStates[b][I]===null)this.state[b][I]={};else for(const O of Object.keys(this.deletedStates[b][I]))delete this.state[b][I][O];T[I]=this.state[b][I]}_[b]=_[b]||{},c.e(_[b],T)}if(this.stateChanges={},this.deletedStates={},Object.keys(_).length!==0)for(const b in n)n[b].setFeatureState(_,u)}}const le=89.25;function fe(w,n){const u=c.ah(n.lat,-c.ai,c.ai);return new c.P(c.V(n.lng)*w,c.U(u)*w)}function Se(w,n){return new c.a1(n.x/w,n.y/w).toLngLat()}function Ne(w){return w.cameraToCenterDistance*Math.min(.85*Math.tan(c.ae(90-w.pitch)),Math.tan(c.ae(le-w.pitch)))}function Ge(w,n){const u=w.canonical,_=n/c.af(u.z),b=u.x+Math.pow(2,u.z)*w.wrap,T=c.ag(new Float64Array(16));return c.M(T,T,[b*_,u.y*_,0]),c.N(T,T,[_/c.$,_/c.$,1]),T}function Je(w,n,u,_,b){const T=c.a1.fromLngLat(w,n),I=b*c.aj(1,w.lat),O=I*Math.cos(c.ae(u)),N=Math.sqrt(I*I-O*O),j=N*Math.sin(c.ae(-_)),$=N*Math.cos(c.ae(-_));return new c.a1(T.x+j,T.y+$,T.z+O)}function Ze(w,n,u){const _=n.intersectsFrustum(w);if(!u||_===0)return _;const b=n.intersectsPlane(u);return b===0?0:_===2&&b===2?2:1}function yt(w,n,u){let _=0;const b=(u-n)/10;for(let T=0;T<10;T++)_+=b*Math.pow(Math.cos(n+(T+.5)/10*(u-n)),w);return _}function At(w,n){return function(u,_,b,T,I){const O=2*((w-1)/c.ak(Math.cos(c.ae(le-I))/Math.cos(c.ae(le)))-1),N=Math.acos(b/T),j=2*yt(O-1,0,c.ae(I/2)),$=Math.min(c.ae(le),N+c.ae(I/2)),X=yt(O-1,Math.min($,N-c.ae(I/2)),$),W=Math.atan(_/b),ee=Math.hypot(_,b);let ae=u;return ae+=c.ak(T/ee/Math.max(.5,Math.cos(c.ae(I/2)))),ae+=O*c.ak(Math.cos(W))/2,ae-=c.ak(Math.max(1,X/j/n))/2,ae}}const bt=At(9.314,3);function en(w,n){const u=(n.roundZoom?Math.round:Math.floor)(w.zoom+c.ak(w.tileSize/n.tileSize));return Math.max(0,u)}function qe(w,n){const u=w.getCameraFrustum(),_=w.getClippingPlane(),b=w.screenPointToMercatorCoordinate(w.getCameraPoint()),T=c.a1.fromLngLat(w.center,w.elevation);b.z=T.z+Math.cos(w.pitchInRadians)*w.cameraToCenterDistance/w.worldSize;const I=w.getCoveringTilesDetailsProvider(),O=I.allowVariableZoom(w,n),N=en(w,n),j=n.minzoom||0,$=n.maxzoom!==void 0?n.maxzoom:w.maxZoom,X=Math.min(Math.max(0,N),$),W=Math.pow(2,X),ee=[W*b.x,W*b.y,0],ae=[W*T.x,W*T.y,0],_e=Math.hypot(T.x-b.x,T.y-b.y),ge=Math.abs(T.z-b.z),ve=Math.hypot(_e,ge),Te=Le=>({zoom:0,x:0,y:0,wrap:Le,fullyVisible:!1}),Me=[],Ae=[];if(w.renderWorldCopies&&I.allowWorldCopies())for(let Le=1;Le<=3;Le++)Me.push(Te(-Le)),Me.push(Te(Le));for(Me.push(Te(0));Me.length>0;){const Le=Me.pop(),Ue=Le.x,Ce=Le.y;let We=Le.fullyVisible;const dt={x:Ue,y:Ce,z:Le.zoom},rt=I.getTileBoundingVolume(dt,Le.wrap,w.elevation,n);if(!We){const Bt=Ze(u,rt,_);if(Bt===0)continue;We=Bt===2}const st=I.distanceToTile2d(b.x,b.y,dt,rt);let ct=N;O&&(ct=(n.calculateTileZoom||bt)(w.zoom+c.ak(w.tileSize/n.tileSize),st,ge,ve,w.fov)),ct=(n.roundZoom?Math.round:Math.floor)(ct),ct=Math.max(0,ct);const Ot=Math.min(ct,$);if(Le.wrap=I.getWrap(T,dt,Le.wrap),Le.zoom>=Ot){if(Le.zoom<j)continue;const Bt=X-Le.zoom,Et=ee[0]-.5-(Ue<<Bt),un=ee[1]-.5-(Ce<<Bt),Kn=n.reparseOverscaled?Math.max(Le.zoom,ct):Le.zoom;Ae.push({tileID:new c.Z(Le.zoom===$?Kn:Le.zoom,Le.wrap,Le.zoom,Ue,Ce),distanceSq:c.al([ae[0]-.5-Ue,ae[1]-.5-Ce]),tileDistanceToCamera:Math.sqrt(Et*Et+un*un)})}else for(let Bt=0;Bt<4;Bt++)Me.push({zoom:Le.zoom+1,x:(Ue<<1)+Bt%2,y:(Ce<<1)+(Bt>>1),wrap:Le.wrap,fullyVisible:We})}return Ae.sort(((Le,Ue)=>Le.distanceSq-Ue.distanceSq)).map((Le=>Le.tileID))}const Cn=c.a2.fromPoints([new c.P(0,0),new c.P(c.$,c.$)]);class Fn extends c.E{constructor(n,u,_){super(),this.id=n,this.dispatcher=_,this.on("data",(b=>this._dataHandler(b))),this.on("dataloading",(()=>{this._sourceErrored=!1})),this.on("error",(()=>{this._sourceErrored=this._source.loaded()})),this._source=((b,T,I,O)=>{const N=new(js(T.type))(b,T,I,O);if(N.id!==b)throw new Error(`Expected Source id to be ${b} instead of ${N.id}`);return N})(n,u,_,this),this._tiles={},this._cache=new je(0,(b=>this._unloadTile(b))),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new se,this._didEmitContent=!1,this._updated=!1}onAdd(n){this.map=n,this._maxTileCacheSize=n?n._maxTileCacheSize:null,this._maxTileCacheZoomLevels=n?n._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(n)}onRemove(n){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(n)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const n in this._tiles){const u=this._tiles[n];if(u.state!=="loaded"&&u.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const n=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,n&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(n,u,_){return c._(this,void 0,void 0,(function*(){try{yield this._source.loadTile(n),this._tileLoaded(n,u,_)}catch(b){n.state="errored",b.status!==404?this._source.fire(new c.k(b,{tile:n})):this.update(this.transform,this.terrain)}}))}_unloadTile(n){this._source.unloadTile&&this._source.unloadTile(n)}_abortTile(n){this._source.abortTile&&this._source.abortTile(n),this._source.fire(new c.l("dataabort",{tile:n,coord:n.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(n){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const u in this._tiles){const _=this._tiles[u];_.upload(n),_.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map((n=>n.tileID)).sort(rn).map((n=>n.key))}getRenderableIds(n){const u=[];for(const _ in this._tiles)this._isIdRenderable(_,n)&&u.push(this._tiles[_]);return n?u.sort(((_,b)=>{const T=_.tileID,I=b.tileID,O=new c.P(T.canonical.x,T.canonical.y)._rotate(-this.transform.bearingInRadians),N=new c.P(I.canonical.x,I.canonical.y)._rotate(-this.transform.bearingInRadians);return T.overscaledZ-I.overscaledZ||N.y-O.y||N.x-O.x})).map((_=>_.tileID.key)):u.map((_=>_.tileID)).sort(rn).map((_=>_.key))}hasRenderableParent(n){const u=this.findLoadedParent(n,0);return!!u&&this._isIdRenderable(u.tileID.key)}_isIdRenderable(n,u){return this._tiles[n]&&this._tiles[n].hasData()&&!this._coveredTiles[n]&&(u||!this._tiles[n].holdingForFade())}reload(n){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const u in this._tiles)n?this._reloadTile(u,"expired"):this._tiles[u].state!=="errored"&&this._reloadTile(u,"reloading")}}_reloadTile(n,u){return c._(this,void 0,void 0,(function*(){const _=this._tiles[n];_&&(_.state!=="loading"&&(_.state=u),yield this._loadTile(_,n,u))}))}_tileLoaded(n,u,_){n.timeAdded=Y.now(),_==="expired"&&(n.refreshedUponExpiration=!0),this._setTileReloadTimer(u,n),this.getSource().type==="raster-dem"&&n.dem&&this._backfillDEM(n),this._state.initializeTileState(n,this.map?this.map.painter:null),n.aborted||this._source.fire(new c.l("data",{dataType:"source",tile:n,coord:n.tileID}))}_backfillDEM(n){const u=this.getRenderableIds();for(let b=0;b<u.length;b++){const T=u[b];if(n.neighboringTiles&&n.neighboringTiles[T]){const I=this.getTileByID(T);_(n,I),_(I,n)}}function _(b,T){b.needsHillshadePrepare=!0,b.needsTerrainPrepare=!0;let I=T.tileID.canonical.x-b.tileID.canonical.x;const O=T.tileID.canonical.y-b.tileID.canonical.y,N=Math.pow(2,b.tileID.canonical.z),j=T.tileID.key;I===0&&O===0||Math.abs(O)>1||(Math.abs(I)>1&&(Math.abs(I+N)===1?I+=N:Math.abs(I-N)===1&&(I-=N)),T.dem&&b.dem&&(b.dem.backfillBorder(T.dem,I,O),b.neighboringTiles&&b.neighboringTiles[j]&&(b.neighboringTiles[j].backfilled=!0)))}}getTile(n){return this.getTileByID(n.key)}getTileByID(n){return this._tiles[n]}_retainLoadedChildren(n,u,_,b){for(const T in this._tiles){let I=this._tiles[T];if(b[T]||!I.hasData()||I.tileID.overscaledZ<=u||I.tileID.overscaledZ>_)continue;let O=I.tileID;for(;I&&I.tileID.overscaledZ>u+1;){const j=I.tileID.scaledTo(I.tileID.overscaledZ-1);I=this._tiles[j.key],I&&I.hasData()&&(O=j)}let N=O;for(;N.overscaledZ>u;)if(N=N.scaledTo(N.overscaledZ-1),n[N.key]||n[N.canonical.key]){b[O.key]=O;break}}}findLoadedParent(n,u){if(n.key in this._loadedParentTiles){const _=this._loadedParentTiles[n.key];return _&&_.tileID.overscaledZ>=u?_:null}for(let _=n.overscaledZ-1;_>=u;_--){const b=n.scaledTo(_),T=this._getLoadedTile(b);if(T)return T}}findLoadedSibling(n){return this._getLoadedTile(n)}_getLoadedTile(n){const u=this._tiles[n.key];return u&&u.hasData()?u:this._cache.getByKey(n.wrapped().key)}updateCacheSize(n){const u=Math.ceil(n.width/this._source.tileSize)+1,_=Math.ceil(n.height/this._source.tileSize)+1,b=Math.floor(u*_*(this._maxTileCacheZoomLevels===null?c.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),T=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,b):b;this._cache.setMaxSize(T)}handleWrapJump(n){const u=Math.round((n-(this._prevLng===void 0?n:this._prevLng))/360);if(this._prevLng=n,u){const _={};for(const b in this._tiles){const T=this._tiles[b];T.tileID=T.tileID.unwrapTo(T.tileID.wrap+u),_[T.tileID.key]=T}this._tiles=_;for(const b in this._timers)clearTimeout(this._timers[b]),delete this._timers[b];for(const b in this._tiles)this._setTileReloadTimer(b,this._tiles[b])}}_updateCoveredAndRetainedTiles(n,u,_,b,T,I){const O={},N={},j=Object.keys(n),$=Y.now();for(const X of j){const W=n[X],ee=this._tiles[X];if(!ee||ee.fadeEndTime!==0&&ee.fadeEndTime<=$)continue;const ae=this.findLoadedParent(W,u),_e=this.findLoadedSibling(W),ge=ae||_e||null;ge&&(this._addTile(ge.tileID),O[ge.tileID.key]=ge.tileID),N[X]=W}this._retainLoadedChildren(N,b,_,n);for(const X in O)n[X]||(this._coveredTiles[X]=!0,n[X]=O[X]);if(I){const X={},W={};for(const ee of T)this._tiles[ee.key].hasData()?X[ee.key]=ee:W[ee.key]=ee;for(const ee in W){const ae=W[ee].children(this._source.maxzoom);this._tiles[ae[0].key]&&this._tiles[ae[1].key]&&this._tiles[ae[2].key]&&this._tiles[ae[3].key]&&(X[ae[0].key]=n[ae[0].key]=ae[0],X[ae[1].key]=n[ae[1].key]=ae[1],X[ae[2].key]=n[ae[2].key]=ae[2],X[ae[3].key]=n[ae[3].key]=ae[3],delete W[ee])}for(const ee in W){const ae=W[ee],_e=this.findLoadedParent(ae,this._source.minzoom),ge=this.findLoadedSibling(ae),ve=_e||ge||null;if(ve){X[ve.tileID.key]=n[ve.tileID.key]=ve.tileID;for(const Te in X)X[Te].isChildOf(ve.tileID)&&delete X[Te]}}for(const ee in this._tiles)X[ee]||(this._coveredTiles[ee]=!0)}}update(n,u){if(!this._sourceLoaded||this._paused)return;let _;this.transform=n,this.terrain=u,this.updateCacheSize(n),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?_=n.getVisibleUnwrappedCoordinates(this._source.tileID).map(($=>new c.Z($.canonical.z,$.wrap,$.canonical.z,$.canonical.x,$.canonical.y))):(_=qe(n,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:u,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(_=_.filter(($=>this._source.hasTile($))))):_=[];const b=en(n,this._source),T=Math.max(b-Fn.maxOverzooming,this._source.minzoom),I=Math.max(b+Fn.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const $={};for(const X of _)if(X.canonical.z>this._source.minzoom){const W=X.scaledTo(X.canonical.z-1);$[W.key]=W;const ee=X.scaledTo(Math.max(this._source.minzoom,Math.min(X.canonical.z,5)));$[ee.key]=ee}_=_.concat(Object.values($))}const O=_.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,O&&this.fire(new c.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const N=this._updateRetainedTiles(_,b);Dn(this._source.type)&&this._updateCoveredAndRetainedTiles(N,T,I,b,_,u);for(const $ in N)this._tiles[$].clearFadeHold();const j=c.am(this._tiles,N);for(const $ of j){const X=this._tiles[$];X.hasSymbolBuckets&&!X.holdingForFade()?X.setHoldDuration(this.map._fadeDuration):X.hasSymbolBuckets&&!X.symbolFadeFinished()||this._removeTile($)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const n in this._tiles)this._tiles[n].holdingForFade()&&this._removeTile(n)}_updateRetainedTiles(n,u){var _;const b={},T={},I=Math.max(u-Fn.maxOverzooming,this._source.minzoom),O=Math.max(u+Fn.maxUnderzooming,this._source.minzoom),N={};for(const j of n){const $=this._addTile(j);b[j.key]=j,$.hasData()||u<this._source.maxzoom&&(N[j.key]=j)}this._retainLoadedChildren(N,u,O,b);for(const j of n){let $=this._tiles[j.key];if($.hasData())continue;if(u+1>this._source.maxzoom){const W=j.children(this._source.maxzoom)[0],ee=this.getTile(W);if(ee&&ee.hasData()){b[W.key]=W;continue}}else{const W=j.children(this._source.maxzoom);if(b[W[0].key]&&b[W[1].key]&&b[W[2].key]&&b[W[3].key])continue}let X=$.wasRequested();for(let W=j.overscaledZ-1;W>=I;--W){const ee=j.scaledTo(W);if(T[ee.key])break;if(T[ee.key]=!0,$=this.getTile(ee),!$&&X&&($=this._addTile(ee)),$){const ae=$.hasData();if((ae||!(!((_=this.map)===null||_===void 0)&&_.cancelPendingTileRequestsWhileZooming)||X)&&(b[ee.key]=ee),X=$.wasRequested(),ae)break}}}return b}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const n in this._tiles){const u=[];let _,b=this._tiles[n].tileID;for(;b.overscaledZ>0;){if(b.key in this._loadedParentTiles){_=this._loadedParentTiles[b.key];break}u.push(b.key);const T=b.scaledTo(b.overscaledZ-1);if(_=this._getLoadedTile(T),_)break;b=T}for(const T of u)this._loadedParentTiles[T]=_}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const n in this._tiles){const u=this._tiles[n].tileID,_=this._getLoadedTile(u);this._loadedSiblingTiles[u.key]=_}}_addTile(n){let u=this._tiles[n.key];if(u)return u;u=this._cache.getAndRemove(n),u&&(this._setTileReloadTimer(n.key,u),u.tileID=n,this._state.initializeTileState(u,this.map?this.map.painter:null),this._cacheTimers[n.key]&&(clearTimeout(this._cacheTimers[n.key]),delete this._cacheTimers[n.key],this._setTileReloadTimer(n.key,u)));const _=u;return u||(u=new pa(n,this._source.tileSize*n.overscaleFactor()),this._loadTile(u,n.key,u.state)),u.uses++,this._tiles[n.key]=u,_||this._source.fire(new c.l("dataloading",{tile:u,coord:u.tileID,dataType:"source"})),u}_setTileReloadTimer(n,u){n in this._timers&&(clearTimeout(this._timers[n]),delete this._timers[n]);const _=u.getExpiryTimeout();_&&(this._timers[n]=setTimeout((()=>{this._reloadTile(n,"expired"),delete this._timers[n]}),_))}refreshTiles(n){for(const u in this._tiles)(this._isIdRenderable(u)||this._tiles[u].state=="errored")&&n.some((_=>_.equals(this._tiles[u].tileID.canonical)))&&this._reloadTile(u,"expired")}_removeTile(n){const u=this._tiles[n];u&&(u.uses--,delete this._tiles[n],this._timers[n]&&(clearTimeout(this._timers[n]),delete this._timers[n]),u.uses>0||(u.hasData()&&u.state!=="reloading"?this._cache.add(u.tileID,u,u.getExpiryTimeout()):(u.aborted=!0,this._abortTile(u),this._unloadTile(u))))}_dataHandler(n){const u=n.sourceDataType;n.dataType==="source"&&u==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&n.dataType==="source"&&u==="content"&&(this.reload(n.sourceDataChanged),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const n in this._tiles)this._removeTile(n);this._cache.reset()}tilesIn(n,u,_){const b=[],T=this.transform;if(!T)return b;const I=T.getCoveringTilesDetailsProvider().allowWorldCopies(),O=_?T.getCameraQueryGeometry(n):n,N=ee=>T.screenPointToMercatorCoordinate(ee,this.terrain),j=this.transformBbox(n,N,!I),$=this.transformBbox(O,N,!I),X=this.getIds(),W=c.a2.fromPoints($);for(let ee=0;ee<X.length;ee++){const ae=this._tiles[X[ee]];if(ae.holdingForFade())continue;const _e=I?[ae.tileID]:[ae.tileID.unwrapTo(-1),ae.tileID.unwrapTo(0)],ge=Math.pow(2,T.zoom-ae.tileID.overscaledZ),ve=u*ae.queryPadding*c.$/ae.tileSize/ge;for(const Te of _e){const Me=W.map((Ae=>Te.getTilePoint(new c.a1(Ae.x,Ae.y))));if(Me.expandBy(ve),Me.intersects(Cn)){const Ae=j.map((Ue=>Te.getTilePoint(Ue))),Le=$.map((Ue=>Te.getTilePoint(Ue)));b.push({tile:ae,tileID:I?Te:Te.unwrapTo(0),queryGeometry:Ae,cameraQueryGeometry:Le,scale:ge})}}}return b}transformBbox(n,u,_){let b=n.map(u);if(_){const T=c.a2.fromPoints(n);T.shrinkBy(.001*Math.min(T.width(),T.height()));const I=T.map(u);c.a2.fromPoints(b).covers(I)||(b=b.map((O=>O.x>.5?new c.a1(O.x-1,O.y,O.z):O)))}return b}getVisibleCoordinates(n){const u=this.getRenderableIds(n).map((_=>this._tiles[_].tileID));return this.transform&&this.transform.populateCache(u),u}hasTransition(){if(this._source.hasTransition())return!0;if(Dn(this._source.type)){const n=Y.now();for(const u in this._tiles)if(this._tiles[u].fadeEndTime>=n)return!0}return!1}setFeatureState(n,u,_){this._state.updateState(n=n||"_geojsonTileLayer",u,_)}removeFeatureState(n,u,_){this._state.removeFeatureState(n=n||"_geojsonTileLayer",u,_)}getFeatureState(n,u){return this._state.getState(n=n||"_geojsonTileLayer",u)}setDependencies(n,u,_){const b=this._tiles[n];b&&b.setDependencies(u,_)}reloadTilesForDependencies(n,u){for(const _ in this._tiles)this._tiles[_].hasDependency(n,u)&&this._reloadTile(_,"reloading");this._cache.filter((_=>!_.hasDependency(n,u)))}}function rn(w,n){const u=Math.abs(2*w.wrap)-+(w.wrap<0),_=Math.abs(2*n.wrap)-+(n.wrap<0);return w.overscaledZ-n.overscaledZ||_-u||n.canonical.y-w.canonical.y||n.canonical.x-w.canonical.x}function Dn(w){return w==="raster"||w==="image"||w==="video"}Fn.maxOverzooming=10,Fn.maxUnderzooming=3;class wi{constructor(n,u){this.reset(n,u)}reset(n,u){this.points=n||[],this._distances=[0];for(let _=1;_<this.points.length;_++)this._distances[_]=this._distances[_-1]+this.points[_].dist(this.points[_-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(u||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(n){if(this.points.length===1)return this.points[0];n=c.ah(n,0,1);let u=1,_=this._distances[u];const b=n*this.paddedLength+this.padding;for(;_<b&&u<this._distances.length;)_=this._distances[++u];const T=u-1,I=this._distances[T],O=_-I,N=O>0?(b-I)/O:0;return this.points[T].mult(1-N).add(this.points[u].mult(N))}}function Xi(w,n){let u=!0;return w==="always"||w!=="never"&&n!=="never"||(u=!1),u}class Er{constructor(n,u,_){const b=this.boxCells=[],T=this.circleCells=[];this.xCellCount=Math.ceil(n/_),this.yCellCount=Math.ceil(u/_);for(let I=0;I<this.xCellCount*this.yCellCount;I++)b.push([]),T.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=n,this.height=u,this.xScale=this.xCellCount/n,this.yScale=this.yCellCount/u,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(n,u,_,b,T){this._forEachCell(u,_,b,T,this._insertBoxCell,this.boxUid++),this.boxKeys.push(n),this.bboxes.push(u),this.bboxes.push(_),this.bboxes.push(b),this.bboxes.push(T)}insertCircle(n,u,_,b){this._forEachCell(u-b,_-b,u+b,_+b,this._insertCircleCell,this.circleUid++),this.circleKeys.push(n),this.circles.push(u),this.circles.push(_),this.circles.push(b)}_insertBoxCell(n,u,_,b,T,I){this.boxCells[T].push(I)}_insertCircleCell(n,u,_,b,T,I){this.circleCells[T].push(I)}_query(n,u,_,b,T,I,O){if(_<0||n>this.width||b<0||u>this.height)return[];const N=[];if(n<=0&&u<=0&&this.width<=_&&this.height<=b){if(T)return[{key:null,x1:n,y1:u,x2:_,y2:b}];for(let j=0;j<this.boxKeys.length;j++)N.push({key:this.boxKeys[j],x1:this.bboxes[4*j],y1:this.bboxes[4*j+1],x2:this.bboxes[4*j+2],y2:this.bboxes[4*j+3]});for(let j=0;j<this.circleKeys.length;j++){const $=this.circles[3*j],X=this.circles[3*j+1],W=this.circles[3*j+2];N.push({key:this.circleKeys[j],x1:$-W,y1:X-W,x2:$+W,y2:X+W})}}else this._forEachCell(n,u,_,b,this._queryCell,N,{hitTest:T,overlapMode:I,seenUids:{box:{},circle:{}}},O);return N}query(n,u,_,b){return this._query(n,u,_,b,!1,null)}hitTest(n,u,_,b,T,I){return this._query(n,u,_,b,!0,T,I).length>0}hitTestCircle(n,u,_,b,T){const I=n-_,O=n+_,N=u-_,j=u+_;if(O<0||I>this.width||j<0||N>this.height)return!1;const $=[];return this._forEachCell(I,N,O,j,this._queryCellCircle,$,{hitTest:!0,overlapMode:b,circle:{x:n,y:u,radius:_},seenUids:{box:{},circle:{}}},T),$.length>0}_queryCell(n,u,_,b,T,I,O,N){const{seenUids:j,hitTest:$,overlapMode:X}=O,W=this.boxCells[T];if(W!==null){const ae=this.bboxes;for(const _e of W)if(!j.box[_e]){j.box[_e]=!0;const ge=4*_e,ve=this.boxKeys[_e];if(n<=ae[ge+2]&&u<=ae[ge+3]&&_>=ae[ge+0]&&b>=ae[ge+1]&&(!N||N(ve))&&(!$||!Xi(X,ve.overlapMode))&&(I.push({key:ve,x1:ae[ge],y1:ae[ge+1],x2:ae[ge+2],y2:ae[ge+3]}),$))return!0}}const ee=this.circleCells[T];if(ee!==null){const ae=this.circles;for(const _e of ee)if(!j.circle[_e]){j.circle[_e]=!0;const ge=3*_e,ve=this.circleKeys[_e];if(this._circleAndRectCollide(ae[ge],ae[ge+1],ae[ge+2],n,u,_,b)&&(!N||N(ve))&&(!$||!Xi(X,ve.overlapMode))){const Te=ae[ge],Me=ae[ge+1],Ae=ae[ge+2];if(I.push({key:ve,x1:Te-Ae,y1:Me-Ae,x2:Te+Ae,y2:Me+Ae}),$)return!0}}}return!1}_queryCellCircle(n,u,_,b,T,I,O,N){const{circle:j,seenUids:$,overlapMode:X}=O,W=this.boxCells[T];if(W!==null){const ae=this.bboxes;for(const _e of W)if(!$.box[_e]){$.box[_e]=!0;const ge=4*_e,ve=this.boxKeys[_e];if(this._circleAndRectCollide(j.x,j.y,j.radius,ae[ge+0],ae[ge+1],ae[ge+2],ae[ge+3])&&(!N||N(ve))&&!Xi(X,ve.overlapMode))return I.push(!0),!0}}const ee=this.circleCells[T];if(ee!==null){const ae=this.circles;for(const _e of ee)if(!$.circle[_e]){$.circle[_e]=!0;const ge=3*_e,ve=this.circleKeys[_e];if(this._circlesCollide(ae[ge],ae[ge+1],ae[ge+2],j.x,j.y,j.radius)&&(!N||N(ve))&&!Xi(X,ve.overlapMode))return I.push(!0),!0}}}_forEachCell(n,u,_,b,T,I,O,N){const j=this._convertToXCellCoord(n),$=this._convertToYCellCoord(u),X=this._convertToXCellCoord(_),W=this._convertToYCellCoord(b);for(let ee=j;ee<=X;ee++)for(let ae=$;ae<=W;ae++)if(T.call(this,n,u,_,b,this.xCellCount*ae+ee,I,O,N))return}_convertToXCellCoord(n){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(n*this.xScale)))}_convertToYCellCoord(n){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(n*this.yScale)))}_circlesCollide(n,u,_,b,T,I){const O=b-n,N=T-u,j=_+I;return j*j>O*O+N*N}_circleAndRectCollide(n,u,_,b,T,I,O){const N=(I-b)/2,j=Math.abs(n-(b+N));if(j>N+_)return!1;const $=(O-T)/2,X=Math.abs(u-(T+$));if(X>$+_)return!1;if(j<=N||X<=$)return!0;const W=j-N,ee=X-$;return W*W+ee*ee<=_*_}}function Mi(w,n,u){const _=c.L();if(!w){const{vecSouth:X,vecEast:W}=Pn(n),ee=k();ee[0]=W[0],ee[1]=W[1],ee[2]=X[0],ee[3]=X[1],b=ee,($=(I=(T=ee)[0])*(j=T[3])-(N=T[2])*(O=T[1]))&&(b[0]=j*($=1/$),b[1]=-O*$,b[2]=-N*$,b[3]=I*$),_[0]=ee[0],_[1]=ee[1],_[4]=ee[2],_[5]=ee[3]}var b,T,I,O,N,j,$;return c.N(_,_,[1/u,1/u,1]),_}function vn(w,n,u,_){if(w){const b=c.L();if(!n){const{vecSouth:T,vecEast:I}=Pn(u);b[0]=I[0],b[1]=I[1],b[4]=T[0],b[5]=T[1]}return c.N(b,b,[_,_,1]),b}return u.pixelsToClipSpaceMatrix}function Pn(w){const n=Math.cos(w.rollInRadians),u=Math.sin(w.rollInRadians),_=Math.cos(w.pitchInRadians),b=Math.cos(w.bearingInRadians),T=Math.sin(w.bearingInRadians),I=c.ar();I[0]=-b*_*u-T*n,I[1]=-T*_*u+b*n;const O=c.as(I);O<1e-9?c.at(I):c.au(I,I,1/O);const N=c.ar();N[0]=b*_*n-T*u,N[1]=T*_*n+b*u;const j=c.as(N);return j<1e-9?c.at(N):c.au(N,N,1/j),{vecEast:N,vecSouth:I}}function Vi(w,n,u,_){let b;_?(b=[w,n,_(w,n),1],c.aw(b,b,u)):(b=[w,n,0,1],ma(b,b,u));const T=b[3];return{point:new c.P(b[0]/T,b[1]/T),signedDistanceFromCamera:T,isOccluded:!1}}function Ct(w,n){return .5+w/n*.5}function Qt(w,n){return w.x>=-n[0]&&w.x<=n[0]&&w.y>=-n[1]&&w.y<=n[1]}function tr(w,n,u,_,b,T,I,O,N,j,$,X,W){const ee=u?w.textSizeData:w.iconSizeData,ae=c.an(ee,n.transform.zoom),_e=[256/n.width*2+1,256/n.height*2+1],ge=u?w.text.dynamicLayoutVertexArray:w.icon.dynamicLayoutVertexArray;ge.clear();const ve=w.lineVertexArray,Te=u?w.text.placedSymbolArray:w.icon.placedSymbolArray,Me=n.transform.width/n.transform.height;let Ae=!1;for(let Le=0;Le<Te.length;Le++){const Ue=Te.get(Le);if(Ue.hidden||Ue.writingMode===c.ao.vertical&&!Ae){Fa(Ue.numGlyphs,ge);continue}Ae=!1;const Ce=new c.P(Ue.anchorX,Ue.anchorY),We={getElevation:W,pitchedLabelPlaneMatrix:_,lineVertexArray:ve,pitchWithMap:T,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:n.transform,tileAnchorPoint:Ce,unwrappedTileID:N,width:j,height:$,translation:X},dt=Ui(Ue.anchorX,Ue.anchorY,We);if(!Qt(dt.point,_e)){Fa(Ue.numGlyphs,ge);continue}const rt=Ct(n.transform.cameraToCenterDistance,dt.signedDistanceFromCamera),st=c.ap(ee,ae,Ue),ct=T?st*n.transform.getPitchedTextCorrection(Ue.anchorX,Ue.anchorY,N)/rt:st*rt,Ot=Vt({projectionContext:We,pitchedLabelPlaneMatrixInverse:b,symbol:Ue,fontSize:ct,flip:!1,keepUpright:I,glyphOffsetArray:w.glyphOffsetArray,dynamicLayoutVertexArray:ge,aspectRatio:Me,rotateToLine:O});Ae=Ot.useVertical,(Ot.notEnoughRoom||Ae||Ot.needsFlipping&&Vt({projectionContext:We,pitchedLabelPlaneMatrixInverse:b,symbol:Ue,fontSize:ct,flip:!0,keepUpright:I,glyphOffsetArray:w.glyphOffsetArray,dynamicLayoutVertexArray:ge,aspectRatio:Me,rotateToLine:O}).notEnoughRoom)&&Fa(Ue.numGlyphs,ge)}u?w.text.dynamicLayoutVertexBuffer.updateData(ge):w.icon.dynamicLayoutVertexBuffer.updateData(ge)}function la(w,n,u,_,b,T,I,O){const N=T.glyphStartIndex+T.numGlyphs,j=T.lineStartIndex,$=T.lineStartIndex+T.lineLength,X=n.getoffsetX(T.glyphStartIndex),W=n.getoffsetX(N-1),ee=Sa(w*X,u,_,b,T.segment,j,$,O,I);if(!ee)return null;const ae=Sa(w*W,u,_,b,T.segment,j,$,O,I);return ae?O.projectionCache.anyProjectionOccluded?null:{first:ee,last:ae}:null}function ps(w,n,u,_){return w===c.ao.horizontal&&Math.abs(u.y-n.y)>Math.abs(u.x-n.x)*_?{useVertical:!0}:(w===c.ao.vertical?n.y<u.y:n.x>u.x)?{needsFlipping:!0}:null}function Vt(w){const{projectionContext:n,pitchedLabelPlaneMatrixInverse:u,symbol:_,fontSize:b,flip:T,keepUpright:I,glyphOffsetArray:O,dynamicLayoutVertexArray:N,aspectRatio:j,rotateToLine:$}=w,X=b/24,W=_.lineOffsetX*X,ee=_.lineOffsetY*X;let ae;if(_.numGlyphs>1){const _e=_.glyphStartIndex+_.numGlyphs,ge=_.lineStartIndex,ve=_.lineStartIndex+_.lineLength,Te=la(X,O,W,ee,T,_,$,n);if(!Te)return{notEnoughRoom:!0};const Me=Ka(Te.first.point.x,Te.first.point.y,n,u),Ae=Ka(Te.last.point.x,Te.last.point.y,n,u);if(I&&!T){const Le=ps(_.writingMode,Me,Ae,j);if(Le)return Le}ae=[Te.first];for(let Le=_.glyphStartIndex+1;Le<_e-1;Le++){const Ue=Sa(X*O.getoffsetX(Le),W,ee,T,_.segment,ge,ve,n,$);if(!Ue)return{notEnoughRoom:!0};ae.push(Ue)}ae.push(Te.last)}else{if(I&&!T){const ge=zi(n.tileAnchorPoint.x,n.tileAnchorPoint.y,n).point,ve=_.lineStartIndex+_.segment+1,Te=new c.P(n.lineVertexArray.getx(ve),n.lineVertexArray.gety(ve)),Me=zi(Te.x,Te.y,n),Ae=Me.signedDistanceFromCamera>0?Me.point:Rn(n.tileAnchorPoint,Te,ge,1,n),Le=Ka(ge.x,ge.y,n,u),Ue=Ka(Ae.x,Ae.y,n,u),Ce=ps(_.writingMode,Le,Ue,j);if(Ce)return Ce}const _e=Sa(X*O.getoffsetX(_.glyphStartIndex),W,ee,T,_.segment,_.lineStartIndex,_.lineStartIndex+_.lineLength,n,$);if(!_e||n.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};ae=[_e]}for(const _e of ae)c.av(N,_e.point,_e.angle);return{}}function Rn(w,n,u,_,b){const T=w.add(w.sub(n)._unit()),I=zi(T.x,T.y,b).point,O=u.sub(I);return u.add(O._mult(_/O.mag()))}function In(w,n,u){const _=n.projectionCache;if(_.projections[w])return _.projections[w];const b=new c.P(n.lineVertexArray.getx(w),n.lineVertexArray.gety(w)),T=zi(b.x,b.y,n);if(T.signedDistanceFromCamera>0)return _.projections[w]=T.point,_.anyProjectionOccluded=_.anyProjectionOccluded||T.isOccluded,T.point;const I=w-u.direction;return Rn(u.distanceFromAnchor===0?n.tileAnchorPoint:new c.P(n.lineVertexArray.getx(I),n.lineVertexArray.gety(I)),b,u.previousVertex,u.absOffsetX-u.distanceFromAnchor+1,n)}function zi(w,n,u){const _=w+u.translation[0],b=n+u.translation[1];let T;return u.pitchWithMap?(T=Vi(_,b,u.pitchedLabelPlaneMatrix,u.getElevation),T.isOccluded=!1):(T=u.transform.projectTileCoordinates(_,b,u.unwrappedTileID,u.getElevation),T.point.x=(.5*T.point.x+.5)*u.width,T.point.y=(.5*-T.point.y+.5)*u.height),T}function Ka(w,n,u,_){if(u.pitchWithMap){const b=[w,n,0,1];return c.aw(b,b,_),u.transform.projectTileCoordinates(b[0]/b[3],b[1]/b[3],u.unwrappedTileID,u.getElevation).point}return{x:w/u.width*2-1,y:1-n/u.height*2}}function Ui(w,n,u){return u.transform.projectTileCoordinates(w,n,u.unwrappedTileID,u.getElevation)}function Vn(w,n,u){return w._unit()._perp()._mult(n*u)}function $o(w,n,u,_,b,T,I,O,N){if(O.projectionCache.offsets[w])return O.projectionCache.offsets[w];const j=u.add(n);if(w+N.direction<_||w+N.direction>=b)return O.projectionCache.offsets[w]=j,j;const $=In(w+N.direction,O,N),X=Vn($.sub(u),I,N.direction),W=u.add(X),ee=$.add(X);return O.projectionCache.offsets[w]=c.ax(T,j,W,ee)||j,O.projectionCache.offsets[w]}function Sa(w,n,u,_,b,T,I,O,N){const j=_?w-n:w+n;let $=j>0?1:-1,X=0;_&&($*=-1,X=Math.PI),$<0&&(X+=Math.PI);let W,ee=$>0?T+b:T+b+1;O.projectionCache.cachedAnchorPoint?W=O.projectionCache.cachedAnchorPoint:(W=zi(O.tileAnchorPoint.x,O.tileAnchorPoint.y,O).point,O.projectionCache.cachedAnchorPoint=W);let ae,_e,ge=W,ve=W,Te=0,Me=0;const Ae=Math.abs(j),Le=[];let Ue;for(;Te+Me<=Ae;){if(ee+=$,ee<T||ee>=I)return null;Te+=Me,ve=ge,_e=ae;const dt={absOffsetX:Ae,direction:$,distanceFromAnchor:Te,previousVertex:ve};if(ge=In(ee,O,dt),u===0)Le.push(ve),Ue=ge.sub(ve);else{let rt;const st=ge.sub(ve);rt=st.mag()===0?Vn(In(ee+$,O,dt).sub(ge),u,$):Vn(st,u,$),_e||(_e=ve.add(rt)),ae=$o(ee,rt,ge,T,I,_e,u,O,dt),Le.push(_e),Ue=ae.sub(_e)}Me=Ue.mag()}const Ce=Ue._mult((Ae-Te)/Me)._add(_e||ve),We=X+Math.atan2(ge.y-ve.y,ge.x-ve.x);return Le.push(Ce),{point:Ce,angle:N?We:0,path:Le}}const ms=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Fa(w,n){for(let u=0;u<w;u++){const _=n.length;n.resize(_+4),n.float32.set(ms,3*_)}}function ma(w,n,u){const _=n[0],b=n[1];return w[0]=u[0]*_+u[4]*b+u[12],w[1]=u[1]*_+u[5]*b+u[13],w[3]=u[3]*_+u[7]*b+u[15],w}const Ki=100;class Vu{constructor(n,u=new Er(n.width+200,n.height+200,25),_=new Er(n.width+200,n.height+200,25)){this.transform=n,this.grid=u,this.ignoredGrid=_,this.pitchFactor=Math.cos(n.pitch*Math.PI/180)*n.cameraToCenterDistance,this.screenRightBoundary=n.width+Ki,this.screenBottomBoundary=n.height+Ki,this.gridRightBoundary=n.width+200,this.gridBottomBoundary=n.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(n,u,_,b,T,I,O,N,j,$,X,W){const ee=this.projectAndGetPerspectiveRatio(n.anchorPointX+N[0],n.anchorPointY+N[1],T,$,W),ae=_*ee.perspectiveRatio;let _e;if(I||O)_e=this._projectCollisionBox(n,ae,b,T,I,O,N,ee,$,X,W);else{const Ue=ee.x+(X?X.x*ae:0),Ce=ee.y+(X?X.y*ae:0);_e={allPointsOccluded:!1,box:[Ue+n.x1*ae,Ce+n.y1*ae,Ue+n.x2*ae,Ce+n.y2*ae]}}const[ge,ve,Te,Me]=_e.box,Ae=I?_e.allPointsOccluded:ee.isOccluded;let Le=Ae;return Le||(Le=ee.perspectiveRatio<this.perspectiveRatioCutoff),Le||(Le=!this.isInsideGrid(ge,ve,Te,Me)),Le||u!=="always"&&this.grid.hitTest(ge,ve,Te,Me,u,j)?{box:[ge,ve,Te,Me],placeable:!1,offscreen:!1,occluded:Ae}:{box:[ge,ve,Te,Me],placeable:!0,offscreen:this.isOffscreen(ge,ve,Te,Me),occluded:Ae}}placeCollisionCircles(n,u,_,b,T,I,O,N,j,$,X,W,ee,ae){const _e=[],ge=new c.P(u.anchorX,u.anchorY),ve=this.getPerspectiveRatio(ge.x,ge.y,I,ae),Te=(j?T*this.transform.getPitchedTextCorrection(u.anchorX,u.anchorY,I)/ve:T*ve)/c.aB,Me={getElevation:ae,pitchedLabelPlaneMatrix:O,lineVertexArray:_,pitchWithMap:j,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:ge,unwrappedTileID:I,width:this.transform.width,height:this.transform.height,translation:ee},Ae=la(Te,b,u.lineOffsetX*Te,u.lineOffsetY*Te,!1,u,!1,Me);let Le=!1,Ue=!1,Ce=!0;if(Ae){const We=.5*X*ve+W,dt=new c.P(-100,-100),rt=new c.P(this.screenRightBoundary,this.screenBottomBoundary),st=new wi,ct=Ae.first,Ot=Ae.last;let Bt=[];for(let Kn=ct.path.length-1;Kn>=1;Kn--)Bt.push(ct.path[Kn]);for(let Kn=1;Kn<Ot.path.length;Kn++)Bt.push(Ot.path[Kn]);const Et=2.5*We;if(j){const Kn=this.projectPathToScreenSpace(Bt,Me);Bt=Kn.some((yi=>yi.signedDistanceFromCamera<=0))?[]:Kn.map((yi=>yi.point))}let un=[];if(Bt.length>0){const Kn=Bt[0].clone(),yi=Bt[0].clone();for(let qi=1;qi<Bt.length;qi++)Kn.x=Math.min(Kn.x,Bt[qi].x),Kn.y=Math.min(Kn.y,Bt[qi].y),yi.x=Math.max(yi.x,Bt[qi].x),yi.y=Math.max(yi.y,Bt[qi].y);un=Kn.x>=dt.x&&yi.x<=rt.x&&Kn.y>=dt.y&&yi.y<=rt.y?[Bt]:yi.x<dt.x||Kn.x>rt.x||yi.y<dt.y||Kn.y>rt.y?[]:c.ay([Bt],dt.x,dt.y,rt.x,rt.y)}for(const Kn of un){st.reset(Kn,.25*We);let yi=0;yi=st.length<=.5*We?1:Math.ceil(st.paddedLength/Et)+1;for(let qi=0;qi<yi;qi++){const Ni=qi/Math.max(yi-1,1),Fr=st.lerp(Ni),Rr=Fr.x+Ki,Hn=Fr.y+Ki;_e.push(Rr,Hn,We,0);const $i=Rr-We,Jr=Hn-We,va=Rr+We,ka=Hn+We;if(Ce=Ce&&this.isOffscreen($i,Jr,va,ka),Ue=Ue||this.isInsideGrid($i,Jr,va,ka),n!=="always"&&this.grid.hitTestCircle(Rr,Hn,We,n,$)&&(Le=!0,!N))return{circles:[],offscreen:!1,collisionDetected:Le}}}}return{circles:!N&&Le||!Ue||ve<this.perspectiveRatioCutoff?[]:_e,offscreen:Ce,collisionDetected:Le}}projectPathToScreenSpace(n,u){const _=(function(b,T){const I=c.L();return c.aq(I,T.pitchedLabelPlaneMatrix),b.map((O=>{const N=Vi(O.x,O.y,I,T.getElevation),j=T.transform.projectTileCoordinates(N.point.x,N.point.y,T.unwrappedTileID,T.getElevation);return j.point.x=(.5*j.point.x+.5)*T.width,j.point.y=(.5*-j.point.y+.5)*T.height,j}))})(n,u);return(function(b){let T=0,I=0,O=0,N=0;for(let j=0;j<b.length;j++)b[j].isOccluded?(O=j+1,N=0):(N++,N>I&&(I=N,T=O));return b.slice(T,T+I)})(_)}queryRenderedSymbols(n){if(n.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const u=[],_=new c.a2;for(const X of n){const W=new c.P(X.x+Ki,X.y+Ki);_.extend(W),u.push(W)}const{minX:b,minY:T,maxX:I,maxY:O}=_,N=this.grid.query(b,T,I,O).concat(this.ignoredGrid.query(b,T,I,O)),j={},$={};for(const X of N){const W=X.key;if(j[W.bucketInstanceId]===void 0&&(j[W.bucketInstanceId]={}),j[W.bucketInstanceId][W.featureIndex])continue;const ee=[new c.P(X.x1,X.y1),new c.P(X.x2,X.y1),new c.P(X.x2,X.y2),new c.P(X.x1,X.y2)];c.az(u,ee)&&(j[W.bucketInstanceId][W.featureIndex]=!0,$[W.bucketInstanceId]===void 0&&($[W.bucketInstanceId]=[]),$[W.bucketInstanceId].push(W.featureIndex))}return $}insertCollisionBox(n,u,_,b,T,I){(_?this.ignoredGrid:this.grid).insert({bucketInstanceId:b,featureIndex:T,collisionGroupID:I,overlapMode:u},n[0],n[1],n[2],n[3])}insertCollisionCircles(n,u,_,b,T,I){const O=_?this.ignoredGrid:this.grid,N={bucketInstanceId:b,featureIndex:T,collisionGroupID:I,overlapMode:u};for(let j=0;j<n.length;j+=4)O.insertCircle(N,n[j],n[j+1],n[j+2])}projectAndGetPerspectiveRatio(n,u,_,b,T){if(T){let I;b?(I=[n,u,b(n,u),1],c.aw(I,I,T)):(I=[n,u,0,1],ma(I,I,T));const O=I[3];return{x:(I[0]/O+1)/2*this.transform.width+Ki,y:(-I[1]/O+1)/2*this.transform.height+Ki,perspectiveRatio:.5+this.transform.cameraToCenterDistance/O*.5,isOccluded:!1,signedDistanceFromCamera:O}}{const I=this.transform.projectTileCoordinates(n,u,_,b);return{x:(I.point.x+1)/2*this.transform.width+Ki,y:(1-I.point.y)/2*this.transform.height+Ki,perspectiveRatio:.5+this.transform.cameraToCenterDistance/I.signedDistanceFromCamera*.5,isOccluded:I.isOccluded,signedDistanceFromCamera:I.signedDistanceFromCamera}}}getPerspectiveRatio(n,u,_,b){const T=this.transform.projectTileCoordinates(n,u,_,b);return .5+this.transform.cameraToCenterDistance/T.signedDistanceFromCamera*.5}isOffscreen(n,u,_,b){return _<Ki||n>=this.screenRightBoundary||b<Ki||u>this.screenBottomBoundary}isInsideGrid(n,u,_,b){return _>=0&&n<this.gridRightBoundary&&b>=0&&u<this.gridBottomBoundary}getViewportMatrix(){const n=c.ag([]);return c.M(n,n,[-100,-100,0]),n}_projectCollisionBox(n,u,_,b,T,I,O,N,j,$,X){let W=1,ee=0,ae=0,_e=1;const ge=n.anchorPointX+O[0],ve=n.anchorPointY+O[1];if(I&&!T){const Bt=this.projectAndGetPerspectiveRatio(ge+1,ve,b,j,X),Et=Bt.x-N.x,un=Math.atan((Bt.y-N.y)/Et)+(Et<0?Math.PI:0),Kn=Math.sin(un),yi=Math.cos(un);W=yi,ee=Kn,ae=-Kn,_e=yi}else if(!I&&T){const Bt=Pn(this.transform);W=Bt.vecEast[0],ee=Bt.vecEast[1],ae=Bt.vecSouth[0],_e=Bt.vecSouth[1]}let Te=N.x,Me=N.y,Ae=u;T&&(Te=ge,Me=ve,Ae=Math.pow(2,-(this.transform.zoom-_.overscaledZ)),Ae*=this.transform.getPitchedTextCorrection(ge,ve,b),$||(Ae*=c.ah(.5+N.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),$&&(Te+=W*$.x*Ae+ae*$.y*Ae,Me+=ee*$.x*Ae+_e*$.y*Ae);const Le=n.x1*Ae,Ue=n.x2*Ae,Ce=(Le+Ue)/2,We=n.y1*Ae,dt=n.y2*Ae,rt=(We+dt)/2,st=[{offsetX:Le,offsetY:We},{offsetX:Ce,offsetY:We},{offsetX:Ue,offsetY:We},{offsetX:Ue,offsetY:rt},{offsetX:Ue,offsetY:dt},{offsetX:Ce,offsetY:dt},{offsetX:Le,offsetY:dt},{offsetX:Le,offsetY:rt}];let ct=[];for(const{offsetX:Bt,offsetY:Et}of st)ct.push(new c.P(Te+W*Bt+ae*Et,Me+ee*Bt+_e*Et));let Ot=!1;if(T){const Bt=ct.map((Et=>this.projectAndGetPerspectiveRatio(Et.x,Et.y,b,j,X)));Ot=Bt.some((Et=>!Et.isOccluded)),ct=Bt.map((Et=>new c.P(Et.x,Et.y)))}else Ot=!0;return{box:c.aA(ct),allPointsOccluded:!Ot}}}class Wr{constructor(n,u,_,b){this.opacity=n?Math.max(0,Math.min(1,n.opacity+(n.placed?u:-u))):b&&_?1:0,this.placed=_}isHidden(){return this.opacity===0&&!this.placed}}class fi{constructor(n,u,_,b,T){this.text=new Wr(n?n.text:null,u,_,T),this.icon=new Wr(n?n.icon:null,u,b,T)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class qs{constructor(n,u,_){this.text=n,this.icon=u,this.skipFade=_}}class $s{constructor(n,u,_,b,T){this.bucketInstanceId=n,this.featureIndex=u,this.sourceLayerIndex=_,this.bucketIndex=b,this.tileID=T}}class ho{constructor(n){this.crossSourceCollisions=n,this.maxGroupID=0,this.collisionGroups={}}get(n){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[n]){const u=++this.maxGroupID;this.collisionGroups[n]={ID:u,predicate:_=>_.collisionGroupID===u}}return this.collisionGroups[n]}}function Ea(w,n,u,_,b){const{horizontalAlign:T,verticalAlign:I}=c.aH(w);return new c.P(-(T-.5)*n+_[0]*b,-(I-.5)*u+_[1]*b)}class gs{constructor(n,u,_,b,T){this.transform=n.clone(),this.terrain=u,this.collisionIndex=new Vu(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=_,this.retainedQueryData={},this.collisionGroups=new ho(b),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=T,T&&(T.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(n){const u=this.terrain;return u?(_,b)=>u.getElevation(n,_,b):null}getBucketParts(n,u,_,b){const T=_.getBucket(u),I=_.latestFeatureIndex;if(!T||!I||u.id!==T.layerIds[0])return;const O=_.collisionBoxArray,N=T.layers[0].layout,j=T.layers[0].paint,$=Math.pow(2,this.transform.zoom-_.tileID.overscaledZ),X=_.tileSize/c.$,W=_.tileID.toUnwrapped(),ee=N.get("text-rotation-alignment")==="map",ae=c.aC(_,1,this.transform.zoom),_e=c.aD(this.collisionIndex.transform,_,j.get("text-translate"),j.get("text-translate-anchor")),ge=c.aD(this.collisionIndex.transform,_,j.get("icon-translate"),j.get("icon-translate-anchor")),ve=Mi(ee,this.transform,ae);this.retainedQueryData[T.bucketInstanceId]=new $s(T.bucketInstanceId,I,T.sourceLayerIndex,T.index,_.tileID);const Te={bucket:T,layout:N,translationText:_e,translationIcon:ge,unwrappedTileID:W,pitchedLabelPlaneMatrix:ve,scale:$,textPixelRatio:X,holdingForFade:_.holdingForFade(),collisionBoxArray:O,partiallyEvaluatedTextSize:c.an(T.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(T.sourceID)};if(b)for(const Me of T.sortKeyRanges){const{sortKey:Ae,symbolInstanceStart:Le,symbolInstanceEnd:Ue}=Me;n.push({sortKey:Ae,symbolInstanceStart:Le,symbolInstanceEnd:Ue,parameters:Te})}else n.push({symbolInstanceStart:0,symbolInstanceEnd:T.symbolInstances.length,parameters:Te})}attemptAnchorPlacement(n,u,_,b,T,I,O,N,j,$,X,W,ee,ae,_e,ge,ve,Te,Me,Ae){const Le=c.aE[n.textAnchor],Ue=[n.textOffset0,n.textOffset1],Ce=Ea(Le,_,b,Ue,T),We=this.collisionIndex.placeCollisionBox(u,W,N,j,$,O,I,ge,X.predicate,Me,Ce,Ae);if((!Te||this.collisionIndex.placeCollisionBox(Te,W,N,j,$,O,I,ve,X.predicate,Me,Ce,Ae).placeable)&&We.placeable){let dt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[ee.crossTileID]&&this.prevPlacement.placements[ee.crossTileID]&&this.prevPlacement.placements[ee.crossTileID].text&&(dt=this.prevPlacement.variableOffsets[ee.crossTileID].anchor),ee.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[ee.crossTileID]={textOffset:Ue,width:_,height:b,anchor:Le,textBoxScale:T,prevAnchor:dt},this.markUsedJustification(ae,Le,ee,_e),ae.allowVerticalPlacement&&(this.markUsedOrientation(ae,_e,ee),this.placedOrientations[ee.crossTileID]=_e),{shift:Ce,placedGlyphBoxes:We}}}placeLayerBucketPart(n,u,_){const{bucket:b,layout:T,translationText:I,translationIcon:O,unwrappedTileID:N,pitchedLabelPlaneMatrix:j,textPixelRatio:$,holdingForFade:X,collisionBoxArray:W,partiallyEvaluatedTextSize:ee,collisionGroup:ae}=n.parameters,_e=T.get("text-optional"),ge=T.get("icon-optional"),ve=c.aF(T,"text-overlap","text-allow-overlap"),Te=ve==="always",Me=c.aF(T,"icon-overlap","icon-allow-overlap"),Ae=Me==="always",Le=T.get("text-rotation-alignment")==="map",Ue=T.get("text-pitch-alignment")==="map",Ce=T.get("icon-text-fit")!=="none",We=T.get("symbol-z-order")==="viewport-y",dt=Te&&(Ae||!b.hasIconData()||ge),rt=Ae&&(Te||!b.hasTextData()||_e);!b.collisionArrays&&W&&b.deserializeCollisionBoxes(W);const st=this.retainedQueryData[b.bucketInstanceId].tileID,ct=this._getTerrainElevationFunc(st),Ot=this.transform.getFastPathSimpleProjectionMatrix(st),Bt=(Et,un,Kn)=>{var yi,qi;if(u[Et.crossTileID])return;if(X)return void(this.placements[Et.crossTileID]=new qs(!1,!1,!1));let Ni=!1,Fr=!1,Rr=!0,Hn=null,$i={box:null,placeable:!1,offscreen:null,occluded:!1},Jr={placeable:!1},va=null,ka=null,io=null,Nl=0,Su=0,ll=0;un.textFeatureIndex?Nl=un.textFeatureIndex:Et.useRuntimeCollisionCircles&&(Nl=Et.featureIndex),un.verticalTextFeatureIndex&&(Su=un.verticalTextFeatureIndex);const nc=un.textBox;if(nc){const rs=kr=>{let Zr=c.ao.horizontal;if(b.allowVerticalPlacement&&!kr&&this.prevPlacement){const ro=this.prevPlacement.placedOrientations[Et.crossTileID];ro&&(this.placedOrientations[Et.crossTileID]=ro,Zr=ro,this.markUsedOrientation(b,Zr,Et))}return Zr},ul=(kr,Zr)=>{if(b.allowVerticalPlacement&&Et.numVerticalGlyphVertices>0&&un.verticalTextBox){for(const ro of b.writingModes)if(ro===c.ao.vertical?($i=Zr(),Jr=$i):$i=kr(),$i&&$i.placeable)break}else $i=kr()},Ls=Et.textAnchorOffsetStartIndex,ac=Et.textAnchorOffsetEndIndex;if(ac===Ls){const kr=(Zr,ro)=>{const Vr=this.collisionIndex.placeCollisionBox(Zr,ve,$,st,N,Ue,Le,I,ae.predicate,ct,void 0,Ot);return Vr&&Vr.placeable&&(this.markUsedOrientation(b,ro,Et),this.placedOrientations[Et.crossTileID]=ro),Vr};ul((()=>kr(nc,c.ao.horizontal)),(()=>{const Zr=un.verticalTextBox;return b.allowVerticalPlacement&&Et.numVerticalGlyphVertices>0&&Zr?kr(Zr,c.ao.vertical):{box:null,offscreen:null}})),rs($i&&$i.placeable)}else{let kr=c.aE[(qi=(yi=this.prevPlacement)===null||yi===void 0?void 0:yi.variableOffsets[Et.crossTileID])===null||qi===void 0?void 0:qi.anchor];const Zr=(Vr,sc,qc)=>{const ru=Vr.x2-Vr.x1,Ds=Vr.y2-Vr.y1,Au=Et.textBoxScale,Oo=Ce&&Me==="never"?sc:null;let ea=null,Iu=ve==="never"?1:2,Jd="never";kr&&Iu++;for(let Bl=0;Bl<Iu;Bl++){for(let cl=Ls;cl<ac;cl++){const yr=b.textAnchorOffsets.get(cl);if(kr&&yr.textAnchor!==kr)continue;const hl=this.attemptAnchorPlacement(yr,Vr,ru,Ds,Au,Le,Ue,$,st,N,ae,Jd,Et,b,qc,I,O,Oo,ct);if(hl&&(ea=hl.placedGlyphBoxes,ea&&ea.placeable))return Ni=!0,Hn=hl.shift,ea}kr?kr=null:Jd=ve}return _&&!ea&&(ea={box:this.collisionIndex.placeCollisionBox(nc,"always",$,st,N,Ue,Le,I,ae.predicate,ct,void 0,Ot).box,offscreen:!1,placeable:!1,occluded:!1}),ea};ul((()=>Zr(nc,un.iconBox,c.ao.horizontal)),(()=>{const Vr=un.verticalTextBox;return b.allowVerticalPlacement&&(!$i||!$i.placeable)&&Et.numVerticalGlyphVertices>0&&Vr?Zr(Vr,un.verticalIconBox,c.ao.vertical):{box:null,occluded:!0,offscreen:null}})),$i&&(Ni=$i.placeable,Rr=$i.offscreen);const ro=rs($i&&$i.placeable);if(!Ni&&this.prevPlacement){const Vr=this.prevPlacement.variableOffsets[Et.crossTileID];Vr&&(this.variableOffsets[Et.crossTileID]=Vr,this.markUsedJustification(b,Vr.anchor,Et,ro))}}}if(va=$i,Ni=va&&va.placeable,Rr=va&&va.offscreen,Et.useRuntimeCollisionCircles){const rs=b.text.placedSymbolArray.get(Et.centerJustifiedTextSymbolIndex),ul=c.ap(b.textSizeData,ee,rs),Ls=T.get("text-padding");ka=this.collisionIndex.placeCollisionCircles(ve,rs,b.lineVertexArray,b.glyphOffsetArray,ul,N,j,_,Ue,ae.predicate,Et.collisionCircleDiameter,Ls,I,ct),ka.circles.length&&ka.collisionDetected&&!_&&c.w("Collisions detected, but collision boxes are not shown"),Ni=Te||ka.circles.length>0&&!ka.collisionDetected,Rr=Rr&&ka.offscreen}if(un.iconFeatureIndex&&(ll=un.iconFeatureIndex),un.iconBox){const rs=ul=>this.collisionIndex.placeCollisionBox(ul,Me,$,st,N,Ue,Le,O,ae.predicate,ct,Ce&&Hn?Hn:void 0,Ot);Jr&&Jr.placeable&&un.verticalIconBox?(io=rs(un.verticalIconBox),Fr=io.placeable):(io=rs(un.iconBox),Fr=io.placeable),Rr=Rr&&io.offscreen}const Eu=_e||Et.numHorizontalGlyphVertices===0&&Et.numVerticalGlyphVertices===0,ic=ge||Et.numIconVertices===0;Eu||ic?ic?Eu||(Fr=Fr&&Ni):Ni=Fr&&Ni:Fr=Ni=Fr&&Ni;const rc=Fr&&io.placeable;if(Ni&&va.placeable&&this.collisionIndex.insertCollisionBox(va.box,ve,T.get("text-ignore-placement"),b.bucketInstanceId,Jr&&Jr.placeable&&Su?Su:Nl,ae.ID),rc&&this.collisionIndex.insertCollisionBox(io.box,Me,T.get("icon-ignore-placement"),b.bucketInstanceId,ll,ae.ID),ka&&Ni&&this.collisionIndex.insertCollisionCircles(ka.circles,ve,T.get("text-ignore-placement"),b.bucketInstanceId,Nl,ae.ID),_&&this.storeCollisionData(b.bucketInstanceId,Kn,un,va,io,ka),Et.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(b.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Et.crossTileID]=new qs((Ni||dt)&&!(va!=null&&va.occluded),(Fr||rt)&&!(io!=null&&io.occluded),Rr||b.justReloaded),u[Et.crossTileID]=!0};if(We){if(n.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Et=b.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let un=Et.length-1;un>=0;--un){const Kn=Et[un];Bt(b.symbolInstances.get(Kn),b.collisionArrays[Kn],Kn)}}else for(let Et=n.symbolInstanceStart;Et<n.symbolInstanceEnd;Et++)Bt(b.symbolInstances.get(Et),b.collisionArrays[Et],Et);b.justReloaded=!1}storeCollisionData(n,u,_,b,T,I){if(_.textBox||_.iconBox){let O,N;this.collisionBoxArrays.has(n)?O=this.collisionBoxArrays.get(n):(O=new Map,this.collisionBoxArrays.set(n,O)),O.has(u)?N=O.get(u):(N={text:null,icon:null},O.set(u,N)),_.textBox&&(N.text=b.box),_.iconBox&&(N.icon=T.box)}if(I){let O=this.collisionCircleArrays[n];O===void 0&&(O=this.collisionCircleArrays[n]=[]);for(let N=0;N<I.circles.length;N+=4)O.push(I.circles[N+0]-Ki),O.push(I.circles[N+1]-Ki),O.push(I.circles[N+2]),O.push(I.collisionDetected?1:0)}}markUsedJustification(n,u,_,b){let T;T=b===c.ao.vertical?_.verticalPlacedTextSymbolIndex:{left:_.leftJustifiedTextSymbolIndex,center:_.centerJustifiedTextSymbolIndex,right:_.rightJustifiedTextSymbolIndex}[c.aG(u)];const I=[_.leftJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.rightJustifiedTextSymbolIndex,_.verticalPlacedTextSymbolIndex];for(const O of I)O>=0&&(n.text.placedSymbolArray.get(O).crossTileID=T>=0&&O!==T?0:_.crossTileID)}markUsedOrientation(n,u,_){const b=u===c.ao.horizontal||u===c.ao.horizontalOnly?u:0,T=u===c.ao.vertical?u:0,I=[_.leftJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.rightJustifiedTextSymbolIndex];for(const O of I)n.text.placedSymbolArray.get(O).placedOrientation=b;_.verticalPlacedTextSymbolIndex&&(n.text.placedSymbolArray.get(_.verticalPlacedTextSymbolIndex).placedOrientation=T)}commit(n){this.commitTime=n,this.zoomAtLastRecencyCheck=this.transform.zoom;const u=this.prevPlacement;let _=!1;this.prevZoomAdjustment=u?u.zoomAdjustment(this.transform.zoom):0;const b=u?u.symbolFadeChange(n):1,T=u?u.opacities:{},I=u?u.variableOffsets:{},O=u?u.placedOrientations:{};for(const N in this.placements){const j=this.placements[N],$=T[N];$?(this.opacities[N]=new fi($,b,j.text,j.icon),_=_||j.text!==$.text.placed||j.icon!==$.icon.placed):(this.opacities[N]=new fi(null,b,j.text,j.icon,j.skipFade),_=_||j.text||j.icon)}for(const N in T){const j=T[N];if(!this.opacities[N]){const $=new fi(j,b,!1,!1);$.isHidden()||(this.opacities[N]=$,_=_||j.text.placed||j.icon.placed)}}for(const N in I)this.variableOffsets[N]||!this.opacities[N]||this.opacities[N].isHidden()||(this.variableOffsets[N]=I[N]);for(const N in O)this.placedOrientations[N]||!this.opacities[N]||this.opacities[N].isHidden()||(this.placedOrientations[N]=O[N]);if(u&&u.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");_?this.lastPlacementChangeTime=n:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=u?u.lastPlacementChangeTime:n)}updateLayerOpacities(n,u){const _={};for(const b of u){const T=b.getBucket(n);T&&b.latestFeatureIndex&&n.id===T.layerIds[0]&&this.updateBucketOpacities(T,b.tileID,_,b.collisionBoxArray)}}updateBucketOpacities(n,u,_,b){n.hasTextData()&&(n.text.opacityVertexArray.clear(),n.text.hasVisibleVertices=!1),n.hasIconData()&&(n.icon.opacityVertexArray.clear(),n.icon.hasVisibleVertices=!1),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexArray.clear(),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexArray.clear();const T=n.layers[0],I=T.layout,O=new fi(null,0,!1,!1,!0),N=I.get("text-allow-overlap"),j=I.get("icon-allow-overlap"),$=T._unevaluatedLayout.hasValue("text-variable-anchor")||T._unevaluatedLayout.hasValue("text-variable-anchor-offset"),X=I.get("text-rotation-alignment")==="map",W=I.get("text-pitch-alignment")==="map",ee=I.get("icon-text-fit")!=="none",ae=new fi(null,0,N&&(j||!n.hasIconData()||I.get("icon-optional")),j&&(N||!n.hasTextData()||I.get("text-optional")),!0);!n.collisionArrays&&b&&(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData())&&n.deserializeCollisionBoxes(b);const _e=(ve,Te,Me)=>{for(let Ae=0;Ae<Te/4;Ae++)ve.opacityVertexArray.emplaceBack(Me);ve.hasVisibleVertices=ve.hasVisibleVertices||Me!==ys},ge=this.collisionBoxArrays.get(n.bucketInstanceId);for(let ve=0;ve<n.symbolInstances.length;ve++){const Te=n.symbolInstances.get(ve),{numHorizontalGlyphVertices:Me,numVerticalGlyphVertices:Ae,crossTileID:Le}=Te;let Ue=this.opacities[Le];_[Le]?Ue=O:Ue||(Ue=ae,this.opacities[Le]=Ue),_[Le]=!0;const Ce=Te.numIconVertices>0,We=this.placedOrientations[Te.crossTileID],dt=We===c.ao.vertical,rt=We===c.ao.horizontal||We===c.ao.horizontalOnly;if(Me>0||Ae>0){const ct=Si(Ue.text);_e(n.text,Me,dt?ys:ct),_e(n.text,Ae,rt?ys:ct);const Ot=Ue.text.isHidden();[Te.rightJustifiedTextSymbolIndex,Te.centerJustifiedTextSymbolIndex,Te.leftJustifiedTextSymbolIndex].forEach((un=>{un>=0&&(n.text.placedSymbolArray.get(un).hidden=Ot||dt?1:0)})),Te.verticalPlacedTextSymbolIndex>=0&&(n.text.placedSymbolArray.get(Te.verticalPlacedTextSymbolIndex).hidden=Ot||rt?1:0);const Bt=this.variableOffsets[Te.crossTileID];Bt&&this.markUsedJustification(n,Bt.anchor,Te,We);const Et=this.placedOrientations[Te.crossTileID];Et&&(this.markUsedJustification(n,"left",Te,Et),this.markUsedOrientation(n,Et,Te))}if(Ce){const ct=Si(Ue.icon),Ot=!(ee&&Te.verticalPlacedIconSymbolIndex&&dt);Te.placedIconSymbolIndex>=0&&(_e(n.icon,Te.numIconVertices,Ot?ct:ys),n.icon.placedSymbolArray.get(Te.placedIconSymbolIndex).hidden=Ue.icon.isHidden()),Te.verticalPlacedIconSymbolIndex>=0&&(_e(n.icon,Te.numVerticalIconVertices,Ot?ys:ct),n.icon.placedSymbolArray.get(Te.verticalPlacedIconSymbolIndex).hidden=Ue.icon.isHidden())}const st=ge&&ge.has(ve)?ge.get(ve):{text:null,icon:null};if(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData()){const ct=n.collisionArrays[ve];if(ct){let Ot=new c.P(0,0);if(ct.textBox||ct.verticalTextBox){let Bt=!0;if($){const Et=this.variableOffsets[Le];Et?(Ot=Ea(Et.anchor,Et.width,Et.height,Et.textOffset,Et.textBoxScale),X&&Ot._rotate(W?-this.transform.bearingInRadians:this.transform.bearingInRadians)):Bt=!1}if(ct.textBox||ct.verticalTextBox){let Et;ct.textBox&&(Et=dt),ct.verticalTextBox&&(Et=rt),fo(n.textCollisionBox.collisionVertexArray,Ue.text.placed,!Bt||Et,st.text,Ot.x,Ot.y)}}if(ct.iconBox||ct.verticalIconBox){const Bt=!!(!rt&&ct.verticalIconBox);let Et;ct.iconBox&&(Et=Bt),ct.verticalIconBox&&(Et=!Bt),fo(n.iconCollisionBox.collisionVertexArray,Ue.icon.placed,Et,st.icon,ee?Ot.x:0,ee?Ot.y:0)}}}}if(n.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[n.bucketInstanceId]&&(this.retainedQueryData[n.bucketInstanceId].featureSortOrder=n.featureSortOrder),n.hasTextData()&&n.text.opacityVertexBuffer&&n.text.opacityVertexBuffer.updateData(n.text.opacityVertexArray),n.hasIconData()&&n.icon.opacityVertexBuffer&&n.icon.opacityVertexBuffer.updateData(n.icon.opacityVertexArray),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexBuffer&&n.iconCollisionBox.collisionVertexBuffer.updateData(n.iconCollisionBox.collisionVertexArray),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexBuffer&&n.textCollisionBox.collisionVertexBuffer.updateData(n.textCollisionBox.collisionVertexArray),n.text.opacityVertexArray.length!==n.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${n.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${n.text.layoutVertexArray.length}) / 4`);if(n.icon.opacityVertexArray.length!==n.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${n.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${n.icon.layoutVertexArray.length}) / 4`);n.bucketInstanceId in this.collisionCircleArrays&&(n.collisionCircleArray=this.collisionCircleArrays[n.bucketInstanceId],delete this.collisionCircleArrays[n.bucketInstanceId])}symbolFadeChange(n){return this.fadeDuration===0?1:(n-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(n){return Math.max(0,(this.transform.zoom-n)/1.5)}hasTransitions(n){return this.stale||n-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(n,u){const _=this.zoomAtLastRecencyCheck===u?1-this.zoomAdjustment(u):1;return this.zoomAtLastRecencyCheck=u,this.commitTime+this.fadeDuration*_>n}setStale(){this.stale=!0}}function fo(w,n,u,_,b,T){_&&_.length!==0||(_=[0,0,0,0]);const I=_[0]-Ki,O=_[1]-Ki,N=_[2]-Ki,j=_[3]-Ki;w.emplaceBack(n?1:0,u?1:0,b||0,T||0,I,O),w.emplaceBack(n?1:0,u?1:0,b||0,T||0,N,O),w.emplaceBack(n?1:0,u?1:0,b||0,T||0,N,j),w.emplaceBack(n?1:0,u?1:0,b||0,T||0,I,j)}const ci=Math.pow(2,25),pi=Math.pow(2,24),Ti=Math.pow(2,17),_s=Math.pow(2,16),po=Math.pow(2,9),Go=Math.pow(2,8),cn=Math.pow(2,1);function Si(w){if(w.opacity===0&&!w.placed)return 0;if(w.opacity===1&&w.placed)return 4294967295;const n=w.placed?1:0,u=Math.floor(127*w.opacity);return u*ci+n*pi+u*Ti+n*_s+u*po+n*Go+u*cn+n}const ys=0;class Ar{constructor(n){this._sortAcrossTiles=n.layout.get("symbol-z-order")!=="viewport-y"&&!n.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(n,u,_,b,T){const I=this._bucketParts;for(;this._currentTileIndex<n.length;)if(u.getBucketParts(I,b,n[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,T())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,I.sort(((O,N)=>O.sortKey-N.sortKey)));this._currentPartIndex<I.length;)if(u.placeLayerBucketPart(I[this._currentPartIndex],this._seenCrossTileIDs,_),this._currentPartIndex++,T())return!0;return!1}}class ga{constructor(n,u,_,b,T,I,O,N){this.placement=new gs(n,u,I,O,N),this._currentPlacementIndex=_.length-1,this._forceFullPlacement=b,this._showCollisionBoxes=T,this._done=!1}isDone(){return this._done}continuePlacement(n,u,_){const b=Y.now(),T=()=>!this._forceFullPlacement&&Y.now()-b>2;for(;this._currentPlacementIndex>=0;){const I=u[n[this._currentPlacementIndex]],O=this.placement.collisionIndex.transform.zoom;if(I.type==="symbol"&&(!I.minzoom||I.minzoom<=O)&&(!I.maxzoom||I.maxzoom>O)){if(this._inProgressLayer||(this._inProgressLayer=new Ar(I)),this._inProgressLayer.continuePlacement(_[I.source],this.placement,this._showCollisionBoxes,I,T))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(n){return this.placement.commit(n),this.placement}}const Zo=512/c.$/2;class Ho{constructor(n,u,_){this.tileID=n,this.bucketInstanceId=_,this._symbolsByKey={};const b=new Map;for(let T=0;T<u.length;T++){const I=u.get(T),O=I.key,N=b.get(O);N?N.push(I):b.set(O,[I])}for(const[T,I]of b){const O={positions:I.map((N=>({x:Math.floor(N.anchorX*Zo),y:Math.floor(N.anchorY*Zo)}))),crossTileIDs:I.map((N=>N.crossTileID))};if(O.positions.length>128){const N=new c.aI(O.positions.length,16,Uint16Array);for(const{x:j,y:$}of O.positions)N.add(j,$);N.finish(),delete O.positions,O.index=N}this._symbolsByKey[T]=O}}getScaledCoordinates(n,u){const{x:_,y:b,z:T}=this.tileID.canonical,{x:I,y:O,z:N}=u.canonical,j=Zo/Math.pow(2,N-T),$=(O*c.$+n.anchorY)*j,X=b*c.$*Zo;return{x:Math.floor((I*c.$+n.anchorX)*j-_*c.$*Zo),y:Math.floor($-X)}}findMatches(n,u,_){const b=this.tileID.canonical.z<u.canonical.z?1:Math.pow(2,this.tileID.canonical.z-u.canonical.z);for(let T=0;T<n.length;T++){const I=n.get(T);if(I.crossTileID)continue;const O=this._symbolsByKey[I.key];if(!O)continue;const N=this.getScaledCoordinates(I,u);if(O.index){const j=O.index.range(N.x-b,N.y-b,N.x+b,N.y+b).sort();for(const $ of j){const X=O.crossTileIDs[$];if(!_[X]){_[X]=!0,I.crossTileID=X;break}}}else if(O.positions)for(let j=0;j<O.positions.length;j++){const $=O.positions[j],X=O.crossTileIDs[j];if(Math.abs($.x-N.x)<=b&&Math.abs($.y-N.y)<=b&&!_[X]){_[X]=!0,I.crossTileID=X;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map((({crossTileIDs:n})=>n))}}class Va{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Ir{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(n){const u=Math.round((n-this.lng)/360);if(u!==0)for(const _ in this.indexes){const b=this.indexes[_],T={};for(const I in b){const O=b[I];O.tileID=O.tileID.unwrapTo(O.tileID.wrap+u),T[O.tileID.key]=O}this.indexes[_]=T}this.lng=n}addBucket(n,u,_){if(this.indexes[n.overscaledZ]&&this.indexes[n.overscaledZ][n.key]){if(this.indexes[n.overscaledZ][n.key].bucketInstanceId===u.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(n.overscaledZ,this.indexes[n.overscaledZ][n.key])}for(let T=0;T<u.symbolInstances.length;T++)u.symbolInstances.get(T).crossTileID=0;this.usedCrossTileIDs[n.overscaledZ]||(this.usedCrossTileIDs[n.overscaledZ]={});const b=this.usedCrossTileIDs[n.overscaledZ];for(const T in this.indexes){const I=this.indexes[T];if(Number(T)>n.overscaledZ)for(const O in I){const N=I[O];N.tileID.isChildOf(n)&&N.findMatches(u.symbolInstances,n,b)}else{const O=I[n.scaledTo(Number(T)).key];O&&O.findMatches(u.symbolInstances,n,b)}}for(let T=0;T<u.symbolInstances.length;T++){const I=u.symbolInstances.get(T);I.crossTileID||(I.crossTileID=_.generate(),b[I.crossTileID]=!0)}return this.indexes[n.overscaledZ]===void 0&&(this.indexes[n.overscaledZ]={}),this.indexes[n.overscaledZ][n.key]=new Ho(n,u.symbolInstances,u.bucketInstanceId),!0}removeBucketCrossTileIDs(n,u){for(const _ of u.getCrossTileIDsLists())for(const b of _)delete this.usedCrossTileIDs[n][b]}removeStaleBuckets(n){let u=!1;for(const _ in this.indexes){const b=this.indexes[_];for(const T in b)n[b[T].bucketInstanceId]||(this.removeBucketCrossTileIDs(_,b[T]),delete b[T],u=!0)}return u}}class Ya{constructor(){this.layerIndexes={},this.crossTileIDs=new Va,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(n,u,_){let b=this.layerIndexes[n.id];b===void 0&&(b=this.layerIndexes[n.id]=new Ir);let T=!1;const I={};b.handleWrapJump(_);for(const O of u){const N=O.getBucket(n);N&&n.id===N.layerIds[0]&&(N.bucketInstanceId||(N.bucketInstanceId=++this.maxBucketInstanceId),b.addBucket(O.tileID,N,this.crossTileIDs)&&(T=!0),I[N.bucketInstanceId]=!0)}return b.removeStaleBuckets(I)&&(T=!0),T}pruneUnusedLayers(n){const u={};n.forEach((_=>{u[_]=!0}));for(const _ in this.layerIndexes)u[_]||delete this.layerIndexes[_]}}var Xr="void main() {fragColor=vec4(1.0);}";const Cr={prelude:Un(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:Un("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:Un("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:Un(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:Un(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Un(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Un(Xr,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:Un(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:Un(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Un("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Un("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:Un(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:Un("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:Un(Xr,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:Un(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:Un(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:Un(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:Un(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Un(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Un(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Un(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Un(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:Un(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Un(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Un(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Un(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Un(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:Un(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Un(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Un(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Un("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:Un("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:Un("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:Un("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:Un(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:Un("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function Un(w,n){const u=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,_=n.match(/in ([\w]+) ([\w]+)/g),b=w.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),T=n.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),I=T?T.concat(b):b,O={};return{fragmentSource:w=w.replace(u,((N,j,$,X,W)=>(O[W]=!0,j==="define"?`
#ifndef HAS_UNIFORM_u_${W}
in ${$} ${X} ${W};
#else
uniform ${$} ${X} u_${W};
#endif
`:`
#ifdef HAS_UNIFORM_u_${W}
    ${$} ${X} ${W} = u_${W};
#endif
`))),vertexSource:n=n.replace(u,((N,j,$,X,W)=>{const ee=X==="float"?"vec2":"vec4",ae=W.match(/color/)?"color":ee;return O[W]?j==="define"?`
#ifndef HAS_UNIFORM_u_${W}
uniform lowp float u_${W}_t;
in ${$} ${ee} a_${W};
out ${$} ${X} ${W};
#else
uniform ${$} ${X} u_${W};
#endif
`:ae==="vec4"?`
#ifndef HAS_UNIFORM_u_${W}
    ${W} = a_${W};
#else
    ${$} ${X} ${W} = u_${W};
#endif
`:`
#ifndef HAS_UNIFORM_u_${W}
    ${W} = unpack_mix_${ae}(a_${W}, u_${W}_t);
#else
    ${$} ${X} ${W} = u_${W};
#endif
`:j==="define"?`
#ifndef HAS_UNIFORM_u_${W}
uniform lowp float u_${W}_t;
in ${$} ${ee} a_${W};
#else
uniform ${$} ${X} u_${W};
#endif
`:ae==="vec4"?`
#ifndef HAS_UNIFORM_u_${W}
    ${$} ${X} ${W} = a_${W};
#else
    ${$} ${X} ${W} = u_${W};
#endif
`:`
#ifndef HAS_UNIFORM_u_${W}
    ${$} ${X} ${W} = unpack_mix_${ae}(a_${W}, u_${W}_t);
#else
    ${$} ${X} ${W} = u_${W};
#endif
`})),staticAttributes:_,staticUniforms:I}}class Qa{constructor(n,u,_){this.vertexBuffer=n,this.indexBuffer=u,this.segments=_}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var Ja=c.aJ([{name:"a_pos",type:"Int16",components:2}]);const vs="#define PROJECTION_MERCATOR",Gs="mercator";class Mn{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return Gs}get shaderDefine(){return vs}get shaderPreludeCode(){return Cr.projectionMercator}get vertexShaderPreludeCode(){return Cr.projectionMercator.vertexSource}get subdivisionGranularity(){return c.aK.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(n){}getMeshFromTileID(n,u,_,b,T){if(this._cachedMesh)return this._cachedMesh;const I=new c.aL;I.emplaceBack(0,0),I.emplaceBack(c.$,0),I.emplaceBack(0,c.$),I.emplaceBack(c.$,c.$);const O=n.createVertexBuffer(I,Ja.members),N=c.aM.simpleSegment(0,0,4,2),j=new c.aN;j.emplaceBack(1,0,2),j.emplaceBack(1,2,3);const $=n.createIndexBuffer(j);return this._cachedMesh=new Qa(O,$,N),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(n){}}class Zs{constructor(n=0,u=0,_=0,b=0){if(isNaN(n)||n<0||isNaN(u)||u<0||isNaN(_)||_<0||isNaN(b)||b<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=n,this.bottom=u,this.left=_,this.right=b}interpolate(n,u,_){return u.top!=null&&n.top!=null&&(this.top=c.C.number(n.top,u.top,_)),u.bottom!=null&&n.bottom!=null&&(this.bottom=c.C.number(n.bottom,u.bottom,_)),u.left!=null&&n.left!=null&&(this.left=c.C.number(n.left,u.left,_)),u.right!=null&&n.right!=null&&(this.right=c.C.number(n.right,u.right,_)),this}getCenter(n,u){const _=c.ah((this.left+n-this.right)/2,0,n),b=c.ah((this.top+u-this.bottom)/2,0,u);return new c.P(_,b)}equals(n){return this.top===n.top&&this.bottom===n.bottom&&this.left===n.left&&this.right===n.right}clone(){return new Zs(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Mo(w,n){if(!w.renderWorldCopies||w.lngRange)return;const u=n.lng-w.center.lng;n.lng+=u>180?-360:u<-180?360:0}function mo(w){return Math.max(0,Math.floor(w))}class Ei{constructor(n,u,_,b,T,I){this._callbacks=n,this._tileSize=512,this._renderWorldCopies=I===void 0||!!I,this._minZoom=u||0,this._maxZoom=_||22,this._minPitch=b??0,this._maxPitch=T??60,this.setMaxBounds(),this._width=0,this._height=0,this._center=new c.S(0,0),this._elevation=0,this._zoom=0,this._tileZoom=mo(this._zoom),this._scale=c.af(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new Zs,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(n,u,_){this._latRange=n.latRange,this._lngRange=n.lngRange,this._width=n.width,this._height=n.height,this._center=n.center,this._elevation=n.elevation,this._minElevationForCurrentTile=n.minElevationForCurrentTile,this._zoom=n.zoom,this._tileZoom=mo(this._zoom),this._scale=c.af(this._zoom),this._bearingInRadians=n.bearingInRadians,this._fovInRadians=n.fovInRadians,this._pitchInRadians=n.pitchInRadians,this._rollInRadians=n.rollInRadians,this._unmodified=n.unmodified,this._edgeInsets=new Zs(n.padding.top,n.padding.bottom,n.padding.left,n.padding.right),this._minZoom=n.minZoom,this._maxZoom=n.maxZoom,this._minPitch=n.minPitch,this._maxPitch=n.maxPitch,this._renderWorldCopies=n.renderWorldCopies,this._cameraToCenterDistance=n.cameraToCenterDistance,this._nearZ=n.nearZ,this._farZ=n.farZ,this._autoCalculateNearFarZ=!_&&n.autoCalculateNearFarZ,u&&this._constrain(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(n){this._minElevationForCurrentTile=n}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(n){this._minZoom!==n&&(this._minZoom=n,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(n){this._maxZoom!==n&&(this._maxZoom=n,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(n){this._minPitch!==n&&(this._minPitch=n,this.setPitch(Math.max(this.pitch,n)))}get maxPitch(){return this._maxPitch}setMaxPitch(n){this._maxPitch!==n&&(this._maxPitch=n,this.setPitch(Math.min(this.pitch,n)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(n){n===void 0?n=!0:n===null&&(n=!1),this._renderWorldCopies=n}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new c.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(n){const u=c.aO(n,-180,180)*Math.PI/180;var _,b,T,I,O,N,j,$,X;this._bearingInRadians!==u&&(this._unmodified=!1,this._bearingInRadians=u,this._calcMatrices(),this._rotationMatrix=k(),_=this._rotationMatrix,T=-this._bearingInRadians,I=(b=this._rotationMatrix)[0],O=b[1],N=b[2],j=b[3],$=Math.sin(T),X=Math.cos(T),_[0]=I*X+N*$,_[1]=O*X+j*$,_[2]=I*-$+N*X,_[3]=O*-$+j*X)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(n){const u=c.ah(n,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==u&&(this._unmodified=!1,this._pitchInRadians=u,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(n){const u=n/180*Math.PI;this._rollInRadians!==u&&(this._unmodified=!1,this._rollInRadians=u,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return c.aP(this._fovInRadians)}setFov(n){n=c.ah(n,.1,150),this.fov!==n&&(this._unmodified=!1,this._fovInRadians=c.ae(n),this._calcMatrices())}get zoom(){return this._zoom}setZoom(n){const u=this.getConstrained(this._center,n).zoom;this._zoom!==u&&(this._unmodified=!1,this._zoom=u,this._tileZoom=Math.max(0,Math.floor(u)),this._scale=c.af(u),this._constrain(),this._calcMatrices())}get center(){return this._center}setCenter(n){n.lat===this._center.lat&&n.lng===this._center.lng||(this._unmodified=!1,this._center=n,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(n){n!==this._elevation&&(this._elevation=n,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(n){this._edgeInsets.equals(n)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,n,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(n,u){this._autoCalculateNearFarZ=!1,this._nearZ=n,this._farZ=u,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(n){return this._edgeInsets.equals(n)}interpolatePadding(n,u,_){this._unmodified=!1,this._edgeInsets.interpolate(n,u,_),this._constrain(),this._calcMatrices()}resize(n,u,_=!0){this._width=n,this._height=u,_&&this._constrain(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new Pi([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(n){n?(this._lngRange=[n.getWest(),n.getEast()],this._latRange=[n.getSouth(),n.getNorth()],this._constrain()):(this._lngRange=null,this._latRange=[-c.ai,c.ai])}getConstrained(n,u){return this._callbacks.getConstrained(n,u)}getCameraQueryGeometry(n,u){if(u.length===1)return[u[0],n];{const{minX:_,minY:b,maxX:T,maxY:I}=c.a2.fromPoints(u).extend(n);return[new c.P(_,b),new c.P(T,b),new c.P(T,I),new c.P(_,I),new c.P(_,b)]}}_constrain(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const n=this._unmodified,{center:u,zoom:_}=this.getConstrained(this.center,this.zoom);this.setCenter(u),this.setZoom(_),this._unmodified=n,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let n=c.ag(new Float64Array(16));c.N(n,n,[this._width/2,-this._height/2,1]),c.M(n,n,[1,-1,0]),this._clipSpaceToPixelsMatrix=n,n=c.ag(new Float64Array(16)),c.N(n,n,[1,-1,1]),c.M(n,n,[-1,-1,0]),c.N(n,n,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=n,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(n,u,_,b){const T=_!==void 0?_:this.bearing,I=b=b!==void 0?b:this.pitch,O=c.a1.fromLngLat(n,u),N=-Math.cos(c.ae(I)),j=Math.sin(c.ae(I)),$=j*Math.sin(c.ae(T)),X=-j*Math.cos(c.ae(T));let W=this.elevation;const ee=u-W;let ae;N*ee>=0||Math.abs(N)<.1?(ae=1e4,W=u+ae*N):ae=-ee/N;let _e,ge,ve=c.aQ(1,O.y),Te=0;do{if(Te+=1,Te>10)break;ge=ae/ve,_e=new c.a1(O.x+$*ge,O.y+X*ge),ve=1/_e.meterInMercatorCoordinateUnits()}while(Math.abs(ae-ge*ve)>1e-12);return{center:_e.toLngLat(),elevation:W,zoom:c.ak(this.height/2/Math.tan(this.fovInRadians/2)/ge/this.tileSize)}}recalculateZoomAndCenter(n){if(this.elevation-n==0)return;const u=c.aj(1,this.center.lat)*this.worldSize,_=this.cameraToCenterDistance/u,b=c.a1.fromLngLat(this.center,this.elevation),T=Je(this.center,this.elevation,this.pitch,this.bearing,_);this._elevation=n;const I=this.calculateCenterFromCameraLngLatAlt(T.toLngLat(),c.aQ(T.z,b.y),this.bearing,this.pitch);this._elevation=I.elevation,this._center=I.center,this.setZoom(I.zoom)}getCameraPoint(){const n=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new c.P(n*Math.sin(this.rollInRadians),n*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const n=c.aj(1,this.center.lat)*this.worldSize;return Je(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/n).toLngLat()}getMercatorTileCoordinates(n){if(!n)return[0,0,1,1];const u=n.canonical.z>=0?1<<n.canonical.z:Math.pow(2,n.canonical.z);return[n.canonical.x/u,n.canonical.y/u,1/u/c.$,1/u/c.$]}}class qr{constructor(n,u){this.min=n,this.max=u,this.center=c.aR([],c.aS([],this.min,this.max),.5)}quadrant(n){const u=[n%2==0,n<2],_=c.aT(this.min),b=c.aT(this.max);for(let T=0;T<u.length;T++)_[T]=u[T]?this.min[T]:this.center[T],b[T]=u[T]?this.center[T]:this.max[T];return b[2]=this.max[2],new qr(_,b)}distanceX(n){return Math.max(Math.min(this.max[0],n[0]),this.min[0])-n[0]}distanceY(n){return Math.max(Math.min(this.max[1],n[1]),this.min[1])-n[1]}intersectsFrustum(n){let u=!0;for(let _=0;_<n.planes.length;_++){const b=this.intersectsPlane(n.planes[_]);if(b===0)return 0;b===1&&(u=!1)}return u?2:n.aabb.min[0]>this.max[0]||n.aabb.min[1]>this.max[1]||n.aabb.min[2]>this.max[2]||n.aabb.max[0]<this.min[0]||n.aabb.max[1]<this.min[1]||n.aabb.max[2]<this.min[2]?0:1}intersectsPlane(n){let u=n[3],_=n[3];for(let b=0;b<3;b++)n[b]>0?(u+=n[b]*this.min[b],_+=n[b]*this.max[b]):(_+=n[b]*this.min[b],u+=n[b]*this.max[b]);return u>=0?2:_<0?0:1}}class fn{distanceToTile2d(n,u,_,b){const T=b.distanceX([n,u]),I=b.distanceY([n,u]);return Math.hypot(T,I)}getWrap(n,u,_){return _}getTileBoundingVolume(n,u,_,b){var T,I;let O=0,N=0;if(b!=null&&b.terrain){const $=new c.Z(n.z,u,n.z,n.x,n.y),X=b.terrain.getMinMaxElevation($);O=(T=X.minElevation)!==null&&T!==void 0?T:Math.min(0,_),N=(I=X.maxElevation)!==null&&I!==void 0?I:Math.max(0,_)}const j=1<<n.z;return new qr([u+n.x/j,n.y/j,O],[u+(n.x+1)/j,(n.y+1)/j,N])}allowVariableZoom(n,u){const _=n.fov*(Math.abs(Math.cos(n.rollInRadians))*n.height+Math.abs(Math.sin(n.rollInRadians))*n.width)/n.height,b=c.ah(78.5-_/2,0,60);return!!u.terrain||n.pitch>b}allowWorldCopies(){return!0}prepareNextFrame(){}}class hi{constructor(n,u,_){this.points=n,this.planes=u,this.aabb=_}static fromInvProjectionMatrix(n,u=1,_=0,b,T){const I=T?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],O=Math.pow(2,_),N=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((W=>(function(ee,ae,_e,ge){const ve=c.aw([],ee,ae),Te=1/ve[3]/_e*ge;return c.aY(ve,ve,[Te,Te,1/ve[3],Te])})(W,n,u,O)));b&&(function(W,ee,ae,_e){const ge=_e?4:0,ve=_e?0:4;let Te=0;const Me=[],Ae=[];for(let Ce=0;Ce<4;Ce++){const We=c.aU([],W[Ce+ve],W[Ce+ge]),dt=c.aZ(We);c.aR(We,We,1/dt),Me.push(dt),Ae.push(We)}for(let Ce=0;Ce<4;Ce++){const We=c.a_(W[Ce+ge],Ae[Ce],ae);Te=We!==null&&We>=0?Math.max(Te,We):Math.max(Te,Me[Ce])}const Le=(function(Ce,We){const dt=c.aU([],Ce[We[0]],Ce[We[1]]),rt=c.aU([],Ce[We[2]],Ce[We[1]]),st=[0,0,0,0];return c.aV(st,c.aW([],dt,rt)),st[3]=-c.aX(st,Ce[We[0]]),st})(W,ee),Ue=(function(Ce,We){const dt=c.a$(Ce),rt=c.b0([],Ce,1/dt),st=c.aU([],We,c.aR([],rt,c.aX(We,rt))),ct=c.a$(st);if(ct>0){const Ot=Math.sqrt(1-rt[3]*rt[3]),Bt=c.aR([],rt,-rt[3]),Et=c.aS([],Bt,c.aR([],st,Ot/ct));return c.b1(We,Et)}return null})(ae,Le);if(Ue!==null){const Ce=Ue/c.aX(Ae[0],Le);Te=Math.min(Te,Ce)}for(let Ce=0;Ce<4;Ce++){const We=Math.min(Te,Me[Ce]);W[Ce+ve]=[W[Ce+ge][0]+Ae[Ce][0]*We,W[Ce+ge][1]+Ae[Ce][1]*We,W[Ce+ge][2]+Ae[Ce][2]*We,1]}})(N,I[0],b,T);const j=I.map((W=>{const ee=c.aU([],N[W[0]],N[W[1]]),ae=c.aU([],N[W[2]],N[W[1]]),_e=c.aV([],c.aW([],ee,ae)),ge=-c.aX(_e,N[W[1]]);return _e.concat(ge)})),$=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],X=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const W of N)for(let ee=0;ee<3;ee++)$[ee]=Math.min($[ee],W[ee]),X[ee]=Math.max(X[ee],W[ee]);return new hi(N,j,new qr($,X))}}class bn{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(n){this._helper.setMinZoom(n)}setMaxZoom(n){this._helper.setMaxZoom(n)}setMinPitch(n){this._helper.setMinPitch(n)}setMaxPitch(n){this._helper.setMaxPitch(n)}setRenderWorldCopies(n){this._helper.setRenderWorldCopies(n)}setBearing(n){this._helper.setBearing(n)}setPitch(n){this._helper.setPitch(n)}setRoll(n){this._helper.setRoll(n)}setFov(n){this._helper.setFov(n)}setZoom(n){this._helper.setZoom(n)}setCenter(n){this._helper.setCenter(n)}setElevation(n){this._helper.setElevation(n)}setMinElevationForCurrentTile(n){this._helper.setMinElevationForCurrentTile(n)}setPadding(n){this._helper.setPadding(n)}interpolatePadding(n,u,_){return this._helper.interpolatePadding(n,u,_)}isPaddingEqual(n){return this._helper.isPaddingEqual(n)}resize(n,u,_=!0){this._helper.resize(n,u,_)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(n){this._helper.setMaxBounds(n)}overrideNearFarZ(n,u){this._helper.overrideNearFarZ(n,u)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(n){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),n)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(n,u){}constructor(n,u,_,b,T){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this._helper=new Ei({calcMatrices:()=>{this._calcMatrices()},getConstrained:(I,O)=>this.getConstrained(I,O)},n,u,_,b,T),this._coveringTilesDetailsProvider=new fn}clone(){const n=new bn;return n.apply(this),n}apply(n,u,_){this._helper.apply(n,u,_)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(n){const u=[new c.b2(0,n)];if(this._helper._renderWorldCopies){const _=this.screenPointToMercatorCoordinate(new c.P(0,0)),b=this.screenPointToMercatorCoordinate(new c.P(this._helper._width,0)),T=this.screenPointToMercatorCoordinate(new c.P(this._helper._width,this._helper._height)),I=this.screenPointToMercatorCoordinate(new c.P(0,this._helper._height)),O=Math.floor(Math.min(_.x,b.x,T.x,I.x)),N=Math.floor(Math.max(_.x,b.x,T.x,I.x)),j=1;for(let $=O-j;$<=N+j;$++)$!==0&&u.push(new c.b2($,n))}return u}getCameraFrustum(){return hi.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(n){const u=this.screenPointToLocation(this.centerPoint,n),_=n?n.getElevationForLngLatZoom(u,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(_)}setLocationAtPoint(n,u){const _=c.aj(this.elevation,this.center.lat),b=this.screenPointToMercatorCoordinateAtZ(u,_),T=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,_),I=c.a1.fromLngLat(n),O=new c.a1(I.x-(b.x-T.x),I.y-(b.y-T.y));this.setCenter(O==null?void 0:O.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(n,u){return u?this.coordinatePoint(c.a1.fromLngLat(n),u.getElevationForLngLatZoom(n,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(c.a1.fromLngLat(n))}screenPointToLocation(n,u){var _;return(_=this.screenPointToMercatorCoordinate(n,u))===null||_===void 0?void 0:_.toLngLat()}screenPointToMercatorCoordinate(n,u){if(u){const _=u.pointCoordinate(n);if(_!=null)return _}return this.screenPointToMercatorCoordinateAtZ(n)}screenPointToMercatorCoordinateAtZ(n,u){const _=u||0,b=[n.x,n.y,0,1],T=[n.x,n.y,1,1];c.aw(b,b,this._pixelMatrixInverse),c.aw(T,T,this._pixelMatrixInverse);const I=b[3],O=T[3],N=b[1]/I,j=T[1]/O,$=b[2]/I,X=T[2]/O,W=$===X?0:(_-$)/(X-$);return new c.a1(c.C.number(b[0]/I,T[0]/O,W)/this.worldSize,c.C.number(N,j,W)/this.worldSize,_)}coordinatePoint(n,u=0,_=this._pixelMatrix){const b=[n.x*this.worldSize,n.y*this.worldSize,u,1];return c.aw(b,b,_),new c.P(b[0]/b[3],b[1]/b[3])}getBounds(){const n=Math.max(0,this._helper._height/2-Ne(this));return new Pi().extend(this.screenPointToLocation(new c.P(0,n))).extend(this.screenPointToLocation(new c.P(this._helper._width,n))).extend(this.screenPointToLocation(new c.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new c.P(0,this._helper._height)))}isPointOnMapSurface(n,u){return u?u.pointCoordinate(n)!=null:n.y>this.height/2-Ne(this)}calculatePosMatrix(n,u=!1,_){var b;const T=(b=n.key)!==null&&b!==void 0?b:c.b3(n.wrap,n.canonical.z,n.canonical.z,n.canonical.x,n.canonical.y),I=u?this._alignedPosMatrixCache:this._posMatrixCache;if(I.has(T)){const j=I.get(T);return _?j.f32:j.f64}const O=Ge(n,this.worldSize);c.O(O,u?this._alignedProjMatrix:this._viewProjMatrix,O);const N={f64:O,f32:new Float32Array(O)};return I.set(T,N),_?N.f32:N.f64}calculateFogMatrix(n){const u=n.key,_=this._fogMatrixCacheF32;if(_.has(u))return _.get(u);const b=Ge(n,this.worldSize);return c.O(b,this._fogMatrix,b),_.set(u,new Float32Array(b)),_.get(u)}getConstrained(n,u){u=c.ah(+u,this.minZoom,this.maxZoom);const _={center:new c.S(n.lng,n.lat),zoom:u};let b=this._helper._lngRange;if(!this._helper._renderWorldCopies&&b===null){const Me=179.9999999999;b=[-Me,Me]}const T=this.tileSize*c.af(_.zoom);let I=0,O=T,N=0,j=T,$=0,X=0;const{x:W,y:ee}=this.size;if(this._helper._latRange){const Me=this._helper._latRange;I=c.U(Me[1])*T,O=c.U(Me[0])*T,O-I<ee&&($=ee/(O-I))}b&&(N=c.aO(c.V(b[0])*T,0,T),j=c.aO(c.V(b[1])*T,0,T),j<N&&(j+=T),j-N<W&&(X=W/(j-N)));const{x:ae,y:_e}=fe(T,n);let ge,ve;const Te=Math.max(X||0,$||0);if(Te){const Me=new c.P(X?(j+N)/2:ae,$?(O+I)/2:_e);return _.center=Se(T,Me).wrap(),_.zoom+=c.ak(Te),_}if(this._helper._latRange){const Me=ee/2;_e-Me<I&&(ve=I+Me),_e+Me>O&&(ve=O-Me)}if(b){const Me=(N+j)/2;let Ae=ae;this._helper._renderWorldCopies&&(Ae=c.aO(ae,Me-T/2,Me+T/2));const Le=W/2;Ae-Le<N&&(ge=N+Le),Ae+Le>j&&(ge=j-Le)}if(ge!==void 0||ve!==void 0){const Me=new c.P(ge??ae,ve??_e);_.center=Se(T,Me).wrap()}return _}calculateCenterFromCameraLngLatAlt(n,u,_,b){return this._helper.calculateCenterFromCameraLngLatAlt(n,u,_,b)}_calculateNearFarZIfNeeded(n,u,_){if(!this._helper.autoCalculateNearFarZ)return;const b=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),T=n-b*this._helper._pixelPerMeter/Math.cos(u),I=b<0?T:n,O=Math.PI/2+this.pitchInRadians,N=c.ae(this.fov)*(Math.abs(Math.cos(c.ae(this.roll)))*this.height+Math.abs(Math.sin(c.ae(this.roll)))*this.width)/this.height*(.5+_.y/this.height),j=Math.sin(N)*I/Math.sin(c.ah(Math.PI-O-N,.01,Math.PI-.01)),$=Ne(this),X=Math.atan($/this._helper.cameraToCenterDistance),W=c.ae(.75),ee=X>W?2*X*(.5+_.y/(2*$)):W,ae=Math.sin(ee)*I/Math.sin(c.ah(Math.PI-O-ee,.01,Math.PI-.01)),_e=Math.min(j,ae);this._helper._farZ=1.01*(Math.cos(Math.PI/2-u)*_e+I),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const n=this.centerOffset,u=fe(this.worldSize,this.center),_=u.x,b=u.y;this._helper._pixelPerMeter=c.aj(1,this.center.lat)*this.worldSize;const T=c.ae(Math.min(this.pitch,le)),I=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(T));let O;this._calculateNearFarZIfNeeded(I,T,n),O=new Float64Array(16),c.b4(O,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),c.aq(this._invProjMatrix,O),O[8]=2*-n.x/this._helper._width,O[9]=2*n.y/this._helper._height,this._projectionMatrix=c.b5(O),c.N(O,O,[1,-1,1]),c.M(O,O,[0,0,-this._helper.cameraToCenterDistance]),c.b6(O,O,-this.rollInRadians),c.b7(O,O,this.pitchInRadians),c.b6(O,O,-this.bearingInRadians),c.M(O,O,[-_,-b,0]),this._mercatorMatrix=c.N([],O,[this.worldSize,this.worldSize,this.worldSize]),c.N(O,O,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=c.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,O),c.M(O,O,[0,0,-this.elevation]),this._viewProjMatrix=O,this._invViewProjMatrix=c.aq([],O);const N=[0,0,-1,1];c.aw(N,N,this._invViewProjMatrix),this._cameraPosition=[N[0]/N[3],N[1]/N[3],N[2]/N[3]],this._fogMatrix=new Float64Array(16),c.b4(this._fogMatrix,this.fovInRadians,this.width/this.height,I,this._helper._farZ),this._fogMatrix[8]=2*-n.x/this.width,this._fogMatrix[9]=2*n.y/this.height,c.N(this._fogMatrix,this._fogMatrix,[1,-1,1]),c.M(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),c.b6(this._fogMatrix,this._fogMatrix,-this.rollInRadians),c.b7(this._fogMatrix,this._fogMatrix,this.pitchInRadians),c.b6(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),c.M(this._fogMatrix,this._fogMatrix,[-_,-b,0]),c.N(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),c.M(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=c.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,O);const j=this._helper._width%2/2,$=this._helper._height%2/2,X=Math.cos(this.bearingInRadians),W=Math.sin(-this.bearingInRadians),ee=_-Math.round(_)+X*j+W*$,ae=b-Math.round(b)+X*$+W*j,_e=new Float64Array(O);if(c.M(_e,_e,[ee>.5?ee-1:ee,ae>.5?ae-1:ae,0]),this._alignedProjMatrix=_e,O=c.aq(new Float64Array(16),this._pixelMatrix),!O)throw new Error("failed to invert matrix");this._pixelMatrixInverse=O,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const n=this.screenPointToMercatorCoordinate(new c.P(0,0)),u=[n.x*this.worldSize,n.y*this.worldSize,0,1];return c.aw(u,u,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const n=c.aj(1,this.center.lat)*this.worldSize;return Je(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/n).toLngLat()}lngLatToCameraDepth(n,u){const _=c.a1.fromLngLat(n),b=[_.x*this.worldSize,_.y*this.worldSize,u,1];return c.aw(b,b,this._viewProjMatrix),b[2]/b[3]}getProjectionData(n){const{overscaledTileID:u,aligned:_,applyTerrainMatrix:b}=n,T=this._helper.getMercatorTileCoordinates(u),I=u?this.calculatePosMatrix(u,_,!0):null;let O;return O=u&&u.terrainRttPosMatrix32f&&b?u.terrainRttPosMatrix32f:I||c.b8(),{mainMatrix:O,tileMercatorCoords:T,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:O}}isLocationOccluded(n){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(n,u,_){return 1}transformLightDirection(n){return c.aT(n)}getRayDirectionFromPixel(n){throw new Error("Not implemented.")}projectTileCoordinates(n,u,_,b){const T=this.calculatePosMatrix(_);let I;b?(I=[n,u,b(n,u),1],c.aw(I,I,T)):(I=[n,u,0,1],ma(I,I,T));const O=I[3];return{point:new c.P(I[0]/O,I[1]/O),signedDistanceFromCamera:O,isOccluded:!1}}populateCache(n){for(const u of n)this.calculatePosMatrix(u)}getMatrixForModel(n,u){const _=c.a1.fromLngLat(n,u),b=_.meterInMercatorCoordinateUnits(),T=c.b9();return c.M(T,T,[_.x,_.y,_.z]),c.b6(T,T,Math.PI),c.b7(T,T,Math.PI/2),c.N(T,T,[-b,b,b]),T}getProjectionDataForCustomLayer(n=!0){const u=new c.Z(0,0,0,0,0),_=this.getProjectionData({overscaledTileID:u,applyGlobeMatrix:n}),b=Ge(u,this.worldSize);c.O(b,this._viewProjMatrix,b),_.tileMercatorCoords=[0,0,1,1];const T=[c.$,c.$,this.worldSize/this._helper.pixelsPerMeter],I=c.ba();return c.N(I,b,T),_.fallbackMatrix=I,_.mainMatrix=I,_}getFastPathSimpleProjectionMatrix(n){return this.calculatePosMatrix(n)}}function Aa(){c.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function or(w){if(w.useSlerp)if(w.k<1){const n=c.bb(w.startEulerAngles.roll,w.startEulerAngles.pitch,w.startEulerAngles.bearing),u=c.bb(w.endEulerAngles.roll,w.endEulerAngles.pitch,w.endEulerAngles.bearing),_=new Float64Array(4);c.bc(_,n,u,w.k);const b=c.bd(_);w.tr.setRoll(b.roll),w.tr.setPitch(b.pitch),w.tr.setBearing(b.bearing)}else w.tr.setRoll(w.endEulerAngles.roll),w.tr.setPitch(w.endEulerAngles.pitch),w.tr.setBearing(w.endEulerAngles.bearing);else w.tr.setRoll(c.C.number(w.startEulerAngles.roll,w.endEulerAngles.roll,w.k)),w.tr.setPitch(c.C.number(w.startEulerAngles.pitch,w.endEulerAngles.pitch,w.k)),w.tr.setBearing(c.C.number(w.startEulerAngles.bearing,w.endEulerAngles.bearing,w.k))}function Br(w,n,u,_,b){const T=b.padding,I=fe(b.worldSize,u.getNorthWest()),O=fe(b.worldSize,u.getNorthEast()),N=fe(b.worldSize,u.getSouthEast()),j=fe(b.worldSize,u.getSouthWest()),$=c.ae(-_),X=I.rotate($),W=O.rotate($),ee=N.rotate($),ae=j.rotate($),_e=new c.P(Math.max(X.x,W.x,ae.x,ee.x),Math.max(X.y,W.y,ae.y,ee.y)),ge=new c.P(Math.min(X.x,W.x,ae.x,ee.x),Math.min(X.y,W.y,ae.y,ee.y)),ve=_e.sub(ge),Te=(b.width-(T.left+T.right+n.left+n.right))/ve.x,Me=(b.height-(T.top+T.bottom+n.top+n.bottom))/ve.y;if(Me<0||Te<0)return void Aa();const Ae=Math.min(c.ak(b.scale*Math.min(Te,Me)),w.maxZoom),Le=c.P.convert(w.offset),Ue=new c.P((n.left-n.right)/2,(n.top-n.bottom)/2).rotate(c.ae(_)),Ce=Le.add(Ue).mult(b.scale/c.af(Ae));return{center:Se(b.worldSize,I.add(N).div(2).sub(Ce)),zoom:Ae,bearing:_}}class Oi{get useGlobeControls(){return!1}handlePanInertia(n,u){return{easingOffset:n,easingCenter:u.center}}handleMapControlsRollPitchBearingZoom(n,u){n.bearingDelta&&u.setBearing(u.bearing+n.bearingDelta),n.pitchDelta&&u.setPitch(u.pitch+n.pitchDelta),n.rollDelta&&u.setRoll(u.roll+n.rollDelta),n.zoomDelta&&u.setZoom(u.zoom+n.zoomDelta)}handleMapControlsPan(n,u,_){n.around.distSqr(u.centerPoint)<.01||u.setLocationAtPoint(_,n.around)}cameraForBoxAndBearing(n,u,_,b,T){return Br(n,u,_,b,T)}handleJumpToCenterZoom(n,u){n.zoom!==(u.zoom!==void 0?+u.zoom:n.zoom)&&n.setZoom(+u.zoom),u.center!==void 0&&n.setCenter(c.S.convert(u.center))}handleEaseTo(n,u){const _=n.zoom,b=n.padding,T={roll:n.roll,pitch:n.pitch,bearing:n.bearing},I={roll:u.roll===void 0?n.roll:u.roll,pitch:u.pitch===void 0?n.pitch:u.pitch,bearing:u.bearing===void 0?n.bearing:u.bearing},O=u.zoom!==void 0,N=!n.isPaddingEqual(u.padding);let j=!1;const $=O?+u.zoom:n.zoom;let X=n.centerPoint.add(u.offsetAsPoint);const W=n.screenPointToLocation(X),{center:ee,zoom:ae}=n.getConstrained(c.S.convert(u.center||W),$??_);Mo(n,ee);const _e=fe(n.worldSize,W),ge=fe(n.worldSize,ee).sub(_e),ve=c.af(ae-_);return j=ae!==_,{easeFunc:Te=>{if(j&&n.setZoom(c.C.number(_,ae,Te)),c.be(T,I)||or({startEulerAngles:T,endEulerAngles:I,tr:n,k:Te,useSlerp:T.roll!=I.roll}),N&&(n.interpolatePadding(b,u.padding,Te),X=n.centerPoint.add(u.offsetAsPoint)),u.around)n.setLocationAtPoint(u.around,u.aroundPoint);else{const Me=c.af(n.zoom-_),Ae=ae>_?Math.min(2,ve):Math.max(.5,ve),Le=Math.pow(Ae,1-Te),Ue=Se(n.worldSize,_e.add(ge.mult(Te*Le)).mult(Me));n.setLocationAtPoint(n.renderWorldCopies?Ue.wrap():Ue,X)}},isZooming:j,elevationCenter:ee}}handleFlyTo(n,u){const _=u.zoom!==void 0,b=n.zoom,T=n.getConstrained(c.S.convert(u.center||u.locationAtOffset),_?+u.zoom:b),I=T.center,O=T.zoom;Mo(n,I);const N=fe(n.worldSize,u.locationAtOffset),j=fe(n.worldSize,I).sub(N),$=j.mag(),X=c.af(O-b);let W;if(u.minZoom!==void 0){const ee=Math.min(+u.minZoom,b,O),ae=n.getConstrained(I,ee).zoom;W=c.af(ae-b)}return{easeFunc:(ee,ae,_e,ge)=>{n.setZoom(ee===1?O:b+c.ak(ae));const ve=ee===1?I:Se(n.worldSize,N.add(j.mult(_e)).mult(ae));n.setLocationAtPoint(n.renderWorldCopies?ve.wrap():ve,ge)},scaleOfZoom:X,targetCenter:I,scaleOfMinZoom:W,pixelPathLength:$}}}class Tn{constructor(n,u,_){this.blendFunction=n,this.blendColor=u,this.mask=_}}Tn.Replace=[1,0],Tn.disabled=new Tn(Tn.Replace,c.bf.transparent,[!1,!1,!1,!1]),Tn.unblended=new Tn(Tn.Replace,c.bf.transparent,[!0,!0,!0,!0]),Tn.alphaBlended=new Tn([1,771],c.bf.transparent,[!0,!0,!0,!0]);const bs=2305;class pn{constructor(n,u,_){this.enable=n,this.mode=u,this.frontFace=_}}pn.disabled=new pn(!1,1029,bs),pn.backCCW=new pn(!0,1029,bs),pn.frontCCW=new pn(!0,1028,bs);class sn{constructor(n,u,_){this.func=n,this.mask=u,this.range=_}}sn.ReadOnly=!1,sn.ReadWrite=!0,sn.disabled=new sn(519,sn.ReadOnly,[0,1]);const $r=7680;class Jn{constructor(n,u,_,b,T,I){this.test=n,this.ref=u,this.mask=_,this.fail=b,this.depthFail=T,this.pass=I}}Jn.disabled=new Jn({func:519,mask:0},0,0,$r,$r,$r);const xi=new WeakMap;function lr(w){var n;if(xi.has(w))return xi.get(w);{const u=(n=w.getParameter(w.VERSION))===null||n===void 0?void 0:n.startsWith("WebGL 2.0");return xi.set(w,u),u}}class Ia{get awaitingQuery(){return!!this._readbackQueue}constructor(n){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=n;const u=n.context,_=u.gl;this._texFormat=_.RGBA,this._texType=_.UNSIGNED_BYTE;const b=new c.aL;b.emplaceBack(-1,-1),b.emplaceBack(2,-1),b.emplaceBack(-1,2);const T=new c.aN;T.emplaceBack(0,1,2),this._fullscreenTriangle=new Qa(u.createVertexBuffer(b,Ja.members),u.createIndexBuffer(T),c.aM.simpleSegment(0,0,b.length,T.length)),this._resultBuffer=new Uint8Array(4),u.activeTexture.set(_.TEXTURE1);const I=_.createTexture();_.bindTexture(_.TEXTURE_2D,I),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,_.CLAMP_TO_EDGE),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,_.CLAMP_TO_EDGE),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,_.NEAREST),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,_.NEAREST),_.texImage2D(_.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=u.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(I),lr(_)&&(this._pbo=_.createBuffer(),_.bindBuffer(_.PIXEL_PACK_BUFFER,this._pbo),_.bufferData(_.PIXEL_PACK_BUFFER,4,_.STREAM_READ),_.bindBuffer(_.PIXEL_PACK_BUFFER,null))}destroy(){const n=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),n.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(n,u){const _=this._updateCount;return this._readbackQueue?_>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():_>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(n,u),this._updateCount++,this._measuredError}_bindFramebuffer(){const n=this._cachedRenderContext.context,u=n.gl;n.activeTexture.set(u.TEXTURE1),u.bindTexture(u.TEXTURE_2D,this._fbo.colorAttachment.get()),n.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(n,u){const _=this._cachedRenderContext.context,b=_.gl;if(this._bindFramebuffer(),_.viewport.set([0,0,this._texWidth,this._texHeight]),_.clear({color:c.bf.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(_,b.TRIANGLES,sn.disabled,Jn.disabled,Tn.unblended,pn.disabled,((T,I)=>({u_input:T,u_output_expected:I}))(n,u),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&lr(b)){b.bindBuffer(b.PIXEL_PACK_BUFFER,this._pbo),b.readBuffer(b.COLOR_ATTACHMENT0),b.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),b.bindBuffer(b.PIXEL_PACK_BUFFER,null);const T=b.fenceSync(b.SYNC_GPU_COMMANDS_COMPLETE,0);b.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:T}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const n=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&lr(n)){const u=n.clientWaitSync(this._readbackQueue.sync,0,0);if(u===n.WAIT_FAILED)return c.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(u===n.TIMEOUT_EXPIRED)return;n.bindBuffer(n.PIXEL_PACK_BUFFER,this._pbo),n.getBufferSubData(n.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),n.bindBuffer(n.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),n.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=Ia._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(n){let u=0;return u+=n[0]/256,u+=n[1]/65536,u+=n[2]/16777216,n[3]<127&&(u=-u),u/128}}const go=c.$/128;function Sl(w,n){const u=w.granularity!==void 0?Math.max(w.granularity,1):1,_=u+(w.generateBorders?2:0),b=u+(w.extendToNorthPole||w.generateBorders?1:0)+(w.extendToSouthPole||w.generateBorders?1:0),T=_+1,I=b+1,O=w.generateBorders?-1:0,N=w.generateBorders||w.extendToNorthPole?-1:0,j=u+(w.generateBorders?1:0),$=u+(w.generateBorders||w.extendToSouthPole?1:0),X=T*I,W=_*b*6,ee=T*I>65536;if(ee&&n==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const ae=ee||n==="32bit",_e=new Int16Array(2*X);let ge=0;for(let Me=N;Me<=$;Me++)for(let Ae=O;Ae<=j;Ae++){let Le=Ae/u*c.$;Ae===-1&&(Le=-go),Ae===u+1&&(Le=c.$+go);let Ue=Me/u*c.$;Me===-1&&(Ue=w.extendToNorthPole?c.bh:-go),Me===u+1&&(Ue=w.extendToSouthPole?c.bi:c.$+go),_e[ge++]=Le,_e[ge++]=Ue}const ve=ae?new Uint32Array(W):new Uint16Array(W);let Te=0;for(let Me=0;Me<b;Me++)for(let Ae=0;Ae<_;Ae++){const Le=Ae+1+Me*T,Ue=Ae+(Me+1)*T,Ce=Ae+1+(Me+1)*T;ve[Te++]=Ae+Me*T,ve[Te++]=Ue,ve[Te++]=Le,ve[Te++]=Le,ve[Te++]=Ue,ve[Te++]=Ce}return{vertices:_e.buffer.slice(0),indices:ve.buffer.slice(0),uses32bitIndices:ae}}const _o=new c.aK({fill:new c.bj(128,2),line:new c.bj(512,0),tile:new c.bj(128,32),stencil:new c.bj(128,1),circle:3});class Xn{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return Cr.projectionGlobe}get vertexShaderPreludeCode(){return Cr.projectionMercator.vertexSource}get subdivisionGranularity(){return _o}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(n){this._errorMeasurement||(this._errorMeasurement=new Ia(n));const u=c.U(this._errorQueryLatitudeDegrees),_=2*Math.atan(Math.exp(Math.PI-u*Math.PI*2))-.5*Math.PI,b=this._errorMeasurement.updateErrorLoop(u,_),T=Y.now();b!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=b,this._errorMeasurementLastChangeTime=T);const I=Math.min(Math.max((T-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=c.bk(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,c.bl(I))}_getMeshKey(n){return`${n.granularity.toString(36)}_${n.generateBorders?"b":""}${n.extendToNorthPole?"n":""}${n.extendToSouthPole?"s":""}`}getMeshFromTileID(n,u,_,b,T){const I=(T==="stencil"?_o.stencil:_o.tile).getGranularityForZoomLevel(u.z);return this._getMesh(n,{granularity:I,generateBorders:_,extendToNorthPole:u.y===0&&b,extendToSouthPole:u.y===(1<<u.z)-1&&b})}_getMesh(n,u){const _=this._getMeshKey(u);if(_ in this._tileMeshCache)return this._tileMeshCache[_];const b=(function(T,I){const O=Sl(I,"16bit"),N=c.aL.deserialize({arrayBuffer:O.vertices,length:O.vertices.byteLength/2/2}),j=c.aN.deserialize({arrayBuffer:O.indices,length:O.indices.byteLength/2/3});return new Qa(T.createVertexBuffer(N,Ja.members),T.createIndexBuffer(j),c.aM.simpleSegment(0,0,N.length,j.length))})(n,u);return this._tileMeshCache[_]=b,b}recalculate(n){}hasTransition(){const n=Y.now();let u=!1;return u=u||(n-this._errorMeasurementLastChangeTime)/1e3<.7,u=u||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,u}setErrorQueryLatitudeDegrees(n){this._errorQueryLatitudeDegrees=n}}const Hs=new c.r({type:new c.D(c.v.projection.type)});class Kr extends c.E{constructor(n){super(),this._transitionable=new c.t(Hs),this.setProjection(n),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new c.F(0)),this._mercatorProjection=new Mn,this._verticalPerspectiveProjection=new Xn}get transitionState(){const n=this.properties.get("type");if(typeof n=="string"&&n==="mercator")return 0;if(typeof n=="string"&&n==="vertical-perspective")return 1;if(n instanceof c.bm){if(n.from==="vertical-perspective"&&n.to==="mercator")return 1-n.transition;if(n.from==="mercator"&&n.to==="vertical-perspective")return n.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(n){this._mercatorProjection.updateGPUdependent(n),this._verticalPerspectiveProjection.updateGPUdependent(n)}getMeshFromTileID(n,u,_,b,T){return this.currentProjection.getMeshFromTileID(n,u,_,b,T)}setProjection(n){this._transitionable.setValue("type",(n==null?void 0:n.type)||"mercator")}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}setErrorQueryLatitudeDegrees(n){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(n),this._mercatorProjection.setErrorQueryLatitudeDegrees(n)}}function xs(w){const n=Ts(w.worldSize,w.center.lat);return 2*Math.PI*n}function ws(w,n,u,_,b){const T=1/(1<<b),I=n/c.$*T+_*T,O=c.bo((w/c.$*T+u*T)*Math.PI*2+Math.PI,2*Math.PI),N=2*Math.atan(Math.exp(Math.PI-I*Math.PI*2))-.5*Math.PI,j=Math.cos(N),$=new Float64Array(3);return $[0]=Math.sin(O)*j,$[1]=Math.sin(N),$[2]=Math.cos(O)*j,$}function Gr(w){return(function(n,u){const _=Math.cos(u),b=new Float64Array(3);return b[0]=Math.sin(n)*_,b[1]=Math.sin(u),b[2]=Math.cos(n)*_,b})(w.lng*Math.PI/180,w.lat*Math.PI/180)}function Ts(w,n){return w/(2*Math.PI)/Math.cos(n*Math.PI/180)}function Wo(w){const n=Math.asin(w[1])/Math.PI*180,u=Math.sqrt(w[0]*w[0]+w[2]*w[2]);if(u>1e-6){const _=w[0]/u,b=Math.acos(w[2]/u),T=(_>0?b:-b)/Math.PI*180;return new c.S(c.aO(T,-180,180),n)}return new c.S(0,n)}function Ro(w){return Math.cos(w*Math.PI/180)}function nr(w,n){const u=Ro(w),_=Ro(n);return c.ak(_/u)}function Uu(w,n){const u=w.rotate(n.bearingInRadians),_=n.zoom+nr(n.center.lat,0),b=c.bk(1/Ro(n.center.lat),1/Ro(Math.min(Math.abs(n.center.lat),60)),c.bn(_,7,3,0,1)),T=360/xs({worldSize:n.worldSize,center:{lat:n.center.lat}});return new c.S(n.center.lng-u.x*T*b,c.ah(n.center.lat+u.y*T,-c.ai,c.ai))}function Xo(w){const n=.5*w,u=Math.sin(n),_=Math.cos(n);return Math.log(u+_)-Math.log(_-u)}function Hl(w,n,u,_){const b=w.lat+u*_;if(Math.abs(u)>1){const T=(Math.sign(w.lat+u)!==Math.sign(w.lat)?-Math.abs(w.lat):Math.abs(w.lat))*Math.PI/180,I=Math.abs(w.lat+u)*Math.PI/180,O=Xo(T+_*(I-T)),N=Xo(T),j=Xo(I);return new c.S(w.lng+n*((O-N)/(j-N)),b)}return new c.S(w.lng+n*_,b)}class Ss{constructor(n){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=n}swapBuffers(){if(!this._hadAnyChanges)return;const n=this._cachePrevious;this._cachePrevious=this._cache,this._cache=n,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(n,u,_,b){const T=`${n.z}_${n.x}_${n.y}_${b!=null&&b.terrain?"t":""}`,I=this._cache.get(T);if(I)return I;const O=this._cachePrevious.get(T);if(O)return this._cache.set(T,O),O;const N=this._boundingVolumeFactory(n,u,_,b);return this._cache.set(T,N),this._hadAnyChanges=!0,N}}class El{constructor(n,u,_,b){this.min=_,this.max=b,this.points=n,this.planes=u}static fromAabb(n,u){const _=[];for(let b=0;b<8;b++)_.push([1&~b?n[0]:u[0],(b>>1&1)==1?u[1]:n[1],(b>>2&1)==1?u[2]:n[2]]);return new El(_,[[-1,0,0,u[0]],[1,0,0,-n[0]],[0,-1,0,u[1]],[0,1,0,-n[1]],[0,0,-1,u[2]],[0,0,1,-n[2]]],n,u)}static fromCenterSizeAngles(n,u,_){const b=c.br([],_[0],_[1],_[2]),T=c.bs([],[u[0],0,0],b),I=c.bs([],[0,u[1],0],b),O=c.bs([],[0,0,u[2]],b),N=[...n],j=[...n];for(let X=0;X<8;X++)for(let W=0;W<3;W++){const ee=n[W]+T[W]*(1&~X?-1:1)+I[W]*((X>>1&1)==1?1:-1)+O[W]*((X>>2&1)==1?1:-1);N[W]=Math.min(N[W],ee),j[W]=Math.max(j[W],ee)}const $=[];for(let X=0;X<8;X++){const W=[...n];c.aS(W,W,c.aR([],T,1&~X?-1:1)),c.aS(W,W,c.aR([],I,(X>>1&1)==1?1:-1)),c.aS(W,W,c.aR([],O,(X>>2&1)==1?1:-1)),$.push(W)}return new El($,[[...T,-c.aX(T,$[0])],[...I,-c.aX(I,$[0])],[...O,-c.aX(O,$[0])],[-T[0],-T[1],-T[2],-c.aX(T,$[7])],[-I[0],-I[1],-I[2],-c.aX(I,$[7])],[-O[0],-O[1],-O[2],-c.aX(O,$[7])]],N,j)}intersectsFrustum(n){let u=!0;const _=this.points.length,b=this.planes.length,T=n.planes.length,I=n.points.length;for(let O=0;O<T;O++){const N=n.planes[O];let j=0;for(let $=0;$<_;$++){const X=this.points[$];N[0]*X[0]+N[1]*X[1]+N[2]*X[2]+N[3]>=0&&j++}if(j===0)return 0;j<_&&(u=!1)}if(u)return 2;for(let O=0;O<b;O++){const N=this.planes[O];let j=0;for(let $=0;$<I;$++){const X=n.points[$];N[0]*X[0]+N[1]*X[1]+N[2]*X[2]+N[3]>=0&&j++}if(j===0)return 0}return 1}intersectsPlane(n){const u=this.points.length;let _=0;for(let b=0;b<u;b++){const T=this.points[b];n[0]*T[0]+n[1]*T[1]+n[2]*T[2]+n[3]>=0&&_++}return _===u?2:_===0?0:1}}function ir(w,n,u){const _=w-n;return _<0?-_:Math.max(0,_-u)}function es(w,n,u,_,b){const T=w-u;let I;return I=T<0?Math.min(-T,1+T-b):T>1?Math.min(Math.max(T-b,0),1-T):0,Math.max(I,ir(n,_,b))}class Es{constructor(){this._boundingVolumeCache=new Ss(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(n,u,_,b){const T=1<<_.z,I=1/T,O=_.x/T,N=_.y/T;let j=2;return j=Math.min(j,es(n,u,O,N,I)),j=Math.min(j,es(n,u,O+.5,-N-I,I)),j=Math.min(j,es(n,u,O+.5,2-N-I,I)),j}getWrap(n,u,_){const b=1<<u.z,T=1/b,I=u.x/b,O=ir(n.x,I,T),N=ir(n.x,I-1,T),j=ir(n.x,I+1,T),$=Math.min(O,N,j);return $===j?1:$===N?-1:0}allowVariableZoom(n,u){return en(n,u)>4}allowWorldCopies(){return!1}getTileBoundingVolume(n,u,_,b){return this._boundingVolumeCache.getTileBoundingVolume(n,u,_,b)}_computeTileBoundingVolume(n,u,_,b){var T,I;let O=0,N=0;if(b!=null&&b.terrain){const j=new c.Z(n.z,u,n.z,n.x,n.y),$=b.terrain.getMinMaxElevation(j);O=(T=$.minElevation)!==null&&T!==void 0?T:Math.min(0,_),N=(I=$.maxElevation)!==null&&I!==void 0?I:Math.max(0,_)}if(O/=c.bu,N/=c.bu,O+=1,N+=1,n.z<=0)return El.fromAabb([-N,-N,-N],[N,N,N]);if(n.z===1)return El.fromAabb([n.x===0?-N:0,n.y===0?0:-N,-N],[n.x===0?0:N,n.y===0?N:0,N]);{const j=[ws(0,0,n.x,n.y,n.z),ws(c.$,0,n.x,n.y,n.z),ws(c.$,c.$,n.x,n.y,n.z),ws(0,c.$,n.x,n.y,n.z)],$=[];for(const st of j)$.push(c.aR([],st,N));if(N!==O)for(const st of j)$.push(c.aR([],st,O));n.y===0&&$.push([0,1,0]),n.y===(1<<n.z)-1&&$.push([0,-1,0]);const X=[1,1,1],W=[-1,-1,-1];for(const st of $)for(let ct=0;ct<3;ct++)X[ct]=Math.min(X[ct],st[ct]),W[ct]=Math.max(W[ct],st[ct]);const ee=ws(c.$/2,c.$/2,n.x,n.y,n.z),ae=c.aW([],[0,1,0],ee);c.aV(ae,ae);const _e=c.aW([],ee,ae);c.aV(_e,_e);const ge=c.aW([],j[2],j[1]);c.aV(ge,ge);const ve=c.aW([],j[0],j[3]);c.aV(ve,ve),$.push(c.aR([],ee,N)),n.y>=(1<<n.z)/2&&$.push(c.aR([],ws(c.$/2,0,n.x,n.y,n.z),N)),n.y<(1<<n.z)/2&&$.push(c.aR([],ws(c.$/2,c.$,n.x,n.y,n.z),N));const Te=ko(ee,$),Me=ko(_e,$),Ae=[-ee[0],-ee[1],-ee[2],Te.max],Le=[ee[0],ee[1],ee[2],-Te.min],Ue=[-_e[0],-_e[1],-_e[2],Me.max],Ce=[_e[0],_e[1],_e[2],-Me.min],We=[...ge,0],dt=[...ve,0],rt=[];return n.y===0?rt.push(c.bt(dt,We,Ae),c.bt(dt,We,Le)):rt.push(c.bt(Ue,We,Ae),c.bt(Ue,We,Le),c.bt(Ue,dt,Ae),c.bt(Ue,dt,Le)),n.y===(1<<n.z)-1?rt.push(c.bt(dt,We,Ae),c.bt(dt,We,Le)):rt.push(c.bt(Ce,We,Ae),c.bt(Ce,We,Le),c.bt(Ce,dt,Ae),c.bt(Ce,dt,Le)),new El(rt,[Ae,Le,Ue,Ce,We,dt],X,W)}}}function ko(w,n){let u=1/0,_=-1/0;for(const b of n){const T=c.aX(w,b);u=Math.min(u,T),_=Math.max(_,T)}return{min:u,max:_}}class Ko{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(n){this._helper.setMinZoom(n)}setMaxZoom(n){this._helper.setMaxZoom(n)}setMinPitch(n){this._helper.setMinPitch(n)}setMaxPitch(n){this._helper.setMaxPitch(n)}setRenderWorldCopies(n){this._helper.setRenderWorldCopies(n)}setBearing(n){this._helper.setBearing(n)}setPitch(n){this._helper.setPitch(n)}setRoll(n){this._helper.setRoll(n)}setFov(n){this._helper.setFov(n)}setZoom(n){this._helper.setZoom(n)}setCenter(n){this._helper.setCenter(n)}setElevation(n){this._helper.setElevation(n)}setMinElevationForCurrentTile(n){this._helper.setMinElevationForCurrentTile(n)}setPadding(n){this._helper.setPadding(n)}interpolatePadding(n,u,_){return this._helper.interpolatePadding(n,u,_)}isPaddingEqual(n){return this._helper.isPaddingEqual(n)}resize(n,u){this._helper.resize(n,u)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(n){this._helper.setMaxBounds(n)}overrideNearFarZ(n,u){this._helper.overrideNearFarZ(n,u)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(n){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),n)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(n){}constructor(){this._cachedClippingPlane=c.bv(),this._projectionMatrix=c.b9(),this._globeViewProjMatrix32f=c.b8(),this._globeViewProjMatrixNoCorrection=c.b9(),this._globeViewProjMatrixNoCorrectionInverted=c.b9(),this._globeProjMatrixInverted=c.b9(),this._cameraPosition=c.bp(),this._globeLatitudeErrorCorrectionRadians=0,this._helper=new Ei({calcMatrices:()=>{this._calcMatrices()},getConstrained:(n,u)=>this.getConstrained(n,u)}),this._coveringTilesDetailsProvider=new Es}clone(){const n=new Ko;return n.apply(this),n}apply(n,u){this._globeLatitudeErrorCorrectionRadians=u||0,this._helper.apply(n)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const n=c.bp();return n[0]=this._cameraPosition[0],n[1]=this._cameraPosition[1],n[2]=this._cameraPosition[2],n}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(n){const{overscaledTileID:u,applyGlobeMatrix:_}=n,b=this._helper.getMercatorTileCoordinates(u);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:b,clippingPlane:this._cachedClippingPlane,projectionTransition:_?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(n){const u=this.pitchInRadians,_=this.cameraToCenterDistance/n,b=Math.sin(u)*_,T=Math.cos(u)*_+1,I=1/Math.sqrt(b*b+T*T)*1;let O=-b,N=T;const j=Math.sqrt(O*O+N*N);O/=j,N/=j;const $=[0,O,N];c.bw($,$,[0,0,0],-this.bearingInRadians),c.bx($,$,[0,0,0],-1*this.center.lat*Math.PI/180),c.by($,$,[0,0,0],this.center.lng*Math.PI/180);const X=1/c.aZ($);return c.aR($,$,X),[...$,-I*X]}isLocationOccluded(n){return!this.isSurfacePointVisible(Gr(n))}transformLightDirection(n){const u=this._helper._center.lng*Math.PI/180,_=this._helper._center.lat*Math.PI/180,b=Math.cos(_),T=[Math.sin(u)*b,Math.sin(_),Math.cos(u)*b],I=[T[2],0,-T[0]],O=[0,0,0];c.aW(O,I,T),c.aV(I,I),c.aV(O,O);const N=[0,0,0];return c.aV(N,[I[0]*n[0]+O[0]*n[1]+T[0]*n[2],I[1]*n[0]+O[1]*n[1]+T[1]*n[2],I[2]*n[0]+O[2]*n[1]+T[2]*n[2]]),N}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(n,u,_){const b=(function(O,N,j){const $=1/(1<<j.z);return new c.a1(O/c.$*$+j.x*$,N/c.$*$+j.y*$)})(n,u,_.canonical),T=(I=b.y,[c.bo(b.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-I*Math.PI*2))-.5*Math.PI]);var I;return this.getCircleRadiusCorrection()/Math.cos(T[1])}projectTileCoordinates(n,u,_,b){const T=_.canonical,I=ws(n,u,T.x,T.y,T.z),O=1+(b?b(n,u):0)/c.bu,N=[I[0]*O,I[1]*O,I[2]*O,1];c.aw(N,N,this._globeViewProjMatrixNoCorrection);const j=this._cachedClippingPlane,$=j[0]*I[0]+j[1]*I[1]+j[2]*I[2]+j[3]<0;return{point:new c.P(N[0]/N[3],N[1]/N[3]),signedDistanceFromCamera:N[3],isOccluded:$}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const n=Ts(this.worldSize,this.center.lat),u=c.ba(),_=c.ba();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*n),c.b4(u,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const b=this.centerOffset;u[8]=2*-b.x/this._helper._width,u[9]=2*b.y/this._helper._height,this._projectionMatrix=c.b5(u),this._globeProjMatrixInverted=c.ba(),c.aq(this._globeProjMatrixInverted,u),c.M(u,u,[0,0,-this.cameraToCenterDistance]),c.b6(u,u,this.rollInRadians),c.b7(u,u,-this.pitchInRadians),c.b6(u,u,this.bearingInRadians),c.M(u,u,[0,0,-n]);const T=c.bp();T[0]=n,T[1]=n,T[2]=n,c.b7(_,u,this.center.lat*Math.PI/180),c.bz(_,_,-this.center.lng*Math.PI/180),c.N(_,_,T),this._globeViewProjMatrixNoCorrection=_,c.b7(u,u,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),c.bz(u,u,-this.center.lng*Math.PI/180),c.N(u,u,T),this._globeViewProjMatrix32f=new Float32Array(u),this._globeViewProjMatrixNoCorrectionInverted=c.ba(),c.aq(this._globeViewProjMatrixNoCorrectionInverted,_);const I=c.bp();this._cameraPosition=c.bp(),this._cameraPosition[2]=this.cameraToCenterDistance/n,c.bw(this._cameraPosition,this._cameraPosition,I,-this.rollInRadians),c.bx(this._cameraPosition,this._cameraPosition,I,this.pitchInRadians),c.bw(this._cameraPosition,this._cameraPosition,I,-this.bearingInRadians),c.aS(this._cameraPosition,this._cameraPosition,[0,0,1]),c.bx(this._cameraPosition,this._cameraPosition,I,-this.center.lat*Math.PI/180),c.by(this._cameraPosition,this._cameraPosition,I,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(n);const O=c.b5(this._globeViewProjMatrixNoCorrectionInverted);c.N(O,O,[1,1,-1]),this._cachedFrustum=hi.fromInvProjectionMatrix(O,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(n){c.w("calculateFogMatrix is not supported on globe projection.");const u=c.ba();return c.ag(u),u}getVisibleUnwrappedCoordinates(n){return[new c.b2(0,n)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(n){n&&c.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(n,u){if(!this._globeViewProjMatrixNoCorrection)return 1;const _=Gr(n);c.aR(_,_,1+u/c.bu);const b=c.bv();return c.aw(b,[_[0],_[1],_[2],1],this._globeViewProjMatrixNoCorrection),b[2]/b[3]}populateCache(n){}getBounds(){const n=.5*this.width,u=.5*this.height,_=[new c.P(0,0),new c.P(n,0),new c.P(this.width,0),new c.P(this.width,u),new c.P(this.width,this.height),new c.P(n,this.height),new c.P(0,this.height),new c.P(0,u)],b=[];for(const X of _)b.push(this.unprojectScreenPoint(X));let T=0,I=0,O=0,N=0;const j=this.center;for(const X of b){const W=c.bA(j.lng,X.lng),ee=c.bA(j.lat,X.lat);W<I&&(I=W),W>T&&(T=W),ee<N&&(N=ee),ee>O&&(O=ee)}const $=[j.lng+I,j.lat+N,j.lng+T,j.lat+O];return this.isSurfacePointOnScreen([0,1,0])&&($[3]=90,$[0]=-180,$[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&($[1]=-90,$[0]=-180,$[2]=180),new Pi($)}getConstrained(n,u){const _=c.ah(n.lat,-c.ai,c.ai),b=c.ah(+u,this.minZoom+nr(0,_),this.maxZoom);return{center:new c.S(n.lng,_),zoom:b}}calculateCenterFromCameraLngLatAlt(n,u,_,b){return this._helper.calculateCenterFromCameraLngLatAlt(n,u,_,b)}setLocationAtPoint(n,u){const _=Gr(this.unprojectScreenPoint(u)),b=Gr(n),T=c.bp();c.bB(T);const I=c.bp();c.by(I,_,T,-this.center.lng*Math.PI/180),c.bx(I,I,T,this.center.lat*Math.PI/180);const O=b[0]*b[0]+b[2]*b[2],N=I[0]*I[0];if(O<N)return;const j=Math.sqrt(O-N),$=-j,X=c.bC(b[0],b[2],I[0],j),W=c.bC(b[0],b[2],I[0],$),ee=c.bp();c.by(ee,b,T,-X);const ae=c.bC(ee[1],ee[2],I[1],I[2]),_e=c.bp();c.by(_e,b,T,-W);const ge=c.bC(_e[1],_e[2],I[1],I[2]),ve=.5*Math.PI,Te=ae>=-ve&&ae<=ve,Me=ge>=-ve&&ge<=ve;let Ae,Le;if(Te&&Me){const dt=this.center.lng*Math.PI/180,rt=this.center.lat*Math.PI/180;c.bD(X,dt)+c.bD(ae,rt)<c.bD(W,dt)+c.bD(ge,rt)?(Ae=X,Le=ae):(Ae=W,Le=ge)}else if(Te)Ae=X,Le=ae;else{if(!Me)return;Ae=W,Le=ge}const Ue=Ae/Math.PI*180,Ce=Le/Math.PI*180,We=this.center.lat;this.setCenter(new c.S(Ue,c.ah(Ce,-90,90))),this.setZoom(this.zoom+nr(We,this.center.lat))}locationToScreenPoint(n,u){const _=Gr(n);if(u){const b=u.getElevationForLngLatZoom(n,this._helper._tileZoom);c.aR(_,_,1+b/c.bu)}return this._projectSurfacePointToScreen(_)}_projectSurfacePointToScreen(n){const u=c.bv();return c.aw(u,[...n,1],this._globeViewProjMatrixNoCorrection),u[0]/=u[3],u[1]/=u[3],new c.P((.5*u[0]+.5)*this.width,(.5*-u[1]+.5)*this.height)}screenPointToMercatorCoordinate(n,u){if(u){const _=u.pointCoordinate(n);if(_)return _}return c.a1.fromLngLat(this.unprojectScreenPoint(n))}screenPointToLocation(n,u){var _;return(_=this.screenPointToMercatorCoordinate(n,u))===null||_===void 0?void 0:_.toLngLat()}isPointOnMapSurface(n,u){const _=this._cameraPosition,b=this.getRayDirectionFromPixel(n);return!!this.rayPlanetIntersection(_,b)}getRayDirectionFromPixel(n){const u=c.bv();u[0]=n.x/this.width*2-1,u[1]=-1*(n.y/this.height*2-1),u[2]=1,u[3]=1,c.aw(u,u,this._globeViewProjMatrixNoCorrectionInverted),u[0]/=u[3],u[1]/=u[3],u[2]/=u[3];const _=c.bp();_[0]=u[0]-this._cameraPosition[0],_[1]=u[1]-this._cameraPosition[1],_[2]=u[2]-this._cameraPosition[2];const b=c.bp();return c.aV(b,_),b}isSurfacePointVisible(n){const u=this._cachedClippingPlane;return u[0]*n[0]+u[1]*n[1]+u[2]*n[2]+u[3]>=0}isSurfacePointOnScreen(n){if(!this.isSurfacePointVisible(n))return!1;const u=c.bv();return c.aw(u,[...n,1],this._globeViewProjMatrixNoCorrection),u[0]/=u[3],u[1]/=u[3],u[2]/=u[3],u[0]>-1&&u[0]<1&&u[1]>-1&&u[1]<1&&u[2]>-1&&u[2]<1}rayPlanetIntersection(n,u){const _=c.aX(n,u),b=c.bp(),T=c.bp();c.aR(T,u,_),c.aU(b,n,T);const I=1-c.aX(b,b);if(I<0)return null;const O=c.aX(n,n)-1,N=-_+(_<0?1:-1)*Math.sqrt(I),j=O/N,$=N;return{tMin:Math.min(j,$),tMax:Math.max(j,$)}}unprojectScreenPoint(n){const u=this._cameraPosition,_=this.getRayDirectionFromPixel(n),b=this.rayPlanetIntersection(u,_);if(b){const $=c.bp();c.aS($,u,[_[0]*b.tMin,_[1]*b.tMin,_[2]*b.tMin]);const X=c.bp();return c.aV(X,$),Wo(X)}const T=this._cachedClippingPlane,I=T[0]*_[0]+T[1]*_[1]+T[2]*_[2],O=-c.b1(T,u)/I,N=c.bp();if(O>0)c.aS(N,u,[_[0]*O,_[1]*O,_[2]*O]);else{const $=c.bp();c.aS($,u,[2*_[0],2*_[1],2*_[2]]);const X=c.b1(this._cachedClippingPlane,$);c.aU(N,$,[this._cachedClippingPlane[0]*X,this._cachedClippingPlane[1]*X,this._cachedClippingPlane[2]*X])}const j=(function($){const X=c.bp();return X[0]=$[0]*-$[3],X[1]=$[1]*-$[3],X[2]=$[2]*-$[3],{center:X,radius:Math.sqrt(1-$[3]*$[3])}})(T);return Wo((function($,X,W){const ee=c.bp();c.aU(ee,W,$);const ae=c.bp();return c.bq(ae,$,ee,X/c.a$(ee)),ae})(j.center,j.radius,N))}getMatrixForModel(n,u){const _=c.S.convert(n),b=1/c.bu,T=c.b9();return c.bz(T,T,_.lng/180*Math.PI),c.b7(T,T,-_.lat/180*Math.PI),c.M(T,T,[0,0,1+u/c.bu]),c.b7(T,T,.5*Math.PI),c.N(T,T,[b,b,b]),T}getProjectionDataForCustomLayer(n=!0){const u=this.getProjectionData({overscaledTileID:new c.Z(0,0,0,0,0),applyGlobeMatrix:n});return u.tileMercatorCoords=[0,0,1,1],u}getFastPathSimpleProjectionMatrix(n){}}class Yo{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(n){this._helper.setMinZoom(n)}setMaxZoom(n){this._helper.setMaxZoom(n)}setMinPitch(n){this._helper.setMinPitch(n)}setMaxPitch(n){this._helper.setMaxPitch(n)}setRenderWorldCopies(n){this._helper.setRenderWorldCopies(n)}setBearing(n){this._helper.setBearing(n)}setPitch(n){this._helper.setPitch(n)}setRoll(n){this._helper.setRoll(n)}setFov(n){this._helper.setFov(n)}setZoom(n){this._helper.setZoom(n)}setCenter(n){this._helper.setCenter(n)}setElevation(n){this._helper.setElevation(n)}setMinElevationForCurrentTile(n){this._helper.setMinElevationForCurrentTile(n)}setPadding(n){this._helper.setPadding(n)}interpolatePadding(n,u,_){return this._helper.interpolatePadding(n,u,_)}isPaddingEqual(n){return this._helper.isPaddingEqual(n)}resize(n,u,_=!0){this._helper.resize(n,u,_)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(n){this._helper.setMaxBounds(n)}overrideNearFarZ(n,u){this._helper.overrideNearFarZ(n,u)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(n){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),n)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(n,u){this._globeness=n,this._globeLatitudeErrorCorrectionRadians=u,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this._helper=new Ei({calcMatrices:()=>{this._calcMatrices()},getConstrained:(n,u)=>this.getConstrained(n,u)}),this._globeness=1,this._mercatorTransform=new bn,this._verticalPerspectiveTransform=new Ko}clone(){const n=new Yo;return n._globeness=this._globeness,n._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,n.apply(this),n}apply(n){this._helper.apply(n),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(n){const u=this._mercatorTransform.getProjectionData(n),_=this._verticalPerspectiveTransform.getProjectionData(n);return{mainMatrix:this.isGlobeRendering?_.mainMatrix:u.mainMatrix,clippingPlane:_.clippingPlane,tileMercatorCoords:_.tileMercatorCoords,projectionTransition:n.applyGlobeMatrix?this._globeness:0,fallbackMatrix:u.fallbackMatrix}}isLocationOccluded(n){return this.currentTransform.isLocationOccluded(n)}transformLightDirection(n){return this.currentTransform.transformLightDirection(n)}getPixelScale(){return c.bk(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return c.bk(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(n,u,_){const b=this._mercatorTransform.getPitchedTextCorrection(n,u,_),T=this._verticalPerspectiveTransform.getPitchedTextCorrection(n,u,_);return c.bk(b,T,this._globeness)}projectTileCoordinates(n,u,_,b){return this.currentTransform.projectTileCoordinates(n,u,_,b)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(n){return this.currentTransform.calculateFogMatrix(n)}getVisibleUnwrappedCoordinates(n){return this.currentTransform.getVisibleUnwrappedCoordinates(n)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(n){this._mercatorTransform.recalculateZoomAndCenter(n),this._verticalPerspectiveTransform.recalculateZoomAndCenter(n)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(n,u){return this.currentTransform.lngLatToCameraDepth(n,u)}populateCache(n){this._mercatorTransform.populateCache(n),this._verticalPerspectiveTransform.populateCache(n)}getBounds(){return this.currentTransform.getBounds()}getConstrained(n,u){return this.currentTransform.getConstrained(n,u)}calculateCenterFromCameraLngLatAlt(n,u,_,b){return this._helper.calculateCenterFromCameraLngLatAlt(n,u,_,b)}setLocationAtPoint(n,u){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(n,u),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(n,u),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(n,u){return this.currentTransform.locationToScreenPoint(n,u)}screenPointToMercatorCoordinate(n,u){return this.currentTransform.screenPointToMercatorCoordinate(n,u)}screenPointToLocation(n,u){return this.currentTransform.screenPointToLocation(n,u)}isPointOnMapSurface(n,u){return this.currentTransform.isPointOnMapSurface(n,u)}getRayDirectionFromPixel(n){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(n)}getMatrixForModel(n,u){return this.currentTransform.getMatrixForModel(n,u)}getProjectionDataForCustomLayer(n=!0){const u=this._mercatorTransform.getProjectionDataForCustomLayer(n);if(!this.isGlobeRendering)return u;const _=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(n);return _.fallbackMatrix=u.mainMatrix,_}getFastPathSimpleProjectionMatrix(n){return this.currentTransform.getFastPathSimpleProjectionMatrix(n)}}class Ai{get useGlobeControls(){return!0}handlePanInertia(n,u){const _=Uu(n,u);return Math.abs(_.lng-u.center.lng)>180&&(_.lng=u.center.lng+179.5*Math.sign(_.lng-u.center.lng)),{easingCenter:_,easingOffset:new c.P(0,0)}}handleMapControlsRollPitchBearingZoom(n,u){const _=n.around,b=u.screenPointToLocation(_);n.bearingDelta&&u.setBearing(u.bearing+n.bearingDelta),n.pitchDelta&&u.setPitch(u.pitch+n.pitchDelta),n.rollDelta&&u.setRoll(u.roll+n.rollDelta);const T=u.zoom;n.zoomDelta&&u.setZoom(u.zoom+n.zoomDelta);const I=u.zoom-T;if(I===0)return;const O=c.bA(u.center.lng,b.lng),N=O/(Math.abs(O/180)+1),j=c.bA(u.center.lat,b.lat),$=u.getRayDirectionFromPixel(_),X=u.cameraPosition,W=-1*c.aX(X,$),ee=c.bp();c.aS(ee,X,[$[0]*W,$[1]*W,$[2]*W]);const ae=c.aZ(ee)-1,_e=Math.exp(.5*-Math.max(ae-.3,0)),ge=Ts(u.worldSize,u.center.lat)/Math.min(u.width,u.height),ve=c.bn(ge,.9,.5,1,.25),Te=(1-c.af(-I))*Math.min(_e,ve),Me=u.center.lat,Ae=u.zoom,Le=new c.S(u.center.lng+N*Te,c.ah(u.center.lat+j*Te,-c.ai,c.ai));u.setLocationAtPoint(b,_);const Ue=u.center,Ce=c.bn(Math.abs(O),45,85,0,1),We=c.bn(ge,.75,.35,0,1),dt=Math.pow(Math.max(Ce,We),.25),rt=c.bA(Ue.lng,Le.lng),st=c.bA(Ue.lat,Le.lat);u.setCenter(new c.S(Ue.lng+rt*dt,Ue.lat+st*dt).wrap()),u.setZoom(Ae+nr(Me,u.center.lat))}handleMapControlsPan(n,u,_){if(!n.panDelta)return;const b=u.center.lat,T=u.zoom;u.setCenter(Uu(n.panDelta,u).wrap()),u.setZoom(T+nr(b,u.center.lat))}cameraForBoxAndBearing(n,u,_,b,T){const I=Br(n,u,_,b,T),O=u.left/T.width*2-1,N=(T.width-u.right)/T.width*2-1,j=u.top/T.height*-2+1,$=(T.height-u.bottom)/T.height*-2+1,X=c.bA(_.getWest(),_.getEast())<0,W=X?_.getEast():_.getWest(),ee=X?_.getWest():_.getEast(),ae=Math.max(_.getNorth(),_.getSouth()),_e=Math.min(_.getNorth(),_.getSouth()),ge=W+.5*c.bA(W,ee),ve=ae+.5*c.bA(ae,_e),Te=T.clone();Te.setCenter(I.center),Te.setBearing(I.bearing),Te.setPitch(0),Te.setRoll(0),Te.setZoom(I.zoom);const Me=Te.modelViewProjectionMatrix,Ae=[Gr(_.getNorthWest()),Gr(_.getNorthEast()),Gr(_.getSouthWest()),Gr(_.getSouthEast()),Gr(new c.S(ee,ve)),Gr(new c.S(W,ve)),Gr(new c.S(ge,ae)),Gr(new c.S(ge,_e))],Le=Gr(I.center);let Ue=Number.POSITIVE_INFINITY;for(const Ce of Ae)O<0&&(Ue=Ai.getLesserNonNegativeNonNull(Ue,Ai.solveVectorScale(Ce,Le,Me,"x",O))),N>0&&(Ue=Ai.getLesserNonNegativeNonNull(Ue,Ai.solveVectorScale(Ce,Le,Me,"x",N))),j>0&&(Ue=Ai.getLesserNonNegativeNonNull(Ue,Ai.solveVectorScale(Ce,Le,Me,"y",j))),$<0&&(Ue=Ai.getLesserNonNegativeNonNull(Ue,Ai.solveVectorScale(Ce,Le,Me,"y",$)));if(Number.isFinite(Ue)&&Ue!==0)return I.zoom=Te.zoom+c.ak(Ue),I;Aa()}handleJumpToCenterZoom(n,u){const _=n.center.lat,b=n.getConstrained(u.center?c.S.convert(u.center):n.center,n.zoom).center;n.setCenter(b.wrap());const T=u.zoom!==void 0?+u.zoom:n.zoom+nr(_,b.lat);n.zoom!==T&&n.setZoom(T)}handleEaseTo(n,u){const _=n.zoom,b=n.center,T=n.padding,I={roll:n.roll,pitch:n.pitch,bearing:n.bearing},O={roll:u.roll===void 0?n.roll:u.roll,pitch:u.pitch===void 0?n.pitch:u.pitch,bearing:u.bearing===void 0?n.bearing:u.bearing},N=u.zoom!==void 0,j=!n.isPaddingEqual(u.padding);let $=!1;const X=u.center?c.S.convert(u.center):b,W=n.getConstrained(X,_).center;Mo(n,W);const ee=n.clone();ee.setCenter(W),ee.setZoom(N?+u.zoom:_+nr(b.lat,X.lat)),ee.setBearing(u.bearing);const ae=new c.P(c.ah(n.centerPoint.x+u.offsetAsPoint.x,0,n.width),c.ah(n.centerPoint.y+u.offsetAsPoint.y,0,n.height));ee.setLocationAtPoint(W,ae);const _e=(u.offset&&u.offsetAsPoint.mag())>0?ee.center:W,ge=N?+u.zoom:_+nr(b.lat,_e.lat),ve=_+nr(b.lat,0),Te=ge+nr(_e.lat,0),Me=c.bA(b.lng,_e.lng),Ae=c.bA(b.lat,_e.lat),Le=c.af(Te-ve);return $=ge!==_,{easeFunc:Ue=>{if(c.be(I,O)||or({startEulerAngles:I,endEulerAngles:O,tr:n,k:Ue,useSlerp:I.roll!=O.roll}),j&&n.interpolatePadding(T,u.padding,Ue),u.around)c.w("Easing around a point is not supported under globe projection."),n.setLocationAtPoint(u.around,u.aroundPoint);else{const Ce=Te>ve?Math.min(2,Le):Math.max(.5,Le),We=Math.pow(Ce,1-Ue),dt=Hl(b,Me,Ae,Ue*We);n.setCenter(dt.wrap())}if($){const Ce=c.C.number(ve,Te,Ue)+nr(0,n.center.lat);n.setZoom(Ce)}},isZooming:$,elevationCenter:_e}}handleFlyTo(n,u){const _=u.zoom!==void 0,b=n.center,T=n.zoom,I=n.padding,O=!n.isPaddingEqual(u.padding),N=n.getConstrained(c.S.convert(u.center||u.locationAtOffset),T).center,j=_?+u.zoom:n.zoom+nr(n.center.lat,N.lat),$=n.clone();$.setCenter(N),$.setZoom(j),$.setBearing(u.bearing);const X=new c.P(c.ah(n.centerPoint.x+u.offsetAsPoint.x,0,n.width),c.ah(n.centerPoint.y+u.offsetAsPoint.y,0,n.height));$.setLocationAtPoint(N,X);const W=$.center;Mo(n,W);const ee=(function(Ae,Le,Ue){const Ce=Gr(Le),We=Gr(Ue),dt=c.aX(Ce,We),rt=Math.acos(dt),st=xs(Ae);return rt/(2*Math.PI)*st})(n,b,W),ae=T+nr(b.lat,0),_e=j+nr(W.lat,0),ge=c.af(_e-ae);let ve;if(typeof u.minZoom=="number"){const Ae=+u.minZoom+nr(W.lat,0),Le=Math.min(Ae,ae,_e)+nr(0,W.lat),Ue=n.getConstrained(W,Le).zoom+nr(W.lat,0);ve=c.af(Ue-ae)}const Te=c.bA(b.lng,W.lng),Me=c.bA(b.lat,W.lat);return{easeFunc:(Ae,Le,Ue,Ce)=>{const We=Hl(b,Te,Me,Ue);O&&n.interpolatePadding(I,u.padding,Ae);const dt=Ae===1?W:We;n.setCenter(dt.wrap());const rt=ae+c.ak(Le);n.setZoom(Ae===1?j:rt+nr(0,dt.lat))},scaleOfZoom:ge,targetCenter:W,scaleOfMinZoom:ve,pixelPathLength:ee}}static solveVectorScale(n,u,_,b,T){const I=b==="x"?[_[0],_[4],_[8],_[12]]:[_[1],_[5],_[9],_[13]],O=[_[3],_[7],_[11],_[15]],N=n[0]*I[0]+n[1]*I[1]+n[2]*I[2],j=n[0]*O[0]+n[1]*O[1]+n[2]*O[2],$=u[0]*I[0]+u[1]*I[1]+u[2]*I[2],X=u[0]*O[0]+u[1]*O[1]+u[2]*O[2];return $+T*j===N+T*X||O[3]*(N-$)+I[3]*(X-j)+N*X==$*j?null:($+I[3]-T*X-T*O[3])/($-N-T*X+T*j)}static getLesserNonNegativeNonNull(n,u){return u!==null&&u>=0&&u<n?u:n}}class hu{constructor(n){this._globe=n,this._mercatorCameraHelper=new Oi,this._verticalPerspectiveCameraHelper=new Ai}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(n,u){return this.currentHelper.handlePanInertia(n,u)}handleMapControlsRollPitchBearingZoom(n,u){return this.currentHelper.handleMapControlsRollPitchBearingZoom(n,u)}handleMapControlsPan(n,u,_){this.currentHelper.handleMapControlsPan(n,u,_)}cameraForBoxAndBearing(n,u,_,b,T){return this.currentHelper.cameraForBoxAndBearing(n,u,_,b,T)}handleJumpToCenterZoom(n,u){this.currentHelper.handleJumpToCenterZoom(n,u)}handleEaseTo(n,u){return this.currentHelper.handleEaseTo(n,u)}handleFlyTo(n,u){return this.currentHelper.handleFlyTo(n,u)}}const du=(w,n)=>c.y(w,n&&n.filter((u=>u.identifier!=="source.canvas"))),Wl=c.bE();class M extends c.E{constructor(n,u={}){super(),this._rtlPluginLoaded=()=>{for(const _ in this.sourceCaches){const b=this.sourceCaches[_].getSource().type;b!=="vector"&&b!=="geojson"||this.sourceCaches[_].reload()}},this.map=n,this.dispatcher=new Ft(an(),n._getMapId()),this.dispatcher.registerMessageHandler("GG",((_,b)=>this.getGlyphs(_,b))),this.dispatcher.registerMessageHandler("GI",((_,b)=>this.getImages(_,b))),this.imageManager=new me,this.imageManager.setEventedParent(this),this.glyphManager=new ke(n._requestManager,u.localIdeographFontFamily),this.lineAtlas=new jt(256,512),this.crossTileSymbolIndex=new Ya,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new c.bF,this._loaded=!1,this._availableImages=[],this._globalState={},this._resetUpdates(),this.dispatcher.broadcast("SR",c.bG()),pr().on(Tl,this._rtlPluginLoaded),this.on("data",(_=>{if(_.dataType!=="source"||_.sourceDataType!=="metadata")return;const b=this.sourceCaches[_.sourceId];if(!b)return;const T=b.getSource();if(T&&T.vectorLayerIds)for(const I in this._layers){const O=this._layers[I];O.source===T.id&&this._validateLayer(O)}}))}setGlobalStateProperty(n,u){var _,b,T;this._checkLoaded();const I=u===null?(T=(b=(_=this.stylesheet.state)===null||_===void 0?void 0:_[n])===null||b===void 0?void 0:b.default)!==null&&T!==void 0?T:null:u;if(c.bH(I,this._globalState[n]))return this;this._globalState[n]=I;const O=this._findGlobalStateAffectedSources([n]);for(const N in this.sourceCaches)O.has(N)&&(this._reloadSource(N),this._changed=!0)}getGlobalState(){return this._globalState}setGlobalState(n){this._checkLoaded();const u=[];for(const b in n)!c.bH(this._globalState[b],n[b].default)&&(u.push(b),this._globalState[b]=n[b].default);const _=this._findGlobalStateAffectedSources(u);for(const b in this.sourceCaches)_.has(b)&&(this._reloadSource(b),this._changed=!0)}_findGlobalStateAffectedSources(n){if(n.length===0)return new Set;const u=new Set;for(const _ in this._layers){const b=this._layers[_],T=b.getLayoutAffectingGlobalStateRefs();for(const I of n)T.has(I)&&u.add(b.source)}return u}loadURL(n,u={},_){this.fire(new c.l("dataloading",{dataType:"style"})),u.validate=typeof u.validate!="boolean"||u.validate;const b=this.map._requestManager.transformRequest(n,"Style");this._loadStyleRequest=new AbortController;const T=this._loadStyleRequest;c.j(b,this._loadStyleRequest).then((I=>{this._loadStyleRequest=null,this._load(I.data,u,_)})).catch((I=>{this._loadStyleRequest=null,I&&!T.signal.aborted&&this.fire(new c.k(I))}))}loadJSON(n,u={},_){this.fire(new c.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,Y.frameAsync(this._frameRequest).then((()=>{this._frameRequest=null,u.validate=u.validate!==!1,this._load(n,u,_)})).catch((()=>{}))}loadEmpty(){this.fire(new c.l("dataloading",{dataType:"style"})),this._load(Wl,{validate:!1})}_load(n,u,_){var b,T,I;const O=u.transformStyle?u.transformStyle(_,n):n;if(!u.validate||!du(this,c.z(O))){this._loaded=!0,this.stylesheet=O;for(const N in O.sources)this.addSource(N,O.sources[N],{validate:!1});O.sprite?this._loadSprite(O.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(O.glyphs),this._createLayers(),this.light=new gt(this.stylesheet.light),this._setProjectionInternal(((b=this.stylesheet.projection)===null||b===void 0?void 0:b.type)||"mercator"),this.sky=new xt(this.stylesheet.sky),this.map.setTerrain((T=this.stylesheet.terrain)!==null&&T!==void 0?T:null),this.setGlobalState((I=this.stylesheet.state)!==null&&I!==void 0?I:null),this.fire(new c.l("data",{dataType:"style"})),this.fire(new c.l("style.load"))}}_createLayers(){const n=c.bI(this.stylesheet.layers);this.dispatcher.broadcast("SL",n),this._order=n.map((u=>u.id)),this._layers={},this._serializedLayers=null;for(const u of n){const _=c.bJ(u);_.setEventedParent(this,{layer:{id:u.id}}),this._layers[u.id]=_}}_loadSprite(n,u=!1,_=void 0){let b;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,(function(T,I,O,N){return c._(this,void 0,void 0,(function*(){const j=it(T),$=O>1?"@2x":"",X={},W={};for(const{id:ee,url:ae}of j){const _e=I.transformRequest(de(ae,$,".json"),"SpriteJSON");X[ee]=c.j(_e,N);const ge=I.transformRequest(de(ae,$,".png"),"SpriteImage");W[ee]=Ke.getImage(ge,N)}return yield Promise.all([...Object.values(X),...Object.values(W)]),(function(ee,ae){return c._(this,void 0,void 0,(function*(){const _e={};for(const ge in ee){_e[ge]={};const ve=Y.getImageCanvasContext((yield ae[ge]).data),Te=(yield ee[ge]).data;for(const Me in Te){const{width:Ae,height:Le,x:Ue,y:Ce,sdf:We,pixelRatio:dt,stretchX:rt,stretchY:st,content:ct,textFitWidth:Ot,textFitHeight:Bt}=Te[Me];_e[ge][Me]={data:null,pixelRatio:dt,sdf:We,stretchX:rt,stretchY:st,content:ct,textFitWidth:Ot,textFitHeight:Bt,spriteData:{width:Ae,height:Le,x:Ue,y:Ce,context:ve}}}}return _e}))})(X,W)}))})(n,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then((T=>{if(this._spriteRequest=null,T)for(const I in T){this._spritesImagesIds[I]=[];const O=this._spritesImagesIds[I]?this._spritesImagesIds[I].filter((N=>!(N in T))):[];for(const N of O)this.imageManager.removeImage(N),this._changedImages[N]=!0;for(const N in T[I]){const j=I==="default"?N:`${I}:${N}`;this._spritesImagesIds[I].push(j),j in this.imageManager.images?this.imageManager.updateImage(j,T[I][N],!1):this.imageManager.addImage(j,T[I][N]),u&&(this._changedImages[j]=!0)}}})).catch((T=>{this._spriteRequest=null,b=T,this.fire(new c.k(b))})).finally((()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),u&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.l("data",{dataType:"style"})),_&&_(b)}))}_unloadSprite(){for(const n of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(n),this._changedImages[n]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.l("data",{dataType:"style"}))}_validateLayer(n){const u=this.sourceCaches[n.source];if(!u)return;const _=n.sourceLayer;if(!_)return;const b=u.getSource();(b.type==="geojson"||b.vectorLayerIds&&b.vectorLayerIds.indexOf(_)===-1)&&this.fire(new c.k(new Error(`Source layer "${_}" does not exist on source "${b.id}" as specified by style layer "${n.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const n in this.sourceCaches)if(!this.sourceCaches[n].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(n,u=!1){const _=this._serializedAllLayers();if(!n||n.length===0)return Object.values(u?c.bK(_):_);const b=[];for(const T of n)if(_[T]){const I=u?c.bK(_[T]):_[T];b.push(I)}return b}_serializedAllLayers(){let n=this._serializedLayers;if(n)return n;n=this._serializedLayers={};const u=Object.keys(this._layers);for(const _ of u){const b=this._layers[_];b.type!=="custom"&&(n[_]=b.serialize())}return n}hasTransitions(){var n,u,_;if(!((n=this.light)===null||n===void 0)&&n.hasTransition()||!((u=this.sky)===null||u===void 0)&&u.hasTransition()||!((_=this.projection)===null||_===void 0)&&_.hasTransition())return!0;for(const b in this.sourceCaches)if(this.sourceCaches[b].hasTransition())return!0;for(const b in this._layers)if(this._layers[b].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(n){if(!this._loaded)return;const u=this._changed;if(u){const b=Object.keys(this._updatedLayers),T=Object.keys(this._removedLayers);(b.length||T.length)&&this._updateWorkerLayers(b,T);for(const I in this._updatedSources){const O=this._updatedSources[I];if(O==="reload")this._reloadSource(I);else{if(O!=="clear")throw new Error(`Invalid action ${O}`);this._clearSource(I)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const I in this._updatedPaintProps)this._layers[I].updateTransitions(n);this.light.updateTransitions(n),this.sky.updateTransitions(n),this._resetUpdates()}const _={};for(const b in this.sourceCaches){const T=this.sourceCaches[b];_[b]=T.used,T.used=!1}for(const b of this._order){const T=this._layers[b];T.recalculate(n,this._availableImages),!T.isHidden(n.zoom)&&T.source&&(this.sourceCaches[T.source].used=!0)}for(const b in _){const T=this.sourceCaches[b];!!_[b]!=!!T.used&&T.fire(new c.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:b}))}this.light.recalculate(n),this.sky.recalculate(n),this.projection.recalculate(n),this.z=n.zoom,u&&this.fire(new c.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const n=Object.keys(this._changedImages);if(n.length){for(const u in this.sourceCaches)this.sourceCaches[u].reloadTilesForDependencies(["icons","patterns"],n);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const n in this.sourceCaches)this.sourceCaches[n].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(n,u){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(n,!1),removedIds:u})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(n,u={}){var _;this._checkLoaded();const b=this.serialize();if(n=u.transformStyle?u.transformStyle(b,n):n,((_=u.validate)===null||_===void 0||_)&&du(this,c.z(n)))return!1;(n=c.bK(n)).layers=c.bI(n.layers);const T=c.bL(b,n),I=this._getOperationsToPerform(T);if(I.unimplemented.length>0)throw new Error(`Unimplemented: ${I.unimplemented.join(", ")}.`);if(I.operations.length===0)return!1;for(const O of I.operations)O();return this.stylesheet=n,this._serializedLayers=null,!0}_getOperationsToPerform(n){const u=[],_=[];for(const b of n)switch(b.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":u.push((()=>this.addLayer.apply(this,b.args)));break;case"removeLayer":u.push((()=>this.removeLayer.apply(this,b.args)));break;case"setPaintProperty":u.push((()=>this.setPaintProperty.apply(this,b.args)));break;case"setLayoutProperty":u.push((()=>this.setLayoutProperty.apply(this,b.args)));break;case"setFilter":u.push((()=>this.setFilter.apply(this,b.args)));break;case"addSource":u.push((()=>this.addSource.apply(this,b.args)));break;case"removeSource":u.push((()=>this.removeSource.apply(this,b.args)));break;case"setLayerZoomRange":u.push((()=>this.setLayerZoomRange.apply(this,b.args)));break;case"setLight":u.push((()=>this.setLight.apply(this,b.args)));break;case"setGeoJSONSourceData":u.push((()=>this.setGeoJSONSourceData.apply(this,b.args)));break;case"setGlyphs":u.push((()=>this.setGlyphs.apply(this,b.args)));break;case"setSprite":u.push((()=>this.setSprite.apply(this,b.args)));break;case"setTerrain":u.push((()=>this.map.setTerrain.apply(this,b.args)));break;case"setSky":u.push((()=>this.setSky.apply(this,b.args)));break;case"setProjection":this.setProjection.apply(this,b.args);break;case"setGlobalState":u.push((()=>this.setGlobalState.apply(this,b.args)));break;case"setTransition":u.push((()=>{}));break;default:_.push(b.command)}return{operations:u,unimplemented:_}}addImage(n,u){if(this.getImage(n))return this.fire(new c.k(new Error(`An image named "${n}" already exists.`)));this.imageManager.addImage(n,u),this._afterImageUpdated(n)}updateImage(n,u){this.imageManager.updateImage(n,u)}getImage(n){return this.imageManager.getImage(n)}removeImage(n){if(!this.getImage(n))return this.fire(new c.k(new Error(`An image named "${n}" does not exist.`)));this.imageManager.removeImage(n),this._afterImageUpdated(n)}_afterImageUpdated(n){this._availableImages=this.imageManager.listImages(),this._changedImages[n]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(n,u,_={}){if(this._checkLoaded(),this.sourceCaches[n]!==void 0)throw new Error(`Source "${n}" already exists.`);if(!u.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(u).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(u.type)>=0&&this._validate(c.z.source,`sources.${n}`,u,null,_))return;this.map&&this.map._collectResourceTiming&&(u.collectResourceTiming=!0);const b=this.sourceCaches[n]=new Fn(n,u,this.dispatcher);b.style=this,b.setEventedParent(this,(()=>({isSourceLoaded:b.loaded(),source:b.serialize(),sourceId:n}))),b.onAdd(this.map),this._changed=!0}removeSource(n){if(this._checkLoaded(),this.sourceCaches[n]===void 0)throw new Error("There is no source with this ID");for(const _ in this._layers)if(this._layers[_].source===n)return this.fire(new c.k(new Error(`Source "${n}" cannot be removed while layer "${_}" is using it.`)));const u=this.sourceCaches[n];delete this.sourceCaches[n],delete this._updatedSources[n],u.fire(new c.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:n})),u.setEventedParent(null),u.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(n,u){if(this._checkLoaded(),this.sourceCaches[n]===void 0)throw new Error(`There is no source with this ID=${n}`);const _=this.sourceCaches[n].getSource();if(_.type!=="geojson")throw new Error(`geojsonSource.type is ${_.type}, which is !== 'geojson`);_.setData(u),this._changed=!0}getSource(n){return this.sourceCaches[n]&&this.sourceCaches[n].getSource()}addLayer(n,u,_={}){this._checkLoaded();const b=n.id;if(this.getLayer(b))return void this.fire(new c.k(new Error(`Layer "${b}" already exists on this map.`)));let T;if(n.type==="custom"){if(du(this,c.bM(n)))return;T=c.bJ(n)}else{if("source"in n&&typeof n.source=="object"&&(this.addSource(b,n.source),n=c.bK(n),n=c.e(n,{source:b})),this._validate(c.z.layer,`layers.${b}`,n,{arrayIndex:-1},_))return;T=c.bJ(n),this._validateLayer(T),T.setEventedParent(this,{layer:{id:b}})}const I=u?this._order.indexOf(u):this._order.length;if(u&&I===-1)this.fire(new c.k(new Error(`Cannot add layer "${b}" before non-existing layer "${u}".`)));else{if(this._order.splice(I,0,b),this._layerOrderChanged=!0,this._layers[b]=T,this._removedLayers[b]&&T.source&&T.type!=="custom"){const O=this._removedLayers[b];delete this._removedLayers[b],O.type!==T.type?this._updatedSources[T.source]="clear":(this._updatedSources[T.source]="reload",this.sourceCaches[T.source].pause())}this._updateLayer(T),T.onAdd&&T.onAdd(this.map)}}moveLayer(n,u){if(this._checkLoaded(),this._changed=!0,!this._layers[n])return void this.fire(new c.k(new Error(`The layer '${n}' does not exist in the map's style and cannot be moved.`)));if(n===u)return;const _=this._order.indexOf(n);this._order.splice(_,1);const b=u?this._order.indexOf(u):this._order.length;u&&b===-1?this.fire(new c.k(new Error(`Cannot move layer "${n}" before non-existing layer "${u}".`))):(this._order.splice(b,0,n),this._layerOrderChanged=!0)}removeLayer(n){this._checkLoaded();const u=this._layers[n];if(!u)return void this.fire(new c.k(new Error(`Cannot remove non-existing layer "${n}".`)));u.setEventedParent(null);const _=this._order.indexOf(n);this._order.splice(_,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[n]=u,delete this._layers[n],this._serializedLayers&&delete this._serializedLayers[n],delete this._updatedLayers[n],delete this._updatedPaintProps[n],u.onRemove&&u.onRemove(this.map)}getLayer(n){return this._layers[n]}getLayersOrder(){return[...this._order]}hasLayer(n){return n in this._layers}setLayerZoomRange(n,u,_){this._checkLoaded();const b=this.getLayer(n);b?b.minzoom===u&&b.maxzoom===_||(u!=null&&(b.minzoom=u),_!=null&&(b.maxzoom=_),this._updateLayer(b)):this.fire(new c.k(new Error(`Cannot set the zoom range of non-existing layer "${n}".`)))}setFilter(n,u,_={}){this._checkLoaded();const b=this.getLayer(n);if(b){if(!c.bH(b.filter,u))return u==null?(b.setFilter(void 0),void this._updateLayer(b)):void(this._validate(c.z.filter,`layers.${b.id}.filter`,u,null,_)||(b.setFilter(c.bK(u)),this._updateLayer(b)))}else this.fire(new c.k(new Error(`Cannot filter non-existing layer "${n}".`)))}getFilter(n){return c.bK(this.getLayer(n).filter)}setLayoutProperty(n,u,_,b={}){this._checkLoaded();const T=this.getLayer(n);T?c.bH(T.getLayoutProperty(u),_)||(T.setLayoutProperty(u,_,b),this._updateLayer(T)):this.fire(new c.k(new Error(`Cannot style non-existing layer "${n}".`)))}getLayoutProperty(n,u){const _=this.getLayer(n);if(_)return _.getLayoutProperty(u);this.fire(new c.k(new Error(`Cannot get style of non-existing layer "${n}".`)))}setPaintProperty(n,u,_,b={}){this._checkLoaded();const T=this.getLayer(n);T?c.bH(T.getPaintProperty(u),_)||(T.setPaintProperty(u,_,b)&&this._updateLayer(T),this._changed=!0,this._updatedPaintProps[n]=!0,this._serializedLayers=null):this.fire(new c.k(new Error(`Cannot style non-existing layer "${n}".`)))}getPaintProperty(n,u){return this.getLayer(n).getPaintProperty(u)}setFeatureState(n,u){this._checkLoaded();const _=n.source,b=n.sourceLayer,T=this.sourceCaches[_];if(T===void 0)return void this.fire(new c.k(new Error(`The source '${_}' does not exist in the map's style.`)));const I=T.getSource().type;I==="geojson"&&b?this.fire(new c.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):I!=="vector"||b?(n.id===void 0&&this.fire(new c.k(new Error("The feature id parameter must be provided."))),T.setFeatureState(b,n.id,u)):this.fire(new c.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(n,u){this._checkLoaded();const _=n.source,b=this.sourceCaches[_];if(b===void 0)return void this.fire(new c.k(new Error(`The source '${_}' does not exist in the map's style.`)));const T=b.getSource().type,I=T==="vector"?n.sourceLayer:void 0;T!=="vector"||I?u&&typeof n.id!="string"&&typeof n.id!="number"?this.fire(new c.k(new Error("A feature id is required to remove its specific state property."))):b.removeFeatureState(I,n.id,u):this.fire(new c.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(n){this._checkLoaded();const u=n.source,_=n.sourceLayer,b=this.sourceCaches[u];if(b!==void 0)return b.getSource().type!=="vector"||_?(n.id===void 0&&this.fire(new c.k(new Error("The feature id parameter must be provided."))),b.getFeatureState(_,n.id)):void this.fire(new c.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new c.k(new Error(`The source '${u}' does not exist in the map's style.`)))}getTransition(){return c.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const n=c.bN(this.sourceCaches,(T=>T.serialize())),u=this._serializeByIds(this._order,!0),_=this.map.getTerrain()||void 0,b=this.stylesheet;return c.bO({version:b.version,name:b.name,metadata:b.metadata,light:b.light,sky:b.sky,center:b.center,zoom:b.zoom,bearing:b.bearing,pitch:b.pitch,sprite:b.sprite,glyphs:b.glyphs,transition:b.transition,projection:b.projection,sources:n,layers:u,terrain:_},(T=>T!==void 0))}_updateLayer(n){this._updatedLayers[n.id]=!0,n.source&&!this._updatedSources[n.source]&&this.sourceCaches[n.source].getSource().type!=="raster"&&(this._updatedSources[n.source]="reload",this.sourceCaches[n.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(n){const u=I=>this._layers[I].type==="fill-extrusion",_={},b=[];for(let I=this._order.length-1;I>=0;I--){const O=this._order[I];if(u(O)){_[O]=I;for(const N of n){const j=N[O];if(j)for(const $ of j)b.push($)}}}b.sort(((I,O)=>O.intersectionZ-I.intersectionZ));const T=[];for(let I=this._order.length-1;I>=0;I--){const O=this._order[I];if(u(O))for(let N=b.length-1;N>=0;N--){const j=b[N].feature;if(_[j.layer.id]<I)break;T.push(j),b.pop()}else for(const N of n){const j=N[O];if(j)for(const $ of j)T.push($.feature)}}return T}queryRenderedFeatures(n,u,_){u&&u.filter&&this._validate(c.z.filter,"queryRenderedFeatures.filter",u.filter,null,u);const b={};if(u&&u.layers){if(!(Array.isArray(u.layers)||u.layers instanceof Set))return this.fire(new c.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const j of u.layers){const $=this._layers[j];if(!$)return this.fire(new c.k(new Error(`The layer '${j}' does not exist in the map's style and cannot be queried for features.`))),[];b[$.source]=!0}}const T=[];u.availableImages=this._availableImages;const I=this._serializedAllLayers(),O=u.layers instanceof Set?u.layers:Array.isArray(u.layers)?new Set(u.layers):null,N=Object.assign(Object.assign({},u),{layers:O});for(const j in this.sourceCaches)u.layers&&!b[j]||T.push(zr(this.sourceCaches[j],this._layers,I,n,N,_,this.map.terrain?($,X,W)=>this.map.terrain.getElevation($,X,W):void 0));return this.placement&&T.push((function(j,$,X,W,ee,ae,_e){const ge={},ve=ae.queryRenderedSymbols(W),Te=[];for(const Me of Object.keys(ve).map(Number))Te.push(_e[Me]);Te.sort(co);for(const Me of Te){const Ae=Me.featureIndex.lookupSymbolFeatures(ve[Me.bucketInstanceId],$,Me.bucketIndex,Me.sourceLayerIndex,ee.filter,ee.layers,ee.availableImages,j);for(const Le in Ae){const Ue=ge[Le]=ge[Le]||[],Ce=Ae[Le];Ce.sort(((We,dt)=>{const rt=Me.featureSortOrder;if(rt){const st=rt.indexOf(We.featureIndex);return rt.indexOf(dt.featureIndex)-st}return dt.featureIndex-We.featureIndex}));for(const We of Ce)Ue.push(We)}}return(function(Me,Ae,Le){for(const Ue in Me)for(const Ce of Me[Ue])Us(Ce,Le[Ae[Ue].source]);return Me})(ge,j,X)})(this._layers,I,this.sourceCaches,n,N,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(T)}querySourceFeatures(n,u){u&&u.filter&&this._validate(c.z.filter,"querySourceFeatures.filter",u.filter,null,u);const _=this.sourceCaches[n];return _?(function(b,T){const I=b.getRenderableIds().map((j=>b.getTileByID(j))),O=[],N={};for(let j=0;j<I.length;j++){const $=I[j],X=$.tileID.canonical.key;N[X]||(N[X]=!0,$.querySourceFeatures(O,T))}return O})(_,u):[]}getLight(){return this.light.getLight()}setLight(n,u={}){this._checkLoaded();const _=this.light.getLight();let b=!1;for(const I in n)if(!c.bH(n[I],_[I])){b=!0;break}if(!b)return;const T={now:Y.now(),transition:c.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(n,u),this.light.updateTransitions(T)}getProjection(){var n;return(n=this.stylesheet)===null||n===void 0?void 0:n.projection}setProjection(n){if(this._checkLoaded(),this.projection){if(this.projection.name===n.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=n,this._setProjectionInternal(n.type)}getSky(){var n;return(n=this.stylesheet)===null||n===void 0?void 0:n.sky}setSky(n,u={}){this._checkLoaded();const _=this.getSky();let b=!1;if(!n&&!_)return;if(n&&!_)b=!0;else if(!n&&_)b=!0;else for(const I in n)if(!c.bH(n[I],_[I])){b=!0;break}if(!b)return;const T={now:Y.now(),transition:c.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=n,this.sky.setSky(n,u),this.sky.updateTransitions(T)}_setProjectionInternal(n){const u=(function(_){if(Array.isArray(_)){const b=new Kr({type:_});return{projection:b,transform:new Yo,cameraHelper:new hu(b)}}switch(_){case"mercator":return{projection:new Mn,transform:new bn,cameraHelper:new Oi};case"globe":{const b=new Kr({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:b,transform:new Yo,cameraHelper:new hu(b)}}case"vertical-perspective":return{projection:new Xn,transform:new Ko,cameraHelper:new Ai};default:return c.w(`Unknown projection name: ${_}. Falling back to mercator projection.`),{projection:new Mn,transform:new bn,cameraHelper:new Oi}}})(n);this.projection=u.projection,this.map.migrateProjection(u.transform,u.cameraHelper);for(const _ in this.sourceCaches)this.sourceCaches[_].reload()}_validate(n,u,_,b,T={}){return(!T||T.validate!==!1)&&du(this,n.call(c.z,c.e({key:u,style:this.serialize(),value:_,styleSpec:c.v},b)))}_remove(n=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),pr().off(Tl,this._rtlPluginLoaded);for(const u in this._layers)this._layers[u].setEventedParent(null);for(const u in this.sourceCaches){const _=this.sourceCaches[u];_.setEventedParent(null),_.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),n&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(n)}_clearSource(n){this.sourceCaches[n].clearTiles()}_reloadSource(n){this.sourceCaches[n].resume(),this.sourceCaches[n].reload()}_updateSources(n){for(const u in this.sourceCaches)this.sourceCaches[u].update(n,this.map.terrain)}_generateCollisionBoxes(){for(const n in this.sourceCaches)this._reloadSource(n)}_updatePlacement(n,u,_,b,T=!1){let I=!1,O=!1;const N={};for(const j of this._order){const $=this._layers[j];if($.type!=="symbol")continue;if(!N[$.source]){const W=this.sourceCaches[$.source];N[$.source]=W.getRenderableIds(!0).map((ee=>W.getTileByID(ee))).sort(((ee,ae)=>ae.tileID.overscaledZ-ee.tileID.overscaledZ||(ee.tileID.isLessThan(ae.tileID)?-1:1)))}const X=this.crossTileSymbolIndex.addLayer($,N[$.source],n.center.lng);I=I||X}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((T=T||this._layerOrderChanged||_===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(Y.now(),n.zoom))&&(this.pauseablePlacement=new ga(n,this.map.terrain,this._order,T,u,_,b,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,N),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(Y.now()),O=!0),I&&this.pauseablePlacement.placement.setStale()),O||I)for(const j of this._order){const $=this._layers[j];$.type==="symbol"&&this.placement.updateLayerOpacities($,N[$.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(Y.now())}_releaseSymbolFadeTiles(){for(const n in this.sourceCaches)this.sourceCaches[n].releaseSymbolFadeTiles()}getImages(n,u){return c._(this,void 0,void 0,(function*(){const _=yield this.imageManager.getImages(u.icons);this._updateTilesForChangedImages();const b=this.sourceCaches[u.source];return b&&b.setDependencies(u.tileID.key,u.type,u.icons),_}))}getGlyphs(n,u){return c._(this,void 0,void 0,(function*(){const _=yield this.glyphManager.getGlyphs(u.stacks),b=this.sourceCaches[u.source];return b&&b.setDependencies(u.tileID.key,u.type,[""]),_}))}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(n,u={}){this._checkLoaded(),n&&this._validate(c.z.glyphs,"glyphs",n,null,u)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=n,this.glyphManager.entries={},this.glyphManager.setURL(n))}addSprite(n,u,_={},b){this._checkLoaded();const T=[{id:n,url:u}],I=[...it(this.stylesheet.sprite),...T];this._validate(c.z.sprite,"sprite",I,null,_)||(this.stylesheet.sprite=I,this._loadSprite(T,!0,b))}removeSprite(n){this._checkLoaded();const u=it(this.stylesheet.sprite);if(u.find((_=>_.id===n))){if(this._spritesImagesIds[n])for(const _ of this._spritesImagesIds[n])this.imageManager.removeImage(_),this._changedImages[_]=!0;u.splice(u.findIndex((_=>_.id===n)),1),this.stylesheet.sprite=u.length>0?u:void 0,delete this._spritesImagesIds[n],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.l("data",{dataType:"style"}))}else this.fire(new c.k(new Error(`Sprite "${n}" doesn't exists on this map.`)))}getSprite(){return it(this.stylesheet.sprite)}setSprite(n,u={},_){this._checkLoaded(),n&&this._validate(c.z.sprite,"sprite",n,null,u)||(this.stylesheet.sprite=n,n?this._loadSprite(n,!0,_):(this._unloadSprite(),_&&_(null)))}}var G=c.aJ([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class te{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(n,u,_,b,T,I,O,N,j){this.context=n;let $=this.boundPaintVertexBuffers.length!==b.length;for(let X=0;!$&&X<b.length;X++)this.boundPaintVertexBuffers[X]!==b[X]&&($=!0);!this.vao||this.boundProgram!==u||this.boundLayoutVertexBuffer!==_||$||this.boundIndexBuffer!==T||this.boundVertexOffset!==I||this.boundDynamicVertexBuffer!==O||this.boundDynamicVertexBuffer2!==N||this.boundDynamicVertexBuffer3!==j?this.freshBind(u,_,b,T,I,O,N,j):(n.bindVertexArray.set(this.vao),O&&O.bind(),T&&T.dynamicDraw&&T.bind(),N&&N.bind(),j&&j.bind())}freshBind(n,u,_,b,T,I,O,N){const j=n.numAttributes,$=this.context,X=$.gl;this.vao&&this.destroy(),this.vao=$.createVertexArray(),$.bindVertexArray.set(this.vao),this.boundProgram=n,this.boundLayoutVertexBuffer=u,this.boundPaintVertexBuffers=_,this.boundIndexBuffer=b,this.boundVertexOffset=T,this.boundDynamicVertexBuffer=I,this.boundDynamicVertexBuffer2=O,this.boundDynamicVertexBuffer3=N,u.enableAttributes(X,n);for(const W of _)W.enableAttributes(X,n);I&&I.enableAttributes(X,n),O&&O.enableAttributes(X,n),N&&N.enableAttributes(X,n),u.bind(),u.setVertexAttribPointers(X,n,T);for(const W of _)W.bind(),W.setVertexAttribPointers(X,n,T);I&&(I.bind(),I.setVertexAttribPointers(X,n,T)),b&&b.bind(),O&&(O.bind(),O.setVertexAttribPointers(X,n,T)),N&&(N.bind(),N.setVertexAttribPointers(X,n,T)),$.currentNumAttributes=j}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const ye=(w,n,u,_,b)=>({u_texture:0,u_ele_delta:w,u_fog_matrix:n,u_fog_color:u?u.properties.get("fog-color"):c.bf.white,u_fog_ground_blend:u?u.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:b?0:u?u.calculateFogBlendOpacity(_):0,u_horizon_color:u?u.properties.get("horizon-color"):c.bf.white,u_horizon_fog_blend:u?u.properties.get("horizon-fog-blend"):1,u_is_globe_mode:b?1:0}),at={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function pt(w){const n=[];for(let u=0;u<w.length;u++){if(w[u]===null)continue;const _=w[u].split(" ");n.push(_.pop())}return n}class Wt{constructor(n,u,_,b,T,I,O,N,j=[]){const $=n.gl;this.program=$.createProgram();const X=pt(u.staticAttributes),W=_?_.getBinderAttributes():[],ee=X.concat(W),ae=Cr.prelude.staticUniforms?pt(Cr.prelude.staticUniforms):[],_e=O.staticUniforms?pt(O.staticUniforms):[],ge=u.staticUniforms?pt(u.staticUniforms):[],ve=_?_.getBinderUniforms():[],Te=ae.concat(_e).concat(ge).concat(ve),Me=[];for(const rt of Te)Me.indexOf(rt)<0&&Me.push(rt);const Ae=_?_.defines():[];lr($)&&Ae.unshift("#version 300 es"),T&&Ae.push("#define OVERDRAW_INSPECTOR;"),I&&Ae.push("#define TERRAIN3D;"),N&&Ae.push(N),j&&Ae.push(...j);let Le=Ae.concat(Cr.prelude.fragmentSource,O.fragmentSource,u.fragmentSource).join(`
`),Ue=Ae.concat(Cr.prelude.vertexSource,O.vertexSource,u.vertexSource).join(`
`);lr($)||(Le=(function(rt){return rt.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")})(Le),Ue=(function(rt){return rt.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")})(Ue));const Ce=$.createShader($.FRAGMENT_SHADER);if($.isContextLost())return void(this.failedToCreate=!0);if($.shaderSource(Ce,Le),$.compileShader(Ce),!$.getShaderParameter(Ce,$.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${$.getShaderInfoLog(Ce)}`);$.attachShader(this.program,Ce);const We=$.createShader($.VERTEX_SHADER);if($.isContextLost())return void(this.failedToCreate=!0);if($.shaderSource(We,Ue),$.compileShader(We),!$.getShaderParameter(We,$.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${$.getShaderInfoLog(We)}`);$.attachShader(this.program,We),this.attributes={};const dt={};this.numAttributes=ee.length;for(let rt=0;rt<this.numAttributes;rt++)ee[rt]&&($.bindAttribLocation(this.program,rt,ee[rt]),this.attributes[ee[rt]]=rt);if($.linkProgram(this.program),!$.getProgramParameter(this.program,$.LINK_STATUS))throw new Error(`Program failed to link: ${$.getProgramInfoLog(this.program)}`);$.deleteShader(We),$.deleteShader(Ce);for(let rt=0;rt<Me.length;rt++){const st=Me[rt];if(st&&!dt[st]){const ct=$.getUniformLocation(this.program,st);ct&&(dt[st]=ct)}}this.fixedUniforms=b(n,dt),this.terrainUniforms=((rt,st)=>({u_depth:new c.bP(rt,st.u_depth),u_terrain:new c.bP(rt,st.u_terrain),u_terrain_dim:new c.bg(rt,st.u_terrain_dim),u_terrain_matrix:new c.bR(rt,st.u_terrain_matrix),u_terrain_unpack:new c.bS(rt,st.u_terrain_unpack),u_terrain_exaggeration:new c.bg(rt,st.u_terrain_exaggeration)}))(n,dt),this.projectionUniforms=((rt,st)=>({u_projection_matrix:new c.bR(rt,st.u_projection_matrix),u_projection_tile_mercator_coords:new c.bS(rt,st.u_projection_tile_mercator_coords),u_projection_clipping_plane:new c.bS(rt,st.u_projection_clipping_plane),u_projection_transition:new c.bg(rt,st.u_projection_transition),u_projection_fallback_matrix:new c.bR(rt,st.u_projection_fallback_matrix)}))(n,dt),this.binderUniforms=_?_.getUniforms(n,dt):[]}draw(n,u,_,b,T,I,O,N,j,$,X,W,ee,ae,_e,ge,ve,Te,Me){const Ae=n.gl;if(this.failedToCreate)return;if(n.program.set(this.program),n.setDepthMode(_),n.setStencilMode(b),n.setColorMode(T),n.setCullFace(I),N){n.activeTexture.set(Ae.TEXTURE2),Ae.bindTexture(Ae.TEXTURE_2D,N.depthTexture),n.activeTexture.set(Ae.TEXTURE3),Ae.bindTexture(Ae.TEXTURE_2D,N.texture);for(const Ue in this.terrainUniforms)this.terrainUniforms[Ue].set(N[Ue])}if(j)for(const Ue in j)this.projectionUniforms[at[Ue]].set(j[Ue]);if(O)for(const Ue in this.fixedUniforms)this.fixedUniforms[Ue].set(O[Ue]);ge&&ge.setUniforms(n,this.binderUniforms,ae,{zoom:_e});let Le=0;switch(u){case Ae.LINES:Le=2;break;case Ae.TRIANGLES:Le=3;break;case Ae.LINE_STRIP:Le=1}for(const Ue of ee.get()){const Ce=Ue.vaos||(Ue.vaos={});(Ce[$]||(Ce[$]=new te)).bind(n,this,X,ge?ge.getPaintVertexBuffers():[],W,Ue.vertexOffset,ve,Te,Me),Ae.drawElements(u,Ue.primitiveLength*Le,Ae.UNSIGNED_SHORT,Ue.primitiveOffset*Le*2)}}}function kn(w,n,u){const _=1/c.aC(u,1,n.transform.tileZoom),b=Math.pow(2,u.tileID.overscaledZ),T=u.tileSize*Math.pow(2,n.transform.tileZoom)/b,I=T*(u.tileID.canonical.x+u.tileID.wrap*b),O=T*u.tileID.canonical.y;return{u_image:0,u_texsize:u.imageAtlasTexture.size,u_scale:[_,w.fromScale,w.toScale],u_fade:w.t,u_pixel_coord_upper:[I>>16,O>>16],u_pixel_coord_lower:[65535&I,65535&O]}}const $n=(w,n,u,_)=>{const b=w.style.light,T=b.properties.get("position"),I=[T.x,T.y,T.z],O=c.bV();b.properties.get("anchor")==="viewport"&&c.bW(O,w.transform.bearingInRadians),c.bX(I,I,O);const N=w.transform.transformLightDirection(I),j=b.properties.get("color");return{u_lightpos:I,u_lightpos_globe:N,u_lightintensity:b.properties.get("intensity"),u_lightcolor:[j.r,j.g,j.b],u_vertical_gradient:+n,u_opacity:u,u_fill_translate:_}},Ri=(w,n,u,_,b,T,I)=>c.e($n(w,n,u,_),kn(T,w,I),{u_height_factor:-Math.pow(2,b.overscaledZ)/I.tileSize/8}),ur=(w,n,u,_)=>c.e(kn(n,w,u),{u_fill_translate:_}),Ca=(w,n)=>({u_world:w,u_fill_translate:n}),Ua=(w,n,u,_,b)=>c.e(ur(w,n,u,b),{u_world:_}),Ws=(w,n,u,_,b)=>{const T=w.transform;let I,O,N=0;if(u.paint.get("circle-pitch-alignment")==="map"){const j=c.aC(n,1,T.zoom);I=!0,O=[j,j],N=j/(c.$*Math.pow(2,n.tileID.overscaledZ))*2*Math.PI*b}else I=!1,O=T.pixelsToGLUnits;return{u_camera_to_center_distance:T.cameraToCenterDistance,u_scale_with_map:+(u.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+I,u_device_pixel_ratio:w.pixelRatio,u_extrude_scale:O,u_globe_extrude_scale:N,u_translate:_}},As=w=>({u_pixel_extrude_scale:[1/w.width,1/w.height]}),Lo=w=>({u_viewport_size:[w.width,w.height]}),yo=(w,n=1)=>({u_color:w,u_overlay:0,u_overlay_scale:n}),Gd=(w,n,u,_)=>{const b=c.aC(w,1,n)/(c.$*Math.pow(2,w.tileID.overscaledZ))*2*Math.PI*_;return{u_extrude_scale:c.aC(w,1,n),u_intensity:u,u_globe_extrude_scale:b}},Xs=(w,n,u,_)=>{const b=c.L();c.bY(b,0,w.width,w.height,0,0,1);const T=w.context.gl;return{u_matrix:b,u_world:[T.drawingBufferWidth,T.drawingBufferHeight],u_image:u,u_color_ramp:_,u_opacity:n.paint.get("heatmap-opacity")}},fu=(w,n,u)=>{const _=u.paint.get("hillshade-accent-color");let b;switch(u.paint.get("hillshade-method")){case"basic":b=4;break;case"combined":b=1;break;case"igor":b=2;break;case"multidirectional":b=3;break;default:b=0}const T=u.getIlluminationProperties();for(let I=0;I<T.directionRadians.length;I++)u.paint.get("hillshade-illumination-anchor")==="viewport"&&(T.directionRadians[I]+=w.transform.bearingInRadians);return{u_image:0,u_latrange:ts(0,n.tileID),u_exaggeration:u.paint.get("hillshade-exaggeration"),u_altitudes:T.altitudeRadians,u_azimuths:T.directionRadians,u_accent:_,u_method:b,u_highlights:T.highlightColor,u_shadows:T.shadowColor}},nd=(w,n)=>{const u=n.stride,_=c.L();return c.bY(_,0,c.$,-c.$,0,0,1),c.M(_,_,[0,-c.$,0]),{u_matrix:_,u_image:1,u_dimension:[u,u],u_zoom:w.overscaledZ,u_unpack:n.getUnpackVector()}};function ts(w,n){const u=Math.pow(2,n.canonical.z),_=n.canonical.y;return[new c.a1(0,_/u).toLngLat().lat,new c.a1(0,(_+1)/u).toLngLat().lat]}const ju=(w,n,u=0)=>({u_image:0,u_unpack:n.getUnpackVector(),u_dimension:[n.stride,n.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:u,u_opacity:w.paint.get("color-relief-opacity")}),Al=(w,n,u,_)=>{const b=w.transform;return{u_translation:Ec(w,n,u),u_ratio:_/c.aC(n,1,b.zoom),u_device_pixel_ratio:w.pixelRatio,u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]]}},Sc=(w,n,u,_,b)=>c.e(Al(w,n,u,_),{u_image:0,u_image_height:b}),pu=(w,n,u,_,b)=>{const T=w.transform,I=Xl(n,T);return{u_translation:Ec(w,n,u),u_texsize:n.imageAtlasTexture.size,u_ratio:_/c.aC(n,1,T.zoom),u_device_pixel_ratio:w.pixelRatio,u_image:0,u_scale:[I,b.fromScale,b.toScale],u_fade:b.t,u_units_to_pixels:[1/T.pixelsToGLUnits[0],1/T.pixelsToGLUnits[1]]}},Il=(w,n,u,_,b,T)=>{const I=w.lineAtlas,O=Xl(n,w.transform),N=u.layout.get("line-cap")==="round",j=I.getDash(b.from,N),$=I.getDash(b.to,N),X=j.width*T.fromScale,W=$.width*T.toScale;return c.e(Al(w,n,u,_),{u_patternscale_a:[O/X,-j.height/2],u_patternscale_b:[O/W,-$.height/2],u_sdfgamma:I.width/(256*Math.min(X,W)*w.pixelRatio)/2,u_image:0,u_tex_y_a:j.y,u_tex_y_b:$.y,u_mix:T.t})};function Xl(w,n){return 1/c.aC(w,1,n.tileZoom)}function Ec(w,n,u){return c.aD(w.transform,n,u.paint.get("line-translate"),u.paint.get("line-translate-anchor"))}const Ks=(w,n,u,_,b)=>{return{u_tl_parent:w,u_scale_parent:n,u_buffer_scale:1,u_fade_t:u.mix,u_opacity:u.opacity*_.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:_.paint.get("raster-brightness-min"),u_brightness_high:_.paint.get("raster-brightness-max"),u_saturation_factor:(I=_.paint.get("raster-saturation"),I>0?1-1/(1.001-I):-I),u_contrast_factor:(T=_.paint.get("raster-contrast"),T>0?1/(1-T):1+T),u_spin_weights:Ac(_.paint.get("raster-hue-rotate")),u_coords_top:[b[0].x,b[0].y,b[1].x,b[1].y],u_coords_bottom:[b[3].x,b[3].y,b[2].x,b[2].y]};var T,I};function Ac(w){w*=Math.PI/180;const n=Math.sin(w),u=Math.cos(w);return[(2*u+1)/3,(-Math.sqrt(3)*n-u+1)/3,(Math.sqrt(3)*n-u+1)/3]}const qu=(w,n,u,_,b,T,I,O,N,j,$,X,W)=>{const ee=I.transform;return{u_is_size_zoom_constant:+(w==="constant"||w==="source"),u_is_size_feature_constant:+(w==="constant"||w==="camera"),u_size_t:n?n.uSizeT:0,u_size:n?n.uSize:0,u_camera_to_center_distance:ee.cameraToCenterDistance,u_pitch:ee.pitch/360*2*Math.PI,u_rotate_symbol:+u,u_aspect_ratio:ee.width/ee.height,u_fade_change:I.options.fadeDuration?I.symbolFadeChange:1,u_label_plane_matrix:O,u_coord_matrix:N,u_is_text:+$,u_pitch_with_map:+_,u_is_along_line:b,u_is_variable_anchor:T,u_texsize:X,u_texture:0,u_translation:j,u_pitched_scale:W}},hh=(w,n,u,_,b,T,I,O,N,j,$,X,W,ee)=>{const ae=I.transform;return c.e(qu(w,n,u,_,b,T,I,O,N,j,$,X,ee),{u_gamma_scale:_?Math.cos(ae.pitch*Math.PI/180)*ae.cameraToCenterDistance:1,u_device_pixel_ratio:I.pixelRatio,u_is_halo:1})},Zf=(w,n,u,_,b,T,I,O,N,j,$,X,W)=>c.e(hh(w,n,u,_,b,T,I,O,N,j,!0,$,0,W),{u_texsize_icon:X,u_texture_icon:1}),Qo=(w,n)=>({u_opacity:w,u_color:n}),Zd=(w,n,u,_,b)=>c.e((function(T,I,O,N){const j=O.imageManager.getPattern(T.from.toString()),$=O.imageManager.getPattern(T.to.toString()),{width:X,height:W}=O.imageManager.getPixelSize(),ee=Math.pow(2,N.tileID.overscaledZ),ae=N.tileSize*Math.pow(2,O.transform.tileZoom)/ee,_e=ae*(N.tileID.canonical.x+N.tileID.wrap*ee),ge=ae*N.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:j.tl,u_pattern_br_a:j.br,u_pattern_tl_b:$.tl,u_pattern_br_b:$.br,u_texsize:[X,W],u_mix:I.t,u_pattern_size_a:j.displaySize,u_pattern_size_b:$.displaySize,u_scale_a:I.fromScale,u_scale_b:I.toScale,u_tile_units_to_pixels:1/c.aC(N,1,O.transform.tileZoom),u_pixel_coord_upper:[_e>>16,ge>>16],u_pixel_coord_lower:[65535&_e,65535&ge]}})(u,b,n,_),{u_opacity:w}),Kl=(w,n)=>{},ns={fillExtrusion:(w,n)=>({u_lightpos:new c.bT(w,n.u_lightpos),u_lightpos_globe:new c.bT(w,n.u_lightpos_globe),u_lightintensity:new c.bg(w,n.u_lightintensity),u_lightcolor:new c.bT(w,n.u_lightcolor),u_vertical_gradient:new c.bg(w,n.u_vertical_gradient),u_opacity:new c.bg(w,n.u_opacity),u_fill_translate:new c.bU(w,n.u_fill_translate)}),fillExtrusionPattern:(w,n)=>({u_lightpos:new c.bT(w,n.u_lightpos),u_lightpos_globe:new c.bT(w,n.u_lightpos_globe),u_lightintensity:new c.bg(w,n.u_lightintensity),u_lightcolor:new c.bT(w,n.u_lightcolor),u_vertical_gradient:new c.bg(w,n.u_vertical_gradient),u_height_factor:new c.bg(w,n.u_height_factor),u_opacity:new c.bg(w,n.u_opacity),u_fill_translate:new c.bU(w,n.u_fill_translate),u_image:new c.bP(w,n.u_image),u_texsize:new c.bU(w,n.u_texsize),u_pixel_coord_upper:new c.bU(w,n.u_pixel_coord_upper),u_pixel_coord_lower:new c.bU(w,n.u_pixel_coord_lower),u_scale:new c.bT(w,n.u_scale),u_fade:new c.bg(w,n.u_fade)}),fill:(w,n)=>({u_fill_translate:new c.bU(w,n.u_fill_translate)}),fillPattern:(w,n)=>({u_image:new c.bP(w,n.u_image),u_texsize:new c.bU(w,n.u_texsize),u_pixel_coord_upper:new c.bU(w,n.u_pixel_coord_upper),u_pixel_coord_lower:new c.bU(w,n.u_pixel_coord_lower),u_scale:new c.bT(w,n.u_scale),u_fade:new c.bg(w,n.u_fade),u_fill_translate:new c.bU(w,n.u_fill_translate)}),fillOutline:(w,n)=>({u_world:new c.bU(w,n.u_world),u_fill_translate:new c.bU(w,n.u_fill_translate)}),fillOutlinePattern:(w,n)=>({u_world:new c.bU(w,n.u_world),u_image:new c.bP(w,n.u_image),u_texsize:new c.bU(w,n.u_texsize),u_pixel_coord_upper:new c.bU(w,n.u_pixel_coord_upper),u_pixel_coord_lower:new c.bU(w,n.u_pixel_coord_lower),u_scale:new c.bT(w,n.u_scale),u_fade:new c.bg(w,n.u_fade),u_fill_translate:new c.bU(w,n.u_fill_translate)}),circle:(w,n)=>({u_camera_to_center_distance:new c.bg(w,n.u_camera_to_center_distance),u_scale_with_map:new c.bP(w,n.u_scale_with_map),u_pitch_with_map:new c.bP(w,n.u_pitch_with_map),u_extrude_scale:new c.bU(w,n.u_extrude_scale),u_device_pixel_ratio:new c.bg(w,n.u_device_pixel_ratio),u_globe_extrude_scale:new c.bg(w,n.u_globe_extrude_scale),u_translate:new c.bU(w,n.u_translate)}),collisionBox:(w,n)=>({u_pixel_extrude_scale:new c.bU(w,n.u_pixel_extrude_scale)}),collisionCircle:(w,n)=>({u_viewport_size:new c.bU(w,n.u_viewport_size)}),debug:(w,n)=>({u_color:new c.bQ(w,n.u_color),u_overlay:new c.bP(w,n.u_overlay),u_overlay_scale:new c.bg(w,n.u_overlay_scale)}),depth:Kl,clippingMask:Kl,heatmap:(w,n)=>({u_extrude_scale:new c.bg(w,n.u_extrude_scale),u_intensity:new c.bg(w,n.u_intensity),u_globe_extrude_scale:new c.bg(w,n.u_globe_extrude_scale)}),heatmapTexture:(w,n)=>({u_matrix:new c.bR(w,n.u_matrix),u_world:new c.bU(w,n.u_world),u_image:new c.bP(w,n.u_image),u_color_ramp:new c.bP(w,n.u_color_ramp),u_opacity:new c.bg(w,n.u_opacity)}),hillshade:(w,n)=>({u_image:new c.bP(w,n.u_image),u_latrange:new c.bU(w,n.u_latrange),u_exaggeration:new c.bg(w,n.u_exaggeration),u_altitudes:new c.b_(w,n.u_altitudes),u_azimuths:new c.b_(w,n.u_azimuths),u_accent:new c.bQ(w,n.u_accent),u_method:new c.bP(w,n.u_method),u_shadows:new c.bZ(w,n.u_shadows),u_highlights:new c.bZ(w,n.u_highlights)}),hillshadePrepare:(w,n)=>({u_matrix:new c.bR(w,n.u_matrix),u_image:new c.bP(w,n.u_image),u_dimension:new c.bU(w,n.u_dimension),u_zoom:new c.bg(w,n.u_zoom),u_unpack:new c.bS(w,n.u_unpack)}),colorRelief:(w,n)=>({u_image:new c.bP(w,n.u_image),u_unpack:new c.bS(w,n.u_unpack),u_dimension:new c.bU(w,n.u_dimension),u_elevation_stops:new c.bP(w,n.u_elevation_stops),u_color_stops:new c.bP(w,n.u_color_stops),u_color_ramp_size:new c.bP(w,n.u_color_ramp_size),u_opacity:new c.bg(w,n.u_opacity)}),line:(w,n)=>({u_translation:new c.bU(w,n.u_translation),u_ratio:new c.bg(w,n.u_ratio),u_device_pixel_ratio:new c.bg(w,n.u_device_pixel_ratio),u_units_to_pixels:new c.bU(w,n.u_units_to_pixels)}),lineGradient:(w,n)=>({u_translation:new c.bU(w,n.u_translation),u_ratio:new c.bg(w,n.u_ratio),u_device_pixel_ratio:new c.bg(w,n.u_device_pixel_ratio),u_units_to_pixels:new c.bU(w,n.u_units_to_pixels),u_image:new c.bP(w,n.u_image),u_image_height:new c.bg(w,n.u_image_height)}),linePattern:(w,n)=>({u_translation:new c.bU(w,n.u_translation),u_texsize:new c.bU(w,n.u_texsize),u_ratio:new c.bg(w,n.u_ratio),u_device_pixel_ratio:new c.bg(w,n.u_device_pixel_ratio),u_image:new c.bP(w,n.u_image),u_units_to_pixels:new c.bU(w,n.u_units_to_pixels),u_scale:new c.bT(w,n.u_scale),u_fade:new c.bg(w,n.u_fade)}),lineSDF:(w,n)=>({u_translation:new c.bU(w,n.u_translation),u_ratio:new c.bg(w,n.u_ratio),u_device_pixel_ratio:new c.bg(w,n.u_device_pixel_ratio),u_units_to_pixels:new c.bU(w,n.u_units_to_pixels),u_patternscale_a:new c.bU(w,n.u_patternscale_a),u_patternscale_b:new c.bU(w,n.u_patternscale_b),u_sdfgamma:new c.bg(w,n.u_sdfgamma),u_image:new c.bP(w,n.u_image),u_tex_y_a:new c.bg(w,n.u_tex_y_a),u_tex_y_b:new c.bg(w,n.u_tex_y_b),u_mix:new c.bg(w,n.u_mix)}),raster:(w,n)=>({u_tl_parent:new c.bU(w,n.u_tl_parent),u_scale_parent:new c.bg(w,n.u_scale_parent),u_buffer_scale:new c.bg(w,n.u_buffer_scale),u_fade_t:new c.bg(w,n.u_fade_t),u_opacity:new c.bg(w,n.u_opacity),u_image0:new c.bP(w,n.u_image0),u_image1:new c.bP(w,n.u_image1),u_brightness_low:new c.bg(w,n.u_brightness_low),u_brightness_high:new c.bg(w,n.u_brightness_high),u_saturation_factor:new c.bg(w,n.u_saturation_factor),u_contrast_factor:new c.bg(w,n.u_contrast_factor),u_spin_weights:new c.bT(w,n.u_spin_weights),u_coords_top:new c.bS(w,n.u_coords_top),u_coords_bottom:new c.bS(w,n.u_coords_bottom)}),symbolIcon:(w,n)=>({u_is_size_zoom_constant:new c.bP(w,n.u_is_size_zoom_constant),u_is_size_feature_constant:new c.bP(w,n.u_is_size_feature_constant),u_size_t:new c.bg(w,n.u_size_t),u_size:new c.bg(w,n.u_size),u_camera_to_center_distance:new c.bg(w,n.u_camera_to_center_distance),u_pitch:new c.bg(w,n.u_pitch),u_rotate_symbol:new c.bP(w,n.u_rotate_symbol),u_aspect_ratio:new c.bg(w,n.u_aspect_ratio),u_fade_change:new c.bg(w,n.u_fade_change),u_label_plane_matrix:new c.bR(w,n.u_label_plane_matrix),u_coord_matrix:new c.bR(w,n.u_coord_matrix),u_is_text:new c.bP(w,n.u_is_text),u_pitch_with_map:new c.bP(w,n.u_pitch_with_map),u_is_along_line:new c.bP(w,n.u_is_along_line),u_is_variable_anchor:new c.bP(w,n.u_is_variable_anchor),u_texsize:new c.bU(w,n.u_texsize),u_texture:new c.bP(w,n.u_texture),u_translation:new c.bU(w,n.u_translation),u_pitched_scale:new c.bg(w,n.u_pitched_scale)}),symbolSDF:(w,n)=>({u_is_size_zoom_constant:new c.bP(w,n.u_is_size_zoom_constant),u_is_size_feature_constant:new c.bP(w,n.u_is_size_feature_constant),u_size_t:new c.bg(w,n.u_size_t),u_size:new c.bg(w,n.u_size),u_camera_to_center_distance:new c.bg(w,n.u_camera_to_center_distance),u_pitch:new c.bg(w,n.u_pitch),u_rotate_symbol:new c.bP(w,n.u_rotate_symbol),u_aspect_ratio:new c.bg(w,n.u_aspect_ratio),u_fade_change:new c.bg(w,n.u_fade_change),u_label_plane_matrix:new c.bR(w,n.u_label_plane_matrix),u_coord_matrix:new c.bR(w,n.u_coord_matrix),u_is_text:new c.bP(w,n.u_is_text),u_pitch_with_map:new c.bP(w,n.u_pitch_with_map),u_is_along_line:new c.bP(w,n.u_is_along_line),u_is_variable_anchor:new c.bP(w,n.u_is_variable_anchor),u_texsize:new c.bU(w,n.u_texsize),u_texture:new c.bP(w,n.u_texture),u_gamma_scale:new c.bg(w,n.u_gamma_scale),u_device_pixel_ratio:new c.bg(w,n.u_device_pixel_ratio),u_is_halo:new c.bP(w,n.u_is_halo),u_translation:new c.bU(w,n.u_translation),u_pitched_scale:new c.bg(w,n.u_pitched_scale)}),symbolTextAndIcon:(w,n)=>({u_is_size_zoom_constant:new c.bP(w,n.u_is_size_zoom_constant),u_is_size_feature_constant:new c.bP(w,n.u_is_size_feature_constant),u_size_t:new c.bg(w,n.u_size_t),u_size:new c.bg(w,n.u_size),u_camera_to_center_distance:new c.bg(w,n.u_camera_to_center_distance),u_pitch:new c.bg(w,n.u_pitch),u_rotate_symbol:new c.bP(w,n.u_rotate_symbol),u_aspect_ratio:new c.bg(w,n.u_aspect_ratio),u_fade_change:new c.bg(w,n.u_fade_change),u_label_plane_matrix:new c.bR(w,n.u_label_plane_matrix),u_coord_matrix:new c.bR(w,n.u_coord_matrix),u_is_text:new c.bP(w,n.u_is_text),u_pitch_with_map:new c.bP(w,n.u_pitch_with_map),u_is_along_line:new c.bP(w,n.u_is_along_line),u_is_variable_anchor:new c.bP(w,n.u_is_variable_anchor),u_texsize:new c.bU(w,n.u_texsize),u_texsize_icon:new c.bU(w,n.u_texsize_icon),u_texture:new c.bP(w,n.u_texture),u_texture_icon:new c.bP(w,n.u_texture_icon),u_gamma_scale:new c.bg(w,n.u_gamma_scale),u_device_pixel_ratio:new c.bg(w,n.u_device_pixel_ratio),u_is_halo:new c.bP(w,n.u_is_halo),u_translation:new c.bU(w,n.u_translation),u_pitched_scale:new c.bg(w,n.u_pitched_scale)}),background:(w,n)=>({u_opacity:new c.bg(w,n.u_opacity),u_color:new c.bQ(w,n.u_color)}),backgroundPattern:(w,n)=>({u_opacity:new c.bg(w,n.u_opacity),u_image:new c.bP(w,n.u_image),u_pattern_tl_a:new c.bU(w,n.u_pattern_tl_a),u_pattern_br_a:new c.bU(w,n.u_pattern_br_a),u_pattern_tl_b:new c.bU(w,n.u_pattern_tl_b),u_pattern_br_b:new c.bU(w,n.u_pattern_br_b),u_texsize:new c.bU(w,n.u_texsize),u_mix:new c.bg(w,n.u_mix),u_pattern_size_a:new c.bU(w,n.u_pattern_size_a),u_pattern_size_b:new c.bU(w,n.u_pattern_size_b),u_scale_a:new c.bg(w,n.u_scale_a),u_scale_b:new c.bg(w,n.u_scale_b),u_pixel_coord_upper:new c.bU(w,n.u_pixel_coord_upper),u_pixel_coord_lower:new c.bU(w,n.u_pixel_coord_lower),u_tile_units_to_pixels:new c.bg(w,n.u_tile_units_to_pixels)}),terrain:(w,n)=>({u_texture:new c.bP(w,n.u_texture),u_ele_delta:new c.bg(w,n.u_ele_delta),u_fog_matrix:new c.bR(w,n.u_fog_matrix),u_fog_color:new c.bQ(w,n.u_fog_color),u_fog_ground_blend:new c.bg(w,n.u_fog_ground_blend),u_fog_ground_blend_opacity:new c.bg(w,n.u_fog_ground_blend_opacity),u_horizon_color:new c.bQ(w,n.u_horizon_color),u_horizon_fog_blend:new c.bg(w,n.u_horizon_fog_blend),u_is_globe_mode:new c.bg(w,n.u_is_globe_mode)}),terrainDepth:(w,n)=>({u_ele_delta:new c.bg(w,n.u_ele_delta)}),terrainCoords:(w,n)=>({u_texture:new c.bP(w,n.u_texture),u_terrain_coords_id:new c.bg(w,n.u_terrain_coords_id),u_ele_delta:new c.bg(w,n.u_ele_delta)}),projectionErrorMeasurement:(w,n)=>({u_input:new c.bg(w,n.u_input),u_output_expected:new c.bg(w,n.u_output_expected)}),atmosphere:(w,n)=>({u_sun_pos:new c.bT(w,n.u_sun_pos),u_atmosphere_blend:new c.bg(w,n.u_atmosphere_blend),u_globe_position:new c.bT(w,n.u_globe_position),u_globe_radius:new c.bg(w,n.u_globe_radius),u_inv_proj_matrix:new c.bR(w,n.u_inv_proj_matrix)}),sky:(w,n)=>({u_sky_color:new c.bQ(w,n.u_sky_color),u_horizon_color:new c.bQ(w,n.u_horizon_color),u_horizon:new c.bU(w,n.u_horizon),u_horizon_normal:new c.bU(w,n.u_horizon_normal),u_sky_horizon_blend:new c.bg(w,n.u_sky_horizon_blend),u_sky_blend:new c.bg(w,n.u_sky_blend)})};class Is{constructor(n,u,_){this.context=n;const b=n.gl;this.buffer=b.createBuffer(),this.dynamicDraw=!!_,this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||delete u.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){const u=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),u.bufferSubData(u.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Yl={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Do{constructor(n,u,_,b){this.length=u.length,this.attributes=_,this.itemSize=u.bytesPerElement,this.dynamicDraw=b,this.context=n;const T=n.gl;this.buffer=T.createBuffer(),n.bindVertexBuffer.set(this.buffer),T.bufferData(T.ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?T.DYNAMIC_DRAW:T.STATIC_DRAW),this.dynamicDraw||delete u.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(n){if(n.length!==this.length)throw new Error(`Length of new data is ${n.length}, which doesn't match current length of ${this.length}`);const u=this.context.gl;this.bind(),u.bufferSubData(u.ARRAY_BUFFER,0,n.arrayBuffer)}enableAttributes(n,u){for(let _=0;_<this.attributes.length;_++){const b=u.attributes[this.attributes[_].name];b!==void 0&&n.enableVertexAttribArray(b)}}setVertexAttribPointers(n,u,_){for(let b=0;b<this.attributes.length;b++){const T=this.attributes[b],I=u.attributes[T.name];I!==void 0&&n.vertexAttribPointer(I,T.components,n[Yl[T.type]],!1,this.itemSize,T.offset+this.itemSize*(_||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class oi{constructor(n){this.gl=n.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(n){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class mu extends oi{getDefault(){return c.bf.transparent}set(n){const u=this.current;(n.r!==u.r||n.g!==u.g||n.b!==u.b||n.a!==u.a||this.dirty)&&(this.gl.clearColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class gu extends oi{getDefault(){return 1}set(n){(n!==this.current||this.dirty)&&(this.gl.clearDepth(n),this.current=n,this.dirty=!1)}}class Ic extends oi{getDefault(){return 0}set(n){(n!==this.current||this.dirty)&&(this.gl.clearStencil(n),this.current=n,this.dirty=!1)}}class Ys extends oi{getDefault(){return[!0,!0,!0,!0]}set(n){const u=this.current;(n[0]!==u[0]||n[1]!==u[1]||n[2]!==u[2]||n[3]!==u[3]||this.dirty)&&(this.gl.colorMask(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class vo extends oi{getDefault(){return!0}set(n){(n!==this.current||this.dirty)&&(this.gl.depthMask(n),this.current=n,this.dirty=!1)}}class Cl extends oi{getDefault(){return 255}set(n){(n!==this.current||this.dirty)&&(this.gl.stencilMask(n),this.current=n,this.dirty=!1)}}class dh extends oi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(n){const u=this.current;(n.func!==u.func||n.ref!==u.ref||n.mask!==u.mask||this.dirty)&&(this.gl.stencilFunc(n.func,n.ref,n.mask),this.current=n,this.dirty=!1)}}class Hd extends oi{getDefault(){const n=this.gl;return[n.KEEP,n.KEEP,n.KEEP]}set(n){const u=this.current;(n[0]!==u[0]||n[1]!==u[1]||n[2]!==u[2]||this.dirty)&&(this.gl.stencilOp(n[0],n[1],n[2]),this.current=n,this.dirty=!1)}}class Jo extends oi{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const u=this.gl;n?u.enable(u.STENCIL_TEST):u.disable(u.STENCIL_TEST),this.current=n,this.dirty=!1}}class $u extends oi{getDefault(){return[0,1]}set(n){const u=this.current;(n[0]!==u[0]||n[1]!==u[1]||this.dirty)&&(this.gl.depthRange(n[0],n[1]),this.current=n,this.dirty=!1)}}class Cc extends oi{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const u=this.gl;n?u.enable(u.DEPTH_TEST):u.disable(u.DEPTH_TEST),this.current=n,this.dirty=!1}}class Wd extends oi{getDefault(){return this.gl.LESS}set(n){(n!==this.current||this.dirty)&&(this.gl.depthFunc(n),this.current=n,this.dirty=!1)}}class Pl extends oi{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const u=this.gl;n?u.enable(u.BLEND):u.disable(u.BLEND),this.current=n,this.dirty=!1}}class Pc extends oi{getDefault(){const n=this.gl;return[n.ONE,n.ZERO]}set(n){const u=this.current;(n[0]!==u[0]||n[1]!==u[1]||this.dirty)&&(this.gl.blendFunc(n[0],n[1]),this.current=n,this.dirty=!1)}}class Cs extends oi{getDefault(){return c.bf.transparent}set(n){const u=this.current;(n.r!==u.r||n.g!==u.g||n.b!==u.b||n.a!==u.a||this.dirty)&&(this.gl.blendColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class Ql extends oi{getDefault(){return this.gl.FUNC_ADD}set(n){(n!==this.current||this.dirty)&&(this.gl.blendEquation(n),this.current=n,this.dirty=!1)}}class id extends oi{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const u=this.gl;n?u.enable(u.CULL_FACE):u.disable(u.CULL_FACE),this.current=n,this.dirty=!1}}class el extends oi{getDefault(){return this.gl.BACK}set(n){(n!==this.current||this.dirty)&&(this.gl.cullFace(n),this.current=n,this.dirty=!1)}}class Mc extends oi{getDefault(){return this.gl.CCW}set(n){(n!==this.current||this.dirty)&&(this.gl.frontFace(n),this.current=n,this.dirty=!1)}}class Jl extends oi{getDefault(){return null}set(n){(n!==this.current||this.dirty)&&(this.gl.useProgram(n),this.current=n,this.dirty=!1)}}class Qs extends oi{getDefault(){return this.gl.TEXTURE0}set(n){(n!==this.current||this.dirty)&&(this.gl.activeTexture(n),this.current=n,this.dirty=!1)}}class eu extends oi{getDefault(){const n=this.gl;return[0,0,n.drawingBufferWidth,n.drawingBufferHeight]}set(n){const u=this.current;(n[0]!==u[0]||n[1]!==u[1]||n[2]!==u[2]||n[3]!==u[3]||this.dirty)&&(this.gl.viewport(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class bo extends oi{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const u=this.gl;u.bindFramebuffer(u.FRAMEBUFFER,n),this.current=n,this.dirty=!1}}class Ml extends oi{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const u=this.gl;u.bindRenderbuffer(u.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class ua extends oi{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const u=this.gl;u.bindTexture(u.TEXTURE_2D,n),this.current=n,this.dirty=!1}}class ja extends oi{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const u=this.gl;u.bindBuffer(u.ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class Rl extends oi{getDefault(){return null}set(n){const u=this.gl;u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class is extends oi{getDefault(){return null}set(n){var u;if(n===this.current&&!this.dirty)return;const _=this.gl;lr(_)?_.bindVertexArray(n):(u=_.getExtension("OES_vertex_array_object"))===null||u===void 0||u.bindVertexArrayOES(n),this.current=n,this.dirty=!1}}class tu extends oi{getDefault(){return 4}set(n){if(n===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_ALIGNMENT,n),this.current=n,this.dirty=!1}}class Gu extends oi{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n),this.current=n,this.dirty=!1}}class xo extends oi{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,n),this.current=n,this.dirty=!1}}class Js extends oi{constructor(n,u){super(n),this.context=n,this.parent=u}getDefault(){return null}}class Zu extends Js{setDirty(){this.dirty=!0}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class tl extends Js{set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferRenderbuffer(u.FRAMEBUFFER,u.DEPTH_ATTACHMENT,u.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class Gn extends Js{set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferRenderbuffer(u.FRAMEBUFFER,u.DEPTH_STENCIL_ATTACHMENT,u.RENDERBUFFER,n),this.current=n,this.dirty=!1}}const Hu="Framebuffer is not complete";class eo{constructor(n,u,_,b,T){this.context=n,this.width=u,this.height=_;const I=n.gl,O=this.framebuffer=I.createFramebuffer();if(this.colorAttachment=new Zu(n,O),b)this.depthAttachment=T?new Gn(n,O):new tl(n,O);else if(T)throw new Error("Stencil cannot be set without depth");if(I.checkFramebufferStatus(I.FRAMEBUFFER)!==I.FRAMEBUFFER_COMPLETE)throw new Error(Hu)}destroy(){const n=this.context.gl,u=this.colorAttachment.get();if(u&&n.deleteTexture(u),this.depthAttachment){const _=this.depthAttachment.get();_&&n.deleteRenderbuffer(_)}n.deleteFramebuffer(this.framebuffer)}}class Rc{constructor(n){var u,_;if(this.gl=n,this.clearColor=new mu(this),this.clearDepth=new gu(this),this.clearStencil=new Ic(this),this.colorMask=new Ys(this),this.depthMask=new vo(this),this.stencilMask=new Cl(this),this.stencilFunc=new dh(this),this.stencilOp=new Hd(this),this.stencilTest=new Jo(this),this.depthRange=new $u(this),this.depthTest=new Cc(this),this.depthFunc=new Wd(this),this.blend=new Pl(this),this.blendFunc=new Pc(this),this.blendColor=new Cs(this),this.blendEquation=new Ql(this),this.cullFace=new id(this),this.cullFaceSide=new el(this),this.frontFace=new Mc(this),this.program=new Jl(this),this.activeTexture=new Qs(this),this.viewport=new eu(this),this.bindFramebuffer=new bo(this),this.bindRenderbuffer=new Ml(this),this.bindTexture=new ua(this),this.bindVertexBuffer=new ja(this),this.bindElementBuffer=new Rl(this),this.bindVertexArray=new is(this),this.pixelStoreUnpack=new tu(this),this.pixelStoreUnpackPremultiplyAlpha=new Gu(this),this.pixelStoreUnpackFlipY=new xo(this),this.extTextureFilterAnisotropic=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=n.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE),lr(n)){this.HALF_FLOAT=n.HALF_FLOAT;const b=n.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(u=n.RGBA16F)!==null&&u!==void 0?u:b==null?void 0:b.RGBA16F_EXT,this.RGB16F=(_=n.RGB16F)!==null&&_!==void 0?_:b==null?void 0:b.RGB16F_EXT,n.getExtension("EXT_color_buffer_float")}else{n.getExtension("EXT_color_buffer_half_float"),n.getExtension("OES_texture_half_float_linear");const b=n.getExtension("OES_texture_half_float");this.HALF_FLOAT=b==null?void 0:b.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(n,u){return new Is(this,n,u)}createVertexBuffer(n,u,_){return new Do(this,n,u,_)}createRenderbuffer(n,u,_){const b=this.gl,T=b.createRenderbuffer();return this.bindRenderbuffer.set(T),b.renderbufferStorage(b.RENDERBUFFER,n,u,_),this.bindRenderbuffer.set(null),T}createFramebuffer(n,u,_,b){return new eo(this,n,u,_,b)}clear({color:n,depth:u,stencil:_}){const b=this.gl;let T=0;n&&(T|=b.COLOR_BUFFER_BIT,this.clearColor.set(n),this.colorMask.set([!0,!0,!0,!0])),u!==void 0&&(T|=b.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(u),this.depthMask.set(!0)),_!==void 0&&(T|=b.STENCIL_BUFFER_BIT,this.clearStencil.set(_),this.stencilMask.set(255)),b.clear(T)}setCullFace(n){n.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(n.mode),this.frontFace.set(n.frontFace))}setDepthMode(n){n.func!==this.gl.ALWAYS||n.mask?(this.depthTest.set(!0),this.depthFunc.set(n.func),this.depthMask.set(n.mask),this.depthRange.set(n.range)):this.depthTest.set(!1)}setStencilMode(n){n.test.func!==this.gl.ALWAYS||n.mask?(this.stencilTest.set(!0),this.stencilMask.set(n.mask),this.stencilOp.set([n.fail,n.depthFail,n.pass]),this.stencilFunc.set({func:n.test.func,ref:n.ref,mask:n.test.mask})):this.stencilTest.set(!1)}setColorMode(n){c.bH(n.blendFunction,Tn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(n.blendFunction),this.blendColor.set(n.blendColor)),this.colorMask.set(n.mask)}createVertexArray(){var n;return lr(this.gl)?this.gl.createVertexArray():(n=this.gl.getExtension("OES_vertex_array_object"))===null||n===void 0?void 0:n.createVertexArrayOES()}deleteVertexArray(n){var u;return lr(this.gl)?this.gl.deleteVertexArray(n):(u=this.gl.getExtension("OES_vertex_array_object"))===null||u===void 0?void 0:u.deleteVertexArrayOES(n)}unbindVAO(){this.bindVertexArray.set(null)}}let Pa;function fh(w,n,u,_,b){const T=w.context,I=w.transform,O=T.gl,N=w.useProgram("collisionBox"),j=[];let $=0,X=0;for(let ve=0;ve<_.length;ve++){const Te=_[ve],Me=n.getTile(Te).getBucket(u);if(!Me)continue;const Ae=b?Me.textCollisionBox:Me.iconCollisionBox,Le=Me.collisionCircleArray;Le.length>0&&(j.push({circleArray:Le,circleOffset:X,coord:Te}),$+=Le.length/4,X=$),Ae&&N.draw(T,O.LINES,sn.disabled,Jn.disabled,w.colorModeForRenderPass(),pn.disabled,As(w.transform),w.style.map.terrain&&w.style.map.terrain.getTerrainData(Te),I.getProjectionData({overscaledTileID:Te,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),u.id,Ae.layoutVertexBuffer,Ae.indexBuffer,Ae.segments,null,w.transform.zoom,null,null,Ae.collisionVertexBuffer)}if(!b||!j.length)return;const W=w.useProgram("collisionCircle"),ee=new c.b$;ee.resize(4*$),ee._trim();let ae=0;for(const ve of j)for(let Te=0;Te<ve.circleArray.length/4;Te++){const Me=4*Te,Ae=ve.circleArray[Me+0],Le=ve.circleArray[Me+1],Ue=ve.circleArray[Me+2],Ce=ve.circleArray[Me+3];ee.emplace(ae++,Ae,Le,Ue,Ce,0),ee.emplace(ae++,Ae,Le,Ue,Ce,1),ee.emplace(ae++,Ae,Le,Ue,Ce,2),ee.emplace(ae++,Ae,Le,Ue,Ce,3)}(!Pa||Pa.length<2*$)&&(Pa=(function(ve){const Te=2*ve,Me=new c.c1;Me.resize(Te),Me._trim();for(let Ae=0;Ae<Te;Ae++){const Le=6*Ae;Me.uint16[Le+0]=4*Ae+0,Me.uint16[Le+1]=4*Ae+1,Me.uint16[Le+2]=4*Ae+2,Me.uint16[Le+3]=4*Ae+2,Me.uint16[Le+4]=4*Ae+3,Me.uint16[Le+5]=4*Ae+0}return Me})($));const _e=T.createIndexBuffer(Pa,!0),ge=T.createVertexBuffer(ee,c.c0.members,!0);for(const ve of j){const Te=Lo(w.transform);W.draw(T,O.TRIANGLES,sn.disabled,Jn.disabled,w.colorModeForRenderPass(),pn.disabled,Te,w.style.map.terrain&&w.style.map.terrain.getTerrainData(ve.coord),null,u.id,ge,_e,c.aM.simpleSegment(0,2*ve.circleOffset,ve.circleArray.length,ve.circleArray.length/2),null,w.transform.zoom,null,null,null)}ge.destroy(),_e.destroy()}const kc=c.ag(new Float32Array(16));function kl(w,n,u,_,b,T){const{horizontalAlign:I,verticalAlign:O}=c.aH(w);return new c.P((-(I-.5)*n/b+_[0])*T,(-(O-.5)*u/b+_[1])*T)}function rd(w,n,u,_,b,T){const I=n.tileAnchorPoint.add(new c.P(n.translation[0],n.translation[1]));if(n.pitchWithMap){let O=_.mult(T);u||(O=O.rotate(-b));const N=I.add(O);return Vi(N.x,N.y,n.pitchedLabelPlaneMatrix,n.getElevation).point}if(u){const O=zi(n.tileAnchorPoint.x+1,n.tileAnchorPoint.y,n).point.sub(w),N=Math.atan(O.y/O.x)+(O.x<0?Math.PI:0);return w.add(_.rotate(N))}return w.add(_)}function Wu(w,n,u,_,b,T,I,O,N,j,$,X){const W=w.text.placedSymbolArray,ee=w.text.dynamicLayoutVertexArray,ae=w.icon.dynamicLayoutVertexArray,_e={};ee.clear();for(let ge=0;ge<W.length;ge++){const ve=W.get(ge),Te=ve.hidden||!ve.crossTileID||w.allowVerticalPlacement&&!ve.placedOrientation?null:_[ve.crossTileID];if(Te){const Me=new c.P(ve.anchorX,ve.anchorY),Ae={getElevation:X,width:b.width,height:b.height,pitchedLabelPlaneMatrix:T,pitchWithMap:u,transform:b,tileAnchorPoint:Me,translation:j,unwrappedTileID:$},Le=u?Ui(Me.x,Me.y,Ae):zi(Me.x,Me.y,Ae),Ue=Ct(b.cameraToCenterDistance,Le.signedDistanceFromCamera);let Ce=c.ap(w.textSizeData,O,ve)*Ue/c.aB;u&&(Ce*=w.tilePixelRatio/I);const{width:We,height:dt,anchor:rt,textOffset:st,textBoxScale:ct}=Te,Ot=kl(rt,We,dt,st,ct,Ce),Bt=b.getPitchedTextCorrection(Me.x+j[0],Me.y+j[1],$),Et=rd(Le.point,Ae,n,Ot,-b.bearingInRadians,Bt),un=w.allowVerticalPlacement&&ve.placedOrientation===c.ao.vertical?Math.PI/2:0;for(let Kn=0;Kn<ve.numGlyphs;Kn++)c.av(ee,Et,un);N&&ve.associatedIconIndex>=0&&(_e[ve.associatedIconIndex]={shiftedAnchor:Et,angle:un})}else Fa(ve.numGlyphs,ee)}if(N){ae.clear();const ge=w.icon.placedSymbolArray;for(let ve=0;ve<ge.length;ve++){const Te=ge.get(ve);if(Te.hidden)Fa(Te.numGlyphs,ae);else{const Me=_e[ve];if(Me)for(let Ae=0;Ae<Te.numGlyphs;Ae++)c.av(ae,Me.shiftedAnchor,Me.angle);else Fa(Te.numGlyphs,ae)}}w.icon.dynamicLayoutVertexBuffer.updateData(ae)}w.text.dynamicLayoutVertexBuffer.updateData(ee)}function nl(w,n,u){return u.iconsInText&&n?"symbolTextAndIcon":w?"symbolSDF":"symbolIcon"}function il(w,n,u,_,b,T,I,O,N,j,$,X,W){const ee=w.context,ae=ee.gl,_e=w.transform,ge=O==="map",ve=N==="map",Te=O!=="viewport"&&u.layout.get("symbol-placement")!=="point",Me=ge&&!ve&&!Te,Ae=!u.layout.get("symbol-sort-key").isConstant();let Le=!1;const Ue=w.getDepthModeForSublayer(0,sn.ReadOnly),Ce=u._unevaluatedLayout.hasValue("text-variable-anchor")||u._unevaluatedLayout.hasValue("text-variable-anchor-offset"),We=[],dt=_e.getCircleRadiusCorrection();for(const rt of _){const st=n.getTile(rt),ct=st.getBucket(u);if(!ct)continue;const Ot=b?ct.text:ct.icon;if(!Ot||!Ot.segments.get().length||!Ot.hasVisibleVertices)continue;const Bt=Ot.programConfigurations.get(u.id),Et=b||ct.sdfIcons,un=b?ct.textSizeData:ct.iconSizeData,Kn=ve||_e.pitch!==0,yi=w.useProgram(nl(Et,b,ct),Bt),qi=c.an(un,_e.zoom),Ni=w.style.map.terrain&&w.style.map.terrain.getTerrainData(rt);let Fr,Rr,Hn,$i,Jr=[0,0],va=null;if(b)Rr=st.glyphAtlasTexture,Hn=ae.LINEAR,Fr=st.glyphAtlasTexture.size,ct.iconsInText&&(Jr=st.imageAtlasTexture.size,va=st.imageAtlasTexture,$i=Kn||w.options.rotating||w.options.zooming||un.kind==="composite"||un.kind==="camera"?ae.LINEAR:ae.NEAREST);else{const kr=u.layout.get("icon-size").constantOr(0)!==1||ct.iconsNeedLinear;Rr=st.imageAtlasTexture,Hn=Et||w.options.rotating||w.options.zooming||kr||Kn?ae.LINEAR:ae.NEAREST,Fr=st.imageAtlasTexture.size}const ka=c.aC(st,1,w.transform.zoom),io=Mi(ge,w.transform,ka),Nl=c.L();c.aq(Nl,io);const Su=vn(ve,ge,w.transform,ka),ll=c.aD(_e,st,T,I),nc=_e.getProjectionData({overscaledTileID:rt,applyGlobeMatrix:!W,applyTerrainMatrix:!0}),Eu=Ce&&ct.hasTextData(),ic=u.layout.get("icon-text-fit")!=="none"&&Eu&&ct.hasIconData();if(Te){const kr=w.style.map.terrain?(ro,Vr)=>w.style.map.terrain.getElevation(rt,ro,Vr):null,Zr=u.layout.get("text-rotation-alignment")==="map";tr(ct,w,b,io,Nl,ve,j,Zr,rt.toUnwrapped(),_e.width,_e.height,ll,kr)}const rc=b&&Ce||ic,rs=Te||rc?kc:ve?io:w.transform.clipSpaceToPixelsMatrix,ul=Et&&u.paint.get(b?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Ls;Ls=Et?ct.iconsInText?Zf(un.kind,qi,Me,ve,Te,rc,w,rs,Su,ll,Fr,Jr,dt):hh(un.kind,qi,Me,ve,Te,rc,w,rs,Su,ll,b,Fr,0,dt):qu(un.kind,qi,Me,ve,Te,rc,w,rs,Su,ll,b,Fr,dt);const ac={program:yi,buffers:Ot,uniformValues:Ls,projectionData:nc,atlasTexture:Rr,atlasTextureIcon:va,atlasInterpolation:Hn,atlasInterpolationIcon:$i,isSDF:Et,hasHalo:ul};if(Ae&&ct.canOverlap){Le=!0;const kr=Ot.segments.get();for(const Zr of kr)We.push({segments:new c.aM([Zr]),sortKey:Zr.sortKey,state:ac,terrainData:Ni})}else We.push({segments:Ot.segments,sortKey:0,state:ac,terrainData:Ni})}Le&&We.sort(((rt,st)=>rt.sortKey-st.sortKey));for(const rt of We){const st=rt.state;if(ee.activeTexture.set(ae.TEXTURE0),st.atlasTexture.bind(st.atlasInterpolation,ae.CLAMP_TO_EDGE),st.atlasTextureIcon&&(ee.activeTexture.set(ae.TEXTURE1),st.atlasTextureIcon&&st.atlasTextureIcon.bind(st.atlasInterpolationIcon,ae.CLAMP_TO_EDGE)),st.isSDF){const ct=st.uniformValues;st.hasHalo&&(ct.u_is_halo=1,f(st.buffers,rt.segments,u,w,st.program,Ue,$,X,ct,st.projectionData,rt.terrainData)),ct.u_is_halo=0}f(st.buffers,rt.segments,u,w,st.program,Ue,$,X,st.uniformValues,st.projectionData,rt.terrainData)}}function f(w,n,u,_,b,T,I,O,N,j,$){const X=_.context;b.draw(X,X.gl.TRIANGLES,T,I,O,pn.backCCW,N,$,j,u.id,w.layoutVertexBuffer,w.indexBuffer,n,u.paint,_.transform.zoom,w.programConfigurations.get(u.id),w.dynamicLayoutVertexBuffer,w.opacityVertexBuffer)}function x(w,n,u,_,b){const T=w.context,I=T.gl,O=Jn.disabled,N=new Tn([I.ONE,I.ONE],c.bf.transparent,[!0,!0,!0,!0]),j=n.getBucket(u);if(!j)return;const $=_.key;let X=u.heatmapFbos.get($);X||(X=U(T,n.tileSize,n.tileSize),u.heatmapFbos.set($,X)),T.bindFramebuffer.set(X.framebuffer),T.viewport.set([0,0,n.tileSize,n.tileSize]),T.clear({color:c.bf.transparent});const W=j.programConfigurations.get(u.id),ee=w.useProgram("heatmap",W,!b),ae=w.transform.getProjectionData({overscaledTileID:n.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),_e=w.style.map.terrain.getTerrainData(_);ee.draw(T,I.TRIANGLES,sn.disabled,O,N,pn.disabled,Gd(n,w.transform.zoom,u.paint.get("heatmap-intensity"),1),_e,ae,u.id,j.layoutVertexBuffer,j.indexBuffer,j.segments,u.paint,w.transform.zoom,W)}function R(w,n,u,_,b){const T=w.context,I=T.gl,O=w.transform;T.setColorMode(w.colorModeForRenderPass());const N=K(T,n),j=u.key,$=n.heatmapFbos.get(j);if(!$)return;T.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,$.colorAttachment.get()),T.activeTexture.set(I.TEXTURE1),N.bind(I.LINEAR,I.CLAMP_TO_EDGE);const X=O.getProjectionData({overscaledTileID:u,applyTerrainMatrix:b,applyGlobeMatrix:!_});w.useProgram("heatmapTexture").draw(T,I.TRIANGLES,sn.disabled,Jn.disabled,w.colorModeForRenderPass(),pn.disabled,Xs(w,n,0,1),null,X,n.id,w.rasterBoundsBuffer,w.quadTriangleIndexBuffer,w.rasterBoundsSegments,n.paint,O.zoom),$.destroy(),n.heatmapFbos.delete(j)}function U(w,n,u){var _,b;const T=w.gl,I=T.createTexture();T.bindTexture(T.TEXTURE_2D,I),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_WRAP_S,T.CLAMP_TO_EDGE),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_WRAP_T,T.CLAMP_TO_EDGE),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_MIN_FILTER,T.LINEAR),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_MAG_FILTER,T.LINEAR);const O=(_=w.HALF_FLOAT)!==null&&_!==void 0?_:T.UNSIGNED_BYTE,N=(b=w.RGBA16F)!==null&&b!==void 0?b:T.RGBA;T.texImage2D(T.TEXTURE_2D,0,N,n,u,0,T.RGBA,O,null);const j=w.createFramebuffer(n,u,!1,!1);return j.colorAttachment.set(I),j}function K(w,n){return n.colorRampTexture||(n.colorRampTexture=new c.T(w,n.colorRamp,w.gl.RGBA)),n.colorRampTexture}function ue(w,n,u,_,b){if(!u||!_||!_.imageAtlas)return;const T=_.imageAtlas.patternPositions;let I=T[u.to.toString()],O=T[u.from.toString()];if(!I&&O&&(I=O),!O&&I&&(O=I),!I||!O){const N=b.getPaintProperty(n);I=T[N],O=T[N]}I&&O&&w.setConstantPatternPositions(I,O)}function Oe(w,n,u,_,b,T,I,O){const N=w.context.gl,j="fill-pattern",$=u.paint.get(j),X=$&&$.constantOr(1),W=u.getCrossfadeParameters();let ee,ae,_e,ge,ve;const Te=w.transform,Me=u.paint.get("fill-translate"),Ae=u.paint.get("fill-translate-anchor");I?(ae=X&&!u.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",ee=N.LINES):(ae=X?"fillPattern":"fill",ee=N.TRIANGLES);const Le=$.constantOr(null);for(const Ue of _){const Ce=n.getTile(Ue);if(X&&!Ce.patternsLoaded())continue;const We=Ce.getBucket(u);if(!We)continue;const dt=We.programConfigurations.get(u.id),rt=w.useProgram(ae,dt),st=w.style.map.terrain&&w.style.map.terrain.getTerrainData(Ue);X&&(w.context.activeTexture.set(N.TEXTURE0),Ce.imageAtlasTexture.bind(N.LINEAR,N.CLAMP_TO_EDGE),dt.updatePaintBuffers(W)),ue(dt,j,Le,Ce,u);const ct=Te.getProjectionData({overscaledTileID:Ue,applyGlobeMatrix:!O,applyTerrainMatrix:!0}),Ot=c.aD(Te,Ce,Me,Ae);if(I){ge=We.indexBuffer2,ve=We.segments2;const Et=[N.drawingBufferWidth,N.drawingBufferHeight];_e=ae==="fillOutlinePattern"&&X?Ua(w,W,Ce,Et,Ot):Ca(Et,Ot)}else ge=We.indexBuffer,ve=We.segments,_e=X?ur(w,W,Ce,Ot):{u_fill_translate:Ot};const Bt=w.stencilModeForClipping(Ue);rt.draw(w.context,ee,b,Bt,T,pn.backCCW,_e,st,ct,u.id,We.layoutVertexBuffer,ge,ve,u.paint,w.transform.zoom,dt)}}function nt(w,n,u,_,b,T,I,O){const N=w.context,j=N.gl,$="fill-extrusion-pattern",X=u.paint.get($),W=X.constantOr(1),ee=u.getCrossfadeParameters(),ae=u.paint.get("fill-extrusion-opacity"),_e=X.constantOr(null),ge=w.transform;for(const ve of _){const Te=n.getTile(ve),Me=Te.getBucket(u);if(!Me)continue;const Ae=w.style.map.terrain&&w.style.map.terrain.getTerrainData(ve),Le=Me.programConfigurations.get(u.id),Ue=w.useProgram(W?"fillExtrusionPattern":"fillExtrusion",Le);W&&(w.context.activeTexture.set(j.TEXTURE0),Te.imageAtlasTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE),Le.updatePaintBuffers(ee));const Ce=ge.getProjectionData({overscaledTileID:ve,applyGlobeMatrix:!O,applyTerrainMatrix:!0});ue(Le,$,_e,Te,u);const We=c.aD(ge,Te,u.paint.get("fill-extrusion-translate"),u.paint.get("fill-extrusion-translate-anchor")),dt=u.paint.get("fill-extrusion-vertical-gradient"),rt=W?Ri(w,dt,ae,We,ve,ee,Te):$n(w,dt,ae,We);Ue.draw(N,N.gl.TRIANGLES,b,T,I,pn.backCCW,rt,Ae,Ce,u.id,Me.layoutVertexBuffer,Me.indexBuffer,Me.segments,u.paint,w.transform.zoom,Le,w.style.map.terrain&&Me.centroidVertexBuffer)}}function mt(w,n,u,_,b,T,I,O,N){var j;const $=w.style.projection,X=w.context,W=w.transform,ee=X.gl,ae=[`#define NUM_ILLUMINATION_SOURCES ${u.paint.get("hillshade-highlight-color").values.length}`],_e=w.useProgram("hillshade",null,!1,ae),ge=!w.options.moving;for(const ve of _){const Te=n.getTile(ve),Me=Te.fbo;if(!Me)continue;const Ae=$.getMeshFromTileID(X,ve.canonical,O,!0,"raster"),Le=(j=w.style.map.terrain)===null||j===void 0?void 0:j.getTerrainData(ve);X.activeTexture.set(ee.TEXTURE0),ee.bindTexture(ee.TEXTURE_2D,Me.colorAttachment.get());const Ue=W.getProjectionData({overscaledTileID:ve,aligned:ge,applyGlobeMatrix:!N,applyTerrainMatrix:!0});_e.draw(X,ee.TRIANGLES,T,b[ve.overscaledZ],I,pn.backCCW,fu(w,Te,u),Le,Ue,u.id,Ae.vertexBuffer,Ae.indexBuffer,Ae.segments)}}function Rt(w,n,u,_,b,T,I,O,N){var j;const $=w.style.projection,X=w.context,W=w.transform,ee=X.gl,ae=w.useProgram("colorRelief"),_e=!w.options.moving;let ge=!0,ve=0;for(const Te of _){const Me=n.getTile(Te),Ae=Me.dem;if(ge){const rt=ee.getParameter(ee.MAX_TEXTURE_SIZE),{elevationTexture:st,colorTexture:ct}=u.getColorRampTextures(X,rt,Ae.getUnpackVector());X.activeTexture.set(ee.TEXTURE1),st.bind(ee.NEAREST,ee.CLAMP_TO_EDGE),X.activeTexture.set(ee.TEXTURE4),ct.bind(ee.LINEAR,ee.CLAMP_TO_EDGE),ge=!1,ve=st.size[0]}if(!Ae||!Ae.data)continue;const Le=Ae.stride,Ue=Ae.getPixels();if(X.activeTexture.set(ee.TEXTURE0),X.pixelStoreUnpackPremultiplyAlpha.set(!1),Me.demTexture=Me.demTexture||w.getTileTexture(Le),Me.demTexture){const rt=Me.demTexture;rt.update(Ue,{premultiply:!1}),rt.bind(ee.LINEAR,ee.CLAMP_TO_EDGE)}else Me.demTexture=new c.T(X,Ue,ee.RGBA,{premultiply:!1}),Me.demTexture.bind(ee.LINEAR,ee.CLAMP_TO_EDGE);const Ce=$.getMeshFromTileID(X,Te.canonical,O,!0,"raster"),We=(j=w.style.map.terrain)===null||j===void 0?void 0:j.getTerrainData(Te),dt=W.getProjectionData({overscaledTileID:Te,aligned:_e,applyGlobeMatrix:!N,applyTerrainMatrix:!0});ae.draw(X,ee.TRIANGLES,T,b[Te.overscaledZ],I,pn.backCCW,ju(u,Me.dem,ve),We,dt,u.id,Ce.vertexBuffer,Ce.indexBuffer,Ce.segments)}}const Jt=[new c.P(0,0),new c.P(c.$,0),new c.P(c.$,c.$),new c.P(0,c.$)];function on(w,n,u,_,b,T,I,O,N=!1,j=!1){const $=_[_.length-1].overscaledZ,X=w.context,W=X.gl,ee=w.useProgram("raster"),ae=w.transform,_e=w.style.projection,ge=w.colorModeForRenderPass(),ve=!w.options.moving;for(const Te of _){const Me=w.getDepthModeForSublayer(Te.overscaledZ-$,u.paint.get("raster-opacity")===1?sn.ReadWrite:sn.ReadOnly,W.LESS),Ae=n.getTile(Te);Ae.registerFadeDuration(u.paint.get("raster-fade-duration"));const Le=n.findLoadedParent(Te,0),Ue=n.findLoadedSibling(Te),Ce=_n(Ae,Le||Ue||null,n,u,w.transform,w.style.map.terrain);let We,dt;const rt=u.paint.get("raster-resampling")==="nearest"?W.NEAREST:W.LINEAR;X.activeTexture.set(W.TEXTURE0),Ae.texture.bind(rt,W.CLAMP_TO_EDGE,W.LINEAR_MIPMAP_NEAREST),X.activeTexture.set(W.TEXTURE1),Le?(Le.texture.bind(rt,W.CLAMP_TO_EDGE,W.LINEAR_MIPMAP_NEAREST),We=Math.pow(2,Le.tileID.overscaledZ-Ae.tileID.overscaledZ),dt=[Ae.tileID.canonical.x*We%1,Ae.tileID.canonical.y*We%1]):Ae.texture.bind(rt,W.CLAMP_TO_EDGE,W.LINEAR_MIPMAP_NEAREST),Ae.texture.useMipmap&&X.extTextureFilterAnisotropic&&w.transform.pitch>20&&W.texParameterf(W.TEXTURE_2D,X.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,X.extTextureFilterAnisotropicMax);const st=w.style.map.terrain&&w.style.map.terrain.getTerrainData(Te),ct=ae.getProjectionData({overscaledTileID:Te,aligned:ve,applyGlobeMatrix:!j,applyTerrainMatrix:!0}),Ot=Ks(dt||[0,0],We||1,Ce,u,O),Bt=_e.getMeshFromTileID(X,Te.canonical,T,I,"raster");ee.draw(X,W.TRIANGLES,Me,b?b[Te.overscaledZ]:Jn.disabled,ge,N?pn.frontCCW:pn.backCCW,Ot,st,ct,u.id,Bt.vertexBuffer,Bt.indexBuffer,Bt.segments)}}function _n(w,n,u,_,b,T){const I=_.paint.get("raster-fade-duration");if(!T&&I>0){const O=Y.now(),N=(O-w.timeAdded)/I,j=n?(O-n.timeAdded)/I:-1,$=u.getSource(),X=en(b,{tileSize:$.tileSize,roundZoom:$.roundZoom}),W=!n||Math.abs(n.tileID.overscaledZ-X)>Math.abs(w.tileID.overscaledZ-X),ee=W&&w.refreshedUponExpiration?1:c.ah(W?N:1-j,0,1);return w.refreshedUponExpiration&&N>=1&&(w.refreshedUponExpiration=!1),n?{opacity:1,mix:1-ee}:{opacity:ee,mix:0}}return{opacity:1,mix:0}}const Zn=new c.bf(1,0,0,1),cr=new c.bf(0,1,0,1),mr=new c.bf(0,0,1,1),_a=new c.bf(1,0,1,1),wo=new c.bf(0,1,1,1);function ph(w,n,u,_){Ps(w,0,n+u/2,w.transform.width,u,_)}function gr(w,n,u,_){Ps(w,n-u/2,0,u,w.transform.height,_)}function Ps(w,n,u,_,b,T){const I=w.context,O=I.gl;O.enable(O.SCISSOR_TEST),O.scissor(n*w.pixelRatio,u*w.pixelRatio,_*w.pixelRatio,b*w.pixelRatio),I.clear({color:T}),O.disable(O.SCISSOR_TEST)}function Ma(w,n,u){const _=w.context,b=_.gl,T=w.useProgram("debug"),I=sn.disabled,O=Jn.disabled,N=w.colorModeForRenderPass(),j="$debug",$=w.style.map.terrain&&w.style.map.terrain.getTerrainData(u);_.activeTexture.set(b.TEXTURE0);const X=n.getTileByID(u.key).latestRawTileData,W=Math.floor((X&&X.byteLength||0)/1024),ee=n.getTile(u).tileSize,ae=512/Math.min(ee,512)*(u.overscaledZ/w.transform.zoom)*.5;let _e=u.canonical.toString();u.overscaledZ!==u.canonical.z&&(_e+=` => ${u.overscaledZ}`),(function(ve,Te){ve.initDebugOverlayCanvas();const Me=ve.debugOverlayCanvas,Ae=ve.context.gl,Le=ve.debugOverlayCanvas.getContext("2d");Le.clearRect(0,0,Me.width,Me.height),Le.shadowColor="white",Le.shadowBlur=2,Le.lineWidth=1.5,Le.strokeStyle="white",Le.textBaseline="top",Le.font="bold 36px Open Sans, sans-serif",Le.fillText(Te,5,5),Le.strokeText(Te,5,5),ve.debugOverlayTexture.update(Me),ve.debugOverlayTexture.bind(Ae.LINEAR,Ae.CLAMP_TO_EDGE)})(w,`${_e} ${W}kB`);const ge=w.transform.getProjectionData({overscaledTileID:u,applyGlobeMatrix:!0,applyTerrainMatrix:!0});T.draw(_,b.TRIANGLES,I,O,Tn.alphaBlended,pn.disabled,yo(c.bf.transparent,ae),null,ge,j,w.debugBuffer,w.quadTriangleIndexBuffer,w.debugSegments),T.draw(_,b.LINE_STRIP,I,O,N,pn.disabled,yo(c.bf.red),$,ge,j,w.debugBuffer,w.tileBorderIndexBuffer,w.debugSegments)}function Lc(w,n,u,_){const{isRenderingGlobe:b}=_,T=w.context,I=T.gl,O=w.transform,N=w.colorModeForRenderPass(),j=w.getDepthModeFor3D(),$=w.useProgram("terrain");T.bindFramebuffer.set(null),T.viewport.set([0,0,w.width,w.height]);for(const X of u){const W=n.getTerrainMesh(X.tileID),ee=w.renderToTexture.getTexture(X),ae=n.getTerrainData(X.tileID);T.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,ee.texture);const _e=n.getMeshFrameDelta(O.zoom),ge=O.calculateFogMatrix(X.tileID.toUnwrapped()),ve=ye(_e,ge,w.style.sky,O.pitch,b),Te=O.getProjectionData({overscaledTileID:X.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});$.draw(T,I.TRIANGLES,j,Jn.disabled,N,pn.backCCW,ve,ae,Te,"terrain",W.vertexBuffer,W.indexBuffer,W.segments)}}function rl(w,n){if(!n.mesh){const u=new c.aL;u.emplaceBack(-1,-1),u.emplaceBack(1,-1),u.emplaceBack(1,1),u.emplaceBack(-1,1);const _=new c.aN;_.emplaceBack(0,1,2),_.emplaceBack(0,2,3),n.mesh=new Qa(w.createVertexBuffer(u,Ja.members),w.createIndexBuffer(_),c.aM.simpleSegment(0,0,u.length,_.length))}return n.mesh}class Pr{constructor(n,u){this.context=new Rc(n),this.transform=u,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:c.ag(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Fn.maxUnderzooming+Fn.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Ya}resize(n,u,_){if(this.width=Math.floor(n*_),this.height=Math.floor(u*_),this.pixelRatio=_,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const b of this.style._order)this.style._layers[b].resize()}setup(){const n=this.context,u=new c.aL;u.emplaceBack(0,0),u.emplaceBack(c.$,0),u.emplaceBack(0,c.$),u.emplaceBack(c.$,c.$),this.tileExtentBuffer=n.createVertexBuffer(u,Ja.members),this.tileExtentSegments=c.aM.simpleSegment(0,0,4,2);const _=new c.aL;_.emplaceBack(0,0),_.emplaceBack(c.$,0),_.emplaceBack(0,c.$),_.emplaceBack(c.$,c.$),this.debugBuffer=n.createVertexBuffer(_,Ja.members),this.debugSegments=c.aM.simpleSegment(0,0,4,5);const b=new c.c6;b.emplaceBack(0,0,0,0),b.emplaceBack(c.$,0,c.$,0),b.emplaceBack(0,c.$,0,c.$),b.emplaceBack(c.$,c.$,c.$,c.$),this.rasterBoundsBuffer=n.createVertexBuffer(b,G.members),this.rasterBoundsSegments=c.aM.simpleSegment(0,0,4,2);const T=new c.aL;T.emplaceBack(0,0),T.emplaceBack(c.$,0),T.emplaceBack(0,c.$),T.emplaceBack(c.$,c.$),this.rasterBoundsBufferPosOnly=n.createVertexBuffer(T,Ja.members),this.rasterBoundsSegmentsPosOnly=c.aM.simpleSegment(0,0,4,5);const I=new c.aL;I.emplaceBack(0,0),I.emplaceBack(1,0),I.emplaceBack(0,1),I.emplaceBack(1,1),this.viewportBuffer=n.createVertexBuffer(I,Ja.members),this.viewportSegments=c.aM.simpleSegment(0,0,4,2);const O=new c.c7;O.emplaceBack(0),O.emplaceBack(1),O.emplaceBack(3),O.emplaceBack(2),O.emplaceBack(0),this.tileBorderIndexBuffer=n.createIndexBuffer(O);const N=new c.aN;N.emplaceBack(1,0,2),N.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=n.createIndexBuffer(N);const j=this.context.gl;this.stencilClearMode=new Jn({func:j.ALWAYS,mask:0},0,255,j.ZERO,j.ZERO,j.ZERO),this.tileExtentMesh=new Qa(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const n=this.context,u=n.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const _=c.L();c.bY(_,0,this.width,this.height,0,0,1),c.N(_,_,[u.drawingBufferWidth,u.drawingBufferHeight,0]);const b={mainMatrix:_,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:_};this.useProgram("clippingMask",null,!0).draw(n,u.TRIANGLES,sn.disabled,this.stencilClearMode,Tn.disabled,pn.disabled,null,null,b,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(n,u,_){if(this.currentStencilSource===n.source||!n.isTileClipped()||!u||!u.length)return;this.currentStencilSource=n.source,this.nextStencilID+u.length>256&&this.clearStencil();const b=this.context;b.setColorMode(Tn.disabled),b.setDepthMode(sn.disabled);const T={};for(const I of u)T[I.key]=this.nextStencilID++;this._renderTileMasks(T,u,_,!0),this._renderTileMasks(T,u,_,!1),this._tileClippingMaskIDs=T}_renderTileMasks(n,u,_,b){const T=this.context,I=T.gl,O=this.style.projection,N=this.transform,j=this.useProgram("clippingMask");for(const $ of u){const X=n[$.key],W=this.style.map.terrain&&this.style.map.terrain.getTerrainData($),ee=O.getMeshFromTileID(this.context,$.canonical,b,!0,"stencil"),ae=N.getProjectionData({overscaledTileID:$,applyGlobeMatrix:!_,applyTerrainMatrix:!0});j.draw(T,I.TRIANGLES,sn.disabled,new Jn({func:I.ALWAYS,mask:0},X,255,I.KEEP,I.KEEP,I.REPLACE),Tn.disabled,_?pn.disabled:pn.backCCW,null,W,ae,"$clipping",ee.vertexBuffer,ee.indexBuffer,ee.segments)}}_renderTilesDepthBuffer(){const n=this.context,u=n.gl,_=this.style.projection,b=this.transform,T=this.useProgram("depth"),I=this.getDepthModeFor3D(),O=qe(b,{tileSize:b.tileSize});for(const N of O){const j=this.style.map.terrain&&this.style.map.terrain.getTerrainData(N),$=_.getMeshFromTileID(this.context,N.canonical,!0,!0,"raster"),X=b.getProjectionData({overscaledTileID:N,applyGlobeMatrix:!0,applyTerrainMatrix:!0});T.draw(n,u.TRIANGLES,I,Jn.disabled,Tn.disabled,pn.backCCW,null,j,X,"$clipping",$.vertexBuffer,$.indexBuffer,$.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const n=this.nextStencilID++,u=this.context.gl;return new Jn({func:u.NOTEQUAL,mask:255},n,255,u.KEEP,u.KEEP,u.REPLACE)}stencilModeForClipping(n){const u=this.context.gl;return new Jn({func:u.EQUAL,mask:255},this._tileClippingMaskIDs[n.key],0,u.KEEP,u.KEEP,u.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(n){const u=this.context.gl,_=n.sort(((I,O)=>O.overscaledZ-I.overscaledZ)),b=_[_.length-1].overscaledZ,T=_[0].overscaledZ-b+1;if(T>1){this.currentStencilSource=void 0,this.nextStencilID+T>256&&this.clearStencil();const I={};for(let O=0;O<T;O++)I[O+b]=new Jn({func:u.GEQUAL,mask:255},O+this.nextStencilID,255,u.KEEP,u.KEEP,u.REPLACE);return this.nextStencilID+=T,[I,_]}return[{[b]:Jn.disabled},_]}stencilConfigForOverlapTwoPass(n){const u=this.context.gl,_=n.sort(((I,O)=>O.overscaledZ-I.overscaledZ)),b=_[_.length-1].overscaledZ,T=_[0].overscaledZ-b+1;if(this.clearStencil(),T>1){const I={},O={};for(let N=0;N<T;N++)I[N+b]=new Jn({func:u.GREATER,mask:255},T+1+N,255,u.KEEP,u.KEEP,u.REPLACE),O[N+b]=new Jn({func:u.GREATER,mask:255},1+N,255,u.KEEP,u.KEEP,u.REPLACE);return this.nextStencilID=2*T+1,[I,O,_]}return this.nextStencilID=3,[{[b]:new Jn({func:u.GREATER,mask:255},2,255,u.KEEP,u.KEEP,u.REPLACE)},{[b]:new Jn({func:u.GREATER,mask:255},1,255,u.KEEP,u.KEEP,u.REPLACE)},_]}colorModeForRenderPass(){const n=this.context.gl;return this._showOverdrawInspector?new Tn([n.CONSTANT_COLOR,n.ONE],new c.bf(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Tn.unblended:Tn.alphaBlended}getDepthModeForSublayer(n,u,_){if(!this.opaquePassEnabledForLayer())return sn.disabled;const b=1-((1+this.currentLayer)*this.numSublayers+n)*this.depthEpsilon;return new sn(_||this.context.gl.LEQUAL,u,[b,b])}getDepthModeFor3D(){return new sn(this.context.gl.LEQUAL,sn.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(n,u){var _,b;this.style=n,this.options=u,this.lineAtlas=n.lineAtlas,this.imageManager=n.imageManager,this.glyphManager=n.glyphManager,this.symbolFadeChange=n.placement.symbolFadeChange(Y.now()),this.imageManager.beginFrame();const T=this.style._order,I=this.style.sourceCaches,O={},N={},j={},$={isRenderingToTexture:!1,isRenderingGlobe:((_=n.projection)===null||_===void 0?void 0:_.transitionState)>0};for(const W in I){const ee=I[W];ee.used&&ee.prepare(this.context),O[W]=ee.getVisibleCoordinates(!1),N[W]=O[W].slice().reverse(),j[W]=ee.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let W=0;W<T.length;W++)if(this.style._layers[T[W]].is3D()){this.opaquePassCutoff=W;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const W of T){const ee=this.style._layers[W];if(!ee.hasOffscreenPass()||ee.isHidden(this.transform.zoom))continue;const ae=N[ee.source];(ee.type==="custom"||ae.length)&&this.renderLayer(this,I[ee.source],ee,ae,$)}if((b=this.style.projection)===null||b===void 0||b.updateGPUdependent({context:this.context,useProgram:W=>this.useProgram(W)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:u.showOverdrawInspector?c.bf.black:c.bf.transparent,depth:1}),this.clearStencil(),this.style.sky&&(function(W,ee){const ae=W.context,_e=ae.gl,ge=((Ue,Ce,We)=>{const dt=Math.cos(Ce.rollInRadians),rt=Math.sin(Ce.rollInRadians),st=Ne(Ce),ct=Ce.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:Ue.properties.get("sky-color"),u_horizon_color:Ue.properties.get("horizon-color"),u_horizon:[(Ce.width/2-st*rt)*We,(Ce.height/2+st*dt)*We],u_horizon_normal:[-rt,dt],u_sky_horizon_blend:Ue.properties.get("sky-horizon-blend")*Ce.height/2*We,u_sky_blend:ct}})(ee,W.style.map.transform,W.pixelRatio),ve=new sn(_e.LEQUAL,sn.ReadWrite,[0,1]),Te=Jn.disabled,Me=W.colorModeForRenderPass(),Ae=W.useProgram("sky"),Le=rl(ae,ee);Ae.draw(ae,_e.TRIANGLES,ve,Te,Me,pn.disabled,ge,null,void 0,"sky",Le.vertexBuffer,Le.indexBuffer,Le.segments)})(this,this.style.sky),this._showOverdrawInspector=u.showOverdrawInspector,this.depthRangeFor3D=[0,1-(n._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=T.length-1;this.currentLayer>=0;this.currentLayer--){const W=this.style._layers[T[this.currentLayer]],ee=I[W.source],ae=O[W.source];this._renderTileClippingMasks(W,ae,!1),this.renderLayer(this,ee,W,ae,$)}this.renderPass="translucent";let X=!1;for(this.currentLayer=0;this.currentLayer<T.length;this.currentLayer++){const W=this.style._layers[T[this.currentLayer]],ee=I[W.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(W,$))continue;this.opaquePassEnabledForLayer()||X||(X=!0,$.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const ae=(W.type==="symbol"?j:N)[W.source];this._renderTileClippingMasks(W,O[W.source],!!this.renderToTexture),this.renderLayer(this,ee,W,ae,$)}if($.isRenderingGlobe&&(function(W,ee,ae){const _e=W.context,ge=_e.gl,ve=W.useProgram("atmosphere"),Te=new sn(ge.LEQUAL,sn.ReadOnly,[0,1]),Me=W.transform,Ae=(function(ct,Ot){const Bt=ct.properties.get("position"),Et=[-Bt.x,-Bt.y,-Bt.z],un=c.ag(new Float64Array(16));return ct.properties.get("anchor")==="map"&&(c.b6(un,un,Ot.rollInRadians),c.b7(un,un,-Ot.pitchInRadians),c.b6(un,un,Ot.bearingInRadians),c.b7(un,un,Ot.center.lat*Math.PI/180),c.bz(un,un,-Ot.center.lng*Math.PI/180)),c.c5(Et,Et,un),Et})(ae,W.transform),Le=Me.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),Ue=ee.properties.get("atmosphere-blend")*Le.projectionTransition;if(Ue===0)return;const Ce=Ts(Me.worldSize,Me.center.lat),We=Me.inverseProjectionMatrix,dt=new Float64Array(4);dt[3]=1,c.aw(dt,dt,Me.modelViewProjectionMatrix),dt[0]/=dt[3],dt[1]/=dt[3],dt[2]/=dt[3],dt[3]=1,c.aw(dt,dt,We),dt[0]/=dt[3],dt[1]/=dt[3],dt[2]/=dt[3],dt[3]=1;const rt=((ct,Ot,Bt,Et,un)=>({u_sun_pos:ct,u_atmosphere_blend:Ot,u_globe_position:Bt,u_globe_radius:Et,u_inv_proj_matrix:un}))(Ae,Ue,[dt[0],dt[1],dt[2]],Ce,We),st=rl(_e,ee);ve.draw(_e,ge.TRIANGLES,Te,Jn.disabled,Tn.alphaBlended,pn.disabled,rt,null,null,"atmosphere",st.vertexBuffer,st.indexBuffer,st.segments)})(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const W=(function(ee,ae){let _e=null;const ge=Object.values(ee._layers).flatMap((Ae=>Ae.source&&!Ae.isHidden(ae)?[ee.sourceCaches[Ae.source]]:[])),ve=ge.filter((Ae=>Ae.getSource().type==="vector")),Te=ge.filter((Ae=>Ae.getSource().type!=="vector")),Me=Ae=>{(!_e||_e.getSource().maxzoom<Ae.getSource().maxzoom)&&(_e=Ae)};return ve.forEach((Ae=>Me(Ae))),_e||Te.forEach((Ae=>Me(Ae))),_e})(this.style,this.transform.zoom);W&&(function(ee,ae,_e){for(let ge=0;ge<_e.length;ge++)Ma(ee,ae,_e[ge])})(this,W,W.getVisibleCoordinates())}this.options.showPadding&&(function(W){const ee=W.transform.padding;ph(W,W.transform.height-(ee.top||0),3,Zn),ph(W,ee.bottom||0,3,cr),gr(W,ee.left||0,3,mr),gr(W,W.transform.width-(ee.right||0),3,_a);const ae=W.transform.centerPoint;(function(_e,ge,ve,Te){Ps(_e,ge-1,ve-10,2,20,Te),Ps(_e,ge-10,ve-1,20,2,Te)})(W,ae.x,W.transform.height-ae.y,wo)})(this),this.context.setDefault()}maybeDrawDepthAndCoords(n){if(!this.style||!this.style.map||!this.style.map.terrain)return;const u=this.terrainFacilitator.matrix,_=this.transform.modelViewProjectionMatrix;let b=this.terrainFacilitator.dirty;b||(b=n?!c.c8(u,_):!c.c9(u,_)),b||(b=this.style.map.terrain.sourceCache.anyTilesAfterTime(this.terrainFacilitator.renderTime)),b&&(c.ca(u,_),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,(function(T,I){const O=T.context,N=O.gl,j=T.transform,$=Tn.unblended,X=new sn(N.LEQUAL,sn.ReadWrite,[0,1]),W=I.sourceCache.getRenderableTiles(),ee=T.useProgram("terrainDepth");O.bindFramebuffer.set(I.getFramebuffer("depth").framebuffer),O.viewport.set([0,0,T.width/devicePixelRatio,T.height/devicePixelRatio]),O.clear({color:c.bf.transparent,depth:1});for(const ae of W){const _e=I.getTerrainMesh(ae.tileID),ge=I.getTerrainData(ae.tileID),ve=j.getProjectionData({overscaledTileID:ae.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),Te={u_ele_delta:I.getMeshFrameDelta(j.zoom)};ee.draw(O,N.TRIANGLES,X,Jn.disabled,$,pn.backCCW,Te,ge,ve,"terrain",_e.vertexBuffer,_e.indexBuffer,_e.segments)}O.bindFramebuffer.set(null),O.viewport.set([0,0,T.width,T.height])})(this,this.style.map.terrain),(function(T,I){const O=T.context,N=O.gl,j=T.transform,$=Tn.unblended,X=new sn(N.LEQUAL,sn.ReadWrite,[0,1]),W=I.getCoordsTexture(),ee=I.sourceCache.getRenderableTiles(),ae=T.useProgram("terrainCoords");O.bindFramebuffer.set(I.getFramebuffer("coords").framebuffer),O.viewport.set([0,0,T.width/devicePixelRatio,T.height/devicePixelRatio]),O.clear({color:c.bf.transparent,depth:1}),I.coordsIndex=[];for(const _e of ee){const ge=I.getTerrainMesh(_e.tileID),ve=I.getTerrainData(_e.tileID);O.activeTexture.set(N.TEXTURE0),N.bindTexture(N.TEXTURE_2D,W.texture);const Te={u_terrain_coords_id:(255-I.coordsIndex.length)/255,u_texture:0,u_ele_delta:I.getMeshFrameDelta(j.zoom)},Me=j.getProjectionData({overscaledTileID:_e.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});ae.draw(O,N.TRIANGLES,X,Jn.disabled,$,pn.backCCW,Te,ve,Me,"terrain",ge.vertexBuffer,ge.indexBuffer,ge.segments),I.coordsIndex.push(_e.tileID.key)}O.bindFramebuffer.set(null),O.viewport.set([0,0,T.width,T.height])})(this,this.style.map.terrain))}renderLayer(n,u,_,b,T){_.isHidden(this.transform.zoom)||(_.type==="background"||_.type==="custom"||(b||[]).length)&&(this.id=_.id,c.cb(_)?(function(I,O,N,j,$,X){if(I.renderPass!=="translucent")return;const{isRenderingToTexture:W}=X,ee=Jn.disabled,ae=I.colorModeForRenderPass();(N._unevaluatedLayout.hasValue("text-variable-anchor")||N._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&(function(_e,ge,ve,Te,Me,Ae,Le,Ue,Ce){const We=ge.transform,dt=ge.style.map.terrain,rt=Me==="map",st=Ae==="map";for(const ct of _e){const Ot=Te.getTile(ct),Bt=Ot.getBucket(ve);if(!Bt||!Bt.text||!Bt.text.segments.get().length)continue;const Et=c.an(Bt.textSizeData,We.zoom),un=c.aC(Ot,1,ge.transform.zoom),Kn=Mi(rt,ge.transform,un),yi=ve.layout.get("icon-text-fit")!=="none"&&Bt.hasIconData();if(Et){const qi=Math.pow(2,We.zoom-Ot.tileID.overscaledZ),Ni=dt?(Fr,Rr)=>dt.getElevation(ct,Fr,Rr):null;Wu(Bt,rt,st,Ce,We,Kn,qi,Et,yi,c.aD(We,Ot,Le,Ue),ct.toUnwrapped(),Ni)}}})(j,I,N,O,N.layout.get("text-rotation-alignment"),N.layout.get("text-pitch-alignment"),N.paint.get("text-translate"),N.paint.get("text-translate-anchor"),$),N.paint.get("icon-opacity").constantOr(1)!==0&&il(I,O,N,j,!1,N.paint.get("icon-translate"),N.paint.get("icon-translate-anchor"),N.layout.get("icon-rotation-alignment"),N.layout.get("icon-pitch-alignment"),N.layout.get("icon-keep-upright"),ee,ae,W),N.paint.get("text-opacity").constantOr(1)!==0&&il(I,O,N,j,!0,N.paint.get("text-translate"),N.paint.get("text-translate-anchor"),N.layout.get("text-rotation-alignment"),N.layout.get("text-pitch-alignment"),N.layout.get("text-keep-upright"),ee,ae,W),O.map.showCollisionBoxes&&(fh(I,O,N,j,!0),fh(I,O,N,j,!1))})(n,u,_,b,this.style.placement.variableOffsets,T):c.cc(_)?(function(I,O,N,j,$){if(I.renderPass!=="translucent")return;const{isRenderingToTexture:X}=$,W=N.paint.get("circle-opacity"),ee=N.paint.get("circle-stroke-width"),ae=N.paint.get("circle-stroke-opacity"),_e=!N.layout.get("circle-sort-key").isConstant();if(W.constantOr(1)===0&&(ee.constantOr(1)===0||ae.constantOr(1)===0))return;const ge=I.context,ve=ge.gl,Te=I.transform,Me=I.getDepthModeForSublayer(0,sn.ReadOnly),Ae=Jn.disabled,Le=I.colorModeForRenderPass(),Ue=[],Ce=Te.getCircleRadiusCorrection();for(let We=0;We<j.length;We++){const dt=j[We],rt=O.getTile(dt),st=rt.getBucket(N);if(!st)continue;const ct=N.paint.get("circle-translate"),Ot=N.paint.get("circle-translate-anchor"),Bt=c.aD(Te,rt,ct,Ot),Et=st.programConfigurations.get(N.id),un=I.useProgram("circle",Et),Kn=st.layoutVertexBuffer,yi=st.indexBuffer,qi=I.style.map.terrain&&I.style.map.terrain.getTerrainData(dt),Ni={programConfiguration:Et,program:un,layoutVertexBuffer:Kn,indexBuffer:yi,uniformValues:Ws(I,rt,N,Bt,Ce),terrainData:qi,projectionData:Te.getProjectionData({overscaledTileID:dt,applyGlobeMatrix:!X,applyTerrainMatrix:!0})};if(_e){const Fr=st.segments.get();for(const Rr of Fr)Ue.push({segments:new c.aM([Rr]),sortKey:Rr.sortKey,state:Ni})}else Ue.push({segments:st.segments,sortKey:0,state:Ni})}_e&&Ue.sort(((We,dt)=>We.sortKey-dt.sortKey));for(const We of Ue){const{programConfiguration:dt,program:rt,layoutVertexBuffer:st,indexBuffer:ct,uniformValues:Ot,terrainData:Bt,projectionData:Et}=We.state;rt.draw(ge,ve.TRIANGLES,Me,Ae,Le,pn.backCCW,Ot,Bt,Et,N.id,st,ct,We.segments,N.paint,I.transform.zoom,dt)}})(n,u,_,b,T):c.cd(_)?(function(I,O,N,j,$){if(N.paint.get("heatmap-opacity")===0)return;const X=I.context,{isRenderingToTexture:W,isRenderingGlobe:ee}=$;if(I.style.map.terrain){for(const ae of j){const _e=O.getTile(ae);O.hasRenderableParent(ae)||(I.renderPass==="offscreen"?x(I,_e,N,ae,ee):I.renderPass==="translucent"&&R(I,N,ae,W,ee))}X.viewport.set([0,0,I.width,I.height])}else I.renderPass==="offscreen"?(function(ae,_e,ge,ve){const Te=ae.context,Me=Te.gl,Ae=ae.transform,Le=Jn.disabled,Ue=new Tn([Me.ONE,Me.ONE],c.bf.transparent,[!0,!0,!0,!0]);(function(Ce,We,dt){const rt=Ce.gl;Ce.activeTexture.set(rt.TEXTURE1),Ce.viewport.set([0,0,We.width/4,We.height/4]);let st=dt.heatmapFbos.get(c.c2);st?(rt.bindTexture(rt.TEXTURE_2D,st.colorAttachment.get()),Ce.bindFramebuffer.set(st.framebuffer)):(st=U(Ce,We.width/4,We.height/4),dt.heatmapFbos.set(c.c2,st))})(Te,ae,ge),Te.clear({color:c.bf.transparent});for(let Ce=0;Ce<ve.length;Ce++){const We=ve[Ce];if(_e.hasRenderableParent(We))continue;const dt=_e.getTile(We),rt=dt.getBucket(ge);if(!rt)continue;const st=rt.programConfigurations.get(ge.id),ct=ae.useProgram("heatmap",st),Ot=Ae.getProjectionData({overscaledTileID:We,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),Bt=Ae.getCircleRadiusCorrection();ct.draw(Te,Me.TRIANGLES,sn.disabled,Le,Ue,pn.backCCW,Gd(dt,Ae.zoom,ge.paint.get("heatmap-intensity"),Bt),null,Ot,ge.id,rt.layoutVertexBuffer,rt.indexBuffer,rt.segments,ge.paint,Ae.zoom,st)}Te.viewport.set([0,0,ae.width,ae.height])})(I,O,N,j):I.renderPass==="translucent"&&(function(ae,_e){const ge=ae.context,ve=ge.gl;ge.setColorMode(ae.colorModeForRenderPass());const Te=_e.heatmapFbos.get(c.c2);Te&&(ge.activeTexture.set(ve.TEXTURE0),ve.bindTexture(ve.TEXTURE_2D,Te.colorAttachment.get()),ge.activeTexture.set(ve.TEXTURE1),K(ge,_e).bind(ve.LINEAR,ve.CLAMP_TO_EDGE),ae.useProgram("heatmapTexture").draw(ge,ve.TRIANGLES,sn.disabled,Jn.disabled,ae.colorModeForRenderPass(),pn.disabled,Xs(ae,_e,0,1),null,null,_e.id,ae.viewportBuffer,ae.quadTriangleIndexBuffer,ae.viewportSegments,_e.paint,ae.transform.zoom))})(I,N)})(n,u,_,b,T):c.ce(_)?(function(I,O,N,j,$){if(I.renderPass!=="translucent")return;const{isRenderingToTexture:X}=$,W=N.paint.get("line-opacity"),ee=N.paint.get("line-width");if(W.constantOr(1)===0||ee.constantOr(1)===0)return;const ae=I.getDepthModeForSublayer(0,sn.ReadOnly),_e=I.colorModeForRenderPass(),ge=N.paint.get("line-dasharray"),ve=N.paint.get("line-pattern"),Te=ve.constantOr(1),Me=N.paint.get("line-gradient"),Ae=N.getCrossfadeParameters(),Le=Te?"linePattern":ge?"lineSDF":Me?"lineGradient":"line",Ue=I.context,Ce=Ue.gl,We=I.transform;let dt=!0;for(const rt of j){const st=O.getTile(rt);if(Te&&!st.patternsLoaded())continue;const ct=st.getBucket(N);if(!ct)continue;const Ot=ct.programConfigurations.get(N.id),Bt=I.context.program.get(),Et=I.useProgram(Le,Ot),un=dt||Et.program!==Bt,Kn=I.style.map.terrain&&I.style.map.terrain.getTerrainData(rt),yi=ve.constantOr(null);if(yi&&st.imageAtlas){const Hn=st.imageAtlas,$i=Hn.patternPositions[yi.to.toString()],Jr=Hn.patternPositions[yi.from.toString()];$i&&Jr&&Ot.setConstantPatternPositions($i,Jr)}const qi=We.getProjectionData({overscaledTileID:rt,applyGlobeMatrix:!X,applyTerrainMatrix:!0}),Ni=We.getPixelScale(),Fr=Te?pu(I,st,N,Ni,Ae):ge?Il(I,st,N,Ni,ge,Ae):Me?Sc(I,st,N,Ni,ct.lineClipsArray.length):Al(I,st,N,Ni);if(Te)Ue.activeTexture.set(Ce.TEXTURE0),st.imageAtlasTexture.bind(Ce.LINEAR,Ce.CLAMP_TO_EDGE),Ot.updatePaintBuffers(Ae);else if(ge&&(un||I.lineAtlas.dirty))Ue.activeTexture.set(Ce.TEXTURE0),I.lineAtlas.bind(Ue);else if(Me){const Hn=ct.gradients[N.id];let $i=Hn.texture;if(N.gradientVersion!==Hn.version){let Jr=256;if(N.stepInterpolant){const va=O.getSource().maxzoom,ka=rt.canonical.z===va?Math.ceil(1<<I.transform.maxZoom-rt.canonical.z):1;Jr=c.ah(c.c3(ct.maxLineLength/c.$*1024*ka),256,Ue.maxTextureSize)}Hn.gradient=c.c4({expression:N.gradientExpression(),evaluationKey:"lineProgress",resolution:Jr,image:Hn.gradient||void 0,clips:ct.lineClipsArray}),Hn.texture?Hn.texture.update(Hn.gradient):Hn.texture=new c.T(Ue,Hn.gradient,Ce.RGBA),Hn.version=N.gradientVersion,$i=Hn.texture}Ue.activeTexture.set(Ce.TEXTURE0),$i.bind(N.stepInterpolant?Ce.NEAREST:Ce.LINEAR,Ce.CLAMP_TO_EDGE)}const Rr=I.stencilModeForClipping(rt);Et.draw(Ue,Ce.TRIANGLES,ae,Rr,_e,pn.disabled,Fr,Kn,qi,N.id,ct.layoutVertexBuffer,ct.indexBuffer,ct.segments,N.paint,I.transform.zoom,Ot,ct.layoutVertexBuffer2),dt=!1}})(n,u,_,b,T):c.cf(_)?(function(I,O,N,j,$){const X=N.paint.get("fill-color"),W=N.paint.get("fill-opacity");if(W.constantOr(1)===0)return;const{isRenderingToTexture:ee}=$,ae=I.colorModeForRenderPass(),_e=N.paint.get("fill-pattern"),ge=I.opaquePassEnabledForLayer()&&!_e.constantOr(1)&&X.constantOr(c.bf.transparent).a===1&&W.constantOr(0)===1?"opaque":"translucent";if(I.renderPass===ge){const ve=I.getDepthModeForSublayer(1,I.renderPass==="opaque"?sn.ReadWrite:sn.ReadOnly);Oe(I,O,N,j,ve,ae,!1,ee)}if(I.renderPass==="translucent"&&N.paint.get("fill-antialias")){const ve=I.getDepthModeForSublayer(N.getPaintProperty("fill-outline-color")?2:0,sn.ReadOnly);Oe(I,O,N,j,ve,ae,!0,ee)}})(n,u,_,b,T):c.cg(_)?(function(I,O,N,j,$){const X=N.paint.get("fill-extrusion-opacity");if(X===0)return;const{isRenderingToTexture:W}=$;if(I.renderPass==="translucent"){const ee=new sn(I.context.gl.LEQUAL,sn.ReadWrite,I.depthRangeFor3D);if(X!==1||N.paint.get("fill-extrusion-pattern").constantOr(1))nt(I,O,N,j,ee,Jn.disabled,Tn.disabled,W),nt(I,O,N,j,ee,I.stencilModeFor3D(),I.colorModeForRenderPass(),W);else{const ae=I.colorModeForRenderPass();nt(I,O,N,j,ee,Jn.disabled,ae,W)}}})(n,u,_,b,T):c.ch(_)?(function(I,O,N,j,$){if(I.renderPass!=="offscreen"&&I.renderPass!=="translucent")return;const{isRenderingToTexture:X}=$,W=I.context,ee=I.style.projection.useSubdivision,ae=I.getDepthModeForSublayer(0,sn.ReadOnly),_e=I.colorModeForRenderPass();if(I.renderPass==="offscreen")(function(ge,ve,Te,Me,Ae,Le,Ue){const Ce=ge.context,We=Ce.gl;for(const dt of Te){const rt=ve.getTile(dt),st=rt.dem;if(!st||!st.data||!rt.needsHillshadePrepare)continue;const ct=st.dim,Ot=st.stride,Bt=st.getPixels();if(Ce.activeTexture.set(We.TEXTURE1),Ce.pixelStoreUnpackPremultiplyAlpha.set(!1),rt.demTexture=rt.demTexture||ge.getTileTexture(Ot),rt.demTexture){const un=rt.demTexture;un.update(Bt,{premultiply:!1}),un.bind(We.NEAREST,We.CLAMP_TO_EDGE)}else rt.demTexture=new c.T(Ce,Bt,We.RGBA,{premultiply:!1}),rt.demTexture.bind(We.NEAREST,We.CLAMP_TO_EDGE);Ce.activeTexture.set(We.TEXTURE0);let Et=rt.fbo;if(!Et){const un=new c.T(Ce,{width:ct,height:ct,data:null},We.RGBA);un.bind(We.LINEAR,We.CLAMP_TO_EDGE),Et=rt.fbo=Ce.createFramebuffer(ct,ct,!0,!1),Et.colorAttachment.set(un.texture)}Ce.bindFramebuffer.set(Et.framebuffer),Ce.viewport.set([0,0,ct,ct]),ge.useProgram("hillshadePrepare").draw(Ce,We.TRIANGLES,Ae,Le,Ue,pn.disabled,nd(rt.tileID,st),null,null,Me.id,ge.rasterBoundsBuffer,ge.quadTriangleIndexBuffer,ge.rasterBoundsSegments),rt.needsHillshadePrepare=!1}})(I,O,j,N,ae,Jn.disabled,_e),W.viewport.set([0,0,I.width,I.height]);else if(I.renderPass==="translucent")if(ee){const[ge,ve,Te]=I.stencilConfigForOverlapTwoPass(j);mt(I,O,N,Te,ge,ae,_e,!1,X),mt(I,O,N,Te,ve,ae,_e,!0,X)}else{const[ge,ve]=I.getStencilConfigForOverlapAndUpdateStencilID(j);mt(I,O,N,ve,ge,ae,_e,!1,X)}})(n,u,_,b,T):c.ci(_)?(function(I,O,N,j,$){if(I.renderPass!=="translucent"||!j.length)return;const{isRenderingToTexture:X}=$,W=I.style.projection.useSubdivision,ee=I.getDepthModeForSublayer(0,sn.ReadOnly),ae=I.colorModeForRenderPass();if(W){const[_e,ge,ve]=I.stencilConfigForOverlapTwoPass(j);Rt(I,O,N,ve,_e,ee,ae,!1,X),Rt(I,O,N,ve,ge,ee,ae,!0,X)}else{const[_e,ge]=I.getStencilConfigForOverlapAndUpdateStencilID(j);Rt(I,O,N,ge,_e,ee,ae,!1,X)}})(n,u,_,b,T):c.cj(_)?(function(I,O,N,j,$){if(I.renderPass!=="translucent"||N.paint.get("raster-opacity")===0||!j.length)return;const{isRenderingToTexture:X}=$,W=O.getSource(),ee=I.style.projection.useSubdivision;if(W instanceof Fi)on(I,O,N,j,null,!1,!1,W.tileCoords,W.flippedWindingOrder,X);else if(ee){const[ae,_e,ge]=I.stencilConfigForOverlapTwoPass(j);on(I,O,N,ge,ae,!1,!0,Jt,!1,X),on(I,O,N,ge,_e,!0,!0,Jt,!1,X)}else{const[ae,_e]=I.getStencilConfigForOverlapAndUpdateStencilID(j);on(I,O,N,_e,ae,!1,!0,Jt,!1,X)}})(n,u,_,b,T):c.ck(_)?(function(I,O,N,j,$){const X=N.paint.get("background-color"),W=N.paint.get("background-opacity");if(W===0)return;const{isRenderingToTexture:ee}=$,ae=I.context,_e=ae.gl,ge=I.style.projection,ve=I.transform,Te=ve.tileSize,Me=N.paint.get("background-pattern");if(I.isPatternMissing(Me))return;const Ae=!Me&&X.a===1&&W===1&&I.opaquePassEnabledForLayer()?"opaque":"translucent";if(I.renderPass!==Ae)return;const Le=Jn.disabled,Ue=I.getDepthModeForSublayer(0,Ae==="opaque"?sn.ReadWrite:sn.ReadOnly),Ce=I.colorModeForRenderPass(),We=I.useProgram(Me?"backgroundPattern":"background"),dt=j||qe(ve,{tileSize:Te,terrain:I.style.map.terrain});Me&&(ae.activeTexture.set(_e.TEXTURE0),I.imageManager.bind(I.context));const rt=N.getCrossfadeParameters();for(const st of dt){const ct=ve.getProjectionData({overscaledTileID:st,applyGlobeMatrix:!ee,applyTerrainMatrix:!0}),Ot=Me?Zd(W,I,Me,{tileID:st,tileSize:Te},rt):Qo(W,X),Bt=I.style.map.terrain&&I.style.map.terrain.getTerrainData(st),Et=ge.getMeshFromTileID(ae,st.canonical,!1,!0,"raster");We.draw(ae,_e.TRIANGLES,Ue,Le,Ce,pn.backCCW,Ot,Bt,ct,N.id,Et.vertexBuffer,Et.indexBuffer,Et.segments)}})(n,0,_,b,T):c.cl(_)&&(function(I,O,N,j){const{isRenderingGlobe:$}=j,X=I.context,W=N.implementation,ee=I.style.projection,ae=I.transform,_e=ae.getProjectionDataForCustomLayer($),ge={farZ:ae.farZ,nearZ:ae.nearZ,fov:ae.fov*Math.PI/180,modelViewProjectionMatrix:ae.modelViewProjectionMatrix,projectionMatrix:ae.projectionMatrix,shaderData:{variantName:ee.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${ee.shaderPreludeCode.vertexSource}`,define:ee.shaderDefine},defaultProjectionData:_e},ve=W.renderingMode?W.renderingMode:"2d";if(I.renderPass==="offscreen"){const Te=W.prerender;Te&&(I.setCustomLayerDefaults(),X.setColorMode(I.colorModeForRenderPass()),Te.call(W,X.gl,ge),X.setDirty(),I.setBaseState())}else if(I.renderPass==="translucent"){I.setCustomLayerDefaults(),X.setColorMode(I.colorModeForRenderPass()),X.setStencilMode(Jn.disabled);const Te=ve==="3d"?I.getDepthModeFor3D():I.getDepthModeForSublayer(0,sn.ReadOnly);X.setDepthMode(Te),W.render(X.gl,ge),X.setDirty(),I.setBaseState(),X.bindFramebuffer.set(null)}})(n,0,_,T))}saveTileTexture(n){const u=this._tileTextures[n.size[0]];u?u.push(n):this._tileTextures[n.size[0]]=[n]}getTileTexture(n){const u=this._tileTextures[n];return u&&u.length>0?u.pop():null}isPatternMissing(n){if(!n)return!1;if(!n.from||!n.to)return!0;const u=this.imageManager.getPattern(n.from.toString()),_=this.imageManager.getPattern(n.to.toString());return!u||!_}useProgram(n,u,_=!1,b=[]){this.cache=this.cache||{};const T=!!this.style.map.terrain,I=this.style.projection,O=_?Cr.projectionMercator:I.shaderPreludeCode,N=_?vs:I.shaderDefine,j=n+(u?u.cacheKey:"")+`/${_?Gs:I.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(T?"/terrain":"")+(b?`/${b.join("/")}`:"");return this.cache[j]||(this.cache[j]=new Wt(this.context,Cr[n],u,ns[n],this._showOverdrawInspector,T,O,N,b)),this.cache[j]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const n=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(n.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new c.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:n,drawingBufferHeight:u}=this.context.gl;return this.width!==n||this.height!==u}}function qa(w,n){let u,_=!1,b=null,T=null;const I=()=>{b=null,_&&(w.apply(T,u),b=setTimeout(I,n),_=!1)};return(...O)=>(_=!0,T=this,u=O,b||I(),b)}class To{constructor(n){this._getCurrentHash=()=>{const u=window.location.hash.replace("#","");if(this._hashName){let _;return u.split("&").map((b=>b.split("="))).forEach((b=>{b[0]===this._hashName&&(_=b)})),(_&&_[1]||"").split("/")}return u.split("/")},this._onHashChange=()=>{const u=this._getCurrentHash();if(!this._isValidHash(u))return!1;const _=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(u[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+u[2],+u[1]],zoom:+u[0],bearing:_,pitch:+(u[4]||0)}),!0},this._updateHashUnthrottled=()=>{const u=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,u)},this._removeHash=()=>{const u=this._getCurrentHash();if(u.length===0)return;const _=u.join("/");let b=_;b.split("&").length>0&&(b=b.split("&")[0]),this._hashName&&(b=`${this._hashName}=${_}`);let T=window.location.hash.replace(b,"");T.startsWith("#&")?T=T.slice(0,1)+T.slice(2):T==="#"&&(T="");let I=window.location.href.replace(/(#.+)?$/,T);I=I.replace("&&","&"),window.history.replaceState(window.history.state,null,I)},this._updateHash=qa(this._updateHashUnthrottled,300),this._hashName=n&&encodeURIComponent(n)}addTo(n){return this._map=n,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(n){const u=this._map.getCenter(),_=Math.round(100*this._map.getZoom())/100,b=Math.ceil((_*Math.LN2+Math.log(512/360/.5))/Math.LN10),T=Math.pow(10,b),I=Math.round(u.lng*T)/T,O=Math.round(u.lat*T)/T,N=this._map.getBearing(),j=this._map.getPitch();let $="";if($+=n?`/${I}/${O}/${_}`:`${_}/${O}/${I}`,(N||j)&&($+="/"+Math.round(10*N)/10),j&&($+=`/${Math.round(j)}`),this._hashName){const X=this._hashName;let W=!1;const ee=window.location.hash.slice(1).split("&").map((ae=>{const _e=ae.split("=")[0];return _e===X?(W=!0,`${_e}=${$}`):ae})).filter((ae=>ae));return W||ee.push(`${X}=${$}`),`#${ee.join("&")}`}return`#${$}`}_isValidHash(n){if(n.length<3||n.some(isNaN))return!1;try{new c.S(+n[2],+n[1])}catch{return!1}const u=+n[0],_=+(n[3]||0),b=+(n[4]||0);return u>=this._map.getMinZoom()&&u<=this._map.getMaxZoom()&&_>=-180&&_<=180&&b>=this._map.getMinPitch()&&b<=this._map.getMaxPitch()}}const $a={linearity:.3,easing:c.cm(0,0,.3,1)},zo=c.e({deceleration:2500,maxSpeed:1400},$a),Xu=c.e({deceleration:20,maxSpeed:1400},$a),Dc=c.e({deceleration:1e3,maxSpeed:360},$a),Ku=c.e({deceleration:1e3,maxSpeed:90},$a),ad=c.e({deceleration:1e3,maxSpeed:360},$a);class Yu{constructor(n){this._map=n,this.clear()}clear(){this._inertiaBuffer=[]}record(n){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:Y.now(),settings:n})}_drainInertiaBuffer(){const n=this._inertiaBuffer,u=Y.now();for(;n.length>0&&u-n[0].time>160;)n.shift()}_onMoveEnd(n){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const u={zoom:0,bearing:0,pitch:0,roll:0,pan:new c.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:T}of this._inertiaBuffer)u.zoom+=T.zoomDelta||0,u.bearing+=T.bearingDelta||0,u.pitch+=T.pitchDelta||0,u.roll+=T.rollDelta||0,T.panDelta&&u.pan._add(T.panDelta),T.around&&(u.around=T.around),T.pinchAround&&(u.pinchAround=T.pinchAround);const _=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,b={};if(u.pan.mag()){const T=_u(u.pan.mag(),_,c.e({},zo,n||{})),I=u.pan.mult(T.amount/u.pan.mag()),O=this._map.cameraHelper.handlePanInertia(I,this._map.transform);b.center=O.easingCenter,b.offset=O.easingOffset,_r(b,T)}if(u.zoom){const T=_u(u.zoom,_,Xu);b.zoom=this._map.transform.zoom+T.amount,_r(b,T)}if(u.bearing){const T=_u(u.bearing,_,Dc);b.bearing=this._map.transform.bearing+c.ah(T.amount,-179,179),_r(b,T)}if(u.pitch){const T=_u(u.pitch,_,Ku);b.pitch=this._map.transform.pitch+T.amount,_r(b,T)}if(u.roll){const T=_u(u.roll,_,ad);b.roll=this._map.transform.roll+c.ah(T.amount,-179,179),_r(b,T)}if(b.zoom||b.bearing){const T=u.pinchAround===void 0?u.around:u.pinchAround;b.around=T?this._map.unproject(T):this._map.getCenter()}return this.clear(),c.e(b,{noMoveStart:!0})}}function _r(w,n){(!w.duration||w.duration<n.duration)&&(w.duration=n.duration,w.easing=n.easing)}function _u(w,n,u){const{maxSpeed:_,linearity:b,deceleration:T}=u,I=c.ah(w*b/(n/1e3),-_,_),O=Math.abs(I)/(T*b);return{easing:u.easing,duration:1e3*O,amount:I*(O/2)}}class to extends c.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,u,_,b={}){_=_ instanceof MouseEvent?_:new MouseEvent(n,_);const T=Q.mousePos(u.getCanvas(),_),I=u.unproject(T);super(n,c.e({point:T,lngLat:I,originalEvent:_},b)),this._defaultPrevented=!1,this.target=u}}class mh extends c.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,u,_){const b=n==="touchend"?_.changedTouches:_.touches,T=Q.touchPos(u.getCanvasContainer(),b),I=T.map((N=>u.unproject(N))),O=T.reduce(((N,j,$,X)=>N.add(j.div(X.length))),new c.P(0,0));super(n,{points:T,point:O,lngLats:I,lngLat:u.unproject(O),originalEvent:_}),this._defaultPrevented=!1}}class Hf extends c.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,u,_){super(n,{originalEvent:_}),this._defaultPrevented=!1}}class lm{constructor(n,u){this._map=n,this._clickTolerance=u.clickTolerance}reset(){delete this._mousedownPos}wheel(n){return this._firePreventable(new Hf(n.type,this._map,n))}mousedown(n,u){return this._mousedownPos=u,this._firePreventable(new to(n.type,this._map,n))}mouseup(n){this._map.fire(new to(n.type,this._map,n))}click(n,u){this._mousedownPos&&this._mousedownPos.dist(u)>=this._clickTolerance||this._map.fire(new to(n.type,this._map,n))}dblclick(n){return this._firePreventable(new to(n.type,this._map,n))}mouseover(n){this._map.fire(new to(n.type,this._map,n))}mouseout(n){this._map.fire(new to(n.type,this._map,n))}touchstart(n){return this._firePreventable(new mh(n.type,this._map,n))}touchmove(n){this._map.fire(new mh(n.type,this._map,n))}touchend(n){this._map.fire(new mh(n.type,this._map,n))}touchcancel(n){this._map.fire(new mh(n.type,this._map,n))}_firePreventable(n){if(this._map.fire(n),n.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ya{constructor(n){this._map=n}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(n){this._map.fire(new to(n.type,this._map,n))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new to("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(n){this._delayContextMenu?this._contextMenuEvent=n:this._ignoreContextMenu||this._map.fire(new to(n.type,this._map,n)),this._map.listens("contextmenu")&&n.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Qu{constructor(n){this._map=n}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(n){return this.transform.screenPointToLocation(c.P.convert(n),this._map.terrain)}}class zc{constructor(n,u){this._map=n,this._tr=new Qu(n),this._el=n.getCanvasContainer(),this._container=n.getContainer(),this._clickTolerance=u.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(n,u){this.isEnabled()&&n.shiftKey&&n.button===0&&(Q.disableDrag(),this._startPos=this._lastPos=u,this._active=!0)}mousemoveWindow(n,u){if(!this._active)return;const _=u;if(this._lastPos.equals(_)||!this._box&&_.dist(this._startPos)<this._clickTolerance)return;const b=this._startPos;this._lastPos=_,this._box||(this._box=Q.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",n));const T=Math.min(b.x,_.x),I=Math.max(b.x,_.x),O=Math.min(b.y,_.y),N=Math.max(b.y,_.y);Q.setTransform(this._box,`translate(${T}px,${O}px)`),this._box.style.width=I-T+"px",this._box.style.height=N-O+"px"}mouseupWindow(n,u){if(!this._active||n.button!==0)return;const _=this._startPos,b=u;if(this.reset(),Q.suppressClick(),_.x!==b.x||_.y!==b.y)return this._map.fire(new c.l("boxzoomend",{originalEvent:n})),{cameraAnimation:T=>T.fitScreenCoordinates(_,b,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",n)}keydown(n){this._active&&n.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",n))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(Q.remove(this._box),this._box=null),Q.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(n,u){return this._map.fire(new c.l(n,{originalEvent:u}))}}function nu(w,n){if(w.length!==n.length)throw new Error(`The number of touches and points are not equal - touches ${w.length}, points ${n.length}`);const u={};for(let _=0;_<w.length;_++)u[w[_].identifier]=n[_];return u}class Xd{constructor(n){this.reset(),this.numTouches=n.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(n,u,_){(this.centroid||_.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=n.timeStamp),_.length===this.numTouches&&(this.centroid=(function(b){const T=new c.P(0,0);for(const I of b)T._add(I);return T.div(b.length)})(u),this.touches=nu(_,u)))}touchmove(n,u,_){if(this.aborted||!this.centroid)return;const b=nu(_,u);for(const T in this.touches){const I=b[T];(!I||I.dist(this.touches[T])>30)&&(this.aborted=!0)}}touchend(n,u,_){if((!this.centroid||n.timeStamp-this.startTime>500)&&(this.aborted=!0),_.length===0){const b=!this.aborted&&this.centroid;if(this.reset(),b)return b}}}class Ra{constructor(n){this.singleTap=new Xd(n),this.numTaps=n.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(n,u,_){this.singleTap.touchstart(n,u,_)}touchmove(n,u,_){this.singleTap.touchmove(n,u,_)}touchend(n,u,_){const b=this.singleTap.touchend(n,u,_);if(b){const T=n.timeStamp-this.lastTime<500,I=!this.lastTap||this.lastTap.dist(b)<30;if(T&&I||this.reset(),this.count++,this.lastTime=n.timeStamp,this.lastTap=b,this.count===this.numTaps)return this.reset(),b}}}class Ms{constructor(n){this._tr=new Qu(n),this._zoomIn=new Ra({numTouches:1,numTaps:2}),this._zoomOut=new Ra({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(n,u,_){this._zoomIn.touchstart(n,u,_),this._zoomOut.touchstart(n,u,_)}touchmove(n,u,_){this._zoomIn.touchmove(n,u,_),this._zoomOut.touchmove(n,u,_)}touchend(n,u,_){const b=this._zoomIn.touchend(n,u,_),T=this._zoomOut.touchend(n,u,_),I=this._tr;return b?(this._active=!0,n.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:O=>O.easeTo({duration:300,zoom:I.zoom+1,around:I.unproject(b)},{originalEvent:n})}):T?(this._active=!0,n.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:O=>O.easeTo({duration:300,zoom:I.zoom-1,around:I.unproject(T)},{originalEvent:n})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class gh{constructor(n){this._enabled=!!n.enable,this._moveStateManager=n.moveStateManager,this._clickTolerance=n.clickTolerance||1,this._moveFunction=n.move,this._activateOnStart=!!n.activateOnStart,n.assignEvents(this),this.reset()}reset(n){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(n)}_move(...n){const u=this._moveFunction(...n);if(u.bearingDelta||u.pitchDelta||u.rollDelta||u.around||u.panDelta)return this._active=!0,u}dragStart(n,u){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(n)&&(this._moveStateManager.startMove(n),this._lastPoint=Array.isArray(u)?u[0]:u,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(n,u){if(!this.isEnabled())return;const _=this._lastPoint;if(!_)return;if(n.preventDefault(),!this._moveStateManager.isValidMoveEvent(n))return void this.reset(n);const b=Array.isArray(u)?u[0]:u;return!this._moved&&b.dist(_)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=b,this._move(_,b))}dragEnd(n){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(n)&&(this._moved&&Q.suppressClick(),this.reset(n))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const al=0,_h=2,um={[al]:1,[_h]:2};class Ll{constructor(n){this._correctEvent=n.checkCorrectEvent}startMove(n){const u=Q.mouseButton(n);this._eventButton=u}endMove(n){delete this._eventButton}isValidStartEvent(n){return this._correctEvent(n)}isValidMoveEvent(n){return!(function(u,_){const b=um[_];return u.buttons===void 0||(u.buttons&b)!==b})(n,this._eventButton)}isValidEndEvent(n){return Q.mouseButton(n)===this._eventButton}}class Wf{constructor(){this._firstTouch=void 0}_isOneFingerTouch(n){return n.targetTouches.length===1}_isSameTouchEvent(n){return n.targetTouches[0].identifier===this._firstTouch}startMove(n){this._firstTouch=n.targetTouches[0].identifier}endMove(n){delete this._firstTouch}isValidStartEvent(n){return this._isOneFingerTouch(n)}isValidMoveEvent(n){return this._isOneFingerTouch(n)&&this._isSameTouchEvent(n)}isValidEndEvent(n){return this._isOneFingerTouch(n)&&this._isSameTouchEvent(n)}}class Kd{constructor(n=new Ll({checkCorrectEvent:()=>!0}),u=new Wf){this.mouseMoveStateManager=n,this.oneFingerTouchMoveStateManager=u}_executeRelevantHandler(n,u,_){return n instanceof MouseEvent?u(n):typeof TouchEvent<"u"&&n instanceof TouchEvent?_(n):void 0}startMove(n){this._executeRelevantHandler(n,(u=>this.mouseMoveStateManager.startMove(u)),(u=>this.oneFingerTouchMoveStateManager.startMove(u)))}endMove(n){this._executeRelevantHandler(n,(u=>this.mouseMoveStateManager.endMove(u)),(u=>this.oneFingerTouchMoveStateManager.endMove(u)))}isValidStartEvent(n){return this._executeRelevantHandler(n,(u=>this.mouseMoveStateManager.isValidStartEvent(u)),(u=>this.oneFingerTouchMoveStateManager.isValidStartEvent(u)))}isValidMoveEvent(n){return this._executeRelevantHandler(n,(u=>this.mouseMoveStateManager.isValidMoveEvent(u)),(u=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(u)))}isValidEndEvent(n){return this._executeRelevantHandler(n,(u=>this.mouseMoveStateManager.isValidEndEvent(u)),(u=>this.oneFingerTouchMoveStateManager.isValidEndEvent(u)))}}const yh=w=>{w.mousedown=w.dragStart,w.mousemoveWindow=w.dragMove,w.mouseup=w.dragEnd,w.contextmenu=n=>{n.preventDefault()}};class yu{constructor(n,u){this._clickTolerance=n.clickTolerance||1,this._map=u,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new c.P(0,0)}_shouldBePrevented(n){return n<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(n,u,_){return this._calculateTransform(n,u,_)}touchmove(n,u,_){if(this._active){if(!this._shouldBePrevented(_.length))return n.preventDefault(),this._calculateTransform(n,u,_);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",n)}}touchend(n,u,_){this._calculateTransform(n,u,_),this._active&&this._shouldBePrevented(_.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(n,u,_){_.length>0&&(this._active=!0);const b=nu(_,u),T=new c.P(0,0),I=new c.P(0,0);let O=0;for(const j in b){const $=b[j],X=this._touches[j];X&&(T._add($),I._add($.sub(X)),O++,b[j]=$)}if(this._touches=b,this._shouldBePrevented(O)||!I.mag())return;const N=I.div(O);return this._sum._add(N),this._sum.mag()<this._clickTolerance?void 0:{around:T.div(O),panDelta:N}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class sl{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(n,u,_){this._firstTwoTouches||_.length<2||(this._firstTwoTouches=[_[0].identifier,_[1].identifier],this._start([u[0],u[1]]))}touchmove(n,u,_){if(!this._firstTwoTouches)return;n.preventDefault();const[b,T]=this._firstTwoTouches,I=Kt(_,u,b),O=Kt(_,u,T);if(!I||!O)return;const N=this._aroundCenter?null:I.add(O).div(2);return this._move([I,O],N,n)}touchend(n,u,_){if(!this._firstTwoTouches)return;const[b,T]=this._firstTwoTouches,I=Kt(_,u,b),O=Kt(_,u,T);I&&O||(this._active&&Q.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(n){this._enabled=!0,this._aroundCenter=!!n&&n.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Kt(w,n,u){for(let _=0;_<w.length;_++)if(w[_].identifier===u)return n[_]}function sd(w,n){return Math.log(w/n)/Math.LN2}class od extends sl{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(n){this._startDistance=this._distance=n[0].dist(n[1])}_move(n,u){const _=this._distance;if(this._distance=n[0].dist(n[1]),this._active||!(Math.abs(sd(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:sd(this._distance,_),pinchAround:u}}}function vh(w,n){return 180*w.angleWith(n)/Math.PI}class Oc extends sl{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(n){this._startVector=this._vector=n[0].sub(n[1]),this._minDiameter=n[0].dist(n[1])}_move(n,u,_){const b=this._vector;if(this._vector=n[0].sub(n[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:vh(this._vector,b),pinchAround:u}}_isBelowThreshold(n){this._minDiameter=Math.min(this._minDiameter,n.mag());const u=25/(Math.PI*this._minDiameter)*360,_=vh(n,this._startVector);return Math.abs(_)<u}}function Dl(w){return Math.abs(w.y)>Math.abs(w.x)}class ld extends sl{constructor(n){super(),this._currentTouchCount=0,this._map=n}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(n,u,_){super.touchstart(n,u,_),this._currentTouchCount=_.length}_start(n){this._lastPoints=n,Dl(n[0].sub(n[1]))&&(this._valid=!1)}_move(n,u,_){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const b=n[0].sub(this._lastPoints[0]),T=n[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(b,T,_.timeStamp),this._valid?(this._lastPoints=n,this._active=!0,{pitchDelta:(b.y+T.y)/2*-.5}):void 0}gestureBeginsVertically(n,u,_){if(this._valid!==void 0)return this._valid;const b=n.mag()>=2,T=u.mag()>=2;if(!b&&!T)return;if(!b||!T)return this._firstMove===void 0&&(this._firstMove=_),_-this._firstMove<100&&void 0;const I=n.y>0==u.y>0;return Dl(n)&&Dl(u)&&I}}const ai={panStep:100,bearingStep:15,pitchStep:10};class zl{constructor(n){this._tr=new Qu(n);const u=ai;this._panStep=u.panStep,this._bearingStep=u.bearingStep,this._pitchStep=u.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(n){if(n.altKey||n.ctrlKey||n.metaKey)return;let u=0,_=0,b=0,T=0,I=0;switch(n.keyCode){case 61:case 107:case 171:case 187:u=1;break;case 189:case 109:case 173:u=-1;break;case 37:n.shiftKey?_=-1:(n.preventDefault(),T=-1);break;case 39:n.shiftKey?_=1:(n.preventDefault(),T=1);break;case 38:n.shiftKey?b=1:(n.preventDefault(),I=-1);break;case 40:n.shiftKey?b=-1:(n.preventDefault(),I=1);break;default:return}return this._rotationDisabled&&(_=0,b=0),{cameraAnimation:O=>{const N=this._tr;O.easeTo({duration:300,easeId:"keyboardHandler",easing:Xf,zoom:u?Math.round(N.zoom)+u*(n.shiftKey?2:1):N.zoom,bearing:N.bearing+_*this._bearingStep,pitch:N.pitch+b*this._pitchStep,offset:[-T*this._panStep,-I*this._panStep],center:N.center},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Xf(w){return w*(2-w)}const bh=4.000244140625,Ju=1/450;class vu{constructor(n,u){this._onTimeout=_=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(_)},this._map=n,this._tr=new Qu(n),this._triggerRenderFrame=u,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Ju}setZoomRate(n){this._defaultZoomRate=n}setWheelZoomRate(n){this._wheelZoomRate=n}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(n){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!n&&n.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(n){return!!this._map.cooperativeGestures.isEnabled()&&!(n.ctrlKey||this._map.cooperativeGestures.isBypassed(n))}wheel(n){if(!this.isEnabled())return;if(this._shouldBePrevented(n))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",n);let u=n.deltaMode===WheelEvent.DOM_DELTA_LINE?40*n.deltaY:n.deltaY;const _=Y.now(),b=_-(this._lastWheelEventTime||0);this._lastWheelEventTime=_,u!==0&&u%bh==0?this._type="wheel":u!==0&&Math.abs(u)<4?this._type="trackpad":b>400?(this._type=null,this._lastValue=u,this._timeout=setTimeout(this._onTimeout,40,n)):this._type||(this._type=Math.abs(b*u)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,u+=this._lastValue)),n.shiftKey&&u&&(u/=4),this._type&&(this._lastWheelEvent=n,this._delta-=u,this._active||this._start(n)),n.preventDefault()}_start(n){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const u=Q.mousePos(this._map.getCanvas(),n),_=this._tr;this._aroundPoint=this._aroundCenter?_.transform.locationToScreenPoint(c.S.convert(_.center)):u,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const n=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const O=n.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=O),typeof this._targetZoom=="number"&&(this._targetZoom+=O)}if(this._delta!==0){const O=this._type==="wheel"&&Math.abs(this._delta)>bh?this._wheelZoomRate:this._defaultZoomRate;let N=2/(1+Math.exp(-Math.abs(this._delta*O)));this._delta<0&&N!==0&&(N=1/N);const j=typeof this._targetZoom!="number"?n.scale:c.af(this._targetZoom);this._targetZoom=n.getConstrained(n.getCameraLngLat(),c.ak(j*N)).zoom,this._type==="wheel"&&(this._startZoom=n.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const u=typeof this._targetZoom!="number"?n.zoom:this._targetZoom,_=this._startZoom,b=this._easing;let T,I=!1;if(this._type==="wheel"&&_&&b){const O=Y.now()-this._lastWheelEventTime,N=Math.min((O+5)/200,1),j=b(N);T=c.C.number(_,u,j),N<1?this._frameId||(this._frameId=!0):I=!0}else T=u,I=!0;return this._active=!0,I&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout}),200)),this._lastExpectedZoom=T,{noInertia:!0,needsRenderFrame:!I,zoomDelta:T-n.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(n){let u=c.co;if(this._prevEase){const _=this._prevEase,b=(Y.now()-_.start)/_.duration,T=_.easing(b+.01)-_.easing(b),I=.27/Math.sqrt(T*T+1e-4)*.01,O=Math.sqrt(.0729-I*I);u=c.cm(I,O,.25,1)}return this._prevEase={start:Y.now(),duration:n,easing:u},u}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Nc{constructor(n,u){this._clickZoom=n,this._tapZoom=u}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class ud{constructor(n){this._tr=new Qu(n),this.reset()}reset(){this._active=!1}dblclick(n,u){return n.preventDefault(),{cameraAnimation:_=>{_.easeTo({duration:300,zoom:this._tr.zoom+(n.shiftKey?-1:1),around:this._tr.unproject(u)},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Yd{constructor(){this._tap=new Ra({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(n,u,_){if(!this._swipePoint)if(this._tapTime){const b=u[0],T=n.timeStamp-this._tapTime<500,I=this._tapPoint.dist(b)<30;T&&I?_.length>0&&(this._swipePoint=b,this._swipeTouch=_[0].identifier):this.reset()}else this._tap.touchstart(n,u,_)}touchmove(n,u,_){if(this._tapTime){if(this._swipePoint){if(_[0].identifier!==this._swipeTouch)return;const b=u[0],T=b.y-this._swipePoint.y;return this._swipePoint=b,n.preventDefault(),this._active=!0,{zoomDelta:T/128}}}else this._tap.touchmove(n,u,_)}touchend(n,u,_){if(this._tapTime)this._swipePoint&&_.length===0&&this.reset();else{const b=this._tap.touchend(n,u,_);b&&(this._tapTime=n.timeStamp,this._tapPoint=b)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class xh{constructor(n,u,_){this._el=n,this._mousePan=u,this._touchPan=_}enable(n){this._inertiaOptions=n||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Bc{constructor(n,u,_,b){this._pitchWithRotate=n.pitchWithRotate,this._rollEnabled=n.rollEnabled,this._mouseRotate=u,this._mousePitch=_,this._mouseRoll=b}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class Kf{constructor(n,u,_,b){this._el=n,this._touchZoom=u,this._touchRotate=_,this._tapDragZoom=b,this._rotationDisabled=!1,this._enabled=!0}enable(n){this._touchZoom.enable(n),this._rotationDisabled||this._touchRotate.enable(n),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Yf{constructor(n,u){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=n,this._options=u,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const n=this._map.getCanvasContainer();n.classList.add("maplibregl-cooperative-gestures"),this._container=Q.create("div","maplibregl-cooperative-gesture-screen",n);let u=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(u=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const _=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),b=document.createElement("div");b.className="maplibregl-desktop-message",b.textContent=u,this._container.appendChild(b);const T=document.createElement("div");T.className="maplibregl-mobile-message",T.textContent=_,this._container.appendChild(T),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(Q.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(n){return n[this._bypassKey]}notifyGestureBlocked(n,u){this._enabled&&(this._map.fire(new c.l("cooperativegestureprevented",{gestureType:n,originalEvent:u})),this._container.classList.add("maplibregl-show"),setTimeout((()=>{this._container.classList.remove("maplibregl-show")}),100))}}const Rs=w=>w.zoom||w.drag||w.roll||w.pitch||w.rotate;class rr extends c.l{}function Fc(w){return w.panDelta&&w.panDelta.mag()||w.zoomDelta||w.bearingDelta||w.pitchDelta||w.rollDelta}class cd{constructor(n,u){this.handleWindowEvent=b=>{this.handleEvent(b,`${b.type}Window`)},this.handleEvent=(b,T)=>{if(b.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const I=b.type==="renderFrame"?void 0:b,O={needsRenderFrame:!1},N={},j={};for(const{handlerName:W,handler:ee,allowed:ae}of this._handlers){if(!ee.isEnabled())continue;let _e;if(this._blockedByActive(j,ae,W))ee.reset();else if(ee[T||b.type]){if(c.cp(b,T||b.type)){const ge=Q.mousePos(this._map.getCanvas(),b);_e=ee[T||b.type](b,ge)}else if(c.cq(b,T||b.type)){const ge=this._getMapTouches(b.touches),ve=Q.touchPos(this._map.getCanvas(),ge);_e=ee[T||b.type](b,ve,ge)}else c.cr(T||b.type)||(_e=ee[T||b.type](b));this.mergeHandlerResult(O,N,_e,W,I),_e&&_e.needsRenderFrame&&this._triggerRenderFrame()}(_e||ee.isActive())&&(j[W]=ee)}const $={};for(const W in this._previousActiveHandlers)j[W]||($[W]=I);this._previousActiveHandlers=j,(Object.keys($).length||Fc(O))&&(this._changes.push([O,N,$]),this._triggerRenderFrame()),(Object.keys(j).length||Fc(O))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:X}=O;X&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],X(this._map))},this._map=n,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Yu(n),this._bearingSnap=u.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(u);const _=this._el;this._listeners=[[_,"touchstart",{passive:!0}],[_,"touchmove",{passive:!1}],[_,"touchend",void 0],[_,"touchcancel",void 0],[_,"mousedown",void 0],[_,"mousemove",void 0],[_,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[_,"mouseover",void 0],[_,"mouseout",void 0],[_,"dblclick",void 0],[_,"click",void 0],[_,"keydown",{capture:!1}],[_,"keyup",void 0],[_,"wheel",{passive:!1}],[_,"contextmenu",void 0],[window,"blur",void 0]];for(const[b,T,I]of this._listeners)Q.addEventListener(b,T,b===document?this.handleWindowEvent:this.handleEvent,I)}destroy(){for(const[n,u,_]of this._listeners)Q.removeEventListener(n,u,n===document?this.handleWindowEvent:this.handleEvent,_)}_addDefaultHandlers(n){const u=this._map,_=u.getCanvasContainer();this._add("mapEvent",new lm(u,n));const b=u.boxZoom=new zc(u,n);this._add("boxZoom",b),n.interactive&&n.boxZoom&&b.enable();const T=u.cooperativeGestures=new Yf(u,n.cooperativeGestures);this._add("cooperativeGestures",T),n.cooperativeGestures&&T.enable();const I=new Ms(u),O=new ud(u);u.doubleClickZoom=new Nc(O,I),this._add("tapZoom",I),this._add("clickZoom",O),n.interactive&&n.doubleClickZoom&&u.doubleClickZoom.enable();const N=new Yd;this._add("tapDragZoom",N);const j=u.touchPitch=new ld(u);this._add("touchPitch",j),n.interactive&&n.touchPitch&&u.touchPitch.enable(n.touchPitch);const $=()=>u.project(u.getCenter()),X=(function({enable:Ae,clickTolerance:Le,aroundCenter:Ue=!0,minPixelCenterThreshold:Ce=100,rotateDegreesPerPixelMoved:We=.8},dt){const rt=new Ll({checkCorrectEvent:st=>Q.mouseButton(st)===0&&st.ctrlKey||Q.mouseButton(st)===2&&!st.ctrlKey});return new gh({clickTolerance:Le,move:(st,ct)=>{const Ot=dt();if(Ue&&Math.abs(Ot.y-st.y)>Ce)return{bearingDelta:c.cn(new c.P(st.x,ct.y),ct,Ot)};let Bt=(ct.x-st.x)*We;return Ue&&ct.y<Ot.y&&(Bt=-Bt),{bearingDelta:Bt}},moveStateManager:rt,enable:Ae,assignEvents:yh})})(n,$),W=(function({enable:Ae,clickTolerance:Le,pitchDegreesPerPixelMoved:Ue=-.5}){const Ce=new Ll({checkCorrectEvent:We=>Q.mouseButton(We)===0&&We.ctrlKey||Q.mouseButton(We)===2});return new gh({clickTolerance:Le,move:(We,dt)=>({pitchDelta:(dt.y-We.y)*Ue}),moveStateManager:Ce,enable:Ae,assignEvents:yh})})(n),ee=(function({enable:Ae,clickTolerance:Le,rollDegreesPerPixelMoved:Ue=.3},Ce){const We=new Ll({checkCorrectEvent:dt=>Q.mouseButton(dt)===2&&dt.ctrlKey});return new gh({clickTolerance:Le,move:(dt,rt)=>{const st=Ce();let ct=(rt.x-dt.x)*Ue;return rt.y<st.y&&(ct=-ct),{rollDelta:ct}},moveStateManager:We,enable:Ae,assignEvents:yh})})(n,$);u.dragRotate=new Bc(n,X,W,ee),this._add("mouseRotate",X,["mousePitch"]),this._add("mousePitch",W,["mouseRotate","mouseRoll"]),this._add("mouseRoll",ee,["mousePitch"]),n.interactive&&n.dragRotate&&u.dragRotate.enable();const ae=(function({enable:Ae,clickTolerance:Le}){const Ue=new Ll({checkCorrectEvent:Ce=>Q.mouseButton(Ce)===0&&!Ce.ctrlKey});return new gh({clickTolerance:Le,move:(Ce,We)=>({around:We,panDelta:We.sub(Ce)}),activateOnStart:!0,moveStateManager:Ue,enable:Ae,assignEvents:yh})})(n),_e=new yu(n,u);u.dragPan=new xh(_,ae,_e),this._add("mousePan",ae),this._add("touchPan",_e,["touchZoom","touchRotate"]),n.interactive&&n.dragPan&&u.dragPan.enable(n.dragPan);const ge=new Oc,ve=new od;u.touchZoomRotate=new Kf(_,ve,ge,N),this._add("touchRotate",ge,["touchPan","touchZoom"]),this._add("touchZoom",ve,["touchPan","touchRotate"]),n.interactive&&n.touchZoomRotate&&u.touchZoomRotate.enable(n.touchZoomRotate);const Te=u.scrollZoom=new vu(u,(()=>this._triggerRenderFrame()));this._add("scrollZoom",Te,["mousePan"]),n.interactive&&n.scrollZoom&&u.scrollZoom.enable(n.scrollZoom);const Me=u.keyboard=new zl(u);this._add("keyboard",Me),n.interactive&&n.keyboard&&u.keyboard.enable(),this._add("blockableMapEvent",new ya(u))}_add(n,u,_){this._handlers.push({handlerName:n,handler:u,allowed:_}),this._handlersById[n]=u}stop(n){if(!this._updatingCamera){for(const{handler:u}of this._handlers)u.reset();this._inertia.clear(),this._fireEvents({},{},n),this._changes=[]}}isActive(){for(const{handler:n}of this._handlers)if(n.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Rs(this._eventsInProgress)||this.isZooming()}_blockedByActive(n,u,_){for(const b in n)if(b!==_&&(!u||u.indexOf(b)<0))return!0;return!1}_getMapTouches(n){const u=[];for(const _ of n)this._el.contains(_.target)&&u.push(_);return u}mergeHandlerResult(n,u,_,b,T){if(!_)return;c.e(n,_);const I={handlerName:b,originalEvent:_.originalEvent||T};_.zoomDelta!==void 0&&(u.zoom=I),_.panDelta!==void 0&&(u.drag=I),_.rollDelta!==void 0&&(u.roll=I),_.pitchDelta!==void 0&&(u.pitch=I),_.bearingDelta!==void 0&&(u.rotate=I)}_applyChanges(){const n={},u={},_={};for(const[b,T,I]of this._changes)b.panDelta&&(n.panDelta=(n.panDelta||new c.P(0,0))._add(b.panDelta)),b.zoomDelta&&(n.zoomDelta=(n.zoomDelta||0)+b.zoomDelta),b.bearingDelta&&(n.bearingDelta=(n.bearingDelta||0)+b.bearingDelta),b.pitchDelta&&(n.pitchDelta=(n.pitchDelta||0)+b.pitchDelta),b.rollDelta&&(n.rollDelta=(n.rollDelta||0)+b.rollDelta),b.around!==void 0&&(n.around=b.around),b.pinchAround!==void 0&&(n.pinchAround=b.pinchAround),b.noInertia&&(n.noInertia=b.noInertia),c.e(u,T),c.e(_,I);this._updateMapTransform(n,u,_),this._changes=[]}_updateMapTransform(n,u,_){const b=this._map,T=b._getTransformForUpdate(),I=b.terrain;if(!(Fc(n)||I&&this._terrainMovement))return this._fireEvents(u,_,!0);b._stop(!0);let{panDelta:O,zoomDelta:N,bearingDelta:j,pitchDelta:$,rollDelta:X,around:W,pinchAround:ee}=n;ee!==void 0&&(W=ee),W=W||b.transform.centerPoint,I&&!T.isPointOnMapSurface(W)&&(W=T.centerPoint);const ae={panDelta:O,zoomDelta:N,rollDelta:X,pitchDelta:$,bearingDelta:j,around:W};this._map.cameraHelper.useGlobeControls&&!T.isPointOnMapSurface(W)&&(W=T.centerPoint);const _e=W.distSqr(T.centerPoint)<.01?T.center:T.screenPointToLocation(O?W.sub(O):W);I?(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(ae,T),this._terrainMovement||!u.drag&&!u.zoom?u.drag&&this._terrainMovement?T.setCenter(T.screenPointToLocation(T.centerPoint.sub(O))):this._map.cameraHelper.handleMapControlsPan(ae,T,_e):(this._terrainMovement=!0,this._map._elevationFreeze=!0,this._map.cameraHelper.handleMapControlsPan(ae,T,_e))):(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(ae,T),this._map.cameraHelper.handleMapControlsPan(ae,T,_e)),b._applyUpdatedTransform(T),this._map._update(),n.noInertia||this._inertia.record(n),this._fireEvents(u,_,!0)}_fireEvents(n,u,_){const b=Rs(this._eventsInProgress),T=Rs(n),I={};for(const X in n){const{originalEvent:W}=n[X];this._eventsInProgress[X]||(I[`${X}start`]=W),this._eventsInProgress[X]=n[X]}!b&&T&&this._fireEvent("movestart",T.originalEvent);for(const X in I)this._fireEvent(X,I[X]);T&&this._fireEvent("move",T.originalEvent);for(const X in n){const{originalEvent:W}=n[X];this._fireEvent(X,W)}const O={};let N;for(const X in this._eventsInProgress){const{handlerName:W,originalEvent:ee}=this._eventsInProgress[X];this._handlersById[W].isActive()||(delete this._eventsInProgress[X],N=u[W]||ee,O[`${X}end`]=N)}for(const X in O)this._fireEvent(X,O[X]);const j=Rs(this._eventsInProgress),$=(b||T)&&!j;if($&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const X=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&X.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(X)}if(_&&$){this._updatingCamera=!0;const X=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),W=ee=>ee!==0&&-this._bearingSnap<ee&&ee<this._bearingSnap;!X||!X.essential&&Y.prefersReducedMotion?(this._map.fire(new c.l("moveend",{originalEvent:N})),W(this._map.getBearing())&&this._map.resetNorth()):(W(X.bearing||this._map.getBearing())&&(X.bearing=0),X.freezeElevation=!0,this._map.easeTo(X,{originalEvent:N})),this._updatingCamera=!1}}_fireEvent(n,u){this._map.fire(new c.l(n,u?{originalEvent:u}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((n=>{delete this._frameId,this.handleEvent(new rr("renderFrame",{timeStamp:n})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Qd extends c.E{constructor(n,u,_){super(),this._renderFrameCallback=()=>{const b=Math.min((Y.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(b)),b<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=n,this._bearingSnap=_.bearingSnap,this.cameraHelper=u,this.on("moveend",(()=>{delete this._requestedCameraState}))}migrateProjection(n,u){n.apply(this.transform),this.transform=n,this.cameraHelper=u}getCenter(){return new c.S(this.transform.center.lng,this.transform.center.lat)}setCenter(n,u){return this.jumpTo({center:n},u)}getCenterElevation(){return this.transform.elevation}setCenterElevation(n,u){return this.jumpTo({elevation:n},u),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(n){this._centerClampedToGround=n}panBy(n,u,_){return n=c.P.convert(n).mult(-1),this.panTo(this.transform.center,c.e({offset:n},u),_)}panTo(n,u,_){return this.easeTo(c.e({center:n},u),_)}getZoom(){return this.transform.zoom}setZoom(n,u){return this.jumpTo({zoom:n},u),this}zoomTo(n,u,_){return this.easeTo(c.e({zoom:n},u),_)}zoomIn(n,u){return this.zoomTo(this.getZoom()+1,n,u),this}zoomOut(n,u){return this.zoomTo(this.getZoom()-1,n,u),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(n,u){return n!=this.transform.fov&&(this.transform.setFov(n),this.fire(new c.l("movestart",u)).fire(new c.l("move",u)).fire(new c.l("moveend",u))),this}getBearing(){return this.transform.bearing}setBearing(n,u){return this.jumpTo({bearing:n},u),this}getPadding(){return this.transform.padding}setPadding(n,u){return this.jumpTo({padding:n},u),this}rotateTo(n,u,_){return this.easeTo(c.e({bearing:n},u),_)}resetNorth(n,u){return this.rotateTo(0,c.e({duration:1e3},n),u),this}resetNorthPitch(n,u){return this.easeTo(c.e({bearing:0,pitch:0,roll:0,duration:1e3},n),u),this}snapToNorth(n,u){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(n,u):this}getPitch(){return this.transform.pitch}setPitch(n,u){return this.jumpTo({pitch:n},u),this}getRoll(){return this.transform.roll}setRoll(n,u){return this.jumpTo({roll:n},u),this}cameraForBounds(n,u){n=Pi.convert(n).adjustAntiMeridian();const _=u&&u.bearing||0;return this._cameraForBoxAndBearing(n.getNorthWest(),n.getSouthEast(),_,u)}_cameraForBoxAndBearing(n,u,_,b){const T={top:0,bottom:0,right:0,left:0};if(typeof(b=c.e({padding:T,offset:[0,0],maxZoom:this.transform.maxZoom},b)).padding=="number"){const j=b.padding;b.padding={top:j,bottom:j,right:j,left:j}}const I=c.e(T,b.padding);b.padding=I;const O=this.transform,N=new Pi(n,u);return this.cameraHelper.cameraForBoxAndBearing(b,I,N,_,O)}fitBounds(n,u,_){return this._fitInternal(this.cameraForBounds(n,u),u,_)}fitScreenCoordinates(n,u,_,b,T){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(c.P.convert(n)),this.transform.screenPointToLocation(c.P.convert(u)),_,b),b,T)}_fitInternal(n,u,_){return n?(delete(u=c.e(n,u)).padding,u.linear?this.easeTo(u,_):this.flyTo(u,_)):this}jumpTo(n,u){this.stop();const _=this._getTransformForUpdate();let b=!1,T=!1,I=!1;const O=_.zoom;this.cameraHelper.handleJumpToCenterZoom(_,n);const N=_.zoom!==O;return"elevation"in n&&_.elevation!==+n.elevation&&_.setElevation(+n.elevation),"bearing"in n&&_.bearing!==+n.bearing&&(b=!0,_.setBearing(+n.bearing)),"pitch"in n&&_.pitch!==+n.pitch&&(T=!0,_.setPitch(+n.pitch)),"roll"in n&&_.roll!==+n.roll&&(I=!0,_.setRoll(+n.roll)),n.padding==null||_.isPaddingEqual(n.padding)||_.setPadding(n.padding),this._applyUpdatedTransform(_),this.fire(new c.l("movestart",u)).fire(new c.l("move",u)),N&&this.fire(new c.l("zoomstart",u)).fire(new c.l("zoom",u)).fire(new c.l("zoomend",u)),b&&this.fire(new c.l("rotatestart",u)).fire(new c.l("rotate",u)).fire(new c.l("rotateend",u)),T&&this.fire(new c.l("pitchstart",u)).fire(new c.l("pitch",u)).fire(new c.l("pitchend",u)),I&&this.fire(new c.l("rollstart",u)).fire(new c.l("roll",u)).fire(new c.l("rollend",u)),this.fire(new c.l("moveend",u))}calculateCameraOptionsFromTo(n,u,_,b=0){const T=c.a1.fromLngLat(n,u),I=c.a1.fromLngLat(_,b),O=I.x-T.x,N=I.y-T.y,j=I.z-T.z,$=Math.hypot(O,N,j);if($===0)throw new Error("Can't calculate camera options with same From and To");const X=Math.hypot(O,N),W=c.ak(this.transform.cameraToCenterDistance/$/this.transform.tileSize),ee=180*Math.atan2(O,-N)/Math.PI;let ae=180*Math.acos(X/$)/Math.PI;return ae=j<0?90-ae:90+ae,{center:I.toLngLat(),elevation:b,zoom:W,pitch:ae,bearing:ee}}calculateCameraOptionsFromCameraLngLatAltRotation(n,u,_,b,T){const I=this.transform.calculateCenterFromCameraLngLatAlt(n,u,_,b);return{center:I.center,elevation:I.elevation,zoom:I.zoom,bearing:_,pitch:b,roll:T}}easeTo(n,u){this._stop(!1,n.easeId),((n=c.e({offset:[0,0],duration:500,easing:c.co},n)).animate===!1||!n.essential&&Y.prefersReducedMotion)&&(n.duration=0);const _=this._getTransformForUpdate(),b=this.getBearing(),T=_.pitch,I=_.roll,O="bearing"in n?this._normalizeBearing(n.bearing,b):b,N="pitch"in n?+n.pitch:T,j="roll"in n?this._normalizeBearing(n.roll,I):I,$="padding"in n?n.padding:_.padding,X=c.P.convert(n.offset);let W,ee;n.around&&(W=c.S.convert(n.around),ee=_.locationToScreenPoint(W));const ae={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},_e=this.cameraHelper.handleEaseTo(_,{bearing:O,pitch:N,roll:j,padding:$,around:W,aroundPoint:ee,offsetAsPoint:X,offset:n.offset,zoom:n.zoom,center:n.center});return this._rotating=this._rotating||b!==O,this._pitching=this._pitching||N!==T,this._rolling=this._rolling||j!==I,this._padding=!_.isPaddingEqual($),this._zooming=this._zooming||_e.isZooming,this._easeId=n.easeId,this._prepareEase(u,n.noMoveStart,ae),this.terrain&&this._prepareElevation(_e.elevationCenter),this._ease((ge=>{_e.easeFunc(ge),this.terrain&&!n.freezeElevation&&this._updateElevation(ge),this._applyUpdatedTransform(_),this._fireMoveEvents(u)}),(ge=>{this.terrain&&n.freezeElevation&&this._finalizeElevation(),this._afterEase(u,ge)}),n),this}_prepareEase(n,u,_={}){this._moving=!0,u||_.moving||this.fire(new c.l("movestart",n)),this._zooming&&!_.zooming&&this.fire(new c.l("zoomstart",n)),this._rotating&&!_.rotating&&this.fire(new c.l("rotatestart",n)),this._pitching&&!_.pitching&&this.fire(new c.l("pitchstart",n)),this._rolling&&!_.rolling&&this.fire(new c.l("rollstart",n))}_prepareElevation(n){this._elevationCenter=n,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(n,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(n){this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const u=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(n<1&&u!==this._elevationTarget){const _=this._elevationTarget-this._elevationStart;this._elevationStart+=n*(_-(u-(_*n+this._elevationStart))/(1-n)),this._elevationTarget=u}this.transform.setElevation(c.C.number(this._elevationStart,this._elevationTarget,n))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(n){if(!this.terrain&&n.elevation>=0&&n.pitch<=90)return{};const u=n.getCameraLngLat(),_=n.getCameraAltitude(),b=this.terrain?this.terrain.getElevationForLngLatZoom(u,n.zoom):0;if(_<b){const T=this.calculateCameraOptionsFromTo(u,b,n.center,n.elevation);return{pitch:T.pitch,zoom:T.zoom}}return{}}_applyUpdatedTransform(n){const u=[];if(u.push((b=>this._elevateCameraIfInsideTerrain(b))),this.transformCameraUpdate&&u.push((b=>this.transformCameraUpdate(b))),!u.length)return;const _=n.clone();for(const b of u){const T=_.clone(),{center:I,zoom:O,roll:N,pitch:j,bearing:$,elevation:X}=b(T);I&&T.setCenter(I),X!==void 0&&T.setElevation(X),O!==void 0&&T.setZoom(O),N!==void 0&&T.setRoll(N),j!==void 0&&T.setPitch(j),$!==void 0&&T.setBearing($),_.apply(T)}this.transform.apply(_)}_fireMoveEvents(n){this.fire(new c.l("move",n)),this._zooming&&this.fire(new c.l("zoom",n)),this._rotating&&this.fire(new c.l("rotate",n)),this._pitching&&this.fire(new c.l("pitch",n)),this._rolling&&this.fire(new c.l("roll",n))}_afterEase(n,u){if(this._easeId&&u&&this._easeId===u)return;delete this._easeId;const _=this._zooming,b=this._rotating,T=this._pitching,I=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,_&&this.fire(new c.l("zoomend",n)),b&&this.fire(new c.l("rotateend",n)),T&&this.fire(new c.l("pitchend",n)),I&&this.fire(new c.l("rollend",n)),this.fire(new c.l("moveend",n))}flyTo(n,u){if(!n.essential&&Y.prefersReducedMotion){const ct=c.Q(n,["center","zoom","bearing","pitch","roll","elevation"]);return this.jumpTo(ct,u)}this.stop(),n=c.e({offset:[0,0],speed:1.2,curve:1.42,easing:c.co},n);const _=this._getTransformForUpdate(),b=_.bearing,T=_.pitch,I=_.roll,O=_.padding,N="bearing"in n?this._normalizeBearing(n.bearing,b):b,j="pitch"in n?+n.pitch:T,$="roll"in n?this._normalizeBearing(n.roll,I):I,X="padding"in n?n.padding:_.padding,W=c.P.convert(n.offset);let ee=_.centerPoint.add(W);const ae=_.screenPointToLocation(ee),_e=this.cameraHelper.handleFlyTo(_,{bearing:N,pitch:j,roll:$,padding:X,locationAtOffset:ae,offsetAsPoint:W,center:n.center,minZoom:n.minZoom,zoom:n.zoom});let ge=n.curve;const ve=Math.max(_.width,_.height),Te=ve/_e.scaleOfZoom,Me=_e.pixelPathLength;typeof _e.scaleOfMinZoom=="number"&&(ge=Math.sqrt(ve/_e.scaleOfMinZoom/Me*2));const Ae=ge*ge;function Le(ct){const Ot=(Te*Te-ve*ve+(ct?-1:1)*Ae*Ae*Me*Me)/(2*(ct?Te:ve)*Ae*Me);return Math.log(Math.sqrt(Ot*Ot+1)-Ot)}function Ue(ct){return(Math.exp(ct)-Math.exp(-ct))/2}function Ce(ct){return(Math.exp(ct)+Math.exp(-ct))/2}const We=Le(!1);let dt=function(ct){return Ce(We)/Ce(We+ge*ct)},rt=function(ct){return ve*((Ce(We)*(Ue(Ot=We+ge*ct)/Ce(Ot))-Ue(We))/Ae)/Me;var Ot},st=(Le(!0)-We)/ge;if(Math.abs(Me)<2e-6||!isFinite(st)){if(Math.abs(ve-Te)<1e-6)return this.easeTo(n,u);const ct=Te<ve?-1:1;st=Math.abs(Math.log(Te/ve))/ge,rt=()=>0,dt=Ot=>Math.exp(ct*ge*Ot)}return n.duration="duration"in n?+n.duration:1e3*st/("screenSpeed"in n?+n.screenSpeed/ge:+n.speed),n.maxDuration&&n.duration>n.maxDuration&&(n.duration=0),this._zooming=!0,this._rotating=b!==N,this._pitching=j!==T,this._rolling=$!==I,this._padding=!_.isPaddingEqual(X),this._prepareEase(u,!1),this.terrain&&this._prepareElevation(_e.targetCenter),this._ease((ct=>{const Ot=ct*st,Bt=1/dt(Ot),Et=rt(Ot);this._rotating&&_.setBearing(c.C.number(b,N,ct)),this._pitching&&_.setPitch(c.C.number(T,j,ct)),this._rolling&&_.setRoll(c.C.number(I,$,ct)),this._padding&&(_.interpolatePadding(O,X,ct),ee=_.centerPoint.add(W)),_e.easeFunc(ct,Bt,Et,ee),this.terrain&&!n.freezeElevation&&this._updateElevation(ct),this._applyUpdatedTransform(_),this._fireMoveEvents(u)}),(()=>{this.terrain&&n.freezeElevation&&this._finalizeElevation(),this._afterEase(u)}),n),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(n,u){var _;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const b=this._onEaseEnd;delete this._onEaseEnd,b.call(this,u)}return n||(_=this.handlers)===null||_===void 0||_.stop(!1),this}_ease(n,u,_){_.animate===!1||_.duration===0?(n(1),u()):(this._easeStart=Y.now(),this._easeOptions=_,this._onEaseFrame=n,this._onEaseEnd=u,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(n,u){n=c.aO(n,-180,180);const _=Math.abs(n-u);return Math.abs(n-360-u)<_&&(n-=360),Math.abs(n+360-u)<_&&(n+=360),n}queryTerrainElevation(n){return this.terrain?this.terrain.getElevationForLngLatZoom(c.S.convert(n),this.transform.tileZoom):null}}const iu={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class ii{constructor(n=iu){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=u=>{!u||u.sourceDataType!=="metadata"&&u.sourceDataType!=="visibility"&&u.dataType!=="style"&&u.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=n}getDefaultPosition(){return"bottom-right"}onAdd(n){return this._map=n,this._compact=this.options.compact,this._container=Q.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=Q.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Q.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){Q.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(n,u){const _=this._map._getUIString(`AttributionControl.${u}`);n.title=_,n.setAttribute("aria-label",_)}_updateAttributions(){if(!this._map.style)return;let n=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?n=n.concat(this.options.customAttribution.map((b=>typeof b!="string"?"":b))):typeof this.options.customAttribution=="string"&&n.push(this.options.customAttribution)),this._map.style.stylesheet){const b=this._map.style.stylesheet;this.styleOwner=b.owner,this.styleId=b.id}const u=this._map.style.sourceCaches;for(const b in u){const T=u[b];if(T.used||T.usedForTerrain){const I=T.getSource();I.attribution&&n.indexOf(I.attribution)<0&&n.push(I.attribution)}}n=n.filter((b=>String(b).trim())),n.sort(((b,T)=>b.length-T.length)),n=n.filter(((b,T)=>{for(let I=T+1;I<n.length;I++)if(n[I].indexOf(b)>=0)return!1;return!0}));const _=n.join(" | ");_!==this._attribHTML&&(this._attribHTML=_,n.length?(this._innerContainer.innerHTML=Q.sanitize(_),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Yi{constructor(n={}){this._updateCompact=()=>{const u=this._container.children;if(u.length){const _=u[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&_.classList.add("maplibregl-compact"):_.classList.remove("maplibregl-compact")}},this.options=n}getDefaultPosition(){return"bottom-left"}onAdd(n){this._map=n,this._compact=this.options&&this.options.compact,this._container=Q.create("div","maplibregl-ctrl");const u=Q.create("a","maplibregl-ctrl-logo");return u.target="_blank",u.rel="noopener nofollow",u.href="https://maplibre.org/",u.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),u.setAttribute("rel","noopener nofollow"),this._container.appendChild(u),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){Q.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Qi{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(n){const u=++this._id;return this._queue.push({callback:n,id:u,cancelled:!1}),u}remove(n){const u=this._currentlyRunning,_=u?this._queue.concat(u):this._queue;for(const b of _)if(b.id===n)return void(b.cancelled=!0)}run(n=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const u=this._currentlyRunning=this._queue;this._queue=[];for(const _ of u)if(!_.cancelled&&(_.callback(n),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Vc=c.aJ([{name:"a_pos3d",type:"Int16",components:3}]);class tn extends c.E{constructor(n){super(),this._lastTilesetChange=Y.now(),this.sourceCache=n,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=n._source.tileSize*2**this.deltaZoom,n.usedForTerrain=!0,n.tileSize=this.tileSize}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(n,u){this.sourceCache.update(n,u),this._renderableTilesKeys=[];const _={};for(const b of qe(n,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:u,calculateTileZoom:this.sourceCache._source.calculateTileZoom}))_[b.key]=!0,this._renderableTilesKeys.push(b.key),this._tiles[b.key]||(b.terrainRttPosMatrix32f=new Float64Array(16),c.bY(b.terrainRttPosMatrix32f,0,c.$,c.$,0,0,1),this._tiles[b.key]=new pa(b,this.tileSize),this._lastTilesetChange=Y.now());for(const b in this._tiles)_[b]||delete this._tiles[b]}freeRtt(n){for(const u in this._tiles){const _=this._tiles[u];(!n||_.tileID.equals(n)||_.tileID.isChildOf(n)||n.isChildOf(_.tileID))&&(_.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map((n=>this.getTileByID(n)))}getTileByID(n){return this._tiles[n]}getTerrainCoords(n,u){return u?this._getTerrainCoordsForTileRanges(n,u):this._getTerrainCoordsForRegularTile(n)}_getTerrainCoordsForRegularTile(n){const u={};for(const _ of this._renderableTilesKeys){const b=this._tiles[_].tileID,T=n.clone(),I=c.ba();if(b.canonical.equals(n.canonical))c.bY(I,0,c.$,c.$,0,0,1);else if(b.canonical.isChildOf(n.canonical)){const O=b.canonical.z-n.canonical.z,N=b.canonical.x-(b.canonical.x>>O<<O),j=b.canonical.y-(b.canonical.y>>O<<O),$=c.$>>O;c.bY(I,0,$,$,0,0,1),c.M(I,I,[-N*$,-j*$,0])}else{if(!n.canonical.isChildOf(b.canonical))continue;{const O=n.canonical.z-b.canonical.z,N=n.canonical.x-(n.canonical.x>>O<<O),j=n.canonical.y-(n.canonical.y>>O<<O),$=c.$>>O;c.bY(I,0,c.$,c.$,0,0,1),c.M(I,I,[N*$,j*$,0]),c.N(I,I,[1/2**O,1/2**O,0])}}T.terrainRttPosMatrix32f=new Float32Array(I),u[_]=T}return u}_getTerrainCoordsForTileRanges(n,u){const _={};for(const b of this._renderableTilesKeys){const T=this._tiles[b].tileID;if(!this._isWithinTileRanges(T,u))continue;const I=n.clone(),O=c.ba();if(T.canonical.z===n.canonical.z){const N=n.canonical.x-T.canonical.x,j=n.canonical.y-T.canonical.y;c.bY(O,0,c.$,c.$,0,0,1),c.M(O,O,[N*c.$,j*c.$,0])}else if(T.canonical.z>n.canonical.z){const N=T.canonical.z-n.canonical.z,j=T.canonical.x-(T.canonical.x>>N<<N),$=T.canonical.y-(T.canonical.y>>N<<N),X=n.canonical.x-(T.canonical.x>>N),W=n.canonical.y-(T.canonical.y>>N),ee=c.$>>N;c.bY(O,0,ee,ee,0,0,1),c.M(O,O,[-j*ee+X*c.$,-$*ee+W*c.$,0])}else{const N=n.canonical.z-T.canonical.z,j=n.canonical.x-(n.canonical.x>>N<<N),$=n.canonical.y-(n.canonical.y>>N<<N),X=(n.canonical.x>>N)-T.canonical.x,W=(n.canonical.y>>N)-T.canonical.y,ee=c.$<<N;c.bY(O,0,ee,ee,0,0,1),c.M(O,O,[j*c.$+X*ee,$*c.$+W*ee,0])}I.terrainRttPosMatrix32f=new Float32Array(O),_[b]=I}return _}getSourceTile(n,u){const _=this.sourceCache._source;let b=n.overscaledZ-this.deltaZoom;if(b>_.maxzoom&&(b=_.maxzoom),b<_.minzoom)return null;this._sourceTileCache[n.key]||(this._sourceTileCache[n.key]=n.scaledTo(b).key);let T=this.sourceCache.getTileByID(this._sourceTileCache[n.key]);if((!T||!T.dem)&&u)for(;b>=_.minzoom&&(!T||!T.dem);)T=this.sourceCache.getTileByID(n.scaledTo(b--).key);return T}anyTilesAfterTime(n=Date.now()){return this._lastTilesetChange>=n}_isWithinTileRanges(n,u){return u[n.canonical.z]&&n.canonical.x>=u[n.canonical.z].minTileX&&n.canonical.x<=u[n.canonical.z].maxTileX&&n.canonical.y>=u[n.canonical.z].minTileY&&n.canonical.y<=u[n.canonical.z].maxTileY}}class yn{constructor(n,u,_){this._meshCache={},this.painter=n,this.sourceCache=new tn(u),this.options=_,this.exaggeration=typeof _.exaggeration=="number"?_.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(n,u,_,b=c.$){var T;if(!(u>=0&&u<b&&_>=0&&_<b))return 0;const I=this.getTerrainData(n),O=(T=I.tile)===null||T===void 0?void 0:T.dem;if(!O)return 0;const N=c.cs([],[u/b*c.$,_/b*c.$],I.u_terrain_matrix),j=[N[0]*O.dim,N[1]*O.dim],$=Math.floor(j[0]),X=Math.floor(j[1]),W=j[0]-$,ee=j[1]-X;return O.get($,X)*(1-W)*(1-ee)+O.get($+1,X)*W*(1-ee)+O.get($,X+1)*(1-W)*ee+O.get($+1,X+1)*W*ee}getElevationForLngLatZoom(n,u){if(!c.ct(u,n.wrap()))return 0;const{tileID:_,mercatorX:b,mercatorY:T}=this._getOverscaledTileIDFromLngLatZoom(n,u);return this.getElevation(_,b%c.$,T%c.$,c.$)}getElevation(n,u,_,b=c.$){return this.getDEMElevation(n,u,_,b)*this.exaggeration}getTerrainData(n){if(!this._emptyDemTexture){const b=this.painter.context,T=new c.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new c.T(b,T,b.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new c.T(b,new c.R({width:1,height:1}),b.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(b.gl.NEAREST,b.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=c.ag([])}const u=this.sourceCache.getSourceTile(n,!0);if(u&&u.dem&&(!u.demTexture||u.needsTerrainPrepare)){const b=this.painter.context;u.demTexture=this.painter.getTileTexture(u.dem.stride),u.demTexture?u.demTexture.update(u.dem.getPixels(),{premultiply:!1}):u.demTexture=new c.T(b,u.dem.getPixels(),b.gl.RGBA,{premultiply:!1}),u.demTexture.bind(b.gl.NEAREST,b.gl.CLAMP_TO_EDGE),u.needsTerrainPrepare=!1}const _=u&&u+u.tileID.key+n.key;if(_&&!this._demMatrixCache[_]){const b=this.sourceCache.sourceCache._source.maxzoom;let T=n.canonical.z-u.tileID.canonical.z;n.overscaledZ>n.canonical.z&&(n.canonical.z>=b?T=n.canonical.z-b:c.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const I=n.canonical.x-(n.canonical.x>>T<<T),O=n.canonical.y-(n.canonical.y>>T<<T),N=c.cu(new Float64Array(16),[1/(c.$<<T),1/(c.$<<T),0]);c.M(N,N,[I*c.$,O*c.$,0]),this._demMatrixCache[n.key]={matrix:N,coord:n}}return{u_depth:2,u_terrain:3,u_terrain_dim:u&&u.dem&&u.dem.dim||1,u_terrain_matrix:_?this._demMatrixCache[n.key].matrix:this._emptyDemMatrix,u_terrain_unpack:u&&u.dem&&u.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(u&&u.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:u}}getFramebuffer(n){const u=this.painter,_=u.width/devicePixelRatio,b=u.height/devicePixelRatio;return!this._fbo||this._fbo.width===_&&this._fbo.height===b||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new c.T(u.context,{width:_,height:b,data:null},u.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(u.context.gl.NEAREST,u.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new c.T(u.context,{width:_,height:b,data:null},u.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(u.context.gl.NEAREST,u.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=u.context.createFramebuffer(_,b,!0,!1),this._fbo.depthAttachment.set(u.context.createRenderbuffer(u.context.gl.DEPTH_COMPONENT16,_,b))),this._fbo.colorAttachment.set(n==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const n=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const u=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let T=0,I=0;T<this._coordsTextureSize;T++)for(let O=0;O<this._coordsTextureSize;O++,I+=4)u[I+0]=255&O,u[I+1]=255&T,u[I+2]=O>>8<<4|T>>8,u[I+3]=0;const _=new c.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(u.buffer)),b=new c.T(n,_,n.gl.RGBA,{premultiply:!1});return b.bind(n.gl.NEAREST,n.gl.CLAMP_TO_EDGE),this._coordsTexture=b,b}pointCoordinate(n){this.painter.maybeDrawDepthAndCoords(!0);const u=new Uint8Array(4),_=this.painter.context,b=_.gl,T=Math.round(n.x*this.painter.pixelRatio/devicePixelRatio),I=Math.round(n.y*this.painter.pixelRatio/devicePixelRatio),O=Math.round(this.painter.height/devicePixelRatio);_.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),b.readPixels(T,O-I-1,1,1,b.RGBA,b.UNSIGNED_BYTE,u),_.bindFramebuffer.set(null);const N=u[0]+(u[2]>>4<<8),j=u[1]+((15&u[2])<<8),$=this.coordsIndex[255-u[3]],X=$&&this.sourceCache.getTileByID($);if(!X)return null;const W=this._coordsTextureSize,ee=(1<<X.tileID.canonical.z)*W;return new c.a1((X.tileID.canonical.x*W+N)/ee+X.tileID.wrap,(X.tileID.canonical.y*W+j)/ee,this.getElevation(X.tileID,N,j,W))}depthAtPoint(n){const u=new Uint8Array(4),_=this.painter.context,b=_.gl;return _.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),b.readPixels(n.x,this.painter.height/devicePixelRatio-n.y-1,1,1,b.RGBA,b.UNSIGNED_BYTE,u),_.bindFramebuffer.set(null),(u[0]/16777216+u[1]/65536+u[2]/256+u[3])/256}getTerrainMesh(n){var u;const _=((u=this.painter.style.projection)===null||u===void 0?void 0:u.transitionState)>0,b=_&&n.canonical.y===0,T=_&&n.canonical.y===(1<<n.canonical.z)-1,I=`m_${b?"n":""}_${T?"s":""}`;if(this._meshCache[I])return this._meshCache[I];const O=this.painter.context,N=new c.cv,j=new c.aN,$=this.meshSize,X=c.$/$,W=$*$;for(let Ce=0;Ce<=$;Ce++)for(let We=0;We<=$;We++)N.emplaceBack(We*X,Ce*X,0);for(let Ce=0;Ce<W;Ce+=$+1)for(let We=0;We<$;We++)j.emplaceBack(We+Ce,$+We+Ce+1,$+We+Ce+2),j.emplaceBack(We+Ce,$+We+Ce+2,We+Ce+1);const ee=N.length,ae=ee+($+1),_e=($+1)*$,ge=b?c.bh:0,ve=b?0:1,Te=T?c.bi:c.$,Me=T?0:1;for(let Ce=0;Ce<=$;Ce++)N.emplaceBack(Ce*X,ge,ve);for(let Ce=0;Ce<=$;Ce++)N.emplaceBack(Ce*X,Te,Me);for(let Ce=0;Ce<$;Ce++)j.emplaceBack(_e+Ce,ae+Ce,ae+Ce+1),j.emplaceBack(_e+Ce,ae+Ce+1,_e+Ce+1),j.emplaceBack(0+Ce,ee+Ce+1,ee+Ce),j.emplaceBack(0+Ce,0+Ce+1,ee+Ce+1);const Ae=N.length,Le=Ae+2*($+1);for(const Ce of[0,1])for(let We=0;We<=$;We++)for(const dt of[0,1])N.emplaceBack(Ce*c.$,We*X,dt);for(let Ce=0;Ce<2*$;Ce+=2)j.emplaceBack(Ae+Ce,Ae+Ce+1,Ae+Ce+3),j.emplaceBack(Ae+Ce,Ae+Ce+3,Ae+Ce+2),j.emplaceBack(Le+Ce,Le+Ce+3,Le+Ce+1),j.emplaceBack(Le+Ce,Le+Ce+2,Le+Ce+3);const Ue=new Qa(O.createVertexBuffer(N,Vc.members),O.createIndexBuffer(j),c.aM.simpleSegment(0,0,N.length,j.length));return this._meshCache[I]=Ue,Ue}getMeshFrameDelta(n){return 2*Math.PI*c.bu/Math.pow(2,Math.max(n,0))/5}getMinTileElevationForLngLatZoom(n,u){var _;const{tileID:b}=this._getOverscaledTileIDFromLngLatZoom(n,u);return(_=this.getMinMaxElevation(b).minElevation)!==null&&_!==void 0?_:0}getMinMaxElevation(n){const u=this.getTerrainData(n).tile,_={minElevation:null,maxElevation:null};return u&&u.dem&&(_.minElevation=u.dem.min*this.exaggeration,_.maxElevation=u.dem.max*this.exaggeration),_}_getOverscaledTileIDFromLngLatZoom(n,u){const _=c.a1.fromLngLat(n.wrap()),b=(1<<u)*c.$,T=_.x*b,I=_.y*b,O=Math.floor(T/c.$),N=Math.floor(I/c.$);return{tileID:new c.Z(u,0,u,O,N),mercatorX:T,mercatorY:I}}}class Uc{constructor(n,u,_){this._context=n,this._size=u,this._tileSize=_,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const n of this._objects)n.texture.destroy(),n.fbo.destroy()}_createObject(n){const u=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),_=new c.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return _.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),u.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),u.colorAttachment.set(_.texture),{id:n,fbo:u,texture:_,stamp:-1,inUse:!1}}getObjectForId(n){return this._objects[n]}useObject(n){n.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter((u=>n.id!==u)),this._recentlyUsed.push(n.id)}stampObject(n){n.stamp=++this._stamp}getOrCreateFreeObject(){for(const u of this._recentlyUsed)if(!this._objects[u].inUse)return this._objects[u];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const n=this._createObject(this._objects.length);return this._objects.push(n),n}freeObject(n){n.inUse=!1}freeAllObjects(){for(const n of this._objects)this.freeObject(n)}isFull(){return!(this._objects.length<this._size)&&this._objects.some((n=>!n.inUse))===!1}}const ol={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class bu{constructor(n,u){this.painter=n,this.terrain=u,this.pool=new Uc(n.context,30,u.sourceCache.tileSize*u.qualityFactor)}destruct(){this.pool.destruct()}getTexture(n){return this.pool.getObjectForId(n.rtt[this._stacks.length-1].id).texture}prepareForRender(n,u){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=n._order.filter((_=>!n._layers[_].isHidden(u))),this._coordsAscending={};for(const _ in n.sourceCaches){this._coordsAscending[_]={};const b=n.sourceCaches[_].getVisibleCoordinates(),T=n.sourceCaches[_].getSource(),I=T instanceof Fi?T.terrainTileRanges:null;for(const O of b){const N=this.terrain.sourceCache.getTerrainCoords(O,I);for(const j in N)this._coordsAscending[_][j]||(this._coordsAscending[_][j]=[]),this._coordsAscending[_][j].push(N[j])}}this._coordsAscendingStr={};for(const _ of n._order){const b=n._layers[_],T=b.source;if(ol[b.type]&&!this._coordsAscendingStr[T]){this._coordsAscendingStr[T]={};for(const I in this._coordsAscending[T])this._coordsAscendingStr[T][I]=this._coordsAscending[T][I].map((O=>O.key)).sort().join()}}for(const _ of this._renderableTiles)for(const b in this._coordsAscendingStr){const T=this._coordsAscendingStr[b][_.tileID.key];T&&T!==_.rttCoords[b]&&(_.rtt=[])}}renderLayer(n,u){if(n.isHidden(this.painter.transform.zoom))return!1;const _=Object.assign(Object.assign({},u),{isRenderingToTexture:!0}),b=n.type,T=this.painter,I=this._renderableLayerIds[this._renderableLayerIds.length-1]===n.id;if(ol[b]&&(this._prevType&&ol[this._prevType]||this._stacks.push([]),this._prevType=b,this._stacks[this._stacks.length-1].push(n.id),!I))return!0;if(ol[this._prevType]||ol[b]&&I){this._prevType=b;const O=this._stacks.length-1,N=this._stacks[O]||[];for(const j of this._renderableTiles){if(this.pool.isFull()&&(Lc(this.painter,this.terrain,this._rttTiles,_),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(j),j.rtt[O]){const X=this.pool.getObjectForId(j.rtt[O].id);if(X.stamp===j.rtt[O].stamp){this.pool.useObject(X);continue}}const $=this.pool.getOrCreateFreeObject();this.pool.useObject($),this.pool.stampObject($),j.rtt[O]={id:$.id,stamp:$.stamp},T.context.bindFramebuffer.set($.fbo.framebuffer),T.context.clear({color:c.bf.transparent,stencil:0}),T.currentStencilSource=void 0;for(let X=0;X<N.length;X++){const W=T.style._layers[N[X]],ee=W.source?this._coordsAscending[W.source][j.tileID.key]:[j.tileID];T.context.viewport.set([0,0,$.fbo.width,$.fbo.height]),T._renderTileClippingMasks(W,ee,!0),T.renderLayer(T,T.style.sourceCaches[W.source],W,ee,_),W.source&&(j.rttCoords[W.source]=this._coordsAscendingStr[W.source][j.tileID.key])}}return Lc(this.painter,this.terrain,this._rttTiles,_),this._rttTiles=[],this.pool.freeAllObjects(),ol[b]}return!1}}const no={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Yr=C,So={hash:!1,interactive:!0,bearingSnap:7,attributionControl:iu,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:c.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0},Qf={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class wh{constructor(n,u,_=!1){this.mousedown=T=>{this.startMove(T,Q.mousePos(this.element,T)),Q.addEventListener(window,"mousemove",this.mousemove),Q.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=T=>{this.move(T,Q.mousePos(this.element,T))},this.mouseup=T=>{this._rotatePitchHandler.dragEnd(T),this.offTemp()},this.touchstart=T=>{T.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Q.touchPos(this.element,T.targetTouches)[0],this.startMove(T,this._startPos),Q.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),Q.addEventListener(window,"touchend",this.touchend))},this.touchmove=T=>{T.targetTouches.length!==1?this.reset():(this._lastPos=Q.touchPos(this.element,T.targetTouches)[0],this.move(T,this._lastPos))},this.touchend=T=>{T.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHandler.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=u;const b=new Kd;this._rotatePitchHandler=new gh({clickTolerance:3,move:(T,I)=>{const O=u.getBoundingClientRect(),N=new c.P((O.bottom-O.top)/2,(O.right-O.left)/2);return{bearingDelta:c.cn(new c.P(T.x,I.y),I,N),pitchDelta:_?-.5*(I.y-T.y):void 0}},moveStateManager:b,enable:!0,assignEvents:()=>{}}),this.map=n,Q.addEventListener(u,"mousedown",this.mousedown),Q.addEventListener(u,"touchstart",this.touchstart,{passive:!1}),Q.addEventListener(u,"touchcancel",this.reset)}startMove(n,u){this._rotatePitchHandler.dragStart(n,u),Q.disableDrag()}move(n,u){const _=this.map,{bearingDelta:b,pitchDelta:T}=this._rotatePitchHandler.dragMove(n,u)||{};b&&_.setBearing(_.getBearing()+b),T&&_.setPitch(_.getPitch()+T)}off(){const n=this.element;Q.removeEventListener(n,"mousedown",this.mousedown),Q.removeEventListener(n,"touchstart",this.touchstart,{passive:!1}),Q.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),Q.removeEventListener(window,"touchend",this.touchend),Q.removeEventListener(n,"touchcancel",this.reset),this.offTemp()}offTemp(){Q.enableDrag(),Q.removeEventListener(window,"mousemove",this.mousemove),Q.removeEventListener(window,"mouseup",this.mouseup),Q.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),Q.removeEventListener(window,"touchend",this.touchend)}}let ji;function Qr(w,n,u,_=!1){if(_||!u.getCoveringTilesDetailsProvider().allowWorldCopies())return w==null?void 0:w.wrap();const b=new c.S(w.lng,w.lat);if(w=new c.S(w.lng,w.lat),n){const T=new c.S(w.lng-360,w.lat),I=new c.S(w.lng+360,w.lat),O=u.locationToScreenPoint(w).distSqr(n);u.locationToScreenPoint(T).distSqr(n)<O?w=T:u.locationToScreenPoint(I).distSqr(n)<O&&(w=I)}for(;Math.abs(w.lng-u.center.lng)>180;){const T=u.locationToScreenPoint(w);if(T.x>=0&&T.y>=0&&T.x<=u.width&&T.y<=u.height)break;w.lng>u.center.lng?w.lng-=360:w.lng+=360}return w.lng!==b.lng&&u.isPointOnMapSurface(u.locationToScreenPoint(w))?w:b}const Th={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function ec(w,n,u){const _=w.classList;for(const b in Th)_.remove(`maplibregl-${u}-anchor-${b}`);_.add(`maplibregl-${u}-anchor-${n}`)}class tc extends c.E{constructor(n){if(super(),this._onKeyPress=u=>{const _=u.code,b=u.charCode||u.keyCode;_!=="Space"&&_!=="Enter"&&b!==32&&b!==13||this.togglePopup()},this._onMapClick=u=>{const _=u.originalEvent.target,b=this._element;this._popup&&(_===b||b.contains(_))&&this.togglePopup()},this._update=u=>{if(!this._map)return;const _=this._map.loaded()&&!this._map.isMoving();((u==null?void 0:u.type)==="terrain"||(u==null?void 0:u.type)==="render"&&!_)&&this._map.once("render",this._update),this._lngLat=Qr(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let b="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?b=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(b=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let T="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?T="rotateX(0deg)":this._pitchAlignment==="map"&&(T=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||u&&u.type!=="moveend"||(this._pos=this._pos.round()),Q.setTransform(this._element,`${Th[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${T} ${b}`),Y.frameAsync(new AbortController).then((()=>{this._updateOpacity(u&&u.type==="moveend")})).catch((()=>{}))},this._onMove=u=>{if(!this._isDragging){const _=this._clickTolerance||this._map._clickTolerance;this._isDragging=u.point.dist(this._pointerdownPos)>=_}this._isDragging&&(this._pos=u.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new c.l("dragstart"))),this.fire(new c.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new c.l("dragend")),this._state="inactive"},this._addDragHandler=u=>{this._element.contains(u.originalEvent.target)&&(u.preventDefault(),this._positionDelta=u.point.sub(this._pos).add(this._offset),this._pointerdownPos=u.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=n&&n.anchor||"center",this._color=n&&n.color||"#3FB1CE",this._scale=n&&n.scale||1,this._draggable=n&&n.draggable||!1,this._clickTolerance=n&&n.clickTolerance||0,this._subpixelPositioning=n&&n.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=n&&n.rotation||0,this._rotationAlignment=n&&n.rotationAlignment||"auto",this._pitchAlignment=n&&n.pitchAlignment&&n.pitchAlignment!=="auto"?n.pitchAlignment:this._rotationAlignment,this.setOpacity(n==null?void 0:n.opacity,n==null?void 0:n.opacityWhenCovered),n&&n.element)this._element=n.element,this._offset=c.P.convert(n&&n.offset||[0,0]);else{this._defaultMarker=!0,this._element=Q.create("div");const u=Q.createNS("http://www.w3.org/2000/svg","svg"),_=41,b=27;u.setAttributeNS(null,"display","block"),u.setAttributeNS(null,"height",`${_}px`),u.setAttributeNS(null,"width",`${b}px`),u.setAttributeNS(null,"viewBox",`0 0 ${b} ${_}`);const T=Q.createNS("http://www.w3.org/2000/svg","g");T.setAttributeNS(null,"stroke","none"),T.setAttributeNS(null,"stroke-width","1"),T.setAttributeNS(null,"fill","none"),T.setAttributeNS(null,"fill-rule","evenodd");const I=Q.createNS("http://www.w3.org/2000/svg","g");I.setAttributeNS(null,"fill-rule","nonzero");const O=Q.createNS("http://www.w3.org/2000/svg","g");O.setAttributeNS(null,"transform","translate(3.0, 29.0)"),O.setAttributeNS(null,"fill","#000000");const N=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const ve of N){const Te=Q.createNS("http://www.w3.org/2000/svg","ellipse");Te.setAttributeNS(null,"opacity","0.04"),Te.setAttributeNS(null,"cx","10.5"),Te.setAttributeNS(null,"cy","5.80029008"),Te.setAttributeNS(null,"rx",ve.rx),Te.setAttributeNS(null,"ry",ve.ry),O.appendChild(Te)}const j=Q.createNS("http://www.w3.org/2000/svg","g");j.setAttributeNS(null,"fill",this._color);const $=Q.createNS("http://www.w3.org/2000/svg","path");$.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),j.appendChild($);const X=Q.createNS("http://www.w3.org/2000/svg","g");X.setAttributeNS(null,"opacity","0.25"),X.setAttributeNS(null,"fill","#000000");const W=Q.createNS("http://www.w3.org/2000/svg","path");W.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),X.appendChild(W);const ee=Q.createNS("http://www.w3.org/2000/svg","g");ee.setAttributeNS(null,"transform","translate(6.0, 7.0)"),ee.setAttributeNS(null,"fill","#FFFFFF");const ae=Q.createNS("http://www.w3.org/2000/svg","g");ae.setAttributeNS(null,"transform","translate(8.0, 8.0)");const _e=Q.createNS("http://www.w3.org/2000/svg","circle");_e.setAttributeNS(null,"fill","#000000"),_e.setAttributeNS(null,"opacity","0.25"),_e.setAttributeNS(null,"cx","5.5"),_e.setAttributeNS(null,"cy","5.5"),_e.setAttributeNS(null,"r","5.4999962");const ge=Q.createNS("http://www.w3.org/2000/svg","circle");ge.setAttributeNS(null,"fill","#FFFFFF"),ge.setAttributeNS(null,"cx","5.5"),ge.setAttributeNS(null,"cy","5.5"),ge.setAttributeNS(null,"r","5.4999962"),ae.appendChild(_e),ae.appendChild(ge),I.appendChild(O),I.appendChild(j),I.appendChild(X),I.appendChild(ee),I.appendChild(ae),u.appendChild(I),u.setAttributeNS(null,"height",_*this._scale+"px"),u.setAttributeNS(null,"width",b*this._scale+"px"),this._element.appendChild(u),this._offset=c.P.convert(n&&n.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",(u=>{u.preventDefault()})),this._element.addEventListener("mousedown",(u=>{u.preventDefault()})),ec(this._element,this._anchor,"marker"),n&&n.className)for(const u of n.className.split(" "))this._element.classList.add(u);this._popup=null}addTo(n){return this.remove(),this._map=n,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",n._getUIString("Marker.Title")),n.getCanvasContainer().appendChild(this._element),n.on("move",this._update),n.on("moveend",this._update),n.on("terrain",this._update),n.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),Q.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(n){return this._lngLat=c.S.convert(n),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(n){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),n){if(!("offset"in n.options)){const b=Math.abs(13.5)/Math.SQRT2;n.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[b,-1*(38.1-13.5+b)],"bottom-right":[-b,-1*(38.1-13.5+b)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=n,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(n){return this._subpixelPositioning=n,this}getPopup(){return this._popup}togglePopup(){const n=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:n?(n.isOpen()?n.remove():(n.setLngLat(this._lngLat),n.addTo(this._map)),this):this}_updateOpacity(n=!1){var u,_;const b=(u=this._map)===null||u===void 0?void 0:u.terrain,T=this._map.transform.isLocationOccluded(this._lngLat);if(!b||T){const ee=T?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==ee&&(this._element.style.opacity=ee))}if(n)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout((()=>{this._opacityTimeout=null}),100)}const I=this._map,O=I.terrain.depthAtPoint(this._pos),N=I.terrain.getElevationForLngLatZoom(this._lngLat,I.transform.tileZoom);if(I.transform.lngLatToCameraDepth(this._lngLat,N)-O<.006)return void(this._element.style.opacity=this._opacity);const j=-this._offset.y/I.transform.pixelsPerMeter,$=Math.sin(I.getPitch()*Math.PI/180)*j,X=I.terrain.depthAtPoint(new c.P(this._pos.x,this._pos.y-this._offset.y)),W=I.transform.lngLatToCameraDepth(this._lngLat,N+$)-X>.006;!((_=this._popup)===null||_===void 0)&&_.isOpen()&&W&&this._popup.remove(),this._element.style.opacity=W?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(n){return this._offset=c.P.convert(n),this._update(),this}addClassName(n){this._element.classList.add(n)}removeClassName(n){this._element.classList.remove(n)}toggleClassName(n){return this._element.classList.toggle(n)}setDraggable(n){return this._draggable=!!n,this._map&&(n?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(n){return this._rotation=n||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(n){return this._rotationAlignment=n||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(n){return this._pitchAlignment=n&&n!=="auto"?n:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(n,u){return(this._opacity===void 0||n===void 0&&u===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),n!==void 0&&(this._opacity=n),u!==void 0&&(this._opacityWhenCovered=u),this._map&&this._updateOpacity(!0),this}}const ks={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Mr=0,xu=!1;const wu={maxWidth:100,unit:"metric"};function jc(w,n,u){const _=u&&u.maxWidth||100,b=w._container.clientHeight/2,T=w._container.clientWidth/2,I=w.unproject([T-_/2,b]),O=w.unproject([T+_/2,b]),N=Math.round(w.project(O).x-w.project(I).x),j=Math.min(_,N,w._container.clientWidth),$=I.distanceTo(O);if(u&&u.unit==="imperial"){const X=3.2808*$;X>5280?Tu(n,j,X/5280,w._getUIString("ScaleControl.Miles")):Tu(n,j,X,w._getUIString("ScaleControl.Feet"))}else u&&u.unit==="nautical"?Tu(n,j,$/1852,w._getUIString("ScaleControl.NauticalMiles")):$>=1e3?Tu(n,j,$/1e3,w._getUIString("ScaleControl.Kilometers")):Tu(n,j,$,w._getUIString("ScaleControl.Meters"))}function Tu(w,n,u,_){const b=(function(T){const I=Math.pow(10,`${Math.floor(T)}`.length-1);let O=T/I;return O=O>=10?10:O>=5?5:O>=3?3:O>=2?2:O>=1?1:(function(N){const j=Math.pow(10,Math.ceil(-Math.log(N)/Math.LN10));return Math.round(N*j)/j})(O),I*O})(u);w.style.width=n*(b/u)+"px",w.innerHTML=`${b}&nbsp;${_}`}const Ol={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},Sh=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Eh(w){if(w){if(typeof w=="number"){const n=Math.round(Math.abs(w)/Math.SQRT2);return{center:new c.P(0,0),top:new c.P(0,w),"top-left":new c.P(n,n),"top-right":new c.P(-n,n),bottom:new c.P(0,-w),"bottom-left":new c.P(n,-n),"bottom-right":new c.P(-n,-n),left:new c.P(w,0),right:new c.P(-w,0)}}if(w instanceof c.P||Array.isArray(w)){const n=c.P.convert(w);return{center:n,top:n,"top-left":n,"top-right":n,bottom:n,"bottom-left":n,"bottom-right":n,left:n,right:n}}return{center:c.P.convert(w.center||[0,0]),top:c.P.convert(w.top||[0,0]),"top-left":c.P.convert(w["top-left"]||[0,0]),"top-right":c.P.convert(w["top-right"]||[0,0]),bottom:c.P.convert(w.bottom||[0,0]),"bottom-left":c.P.convert(w["bottom-left"]||[0,0]),"bottom-right":c.P.convert(w["bottom-right"]||[0,0]),left:c.P.convert(w.left||[0,0]),right:c.P.convert(w.right||[0,0])}}return Eh(new c.P(0,0))}const hd=C;g.AJAXError=c.cz,g.Event=c.l,g.Evented=c.E,g.LngLat=c.S,g.MercatorCoordinate=c.a1,g.Point=c.P,g.addProtocol=c.cA,g.config=c.a,g.removeProtocol=c.cB,g.AttributionControl=ii,g.BoxZoomHandler=zc,g.CanvasSource=fa,g.CooperativeGesturesHandler=Yf,g.DoubleClickZoomHandler=Nc,g.DragPanHandler=xh,g.DragRotateHandler=Bc,g.EdgeInsets=Zs,g.FullscreenControl=class extends c.E{constructor(w={}){super(),this._onFullscreenChange=()=>{var n;let u=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((n=u==null?void 0:u.shadowRoot)===null||n===void 0)&&n.fullscreenElement;)u=u.shadowRoot.fullscreenElement;u===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,w&&w.container&&(w.container instanceof HTMLElement?this._container=w.container:c.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(w){return this._map=w,this._container||(this._container=this._map.getContainer()),this._controlContainer=Q.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){Q.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const w=this._fullscreenButton=Q.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);Q.create("span","maplibregl-ctrl-icon",w).setAttribute("aria-hidden","true"),w.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const w=this._getTitle();this._fullscreenButton.setAttribute("aria-label",w),this._fullscreenButton.title=w}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new c.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new c.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},g.GeoJSONSource=Ba,g.GeolocateControl=class extends c.E{constructor(w){super(),this._onSuccess=n=>{if(this._map){if(this._isOutOfMapMaxBounds(n))return this._setErrorState(),this.fire(new c.l("outofmaxbounds",n)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=n,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(n),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(n),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new c.l("geolocate",n)),this._finish()}},this._updateCamera=n=>{const u=new c.S(n.coords.longitude,n.coords.latitude),_=n.coords.accuracy,b=this._map.getBearing(),T=c.e({bearing:b},this.options.fitBoundsOptions),I=Pi.fromLngLat(u,_);this._map.fitBounds(I,T,{geolocateSource:!0})},this._updateMarker=n=>{if(n){const u=new c.S(n.coords.longitude,n.coords.latitude);this._accuracyCircleMarker.setLngLat(u).addTo(this._map),this._userLocationDotMarker.setLngLat(u).addTo(this._map),this._accuracy=n.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=n=>{if(this._map){if(n.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const u=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=u,this._geolocateButton.setAttribute("aria-label",u),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(n.code===3&&xu)return;this.options.trackUserLocation&&this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new c.l("error",n)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",(n=>n.preventDefault())),this._geolocateButton=Q.create("button","maplibregl-ctrl-geolocate",this._container),Q.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=n=>{if(this._map){if(n===!1){c.w("Geolocation support is not available so the GeolocateControl will be disabled.");const u=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=u,this._geolocateButton.setAttribute("aria-label",u)}else{const u=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=u,this._geolocateButton.setAttribute("aria-label",u)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Q.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new tc({element:this._dotElement}),this._circleElement=Q.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new tc({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",(()=>this.trigger())),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(u=>{const _=(u==null?void 0:u[0])instanceof ResizeObserverEntry;u.geolocateSource||this._watchState!=="ACTIVE_LOCK"||_||this._map.isZooming()||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new c.l("trackuserlocationend")),this.fire(new c.l("userlocationlostfocus")))}))}},this.options=c.e({},ks,w)}onAdd(w){return this._map=w,this._container=Q.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),(function(){return c._(this,arguments,void 0,(function*(n=!1){if(ji!==void 0&&!n)return ji;if(window.navigator.permissions===void 0)return ji=!!window.navigator.geolocation,ji;try{ji=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{ji=!!window.navigator.geolocation}return ji}))})().then((n=>this._finishSetupUI(n))),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),Q.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Mr=0,xu=!1}_isOutOfMapMaxBounds(w){const n=this._map.getMaxBounds(),u=w.coords;return n&&(u.longitude<n.getWest()||u.longitude>n.getEast()||u.latitude<n.getSouth()||u.latitude>n.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const w=this._map.getBounds(),n=w.getSouthEast(),u=w.getNorthEast(),_=n.distanceTo(u),b=Math.ceil(this._accuracy/(_/this._map._container.clientHeight)*2);this._circleElement.style.width=`${b}px`,this._circleElement.style.height=`${b}px`}trigger(){if(!this._setup)return c.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new c.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Mr--,xu=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new c.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new c.l("trackuserlocationstart")),this.fire(new c.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let w;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Mr++,Mr>1?(w={maximumAge:6e5,timeout:0},xu=!0):(w=this.options.positionOptions,xu=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,w)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},g.GlobeControl=class{constructor(){this._toggleProjection=()=>{var w;const n=(w=this._map.getProjection())===null||w===void 0?void 0:w.type;this._map.setProjection(n!=="mercator"&&n?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var w;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((w=this._map.getProjection())===null||w===void 0?void 0:w.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(w){return this._map=w,this._container=Q.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=Q.create("button","maplibregl-ctrl-globe",this._container),Q.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){Q.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},g.Hash=To,g.ImageSource=Fi,g.KeyboardHandler=zl,g.LngLatBounds=Pi,g.LogoControl=Yi,g.Map=class extends Qd{constructor(w){var n,u;c.cw.mark(c.cx.create);const _=Object.assign(Object.assign(Object.assign({},So),w),{canvasContextAttributes:Object.assign(Object.assign({},So.canvasContextAttributes),w.canvasContextAttributes)});if(_.minZoom!=null&&_.maxZoom!=null&&_.minZoom>_.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(_.minPitch!=null&&_.maxPitch!=null&&_.minPitch>_.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(_.minPitch!=null&&_.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(_.maxPitch!=null&&_.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const b=new bn,T=new Oi;if(_.minZoom!==void 0&&b.setMinZoom(_.minZoom),_.maxZoom!==void 0&&b.setMaxZoom(_.maxZoom),_.minPitch!==void 0&&b.setMinPitch(_.minPitch),_.maxPitch!==void 0&&b.setMaxPitch(_.maxPitch),_.renderWorldCopies!==void 0&&b.setRenderWorldCopies(_.renderWorldCopies),super(b,T,{bearingSnap:_.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Qi,this._controls=[],this._mapId=c.a7(),this._contextLost=O=>{O.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new c.l("webglcontextlost",{originalEvent:O}))},this._contextRestored=O=>{this._setupPainter(),this.resize(),this._update(),this.fire(new c.l("webglcontextrestored",{originalEvent:O}))},this._onMapScroll=O=>{if(O.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=_.interactive,this._maxTileCacheSize=_.maxTileCacheSize,this._maxTileCacheZoomLevels=_.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},_.canvasContextAttributes),this._trackResize=_.trackResize===!0,this._bearingSnap=_.bearingSnap,this._centerClampedToGround=_.centerClampedToGround,this._refreshExpiredTiles=_.refreshExpiredTiles===!0,this._fadeDuration=_.fadeDuration,this._crossSourceCollisions=_.crossSourceCollisions===!0,this._collectResourceTiming=_.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},no),_.locale),this._clickTolerance=_.clickTolerance,this._overridePixelRatio=_.pixelRatio,this._maxCanvasSize=_.maxCanvasSize,this.transformCameraUpdate=_.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=_.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=Ke.addThrottleControl((()=>this.isMoving())),this._requestManager=new Ve(_.transformRequest),typeof _.container=="string"){if(this._container=document.getElementById(_.container),!this._container)throw new Error(`Container '${_.container}' not found.`)}else{if(!(_.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=_.container}if(_.maxBounds&&this.setMaxBounds(_.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this.on("terrain",(()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)})),this.once("idle",(()=>{this._idleTriggered=!0})),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let O=!1;const N=qa((j=>{this._trackResize&&!this._removed&&(this.resize(j),this.redraw())}),50);this._resizeObserver=new ResizeObserver((j=>{O?N(j):O=!0})),this._resizeObserver.observe(this._container)}this.handlers=new cd(this,_),this._hash=_.hash&&new To(typeof _.hash=="string"&&_.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:_.center,elevation:_.elevation,zoom:_.zoom,bearing:_.bearing,pitch:_.pitch,roll:_.roll}),_.bounds&&(this.resize(),this.fitBounds(_.bounds,c.e({},_.fitBoundsOptions,{duration:0}))));const I=typeof _.style=="string"||((u=(n=_.style)===null||n===void 0?void 0:n.projection)===null||u===void 0?void 0:u.type)!=="globe";this.resize(null,I),this._localIdeographFontFamily=_.localIdeographFontFamily,this._validateStyle=_.validateStyle,_.style&&this.setStyle(_.style,{localIdeographFontFamily:_.localIdeographFontFamily}),_.attributionControl&&this.addControl(new ii(typeof _.attributionControl=="boolean"?void 0:_.attributionControl)),_.maplibreLogo&&this.addControl(new Yi,_.logoPosition),this.on("style.load",(()=>{if(I||this._resizeTransform(),this.transform.unmodified){const O=c.Q(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(O)}})),this.on("data",(O=>{this._update(O.dataType==="style"),this.fire(new c.l(`${O.dataType}data`,O))})),this.on("dataloading",(O=>{this.fire(new c.l(`${O.dataType}dataloading`,O))})),this.on("dataabort",(O=>{this.fire(new c.l("sourcedataabort",O))}))}_getMapId(){return this._mapId}setGlobalStateProperty(w,n){return this.style.setGlobalStateProperty(w,n),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(w,n){if(n===void 0&&(n=w.getDefaultPosition?w.getDefaultPosition():"top-right"),!w||!w.onAdd)return this.fire(new c.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const u=w.onAdd(this);this._controls.push(w);const _=this._controlPositions[n];return n.indexOf("bottom")!==-1?_.insertBefore(u,_.firstChild):_.appendChild(u),this}removeControl(w){if(!w||!w.onRemove)return this.fire(new c.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const n=this._controls.indexOf(w);return n>-1&&this._controls.splice(n,1),w.onRemove(this),this}hasControl(w){return this._controls.indexOf(w)>-1}calculateCameraOptionsFromTo(w,n,u,_){return _==null&&this.terrain&&(_=this.terrain.getElevationForLngLatZoom(u,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(w,n,u,_)}resize(w,n=!0){const[u,_]=this._containerDimensions(),b=this._getClampedPixelRatio(u,_);if(this._resizeCanvas(u,_,b),this.painter.resize(u,_,b),this.painter.overLimit()){const I=this.painter.context.gl;this._maxCanvasSize=[I.drawingBufferWidth,I.drawingBufferHeight];const O=this._getClampedPixelRatio(u,_);this._resizeCanvas(u,_,O),this.painter.resize(u,_,O)}this._resizeTransform(n);const T=!this._moving;return T&&(this.stop(),this.fire(new c.l("movestart",w)).fire(new c.l("move",w))),this.fire(new c.l("resize",w)),T&&this.fire(new c.l("moveend",w)),this}_resizeTransform(w=!0){var n;const[u,_]=this._containerDimensions();this.transform.resize(u,_,w),(n=this._requestedCameraState)===null||n===void 0||n.resize(u,_,w)}_getClampedPixelRatio(w,n){const{0:u,1:_}=this._maxCanvasSize,b=this.getPixelRatio(),T=w*b,I=n*b;return Math.min(T>u?u/T:1,I>_?_/I:1)*b}getPixelRatio(){var w;return(w=this._overridePixelRatio)!==null&&w!==void 0?w:devicePixelRatio}setPixelRatio(w){this._overridePixelRatio=w,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(w){return this.transform.setMaxBounds(Pi.convert(w)),this._update()}setMinZoom(w){if((w=w??-2)>=-2&&w<=this.transform.maxZoom)return this.transform.setMinZoom(w),this._update(),this.getZoom()<w&&this.setZoom(w),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(w){if((w=w??22)>=this.transform.minZoom)return this.transform.setMaxZoom(w),this._update(),this.getZoom()>w&&this.setZoom(w),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(w){if((w=w??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(w>=0&&w<=this.transform.maxPitch)return this.transform.setMinPitch(w),this._update(),this.getPitch()<w&&this.setPitch(w),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(w){if((w=w??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(w>=this.transform.minPitch)return this.transform.setMaxPitch(w),this._update(),this.getPitch()>w&&this.setPitch(w),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(w){return this.transform.setRenderWorldCopies(w),this._update()}project(w){return this.transform.locationToScreenPoint(c.S.convert(w),this.style&&this.terrain)}unproject(w){return this.transform.screenPointToLocation(c.P.convert(w),this.terrain)}isMoving(){var w;return this._moving||((w=this.handlers)===null||w===void 0?void 0:w.isMoving())}isZooming(){var w;return this._zooming||((w=this.handlers)===null||w===void 0?void 0:w.isZooming())}isRotating(){var w;return this._rotating||((w=this.handlers)===null||w===void 0?void 0:w.isRotating())}_createDelegatedListener(w,n,u){if(w==="mouseenter"||w==="mouseover"){let _=!1;return{layers:n,listener:u,delegates:{mousemove:T=>{const I=n.filter((N=>this.getLayer(N))),O=I.length!==0?this.queryRenderedFeatures(T.point,{layers:I}):[];O.length?_||(_=!0,u.call(this,new to(w,this,T.originalEvent,{features:O}))):_=!1},mouseout:()=>{_=!1}}}}if(w==="mouseleave"||w==="mouseout"){let _=!1;return{layers:n,listener:u,delegates:{mousemove:I=>{const O=n.filter((N=>this.getLayer(N)));(O.length!==0?this.queryRenderedFeatures(I.point,{layers:O}):[]).length?_=!0:_&&(_=!1,u.call(this,new to(w,this,I.originalEvent)))},mouseout:I=>{_&&(_=!1,u.call(this,new to(w,this,I.originalEvent)))}}}}{const _=b=>{const T=n.filter((O=>this.getLayer(O))),I=T.length!==0?this.queryRenderedFeatures(b.point,{layers:T}):[];I.length&&(b.features=I,u.call(this,b),delete b.features)};return{layers:n,listener:u,delegates:{[w]:_}}}}_saveDelegatedListener(w,n){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[w]=this._delegatedListeners[w]||[],this._delegatedListeners[w].push(n)}_removeDelegatedListener(w,n,u){if(!this._delegatedListeners||!this._delegatedListeners[w])return;const _=this._delegatedListeners[w];for(let b=0;b<_.length;b++){const T=_[b];if(T.listener===u&&T.layers.length===n.length&&T.layers.every((I=>n.includes(I)))){for(const I in T.delegates)this.off(I,T.delegates[I]);return void _.splice(b,1)}}}on(w,n,u){if(u===void 0)return super.on(w,n);const _=typeof n=="string"?[n]:n,b=this._createDelegatedListener(w,_,u);this._saveDelegatedListener(w,b);for(const T in b.delegates)this.on(T,b.delegates[T]);return{unsubscribe:()=>{this._removeDelegatedListener(w,_,u)}}}once(w,n,u){if(u===void 0)return super.once(w,n);const _=typeof n=="string"?[n]:n,b=this._createDelegatedListener(w,_,u);for(const T in b.delegates){const I=b.delegates[T];b.delegates[T]=(...O)=>{this._removeDelegatedListener(w,_,u),I(...O)}}this._saveDelegatedListener(w,b);for(const T in b.delegates)this.once(T,b.delegates[T]);return this}off(w,n,u){return u===void 0?super.off(w,n):(this._removeDelegatedListener(w,typeof n=="string"?[n]:n,u),this)}queryRenderedFeatures(w,n){if(!this.style)return[];let u;const _=w instanceof c.P||Array.isArray(w),b=_?w:[[0,0],[this.transform.width,this.transform.height]];if(n=n||(_?{}:w)||{},b instanceof c.P||typeof b[0]=="number")u=[c.P.convert(b)];else{const T=c.P.convert(b[0]),I=c.P.convert(b[1]);u=[T,new c.P(I.x,T.y),I,new c.P(T.x,I.y),T]}return this.style.queryRenderedFeatures(u,n,this.transform)}querySourceFeatures(w,n){return this.style.querySourceFeatures(w,n)}setStyle(w,n){return(n=c.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},n)).diff!==!1&&n.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&w?(this._diffStyle(w,n),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._updateStyle(w,n))}setTransformRequest(w){return this._requestManager.setTransformRequest(w),this}_getUIString(w){const n=this._locale[w];if(n==null)throw new Error(`Missing UI string '${w}'`);return n}_updateStyle(w,n){var u,_;if(n.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",(()=>this._updateStyle(w,n)));const b=this.style&&n.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!w)),w?(this.style=new M(this,n||{}),this.style.setEventedParent(this,{style:this.style}),typeof w=="string"?this.style.loadURL(w,n,b):this.style.loadJSON(w,n,b),this):((_=(u=this.style)===null||u===void 0?void 0:u.projection)===null||_===void 0||_.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new M(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(w,n){if(typeof w=="string"){const u=this._requestManager.transformRequest(w,"Style");c.j(u,new AbortController).then((_=>{this._updateDiff(_.data,n)})).catch((_=>{_&&this.fire(new c.k(_))}))}else typeof w=="object"&&this._updateDiff(w,n)}_updateDiff(w,n){try{this.style.setState(w,n)&&this._update(!0)}catch(u){c.w(`Unable to perform style diff: ${u.message||u.error||u}.  Rebuilding the style from scratch.`),this._updateStyle(w,n)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():c.w("There is no style added to the map.")}addSource(w,n){return this._lazyInitEmptyStyle(),this.style.addSource(w,n),this._update(!0)}isSourceLoaded(w){const n=this.style&&this.style.sourceCaches[w];if(n!==void 0)return n.loaded();this.fire(new c.k(new Error(`There is no source with ID '${w}'`)))}setTerrain(w){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),w){const n=this.style.sourceCaches[w.source];if(!n)throw new Error(`cannot load terrain, because there exists no source with ID: ${w.source}`);this.terrain===null&&n.reload();for(const u in this.style._layers){const _=this.style._layers[u];_.type==="hillshade"&&_.source===w.source&&c.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),_.type==="color-relief"&&_.source===w.source&&c.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new yn(this.painter,n,w),this.painter.renderToTexture=new bu(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=u=>{var _;u.dataType==="style"?this.terrain.sourceCache.freeRtt():u.dataType==="source"&&u.tile&&(u.sourceId!==w.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((_=u.source)===null||_===void 0?void 0:_.type)==="image"?this.terrain.sourceCache.freeRtt():this.terrain.sourceCache.freeRtt(u.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new c.l("terrain",{terrain:w})),this}getTerrain(){var w,n;return(n=(w=this.terrain)===null||w===void 0?void 0:w.options)!==null&&n!==void 0?n:null}areTilesLoaded(){const w=this.style&&this.style.sourceCaches;for(const n in w){const u=w[n]._tiles;for(const _ in u){const b=u[_];if(b.state!=="loaded"&&b.state!=="errored")return!1}}return!0}removeSource(w){return this.style.removeSource(w),this._update(!0)}getSource(w){return this.style.getSource(w)}setSourceTileLodParams(w,n,u){if(u){const _=this.getSource(u);if(!_)throw new Error(`There is no source with ID "${u}", cannot set LOD parameters`);_.calculateTileZoom=At(Math.max(1,w),Math.max(1,n))}else for(const _ in this.style.sourceCaches)this.style.sourceCaches[_].getSource().calculateTileZoom=At(Math.max(1,w),Math.max(1,n));return this._update(!0),this}refreshTiles(w,n){const u=this.style.sourceCaches[w];if(!u)throw new Error(`There is no source cache with ID "${w}", cannot refresh tile`);n===void 0?u.reload(!0):u.refreshTiles(n.map((_=>new c.a4(_.z,_.x,_.y))))}addImage(w,n,u={}){const{pixelRatio:_=1,sdf:b=!1,stretchX:T,stretchY:I,content:O,textFitWidth:N,textFitHeight:j}=u;if(this._lazyInitEmptyStyle(),!(n instanceof HTMLImageElement||c.b(n))){if(n.width===void 0||n.height===void 0)return this.fire(new c.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:$,height:X,data:W}=n,ee=n;return this.style.addImage(w,{data:new c.R({width:$,height:X},new Uint8Array(W)),pixelRatio:_,stretchX:T,stretchY:I,content:O,textFitWidth:N,textFitHeight:j,sdf:b,version:0,userImage:ee}),ee.onAdd&&ee.onAdd(this,w),this}}{const{width:$,height:X,data:W}=Y.getImageData(n);this.style.addImage(w,{data:new c.R({width:$,height:X},W),pixelRatio:_,stretchX:T,stretchY:I,content:O,textFitWidth:N,textFitHeight:j,sdf:b,version:0})}}updateImage(w,n){const u=this.style.getImage(w);if(!u)return this.fire(new c.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const _=n instanceof HTMLImageElement||c.b(n)?Y.getImageData(n):n,{width:b,height:T,data:I}=_;if(b===void 0||T===void 0)return this.fire(new c.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(b!==u.data.width||T!==u.data.height)return this.fire(new c.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const O=!(n instanceof HTMLImageElement||c.b(n));return u.data.replace(I,O),this.style.updateImage(w,u),this}getImage(w){return this.style.getImage(w)}hasImage(w){return w?!!this.style.getImage(w):(this.fire(new c.k(new Error("Missing required image id"))),!1)}removeImage(w){this.style.removeImage(w)}loadImage(w){return Ke.getImage(this._requestManager.transformRequest(w,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(w,n){return this._lazyInitEmptyStyle(),this.style.addLayer(w,n),this._update(!0)}moveLayer(w,n){return this.style.moveLayer(w,n),this._update(!0)}removeLayer(w){return this.style.removeLayer(w),this._update(!0)}getLayer(w){return this.style.getLayer(w)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(w,n,u){return this.style.setLayerZoomRange(w,n,u),this._update(!0)}setFilter(w,n,u={}){return this.style.setFilter(w,n,u),this._update(!0)}getFilter(w){return this.style.getFilter(w)}setPaintProperty(w,n,u,_={}){return this.style.setPaintProperty(w,n,u,_),this._update(!0)}getPaintProperty(w,n){return this.style.getPaintProperty(w,n)}setLayoutProperty(w,n,u,_={}){return this.style.setLayoutProperty(w,n,u,_),this._update(!0)}getLayoutProperty(w,n){return this.style.getLayoutProperty(w,n)}setGlyphs(w,n={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(w,n),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(w,n,u={}){return this._lazyInitEmptyStyle(),this.style.addSprite(w,n,u,(_=>{_||this._update(!0)})),this}removeSprite(w){return this._lazyInitEmptyStyle(),this.style.removeSprite(w),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(w,n={}){return this._lazyInitEmptyStyle(),this.style.setSprite(w,n,(u=>{u||this._update(!0)})),this}setLight(w,n={}){return this._lazyInitEmptyStyle(),this.style.setLight(w,n),this._update(!0)}getLight(){return this.style.getLight()}setSky(w,n={}){return this._lazyInitEmptyStyle(),this.style.setSky(w,n),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(w,n){return this.style.setFeatureState(w,n),this._update()}removeFeatureState(w,n){return this.style.removeFeatureState(w,n),this._update()}getFeatureState(w){return this.style.getFeatureState(w)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let w=0,n=0;return this._container&&(w=this._container.clientWidth||400,n=this._container.clientHeight||300),[w,n]}_setupContainer(){const w=this._container;w.classList.add("maplibregl-map");const n=this._canvasContainer=Q.create("div","maplibregl-canvas-container",w);this._interactive&&n.classList.add("maplibregl-interactive"),this._canvas=Q.create("canvas","maplibregl-canvas",n),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const u=this._containerDimensions(),_=this._getClampedPixelRatio(u[0],u[1]);this._resizeCanvas(u[0],u[1],_);const b=this._controlContainer=Q.create("div","maplibregl-control-container",w),T=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((I=>{T[I]=Q.create("div",`maplibregl-ctrl-${I} `,b)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(w,n,u){this._canvas.width=Math.floor(u*w),this._canvas.height=Math.floor(u*n),this._canvas.style.width=`${w}px`,this._canvas.style.height=`${n}px`}_setupPainter(){const w=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let n=null;this._canvas.addEventListener("webglcontextcreationerror",(_=>{n={requestedAttributes:w},_&&(n.statusMessage=_.statusMessage,n.type=_.type)}),{once:!0});let u=null;if(u=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,w):this._canvas.getContext("webgl2",w)||this._canvas.getContext("webgl",w),!u){const _="Failed to initialize WebGL";throw n?(n.message=_,new Error(JSON.stringify(n))):new Error(_)}this.painter=new Pr(u,this.transform),be.testSupport(u)}migrateProjection(w,n){super.migrateProjection(w,n),this.painter.transform=w,this.fire(new c.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(w){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||w,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(w){return this._update(),this._renderTaskQueue.add(w)}_cancelRenderFrame(w){this._renderTaskQueue.remove(w)}_render(w){var n,u,_,b,T;const I=this._idleTriggered?this._fadeDuration:0,O=((n=this.style.projection)===null||n===void 0?void 0:n.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(w),this._removed)return;let N=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const X=this.transform.zoom,W=Y.now();this.style.zoomHistory.update(X,W);const ee=new c.F(X,{now:W,fadeDuration:I,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition(),globalState:this.style.getGlobalState()}),ae=ee.crossFadingFactor();ae===1&&ae===this._crossFadingFactor||(N=!0,this._crossFadingFactor=ae),this.style.update(ee)}const j=((u=this.style.projection)===null||u===void 0?void 0:u.transitionState)>0!==O;(_=this.style.projection)===null||_===void 0||_.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((b=this.style.projection)===null||b===void 0?void 0:b.transitionState,(T=this.style.projection)===null||T===void 0?void 0:T.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||j)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,I,this._crossSourceCollisions,j),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:I,showPadding:this.showPadding}),this.fire(new c.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,c.cw.mark(c.cx.load),this.fire(new c.l("load"))),this.style&&(this.style.hasTransitions()||N)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const $=this._sourcesDirty||this._styleDirty||this._placementDirty;return $||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new c.l("idle")),!this._loaded||this._fullyLoaded||$||(this._fullyLoaded=!0,c.cw.mark(c.cx.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var w;this._hash&&this._hash.remove();for(const u of this._controls)u.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),Ke.removeThrottleControl(this._imageQueueHandle),(w=this._resizeObserver)===null||w===void 0||w.disconnect();const n=this.painter.context.gl.getExtension("WEBGL_lose_context");n!=null&&n.loseContext&&n.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),Q.remove(this._canvasContainer),Q.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),c.cw.clearMetrics(),this._removed=!0,this.fire(new c.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,Y.frame(this._frameRequest,(w=>{c.cw.frame(w),this._frameRequest=null;try{this._render(w)}catch(n){if(!c.cy(n)&&!(function(u){return u.message===Hu})(n))throw n}}),(()=>{})))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(w){this._showTileBoundaries!==w&&(this._showTileBoundaries=w,this._update())}get showPadding(){return!!this._showPadding}set showPadding(w){this._showPadding!==w&&(this._showPadding=w,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(w){this._showCollisionBoxes!==w&&(this._showCollisionBoxes=w,w?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(w){this._showOverdrawInspector!==w&&(this._showOverdrawInspector=w,this._update())}get repaint(){return!!this._repaint}set repaint(w){this._repaint!==w&&(this._repaint=w,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(w){this._vertices=w,this._update()}get version(){return Yr}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(w){return this._lazyInitEmptyStyle(),this.style.setProjection(w),this._update(!0)}},g.MapMouseEvent=to,g.MapTouchEvent=mh,g.MapWheelEvent=Hf,g.Marker=tc,g.NavigationControl=class{constructor(w){this._updateZoomButtons=()=>{const n=this._map.getZoom(),u=n===this._map.getMaxZoom(),_=n===this._map.getMinZoom();this._zoomInButton.disabled=u,this._zoomOutButton.disabled=_,this._zoomInButton.setAttribute("aria-disabled",u.toString()),this._zoomOutButton.setAttribute("aria-disabled",_.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(n,u)=>{const _=this._map._getUIString(`NavigationControl.${u}`);n.title=_,n.setAttribute("aria-label",_)},this.options=c.e({},Qf,w),this._container=Q.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",(n=>n.preventDefault())),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",(n=>this._map.zoomIn({},{originalEvent:n}))),Q.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",(n=>this._map.zoomOut({},{originalEvent:n}))),Q.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",(n=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:n}):this._map.resetNorth({},{originalEvent:n})})),this._compassIcon=Q.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(w){return this._map=w,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new wh(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){Q.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(w,n){const u=Q.create("button",w,this._container);return u.type="button",u.addEventListener("click",n),u}},g.Popup=class extends c.E{constructor(w){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&Q.remove(this._content),this._container&&(Q.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new c.l("close"))),this),this._onMouseUp=n=>{this._update(n.point)},this._onMouseMove=n=>{this._update(n.point)},this._onDrag=n=>{this._update(n.point)},this._update=n=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=Q.create("div","maplibregl-popup",this._map.getContainer()),this._tip=Q.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const I of this.options.className.split(" "))this._container.classList.add(I);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=Qr(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!n)return;const u=this._flatPos=this._pos=this._trackPointer&&n?n:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&n?n:this._map.transform.locationToScreenPoint(this._lngLat));let _=this.options.anchor;const b=Eh(this.options.offset);if(!_){const I=this._container.offsetWidth,O=this._container.offsetHeight;let N;N=u.y+b.bottom.y<O?["top"]:u.y>this._map.transform.height-O?["bottom"]:[],u.x<I/2?N.push("left"):u.x>this._map.transform.width-I/2&&N.push("right"),_=N.length===0?"bottom":N.join("-")}let T=u.add(b[_]);this.options.subpixelPositioning||(T=T.round()),Q.setTransform(this._container,`${Th[_]} translate(${T.x}px,${T.y}px)`),ec(this._container,_,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=c.e(Object.create(Ol),w)}addTo(w){return this._map&&this.remove(),this._map=w,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new c.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(w){return this._lngLat=c.S.convert(w),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(w){return this.setDOMContent(document.createTextNode(w))}setHTML(w){const n=document.createDocumentFragment(),u=document.createElement("body");let _;for(u.innerHTML=w;_=u.firstChild,_;)n.appendChild(_);return this.setDOMContent(n)}getMaxWidth(){var w;return(w=this._container)===null||w===void 0?void 0:w.style.maxWidth}setMaxWidth(w){return this.options.maxWidth=w,this._update(),this}setDOMContent(w){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=Q.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(w),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(w){return this._container&&this._container.classList.add(w),this}removeClassName(w){return this._container&&this._container.classList.remove(w),this}setOffset(w){return this.options.offset=w,this._update(),this}toggleClassName(w){if(this._container)return this._container.classList.toggle(w)}setSubpixelPositioning(w){this.options.subpixelPositioning=w}_createCloseButton(){this.options.closeButton&&(this._closeButton=Q.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const w=this._container.querySelector(Sh);w&&w.focus()}},g.RasterDEMTileSource=Nr,g.RasterTileSource=Xa,g.ScaleControl=class{constructor(w){this._onMove=()=>{jc(this._map,this._container,this.options)},this.setUnit=n=>{this.options.unit=n,jc(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},wu),w)}getDefaultPosition(){return"bottom-left"}onAdd(w){return this._map=w,this._container=Q.create("div","maplibregl-ctrl maplibregl-ctrl-scale",w.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){Q.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},g.ScrollZoomHandler=vu,g.Style=M,g.TerrainControl=class{constructor(w){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=w}onAdd(w){return this._map=w,this._container=Q.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=Q.create("button","maplibregl-ctrl-terrain",this._container),Q.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){Q.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},g.TwoFingersTouchPitchHandler=ld,g.TwoFingersTouchRotateHandler=Oc,g.TwoFingersTouchZoomHandler=od,g.TwoFingersTouchZoomRotateHandler=Kf,g.VectorTileSource=ds,g.VideoSource=fr,g.addSourceType=(w,n)=>c._(void 0,void 0,void 0,(function*(){if(js(w))throw new Error(`A source type called "${w}" already exists.`);((u,_)=>{Po[u]=_})(w,n)})),g.clearPrewarmedResources=function(){const w=zt;w&&(w.isPreloaded()&&w.numActive()===1?(w.release(Ie),zt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},g.createTileMesh=Sl,g.getMaxParallelImageRequests=function(){return c.a.MAX_PARALLEL_IMAGE_REQUESTS},g.getRTLTextPluginStatus=function(){return pr().getRTLTextPluginStatus()},g.getVersion=function(){return hd},g.getWorkerCount=function(){return lt.workerCount},g.getWorkerUrl=function(){return c.a.WORKER_URL},g.importScriptInWorkers=function(w){return Ci().broadcast("IS",w)},g.prewarm=function(){an().acquire(Ie)},g.setMaxParallelImageRequests=function(w){c.a.MAX_PARALLEL_IMAGE_REQUESTS=w},g.setRTLTextPlugin=function(w,n){return pr().setRTLTextPlugin(w,n)},g.setWorkerCount=function(w){lt.workerCount=w},g.setWorkerUrl=function(w){c.a.WORKER_URL=w}}));var m=t;return m}))})(Wv)),Wv.exports}var sN=aN();const Sn=uy(sN);function oN(){return typeof self<"u"?fetch.bind(self):typeof global<"u"&&global.fetch?global.fetch:null}class lN{constructor(){this._apiKey="",this._fetch=oN(),this.tileCacheSize=200}set apiKey(e){this._apiKey=e}get apiKey(){return this._apiKey}set fetch(e){this._fetch=e}get fetch(){return this._fetch}}const ig=new lN,uN={AUTO:{code:null,flag:"auto",name:"Auto",latin:!1,isMode:!0,geocoding:!0},LATIN:{code:"latin",flag:"name:latin",name:"Latin",latin:!0,isMode:!1,geocoding:!1},NON_LATIN:{code:"nonlatin",flag:"name:nonlatin",name:"Non Latin",latin:!1,isMode:!1,geocoding:!1},LOCAL:{code:null,flag:"name",name:"Local",latin:!0,isMode:!1,geocoding:!1}},cN={ALBANIAN:{code:"sq",flag:"name:sq",name:"Albanian",latin:!0,isMode:!1,geocoding:!0},AMHARIC:{code:"am",flag:"name:am",name:"Amharic",latin:!1,isMode:!1,geocoding:!0},ARABIC:{code:"ar",flag:"name:ar",name:"Arabic",latin:!1,isMode:!1,geocoding:!0},ARMENIAN:{code:"hy",flag:"name:hy",name:"Armenian",latin:!1,isMode:!1,geocoding:!0},AZERBAIJANI:{code:"az",flag:"name:az",name:"Azerbaijani",latin:!0,isMode:!1,geocoding:!0},BASQUE:{code:"eu",flag:"name:eu",name:"Basque",latin:!0,isMode:!1,geocoding:!0},BELARUSIAN:{code:"be",flag:"name:be",name:"Belarusian",latin:!1,isMode:!1,geocoding:!0},BENGALI:{code:"bn",flag:"name:bn",name:"Bengali",latin:!0,isMode:!1,geocoding:!0},BOSNIAN:{code:"bs",flag:"name:bs",name:"Bosnian",latin:!0,isMode:!1,geocoding:!0},BRETON:{code:"br",flag:"name:br",name:"Breton",latin:!0,isMode:!1,geocoding:!0},BULGARIAN:{code:"bg",flag:"bg",name:"Bulgarian",latin:!1,isMode:!1,geocoding:!0},CATALAN:{code:"ca",flag:"name:ca",name:"Catalan",latin:!0,isMode:!1,geocoding:!0},CHINESE:{code:"zh",flag:"name:zh",name:"Chinese",latin:!1,isMode:!1,geocoding:!0},TRADITIONAL_CHINESE:{code:"zh-Hant",flag:"name:zh-Hant",name:"Chinese (traditional)",latin:!1,isMode:!1,geocoding:!1},SIMPLIFIED_CHINESE:{code:"zh-Hans",flag:"name:zh-Hans",name:"Chinese (simplified)",latin:!1,isMode:!1,geocoding:!1},CORSICAN:{code:"co",flag:"name:co",name:"Corsican",latin:!0,isMode:!1,geocoding:!0},CROATIAN:{code:"hr",flag:"name:hr",name:"Croatian",latin:!0,isMode:!1,geocoding:!0},CZECH:{code:"cs",flag:"name:cs",name:"Czech",latin:!0,isMode:!1,geocoding:!0},DANISH:{code:"da",flag:"name:da",name:"Danish",latin:!0,isMode:!1,geocoding:!0},DUTCH:{code:"nl",flag:"name:nl",name:"Dutch",latin:!0,isMode:!1,geocoding:!0},GERMAN:{code:"de",flag:"name:de",name:"German",latin:!0,isMode:!1,geocoding:!0},GREEK:{code:"el",flag:"name:el",name:"Greek",latin:!1,isMode:!1,geocoding:!0},ENGLISH:{code:"en",flag:"name:en",name:"English",latin:!0,isMode:!1,geocoding:!0},ESPERANTO:{code:"eo",flag:"name:eo",name:"Esperanto",latin:!0,isMode:!1,geocoding:!0},ESTONIAN:{code:"et",flag:"name:et",name:"Estonian",latin:!0,isMode:!1,geocoding:!0},FINNISH:{code:"fi",flag:"name:fi",name:"Finnish",latin:!0,isMode:!1,geocoding:!0},FRENCH:{code:"fr",flag:"name:fr",name:"French",latin:!0,isMode:!1,geocoding:!0},FRISIAN:{code:"fy",flag:"name:fy",name:"Frisian (West)",latin:!0,isMode:!1,geocoding:!0},GEORGIAN:{code:"ka",flag:"name:ka",name:"Georgian",latin:!1,isMode:!1,geocoding:!0},HEBREW:{code:"he",flag:"name:he",name:"Hebrew",latin:!1,isMode:!1,geocoding:!0},HINDI:{code:"hi",flag:"name:hi",name:"Hindi",latin:!1,isMode:!1,geocoding:!0},HUNGARIAN:{code:"hu",flag:"name:hu",name:"Hungarian",latin:!0,isMode:!1,geocoding:!0},ICELANDIC:{code:"is",flag:"name:is",name:"Icelandic",latin:!0,isMode:!1,geocoding:!0},INDONESIAN:{code:"id",flag:"name:id",name:"Indonesian",latin:!0,isMode:!1,geocoding:!0},IRISH:{code:"ga",flag:"name:ga",name:"Irish",latin:!0,isMode:!1,geocoding:!0},ITALIAN:{code:"it",flag:"name:it",name:"Italian",latin:!0,isMode:!1,geocoding:!0},JAPANESE:{code:"ja",flag:"name:ja",name:"Japanese",latin:!1,isMode:!1,geocoding:!0},JAPANESE_HIRAGANA:{code:"ja-Hira",flag:"name:ja-Hira",name:"Japanese Hiragana form",latin:!1,isMode:!1,geocoding:!1},JAPANESE_2018:{code:"ja-Latn",flag:"name:ja-Latn",name:"Japanese (Latin 2018)",latin:!0,isMode:!1,geocoding:!1},JAPANESE_KANA:{code:"ja_kana",flag:"name:ja_kana",name:"Japanese (Kana)",latin:!1,isMode:!1,geocoding:!1},JAPANESE_LATIN:{code:"ja_rm",flag:"name:ja_rm",name:"Japanese (Latin script)",latin:!0,isMode:!1,geocoding:!1},KANNADA:{code:"kn",flag:"name:kn",name:"Kannada",latin:!0,isMode:!1,geocoding:!0},KAZAKH:{code:"kk",flag:"name:kk",name:"Kazakh",latin:!1,isMode:!1,geocoding:!0},KOREAN:{code:"ko",flag:"name:ko",name:"Korean",latin:!1,isMode:!1,geocoding:!0},KOREAN_LATIN:{code:"ko-Latn",flag:"name:ko-Latn",name:"Korean (Latin script)",latin:!0,isMode:!1,geocoding:!1},KURDISH:{code:"ku",flag:"name:ku",name:"Kurdish",latin:!0,isMode:!1,geocoding:!0},CLASSICAL_LATIN:{code:"la",flag:"name:la",name:"Latin",latin:!0,isMode:!1,geocoding:!0},LATVIAN:{code:"lv",flag:"name:lv",name:"Latvian",latin:!0,isMode:!1,geocoding:!0},LITHUANIAN:{code:"lt",flag:"name:lt",name:"Lithuanian",latin:!0,isMode:!1,geocoding:!0},LUXEMBOURGISH:{code:"lb",flag:"name:lb",name:"Luxembourgish",latin:!0,isMode:!1,geocoding:!0},MACEDONIAN:{code:"mk",flag:"name:mk",name:"Macedonian",latin:!1,isMode:!1,geocoding:!0},MALAYALAM:{code:"ml",flag:"name:ml",name:"Malayalam",latin:!1,isMode:!1,geocoding:!0},MALTESE:{code:"mt",flag:"name:mt",name:"Maltese",latin:!0,isMode:!1,geocoding:!0},NORWEGIAN:{code:"no",flag:"name:no",name:"Norwegian",latin:!0,isMode:!1,geocoding:!0},OCCITAN:{code:"oc",flag:"name:oc",name:"Occitan",latin:!0,isMode:!1,geocoding:!0},PERSIAN:{code:"fa",flag:"name:fa",name:"Persian",latin:!1,isMode:!1,geocoding:!0},POLISH:{code:"pl",flag:"name:pl",name:"Polish",latin:!0,isMode:!1,geocoding:!0},PORTUGUESE:{code:"pt",flag:"name:pt",name:"Portuguese",latin:!0,isMode:!1,geocoding:!0},PUNJABI:{code:"pa",flag:"name:pa",name:"Punjabi",latin:!1,isMode:!1,geocoding:!0},WESTERN_PUNJABI:{code:"pnb",flag:"name:pnb",name:"Western Punjabi",latin:!1,isMode:!1,geocoding:!1},ROMANIAN:{code:"ro",flag:"name:ro",name:"Romanian",latin:!0,isMode:!1,geocoding:!0},ROMANSH:{code:"rm",flag:"name:rm",name:"Romansh",latin:!0,isMode:!1,geocoding:!0},RUSSIAN:{code:"ru",flag:"name:ru",name:"Russian",latin:!1,isMode:!1,geocoding:!0},SERBIAN_CYRILLIC:{code:"sr",flag:"name:sr",name:"Serbian (Cyrillic script)",latin:!1,isMode:!1,geocoding:!0},SERBIAN_LATIN:{code:"sr-Latn",flag:"name:sr-Latn",name:"Serbian (Latin script)",latin:!0,isMode:!1,geocoding:!1},SCOTTISH_GAELIC:{code:"gd",flag:"name:gd",name:"Scottish Gaelic",latin:!0,isMode:!1,geocoding:!0},SLOVAK:{code:"sk",flag:"name:sk",name:"Slovak",latin:!0,isMode:!1,geocoding:!0},SLOVENE:{code:"sl",flag:"name:sl",name:"Slovene",latin:!0,isMode:!1,geocoding:!0},SPANISH:{code:"es",flag:"name:es",name:"Spanish",latin:!0,isMode:!1,geocoding:!0},SWEDISH:{code:"sv",flag:"name:sv",name:"Swedish",latin:!0,isMode:!1,geocoding:!0},TAMIL:{code:"ta",flag:"name:ta",name:"Tamil",latin:!1,isMode:!1,geocoding:!0},TELUGU:{code:"te",flag:"name:te",name:"Telugu",latin:!1,isMode:!1,geocoding:!0},THAI:{code:"th",flag:"name:th",name:"Thai",latin:!1,isMode:!1,geocoding:!0},TURKISH:{code:"tr",flag:"name:tr",name:"Turkish",latin:!0,isMode:!1,geocoding:!0},UKRAINIAN:{code:"uk",flag:"name:uk",name:"Ukrainian",latin:!1,isMode:!1,geocoding:!0},VIETNAMESE:{code:"vi",flag:"name:vi",name:"Vietnamese (Latin script)",latin:!0,isMode:!1,geocoding:!0},WELSH:{code:"cy",flag:"name:cy",name:"Welsh",latin:!0,isMode:!1,geocoding:!0}},Ty={...uN,...cN};function hN(i,e=Ty){return i in e?i[i]:null}function Hx(i,e=Ty){for(const t of Object.values(e))if(t.code===i)return t;return null}function Wx(i,e=Ty){for(const t of Object.values(e))if(t.flag===i)return t;return null}function dN(i){return i!==null&&typeof i=="object"&&"code"in i&&"flag"in i&&"name"in i&&"latin"in i&&"isMode"in i&&"geocoding"in i&&(typeof i.code=="string"||i.code===null)&&typeof i.flag=="string"&&typeof i.name=="string"&&typeof i.latin=="boolean"&&typeof i.isMode=="boolean"&&typeof i.geocoding=="boolean"}function WT(i,e=Ty){return dN(i)?Wx(i.flag,e):typeof i!="string"?null:hN(i,e)||Hx(i,e)||Wx(i,e)||null}async function fN(i,e={}){if(ig.fetch===null)throw new Error("The fetch function was not found. If on NodeJS < 18 please specify the fetch function with config.fetch");if(new URL(i).searchParams.get("key").trim()==="")throw new Error("The MapTiler Cloud API key is missing. Set it in `config.apiKey` or get one for free at https://maptiler.com");return ig.fetch(i,e)}const gC={maptilerApiURL:"https://api.maptiler.com/",mapStyle:"streets-v2"};Object.freeze(gC);class pN extends Error{constructor(e,t=""){super(`Call to enpoint ${e.url} failed with the status code ${e.status}. ${t}`),this.res=e}}const XT={403:"Key is missing, invalid or restricted"};async function mN(i={}){const e=new URL("geolocation/ip.json",gC.maptilerApiURL);e.searchParams.set("key",i.apiKey??ig.apiKey),"elevation"in i&&e.searchParams.set("elevation",i.elevation?"true":"false");const t=e.toString(),a=await fN(t);if(!a.ok)throw new pN(a,a.status in XT?XT[a.status]:"");return await a.json()}const KT={info:mN};function _C(i){const e=/^maptiler:\/\/(.*)/;let t;const a=i.trim();let h;return a.startsWith("http://")||a.startsWith("https://")?h=a:(t=e.exec(a))!==null?h=`https://api.maptiler.com/maps/${t[1]}/style.json`:h=`https://api.maptiler.com/maps/${a}/style.json`,h}class yC{constructor(e,t,a,h,m,g,c=!1){this.name=e,this.variantType=t,this.id=a,this.referenceStyle=h,this.description=m,this.imageURL=g,this.deprecated=c}getName(){return this.name}getFullName(){return`${this.referenceStyle.getName()} ${this.name}`}getType(){return this.variantType}getId(){return this.id}getDescription(){return this.description}getReferenceStyle(){return this.referenceStyle}hasVariant(e){return this.referenceStyle.hasVariant(e)}getVariant(e){const t=this.referenceStyle.getVariant(e);return this.warnIfDeprecated(t),t}getVariants(){return this.referenceStyle.getVariants().filter(e=>e!==this).map(e=>(this.warnIfDeprecated(e),e))}getImageURL(){return this.imageURL}getExpandedStyleURL(){return _C(this.getId())}warnIfDeprecated(e=this){if(!e.deprecated)return e;const t=e.getFullName();return console.warn(`Style "${t}" is deprecated and will be removed in a future version.`),e}}class vC{constructor(e,t){this.name=e,this.id=t,this.variants={},this.orderedVariants=[]}getName(){return this.name}getId(){return this.id}addVariant(e){this.variants[e.getType()]=e,this.orderedVariants.push(e)}hasVariant(e){return e in this.variants}getVariant(e){return e in this.variants?this.variants[e]:this.orderedVariants[0]}getVariants(){return Object.values(this.variants)}getDefaultVariant(){return this.orderedVariants[0].warnIfDeprecated()}}const B_=[{referenceStyleID:"STREETS",name:"Streets",description:"",variants:[{id:"streets-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"streets-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"streets-v2-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""},{id:"streets-v2-night",name:"Night",variantType:"NIGHT",description:"",imageURL:""},{id:"streets-v2-pastel",name:"Pastel",variantType:"PASTEL",description:"",imageURL:""}]},{referenceStyleID:"OUTDOOR",name:"Outdoor",description:"",variants:[{id:"outdoor-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"outdoor-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""}]},{referenceStyleID:"WINTER",name:"Winter",description:"",variants:[{id:"winter-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"winter-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""}]},{referenceStyleID:"SATELLITE",name:"Satellite",description:"",variants:[{id:"satellite",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"HYBRID",name:"Hybrid",description:"",variants:[{id:"hybrid",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"BASIC",name:"Basic",description:"",variants:[{id:"basic-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"basic-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"basic-v2-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""}]},{referenceStyleID:"BRIGHT",name:"Bright",description:"",variants:[{id:"bright-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"bright-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"bright-v2-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""},{id:"bright-v2-pastel",name:"Pastel",variantType:"PASTEL",description:"",imageURL:""}]},{referenceStyleID:"OPENSTREETMAP",name:"OpenStreetMap",description:"",variants:[{id:"openstreetmap",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"TOPO",name:"Topo",description:"",variants:[{id:"topo-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"topo-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"topo-v2-shiny",name:"Shiny",deprecated:!0,variantType:"SHINY",description:"",imageURL:""},{id:"topo-v2-pastel",name:"Pastel",variantType:"PASTEL",description:"",imageURL:""},{id:"topo-v2-topographique",name:"Topographique",variantType:"TOPOGRAPHIQUE",description:"",imageURL:""}]},{referenceStyleID:"VOYAGER",name:"Voyager",description:"",variants:[{id:"voyager-v2",name:"Default",deprecated:!0,variantType:"DEFAULT",description:"",imageURL:""},{id:"voyager-v2-darkmatter",name:"Darkmatter",deprecated:!0,variantType:"DARK",description:"",imageURL:""},{id:"voyager-v2-positron",name:"Positron",deprecated:!0,variantType:"LIGHT",description:"",imageURL:""},{id:"voyager-v2-vintage",name:"Vintage",deprecated:!0,variantType:"VINTAGE",description:"",imageURL:""}]},{referenceStyleID:"TONER",name:"Toner",description:"",variants:[{id:"toner-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"toner-v2-background",name:"Background",variantType:"BACKGROUND",deprecated:!0,description:"",imageURL:""},{id:"toner-v2-lite",name:"Lite",variantType:"LITE",description:"",imageURL:""},{id:"toner-v2-lines",name:"Lines",variantType:"LINES",deprecated:!0,description:"",imageURL:""}]},{referenceStyleID:"DATAVIZ",name:"Dataviz",description:"",variants:[{id:"dataviz",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"dataviz-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"dataviz-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""}]},{referenceStyleID:"BACKDROP",name:"Backdrop",description:"",variants:[{id:"backdrop",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"backdrop-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"backdrop-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""}]},{referenceStyleID:"OCEAN",name:"Ocean",description:"",variants:[{id:"ocean",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"AQUARELLE",name:"Aquarelle",description:"Watercolor map for creative use",variants:[{id:"aquarelle",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"aquarelle-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"aquarelle-vivid",name:"Vivid",variantType:"VIVID",description:"",imageURL:""}]},{referenceStyleID:"LANDSCAPE",name:"Landscape",description:"Terrain map for data overlays and visualisations",variants:[{id:"landscape",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"landscape-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"landscape-vivid",name:"Vivid",variantType:"VIVID",description:"",imageURL:""}]}];function gN(i){return new Proxy(i,{get(e,t,a){return e.hasVariant(t)?e.getVariant(t):t.toString().toUpperCase()===t?i.getDefaultVariant():Reflect.get(e,t,a)}})}function _N(){const i={};for(let e=0;e<B_.length;e+=1){const t=B_[e],a=gN(new vC(t.name,t.referenceStyleID));for(let h=0;h<t.variants.length;h+=1){const m=t.variants[h],g=new yC(m.name,m.variantType,m.id,a,m.description,m.imageURL,m.deprecated);a.addVariant(g)}i[t.referenceStyleID]=a}return i}const F_=_N();var Pv={exports:{}},YT;function yN(){if(YT)return Pv.exports;YT=1;var i=typeof Reflect=="object"?Reflect:null,e=i&&typeof i.apply=="function"?i.apply:function(Ve,it,de){return Function.prototype.apply.call(Ve,it,de)},t;i&&typeof i.ownKeys=="function"?t=i.ownKeys:Object.getOwnPropertySymbols?t=function(Ve){return Object.getOwnPropertyNames(Ve).concat(Object.getOwnPropertySymbols(Ve))}:t=function(Ve){return Object.getOwnPropertyNames(Ve)};function a(Ke){console&&console.warn&&console.warn(Ke)}var h=Number.isNaN||function(Ve){return Ve!==Ve};function m(){m.init.call(this)}Pv.exports=m,Pv.exports.once=et,m.EventEmitter=m,m.prototype._events=void 0,m.prototype._eventsCount=0,m.prototype._maxListeners=void 0;var g=10;function c(Ke){if(typeof Ke!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof Ke)}Object.defineProperty(m,"defaultMaxListeners",{enumerable:!0,get:function(){return g},set:function(Ke){if(typeof Ke!="number"||Ke<0||h(Ke))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+Ke+".");g=Ke}}),m.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},m.prototype.setMaxListeners=function(Ve){if(typeof Ve!="number"||Ve<0||h(Ve))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+Ve+".");return this._maxListeners=Ve,this};function C(Ke){return Ke._maxListeners===void 0?m.defaultMaxListeners:Ke._maxListeners}m.prototype.getMaxListeners=function(){return C(this)},m.prototype.emit=function(Ve){for(var it=[],de=1;de<arguments.length;de++)it.push(arguments[de]);var ce=Ve==="error",me=this._events;if(me!==void 0)ce=ce&&me.error===void 0;else if(!ce)return!1;if(ce){var Ee;if(it.length>0&&(Ee=it[0]),Ee instanceof Error)throw Ee;var De=new Error("Unhandled error."+(Ee?" ("+Ee.message+")":""));throw De.context=Ee,De}var $e=me[Ve];if($e===void 0)return!1;if(typeof $e=="function")e($e,this,it);else for(var ke=$e.length,Bn=be($e,ke),de=0;de<ke;++de)e(Bn[de],this,it);return!0};function k(Ke,Ve,it,de){var ce,me,Ee;if(c(it),me=Ke._events,me===void 0?(me=Ke._events=Object.create(null),Ke._eventsCount=0):(me.newListener!==void 0&&(Ke.emit("newListener",Ve,it.listener?it.listener:it),me=Ke._events),Ee=me[Ve]),Ee===void 0)Ee=me[Ve]=it,++Ke._eventsCount;else if(typeof Ee=="function"?Ee=me[Ve]=de?[it,Ee]:[Ee,it]:de?Ee.unshift(it):Ee.push(it),ce=C(Ke),ce>0&&Ee.length>ce&&!Ee.warned){Ee.warned=!0;var De=new Error("Possible EventEmitter memory leak detected. "+Ee.length+" "+String(Ve)+" listeners added. Use emitter.setMaxListeners() to increase limit");De.name="MaxListenersExceededWarning",De.emitter=Ke,De.type=Ve,De.count=Ee.length,a(De)}return Ke}m.prototype.addListener=function(Ve,it){return k(this,Ve,it,!1)},m.prototype.on=m.prototype.addListener,m.prototype.prependListener=function(Ve,it){return k(this,Ve,it,!0)};function V(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Z(Ke,Ve,it){var de={fired:!1,wrapFn:void 0,target:Ke,type:Ve,listener:it},ce=V.bind(de);return ce.listener=it,de.wrapFn=ce,ce}m.prototype.once=function(Ve,it){return c(it),this.on(Ve,Z(this,Ve,it)),this},m.prototype.prependOnceListener=function(Ve,it){return c(it),this.prependListener(Ve,Z(this,Ve,it)),this},m.prototype.removeListener=function(Ve,it){var de,ce,me,Ee,De;if(c(it),ce=this._events,ce===void 0)return this;if(de=ce[Ve],de===void 0)return this;if(de===it||de.listener===it)--this._eventsCount===0?this._events=Object.create(null):(delete ce[Ve],ce.removeListener&&this.emit("removeListener",Ve,de.listener||it));else if(typeof de!="function"){for(me=-1,Ee=de.length-1;Ee>=0;Ee--)if(de[Ee]===it||de[Ee].listener===it){De=de[Ee].listener,me=Ee;break}if(me<0)return this;me===0?de.shift():xe(de,me),de.length===1&&(ce[Ve]=de[0]),ce.removeListener!==void 0&&this.emit("removeListener",Ve,De||it)}return this},m.prototype.off=m.prototype.removeListener,m.prototype.removeAllListeners=function(Ve){var it,de,ce;if(de=this._events,de===void 0)return this;if(de.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):de[Ve]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete de[Ve]),this;if(arguments.length===0){var me=Object.keys(de),Ee;for(ce=0;ce<me.length;++ce)Ee=me[ce],Ee!=="removeListener"&&this.removeAllListeners(Ee);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(it=de[Ve],typeof it=="function")this.removeListener(Ve,it);else if(it!==void 0)for(ce=it.length-1;ce>=0;ce--)this.removeListener(Ve,it[ce]);return this};function Y(Ke,Ve,it){var de=Ke._events;if(de===void 0)return[];var ce=de[Ve];return ce===void 0?[]:typeof ce=="function"?it?[ce.listener||ce]:[ce]:it?ze(ce):be(ce,ce.length)}m.prototype.listeners=function(Ve){return Y(this,Ve,!0)},m.prototype.rawListeners=function(Ve){return Y(this,Ve,!1)},m.listenerCount=function(Ke,Ve){return typeof Ke.listenerCount=="function"?Ke.listenerCount(Ve):Q.call(Ke,Ve)},m.prototype.listenerCount=Q;function Q(Ke){var Ve=this._events;if(Ve!==void 0){var it=Ve[Ke];if(typeof it=="function")return 1;if(it!==void 0)return it.length}return 0}m.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]};function be(Ke,Ve){for(var it=new Array(Ve),de=0;de<Ve;++de)it[de]=Ke[de];return it}function xe(Ke,Ve){for(;Ve+1<Ke.length;Ve++)Ke[Ve]=Ke[Ve+1];Ke.pop()}function ze(Ke){for(var Ve=new Array(Ke.length),it=0;it<Ve.length;++it)Ve[it]=Ke[it].listener||Ke[it];return Ve}function et(Ke,Ve){return new Promise(function(it,de){function ce(Ee){Ke.removeListener(Ve,me),de(Ee)}function me(){typeof Ke.removeListener=="function"&&Ke.removeListener("error",ce),it([].slice.call(arguments))}Xe(Ke,Ve,me,{once:!0}),Ve!=="error"&&Qe(Ke,ce,{once:!0})})}function Qe(Ke,Ve,it){typeof Ke.on=="function"&&Xe(Ke,"error",Ve,it)}function Xe(Ke,Ve,it,de){if(typeof Ke.on=="function")de.once?Ke.once(Ve,it):Ke.on(Ve,it);else if(typeof Ke.addEventListener=="function")Ke.addEventListener(Ve,function ce(me){de.once&&Ke.removeEventListener(Ve,ce),it(me)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof Ke)}return Pv.exports}var vN=yN();const bN=uy(vN),Fo=[];for(let i=0;i<256;++i)Fo.push((i+256).toString(16).slice(1));function xN(i,e=0){return(Fo[i[e+0]]+Fo[i[e+1]]+Fo[i[e+2]]+Fo[i[e+3]]+"-"+Fo[i[e+4]]+Fo[i[e+5]]+"-"+Fo[i[e+6]]+Fo[i[e+7]]+"-"+Fo[i[e+8]]+Fo[i[e+9]]+"-"+Fo[i[e+10]]+Fo[i[e+11]]+Fo[i[e+12]]+Fo[i[e+13]]+Fo[i[e+14]]+Fo[i[e+15]]).toLowerCase()}let nx;const wN=new Uint8Array(16);function TN(){if(!nx){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");nx=crypto.getRandomValues.bind(crypto)}return nx(wN)}const SN=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),QT={randomUUID:SN};function EN(i,e,t){var h;if(QT.randomUUID&&!i)return QT.randomUUID();i=i||{};const a=i.random??((h=i.rng)==null?void 0:h.call(i))??TN();if(a.length<16)throw new Error("Random bytes length must be >= 16");return a[6]=a[6]&15|64,a[8]=a[8]&63|128,xN(a)}const bC="3.7.8",AN=bC,Eg=typeof Buffer=="function",JT=typeof TextDecoder=="function"?new TextDecoder:void 0,eS=typeof TextEncoder=="function"?new TextEncoder:void 0,IN="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",A_=Array.prototype.slice.call(IN),Mv=(i=>{let e={};return i.forEach((t,a)=>e[t]=a),e})(A_),CN=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,Vo=String.fromCharCode.bind(String),tS=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):i=>new Uint8Array(Array.prototype.slice.call(i,0)),xC=i=>i.replace(/=/g,"").replace(/[+\/]/g,e=>e=="+"?"-":"_"),wC=i=>i.replace(/[^A-Za-z0-9\+\/]/g,""),TC=i=>{let e,t,a,h,m="";const g=i.length%3;for(let c=0;c<i.length;){if((t=i.charCodeAt(c++))>255||(a=i.charCodeAt(c++))>255||(h=i.charCodeAt(c++))>255)throw new TypeError("invalid character found");e=t<<16|a<<8|h,m+=A_[e>>18&63]+A_[e>>12&63]+A_[e>>6&63]+A_[e&63]}return g?m.slice(0,g-3)+"===".substring(g):m},_w=typeof btoa=="function"?i=>btoa(i):Eg?i=>Buffer.from(i,"binary").toString("base64"):TC,Xx=Eg?i=>Buffer.from(i).toString("base64"):i=>{let t=[];for(let a=0,h=i.length;a<h;a+=4096)t.push(Vo.apply(null,i.subarray(a,a+4096)));return _w(t.join(""))},Xv=(i,e=!1)=>e?xC(Xx(i)):Xx(i),PN=i=>{if(i.length<2){var e=i.charCodeAt(0);return e<128?i:e<2048?Vo(192|e>>>6)+Vo(128|e&63):Vo(224|e>>>12&15)+Vo(128|e>>>6&63)+Vo(128|e&63)}else{var e=65536+(i.charCodeAt(0)-55296)*1024+(i.charCodeAt(1)-56320);return Vo(240|e>>>18&7)+Vo(128|e>>>12&63)+Vo(128|e>>>6&63)+Vo(128|e&63)}},MN=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,SC=i=>i.replace(MN,PN),nS=Eg?i=>Buffer.from(i,"utf8").toString("base64"):eS?i=>Xx(eS.encode(i)):i=>_w(SC(i)),rg=(i,e=!1)=>e?xC(nS(i)):nS(i),iS=i=>rg(i,!0),RN=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,kN=i=>{switch(i.length){case 4:var e=(7&i.charCodeAt(0))<<18|(63&i.charCodeAt(1))<<12|(63&i.charCodeAt(2))<<6|63&i.charCodeAt(3),t=e-65536;return Vo((t>>>10)+55296)+Vo((t&1023)+56320);case 3:return Vo((15&i.charCodeAt(0))<<12|(63&i.charCodeAt(1))<<6|63&i.charCodeAt(2));default:return Vo((31&i.charCodeAt(0))<<6|63&i.charCodeAt(1))}},EC=i=>i.replace(RN,kN),AC=i=>{if(i=i.replace(/\s+/g,""),!CN.test(i))throw new TypeError("malformed base64.");i+="==".slice(2-(i.length&3));let e,t,a,h=[];for(let m=0;m<i.length;)e=Mv[i.charAt(m++)]<<18|Mv[i.charAt(m++)]<<12|(t=Mv[i.charAt(m++)])<<6|(a=Mv[i.charAt(m++)]),t===64?h.push(Vo(e>>16&255)):a===64?h.push(Vo(e>>16&255,e>>8&255)):h.push(Vo(e>>16&255,e>>8&255,e&255));return h.join("")},yw=typeof atob=="function"?i=>atob(wC(i)):Eg?i=>Buffer.from(i,"base64").toString("binary"):AC,IC=Eg?i=>tS(Buffer.from(i,"base64")):i=>tS(yw(i).split("").map(e=>e.charCodeAt(0))),CC=i=>IC(PC(i)),LN=Eg?i=>Buffer.from(i,"base64").toString("utf8"):JT?i=>JT.decode(IC(i)):i=>EC(yw(i)),PC=i=>wC(i.replace(/[-_]/g,e=>e=="-"?"+":"/")),Kx=i=>LN(PC(i)),DN=i=>{if(typeof i!="string")return!1;const e=i.replace(/\s+/g,"").replace(/={0,2}$/,"");return!/[^\s0-9a-zA-Z\+/]/.test(e)||!/[^\s0-9a-zA-Z\-_]/.test(e)},MC=i=>({value:i,enumerable:!1,writable:!0,configurable:!0}),RC=function(){const i=(e,t)=>Object.defineProperty(String.prototype,e,MC(t));i("fromBase64",function(){return Kx(this)}),i("toBase64",function(e){return rg(this,e)}),i("toBase64URI",function(){return rg(this,!0)}),i("toBase64URL",function(){return rg(this,!0)}),i("toUint8Array",function(){return CC(this)})},kC=function(){const i=(e,t)=>Object.defineProperty(Uint8Array.prototype,e,MC(t));i("toBase64",function(e){return Xv(this,e)}),i("toBase64URI",function(){return Xv(this,!0)}),i("toBase64URL",function(){return Xv(this,!0)})},zN=()=>{RC(),kC()},ON={version:bC,VERSION:AN,atob:yw,atobPolyfill:AC,btoa:_w,btoaPolyfill:TC,fromBase64:Kx,toBase64:rg,encode:rg,encodeURI:iS,encodeURL:iS,utob:SC,btou:EC,decode:Kx,isValid:DN,fromUint8Array:Xv,toUint8Array:CC,extendString:RC,extendUint8Array:kC,extendBuiltins:zN};var NN=Object.defineProperty,LC=i=>{throw TypeError(i)},BN=(i,e,t)=>e in i?NN(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,nn=(i,e,t)=>BN(i,typeof e!="symbol"?e+"":e,t),vw=(i,e,t)=>e.has(i)||LC("Cannot "+t),An=(i,e,t)=>(vw(i,e,"read from private field"),t?t.call(i):e.get(i)),lu=(i,e,t)=>e.has(i)?LC("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(i):e.set(i,t),zu=(i,e,t,a)=>(vw(i,e,"write to private field"),e.set(i,t),t),Lu=(i,e,t)=>(vw(i,e,"access private method"),t);const Wi={VISITOR:{code:null,flag:"visitor",name:"Visitor",latin:!0,isMode:!0,geocoding:!1},VISITOR_ENGLISH:{code:null,flag:"visitor_en",name:"Visitor English",latin:!0,isMode:!0,geocoding:!1},STYLE:{code:null,flag:"style",name:"Style",latin:!1,isMode:!0,geocoding:!1},STYLE_LOCK:{code:null,flag:"style_lock",name:"Style Lock",latin:!1,isMode:!0,geocoding:!1},...Ty};function rS(){if(typeof navigator>"u"){const i=Intl.DateTimeFormat().resolvedOptions().locale.split("-")[0];return Hx(i)||Wi.ENGLISH}return Array.from(new Set(navigator.languages.map(i=>i.split("-")[0]))).map(i=>Hx(i)).filter(i=>i)[0]??Wi.LOCAL}const Zl={maptilerLogoURL:"https://api.maptiler.com/resources/logo.svg",maptilerURL:"https://www.maptiler.com/",maptilerApiHost:"api.maptiler.com",telemetryURL:"https://api.maptiler.com/metrics",rtlPluginURL:"https://cdn.maptiler.com/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.min.js",primaryLanguage:Wi.STYLE,secondaryLanguage:Wi.LOCAL,terrainSourceURL:"https://api.maptiler.com/tiles/terrain-rgb-v2/tiles.json",terrainSourceId:"maptiler-terrain"};Object.freeze(Zl);const bw=EN();class FN extends bN{constructor(){super(...arguments),nn(this,"primaryLanguage",Zl.primaryLanguage),nn(this,"secondaryLanguage"),nn(this,"session",!0),nn(this,"caching",!0),nn(this,"telemetry",!0),nn(this,"_unit","metric"),nn(this,"_apiKey","")}set unit(e){this._unit=e,this.emit("unit",e)}get unit(){return this._unit}set apiKey(e){this._apiKey=e,ig.apiKey=e,this.emit("apiKey",e)}get apiKey(){return this._apiKey}set fetch(e){ig.fetch=e}get fetch(){return ig.fetch}}const Ha=new FN,Yx="localcache_source",Qx="localcache",VN="maptiler_sdk",UN=1e3,jN=100,Jx=typeof caches<"u",{addProtocol:aS}=Sn;function qN(i,e){if(Jx&&Ha.caching&&Ha.session&&i.host===Zl.maptilerApiHost){if(e==="Source"&&i.href.includes("tiles.json"))return i.href.replace("https://",`${Yx}://`);if(e==="Tile"||e==="Glyphs")return i.href.replace("https://",`${Qx}://`)}return i.href}let ix;async function DC(){return ix||(ix=await caches.open(VN)),ix}let sS=0;async function $N(){const i=await DC(),e=await i.keys(),t=e.slice(0,Math.max(e.length-UN,0));for(const a of t)i.delete(a)}function GN(){aS(Yx,async(i,e)=>{if(!i.url)throw new Error("");i.url=i.url.replace(`${Yx}://`,"https://");const t=i;t.signal=e.signal;const a=await fetch(i.url,t),h=await a.json();return h.tiles&&h.tiles.length>0&&(h.tiles[0]+=`&last-modified=${a.headers.get("Last-Modified")}`),{data:h,cacheControl:a.headers.get("Cache-Control"),expires:a.headers.get("Expires")}}),aS(Qx,async(i,e)=>{if(!i.url)throw new Error("");i.url=i.url.replace(`${Qx}://`,"https://");const t=new URL(i.url),a=new URL(t);a.searchParams.delete("mtsid"),a.searchParams.delete("key");const h=a.toString(),m=new URL(t);m.searchParams.delete("last-modified");const g=m.toString(),c=async Y=>({data:await Y.arrayBuffer(),cacheControl:Y.headers.get("Cache-Control"),expires:Y.headers.get("Expires")}),C=await DC(),k=await C.match(h);if(k)return c(k);const V=i;V.signal=e.signal;const Z=await fetch(g,V);return Z.status>=200&&Z.status<300&&(C.put(h,Z.clone()).catch(()=>{}),++sS>jN&&($N(),sS=0)),c(Z)})}function ZN(){if(typeof window>"u")return;const i=Sn.getRTLTextPluginStatus();if(i==="unavailable"||i==="requested")try{Sn.setRTLTextPlugin(Zl.rtlPluginURL,!0)}catch{}}function HN(i,e){for(const t of i)typeof e[t]=="function"&&(e[t]=e[t].bind(e))}function oS(i,e){let t=null;try{t=new URL(i)}catch{return{url:i}}return t.host===Zl.maptilerApiHost&&(t.searchParams.has("key")||t.searchParams.append("key",Ha.apiKey),Ha.session&&t.searchParams.append("mtsid",bw)),{url:qN(t,e)}}function lS(i){return(e,t)=>{if(i!=null){const a=i(e,t),h=oS((a==null?void 0:a.url)??"",t);return{...a,...h}}return oS(e,t)}}function zC(){return Math.random().toString(36).substring(2)}function nb(i){return/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/gi.test(i)}function WN(i){try{return JSON.parse(i)}catch{}return null}function XN(){return document.createElement("canvas").getContext("webgl2")?null:typeof WebGL2RenderingContext<"u"?"Graphic rendering with WebGL2 has been disabled or is not supported by your graphic card. The map cannot be displayed.":"Your browser does not support graphic rendering with WebGL2. The map cannot be displayed."}function KN(i){const e=XN();if(!e)return;let t=null;if(typeof i=="string"?t=document.getElementById(i):i instanceof HTMLElement&&(t=i),!t)throw new Error("The Map container must be provided.");const a=document.createElement("div");throw a.innerHTML=e,a.classList.add("webgl-warning-div"),t.appendChild(a),new Error(e)}function uS(i,e){return!(!Array.isArray(i)||i.length!==2||i[0]!=="get"||typeof i[1]!="string"||e&&!i[1].startsWith("name:")||!e&&i[1]!=="name")}function YN(i,e,t){const a=structuredClone(i),h=m=>{if(typeof m!="string")for(let g=0;g<m.length;g+=1)uS(m[g],t)?m[g]=structuredClone(e):h(m[g])};return uS(a,t)?e:(h(a),a)}function QN(i,e){const t=e?/\{name:\S+\}/:/\{name\}/;return{contains:t.test(i),exactMatch:new RegExp(`^${t.source}$`).test(i)}}function JN(i,e,t){const a=t?/\{name:\S+\}/:/\{name\}/,h=i.split(a);return["concat",...h.flatMap((m,g)=>g===h.length-1?[m]:[m,e])]}function e6(i){var e;const t=/\{name(?::(?<language>\S+))?\}/g,a=[];for(;;){const h=t.exec(i);if(!h)break;const m=((e=h.groups)==null?void 0:e.language)??null;a.push(m)}return a}function t6(i){return!Array.isArray(i)||i.length!==2||i[0]!=="get"||typeof i[1]!="string"?null:i[1].trim()==="name"?{isLanguage:!0,localization:null}:i[1].trim().startsWith("name:")?{isLanguage:!0,localization:i[1].trim().split(":").pop()}:null}function n6(i){const e=[],t=structuredClone(i),a=h=>{if(typeof h!="string")for(let m=0;m<h.length;m+=1){const g=t6(h[m]);g?e.push(g.localization):a(h[m])}};return a([t]),e}function i6(i,e){const t=[];for(const m of i){if(m.type!=="symbol")continue;const g=m,{id:c,layout:C}=g;if(!C||!("text-field"in C))continue;const k=e.getLayoutProperty(c,"text-field");if(k)if(typeof k=="string"){const V=e6(k);t.push(V)}else{const V=n6(k);t.push(V)}}const a=t.flat(),h={unlocalized:0,localized:{}};for(const m of a)m===null?h.unlocalized+=1:(m in h.localized||(h.localized[m]=0),h.localized[m]+=1);return h}(class extends Sn.Marker{addTo(i){return super.addTo(i)}});class NV extends Sn.Popup{addTo(e){return super.addTo(e)}}class BV extends Sn.Style{constructor(e,t={}){super(e,t)}}class FV extends Sn.CanvasSource{onAdd(e){super.onAdd(e)}}class VV extends Sn.GeoJSONSource{onAdd(e){super.onAdd(e)}}class UV extends Sn.ImageSource{onAdd(e){super.onAdd(e)}}class jV extends Sn.RasterTileSource{onAdd(e){super.onAdd(e)}}class qV extends Sn.RasterDEMTileSource{onAdd(e){super.onAdd(e)}}class $V extends Sn.VectorTileSource{onAdd(e){super.onAdd(e)}}class GV extends Sn.VideoSource{onAdd(e){super.onAdd(e)}}class r6 extends Sn.NavigationControl{onAdd(e){return super.onAdd(e)}}class a6 extends Sn.GeolocateControl{onAdd(e){return super.onAdd(e)}}class ZV extends Sn.AttributionControl{onAdd(e){return super.onAdd(e)}}class s6 extends Sn.LogoControl{onAdd(e){return super.onAdd(e)}}class o6 extends Sn.ScaleControl{onAdd(e){return super.onAdd(e)}}class l6 extends Sn.FullscreenControl{onAdd(e){return super.onAdd(e)}}class HV extends Sn.TerrainControl{onAdd(e){return super.onAdd(e)}}class WV extends Sn.BoxZoomHandler{constructor(e,t){super(e,t)}}class XV extends Sn.ScrollZoomHandler{constructor(e,t){super(e,t)}}class KV extends Sn.CooperativeGesturesHandler{constructor(e,t){super(e,t)}}class YV extends Sn.KeyboardHandler{constructor(e){super(e)}}class QV extends Sn.TwoFingersTouchPitchHandler{constructor(e){super(e)}}class JV extends Sn.MapWheelEvent{constructor(e,t,a){super(e,t,a)}}class eU extends Sn.MapTouchEvent{constructor(e,t,a){super(e,t,a)}}class tU extends Sn.MapMouseEvent{constructor(e,t,a,h={}){super(e,t,a,h)}}class cS extends s6{constructor(e={}){super(e),nn(this,"logoURL",""),nn(this,"linkURL",""),this.logoURL=e.logoURL??Zl.maptilerLogoURL,this.linkURL=e.linkURL??Zl.maptilerURL}onAdd(e){this._map=e,this._compact=this.options.compact??!1,this._container=window.document.createElement("div"),this._container.className="maplibregl-ctrl";const t=window.document.createElement("a");return t.style.backgroundRepeat="no-repeat",t.style.cursor="pointer",t.style.display="block",t.style.height="23px",t.style.margin="0 0 -4px -4px",t.style.overflow="hidden",t.style.width="88px",t.style.backgroundImage=`url(${this.logoURL})`,t.style.backgroundSize="100px 30px",t.style.width="100px",t.style.height="30px",t.target="_blank",t.rel="noopener",t.href=this.linkURL,t.setAttribute("aria-label","MapTiler logo"),t.setAttribute("rel","noopener"),this._container.appendChild(t),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}}var u6=8,c6={version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},h6={"*":{type:"source"}},d6=["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],f6={type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},p6={type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},m6={type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},g6={type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},_6={type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},y6={type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},v6={id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},b6=["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],x6={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},w6={"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},T6={"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},S6={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},E6={"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},A6={"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},I6={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},C6={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},P6={type:"array",value:"*"},M6={type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},R6={type:"enum",values:{Point:{},LineString:{},Polygon:{}}},k6={type:"array",minimum:0,maximum:24,value:["number","color"],length:2},L6={type:"array",value:"*",minimum:1},D6={anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},z6={"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},O6={source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},N6={type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},B6=["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],F6={"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},V6={"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},U6={"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},j6={"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},q6={"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},$6={"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},G6={"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},Z6={"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},H6={duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},W6={"*":{type:"string"}},X6={$version:u6,$root:c6,sources:h6,source:d6,source_vector:f6,source_raster:p6,source_raster_dem:m6,source_geojson:g6,source_video:_6,source_image:y6,layer:v6,layout:b6,layout_background:x6,layout_fill:w6,layout_circle:T6,layout_heatmap:S6,"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:E6,layout_symbol:A6,layout_raster:I6,layout_hillshade:C6,"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:P6,filter_operator:M6,geometry_type:R6,function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:k6,expression:L6,light:D6,sky:z6,terrain:O6,projection:N6,paint:B6,paint_fill:F6,"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:V6,paint_circle:U6,paint_heatmap:j6,paint_symbol:q6,paint_raster:$6,paint_hillshade:G6,"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:Z6,transition:H6,"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:W6};class Ht{constructor(e,t,a,h){this.message=(e?`${e}: `:"")+a,h&&(this.identifier=h),t!=null&&t.__line__&&(this.line=t.__line__)}}function E0(i,...e){for(const t of e)for(const a in t)i[a]=t[a];return i}class Uh extends Error{constructor(e,t){super(t),this.message=t,this.key=e}}class xw{constructor(e,t=[]){this.parent=e,this.bindings={};for(const[a,h]of t)this.bindings[a]=h}concat(e){return new xw(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return this.bindings[e]?!0:this.parent?this.parent.has(e):!1}}const ib={kind:"null"},Yt={kind:"number"},_i={kind:"string"},ui={kind:"boolean"},Wh={kind:"color"},rb={kind:"projectionDefinition"},Up={kind:"object"},li={kind:"value"},K6={kind:"error"},ab={kind:"collator"},sb={kind:"formatted"},ob={kind:"padding"},J_={kind:"colorArray"},lb={kind:"numberArray"},Sy={kind:"resolvedImage"},ub={kind:"variableAnchorOffsetCollection"};function Ou(i,e){return{kind:"array",itemType:i,N:e}}function wa(i){if(i.kind==="array"){const e=wa(i.itemType);return typeof i.N=="number"?`array<${e}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${e}>`}else return i.kind}const Y6=[ib,Yt,_i,ui,Wh,rb,sb,Up,Ou(li),ob,lb,J_,Sy,ub];function ey(i,e){if(e.kind==="error")return null;if(i.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!ey(i.itemType,e.itemType))&&(typeof i.N!="number"||i.N===e.N))return null}else{if(i.kind===e.kind)return null;if(i.kind==="value"){for(const t of Y6)if(!ey(t,e))return null}}return`Expected ${wa(i)} but found ${wa(e)} instead.`}function ww(i,e){return e.some(t=>t.kind===i.kind)}function jp(i,e){return e.some(t=>t==="null"?i===null:t==="array"?Array.isArray(i):t==="object"?i&&!Array.isArray(i)&&typeof i=="object":t===typeof i)}function Sf(i,e){return i.kind==="array"&&e.kind==="array"?i.itemType.kind===e.itemType.kind&&typeof i.N=="number":i.kind===e.kind}const OC=.96422,NC=1,BC=.82521,FC=4/29,ag=6/29,VC=3*ag*ag,Q6=ag*ag*ag,J6=Math.PI/180,eB=180/Math.PI;function UC(i){return i=i%360,i<0&&(i+=360),i}function jC([i,e,t,a]){i=rx(i),e=rx(e),t=rx(t);let h,m;const g=ax((.2225045*i+.7168786*e+.0606169*t)/NC);i===e&&e===t?h=m=g:(h=ax((.4360747*i+.3850649*e+.1430804*t)/OC),m=ax((.0139322*i+.0971045*e+.7141733*t)/BC));const c=116*g-16;return[c<0?0:c,500*(h-g),200*(g-m),a]}function rx(i){return i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function ax(i){return i>Q6?Math.pow(i,1/3):i/VC+FC}function qC([i,e,t,a]){let h=(i+16)/116,m=isNaN(e)?h:h+e/500,g=isNaN(t)?h:h-t/200;return h=NC*ox(h),m=OC*ox(m),g=BC*ox(g),[sx(3.1338561*m-1.6168667*h-.4906146*g),sx(-.9787684*m+1.9161415*h+.033454*g),sx(.0719453*m-.2289914*h+1.4052427*g),a]}function sx(i){return i=i<=.00304?12.92*i:1.055*Math.pow(i,1/2.4)-.055,i<0?0:i>1?1:i}function ox(i){return i>ag?i*i*i:VC*(i-FC)}function tB(i){const[e,t,a,h]=jC(i),m=Math.sqrt(t*t+a*a);return[Math.round(m*1e4)?UC(Math.atan2(a,t)*eB):NaN,m,e,h]}function nB([i,e,t,a]){return i=isNaN(i)?0:i*J6,qC([t,Math.cos(i)*e,Math.sin(i)*e,a])}function iB([i,e,t,a]){i=UC(i),e/=100,t/=100;function h(m){const g=(m+i/30)%12,c=e*Math.min(t,1-t);return t-c*Math.max(-1,Math.min(g-3,9-g,1))}return[h(0),h(8),h(4),a]}const rB=Object.hasOwn||function(i,e){return Object.prototype.hasOwnProperty.call(i,e)};function V_(i,e){return rB(i,e)?i[e]:void 0}function aB(i){if(i=i.toLowerCase().trim(),i==="transparent")return[0,0,0,0];const e=V_(sB,i);if(e){const[h,m,g]=e;return[h/255,m/255,g/255,1]}if(i.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(i)){const h=i.length<6?1:2;let m=1;return[Rv(i.slice(m,m+=h)),Rv(i.slice(m,m+=h)),Rv(i.slice(m,m+=h)),Rv(i.slice(m,m+h)||"ff")]}if(i.startsWith("rgb")){const h=/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/,m=i.match(h);if(m){const[g,c,C,k,V,Z,Y,Q,be,xe,ze,et]=m,Qe=[k||" ",Y||" ",xe].join("");if(Qe==="  "||Qe==="  /"||Qe===",,"||Qe===",,,"){const Xe=[C,Z,be].join(""),Ke=Xe==="%%%"?100:Xe===""?255:0;if(Ke){const Ve=[Wm(+c/Ke,0,1),Wm(+V/Ke,0,1),Wm(+Q/Ke,0,1),ze?hS(+ze,et):1];if(dS(Ve))return Ve}}return}}const t=/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/,a=i.match(t);if(a){const[h,m,g,c,C,k,V,Z,Y]=a,Q=[g||" ",C||" ",V].join("");if(Q==="  "||Q==="  /"||Q===",,"||Q===",,,"){const be=[+m,Wm(+c,0,100),Wm(+k,0,100),Z?hS(+Z,Y):1];if(dS(be))return iB(be)}}}function Rv(i){return parseInt(i.padEnd(2,i),16)/255}function hS(i,e){return Wm(e?i/100:i,0,1)}function Wm(i,e,t){return Math.min(Math.max(e,i),t)}function dS(i){return!i.some(Number.isNaN)}const sB={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function qp(i,e,t){return i+t*(e-i)}function ty(i,e,t){return i.map((a,h)=>qp(a,e[h],t))}class Tr{constructor(e,t,a,h=1,m=!0){this.r=e,this.g=t,this.b=a,this.a=h,m||(this.r*=h,this.g*=h,this.b*=h,h||this.overwriteGetter("rgb",[e,t,a,h]))}static parse(e){if(e instanceof Tr)return e;if(typeof e!="string")return;const t=aB(e);if(t)return new Tr(...t,!1)}get rgb(){const{r:e,g:t,b:a,a:h}=this,m=h||1/0;return this.overwriteGetter("rgb",[e/m,t/m,a/m,h])}get hcl(){return this.overwriteGetter("hcl",tB(this.rgb))}get lab(){return this.overwriteGetter("lab",jC(this.rgb))}overwriteGetter(e,t){return Object.defineProperty(this,e,{value:t}),t}toString(){const[e,t,a,h]=this.rgb;return`rgba(${[e,t,a].map(m=>Math.round(m*255)).join(",")},${h})`}static interpolate(e,t,a,h="rgb"){switch(h){case"rgb":{const[m,g,c,C]=ty(e.rgb,t.rgb,a);return new Tr(m,g,c,C,!1)}case"hcl":{const[m,g,c,C]=e.hcl,[k,V,Z,Y]=t.hcl;let Q,be;if(!isNaN(m)&&!isNaN(k)){let Xe=k-m;k>m&&Xe>180?Xe-=360:k<m&&m-k>180&&(Xe+=360),Q=m+a*Xe}else isNaN(m)?isNaN(k)?Q=NaN:(Q=k,(c===1||c===0)&&(be=V)):(Q=m,(Z===1||Z===0)&&(be=g));const[xe,ze,et,Qe]=nB([Q,be??qp(g,V,a),qp(c,Z,a),qp(C,Y,a)]);return new Tr(xe,ze,et,Qe,!1)}case"lab":{const[m,g,c,C]=qC(ty(e.lab,t.lab,a));return new Tr(m,g,c,C,!1)}}}}Tr.black=new Tr(0,0,0,1);Tr.white=new Tr(1,1,1,1);Tr.transparent=new Tr(0,0,0,0);Tr.red=new Tr(1,0,0,1);class Tw{constructor(e,t,a){e?this.sensitivity=t?"variant":"case":this.sensitivity=t?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,t){return this.collator.compare(e,t)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const oB=["bottom","center","top"];class e1{constructor(e,t,a,h,m,g){this.text=e,this.image=t,this.scale=a,this.fontStack=h,this.textColor=m,this.verticalAlign=g}}class zd{constructor(e){this.sections=e}static fromString(e){return new zd([new e1(e,null,null,null,null,null)])}isEmpty(){return this.sections.length===0?!0:!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof zd?e:zd.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}}class ih{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof ih)return e;if(typeof e=="number")return new ih([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const t of e)if(typeof t!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]];break}return new ih(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,t,a){return new ih(ty(e.values,t.values,a))}}class rh{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof rh)return e;if(typeof e=="number")return new rh([e]);if(Array.isArray(e)){for(const t of e)if(typeof t!="number")return;return new rh(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,t,a){return new rh(ty(e.values,t.values,a))}}class Nu{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Nu)return e;if(typeof e=="string"){const a=Tr.parse(e);return a?new Nu([a]):void 0}if(!Array.isArray(e))return;const t=[];for(const a of e){if(typeof a!="string")return;const h=Tr.parse(a);if(!h)return;t.push(h)}return new Nu(t)}toString(){return JSON.stringify(this.values)}static interpolate(e,t,a,h="rgb"){const m=[];if(e.values.length!=t.values.length)throw new Error(`colorArray: Arrays have mismatched length (${e.values.length} vs. ${t.values.length}), cannot interpolate.`);for(let g=0;g<e.values.length;g++)m.push(Tr.interpolate(e.values[g],t.values[g],a,h));return new Nu(m)}}class za extends Error{constructor(e){super(e),this.name="RuntimeError"}toJSON(){return this.message}}const lB=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Xh{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Xh)return e;if(!(!Array.isArray(e)||e.length<1||e.length%2!==0)){for(let t=0;t<e.length;t+=2){const a=e[t],h=e[t+1];if(typeof a!="string"||!lB.has(a)||!Array.isArray(h)||h.length!==2||typeof h[0]!="number"||typeof h[1]!="number")return}return new Xh(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,t,a){const h=e.values,m=t.values;if(h.length!==m.length)throw new za(`Cannot interpolate values of different length. from: ${e.toString()}, to: ${t.toString()}`);const g=[];for(let c=0;c<h.length;c+=2){if(h[c]!==m[c])throw new za(`Cannot interpolate values containing mismatched anchors. from[${c}]: ${h[c]}, to[${c}]: ${m[c]}`);g.push(h[c]);const[C,k]=h[c+1],[V,Z]=m[c+1];g.push([qp(C,V,a),qp(k,Z,a)])}return new Xh(g)}}class Gf{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Gf({name:e,available:!1}):null}}class Jc{constructor(e,t,a){this.from=e,this.to=t,this.transition=a}static interpolate(e,t,a){return new Jc(e,t,a)}static parse(e){if(e instanceof Jc)return e;if(Array.isArray(e)&&e.length===3&&typeof e[0]=="string"&&typeof e[1]=="string"&&typeof e[2]=="number")return new Jc(e[0],e[1],e[2]);if(typeof e=="object"&&typeof e.from=="string"&&typeof e.to=="string"&&typeof e.transition=="number")return new Jc(e.from,e.to,e.transition);if(typeof e=="string")return new Jc(e,e,1)}}function $C(i,e,t,a){return typeof i=="number"&&i>=0&&i<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof t=="number"&&t>=0&&t<=255?typeof a>"u"||typeof a=="number"&&a>=0&&a<=1?null:`Invalid rgba value [${[i,e,t,a].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof a=="number"?[i,e,t,a]:[i,e,t]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ny(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof Jc||i instanceof Tr||i instanceof Tw||i instanceof zd||i instanceof ih||i instanceof rh||i instanceof Nu||i instanceof Xh||i instanceof Gf)return!0;if(Array.isArray(i)){for(const e of i)if(!ny(e))return!1;return!0}else if(typeof i=="object"){for(const e in i)if(!ny(i[e]))return!1;return!0}else return!1}function Vs(i){if(i===null)return ib;if(typeof i=="string")return _i;if(typeof i=="boolean")return ui;if(typeof i=="number")return Yt;if(i instanceof Tr)return Wh;if(i instanceof Jc)return rb;if(i instanceof Tw)return ab;if(i instanceof zd)return sb;if(i instanceof ih)return ob;if(i instanceof rh)return lb;if(i instanceof Nu)return J_;if(i instanceof Xh)return ub;if(i instanceof Gf)return Sy;if(Array.isArray(i)){const e=i.length;let t;for(const a of i){const h=Vs(a);if(!t)t=h;else{if(t===h)continue;t=li;break}}return Ou(t||li,e)}else return Up}function U_(i){const e=typeof i;return i===null?"":e==="string"||e==="number"||e==="boolean"?String(i):i instanceof Tr||i instanceof Jc||i instanceof zd||i instanceof ih||i instanceof rh||i instanceof Nu||i instanceof Xh||i instanceof Gf?i.toString():JSON.stringify(i)}class fg{constructor(e,t){this.type=e,this.value=t}static parse(e,t){if(e.length!==2)return t.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!ny(e[1]))return t.error("invalid value");const a=e[1];let h=Vs(a);const m=t.expectedType;return h.kind==="array"&&h.N===0&&m&&m.kind==="array"&&(typeof m.N!="number"||m.N===0)&&(h=m),new fg(h,a)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const kv={string:_i,number:Yt,boolean:ui,object:Up};class eh{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");let a=1,h;const m=e[0];if(m==="array"){let c;if(e.length>2){const k=e[1];if(typeof k!="string"||!(k in kv)||k==="object")return t.error('The item type argument of "array" must be one of string, number, boolean',1);c=kv[k],a++}else c=li;let C;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return t.error('The length argument to "array" must be a positive integer literal',2);C=e[2],a++}h=Ou(c,C)}else{if(!kv[m])throw new Error(`Types doesn't contain name = ${m}`);h=kv[m]}const g=[];for(;a<e.length;a++){const c=t.parse(e[a],a,li);if(!c)return null;g.push(c)}return new eh(h,g)}evaluate(e){for(let t=0;t<this.args.length;t++){const a=this.args[t].evaluate(e);if(ey(this.type,Vs(a))){if(t===this.args.length-1)throw new za(`Expected value to be of type ${wa(this.type)}, but found ${wa(Vs(a))} instead.`)}else return a}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const fS={"to-boolean":ui,"to-color":Wh,"to-number":Yt,"to-string":_i};class Mf{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const a=e[0];if(!fS[a])throw new Error(`Can't parse ${a} as it is not part of the known types`);if((a==="to-boolean"||a==="to-string")&&e.length!==2)return t.error("Expected one argument.");const h=fS[a],m=[];for(let g=1;g<e.length;g++){const c=t.parse(e[g],g,li);if(!c)return null;m.push(c)}return new Mf(h,m)}evaluate(e){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(e);case"color":{let t,a;for(const h of this.args){if(t=h.evaluate(e),a=null,t instanceof Tr)return t;if(typeof t=="string"){const m=e.parseColor(t);if(m)return m}else if(Array.isArray(t)&&(t.length<3||t.length>4?a=`Invalid rgba value ${JSON.stringify(t)}: expected an array containing either three or four numeric values.`:a=$C(t[0],t[1],t[2],t[3]),!a))return new Tr(t[0]/255,t[1]/255,t[2]/255,t[3])}throw new za(a||`Could not parse color from value '${typeof t=="string"?t:JSON.stringify(t)}'`)}case"padding":{let t;for(const a of this.args){t=a.evaluate(e);const h=ih.parse(t);if(h)return h}throw new za(`Could not parse padding from value '${typeof t=="string"?t:JSON.stringify(t)}'`)}case"numberArray":{let t;for(const a of this.args){t=a.evaluate(e);const h=rh.parse(t);if(h)return h}throw new za(`Could not parse numberArray from value '${typeof t=="string"?t:JSON.stringify(t)}'`)}case"colorArray":{let t;for(const a of this.args){t=a.evaluate(e);const h=Nu.parse(t);if(h)return h}throw new za(`Could not parse colorArray from value '${typeof t=="string"?t:JSON.stringify(t)}'`)}case"variableAnchorOffsetCollection":{let t;for(const a of this.args){t=a.evaluate(e);const h=Xh.parse(t);if(h)return h}throw new za(`Could not parse variableAnchorOffsetCollection from value '${typeof t=="string"?t:JSON.stringify(t)}'`)}case"number":{let t=null;for(const a of this.args){if(t=a.evaluate(e),t===null)return 0;const h=Number(t);if(!isNaN(h))return h}throw new za(`Could not convert ${JSON.stringify(t)} to number.`)}case"formatted":return zd.fromString(U_(this.args[0].evaluate(e)));case"resolvedImage":return Gf.fromString(U_(this.args[0].evaluate(e)));case"projectionDefinition":return this.args[0].evaluate(e);default:return U_(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const uB=["Unknown","Point","LineString","Polygon"];class GC{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?uB[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let t=this._parseColorCache.get(e);return t||(t=Tr.parse(e),this._parseColorCache.set(e,t)),t}}class cb{constructor(e,t,a=[],h,m=new xw,g=[]){this.registry=e,this.path=a,this.key=a.map(c=>`[${c}]`).join(""),this.scope=m,this.errors=g,this.expectedType=h,this._isConstant=t}parse(e,t,a,h,m={}){return t?this.concat(t,a,h)._parse(e,m):this._parse(e,m)}_parse(e,t){(e===null||typeof e=="string"||typeof e=="boolean"||typeof e=="number")&&(e=["literal",e]);function a(h,m,g){return g==="assert"?new eh(m,[h]):g==="coerce"?new Mf(m,[h]):h}if(Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const h=e[0];if(typeof h!="string")return this.error(`Expression name must be a string, but found ${typeof h} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const m=this.registry[h];if(m){let g=m.parse(e,this);if(!g)return null;if(this.expectedType){const c=this.expectedType,C=g.type;if((c.kind==="string"||c.kind==="number"||c.kind==="boolean"||c.kind==="object"||c.kind==="array")&&C.kind==="value")g=a(g,c,t.typeAnnotation||"assert");else if(c.kind==="projectionDefinition"&&["string","array"].includes(C.kind)||["color","formatted","resolvedImage"].includes(c.kind)&&["value","string"].includes(C.kind)||["padding","numberArray"].includes(c.kind)&&["value","number","array"].includes(C.kind)||c.kind==="colorArray"&&["value","string","array"].includes(C.kind)||c.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(C.kind))g=a(g,c,t.typeAnnotation||"coerce");else if(this.checkSubtype(c,C))return null}if(!(g instanceof fg)&&g.type.kind!=="resolvedImage"&&this._isConstant(g)){const c=new GC;try{g=new fg(g.type,g.evaluate(c))}catch(C){return this.error(C.message),null}}return g}return this.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0)}else return typeof e>"u"?this.error("'undefined' value invalid. Use null instead."):typeof e=="object"?this.error('Bare objects invalid. Use ["literal", {...}] instead.'):this.error(`Expected an array, but found ${typeof e} instead.`)}concat(e,t,a){const h=typeof e=="number"?this.path.concat(e):this.path,m=a?this.scope.concat(a):this.scope;return new cb(this.registry,this._isConstant,h,t||null,m,this.errors)}error(e,...t){const a=`${this.key}${t.map(h=>`[${h}]`).join("")}`;this.errors.push(new Uh(a,e))}checkSubtype(e,t){const a=ey(e,t);return a&&this.error(a),a}}class hb{constructor(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const t of this.bindings)e(t[1]);e(this.result)}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const a=[];for(let m=1;m<e.length-1;m+=2){const g=e[m];if(typeof g!="string")return t.error(`Expected string, but found ${typeof g} instead.`,m);if(/[^a-zA-Z0-9_]/.test(g))return t.error("Variable names must contain only alphanumeric characters or '_'.",m);const c=t.parse(e[m+1],m+1);if(!c)return null;a.push([g,c])}const h=t.parse(e[e.length-1],e.length-1,t.expectedType,a);return h?new hb(a,h):null}outputDefined(){return this.result.outputDefined()}}class db{constructor(e,t){this.type=t.type,this.name=e,this.boundExpression=t}static parse(e,t){if(e.length!==2||typeof e[1]!="string")return t.error("'var' expression requires exactly one string literal argument.");const a=e[1];return t.scope.has(a)?new db(a,t.scope.get(a)):t.error(`Unknown variable "${a}". Make sure "${a}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class Sw{constructor(e,t,a){this.type=e,this.index=t,this.input=a}static parse(e,t){if(e.length!==3)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=t.parse(e[1],1,Yt),h=t.parse(e[2],2,Ou(t.expectedType||li));if(!a||!h)return null;const m=h.type;return new Sw(m.itemType,a,h)}evaluate(e){const t=this.index.evaluate(e),a=this.input.evaluate(e);if(t<0)throw new za(`Array index out of bounds: ${t} < 0.`);if(t>=a.length)throw new za(`Array index out of bounds: ${t} > ${a.length-1}.`);if(t!==Math.floor(t))throw new za(`Array index must be an integer, but found ${t} instead.`);return a[t]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class Ew{constructor(e,t){this.type=ui,this.needle=e,this.haystack=t}static parse(e,t){if(e.length!==3)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=t.parse(e[1],1,li),h=t.parse(e[2],2,li);return!a||!h?null:ww(a.type,[ui,_i,Yt,ib,li])?new Ew(a,h):t.error(`Expected first argument to be of type boolean, string, number or null, but found ${wa(a.type)} instead`)}evaluate(e){const t=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(!a)return!1;if(!jp(t,["boolean","string","number","null"]))throw new za(`Expected first argument to be of type boolean, string, number or null, but found ${wa(Vs(t))} instead.`);if(!jp(a,["string","array"]))throw new za(`Expected second argument to be of type array or string, but found ${wa(Vs(a))} instead.`);return a.indexOf(t)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class A0{constructor(e,t,a){this.type=Yt,this.needle=e,this.haystack=t,this.fromIndex=a}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=t.parse(e[1],1,li),h=t.parse(e[2],2,li);if(!a||!h)return null;if(!ww(a.type,[ui,_i,Yt,ib,li]))return t.error(`Expected first argument to be of type boolean, string, number or null, but found ${wa(a.type)} instead`);if(e.length===4){const m=t.parse(e[3],3,Yt);return m?new A0(a,h,m):null}else return new A0(a,h)}evaluate(e){const t=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(!jp(t,["boolean","string","number","null"]))throw new za(`Expected first argument to be of type boolean, string, number or null, but found ${wa(Vs(t))} instead.`);let h;if(this.fromIndex&&(h=this.fromIndex.evaluate(e)),jp(a,["string"])){const m=a.indexOf(t,h);return m===-1?-1:[...a.slice(0,m)].length}else{if(jp(a,["array"]))return a.indexOf(t,h);throw new za(`Expected second argument to be of type array or string, but found ${wa(Vs(a))} instead.`)}}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class Aw{constructor(e,t,a,h,m,g){this.inputType=e,this.type=t,this.input=a,this.cases=h,this.outputs=m,this.otherwise=g}static parse(e,t){if(e.length<5)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!==1)return t.error("Expected an even number of arguments.");let a,h;t.expectedType&&t.expectedType.kind!=="value"&&(h=t.expectedType);const m={},g=[];for(let k=2;k<e.length-1;k+=2){let V=e[k];const Z=e[k+1];Array.isArray(V)||(V=[V]);const Y=t.concat(k);if(V.length===0)return Y.error("Expected at least one branch label.");for(const be of V){if(typeof be!="number"&&typeof be!="string")return Y.error("Branch labels must be numbers or strings.");if(typeof be=="number"&&Math.abs(be)>Number.MAX_SAFE_INTEGER)return Y.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof be=="number"&&Math.floor(be)!==be)return Y.error("Numeric branch labels must be integer values.");if(!a)a=Vs(be);else if(Y.checkSubtype(a,Vs(be)))return null;if(typeof m[String(be)]<"u")return Y.error("Branch labels must be unique.");m[String(be)]=g.length}const Q=t.parse(Z,k,h);if(!Q)return null;h=h||Q.type,g.push(Q)}const c=t.parse(e[1],1,li);if(!c)return null;const C=t.parse(e[e.length-1],e.length-1,h);return!C||c.type.kind!=="value"&&t.concat(1).checkSubtype(a,c.type)?null:new Aw(a,h,c,m,g,C)}evaluate(e){const t=this.input.evaluate(e);return(Vs(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}}class Iw{constructor(e,t,a){this.type=e,this.branches=t,this.otherwise=a}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!==0)return t.error("Expected an odd number of arguments.");let a;t.expectedType&&t.expectedType.kind!=="value"&&(a=t.expectedType);const h=[];for(let g=1;g<e.length-1;g+=2){const c=t.parse(e[g],g,ui);if(!c)return null;const C=t.parse(e[g+1],g+1,a);if(!C)return null;h.push([c,C]),a=a||C.type}const m=t.parse(e[e.length-1],e.length-1,a);if(!m)return null;if(!a)throw new Error("Can't infer output type");return new Iw(a,h,m)}evaluate(e){for(const[t,a]of this.branches)if(t.evaluate(e))return a.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[t,a]of this.branches)e(t),e(a);e(this.otherwise)}outputDefined(){return this.branches.every(([e,t])=>t.outputDefined())&&this.otherwise.outputDefined()}}class I0{constructor(e,t,a,h){this.type=e,this.input=t,this.beginIndex=a,this.endIndex=h}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=t.parse(e[1],1,li),h=t.parse(e[2],2,Yt);if(!a||!h)return null;if(!ww(a.type,[Ou(li),_i,li]))return t.error(`Expected first argument to be of type array or string, but found ${wa(a.type)} instead`);if(e.length===4){const m=t.parse(e[3],3,Yt);return m?new I0(a.type,a,h,m):null}else return new I0(a.type,a,h)}evaluate(e){const t=this.input.evaluate(e),a=this.beginIndex.evaluate(e);let h;if(this.endIndex&&(h=this.endIndex.evaluate(e)),jp(t,["string"]))return[...t].slice(a,h).join("");if(jp(t,["array"]))return t.slice(a,h);throw new za(`Expected first argument to be of type array or string, but found ${wa(Vs(t))} instead.`)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function ZC(i,e){const t=i.length-1;let a=0,h=t,m=0,g,c;for(;a<=h;)if(m=Math.floor((a+h)/2),g=i[m],c=i[m+1],g<=e){if(m===t||e<c)return m;a=m+1}else if(g>e)h=m-1;else throw new za("Input is not a number.");return 0}class fb{constructor(e,t,a){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(const[h,m]of a)this.labels.push(h),this.outputs.push(m)}static parse(e,t){if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!==0)return t.error("Expected an even number of arguments.");const a=t.parse(e[1],1,Yt);if(!a)return null;const h=[];let m=null;t.expectedType&&t.expectedType.kind!=="value"&&(m=t.expectedType);for(let g=1;g<e.length;g+=2){const c=g===1?-1/0:e[g],C=e[g+1],k=g,V=g+1;if(typeof c!="number")return t.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',k);if(h.length&&h[h.length-1][0]>=c)return t.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',k);const Z=t.parse(C,V,m);if(!Z)return null;m=m||Z.type,h.push([c,Z])}return new fb(m,a,h)}evaluate(e){const t=this.labels,a=this.outputs;if(t.length===1)return a[0].evaluate(e);const h=this.input.evaluate(e);if(h<=t[0])return a[0].evaluate(e);const m=t.length;if(h>=t[m-1])return a[m-1].evaluate(e);const g=ZC(t,h);return a[g].evaluate(e)}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function cB(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var lx,pS;function hB(){if(pS)return lx;pS=1,lx=i;function i(e,t,a,h){this.cx=3*e,this.bx=3*(a-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(h-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=t,this.p2x=a,this.p2y=h}return i.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,t){if(t===void 0&&(t=1e-6),e<0)return 0;if(e>1)return 1;for(var a=e,h=0;h<8;h++){var m=this.sampleCurveX(a)-e;if(Math.abs(m)<t)return a;var g=this.sampleCurveDerivativeX(a);if(Math.abs(g)<1e-6)break;a=a-m/g}var c=0,C=1;for(a=e,h=0;h<20&&(m=this.sampleCurveX(a),!(Math.abs(m-e)<t));h++)e>m?c=a:C=a,a=(C-c)*.5+c;return a},solve:function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))}},lx}var dB=hB(),fB=cB(dB);class Kh{constructor(e,t,a,h,m){this.type=e,this.operator=t,this.interpolation=a,this.input=h,this.labels=[],this.outputs=[];for(const[g,c]of m)this.labels.push(g),this.outputs.push(c)}static interpolationFactor(e,t,a,h){let m=0;if(e.name==="exponential")m=ux(t,e.base,a,h);else if(e.name==="linear")m=ux(t,1,a,h);else if(e.name==="cubic-bezier"){const g=e.controlPoints;m=new fB(g[0],g[1],g[2],g[3]).solve(ux(t,1,a,h))}return m}static parse(e,t){let[a,h,m,...g]=e;if(!Array.isArray(h)||h.length===0)return t.error("Expected an interpolation type expression.",1);if(h[0]==="linear")h={name:"linear"};else if(h[0]==="exponential"){const k=h[1];if(typeof k!="number")return t.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:k}}else if(h[0]==="cubic-bezier"){const k=h.slice(1);if(k.length!==4||k.some(V=>typeof V!="number"||V<0||V>1))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:k}}else return t.error(`Unknown interpolation type ${String(h[0])}`,1,0);if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!==0)return t.error("Expected an even number of arguments.");if(m=t.parse(m,2,Yt),!m)return null;const c=[];let C=null;(a==="interpolate-hcl"||a==="interpolate-lab")&&t.expectedType!=J_?C=Wh:t.expectedType&&t.expectedType.kind!=="value"&&(C=t.expectedType);for(let k=0;k<g.length;k+=2){const V=g[k],Z=g[k+1],Y=k+3,Q=k+4;if(typeof V!="number")return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',Y);if(c.length&&c[c.length-1][0]>=V)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',Y);const be=t.parse(Z,Q,C);if(!be)return null;C=C||be.type,c.push([V,be])}return!Sf(C,Yt)&&!Sf(C,rb)&&!Sf(C,Wh)&&!Sf(C,ob)&&!Sf(C,lb)&&!Sf(C,J_)&&!Sf(C,ub)&&!Sf(C,Ou(Yt))?t.error(`Type ${wa(C)} is not interpolatable.`):new Kh(C,a,h,m,c)}evaluate(e){const t=this.labels,a=this.outputs;if(t.length===1)return a[0].evaluate(e);const h=this.input.evaluate(e);if(h<=t[0])return a[0].evaluate(e);const m=t.length;if(h>=t[m-1])return a[m-1].evaluate(e);const g=ZC(t,h),c=t[g],C=t[g+1],k=Kh.interpolationFactor(this.interpolation,h,c,C),V=a[g].evaluate(e),Z=a[g+1].evaluate(e);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return qp(V,Z,k);case"color":return Tr.interpolate(V,Z,k);case"padding":return ih.interpolate(V,Z,k);case"colorArray":return Nu.interpolate(V,Z,k);case"numberArray":return rh.interpolate(V,Z,k);case"variableAnchorOffsetCollection":return Xh.interpolate(V,Z,k);case"array":return ty(V,Z,k);case"projectionDefinition":return Jc.interpolate(V,Z,k)}case"interpolate-hcl":switch(this.type.kind){case"color":return Tr.interpolate(V,Z,k,"hcl");case"colorArray":return Nu.interpolate(V,Z,k,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return Tr.interpolate(V,Z,k,"lab");case"colorArray":return Nu.interpolate(V,Z,k,"lab")}}}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function ux(i,e,t,a){const h=a-t,m=i-t;return h===0?0:e===1?m/h:(Math.pow(e,m)-1)/(Math.pow(e,h)-1)}class iy{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");let a=null;const h=t.expectedType;h&&h.kind!=="value"&&(a=h);const m=[];for(const g of e.slice(1)){const c=t.parse(g,1+m.length,a,void 0,{typeAnnotation:"omit"});if(!c)return null;a=a||c.type,m.push(c)}if(!a)throw new Error("No output type");return h&&m.some(g=>ey(h,g.type))?new iy(li,m):new iy(a,m)}evaluate(e){let t=null,a=0,h;for(const m of this.args)if(a++,t=m.evaluate(e),t&&t instanceof Gf&&!t.available&&(h||(h=t.name),t=null,a===this.args.length&&(t=h)),t!==null)break;return t}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}function mS(i,e){return i==="=="||i==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function pB(i,e,t){return e===t}function mB(i,e,t){return e!==t}function gB(i,e,t){return e<t}function _B(i,e,t){return e>t}function yB(i,e,t){return e<=t}function vB(i,e,t){return e>=t}function HC(i,e,t,a){return a.compare(e,t)===0}function bB(i,e,t,a){return!HC(i,e,t,a)}function xB(i,e,t,a){return a.compare(e,t)<0}function wB(i,e,t,a){return a.compare(e,t)>0}function TB(i,e,t,a){return a.compare(e,t)<=0}function SB(i,e,t,a){return a.compare(e,t)>=0}function Ag(i,e,t){const a=i!=="=="&&i!=="!=";return class WC{constructor(m,g,c){this.type=ui,this.lhs=m,this.rhs=g,this.collator=c,this.hasUntypedArgument=m.type.kind==="value"||g.type.kind==="value"}static parse(m,g){if(m.length!==3&&m.length!==4)return g.error("Expected two or three arguments.");const c=m[0];let C=g.parse(m[1],1,li);if(!C)return null;if(!mS(c,C.type))return g.concat(1).error(`"${c}" comparisons are not supported for type '${wa(C.type)}'.`);let k=g.parse(m[2],2,li);if(!k)return null;if(!mS(c,k.type))return g.concat(2).error(`"${c}" comparisons are not supported for type '${wa(k.type)}'.`);if(C.type.kind!==k.type.kind&&C.type.kind!=="value"&&k.type.kind!=="value")return g.error(`Cannot compare types '${wa(C.type)}' and '${wa(k.type)}'.`);a&&(C.type.kind==="value"&&k.type.kind!=="value"?C=new eh(k.type,[C]):C.type.kind!=="value"&&k.type.kind==="value"&&(k=new eh(C.type,[k])));let V=null;if(m.length===4){if(C.type.kind!=="string"&&k.type.kind!=="string"&&C.type.kind!=="value"&&k.type.kind!=="value")return g.error("Cannot use collator to compare non-string types.");if(V=g.parse(m[3],3,ab),!V)return null}return new WC(C,k,V)}evaluate(m){const g=this.lhs.evaluate(m),c=this.rhs.evaluate(m);if(a&&this.hasUntypedArgument){const C=Vs(g),k=Vs(c);if(C.kind!==k.kind||!(C.kind==="string"||C.kind==="number"))throw new za(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${C.kind}, ${k.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){const C=Vs(g),k=Vs(c);if(C.kind!=="string"||k.kind!=="string")return e(m,g,c)}return this.collator?t(m,g,c,this.collator.evaluate(m)):e(m,g,c)}eachChild(m){m(this.lhs),m(this.rhs),this.collator&&m(this.collator)}outputDefined(){return!0}}}const EB=Ag("==",pB,HC),AB=Ag("!=",mB,bB),IB=Ag("<",gB,xB),CB=Ag(">",_B,wB),PB=Ag("<=",yB,TB),MB=Ag(">=",vB,SB);class pb{constructor(e,t,a){this.type=ab,this.locale=a,this.caseSensitive=e,this.diacriticSensitive=t}static parse(e,t){if(e.length!==2)return t.error("Expected one argument.");const a=e[1];if(typeof a!="object"||Array.isArray(a))return t.error("Collator options argument must be an object.");const h=t.parse(a["case-sensitive"]===void 0?!1:a["case-sensitive"],1,ui);if(!h)return null;const m=t.parse(a["diacritic-sensitive"]===void 0?!1:a["diacritic-sensitive"],1,ui);if(!m)return null;let g=null;return a.locale&&(g=t.parse(a.locale,1,_i),!g)?null:new pb(h,m,g)}evaluate(e){return new Tw(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}class Cw{constructor(e,t,a,h,m){this.type=_i,this.number=e,this.locale=t,this.currency=a,this.minFractionDigits=h,this.maxFractionDigits=m}static parse(e,t){if(e.length!==3)return t.error("Expected two arguments.");const a=t.parse(e[1],1,Yt);if(!a)return null;const h=e[2];if(typeof h!="object"||Array.isArray(h))return t.error("NumberFormat options argument must be an object.");let m=null;if(h.locale&&(m=t.parse(h.locale,1,_i),!m))return null;let g=null;if(h.currency&&(g=t.parse(h.currency,1,_i),!g))return null;let c=null;if(h["min-fraction-digits"]&&(c=t.parse(h["min-fraction-digits"],1,Yt),!c))return null;let C=null;return h["max-fraction-digits"]&&(C=t.parse(h["max-fraction-digits"],1,Yt),!C)?null:new Cw(a,m,g,c,C)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class Pw{constructor(e){this.type=sb,this.sections=e}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const a=e[1];if(!Array.isArray(a)&&typeof a=="object")return t.error("First argument must be an image or text section.");const h=[];let m=!1;for(let g=1;g<=e.length-1;++g){const c=e[g];if(m&&typeof c=="object"&&!Array.isArray(c)){m=!1;let C=null;if(c["font-scale"]&&(C=t.parse(c["font-scale"],1,Yt),!C))return null;let k=null;if(c["text-font"]&&(k=t.parse(c["text-font"],1,Ou(_i)),!k))return null;let V=null;if(c["text-color"]&&(V=t.parse(c["text-color"],1,Wh),!V))return null;let Z=null;if(c["vertical-align"]){if(typeof c["vertical-align"]=="string"&&!oB.includes(c["vertical-align"]))return t.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${c["vertical-align"]}' instead.`);if(Z=t.parse(c["vertical-align"],1,_i),!Z)return null}const Y=h[h.length-1];Y.scale=C,Y.font=k,Y.textColor=V,Y.verticalAlign=Z}else{const C=t.parse(e[g],1,li);if(!C)return null;const k=C.type.kind;if(k!=="string"&&k!=="value"&&k!=="null"&&k!=="resolvedImage")return t.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");m=!0,h.push({content:C,scale:null,font:null,textColor:null,verticalAlign:null})}}return new Pw(h)}evaluate(e){const t=a=>{const h=a.content.evaluate(e);return Vs(h)===Sy?new e1("",h,null,null,null,a.verticalAlign?a.verticalAlign.evaluate(e):null):new e1(U_(h),null,a.scale?a.scale.evaluate(e):null,a.font?a.font.evaluate(e).join(","):null,a.textColor?a.textColor.evaluate(e):null,a.verticalAlign?a.verticalAlign.evaluate(e):null)};return new zd(this.sections.map(t))}eachChild(e){for(const t of this.sections)e(t.content),t.scale&&e(t.scale),t.font&&e(t.font),t.textColor&&e(t.textColor),t.verticalAlign&&e(t.verticalAlign)}outputDefined(){return!1}}class Mw{constructor(e){this.type=Sy,this.input=e}static parse(e,t){if(e.length!==2)return t.error("Expected two arguments.");const a=t.parse(e[1],1,_i);return a?new Mw(a):t.error("No image name provided.")}evaluate(e){const t=this.input.evaluate(e),a=Gf.fromString(t);return a&&e.availableImages&&(a.available=e.availableImages.indexOf(t)>-1),a}eachChild(e){e(this.input)}outputDefined(){return!1}}class Rw{constructor(e){this.type=Yt,this.input=e}static parse(e,t){if(e.length!==2)return t.error(`Expected 1 argument, but found ${e.length-1} instead.`);const a=t.parse(e[1],1);return a?a.type.kind!=="array"&&a.type.kind!=="string"&&a.type.kind!=="value"?t.error(`Expected argument of type string or array, but found ${wa(a.type)} instead.`):new Rw(a):null}evaluate(e){const t=this.input.evaluate(e);if(typeof t=="string")return[...t].length;if(Array.isArray(t))return t.length;throw new za(`Expected value to be of type string or array, but found ${wa(Vs(t))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const Yh=8192;function RB(i,e){const t=kB(i[0]),a=DB(i[1]),h=Math.pow(2,e.z);return[Math.round(t*h*Yh),Math.round(a*h*Yh)]}function kw(i,e){const t=Math.pow(2,e.z),a=(i[0]/Yh+e.x)/t,h=(i[1]/Yh+e.y)/t;return[LB(a),zB(h)]}function kB(i){return(180+i)/360}function LB(i){return i*360-180}function DB(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function zB(i){return 360/Math.PI*Math.atan(Math.exp((180-i*360)*Math.PI/180))-90}function Ey(i,e){i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),i[2]=Math.max(i[2],e[0]),i[3]=Math.max(i[3],e[1])}function ry(i,e){return!(i[0]<=e[0]||i[2]>=e[2]||i[1]<=e[1]||i[3]>=e[3])}function OB(i,e,t){return e[1]>i[1]!=t[1]>i[1]&&i[0]<(t[0]-e[0])*(i[1]-e[1])/(t[1]-e[1])+e[0]}function NB(i,e,t){const a=i[0]-e[0],h=i[1]-e[1],m=i[0]-t[0],g=i[1]-t[1];return a*g-m*h===0&&a*m<=0&&h*g<=0}function mb(i,e,t,a){const h=[e[0]-i[0],e[1]-i[1]],m=[a[0]-t[0],a[1]-t[1]];return UB(m,h)===0?!1:!!(gS(i,e,t,a)&&gS(t,a,i,e))}function BB(i,e,t){for(const a of t)for(let h=0;h<a.length-1;++h)if(mb(i,e,a[h],a[h+1]))return!0;return!1}function Ig(i,e,t=!1){let a=!1;for(const h of e)for(let m=0;m<h.length-1;m++){if(NB(i,h[m],h[m+1]))return t;OB(i,h[m],h[m+1])&&(a=!a)}return a}function FB(i,e){for(const t of e)if(Ig(i,t))return!0;return!1}function XC(i,e){for(const t of i)if(!Ig(t,e))return!1;for(let t=0;t<i.length-1;++t)if(BB(i[t],i[t+1],e))return!1;return!0}function VB(i,e){for(const t of e)if(XC(i,t))return!0;return!1}function UB(i,e){return i[0]*e[1]-i[1]*e[0]}function gS(i,e,t,a){const h=i[0]-t[0],m=i[1]-t[1],g=e[0]-t[0],c=e[1]-t[1],C=a[0]-t[0],k=a[1]-t[1],V=h*k-C*m,Z=g*k-C*c;return V>0&&Z<0||V<0&&Z>0}function Lw(i,e,t){const a=[];for(let h=0;h<i.length;h++){const m=[];for(let g=0;g<i[h].length;g++){const c=RB(i[h][g],t);Ey(e,c),m.push(c)}a.push(m)}return a}function KC(i,e,t){const a=[];for(let h=0;h<i.length;h++){const m=Lw(i[h],e,t);a.push(m)}return a}function YC(i,e,t,a){if(i[0]<t[0]||i[0]>t[2]){const h=a*.5;let m=i[0]-t[0]>h?-a:t[0]-i[0]>h?a:0;m===0&&(m=i[0]-t[2]>h?-a:t[2]-i[0]>h?a:0),i[0]+=m}Ey(e,i)}function jB(i){i[0]=i[1]=1/0,i[2]=i[3]=-1/0}function _S(i,e,t,a){const h=Math.pow(2,a.z)*Yh,m=[a.x*Yh,a.y*Yh],g=[];for(const c of i)for(const C of c){const k=[C.x+m[0],C.y+m[1]];YC(k,e,t,h),g.push(k)}return g}function yS(i,e,t,a){const h=Math.pow(2,a.z)*Yh,m=[a.x*Yh,a.y*Yh],g=[];for(const c of i){const C=[];for(const k of c){const V=[k.x+m[0],k.y+m[1]];Ey(e,V),C.push(V)}g.push(C)}if(e[2]-e[0]<=h/2){jB(e);for(const c of g)for(const C of c)YC(C,e,t,h)}return g}function qB(i,e){const t=[1/0,1/0,-1/0,-1/0],a=[1/0,1/0,-1/0,-1/0],h=i.canonicalID();if(e.type==="Polygon"){const m=Lw(e.coordinates,a,h),g=_S(i.geometry(),t,a,h);if(!ry(t,a))return!1;for(const c of g)if(!Ig(c,m))return!1}if(e.type==="MultiPolygon"){const m=KC(e.coordinates,a,h),g=_S(i.geometry(),t,a,h);if(!ry(t,a))return!1;for(const c of g)if(!FB(c,m))return!1}return!0}function $B(i,e){const t=[1/0,1/0,-1/0,-1/0],a=[1/0,1/0,-1/0,-1/0],h=i.canonicalID();if(e.type==="Polygon"){const m=Lw(e.coordinates,a,h),g=yS(i.geometry(),t,a,h);if(!ry(t,a))return!1;for(const c of g)if(!XC(c,m))return!1}if(e.type==="MultiPolygon"){const m=KC(e.coordinates,a,h),g=yS(i.geometry(),t,a,h);if(!ry(t,a))return!1;for(const c of g)if(!VB(c,m))return!1}return!0}class $p{constructor(e,t){this.type=ui,this.geojson=e,this.geometries=t}static parse(e,t){if(e.length!==2)return t.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(ny(e[1])){const a=e[1];if(a.type==="FeatureCollection"){const h=[];for(const m of a.features){const{type:g,coordinates:c}=m.geometry;g==="Polygon"&&h.push(c),g==="MultiPolygon"&&h.push(...c)}if(h.length){const m={type:"MultiPolygon",coordinates:h};return new $p(a,m)}}else if(a.type==="Feature"){const h=a.geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new $p(a,a.geometry)}else if(a.type==="Polygon"||a.type==="MultiPolygon")return new $p(a,a)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return qB(e,this.geometries);if(e.geometryType()==="LineString")return $B(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class QC{constructor(e=[],t=(a,h)=>a<h?-1:a>h?1:0){if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let a=(this.length>>1)-1;a>=0;a--)this._down(a)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:t,compare:a}=this,h=t[e];for(;e>0;){const m=e-1>>1,g=t[m];if(a(h,g)>=0)break;t[e]=g,e=m}t[e]=h}_down(e){const{data:t,compare:a}=this,h=this.length>>1,m=t[e];for(;e<h;){let g=(e<<1)+1;const c=g+1;if(c<this.length&&a(t[c],t[g])<0&&(g=c),a(t[g],m)>=0)break;t[e]=t[g],e=g}t[e]=m}}function GB(i,e){if(i.length<=1)return[i];const t=[];let a,h;for(const m of i){const g=ZB(m);g!==0&&(m.area=Math.abs(g),h===void 0&&(h=g<0),h===g<0?(a&&t.push(a),a=[m]):a.push(m))}return a&&t.push(a),t}function ZB(i){let e=0;for(let t=0,a=i.length,h=a-1,m,g;t<a;h=t++)m=i[t],g=i[h],e+=(g.x-m.x)*(m.y+g.y);return e}const HB=6378.137,vS=1/298.257223563,bS=vS*(2-vS),xS=Math.PI/180;class Dw{constructor(e){const t=xS*HB*1e3,a=Math.cos(e*xS),h=1/(1-bS*(1-a*a)),m=Math.sqrt(h);this.kx=t*m*a,this.ky=t*m*h*(1-bS)}distance(e,t){const a=this.wrap(e[0]-t[0])*this.kx,h=(e[1]-t[1])*this.ky;return Math.sqrt(a*a+h*h)}pointOnLine(e,t){let a=1/0,h,m,g,c;for(let C=0;C<e.length-1;C++){let k=e[C][0],V=e[C][1],Z=this.wrap(e[C+1][0]-k)*this.kx,Y=(e[C+1][1]-V)*this.ky,Q=0;(Z!==0||Y!==0)&&(Q=(this.wrap(t[0]-k)*this.kx*Z+(t[1]-V)*this.ky*Y)/(Z*Z+Y*Y),Q>1?(k=e[C+1][0],V=e[C+1][1]):Q>0&&(k+=Z/this.kx*Q,V+=Y/this.ky*Q)),Z=this.wrap(t[0]-k)*this.kx,Y=(t[1]-V)*this.ky;const be=Z*Z+Y*Y;be<a&&(a=be,h=k,m=V,g=C,c=Q)}return{point:[h,m],index:g,t:Math.max(0,Math.min(1,c))}}wrap(e){for(;e<-180;)e+=360;for(;e>180;)e-=360;return e}}const t1=100,n1=50;function JC(i,e){return e[0]-i[0]}function C0(i){return i[1]-i[0]+1}function qd(i,e){return i[1]>=i[0]&&i[1]<e}function i1(i,e){if(i[0]>i[1])return[null,null];const t=C0(i);if(e){if(t===2)return[i,null];const h=Math.floor(t/2);return[[i[0],i[0]+h],[i[0]+h,i[1]]]}if(t===1)return[i,null];const a=Math.floor(t/2)-1;return[[i[0],i[0]+a],[i[0]+a+1,i[1]]]}function r1(i,e){if(!qd(e,i.length))return[1/0,1/0,-1/0,-1/0];const t=[1/0,1/0,-1/0,-1/0];for(let a=e[0];a<=e[1];++a)Ey(t,i[a]);return t}function a1(i){const e=[1/0,1/0,-1/0,-1/0];for(const t of i)for(const a of t)Ey(e,a);return e}function wS(i){return i[0]!==-1/0&&i[1]!==-1/0&&i[2]!==1/0&&i[3]!==1/0}function zw(i,e,t){if(!wS(i)||!wS(e))return NaN;let a=0,h=0;return i[2]<e[0]&&(a=e[0]-i[2]),i[0]>e[2]&&(a=i[0]-e[2]),i[1]>e[3]&&(h=i[1]-e[3]),i[3]<e[1]&&(h=e[1]-i[3]),t.distance([0,0],[a,h])}function Fp(i,e,t){const a=t.pointOnLine(e,i);return t.distance(i,a.point)}function Ow(i,e,t,a,h){const m=Math.min(Fp(i,[t,a],h),Fp(e,[t,a],h)),g=Math.min(Fp(t,[i,e],h),Fp(a,[i,e],h));return Math.min(m,g)}function WB(i,e,t,a,h){if(!(qd(e,i.length)&&qd(a,t.length)))return 1/0;let m=1/0;for(let g=e[0];g<e[1];++g){const c=i[g],C=i[g+1];for(let k=a[0];k<a[1];++k){const V=t[k],Z=t[k+1];if(mb(c,C,V,Z))return 0;m=Math.min(m,Ow(c,C,V,Z,h))}}return m}function XB(i,e,t,a,h){if(!(qd(e,i.length)&&qd(a,t.length)))return NaN;let m=1/0;for(let g=e[0];g<=e[1];++g)for(let c=a[0];c<=a[1];++c)if(m=Math.min(m,h.distance(i[g],t[c])),m===0)return m;return m}function KB(i,e,t){if(Ig(i,e,!0))return 0;let a=1/0;for(const h of e){const m=h[0],g=h[h.length-1];if(m!==g&&(a=Math.min(a,Fp(i,[g,m],t)),a===0))return a;const c=t.pointOnLine(h,i);if(a=Math.min(a,t.distance(i,c.point)),a===0)return a}return a}function YB(i,e,t,a){if(!qd(e,i.length))return NaN;for(let m=e[0];m<=e[1];++m)if(Ig(i[m],t,!0))return 0;let h=1/0;for(let m=e[0];m<e[1];++m){const g=i[m],c=i[m+1];for(const C of t)for(let k=0,V=C.length,Z=V-1;k<V;Z=k++){const Y=C[Z],Q=C[k];if(mb(g,c,Y,Q))return 0;h=Math.min(h,Ow(g,c,Y,Q,a))}}return h}function TS(i,e){for(const t of i)for(const a of t)if(Ig(a,e,!0))return!0;return!1}function QB(i,e,t,a=1/0){const h=a1(i),m=a1(e);if(a!==1/0&&zw(h,m,t)>=a)return a;if(ry(h,m)){if(TS(i,e))return 0}else if(TS(e,i))return 0;let g=1/0;for(const c of i)for(let C=0,k=c.length,V=k-1;C<k;V=C++){const Z=c[V],Y=c[C];for(const Q of e)for(let be=0,xe=Q.length,ze=xe-1;be<xe;ze=be++){const et=Q[ze],Qe=Q[be];if(mb(Z,Y,et,Qe))return 0;g=Math.min(g,Ow(Z,Y,et,Qe,t))}}return g}function SS(i,e,t,a,h,m){if(!m)return;const g=zw(r1(a,m),h,t);g<e&&i.push([g,m,[0,0]])}function Lv(i,e,t,a,h,m,g){if(!m||!g)return;const c=zw(r1(a,m),r1(h,g),t);c<e&&i.push([c,m,g])}function P0(i,e,t,a,h=1/0){let m=Math.min(a.distance(i[0],t[0][0]),h);if(m===0)return m;const g=new QC([[0,[0,i.length-1],[0,0]]],JC),c=a1(t);for(;g.length>0;){const C=g.pop();if(C[0]>=m)continue;const k=C[1],V=e?n1:t1;if(C0(k)<=V){if(!qd(k,i.length))return NaN;if(e){const Z=YB(i,k,t,a);if(isNaN(Z)||Z===0)return Z;m=Math.min(m,Z)}else for(let Z=k[0];Z<=k[1];++Z){const Y=KB(i[Z],t,a);if(m=Math.min(m,Y),m===0)return 0}}else{const Z=i1(k,e);SS(g,m,a,i,c,Z[0]),SS(g,m,a,i,c,Z[1])}}return m}function M0(i,e,t,a,h,m=1/0){let g=Math.min(m,h.distance(i[0],t[0]));if(g===0)return g;const c=new QC([[0,[0,i.length-1],[0,t.length-1]]],JC);for(;c.length>0;){const C=c.pop();if(C[0]>=g)continue;const k=C[1],V=C[2],Z=e?n1:t1,Y=a?n1:t1;if(C0(k)<=Z&&C0(V)<=Y){if(!qd(k,i.length)&&qd(V,t.length))return NaN;let Q;if(e&&a)Q=WB(i,k,t,V,h),g=Math.min(g,Q);else if(e&&!a){const be=i.slice(k[0],k[1]+1);for(let xe=V[0];xe<=V[1];++xe)if(Q=Fp(t[xe],be,h),g=Math.min(g,Q),g===0)return g}else if(!e&&a){const be=t.slice(V[0],V[1]+1);for(let xe=k[0];xe<=k[1];++xe)if(Q=Fp(i[xe],be,h),g=Math.min(g,Q),g===0)return g}else Q=XB(i,k,t,V,h),g=Math.min(g,Q)}else{const Q=i1(k,e),be=i1(V,a);Lv(c,g,h,i,t,Q[0],be[0]),Lv(c,g,h,i,t,Q[0],be[1]),Lv(c,g,h,i,t,Q[1],be[0]),Lv(c,g,h,i,t,Q[1],be[1])}}return g}function JB(i,e){const t=i.geometry(),a=t.flat().map(g=>kw([g.x,g.y],i.canonical));if(t.length===0)return NaN;const h=new Dw(a[0][1]);let m=1/0;for(const g of e){switch(g.type){case"Point":m=Math.min(m,M0(a,!1,[g.coordinates],!1,h,m));break;case"LineString":m=Math.min(m,M0(a,!1,g.coordinates,!0,h,m));break;case"Polygon":m=Math.min(m,P0(a,!1,g.coordinates,h,m));break}if(m===0)return m}return m}function eF(i,e){const t=i.geometry(),a=t.flat().map(g=>kw([g.x,g.y],i.canonical));if(t.length===0)return NaN;const h=new Dw(a[0][1]);let m=1/0;for(const g of e){switch(g.type){case"Point":m=Math.min(m,M0(a,!0,[g.coordinates],!1,h,m));break;case"LineString":m=Math.min(m,M0(a,!0,g.coordinates,!0,h,m));break;case"Polygon":m=Math.min(m,P0(a,!0,g.coordinates,h,m));break}if(m===0)return m}return m}function tF(i,e){const t=i.geometry();if(t.length===0||t[0].length===0)return NaN;const a=GB(t).map(g=>g.map(c=>c.map(C=>kw([C.x,C.y],i.canonical)))),h=new Dw(a[0][0][0][1]);let m=1/0;for(const g of e)for(const c of a){switch(g.type){case"Point":m=Math.min(m,P0([g.coordinates],!1,c,h,m));break;case"LineString":m=Math.min(m,P0(g.coordinates,!0,c,h,m));break;case"Polygon":m=Math.min(m,QB(c,g.coordinates,h,m));break}if(m===0)return m}return m}function cx(i){return i.type==="MultiPolygon"?i.coordinates.map(e=>({type:"Polygon",coordinates:e})):i.type==="MultiLineString"?i.coordinates.map(e=>({type:"LineString",coordinates:e})):i.type==="MultiPoint"?i.coordinates.map(e=>({type:"Point",coordinates:e})):[i]}class Gp{constructor(e,t){this.type=Yt,this.geojson=e,this.geometries=t}static parse(e,t){if(e.length!==2)return t.error(`'distance' expression requires exactly one argument, but found ${e.length-1} instead.`);if(ny(e[1])){const a=e[1];if(a.type==="FeatureCollection")return new Gp(a,a.features.map(h=>cx(h.geometry)).flat());if(a.type==="Feature")return new Gp(a,cx(a.geometry));if("type"in a&&"coordinates"in a)return new Gp(a,cx(a))}return t.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return JB(e,this.geometries);if(e.geometryType()==="LineString")return eF(e,this.geometries);if(e.geometryType()==="Polygon")return tF(e,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class Ay{constructor(e){this.type=li,this.key=e}static parse(e,t){if(e.length!==2)return t.error(`Expected 1 argument, but found ${e.length-1} instead.`);const a=e[1];return a==null?t.error("Global state property must be defined."):typeof a!="string"?t.error(`Global state property must be string, but found ${typeof e[1]} instead.`):new Ay(a)}evaluate(e){var t;const a=(t=e.globals)===null||t===void 0?void 0:t.globalState;return!a||Object.keys(a).length===0?null:V_(a,this.key)}eachChild(){}outputDefined(){return!1}}const Nw={"==":EB,"!=":AB,">":CB,"<":IB,">=":MB,"<=":PB,array:eh,at:Sw,boolean:eh,case:Iw,coalesce:iy,collator:pb,format:Pw,image:Mw,in:Ew,"index-of":A0,interpolate:Kh,"interpolate-hcl":Kh,"interpolate-lab":Kh,length:Rw,let:hb,literal:fg,match:Aw,number:eh,"number-format":Cw,object:eh,slice:I0,step:fb,string:eh,"to-boolean":Mf,"to-color":Mf,"to-number":Mf,"to-string":Mf,var:db,within:$p,distance:Gp,"global-state":Ay};class ah{constructor(e,t,a,h){this.name=e,this.type=t,this._evaluate=a,this.args=h}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,t){const a=e[0],h=ah.definitions[a];if(!h)return t.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0);const m=Array.isArray(h)?h[0]:h.type,g=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,c=g.filter(([k])=>!Array.isArray(k)||k.length===e.length-1);let C=null;for(const[k,V]of c){C=new cb(t.registry,R0,t.path,null,t.scope);const Z=[];let Y=!1;for(let Q=1;Q<e.length;Q++){const be=e[Q],xe=Array.isArray(k)?k[Q-1]:k.type,ze=C.parse(be,1+Z.length,xe);if(!ze){Y=!0;break}Z.push(ze)}if(!Y){if(Array.isArray(k)&&k.length!==Z.length){C.error(`Expected ${k.length} arguments, but found ${Z.length} instead.`);continue}for(let Q=0;Q<Z.length;Q++){const be=Array.isArray(k)?k[Q]:k.type,xe=Z[Q];C.concat(Q+1).checkSubtype(be,xe.type)}if(C.errors.length===0)return new ah(a,m,V,Z)}}if(c.length===1)t.errors.push(...C.errors);else{const k=(c.length?c:g).map(([Z])=>iF(Z)).join(" | "),V=[];for(let Z=1;Z<e.length;Z++){const Y=t.parse(e[Z],1+V.length);if(!Y)return null;V.push(wa(Y.type))}t.error(`Expected arguments of type ${k}, but found (${V.join(", ")}) instead.`)}return null}static register(e,t){ah.definitions=t;for(const a in t)e[a]=ah}}function ES(i,[e,t,a,h]){e=e.evaluate(i),t=t.evaluate(i),a=a.evaluate(i);const m=h?h.evaluate(i):1,g=$C(e,t,a,m);if(g)throw new za(g);return new Tr(e/255,t/255,a/255,m,!1)}function AS(i,e){return i in e}function hx(i,e){const t=e[i];return typeof t>"u"?null:t}function nF(i,e,t,a){for(;t<=a;){const h=t+a>>1;if(e[h]===i)return!0;e[h]>i?a=h-1:t=h+1}return!1}function Ip(i){return{type:i}}ah.register(Nw,{error:[K6,[_i],(i,[e])=>{throw new za(e.evaluate(i))}],typeof:[_i,[li],(i,[e])=>wa(Vs(e.evaluate(i)))],"to-rgba":[Ou(Yt,4),[Wh],(i,[e])=>{const[t,a,h,m]=e.evaluate(i).rgb;return[t*255,a*255,h*255,m]}],rgb:[Wh,[Yt,Yt,Yt],ES],rgba:[Wh,[Yt,Yt,Yt,Yt],ES],has:{type:ui,overloads:[[[_i],(i,[e])=>AS(e.evaluate(i),i.properties())],[[_i,Up],(i,[e,t])=>AS(e.evaluate(i),t.evaluate(i))]]},get:{type:li,overloads:[[[_i],(i,[e])=>hx(e.evaluate(i),i.properties())],[[_i,Up],(i,[e,t])=>hx(e.evaluate(i),t.evaluate(i))]]},"feature-state":[li,[_i],(i,[e])=>hx(e.evaluate(i),i.featureState||{})],properties:[Up,[],i=>i.properties()],"geometry-type":[_i,[],i=>i.geometryType()],id:[li,[],i=>i.id()],zoom:[Yt,[],i=>i.globals.zoom],"heatmap-density":[Yt,[],i=>i.globals.heatmapDensity||0],elevation:[Yt,[],i=>i.globals.elevation||0],"line-progress":[Yt,[],i=>i.globals.lineProgress||0],accumulated:[li,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[Yt,Ip(Yt),(i,e)=>{let t=0;for(const a of e)t+=a.evaluate(i);return t}],"*":[Yt,Ip(Yt),(i,e)=>{let t=1;for(const a of e)t*=a.evaluate(i);return t}],"-":{type:Yt,overloads:[[[Yt,Yt],(i,[e,t])=>e.evaluate(i)-t.evaluate(i)],[[Yt],(i,[e])=>-e.evaluate(i)]]},"/":[Yt,[Yt,Yt],(i,[e,t])=>e.evaluate(i)/t.evaluate(i)],"%":[Yt,[Yt,Yt],(i,[e,t])=>e.evaluate(i)%t.evaluate(i)],ln2:[Yt,[],()=>Math.LN2],pi:[Yt,[],()=>Math.PI],e:[Yt,[],()=>Math.E],"^":[Yt,[Yt,Yt],(i,[e,t])=>Math.pow(e.evaluate(i),t.evaluate(i))],sqrt:[Yt,[Yt],(i,[e])=>Math.sqrt(e.evaluate(i))],log10:[Yt,[Yt],(i,[e])=>Math.log(e.evaluate(i))/Math.LN10],ln:[Yt,[Yt],(i,[e])=>Math.log(e.evaluate(i))],log2:[Yt,[Yt],(i,[e])=>Math.log(e.evaluate(i))/Math.LN2],sin:[Yt,[Yt],(i,[e])=>Math.sin(e.evaluate(i))],cos:[Yt,[Yt],(i,[e])=>Math.cos(e.evaluate(i))],tan:[Yt,[Yt],(i,[e])=>Math.tan(e.evaluate(i))],asin:[Yt,[Yt],(i,[e])=>Math.asin(e.evaluate(i))],acos:[Yt,[Yt],(i,[e])=>Math.acos(e.evaluate(i))],atan:[Yt,[Yt],(i,[e])=>Math.atan(e.evaluate(i))],min:[Yt,Ip(Yt),(i,e)=>Math.min(...e.map(t=>t.evaluate(i)))],max:[Yt,Ip(Yt),(i,e)=>Math.max(...e.map(t=>t.evaluate(i)))],abs:[Yt,[Yt],(i,[e])=>Math.abs(e.evaluate(i))],round:[Yt,[Yt],(i,[e])=>{const t=e.evaluate(i);return t<0?-Math.round(-t):Math.round(t)}],floor:[Yt,[Yt],(i,[e])=>Math.floor(e.evaluate(i))],ceil:[Yt,[Yt],(i,[e])=>Math.ceil(e.evaluate(i))],"filter-==":[ui,[_i,li],(i,[e,t])=>i.properties()[e.value]===t.value],"filter-id-==":[ui,[li],(i,[e])=>i.id()===e.value],"filter-type-==":[ui,[_i],(i,[e])=>i.geometryType()===e.value],"filter-<":[ui,[_i,li],(i,[e,t])=>{const a=i.properties()[e.value],h=t.value;return typeof a==typeof h&&a<h}],"filter-id-<":[ui,[li],(i,[e])=>{const t=i.id(),a=e.value;return typeof t==typeof a&&t<a}],"filter->":[ui,[_i,li],(i,[e,t])=>{const a=i.properties()[e.value],h=t.value;return typeof a==typeof h&&a>h}],"filter-id->":[ui,[li],(i,[e])=>{const t=i.id(),a=e.value;return typeof t==typeof a&&t>a}],"filter-<=":[ui,[_i,li],(i,[e,t])=>{const a=i.properties()[e.value],h=t.value;return typeof a==typeof h&&a<=h}],"filter-id-<=":[ui,[li],(i,[e])=>{const t=i.id(),a=e.value;return typeof t==typeof a&&t<=a}],"filter->=":[ui,[_i,li],(i,[e,t])=>{const a=i.properties()[e.value],h=t.value;return typeof a==typeof h&&a>=h}],"filter-id->=":[ui,[li],(i,[e])=>{const t=i.id(),a=e.value;return typeof t==typeof a&&t>=a}],"filter-has":[ui,[li],(i,[e])=>e.value in i.properties()],"filter-has-id":[ui,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[ui,[Ou(_i)],(i,[e])=>e.value.indexOf(i.geometryType())>=0],"filter-id-in":[ui,[Ou(li)],(i,[e])=>e.value.indexOf(i.id())>=0],"filter-in-small":[ui,[_i,Ou(li)],(i,[e,t])=>t.value.indexOf(i.properties()[e.value])>=0],"filter-in-large":[ui,[_i,Ou(li)],(i,[e,t])=>nF(i.properties()[e.value],t.value,0,t.value.length-1)],all:{type:ui,overloads:[[[ui,ui],(i,[e,t])=>e.evaluate(i)&&t.evaluate(i)],[Ip(ui),(i,e)=>{for(const t of e)if(!t.evaluate(i))return!1;return!0}]]},any:{type:ui,overloads:[[[ui,ui],(i,[e,t])=>e.evaluate(i)||t.evaluate(i)],[Ip(ui),(i,e)=>{for(const t of e)if(t.evaluate(i))return!0;return!1}]]},"!":[ui,[ui],(i,[e])=>!e.evaluate(i)],"is-supported-script":[ui,[_i],(i,[e])=>{const t=i.globals&&i.globals.isSupportedScript;return t?t(e.evaluate(i)):!0}],upcase:[_i,[_i],(i,[e])=>e.evaluate(i).toUpperCase()],downcase:[_i,[_i],(i,[e])=>e.evaluate(i).toLowerCase()],concat:[_i,Ip(li),(i,e)=>e.map(t=>U_(t.evaluate(i))).join("")],"resolved-locale":[_i,[ab],(i,[e])=>e.evaluate(i).resolvedLocale()]});function iF(i){return Array.isArray(i)?`(${i.map(wa).join(", ")})`:`(${wa(i.type)}...)`}function R0(i){if(i instanceof db)return R0(i.boundExpression);if(i instanceof ah&&i.name==="error"||i instanceof pb||i instanceof $p||i instanceof Gp||i instanceof Ay)return!1;const e=i instanceof Mf||i instanceof eh;let t=!0;return i.eachChild(a=>{e?t=t&&R0(a):t=t&&a instanceof fg}),t?gb(i)&&_b(i,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"]):!1}function gb(i){if(i instanceof ah&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof $p||i instanceof Gp)return!1;let e=!0;return i.eachChild(t=>{e&&!gb(t)&&(e=!1)}),e}function ay(i){if(i instanceof ah&&i.name==="feature-state")return!1;let e=!0;return i.eachChild(t=>{e&&!ay(t)&&(e=!1)}),e}function _b(i,e){if(i instanceof ah&&e.indexOf(i.name)>=0)return!1;let t=!0;return i.eachChild(a=>{t&&!_b(a,e)&&(t=!1)}),t}function s1(i){return{result:"success",value:i}}function Xm(i){return{result:"error",value:i}}function k0(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function eP(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function tP(i){return!!i.expression&&i.expression.interpolated}function Ii(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function Bw(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)&&Vs(i)===Up}class rF{constructor(e,t){this.expression=e,this._warningHistory={},this._evaluator=new GC,this._defaultValue=t?oF(t):null,this._enumValues=t&&t.type==="enum"?t.values:null}evaluateWithoutErrorHandling(e,t,a,h,m,g){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=a,this._evaluator.canonical=h,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=g,this.expression.evaluate(this._evaluator)}evaluate(e,t,a,h,m,g){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=a||null,this._evaluator.canonical=h,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=g||null;try{const c=this.expression.evaluate(this._evaluator);if(c==null||typeof c=="number"&&c!==c)return this._defaultValue;if(this._enumValues&&!(c in this._enumValues))throw new za(`Expected value to be one of ${Object.keys(this._enumValues).map(C=>JSON.stringify(C)).join(", ")}, but found ${JSON.stringify(c)} instead.`);return c}catch(c){return this._warningHistory[c.message]||(this._warningHistory[c.message]=!0,typeof console<"u"&&console.warn(c.message)),this._defaultValue}}}function nP(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in Nw}function iP(i,e){const t=new cb(Nw,R0,[],e?sF(e):void 0),a=t.parse(i,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return a?s1(new rF(a,e)):Xm(t.errors)}class IS{constructor(e,t){this.kind=e,this._styleExpression=t,this.isStateDependent=e!=="constant"&&!ay(t.expression),this.globalStateRefs=Fw(t.expression)}evaluateWithoutErrorHandling(e,t,a,h,m,g){return this._styleExpression.evaluateWithoutErrorHandling(e,t,a,h,m,g)}evaluate(e,t,a,h,m,g){return this._styleExpression.evaluate(e,t,a,h,m,g)}}class CS{constructor(e,t,a,h){this.kind=e,this.zoomStops=a,this._styleExpression=t,this.isStateDependent=e!=="camera"&&!ay(t.expression),this.globalStateRefs=Fw(t.expression),this.interpolationType=h}evaluateWithoutErrorHandling(e,t,a,h,m,g){return this._styleExpression.evaluateWithoutErrorHandling(e,t,a,h,m,g)}evaluate(e,t,a,h,m,g){return this._styleExpression.evaluate(e,t,a,h,m,g)}interpolationFactor(e,t,a){return this.interpolationType?Kh.interpolationFactor(this.interpolationType,e,t,a):0}}function aF(i,e){const t=iP(i,e);if(t.result==="error")return t;const a=t.value.expression,h=gb(a);if(!h&&!k0(e))return Xm([new Uh("","data expressions not supported")]);const m=_b(a,["zoom"]);if(!m&&!eP(e))return Xm([new Uh("","zoom expressions not supported")]);const g=Kv(a);if(!g&&!m)return Xm([new Uh("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')]);if(g instanceof Uh)return Xm([g]);if(g instanceof Kh&&!tP(e))return Xm([new Uh("",'"interpolate" expressions cannot be used with this property')]);if(!g)return s1(h?new IS("constant",t.value):new IS("source",t.value));const c=g instanceof Kh?g.interpolation:void 0;return s1(h?new CS("camera",t.value,g.labels,c):new CS("composite",t.value,g.labels,c))}function Kv(i){let e=null;if(i instanceof hb)e=Kv(i.result);else if(i instanceof iy){for(const t of i.args)if(e=Kv(t),e)break}else(i instanceof fb||i instanceof Kh)&&i.input instanceof ah&&i.input.name==="zoom"&&(e=i);return e instanceof Uh||i.eachChild(t=>{const a=Kv(t);a instanceof Uh?e=a:!e&&a?e=new Uh("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&a&&e!==a&&(e=new Uh("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function Fw(i,e=new Set){return i instanceof Ay&&e.add(i.key),i.eachChild(t=>{Fw(t,e)}),e}function sF(i){const e={color:Wh,string:_i,number:Yt,enum:_i,boolean:ui,formatted:sb,padding:ob,numberArray:lb,colorArray:J_,projectionDefinition:rb,resolvedImage:Sy,variableAnchorOffsetCollection:ub};return i.type==="array"?Ou(e[i.value]||li,i.length):e[i.type]}function oF(i){if(i.type==="color"&&Bw(i.default))return new Tr(0,0,0,0);switch(i.type){case"color":return Tr.parse(i.default)||null;case"padding":return ih.parse(i.default)||null;case"numberArray":return rh.parse(i.default)||null;case"colorArray":return Nu.parse(i.default)||null;case"variableAnchorOffsetCollection":return Xh.parse(i.default)||null;case"projectionDefinition":return Jc.parse(i.default)||null;default:return i.default===void 0?null:i.default}}function rP(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const e of i.slice(1))if(!rP(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function aP(i){const e=i.key,t=i.value;return t?[new Ht(e,t,"constants have been deprecated as of v8")]:[]}function Wa(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function Jp(i){if(Array.isArray(i))return i.map(Jp);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const e={};for(const t in i)e[t]=Jp(i[t]);return e}return Wa(i)}function vc(i){const e=i.key,t=i.value,a=i.valueSpec||{},h=i.objectElementValidators||{},m=i.style,g=i.styleSpec,c=i.validateSpec;let C=[];const k=Ii(t);if(k!=="object")return[new Ht(e,t,`object expected, ${k} found`)];for(const V in t){const Z=V.split(".")[0],Y=V_(a,Z)||a["*"];let Q;if(V_(h,Z))Q=h[Z];else if(V_(a,Z))Q=c;else if(h["*"])Q=h["*"];else if(a["*"])Q=c;else{C.push(new Ht(e,t[V],`unknown property "${V}"`));continue}C=C.concat(Q({key:(e&&`${e}.`)+V,value:t[V],valueSpec:Y,style:m,styleSpec:g,object:t,objectKey:V,validateSpec:c},t))}for(const V in a)h[V]||a[V].required&&a[V].default===void 0&&t[V]===void 0&&C.push(new Ht(e,t,`missing required property "${V}"`));return C}function Vw(i){const e=i.value,t=i.valueSpec,a=i.validateSpec,h=i.style,m=i.styleSpec,g=i.key,c=i.arrayElementValidator||a;if(Ii(e)!=="array")return[new Ht(g,e,`array expected, ${Ii(e)} found`)];if(t.length&&e.length!==t.length)return[new Ht(g,e,`array length ${t.length} expected, length ${e.length} found`)];if(t["min-length"]&&e.length<t["min-length"])return[new Ht(g,e,`array length at least ${t["min-length"]} expected, length ${e.length} found`)];let C={type:t.value,values:t.values};m.$version<7&&(C.function=t.function),Ii(t.value)==="object"&&(C=t.value);let k=[];for(let V=0;V<e.length;V++)k=k.concat(c({array:e,arrayIndex:V,value:e[V],valueSpec:C,validateSpec:i.validateSpec,style:h,styleSpec:m,key:`${g}[${V}]`}));return k}function yb(i){const e=i.key,t=i.value,a=i.valueSpec;let h=Ii(t);return h==="number"&&t!==t&&(h="NaN"),h!=="number"?[new Ht(e,t,`number expected, ${h} found`)]:"minimum"in a&&t<a.minimum?[new Ht(e,t,`${t} is less than the minimum value ${a.minimum}`)]:"maximum"in a&&t>a.maximum?[new Ht(e,t,`${t} is greater than the maximum value ${a.maximum}`)]:[]}function sP(i){const e=i.valueSpec,t=Wa(i.value.type);let a,h={},m,g;const c=t!=="categorical"&&i.value.property===void 0,C=!c,k=Ii(i.value.stops)==="array"&&Ii(i.value.stops[0])==="array"&&Ii(i.value.stops[0][0])==="object",V=vc({key:i.key,value:i.value,valueSpec:i.styleSpec.function,validateSpec:i.validateSpec,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:Z,default:be}});return t==="identity"&&c&&V.push(new Ht(i.key,i.value,'missing required property "property"')),t!=="identity"&&!i.value.stops&&V.push(new Ht(i.key,i.value,'missing required property "stops"')),t==="exponential"&&i.valueSpec.expression&&!tP(i.valueSpec)&&V.push(new Ht(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(C&&!k0(i.valueSpec)?V.push(new Ht(i.key,i.value,"property functions not supported")):c&&!eP(i.valueSpec)&&V.push(new Ht(i.key,i.value,"zoom functions not supported"))),(t==="categorical"||k)&&i.value.property===void 0&&V.push(new Ht(i.key,i.value,'"property" property is required')),V;function Z(xe){if(t==="identity")return[new Ht(xe.key,xe.value,'identity function may not have a "stops" property')];let ze=[];const et=xe.value;return ze=ze.concat(Vw({key:xe.key,value:et,valueSpec:xe.valueSpec,validateSpec:xe.validateSpec,style:xe.style,styleSpec:xe.styleSpec,arrayElementValidator:Y})),Ii(et)==="array"&&et.length===0&&ze.push(new Ht(xe.key,et,"array must have at least one stop")),ze}function Y(xe){let ze=[];const et=xe.value,Qe=xe.key;if(Ii(et)!=="array")return[new Ht(Qe,et,`array expected, ${Ii(et)} found`)];if(et.length!==2)return[new Ht(Qe,et,`array length 2 expected, length ${et.length} found`)];if(k){if(Ii(et[0])!=="object")return[new Ht(Qe,et,`object expected, ${Ii(et[0])} found`)];if(et[0].zoom===void 0)return[new Ht(Qe,et,"object stop key must have zoom")];if(et[0].value===void 0)return[new Ht(Qe,et,"object stop key must have value")];if(g&&g>Wa(et[0].zoom))return[new Ht(Qe,et[0].zoom,"stop zoom values must appear in ascending order")];Wa(et[0].zoom)!==g&&(g=Wa(et[0].zoom),m=void 0,h={}),ze=ze.concat(vc({key:`${Qe}[0]`,value:et[0],valueSpec:{zoom:{}},validateSpec:xe.validateSpec,style:xe.style,styleSpec:xe.styleSpec,objectElementValidators:{zoom:yb,value:Q}}))}else ze=ze.concat(Q({key:`${Qe}[0]`,value:et[0],validateSpec:xe.validateSpec,style:xe.style,styleSpec:xe.styleSpec},et));return nP(Jp(et[1]))?ze.concat([new Ht(`${Qe}[1]`,et[1],"expressions are not allowed in function stops.")]):ze.concat(xe.validateSpec({key:`${Qe}[1]`,value:et[1],valueSpec:e,validateSpec:xe.validateSpec,style:xe.style,styleSpec:xe.styleSpec}))}function Q(xe,ze){const et=Ii(xe.value),Qe=Wa(xe.value),Xe=xe.value!==null?xe.value:ze;if(!a)a=et;else if(et!==a)return[new Ht(xe.key,Xe,`${et} stop domain type must match previous stop domain type ${a}`)];if(et!=="number"&&et!=="string"&&et!=="boolean")return[new Ht(xe.key,Xe,"stop domain value must be a number, string, or boolean")];if(et!=="number"&&t!=="categorical"){let Ke=`number expected, ${et} found`;return k0(e)&&t===void 0&&(Ke+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ht(xe.key,Xe,Ke)]}return t==="categorical"&&et==="number"&&(!isFinite(Qe)||Math.floor(Qe)!==Qe)?[new Ht(xe.key,Xe,`integer expected, found ${Qe}`)]:t!=="categorical"&&et==="number"&&m!==void 0&&Qe<m?[new Ht(xe.key,Xe,"stop domain values must appear in ascending order")]:(m=Qe,t==="categorical"&&Qe in h?[new Ht(xe.key,Xe,"stop domain values must be unique")]:(h[Qe]=!0,[]))}function be(xe){return xe.validateSpec({key:xe.key,value:xe.value,valueSpec:e,validateSpec:xe.validateSpec,style:xe.style,styleSpec:xe.styleSpec})}}function pg(i){const e=(i.expressionContext==="property"?aF:iP)(Jp(i.value),i.valueSpec);if(e.result==="error")return e.value.map(a=>new Ht(`${i.key}${a.key}`,i.value,a.message));const t=e.value.expression||e.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!t.outputDefined())return[new Ht(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!ay(t))return[new Ht(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!ay(t))return[new Ht(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!_b(t,["zoom","feature-state"]))return[new Ht(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!gb(t))return[new Ht(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function lF(i){const e=i.value,t=i.key,a=Ii(e);return a!=="boolean"?[new Ht(t,e,`boolean expected, ${a} found`)]:[]}function o1(i){const e=i.key,t=i.value,a=Ii(t);return a!=="string"?[new Ht(e,t,`color expected, ${a} found`)]:Tr.parse(String(t))?[]:[new Ht(e,t,`color expected, "${t}" found`)]}function sy(i){const e=i.key,t=i.value,a=i.valueSpec,h=[];return Array.isArray(a.values)?a.values.indexOf(Wa(t))===-1&&h.push(new Ht(e,t,`expected one of [${a.values.join(", ")}], ${JSON.stringify(t)} found`)):Object.keys(a.values).indexOf(Wa(t))===-1&&h.push(new Ht(e,t,`expected one of [${Object.keys(a.values).join(", ")}], ${JSON.stringify(t)} found`)),h}function Uw(i){return rP(Jp(i.value))?pg(E0({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):oP(i)}function oP(i){const e=i.value,t=i.key;if(Ii(e)!=="array")return[new Ht(t,e,`array expected, ${Ii(e)} found`)];const a=i.styleSpec;let h,m=[];if(e.length<1)return[new Ht(t,e,"filter array must have at least 1 element")];switch(m=m.concat(sy({key:`${t}[0]`,value:e[0],valueSpec:a.filter_operator,style:i.style,styleSpec:i.styleSpec})),Wa(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&Wa(e[1])==="$type"&&m.push(new Ht(t,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&m.push(new Ht(t,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(h=Ii(e[1]),h!=="string"&&m.push(new Ht(`${t}[1]`,e[1],`string expected, ${h} found`)));for(let g=2;g<e.length;g++)h=Ii(e[g]),Wa(e[1])==="$type"?m=m.concat(sy({key:`${t}[${g}]`,value:e[g],valueSpec:a.geometry_type,style:i.style,styleSpec:i.styleSpec})):h!=="string"&&h!=="number"&&h!=="boolean"&&m.push(new Ht(`${t}[${g}]`,e[g],`string, number, or boolean expected, ${h} found`));break;case"any":case"all":case"none":for(let g=1;g<e.length;g++)m=m.concat(oP({key:`${t}[${g}]`,value:e[g],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":h=Ii(e[1]),e.length!==2?m.push(new Ht(t,e,`filter array for "${e[0]}" operator must have 2 elements`)):h!=="string"&&m.push(new Ht(`${t}[1]`,e[1],`string expected, ${h} found`));break}return m}function lP(i,e){const t=i.key,a=i.validateSpec,h=i.style,m=i.styleSpec,g=i.value,c=i.objectKey,C=m[`${e}_${i.layerType}`];if(!C)return[];const k=c.match(/^(.*)-transition$/);if(e==="paint"&&k&&C[k[1]]&&C[k[1]].transition)return a({key:t,value:g,valueSpec:m.transition,style:h,styleSpec:m});const V=i.valueSpec||C[c];if(!V)return[new Ht(t,g,`unknown property "${c}"`)];let Z;if(Ii(g)==="string"&&k0(V)&&!V.tokens&&(Z=/^{([^}]+)}$/.exec(g)))return[new Ht(t,g,`"${c}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(Z[1])} }\`.`)];const Y=[];return i.layerType==="symbol"&&(c==="text-field"&&h&&!h.glyphs&&Y.push(new Ht(t,g,'use of "text-field" requires a style "glyphs" property')),c==="text-font"&&Bw(Jp(g))&&Wa(g.type)==="identity"&&Y.push(new Ht(t,g,'"text-font" does not support identity functions'))),Y.concat(a({key:i.key,value:g,valueSpec:V,style:h,styleSpec:m,expressionContext:"property",propertyType:e,propertyKey:c}))}function uP(i){return lP(i,"paint")}function cP(i){return lP(i,"layout")}function hP(i){let e=[];const t=i.value,a=i.key,h=i.style,m=i.styleSpec;if(Ii(t)!=="object")return[new Ht(a,t,`object expected, ${Ii(t)} found`)];!t.type&&!t.ref&&e.push(new Ht(a,t,'either "type" or "ref" is required'));let g=Wa(t.type);const c=Wa(t.ref);if(t.id){const C=Wa(t.id);for(let k=0;k<i.arrayIndex;k++){const V=h.layers[k];Wa(V.id)===C&&e.push(new Ht(a,t.id,`duplicate layer id "${t.id}", previously used at line ${V.id.__line__}`))}}if("ref"in t){["type","source","source-layer","filter","layout"].forEach(k=>{k in t&&e.push(new Ht(a,t[k],`"${k}" is prohibited for ref layers`))});let C;h.layers.forEach(k=>{Wa(k.id)===c&&(C=k)}),C?C.ref?e.push(new Ht(a,t.ref,"ref cannot reference another ref layer")):g=Wa(C.type):e.push(new Ht(a,t.ref,`ref layer "${c}" not found`))}else if(g!=="background")if(!t.source)e.push(new Ht(a,t,'missing required property "source"'));else{const C=h.sources&&h.sources[t.source],k=C&&Wa(C.type);C?k==="vector"&&g==="raster"?e.push(new Ht(a,t.source,`layer "${t.id}" requires a raster source`)):k!=="raster-dem"&&g==="hillshade"?e.push(new Ht(a,t.source,`layer "${t.id}" requires a raster-dem source`)):k!=="raster-dem"&&g==="color-relief"?e.push(new Ht(a,t.source,`layer "${t.id}" requires a raster-dem source`)):k==="raster"&&g!=="raster"?e.push(new Ht(a,t.source,`layer "${t.id}" requires a vector source`)):k==="vector"&&!t["source-layer"]?e.push(new Ht(a,t,`layer "${t.id}" must specify a "source-layer"`)):k==="raster-dem"&&g!=="hillshade"&&g!=="color-relief"?e.push(new Ht(a,t.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):g==="line"&&t.paint&&t.paint["line-gradient"]&&(k!=="geojson"||!C.lineMetrics)&&e.push(new Ht(a,t,`layer "${t.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Ht(a,t.source,`source "${t.source}" not found`))}return e=e.concat(vc({key:a,value:t,valueSpec:m.layer,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,objectElementValidators:{"*"(){return[]},type(){return i.validateSpec({key:`${a}.type`,value:t.type,valueSpec:m.layer.type,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,object:t,objectKey:"type"})},filter:Uw,layout(C){return vc({layer:t,key:C.key,value:C.value,style:C.style,styleSpec:C.styleSpec,validateSpec:C.validateSpec,objectElementValidators:{"*"(k){return cP(E0({layerType:g},k))}}})},paint(C){return vc({layer:t,key:C.key,value:C.value,style:C.style,styleSpec:C.styleSpec,validateSpec:C.validateSpec,objectElementValidators:{"*"(k){return uP(E0({layerType:g},k))}}})}}})),e}function em(i){const e=i.value,t=i.key,a=Ii(e);return a!=="string"?[new Ht(t,e,`string expected, ${a} found`)]:[]}function uF(i){var e;const t=(e=i.sourceName)!==null&&e!==void 0?e:"",a=i.value,h=i.styleSpec,m=h.source_raster_dem,g=i.style;let c=[];const C=Ii(a);if(a===void 0)return c;if(C!=="object")return c.push(new Ht("source_raster_dem",a,`object expected, ${C} found`)),c;const k=Wa(a.encoding)==="custom",V=["redFactor","greenFactor","blueFactor","baseShift"],Z=i.value.encoding?`"${i.value.encoding}"`:"Default";for(const Y in a)!k&&V.includes(Y)?c.push(new Ht(Y,a[Y],`In "${t}": "${Y}" is only valid when "encoding" is set to "custom". ${Z} encoding found`)):m[Y]?c=c.concat(i.validateSpec({key:Y,value:a[Y],valueSpec:m[Y],validateSpec:i.validateSpec,style:g,styleSpec:h})):c.push(new Ht(Y,a[Y],`unknown property "${Y}"`));return c}const PS={promoteId:cF};function dP(i){const e=i.value,t=i.key,a=i.styleSpec,h=i.style,m=i.validateSpec;if(!e.type)return[new Ht(t,e,'"type" is required')];const g=Wa(e.type);let c;switch(g){case"vector":case"raster":return c=vc({key:t,value:e,valueSpec:a[`source_${g.replace("-","_")}`],style:i.style,styleSpec:a,objectElementValidators:PS,validateSpec:m}),c;case"raster-dem":return c=uF({sourceName:t,value:e,style:i.style,styleSpec:a,validateSpec:m}),c;case"geojson":if(c=vc({key:t,value:e,valueSpec:a.source_geojson,style:h,styleSpec:a,validateSpec:m,objectElementValidators:PS}),e.cluster)for(const C in e.clusterProperties){const[k,V]=e.clusterProperties[C],Z=typeof k=="string"?[k,["accumulated"],["get",C]]:k;c.push(...pg({key:`${t}.${C}.map`,value:V,expressionContext:"cluster-map"})),c.push(...pg({key:`${t}.${C}.reduce`,value:Z,expressionContext:"cluster-reduce"}))}return c;case"video":return vc({key:t,value:e,valueSpec:a.source_video,style:h,validateSpec:m,styleSpec:a});case"image":return vc({key:t,value:e,valueSpec:a.source_image,style:h,validateSpec:m,styleSpec:a});case"canvas":return[new Ht(t,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return sy({key:`${t}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function cF({key:i,value:e}){if(Ii(e)==="string")return em({key:i,value:e});{const t=[];for(const a in e)t.push(...em({key:`${i}.${a}`,value:e[a]}));return t}}function fP(i){const e=i.value,t=i.styleSpec,a=t.light,h=i.style;let m=[];const g=Ii(e);if(e===void 0)return m;if(g!=="object")return m=m.concat([new Ht("light",e,`object expected, ${g} found`)]),m;for(const c in e){const C=c.match(/^(.*)-transition$/);C&&a[C[1]]&&a[C[1]].transition?m=m.concat(i.validateSpec({key:c,value:e[c],valueSpec:t.transition,validateSpec:i.validateSpec,style:h,styleSpec:t})):a[c]?m=m.concat(i.validateSpec({key:c,value:e[c],valueSpec:a[c],validateSpec:i.validateSpec,style:h,styleSpec:t})):m=m.concat([new Ht(c,e[c],`unknown property "${c}"`)])}return m}function pP(i){const e=i.value,t=i.styleSpec,a=t.sky,h=i.style,m=Ii(e);if(e===void 0)return[];if(m!=="object")return[new Ht("sky",e,`object expected, ${m} found`)];let g=[];for(const c in e)a[c]?g=g.concat(i.validateSpec({key:c,value:e[c],valueSpec:a[c],style:h,styleSpec:t})):g=g.concat([new Ht(c,e[c],`unknown property "${c}"`)]);return g}function mP(i){const e=i.value,t=i.styleSpec,a=t.terrain,h=i.style;let m=[];const g=Ii(e);if(e===void 0)return m;if(g!=="object")return m=m.concat([new Ht("terrain",e,`object expected, ${g} found`)]),m;for(const c in e)a[c]?m=m.concat(i.validateSpec({key:c,value:e[c],valueSpec:a[c],validateSpec:i.validateSpec,style:h,styleSpec:t})):m=m.concat([new Ht(c,e[c],`unknown property "${c}"`)]);return m}function hF(i){return em(i).length===0?[]:pg(i)}function dF(i){return em(i).length===0?[]:pg(i)}function fF(i){const e=i.key,t=i.value;if(Ii(t)==="array"){if(t.length<1||t.length>4)return[new Ht(e,t,`padding requires 1 to 4 values; ${t.length} values found`)];const a={type:"number"};let h=[];for(let m=0;m<t.length;m++)h=h.concat(i.validateSpec({key:`${e}[${m}]`,value:t[m],validateSpec:i.validateSpec,valueSpec:a}));return h}else return yb({key:e,value:t,valueSpec:{}})}function pF(i){const e=i.key,t=i.value;if(Ii(t)==="array"){const a={type:"number"};if(t.length<1)return[new Ht(e,t,"array length at least 1 expected, length 0 found")];let h=[];for(let m=0;m<t.length;m++)h=h.concat(i.validateSpec({key:`${e}[${m}]`,value:t[m],validateSpec:i.validateSpec,valueSpec:a}));return h}else return yb({key:e,value:t,valueSpec:{}})}function mF(i){const e=i.key,t=i.value;if(Ii(t)==="array"){if(t.length<1)return[new Ht(e,t,"array length at least 1 expected, length 0 found")];let a=[];for(let h=0;h<t.length;h++)a=a.concat(o1({key:`${e}[${h}]`,value:t[h]}));return a}else return o1({key:e,value:t})}function gF(i){const e=i.key,t=i.value,a=Ii(t),h=i.styleSpec;if(a!=="array"||t.length<1||t.length%2!==0)return[new Ht(e,t,"variableAnchorOffsetCollection requires a non-empty array of even length")];let m=[];for(let g=0;g<t.length;g+=2)m=m.concat(sy({key:`${e}[${g}]`,value:t[g],valueSpec:h.layout_symbol["text-anchor"]})),m=m.concat(Vw({key:`${e}[${g+1}]`,value:t[g+1],valueSpec:{length:2,value:"number"},validateSpec:i.validateSpec,style:i.style,styleSpec:h}));return m}function gP(i){let e=[];const t=i.value,a=i.key;if(Array.isArray(t)){const h=[],m=[];for(const g in t){t[g].id&&h.includes(t[g].id)&&e.push(new Ht(a,t,`all the sprites' ids must be unique, but ${t[g].id} is duplicated`)),h.push(t[g].id),t[g].url&&m.includes(t[g].url)&&e.push(new Ht(a,t,`all the sprites' URLs must be unique, but ${t[g].url} is duplicated`)),m.push(t[g].url);const c={id:{type:"string",required:!0},url:{type:"string",required:!0}};e=e.concat(vc({key:`${a}[${g}]`,value:t[g],valueSpec:c,validateSpec:i.validateSpec}))}return e}else return em({key:a,value:t})}function _F(i){const e=i.value,t=i.styleSpec,a=t.projection,h=i.style,m=Ii(e);if(e===void 0)return[];if(m!=="object")return[new Ht("projection",e,`object expected, ${m} found`)];let g=[];for(const c in e)a[c]?g=g.concat(i.validateSpec({key:c,value:e[c],valueSpec:a[c],style:h,styleSpec:t})):g=g.concat([new Ht(c,e[c],`unknown property "${c}"`)]);return g}function yF(i){const e=i.key;let t=i.value;t=t instanceof String?t.valueOf():t;const a=Ii(t);return a==="array"&&!bF(t)&&!vF(t)?[new Ht(e,t,`projection expected, invalid array ${JSON.stringify(t)} found`)]:["array","string"].includes(a)?[]:[new Ht(e,t,`projection expected, invalid type "${a}" found`)]}function vF(i){return!!["interpolate","step","literal"].includes(i[0])}function bF(i){return Array.isArray(i)&&i.length===3&&typeof i[0]=="string"&&typeof i[1]=="string"&&typeof i[2]=="number"}function xF(i){return!!i&&i.constructor===Object}function _P(i){return xF(i.value)?[]:[new Ht(i.key,i.value,`object expected, ${Ii(i.value)} found`)]}const MS={"*"(){return[]},array:Vw,boolean:lF,number:yb,color:o1,constants:aP,enum:sy,filter:Uw,function:sP,layer:hP,object:vc,source:dP,light:fP,sky:pP,terrain:mP,projection:_F,projectionDefinition:yF,string:em,formatted:hF,resolvedImage:dF,padding:fF,numberArray:pF,colorArray:mF,variableAnchorOffsetCollection:gF,sprite:gP,state:_P};function L0(i){const e=i.value,t=i.valueSpec,a=i.styleSpec;return i.validateSpec=L0,t.expression&&Bw(Wa(e))?sP(i):t.expression&&nP(Jp(e))?pg(i):t.type&&MS[t.type]?MS[t.type](i):vc(E0({},i,{valueSpec:t.type?a[t.type]:t}))}function yP(i){const e=i.value,t=i.key,a=em(i);return a.length||(e.indexOf("{fontstack}")===-1&&a.push(new Ht(t,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&a.push(new Ht(t,e,'"glyphs" url must include a "{range}" token'))),a}function Fu(i,e=X6){let t=[];return t=t.concat(L0({key:"",value:i,valueSpec:e.$root,styleSpec:e,style:i,validateSpec:L0,objectElementValidators:{glyphs:yP,"*"(){return[]}}})),i.constants&&(t=t.concat(aP({key:"constants",value:i.constants}))),vP(t)}Fu.source=ch(uh(dP));Fu.sprite=ch(uh(gP));Fu.glyphs=ch(uh(yP));Fu.light=ch(uh(fP));Fu.sky=ch(uh(pP));Fu.terrain=ch(uh(mP));Fu.state=ch(uh(_P));Fu.layer=ch(uh(hP));Fu.filter=ch(uh(Uw));Fu.paintProperty=ch(uh(uP));Fu.layoutProperty=ch(uh(cP));function uh(i){return function(e){return i({...e,validateSpec:L0})}}function vP(i){return[].concat(i).sort((e,t)=>e.line-t.line)}function ch(i){return function(...e){return vP(i.apply(this,e))}}function RS(i){if(!i)return{style:F_[B_[0].referenceStyleID].getDefaultVariant().getExpandedStyleURL(),requiresUrlMonitoring:!1,isFallback:!0};if(typeof i=="string"){const e=TF(i);return e.isValidStyle?{style:e.styleObject,requiresUrlMonitoring:!1,isFallback:!1}:e.isValidJSON?{style:F_[B_[0].referenceStyleID].getDefaultVariant().getExpandedStyleURL(),requiresUrlMonitoring:!1,isFallback:!0}:i.startsWith("http")?{style:i,requiresUrlMonitoring:!0,isFallback:!1}:i.toLowerCase().includes(".json")?{style:wF(i),requiresUrlMonitoring:!0,isFallback:!1}:{style:_C(i),requiresUrlMonitoring:!0,isFallback:!1}}return i instanceof yC?{style:i.getExpandedStyleURL(),requiresUrlMonitoring:!1,isFallback:!1}:i instanceof vC?{style:i.getDefaultVariant().getExpandedStyleURL(),requiresUrlMonitoring:!1,isFallback:!1}:Fu(i).length===0?{style:i,requiresUrlMonitoring:!1,isFallback:!1}:{style:F_[B_[0].referenceStyleID].getDefaultVariant().getExpandedStyleURL(),requiresUrlMonitoring:!1,isFallback:!0}}function wF(i){try{return new URL(i).href}catch{}return new URL(i,location.origin).href}function TF(i){try{const e=JSON.parse(i),t=Fu(e);return{isValidJSON:!0,isValidStyle:t.length===0,styleObject:t.length===0?e:null}}catch{return{isValidJSON:!1,isValidStyle:!1,styleObject:null}}}function Od(i,e,t){const a=window.document.createElement(i);return e!==void 0&&(a.className=e),t&&t.appendChild(a),a}function oy(i){i.parentNode&&i.parentNode.removeChild(i)}class SF{constructor(){nn(this,"_map"),nn(this,"_container"),nn(this,"_terrainButton"),HN(["_toggleTerrain","_updateTerrainIcon"],this)}onAdd(e){return this._map=e,this._container=Od("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=Od("button","maplibregl-ctrl-terrain",this._container),Od("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){oy(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}_toggleTerrain(){bP(this._map),this._updateTerrainIcon()}_updateTerrainIcon(){this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.hasTerrain()?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))}}function bP(i){i.hasTerrain()?i.disableTerrain():i.enableTerrain()}class EF extends r6{constructor(e={}){super({showCompass:e.showCompass??!0,showZoom:e.showZoom??!0,visualizePitch:e.visualizePitch??!0}),nn(this,"_rotateCompassArrow",()=>{const t=this._map.getBearing(),a=this._map.getPitch(),h=this.options.visualizePitch?`scale(${Math.min(1.5,1/Math.cos(a*(Math.PI/180))**.5)}) rotateX(${Math.min(70,a)}deg) rotateZ(${-t}deg)`:`rotate(${-t}deg)`;this._compassIcon.style.transform=h}),this._compass&&(this._compass.removeEventListener("click",this._compass.clickFunction),this._compass.addEventListener("click",t=>{this._map.getPitch()===0?this._map.easeTo({pitch:Math.min(this._map.getMaxPitch(),80)}):this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})}))}_createButton(e,t){const a=super._createButton(e,t);return a.clickFunction=t,a}}const kS=Sn.Marker,LS=Sn.LngLat,AF=Sn.LngLatBounds;class IF extends a6{constructor(){super(...arguments),nn(this,"lastUpdatedCenter",new LS(0,0)),nn(this,"_updateCamera",e=>{var t;const a=new LS(e.coords.longitude,e.coords.latitude),h=e.coords.accuracy,m={bearing:this._map.getBearing(),...this.options.fitBoundsOptions,linear:!0},g=this._map.getZoom();g>(((t=this.options.fitBoundsOptions)==null?void 0:t.maxZoom)??30)&&(m.zoom=g),this._map.fitBounds(AF.fromLngLat(a,h),m,{geolocateSource:!0});let c=!1;const C=()=>{c=!0};this._map.once("click",C),this._map.once("dblclick",C),this._map.once("dragstart",C),this._map.once("mousedown",C),this._map.once("touchstart",C),this._map.once("wheel",C),this._map.once("moveend",()=>{this._map.off("click",C),this._map.off("dblclick",C),this._map.off("dragstart",C),this._map.off("mousedown",C),this._map.off("touchstart",C),this._map.off("wheel",C),!c&&(this.lastUpdatedCenter=this._map.getCenter())})}),nn(this,"_finishSetupUI",e=>{if(this._map){if(e===!1){const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Od("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new kS({element:this._dotElement}),this._circleElement=Od("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new kS({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("move",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("moveend",t=>{const a=t.originalEvent&&t.originalEvent.type==="resize",h=this.lastUpdatedCenter.distanceTo(this._map.getCenter());!t.geolocateSource&&this._watchState==="ACTIVE_LOCK"&&!a&&h>1&&(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new Event("trackuserlocationend")))})}}),nn(this,"_onZoom",()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()})}_updateCircleRadius(){if(this._watchState!=="BACKGROUND"&&this._watchState!=="ACTIVE_LOCK")return;const e=[this._lastKnownPosition.coords.longitude,this._lastKnownPosition.coords.latitude],t=this._map.project(e),a=this._map.unproject([t.x,t.y]),h=this._map.unproject([t.x+20,t.y]),m=a.distanceTo(h)/20,g=Math.ceil(2*this._accuracy/m);this._circleElement.style.width=`${g}px`,this._circleElement.style.height=`${g}px`}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;case"BACKGROUND_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}}var Rp,ku,kp,Lp,I_;class CF{constructor(e,t,a){if(lu(this,Rp),lu(this,ku),lu(this,kp),lu(this,Lp),lu(this,I_),typeof e=="string"){const h=document.querySelector(e);if(!h)throw new Error(`No element has been found with selector "${e}" when creating an external control.`);zu(this,ku,h)}else zu(this,ku,e);t&&zu(this,kp,h=>{t(An(this,Rp),An(this,ku),h)}),a&&zu(this,Lp,h=>{a(An(this,Rp),An(this,ku),h)}),zu(this,I_,An(this,ku).parentElement)}onAdd(e){return zu(this,Rp,e),An(this,kp)&&An(this,ku).addEventListener("click",An(this,kp)),An(this,Lp)&&An(this,Rp).on("render",An(this,Lp)),oy(An(this,ku)),An(this,ku)}onRemove(){An(this,kp)&&An(this,ku).removeEventListener("click",An(this,kp)),An(this,Lp)&&An(this,Rp).off("render",An(this,Lp)),An(this,I_)?An(this,I_).appendChild(An(this,ku)):oy(An(this,ku))}}Rp=new WeakMap,ku=new WeakMap,kp=new WeakMap,Lp=new WeakMap,I_=new WeakMap;class PF{constructor(){nn(this,"map"),nn(this,"container"),nn(this,"projectionButton")}onAdd(e){return this.map=e,this.container=Od("div","maplibregl-ctrl maplibregl-ctrl-group"),this.projectionButton=Od("button","maplibregl-ctrl-projection",this.container),Od("span","maplibregl-ctrl-icon",this.projectionButton).setAttribute("aria-hidden","true"),this.projectionButton.type="button",this.projectionButton.addEventListener("click",this.toggleProjection.bind(this)),e.on("projectiontransition",this.updateProjectionIcon.bind(this)),this.updateProjectionIcon(),this.container}onRemove(){oy(this.container),this.map.off("projectiontransition",this.updateProjectionIcon),this.map=void 0}toggleProjection(){xP(this.map),this.updateProjectionIcon()}updateProjectionIcon(){this.projectionButton.classList.remove("maplibregl-ctrl-projection-globe"),this.projectionButton.classList.remove("maplibregl-ctrl-projection-mercator"),this.map.isGlobeProjection()?(this.projectionButton.classList.add("maplibregl-ctrl-projection-mercator"),this.projectionButton.title="Enable Mercator projection"):(this.projectionButton.classList.add("maplibregl-ctrl-projection-globe"),this.projectionButton.title="Enable Globe projection")}}function xP(i){i.getProjection()===void 0&&i.setProjection({type:"mercator"}),i.isGlobeProjection()?i.enableMercatorProjection():i.enableGlobeProjection()}const C_={"zoom-in":i=>i.zoomIn(),"zoom-out":i=>i.zoomOut(),"toggle-projection":xP,"toggle-terrain":bP,"reset-view":i=>{i.getPitch()===0?i.easeTo({pitch:Math.min(i.getMaxPitch(),80)}):i.resetNorthPitch()},"reset-bearing":i=>{i.rotateTo(0)},"reset-pitch":i=>{i.setPitch(0)},"reset-roll":i=>{i.setRoll(0)}};var Yv,P_;class l1 extends CF{constructor(e,t){if(t&&!(t in C_))throw new Error(`data-maptiler-control value "${t}" is invalid.`);super(e,t&&C_[t]),lu(this,Yv),lu(this,P_,new Map)}onAdd(e){return zu(this,Yv,e),super.onAdd(e)}onRemove(){for(const[e,t]of An(this,P_)){const a=e.deref();a&&a.removeEventListener("click",t)}An(this,P_).clear(),super.onRemove()}configureGroupItem(e,t){if(!t)return;if(!(t in C_))throw new Error(`data-maptiler-control value "${t}" is invalid.`);const a=h=>{C_[t](An(this,Yv),e,h)};e.addEventListener("click",a),An(this,P_).set(new WeakRef(e),a)}}Yv=new WeakMap,P_=new WeakMap,nn(l1,"controlCallbacks",C_);var Du,Bh,Dp,zp,mc,Qv,Gl,wP,gc,TP;class dx{constructor(e,t){lu(this,Gl),lu(this,Du),nn(this,"map"),lu(this,Bh),lu(this,Dp),lu(this,zp),lu(this,mc,!1),lu(this,Qv),e.style!==void 0&&zu(this,mc,!0),zu(this,Du,{zoomAdjust:-4,position:"top-right",...t,forceNoAttributionControl:!0,attributionControl:!1,navigationControl:!1,geolocateControl:!1,maptilerLogo:!1,minimap:!1,hash:!1,pitchAdjust:!1,...e,containerStyle:{border:"1px solid #000",width:"400px",height:"300px",...e.containerStyle??{}}}),e.lockZoom!==void 0&&(An(this,Du).minZoom=e.lockZoom,An(this,Du).maxZoom=e.lockZoom)}setStyle(e,t){An(this,mc)||this.map.setStyle(e,t),Lu(this,Gl,gc).call(this)}addLayer(e,t){return An(this,mc)||this.map.addLayer(e,t),Lu(this,Gl,gc).call(this),this.map}moveLayer(e,t){return An(this,mc)||this.map.moveLayer(e,t),Lu(this,Gl,gc).call(this),this.map}removeLayer(e){return An(this,mc)||this.map.removeLayer(e),Lu(this,Gl,gc).call(this),this}setLayerZoomRange(e,t,a){return An(this,mc)||this.map.setLayerZoomRange(e,t,a),Lu(this,Gl,gc).call(this),this}setFilter(e,t,a){return An(this,mc)||this.map.setFilter(e,t,a),Lu(this,Gl,gc).call(this),this}setPaintProperty(e,t,a,h){return An(this,mc)||this.map.setPaintProperty(e,t,a,h),Lu(this,Gl,gc).call(this),this}setLayoutProperty(e,t,a,h){return An(this,mc)||this.map.setLayoutProperty(e,t,a,h),Lu(this,Gl,gc).call(this),this}setGlyphs(e,t){return An(this,mc)||this.map.setGlyphs(e,t),Lu(this,Gl,gc).call(this),this}onAdd(e){zu(this,Bh,e),zu(this,Dp,Od("div","maplibregl-ctrl maplibregl-ctrl-group"));for(const[t,a]of Object.entries(An(this,Du).containerStyle))An(this,Dp).style.setProperty(t,a);return An(this,Du).container=An(this,Dp),An(this,Du).zoom=e.getZoom()+An(this,Du).zoomAdjust,this.map=new IP(An(this,Du)),this.map.once("style.load",()=>{this.map.resize()}),this.map.once("load",()=>{Lu(this,Gl,wP).call(this,An(this,Du).parentRect),zu(this,Qv,Lu(this,Gl,TP).call(this))}),An(this,Dp)}onRemove(){var e;(e=An(this,Qv))==null||e.call(this),oy(An(this,Dp))}}Du=new WeakMap,Bh=new WeakMap,Dp=new WeakMap,zp=new WeakMap,mc=new WeakMap,Qv=new WeakMap,Gl=new WeakSet,wP=function(i){i===void 0||i.linePaint===void 0&&i.fillPaint===void 0||(zu(this,zp,{type:"Feature",properties:{name:"parentRect"},geometry:{type:"Polygon",coordinates:[[[],[],[],[],[]]]}}),this.map.addSource("parentRect",{type:"geojson",data:An(this,zp)}),(i.lineLayout!==void 0||i.linePaint!==void 0)&&this.map.addLayer({id:"parentRectOutline",type:"line",source:"parentRect",layout:{...i.lineLayout},paint:{"line-color":"#FFF","line-width":1,"line-opacity":.85,...i.linePaint}}),i.fillPaint!==void 0&&this.map.addLayer({id:"parentRectFill",type:"fill",source:"parentRect",layout:{},paint:{"fill-color":"#08F","fill-opacity":.135,...i.fillPaint}}),Lu(this,Gl,gc).call(this))},gc=function(){if(An(this,zp)===void 0)return;const{devicePixelRatio:i}=window,e=An(this,Bh).getCanvas(),t=e.width/i,a=e.height/i,h=An(this,Bh).unproject.bind(An(this,Bh)),m=h([0,0]),g=h([t,0]),c=h([0,a]),C=h([t,a]);An(this,zp).geometry.coordinates=[[c.toArray(),C.toArray(),g.toArray(),m.toArray(),c.toArray()]];const k=this.map.getSource("parentRect");k!==void 0&&k.setData(An(this,zp))},TP=function(){const{pitchAdjust:i}=An(this,Du),e=()=>{m("parent")},t=()=>{m("minimap")},a=()=>{An(this,Bh).on("move",e),this.map.on("move",t)},h=()=>{An(this,Bh).off("move",e),this.map.off("move",t)},m=g=>{h();const c=g==="parent"?An(this,Bh):this.map,C=g==="parent"?this.map:An(this,Bh),k=c.getCenter(),V=c.getZoom()+An(this,Du).zoomAdjust*(g==="parent"?1:-1),Z=c.getBearing(),Y=c.getPitch();C.jumpTo({center:k,zoom:V,bearing:Z,pitch:i?Y:0}),Lu(this,Gl,gc).call(this),a()};return a(),()=>{h()}};class MF{constructor(e,t=2e3){nn(this,"map"),nn(this,"registeredModules",new Set),nn(this,"viewerType"),this.map=e,this.viewerType="Map",setTimeout(async()=>{if(!Ha.telemetry)return;const a=this.preparePayload();try{(await fetch(a,{method:"POST"})).ok||console.warn("The metrics could not be sent to MapTiler Cloud")}catch(h){console.warn("The metrics could not be sent to MapTiler Cloud",h)}},Math.max(1e3,t))}registerModule(e,t){this.registeredModules.add(`${e}:${t}`)}registerViewerType(e="Map"){this.viewerType=e}preparePayload(){const e=new URL(Zl.telemetryURL);return e.searchParams.append("sdk",kV()),e.searchParams.append("key",Ha.apiKey),e.searchParams.append("mtsid",bw),e.searchParams.append("session",Ha.session?"1":"0"),e.searchParams.append("caching",Ha.caching?"1":"0"),e.searchParams.append("lang-updated",this.map.isLanguageUpdated()?"1":"0"),e.searchParams.append("terrain",this.map.getTerrain()?"1":"0"),e.searchParams.append("globe",this.map.isGlobeProjection()?"1":"0"),e.searchParams.append("viewerType",this.viewerType),this.registeredModules.size>0&&e.searchParams.append("modules",Array.from(this.registeredModules).join("|")),e.href}}var ly=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var i=0,e=arguments.length;e--;)i+=arguments[e]*arguments[e];return Math.sqrt(i)});function j_(){var i=new ly(16);return ly!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i}function RF(i,e,t,a,h,m,g,c,C,k,V,Z,Y,Q,be,xe,ze){return i[0]=e,i[1]=t,i[2]=a,i[3]=h,i[4]=m,i[5]=g,i[6]=c,i[7]=C,i[8]=k,i[9]=V,i[10]=Z,i[11]=Y,i[12]=Q,i[13]=be,i[14]=xe,i[15]=ze,i}function kF(i,e,t){var a=e[0],h=e[1],m=e[2],g=e[3],c=e[4],C=e[5],k=e[6],V=e[7],Z=e[8],Y=e[9],Q=e[10],be=e[11],xe=e[12],ze=e[13],et=e[14],Qe=e[15],Xe=t[0],Ke=t[1],Ve=t[2],it=t[3];return i[0]=Xe*a+Ke*c+Ve*Z+it*xe,i[1]=Xe*h+Ke*C+Ve*Y+it*ze,i[2]=Xe*m+Ke*k+Ve*Q+it*et,i[3]=Xe*g+Ke*V+Ve*be+it*Qe,Xe=t[4],Ke=t[5],Ve=t[6],it=t[7],i[4]=Xe*a+Ke*c+Ve*Z+it*xe,i[5]=Xe*h+Ke*C+Ve*Y+it*ze,i[6]=Xe*m+Ke*k+Ve*Q+it*et,i[7]=Xe*g+Ke*V+Ve*be+it*Qe,Xe=t[8],Ke=t[9],Ve=t[10],it=t[11],i[8]=Xe*a+Ke*c+Ve*Z+it*xe,i[9]=Xe*h+Ke*C+Ve*Y+it*ze,i[10]=Xe*m+Ke*k+Ve*Q+it*et,i[11]=Xe*g+Ke*V+Ve*be+it*Qe,Xe=t[12],Ke=t[13],Ve=t[14],it=t[15],i[12]=Xe*a+Ke*c+Ve*Z+it*xe,i[13]=Xe*h+Ke*C+Ve*Y+it*ze,i[14]=Xe*m+Ke*k+Ve*Q+it*et,i[15]=Xe*g+Ke*V+Ve*be+it*Qe,i}function LF(i,e,t){var a=t[0],h=t[1],m=t[2];return i[0]=e[0]*a,i[1]=e[1]*a,i[2]=e[2]*a,i[3]=e[3]*a,i[4]=e[4]*h,i[5]=e[5]*h,i[6]=e[6]*h,i[7]=e[7]*h,i[8]=e[8]*m,i[9]=e[9]*m,i[10]=e[10]*m,i[11]=e[11]*m,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i}function DS(i,e,t){var a=Math.sin(t),h=Math.cos(t),m=e[4],g=e[5],c=e[6],C=e[7],k=e[8],V=e[9],Z=e[10],Y=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=m*h+k*a,i[5]=g*h+V*a,i[6]=c*h+Z*a,i[7]=C*h+Y*a,i[8]=k*h-m*a,i[9]=V*h-g*a,i[10]=Z*h-c*a,i[11]=Y*h-C*a,i}function DF(i,e,t){var a=Math.sin(t),h=Math.cos(t),m=e[0],g=e[1],c=e[2],C=e[3],k=e[8],V=e[9],Z=e[10],Y=e[11];return e!==i&&(i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=m*h-k*a,i[1]=g*h-V*a,i[2]=c*h-Z*a,i[3]=C*h-Y*a,i[8]=m*a+k*h,i[9]=g*a+V*h,i[10]=c*a+Z*h,i[11]=C*a+Y*h,i}function zS(i,e,t){var a=Math.sin(t),h=Math.cos(t),m=e[0],g=e[1],c=e[2],C=e[3],k=e[4],V=e[5],Z=e[6],Y=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=m*h+k*a,i[1]=g*h+V*a,i[2]=c*h+Z*a,i[3]=C*h+Y*a,i[4]=k*h-m*a,i[5]=V*h-g*a,i[6]=Z*h-c*a,i[7]=Y*h-C*a,i}function zF(i,e,t,a,h){var m=1/Math.tan(e/2),g;return i[0]=m/t,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=m,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,h!=null&&h!==1/0?(g=1/(a-h),i[10]=(h+a)*g,i[14]=2*h*a*g):(i[10]=-1,i[14]=-2*a),i}var OF=zF;function Jv(){var i=new ly(3);return ly!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function NF(i,e,t){var a=new ly(3);return a[0]=i,a[1]=e,a[2]=t,a}function fx(i,e){var t=e[0],a=e[1],h=e[2],m=t*t+a*a+h*h;return m>0&&(m=1/Math.sqrt(m)),i[0]=e[0]*m,i[1]=e[1]*m,i[2]=e[2]*m,i}function OS(i,e,t){var a=e[0],h=e[1],m=e[2],g=t[0],c=t[1],C=t[2];return i[0]=h*C-m*c,i[1]=m*g-a*C,i[2]=a*c-h*g,i}(function(){var i=Jv();return function(e,t,a,h,m,g){var c,C;for(t||(t=3),a||(a=0),h?C=Math.min(h*t+a,e.length):C=e.length,c=a;c<C;c+=t)i[0]=e[c],i[1]=e[c+1],i[2]=e[c+2],m(i,i,g),e[c]=i[0],e[c+1]=i[1],e[c+2]=i[2];return e}})();function BF(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var NS,BS;function FF(){return BS||(BS=1,NS={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}),NS}var px,FS;function SP(){if(FS)return px;FS=1;const i=FF(),e={};for(const h of Object.keys(i))e[i[h]]=h;const t={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};px=t;for(const h of Object.keys(t)){if(!("channels"in t[h]))throw new Error("missing channels property: "+h);if(!("labels"in t[h]))throw new Error("missing channel labels property: "+h);if(t[h].labels.length!==t[h].channels)throw new Error("channel and label counts mismatch: "+h);const{channels:m,labels:g}=t[h];delete t[h].channels,delete t[h].labels,Object.defineProperty(t[h],"channels",{value:m}),Object.defineProperty(t[h],"labels",{value:g})}t.rgb.hsl=function(h){const m=h[0]/255,g=h[1]/255,c=h[2]/255,C=Math.min(m,g,c),k=Math.max(m,g,c),V=k-C;let Z,Y;k===C?Z=0:m===k?Z=(g-c)/V:g===k?Z=2+(c-m)/V:c===k&&(Z=4+(m-g)/V),Z=Math.min(Z*60,360),Z<0&&(Z+=360);const Q=(C+k)/2;return k===C?Y=0:Q<=.5?Y=V/(k+C):Y=V/(2-k-C),[Z,Y*100,Q*100]},t.rgb.hsv=function(h){let m,g,c,C,k;const V=h[0]/255,Z=h[1]/255,Y=h[2]/255,Q=Math.max(V,Z,Y),be=Q-Math.min(V,Z,Y),xe=function(ze){return(Q-ze)/6/be+1/2};return be===0?(C=0,k=0):(k=be/Q,m=xe(V),g=xe(Z),c=xe(Y),V===Q?C=c-g:Z===Q?C=1/3+m-c:Y===Q&&(C=2/3+g-m),C<0?C+=1:C>1&&(C-=1)),[C*360,k*100,Q*100]},t.rgb.hwb=function(h){const m=h[0],g=h[1];let c=h[2];const C=t.rgb.hsl(h)[0],k=1/255*Math.min(m,Math.min(g,c));return c=1-1/255*Math.max(m,Math.max(g,c)),[C,k*100,c*100]},t.rgb.cmyk=function(h){const m=h[0]/255,g=h[1]/255,c=h[2]/255,C=Math.min(1-m,1-g,1-c),k=(1-m-C)/(1-C)||0,V=(1-g-C)/(1-C)||0,Z=(1-c-C)/(1-C)||0;return[k*100,V*100,Z*100,C*100]};function a(h,m){return(h[0]-m[0])**2+(h[1]-m[1])**2+(h[2]-m[2])**2}return t.rgb.keyword=function(h){const m=e[h];if(m)return m;let g=1/0,c;for(const C of Object.keys(i)){const k=i[C],V=a(h,k);V<g&&(g=V,c=C)}return c},t.keyword.rgb=function(h){return i[h]},t.rgb.xyz=function(h){let m=h[0]/255,g=h[1]/255,c=h[2]/255;m=m>.04045?((m+.055)/1.055)**2.4:m/12.92,g=g>.04045?((g+.055)/1.055)**2.4:g/12.92,c=c>.04045?((c+.055)/1.055)**2.4:c/12.92;const C=m*.4124+g*.3576+c*.1805,k=m*.2126+g*.7152+c*.0722,V=m*.0193+g*.1192+c*.9505;return[C*100,k*100,V*100]},t.rgb.lab=function(h){const m=t.rgb.xyz(h);let g=m[0],c=m[1],C=m[2];g/=95.047,c/=100,C/=108.883,g=g>.008856?g**(1/3):7.787*g+16/116,c=c>.008856?c**(1/3):7.787*c+16/116,C=C>.008856?C**(1/3):7.787*C+16/116;const k=116*c-16,V=500*(g-c),Z=200*(c-C);return[k,V,Z]},t.hsl.rgb=function(h){const m=h[0]/360,g=h[1]/100,c=h[2]/100;let C,k,V;if(g===0)return V=c*255,[V,V,V];c<.5?C=c*(1+g):C=c+g-c*g;const Z=2*c-C,Y=[0,0,0];for(let Q=0;Q<3;Q++)k=m+1/3*-(Q-1),k<0&&k++,k>1&&k--,6*k<1?V=Z+(C-Z)*6*k:2*k<1?V=C:3*k<2?V=Z+(C-Z)*(2/3-k)*6:V=Z,Y[Q]=V*255;return Y},t.hsl.hsv=function(h){const m=h[0];let g=h[1]/100,c=h[2]/100,C=g;const k=Math.max(c,.01);c*=2,g*=c<=1?c:2-c,C*=k<=1?k:2-k;const V=(c+g)/2,Z=c===0?2*C/(k+C):2*g/(c+g);return[m,Z*100,V*100]},t.hsv.rgb=function(h){const m=h[0]/60,g=h[1]/100;let c=h[2]/100;const C=Math.floor(m)%6,k=m-Math.floor(m),V=255*c*(1-g),Z=255*c*(1-g*k),Y=255*c*(1-g*(1-k));switch(c*=255,C){case 0:return[c,Y,V];case 1:return[Z,c,V];case 2:return[V,c,Y];case 3:return[V,Z,c];case 4:return[Y,V,c];case 5:return[c,V,Z]}},t.hsv.hsl=function(h){const m=h[0],g=h[1]/100,c=h[2]/100,C=Math.max(c,.01);let k,V;V=(2-g)*c;const Z=(2-g)*C;return k=g*C,k/=Z<=1?Z:2-Z,k=k||0,V/=2,[m,k*100,V*100]},t.hwb.rgb=function(h){const m=h[0]/360;let g=h[1]/100,c=h[2]/100;const C=g+c;let k;C>1&&(g/=C,c/=C);const V=Math.floor(6*m),Z=1-c;k=6*m-V,V&1&&(k=1-k);const Y=g+k*(Z-g);let Q,be,xe;switch(V){default:case 6:case 0:Q=Z,be=Y,xe=g;break;case 1:Q=Y,be=Z,xe=g;break;case 2:Q=g,be=Z,xe=Y;break;case 3:Q=g,be=Y,xe=Z;break;case 4:Q=Y,be=g,xe=Z;break;case 5:Q=Z,be=g,xe=Y;break}return[Q*255,be*255,xe*255]},t.cmyk.rgb=function(h){const m=h[0]/100,g=h[1]/100,c=h[2]/100,C=h[3]/100,k=1-Math.min(1,m*(1-C)+C),V=1-Math.min(1,g*(1-C)+C),Z=1-Math.min(1,c*(1-C)+C);return[k*255,V*255,Z*255]},t.xyz.rgb=function(h){const m=h[0]/100,g=h[1]/100,c=h[2]/100;let C,k,V;return C=m*3.2406+g*-1.5372+c*-.4986,k=m*-.9689+g*1.8758+c*.0415,V=m*.0557+g*-.204+c*1.057,C=C>.0031308?1.055*C**(1/2.4)-.055:C*12.92,k=k>.0031308?1.055*k**(1/2.4)-.055:k*12.92,V=V>.0031308?1.055*V**(1/2.4)-.055:V*12.92,C=Math.min(Math.max(0,C),1),k=Math.min(Math.max(0,k),1),V=Math.min(Math.max(0,V),1),[C*255,k*255,V*255]},t.xyz.lab=function(h){let m=h[0],g=h[1],c=h[2];m/=95.047,g/=100,c/=108.883,m=m>.008856?m**(1/3):7.787*m+16/116,g=g>.008856?g**(1/3):7.787*g+16/116,c=c>.008856?c**(1/3):7.787*c+16/116;const C=116*g-16,k=500*(m-g),V=200*(g-c);return[C,k,V]},t.lab.xyz=function(h){const m=h[0],g=h[1],c=h[2];let C,k,V;k=(m+16)/116,C=g/500+k,V=k-c/200;const Z=k**3,Y=C**3,Q=V**3;return k=Z>.008856?Z:(k-16/116)/7.787,C=Y>.008856?Y:(C-16/116)/7.787,V=Q>.008856?Q:(V-16/116)/7.787,C*=95.047,k*=100,V*=108.883,[C,k,V]},t.lab.lch=function(h){const m=h[0],g=h[1],c=h[2];let C;C=Math.atan2(c,g)*360/2/Math.PI,C<0&&(C+=360);const k=Math.sqrt(g*g+c*c);return[m,k,C]},t.lch.lab=function(h){const m=h[0],g=h[1],c=h[2]/360*2*Math.PI,C=g*Math.cos(c),k=g*Math.sin(c);return[m,C,k]},t.rgb.ansi16=function(h,m=null){const[g,c,C]=h;let k=m===null?t.rgb.hsv(h)[2]:m;if(k=Math.round(k/50),k===0)return 30;let V=30+(Math.round(C/255)<<2|Math.round(c/255)<<1|Math.round(g/255));return k===2&&(V+=60),V},t.hsv.ansi16=function(h){return t.rgb.ansi16(t.hsv.rgb(h),h[2])},t.rgb.ansi256=function(h){const m=h[0],g=h[1],c=h[2];return m===g&&g===c?m<8?16:m>248?231:Math.round((m-8)/247*24)+232:16+36*Math.round(m/255*5)+6*Math.round(g/255*5)+Math.round(c/255*5)},t.ansi16.rgb=function(h){let m=h%10;if(m===0||m===7)return h>50&&(m+=3.5),m=m/10.5*255,[m,m,m];const g=(~~(h>50)+1)*.5,c=(m&1)*g*255,C=(m>>1&1)*g*255,k=(m>>2&1)*g*255;return[c,C,k]},t.ansi256.rgb=function(h){if(h>=232){const k=(h-232)*10+8;return[k,k,k]}h-=16;let m;const g=Math.floor(h/36)/5*255,c=Math.floor((m=h%36)/6)/5*255,C=m%6/5*255;return[g,c,C]},t.rgb.hex=function(h){const m=(((Math.round(h[0])&255)<<16)+((Math.round(h[1])&255)<<8)+(Math.round(h[2])&255)).toString(16).toUpperCase();return"000000".substring(m.length)+m},t.hex.rgb=function(h){const m=h.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!m)return[0,0,0];let g=m[0];m[0].length===3&&(g=g.split("").map(Z=>Z+Z).join(""));const c=parseInt(g,16),C=c>>16&255,k=c>>8&255,V=c&255;return[C,k,V]},t.rgb.hcg=function(h){const m=h[0]/255,g=h[1]/255,c=h[2]/255,C=Math.max(Math.max(m,g),c),k=Math.min(Math.min(m,g),c),V=C-k;let Z,Y;return V<1?Z=k/(1-V):Z=0,V<=0?Y=0:C===m?Y=(g-c)/V%6:C===g?Y=2+(c-m)/V:Y=4+(m-g)/V,Y/=6,Y%=1,[Y*360,V*100,Z*100]},t.hsl.hcg=function(h){const m=h[1]/100,g=h[2]/100,c=g<.5?2*m*g:2*m*(1-g);let C=0;return c<1&&(C=(g-.5*c)/(1-c)),[h[0],c*100,C*100]},t.hsv.hcg=function(h){const m=h[1]/100,g=h[2]/100,c=m*g;let C=0;return c<1&&(C=(g-c)/(1-c)),[h[0],c*100,C*100]},t.hcg.rgb=function(h){const m=h[0]/360,g=h[1]/100,c=h[2]/100;if(g===0)return[c*255,c*255,c*255];const C=[0,0,0],k=m%1*6,V=k%1,Z=1-V;let Y=0;switch(Math.floor(k)){case 0:C[0]=1,C[1]=V,C[2]=0;break;case 1:C[0]=Z,C[1]=1,C[2]=0;break;case 2:C[0]=0,C[1]=1,C[2]=V;break;case 3:C[0]=0,C[1]=Z,C[2]=1;break;case 4:C[0]=V,C[1]=0,C[2]=1;break;default:C[0]=1,C[1]=0,C[2]=Z}return Y=(1-g)*c,[(g*C[0]+Y)*255,(g*C[1]+Y)*255,(g*C[2]+Y)*255]},t.hcg.hsv=function(h){const m=h[1]/100,g=h[2]/100,c=m+g*(1-m);let C=0;return c>0&&(C=m/c),[h[0],C*100,c*100]},t.hcg.hsl=function(h){const m=h[1]/100,g=h[2]/100*(1-m)+.5*m;let c=0;return g>0&&g<.5?c=m/(2*g):g>=.5&&g<1&&(c=m/(2*(1-g))),[h[0],c*100,g*100]},t.hcg.hwb=function(h){const m=h[1]/100,g=h[2]/100,c=m+g*(1-m);return[h[0],(c-m)*100,(1-c)*100]},t.hwb.hcg=function(h){const m=h[1]/100,g=1-h[2]/100,c=g-m;let C=0;return c<1&&(C=(g-c)/(1-c)),[h[0],c*100,C*100]},t.apple.rgb=function(h){return[h[0]/65535*255,h[1]/65535*255,h[2]/65535*255]},t.rgb.apple=function(h){return[h[0]/255*65535,h[1]/255*65535,h[2]/255*65535]},t.gray.rgb=function(h){return[h[0]/100*255,h[0]/100*255,h[0]/100*255]},t.gray.hsl=function(h){return[0,0,h[0]]},t.gray.hsv=t.gray.hsl,t.gray.hwb=function(h){return[0,100,h[0]]},t.gray.cmyk=function(h){return[0,0,0,h[0]]},t.gray.lab=function(h){return[h[0],0,0]},t.gray.hex=function(h){const m=Math.round(h[0]/100*255)&255,g=((m<<16)+(m<<8)+m).toString(16).toUpperCase();return"000000".substring(g.length)+g},t.rgb.gray=function(h){return[(h[0]+h[1]+h[2])/3/255*100]},px}var mx,VS;function VF(){if(VS)return mx;VS=1;const i=SP();function e(){const m={},g=Object.keys(i);for(let c=g.length,C=0;C<c;C++)m[g[C]]={distance:-1,parent:null};return m}function t(m){const g=e(),c=[m];for(g[m].distance=0;c.length;){const C=c.pop(),k=Object.keys(i[C]);for(let V=k.length,Z=0;Z<V;Z++){const Y=k[Z],Q=g[Y];Q.distance===-1&&(Q.distance=g[C].distance+1,Q.parent=C,c.unshift(Y))}}return g}function a(m,g){return function(c){return g(m(c))}}function h(m,g){const c=[g[m].parent,m];let C=i[g[m].parent][m],k=g[m].parent;for(;g[k].parent;)c.unshift(g[k].parent),C=a(i[g[k].parent][k],C),k=g[k].parent;return C.conversion=c,C}return mx=function(m){const g=t(m),c={},C=Object.keys(g);for(let k=C.length,V=0;V<k;V++){const Z=C[V];g[Z].parent!==null&&(c[Z]=h(Z,g))}return c},mx}var gx,US;function UF(){if(US)return gx;US=1;const i=SP(),e=VF(),t={},a=Object.keys(i);function h(g){const c=function(...C){const k=C[0];return k==null?k:(k.length>1&&(C=k),g(C))};return"conversion"in g&&(c.conversion=g.conversion),c}function m(g){const c=function(...C){const k=C[0];if(k==null)return k;k.length>1&&(C=k);const V=g(C);if(typeof V=="object")for(let Z=V.length,Y=0;Y<Z;Y++)V[Y]=Math.round(V[Y]);return V};return"conversion"in g&&(c.conversion=g.conversion),c}return a.forEach(g=>{t[g]={},Object.defineProperty(t[g],"channels",{value:i[g].channels}),Object.defineProperty(t[g],"labels",{value:i[g].labels});const c=e(g);Object.keys(c).forEach(C=>{const k=c[C];t[g][C]=m(k),t[g][C].raw=h(k)})}),gx=t,gx}var jF=UF();const qF=BF(jF);function jS({gl:i,type:e,source:t}){const a=i.createShader(e);if(a===null)throw new Error("Cannot create shader");if(i.shaderSource(a,t),i.compileShader(a),!i.getShaderParameter(a,i.COMPILE_STATUS))throw console.error("Shader compilation error:",i.getShaderInfoLog(a)),i.deleteShader(a),new Error("Cannot compile shader");return a}function $F({gl:i,vertexShaderSource:e,fragmentShaderSource:t}){const a=jS({gl:i,type:i.VERTEX_SHADER,source:e}),h=jS({gl:i,type:i.FRAGMENT_SHADER,source:t}),m=i.createProgram();if(i.attachShader(m,a),i.attachShader(m,h),i.linkProgram(m),!i.getProgramParameter(m,i.LINK_STATUS))throw console.error("Error: ",i.getProgramInfoLog(m)),new Error("Cannot link shader program");return m}function GF(i,e,t){const a=i.getUniformLocation(e,t);if(a===null)throw new Error(`Cannot get uniform location for ${t}`);return a}function EP({gl:i,vertexShaderSource:e,fragmentShaderSource:t,attributesKeys:a,uniformsKeys:h,vertices:m,indices:g}){const c=$F({gl:i,vertexShaderSource:e,fragmentShaderSource:t}),C=a.reduce((Q,be)=>(Q[be]=i.getAttribLocation(c,`a_${be}`),Q),{}),k=h.reduce((Q,be)=>(Q[be]=GF(i,c,`u_${be}`),Q),{}),V=i.createBuffer();i.bindBuffer(i.ARRAY_BUFFER,V),i.bufferData(i.ARRAY_BUFFER,new Float32Array(m),i.STATIC_DRAW);let Z,Y;return g!==void 0&&(Z=i.createBuffer(),Y=g.length,i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,Z),i.bufferData(i.ELEMENT_ARRAY_BUFFER,new Uint16Array(g),i.STATIC_DRAW)),{shaderProgram:c,programInfo:{attributesLocations:C,uniformsLocations:k},positionBuffer:V,indexBuffer:Z,indexBufferLength:Y}}function e0(i){if(!i)return[1,1,1,0];if(i==="transparent")return[1,1,1,0];try{const e=ZF(i),t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})?$/i.exec(e);if(t!=null&&t.length){const h=!!t[4];return[...qF.hex.rgb(e).map(m=>m/255),h?parseInt(t[4],16)/255:1]}const a=e.match(/(\d\.\d(\d+)?|\d{3}|\d{2}|\d{1})/gi)??["0","0","0"];if(e.includes("rgb")){const h=e.includes("rgba"),m=[...a.map(g=>parseFloat(g)).map((g,c)=>c<3?g/255:g)];return h||m.push(1),m}}catch{}return console.warn([`[parseColorStringToVec4]: Color ${i} is either not a valid color or its type is not supported, defaulting to black`]),[0,0,0,1]}let b_;function ZF(i){return b_=b_??document.createElement("canvas").getContext("2d"),b_?(b_.fillStyle=i,b_.fillStyle):"#000000"}const jw=1,bc=jw/2,xc=jw/2,wc=jw/2,HF=[-.5,-.5,wc,bc,-.5,wc,bc,xc,wc,-.5,xc,wc],WF=[-.5,-.5,-.5,-.5,xc,-.5,bc,xc,-.5,bc,-.5,-.5],XF=[-.5,xc,-.5,-.5,xc,wc,bc,xc,wc,bc,xc,-.5],KF=[-.5,-.5,-.5,bc,-.5,-.5,bc,-.5,wc,-.5,-.5,wc],YF=[bc,-.5,-.5,bc,xc,-.5,bc,xc,wc,bc,-.5,wc],QF=[-.5,-.5,-.5,-.5,-.5,wc,-.5,xc,wc,-.5,xc,-.5],JF=[...HF,...WF,...XF,...KF,...YF,...QF],eV=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23],tV=`attribute vec3 a_vertexPosition;
varying vec3 vTextureCoord;

uniform mat4 u_projectionMatrix;
uniform mat4 u_modelViewMatrix;
  
void main(void) {
  vTextureCoord = vec3(-a_vertexPosition.x, a_vertexPosition.y, a_vertexPosition.z);
  gl_Position = u_projectionMatrix * u_modelViewMatrix * vec4(a_vertexPosition, 1.0);
}
`,qS=`precision mediump float;

varying vec3 vTextureCoord;

%USE_TEXTURE_MACRO_MARKER%

# ifdef USE_TEXTURE
uniform samplerCube u_cubeSampler;
uniform float u_fadeOpacity;
# endif

uniform vec4 u_bgColor;

void main(void) {
  #ifdef USE_TEXTURE
  vec4 texColor = textureCube(u_cubeSampler, vTextureCoord);

    gl_FragColor = mix(
      u_bgColor,
      texColor,
      min(texColor.a, u_fadeOpacity)
    );

    gl_FragColor.a = max(gl_FragColor.a, u_fadeOpacity);

  #else
  gl_FragColor = u_bgColor;
  #endif
}
`,Zp={stars:{color:"hsl(233,100%,92%)",preset:"stars"},space:{color:"hsl(210, 100%, 4%)",preset:"space"},milkyway:{color:"hsl(233,100%,92%)",preset:"milkyway"},"milkyway-subtle":{color:"hsl(233,100%,92%)",preset:"milkyway-subtle"},"milkyway-bright":{color:"hsl(233,100%,92%)",preset:"milkyway-bright"},"milkyway-colored":{color:"black",preset:"milkyway-colored"}};var Op=(i=>(i.POSITIVE_X="pX",i.NEGATIVE_X="nX",i.POSITIVE_Y="pY",i.NEGATIVE_Y="nY",i.POSITIVE_Z="pZ",i.NEGATIVE_Z="nZ",i))(Op||{});let Dv,$S,GS;function nV({gl:i,faces:e,onReady:t,forceRefresh:a}){Dv&&!a&&GS===JSON.stringify(e)&&t(Dv,$S),GS=JSON.stringify(e);const h=Dv??i.createTexture();if(i.bindTexture(i.TEXTURE_CUBE_MAP,h),!e){console.warn("[CubemapLayer][loadCubemapTexture]: Faces are null");return}const m=Object.keys(e).length;if(m!==6){console.warn(`[CubemapLayer][loadCubemapTexture]: Faces should contain exactly 6 images, but found ${m}`);return}const g=Object.entries(e).map(([c,C])=>new Promise((k,V)=>{const Z=c;if(C===void 0){V(new Error(`[CubemapLayer][loadCubemapTexture]: Face ${c} is undefined`));return}const Y=new Image;Y.crossOrigin="anonymous";const Q=()=>{k({image:Y,key:Z})};Y.src=C,Y.complete&&Y.naturalWidth>0?Q():Y.onload=Q,Y.onerror=()=>{V(new Error(`[CubemapLayer][loadCubemapTexture]: Error loading image ${C}`))}}));Promise.all(g).then(c=>{for(let k=0;k<c.length;k++){const V=i.RGBA,Z=i.RGBA,Y=i.UNSIGNED_BYTE,{image:Q,key:be}=c[k]??{};if(!Q||!be){console.warn("[CubemapLayer][loadCubemapTexture]: Image or key is null");continue}const xe=iV(i,be);i.bindTexture(i.TEXTURE_CUBE_MAP,h),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texImage2D(xe,0,V,Z,Y,Q)}i.bindTexture(i.TEXTURE_CUBE_MAP,h),i.generateMipmap(i.TEXTURE_CUBE_MAP),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_MIN_FILTER,i.LINEAR_MIPMAP_LINEAR),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_MAG_FILTER,i.LINEAR);const C=c.map(k=>k.image);t(h,C),$S=C,Dv=h}).catch(c=>{console.error("[CubemapLayer][loadCubemapTexture]: Error loading cubemap texture",c)})}function iV(i,e){if(e===Op.POSITIVE_X)return i.TEXTURE_CUBE_MAP_POSITIVE_X;if(e===Op.NEGATIVE_X)return i.TEXTURE_CUBE_MAP_NEGATIVE_X;if(e===Op.POSITIVE_Y)return i.TEXTURE_CUBE_MAP_POSITIVE_Y;if(e===Op.NEGATIVE_Y)return i.TEXTURE_CUBE_MAP_NEGATIVE_Y;if(e===Op.POSITIVE_Z)return i.TEXTURE_CUBE_MAP_POSITIVE_Z;if(e===Op.NEGATIVE_Z)return i.TEXTURE_CUBE_MAP_NEGATIVE_Z;throw new Error(`[CubemapLayer][loadCubemapTexture]: Invalid key ${e}`)}function rV(i,e,t){return[Rf(i[0],e[0],t),Rf(i[1],e[1],t),Rf(i[2],e[2],t),Rf(i[3],e[3],t)]}function Rf(i,e,t){return i+(e-i)*t}const qm="https://api.maptiler.com/resources/space",aV=["vertexPosition"],sV=["projectionMatrix","modelViewMatrix","cubeSampler","bgColor","fadeOpacity"],ZS="%USE_TEXTURE_MACRO_MARKER%",oV="#define USE_TEXTURE",HS=Zp.stars;function lV(i,e){if(!AP(i))return{color:"transparent"};if(i===!0)return e;const t={...i};if(i.faces||i.path)return delete t.preset,t;const a=i.preset;if(a!==void 0&&!(a in Zp))throw new Error(`[CubemapLayer]: Invalid preset "${a}". Available presets: ${Object.keys(Zp).join(", ")}`);return{...t,color:t.color??Zp[a].color??"hsl(233,100%,92%)"}}class _x{constructor(e){nn(this,"id","Cubemap Layer"),nn(this,"type","custom"),nn(this,"renderingMode","3d"),nn(this,"map"),nn(this,"faces"),nn(this,"useCubemapTexture",!0),nn(this,"currentFadeOpacity",0),nn(this,"cubeMapNeedsUpdate",!1),nn(this,"bgColor"),nn(this,"previousBgColor",[0,0,0,0]),nn(this,"targetBgColor",[0,0,0,0]),nn(this,"transitionDelta",0),nn(this,"gl"),nn(this,"cubemap"),nn(this,"texture"),nn(this,"currentFacesDefinitionKey",""),nn(this,"options"),nn(this,"animationActive",!0),nn(this,"imageIsAnimating",!1),nn(this,"imageFadeInDelta",0);const t=lV(e,HS);this.options=t,this.currentFacesDefinitionKey=JSON.stringify(t.faces??t.preset??t.path),this.bgColor=[0,0,0,0],this.targetBgColor=e0(t.color),this.faces=WS(t),this.useCubemapTexture=this.faces!==null}updateCubemap({facesNeedUpdate:e}={facesNeedUpdate:!0}){this.useCubemapTexture=this.faces!==null;const t=sV.filter(a=>a==="cubeSampler"||a==="fadeOpacity"?this.useCubemapTexture:!0);this.cubemap=EP({gl:this.gl,vertexShaderSource:tV,fragmentShaderSource:this.useCubemapTexture?qS.replace(ZS,oV):qS.replace(ZS,""),attributesKeys:aV,uniformsKeys:t,vertices:JF,indices:eV}),this.cubeMapNeedsUpdate=e,this.useCubemapTexture&&this.updateTexture(this.gl,this.faces),this.animateColorChange()}onAdd(e,t){this.map=e,this.gl=t,this.updateCubemap()}onRemove(e,t){this.cubemap&&(t.deleteProgram(this.cubemap.shaderProgram),t.deleteBuffer(this.cubemap.positionBuffer))}updateTexture(e,t){if(this.cubeMapNeedsUpdate===!0&&!this.imageIsAnimating){if(this.cubeMapNeedsUpdate=!1,!this.useCubemapTexture)return;nV({gl:e,faces:t,onReady:a=>{this.texture=a,this.animateIn()}})}}prerender(e,t){this.faces&&this.updateTexture(this.gl,this.faces)}animateColorChange(){const e=()=>{this.transitionDelta<1&&(requestAnimationFrame(e),this.bgColor=rV(this.previousBgColor,this.targetBgColor,this.transitionDelta),this.transitionDelta+=.075,this.map.triggerRepaint())};requestAnimationFrame(e)}async animateIn(){if(!this.imageIsAnimating){if(!this.animationActive){this.currentFadeOpacity=1,this.imageFadeInDelta=1,this.map.triggerRepaint();return}return new Promise(e=>{this.imageIsAnimating=!0;const t=()=>{if(this.imageFadeInDelta=Math.min(this.imageFadeInDelta+.05,1),this.currentFadeOpacity=Rf(0,1,this.imageFadeInDelta),this.map.triggerRepaint(),this.imageFadeInDelta<1){requestAnimationFrame(t);return}this.imageIsAnimating=!1,this.imageFadeInDelta=0,e()};requestAnimationFrame(t)})}}async animateOut(){if(!(this.imageIsAnimating||!this.animationActive))return new Promise(e=>{const t=()=>{if(this.imageFadeInDelta=Math.min(this.imageFadeInDelta+.05,1),this.currentFadeOpacity=Rf(1,0,this.imageFadeInDelta),this.map.triggerRepaint(),this.imageFadeInDelta>=1){this.imageIsAnimating=!1,this.imageFadeInDelta=0,e();return}requestAnimationFrame(t)};requestAnimationFrame(t)})}setAnimationActive(e){this.animationActive=e}render(e,t){if(!this.map.isGlobeProjection())return;if(this.map===void 0)throw new Error("[CubemapLayer]: Map is undefined");if(this.cubemap===void 0)throw new Error("[CubemapLayer]: Cubemap is undefined");this.texture,e.disable(e.DEPTH_TEST),e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.DST_ALPHA),e.useProgram(this.cubemap.shaderProgram),e.bindBuffer(e.ARRAY_BUFFER,this.cubemap.positionBuffer),e.vertexAttribPointer(this.cubemap.programInfo.attributesLocations.vertexPosition,3,e.FLOAT,!1,0,0),e.enableVertexAttribArray(this.cubemap.programInfo.attributesLocations.vertexPosition);const a=.1,h=1e4,m=e.canvas,g=m.clientWidth/m.clientHeight,c=this.map.transform,C=c.fov*(Math.PI/180),k=j_();OF(k,C,g,a,h),zS(k,k,c.rollInRadians),DS(k,k,-c.pitchInRadians),zS(k,k,c.bearingInRadians);const V=c.center.lat*Math.PI/180,Z=c.center.lng*Math.PI/180;DS(k,k,V),DF(k,k,-Z),e.uniformMatrix4fv(this.cubemap.programInfo.uniformsLocations.projectionMatrix,!1,k);const Y=j_();if(e.uniformMatrix4fv(this.cubemap.programInfo.uniformsLocations.modelViewMatrix,!1,Y),e.uniform4fv(this.cubemap.programInfo.uniformsLocations.bgColor,new Float32Array(this.bgColor)),e.uniform1f(this.cubemap.programInfo.uniformsLocations.fadeOpacity,this.currentFadeOpacity),this.useCubemapTexture&&this.texture&&(e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_CUBE_MAP,this.texture),e.uniform1i(this.cubemap.programInfo.uniformsLocations.cubeSampler,0)),this.cubemap.indexBuffer===void 0)throw new Error("Index buffer is undefined");if(this.cubemap.indexBufferLength===void 0)throw new Error("Index buffer length is undefined");e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.cubemap.indexBuffer),e.drawElements(e.TRIANGLES,this.cubemap.indexBufferLength,e.UNSIGNED_SHORT,0)}setBgColor(e){this.targetBgColor=e,this.previousBgColor=this.bgColor,this.transitionDelta=0}getConfig(){return this.options}async setCubemapFaces(e){if(await this.animateOut(),!e.faces&&!e.preset&&!e.path){this.faces=null,this.useCubemapTexture=!1,this.currentFacesDefinitionKey="empty",await this.animateIn();return}this.faces=WS(e),this.currentFacesDefinitionKey=JSON.stringify(e.faces??e.preset??e.path)}async setCubemap(e){const t=typeof e=="boolean"?HS:e;this.options=t;const a=JSON.stringify(t.faces??t.preset??t.path),h=this.currentFacesDefinitionKey!==a;h&&(await this.setCubemapFaces(t),this.cubeMapNeedsUpdate=!0);const m=e0(t.color);if(t.color&&this.targetBgColor.toString()!==m.toString())this.setBgColor(m);else if(!t.color&&t.preset&&t.preset in Zp){const g=Zp[t.preset];this.setBgColor(e0(g.color))}this.updateCubemap({facesNeedUpdate:h})}show(){this.map.setLayoutProperty(this.id,"visibility","visible")}hide(){this.map.setLayoutProperty(this.id,"visibility","none")}}function AP(i){return i?typeof i=="boolean"?!0:!(!i.path&&!i.preset&&!i.faces&&!i.color||i.preset&&!(i.preset in Zp)||i.faces&&(!i.faces.pX||!i.faces.nX||!i.faces.pY||!i.faces.nY||!i.faces.pZ||!i.faces.nZ)):!1}function WS(i){if(i.faces)return i.faces;if(i.preset)return{pX:`${qm}/${i.preset}/px.webp`,nX:`${qm}/${i.preset}/nx.webp`,pY:`${qm}/${i.preset}/py.webp`,nY:`${qm}/${i.preset}/ny.webp`,pZ:`${qm}/${i.preset}/pz.webp`,nZ:`${qm}/${i.preset}/nz.webp`};if(i.path){const e=i.path.baseUrl,t=i.path.format??"png";return{pX:`${e}/px.${t}`,nX:`${e}/nx.${t}`,pY:`${e}/py.${t}`,nY:`${e}/ny.${t}`,pZ:`${e}/pz.${t}`,nZ:`${e}/nz.${t}`}}return null}const uV=`attribute vec3 a_position;

uniform mat4 u_matrix;
uniform mat4 u_rotationMatrix;

uniform float u_scale;

varying vec2 v_pos;
varying float v_scale;

void main() {
  v_scale = u_scale;
  v_pos = a_position.xy * u_scale;
  gl_Position = u_matrix * u_rotationMatrix * vec4(a_position, 1.0);
}
`,cV=`precision mediump float;
varying vec2 v_pos;
      
uniform int u_stopsNumber;
uniform float u_stops[100];
uniform vec4 u_colors[100];
uniform float u_maxDistance;

varying float v_scale;

const float EPSILON = 0.000001;

vec2 center = vec2(0.0, 0.0);
void main() {
  float rawDistance = distance(center, v_pos);
  float distanceFromGlobeEdge = rawDistance - 1.0;

    vec4 color = u_colors[0];

  // if we're further than the max distance, we should not render anything.
  // This is to always render a circle, otherwise we end up rendering
  // to the corners of the plane.
  if (distance(center, v_pos) > u_maxDistance * v_scale) {
    discard;
  }

  for (int i = 1; i < 100; i++) {
    // if we're past the last stop
    // we should fill to the end with the last stop color
    if (i >= u_stopsNumber) {
      color = u_colors[i - 1];
      break;
    }

    float scaledStopPosition = u_stops[i] * pow(v_scale, 1.6);
    float lastStopValue = u_stops[i - 1];
    float thisStopValue = u_stops[i];

    // this is to avoid blending errors when the stops are the same
    // eg when you would want a sharp edge between two stops.
    // \`numbersAreEqual\` will be 1.0 if the numbers are equal, 0.0 if they are not.
    // We then subtract EPSILON from the last stop making the stop value _almost_ equal
    // to the next stop but not enough to cause blending issues.
    // It's more efficient to do this than an if / else statement.
    float numbersAreEqual = 1.0 - step(EPSILON, abs(lastStopValue - thisStopValue));
    lastStopValue = lastStopValue - numbersAreEqual * EPSILON;

    float lastScaledStopPosition = lastStopValue * pow(v_scale, 1.6);

    if (distanceFromGlobeEdge <= scaledStopPosition) {
      float stopBlendFactor = (distanceFromGlobeEdge - lastScaledStopPosition) / (scaledStopPosition - lastScaledStopPosition);
      color = mix(u_colors[i - 1], u_colors[i], stopBlendFactor);
      break;
    }
  }
  
  // gl_FragColor = color;
  gl_FragColor = vec4(color.rgb * color.a, color.a);
}
`,M_=2,hV=["position"],dV=["matrix","rotationMatrix","stopsNumber","stops","colors","maxDistance","scale"],fV=[-2,-2,0,M_,-2,0,-2,M_,0,M_,M_,0],Cp={scale:.9,stops:[[0,"rgba(176, 208, 240, 1)"],[.1,"rgba(98, 168, 229, 0.3)"],[.2,"rgba(98, 168, 229, 0.0)"]]},XS=.06;class yx{constructor(e){if(nn(this,"id","Halo Layer"),nn(this,"type","custom"),nn(this,"renderingMode","3d"),nn(this,"gradient"),nn(this,"scale",0),nn(this,"animationDelta",0),nn(this,"map"),nn(this,"plane"),nn(this,"animationActive",!0),typeof e=="boolean"){this.gradient=Cp;return}this.gradient={...Cp,...e}}onAdd(e,t){this.map=e,this.plane=EP({gl:t,vertexShaderSource:uV,fragmentShaderSource:cV,attributesKeys:hV,uniformsKeys:dV,vertices:fV}),this.animateIn()}getConfig(){return this.gradient}async animateIn(){if(!this.animationActive){this.scale=this.gradient.scale,this.animationDelta=1,this.map.triggerRepaint();return}return new Promise(e=>{this.animationDelta=0;const t=()=>{if(this.animationDelta<1){this.scale=Rf(0,this.gradient.scale,this.animationDelta),this.animationDelta+=XS,this.map.triggerRepaint(),requestAnimationFrame(t);return}e()};requestAnimationFrame(t)})}async animateOut(){if(this.animationActive)return this.animationDelta=0,new Promise(e=>{const t=()=>{if(this.animationDelta<1){this.scale=Rf(this.gradient.scale,0,this.animationDelta),this.animationDelta+=XS,this.map.triggerRepaint(),requestAnimationFrame(t);return}e()};t()})}onRemove(e,t){this.plane!==void 0&&(t.deleteProgram(this.plane.shaderProgram),t.deleteBuffer(this.plane.positionBuffer))}prerender(e,t){}render(e,t){if(this.map===void 0)throw new Error("[RadialGradientLayer]: Map is undefined");if(!this.map.isGlobeProjection())return;if(this.plane===void 0)throw new Error("[RadialGradientLayer]: Plane is undefined");e.disable(e.DEPTH_TEST),e.enable(e.BLEND),e.useProgram(this.plane.shaderProgram),e.bindBuffer(e.ARRAY_BUFFER,this.plane.positionBuffer);const a=this.plane.programInfo.attributesLocations.position;e.enableVertexAttribArray(a),e.vertexAttribPointer(a,3,e.FLOAT,!1,0,0);const h=j_(),m=this.scale;LF(h,h,[m,m,m]);const g=j_();kF(g,t.defaultProjectionData.mainMatrix,h);const c=this.plane.programInfo.uniformsLocations.matrix;e.uniformMatrix4fv(c,!1,g);const C=j_(),k=this.map.transform.cameraPosition,V=fx(Jv(),k),Z=NF(0,1,0),Y=Jv();OS(Y,Z,V),fx(Y,Y);const Q=Jv();OS(Q,V,Y),fx(Q,Q),RF(C,Y[0],Y[1],Y[2],0,Q[0],Q[1],Q[2],0,V[0],V[1],V[2],0,0,0,0,1);const be=this.plane.programInfo.uniformsLocations.rotationMatrix;e.uniformMatrix4fv(be,!1,C);const xe=this.gradient.stops.length,ze=[],et=[];for(let Qe=0;Qe<=xe;Qe++)if(Qe<xe){ze[Qe]=this.gradient.stops[Qe][0];const Xe=e0(this.gradient.stops[Qe][1]);et.push(...Xe)}e.uniform1i(this.plane.programInfo.uniformsLocations.stopsNumber,xe),e.uniform1fv(this.plane.programInfo.uniformsLocations.stops,new Float32Array(ze)),e.uniform4fv(this.plane.programInfo.uniformsLocations.colors,new Float32Array(et)),e.uniform1f(this.plane.programInfo.uniformsLocations.maxDistance,M_),e.uniform1f(this.plane.programInfo.uniformsLocations.scale,m),e.drawArrays(e.TRIANGLE_STRIP,0,4)}async setGradient(e){if(e===!1){await this.animateOut();return}if(await this.animateOut(),!pV(e)){this.gradient.scale=Cp.scale,this.gradient.stops=[[0,"transparent"],[1,"transparent"]];return}e===!0?(this.gradient.scale=Cp.scale,this.gradient.stops=Cp.stops):(this.gradient.scale=e.scale??Cp.scale,this.gradient.stops=e.stops??Cp.stops),await this.animateIn()}setAnimationActive(e){this.animationActive=e}show(){this.map.setLayoutProperty(this.id,"visibility","visible")}hide(){this.map.setLayoutProperty(this.id,"visibility","none")}}function pV(i){return typeof i=="boolean"?!0:!(typeof i.scale!="number"||!i.stops||i.stops.length===0||i.stops.some(e=>typeof e[0]!="number"||typeof e[1]!="string"))}const mV={POINT:"POINT",COUNTRY:"COUNTRY"};let IP=class CP extends Sn.Map{constructor(e){KN(e.container),e.apiKey&&(Ha.apiKey=e.apiKey);const{style:t,requiresUrlMonitoring:a,isFallback:h}=RS(e.style);h&&console.warn("Invalid style. A style must be a valid URL to a style.json, a JSON string representing a valid StyleSpecification or a valid StyleSpecification object. Fallback to default MapTiler style."),Ha.apiKey||console.warn("MapTiler Cloud API key is not set. Visit https://maptiler.com and try Cloud for free!");const m=location.hash;let g={compact:!1};e.customAttribution?g.customAttribution=e.customAttribution:e.attributionControl&&typeof e.attributionControl=="object"&&(g={...g,...e.attributionControl});const c={...e,style:t,maplibreLogo:!1,transformRequest:lS(e.transformRequest),attributionControl:e.forceNoAttributionControl===!0?!1:g};delete c.style,super(c),nn(this,"telemetry"),nn(this,"space"),nn(this,"halo"),nn(this,"options"),nn(this,"isTerrainEnabled",!1),nn(this,"terrainExaggeration",1),nn(this,"primaryLanguage"),nn(this,"terrainGrowing",!1),nn(this,"terrainFlattening",!1),nn(this,"minimap"),nn(this,"forceLanguageUpdate"),nn(this,"languageAlwaysBeenStyle"),nn(this,"isReady",!1),nn(this,"terrainAnimationDuration",1e3),nn(this,"monitoredStyleUrls"),nn(this,"styleInProcess",!1),nn(this,"curentProjection"),nn(this,"originalLabelStyle",new window.Map),nn(this,"isStyleLocalized",!1),nn(this,"languageIsUpdated",!1),nn(this,"spaceboxLoadingState",{styleLoadCallbackSet:!1}),this.options=e,this.setStyle(t),a&&this.monitorStyleUrl(t);const C=()=>{let Q="The distant style could not be loaded.";this.getStyle()?Q+="Leaving the style as is.":(this.setStyle(F_.STREETS),Q+=`Loading default MapTiler Cloud style "${F_.STREETS.getDefaultVariant().getId()}" as a fallback.`),console.warn(Q)};if(this.on("style.load",()=>{this.styleInProcess=!1}),this.on("error",Q=>{if(Q.error instanceof Sn.AJAXError){const be=Q.error.url,xe=new URL(be);xe.search="";const ze=xe.href;this.monitoredStyleUrls&&this.monitoredStyleUrls.has(ze)&&(this.monitoredStyleUrls.delete(ze),C());return}if(this.styleInProcess){C();return}}),Ha.caching&&!Jx&&console.warn("The cache API is only available in secure contexts. More info at https://developer.mozilla.org/en-US/docs/Web/API/Cache"),Ha.caching&&Jx&&GN(),typeof e.language>"u")this.primaryLanguage=Ha.primaryLanguage;else{const Q=WT(e.language,Wi);this.primaryLanguage=Q??Ha.primaryLanguage}this.forceLanguageUpdate=!(this.primaryLanguage===Wi.STYLE||this.primaryLanguage===Wi.STYLE_LOCK),this.languageAlwaysBeenStyle=this.primaryLanguage===Wi.STYLE,this.terrainExaggeration=e.terrainExaggeration??this.terrainExaggeration,this.curentProjection=e.projection,this.on("styledata",()=>{this.curentProjection==="mercator"?this.setProjection({type:"mercator"}):this.curentProjection==="globe"&&this.setProjection({type:"globe"})}),this.once("styledata",async()=>{if(!e.geolocate||e.center||e.hash&&m)return;try{if(e.geolocate===mV.COUNTRY){await this.fitToIpBounds();return}}catch(be){console.warn(be.message)}let Q;try{await this.centerOnIpPoint(e.zoom),Q=this.getCameraHash()}catch(be){console.warn(be.message)}(await navigator.permissions.query({name:"geolocation"})).state==="granted"&&navigator.geolocation.getCurrentPosition(be=>{Q===this.getCameraHash()&&(this.terrain?this.easeTo({center:[be.coords.longitude,be.coords.latitude],zoom:e.zoom||12,duration:2e3}):this.once("terrain",()=>{this.easeTo({center:[be.coords.longitude,be.coords.latitude],zoom:e.zoom||12,duration:2e3})}))},null,{maximumAge:24*3600*1e3,timeout:5e3,enableHighAccuracy:!1})}),this.on("styledata",()=>{this.setPrimaryLanguage(this.primaryLanguage)}),this.on("styledata",()=>{this.getTerrain()===null&&this.isTerrainEnabled&&this.enableTerrain(this.terrainExaggeration)}),this.once("load",async()=>{let Q={logo:null};try{const be=Object.keys(this.style.sourceCaches).map(ze=>this.getSource(ze)).filter(ze=>ze&&"url"in ze&&typeof ze.url=="string"&&ze.url.includes("tiles.json")),xe=new URL(be[0].url);xe.searchParams.has("key")||xe.searchParams.append("key",Ha.apiKey),Q=await(await fetch(xe.href)).json()}catch{}if(e.customControls){const be="[data-maptiler-control-group]",xe="[data-maptiler-control]",ze=Ve=>{let it=Ve.dataset.maptilerControl;return(it==="true"||it==="")&&(it=void 0),it},et=Ve=>Ve.dataset.maptilerPosition;let Qe=[...this._container.ownerDocument.querySelectorAll(be)],Xe=[...this._container.ownerDocument.querySelectorAll(xe)].filter(Ve=>Ve.closest(be)===null);if(typeof e.customControls=="string"){const Ve=e.customControls;Qe=Qe.filter(it=>it.matches(Ve)||it.closest(Ve)!==null),Xe=Xe.filter(it=>it.matches(Ve)||it.closest(Ve)!==null)}for(const Ve of Qe){const it=new l1(Ve);this.addControl(it,et(Ve));for(const de of Ve.querySelectorAll(xe))it.configureGroupItem(de,ze(de))}for(const Ve of Xe)this.addControl(new l1(Ve,ze(Ve)),et(Ve));const Ke=()=>{const{lng:Ve,lat:it}=this.getCenter();this._container.style.setProperty("--maptiler-center-lng",String(Ve)),this._container.style.setProperty("--maptiler-center-lat",String(it)),this._container.style.setProperty("--maptiler-zoom",String(this.getZoom())),this._container.style.setProperty("--maptiler-bearing",String(this.getBearing())),this._container.style.setProperty("--maptiler-pitch",String(this.getPitch())),this._container.style.setProperty("--maptiler-roll",String(this.getRoll())),this._container.style.setProperty("--maptiler-is-globe-projection",String(this.isGlobeProjection())),this._container.style.setProperty("--maptiler-has-terrain",String(this.hasTerrain()))};Ke(),this.on("render",Ke)}if(e.forceNoAttributionControl!==!0)if("logo"in Q&&Q.logo){const be=Q.logo;this.addControl(new cS({logoURL:be}),e.logoPosition)}else e.maptilerLogo&&this.addControl(new cS,e.logoPosition);if(e.scaleControl){const be=e.scaleControl===!0||e.scaleControl===void 0?"bottom-right":e.scaleControl,xe=new o6({unit:Ha.unit});this.addControl(xe,be),Ha.on("unit",ze=>{xe.setUnit(ze)})}if(e.navigationControl!==!1){const be=e.navigationControl===!0||e.navigationControl===void 0?"top-right":e.navigationControl;this.addControl(new EF,be)}if(e.geolocateControl!==!1){const be=e.geolocateControl===!0||e.geolocateControl===void 0?"top-right":e.geolocateControl;this.addControl(new IF({positionOptions:{enableHighAccuracy:!0,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!0,showAccuracyCircle:!0,showUserLocation:!0}),be)}if(e.terrainControl){const be=e.terrainControl===!0||e.terrainControl===void 0?"top-right":e.terrainControl;this.addControl(new SF,be)}if(e.projectionControl){const be=e.projectionControl===!0||e.projectionControl===void 0?"top-right":e.projectionControl;this.addControl(new PF,be)}if(e.fullscreenControl){const be=e.fullscreenControl===!0||e.fullscreenControl===void 0?"top-right":e.fullscreenControl;this.addControl(new l6({}),be)}this.isReady=!0,this.fire("ready",{target:this})});let k=!1,V=!1,Z;this.once("ready",()=>{k=!0,V&&this.fire("loadWithTerrain",Z)}),this.once("style.load",()=>{const{minimap:Q}=e;if(typeof Q=="object"){const{zoom:be,center:xe,style:ze,language:et,apiKey:Qe,maptilerLogo:Xe,canvasContextAttributes:Ke,refreshExpiredTiles:Ve,maxBounds:it,scrollZoom:de,minZoom:ce,maxZoom:me,boxZoom:Ee,locale:De,fadeDuration:$e,crossSourceCollisions:ke,clickTolerance:Bn,bounds:ti,fitBoundsOptions:gt,pixelRatio:Zt,validateStyle:xt}=e;this.minimap=new dx(Q,{zoom:be,center:xe,style:ze,language:et,apiKey:Qe,container:"null",maptilerLogo:Xe,canvasContextAttributes:Ke,refreshExpiredTiles:Ve,maxBounds:it,scrollZoom:de,minZoom:ce,maxZoom:me,boxZoom:Ee,locale:De,fadeDuration:$e,crossSourceCollisions:ke,clickTolerance:Bn,bounds:ti,fitBoundsOptions:gt,pixelRatio:Zt,validateStyle:xt}),this.addControl(this.minimap,Q.position??"bottom-left")}else Q===!0?(this.minimap=new dx({},e),this.addControl(this.minimap,"bottom-left")):Q!==void 0&&Q!==!1&&(this.minimap=new dx({},e),this.addControl(this.minimap,Q))});const Y=Q=>{Q.terrain&&(V=!0,Z={type:"loadWithTerrain",target:this,terrain:Q.terrain},this.off("terrain",Y),k&&this.fire("loadWithTerrain",Z))};this.on("terrain",Y),e.terrain&&this.enableTerrain(e.terrainExaggeration??this.terrainExaggeration),this.once("load",()=>{this.getCanvas().addEventListener("webglcontextlost",be=>{if(this._removed===!0){console.warn("[webglcontextlost]","WebGL context lost after map removal. This is harmless.");return}console.warn("[webglcontextlost]","Unexpected loss of WebGL context!"),this.fire("webglContextLost",be)});const Q=this.getLayersOrder()[0];e.space&&this.initSpace({options:e,before:Q}),e.halo&&this.initHalo({options:e,before:Q})}),this.telemetry=new MF(this)}getSpace(){return this.space}setSpace(e){if(e===!1){this.space=void 0;return}if(this.isGlobeProjection()){if(this.space){this.space.setCubemap(e),this.getLayer(this.space.id)||this.addLayer(this.space,this.getLayersOrder()[0]);return}this.space=new _x(e),this.once("load",()=>{const t=this.getLayersOrder()[0];this.space&&this.addLayer(this.space,t)})}}enableSpaceAnimations(){this.setSpaceAnimationActive(!0)}disableSpaceAnimations(){this.setSpaceAnimationActive(!1)}enableHaloAnimations(){this.setHaloAnimationActive(!0)}disableHaloAnimations(){this.setHaloAnimationActive(!1)}setHaloAnimationActive(e){this.halo?this.halo.setAnimationActive(e):this.once("load",()=>{var t;(t=this.halo)==null||t.setAnimationActive(e)})}setSpaceAnimationActive(e){this.space?this.space.setAnimationActive(e):this.once("load",()=>{var t;(t=this.space)==null||t.setAnimationActive(e)})}setSpaceFromStyle({style:e}){var t,a,h;if(this.options.space){this.setSpace(this.options.space);return}const m=(a=(t=e.metadata)==null?void 0:t.maptiler)==null?void 0:a.space;if(!m){this.setSpace({color:"transparent"});return}if(!AP(m)){this.setSpace({color:"transparent"});return}if(JSON.stringify((h=this.space)==null?void 0:h.getConfig())===JSON.stringify(m)){if(this.space&&!this.getLayer(this.space.id)){const g=this.getLayersOrder()[0];this.addLayer(this.space,g)}return}(()=>{if(this.space&&this.isGlobeProjection()){if(!this.getLayer(this.space.id)){const g=this.getLayersOrder()[0];this.addLayer(this.space,g)}this.space.setCubemap(m)}})()}setHaloFromStyle({style:e}){var t,a,h;const m=(t=e.metadata)==null?void 0:t.maptiler;if(JSON.stringify((a=this.halo)==null?void 0:a.getConfig())===JSON.stringify(m==null?void 0:m.halo)){if(this.halo&&!this.getLayer(this.halo.id)){const g=this.getLayersOrder().indexOf(((h=this.space)==null?void 0:h.id)??"")+1,c=this.getLayersOrder()[g];this.addLayer(this.halo,c)}return}if(!(m!=null&&m.halo)&&!this.options.halo){this.setHalo({stops:[[0,"transparent"],[1,"transparent"]],scale:1});return}(()=>{var g;if(this.halo){if(!this.getLayer(this.halo.id)){const C=this.getLayersOrder().indexOf(((g=this.space)==null?void 0:g.id)??"")+1,k=this.getLayersOrder()[C];this.addLayer(this.halo,k)}const c=(m==null?void 0:m.halo)??this.options.halo;c&&this.halo.setGradient(c)}})()}initSpace({options:e=this.options,before:t,spec:a}){if(this.space){this.getLayer(this.space.id)||this.addLayer(this.space,t);return}if(e.space===!1)return;const h=a;if(e.space){this.space=new _x(e.space),this.addLayer(this.space,t);return}h&&(this.space=new _x(h),this.addLayer(this.space,t))}initHalo({options:e=this.options,before:t,spec:a}){if(this.halo&&this.getLayer(this.halo.id)||e.halo===!1)return;const h=a;if(e.halo){this.halo=new yx(e.halo),this.addLayer(this.halo,t);return}h&&(this.halo=new yx(h),this.addLayer(this.halo,t))}getHalo(){return this.halo}setHalo(e){if(this.isGlobeProjection()){if(this.halo){this.halo.setGradient(e);return}this.halo=new yx(e),this.once("load",()=>{var t;const a=this.getLayersOrder(),h=a[0],m=a.indexOf(((t=this.space)==null?void 0:t.id)??"")+2,g=a[m];this.halo&&this.addLayer(this.halo,this.space?g:h)})}}recreate(){const e={center:this.getCenter(),zoom:this.getZoom(),bearing:this.getBearing(),pitch:this.getPitch()};this.remove(),Object.assign(this,new CP({...this.options})),this.once("load",()=>{this.jumpTo(e)})}setTerrainAnimationDuration(e){this.terrainAnimationDuration=Math.max(e,0)}async onLoadAsync(){return new Promise(e=>{if(this.loaded()){e(this);return}this.once("load",()=>{e(this)})})}async onReadyAsync(){return new Promise(e=>{if(this.isReady){e(this);return}this.once("ready",()=>{e(this)})})}async onLoadWithTerrainAsync(){return new Promise(e=>{if(this.isReady&&this.terrain){e(this);return}this.once("loadWithTerrain",()=>{e(this)})})}monitorStyleUrl(e){typeof this.monitoredStyleUrls>"u"&&(this.monitoredStyleUrls=new Set);const t=new URL(e);t.search="",this.monitoredStyleUrls.add(t.href)}setStyle(e,t){var a,h,m,g,c;this.originalLabelStyle.clear(),(a=this.minimap)==null||a.setStyle(e),this.forceLanguageUpdate=!0,this.once("idle",()=>{this.forceLanguageUpdate=!1});const C=RS(e);if(C.requiresUrlMonitoring&&this.monitorStyleUrl(C.style),C.isFallback){if(this.getStyle())return console.warn("[Map.setStyle]: Invalid style. A style must be a valid URL to a style.json, a JSON string representing a valid StyleSpecification or a valid StyleSpecification object. Keeping the curent style instead."),this;console.warn("[Map.setStyle]: Invalid style. A style must be a valid URL to a style.json, a JSON string representing a valid StyleSpecification or a valid StyleSpecification object. Fallback to default MapTiler style.")}const k=this.getStyle(),V=C.style;try{super.setStyle(C.style,t),this.styleInProcess=!0}catch(Q){this.styleInProcess=!1,console.error("[Map.setStyle]: Error while setting style:",Q)}const Z=()=>{const Q=C.style;if(!Q.projection||Q.projection.type==="mercator"){console.warn("[Map.setStyle]: Neither space nor halo is supported for mercator projection. Ignoring...");return}this.setSpaceFromStyle({style:C.style}),this.setHaloFromStyle({style:C.style})},Y=Q=>{var be,xe,ze,et;const Qe=(Q==null?void 0:Q.target.getStyle())??C.style,Xe=this.getLayersOrder()[0];this.space?this.setSpaceFromStyle({style:Qe}):this.initSpace({before:Xe,spec:(xe=(be=Qe.metadata)==null?void 0:be.maptiler)==null?void 0:xe.space}),this.halo?this.setHaloFromStyle({style:Qe}):this.initHalo({before:Xe,spec:(et=(ze=Qe.metadata)==null?void 0:ze.maptiler)==null?void 0:et.halo})};if(typeof C.style=="string"||C.requiresUrlMonitoring)return this.on("styledata",Y),this;if(this.styleInProcess&&!this.spaceboxLoadingState.styleLoadCallbackSet)return this.once("style.load",Y),this.once("styledata",Y),this.spaceboxLoadingState.styleLoadCallbackSet=!0,this;if(((h=k==null?void 0:k.terrain)==null?void 0:h.source)!==((m=V==null?void 0:V.terrain)==null?void 0:m.source)||((g=k==null?void 0:k.terrain)==null?void 0:g.exaggeration)!==((c=V==null?void 0:V.terrain)==null?void 0:c.exaggeration))return this.once("terrain",Z),this;try{Y()}catch{}return this}addLayer(e,t){var a;return(a=this.minimap)==null||a.addLayer(e,t),super.addLayer(e,t)}moveLayer(e,t){var a;return(a=this.minimap)==null||a.moveLayer(e,t),super.moveLayer(e,t)}removeLayer(e){var t;return(t=this.minimap)==null||t.removeLayer(e),super.removeLayer(e)}setLayerZoomRange(e,t,a){var h;return(h=this.minimap)==null||h.setLayerZoomRange(e,t,a),super.setLayerZoomRange(e,t,a)}setFilter(e,t,a){var h;return(h=this.minimap)==null||h.setFilter(e,t,a),super.setFilter(e,t,a)}setPaintProperty(e,t,a,h){var m;return(m=this.minimap)==null||m.setPaintProperty(e,t,a,h),super.setPaintProperty(e,t,a,h)}setLayoutProperty(e,t,a,h){var m;return(m=this.minimap)==null||m.setLayoutProperty(e,t,a,h),super.setLayoutProperty(e,t,a,h)}setGlyphs(e,t){var a;return(a=this.minimap)==null||a.setGlyphs(e,t),super.setGlyphs(e,t)}getStyleLanguage(){return!this.style||!this.style.stylesheet||!this.style.stylesheet.metadata||typeof this.style.stylesheet.metadata!="object"?null:"maptiler:language"in this.style.stylesheet.metadata&&typeof this.style.stylesheet.metadata["maptiler:language"]=="string"?Wx(this.style.stylesheet.metadata["maptiler:language"]):null}setLanguage(e){var t;(t=this.minimap)==null||t.map.setLanguage(e),this.onStyleReady(()=>{this.setPrimaryLanguage(e)})}setPrimaryLanguage(e){const t=this.getStyleLanguage(),a=WT(e,Wi);if(!a){console.warn(`The language "${a}" is not supported.`);return}if(!(a.flag===Wi.STYLE.flag&&t&&(t.flag===Wi.AUTO.flag||t.flag===Wi.VISITOR.flag))&&(a.flag!==Wi.STYLE.flag&&(this.languageAlwaysBeenStyle=!1),this.languageAlwaysBeenStyle||this.primaryLanguage===a&&!this.forceLanguageUpdate))return;if(this.primaryLanguage.flag===Wi.STYLE_LOCK.flag){console.warn("The language cannot be changed because this map has been instantiated with the STYLE_LOCK language flag.");return}this.primaryLanguage=a;let h=a;if(a.flag===Wi.STYLE.flag){if(!t){console.warn("The style has no default languages or has an invalid one.");return}h=t}let m=Wi.LOCAL.flag,g=["get",m];h.flag===Wi.VISITOR.flag?(m=rS().flag,g=["case",["all",["has",m],["has",Wi.LOCAL.flag]],["case",["==",["get",m],["get",Wi.LOCAL.flag]],["get",Wi.LOCAL.flag],["format",["get",m],{"font-scale":.8},`
`,["get",Wi.LOCAL.flag],{"font-scale":1.1}]],["get",Wi.LOCAL.flag]]):h.flag===Wi.VISITOR_ENGLISH.flag?(m=Wi.ENGLISH.flag,g=["case",["all",["has",m],["has",Wi.LOCAL.flag]],["case",["==",["get",m],["get",Wi.LOCAL.flag]],["get",Wi.LOCAL.flag],["format",["get",m],{"font-scale":.8},`
`,["get",Wi.LOCAL.flag],{"font-scale":1.1}]],["get",Wi.LOCAL.flag]]):h.flag===Wi.AUTO.flag?(m=rS().flag,g=["coalesce",["get",m],["get",Wi.LOCAL.flag]]):h===Wi.LOCAL?(m=Wi.LOCAL.flag,g=["get",m]):(m=h.flag,g=["coalesce",["get",m],["get",Wi.LOCAL.flag]]);const{layers:c}=this.getStyle(),C=this.originalLabelStyle.size===0;if(C){const k=i6(c,this);this.isStyleLocalized=Object.keys(k.localized).length>0}for(const k of c){if(k.type!=="symbol")continue;const V=k,Z=this.getSource(V.source);if(!Z||!("url"in Z&&typeof Z.url=="string")||new URL(Z.url).host!==Zl.maptilerApiHost)continue;const{id:Y,layout:Q}=V;if(!Q||!("text-field"in Q))continue;let be;if(C?(be=this.getLayoutProperty(Y,"text-field"),this.originalLabelStyle.set(Y,be)):be=this.originalLabelStyle.get(Y),typeof be=="string"){const{contains:xe,exactMatch:ze}=QN(be,this.isStyleLocalized);if(!xe)continue;if(ze)this.setLayoutProperty(Y,"text-field",g);else{const et=JN(be,g,this.isStyleLocalized);this.setLayoutProperty(Y,"text-field",et)}}else{const xe=YN(be,g,this.isStyleLocalized);this.setLayoutProperty(Y,"text-field",xe)}}this.languageIsUpdated=!0}getPrimaryLanguage(){return this.primaryLanguage}getTerrainExaggeration(){return this.terrainExaggeration}hasTerrain(){return this.isTerrainEnabled}growTerrain(e){if(!this.terrain)return;const t=performance.now(),a=this.terrain.exaggeration,h=e-a,m=()=>{if(!this.terrain||this.terrainFlattening)return;const g=(performance.now()-t)/this.terrainAnimationDuration;if(g<.99){const c=1-(1-g)**4,C=a+c*h;this.terrain.exaggeration=C,requestAnimationFrame(m)}else this.terrainGrowing=!1,this.terrainFlattening=!1,this.terrain.exaggeration=e,this.fire("terrainAnimationStop",{terrain:this.terrain});this._elevationFreeze=!1,this.triggerRepaint()};!this.terrainGrowing&&!this.terrainFlattening&&this.fire("terrainAnimationStart",{terrain:this.terrain}),this.terrainGrowing=!0,this.terrainFlattening=!1,requestAnimationFrame(m)}enableTerrain(e=this.terrainExaggeration){if(e<0){console.warn("Terrain exaggeration cannot be negative.");return}const t=h=>{!this.terrain||h.type!=="data"||h.dataType!=="source"||!("source"in h)||h.sourceId!=="maptiler-terrain"||h.source.type!=="raster-dem"||h.isSourceLoaded&&(this.off("data",t),this.growTerrain(e))},a=()=>{this.isTerrainEnabled=!0,this.terrainExaggeration=e,this.on("data",t),this.addSource(Zl.terrainSourceId,{type:"raster-dem",url:Zl.terrainSourceURL}),this.setTerrain({source:Zl.terrainSourceId,exaggeration:0})};if(this.getTerrain()){this.isTerrainEnabled=!0,this.growTerrain(e);return}if(this.loaded()||this.isTerrainEnabled)a();else{const h=()=>{this.getTerrain()&&this.getSource(Zl.terrainSourceId)||a()};this.once("load",()=>{h()}),this.once("moveend",()=>{h()})}}disableTerrain(){if(!this.terrain)return;this.isTerrainEnabled=!1;const e=performance.now(),t=this.terrain.exaggeration,a=()=>{if(!this.terrain||this.terrainGrowing)return;const h=(performance.now()-e)/this.terrainAnimationDuration;if(this._elevationFreeze=!1,h<.99){const m=(1-h)**4,g=t*m;this.terrain.exaggeration=g,requestAnimationFrame(a)}else this.terrain.exaggeration=0,this.terrainGrowing=!1,this.terrainFlattening=!1,this.setTerrain(),this.getSource(Zl.terrainSourceId)&&this.removeSource(Zl.terrainSourceId),this.fire("terrainAnimationStop",{terrain:null});this.triggerRepaint()};!this.terrainGrowing&&!this.terrainFlattening&&this.fire("terrainAnimationStart",{terrain:this.terrain}),this.terrainGrowing=!1,this.terrainFlattening=!0,requestAnimationFrame(a)}setTerrainExaggeration(e,t=!0){!t&&this.terrain?(this.terrainExaggeration=e,this.terrain.exaggeration=e,this.triggerRepaint()):this.enableTerrain(e)}onStyleReady(e){this.isStyleLoaded()?e():this.once("styledata",()=>{e()})}async fitToIpBounds(){const e=await KT.info();this.fitBounds(e.country_bounds,{duration:0,padding:100})}async centerOnIpPoint(e){const t=await KT.info();this.jumpTo({center:[t.longitude??0,t.latitude??0],zoom:e||11})}getCameraHash(){const e=new Float32Array(5),t=this.getCenter();return e[0]=t.lng,e[1]=t.lat,e[2]=this.getZoom(),e[3]=this.getPitch(),e[4]=this.getBearing(),ON.fromUint8Array(new Uint8Array(e.buffer))}getSdkConfig(){return Ha}getMaptilerSessionId(){return bw}setTransformRequest(e){return super.setTransformRequest(lS(e)),this}isGlobeProjection(){const e=this.getProjection();return e?e.type==="globe":!1}enableGlobeProjection(){this.isGlobeProjection()!==!0&&(this.setProjection({type:"globe"}),this.curentProjection="globe")}enableMercatorProjection(){this.isGlobeProjection()!==!1&&(this.setProjection({type:"mercator"}),this.curentProjection="mercator")}isLanguageUpdated(){return this.languageIsUpdated}};Sn.Evented;function qw(i){if(typeof DOMParser<"u"){const e=new DOMParser().parseFromString(i,"application/xml");if(e.querySelector("parsererror"))throw new Error("The provided string is not valid XML");return e}throw new Error("No XML parser found")}function PP(i,e){if(!i.hasChildNodes())return!1;for(const t of Array.from(i.childNodes)){const a=t.nodeName;if(typeof a=="string"&&a.trim().toLowerCase()===e.toLowerCase())return!0}return!1}function KS(i){if(typeof XMLSerializer<"u")return new XMLSerializer().serializeToString(i);throw new Error("No XML serializer found")}function MP(i){const e=typeof i=="string"?qw(i):i;if(!PP(e,"gpx"))throw new Error("The XML document is not valid GPX");const t=Co(e,"trk"),a=Co(e,"rte"),h=Co(e,"wpt"),m={type:"FeatureCollection",features:[]};for(const g of Array.from(t)){const c=vV(g);c&&m.features.push(c)}for(const g of Array.from(a)){const c=bV(g);c&&m.features.push(c)}for(const g of Array.from(h))m.features.push(xV(g));return m}function RP(i,e){let t=i;if(typeof t=="string"&&(t=qw(t)),!PP(t,"kml"))throw new Error("The XML document is not valid KML");const a={type:"FeatureCollection",features:[]},h={},m={},g={},c=Co(t,"Placemark"),C=Co(t,"Style"),k=Co(t,"StyleMap");for(const V of Array.from(C)){const Z=QS(KS(V)).toString(16);h[`#${Hp(V,"id")}`]=Z,m[Z]=V}for(const V of Array.from(k)){h[`#${Hp(V,"id")}`]=QS(KS(V)).toString(16);const Z=Co(V,"Pair"),Y={};for(const Q of Array.from(Z))Y[wr(ni(Q,"key"))??""]=wr(ni(Q,"styleUrl"));g[`#${Hp(V,"id")}`]=Y}for(const V of Array.from(c))a.features=a.features.concat(yV(V,h,m,g));return a}function YS(i){if(i===null)return["#000000",1];let e="",t=1,a=i;return a.startsWith("#")&&(a=a.substring(1)),(a.length===6||a.length===3)&&(e=a),a.length===8&&(t=Number.parseInt(a.substring(0,2),16)/255,e=`#${a.substring(6,8)}${a.substring(4,6)}${a.substring(2,4)}`),[e??"#000000",t??1]}function gV(i){return DP(i.split(" "))}function _V(i){let e=Co(i,"coord");const t=[],a=[];e.length===0&&(e=Co(i,"gx:coord"));for(const m of Array.from(e))t.push(gV(wr(m)??""));const h=Co(i,"when");for(const m of Array.from(h))a.push(wr(m));return{coords:t,times:a}}function t0(i){const e=["Polygon","LineString","Point","Track","gx:Track"];let t,a,h,m,g;const c=[],C=[];if(ni(i,"MultiGeometry")!==null)return t0(ni(i,"MultiGeometry"));if(ni(i,"MultiTrack")!==null)return t0(ni(i,"MultiTrack"));if(ni(i,"gx:MultiTrack")!==null)return t0(ni(i,"gx:MultiTrack"));for(h=0;h<e.length;h++)if(a=Co(i,e[h]),a){for(m=0;m<a.length;m++)if(t=a[m],e[h]==="Point")c.push({type:"Point",coordinates:zP(wr(ni(t,"coordinates"))??"")});else if(e[h]==="LineString")c.push({type:"LineString",coordinates:eE(wr(ni(t,"coordinates"))??"")});else if(e[h]==="Polygon"){const k=Co(t,"LinearRing"),V=[];for(g=0;g<k.length;g++)V.push(eE(wr(ni(k[g],"coordinates"))??""));c.push({type:"Polygon",coordinates:V})}else if(e[h]==="Track"||e[h]==="gx:Track"){const k=_V(t);c.push({type:"LineString",coordinates:k.coords}),k.times.length&&C.push(k.times)}}return{geoms:c,coordTimes:C}}function yV(i,e,t,a){const h=t0(i),m={},g=wr(ni(i,"name")),c=wr(ni(i,"address")),C=wr(ni(i,"description")),k=ni(i,"TimeSpan"),V=ni(i,"TimeStamp"),Z=ni(i,"ExtendedData"),Y=ni(i,"visibility");let Q,be=wr(ni(i,"styleUrl")),xe=ni(i,"LineStyle"),ze=ni(i,"PolyStyle");if(!h.geoms.length)return[];if(g&&(m.name=g),c&&(m.address=c),be){be.startsWith("#")||(be=`#${be}`),m.styleUrl=be,e[be]&&(m.styleHash=e[be]),a[be]&&(m.styleMapHash=a[be],m.styleHash=e[a[be].normal??""]);const Qe=t[m.styleHash??""];if(Qe){xe||(xe=ni(Qe,"LineStyle")),ze||(ze=ni(Qe,"PolyStyle"));const Xe=ni(Qe,"IconStyle");if(Xe){const Ke=ni(Xe,"Icon");if(Ke){const Ve=wr(ni(Ke,"href"));Ve&&(m.icon=Ve)}}}}if(C&&(m.description=C),k){const Qe=wr(ni(k,"begin")),Xe=wr(ni(k,"end"));Qe&&Xe&&(m.timespan={begin:Qe,end:Xe})}if(V!==null&&(m.timestamp=wr(ni(V,"when"))??new Date().toISOString()),xe!==null){const Qe=YS(wr(ni(xe,"color"))),Xe=Qe[0],Ke=Qe[1],Ve=Number.parseFloat(wr(ni(xe,"width"))??"");Xe&&(m.stroke=Xe),Number.isNaN(Ke)||(m["stroke-opacity"]=Ke),Number.isNaN(Ve)||(m["stroke-width"]=Ve)}if(ze){const Qe=YS(wr(ni(ze,"color"))),Xe=Qe[0],Ke=Qe[1],Ve=wr(ni(ze,"fill")),it=wr(ni(ze,"outline"));Xe&&(m.fill=Xe),Number.isNaN(Ke)||(m["fill-opacity"]=Ke),Ve&&(m["fill-opacity"]=Ve==="1"?m["fill-opacity"]||1:0),it&&(m["stroke-opacity"]=it==="1"?m["stroke-opacity"]||1:0)}if(Z){const Qe=Co(Z,"Data"),Xe=Co(Z,"SimpleData");for(Q=0;Q<Qe.length;Q++)m[Qe[Q].getAttribute("name")??""]=wr(ni(Qe[Q],"value"))??"";for(Q=0;Q<Xe.length;Q++)m[Xe[Q].getAttribute("name")??""]=wr(Xe[Q])??""}Y!==null&&(m.visibility=wr(Y)??""),h.coordTimes.length!==0&&(m.coordTimes=h.coordTimes.length===1?h.coordTimes[0]:h.coordTimes);const et={type:"Feature",geometry:h.geoms.length===1?h.geoms[0]:{type:"GeometryCollection",geometries:h.geoms},properties:m};return Hp(i,"id")&&(et.id=Hp(i,"id")??void 0),[et]}function kP(i,e){const t=Co(i,e),a=[],h=[];let m=[];const g=t.length;if(!(g<2)){for(let c=0;c<g;c++){const C=OP(t[c]);a.push(C.coordinates),C.time&&h.push(C.time),(C.heartRate||m.length)&&(m.length===0&&(m=new Array(c).fill(null)),m.push(C.heartRate))}return{line:a,times:h,heartRates:m}}}function vV(i){const e=Co(i,"trkseg"),t=[],a=[],h=[];let m;for(let c=0;c<e.length;c++)if(m=kP(e[c],"trkpt"),m!==void 0&&(m.line&&t.push(m.line),m.times&&m.times.length&&a.push(m.times),h.length||m.heartRates&&m.heartRates.length)){if(!h.length)for(let C=0;C<c;C++)h.push(new Array(t[C].length).fill(null));m.heartRates&&m.heartRates.length?h.push(m.heartRates):h.push(new Array(m.line.length).fill(null))}if(t.length===0)return;const g={...$w(i),...LP(ni(i,"extensions"))};return a.length!==0&&(g.coordTimes=t.length===1?a[0]:a),h.length!==0&&(g.heartRates=t.length===1?h[0]:h),t.length===1?{type:"Feature",properties:g,geometry:{type:"LineString",coordinates:t[0]}}:{type:"Feature",properties:g,geometry:{type:"MultiLineString",coordinates:t}}}function bV(i){const e=kP(i,"rtept");return e===void 0?void 0:{type:"Feature",properties:{...$w(i),...LP(ni(i,"extensions"))},geometry:{type:"LineString",coordinates:e.line}}}function xV(i){return{type:"Feature",properties:{...$w(i),...u1(i,["sym"])},geometry:{type:"Point",coordinates:OP(i).coordinates}}}function LP(i){const e={};if(i){const t=ni(i,"line");if(t){const a=wr(ni(t,"color")),h=Number.parseFloat(wr(ni(t,"opacity"))??"0"),m=Number.parseFloat(wr(ni(t,"width"))??"0");a&&(e.stroke=a),Number.isNaN(h)||(e["stroke-opacity"]=h),Number.isNaN(m)||(e["stroke-width"]=m*96/25.4)}}return e}function $w(i){const e=u1(i,["name","cmt","desc","type","time","keywords"]),t=Co(i,"link");if(t.length!==0){e.links=[];for(const a of Array.from(t)){const h={href:Hp(a,"href"),...u1(a,["text","type"])};e.links.push(h)}}return e}function QS(i){let e=0;if(!i||!i.length)return e;for(let t=0;t<i.length;t++)e=(e<<5)-e+i.charCodeAt(t)|0;return e}function Co(i,e){return i.getElementsByTagName(e)}function Hp(i,e){return i.getAttribute(e)}function JS(i,e){return Number.parseFloat(Hp(i,e)??"0")}function ni(i,e){const t=Co(i,e);return t.length?t[0]:null}function wV(i){return i.normalize&&i.normalize(),i}function DP(i){return i.map(Number.parseFloat).map(e=>Number.isNaN(e)?null:e)}function wr(i){return i&&wV(i),i&&i.textContent}function u1(i,e){const t={};let a,h;for(h=0;h<e.length;h++)a=ni(i,e[h]),a&&(t[e[h]]=wr(a)??"");return t}function zP(i){return DP(i.replace(/\s*/g,"").split(","))}function eE(i){const e=i.replace(/^\s*|\s*$/g,"").split(/\s+/),t=[];for(const a of e)t.push(zP(a));return t}function OP(i){const e=[JS(i,"lon"),JS(i,"lat")],t=ni(i,"ele"),a=ni(i,"gpxtpx:hr")||ni(i,"hr"),h=ni(i,"time");let m;return t&&(m=Number.parseFloat(wr(t)??"0"),Number.isNaN(m)||e.push(m)),{coordinates:e,time:h?wr(h):null,heartRate:a!==null?Number.parseFloat(wr(a)??"0"):null}}function TV(i){let e=i;try{typeof e=="string"&&(e=qw(e))}catch{return null}try{return MP(e)}catch{}try{return RP(e)}catch{}return null}async function SV(i,e={}){const t=e.download??!1,a=await EV(i);if(t){const h=e.filename??"maptiler_screenshot.png",m=document.createElement("a");m.style.display="none",document.body.appendChild(m),m.href=URL.createObjectURL(a),m.download=h,m.click(),setTimeout(()=>{document.body.removeChild(m),URL.revokeObjectURL(m.href)},0)}return a}function EV(i){return new Promise((e,t)=>{i.redraw(),i.once("idle",()=>{i.getCanvas().toBlob(a=>{if(!a){t(Error("Screenshot could not be created."));return}e(a)},"image/png")})})}const c1=[["#1D5B79","#468B97","#EF6262","#F3AA60"],["#614BC3","#33BBC5","#85E6C5","#C8FFE0"],["#461959","#7A316F","#CD6688","#AED8CC"],["#0079FF","#00DFA2","#F6FA70","#FF0060"],["#39B5E0","#A31ACB","#FF78F0","#F5EA5A"],["#37E2D5","#590696","#C70A80","#FBCB0A"],["#FFD36E","#FFF56D","#99FFCD","#9FB4FF"],["#00EAD3","#FFF5B7","#FF449F","#005F99"],["#10A19D","#540375","#FF7000","#FFBF00"]];function vb(){return c1[~~(Math.random()*c1.length)][~~(Math.random()*4)]}function Iy(){return`maptiler_source_${zC()}`}function Cy(){return`maptiler_layer_${zC()}`}function h1(i,e){if(e<=i[0].zoom)return i[0].value;if(e>=i[i.length-1].zoom)return i[i.length-1].value;for(let t=0;t<i.length-1;t+=1)if(e>=i[t].zoom&&e<i[t+1].zoom){const a=i[t+1].zoom-i[t].zoom,h=(e-i[t].zoom)/a;return h*i[t+1].value+(1-h)*i[t].value}return 0}function Nf(i){return["interpolate",["linear"],["zoom"],...i.flatMap(e=>[e.zoom,e.value])]}function dr(i){return["interpolate",["linear"],["zoom"],...i.flatMap(e=>[e.zoom,e.value])]}function NP(i,e){if(typeof e=="number"&&typeof i=="number")return 2*e+i;if(typeof e=="number"&&Array.isArray(i))return["interpolate",["linear"],["zoom"],...i.flatMap(t=>[t.zoom,2*e+t.value])];if(typeof i=="number"&&Array.isArray(e))return["interpolate",["linear"],["zoom"],...e.flatMap(t=>[t.zoom,2*t.value+i])];if(Array.isArray(i)&&Array.isArray(e)){const t=Array.from(new Set([...i.map(a=>a.zoom),...e.map(a=>a.zoom)])).sort((a,h)=>a<h?-1:1);return["interpolate",["linear"],["zoom"],...t.flatMap(a=>[a,2*h1(e,a)+h1(i,a)])]}return 0}function BP(i,e){return["interpolate",["linear"],["get",e],...i.flatMap(t=>[t.propertyValue,t.value])]}function Gw(i){const e=i.trimStart(),t=`${e}${" ".repeat(i.length-e.length)}`,a=Array.from(t);if(!a.every(m=>m===" "||m==="_"))throw new Error("A dash pattern must be composed only of whitespace and underscore characters.");if(!(a.some(m=>m==="_")&&a.some(m=>m===" ")))throw new Error("A dash pattern must contain at least one underscore and one whitespace character");const h=[1];for(let m=1;m<a.length;m+=1){const g=a[m-1],c=a[m];g===c?h[h.length-1]+=1:h.push(1)}return h}function d1(i,e){return["interpolate",["linear"],["get",e],...i.flatMap(t=>[t.value,t.color])]}function f1(i,e,t=!0){return t?["interpolate",["linear"],["zoom"],0,["interpolate",["linear"],["get",e],...i.flatMap(a=>[a.value,a.pointRadius*.025])],2,["interpolate",["linear"],["get",e],...i.flatMap(a=>[a.value,a.pointRadius*.05])],4,["interpolate",["linear"],["get",e],...i.flatMap(a=>[a.value,a.pointRadius*.1])],8,["interpolate",["linear"],["get",e],...i.flatMap(a=>[a.value,a.pointRadius*.25])],16,["interpolate",["linear"],["get",e],...i.flatMap(a=>[a.value,a.pointRadius])]]:["interpolate",["linear"],["get",e],...i.flatMap(a=>[a.value,a.pointRadius])]}function FP(i,e,t=!0){return t?["interpolate",["linear"],["zoom"],0,["interpolate",["linear"],["get",e],...i.flatMap(a=>[a.propertyValue,a.value*.025])],2,["interpolate",["linear"],["get",e],...i.flatMap(a=>[a.propertyValue,a.value*.05])],4,["interpolate",["linear"],["get",e],...i.flatMap(a=>[a.propertyValue,a.value*.1])],8,["interpolate",["linear"],["get",e],...i.flatMap(a=>[a.propertyValue,a.value*.25])],16,["interpolate",["linear"],["get",e],...i.flatMap(a=>[a.propertyValue,a.value])]]:["interpolate",["linear"],["get",e],...i.flatMap(a=>[a.propertyValue,a.value])]}function p1(i,e){return i.every(t=>t.color[3]===i[0].color[3])?i[0].color[3]?i[0].color[3]/255:1:["interpolate",["linear"],["get",e],...i.getRawColorStops().flatMap(t=>{const a=t.value,h=t.color;return[a,h.length===4?h[3]/255:1]})]}function VP(i,e=10){return["interpolate",["linear"],["heatmap-density"],...Array.from({length:e+1},(t,a)=>{const h=a/e;return[h,i.getColorHex(h)]}).flat()]}function zv(i){const e=i.toString(16);return e.length===1?`0${e}`:e}function AV(i){return`#${zv(i[0])}${zv(i[1])}${zv(i[2])}${i.length===4?zv(i[3]):""}`}class On extends Array{constructor(e={}){super(),nn(this,"min",0),nn(this,"max",1),"min"in e&&(this.min=e.min),"max"in e&&(this.max=e.max),"stops"in e&&this.setStops(e.stops,{clone:!1})}static fromArrayDefinition(e){return new On({stops:e.map(t=>({value:t[0],color:t[1]}))})}setStops(e,t={clone:!0}){const a=t.clone?this.clone():this;a.length=0;let h=Number.POSITIVE_INFINITY,m=Number.NEGATIVE_INFINITY;for(let g=0;g<e.length;g+=1)h=Math.min(h,e[g].value),m=Math.max(m,e[g].value),a.push({value:e[g].value,color:e[g].color.slice()});return a.sort((g,c)=>g.value<c.value?-1:1),this.min=h,this.max=m,a}scale(e,t,a={clone:!0}){const h=a.clone,m=this[0].value,g=this.at(-1).value-m,c=t-e,C=[];for(let k=0;k<this.length;k+=1){const V=(this[k].value-m)/g*c+e;h?C.push({value:V,color:this[k].color.slice()}):this[k].value=V}return h?new On({stops:C}):this}at(e){return e<0?this[this.length+e]:this[e]}clone(){return new On({stops:this.getRawColorStops()})}getRawColorStops(){const e=[];for(let t=0;t<this.length;t+=1)e.push({value:this[t].value,color:this[t].color});return e}reverse(e={clone:!0}){const t=e.clone?this.clone():this;for(let a=0;a<~~(t.length/2);a+=1){const h=t[a].color;t[a].color=t.at(-(a+1)).color,t.at(-(a+1)).color=h}return t}getBounds(){return{min:this.min,max:this.max}}getColor(e,t={smooth:!0}){if(e<=this[0].value)return this[0].color;if(e>=this.at(-1).value)return this.at(-1).color;for(let a=0;a<this.length-1;a+=1){if(e>this[a+1].value)continue;const h=this[a].color;if(!t.smooth)return h.slice();const m=this[a].value,g=this[a+1].value,c=this[a+1].color,C=(g-e)/(g-m);return h.map((k,V)=>Math.round(k*C+c[V]*(1-C)))}return[0,0,0]}getColorHex(e,t={smooth:!0,withAlpha:!1}){return AV(this.getColor(e,t))}getColorRelative(e,t={smooth:!0}){const a=this.getBounds();return this.getColor(a.min+e*(a.max-a.min),t)}getCanvasStrip(e={horizontal:!0,size:512,smooth:!0}){const t=document.createElement("canvas");t.width=e.horizontal?e.size:1,t.height=e.horizontal?1:e.size;const a=t.getContext("2d");if(!a)throw new Error("Canvs context is missing");const h=a.getImageData(0,0,t.width,t.height),m=h.data,g=e.size,c=this[0].value,C=(this.at(-1).value-c)/g;for(let k=0;k<g;k+=1){const V=this.getColor(c+k*C,{smooth:e.smooth});m[k*4]=V[0],m[k*4+1]=V[1],m[k*4+2]=V[2],m[k*4+3]=V.length>3?V[3]:255}return a.putImageData(h,0,0),t}resample(e,t=15){const a=this.getBounds(),h=this.scale(0,1),m=1/(t-1);let g;if(e==="ease-in-square")g=Array.from({length:t},(c,C)=>{const k=C*m,V=k**2,Z=h.getColor(V);return{value:k,color:Z}});else if(e==="ease-out-square")g=Array.from({length:t},(c,C)=>{const k=C*m,V=1-(1-k)**2,Z=h.getColor(V);return{value:k,color:Z}});else if(e==="ease-out-sqrt")g=Array.from({length:t},(c,C)=>{const k=C*m,V=k**.5,Z=h.getColor(V);return{value:k,color:Z}});else if(e==="ease-in-sqrt")g=Array.from({length:t},(c,C)=>{const k=C*m,V=1-(1-k)**.5,Z=h.getColor(V);return{value:k,color:Z}});else if(e==="ease-out-exp")g=Array.from({length:t},(c,C)=>{const k=C*m,V=1-2**(-10*k),Z=h.getColor(V);return{value:k,color:Z}});else if(e==="ease-in-exp")g=Array.from({length:t},(c,C)=>{const k=C*m,V=2**(10*k-10),Z=h.getColor(V);return{value:k,color:Z}});else throw new Error("Invalid ressampling method.");return new On({stops:g}).scale(a.min,a.max)}transparentStart(){const e=this.getRawColorStops();e.unshift({value:e[0].value,color:e[0].color.slice()}),e[1].value+=.001;for(const t of e)t.color.length===3&&t.color.push(255);return e[0].color[3]=0,new On({stops:e})}hasTransparentStart(){return this[0].color.length===4&&this[0].color[3]===0}}const UP={NULL:new On({stops:[{value:0,color:[0,0,0,0]},{value:1,color:[0,0,0,0]}]}),GRAY:new On({stops:[{value:0,color:[0,0,0]},{value:1,color:[255,255,255]}]}),JET:new On({stops:[{value:0,color:[0,0,131]},{value:.125,color:[0,60,170]},{value:.375,color:[5,255,255]},{value:.625,color:[255,255,0]},{value:.875,color:[250,0,0]},{value:1,color:[128,0,0]}]}),HSV:new On({stops:[{value:0,color:[255,0,0]},{value:.169,color:[253,255,2]},{value:.173,color:[247,255,2]},{value:.337,color:[0,252,4]},{value:.341,color:[0,252,10]},{value:.506,color:[1,249,255]},{value:.671,color:[2,0,253]},{value:.675,color:[8,0,253]},{value:.839,color:[255,0,251]},{value:.843,color:[255,0,245]},{value:1,color:[255,0,6]}]}),HOT:new On({stops:[{value:0,color:[0,0,0]},{value:.3,color:[230,0,0]},{value:.6,color:[255,210,0]},{value:1,color:[255,255,255]}]}),SPRING:new On({stops:[{value:0,color:[255,0,255]},{value:1,color:[255,255,0]}]}),SUMMER:new On({stops:[{value:0,color:[0,128,102]},{value:1,color:[255,255,102]}]}),AUTOMN:new On({stops:[{value:0,color:[255,0,0]},{value:1,color:[255,255,0]}]}),WINTER:new On({stops:[{value:0,color:[0,0,255]},{value:1,color:[0,255,128]}]}),BONE:new On({stops:[{value:0,color:[0,0,0]},{value:.376,color:[84,84,116]},{value:.753,color:[169,200,200]},{value:1,color:[255,255,255]}]}),COPPER:new On({stops:[{value:0,color:[0,0,0]},{value:.804,color:[255,160,102]},{value:1,color:[255,199,127]}]}),GREYS:new On({stops:[{value:0,color:[0,0,0]},{value:1,color:[255,255,255]}]}),YIGNBU:new On({stops:[{value:0,color:[8,29,88]},{value:.125,color:[37,52,148]},{value:.25,color:[34,94,168]},{value:.375,color:[29,145,192]},{value:.5,color:[65,182,196]},{value:.625,color:[127,205,187]},{value:.75,color:[199,233,180]},{value:.875,color:[237,248,217]},{value:1,color:[255,255,217]}]}),GREENS:new On({stops:[{value:0,color:[0,68,27]},{value:.125,color:[0,109,44]},{value:.25,color:[35,139,69]},{value:.375,color:[65,171,93]},{value:.5,color:[116,196,118]},{value:.625,color:[161,217,155]},{value:.75,color:[199,233,192]},{value:.875,color:[229,245,224]},{value:1,color:[247,252,245]}]}),YIORRD:new On({stops:[{value:0,color:[128,0,38]},{value:.125,color:[189,0,38]},{value:.25,color:[227,26,28]},{value:.375,color:[252,78,42]},{value:.5,color:[253,141,60]},{value:.625,color:[254,178,76]},{value:.75,color:[254,217,118]},{value:.875,color:[255,237,160]},{value:1,color:[255,255,204]}]}),BLUERED:new On({stops:[{value:0,color:[0,0,255]},{value:1,color:[255,0,0]}]}),RDBU:new On({stops:[{value:0,color:[5,10,172]},{value:.35,color:[106,137,247]},{value:.5,color:[190,190,190]},{value:.6,color:[220,170,132]},{value:.7,color:[230,145,90]},{value:1,color:[178,10,28]}]}),PICNIC:new On({stops:[{value:0,color:[0,0,255]},{value:.1,color:[51,153,255]},{value:.2,color:[102,204,255]},{value:.3,color:[153,204,255]},{value:.4,color:[204,204,255]},{value:.5,color:[255,255,255]},{value:.6,color:[255,204,255]},{value:.7,color:[255,153,255]},{value:.8,color:[255,102,204]},{value:.9,color:[255,102,102]},{value:1,color:[255,0,0]}]}),RAINBOW:new On({stops:[{value:0,color:[150,0,90]},{value:.125,color:[0,0,200]},{value:.25,color:[0,25,255]},{value:.375,color:[0,152,255]},{value:.5,color:[44,255,150]},{value:.625,color:[151,255,0]},{value:.75,color:[255,234,0]},{value:.875,color:[255,111,0]},{value:1,color:[255,0,0]}]}),PORTLAND:new On({stops:[{value:0,color:[12,51,131]},{value:.25,color:[10,136,186]},{value:.5,color:[242,211,56]},{value:.75,color:[242,143,56]},{value:1,color:[217,30,30]}]}),BLACKBODY:new On({stops:[{value:0,color:[0,0,0]},{value:.2,color:[230,0,0]},{value:.4,color:[230,210,0]},{value:.7,color:[255,255,255]},{value:1,color:[160,200,255]}]}),EARTH:new On({stops:[{value:0,color:[0,0,130]},{value:.1,color:[0,180,180]},{value:.2,color:[40,210,40]},{value:.4,color:[230,230,50]},{value:.6,color:[120,70,20]},{value:1,color:[255,255,255]}]}),ELECTRIC:new On({stops:[{value:0,color:[0,0,0]},{value:.15,color:[30,0,100]},{value:.4,color:[120,0,100]},{value:.6,color:[160,90,0]},{value:.8,color:[230,200,0]},{value:1,color:[255,250,220]}]}),VIRIDIS:new On({stops:[{value:0,color:[68,1,84]},{value:.13,color:[71,44,122]},{value:.25,color:[59,81,139]},{value:.38,color:[44,113,142]},{value:.5,color:[33,144,141]},{value:.63,color:[39,173,129]},{value:.75,color:[92,200,99]},{value:.88,color:[170,220,50]},{value:1,color:[253,231,37]}]}),INFERNO:new On({stops:[{value:0,color:[0,0,4]},{value:.13,color:[31,12,72]},{value:.25,color:[85,15,109]},{value:.38,color:[136,34,106]},{value:.5,color:[186,54,85]},{value:.63,color:[227,89,51]},{value:.75,color:[249,140,10]},{value:.88,color:[249,201,50]},{value:1,color:[252,255,164]}]}),MAGMA:new On({stops:[{value:0,color:[0,0,4]},{value:.13,color:[28,16,68]},{value:.25,color:[79,18,123]},{value:.38,color:[129,37,129]},{value:.5,color:[181,54,122]},{value:.63,color:[229,80,100]},{value:.75,color:[251,135,97]},{value:.88,color:[254,194,135]},{value:1,color:[252,253,191]}]}),PLASMA:new On({stops:[{value:0,color:[13,8,135]},{value:.13,color:[75,3,161]},{value:.25,color:[125,3,168]},{value:.38,color:[168,34,150]},{value:.5,color:[203,70,121]},{value:.63,color:[229,107,93]},{value:.75,color:[248,148,65]},{value:.88,color:[253,195,40]},{value:1,color:[240,249,33]}]}),WARM:new On({stops:[{value:0,color:[125,0,179]},{value:.13,color:[172,0,187]},{value:.25,color:[219,0,170]},{value:.38,color:[255,0,130]},{value:.5,color:[255,63,74]},{value:.63,color:[255,123,0]},{value:.75,color:[234,176,0]},{value:.88,color:[190,228,0]},{value:1,color:[147,255,0]}]}),COOL:new On({stops:[{value:0,color:[125,0,179]},{value:.13,color:[116,0,218]},{value:.25,color:[98,74,237]},{value:.38,color:[68,146,231]},{value:.5,color:[0,204,197]},{value:.63,color:[0,247,146]},{value:.75,color:[0,255,88]},{value:.88,color:[40,255,8]},{value:1,color:[147,255,0]}]}),RAINBOW_SOFT:new On({stops:[{value:0,color:[125,0,179]},{value:.1,color:[199,0,180]},{value:.2,color:[255,0,121]},{value:.3,color:[255,108,0]},{value:.4,color:[222,194,0]},{value:.5,color:[150,255,0]},{value:.6,color:[0,255,55]},{value:.7,color:[0,246,150]},{value:.8,color:[50,167,222]},{value:.9,color:[103,51,235]},{value:1,color:[124,0,186]}]}),BATHYMETRY:new On({stops:[{value:0,color:[40,26,44]},{value:.13,color:[59,49,90]},{value:.25,color:[64,76,139]},{value:.38,color:[63,110,151]},{value:.5,color:[72,142,158]},{value:.63,color:[85,174,163]},{value:.75,color:[120,206,163]},{value:.88,color:[187,230,172]},{value:1,color:[253,254,204]}]}),CDOM:new On({stops:[{value:0,color:[47,15,62]},{value:.13,color:[87,23,86]},{value:.25,color:[130,28,99]},{value:.38,color:[171,41,96]},{value:.5,color:[206,67,86]},{value:.63,color:[230,106,84]},{value:.75,color:[242,149,103]},{value:.88,color:[249,193,135]},{value:1,color:[254,237,176]}]}),CHLOROPHYLL:new On({stops:[{value:0,color:[18,36,20]},{value:.13,color:[25,63,41]},{value:.25,color:[24,91,59]},{value:.38,color:[13,119,72]},{value:.5,color:[18,148,80]},{value:.63,color:[80,173,89]},{value:.75,color:[132,196,122]},{value:.88,color:[175,221,162]},{value:1,color:[215,249,208]}]}),DENSITY:new On({stops:[{value:0,color:[54,14,36]},{value:.13,color:[89,23,80]},{value:.25,color:[110,45,132]},{value:.38,color:[120,77,178]},{value:.5,color:[120,113,213]},{value:.63,color:[115,151,228]},{value:.75,color:[134,185,227]},{value:.88,color:[177,214,227]},{value:1,color:[230,241,241]}]}),FREESURFACE_BLUE:new On({stops:[{value:0,color:[30,4,110]},{value:.13,color:[47,14,176]},{value:.25,color:[41,45,236]},{value:.38,color:[25,99,212]},{value:.5,color:[68,131,200]},{value:.63,color:[114,156,197]},{value:.75,color:[157,181,203]},{value:.88,color:[200,208,216]},{value:1,color:[241,237,236]}]}),FREESURFACE_RED:new On({stops:[{value:0,color:[60,9,18]},{value:.13,color:[100,17,27]},{value:.25,color:[142,20,29]},{value:.38,color:[177,43,27]},{value:.5,color:[192,87,63]},{value:.63,color:[205,125,105]},{value:.75,color:[216,162,148]},{value:.88,color:[227,199,193]},{value:1,color:[241,237,236]}]}),OXYGEN:new On({stops:[{value:0,color:[64,5,5]},{value:.13,color:[106,6,15]},{value:.25,color:[144,26,7]},{value:.38,color:[168,64,3]},{value:.5,color:[188,100,4]},{value:.63,color:[206,136,11]},{value:.75,color:[220,174,25]},{value:.88,color:[231,215,44]},{value:1,color:[248,254,105]}]}),PAR:new On({stops:[{value:0,color:[51,20,24]},{value:.13,color:[90,32,35]},{value:.25,color:[129,44,34]},{value:.38,color:[159,68,25]},{value:.5,color:[182,99,19]},{value:.63,color:[199,134,22]},{value:.75,color:[212,171,35]},{value:.88,color:[221,210,54]},{value:1,color:[225,253,75]}]}),PHASE:new On({stops:[{value:0,color:[145,105,18]},{value:.13,color:[184,71,38]},{value:.25,color:[186,58,115]},{value:.38,color:[160,71,185]},{value:.5,color:[110,97,218]},{value:.63,color:[50,123,164]},{value:.75,color:[31,131,110]},{value:.88,color:[77,129,34]},{value:1,color:[145,105,18]}]}),SALINITY:new On({stops:[{value:0,color:[42,24,108]},{value:.13,color:[33,50,162]},{value:.25,color:[15,90,145]},{value:.38,color:[40,118,137]},{value:.5,color:[59,146,135]},{value:.63,color:[79,175,126]},{value:.75,color:[120,203,104]},{value:.88,color:[193,221,100]},{value:1,color:[253,239,154]}]}),TEMPERATURE:new On({stops:[{value:0,color:[4,35,51]},{value:.13,color:[23,51,122]},{value:.25,color:[85,59,157]},{value:.38,color:[129,79,143]},{value:.5,color:[175,95,130]},{value:.63,color:[222,112,101]},{value:.75,color:[249,146,66]},{value:.88,color:[249,196,65]},{value:1,color:[232,250,91]}]}),TURBIDITY:new On({stops:[{value:0,color:[34,31,27]},{value:.13,color:[65,50,41]},{value:.25,color:[98,69,52]},{value:.38,color:[131,89,57]},{value:.5,color:[161,112,59]},{value:.63,color:[185,140,66]},{value:.75,color:[202,174,88]},{value:.88,color:[216,209,126]},{value:1,color:[233,246,171]}]}),VELOCITY_BLUE:new On({stops:[{value:0,color:[17,32,64]},{value:.13,color:[35,52,116]},{value:.25,color:[29,81,156]},{value:.38,color:[31,113,162]},{value:.5,color:[50,144,169]},{value:.63,color:[87,173,176]},{value:.75,color:[149,196,189]},{value:.88,color:[203,221,211]},{value:1,color:[254,251,230]}]}),VELOCITY_GREEN:new On({stops:[{value:0,color:[23,35,19]},{value:.13,color:[24,64,38]},{value:.25,color:[11,95,45]},{value:.38,color:[39,123,35]},{value:.5,color:[95,146,12]},{value:.63,color:[152,165,18]},{value:.75,color:[201,186,69]},{value:.88,color:[233,216,137]},{value:1,color:[255,253,205]}]}),CUBEHELIX:new On({stops:[{value:0,color:[0,0,0]},{value:.07,color:[22,5,59]},{value:.13,color:[60,4,105]},{value:.2,color:[109,1,135]},{value:.27,color:[161,0,147]},{value:.33,color:[210,2,142]},{value:.4,color:[251,11,123]},{value:.47,color:[255,29,97]},{value:.53,color:[255,54,69]},{value:.6,color:[255,85,46]},{value:.67,color:[255,120,34]},{value:.73,color:[255,157,37]},{value:.8,color:[241,191,57]},{value:.87,color:[224,220,93]},{value:.93,color:[218,241,142]},{value:1,color:[227,253,198]}]}),CIVIDIS:new On({stops:[{value:0,color:[0,32,77,255]},{value:.125,color:[5,54,110,255]},{value:.25,color:[65,77,108,255]},{value:.375,color:[97,100,111,255]},{value:.5,color:[125,124,121,255]},{value:.625,color:[156,149,120,255]},{value:.75,color:[190,175,111,255]},{value:.875,color:[225,204,94,255]},{value:1,color:[255,235,70,255]}]}),TURBO:new On({stops:[{value:0,color:[48,18,59,255]},{value:.125,color:[70,107,227,255]},{value:.25,color:[40,187,236,255]},{value:.375,color:[49,242,153,255]},{value:.5,color:[162,252,60,255]},{value:.625,color:[237,208,58,255]},{value:.75,color:[251,128,34,255]},{value:.875,color:[210,49,5,255]},{value:1,color:[122,4,3,255]}]}),ROCKET:new On({stops:[{value:0,color:[250,235,221,0]},{value:.133,color:[250,235,221,255]},{value:.266,color:[246,170,130,255]},{value:.4,color:[240,96,67,255]},{value:.533,color:[203,27,79,255]},{value:.666,color:[132,30,90,255]},{value:.8,color:[63,27,68,255]},{value:1,color:[3,5,26,255]}]}),MAKO:new On({stops:[{value:0,color:[11,4,5,255]},{value:.125,color:[43,28,53,255]},{value:.25,color:[62,53,107,255]},{value:.375,color:[59,86,152,255]},{value:.5,color:[53,123,162,255]},{value:.625,color:[53,158,170,255]},{value:.75,color:[73,193,173,255]},{value:.875,color:[150,221,181,255]},{value:1,color:[222,245,229,255]}]})};async function IV(i,e,t={}){var a,h;if(!e.sourceId&&!e.data)throw new Error("Creating a polyline layer requires an existing .sourceId or a valid .data property");let m=e.data;if(typeof m=="string"){if(nb(m))m=`https://api.maptiler.com/data/${e.data}/features.json?key=${Ha.apiKey}`;else if(((a=m.split(".").pop())==null?void 0:a.toLowerCase().trim())==="gpx"){const g=await(await fetch(m,t)).text();m=MP(g)}else if(((h=m.split(".").pop())==null?void 0:h.toLowerCase().trim())==="kml"){const g=await(await fetch(m,t)).text();m=RP(g)}else{const g=WN(m)??TV(m);g&&(m=g)}if(!m)throw new Error("Polyline data was provided as string but is incompatible with valid formats.")}return CV(i,{...e,data:m})}function CV(i,e){if(e.layerId&&i.getLayer(e.layerId))throw new Error(`A layer already exists with the layer id: ${e.layerId}`);const t=e.sourceId??Iy(),a=e.layerId??Cy(),h={polylineLayerId:a,polylineOutlineLayerId:"",polylineSourceId:t};e.data&&!i.getSource(t)&&i.addSource(t,{type:"geojson",data:e.data});const m=e.lineWidth??3,g=e.lineColor??vb(),c=e.lineOpacity??1,C=e.lineBlur??0,k=e.lineGapWidth??0;let V=e.lineDashArray??null;const Z=e.outlineWidth??1,Y=e.outlineColor??"#FFFFFF",Q=e.outlineOpacity??1,be=e.outlineBlur??0;if(typeof V=="string"&&(V=Gw(V)),e.outline===!0){const xe=`${a}_outline`;h.polylineOutlineLayerId=xe,i.addLayer({id:xe,type:"line",source:t,layout:{"line-join":e.lineJoin??"round","line-cap":e.lineCap??"round"},minzoom:e.minzoom??0,maxzoom:e.maxzoom??23,paint:{"line-opacity":typeof Q=="number"?Q:dr(Q),"line-color":typeof Y=="string"?Y:Nf(Y),"line-width":NP(m,Z),"line-blur":typeof be=="number"?be:dr(be)}},e.beforeId)}return i.addLayer({id:a,type:"line",source:t,layout:{"line-join":e.lineJoin??"round","line-cap":e.lineCap??"round"},minzoom:e.minzoom??0,maxzoom:e.maxzoom??23,paint:{"line-opacity":typeof c=="number"?c:dr(c),"line-color":typeof g=="string"?g:Nf(g),"line-width":typeof m=="number"?m:dr(m),"line-blur":typeof C=="number"?C:dr(C),"line-gap-width":typeof k=="number"?k:dr(k),...V&&{"line-dasharray":V}}},e.beforeId),h}function PV(i,e){if(e.layerId&&i.getLayer(e.layerId))throw new Error(`A layer already exists with the layer id: ${e.layerId}`);const t=e.sourceId??Iy(),a=e.layerId??Cy(),h={polygonLayerId:a,polygonOutlineLayerId:e.outline?`${a}_outline`:"",polygonSourceId:t};if(e.data&&!i.getSource(t)){let xe=e.data;typeof xe=="string"&&nb(xe)&&(xe=`https://api.maptiler.com/data/${xe}/features.json?key=${Ha.apiKey}`),i.addSource(t,{type:"geojson",data:xe})}let m=e.outlineDashArray??null;const g=e.outlineWidth??1,c=e.outlineColor??"#FFFFFF",C=e.outlineOpacity??1,k=e.outlineBlur??0,V=e.fillColor??vb(),Z=e.fillOpacity??1,Y=e.outlinePosition??"center",Q=e.pattern??null;typeof m=="string"&&(m=Gw(m));const be=(xe=null)=>{if(i.addLayer({id:a,type:"fill",source:t,minzoom:e.minzoom??0,maxzoom:e.maxzoom??23,paint:{"fill-color":typeof V=="string"?V:Nf(V),"fill-opacity":typeof Z=="number"?Z:dr(Z),...xe&&{"fill-pattern":xe}}},e.beforeId),e.outline===!0){let ze;Y==="inside"?typeof g=="number"?ze=.5*g:ze=dr(g.map(({zoom:et,value:Qe})=>({zoom:et,value:.5*Qe}))):Y==="outside"?typeof g=="number"?ze=-.5*g:ze=dr(g.map(et=>({zoom:et.zoom,value:-.5*et.value}))):ze=0,i.addLayer({id:h.polygonOutlineLayerId,type:"line",source:t,layout:{"line-join":e.outlineJoin??"round","line-cap":e.outlineCap??"butt"},minzoom:e.minzoom??0,maxzoom:e.maxzoom??23,paint:{"line-opacity":typeof C=="number"?C:dr(C),"line-color":typeof c=="string"?c:Nf(c),"line-width":typeof g=="number"?g:dr(g),"line-blur":typeof k=="number"?k:dr(k),"line-offset":ze,...m&&{"line-dasharray":m}}},e.beforeId)}};return Q?i.hasImage(Q)?be(Q):i.loadImage(Q).then(xe=>{i.addImage(Q,xe.data),be(Q)}).catch(xe=>{console.error("Could not load the pattern image.",xe.message),be()}):be(),h}function MV(i,e){if(e.layerId&&i.getLayer(e.layerId))throw new Error(`A layer already exists with the layer id: ${e.layerId}`);const t=e.minPointRadius??10,a=e.maxPointRadius??50,h=e.cluster??!1,m=20,g=Array.isArray(e.pointColor)?e.pointColor:UP.TURBO.scale(10,e.cluster?1e4:1e3).resample("ease-out-square"),c=g.getBounds(),C=e.sourceId??Iy(),k=e.layerId??Cy(),V=e.showLabel??h,Z=e.alignOnViewport??!0,Y=e.outline??!1,Q=e.outlineOpacity??1,be=e.outlineWidth??1,xe=e.outlineColor??"#FFFFFF";let ze;const et=e.zoomCompensation??!0,Qe=e.minzoom??0,Xe=e.maxzoom??23;typeof e.pointOpacity=="number"?ze=e.pointOpacity:Array.isArray(e.pointOpacity)?ze=dr(e.pointOpacity):e.cluster?ze=p1(g,"point_count"):e.property?ze=p1(g,e.property):ze=dr([{zoom:Qe,value:0},{zoom:Qe+.25,value:1},{zoom:Xe-.25,value:1},{zoom:Xe,value:0}]);const Ke={pointLayerId:k,clusterLayerId:"",labelLayerId:"",pointSourceId:C};if(e.data&&!i.getSource(C)){let Ve=e.data;typeof Ve=="string"&&nb(Ve)&&(Ve=`https://api.maptiler.com/data/${Ve}/features.json?key=${Ha.apiKey}`),i.addSource(C,{type:"geojson",data:Ve,cluster:h})}if(h){Ke.clusterLayerId=`${k}_cluster`;const Ve=Array.from({length:m},(it,de)=>{const ce=c.min+de*(c.max-c.min)/(m-1);return{value:ce,pointRadius:t+(a-t)*(de/(m-1))**.5,color:g.getColorHex(ce)}});i.addLayer({id:Ke.clusterLayerId,type:"circle",source:C,filter:["has","point_count"],paint:{"circle-color":typeof e.pointColor=="string"?e.pointColor:d1(Ve,"point_count"),"circle-radius":typeof e.pointRadius=="number"?e.pointRadius:Array.isArray(e.pointRadius)?dr(e.pointRadius):f1(Ve,"point_count",!1),"circle-pitch-alignment":Z?"viewport":"map","circle-pitch-scale":"map","circle-opacity":ze,...Y&&{"circle-stroke-opacity":typeof Q=="number"?Q:dr(Q),"circle-stroke-width":typeof be=="number"?be:dr(be),"circle-stroke-color":typeof xe=="string"?xe:Nf(xe)}},minzoom:Qe,maxzoom:Xe},e.beforeId),i.addLayer({id:Ke.pointLayerId,type:"circle",source:C,filter:["!",["has","point_count"]],paint:{"circle-pitch-alignment":Z?"viewport":"map","circle-pitch-scale":"map","circle-color":typeof e.pointColor=="string"?e.pointColor:g.getColorHex(g.getBounds().min),"circle-radius":typeof e.pointRadius=="number"?e.pointRadius:Array.isArray(e.pointRadius)?dr(e.pointRadius):Ve[0].pointRadius*.75,"circle-opacity":ze,...Y&&{"circle-stroke-opacity":typeof Q=="number"?Q:dr(Q),"circle-stroke-width":typeof be=="number"?be:dr(be),"circle-stroke-color":typeof xe=="string"?xe:Nf(xe)}},minzoom:Qe,maxzoom:Xe},e.beforeId)}else{let Ve=typeof e.pointColor=="string"?e.pointColor:Array.isArray(e.pointColor)?e.pointColor.getColorHex(e.pointColor.getBounds().min):vb(),it=typeof e.pointRadius=="number"?et?dr([{zoom:0,value:e.pointRadius*.025},{zoom:2,value:e.pointRadius*.05},{zoom:4,value:e.pointRadius*.1},{zoom:8,value:e.pointRadius*.25},{zoom:16,value:e.pointRadius*1}]):e.pointRadius:Array.isArray(e.pointRadius)?dr(e.pointRadius):et?dr([{zoom:0,value:t*.05},{zoom:2,value:t*.1},{zoom:4,value:t*.2},{zoom:8,value:t*.5},{zoom:16,value:t*1}]):t;if(e.property&&Array.isArray(e.pointColor)){const de=Array.from({length:m},(ce,me)=>{const Ee=c.min+me*(c.max-c.min)/(m-1);return{value:Ee,pointRadius:typeof e.pointRadius=="number"?e.pointRadius:t+(a-t)*(me/(m-1))**.5,color:typeof e.pointColor=="string"?e.pointColor:g.getColorHex(Ee)}});Ve=d1(de,e.property),it=f1(de,e.property,et)}i.addLayer({id:Ke.pointLayerId,type:"circle",source:C,layout:{"circle-sort-key":e.property?["/",1,["get",e.property]]:0},paint:{"circle-pitch-alignment":Z?"viewport":"map","circle-pitch-scale":"map","circle-color":Ve,"circle-opacity":ze,"circle-radius":it,...Y&&{"circle-stroke-opacity":typeof Q=="number"?Q:dr(Q),"circle-stroke-width":typeof be=="number"?be:dr(be),"circle-stroke-color":typeof xe=="string"?xe:Nf(xe)}},minzoom:Qe,maxzoom:Xe},e.beforeId)}if(V!==!1&&(e.cluster||e.property)){Ke.labelLayerId=`${k}_label`;const Ve=e.labelColor??"#fff",it=e.labelSize??12;i.addLayer({id:Ke.labelLayerId,type:"symbol",source:C,filter:["has",e.cluster?"point_count":e.property],layout:{"text-field":e.cluster?"{point_count_abbreviated}":`{${e.property}}`,"text-font":["Noto Sans Regular"],"text-size":it,"text-pitch-alignment":Z?"viewport":"map","symbol-sort-key":["/",1,["get",e.cluster?"point_count":e.property]]},paint:{"text-color":Ve,"text-opacity":ze},minzoom:Qe,maxzoom:Xe},e.beforeId)}return Ke}function RV(i,e){if(e.layerId&&i.getLayer(e.layerId))throw new Error(`A layer already exists with the layer id: ${e.layerId}`);const t=e.sourceId??Iy(),a=e.layerId??Cy(),h=e.minzoom??0,m=e.maxzoom??23,g=e.zoomCompensation??!0,c=e.opacity??[{zoom:h,value:0},{zoom:h+.25,value:1},{zoom:m-.25,value:1},{zoom:m,value:0}];let C=Array.isArray(e.colorRamp)?e.colorRamp:UP.TURBO.transparentStart();const k=C.getBounds();(k.min!==0||k.max!==1)&&(C=C.scale(0,1)),C.hasTransparentStart()||(C=C.transparentStart());const V=e.intensity??[{zoom:0,value:.01},{zoom:4,value:.2},{zoom:16,value:1}],Z=e.property??null,Y=e.weight??1;let Q=1;Z?typeof Y=="number"?(Q=Y,typeof e.weight=="number"&&console.warn("The option `.property` is ignored when `.propertyValueWeights` is not of type `PropertyValueWeights`")):Array.isArray(Y)?Q=BP(Y,Z):console.warn("The option `.property` is ignored when `.propertyValueWeights` is not of type `PropertyValueWeights`"):typeof Y=="number"?Q=Y:Array.isArray(Y)&&console.warn("The options `.propertyValueWeights` can only be used when `.property` is provided.");const be=[{zoom:0,value:50*.025},{zoom:2,value:50*.05},{zoom:4,value:50*.1},{zoom:8,value:50*.25},{zoom:16,value:50}],xe=e.radius??(g?be:10);let ze=1;typeof xe=="number"?ze=xe:Array.isArray(xe)&&"zoom"in xe[0]?ze=dr(xe):Z&&Array.isArray(xe)&&"propertyValue"in xe[0]?ze=FP(xe,Z,g):!Z&&Array.isArray(xe)&&"propertyValue"in xe[0]?(ze=dr(be),console.warn("The option `.radius` can only be property-driven if the option `.property` is provided.")):ze=dr(be);const et={heatmapLayerId:a,heatmapSourceId:t};if(e.data&&!i.getSource(t)){let Qe=e.data;typeof Qe=="string"&&nb(Qe)&&(Qe=`https://api.maptiler.com/data/${Qe}/features.json?key=${Ha.apiKey}`),i.addSource(t,{type:"geojson",data:Qe})}return i.addLayer({id:a,type:"heatmap",source:t,minzoom:h,maxzoom:m,paint:{"heatmap-weight":Q,"heatmap-intensity":typeof V=="number"?V:dr(V),"heatmap-color":VP(C),"heatmap-radius":ze,"heatmap-opacity":typeof c=="number"?c:dr(c)}},e.beforeId),et}const x_=Object.freeze(Object.defineProperty({__proto__:null,addHeatmap:RV,addPoint:MV,addPolygon:PV,addPolyline:IV,colorDrivenByProperty:d1,colorPalettes:c1,computeRampedOutlineWidth:NP,dashArrayMaker:Gw,generateRandomLayerName:Cy,generateRandomSourceName:Iy,getRandomColor:vb,heatmapIntensityFromColorRamp:VP,lerpZoomNumberValues:h1,opacityDrivenByProperty:p1,paintColorOptionsToPaintSpec:Nf,radiusDrivenByProperty:f1,radiusDrivenByPropertyHeatmap:FP,rampedOptionsToLayerPaintSpec:dr,rampedPropertyValueWeight:BP,takeScreenshot:SV},Symbol.toStringTag,{value:"Module"}));ZN();function kV(){return"3.8.0"}Sn.Map;Sn.Marker;Sn.Popup;Sn.Style;Sn.CanvasSource;Sn.GeoJSONSource;Sn.ImageSource;Sn.RasterTileSource;Sn.RasterDEMTileSource;Sn.VectorTileSource;Sn.VideoSource;Sn.NavigationControl;Sn.GeolocateControl;Sn.AttributionControl;Sn.LogoControl;Sn.ScaleControl;Sn.FullscreenControl;Sn.TerrainControl;Sn.BoxZoomHandler;Sn.ScrollZoomHandler;Sn.CooperativeGesturesHandler;Sn.KeyboardHandler;Sn.TwoFingersTouchPitchHandler;Sn.MapWheelEvent;Sn.MapTouchEvent;Sn.MapMouseEvent;Sn.config;Sn.getVersion;const{setRTLTextPlugin:nU,getRTLTextPluginStatus:iU,LngLat:rU,LngLatBounds:aU,MercatorCoordinate:sU,Evented:oU,AJAXError:lU,prewarm:uU,clearPrewarmedResources:cU,Hash:hU,Point:dU,EdgeInsets:fU,DragRotateHandler:pU,DragPanHandler:mU,TwoFingersTouchZoomRotateHandler:gU,DoubleClickZoomHandler:_U,TwoFingersTouchZoomHandler:yU,TwoFingersTouchRotateHandler:vU,getWorkerCount:bU,setWorkerCount:xU,getMaxParallelImageRequests:wU,setMaxParallelImageRequests:TU,getWorkerUrl:SU,setWorkerUrl:EU,addSourceType:AU,importScriptInWorkers:IU,addProtocol:CU,removeProtocol:PU}=Sn,LV="@maptiler/leaflet-maptilersdk",DV="4.1.1",zV=Dr.Layer.extend({options:{updateInterval:32,padding:.1,interactive:!1,pane:"tilePane"},map:null,initialize:function(i){Dr.setOptions(this,i),this._throttledUpdate=Dr.Util.throttle(this._update,this.options.updateInterval,this)},onAdd:function(i){var e;this._container||this._initContainer();const t=this.getPaneName();(e=i.getPane(t))==null||e.appendChild(this._container),this._initMaptilerSDK(),this._offset=this._map.containerPointToLayerPoint([0,0]),i.options.zoomAnimation&&Dr.DomEvent.on(i._proxy,Dr.DomUtil.TRANSITION_END,this._transitionEnd,this),i.attributionControl.addAttribution('<a href="https://www.maptiler.com/copyright/" target="_blank">&copy; MapTiler</a> <a href="https://www.openstreetmap.org/copyright" target="_blank">&copy; OpenStreetMap contributors</a>')},onRemove:function(i){var e;this._map._proxy&&this._map.options.zoomAnimation&&Dr.DomEvent.off(this._map._proxy,Dr.DomUtil.TRANSITION_END,this._transitionEnd,this);const t=this.getPaneName();(e=i.getPane(t))==null||e.removeChild(this._container),this._maptilerMap.remove(),this._maptilerMap=null},getEvents:function(){return{move:this._throttledUpdate,zoomanim:this._animateZoom,zoom:this._pinchZoom,zoomstart:this._zoomStart,zoomend:this._zoomEnd,resize:this._resize}},getMaptilerSDKMap:function(){return this._maptilerMap},getCanvas:function(){return this._maptilerMap.getCanvas()},getSize:function(){return this._map.getSize().multiplyBy(1+this.options.padding*2)},getBounds:function(){const i=this.getSize().multiplyBy(.5),e=this._map.latLngToContainerPoint(this._map.getCenter());return Dr.latLngBounds(this._map.containerPointToLatLng(e.subtract(i)),this._map.containerPointToLatLng(e.add(i)))},getContainer:function(){return this._container},getPaneName:function(){return this._map.getPane(this.options.pane)?this.options.pane:"tilePane"},setStyle:function(i){this._maptilerMap.setStyle(i)},setLanguage:function(i){this._maptilerMap.setLanguage(i)},_roundPoint:i=>({x:Math.round(i.x),y:Math.round(i.y)}),_initContainer:function(){this._container=Dr.DomUtil.create("div","leaflet-gl-layer");const i=this.getSize(),e=this._map.getSize().multiplyBy(this.options.padding);this._container.style.width=`${i.x}px`,this._container.style.height=`${i.y}px`;const t=this._map.containerPointToLayerPoint([0,0]).subtract(e);Dr.DomUtil.setPosition(this._container,this._roundPoint(t))},_initMaptilerSDK:function(){const i=this._map.getCenter(),e=this.options.maxBounds?this.options.maxBounds:[[Number.NEGATIVE_INFINITY,-90],[Number.POSITIVE_INFINITY,90]];this._map.setMaxBounds(Dr.latLngBounds(Dr.latLng(e[0][1],e[0][0]),Dr.latLng(e[1][1],e[1][0])));const t={maxBounds:e,...this.options,projection:"mercator",container:this._container,center:[i.lng,i.lat],zoom:this._map.getZoom()-1,attributionControl:!1};this.options.geolocate&&(t.center=void 0,t.zoom=void 0),this._maptilerMap=new IP(t),this._maptilerMap.telemetry.registerModule(LV,DV),this._maptilerMap.once("load",()=>{this.fire("ready")}),this._maptilerMap.once("load",async()=>{let h={logo:null};try{const m=Object.keys(this._maptilerMap.style.sourceCaches).map(c=>this._maptilerMap.getSource(c)).filter(c=>c&&"url"in c&&typeof c.url=="string"&&(c==null?void 0:c.url.includes("tiles.json"))),g=new URL(m[0].url);g.searchParams.has("key")||g.searchParams.append("key",t.apiKey),h=await(await fetch(g.href)).json()}catch{}if(h.logo||t.maptilerLogo){const m=h.logo??"https://api.maptiler.com/resources/logo.svg",g=document.createElement("a");g.href="https://www.maptiler.com",g.style.setProperty("position","absolute"),g.style.setProperty("left","10px"),g.style.setProperty("bottom","2px"),g.style.setProperty("z-index","999");const c=document.createElement("img");c.src=m,c.alt="MapTiler logo",c.width=100,c.height=30,g.appendChild(c),this._map.getContainer().appendChild(g)}}),this._maptilerMap.transform.freezeElevation=!0,this.options.geolocate&&this._maptilerMap.on("load",()=>{this._map.setView(this._maptilerMap.getCenter(),this._maptilerMap.getZoom()+1)}),this._transformGL(),this._maptilerMap._actualCanvas=this._maptilerMap._canvas;const a=this._maptilerMap._actualCanvas;Dr.DomUtil.addClass(a,"leaflet-image-layer"),Dr.DomUtil.addClass(a,"leaflet-zoom-animated"),this.options.interactive&&Dr.DomUtil.addClass(a,"leaflet-interactive"),this.options.className&&Dr.DomUtil.addClass(a,this.options.className),this.addHeatmap=h=>x_.addHeatmap(this._maptilerMap,h),this.addPolygon=h=>x_.addPolygon(this._maptilerMap,h),this.addPoint=h=>x_.addPoint(this._maptilerMap,h),this.addPolyline=h=>x_.addPolyline(this._maptilerMap,h),this.takeScreenshot=h=>x_.takeScreenshot(this._maptilerMap,h)},_update:function(){if(this._offset=this._map.containerPointToLayerPoint([0,0]),this._zooming)return;const i=this.getSize(),e=this._map.getSize().multiplyBy(this.options.padding),t=this._map.containerPointToLayerPoint([0,0]).subtract(e);Dr.DomUtil.setPosition(this._container,this._roundPoint(t)),this._transformGL(),this._maptilerMap.transform.width!==i.x||this._maptilerMap.transform.height!==i.y?(this._container.style.width=`${i.x}px`,this._container.style.height=`${i.y}px`,this._maptilerMap._resize!==null&&this._maptilerMap._resize!==void 0?this._maptilerMap._resize():this._maptilerMap.resize()):this._maptilerMap._update!==null&&this._maptilerMap._update!==void 0?this._maptilerMap._update():this._maptilerMap.update()},_transformGL:function(){this._maptilerMap.setCenter(this._map.getCenter()),this._maptilerMap.setZoom(this._map.getZoom()-1)},_pinchZoom:function(){this._maptilerMap.jumpTo({zoom:this._map.getZoom()-1,center:this._map.getCenter()})},_animateZoom:function(i){const e=this._map.getZoomScale(i.zoom),t=this._map.getSize().multiplyBy(this.options.padding*e),a=this.getSize()._divideBy(2),h=this._map.project(i.center,i.zoom)._subtract(a)._add(this._map._getMapPanePos().add(t))._round(),m=this._map.project(this._map.getBounds().getNorthWest(),i.zoom)._subtract(h);Dr.DomUtil.setTransform(this._maptilerMap.getCanvas(),m.subtract(this._offset),e)},_zoomStart:function(){this._zooming=!0},_zoomEnd:function(){const i=this._map.getZoomScale(this._map.getZoom());Dr.DomUtil.setTransform(this._maptilerMap.getCanvas(),new Dr.Point(0,0),i),this._zooming=!1,this._update()},_transitionEnd:function(){Dr.Util.requestAnimFrame(()=>{const i=this._map.getZoom(),e=this._map.getCenter(),t=this._map.latLngToContainerPoint(this._map.getBounds().getNorthWest());Dr.DomUtil.setTransform(this._maptilerMap._actualCanvas,t,1),this._maptilerMap.once("moveend",Dr.Util.bind(()=>{this._zoomEnd()},this)),this._maptilerMap.jumpTo({center:e,zoom:i-1})},this)},_resize:function(i){this._transitionEnd(i)}});function tE({reports:i=[],onReportClick:e}){const[t,a]=Tt.useState([]),[h,m]=Tt.useState([]),[g,c]=Tt.useState([]),[C,k]=Tt.useState(!0),[V,Z]=Tt.useState(null),[Y,Q]=Tt.useState({selectedCampus:"All",selectedMonth:"All",selectedTypes:[],showMenu:!1}),be=Tt.useRef(null),xe=()=>{const de=new Set;return t.forEach(ce=>{const me=new Date(ce.time),Ee=`${me.getFullYear()}-${String(me.getMonth()+1).padStart(2,"0")}`;de.add(Ee)}),["All",...Array.from(de).sort().reverse()]},ze=[{id:0,name:"Uncomfortable Situation",color:"#de9e36"},{id:1,name:"Sexual Harassment",color:"#ca3c25"},{id:2,name:"Physical",color:"#701d52"},{id:3,name:"Verbal Aggression",color:"#212475"},{id:4,name:"Discrimination",color:"#1d1a05"}],et=()=>{const de={};return tx.forEach(ce=>{de[ce.name]={buildingName:ce.name,coordinates:[ce.latitude,ce.longitude],totalIncidents:0,incidentCounts:{"Uncomfortable Situation":0,"Sexual Harassment":0,Physical:0,"Verbal Aggression":0,Discrimination:0},buildingType:ce.type,location:ce.location,recentIncidents:[]}}),de},Qe=de=>de.filter(ce=>{if(Y.selectedCampus!=="All"){const me=tx.find(Ee=>Ee.name===ce.specificLocation);if(!me||me.location!==Y.selectedCampus)return!1}if(Y.selectedMonth!=="All"){const me=new Date(ce.time);if(`${me.getFullYear()}-${String(me.getMonth()+1).padStart(2,"0")}`!==Y.selectedMonth)return!1}return!(Y.selectedTypes.length>0&&!Y.selectedTypes.some(me=>ce.offenseTypes.includes(me)))}),Xe=(de,ce)=>{Q(me=>({...me,[de]:ce}))},Ke=de=>{Q(ce=>({...ce,selectedTypes:ce.selectedTypes.includes(de)?ce.selectedTypes.filter(me=>me!==de):[...ce.selectedTypes,de]}))},Ve=de=>{if(be.current)if(de==="All")be.current.setView([41.7002,-86.2379],15);else{const ce=tx.filter(me=>me.location===de);if(ce.length>0){const me=Dr.latLngBounds(ce.map(Ee=>[Ee.latitude,Ee.longitude]));be.current.fitBounds(me,{padding:[50,50]})}}};Tt.useEffect(()=>{const de=async()=>{try{const ce=[];Y!=null&&Y.selectedCampus&&Y.selectedCampus!=="All"&&ce.push(Xb("campus","==",Y.selectedCampus)),Y!=null&&Y.selectedMonth&&ce.push(Xb("createdAt",">=",Y.selectedMonth)),ce.push(Xb("status","==","submitted"));const me=iI(dC,"reports"),Ee=Ez(me,...ce),De=await Mz(Ee);a(De.docs.map($e=>$e.data()))}catch(ce){throw console.error("Error fetching incidents:",ce),new Error("Failed to fetch incident data")}};be.current||(be.current=Dr.map("map",{maxZoom:19}).setView([41.7002,-86.2379],15).setMinZoom(15).setMaxBounds([[41.7852,-86.1779],[41.5852,-86.2879]]),new zV({style:"80390579-ac14-4623-ba3e-80bdbcb7bd5f",apiKey:"0UGrg19TXtYRROinsJ9a"}).addTo(be.current)),de()},[]),Tt.useEffect(()=>{m(Qe(t))},[t,Y]),Tt.useEffect(()=>{if(!be.current||h.length===0)return;be.current.eachLayer(ce=>{ce instanceof Dr.Circle&&be.current.removeLayer(ce)});const de=et();h.forEach(ce=>{try{const me=ce.specificLocation;de[me]&&(de[me].totalIncidents++,ce.offenseTypes.forEach(Ee=>{de[me].incidentCounts[Ee]!==void 0&&de[me].incidentCounts[Ee]++}),de[me].recentIncidents.push(ce),de[me].recentIncidents.length>10&&de[me].recentIncidents.shift())}catch(me){console.warn(`Error processing incident for ${ce.specificLocation}:`,me)}}),c(Object.values(de)),Object.values(de).forEach(ce=>{if(ce.totalIncidents>0){const me=Math.min(ce.totalIncidents*10+15,100),Ee=Object.entries(ce.incidentCounts).sort(([,ti],[,gt])=>gt-ti)[0][0],$e={"Uncomfortable Situation":"#de9e36","Sexual Harassment":"#ca3c25",Physical:"#701d52","Verbal Aggression":"#212475",Discrimination:"#1d1a05"}[Ee]||"#666666";Dr.circle(ce.coordinates,{color:$e,fillColor:$e,fillOpacity:.7,radius:me,weight:2}).addTo(be.current);const ke=it(ce);let Bn="black";ce.location==="Notre Dame"?Bn="#FFD700":ce.location==="Holy Cross"?Bn="#fff":ce.location==="Saint Mary's"&&(Bn="#87CEEB"),Dr.circle(ce.coordinates,{fillColor:Bn,fillOpacity:.5,color:Bn,radius:15}).addTo(be.current).bindPopup(ke,{maxWidth:400,className:"enhanced-popup"})}})},[h]);const it=de=>{const ce=new Date;ce.setDate(ce.getDate()-7);const me=de.recentIncidents.filter(ke=>new Date(ke.time)>=ce);let Ee=1;me.length>=5?Ee=5:me.length>=3?Ee=4:me.length>=2?Ee=3:me.length>=1?Ee=2:Ee=1;const De=Ee>=4?"#ca3c25":Ee>=3?"#de9e36":Ee>=2?"#212475":"#28a745",$e=[{name:"Uncomfortable Situation",color:"#de9e36"},{name:"Sexual Harassment",color:"#ca3c25"},{name:"Physical",color:"#701d52"},{name:"Verbal Aggression",color:"#212475"},{name:"Discrimination",color:"#1d1a05"}];return`
      <div class="enhanced-popup-content">
        <h3 style="margin: 0 0 10px 0; color: #333;">${de.buildingName}</h3>
        
        <div style="margin-bottom: 10px;">
          <span style="font-weight: bold; color: #666;">Location:</span> ${de.location}<br>
          <span style="font-weight: bold; color: #666;">Building Type:</span> ${de.buildingType}
        </div>
        
        <div style="margin-bottom: 10px;">
          <span style="font-weight: bold; color: #666;">Total Cases:</span> ${de.totalIncidents}
        </div>
        
        <div style="margin-bottom: 10px;">
          <span style="font-weight: bold; color: #666;">Cases by Type:</span><br>
          ${Object.entries(de.incidentCounts).filter(([,ke])=>ke>0).map(([ke,Bn])=>{const ti=$e.find(gt=>gt.name===ke);return ti?`<div style="margin: 2px 0; font-size: 12px;">
                <span style="color: ${ti.color}; font-weight: bold;"></span>
                ${ti.name}: ${Bn}
              </div>`:""}).join("")}
        </div>
        
        <div style="margin-bottom: 10px;">
          <span style="font-weight: bold; color: #666;">Risk Score:</span> 
          <span style="color: ${De}; font-weight: bold; font-size: 16px;">
            ${Ee}/5
          </span>
          ${me.length>0?`<br><span style="font-size: 12px; color: #666;">
              (${me.length} recent case${me.length>1?"s":""} in last 7 days)
            </span>`:'<br><span style="font-size: 12px; color: #28a745;">(No recent activity)</span>'}
        </div>
      </div>
    `};return Pe.jsxs("div",{className:"fullscreen-map-container",children:[Pe.jsxs("div",{className:"map-filter-menu m-2",children:[Pe.jsx("button",{className:"menu-toggle-btn",onClick:()=>Xe("showMenu",!Y.showMenu),children:Y.showMenu?"":""}),Y.showMenu&&Pe.jsxs("div",{className:"filter-content",children:[Pe.jsx("h3",{children:"Map Filters"}),Pe.jsxs("div",{className:"filter-section",children:[Pe.jsx("label",{children:"Campus:"}),Pe.jsx("select",{value:Y.selectedCampus,onChange:de=>{Xe("selectedCampus",de.target.value),Ve(de.target.value)},children:pC.map(de=>Pe.jsx("option",{value:de.toString(),children:de.toString()},de.toString()))})]}),Pe.jsxs("div",{className:"filter-section",children:[Pe.jsx("label",{children:"Month:"}),Pe.jsx("select",{value:Y.selectedMonth,onChange:de=>Xe("selectedMonth",de.target.value),children:xe().map(de=>Pe.jsx("option",{value:de,children:de==="All"?"All Time":de},de))})]}),Pe.jsxs("div",{className:"filter-section",children:[Pe.jsx("label",{children:"Incident Types:"}),Pe.jsx("div",{className:"type-filters",children:ze.map(de=>Pe.jsxs("label",{className:"type-checkbox custom-circle-checkbox",style:{cursor:"pointer"},children:[Pe.jsx("input",{type:"checkbox",checked:Y.selectedTypes.includes(de.name),onChange:()=>Ke(de.name),style:{display:"none"}}),Pe.jsx("span",{className:`type-color-dot-circle ${Y.selectedTypes.includes(de.name)?"selected":""}`,style:{backgroundColor:de.color,borderColor:de.color},children:Y.selectedTypes.includes(de.name)&&Pe.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",style:{display:"block",margin:"auto"},children:Pe.jsx("circle",{cx:"13",cy:"13",r:"10",fill:"#fff",opacity:"0.8"})})}),Pe.jsx("span",{style:{marginLeft:8},children:de.name})]},de.name))})]}),Pe.jsx("button",{className:"clear-filters-btn",onClick:()=>Q({selectedCampus:"All",selectedMonth:"All",selectedTypes:[],showMenu:Y.showMenu}),children:"Clear All Filters"}),Pe.jsxs("div",{className:"results-summary",children:[Pe.jsxs("p",{children:["Showing ",h.length," incidents"]}),Y.selectedCampus!=="All"&&Pe.jsxs("p",{children:["Campus: ",Y.selectedCampus]}),Y.selectedMonth!=="All"&&Pe.jsxs("p",{children:["Period: ",Y.selectedMonth]}),Y.selectedTypes.length>0&&Pe.jsxs("p",{children:["Types:"," ",Y.selectedTypes.map(de=>{var ce;return(ce=ze.find(me=>me.name===de))==null?void 0:ce.name}).join(", ")]})]})]})]}),Pe.jsxs("div",{children:[Pe.jsx("a",{href:"../",className:"back-button",children:Pe.jsx("button",{className:"option abs right small",children:"Back"})}),Pe.jsx("a",{"data-az-l":"1e9e1abc-2335-4838-949d-8ab8af0dd8c9",className:"back-button",children:Pe.jsx("button",{className:"option abs right mt-5 small",children:"Leave Feedback"})})]}),C&&Pe.jsx("div",{className:"loading-overlay",children:Pe.jsx("div",{className:"loading-content",children:"Loading incident data..."})}),V&&Pe.jsx("div",{className:"error-overlay",children:V}),Pe.jsx("div",{id:"map",className:"fullscreen-map"})]})}JP.createRoot(document.getElementById("root")).render(Pe.jsx(GP.StrictMode,{children:Pe.jsx(fR,{children:Pe.jsxs($M,{children:[Pe.jsx(Pp,{path:"/",element:Pe.jsx(o2,{})}),Pe.jsx(Pp,{path:"/client/",element:Pe.jsx(o2,{})}),Pe.jsx(Pp,{path:"/report",element:Pe.jsx(GT,{})}),Pe.jsx(Pp,{path:"/client/report",element:Pe.jsx(GT,{})}),Pe.jsx(Pp,{path:"/map",element:Pe.jsx(tE,{})}),Pe.jsx(Pp,{path:"/client/map",element:Pe.jsx(tE,{})})]})})}));
